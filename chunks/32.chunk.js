/*! For license information please see jt0ced8.32.91589fae.chunk.js.LICENSE.txt */
(self.isj1uwvwrek=self.isj1uwvwrek||[]).push([[32],{14705:(I,x,L)=>{"use strict";var F=L(14710),X=L(14717),G=L(14724);L.g.__TYPEDARRAY_POOL||(L.g.__TYPEDARRAY_POOL={UINT8:X([32,0]),UINT16:X([32,0]),UINT32:X([32,0]),INT8:X([32,0]),INT16:X([32,0]),INT32:X([32,0]),FLOAT:X([32,0]),DOUBLE:X([32,0]),DATA:X([32,0]),UINT8C:X([32,0]),BUFFER:X([32,0])});var Y="undefined"!==typeof Uint8ClampedArray,p=L.g.__TYPEDARRAY_POOL;p.UINT8C||(p.UINT8C=X([32,0])),p.BUFFER||(p.BUFFER=X([32,0]));var B=p.DATA,l=p.BUFFER;function W(I){if(I){var x=I.length||I.byteLength,L=F.log2(x);B[L].push(I)}}function Q(I){I=F.nextPow2(I);var x=F.log2(I),L=B[x];return L.length>0?L.pop():new ArrayBuffer(I)}function e(I){return new Uint8Array(Q(I),0,I)}function g(I){return new Uint16Array(Q(2*I),0,I)}function v(I){return new Uint32Array(Q(4*I),0,I)}function z(I){return new Int8Array(Q(I),0,I)}function H(I){return new Int16Array(Q(2*I),0,I)}function s(I){return new Int32Array(Q(4*I),0,I)}function U(I){return new Float32Array(Q(4*I),0,I)}function q(I){return new Float64Array(Q(8*I),0,I)}function y(I){return Y?new Uint8ClampedArray(Q(I),0,I):e(I)}function T(I){return new DataView(Q(I),0,I)}x.free=function(I){if(G(I))l[F.log2(I.length)].push(I);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(I)&&(I=I.buffer),!I)return;var x=I.length||I.byteLength,L=0|F.log2(x);B[L].push(I)}},x.freeUint8=x.freeUint16=x.freeUint32=x.freeInt8=x.freeInt16=x.freeInt32=x.freeFloat32=x.freeFloat=x.freeFloat64=x.freeDouble=x.freeUint8Clamped=x.freeDataView=function(I){W(I.buffer)},x.freeArrayBuffer=W,x.freeBuffer=function(I){l[F.log2(I.length)].push(I)},x.malloc=function(I,x){if(void 0===x||"arraybuffer"===x)return Q(I);switch(x){case"uint8":return e(I);case"uint16":return g(I);case"uint32":return v(I);case"int8":return z(I);case"int16":return H(I);case"int32":return s(I);case"float":case"float32":return U(I);case"double":case"float64":return q(I);case"uint8_clamped":return y(I);case"buffer":throw"Buffer not supported";case"data":case"dataview":return T(I);default:return null}return null},x.mallocArrayBuffer=Q,x.mallocUint8=e,x.mallocUint16=g,x.mallocUint32=v,x.mallocInt8=z,x.mallocInt16=H,x.mallocInt32=s,x.mallocFloat32=x.mallocFloat=U,x.mallocFloat64=x.mallocDouble=q,x.mallocUint8Clamped=y,x.mallocDataView=T,x.clearCache=function(){for(var I=0;I<32;++I)p.UINT8[I].length=0,p.UINT16[I].length=0,p.UINT32[I].length=0,p.INT8[I].length=0,p.INT16[I].length=0,p.INT32[I].length=0,p.FLOAT[I].length=0,p.DOUBLE[I].length=0,p.UINT8C[I].length=0,B[I].length=0,l[I].length=0}},14809:(I,x,L)=>{I.exports=X;var F=L(13764);function X(I,x){if(!(this instanceof X))return new X(I,x);var L=F.create();F.add(L,I,x),this.base=F.min(F.create(),I,L),this.OW=F.clone(x),this.max=F.max(F.create(),I,L),this.mag=F.length(this.OW)}var G=X.prototype;G.width=function(){return this.OW[0]},G.height=function(){return this.OW[1]},G.depth=function(){return this.OW[2]},G.x0=function(){return this.base[0]},G.y0=function(){return this.base[1]},G.z0=function(){return this.base[2]},G.x1=function(){return this.max[0]},G.y1=function(){return this.max[1]},G.z1=function(){return this.max[2]},G.translate=function(I){return F.add(this.max,this.max,I),F.add(this.base,this.base,I),this},G.setPosition=function(I){return F.add(this.max,I,this.OW),F.j(this.base,I),this},G.expand=function(I){var x=F.create(),L=F.create();return F.max(x,I.max,this.max),F.min(L,I.base,this.base),F.Ux(x,x,L),new X(L,x)},G.intersects=function(I){return!(I.base[0]>this.max[0])&&(!(I.base[1]>this.max[1])&&(!(I.base[2]>this.max[2])&&(!(I.max[0]<this.base[0])&&(!(I.max[1]<this.base[1])&&!(I.max[2]<this.base[2])))))},G.touches=function(I){var x=this.union(I);return null!==x&&(0==x.width()||0==x.height()||0==x.depth())},G.union=function(I){if(!this.intersects(I))return null;var x=Math.max(I.base[0],this.base[0]),L=Math.max(I.base[1],this.base[1]),F=Math.max(I.base[2],this.base[2]);return new X([x,L,F],[Math.min(I.max[0],this.max[0])-x,Math.min(I.max[1],this.max[1])-L,Math.min(I.max[2],this.max[2])-F])}},14710:(I,x)=>{"use strict";function L(I){var x=32;return(I&=-I)&&x--,65535&I&&(x-=16),16711935&I&&(x-=8),252645135&I&&(x-=4),858993459&I&&(x-=2),1431655765&I&&(x-=1),x}x.INT_BITS=32,x.INT_MAX=2147483647,x.INT_MIN=-1<<31,x.sign=function(I){return(I>0)-(I<0)},x.abs=function(I){var x=I>>31;return(I^x)-x},x.min=function(I,x){return x^(I^x)&-(I<x)},x.max=function(I,x){return I^(I^x)&-(I<x)},x.isPow2=function(I){return!(I&I-1)&&!!I},x.log2=function(I){var x,L;return x=(I>65535)<<4,x|=L=((I>>>=x)>255)<<3,x|=L=((I>>>=L)>15)<<2,(x|=L=((I>>>=L)>3)<<1)|(I>>>=L)>>1},x.log10=function(I){return I>=1e9?9:I>=1e8?8:I>=1e7?7:I>=1e6?6:I>=1e5?5:I>=1e4?4:I>=1e3?3:I>=100?2:I>=10?1:0},x.popCount=function(I){return 16843009*((I=(858993459&(I-=I>>>1&1431655765))+(I>>>2&858993459))+(I>>>4)&252645135)>>>24},x.countTrailingZeros=L,x.nextPow2=function(I){return I+=0===I,--I,I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)+1},x.prevPow2=function(I){return I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)-(I>>>1)},x.parity=function(I){return I^=I>>>16,I^=I>>>8,I^=I>>>4,27030>>>(I&=15)&1};var F=new Array(256);!function(I){for(var x=0;x<256;++x){var L=x,F=x,X=7;for(L>>>=1;L;L>>>=1)F<<=1,F|=1&L,--X;I[x]=F<<X&255}}(F),x.reverse=function(I){return F[255&I]<<24|F[I>>>8&255]<<16|F[I>>>16&255]<<8|F[I>>>24&255]},x.interleave2=function(I,x){return(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))|(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x&=65535)|x<<8))|x<<4))|x<<2))|x<<1))<<1},x.deinterleave2=function(I,x){return(I=65535&((I=16711935&((I=252645135&((I=858993459&((I=I>>>x&1431655765)|I>>>1))|I>>>2))|I>>>4))|I>>>16))<<16>>16},x.interleave3=function(I,x,L){return I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2),(I|=(x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2))<<1)|(L=1227133513&((L=3272356035&((L=251719695&((L=4278190335&((L&=1023)|L<<16))|L<<8))|L<<4))|L<<2))<<2},x.deinterleave3=function(I,x){return(I=1023&((I=4278190335&((I=251719695&((I=3272356035&((I=I>>>x&1227133513)|I>>>2))|I>>>4))|I>>>8))|I>>>16))<<22>>22},x.nextCombination=function(I){var x=I|I-1;return x+1|(~x&-~x)-1>>>L(I)+1}},14700:(I,x,L)=>{"use strict";I.exports=function(I,x,L){switch(arguments.length){case 1:return F=[],l(X=I,X,W,!0),F;case 2:return"function"===typeof x?l(I,I,x,!0):function(I,x){return F=[],l(I,x,W,!1),F}(I,x);case 3:return l(I,x,L,!1);default:throw new Error("box-intersect: Invalid arguments")}var X};var F,X=L(14705),G=L(14732),Y=L(14743);function p(I,x){for(var L=0;L<I;++L)if(!(x[L]<=x[L+I]))return!0;return!1}function B(I,x,L,F){for(var X=0,G=0,Y=0,B=I.length;Y<B;++Y){var l=I[Y];if(!p(x,l)){for(var W=0;W<2*x;++W)L[X++]=l[W];F[G++]=Y}}return G}function l(I,x,L,F){var p=I.length,l=x.length;if(!(p<=0||l<=0)){var W=I[0].length>>>1;if(!(W<=0)){var Q,e=X.mallocDouble(2*W*p),g=X.mallocInt32(p);if((p=B(I,W,e,g))>0){if(1===W&&F)G.init(p),Q=G.sweepComplete(W,L,0,p,e,g,0,p,e,g);else{var v=X.mallocDouble(2*W*l),z=X.mallocInt32(l);(l=B(x,W,v,z))>0&&(G.init(p+l),Q=1===W?G.sweepBipartite(W,L,0,p,e,g,0,l,v,z):Y(W,L,F,p,e,g,l,v,z),X.free(v),X.free(z))}X.free(e),X.free(g)}return Q}}}function W(I,x){F.push([I,x])}},14749:(I,x)=>{"use strict";var L="d",F="ax",X="fp",G="es",Y="rs",p="re",B="rb",l="bs",W="be",Q="bb",e=[L,F,"vv",Y,p,B,"ri",l,W,Q,"bi"];function g(I){var x="bruteForce"+(I?"Full":"Partial"),F=[],Y=e.slice();I||Y.splice(3,0,X);var p=["function "+x+"("+Y.join()+"){"];function B(x,X){var Y=function(I,x,F){var X="bruteForce"+(I?"Red":"Blue")+(x?"Flip":"")+(F?"Full":""),Y=["function ",X,"(",e.join(),"){","var ",G,"=2*",L,";"],p="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",B="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(F?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return I?Y.push(p,"Q",":",B):Y.push(B,"Q",":",p),F?Y.push("if(y1<x0||x1<y0)continue;"):x?Y.push("if(y0<=x0||x1<y0)continue;"):Y.push("if(y0<x0||x1<y0)continue;"),Y.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),x?Y.push("yi,xi"):Y.push("xi,yi"),Y.push(");if(rv!==void 0)return rv;}}}"),{name:X,code:Y.join("")}}(x,X,I);F.push(Y.code),p.push("return "+Y.name+"("+e.join()+");")}p.push("if(re-rs>be-bs){"),I?(B(!0,!1),p.push("}else{"),B(!1,!1)):(p.push("if(fp){"),B(!0,!0),p.push("}else{"),B(!0,!1),p.push("}}else{if(fp){"),B(!1,!0),p.push("}else{"),B(!1,!1),p.push("}")),p.push("}}return "+x);var l=F.join("")+p.join("");return new Function(l)()}x.partial=g(!1),x.full=g(!0)},14743:(I,x,L)=>{"use strict";I.exports=function(I,x,L,G,W,P,d,M,K){!function(I,x){var L=8*X.log2(x+1)*(I+1)|0,G=X.nextPow2(y*L);Z.length<G&&(F.free(Z),Z=F.mallocInt32(G));var Y=X.nextPow2(T*L);t.length<Y&&(F.free(t),t=F.mallocDouble(Y))}(I,G+d);var u,A=0,mI=2*I;f(A++,0,0,G,0,d,L?16:0,-1/0,1/0),L||f(A++,0,0,d,0,G,1,-1/0,1/0);for(;A>0;){var O=(A-=1)*y,w=Z[O],k=Z[O+1],a=Z[O+2],D=Z[O+3],r=Z[O+4],N=Z[O+5],S=A*T,c=t[S],o=t[S+1],J=1&N,h=!!(16&N),E=W,i=P,V=M,j=K;if(J&&(E=M,i=K,V=W,j=P),!(2&N&&k>=(a=H(I,w,k,a,E,i,o)))&&!(4&N&&(k=s(I,w,k,a,E,i,c))>=a)){var C=a-k,b=r-D;if(h){if(I*C*(C+b)<g){if(void 0!==(u=B.scanComplete(I,w,x,k,a,E,i,D,r,V,j)))return u;continue}}else{if(I*Math.min(C,b)<Q){if(void 0!==(u=Y(I,w,x,J,k,a,E,i,D,r,V,j)))return u;continue}if(I*C*b<e){if(void 0!==(u=B.scanBipartite(I,w,x,J,k,a,E,i,D,r,V,j)))return u;continue}}var II=v(I,w,k,a,E,i,c,o);if(k<II)if(I*(II-k)<Q){if(void 0!==(u=p(I,w+1,x,k,II,E,i,D,r,V,j)))return u}else if(w===I-2){if(void 0!==(u=J?B.sweepBipartite(I,x,D,r,V,j,k,II,E,i):B.sweepBipartite(I,x,k,II,E,i,D,r,V,j)))return u}else f(A++,w+1,k,II,D,r,J,-1/0,1/0),f(A++,w+1,D,r,k,II,1^J,-1/0,1/0);if(II<a){var xI=l(I,w,D,r,V,j),LI=V[mI*xI+w],FI=z(I,w,xI,r,V,j,LI);if(FI<r&&f(A++,w,II,a,FI,r,(4|J)+(h?16:0),LI,o),D<xI&&f(A++,w,II,a,D,xI,(2|J)+(h?16:0),c,LI),xI+1===FI){if(void 0!==(u=h?n(I,w,x,II,a,E,i,xI,V,j[xI]):R(I,w,x,J,II,a,E,i,xI,V,j[xI])))return u}else if(xI<FI){var XI;if(h){if(II<(XI=U(I,w,II,a,E,i,LI))){var GI=z(I,w,II,XI,E,i,LI);if(w===I-2){if(II<GI&&void 0!==(u=B.sweepComplete(I,x,II,GI,E,i,xI,FI,V,j)))return u;if(GI<XI&&void 0!==(u=B.sweepBipartite(I,x,GI,XI,E,i,xI,FI,V,j)))return u}else II<GI&&f(A++,w+1,II,GI,xI,FI,16,-1/0,1/0),GI<XI&&(f(A++,w+1,GI,XI,xI,FI,0,-1/0,1/0),f(A++,w+1,xI,FI,GI,XI,1,-1/0,1/0))}}else II<(XI=J?q(I,w,II,a,E,i,LI):U(I,w,II,a,E,i,LI))&&(w===I-2?u=J?B.sweepBipartite(I,x,xI,FI,V,j,II,XI,E,i):B.sweepBipartite(I,x,II,XI,E,i,xI,FI,V,j):(f(A++,w+1,II,XI,xI,FI,J,-1/0,1/0),f(A++,w+1,xI,FI,II,XI,1^J,-1/0,1/0)))}}}}};var F=L(14705),X=L(14710),G=L(14749),Y=G.partial,p=G.full,B=L(14732),l=L(14758),W=L(14766),Q=128,e=1<<22,g=1<<22,v=W("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),z=W("lo===p0",["p0"]),H=W("lo<p0",["p0"]),s=W("hi<=p0",["p0"]),U=W("lo<=p0&&p0<=hi",["p0"]),q=W("lo<p0&&p0<=hi",["p0"]),y=6,T=2,Z=F.mallocInt32(1024),t=F.mallocDouble(1024);function f(I,x,L,F,X,G,Y,p,B){var l=y*I;Z[l]=x,Z[l+1]=L,Z[l+2]=F,Z[l+3]=X,Z[l+4]=G,Z[l+5]=Y;var W=T*I;t[W]=p,t[W+1]=B}function R(I,x,L,F,X,G,Y,p,B,l,W){var Q=2*I,e=B*Q,g=l[e+x];I:for(var v=X,z=X*Q;v<G;++v,z+=Q){var H=Y[z+x],s=Y[z+x+I];if(!(g<H||s<g)&&(!F||g!==H)){for(var U,q=p[v],y=x+1;y<I;++y){H=Y[z+y],s=Y[z+y+I];var T=l[e+y],Z=l[e+y+I];if(s<T||Z<H)continue I}if(void 0!==(U=F?L(W,q):L(q,W)))return U}}}function n(I,x,L,F,X,G,Y,p,B,l){var W=2*I,Q=p*W,e=B[Q+x];I:for(var g=F,v=F*W;g<X;++g,v+=W){var z=Y[g];if(z!==l){var H=G[v+x],s=G[v+x+I];if(!(e<H||s<e)){for(var U=x+1;U<I;++U){H=G[v+U],s=G[v+U+I];var q=B[Q+U],y=B[Q+U+I];if(s<q||y<H)continue I}var T=L(z,l);if(void 0!==T)return T}}}}},14758:(I,x,L)=>{"use strict";I.exports=function(I,x,L,Y,p,B){if(Y<=L+1)return L;var l=L,W=Y,Q=Y+L>>>1,e=2*I,g=Q,v=p[e*Q+x];for(;l<W;){if(W-l<X){G(I,x,l,W,p,B),v=p[e*Q+x];break}var z=W-l,H=Math.random()*z+l|0,s=p[e*H+x],U=Math.random()*z+l|0,q=p[e*U+x],y=Math.random()*z+l|0,T=p[e*y+x];s<=q?T>=q?(g=U,v=q):s>=T?(g=H,v=s):(g=y,v=T):q>=T?(g=U,v=q):T>=s?(g=H,v=s):(g=y,v=T);for(var Z=e*(W-1),t=e*g,f=0;f<e;++f,++Z,++t){var R=p[Z];p[Z]=p[t],p[t]=R}var n=B[W-1];B[W-1]=B[g],B[g]=n;for(Z=e*(W-1),t=e*(g=F(I,x,l,W-1,p,B,v)),f=0;f<e;++f,++Z,++t){R=p[Z];p[Z]=p[t],p[t]=R}n=B[W-1];if(B[W-1]=B[g],B[g]=n,Q<g){for(W=g-1;l<W&&p[e*(W-1)+x]===v;)W-=1;W+=1}else{if(!(g<Q))break;for(l=g+1;l<W&&p[e*l+x]===v;)l+=1}}return F(I,x,L,Q,p,B,p[e*Q+x])};var F=L(14766)("lo<p0",["p0"]),X=8;function G(I,x,L,F,X,G){for(var Y=2*I,p=Y*(L+1)+x,B=L+1;B<F;++B,p+=Y)for(var l=X[p],W=B,Q=Y*(B-1);W>L&&X[Q+x]>l;--W,Q-=Y){for(var e=Q,g=Q+Y,v=0;v<Y;++v,++e,++g){var z=X[e];X[e]=X[g],X[g]=z}var H=G[W];G[W]=G[W-1],G[W-1]=H}}},14766:I=>{"use strict";I.exports=function(I,L){var F="abcdef".split("").concat(L),X=[];I.indexOf("lo")>=0&&X.push("lo=e[k+n]");I.indexOf("hi")>=0&&X.push("hi=e[k+o]");return F.push(x.replace("_",X.join()).replace("$",I)),Function.apply(void 0,F)};var x="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14734:I=>{"use strict";I.exports=function(I,F){F<=4*x?L(0,F-1,I):l(0,F-1,I)};var x=32;function L(I,x,L){for(var F=2*(I+1),X=I+1;X<=x;++X){for(var G=L[F++],Y=L[F++],p=X,B=F-2;p-- >I;){var l=L[B-2],W=L[B-1];if(l<G)break;if(l===G&&W<Y)break;L[B]=l,L[B+1]=W,B-=2}L[B]=G,L[B+1]=Y}}function F(I,x,L){x*=2;var F=L[I*=2],X=L[I+1];L[I]=L[x],L[I+1]=L[x+1],L[x]=F,L[x+1]=X}function X(I,x,L){x*=2,L[I*=2]=L[x],L[I+1]=L[x+1]}function G(I,x,L,F){x*=2,L*=2;var X=F[I*=2],G=F[I+1];F[I]=F[x],F[I+1]=F[x+1],F[x]=F[L],F[x+1]=F[L+1],F[L]=X,F[L+1]=G}function Y(I,x,L,F,X){x*=2,X[I*=2]=X[x],X[x]=L,X[I+1]=X[x+1],X[x+1]=F}function p(I,x,L){x*=2;var F=L[I*=2],X=L[x];return!(F<X)&&(F!==X||L[I+1]>L[x+1])}function B(I,x,L,F){var X=F[I*=2];return X<x||X===x&&F[I+1]<L}function l(I,W,Q){var e=(W-I+1)/6|0,g=I+e,v=W-e,z=I+W>>1,H=z-e,s=z+e,U=g,q=H,y=z,T=s,Z=v,t=I+1,f=W-1,R=0;p(U,q,Q)&&(R=U,U=q,q=R),p(T,Z,Q)&&(R=T,T=Z,Z=R),p(U,y,Q)&&(R=U,U=y,y=R),p(q,y,Q)&&(R=q,q=y,y=R),p(U,T,Q)&&(R=U,U=T,T=R),p(y,T,Q)&&(R=y,y=T,T=R),p(q,Z,Q)&&(R=q,q=Z,Z=R),p(q,y,Q)&&(R=q,q=y,y=R),p(T,Z,Q)&&(R=T,T=Z,Z=R);for(var n=Q[2*q],P=Q[2*q+1],d=Q[2*T],M=Q[2*T+1],K=2*U,u=2*y,A=2*Z,mI=2*g,O=2*z,w=2*v,k=0;k<2;++k){var a=Q[K+k],D=Q[u+k],r=Q[A+k];Q[mI+k]=a,Q[O+k]=D,Q[w+k]=r}X(H,I,Q),X(s,W,Q);for(var N=t;N<=f;++N)if(B(N,n,P,Q))N!==t&&F(N,t,Q),++t;else if(!B(N,d,M,Q))for(;;){if(B(f,d,M,Q)){B(f,n,P,Q)?(G(N,t,f,Q),++t,--f):(F(N,f,Q),--f);break}if(--f<N)break}Y(I,t-1,n,P,Q),Y(W,f+1,d,M,Q),t-2-I<=x?L(I,t-2,Q):l(I,t-2,Q),W-(f+2)<=x?L(f+2,W,Q):l(f+2,W,Q),f-t<=x?L(t,f,Q):l(t,f,Q)}},14732:(I,x,L)=>{"use strict";I.exports={init:function(I){var x=X.nextPow2(I);B.length<x&&(F.free(B),B=F.mallocInt32(x));l.length<x&&(F.free(l),l=F.mallocInt32(x));W.length<x&&(F.free(W),W=F.mallocInt32(x));Q.length<x&&(F.free(Q),Q=F.mallocInt32(x));e.length<x&&(F.free(e),e=F.mallocInt32(x));g.length<x&&(F.free(g),g=F.mallocInt32(x));var L=8*x;v.length<L&&(F.free(v),v=F.mallocDouble(L))},sweepBipartite:function(I,x,L,F,X,p,e,g,s,U){for(var q=0,y=2*I,T=I-1,Z=y-1,t=L;t<F;++t){var f=p[t],R=y*t;v[q++]=X[R+T],v[q++]=-(f+1),v[q++]=X[R+Z],v[q++]=f}for(t=e;t<g;++t){f=U[t]+Y;var n=y*t;v[q++]=s[n+T],v[q++]=-f,v[q++]=s[n+Z],v[q++]=f}var P=q>>>1;G(v,P);var d=0,M=0;for(t=0;t<P;++t){var K=0|v[2*t+1];if(K>=Y)z(W,Q,M--,K=K-Y|0);else if(K>=0)z(B,l,d--,K);else if(K<=-Y){K=-K-Y|0;for(var u=0;u<d;++u){if(void 0!==(A=x(B[u],K)))return A}H(W,Q,M++,K)}else{K=-K-1|0;for(u=0;u<M;++u){var A;if(void 0!==(A=x(K,W[u])))return A}H(B,l,d++,K)}}},sweepComplete:function(I,x,L,F,X,Y,p,s,U,q){for(var y=0,T=2*I,Z=I-1,t=T-1,f=L;f<F;++f){var R=Y[f]+1<<1,n=T*f;v[y++]=X[n+Z],v[y++]=-R,v[y++]=X[n+t],v[y++]=R}for(f=p;f<s;++f){R=q[f]+1<<1;var P=T*f;v[y++]=U[P+Z],v[y++]=1|-R,v[y++]=U[P+t],v[y++]=1|R}var d=y>>>1;G(v,d);var M=0,K=0,u=0;for(f=0;f<d;++f){var A=0|v[2*f+1],mI=1&A;if(f<d-1&&A>>1===v[2*f+3]>>1&&(mI=2,f+=1),A<0){for(var O=-(A>>1)-1,w=0;w<u;++w){if(void 0!==(k=x(e[w],O)))return k}if(0!==mI)for(w=0;w<M;++w){if(void 0!==(k=x(B[w],O)))return k}if(1!==mI)for(w=0;w<K;++w){var k;if(void 0!==(k=x(W[w],O)))return k}0===mI?H(B,l,M++,O):1===mI?H(W,Q,K++,O):2===mI&&H(e,g,u++,O)}else{O=(A>>1)-1;0===mI?z(B,l,M--,O):1===mI?z(W,Q,K--,O):2===mI&&z(e,g,u--,O)}}},scanBipartite:function(I,x,L,F,X,p,W,Q,e,g,s,U){var q=0,y=2*I,T=x,Z=x+I,t=1,f=1;F?f=Y:t=Y;for(var R=X;R<p;++R){var n=R+t,P=y*R;v[q++]=W[P+T],v[q++]=-n,v[q++]=W[P+Z],v[q++]=n}for(R=e;R<g;++R){n=R+f;var d=y*R;v[q++]=s[d+T],v[q++]=-n}var M=q>>>1;G(v,M);var K=0;for(R=0;R<M;++R){var u=0|v[2*R+1];if(u<0){var A=!1;if((n=-u)>=Y?(A=!F,n-=Y):(A=!!F,n-=1),A)H(B,l,K++,n);else{var mI=U[n],O=y*n,w=s[O+x+1],k=s[O+x+1+I];I:for(var a=0;a<K;++a){var D=B[a],r=y*D;if(!(k<W[r+x+1]||W[r+x+1+I]<w)){for(var N=x+2;N<I;++N)if(s[O+N+I]<W[r+N]||W[r+N+I]<s[O+N])continue I;var S,c=Q[D];if(void 0!==(S=F?L(mI,c):L(c,mI)))return S}}}}else z(B,l,K--,u-t)}},scanComplete:function(I,x,L,F,X,p,l,W,Q,e,g){for(var z=0,H=2*I,s=x,U=x+I,q=F;q<X;++q){var y=q+Y,T=H*q;v[z++]=p[T+s],v[z++]=-y,v[z++]=p[T+U],v[z++]=y}for(q=W;q<Q;++q){y=q+1;var Z=H*q;v[z++]=e[Z+s],v[z++]=-y}var t=z>>>1;G(v,t);var f=0;for(q=0;q<t;++q){var R=0|v[2*q+1];if(R<0){if((y=-R)>=Y)B[f++]=y-Y;else{var n=g[y-=1],P=H*y,d=e[P+x+1],M=e[P+x+1+I];I:for(var K=0;K<f;++K){var u=B[K],A=l[u];if(A===n)break;var mI=H*u;if(!(M<p[mI+x+1]||p[mI+x+1+I]<d)){for(var O=x+2;O<I;++O)if(e[P+O+I]<p[mI+O]||p[mI+O+I]<e[P+O])continue I;var w=L(A,n);if(void 0!==w)return w}}}}else{for(y=R-Y,K=f-1;K>=0;--K)if(B[K]===y){for(O=K+1;O<f;++O)B[O-1]=B[O];break}--f}}}};var F=L(14705),X=L(14710),G=L(14734),Y=1<<28,p=1024,B=F.mallocInt32(p),l=F.mallocInt32(p),W=F.mallocInt32(p),Q=F.mallocInt32(p),e=F.mallocInt32(p),g=F.mallocInt32(p),v=F.mallocDouble(8192);function z(I,x,L,F){var X=x[F],G=I[L-1];I[X]=G,x[G]=X}function H(I,x,L,F){I[L]=F,x[F]=L}},14717:I=>{"use strict";function x(I,L,F){var X=0|I[F];if(X<=0)return[];var G,Y=new Array(X);if(F===I.length-1)for(G=0;G<X;++G)Y[G]=L;else for(G=0;G<X;++G)Y[G]=x(I,L,F+1);return Y}I.exports=function(I,L){switch("undefined"===typeof L&&(L=0),typeof I){case"number":if(I>0)return function(I,x){var L,F;for(L=new Array(I),F=0;F<I;++F)L[F]=x;return L}(0|I,L);break;case"object":if("number"===typeof I.length)return x(I,L,0)}return[]}},14675:(I,x,L)=>{I.exports=function(){var I=this;this.components={},this.comps=this.components;var x=this.components,L=1,X={},G=[],Y=[],p={timeout:!1,removals:[],multiComps:[]};function B(I,L){var F=x[L],G=X[L],Y=G.hash[I];Y&&(G.remove(I),F.nx&&(F.multi?(Y.forEach((x=>{x&&F.nx(I,x)})),Y.length=0):F.nx(I,Y)),p.removals.push(G),l())}function l(){p.timeout||(p.timeout=!0,setTimeout(W,1))}function W(){p.timeout=!1,Q()}function Q(){p.multiComps.length&&function(I){for(var x=0;x<I.length;x++){var{entID:L,data:F}=I[x],X=F.hash[L];if(X){for(var G=0;G<X.length;G++)X[G]||(X.splice(G,1),G--);0===X.length&&(F.remove(L),p.removals.push(F))}}I.length=0}(p.multiComps),p.removals.length&&function(I){for(var x=0;x<I.length;x++){I[x].flush()}I.length=0}(p.removals)}this.jQ=X,this._systems=G,this._renderSystems=Y,this.dl=function(x){var F=L++;return Array.isArray(x)&&x.forEach((x=>I.yl(F,x))),F},this.deleteEntity=function(x){return Object.keys(X).forEach((I=>{X[I].hash[x]&&B(x,I)})),I},this.xQ=function(I){if(!I)throw new Error("Missing component definition");var L=I.name;if(!L)throw new Error("Component definition must have a name property.");if("string"!==typeof L)throw new Error("Component name must be a string.");if(""===L)throw new Error("Component name must be a non-empty string.");if(X[L])throw new Error(`Component ${L} already exists.`);var p={};return p.name=L,p.multi=!!I.multi,p.order=isNaN(I.order)?99:I.order,p.stateConstructor=I.stateConstructor||null,p.state=I.state||{},p.qB=I.qB||null,p.nx=I.nx||null,p.system=I.system||null,p.RB=I.RB||null,x[L]=p,X[L]=new F,X[L]._pendingMultiCleanup=!1,X[L]._multiCleanupIDs=p.multi?[]:null,p.system&&(G.push(L),G.sort(((I,L)=>x[I].order-x[L].order))),p.RB&&(Y.push(L),Y.sort(((I,L)=>x[I].order-x[L].order))),L},this.overwriteComponent=function(I,L){var F=x[I];if(!F)throw new Error(`Unknown component: ${I}`);if(!L)throw new Error("Missing component definition");if(F.name!==L.name)throw new Error("Overwriting component must use the same name property.");var p={};p.name=I,p.multi=!!L.multi,p.order=isNaN(L.order)?99:L.order,p.state=L.state||{},p.qB=L.qB||null,p.nx=L.nx||null,p.system=L.system||null,p.RB=L.RB||null,x[I]=p,X[I]._pendingMultiCleanup=!1,X[I]._multiCleanupIDs=p.multi?[]:null;var B=G.indexOf(I);p.system&&B<0&&G.push(I),!p.system&&B>=0&&G.splice(B,1),G.sort(((I,L)=>x[I].order-x[L].order));var l=Y.indexOf(I);p.RB&&l<0&&Y.push(I),!p.RB&&l>=0&&Y.splice(l,1),Y.sort(((I,L)=>x[I].order-x[L].order));var W=p.state;return this.qW(I).forEach((I=>{for(var x in W)x in I||(I[x]=W[x]);p.qB&&p.qB(I.tB,I)})),I},this.deleteComponent=function(L){var F=X[L];if(!F)throw new Error(`Unknown component: ${L}`);F.flush(),F.list.forEach((I=>{I&&B(I.tB||I[0].tB,L)}));var p=G.indexOf(L),l=Y.indexOf(L);return p>-1&&G.splice(p,1),l>-1&&Y.splice(l,1),X[L].dispose(),delete X[L],delete x[L],I},this.yl=function(I,L,F){var G,Y=x[L],p=X[L];if(!p)throw new Error(`Unknown component: ${L}.`);if(p.hash[I]&&!Y.multi)throw new Error(`Entity ${I} already has component: ${L}.`);if(Y.stateConstructor){if(!(G=new Y.stateConstructor).hasOwnProperty("tB"))throw new Error(`Component ${Y.name} stateConstructor type does not have property __id`)}else G=Object.assign({},{tB:I},Y.state,F);if(G.tB=I,Y.multi){var B=p.hash[I];B||(B=[],p.add(I,B)),B.push(G)}else p.add(I,G);return Y.qB&&Y.qB(I,G),this},this.ul=function(I,x){var L=X[x];if(!L)throw new Error(`Unknown component: ${x}.`);return!!L.hash[I]},this.fl=function(x,L){if(!X[L])throw new Error(`Unknown component: ${L}.`);return B(x,L),I},this.getState=function(I,x){var L=X[x];if(!L)throw new Error(`Unknown component: ${x}.`);return L.hash[I]},this.qW=function(I){var x=X[I];if(!x)throw new Error(`Unknown component: ${I}.`);return Q(),x.list},this.qv=function(I){if(!X[I])throw new Error(`Unknown component: ${I}.`);var x=X[I].hash;return I=>x[I]},this.Zv=function(I){if(!X[I])throw new Error(`Unknown component: ${I}.`);var x=X[I].hash;return I=>!!x[I]},this.rp=function(L){Q();for(var F=0;F<G.length;F++){var Y=G[F],p=x[Y],B=X[Y];p.system(L,B.list),Q()}return I},this.render=function(L){Q();for(var F=0;F<Y.length;F++){var G=Y[F],p=x[G],B=X[G];p.RB(L,B.list),Q()}return I},this.removeMultiComponent=function(L,F,G){var Y=x[F],B=X[F];if(!B)throw new Error(`Unknown component: ${F}.`);if(!Y.multi)throw new Error("removeMultiComponent called on non-multi component");return function(I,x,L,F){var X=L.hash[I];if(X){var G=X[F];G&&(X[F]=null,x.nx&&x.nx(I,G),p.multiComps.push({entID:I,data:L}),l())}}(L,Y,B,G),I}};var F=L(14681)},14681:I=>{function x(I,x){var L=I._map[x];if(delete I.hash[x],delete I._map[x],L===I.list.length-1)I.list.pop();else{var F=I.list.pop();if(I.list[L]=F,null===F||null===F[0]){var X=I.list.length;for(var G in I._map)if(I._map[G]===X)return void(I._map[G]=L)}else{var Y=F.tB||F[0].tB;I._map[Y]=L}}}I.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(I,x){if("number"===typeof this._map[I]){var L=this._map[I];this.hash[I]=x,this.list[L]=x}else this._map[I]=this.list.length,this.hash[I]=x,this.list.push(x)}remove(I){var x=this._map[I];this.hash[I]=null,this.list[x]=null,this._pendingRemovals.push(I)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var I=0;I<this._pendingRemovals.length;I++){var L=this._pendingRemovals[I];null===this.hash[L]&&x(this,L)}this._pendingRemovals.length=0}}},14631:I=>{"use strict";var x,L="object"===typeof Reflect?Reflect:null,F=function(I,x,L){return Function.prototype.apply.call(I,x,L)};x=L&&"function"===typeof L.ownKeys?L.ownKeys:Object.getOwnPropertySymbols?function(I){return Object.getOwnPropertyNames(I).concat(Object.getOwnPropertySymbols(I))}:function(I){return Object.getOwnPropertyNames(I)};var X=Number.isNaN||function(I){return I!==I};function G(){G.init.call(this)}I.exports=G,I.exports.once=function(I,x){return new Promise((function(L,F){function X(L){I.removeListener(x,G),F(L)}function G(){"function"===typeof I.removeListener&&I.removeListener("error",X),L([].slice.call(arguments))}z(I,x,G,{once:!0}),"error"!==x&&function(I,x,L){"function"===typeof I.on&&z(I,"error",x,L)}(I,X,{once:!0})}))},G.EventEmitter=G,G.prototype._events=void 0,G.prototype._eventsCount=0,G.prototype._maxListeners=void 0;var Y=10;function p(I){if("function"!==typeof I)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof I)}function B(I){return void 0===I._maxListeners?G.defaultMaxListeners:I._maxListeners}function l(I,x,L,F){var X,G,Y,l;if(p(L),void 0===(G=I._events)?(G=I._events=Object.create(null),I._eventsCount=0):(void 0!==G.newListener&&(I.emit("newListener",x,L.listener?L.listener:L),G=I._events),Y=G[x]),void 0===Y)Y=G[x]=L,++I._eventsCount;else if("function"===typeof Y?Y=G[x]=F?[L,Y]:[Y,L]:F?Y.unshift(L):Y.push(L),(X=B(I))>0&&Y.length>X&&!Y.warned){Y.warned=!0;var W=new Error("Possible EventEmitter memory leak detected. "+Y.length+" "+String(x)+" listeners added. Use emitter.setMaxListeners() to increase limit");W.name="MaxListenersExceededWarning",W.Xx=I,W.type=x,W.count=Y.length,l=W,console&&console.warn&&console.warn(l)}return I}function W(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Q(I,x,L){var F={fired:!1,wrapFn:void 0,target:I,type:x,listener:L},X=W.bind(F);return X.listener=L,F.wrapFn=X,X}function e(I,x,L){var F=I._events;if(void 0===F)return[];var X=F[x];return void 0===X?[]:"function"===typeof X?L?[X.listener||X]:[X]:L?function(I){for(var x=new Array(I.length),L=0;L<x.length;++L)x[L]=I[L].listener||I[L];return x}(X):v(X,X.length)}function g(I){var x=this._events;if(void 0!==x){var L=x[I];if("function"===typeof L)return 1;if(void 0!==L)return L.length}return 0}function v(I,x){for(var L=new Array(x),F=0;F<x;++F)L[F]=I[F];return L}function z(I,x,L,F){if("function"===typeof I.on)F.once?I.once(x,L):I.on(x,L);else{if("function"!==typeof I.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof I);I.addEventListener(x,(function X(G){F.once&&I.removeEventListener(x,X),L(G)}))}}Object.defineProperty(G,"defaultMaxListeners",{enumerable:!0,get:function(){return Y},set:function(I){if("number"!==typeof I||I<0||X(I))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+I+".");Y=I}}),G.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},G.prototype.setMaxListeners=function(I){if("number"!==typeof I||I<0||X(I))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+I+".");return this._maxListeners=I,this},G.prototype.getMaxListeners=function(){return B(this)},G.prototype.emit=function(I){for(var x=[],L=1;L<arguments.length;L++)x.push(arguments[L]);var X="error"===I,G=this._events;if(void 0!==G)X=X&&void 0===G.error;else if(!X)return!1;if(X){var Y;if(x.length>0&&(Y=x[0]),Y instanceof Error)throw Y;var p=new Error("Unhandled error."+(Y?" ("+Y.message+")":""));throw p.context=Y,p}var B=G[I];if(void 0===B)return!1;if("function"===typeof B)F(B,this,x);else{var l=B.length,W=v(B,l);for(L=0;L<l;++L)F(W[L],this,x)}return!0},G.prototype.addListener=function(I,x){return l(this,I,x,!1)},G.prototype.on=G.prototype.addListener,G.prototype.prependListener=function(I,x){return l(this,I,x,!0)},G.prototype.once=function(I,x){return p(x),this.on(I,Q(this,I,x)),this},G.prototype.prependOnceListener=function(I,x){return p(x),this.prependListener(I,Q(this,I,x)),this},G.prototype.removeListener=function(I,x){var L,F,X,G,Y;if(p(x),void 0===(F=this._events))return this;if(void 0===(L=F[I]))return this;if(L===x||L.listener===x)0===--this._eventsCount?this._events=Object.create(null):(delete F[I],F.removeListener&&this.emit("removeListener",I,L.listener||x));else if("function"!==typeof L){for(X=-1,G=L.length-1;G>=0;G--)if(L[G]===x||L[G].listener===x){Y=L[G].listener,X=G;break}if(X<0)return this;0===X?L.shift():function(I,x){for(;x+1<I.length;x++)I[x]=I[x+1];I.pop()}(L,X),1===L.length&&(F[I]=L[0]),void 0!==F.removeListener&&this.emit("removeListener",I,Y||x)}return this},G.prototype.off=G.prototype.removeListener,G.prototype.Gx=function(I){var x,L,F;if(void 0===(L=this._events))return this;if(void 0===L.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==L[I]&&(0===--this._eventsCount?this._events=Object.create(null):delete L[I]),this;if(0===arguments.length){var X,G=Object.keys(L);for(F=0;F<G.length;++F)"removeListener"!==(X=G[F])&&this.Gx(X);return this.Gx("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(x=L[I]))this.removeListener(I,x);else if(void 0!==x)for(F=x.length-1;F>=0;F--)this.removeListener(I,x[F]);return this},G.prototype.listeners=function(I){return e(this,I,!0)},G.prototype.rawListeners=function(I){return e(this,I,!1)},G.listenerCount=function(I,x){return"function"===typeof I.listenerCount?I.listenerCount(x):g.call(I,x)},G.prototype.listenerCount=g,G.prototype.eventNames=function(){return this._eventsCount>0?x(this._events):[]}},15086:I=>{"use strict";I.exports=function(I,x,L,F,X,G){var Y=+x[0],p=+x[1],B=+x[2],l=+L[0],W=+L[1],Q=+L[2],e=Math.sqrt(l*l+W*W+Q*Q);if(0===e)throw new Error("Can't raycast along a zero vector");return function(I,x,L,F,X,G,Y,p,B,l){for(var W=0,Q=Math.floor,e=0|Q(x),g=0|Q(L),v=0|Q(F),z=X>0?1:-1,H=G>0?1:-1,s=Y>0?1:-1,U=Math.abs(1/X),q=Math.abs(1/G),y=Math.abs(1/Y),T=U<1/0?U*(z>0?e+1-x:x-e):1/0,Z=q<1/0?q*(H>0?g+1-L:L-g):1/0,t=y<1/0?y*(s>0?v+1-F:F-v):1/0,f=-1;W<=p;){var R=I(e,g,v);if(R)return B&&(B[0]=x+W*X,B[1]=L+W*G,B[2]=F+W*Y),l&&(l[0]=l[1]=l[2]=0,0===f&&(l[0]=-z),1===f&&(l[1]=-H),2===f&&(l[2]=-s)),R;T<Z?T<t?(e+=z,W=T,T+=U,f=0):(v+=s,W=t,t+=y,f=2):Z<t?(g+=H,W=Z,Z+=q,f=1):(v+=s,W=t,t+=y,f=2)}return B&&(B[0]=x+W*X,B[1]=L+W*G,B[2]=F+W*Y),l&&(l[0]=l[1]=l[2]=0),0}(I,Y,p,B,l/=e,W/=e,Q/=e,F="undefined"===typeof F?64:+F,X,G)}},15120:(I,x,L)=>{"use strict";L.d(x,{c:()=>G});var F=L(14631);function X(){this.Qg=!1,this.stopPropagation=!1,this.eg=!1,this.disabled=!1}class G{constructor(I,x){this.version="0.7.0";var L=Object.assign({},new X,x||{});this.element=I||document,this.Qg=!!L.Qg,this.stopPropagation=!!L.stopPropagation,this.eg=!!L.eg,this.disabled=!!L.disabled,this.filterEvents=(I,x)=>!0,this.down=new F.EventEmitter,this.up=new F.EventEmitter,this.state={},this.vW={dx:0,dy:0,Qv:0,gW:0,ev:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?p(this):document.addEventListener("DOMContentLoaded",(I=>{p(this)}),{once:!0})}bind(I){for(var x=arguments.length,L=new Array(x>1?x-1:0),F=1;F<x;F++)L[F-1]=arguments[F];L.forEach((x=>{var L=this._keyBindmap[x]||[];L.includes(I)||(L.push(I),this._keyBindmap[x]=L)})),this.state[I]=!!this.state[I],this.pressCount[I]=this.pressCount[I]||0,this.releaseCount[I]=this.releaseCount[I]||0}unbind(I){for(var x in this._keyBindmap){var L=this._keyBindmap[x],F=L.indexOf(I);F>-1&&L.splice(F,1)}}getBindings(){var I={};for(var x in this._keyBindmap){this._keyBindmap[x].forEach((L=>{I[L]=I[L]||[],I[L].push(x)}))}return I}rp(){Y(this.vW),Y(this.pressCount),Y(this.releaseCount)}}function Y(I){for(var x in I)I[x]=0}function p(I){window.addEventListener("keydown",v.bind(null,I,!0),!1),window.addEventListener("keyup",v.bind(null,I,!1),!1);var x={passive:!0};I.element.addEventListener("touchstart",Q.bind(void 0,I),{passive:!1}),I.element.addEventListener("touchend",g.bind(void 0,I),x),I.element.addEventListener("mousedown",z.bind(null,I,!0),x),window.document.addEventListener("mouseup",z.bind(null,I,!1),x),I.element.addEventListener("touchmove",H.bind(null,I),x),I.element.addEventListener("mousemove",H.bind(null,I),x),window.PointerEvent,I.element.addEventListener("wheel",s.bind(null,I),x),I.element.addEventListener("contextmenu",U.bind(null,I),!1),window.addEventListener("blur",q.bind(null,I),!1)}var B=0,l=0,W=null;function Q(I,x){x.preventDefault(),e(x)}function e(I){let x=!1;for(let L=0;L<I.touches.length;++L)if(I.touches[L].identifier===W){x=!0;break}if(!x){const x=I.changedTouches[0];B=x.clientX,l=x.clientY,W=x.identifier}}function g(I,x){for(var L=x.changedTouches,F=0;F<L.length;++F)L[F].identifier===W&&(W=null)}function v(I,x,L){y(L.code,x,I,L)}function z(I,x,L){if("pointerId"in L)if(x){if(null!==I._touches.currID)return;I._touches.currID=L.pointerId}else{if(I._touches.currID!==L.pointerId)return;I._touches.currID=null}return y("Mouse"+("button"in L?L.button+1:1),x,I,L),!1}function H(I,x){var L=x.movementX||x.mozMovementX||0,F=x.movementY||x.mozMovementY||0;if(x.touches&&0===(L|F)){var X=function(I){e(I);for(let x=0;x<I.changedTouches.length;++x)if(I.changedTouches[x].identifier==W){const L=I.changedTouches[x],F=[L.clientX-B,L.clientY-l];return B=L.clientX,l=L.clientY,F}return console.error(`Did not find touch id ${W}`),[0,0]}(x);L=X[0],F=X[1]}I.vW.dx+=L,I.vW.dy+=F}function s(I,x){var L=1;switch(x.deltaMode){case 0:L=1;break;case 1:L=12;break;case 2:L=I.element.clientHeight||window.innerHeight}I.vW.Qv+=(x.deltaX||0)*L,I.vW.gW+=(x.deltaY||0)*L,I.vW.ev+=(x.deltaZ||0)*L}function U(I,x){if(!I.eg)return x.preventDefault(),!1}function q(I){for(var x in I._keyStates)I._keyStates[x]&&(/^Mouse\d/.test(x)||y(x,!1,I,{code:x,note:"pfo2nl9k1ka",preventDefault:()=>{},stopPropagation:()=>{}}))}function y(I,x,L,F){var X=L._keyBindmap[I];X&&(T(L._keyStates[I],x)&&(L._keyStates[I]=x,X.forEach((I=>{(!L.filterEvents||L.filterEvents(F,I))&&function(I,x,L,F){var X=x?L.pressCount:L.releaseCount;X[I]=(X[I]||0)+1;var G=L._bindPressCount[I]||0;(G+=x?1:-1)<0&&(G=0);L._bindPressCount[I]=G;var Y=L.state[I];if(T(Y,G)){L.state[I]=G>0;var p=x?L.down:L.up;L.disabled||p.emit(I,F)}}(I,x,L,F)}))),"button"in F||(L.Qg&&!F.defaultPrevented&&F.preventDefault(),L.stopPropagation&&F.stopPropagation()))}function T(I,x){return I?!x:x}},13841:I=>{I.exports=function(I,x,L){return I[0]=x[0]+L[0],I[1]=x[1]+L[1],I[2]=x[2]+L[2],I}},13787:(I,x,L)=>{I.exports=function(I,x){var L=F(I[0],I[1],I[2]),Y=F(x[0],x[1],x[2]);X(L,L),X(Y,Y);var p=G(L,Y);return p>1?0:Math.acos(p)};var F=L(13792),X=L(13799),G=L(13808)},13890:I=>{I.exports=function(I,x){return I[0]=Math.ceil(x[0]),I[1]=Math.ceil(x[1]),I[2]=Math.ceil(x[2]),I}},13778:I=>{I.exports=function(I){var x=new Float32Array(3);return x[0]=I[0],x[1]=I[1],x[2]=I[2],x}},13815:I=>{I.exports=function(I,x){return I[0]=x[0],I[1]=x[1],I[2]=x[2],I}},13771:I=>{I.exports=function(){var I=new Float32Array(3);return I[0]=0,I[1]=0,I[2]=0,I}},13965:I=>{I.exports=function(I,x,L){var F=x[0],X=x[1],G=x[2],Y=L[0],p=L[1],B=L[2];return I[0]=X*B-G*p,I[1]=G*Y-F*B,I[2]=F*p-X*Y,I}},13910:(I,x,L)=>{I.exports=L(13906)},13906:I=>{I.exports=function(I,x){var L=x[0]-I[0],F=x[1]-I[1],X=x[2]-I[2];return Math.sqrt(L*L+F*F+X*X)}},13872:(I,x,L)=>{I.exports=L(13869)},13869:I=>{I.exports=function(I,x,L){return I[0]=x[0]/L[0],I[1]=x[1]/L[1],I[2]=x[2]/L[2],I}},13808:I=>{I.exports=function(I,x){return I[0]*x[0]+I[1]*x[1]+I[2]*x[2]}},13767:I=>{I.exports=1e-6},13827:(I,x,L)=>{I.exports=function(I,x){var L=I[0],X=I[1],G=I[2],Y=x[0],p=x[1],B=x[2];return Math.abs(L-Y)<=F*Math.max(1,Math.abs(L),Math.abs(Y))&&Math.abs(X-p)<=F*Math.max(1,Math.abs(X),Math.abs(p))&&Math.abs(G-B)<=F*Math.max(1,Math.abs(G),Math.abs(B))};var F=L(13767)},13832:I=>{I.exports=function(I,x){return I[0]===x[0]&&I[1]===x[1]&&I[2]===x[2]}},13886:I=>{I.exports=function(I,x){return I[0]=Math.floor(x[0]),I[1]=Math.floor(x[1]),I[2]=Math.floor(x[2]),I}},14012:(I,x,L)=>{I.exports=function(I,x,L,X,G,Y){var p,B;x||(x=3);L||(L=0);B=X?Math.min(X*x+L,I.length):I.length;for(p=L;p<B;p+=x)F[0]=I[p],F[1]=I[p+1],F[2]=I[p+2],G(F,F,Y),I[p]=F[0],I[p+1]=F[1],I[p+2]=F[2];return I};var F=L(13771)()},13792:I=>{I.exports=function(I,x,L){var F=new Float32Array(3);return F[0]=I,F[1]=x,F[2]=L,F}},13764:(I,x,L)=>{I.exports={EPSILON:L(13767),create:L(13771),clone:L(13778),angle:L(13787),Kp:L(13792),j:L(13815),set:L(13823),equals:L(13827),exactEquals:L(13832),add:L(13841),Ux:L(13848),sub:L(13850),multiply:L(13857),mul:L(13861),divide:L(13869),div:L(13872),min:L(13879),max:L(13882),floor:L(13886),ceil:L(13890),round:L(13897),scale:L(13901),upI:L(13904),distance:L(13906),k:L(13910),squaredDistance:L(13914),sqrDist:L(13918),length:L(13923),len:L(13932),squaredLength:L(13940),Ap:L(13946),negate:L(13953),inverse:L(13960),normalize:L(13799),dot:L(13808),cross:L(13965),zp:L(13974),random:L(13980),transformMat4:L(13988),transformMat3:L(13990),transformQuat:L(13996),mB:L(13999),Op:L(14003),wp:L(14009),forEach:L(14012)}},13960:I=>{I.exports=function(I,x){return I[0]=1/x[0],I[1]=1/x[1],I[2]=1/x[2],I}},13932:(I,x,L)=>{I.exports=L(13923)},13923:I=>{I.exports=function(I){var x=I[0],L=I[1],F=I[2];return Math.sqrt(x*x+L*L+F*F)}},13974:I=>{I.exports=function(I,x,L,F){var X=x[0],G=x[1],Y=x[2];return I[0]=X+F*(L[0]-X),I[1]=G+F*(L[1]-G),I[2]=Y+F*(L[2]-Y),I}},13882:I=>{I.exports=function(I,x,L){return I[0]=Math.max(x[0],L[0]),I[1]=Math.max(x[1],L[1]),I[2]=Math.max(x[2],L[2]),I}},13879:I=>{I.exports=function(I,x,L){return I[0]=Math.min(x[0],L[0]),I[1]=Math.min(x[1],L[1]),I[2]=Math.min(x[2],L[2]),I}},13861:(I,x,L)=>{I.exports=L(13857)},13857:I=>{I.exports=function(I,x,L){return I[0]=x[0]*L[0],I[1]=x[1]*L[1],I[2]=x[2]*L[2],I}},13953:I=>{I.exports=function(I,x){return I[0]=-x[0],I[1]=-x[1],I[2]=-x[2],I}},13799:I=>{I.exports=function(I,x){var L=x[0],F=x[1],X=x[2],G=L*L+F*F+X*X;G>0&&(G=1/Math.sqrt(G),I[0]=x[0]*G,I[1]=x[1]*G,I[2]=x[2]*G);return I}},13980:I=>{I.exports=function(I,x){x=x||1;var L=2*Math.random()*Math.PI,F=2*Math.random()-1,X=Math.sqrt(1-F*F)*x;return I[0]=Math.cos(L)*X,I[1]=Math.sin(L)*X,I[2]=F*x,I}},13999:I=>{I.exports=function(I,x,L,F){var X=L[1],G=L[2],Y=x[1]-X,p=x[2]-G,B=Math.sin(F),l=Math.cos(F);return I[0]=x[0],I[1]=X+Y*l-p*B,I[2]=G+Y*B+p*l,I}},14003:I=>{I.exports=function(I,x,L,F){var X=L[0],G=L[2],Y=x[0]-X,p=x[2]-G,B=Math.sin(F),l=Math.cos(F);return I[0]=X+p*B+Y*l,I[1]=x[1],I[2]=G+p*l-Y*B,I}},14009:I=>{I.exports=function(I,x,L,F){var X=L[0],G=L[1],Y=x[0]-X,p=x[1]-G,B=Math.sin(F),l=Math.cos(F);return I[0]=X+Y*l-p*B,I[1]=G+Y*B+p*l,I[2]=x[2],I}},13897:I=>{I.exports=function(I,x){return I[0]=Math.round(x[0]),I[1]=Math.round(x[1]),I[2]=Math.round(x[2]),I}},13901:I=>{I.exports=function(I,x,L){return I[0]=x[0]*L,I[1]=x[1]*L,I[2]=x[2]*L,I}},13904:I=>{I.exports=function(I,x,L,F){return I[0]=x[0]+L[0]*F,I[1]=x[1]+L[1]*F,I[2]=x[2]+L[2]*F,I}},13823:I=>{I.exports=function(I,x,L,F){return I[0]=x,I[1]=L,I[2]=F,I}},13918:(I,x,L)=>{I.exports=L(13914)},13946:(I,x,L)=>{I.exports=L(13940)},13914:I=>{I.exports=function(I,x){var L=x[0]-I[0],F=x[1]-I[1],X=x[2]-I[2];return L*L+F*F+X*X}},13940:I=>{I.exports=function(I){var x=I[0],L=I[1],F=I[2];return x*x+L*L+F*F}},13850:(I,x,L)=>{I.exports=L(13848)},13848:I=>{I.exports=function(I,x,L){return I[0]=x[0]-L[0],I[1]=x[1]-L[1],I[2]=x[2]-L[2],I}},13990:I=>{I.exports=function(I,x,L){var F=x[0],X=x[1],G=x[2];return I[0]=F*L[0]+X*L[3]+G*L[6],I[1]=F*L[1]+X*L[4]+G*L[7],I[2]=F*L[2]+X*L[5]+G*L[8],I}},13988:I=>{I.exports=function(I,x,L){var F=x[0],X=x[1],G=x[2],Y=L[3]*F+L[7]*X+L[11]*G+L[15];return Y=Y||1,I[0]=(L[0]*F+L[4]*X+L[8]*G+L[12])/Y,I[1]=(L[1]*F+L[5]*X+L[9]*G+L[13])/Y,I[2]=(L[2]*F+L[6]*X+L[10]*G+L[14])/Y,I}},13996:I=>{I.exports=function(I,x,L){var F=x[0],X=x[1],G=x[2],Y=L[0],p=L[1],B=L[2],l=L[3],W=l*F+p*G-B*X,Q=l*X+B*F-Y*G,e=l*G+Y*X-p*F,g=-Y*F-p*X-B*G;return I[0]=W*l+g*-Y+Q*-B-e*-p,I[1]=Q*l+g*-p+e*-Y-W*-B,I[2]=e*l+g*-B+W*-p-Q*-Y,I}},14654:I=>{"use strict";I.exports=function(I){for(var x=new Array(I),L=0;L<I;++L)x[L]=L;return x}},14724:I=>{I.exports=function(I){return null!=I&&null!=I.constructor&&"function"===typeof I.constructor.isBuffer&&I.constructor.isBuffer(I)}},15094:(I,x,L)=>{"use strict";L.d(x,{d:()=>F});class F{constructor(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.TQ=!1,this.ZQ=!1,this.qQ=30,this.yQ=0,this.KQ=!1,this.fullscreen=!1,this.fQ=function(I){},this.RQ=function(){},this.dQ=function(){},this.XL=function(){},this.nQ=function(I){},this.onFullscreenChanged=function(I){},l((()=>{!function(I,x){I._nowObject=performance||Date,I._lastTick=0,I._renderAccum=0,I._rt=0,I._frameCB=p.bind(null,I),requestAnimationFrame(I._frameCB),x>0&&(I._intervalCB=Y.bind(null,I),I._interval=setInterval(I._intervalCB,Math.max(x,1e3/I.qQ/2)))}(this,x),function(I,x){if(!x)return;var L=!1,F=!1;document.addEventListener("pointerlockchange",(F=>{L=document.pointerLockElement===x,I.nQ(L)})),document.addEventListener("fullscreenchange",(L=>{F=document.fullscreenElement===x,I.onFullscreenChanged(F)})),Object.defineProperty(I,"KQ",{get:()=>L,set:I=>{I&&!L?B(x):L&&!I&&function(I){I.exitPointerLock&&I.exitPointerLock()}(document)}}),Object.defineProperty(I,"fullscreen",{get:()=>F,set:I=>{I&&!F?x.requestFullscreen():F&&!I&&document.exitFullscreen()}}),x.addEventListener("click",(X=>{I.TQ&&!L&&B(x),I.ZQ&&!F&&x.requestFullscreen()}));var X=()=>I.XL();if(window.ResizeObserver){new ResizeObserver(X).observe(x)}else window.addEventListener("resize",X)}(this,I),this.dQ()}))}}var X=3,G=20;function Y(I){for(var x=1e3/I.qQ,L=I._nowObject.now()+G,F=0;I._nowObject.now()>=I._lastTick+x&&I._nowObject.now()<L&&++F<=X;)I.fQ(x),I._lastTick+=x;var Y=5*(x+5),p=I._nowObject.now();if(p-I._lastTick>Y)for(;p>=I._lastTick+x;)I._lastTick+=x}function p(I){requestAnimationFrame(I._frameCB),Y(I);var x=I._nowObject.now(),L=x-I._rt;if(I._rt=x,I.yQ>0){I._renderAccum+=L;var F=1e3/I.yQ;if(I._renderAccum<F)return;I._renderAccum=Math.min(I._renderAccum-F,F)}var X=1e3/I.qQ,G=(x-I._lastTick)/X;I.RQ(L,G,X)}function B(I){I.requestPointerLock&&I.requestPointerLock()}var l=I=>{if("loading"===document.readyState){var x=()=>{document.removeEventListener("readystatechange",x),I()};document.addEventListener("readystatechange",x)}else setTimeout(I,1)}},14649:(I,x,L)=>{var F=L(14654),X=L(14658),G="undefined"!==typeof Float64Array;function Y(I,x){return I[0]-x[0]}function p(){var I,x=this.stride,L=new Array(x.length);for(I=0;I<L.length;++I)L[I]=[Math.abs(x[I]),I];L.sort(Y);var F=new Array(L.length);for(I=0;I<F.length;++I)F[I]=L[I][1];return F}function B(I,x){var L=["View",x,"d",I].join("");x<0&&(L="View_Nil"+I);var X="generic"===I;if(-1===x){var G="function "+L+"(a){this.data=a;};var proto="+L+".prototype;proto.dtype='"+I+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+L+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+L+"(a){return new "+L+"(a);}";return new Function(G)()}if(0===x){G="function "+L+"(a,d) {this.data = a;this.offset = d};var proto="+L+".prototype;proto.dtype='"+I+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+L+"_copy() {return new "+L+"(this.data,this.offset)};proto.pick=function "+L+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+L+"_get(){return "+(X?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+L+"_set(v){return "+(X?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+L+"(a,b,c,d){return new "+L+"(a,d)}";return new Function("TrivialArray",G)(l[I][0])}G=["'use strict'"];var Y=F(x),B=Y.map((function(I){return"i"+I})),W="this.offset+"+Y.map((function(I){return"this.stride["+I+"]*i"+I})).join("+"),Q=Y.map((function(I){return"b"+I})).join(","),e=Y.map((function(I){return"c"+I})).join(",");G.push("function "+L+"(a,"+Q+","+e+",d){this.data=a","this.shape=["+Q+"]","this.stride=["+e+"]","this.offset=d|0}","var proto="+L+".prototype","proto.dtype='"+I+"'","proto.dimension="+x),G.push("Object.defineProperty(proto,'size',{get:function "+L+"_size(){return "+Y.map((function(I){return"this.shape["+I+"]"})).join("*"),"}})"),1===x?G.push("proto.order=[0]"):(G.push("Object.defineProperty(proto,'order',{get:"),x<4?(G.push("function "+L+"_order(){"),2===x?G.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===x&&G.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):G.push("ORDER})")),G.push("proto.set=function "+L+"_set("+B.join(",")+",v){"),X?G.push("return this.data.set("+W+",v)}"):G.push("return this.data["+W+"]=v}"),G.push("proto.get=function "+L+"_get("+B.join(",")+"){"),X?G.push("return this.data.get("+W+")}"):G.push("return this.data["+W+"]}"),G.push("proto.index=function "+L+"_index(",B.join(),"){return "+W+"}"),G.push("proto.hi=function "+L+"_hi("+B.join(",")+"){return new "+L+"(this.data,"+Y.map((function(I){return["(typeof i",I,"!=='number'||i",I,"<0)?this.shape[",I,"]:i",I,"|0"].join("")})).join(",")+","+Y.map((function(I){return"this.stride["+I+"]"})).join(",")+",this.offset)}");var g=Y.map((function(I){return"a"+I+"=this.shape["+I+"]"})),v=Y.map((function(I){return"c"+I+"=this.stride["+I+"]"}));G.push("proto.lo=function "+L+"_lo("+B.join(",")+"){var b=this.offset,d=0,"+g.join(",")+","+v.join(","));for(var z=0;z<x;++z)G.push("if(typeof i"+z+"==='number'&&i"+z+">=0){d=i"+z+"|0;b+=c"+z+"*d;a"+z+"-=d}");G.push("return new "+L+"(this.data,"+Y.map((function(I){return"a"+I})).join(",")+","+Y.map((function(I){return"c"+I})).join(",")+",b)}"),G.push("proto.step=function "+L+"_step("+B.join(",")+"){var "+Y.map((function(I){return"a"+I+"=this.shape["+I+"]"})).join(",")+","+Y.map((function(I){return"b"+I+"=this.stride["+I+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(z=0;z<x;++z)G.push("if(typeof i"+z+"==='number'){d=i"+z+"|0;if(d<0){c+=b"+z+"*(a"+z+"-1);a"+z+"=ceil(-a"+z+"/d)}else{a"+z+"=ceil(a"+z+"/d)}b"+z+"*=d}");G.push("return new "+L+"(this.data,"+Y.map((function(I){return"a"+I})).join(",")+","+Y.map((function(I){return"b"+I})).join(",")+",c)}");var H=new Array(x),s=new Array(x);for(z=0;z<x;++z)H[z]="a[i"+z+"]",s[z]="b[i"+z+"]";G.push("proto.transpose=function "+L+"_transpose("+B+"){"+B.map((function(I,x){return I+"=("+I+"===undefined?"+x+":"+I+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+L+"(this.data,"+H.join(",")+","+s.join(",")+",this.offset)}"),G.push("proto.pick=function "+L+"_pick("+B+"){var a=[],b=[],c=this.offset");for(z=0;z<x;++z)G.push("if(typeof i"+z+"==='number'&&i"+z+">=0){c=(c+this.stride["+z+"]*i"+z+")|0}else{a.push(this.shape["+z+"]);b.push(this.stride["+z+"])}");return G.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),G.push("return function construct_"+L+"(data,shape,stride,offset){return new "+L+"(data,"+Y.map((function(I){return"shape["+I+"]"})).join(",")+","+Y.map((function(I){return"stride["+I+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",G.join("\n"))(l[I],p)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};I.exports=function(I,x,L,F){if(void 0===I)return(0,l.array[0])([]);"number"===typeof I&&(I=[I]),void 0===x&&(x=[I.length]);var Y=x.length;if(void 0===L){L=new Array(Y);for(var p=Y-1,W=1;p>=0;--p)L[p]=W,W*=x[p]}if(void 0===F){F=0;for(p=0;p<Y;++p)L[p]<0&&(F-=(x[p]-1)*L[p])}for(var Q=function(I){if(X(I))return"buffer";if(G)switch(Object.prototype.toString.call(I)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(I)?"array":"generic"}(I),e=l[Q];e.length<=Y+1;)e.push(B(Q,e.length-1));return(0,e[Y+1])(I,x,L,F)}},14658:I=>{function x(I){return!!I.constructor&&"function"===typeof I.constructor.isBuffer&&I.constructor.isBuffer(I)}I.exports=function(I){return null!=I&&(x(I)||function(I){return"function"===typeof I.readFloatLE&&"function"===typeof I.slice&&x(I.slice(0,0))}(I)||!!I._isBuffer)}},14814:I=>{"use strict";var x=[],L=[],F=[],X=[],G=[],Y=[],p=[],B=[],l=[],W=[],Q=[],e=[];I.exports=function(I,g,v,z,H,s){for(var U=p,q=l,y=W,T=e,Z=0;Z<3;Z++)U[Z]=+v[Z],y[Z]=+g.max[Z],q[Z]=+g.base[Z];s||(s=1e-10);var t=function(I,p,l,W,e,g){var v=x,z=L,H=F,s=X,U=G,q=Y,y=B,T=Math.floor,Z=0,t=0,f=0,R=0,n=0;if(P(),0===f)return 0;for(R=K();t<=f;){if(d(R)&&M())return Z;R=K()}for(Z+=f,n=0;n<3;n++)W[n]+=l[n],e[n]+=l[n];return Z;function P(){if(t=0,0!==(f=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])))for(var I=0;I<3;I++){var x=l[I]>=0;s[I]=x?1:-1;var L=x?e[I]:W[I];v[I]=x?W[I]:e[I],z[I]=u(L,s[I]),H[I]=A(v[I],s[I]),y[I]=l[I]/f,U[I]=Math.abs(1/y[I]);var F=x?z[I]+1-L:L-z[I];q[I]=U[I]<1/0?U[I]*F:1/0}}function d(x){for(var L=s[0],F=0===x?z[0]:H[0],X=z[0]+L,G=s[1],Y=1===x?z[1]:H[1],p=z[1]+G,B=s[2],l=2===x?z[2]:H[2],W=z[2]+B,Q=F;Q!=X;Q+=L)for(var e=Y;e!=p;e+=G)for(var g=l;g!=W;g+=B)if(I(Q,e,g))return!0;return!1}function M(){Z+=t;var I=s[R],x=t/f,L=Q;for(n=0;n<3;n++){var F=l[n]*x;W[n]+=F,e[n]+=F,L[n]=l[n]-F}if(I>0?e[R]=Math.round(e[R]):W[R]=Math.round(W[R]),p(Z,R,I,L))return!0;for(n=0;n<3;n++)l[n]=L[n];return P(),0===f}function K(){var I=q[0]<q[1]?q[0]<q[2]?0:2:q[1]<q[2]?1:2,x=q[I]-t;for(t=q[I],z[I]+=s[I],q[I]+=U[I],n=0;n<3;n++)v[n]+=x*y[n],H[n]=A(v[n],s[n]);return I}function u(I,x){return T(I-x*g)}function A(I,x){return T(I+x*g)}}(I,z,U,q,y,s);if(!H){for(Z=0;Z<3;Z++)T[Z]=v[Z]>0?y[Z]-g.max[Z]:q[Z]-g.base[Z];g.translate(T)}return t}},15129:(I,x,L)=>{"use strict";L.d(x,{e:()=>Q});var F=L(14809),X=L(13764);class G{constructor(I,x,L,G,Y,p,B){this.UW=new F(I.base,I.OW),this.UX=x,this.friction=L,this.restitution=G,this.Bp=Y,this.Kv=p,this.lp=!!B,this.mQ=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Uz=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.wl=X.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=X.create(),this._impulses=X.create(),this._sleepFrameCount=10}loadFromCopy(I){X.j(this.UW.base,I.UW.base),X.j(this.UW.OW,I.UW.OW),X.j(this.UW.max,I.UW.max),this.UW.mag=I.UW.mag,this.UX=I.UX,this.friction=I.friction,this.restitution=I.restitution,this.Bp=I.Bp,this.Kv=I.Kv,this.lp=I.lp,this.mQ=I.mQ,this.fluidDrag=I.fluidDrag,this.Uz=I.Uz,this.preventFallOffEdge=I.preventFallOffEdge,this.rolledBackLastTick=I.rolledBackLastTick,X.j(this.wl,I.wl),X.j(this.resting,I.resting),this.inFluid=I.inFluid,this._ratioInFluid=I._ratioInFluid,X.j(this._forces,I._forces),X.j(this._impulses,I._impulses),this._sleepFrameCount=I._sleepFrameCount}setPosition(I){Y(I),X.Ux(I,I,this.UW.base),this.UW.translate(I),this.kl()}IX(){return X.clone(this.UW.base)}applyForce(I){Y(I),X.add(this._forces,this._forces,I),this.kl()}applyImpulse(I){Y(I),X.add(this._impulses,this._impulses,I),this.kl()}kl(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var Y=I=>{};var p=L(14809),B=L(13764),l=L(14814);function W(){this.mQ=.1,this.fluidDrag=.4,this.vp=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function Q(I,x,L){I=Object.assign(new W,I),this.gravity=I.gravity||[0,-10,0],this.mQ=I.mQ||.1,this.vp=I.vp||2,this.fluidDrag=I.fluidDrag||.4,this.minBounceImpulse=I.minBounceImpulse,this.bodies=[],this.xv=I.xv,this.testSolid=x,this.testFluid=L}Q.prototype.av=function(I,x,L,F,X,Y){I=I||new p([0,0,0],[1,1,1]),"undefined"==typeof x&&(x=1),"undefined"==typeof L&&(L=1),"undefined"==typeof F&&(F=0),"undefined"==typeof X&&(X=1);var B=new G(I,x,L,F,X,Y);return this.bodies.push(B),B},Q.prototype.Dv=function(I){var x=this.bodies.indexOf(I);x<0||(this.bodies.splice(x,1),I.UW=I.Kv=null)};var e=B.create(),g=B.create(),v=B.create(),z=B.create(),H=B.create(),s=B.create(),U=B.create(),q=new p([0,0,0],[1,1,1]),y=new G(q,1,1,0,1,(()=>{}),!1);function T(I,x,L){return x=L,x*=1-(1-I.ratioInFluid)**2}Q.prototype.rp=function(I){I/=1e3;var x=a(0,B.squaredLength(this.gravity));this.bodies.forEach((L=>function(I,x,L,F){B.j(H,x.resting),I.xv&&y.loadFromCopy(x);if(x.UX<=0)return B.set(x.wl,0,0,0),B.set(x._forces,0,0,0),void B.set(x._impulses,0,0,0);var X=F||0===x.Bp;if(function(I,x,L,F){if(x._sleepFrameCount>0)return!1;if(F)return!0;var X=!1,G=.5*L*L*x.Bp;return B.scale(k,I.gravity,G),l(I.testSolid,x.UW,k,(function(){return X=!0,!0}),!0),X}(I,x,L,X))return;x._sleepFrameCount--,function(I,x){var L=x.UW,F=Math.floor(L.base[0]),X=Math.floor(L.base[2]),G=Math.floor(L.base[1]),Y=Math.floor(L.max[1]);if(!I.testFluid(F,G,X))return x.inFluid=!1,void(x.ratioInFluid=0);var p=1,l=G+1;for(;l<=Y&&I.testFluid(F,l,X);)p++,l++;var W=(G+p-L.base[1])/L.OW[1];W>1&&(W=1);var Q=L.OW[0]*L.OW[1]*L.OW[2]*W,e=t;B.scale(e,I.gravity,-I.vp*Q*x.Bp),x.applyForce(e),x.inFluid=!0,x.ratioInFluid=W}(I,x),r(x._forces),r(x._impulses),r(x.wl),r(x.resting),B.scale(e,x._forces,1/x.UX),B.upI(e,e,I.gravity,x.Bp),B.scale(g,x._impulses,1/x.UX),B.upI(g,g,e,L),B.add(x.wl,x.wl,g),x.friction&&(f(I,0,x,g,L),f(I,1,x,g,L),f(I,2,x,g,L));var G=x.fluidDrag>=0?x.fluidDrag:I.fluidDrag,Y=x.mQ>=0?x.mQ:I.mQ,p=Y,W=Y;x.inFluid&&(p=T(x,p,x.fluidDragHoriz>=0?x.fluidDragHoriz:G),W=T(x,W,x.fluidDragVert>=0?x.fluidDragVert:G));p=Math.max(1-p*L/x.UX,0),W=Math.max(1-W*L/x.UX,0),B.set(Z,p,W,p),B.multiply(x.wl,x.wl,Z),B.scale(v,x.wl,L),B.set(x._forces,0,0,0),B.set(x._impulses,0,0,0),x.lp&&D(P,x.UW);B.j(s,v),B.set(U,0,0,0),x.preventFallOffEdge&&function(I,x,L,F){if(!x.resting[1]||L[1]>0)return;var X=mI;D(X,x.UW);for(var G=0;G<3;G+=2){B.set(A,0,0,0),A[G]=L[G];var Y=!0;(Y=(Y=(Y=(Y=Y&&!w(I,X.base[0]+A[0]+1e-5,X.base[1],X.base[2]+A[2]+1e-5))&&!w(I,X.max[0]+A[0]-1e-5,X.base[1],X.base[2]+A[2]+1e-5))&&!w(I,X.base[0]+A[0]+1e-5,X.base[1],X.max[2]+A[2]-1e-5))&&!w(I,X.max[0]+A[0]-1e-5,X.base[1],X.max[2]+A[2]-1e-5))?(F[G]=L[G]>0?1:-1,L[G]=0):0===G&&(B.set(O,L[0],0,0),n(I,X,O,F,x.slideOnCollision))}}(I,x,v,U);n(I,x.UW,v,x.resting,x.slideOnCollision),x.lp&&function(I,x,L,F){if(x.resting[1]>=0&&!x.inFluid)return;var X=0!==x.resting[0],G=0!==x.resting[2];if(!X&&!G)return;var Y=Math.abs(F[0]/F[2]),p=4;if(!X&&Y>p)return;if(!G&&Y<1/p)return;B.add(M,L.base,F);var W=I.testSolid;l(W,L,F,(function(I,x,L,F){if(1!==x)return!0;F[x]=0}));var Q=L.base[1],e=x.inFluid?1.951:1.001,g=Math.floor(Q+e)-Q;B.set(K,0,g,0);var v=!1;if(l(W,L,K,(function(I,x,L,F){return v=!0,!0})),v)return;B.Ux(u,M,L.base),u[1]=0,n(I,L,u,d,!0);var z=a(L.base[0],M[0]),H=a(L.base[2],M[2]);if(X&&!z&&(!H||!G))return;if(G&&(!z||!X)&&!H)return;var s=!0;if(s=s&&!w(I,L.base[0]+1e-5,L.base[1],L.base[2]+1e-5),s=s&&!w(I,L.max[0]-1e-5,L.base[1],L.base[2]+1e-5),s=s&&!w(I,L.base[0]+1e-5,L.base[1],L.max[2]-1e-5),s=s&&!w(I,L.max[0]-1e-5,L.base[1],L.max[2]-1e-5),s)return;D(x.UW,L),x.resting[0]=d[0],x.resting[2]=d[2],x.Uz&&x.Uz()}(I,x,P,s);for(var Q=0;Q<3;++Q)x.resting[Q]=x.resting[Q]||U[Q],z[Q]=0,x.resting[Q]&&(H[Q]||(z[Q]=-x.wl[Q]),x.wl[Q]=0);var q=B.length(z);q>.001&&(B.scale(z,z,x.UX),x.Kv&&x.Kv(z),x.restitution>0&&q>I.minBounceImpulse&&(B.scale(z,z,x.restitution),x.applyImpulse(z)));var R=B.squaredLength(x.wl);R>1e-5&&x.kl();I.xv&&I.xv(x)?(x.loadFromCopy(y),x.rolledBackLastTick=!0):x.rolledBackLastTick=!1}(this,L,I,x)))};var Z=B.create([0,0,0]);var t=B.create();function f(I,x,L,F,X){var G=L.resting[x],Y=F[x];if(!L.alwaysApplyHorizFriction||1!==x){if(0===G)return;if(G*Y<=0)return}B.j(R,L.wl),R[x]=0;var p=B.length(R);if(!a(p,0)){var l=Math.abs(L.friction*I.gravity[x]*X),W=p>l?(p-l)/p:0;L.wl[(x+1)%3]*=W,L.wl[(x+2)%3]*=W}}var R=B.create();function n(I,x,L,F,X){return B.set(F,0,0,0),l(I.testSolid,x,L,(function(I,x,L,G){F[x]=L,G[x]=0,X||(G[0]=0,G[1]=0,G[2]=0)}))}var P=new p([],[]),d=B.create(),M=B.create(),K=B.create(),u=B.create();var A=B.create(),mI=new p([],[]),O=B.create();function w(I,x,L,F){return I.testSolid(Math.floor(x),Math.floor(L-1),Math.floor(F))}var k=B.create();function a(I,x){return Math.abs(I-x)<1e-5}function D(I,x){for(var L=0;L<3;L++)I.base[L]=x.base[L],I.max[L]=x.max[L],I.OW[L]=x.OW[L]}var r=function(I){}},13638:function(I,x){!function(I){"use strict";var x=function(I,L){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,x){I.__proto__=x}||function(I,x){for(var L in x)Object.prototype.hasOwnProperty.call(x,L)&&(I[L]=x[L])},x(I,L)};function L(I,L){if("function"!==typeof L&&null!==L)throw new TypeError("Class extends value "+String(L)+" is not a constructor or null");function F(){this.constructor=I}x(I,L),I.prototype=null===L?Object.create(L):(F.prototype=L.prototype,new F)}function F(I,x,L,F){var X,G=arguments.length,Y=G<3?x:null===F?F=Object.getOwnPropertyDescriptor(x,L):F;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Y=Reflect.decorate(I,x,L,F);else for(var p=I.length-1;p>=0;p--)(X=I[p])&&(Y=(G<3?X(Y):G>3?X(x,L,Y):X(x,L))||Y);return G>3&&Y&&Object.defineProperty(x,L,Y),Y}function X(I,x,L){if(L||2===arguments.length)for(var F,X=0,G=x.length;X<G;X++)!F&&X in x||(F||(F=Array.prototype.slice.call(x,0,X)),F[X]=x[X]);return I.concat(F||Array.prototype.slice.call(x))}var G,Y=255,p=213;I.OPERATION=void 0,(G=I.OPERATION||(I.OPERATION={}))[G.ADD=128]="ADD",G[G.REPLACE=0]="REPLACE",G[G.DELETE=64]="DELETE",G[G.DELETE_AND_ADD=192]="DELETE_AND_ADD",G[G.TOUCH=1]="TOUCH",G[G.CLEAR=10]="CLEAR";var B=function(){function x(I,x,L){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=I,this.setParent(x,L)}return x.prototype.setParent=function(I,x,L){var F=this;if(this.indexes||(this.indexes=this.ref instanceof uI?this.ref._definition.indexes:{}),this.parent=I,this.parentIndex=L,x)if(this.root=x,this.ref instanceof uI){var X=this.ref._definition;for(var G in X.schema){var Y=this.ref[G];if(Y&&Y.$changes){var p=X.indexes[G];Y.$changes.setParent(this.ref,x,p)}}}else"object"===typeof this.ref&&this.ref.forEach((function(I,x){if(I instanceof uI){var L=I.$changes,X=F.ref.$changes.indexes[x];L.setParent(F.ref,F.root,X)}}))},x.prototype.operation=function(I){this.changes.set(--this.currentCustomOperation,I)},x.prototype.change=function(x,L){void 0===L&&(L=I.OPERATION.ADD);var F="number"===typeof x?x:this.indexes[x];this.assertValidIndex(F,x);var X=this.changes.get(F);X&&X.op!==I.OPERATION.DELETE&&X.op!==I.OPERATION.TOUCH||this.changes.set(F,{op:X&&X.op===I.OPERATION.DELETE?I.OPERATION.DELETE_AND_ADD:L,index:F}),this.allChanges.add(F),this.changed=!0,this.touchParents()},x.prototype.touch=function(x){var L="number"===typeof x?x:this.indexes[x];this.assertValidIndex(L,x),this.changes.has(L)||this.changes.set(L,{op:I.OPERATION.TOUCH,index:L}),this.allChanges.add(L),this.touchParents()},x.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},x.prototype.getType=function(I){if(this.ref._definition)return(x=this.ref._definition).schema[x.fieldsByIndex[I]];var x,L=(x=this.parent._definition).schema[x.fieldsByIndex[this.parentIndex]];return Object.values(L)[0]},x.prototype.getChildrenFilter=function(){var I=this.parent._definition.childFilters;return I&&I[this.parentIndex]},x.prototype.getValue=function(I){return this.ref.getByIndex(I)},x.prototype.delete=function(x){var L="number"===typeof x?x:this.indexes[x];if(void 0!==L){var F=this.getValue(L);this.changes.set(L,{op:I.OPERATION.DELETE,index:L}),this.allChanges.delete(L),delete this.caches[L],F&&F.$changes&&(F.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(x," (").concat(L,")"))},x.prototype.discard=function(x,L){var F=this;void 0===x&&(x=!1),void 0===L&&(L=!1),this.ref instanceof uI||this.changes.forEach((function(x){if(x.op===I.OPERATION.DELETE){var L=F.ref.getIndex(x.index);delete F.indexes[L]}})),this.changes.clear(),this.changed=x,L&&this.allChanges.clear(),this.currentCustomOperation=0},x.prototype.discardAll=function(){var I=this;this.changes.forEach((function(x){var L=I.getValue(x.index);L&&L.$changes&&L.$changes.discardAll()})),this.discard()},x.prototype.cache=function(I,x){this.caches[I]=x},x.prototype.clone=function(){return new x(this.ref,this.parent,this.root)},x.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},x.prototype.assertValidIndex=function(I,x){if(void 0===I)throw new Error('ChangeTree: missing index for field "'.concat(x,'"'))},x}();function l(I,x,L,F){return I[x]||(I[x]=[]),I[x].push(L),null===F||void 0===F||F.forEach((function(I,x){return L(I,x)})),function(){return Q(I[x],I[x].indexOf(L))}}function W(x){var L=this,F="string"!==typeof this.$changes.getType();this.$items.forEach((function(X,G){x.push({refId:L.$changes.refId,op:I.OPERATION.DELETE,field:G,value:void 0,previousValue:X}),F&&L.$changes.root.removeRef(X.$changes.refId)}))}function Q(I,x){if(-1===x||x>=I.length)return!1;for(var L=I.length-1,F=x;F<L;F++)I[F]=I[F+1];return I.length=L,!0}var e=function(I,x){var L=I.toString(),F=x.toString();return L<F?-1:L>F?1:0};function g(I){return I.$proxy=!0,I=new Proxy(I,{get:function(I,x){return"symbol"===typeof x||isNaN(x)?I[x]:I.at(x)},set:function(I,x,L){if("symbol"===typeof x||isNaN(x))I[x]=L;else{var F=Array.from(I.$items.keys()),X=parseInt(F[x]||x);void 0===L||null===L?I.deleteAt(X):I.setAt(X,L)}return!0},deleteProperty:function(I,x){return"number"===typeof x?I.deleteAt(x):delete I[x],!0}})}var v=function(){function x(){for(var I=[],x=0;x<arguments.length;x++)I[x]=arguments[x];this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,I)}return x.prototype.qB=function(x,L){return void 0===L&&(L=!0),l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,x,L?this.$items:void 0)},x.prototype.nx=function(x){return l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,x)},x.is=function(I){return Array.isArray(I)||void 0!==I.array},Object.defineProperty(x.prototype,"length",{get:function(){return this.$items.size},set:function(I){0===I?this.clear():this.splice(I,this.length-I)},enumerable:!1,configurable:!0}),x.prototype.push=function(){for(var I,x=this,L=[],F=0;F<arguments.length;F++)L[F]=arguments[F];return L.forEach((function(L){I=x.$refId++,x.setAt(I,L)})),I},x.prototype.pop=function(){var I=Array.from(this.$indexes.values()).pop();if(void 0!==I){this.$changes.delete(I),this.$indexes.delete(I);var x=this.$items.get(I);return this.$items.delete(I),x}},x.prototype.at=function(I){var x=Array.from(this.$items.keys())[I];return this.$items.get(x)},x.prototype.setAt=function(x,L){var F,X;if(void 0!==L&&null!==L){if(this.$items.get(x)!==L){void 0!==L.$changes&&L.$changes.setParent(this,this.$changes.root,x);var G=null!==(X=null===(F=this.$changes.indexes[x])||void 0===F?void 0:F.op)&&void 0!==X?X:I.OPERATION.ADD;this.$changes.indexes[x]=x,this.$indexes.set(x,x),this.$items.set(x,L),this.$changes.change(x,G)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},x.prototype.deleteAt=function(I){var x=Array.from(this.$items.keys())[I];return void 0!==x&&this.$deleteAt(x)},x.prototype.$deleteAt=function(I){return this.$changes.delete(I),this.$indexes.delete(I),this.$items.delete(I)},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&W.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.concat=function(){for(var I,L=[],F=0;F<arguments.length;F++)L[F]=arguments[F];return new(x.bind.apply(x,X([void 0],(I=Array.from(this.$items.values())).concat.apply(I,L),!1)))},x.prototype.join=function(I){return Array.from(this.$items.values()).join(I)},x.prototype.reverse=function(){var I=this,x=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(L,F){I.setAt(x[F],L)})),this},x.prototype.shift=function(){var I=Array.from(this.$items.keys()).shift();if(void 0!==I){var x=this.$items.get(I);return this.$deleteAt(I),x}},x.prototype.slice=function(I,L){var F=new x;return F.push.apply(F,Array.from(this.$items.values()).slice(I,L)),F},x.prototype.sort=function(I){var x=this;void 0===I&&(I=e);var L=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(I).forEach((function(I,F){x.setAt(L[F],I)})),this},x.prototype.splice=function(I,x){void 0===x&&(x=this.length-I);for(var L=Array.from(this.$items.keys()),F=[],X=I;X<I+x;X++)F.push(this.$items.get(L[X])),this.$deleteAt(L[X]);return F},x.prototype.unshift=function(){for(var I=this,x=[],L=0;L<arguments.length;L++)x[L]=arguments[L];var F=this.length,X=x.length,G=Array.from(this.$items.values());return x.forEach((function(x,L){I.setAt(L,x)})),G.forEach((function(x,L){I.setAt(X+L,x)})),F+X},x.prototype.indexOf=function(I,x){return Array.from(this.$items.values()).indexOf(I,x)},x.prototype.lastIndexOf=function(I,x){return void 0===x&&(x=this.length-1),Array.from(this.$items.values()).lastIndexOf(I,x)},x.prototype.every=function(I,x){return Array.from(this.$items.values()).every(I,x)},x.prototype.some=function(I,x){return Array.from(this.$items.values()).some(I,x)},x.prototype.forEach=function(I,x){Array.from(this.$items.values()).forEach(I,x)},x.prototype.map=function(I,x){return Array.from(this.$items.values()).map(I,x)},x.prototype.filter=function(I,x){return Array.from(this.$items.values()).filter(I,x)},x.prototype.reduce=function(I,x){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},x.prototype.reduceRight=function(I,x){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},x.prototype.find=function(I,x){return Array.from(this.$items.values()).find(I,x)},x.prototype.findIndex=function(I,x){return Array.from(this.$items.values()).findIndex(I,x)},x.prototype.fill=function(I,x,L){throw new Error("ArraySchema#fill() not implemented")},x.prototype.copyWithin=function(I,x,L){throw new Error("ArraySchema#copyWithin() not implemented")},x.prototype.toString=function(){return this.$items.toString()},x.prototype.toLocaleString=function(){return this.$items.toLocaleString()},x.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(x,Symbol.species,{get:function(){return x},enumerable:!1,configurable:!0}),x.prototype.entries=function(){return this.$items.entries()},x.prototype.keys=function(){return this.$items.keys()},x.prototype.values=function(){return this.$items.values()},x.prototype.includes=function(I,x){return Array.from(this.$items.values()).includes(I,x)},x.prototype.flatMap=function(I,x){throw new Error("ArraySchema#flatMap() is not supported.")},x.prototype.flat=function(I){throw new Error("ArraySchema#flat() is not supported.")},x.prototype.findLast=function(){var I=Array.from(this.$items.values());return I.findLast.apply(I,arguments)},x.prototype.findLastIndex=function(){var I=Array.from(this.$items.values());return I.findLastIndex.apply(I,arguments)},x.prototype.setIndex=function(I,x){this.$indexes.set(I,x)},x.prototype.getIndex=function(I){return this.$indexes.get(I)},x.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},x.prototype.deleteByIndex=function(I){var x=this.$indexes.get(I);this.$items.delete(x),this.$indexes.delete(I)},x.prototype.toArray=function(){return Array.from(this.$items.values())},x.prototype.toJSON=function(){return this.toArray().map((function(I){return"function"===typeof I.toJSON?I.toJSON():I}))},x.prototype.clone=function(I){return I?new(x.bind.apply(x,X([void 0],Array.from(this.$items.values()),!1))):new(x.bind.apply(x,X([void 0],this.map((function(I){return I.$changes?I.clone():I})),!1)))},x}();function z(I){return I.$proxy=!0,I=new Proxy(I,{get:function(I,x){return"symbol"!==typeof x&&"undefined"===typeof I[x]?I.get(x):I[x]},set:function(I,x,L){return"symbol"!==typeof x&&-1===x.indexOf("$")&&"qB"!==x&&"nx"!==x&&"onChange"!==x?I.set(x,L):I[x]=L,!0},deleteProperty:function(I,x){return I.delete(x),!0}})}var H=function(){function x(I){var L=this;if(this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,I)if(I instanceof Map||I instanceof x)I.forEach((function(I,x){return L.set(x,I)}));else for(var F in I)this.set(F,I[F])}return x.prototype.qB=function(x,L){return void 0===L&&(L=!0),l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,x,L?this.$items:void 0)},x.prototype.nx=function(x){return l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,x)},x.is=function(I){return void 0!==I.map},x.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(x.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(x,Symbol.species,{get:function(){return x},enumerable:!1,configurable:!0}),x.prototype.set=function(x,L){if(void 0===L||null===L)throw new Error("MapSchema#set('".concat(x,"', ").concat(L,"): trying to set ").concat(L," value on '").concat(x,"'."));x=x.toString();var F="undefined"!==typeof this.$changes.indexes[x],X=F?this.$changes.indexes[x]:this.$refId++,G=F?I.OPERATION.REPLACE:I.OPERATION.ADD,Y=void 0!==L.$changes;if(Y&&L.$changes.setParent(this,this.$changes.root,X),F){if(!Y&&this.$items.get(x)===L)return;Y&&this.$items.get(x)!==L&&(G=I.OPERATION.ADD)}else this.$changes.indexes[x]=X,this.$indexes.set(X,x);return this.$items.set(x,L),this.$changes.change(x,G),this},x.prototype.get=function(I){return this.$items.get(I)},x.prototype.delete=function(I){return this.$changes.delete(I),this.$items.delete(I)},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&W.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.has=function(I){return this.$items.has(I)},x.prototype.forEach=function(I){this.$items.forEach(I)},x.prototype.entries=function(){return this.$items.entries()},x.prototype.keys=function(){return this.$items.keys()},x.prototype.values=function(){return this.$items.values()},Object.defineProperty(x.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),x.prototype.setIndex=function(I,x){this.$indexes.set(I,x)},x.prototype.getIndex=function(I){return this.$indexes.get(I)},x.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},x.prototype.deleteByIndex=function(I){var x=this.$indexes.get(I);this.$items.delete(x),this.$indexes.delete(I)},x.prototype.toJSON=function(){var I={};return this.forEach((function(x,L){I[L]="function"===typeof x.toJSON?x.toJSON():x})),I},x.prototype.clone=function(I){var L;return I?L=Object.assign(new x,this):(L=new x,this.forEach((function(I,x){I.$changes?L.set(x,I.clone()):L.set(x,I)}))),L},x}(),s={};function U(I,x){s[I]=x}function q(I){return s[I]}var y=function(){function I(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return I.create=function(x){var L=new I;return L.schema=Object.assign({},x&&x.schema||{}),L.indexes=Object.assign({},x&&x.indexes||{}),L.fieldsByIndex=Object.assign({},x&&x.fieldsByIndex||{}),L.descriptors=Object.assign({},x&&x.descriptors||{}),L.deprecated=Object.assign({},x&&x.deprecated||{}),L},I.prototype.addField=function(I,x){var L=this.getNextFieldIndex();this.fieldsByIndex[L]=I,this.indexes[I]=L,this.schema[I]=Array.isArray(x)?{array:x[0]}:x},I.prototype.hasField=function(I){return void 0!==this.indexes[I]},I.prototype.addFilter=function(I,x){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[I]]=x,this.indexesWithFilters.push(this.indexes[I]),!0},I.prototype.addChildrenFilter=function(I,x){var L=this.indexes[I],F=this.schema[I];if(q(Object.keys(F)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[L]=x,!0;console.warn("@filterChildren: field '".concat(I,"' can't have children. Ignoring filter."))},I.prototype.getChildrenFilter=function(I){return this.childFilters&&this.childFilters[this.indexes[I]]},I.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},I}();function T(I){return I._context&&I._context.useFilters}var Z=function(){function I(){this.types={},this.schemas=new Map,this.useFilters=!1}return I.prototype.has=function(I){return this.schemas.has(I)},I.prototype.get=function(I){return this.types[I]},I.prototype.add=function(I,x){void 0===x&&(x=this.schemas.size),I._definition=y.create(I._definition),I._typeid=x,this.types[x]=I,this.schemas.set(I,x)},I.create=function(x){return void 0===x&&(x={}),function(L){return x.context||(x.context=new I),f(L,x)}},I}(),t=new Z;function f(I,x){return void 0===x&&(x={}),function(L,F){var G=x.context||t,Y=L.constructor;if(Y._context=G,!I)throw new Error("".concat(Y.name,': @type() reference provided for "').concat(F,"\" is undefined. Make sure you don't have any circular dependencies."));G.has(Y)||G.add(Y);var p=Y._definition;if(p.addField(F,I),p.descriptors[F]){if(p.deprecated[F])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(F,"' definition on '").concat(Y.name,"'.\nCheck @type() annotation"))}catch(s){var B=s.stack.split("\n")[4].trim();throw new Error("".concat(s.message," ").concat(B))}}var l=v.is(I),W=!l&&H.is(I);if("string"!==typeof I&&!uI.is(I)){var Q=Object.values(I)[0];"string"===typeof Q||G.has(Q)||G.add(Q)}if(x.manual)p.descriptors[F]={enumerable:!0,configurable:!0,writable:!0};else{var e="_".concat(F);p.descriptors[e]={enumerable:!1,configurable:!1,writable:!0},p.descriptors[F]={get:function(){return this[e]},set:function(I){I!==this[e]&&(void 0!==I&&null!==I?(!l||I instanceof v||(I=new(v.bind.apply(v,X([void 0],I,!1)))),!W||I instanceof H||(I=new H(I)),void 0===I.$proxy&&(W?I=z(I):l&&(I=g(I))),this.$changes.change(F),I.$changes&&I.$changes.setParent(this,this.$changes.root,this._definition.indexes[F])):this[e]&&this.$changes.delete(F),this[e]=I)},enumerable:!0,configurable:!0}}}}function R(I){return function(x,L){var F=x.constructor;F._definition.addFilter(L,I)&&(F._context.useFilters=!0)}}function n(I){return function(x,L){var F=x.constructor;F._definition.addChildrenFilter(L,I)&&(F._context.useFilters=!0)}}function P(I){return void 0===I&&(I=!0),function(x,L){var F=x.constructor._definition;F.deprecated[L]=!0,I&&(F.descriptors[L]={get:function(){throw new Error("".concat(L," is deprecated."))},set:function(I){},enumerable:!1,configurable:!0})}}function d(I,x,L){for(var F in void 0===L&&(L={}),L.context||(L.context=I._context||L.context||t),x)f(x[F],L)(I.prototype,F);return I}function M(I){for(var x=0,L=0,F=0,X=I.length;F<X;F++)(x=I.charCodeAt(F))<128?L+=1:x<2048?L+=2:x<55296||x>=57344?L+=3:(F++,L+=4);return L}function K(I,x,L){for(var F=0,X=0,G=L.length;X<G;X++)(F=L.charCodeAt(X))<128?I[x++]=F:F<2048?(I[x++]=192|F>>6,I[x++]=128|63&F):F<55296||F>=57344?(I[x++]=224|F>>12,I[x++]=128|F>>6&63,I[x++]=128|63&F):(X++,F=65536+((1023&F)<<10|1023&L.charCodeAt(X)),I[x++]=240|F>>18,I[x++]=128|F>>12&63,I[x++]=128|F>>6&63,I[x++]=128|63&F)}function u(I,x){I.push(255&x)}function A(I,x){I.push(255&x)}function mI(I,x){I.push(255&x),I.push(x>>8&255)}function O(I,x){I.push(255&x),I.push(x>>8&255)}function w(I,x){I.push(255&x),I.push(x>>8&255),I.push(x>>16&255),I.push(x>>24&255)}function k(I,x){var L=x>>24,F=x>>16,X=x>>8,G=x;I.push(255&G),I.push(255&X),I.push(255&F),I.push(255&L)}function a(I,x){var L=Math.floor(x/Math.pow(2,32));k(I,x>>>0),k(I,L)}function D(I,x){var L=x/Math.pow(2,32)|0;k(I,x>>>0),k(I,L)}function r(I,x){J(I,x)}function N(I,x){h(I,x)}var S=new Int32Array(2),c=new Float32Array(S.buffer),o=new Float64Array(S.buffer);function J(I,x){c[0]=x,w(I,S[0])}function h(I,x){o[0]=x,w(I,S[0]),w(I,S[1])}function E(I,x){return A(I,x?1:0)}function i(I,x){x||(x="");var L=M(x),F=0;if(L<32)I.push(160|L),F=1;else if(L<256)I.push(217),A(I,L),F=2;else if(L<65536)I.push(218),O(I,L),F=3;else{if(!(L<4294967296))throw new Error("String too long");I.push(219),k(I,L),F=5}return K(I,I.length,x),F+L}function V(I,x){return isNaN(x)?V(I,0):isFinite(x)?x!==(0|x)?(I.push(203),h(I,x),9):x>=0?x<128?(A(I,x),1):x<256?(I.push(204),A(I,x),2):x<65536?(I.push(205),O(I,x),3):x<4294967296?(I.push(206),k(I,x),5):(I.push(207),D(I,x),9):x>=-32?(I.push(224|x+32),1):x>=-128?(I.push(208),u(I,x),2):x>=-32768?(I.push(209),mI(I,x),3):x>=-2147483648?(I.push(210),w(I,x),5):(I.push(211),a(I,x),9):V(I,x>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var j=Object.freeze({__proto__:null,utf8Write:K,int8:u,uint8:A,int16:mI,uint16:O,int32:w,uint32:k,int64:a,uint64:D,float32:r,float64:N,writeFloat32:J,writeFloat64:h,boolean:E,string:i,number:V});function C(I,x,L){for(var F="",X=0,G=x,Y=x+L;G<Y;G++){var p=I[G];0!==(128&p)?192!==(224&p)?224!==(240&p)?240!==(248&p)?console.error("Invalid byte "+p.toString(16)):(X=(7&p)<<18|(63&I[++G])<<12|(63&I[++G])<<6|63&I[++G])>=65536?(X-=65536,F+=String.fromCharCode(55296+(X>>>10),56320+(1023&X))):F+=String.fromCharCode(X):F+=String.fromCharCode((15&p)<<12|(63&I[++G])<<6|63&I[++G]):F+=String.fromCharCode((31&p)<<6|63&I[++G]):F+=String.fromCharCode(p)}return F}function b(I,x){return II(I,x)<<24>>24}function II(I,x){return I[x.offset++]}function xI(I,x){return LI(I,x)<<16>>16}function LI(I,x){return I[x.offset++]|I[x.offset++]<<8}function FI(I,x){return I[x.offset++]|I[x.offset++]<<8|I[x.offset++]<<16|I[x.offset++]<<24}function XI(I,x){return FI(I,x)>>>0}function GI(I,x){return eI(I,x)}function YI(I,x){return gI(I,x)}function pI(I,x){var L=XI(I,x);return FI(I,x)*Math.pow(2,32)+L}function BI(I,x){var L=XI(I,x);return XI(I,x)*Math.pow(2,32)+L}var lI=new Int32Array(2),WI=new Float32Array(lI.buffer),QI=new Float64Array(lI.buffer);function eI(I,x){return lI[0]=FI(I,x),WI[0]}function gI(I,x){return lI[0]=FI(I,x),lI[1]=FI(I,x),QI[0]}function vI(I,x){return II(I,x)>0}function zI(I,x){var L,F=I[x.offset++];F<192?L=31&F:217===F?L=II(I,x):218===F?L=LI(I,x):219===F&&(L=XI(I,x));var X=C(I,x.offset,L);return x.offset+=L,X}function HI(I,x){var L=I[x.offset];return L<192&&L>160||217===L||218===L||219===L}function sI(I,x){var L=I[x.offset++];return L<128?L:202===L?eI(I,x):203===L?gI(I,x):204===L?II(I,x):205===L?LI(I,x):206===L?XI(I,x):207===L?BI(I,x):208===L?b(I,x):209===L?xI(I,x):210===L?FI(I,x):211===L?pI(I,x):L>223?-1*(255-L+1):void 0}function UI(I,x){var L=I[x.offset];return L<128||L>=202&&L<=211}function qI(I,x){return I[x.offset]<160}function yI(I,x){return I[x.offset-1]===Y&&(I[x.offset]<128||I[x.offset]>=202&&I[x.offset]<=211)}var TI=Object.freeze({__proto__:null,int8:b,uint8:II,int16:xI,uint16:LI,int32:FI,uint32:XI,float32:GI,float64:YI,int64:pI,uint64:BI,readFloat32:eI,readFloat64:gI,boolean:vI,string:zI,stringCheck:HI,number:sI,numberCheck:UI,arrayCheck:qI,switchStructureCheck:yI}),ZI=function(){function x(I){var x=this;this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,I&&I.forEach((function(I){return x.add(I)}))}return x.prototype.qB=function(x,L){return void 0===L&&(L=!0),l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,x,L?this.$items:void 0)},x.prototype.nx=function(x){return l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,x)},x.is=function(I){return void 0!==I.collection},x.prototype.add=function(I){var x=this.$refId++;return void 0!==I.$changes&&I.$changes.setParent(this,this.$changes.root,x),this.$changes.indexes[x]=x,this.$indexes.set(x,x),this.$items.set(x,I),this.$changes.change(x),x},x.prototype.at=function(I){var x=Array.from(this.$items.keys())[I];return this.$items.get(x)},x.prototype.entries=function(){return this.$items.entries()},x.prototype.delete=function(I){for(var x,L,F=this.$items.entries();(L=F.next())&&!L.done;)if(I===L.value[1]){x=L.value[0];break}return void 0!==x&&(this.$changes.delete(x),this.$indexes.delete(x),this.$items.delete(x))},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&W.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.has=function(I){return Array.from(this.$items.values()).some((function(x){return x===I}))},x.prototype.forEach=function(I){var x=this;this.$items.forEach((function(L,F,X){return I(L,F,x)}))},x.prototype.values=function(){return this.$items.values()},Object.defineProperty(x.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),x.prototype.setIndex=function(I,x){this.$indexes.set(I,x)},x.prototype.getIndex=function(I){return this.$indexes.get(I)},x.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},x.prototype.deleteByIndex=function(I){var x=this.$indexes.get(I);this.$items.delete(x),this.$indexes.delete(I)},x.prototype.toArray=function(){return Array.from(this.$items.values())},x.prototype.toJSON=function(){var I=[];return this.forEach((function(x,L){I.push("function"===typeof x.toJSON?x.toJSON():x)})),I},x.prototype.clone=function(I){var L;return I?L=Object.assign(new x,this):(L=new x,this.forEach((function(I){I.$changes?L.add(I.clone()):L.add(I)}))),L},x}(),tI=function(){function x(I){var x=this;this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,I&&I.forEach((function(I){return x.add(I)}))}return x.prototype.qB=function(x,L){return void 0===L&&(L=!0),l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,x,L?this.$items:void 0)},x.prototype.nx=function(x){return l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,x)},x.is=function(I){return void 0!==I.set},x.prototype.add=function(x){var L,F;if(this.has(x))return!1;var X=this.$refId++;void 0!==x.$changes&&x.$changes.setParent(this,this.$changes.root,X);var G=null!==(F=null===(L=this.$changes.indexes[X])||void 0===L?void 0:L.op)&&void 0!==F?F:I.OPERATION.ADD;return this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,x),this.$changes.change(X,G),X},x.prototype.entries=function(){return this.$items.entries()},x.prototype.delete=function(I){for(var x,L,F=this.$items.entries();(L=F.next())&&!L.done;)if(I===L.value[1]){x=L.value[0];break}return void 0!==x&&(this.$changes.delete(x),this.$indexes.delete(x),this.$items.delete(x))},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&W.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.has=function(I){for(var x,L=this.$items.values(),F=!1;(x=L.next())&&!x.done;)if(I===x.value){F=!0;break}return F},x.prototype.forEach=function(I){var x=this;this.$items.forEach((function(L,F,X){return I(L,F,x)}))},x.prototype.values=function(){return this.$items.values()},Object.defineProperty(x.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),x.prototype.setIndex=function(I,x){this.$indexes.set(I,x)},x.prototype.getIndex=function(I){return this.$indexes.get(I)},x.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},x.prototype.deleteByIndex=function(I){var x=this.$indexes.get(I);this.$items.delete(x),this.$indexes.delete(I)},x.prototype.toArray=function(){return Array.from(this.$items.values())},x.prototype.toJSON=function(){var I=[];return this.forEach((function(x,L){I.push("function"===typeof x.toJSON?x.toJSON():x)})),I},x.prototype.clone=function(I){var L;return I?L=Object.assign(new x,this):(L=new x,this.forEach((function(I){I.$changes?L.add(I.clone()):L.add(I)}))),L},x}(),fI=function(){function I(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return I.prototype.addRefId=function(I){this.refIds.has(I)||(this.refIds.add(I),this.containerIndexes.set(I,new Set))},I.get=function(x){return void 0===x.$filterState&&(x.$filterState=new I),x.$filterState},I}(),RI=function(){function I(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return I.prototype.getNextUniqueId=function(){return this.nextUniqueId++},I.prototype.addRef=function(I,x,L){void 0===L&&(L=!0),this.refs.set(I,x),L&&(this.refCounts[I]=(this.refCounts[I]||0)+1)},I.prototype.removeRef=function(I){this.refCounts[I]=this.refCounts[I]-1,this.deletedRefs.add(I)},I.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},I.prototype.garbageCollectDeletedRefs=function(){var I=this;this.deletedRefs.forEach((function(x){if(!(I.refCounts[x]>0)){var L=I.refs.get(x);if(L instanceof uI)for(var F in L._definition.schema)"string"!==typeof L._definition.schema[F]&&L[F]&&L[F].$changes&&I.removeRef(L[F].$changes.refId);else{var X=L.$changes.parent._definition,G=X.schema[X.fieldsByIndex[L.$changes.parentIndex]];"function"===typeof Object.values(G)[0]&&Array.from(L.values()).forEach((function(x){return I.removeRef(x.$changes.refId)}))}I.refs.delete(x),delete I.refCounts[x]}})),this.deletedRefs.clear()},I}(),nI=function(I){function x(){return null!==I&&I.apply(this,arguments)||this}return L(x,I),x}(Error);function PI(I,x,L,F){var X,G=!1;switch(x){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":X="number",isNaN(I)&&console.log('trying to encode "NaN" in '.concat(L.constructor.name,"#").concat(F));break;case"string":X="string",G=!0;break;case"boolean":return}if(typeof I!==X&&(!G||G&&null!==I)){var Y="'".concat(JSON.stringify(I),"'").concat(I&&I.constructor&&" (".concat(I.constructor.name,")")||"");throw new nI("a '".concat(X,"' was expected, but ").concat(Y," was provided in ").concat(L.constructor.name,"#").concat(F))}}function dI(I,x,L,F){if(!(I instanceof x))throw new nI("a '".concat(x.name,"' was expected, but '").concat(I.constructor.name,"' was provided in ").concat(L.constructor.name,"#").concat(F))}function MI(I,x,L,F,X){PI(L,I,F,X);var G=j[I];if(!G)throw new nI("a '".concat(I,"' was expected, but ").concat(L," was provided in ").concat(F.constructor.name,"#").concat(X));G(x,L)}function KI(I,x,L){return TI[I](x,L)}var uI=function(){function x(){for(var I=[],x=0;x<arguments.length;x++)I[x]=arguments[x];Object.defineProperties(this,{$changes:{value:new B(this,void 0,new RI),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var L=this._definition.descriptors;L&&Object.defineProperties(this,L),I[0]&&this.assign(I[0])}return x.onError=function(I){console.error(I)},x.is=function(I){return I._definition&&void 0!==I._definition.schema},x.prototype.onChange=function(x){return l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,x)},x.prototype.nx=function(x){return l(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,x)},x.prototype.assign=function(I){return Object.assign(this,I),this},Object.defineProperty(x.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),x.prototype.setDirty=function(I,x){this.$changes.change(I,x)},x.prototype.listen=function(I,x,L){var F=this;return void 0===L&&(L=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[I]||(this.$callbacks[I]=[]),this.$callbacks[I].push(x),L&&void 0!==this[I]&&x(this[I],void 0),function(){return Q(F.$callbacks[I],F.$callbacks[I].indexOf(x))}},x.prototype.decode=function(L,F,X){var G;void 0===F&&(F={offset:0}),void 0===X&&(X=this);var p=[],B=this.$changes.root,l=L.length,W=0;for(B.refs.set(W,this);F.offset<l;){var Q=L[F.offset++];if(Q!=Y){var e=X.$changes,g=void 0!==X._definition,z=g?Q>>6<<6:Q;if(z!==I.OPERATION.CLEAR){var s=g?Q%(z||255):sI(L,F),U=g?X._definition.fieldsByIndex[s]:"",y=e.getType(s),T=void 0,Z=void 0,t=void 0;if(g?Z=X["_".concat(U)]:(Z=X.getByIndex(s),(z&I.OPERATION.ADD)===I.OPERATION.ADD?(t=X instanceof H?zI(L,F):s,X.setIndex(s,t)):t=X.getIndex(s)),(z&I.OPERATION.DELETE)===I.OPERATION.DELETE&&(z!==I.OPERATION.DELETE_AND_ADD&&X.deleteByIndex(s),Z&&Z.$changes&&B.removeRef(Z.$changes.refId),T=null),void 0!==U){if(z===I.OPERATION.DELETE);else if(x.is(y)){var f=sI(L,F);if(T=B.refs.get(f),z!==I.OPERATION.REPLACE){var R=this.getSchemaType(L,F,y);T||((T=this.createTypeInstance(R)).$changes.refId=f,Z&&(T.$callbacks=Z.$callbacks,Z.$changes.refId&&f!==Z.$changes.refId&&B.removeRef(Z.$changes.refId))),B.addRef(f,T,T!==Z)}}else if("string"===typeof y)T=KI(y,L,F);else{var n=q(Object.keys(y)[0]),P=sI(L,F),d=B.refs.has(P)?Z||B.refs.get(P):new n.constructor;if((T=d.clone(!0)).$changes.refId=P,Z&&(T.$callbacks=Z.$callbacks,Z.$changes.refId&&P!==Z.$changes.refId)){B.removeRef(Z.$changes.refId);for(var M=Z.entries(),K=void 0;(K=M.next())&&!K.done;){var u=(G=K.value)[0],A=G[1];p.push({refId:P,op:I.OPERATION.DELETE,field:u,value:void 0,previousValue:A})}}B.addRef(P,T,d!==Z)}if(null!==T&&void 0!==T)if(T.$changes&&T.$changes.setParent(e.ref,e.root,s),X instanceof x)X[U]=T;else if(X instanceof H)u=t,X.$items.set(u,T),X.$changes.allChanges.add(s);else if(X instanceof v)X.setAt(s,T);else if(X instanceof ZI){var mI=X.add(T);X.setIndex(s,mI)}else X instanceof tI&&!1!==(mI=X.add(T))&&X.setIndex(s,mI);Z!==T&&p.push({refId:W,op:z,field:U,dynamicIndex:t,value:T,previousValue:Z})}else{console.warn("@colyseus/schema: definition mismatch");for(var O={offset:F.offset};F.offset<l&&(!yI(L,F)||(O.offset=F.offset+1,!B.refs.has(sI(L,O))));)F.offset++}}else X.clear(p)}else{W=sI(L,F);var w=B.refs.get(W);if(!w)throw new Error('"refId" not found: '.concat(W));X=w}}return this._triggerChanges(p),B.garbageCollectDeletedRefs(),p},x.prototype.encode=function(L,F,X){void 0===L&&(L=!1),void 0===F&&(F=[]),void 0===X&&(X=!1);for(var G=this.$changes,p=new WeakSet,B=[G],l=1,W=0;W<l;W++){var Q=B[W],e=Q.ref,g=e instanceof x;Q.ensureRefId(),p.add(Q),Q!==G&&(Q.changed||L)&&(A(F,Y),V(F,Q.refId));for(var v=L?Array.from(Q.allChanges):Array.from(Q.changes.values()),z=0,s=v.length;z<s;z++){var U=L?{op:I.OPERATION.ADD,index:v[z]}:v[z],y=U.index,T=g?e._definition.fieldsByIndex&&e._definition.fieldsByIndex[y]:y,Z=F.length;if(U.op!==I.OPERATION.TOUCH)if(g)A(F,y|U.op);else{if(A(F,U.op),U.op===I.OPERATION.CLEAR)continue;V(F,y)}if(g||(U.op&I.OPERATION.ADD)!=I.OPERATION.ADD||e instanceof H&&i(F,Q.ref.$indexes.get(y)),U.op!==I.OPERATION.DELETE){var t=Q.getType(y),f=Q.getValue(y);if(f&&f.$changes&&!p.has(f.$changes)&&(B.push(f.$changes),f.$changes.ensureRefId(),l++),U.op!==I.OPERATION.TOUCH){if(x.is(t))dI(f,t,e,T),V(F,f.$changes.refId),(U.op&I.OPERATION.ADD)===I.OPERATION.ADD&&this.tryEncodeTypeId(F,t,f.constructor);else if("string"===typeof t)MI(t,F,f,e,T);else{var R=q(Object.keys(t)[0]);dI(e["_".concat(T)],R.constructor,e,T),V(F,f.$changes.refId)}X&&Q.cache(y,F.slice(Z))}}}L||X||Q.discard()}return F},x.prototype.encodeAll=function(I){return this.encode(!0,[],I)},x.prototype.applyFilters=function(L,F){var X,G;void 0===F&&(F=!1);for(var p=this,B=new Set,l=fI.get(L),W=[this.$changes],Q=1,e=[],g=function(g){var v=W[g];if(B.has(v.refId))return"continue";var z=v.ref,s=z instanceof x;A(e,Y),V(e,v.refId);var U=l.refIds.has(v),q=F||!U;l.addRefId(v);var y=l.containerIndexes.get(v),T=q?Array.from(v.allChanges):Array.from(v.changes.values());!F&&s&&z._definition.indexesWithFilters&&z._definition.indexesWithFilters.forEach((function(x){!y.has(x)&&v.allChanges.has(x)&&(q?T.push(x):T.push({op:I.OPERATION.ADD,index:x}))}));for(var Z=0,t=T.length;Z<t;Z++){var f=q?{op:I.OPERATION.ADD,index:T[Z]}:T[Z];if(f.op!==I.OPERATION.CLEAR){var R=f.index;if(f.op!==I.OPERATION.DELETE){var n=v.getValue(R),P=v.getType(R);if(s){if((d=z._definition.filters&&z._definition.filters[R])&&!d.call(z,L,n,p)){n&&n.$changes&&B.add(n.$changes.refId);continue}}else{var d,M=v.parent;if((d=v.getChildrenFilter())&&!d.call(M,L,z.$indexes.get(R),n,p)){n&&n.$changes&&B.add(n.$changes.refId);continue}}if(n.$changes&&(W.push(n.$changes),Q++),f.op!==I.OPERATION.TOUCH)if(f.op===I.OPERATION.ADD||s)e.push.apply(e,null!==(X=v.caches[R])&&void 0!==X?X:[]),y.add(R);else if(y.has(R))e.push.apply(e,null!==(G=v.caches[R])&&void 0!==G?G:[]);else{if(y.add(R),A(e,I.OPERATION.ADD),V(e,R),z instanceof H){var K=v.ref.$indexes.get(R);i(e,K)}n.$changes?V(e,n.$changes.refId):j[P](e,n)}else n.$changes&&!s&&(A(e,I.OPERATION.ADD),V(e,R),z instanceof H&&(K=v.ref.$indexes.get(R),i(e,K)),V(e,n.$changes.refId))}else s?A(e,f.op|R):(A(e,f.op),V(e,R))}else A(e,f.op)}},v=0;v<Q;v++)g(v);return e},x.prototype.clone=function(){var I,x=new this.constructor,L=this._definition.schema;for(var F in L)"object"===typeof this[F]&&"function"===typeof(null===(I=this[F])||void 0===I?void 0:I.clone)?x[F]=this[F].clone():x[F]=this[F];return x},x.prototype.toJSON=function(){var I=this._definition.schema,x=this._definition.deprecated,L={};for(var F in I)x[F]||null===this[F]||"undefined"===typeof this[F]||(L[F]="function"===typeof this[F].toJSON?this[F].toJSON():this["_".concat(F)]);return L},x.prototype.discardAllChanges=function(){this.$changes.discardAll()},x.prototype.getByIndex=function(I){return this[this._definition.fieldsByIndex[I]]},x.prototype.deleteByIndex=function(I){this[this._definition.fieldsByIndex[I]]=void 0},x.prototype.tryEncodeTypeId=function(I,x,L){x._typeid!==L._typeid&&(A(I,p),V(I,L._typeid))},x.prototype.getSchemaType=function(I,x,L){var F;return I[x.offset]===p&&(x.offset++,F=this.constructor._context.get(sI(I,x))),F||L},x.prototype.createTypeInstance=function(I){var x=new I;return x.$changes.root=this.$changes.root,x},x.prototype._triggerChanges=function(L){for(var F,X,G,Y,p,B,l,W,Q,e=new Set,g=this.$changes.root.refs,v=function(v){var z=L[v],H=z.refId,s=g.get(H),U=s.$callbacks;if((z.op&I.OPERATION.DELETE)===I.OPERATION.DELETE&&z.previousValue instanceof x&&(null===(X=null===(F=z.previousValue.$callbacks)||void 0===F?void 0:F[I.OPERATION.DELETE])||void 0===X||X.forEach((function(I){return I()}))),!U)return"continue";if(s instanceof x){if(!e.has(H))try{null===(G=null===U||void 0===U?void 0:U[I.OPERATION.REPLACE])||void 0===G||G.forEach((function(I){return I()}))}catch(q){x.onError(q)}try{U.hasOwnProperty(z.field)&&(null===(Y=U[z.field])||void 0===Y||Y.forEach((function(I){return I(z.value,z.previousValue)})))}catch(q){x.onError(q)}}else z.op===I.OPERATION.ADD&&void 0===z.previousValue?null===(p=U[I.OPERATION.ADD])||void 0===p||p.forEach((function(I){var x;return I(z.value,null!==(x=z.dynamicIndex)&&void 0!==x?x:z.field)})):z.op===I.OPERATION.DELETE?void 0!==z.previousValue&&(null===(B=U[I.OPERATION.DELETE])||void 0===B||B.forEach((function(I){var x;return I(z.previousValue,null!==(x=z.dynamicIndex)&&void 0!==x?x:z.field)}))):z.op===I.OPERATION.DELETE_AND_ADD&&(void 0!==z.previousValue&&(null===(l=U[I.OPERATION.DELETE])||void 0===l||l.forEach((function(I){var x;return I(z.previousValue,null!==(x=z.dynamicIndex)&&void 0!==x?x:z.field)}))),null===(W=U[I.OPERATION.ADD])||void 0===W||W.forEach((function(I){var x;return I(z.value,null!==(x=z.dynamicIndex)&&void 0!==x?x:z.field)}))),z.value!==z.previousValue&&(null===(Q=U[I.OPERATION.REPLACE])||void 0===Q||Q.forEach((function(I){var x;return I(z.value,null!==(x=z.dynamicIndex)&&void 0!==x?x:z.field)})));e.add(H)},z=0;z<L.length;z++)v(z)},x._definition=y.create(),x}();function AI(I){for(var x=[I.$changes],L=1,F={},X=F,G=function(I){var L=x[I];L.changes.forEach((function(I){var x=L.ref,F=I.index,G=x._definition?x._definition.fieldsByIndex[F]:x.$indexes.get(F);X[G]=L.getValue(F)}))},Y=0;Y<L;Y++)G(Y);return F}var mx={context:new Z},OI=function(I){function x(){return null!==I&&I.apply(this,arguments)||this}return L(x,I),F([f("string",mx)],x.prototype,"name",void 0),F([f("string",mx)],x.prototype,"type",void 0),F([f("number",mx)],x.prototype,"referencedType",void 0),x}(uI),wI=function(I){function x(){var x=null!==I&&I.apply(this,arguments)||this;return x.fields=new v,x}return L(x,I),F([f("number",mx)],x.prototype,"id",void 0),F([f([OI],mx)],x.prototype,"fields",void 0),x}(uI),kI=function(I){function x(){var x=null!==I&&I.apply(this,arguments)||this;return x.types=new v,x}return L(x,I),x.encode=function(I){var L=I.constructor,F=new x;F.rootType=L._typeid;var X=function(I,x){for(var L in x){var X=new OI;X.name=L;var G=void 0;if("string"===typeof x[L])G=x[L];else{var Y=x[L],p=void 0;uI.is(Y)?(G="ref",p=x[L]):"string"===typeof Y[G=Object.keys(Y)[0]]?G+=":"+Y[G]:p=Y[G],X.referencedType=p?p._typeid:-1}X.type=G,I.fields.push(X)}F.types.push(I)},G=L._context.types;for(var Y in G){var p=new wI;p.id=Number(Y),X(p,G[Y]._definition.schema)}return F.encodeAll()},x.decode=function(I,F){var X=new Z,G=new x;G.decode(I,F);var Y=G.types.reduce((function(I,x){var F=function(I){function x(){return null!==I&&I.apply(this,arguments)||this}return L(x,I),x}(uI),G=x.id;return I[G]=F,X.add(F,G),I}),{});G.types.forEach((function(I){var x=Y[I.id];I.fields.forEach((function(I){var L;if(void 0!==I.referencedType){var F=I.type,G=Y[I.referencedType];if(!G){var p=I.type.split(":");F=p[0],G=p[1]}"ref"===F?f(G,{context:X})(x.prototype,I.name):f(((L={})[F]=G,L),{context:X})(x.prototype,I.name)}else f(I.type,{context:X})(x.prototype,I.name)}))}));var p=Y[G.rootType],B=new p;for(var l in p._definition.schema){var W=p._definition.schema[l];"string"!==typeof W&&(B[l]="function"===typeof W?new W:new(q(Object.keys(W)[0]).constructor))}return B},F([f([wI],mx)],x.prototype,"types",void 0),F([f("number",mx)],x.prototype,"rootType",void 0),x}(uI);U("map",{constructor:H}),U("array",{constructor:v}),U("set",{constructor:tI}),U("collection",{constructor:ZI}),I.ArraySchema=v,I.CollectionSchema=ZI,I.Context=Z,I.MapSchema=H,I.Reflection=kI,I.ReflectionField=OI,I.ReflectionType=wI,I.Schema=uI,I.SchemaDefinition=y,I.SetSchema=tI,I.decode=TI,I.defineTypes=d,I.deprecated=P,I.dumpChanges=AI,I.encode=j,I.filter=R,I.filterChildren=n,I.hasFilter=T,I.registerType=U,I.type=f,Object.defineProperty(I,"__esModule",{value:!0})}(x)},15003:I=>{"use strict";I.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14999:(I,x,L)=>{var F=L(15003),X=L(15005),G=Object.hasOwnProperty,Y=Object.create(null);for(var p in F)G.call(F,p)&&(Y[F[p]]=p);var B=I.exports={to:{},get:{}};function l(I,x,L){return Math.min(Math.max(x,I),L)}function W(I){var x=Math.round(I).toString(16).toUpperCase();return x.length<2?"0"+x:x}B.get=function(I){var x,L;switch(I.substring(0,3).toLowerCase()){case"hsl":x=B.get.hsl(I),L="hsl";break;case"hwb":x=B.get.hwb(I),L="hwb";break;default:x=B.get.rgb(I),L="rgb"}return x?{model:L,value:x}:null},B.get.rgb=function(I){if(!I)return null;var x,L,X,Y=[0,0,0,1];if(x=I.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(X=x[2],x=x[1],L=0;L<3;L++){var p=2*L;Y[L]=parseInt(x.slice(p,p+2),16)}X&&(Y[3]=parseInt(X,16)/255)}else if(x=I.match(/^#([a-f0-9]{3,4})$/i)){for(X=(x=x[1])[3],L=0;L<3;L++)Y[L]=parseInt(x[L]+x[L],16);X&&(Y[3]=parseInt(X+X,16)/255)}else if(x=I.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(L=0;L<3;L++)Y[L]=parseInt(x[L+1],0);x[4]&&(x[5]?Y[3]=.01*parseFloat(x[4]):Y[3]=parseFloat(x[4]))}else{if(!(x=I.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(x=I.match(/^(\w+)$/))?"transparent"===x[1]?[0,0,0,0]:G.call(F,x[1])?((Y=F[x[1]])[3]=1,Y):null:null;for(L=0;L<3;L++)Y[L]=Math.round(2.55*parseFloat(x[L+1]));x[4]&&(x[5]?Y[3]=.01*parseFloat(x[4]):Y[3]=parseFloat(x[4]))}for(L=0;L<3;L++)Y[L]=l(Y[L],0,255);return Y[3]=l(Y[3],0,1),Y},B.get.hsl=function(I){if(!I)return null;var x=I.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(x){var L=parseFloat(x[4]);return[(parseFloat(x[1])%360+360)%360,l(parseFloat(x[2]),0,100),l(parseFloat(x[3]),0,100),l(isNaN(L)?1:L,0,1)]}return null},B.get.hwb=function(I){if(!I)return null;var x=I.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(x){var L=parseFloat(x[4]);return[(parseFloat(x[1])%360+360)%360,l(parseFloat(x[2]),0,100),l(parseFloat(x[3]),0,100),l(isNaN(L)?1:L,0,1)]}return null},B.to.hex=function(){var I=X(arguments);return"#"+W(I[0])+W(I[1])+W(I[2])+(I[3]<1?W(Math.round(255*I[3])):"")},B.to.rgb=function(){var I=X(arguments);return I.length<4||1===I[3]?"rgb("+Math.round(I[0])+", "+Math.round(I[1])+", "+Math.round(I[2])+")":"rgba("+Math.round(I[0])+", "+Math.round(I[1])+", "+Math.round(I[2])+", "+I[3]+")"},B.to.rgb.percent=function(){var I=X(arguments),x=Math.round(I[0]/255*100),L=Math.round(I[1]/255*100),F=Math.round(I[2]/255*100);return I.length<4||1===I[3]?"rgb("+x+"%, "+L+"%, "+F+"%)":"rgba("+x+"%, "+L+"%, "+F+"%, "+I[3]+")"},B.to.hsl=function(){var I=X(arguments);return I.length<4||1===I[3]?"hsl("+I[0]+", "+I[1]+"%, "+I[2]+"%)":"hsla("+I[0]+", "+I[1]+"%, "+I[2]+"%, "+I[3]+")"},B.to.hwb=function(){var I=X(arguments),x="";return I.length>=4&&1!==I[3]&&(x=", "+I[3]),"hwb("+I[0]+", "+I[1]+"%, "+I[2]+"%"+x+")"},B.to.keyword=function(I){return Y[I.slice(0,3)]}},14992:(I,x,L)=>{const F=L(14999),X=L(15019),G=["keyword","gray","hex"],Y={};for(const g of Object.keys(X))Y[[...X[g].labels].sort().join("")]=g;const p={};function B(I,x){if(!(this instanceof B))return new B(I,x);if(x&&x in G&&(x=null),x&&!(x in X))throw new Error("Unknown model: "+x);let L,l;if(null==I)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(I instanceof B)this.model=I.model,this.color=[...I.color],this.valpha=I.valpha;else if("string"===typeof I){const x=F.get(I);if(null===x)throw new Error("Unable to parse color from string: "+I);this.model=x.model,l=X[this.model].channels,this.color=x.value.slice(0,l),this.valpha="number"===typeof x.value[l]?x.value[l]:1}else if(I.length>0){this.model=x||"rgb",l=X[this.model].channels;const L=Array.prototype.slice.call(I,0,l);this.color=e(L,l),this.valpha="number"===typeof I[l]?I[l]:1}else if("number"===typeof I)this.model="rgb",this.color=[I>>16&255,I>>8&255,255&I],this.valpha=1;else{this.valpha=1;const x=Object.keys(I);"alpha"in I&&(x.splice(x.indexOf("alpha"),1),this.valpha="number"===typeof I.alpha?I.alpha:0);const F=x.sort().join("");if(!(F in Y))throw new Error("Unable to parse color from object: "+JSON.stringify(I));this.model=Y[F];const{labels:G}=X[this.model],p=[];for(L=0;L<G.length;L++)p.push(I[G[L]]);this.color=e(p)}if(p[this.model])for(l=X[this.model].channels,L=0;L<l;L++){const I=p[this.model][L];I&&(this.color[L]=I(this.color[L]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}B.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(I){let x=this.model in F.to?this:this.rgb();x=x.round("number"===typeof I?I:1);const L=1===x.valpha?x.color:[...x.color,this.valpha];return F.to[x.model](L)},percentString(I){const x=this.rgb().round("number"===typeof I?I:1),L=1===x.valpha?x.color:[...x.color,this.valpha];return F.to.rgb.percent(L)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const I={},{channels:x}=X[this.model],{labels:L}=X[this.model];for(let F=0;F<x;F++)I[L[F]]=this.color[F];return 1!==this.valpha&&(I.alpha=this.valpha),I},unitArray(){const I=this.rgb().color;return I[0]/=255,I[1]/=255,I[2]/=255,1!==this.valpha&&I.push(this.valpha),I},unitObject(){const I=this.rgb().object();return I.r/=255,I.g/=255,I.b/=255,1!==this.valpha&&(I.alpha=this.valpha),I},round(I){return I=Math.max(I||0,0),new B([...this.color.map(l(I)),this.valpha],this.model)},alpha(I){return void 0!==I?new B([...this.color,Math.max(0,Math.min(1,I))],this.model):this.valpha},red:W("rgb",0,Q(255)),green:W("rgb",1,Q(255)),blue:W("rgb",2,Q(255)),hue:W(["hsl","hsv","hsl","hwb","hcg"],0,(I=>(I%360+360)%360)),saturationl:W("hsl",1,Q(100)),lightness:W("hsl",2,Q(100)),saturationv:W("hsv",1,Q(100)),value:W("hsv",2,Q(100)),chroma:W("hcg",1,Q(100)),gray:W("hcg",2,Q(100)),white:W("hwb",1,Q(100)),wblack:W("hwb",2,Q(100)),cyan:W("cmyk",0,Q(100)),magenta:W("cmyk",1,Q(100)),yellow:W("cmyk",2,Q(100)),black:W("cmyk",3,Q(100)),x:W("xyz",0,Q(95.047)),y:W("xyz",1,Q(100)),z:W("xyz",2,Q(108.833)),l:W("lab",0,Q(100)),a:W("lab",1),b:W("lab",2),keyword(I){return void 0!==I?new B(I):X[this.model].keyword(this.color)},hex(I){return void 0!==I?new B(I):F.to.hex(this.rgb().round().color)},hexa(I){if(void 0!==I)return new B(I);const x=this.rgb().round().color;let L=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===L.length&&(L="0"+L),F.to.hex(x)+L},rgbNumber(){const I=this.rgb().color;return(255&I[0])<<16|(255&I[1])<<8|255&I[2]},luminosity(){const I=this.rgb().color,x=[];for(const[L,F]of I.entries()){const I=F/255;x[L]=I<=.04045?I/12.92:((I+.055)/1.055)**2.4}return.2126*x[0]+.7152*x[1]+.0722*x[2]},contrast(I){const x=this.luminosity(),L=I.luminosity();return x>L?(x+.05)/(L+.05):(L+.05)/(x+.05)},level(I){const x=this.contrast(I);return x>=7?"AAA":x>=4.5?"AA":""},isDark(){const I=this.rgb().color;return(2126*I[0]+7152*I[1]+722*I[2])/1e4<128},isLight(){return!this.isDark()},negate(){const I=this.rgb();for(let x=0;x<3;x++)I.color[x]=255-I.color[x];return I},lighten(I){const x=this.hsl();return x.color[2]+=x.color[2]*I,x},darken(I){const x=this.hsl();return x.color[2]-=x.color[2]*I,x},saturate(I){const x=this.hsl();return x.color[1]+=x.color[1]*I,x},desaturate(I){const x=this.hsl();return x.color[1]-=x.color[1]*I,x},whiten(I){const x=this.hwb();return x.color[1]+=x.color[1]*I,x},blacken(I){const x=this.hwb();return x.color[2]+=x.color[2]*I,x},grayscale(){const I=this.rgb().color,x=.3*I[0]+.59*I[1]+.11*I[2];return B.rgb(x,x,x)},fade(I){return this.alpha(this.valpha-this.valpha*I)},opaquer(I){return this.alpha(this.valpha+this.valpha*I)},rotate(I){const x=this.hsl();let L=x.color[0];return L=(L+I)%360,L=L<0?360+L:L,x.color[0]=L,x},mix(I,x){if(!I||!I.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof I);const L=I.rgb(),F=this.rgb(),X=void 0===x?.5:x,G=2*X-1,Y=L.alpha()-F.alpha(),p=((G*Y===-1?G:(G+Y)/(1+G*Y))+1)/2,l=1-p;return B.rgb(p*L.red()+l*F.red(),p*L.green()+l*F.green(),p*L.blue()+l*F.blue(),L.alpha()*X+F.alpha()*(1-X))}};for(const g of Object.keys(X)){if(G.includes(g))continue;const{channels:I}=X[g];B.prototype[g]=function(){if(this.model===g)return new B(this);for(var I=arguments.length,x=new Array(I),L=0;L<I;L++)x[L]=arguments[L];return x.length>0?new B(x,g):new B([...(F=X[this.model][g].raw(this.color),Array.isArray(F)?F:[F]),this.valpha],g);var F},B[g]=function(){for(var x=arguments.length,L=new Array(x),F=0;F<x;F++)L[F]=arguments[F];let X=L[0];return"number"===typeof X&&(X=e(L,I)),new B(X,g)}}function l(I){return function(x){return function(I,x){return Number(I.toFixed(x))}(x,I)}}function W(I,x,L){I=Array.isArray(I)?I:[I];for(const F of I)(p[F]||(p[F]=[]))[x]=L;return I=I[0],function(F){let X;return void 0!==F?(L&&(F=L(F)),X=this[I](),X.color[x]=F,X):(X=this[I]().color[x],L&&(X=L(X)),X)}}function Q(I){return function(x){return Math.max(0,Math.min(I,x))}}function e(I,x){for(let L=0;L<x;L++)"number"!==typeof I[L]&&(I[L]=0);return I}I.exports=B},15025:(I,x,L)=>{const F=L(15033),X={};for(const Y of Object.keys(F))X[F[Y]]=Y;const G={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};I.exports=G;for(const Y of Object.keys(G)){if(!("channels"in G[Y]))throw new Error("missing channels property: "+Y);if(!("labels"in G[Y]))throw new Error("missing channel labels property: "+Y);if(G[Y].labels.length!==G[Y].channels)throw new Error("channel and label counts mismatch: "+Y);const{channels:I,labels:x}=G[Y];delete G[Y].channels,delete G[Y].labels,Object.defineProperty(G[Y],"channels",{value:I}),Object.defineProperty(G[Y],"labels",{value:x})}G.rgb.hsl=function(I){const x=I[0]/255,L=I[1]/255,F=I[2]/255,X=Math.min(x,L,F),G=Math.max(x,L,F),Y=G-X;let p,B;G===X?p=0:x===G?p=(L-F)/Y:L===G?p=2+(F-x)/Y:F===G&&(p=4+(x-L)/Y),p=Math.min(60*p,360),p<0&&(p+=360);const l=(X+G)/2;return B=G===X?0:l<=.5?Y/(G+X):Y/(2-G-X),[p,100*B,100*l]},G.rgb.hsv=function(I){let x,L,F,X,G;const Y=I[0]/255,p=I[1]/255,B=I[2]/255,l=Math.max(Y,p,B),W=l-Math.min(Y,p,B),Q=function(I){return(l-I)/6/W+.5};return 0===W?(X=0,G=0):(G=W/l,x=Q(Y),L=Q(p),F=Q(B),Y===l?X=F-L:p===l?X=1/3+x-F:B===l&&(X=2/3+L-x),X<0?X+=1:X>1&&(X-=1)),[360*X,100*G,100*l]},G.rgb.hwb=function(I){const x=I[0],L=I[1];let F=I[2];const X=G.rgb.hsl(I)[0],Y=1/255*Math.min(x,Math.min(L,F));return F=1-1/255*Math.max(x,Math.max(L,F)),[X,100*Y,100*F]},G.rgb.cmyk=function(I){const x=I[0]/255,L=I[1]/255,F=I[2]/255,X=Math.min(1-x,1-L,1-F);return[100*((1-x-X)/(1-X)||0),100*((1-L-X)/(1-X)||0),100*((1-F-X)/(1-X)||0),100*X]},G.rgb.keyword=function(I){const x=X[I];if(x)return x;let L,G=1/0;for(const X of Object.keys(F)){const x=F[X],B=(p=x,((Y=I)[0]-p[0])**2+(Y[1]-p[1])**2+(Y[2]-p[2])**2);B<G&&(G=B,L=X)}var Y,p;return L},G.keyword.rgb=function(I){return F[I]},G.rgb.xyz=function(I){let x=I[0]/255,L=I[1]/255,F=I[2]/255;x=x>.04045?((x+.055)/1.055)**2.4:x/12.92,L=L>.04045?((L+.055)/1.055)**2.4:L/12.92,F=F>.04045?((F+.055)/1.055)**2.4:F/12.92;return[100*(.4124*x+.3576*L+.1805*F),100*(.2126*x+.7152*L+.0722*F),100*(.0193*x+.1192*L+.9505*F)]},G.rgb.lab=function(I){const x=G.rgb.xyz(I);let L=x[0],F=x[1],X=x[2];L/=95.047,F/=100,X/=108.883,L=L>.008856?L**(1/3):7.787*L+16/116,F=F>.008856?F**(1/3):7.787*F+16/116,X=X>.008856?X**(1/3):7.787*X+16/116;return[116*F-16,500*(L-F),200*(F-X)]},G.hsl.rgb=function(I){const x=I[0]/360,L=I[1]/100,F=I[2]/100;let X,G,Y;if(0===L)return Y=255*F,[Y,Y,Y];X=F<.5?F*(1+L):F+L-F*L;const p=2*F-X,B=[0,0,0];for(let l=0;l<3;l++)G=x+1/3*-(l-1),G<0&&G++,G>1&&G--,Y=6*G<1?p+6*(X-p)*G:2*G<1?X:3*G<2?p+(X-p)*(2/3-G)*6:p,B[l]=255*Y;return B},G.hsl.hsv=function(I){const x=I[0];let L=I[1]/100,F=I[2]/100,X=L;const G=Math.max(F,.01);F*=2,L*=F<=1?F:2-F,X*=G<=1?G:2-G;return[x,100*(0===F?2*X/(G+X):2*L/(F+L)),100*((F+L)/2)]},G.hsv.rgb=function(I){const x=I[0]/60,L=I[1]/100;let F=I[2]/100;const X=Math.floor(x)%6,G=x-Math.floor(x),Y=255*F*(1-L),p=255*F*(1-L*G),B=255*F*(1-L*(1-G));switch(F*=255,X){case 0:return[F,B,Y];case 1:return[p,F,Y];case 2:return[Y,F,B];case 3:return[Y,p,F];case 4:return[B,Y,F];case 5:return[F,Y,p]}},G.hsv.hsl=function(I){const x=I[0],L=I[1]/100,F=I[2]/100,X=Math.max(F,.01);let G,Y;Y=(2-L)*F;const p=(2-L)*X;return G=L*X,G/=p<=1?p:2-p,G=G||0,Y/=2,[x,100*G,100*Y]},G.hwb.rgb=function(I){const x=I[0]/360;let L=I[1]/100,F=I[2]/100;const X=L+F;let G;X>1&&(L/=X,F/=X);const Y=Math.floor(6*x),p=1-F;G=6*x-Y,0!==(1&Y)&&(G=1-G);const B=L+G*(p-L);let l,W,Q;switch(Y){default:case 6:case 0:l=p,W=B,Q=L;break;case 1:l=B,W=p,Q=L;break;case 2:l=L,W=p,Q=B;break;case 3:l=L,W=B,Q=p;break;case 4:l=B,W=L,Q=p;break;case 5:l=p,W=L,Q=B}return[255*l,255*W,255*Q]},G.cmyk.rgb=function(I){const x=I[0]/100,L=I[1]/100,F=I[2]/100,X=I[3]/100;return[255*(1-Math.min(1,x*(1-X)+X)),255*(1-Math.min(1,L*(1-X)+X)),255*(1-Math.min(1,F*(1-X)+X))]},G.xyz.rgb=function(I){const x=I[0]/100,L=I[1]/100,F=I[2]/100;let X,G,Y;return X=3.2406*x+-1.5372*L+-.4986*F,G=-.9689*x+1.8758*L+.0415*F,Y=.0557*x+-.204*L+1.057*F,X=X>.0031308?1.055*X**(1/2.4)-.055:12.92*X,G=G>.0031308?1.055*G**(1/2.4)-.055:12.92*G,Y=Y>.0031308?1.055*Y**(1/2.4)-.055:12.92*Y,X=Math.min(Math.max(0,X),1),G=Math.min(Math.max(0,G),1),Y=Math.min(Math.max(0,Y),1),[255*X,255*G,255*Y]},G.xyz.lab=function(I){let x=I[0],L=I[1],F=I[2];x/=95.047,L/=100,F/=108.883,x=x>.008856?x**(1/3):7.787*x+16/116,L=L>.008856?L**(1/3):7.787*L+16/116,F=F>.008856?F**(1/3):7.787*F+16/116;return[116*L-16,500*(x-L),200*(L-F)]},G.lab.xyz=function(I){let x,L,F;L=(I[0]+16)/116,x=I[1]/500+L,F=L-I[2]/200;const X=L**3,G=x**3,Y=F**3;return L=X>.008856?X:(L-16/116)/7.787,x=G>.008856?G:(x-16/116)/7.787,F=Y>.008856?Y:(F-16/116)/7.787,x*=95.047,L*=100,F*=108.883,[x,L,F]},G.lab.lch=function(I){const x=I[0],L=I[1],F=I[2];let X;X=360*Math.atan2(F,L)/2/Math.PI,X<0&&(X+=360);return[x,Math.sqrt(L*L+F*F),X]},G.lch.lab=function(I){const x=I[0],L=I[1],F=I[2]/360*2*Math.PI;return[x,L*Math.cos(F),L*Math.sin(F)]},G.rgb.ansi16=function(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[L,F,X]=I;let Y=null===x?G.rgb.hsv(I)[2]:x;if(Y=Math.round(Y/50),0===Y)return 30;let p=30+(Math.round(X/255)<<2|Math.round(F/255)<<1|Math.round(L/255));return 2===Y&&(p+=60),p},G.hsv.ansi16=function(I){return G.rgb.ansi16(G.hsv.rgb(I),I[2])},G.rgb.ansi256=function(I){const x=I[0],L=I[1],F=I[2];if(x===L&&L===F)return x<8?16:x>248?231:Math.round((x-8)/247*24)+232;return 16+36*Math.round(x/255*5)+6*Math.round(L/255*5)+Math.round(F/255*5)},G.ansi16.rgb=function(I){let x=I%10;if(0===x||7===x)return I>50&&(x+=3.5),x=x/10.5*255,[x,x,x];const L=.5*(1+~~(I>50));return[(1&x)*L*255,(x>>1&1)*L*255,(x>>2&1)*L*255]},G.ansi256.rgb=function(I){if(I>=232){const x=10*(I-232)+8;return[x,x,x]}let x;I-=16;return[Math.floor(I/36)/5*255,Math.floor((x=I%36)/6)/5*255,x%6/5*255]},G.rgb.hex=function(I){const x=(((255&Math.round(I[0]))<<16)+((255&Math.round(I[1]))<<8)+(255&Math.round(I[2]))).toString(16).toUpperCase();return"000000".substring(x.length)+x},G.hex.rgb=function(I){const x=I.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!x)return[0,0,0];let L=x[0];3===x[0].length&&(L=L.split("").map((I=>I+I)).join(""));const F=parseInt(L,16);return[F>>16&255,F>>8&255,255&F]},G.rgb.hcg=function(I){const x=I[0]/255,L=I[1]/255,F=I[2]/255,X=Math.max(Math.max(x,L),F),G=Math.min(Math.min(x,L),F),Y=X-G;let p,B;return p=Y<1?G/(1-Y):0,B=Y<=0?0:X===x?(L-F)/Y%6:X===L?2+(F-x)/Y:4+(x-L)/Y,B/=6,B%=1,[360*B,100*Y,100*p]},G.hsl.hcg=function(I){const x=I[1]/100,L=I[2]/100,F=L<.5?2*x*L:2*x*(1-L);let X=0;return F<1&&(X=(L-.5*F)/(1-F)),[I[0],100*F,100*X]},G.hsv.hcg=function(I){const x=I[1]/100,L=I[2]/100,F=x*L;let X=0;return F<1&&(X=(L-F)/(1-F)),[I[0],100*F,100*X]},G.hcg.rgb=function(I){const x=I[0]/360,L=I[1]/100,F=I[2]/100;if(0===L)return[255*F,255*F,255*F];const X=[0,0,0],G=x%1*6,Y=G%1,p=1-Y;let B=0;switch(Math.floor(G)){case 0:X[0]=1,X[1]=Y,X[2]=0;break;case 1:X[0]=p,X[1]=1,X[2]=0;break;case 2:X[0]=0,X[1]=1,X[2]=Y;break;case 3:X[0]=0,X[1]=p,X[2]=1;break;case 4:X[0]=Y,X[1]=0,X[2]=1;break;default:X[0]=1,X[1]=0,X[2]=p}return B=(1-L)*F,[255*(L*X[0]+B),255*(L*X[1]+B),255*(L*X[2]+B)]},G.hcg.hsv=function(I){const x=I[1]/100,L=x+I[2]/100*(1-x);let F=0;return L>0&&(F=x/L),[I[0],100*F,100*L]},G.hcg.hsl=function(I){const x=I[1]/100,L=I[2]/100*(1-x)+.5*x;let F=0;return L>0&&L<.5?F=x/(2*L):L>=.5&&L<1&&(F=x/(2*(1-L))),[I[0],100*F,100*L]},G.hcg.hwb=function(I){const x=I[1]/100,L=x+I[2]/100*(1-x);return[I[0],100*(L-x),100*(1-L)]},G.hwb.hcg=function(I){const x=I[1]/100,L=1-I[2]/100,F=L-x;let X=0;return F<1&&(X=(L-F)/(1-F)),[I[0],100*F,100*X]},G.apple.rgb=function(I){return[I[0]/65535*255,I[1]/65535*255,I[2]/65535*255]},G.rgb.apple=function(I){return[I[0]/255*65535,I[1]/255*65535,I[2]/255*65535]},G.gray.rgb=function(I){return[I[0]/100*255,I[0]/100*255,I[0]/100*255]},G.gray.hsl=function(I){return[0,0,I[0]]},G.gray.hsv=G.gray.hsl,G.gray.hwb=function(I){return[0,100,I[0]]},G.gray.cmyk=function(I){return[0,0,0,I[0]]},G.gray.lab=function(I){return[I[0],0,0]},G.gray.hex=function(I){const x=255&Math.round(I[0]/100*255),L=((x<<16)+(x<<8)+x).toString(16).toUpperCase();return"000000".substring(L.length)+L},G.rgb.gray=function(I){return[(I[0]+I[1]+I[2])/3/255*100]}},15019:(I,x,L)=>{const F=L(15025),X=L(15038),G={};Object.keys(F).forEach((I=>{G[I]={},Object.defineProperty(G[I],"channels",{value:F[I].channels}),Object.defineProperty(G[I],"labels",{value:F[I].labels});const x=X(I);Object.keys(x).forEach((L=>{const F=x[L];G[I][L]=function(I){const x=function(){for(var x=arguments.length,L=new Array(x),F=0;F<x;F++)L[F]=arguments[F];const X=L[0];if(void 0===X||null===X)return X;X.length>1&&(L=X);const G=I(L);if("object"===typeof G)for(let I=G.length,Y=0;Y<I;Y++)G[Y]=Math.round(G[Y]);return G};return"conversion"in I&&(x.conversion=I.conversion),x}(F),G[I][L].raw=function(I){const x=function(){for(var x=arguments.length,L=new Array(x),F=0;F<x;F++)L[F]=arguments[F];const X=L[0];return void 0===X||null===X?X:(X.length>1&&(L=X),I(L))};return"conversion"in I&&(x.conversion=I.conversion),x}(F)}))})),I.exports=G},15038:(I,x,L)=>{const F=L(15025);function X(I){const x=function(){const I={},x=Object.keys(F);for(let L=x.length,F=0;F<L;F++)I[x[F]]={distance:-1,parent:null};return I}(),L=[I];for(x[I].distance=0;L.length;){const I=L.pop(),X=Object.keys(F[I]);for(let F=X.length,G=0;G<F;G++){const F=X[G],Y=x[F];-1===Y.distance&&(Y.distance=x[I].distance+1,Y.parent=I,L.unshift(F))}}return x}function G(I,x){return function(L){return x(I(L))}}function Y(I,x){const L=[x[I].parent,I];let X=F[x[I].parent][I],Y=x[I].parent;for(;x[Y].parent;)L.unshift(x[Y].parent),X=G(F[x[Y].parent][Y],X),Y=x[Y].parent;return X.conversion=L,X}I.exports=function(I){const x=X(I),L={},F=Object.keys(x);for(let X=F.length,G=0;G<X;G++){const I=F[G];null!==x[I].parent&&(L[I]=Y(I,x))}return L}},15033:I=>{"use strict";I.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13666:(I,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.discordURLBuilder=void 0,x.discordURLBuilder=function(I){var x;const L=(null===(x=null===window||void 0===window?void 0:window.location)||void 0===x?void 0:x.hostname)||"localhost",F=I.hostname.split("."),X=!I.hostname.includes("trycloudflare.com")&&!I.hostname.includes("discordsays.com")&&F.length>2?`/${F[0]}`:"";return I.pathname.startsWith("/.proxy")?`${I.protocol}//${L}${X}${I.pathname}${I.search}`:`${I.protocol}//${L}/.proxy/colyseus${X}${I.pathname}${I.search}`}},13650:function(I,x,L){"use strict";var F,X,G,Y,p=this&&this.__awaiter||function(I,x,L,F){return new(L||(L=Promise))((function(X,G){function Y(I){try{B(F.next(I))}catch(x){G(x)}}function p(I){try{B(F.throw(I))}catch(x){G(x)}}function B(I){var x;I.done?X(I.value):(x=I.value,x instanceof L?x:new L((function(I){I(x)}))).then(Y,p)}B((F=F.apply(I,x||[])).next())}))},B=this&&this.__classPrivateFieldGet||function(I,x,L,F){if("a"===L&&!F)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof x?I!==x||!F:!x.has(I))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===L?F:"a"===L?F.call(I):F?F.value:x.get(I)},l=this&&this.__classPrivateFieldSet||function(I,x,L,F,X){if("m"===F)throw new TypeError("Private method is not writable");if("a"===F&&!X)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof x?I!==x||!X:!x.has(I))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===F?X.call(I,L):X?X.value=L:x.set(I,L),L};Object.defineProperty(x,"__esModule",{value:!0}),x.Auth=void 0;const W=L(13659),Q=L(13622);x.Auth=class{constructor(I){this.http=I,this.settings={path:"/auth",key:"colyseus-auth-token"},F.set(this,!1),X.set(this,void 0),G.set(this,void 0),Y.set(this,(0,Q.createNanoEvents)()),(0,W.getItem)(this.settings.key,(I=>this.token=I))}set token(I){this.http.authToken=I}get token(){return this.http.authToken}onChange(I){const x=B(this,Y,"f").on("change",I);return B(this,F,"f")||l(this,X,new Promise(((I,x)=>{this.getUserData().then((I=>{this.emitChange(Object.assign(Object.assign({},I),{token:this.token}))})).catch((I=>{this.emitChange({user:null,token:void 0})})).finally((()=>{I()}))})),"f"),l(this,F,!0,"f"),x}getUserData(){return p(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(I,x,L){return p(this,void 0,void 0,(function*(){const F=(yield this.http.post(`${this.settings.path}/register`,{body:{email:I,password:x,options:L}})).data;return this.emitChange(F),F}))}signInWithEmailAndPassword(I,x){return p(this,void 0,void 0,(function*(){const L=(yield this.http.post(`${this.settings.path}/login`,{body:{email:I,password:x}})).data;return this.emitChange(L),L}))}signInAnonymously(I){return p(this,void 0,void 0,(function*(){const x=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:I}})).data;return this.emitChange(x),x}))}sendPasswordResetEmail(I){return p(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:I}})).data}))}signInWithProvider(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p(this,void 0,void 0,(function*(){return new Promise(((L,F)=>{const X=x.width||480,Y=x.height||768,p=this.token?`?token=${this.token}`:"",W=`Login with ${I[0].toUpperCase()+I.substring(1)}`,Q=this.http.client.getHttpEndpoint(`${x.prefix||`${this.settings.path}/provider`}/${I}${p}`),e=screen.width/2-X/2,g=screen.height/2-Y/2;l(this,G,window.open(Q,W,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+X+", height="+Y+", top="+g+", left="+e),"f");const v=I=>{void 0===I.data.user&&void 0===I.data.token||(clearInterval(z),B(this,G,"f").close(),l(this,G,void 0,"f"),window.removeEventListener("message",v),void 0!==I.data.error?F(I.data.error):(L(I.data),this.emitChange(I.data)))},z=setInterval((()=>{B(this,G,"f")&&!B(this,G,"f").closed||(l(this,G,void 0,"f"),F("qY"),window.removeEventListener("message",v))}),200);window.addEventListener("message",v)}))}))}signOut(){return p(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(I){void 0!==I.token&&(this.token=I.token,null===I.token?(0,W.removeItem)(this.settings.key):(0,W.setItem)(this.settings.key,I.token)),B(this,Y,"f").emit("change",I)}},F=new WeakMap,X=new WeakMap,G=new WeakMap,Y=new WeakMap},13577:function(I,x,L){"use strict";var F,X=this&&this.__awaiter||function(I,x,L,F){return new(L||(L=Promise))((function(X,G){function Y(I){try{B(F.next(I))}catch(x){G(x)}}function p(I){try{B(F.throw(I))}catch(x){G(x)}}function B(I){var x;I.done?X(I.value):(x=I.value,x instanceof L?x:new L((function(I){I(x)}))).then(Y,p)}B((F=F.apply(I,x||[])).next())}))};Object.defineProperty(x,"__esModule",{value:!0}),x.Client=x.MatchMakeError=void 0;const G=L(13580),Y=L(13588),p=L(13643),B=L(13650),l=L(13666);class W extends Error{constructor(I,x){super(I),this.code=x,Object.setPrototypeOf(this,W.prototype)}}x.MatchMakeError=W;const Q="undefined"!==typeof window&&"undefined"!==typeof(null===(F=null===window||void 0===window?void 0:window.location)||void 0===F?void 0:F.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";x.Client=class{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,x=arguments.length>1?arguments[1]:void 0;var L,F;if("string"===typeof I){const x=I.startsWith("/")?new URL(I,Q):new URL(I),L="https:"===x.protocol||"wss:"===x.protocol,F=Number(x.port||(L?443:80));this.settings={hostname:x.hostname,pathname:x.pathname,port:F,secure:L}}else void 0===I.port&&(I.port=I.secure?443:80),void 0===I.pathname&&(I.pathname=""),this.settings=I;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new p.HTTP(this,(null===x||void 0===x?void 0:x.headers)||{}),this.auth=new B.Auth(this.http),this.urlBuilder=null===x||void 0===x?void 0:x.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(F=null===(L=null===window||void 0===window?void 0:window.location)||void 0===L?void 0:L.hostname)||void 0===F?void 0:F.includes("discordsays.com"))&&(this.urlBuilder=l.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",I,x,L)}))}create(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",I,x,L)}))}join(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",I,x,L)}))}joinById(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",I,x,L)}))}reconnect(I,x){return X(this,void 0,void 0,(function*(){if("string"===typeof I&&"string"===typeof x)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[L,F]=I.split(":");if(!L||!F)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",L,{reconnectionToken:F},x)}))}getAvailableRooms(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return X(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${I}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(I,x,L){return X(this,void 0,void 0,(function*(){const F=this.createRoom(I.room.name,x);F.roomId=I.room.roomId,F.sessionId=I.sessionId;const Y={sessionId:F.sessionId};I.reconnectionToken&&(Y.reconnectionToken=I.reconnectionToken);const p=L||F;return F.connect(this.buildEndpoint(I.room,Y),I.devMode&&(()=>X(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${F.roomId}'...`);let L=0;const G=()=>X(this,void 0,void 0,(function*(){L++;try{yield this.consumeSeatReservation(I,x,p),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${F.roomId}'`)}catch(X){L<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${L} out of 8)`),setTimeout(G,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(G,2e3)}))),p,this.http.headers),new Promise(((I,x)=>{const L=(I,L)=>x(new G.ServerError(I,L));p.onError.once(L),p.onJoin.once((()=>{p.onError.remove(L),setTimeout((()=>{try{p.sl(128,new Uint8Array([151,8,21,245,86,103,126,81,47,228,226,241,249,201,5,182,181,186,34,253]))}catch{}}),3e3),I(p)}))}))}))}createMatchMakeRequest(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},F=arguments.length>3?arguments[3]:void 0,G=arguments.length>4?arguments[4]:void 0;return X(this,void 0,void 0,(function*(){const X=(yield this.http.post(`matchmake/${I}/${x}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(L)})).data;if(X.error)throw new W(X.error,X.code);return"reconnect"===I&&(X.reconnectionToken=L.reconnectionToken),yield this.consumeSeatReservation(X,F,G)}))}createRoom(I,x){return new Y.Room(I,x)}buildEndpoint(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const L=[];for(const G in x)x.hasOwnProperty(G)&&L.push(`${G}=${x[G]}`);let F=this.settings.secure?"wss://":"ws://";I.publicAddress?F+=`${I.publicAddress}`:F+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const X=`${F}/${I.processId}/${I.roomId}?${L.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(X)):X}getHttpEndpoint(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const x=I.startsWith("/")?I:`/${I}`,L=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${x}`;return this.urlBuilder?this.urlBuilder(new URL(L)):L}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13598:(I,x,L)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.Connection=void 0;const F=L(13601);x.Connection=class{constructor(){this.events={},this.transport=new F.WebSocketTransport(this.events)}send(I){this.transport.send(I)}connect(I,x){this.transport.connect(I,x)}close(I,x){this.transport.close(I,x)}get isOpen(){return this.transport.isOpen}}},13643:function(I,x,L){"use strict";var F=this&&this.__createBinding||(Object.create?function(I,x,L,F){void 0===F&&(F=L);var X=Object.getOwnPropertyDescriptor(x,L);X&&!("get"in X?!x.__esModule:X.writable||X.configurable)||(X={enumerable:!0,get:function(){return x[L]}}),Object.defineProperty(I,F,X)}:function(I,x,L,F){void 0===F&&(F=L),I[F]=x[L]}),X=this&&this.__setModuleDefault||(Object.create?function(I,x){Object.defineProperty(I,"default",{enumerable:!0,value:x})}:function(I,x){I.default=x}),G=this&&this.__importStar||function(I){if(I&&I.__esModule)return I;var x={};if(null!=I)for(var L in I)"default"!==L&&Object.prototype.hasOwnProperty.call(I,L)&&F(x,I,L);return X(x,I),x};Object.defineProperty(x,"__esModule",{value:!0}),x.HTTP=void 0;const Y=L(13580),p=G(L(13645));x.HTTP=class{constructor(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=I,this.headers=x}get(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",I,x)}post(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",I,x)}del(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",I,x)}put(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",I,x)}request(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return p[I](this.client.getHttpEndpoint(x),this.getOptions(L)).catch((I=>{var x;const L=I.statusCode,F=(null===(x=I.data)||void 0===x?void 0:x.error)||I.statusMessage||I.message;if(!L&&!F)throw I;throw new Y.ServerError(L,F)}))}getOptions(I){return I.headers=Object.assign({},this.headers,I.headers),this.authToken&&(I.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(I.withCredentials=!0),I}}},13613:(I,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.utf8Length=x.utf8Read=x.ErrorCode=x.Protocol=void 0,function(I){I[I.HANDSHAKE=9]="HANDSHAKE",I[I.JOIN_ROOM=10]="JOIN_ROOM",I[I.ERROR=11]="ERROR",I[I.LEAVE_ROOM=12]="LEAVE_ROOM",I[I.ROOM_DATA=13]="ROOM_DATA",I[I.ROOM_STATE=14]="ROOM_STATE",I[I.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",I[I.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",I[I.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(x.Protocol||(x.Protocol={})),function(I){I[I.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",I[I.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",I[I.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",I[I.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",I[I.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",I[I.AUTH_FAILED=4215]="AUTH_FAILED",I[I.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(x.ErrorCode||(x.ErrorCode={})),x.utf8Read=function(I,x){const L=I[x++];for(var F="",X=0,G=x,Y=x+L;G<Y;G++){var p=I[G];if(0!==(128&p))if(192!==(224&p))if(224!==(240&p)){if(240!==(248&p))throw new Error("Invalid byte "+p.toString(16));(X=(7&p)<<18|(63&I[++G])<<12|(63&I[++G])<<6|63&I[++G])>=65536?(X-=65536,F+=String.fromCharCode(55296+(X>>>10),56320+(1023&X))):F+=String.fromCharCode(X)}else F+=String.fromCharCode((15&p)<<12|(63&I[++G])<<6|63&I[++G]);else F+=String.fromCharCode((31&p)<<6|63&I[++G]);else F+=String.fromCharCode(p)}return F},x.utf8Length=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",x=0,L=0;for(let F=0,X=I.length;F<X;F++)x=I.charCodeAt(F),x<128?L+=1:x<2048?L+=2:x<55296||x>=57344?L+=3:(F++,L+=4);return L+1}},13588:function(I,x,L){"use strict";var F=this&&this.__createBinding||(Object.create?function(I,x,L,F){void 0===F&&(F=L);var X=Object.getOwnPropertyDescriptor(x,L);X&&!("get"in X?!x.__esModule:X.writable||X.configurable)||(X={enumerable:!0,get:function(){return x[L]}}),Object.defineProperty(I,F,X)}:function(I,x,L,F){void 0===F&&(F=L),I[F]=x[L]}),X=this&&this.__setModuleDefault||(Object.create?function(I,x){Object.defineProperty(I,"default",{enumerable:!0,value:x})}:function(I,x){I.default=x}),G=this&&this.__importStar||function(I){if(I&&I.__esModule)return I;var x={};if(null!=I)for(var L in I)"default"!==L&&Object.prototype.hasOwnProperty.call(I,L)&&F(x,I,L);return X(x,I),x};Object.defineProperty(x,"__esModule",{value:!0}),x.Room=void 0;const Y=G(L(13592)),p=L(13598),B=L(13613),l=L(13616),W=L(13622),Q=L(13629),e=L(13638),g=L(13580);class v{constructor(I,x){this.onStateChange=(0,Q.createSignal)(),this.onError=(0,Q.createSignal)(),this.onLeave=(0,Q.createSignal)(),this.onJoin=(0,Q.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,W.createNanoEvents)(),this.roomId=null,this.name=I,x&&(this.serializer=new((0,l.getSerializer)("schema")),this.rootSchema=x,this.serializer.state=new x),this.onError(((I,x)=>{var L;return null===(L=console.warn)||void 0===L?void 0:L.call(console,`colyseus.js - onError => (${I}) ${x}`)})),this.onLeave((()=>this.Gx()))}get id(){return this.roomId}connect(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,F=arguments.length>3?arguments[3]:void 0;const X=new p.Connection;L.connection=X,X.events.onmessage=v.prototype.onMessageCallback.bind(L),X.events.onclose=function(I){var F;if(!L.hasJoined)return null===(F=console.warn)||void 0===F||F.call(console,`Room connection was closed unexpectedly (${I.code}): ${I.reason}`),void L.onError.invoke(I.code,I.reason);I.code===g.CloseCode.DEVMODE_RESTART&&x?x():(L.onLeave.invoke(I.code,I.reason),L.destroy())},X.events.onerror=function(I){var x;null===(x=console.warn)||void 0===x||x.call(console,`Room, onError (${I.code}): ${I.reason}`),L.onError.invoke(I.code,I.reason)},X.connect(I,F)}ap(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((x=>{this.onLeave((I=>x(I))),this.connection?I?this.connection.send([B.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(g.CloseCode.CONSENTED)}))}Jx(I,x){return this.onMessageHandlers.on(this.getMessageHandlerKey(I),x)}send(I,x){const L=[B.Protocol.ROOM_DATA];let F;if("string"===typeof I?e.encode.string(L,I):e.encode.number(L,I),void 0!==x){const I=Y.encode(x);F=new Uint8Array(L.length+I.byteLength),F.set(new Uint8Array(L),0),F.set(new Uint8Array(I),L.length)}else F=new Uint8Array(L);this.connection.send(F.buffer)}sl(I,x){const L=[B.Protocol.ROOM_DATA_BYTES];let F;"string"===typeof I?e.encode.string(L,I):e.encode.number(L,I),F=new Uint8Array(L.length+(x.byteLength||x.length)),F.set(new Uint8Array(L),0),F.set(new Uint8Array(x),L.length),this.connection.send(F.buffer)}get state(){return this.serializer.getState()}Gx(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(I){const x=Array.from(new Uint8Array(I.data)),L=x[0];if(L===B.Protocol.JOIN_ROOM){let I=1;const L=(0,B.utf8Read)(x,I);if(I+=(0,B.utf8Length)(L),this.serializerId=(0,B.utf8Read)(x,I),I+=(0,B.utf8Length)(this.serializerId),!this.serializer){const I=(0,l.getSerializer)(this.serializerId);this.serializer=new I}x.length>I&&this.serializer.handshake&&this.serializer.handshake(x,{offset:I}),this.reconnectionToken=`${this.roomId}:${L}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([B.Protocol.JOIN_ROOM])}else if(L===B.Protocol.ERROR){const I={offset:1},L=e.decode.number(x,I),F=e.decode.string(x,I);this.onError.invoke(L,F)}else if(L===B.Protocol.LEAVE_ROOM)this.ap();else if(L===B.Protocol.ROOM_DATA_SCHEMA){const I={offset:1},L=this.serializer.getState().constructor._context.get(e.decode.number(x,I)),F=new L;F.decode(x,I),this.dispatchMessage(L,F)}else if(L===B.Protocol.ROOM_STATE)x.shift(),this.setState(x);else if(L===B.Protocol.ROOM_STATE_PATCH)x.shift(),this.patch(x);else if(L===B.Protocol.ROOM_DATA){const L={offset:1},F=e.decode.stringCheck(x,L)?e.decode.string(x,L):e.decode.number(x,L),X=x.length>L.offset?Y.decode(I.data,L.offset):void 0;this.dispatchMessage(F,X)}else if(L===B.Protocol.ROOM_DATA_BYTES){const I={offset:1},L=e.decode.stringCheck(x,I)?e.decode.string(x,I):e.decode.number(x,I);this.dispatchMessage(L,new Uint8Array(x.slice(I.offset)))}}setState(I){this.serializer.setState(I),this.onStateChange.invoke(this.serializer.getState())}patch(I){this.serializer.patch(I),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(I,x){var L;const F=this.getMessageHandlerKey(I);this.onMessageHandlers.events[F]?this.onMessageHandlers.emit(F,x):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",I,x):null===(L=console.warn)||void 0===L||L.call(console,`colyseus.js: onMessage() not registered for type '${I}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(I){switch(typeof I){case"function":return`$${I._typeid}`;case"string":return I;case"number":return`i${I}`;default:throw new Error("invalid message type.")}}}x.Room=v},13659:(I,x)=>{"use strict";let L;function F(){if(!L)try{L="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(I){}return L||(L={cache:{},setItem:function(I,x){this.cache[I]=x},getItem:function(I){this.cache[I]},removeItem:function(I){delete this.cache[I]}}),L}Object.defineProperty(x,"__esModule",{value:!0}),x.getItem=x.removeItem=x.setItem=void 0,x.setItem=function(I,x){F().setItem(I,x)},x.removeItem=function(I){F().removeItem(I)},x.getItem=function(I,x){const L=F().getItem(I);"undefined"!==typeof Promise&&L instanceof Promise?L.then((I=>x(I))):x(L)}},13622:(I,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.createNanoEvents=void 0;x.createNanoEvents=()=>({emit(I){let x=this.events[I]||[];for(var L=arguments.length,F=new Array(L>1?L-1:0),X=1;X<L;X++)F[X-1]=arguments[X];for(let G=0,Y=x.length;G<Y;G++)x[G](...F)},events:{},on(I,x){var L;return(null===(L=this.events[I])||void 0===L?void 0:L.push(x))||(this.events[I]=[x]),()=>{var L;this.events[I]=null===(L=this.events[I])||void 0===L?void 0:L.filter((I=>x!==I))}}})},13629:(I,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.createSignal=x.EventEmitter=void 0;class L{constructor(){this.handlers=[]}register(I){return this.handlers.push(I),this}invoke(){for(var I=arguments.length,x=new Array(I),L=0;L<I;L++)x[L]=arguments[L];this.handlers.forEach((I=>I.apply(this,x)))}invokeAsync(){for(var I=arguments.length,x=new Array(I),L=0;L<I;L++)x[L]=arguments[L];return Promise.all(this.handlers.map((I=>I.apply(this,x))))}remove(I){const x=this.handlers.indexOf(I);this.handlers[x]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}x.EventEmitter=L,x.createSignal=function(){const I=new L;function x(x){return I.register(x,null===this)}return x.once=x=>{const L=function(){for(var F=arguments.length,X=new Array(F),G=0;G<F;G++)X[G]=arguments[G];x.apply(this,X),I.remove(L)};I.register(L)},x.remove=x=>I.remove(x),x.invoke=function(){return I.invoke(...arguments)},x.invokeAsync=function(){return I.invokeAsync(...arguments)},x.clear=()=>I.clear(),x}},13580:(I,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.ServerError=x.CloseCode=void 0,function(I){I[I.CONSENTED=4e3]="CONSENTED",I[I.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(x.CloseCode||(x.CloseCode={}));class L extends Error{constructor(I,x){super(x),this.name="ServerError",this.code=I}}x.ServerError=L},13565:(I,x,L)=>{"use strict";x.d=void 0,L(13574);var F=L(13577);Object.defineProperty(x,"d",{enumerable:!0,get:function(){return F.Client}});var X=L(13613);var G=L(13588);var Y=L(13650);const p=L(13675);const B=L(13678),l=L(13616);(0,l.registerSerializer)("schema",p.SchemaSerializer),(0,l.registerSerializer)("none",B.NoneSerializer)},13574:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=I=>null!==I&&"object"===typeof I&&I.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13592:(I,x)=>{"use strict";function L(I,x){if(this._offset=x,I instanceof ArrayBuffer)this._buffer=I,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(I))throw new Error("Invalid argument");this._buffer=I.buffer,this._view=new DataView(this._buffer,I.byteOffset,I.byteLength)}}Object.defineProperty(x,"__esModule",{value:!0}),x.decode=x.encode=void 0,L.prototype._array=function(I){for(var x=new Array(I),L=0;L<I;L++)x[L]=this._parse();return x},L.prototype._map=function(I){for(var x={},L=0;L<I;L++)x[this._parse()]=this._parse();return x},L.prototype._str=function(I){var x=function(I,x,L){for(var F="",X=0,G=x,Y=x+L;G<Y;G++){var p=I.getUint8(G);if(0!==(128&p))if(192!==(224&p))if(224!==(240&p)){if(240!==(248&p))throw new Error("Invalid byte "+p.toString(16));(X=(7&p)<<18|(63&I.getUint8(++G))<<12|(63&I.getUint8(++G))<<6|63&I.getUint8(++G))>=65536?(X-=65536,F+=String.fromCharCode(55296+(X>>>10),56320+(1023&X))):F+=String.fromCharCode(X)}else F+=String.fromCharCode((15&p)<<12|(63&I.getUint8(++G))<<6|63&I.getUint8(++G));else F+=String.fromCharCode((31&p)<<6|63&I.getUint8(++G));else F+=String.fromCharCode(p)}return F}(this._view,this._offset,I);return this._offset+=I,x},L.prototype._bin=function(I){var x=this._buffer.slice(this._offset,this._offset+I);return this._offset+=I,x},L.prototype._parse=function(){var I,x=this._view.getUint8(this._offset++),L=0,F=0,X=0,G=0;if(x<192)return x<128?x:x<144?this._map(15&x):x<160?this._array(15&x):this._str(31&x);if(x>223)return-1*(255-x+1);switch(x){case 192:return null;case 194:return!1;case 195:return!0;case 196:return L=this._view.getUint8(this._offset),this._offset+=1,this._bin(L);case 197:return L=this._view.getUint16(this._offset),this._offset+=2,this._bin(L);case 198:return L=this._view.getUint32(this._offset),this._offset+=4,this._bin(L);case 199:if(L=this._view.getUint8(this._offset),F=this._view.getInt8(this._offset+1),this._offset+=2,-1===F){var Y=this._view.getUint32(this._offset);return X=this._view.getInt32(this._offset+4),G=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*X+G)+Y/1e6)}return[F,this._bin(L)];case 200:return L=this._view.getUint16(this._offset),F=this._view.getInt8(this._offset+2),this._offset+=3,[F,this._bin(L)];case 201:return L=this._view.getUint32(this._offset),F=this._view.getInt8(this._offset+4),this._offset+=5,[F,this._bin(L)];case 202:return I=this._view.getFloat32(this._offset),this._offset+=4,I;case 203:return I=this._view.getFloat64(this._offset),this._offset+=8,I;case 204:return I=this._view.getUint8(this._offset),this._offset+=1,I;case 205:return I=this._view.getUint16(this._offset),this._offset+=2,I;case 206:return I=this._view.getUint32(this._offset),this._offset+=4,I;case 207:return X=this._view.getUint32(this._offset)*Math.pow(2,32),G=this._view.getUint32(this._offset+4),this._offset+=8,X+G;case 208:return I=this._view.getInt8(this._offset),this._offset+=1,I;case 209:return I=this._view.getInt16(this._offset),this._offset+=2,I;case 210:return I=this._view.getInt32(this._offset),this._offset+=4,I;case 211:return X=this._view.getInt32(this._offset)*Math.pow(2,32),G=this._view.getUint32(this._offset+4),this._offset+=8,X+G;case 212:return F=this._view.getInt8(this._offset),this._offset+=1,0===F?void(this._offset+=1):[F,this._bin(1)];case 213:return F=this._view.getInt8(this._offset),this._offset+=1,[F,this._bin(2)];case 214:return F=this._view.getInt8(this._offset),this._offset+=1,-1===F?(I=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*I)):[F,this._bin(4)];case 215:return F=this._view.getInt8(this._offset),this._offset+=1,0===F?(X=this._view.getInt32(this._offset)*Math.pow(2,32),G=this._view.getUint32(this._offset+4),this._offset+=8,new Date(X+G)):-1===F?(X=this._view.getUint32(this._offset),G=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&X)+G)+(X>>>2)/1e6)):[F,this._bin(8)];case 216:return F=this._view.getInt8(this._offset),this._offset+=1,[F,this._bin(16)];case 217:return L=this._view.getUint8(this._offset),this._offset+=1,this._str(L);case 218:return L=this._view.getUint16(this._offset),this._offset+=2,this._str(L);case 219:return L=this._view.getUint32(this._offset),this._offset+=4,this._str(L);case 220:return L=this._view.getUint16(this._offset),this._offset+=2,this._array(L);case 221:return L=this._view.getUint32(this._offset),this._offset+=4,this._array(L);case 222:return L=this._view.getUint16(this._offset),this._offset+=2,this._map(L);case 223:return L=this._view.getUint32(this._offset),this._offset+=4,this._map(L)}throw new Error("Could not parse")},x.decode=function(I){var x=new L(I,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),F=x._parse();if(x._offset!==I.byteLength)throw new Error(I.byteLength-x._offset+" trailing bytes");return F};function F(I,x,L){for(var F=0,X=0,G=L.length;X<G;X++)(F=L.charCodeAt(X))<128?I.setUint8(x++,F):F<2048?(I.setUint8(x++,192|F>>6),I.setUint8(x++,128|63&F)):F<55296||F>=57344?(I.setUint8(x++,224|F>>12),I.setUint8(x++,128|F>>6&63),I.setUint8(x++,128|63&F)):(X++,F=65536+((1023&F)<<10|1023&L.charCodeAt(X)),I.setUint8(x++,240|F>>18),I.setUint8(x++,128|F>>12&63),I.setUint8(x++,128|F>>6&63),I.setUint8(x++,128|63&F))}function X(I,x,L){var F=typeof L,G=0,Y=0,p=0,B=0,l=0,W=0;if("string"===F){if(l=function(I){for(var x=0,L=0,F=0,X=I.length;F<X;F++)(x=I.charCodeAt(F))<128?L+=1:x<2048?L+=2:x<55296||x>=57344?L+=3:(F++,L+=4);return L}(L),l<32)I.push(160|l),W=1;else if(l<256)I.push(217,l),W=2;else if(l<65536)I.push(218,l>>8,l),W=3;else{if(!(l<4294967296))throw new Error("String too long");I.push(219,l>>24,l>>16,l>>8,l),W=5}return x.push({_str:L,_length:l,_offset:I.length}),W+l}if("number"===F)return Math.floor(L)===L&&isFinite(L)?L>=0?L<128?(I.push(L),1):L<256?(I.push(204,L),2):L<65536?(I.push(205,L>>8,L),3):L<4294967296?(I.push(206,L>>24,L>>16,L>>8,L),5):(p=L/Math.pow(2,32)|0,B=L>>>0,I.push(207,p>>24,p>>16,p>>8,p,B>>24,B>>16,B>>8,B),9):L>=-32?(I.push(L),1):L>=-128?(I.push(208,L),2):L>=-32768?(I.push(209,L>>8,L),3):L>=-2147483648?(I.push(210,L>>24,L>>16,L>>8,L),5):(p=Math.floor(L/Math.pow(2,32)),B=L>>>0,I.push(211,p>>24,p>>16,p>>8,p,B>>24,B>>16,B>>8,B),9):(I.push(203),x.push({_float:L,_length:8,_offset:I.length}),9);if("object"===F){if(null===L)return I.push(192),1;if(Array.isArray(L)){if((l=L.length)<16)I.push(144|l),W=1;else if(l<65536)I.push(220,l>>8,l),W=3;else{if(!(l<4294967296))throw new Error("Array too large");I.push(221,l>>24,l>>16,l>>8,l),W=5}for(G=0;G<l;G++)W+=X(I,x,L[G]);return W}if(L instanceof Date){var Q=L.getTime(),e=Math.floor(Q/1e3),g=1e6*(Q-1e3*e);return e>=0&&g>=0&&e<=17179869183?0===g&&e<=4294967295?(I.push(214,255,e>>24,e>>16,e>>8,e),6):(p=e/4294967296,B=4294967295&e,I.push(215,255,g>>22,g>>14,g>>6,p,B>>24,B>>16,B>>8,B),10):(p=Math.floor(e/4294967296),B=e>>>0,I.push(199,12,255,g>>24,g>>16,g>>8,g,p>>24,p>>16,p>>8,p,B>>24,B>>16,B>>8,B),15)}if(L instanceof ArrayBuffer){if((l=L.byteLength)<256)I.push(196,l),W=2;else if(l<65536)I.push(197,l>>8,l),W=3;else{if(!(l<4294967296))throw new Error("Buffer too large");I.push(198,l>>24,l>>16,l>>8,l),W=5}return x.push({_bin:L,_length:l,_offset:I.length}),W+l}if("function"===typeof L.toJSON)return X(I,x,L.toJSON());var v=[],z="",H=Object.keys(L);for(G=0,Y=H.length;G<Y;G++)void 0!==L[z=H[G]]&&"function"!==typeof L[z]&&v.push(z);if((l=v.length)<16)I.push(128|l),W=1;else if(l<65536)I.push(222,l>>8,l),W=3;else{if(!(l<4294967296))throw new Error("Object too large");I.push(223,l>>24,l>>16,l>>8,l),W=5}for(G=0;G<l;G++)W+=X(I,x,z=v[G]),W+=X(I,x,L[z]);return W}if("boolean"===F)return I.push(L?195:194),1;if("undefined"===F)return I.push(192),1;if("function"===typeof L.toJSON)return X(I,x,L.toJSON());throw new Error("Could not encode")}x.encode=function(I){var x=[],L=[],G=X(x,L,I),Y=new ArrayBuffer(G),p=new DataView(Y),B=0,l=0,W=-1;L.length>0&&(W=L[0]._offset);for(var Q,e=0,g=0,v=0,z=x.length;v<z;v++)if(p.setUint8(l+v,x[v]),v+1===W){if(e=(Q=L[B])._length,g=l+W,Q._bin)for(var H=new Uint8Array(Q._bin),s=0;s<e;s++)p.setUint8(g+s,H[s]);else Q._str?F(p,g,Q._str):void 0!==Q._float&&p.setFloat64(g,Q._float);l+=e,L[++B]&&(W=L[B]._offset)}return Y}},13678:(I,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.NoneSerializer=void 0;x.NoneSerializer=class{setState(I){}getState(){return null}patch(I){}teardown(){}handshake(I){}}},13675:(I,x,L)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.SchemaSerializer=void 0;const F=L(13638);x.SchemaSerializer=class{setState(I){return this.state.decode(I)}getState(){return this.state}patch(I){return this.state.decode(I)}teardown(){var I,x;null===(x=null===(I=this.state)||void 0===I?void 0:I.$changes)||void 0===x||x.root.clearRefs()}handshake(I,x){if(this.state){(new F.Reflection).decode(I,x)}else this.state=F.Reflection.decode(I,x)}}},13616:(I,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.getSerializer=x.registerSerializer=void 0;const L={};x.registerSerializer=function(I,x){L[I]=x},x.getSerializer=function(I){const x=L[I];if(!x)throw new Error("missing serializer: "+I);return x}},13601:function(I,x,L){"use strict";var F=this&&this.__importDefault||function(I){return I&&I.__esModule?I:{default:I}};Object.defineProperty(x,"__esModule",{value:!0}),x.WebSocketTransport=void 0;const X=F(L(13606)),G=globalThis.WebSocket||X.default;x.WebSocketTransport=class{constructor(I){this.events=I}send(I){I instanceof ArrayBuffer?this.ws.send(I):Array.isArray(I)&&this.ws.send(new Uint8Array(I).buffer)}connect(I,x){try{this.ws=new G(I,{headers:x,protocols:this.protocols})}catch(L){this.ws=new G(I,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(I,x){this.ws.close(I,x)}get isOpen(){return this.ws.readyState===G.OPEN}}},13606:I=>{"use strict";I.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14869:I=>{"use strict";I.exports=function(I){for(var x=new Array(I),L=0;L<I;++L)x[L]=L;return x}},14872:I=>{function x(I){return!!I.constructor&&"function"===typeof I.constructor.isBuffer&&I.constructor.isBuffer(I)}I.exports=function(I){return null!=I&&(x(I)||function(I){return"function"===typeof I.readFloatLE&&"function"===typeof I.slice&&x(I.slice(0,0))}(I)||!!I._isBuffer)}},14864:(I,x,L)=>{var F=L(14869),X=L(14872),G="undefined"!==typeof Float64Array;function Y(I,x){return I[0]-x[0]}function p(){var I,x=this.stride,L=new Array(x.length);for(I=0;I<L.length;++I)L[I]=[Math.abs(x[I]),I];L.sort(Y);var F=new Array(L.length);for(I=0;I<F.length;++I)F[I]=L[I][1];return F}function B(I,x){var L=["View",x,"d",I].join("");x<0&&(L="View_Nil"+I);var X="generic"===I;if(-1===x){var G="function "+L+"(a){this.data=a;};var proto="+L+".prototype;proto.dtype='"+I+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+L+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+L+"(a){return new "+L+"(a);}";return new Function(G)()}if(0===x){G="function "+L+"(a,d) {this.data = a;this.offset = d};var proto="+L+".prototype;proto.dtype='"+I+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+L+"_copy() {return new "+L+"(this.data,this.offset)};proto.pick=function "+L+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+L+"_get(){return "+(X?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+L+"_set(v){return "+(X?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+L+"(a,b,c,d){return new "+L+"(a,d)}";return new Function("TrivialArray",G)(l[I][0])}G=["'use strict'"];var Y=F(x),B=Y.map((function(I){return"i"+I})),W="this.offset+"+Y.map((function(I){return"this.stride["+I+"]*i"+I})).join("+"),Q=Y.map((function(I){return"b"+I})).join(","),e=Y.map((function(I){return"c"+I})).join(",");G.push("function "+L+"(a,"+Q+","+e+",d){this.data=a","this.shape=["+Q+"]","this.stride=["+e+"]","this.offset=d|0}","var proto="+L+".prototype","proto.dtype='"+I+"'","proto.dimension="+x),G.push("Object.defineProperty(proto,'size',{get:function "+L+"_size(){return "+Y.map((function(I){return"this.shape["+I+"]"})).join("*"),"}})"),1===x?G.push("proto.order=[0]"):(G.push("Object.defineProperty(proto,'order',{get:"),x<4?(G.push("function "+L+"_order(){"),2===x?G.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===x&&G.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):G.push("ORDER})")),G.push("proto.set=function "+L+"_set("+B.join(",")+",v){"),X?G.push("return this.data.set("+W+",v)}"):G.push("return this.data["+W+"]=v}"),G.push("proto.get=function "+L+"_get("+B.join(",")+"){"),X?G.push("return this.data.get("+W+")}"):G.push("return this.data["+W+"]}"),G.push("proto.index=function "+L+"_index(",B.join(),"){return "+W+"}"),G.push("proto.hi=function "+L+"_hi("+B.join(",")+"){return new "+L+"(this.data,"+Y.map((function(I){return["(typeof i",I,"!=='number'||i",I,"<0)?this.shape[",I,"]:i",I,"|0"].join("")})).join(",")+","+Y.map((function(I){return"this.stride["+I+"]"})).join(",")+",this.offset)}");var g=Y.map((function(I){return"a"+I+"=this.shape["+I+"]"})),v=Y.map((function(I){return"c"+I+"=this.stride["+I+"]"}));G.push("proto.lo=function "+L+"_lo("+B.join(",")+"){var b=this.offset,d=0,"+g.join(",")+","+v.join(","));for(var z=0;z<x;++z)G.push("if(typeof i"+z+"==='number'&&i"+z+">=0){d=i"+z+"|0;b+=c"+z+"*d;a"+z+"-=d}");G.push("return new "+L+"(this.data,"+Y.map((function(I){return"a"+I})).join(",")+","+Y.map((function(I){return"c"+I})).join(",")+",b)}"),G.push("proto.step=function "+L+"_step("+B.join(",")+"){var "+Y.map((function(I){return"a"+I+"=this.shape["+I+"]"})).join(",")+","+Y.map((function(I){return"b"+I+"=this.stride["+I+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(z=0;z<x;++z)G.push("if(typeof i"+z+"==='number'){d=i"+z+"|0;if(d<0){c+=b"+z+"*(a"+z+"-1);a"+z+"=ceil(-a"+z+"/d)}else{a"+z+"=ceil(a"+z+"/d)}b"+z+"*=d}");G.push("return new "+L+"(this.data,"+Y.map((function(I){return"a"+I})).join(",")+","+Y.map((function(I){return"b"+I})).join(",")+",c)}");var H=new Array(x),s=new Array(x);for(z=0;z<x;++z)H[z]="a[i"+z+"]",s[z]="b[i"+z+"]";G.push("proto.transpose=function "+L+"_transpose("+B+"){"+B.map((function(I,x){return I+"=("+I+"===undefined?"+x+":"+I+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+L+"(this.data,"+H.join(",")+","+s.join(",")+",this.offset)}"),G.push("proto.pick=function "+L+"_pick("+B+"){var a=[],b=[],c=this.offset");for(z=0;z<x;++z)G.push("if(typeof i"+z+"==='number'&&i"+z+">=0){c=(c+this.stride["+z+"]*i"+z+")|0}else{a.push(this.shape["+z+"]);b.push(this.stride["+z+"])}");return G.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),G.push("return function construct_"+L+"(data,shape,stride,offset){return new "+L+"(data,"+Y.map((function(I){return"shape["+I+"]"})).join(",")+","+Y.map((function(I){return"stride["+I+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",G.join("\n"))(l[I],p)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};I.exports=function(I,x,L,F){if(void 0===I)return(0,l.array[0])([]);"number"===typeof I&&(I=[I]),void 0===x&&(x=[I.length]);var Y=x.length;if(void 0===L){L=new Array(Y);for(var p=Y-1,W=1;p>=0;--p)L[p]=W,W*=x[p]}if(void 0===F){F=0;for(p=0;p<Y;++p)L[p]<0&&(F-=(x[p]-1)*L[p])}for(var Q=function(I){if(X(I))return"buffer";if(G)switch(Object.prototype.toString.call(I)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(I)?"array":"generic"}(I),e=l[Q];e.length<=Y+1;)e.push(B(Q,e.length-1));return(0,e[Y+1])(I,x,L,F)}},14827:I=>{var x;self,x=()=>(()=>{"use strict";var I={d:(x,L)=>{for(var F in L)I.o(L,F)&&!I.o(x,F)&&Object.defineProperty(x,F,{enumerable:!0,get:L[F]})},o:(I,x)=>Object.prototype.hasOwnProperty.call(I,x)},x={};I.d(x,{default:()=>A});var L,F=function(I,x){var L=x.x-I.x,F=x.y-I.y;return Math.sqrt(L*L+F*F)},X=function(I){return I*(Math.PI/180)},G=new Map,Y=function(I){G.has(I)&&clearTimeout(G.get(I)),G.set(I,setTimeout(I,100))},p=function(I,x,L){for(var F,X=x.split(/[ ,]+/g),G=0;G<X.length;G+=1)F=X[G],I.addEventListener?I.addEventListener(F,L,!1):I.attachEvent&&I.attachEvent(F,L)},B=function(I,x,L){for(var F,X=x.split(/[ ,]+/g),G=0;G<X.length;G+=1)F=X[G],I.removeEventListener?I.removeEventListener(F,L):I.detachEvent&&I.detachEvent(F,L)},l=function(I){return I.preventDefault(),I.type.match(/^touch/)?I.changedTouches:I},W=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},Q=function(I,x){x.top||x.right||x.bottom||x.left?(I.style.top=x.top,I.style.right=x.right,I.style.bottom=x.bottom,I.style.left=x.left):(I.style.left=x.x+"px",I.style.top=x.y+"px")},e=function(I,x,L){var F=g(I);for(var X in F)if(F.hasOwnProperty(X))if("string"==typeof x)F[X]=x+" "+L;else{for(var G="",Y=0,p=x.length;Y<p;Y+=1)G+=x[Y]+" "+L+", ";F[X]=G.slice(0,-2)}return F},g=function(I){var x={};return x[I]="",["webkit","Moz","o"].forEach((function(L){x[L+I.charAt(0).toUpperCase()+I.slice(1)]=""})),x},v=function(I,x){for(var L in x)x.hasOwnProperty(L)&&(I[L]=x[L]);return I},z=function(I,x){if(I.length)for(var L=0,F=I.length;L<F;L+=1)x(I[L]);else x(I)},H="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,s=window.matchMedia("(any-hover: none)").matches,U=!!("ontouchstart"in window),q=!!window.PointerEvent,y=!!window.MSPointerEvent,T={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},Z={start:"mousedown",move:"mousemove",end:"mouseup"},t={};function f(){}H&&!s?L=T:q?L={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:y?L={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:U?(L=T,t=Z):L=Z,f.prototype.on=function(I,x){var L,F=this,X=I.split(/[ ,]+/g);F._handlers_=F._handlers_||{};for(var G=0;G<X.length;G+=1)L=X[G],F._handlers_[L]=F._handlers_[L]||[],F._handlers_[L].push(x);return F},f.prototype.off=function(I,x){var L=this;return L._handlers_=L._handlers_||{},void 0===I?L._handlers_={}:void 0===x?L._handlers_[I]=null:L._handlers_[I]&&L._handlers_[I].indexOf(x)>=0&&L._handlers_[I].splice(L._handlers_[I].indexOf(x),1),L},f.prototype.trigger=function(I,x){var L,F=this,X=I.split(/[ ,]+/g);F._handlers_=F._handlers_||{};for(var G=0;G<X.length;G+=1)L=X[G],F._handlers_[L]&&F._handlers_[L].length&&F._handlers_[L].forEach((function(I){I.call(F,{type:L,target:F},x)}))},f.prototype.config=function(I){var x=this;x.options=x.defaults||{},I&&(x.options=function(I,x){var L={};for(var F in I)I.hasOwnProperty(F)&&x.hasOwnProperty(F)?L[F]=x[F]:I.hasOwnProperty(F)&&(L[F]=I[F]);return L}(x.options,I))},f.prototype.bindEvt=function(I,x){var F=this;return F._domHandlers_=F._domHandlers_||{},F._domHandlers_[x]=function(){"function"==typeof F["on"+x]?F["on"+x].apply(F,arguments):console.warn('[WARNING] : Missing "on'+x+'" handler.')},p(I,L[x],F._domHandlers_[x]),t[x]&&p(I,t[x],F._domHandlers_[x]),F},f.prototype.unbindEvt=function(I,x){var F=this;return F._domHandlers_=F._domHandlers_||{},B(I,L[x],F._domHandlers_[x]),t[x]&&B(I,t[x],F._domHandlers_[x]),delete F._domHandlers_[x],this};const R=f;function n(I,x){return this.identifier=x.identifier,this.position=x.position,this.frontPosition=x.frontPosition,this.collection=I,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(x),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=n.id,n.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}n.prototype=new R,n.constructor=n,n.id=0,n.prototype.buildEl=function(I){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},n.prototype.stylize=function(){if(this.options.dataOnly)return this;var I=this.options.fadeTime+"ms",x=function(){var I=g("borderRadius");for(var x in I)I.hasOwnProperty(x)&&(I[x]="50%");return I}(),L=e("transition","opacity",I),F={};return F.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},F.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},F.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},v(F.el,L),"circle"===this.options.shape&&v(F.back,x),v(F.front,x),this.applyStyles(F),this},n.prototype.applyStyles=function(I){for(var x in this.ui)if(this.ui.hasOwnProperty(x))for(var L in I[x])this.ui[x].style[L]=I[x][L];return this},n.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},n.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},n.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},n.prototype.show=function(I){var x=this;return x.options.dataOnly||(clearTimeout(x.removeTimeout),clearTimeout(x.showTimeout),clearTimeout(x.restTimeout),x.addToDom(),x.restCallback(),setTimeout((function(){x.ui.el.style.opacity=1}),0),x.showTimeout=setTimeout((function(){x.trigger("shown",x.instance),"function"==typeof I&&I.call(this)}),x.options.fadeTime)),x},n.prototype.hide=function(I){var x=this;if(x.options.dataOnly)return x;if(x.ui.el.style.opacity=x.options.restOpacity,clearTimeout(x.removeTimeout),clearTimeout(x.showTimeout),clearTimeout(x.restTimeout),x.removeTimeout=setTimeout((function(){var L="dynamic"===x.options.mode?"none":"block";x.ui.el.style.display=L,"function"==typeof I&&I.call(x),x.trigger("hidden",x.instance)}),x.options.fadeTime),x.options.restJoystick){var L=x.options.restJoystick,F={};F.x=!0===L||!1!==L.x?0:x.instance.frontPosition.x,F.y=!0===L||!1!==L.y?0:x.instance.frontPosition.y,x.setPosition(I,F)}return x},n.prototype.setPosition=function(I,x){var L=this;L.frontPosition={x:x.x,y:x.y};var F=L.options.fadeTime+"ms",X={};X.front=e("transition",["transform"],F);var G={front:{}};G.front={transform:"translate("+L.frontPosition.x+"px,"+L.frontPosition.y+"px)"},L.applyStyles(X),L.applyStyles(G),L.restTimeout=setTimeout((function(){"function"==typeof I&&I.call(L),L.restCallback()}),L.options.fadeTime)},n.prototype.restCallback=function(){var I=this,x={};x.front=e("transition","none",""),I.applyStyles(x),I.trigger("rested",I.instance)},n.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},n.prototype.computeDirection=function(I){var x,L,F,X=I.angle.radian,G=Math.PI/4,Y=Math.PI/2;if(X>G&&X<3*G&&!I.lockX?x="up":X>-G&&X<=G&&!I.lockY?x="left":X>3*-G&&X<=-G&&!I.lockX?x="down":I.lockY||(x="right"),I.lockY||(L=X>-Y&&X<Y?"left":"right"),I.lockX||(F=X>0?"up":"down"),I.force>this.options.threshold){var p,B={};for(p in this.direction)this.direction.hasOwnProperty(p)&&(B[p]=this.direction[p]);var l={};for(p in this.direction={x:L,y:F,angle:x},I.direction=this.direction,B)B[p]===this.direction[p]&&(l[p]=!0);if(l.x&&l.y&&l.angle)return I;l.x&&l.y||this.trigger("plain",I),l.x||this.trigger("plain:"+L,I),l.y||this.trigger("plain:"+F,I),l.angle||this.trigger("dir dir:"+x,I)}else this.resetDirection();return I};const P=n;function d(I,x){var L=this;L.nipples=[],L.idles=[],L.actives=[],L.ids=[],L.pressureIntervals={},L.manager=I,L.id=d.id,d.id+=1,L.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},L.config(x),"static"!==L.options.mode&&"semi"!==L.options.mode||(L.options.multitouch=!1),L.options.multitouch||(L.options.maxNumberOfNipples=1);var F=getComputedStyle(L.options.zone.parentElement);return F&&"flex"===F.display&&(L.parentIsFlex=!0),L.updateBox(),L.prepareNipples(),L.gg(),L.begin(),L.nipples}d.prototype=new R,d.constructor=d,d.id=0,d.prototype.prepareNipples=function(){var I=this,x=I.nipples;x.on=I.on.bind(I),x.off=I.off.bind(I),x.options=I.options,x.destroy=I.destroy.bind(I),x.ids=I.ids,x.id=I.id,x.processOnMove=I.processOnMove.bind(I),x.processOnEnd=I.processOnEnd.bind(I),x.get=function(I){if(void 0===I)return x[0];for(var L=0,F=x.length;L<F;L+=1)if(x[L].identifier===I)return x[L];return!1}},d.prototype.gg=function(){var I=this;I.bindEvt(I.options.zone,"start"),I.options.zone.style.touchAction="none",I.options.zone.style.msTouchAction="none"},d.prototype.begin=function(){var I=this,x=I.options;if("static"===x.mode){var L=I.createNipple(x.position,I.manager.getIdentifier());L.add(),I.idles.push(L)}},d.prototype.createNipple=function(I,x){var L=this,F=L.manager.scroll,X={},G=L.options,Y=L.parentIsFlex?F.x:F.x+L.box.left,p=L.parentIsFlex?F.y:F.y+L.box.top;if(I.x&&I.y)X={x:I.x-Y,y:I.y-p};else if(I.top||I.right||I.bottom||I.left){var B=document.createElement("DIV");B.style.display="hidden",B.style.top=I.top,B.style.right=I.right,B.style.bottom=I.bottom,B.style.left=I.left,B.style.position="absolute",G.zone.appendChild(B);var l=B.getBoundingClientRect();G.zone.removeChild(B),X=I,I={x:l.left+F.x,y:l.top+F.y}}var W=new P(L,{color:G.color,size:G.size,threshold:G.threshold,fadeTime:G.fadeTime,dataOnly:G.dataOnly,restJoystick:G.restJoystick,restOpacity:G.restOpacity,mode:G.mode,identifier:x,position:I,zone:G.zone,frontPosition:{x:0,y:0},shape:G.shape});return G.dataOnly||(Q(W.ui.el,X),Q(W.ui.front,W.frontPosition)),L.nipples.push(W),L.trigger("added "+W.identifier+":added",W),L.manager.trigger("added "+W.identifier+":added",W),L.bindNipple(W),W},d.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},d.prototype.bindNipple=function(I){var x,L=this,F=function(I,F){x=I.type+" "+F.id+":"+I.type,L.trigger(x,F)};I.on("destroyed",L.onDestroyed.bind(L)),I.on("shown hidden rested dir plain",F),I.on("dir:up dir:right dir:down dir:left",F),I.on("plain:up plain:right plain:down plain:left",F)},d.prototype.pressureFn=function(I,x,L){var F=this,X=0;clearInterval(F.pressureIntervals[L]),F.pressureIntervals[L]=setInterval(function(){var L=I.force||I.pressure||I.webkitForce||0;L!==X&&(x.trigger("pressure",L),F.trigger("pressure "+x.identifier+":pressure",L),X=L)}.bind(F),100)},d.prototype.onstart=function(I){var x=this,L=x.options,F=I;return I=l(I),x.updateBox(),z(I,(function(X){x.actives.length<L.maxNumberOfNipples?x.processOnStart(X):F.type.match(/^touch/)&&(Object.keys(x.manager.ids).forEach((function(L){if(Object.values(F.touches).findIndex((function(I){return I.identifier===L}))<0){var X=[I[0]];X.identifier=L,x.processOnEnd(X)}})),x.actives.length<L.maxNumberOfNipples&&x.processOnStart(X))})),x.manager.bindDocument(),!1},d.prototype.processOnStart=function(I){var x,L=this,X=L.options,G=L.manager.getIdentifier(I),Y=I.force||I.pressure||I.webkitForce||0,p={x:I.pageX,y:I.pageY},B=L.getOrCreate(G,p);B.identifier!==G&&L.manager.removeIdentifier(B.identifier),B.identifier=G;var l=function(x){x.trigger("start",x),L.trigger("start "+x.id+":start",x),x.show(),Y>0&&L.pressureFn(I,x,x.identifier),L.processOnMove(I)};if((x=L.idles.indexOf(B))>=0&&L.idles.splice(x,1),L.actives.push(B),L.ids.push(B.identifier),"semi"!==X.mode)l(B);else{if(!(F(p,B.position)<=X.catchDistance))return B.destroy(),void L.processOnStart(I);l(B)}return B},d.prototype.getOrCreate=function(I,x){var L,F=this,X=F.options;return/(semi|static)/.test(X.mode)?(L=F.idles[0])?(F.idles.splice(0,1),L):"semi"===X.mode?F.createNipple(x,I):(console.warn("Coudln't find the needed nipple."),!1):L=F.createNipple(x,I)},d.prototype.processOnMove=function(I){var x=this,L=x.options,G=x.manager.getIdentifier(I),Y=x.nipples.get(G),p=x.manager.scroll;if(function(I){return isNaN(I.buttons)?0!==I.pressure:0!==I.buttons}(I)){if(!Y)return console.error("Found zombie joystick with ID "+G),void x.manager.removeIdentifier(G);if(L.dynamicPage){var B=Y.el.getBoundingClientRect();Y.position={x:p.x+B.left,y:p.y+B.top}}Y.identifier=G;var l=Y.options.size/2,W={x:I.pageX,y:I.pageY};L.lockX&&(W.y=Y.position.y),L.lockY&&(W.x=Y.position.x);var Q,e,g,v,z,H,s,U,q,y,T=F(W,Y.position),Z=(Q=W,g=(e=Y.position).x-Q.x,v=e.y-Q.y,function(I){return I*(180/Math.PI)}(Math.atan2(v,g))),t=X(Z),f=T/l,R={distance:T,position:W};if("circle"===Y.options.shape?(z=Math.min(T,l),s=Y.position,U=z,y={x:0,y:0},q=X(q=Z),y.x=s.x-U*Math.cos(q),y.y=s.y-U*Math.sin(q),H=y):(H=function(I,x,L){return{x:Math.min(Math.max(I.x,x.x-L),x.x+L),y:Math.min(Math.max(I.y,x.y-L),x.y+L)}}(W,Y.position,l),z=F(H,Y.position)),L.follow){if(T>l){var n=W.x-H.x,P=W.y-H.y;Y.position.x+=n,Y.position.y+=P,Y.el.style.top=Y.position.y-(x.box.top+p.y)+"px",Y.el.style.left=Y.position.x-(x.box.left+p.x)+"px",T=F(W,Y.position)}}else W=H,T=z;var d=W.x-Y.position.x,M=W.y-Y.position.y;Y.frontPosition={x:d,y:M},L.dataOnly||(Y.ui.front.style.transform="translate("+d+"px,"+M+"px)");var K={identifier:Y.identifier,position:W,force:f,pressure:I.force||I.pressure||I.webkitForce||0,distance:T,angle:{radian:t,degree:Z},vector:{x:d/l,y:-M/l},raw:R,instance:Y,lockX:L.lockX,lockY:L.lockY};(K=Y.computeDirection(K)).angle={radian:X(180-Z),degree:180-Z},Y.trigger("move",K),x.trigger("move "+Y.id+":move",K)}else this.processOnEnd(I)},d.prototype.processOnEnd=function(I){var x=this,L=x.options,F=x.manager.getIdentifier(I),X=x.nipples.get(F),G=x.manager.removeIdentifier(X.identifier);X&&(L.dataOnly||X.hide((function(){"dynamic"===L.mode&&(X.trigger("removed",X),x.trigger("removed "+X.id+":removed",X),x.manager.trigger("removed "+X.id+":removed",X),X.destroy())})),clearInterval(x.pressureIntervals[X.identifier]),X.resetDirection(),X.trigger("end",X),x.trigger("end "+X.id+":end",X),x.ids.indexOf(X.identifier)>=0&&x.ids.splice(x.ids.indexOf(X.identifier),1),x.actives.indexOf(X)>=0&&x.actives.splice(x.actives.indexOf(X),1),/(semi|static)/.test(L.mode)?x.idles.push(X):x.nipples.indexOf(X)>=0&&x.nipples.splice(x.nipples.indexOf(X),1),x.manager.unbindDocument(),/(semi|static)/.test(L.mode)&&(x.manager.ids[G.id]=G.identifier))},d.prototype.onDestroyed=function(I,x){var L=this;L.nipples.indexOf(x)>=0&&L.nipples.splice(L.nipples.indexOf(x),1),L.actives.indexOf(x)>=0&&L.actives.splice(L.actives.indexOf(x),1),L.idles.indexOf(x)>=0&&L.idles.splice(L.idles.indexOf(x),1),L.ids.indexOf(x.identifier)>=0&&L.ids.splice(L.ids.indexOf(x.identifier),1),L.manager.removeIdentifier(x.identifier),L.manager.unbindDocument()},d.prototype.destroy=function(){var I=this;for(var x in I.unbindEvt(I.options.zone,"start"),I.nipples.forEach((function(I){I.destroy()})),I.pressureIntervals)I.pressureIntervals.hasOwnProperty(x)&&clearInterval(I.pressureIntervals[x]);I.trigger("destroyed",I.nipples),I.manager.unbindDocument(),I.off()};const M=d;function K(I){var x=this;x.ids={},x.index=0,x.collections=[],x.scroll=W(),x.config(I),x.prepareCollections();var L=function(){var I;x.collections.forEach((function(L){L.forEach((function(L){I=L.el.getBoundingClientRect(),L.position={x:x.scroll.x+I.left,y:x.scroll.y+I.top}}))}))};p(window,"resize",(function(){Y(L)}));var F=function(){x.scroll=W()};return p(window,"scroll",(function(){Y(F)})),x.collections}K.prototype=new R,K.constructor=K,K.prototype.prepareCollections=function(){var I=this;I.collections.create=I.create.bind(I),I.collections.on=I.on.bind(I),I.collections.off=I.off.bind(I),I.collections.destroy=I.destroy.bind(I),I.collections.get=function(x){var L;return I.collections.every((function(I){return!(L=I.get(x))})),L}},K.prototype.create=function(I){return this.createCollection(I)},K.prototype.createCollection=function(I){var x=this,L=new M(x,I);return x.bindCollection(L),x.collections.push(L),L},K.prototype.bindCollection=function(I){var x,L=this,F=function(I,F){x=I.type+" "+F.id+":"+I.type,L.trigger(x,F)};I.on("destroyed",L.onDestroyed.bind(L)),I.on("shown hidden rested dir plain",F),I.on("dir:up dir:right dir:down dir:left",F),I.on("plain:up plain:right plain:down plain:left",F)},K.prototype.bindDocument=function(){var I=this;I.binded||(I.bindEvt(document,"move").bindEvt(document,"end"),I.binded=!0)},K.prototype.unbindDocument=function(I){var x=this;Object.keys(x.ids).length&&!0!==I||(x.unbindEvt(document,"move").unbindEvt(document,"end"),x.binded=!1)},K.prototype.getIdentifier=function(I){var x;return I?void 0===(x=void 0===I.identifier?I.pointerId:I.identifier)&&(x=this.latest||0):x=this.index,void 0===this.ids[x]&&(this.ids[x]=this.index,this.index+=1),this.latest=x,this.ids[x]},K.prototype.removeIdentifier=function(I){var x={};for(var L in this.ids)if(this.ids[L]===I){x.id=L,x.identifier=this.ids[L],delete this.ids[L];break}return x},K.prototype.onmove=function(I){return this.onAny("move",I),!1},K.prototype.onend=function(I){return this.onAny("end",I),!1},K.prototype.oncancel=function(I){return this.onAny("end",I),!1},K.prototype.onAny=function(I,x){var L,F=this,X="processOn"+I.charAt(0).toUpperCase()+I.slice(1);x=l(x);var G=function(I,x,L){L.ids.indexOf(x)>=0&&(L[X](I),I._found_=!0)};return z(x,(function(I){L=F.getIdentifier(I),z(F.collections,G.bind(null,I,L)),I._found_||F.removeIdentifier(L)})),!1},K.prototype.destroy=function(){var I=this;I.unbindDocument(!0),I.ids={},I.index=0,I.collections.forEach((function(I){I.destroy()})),I.off()},K.prototype.onDestroyed=function(I,x){var L=this;if(L.collections.indexOf(x)<0)return!1;L.collections.splice(L.collections.indexOf(x),1)};var u=new K;const A={create:function(I){return u.create(I)},factory:u};return x.default})(),I.exports=x()},14888:(I,x,L)=>{"use strict";const{Deflate:F,deflate:X,deflateRaw:G,gzip:Y}=L(14895),{Inflate:p,inflate:B,inflateRaw:l,ungzip:W}=L(14949),Q=L(14926);I.exports.Deflate=F,I.exports.deflate=X,I.exports.deflateRaw=G,I.exports.gzip=Y,I.exports.Inflate=p,I.exports.inflate=B,I.exports.inflateRaw=l,I.exports.ungzip=W,I.exports.constants=Q},14895:(I,x,L)=>{"use strict";const F=L(14901),X=L(14929),G=L(14938),Y=L(14923),p=L(14940),B=Object.prototype.toString,{Z_NO_FLUSH:l,Z_SYNC_FLUSH:W,Z_FULL_FLUSH:Q,Z_FINISH:e,Z_OK:g,Z_STREAM_END:v,Z_DEFAULT_COMPRESSION:z,Z_DEFAULT_STRATEGY:H,Z_DEFLATED:s}=L(14926);function U(I){this.options=X.assign({level:z,method:s,DI:16384,windowBits:15,memLevel:8,strategy:H},I||{});let x=this.options;x.raw&&x.windowBits>0?x.windowBits=-x.windowBits:x.gzip&&x.windowBits>0&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.Qx="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;let L=F.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(L!==g)throw new Error(Y[L]);if(x.header&&F.deflateSetHeader(this.strm,x.header),x.dictionary){let I;if(I="string"===typeof x.dictionary?G.string2buf(x.dictionary):"[object ArrayBuffer]"===B.call(x.dictionary)?new Uint8Array(x.dictionary):x.dictionary,L=F.deflateSetDictionary(this.strm,I),L!==g)throw new Error(Y[L]);this._dict_set=!0}}function q(I,x){const L=new U(x);if(L.push(I,!0),L.err)throw L.Qx||Y[L.err];return L.result}U.prototype.push=function(I,x){const L=this.strm,X=this.options.DI;let Y,p;if(this.ended)return!1;for(p=x===~~x?x:!0===x?e:l,"string"===typeof I?L.input=G.string2buf(I):"[object ArrayBuffer]"===B.call(I)?L.input=new Uint8Array(I):L.input=I,L.next_in=0,L.avail_in=L.input.length;;)if(0===L.avail_out&&(L.output=new Uint8Array(X),L.next_out=0,L.avail_out=X),(p===W||p===Q)&&L.avail_out<=6)this.onData(L.output.subarray(0,L.next_out)),L.avail_out=0;else{if(Y=F.deflate(L,p),Y===v)return L.next_out>0&&this.onData(L.output.subarray(0,L.next_out)),Y=F.deflateEnd(this.strm),this.onEnd(Y),this.ended=!0,Y===g;if(0!==L.avail_out){if(p>0&&L.next_out>0)this.onData(L.output.subarray(0,L.next_out)),L.avail_out=0;else if(0===L.avail_in)break}else this.onData(L.output)}return!0},U.prototype.onData=function(I){this.chunks.push(I)},U.prototype.onEnd=function(I){I===g&&(this.result=X.flattenChunks(this.chunks)),this.chunks=[],this.err=I,this.Qx=this.strm.Qx},I.exports.Deflate=U,I.exports.deflate=q,I.exports.deflateRaw=function(I,x){return(x=x||{}).raw=!0,q(I,x)},I.exports.gzip=function(I,x){return(x=x||{}).gzip=!0,q(I,x)},I.exports.constants=L(14926)},14949:(I,x,L)=>{"use strict";const F=L(14958),X=L(14929),G=L(14938),Y=L(14923),p=L(14940),B=L(14976),l=Object.prototype.toString,{Z_NO_FLUSH:W,Z_FINISH:Q,Z_OK:e,Z_STREAM_END:g,Z_NEED_DICT:v,Z_STREAM_ERROR:z,Z_DATA_ERROR:H,Z_MEM_ERROR:s}=L(14926);function U(I){this.options=X.assign({DI:65536,windowBits:15,to:""},I||{});const x=this.options;x.raw&&x.windowBits>=0&&x.windowBits<16&&(x.windowBits=-x.windowBits,0===x.windowBits&&(x.windowBits=-15)),!(x.windowBits>=0&&x.windowBits<16)||I&&I.windowBits||(x.windowBits+=32),x.windowBits>15&&x.windowBits<48&&0===(15&x.windowBits)&&(x.windowBits|=15),this.err=0,this.Qx="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;let L=F.inflateInit2(this.strm,x.windowBits);if(L!==e)throw new Error(Y[L]);if(this.header=new B,F.inflateGetHeader(this.strm,this.header),x.dictionary&&("string"===typeof x.dictionary?x.dictionary=G.string2buf(x.dictionary):"[object ArrayBuffer]"===l.call(x.dictionary)&&(x.dictionary=new Uint8Array(x.dictionary)),x.raw&&(L=F.inflateSetDictionary(this.strm,x.dictionary),L!==e)))throw new Error(Y[L])}function q(I,x){const L=new U(x);if(L.push(I),L.err)throw L.Qx||Y[L.err];return L.result}U.prototype.push=function(I,x){const L=this.strm,X=this.options.DI,Y=this.options.dictionary;let p,B,U;if(this.ended)return!1;for(B=x===~~x?x:!0===x?Q:W,"[object ArrayBuffer]"===l.call(I)?L.input=new Uint8Array(I):L.input=I,L.next_in=0,L.avail_in=L.input.length;;){for(0===L.avail_out&&(L.output=new Uint8Array(X),L.next_out=0,L.avail_out=X),p=F.inflate(L,B),p===v&&Y&&(p=F.inflateSetDictionary(L,Y),p===e?p=F.inflate(L,B):p===H&&(p=v));L.avail_in>0&&p===g&&L.state.wrap>0&&0!==I[L.next_in];)F.inflateReset(L),p=F.inflate(L,B);switch(p){case z:case H:case v:case s:return this.onEnd(p),this.ended=!0,!1}if(U=L.avail_out,L.next_out&&(0===L.avail_out||p===g))if("string"===this.options.to){let I=G.utf8border(L.output,L.next_out),x=L.next_out-I,F=G.buf2string(L.output,I);L.next_out=x,L.avail_out=X-x,x&&L.output.set(L.output.subarray(I,I+x),0),this.onData(F)}else this.onData(L.output.length===L.next_out?L.output:L.output.subarray(0,L.next_out));if(p!==e||0!==U){if(p===g)return p=F.inflateEnd(this.strm),this.onEnd(p),this.ended=!0,!0;if(0===L.avail_in)break}}return!0},U.prototype.onData=function(I){this.chunks.push(I)},U.prototype.onEnd=function(I){I===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=X.flattenChunks(this.chunks)),this.chunks=[],this.err=I,this.Qx=this.strm.Qx},I.exports.Inflate=U,I.exports.inflate=q,I.exports.inflateRaw=function(I,x){return(x=x||{}).raw=!0,q(I,x)},I.exports.ungzip=q,I.exports.constants=L(14926)},14929:I=>{"use strict";const x=(I,x)=>Object.prototype.hasOwnProperty.call(I,x);I.exports.assign=function(I){const L=Array.prototype.slice.call(arguments,1);for(;L.length;){const F=L.shift();if(F){if("object"!==typeof F)throw new TypeError(F+"must be non-object");for(const L in F)x(F,L)&&(I[L]=F[L])}}return I},I.exports.flattenChunks=I=>{let x=0;for(let F=0,X=I.length;F<X;F++)x+=I[F].length;const L=new Uint8Array(x);for(let F=0,X=0,G=I.length;F<G;F++){let x=I[F];L.set(x,X),X+=x.length}return L}},14938:I=>{"use strict";let x=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(F){x=!1}const L=new Uint8Array(256);for(let X=0;X<256;X++)L[X]=X>=252?6:X>=248?5:X>=240?4:X>=224?3:X>=192?2:1;L[254]=L[254]=1,I.exports.string2buf=I=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(I);let x,L,F,X,G,Y=I.length,p=0;for(X=0;X<Y;X++)L=I.charCodeAt(X),55296===(64512&L)&&X+1<Y&&(F=I.charCodeAt(X+1),56320===(64512&F)&&(L=65536+(L-55296<<10)+(F-56320),X++)),p+=L<128?1:L<2048?2:L<65536?3:4;for(x=new Uint8Array(p),G=0,X=0;G<p;X++)L=I.charCodeAt(X),55296===(64512&L)&&X+1<Y&&(F=I.charCodeAt(X+1),56320===(64512&F)&&(L=65536+(L-55296<<10)+(F-56320),X++)),L<128?x[G++]=L:L<2048?(x[G++]=192|L>>>6,x[G++]=128|63&L):L<65536?(x[G++]=224|L>>>12,x[G++]=128|L>>>6&63,x[G++]=128|63&L):(x[G++]=240|L>>>18,x[G++]=128|L>>>12&63,x[G++]=128|L>>>6&63,x[G++]=128|63&L);return x};I.exports.buf2string=(I,F)=>{const X=F||I.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(I.subarray(0,F));let G,Y;const p=new Array(2*X);for(Y=0,G=0;G<X;){let x=I[G++];if(x<128){p[Y++]=x;continue}let F=L[x];if(F>4)p[Y++]=65533,G+=F-1;else{for(x&=2===F?31:3===F?15:7;F>1&&G<X;)x=x<<6|63&I[G++],F--;F>1?p[Y++]=65533:x<65536?p[Y++]=x:(x-=65536,p[Y++]=55296|x>>10&1023,p[Y++]=56320|1023&x)}}return((I,L)=>{if(L<65534&&I.subarray&&x)return String.fromCharCode.apply(null,I.length===L?I:I.subarray(0,L));let F="";for(let x=0;x<L;x++)F+=String.fromCharCode(I[x]);return F})(p,Y)},I.exports.utf8border=(I,x)=>{(x=x||I.length)>I.length&&(x=I.length);let F=x-1;for(;F>=0&&128===(192&I[F]);)F--;return F<0||0===F?x:F+L[I[F]]>x?F:x}},14912:I=>{"use strict";I.exports=(I,x,L,F)=>{let X=65535&I,G=I>>>16&65535,Y=0;for(;0!==L;){Y=L>2e3?2e3:L,L-=Y;do{X=X+x[F++]|0,G=G+X|0}while(--Y);X%=65521,G%=65521}return X|G<<16}},14926:I=>{"use strict";I.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},14921:I=>{"use strict";const x=new Uint32Array((()=>{let I,x=[];for(var L=0;L<256;L++){I=L;for(var F=0;F<8;F++)I=1&I?3988292384^I>>>1:I>>>1;x[L]=I}return x})());I.exports=(I,L,F,X)=>{const G=x,Y=X+F;I^=-1;for(let x=X;x<Y;x++)I=I>>>8^G[255&(I^L[x])];return~I}},14901:(I,x,L)=>{"use strict";const{_tr_init:F,_tr_stored_block:X,_tr_flush_block:G,_tr_tally:Y,_tr_align:p}=L(14904),B=L(14912),l=L(14921),W=L(14923),{Z_NO_FLUSH:Q,Z_PARTIAL_FLUSH:e,Z_FULL_FLUSH:g,Z_FINISH:v,Z_BLOCK:z,Z_OK:H,Z_STREAM_END:s,Z_STREAM_ERROR:U,Z_DATA_ERROR:q,Z_BUF_ERROR:y,Z_DEFAULT_COMPRESSION:T,Z_FILTERED:Z,Z_HUFFMAN_ONLY:t,Z_RLE:f,Z_FIXED:R,Z_DEFAULT_STRATEGY:n,Z_UNKNOWN:P,Z_DEFLATED:d}=L(14926),M=258,K=262,u=103,A=113,mI=666,O=(I,x)=>(I.Qx=W[x],x),w=I=>(I<<1)-(I>4?9:0),k=I=>{let x=I.length;for(;--x>=0;)I[x]=0};let a=(I,x,L)=>(x<<I.hash_shift^L)&I.hash_mask;const D=I=>{const x=I.state;let L=x.pending;L>I.avail_out&&(L=I.avail_out),0!==L&&(I.output.set(x.pending_buf.subarray(x.pending_out,x.pending_out+L),I.next_out),I.next_out+=L,x.pending_out+=L,I.total_out+=L,I.avail_out-=L,x.pending-=L,0===x.pending&&(x.pending_out=0))},r=(I,x)=>{G(I,I.block_start>=0?I.block_start:-1,I.strstart-I.block_start,x),I.block_start=I.strstart,D(I.strm)},N=(I,x)=>{I.pending_buf[I.pending++]=x},S=(I,x)=>{I.pending_buf[I.pending++]=x>>>8&255,I.pending_buf[I.pending++]=255&x},c=(I,x,L,F)=>{let X=I.avail_in;return X>F&&(X=F),0===X?0:(I.avail_in-=X,x.set(I.input.subarray(I.next_in,I.next_in+X),L),1===I.state.wrap?I.adler=B(I.adler,x,X,L):2===I.state.wrap&&(I.adler=l(I.adler,x,X,L)),I.next_in+=X,I.total_in+=X,X)},o=(I,x)=>{let L,F,X=I.max_chain_length,G=I.strstart,Y=I.prev_length,p=I.nice_match;const B=I.strstart>I.w_size-K?I.strstart-(I.w_size-K):0,l=I.window,W=I.w_mask,Q=I.prev,e=I.strstart+M;let g=l[G+Y-1],v=l[G+Y];I.prev_length>=I.good_match&&(X>>=2),p>I.lookahead&&(p=I.lookahead);do{if(L=x,l[L+Y]===v&&l[L+Y-1]===g&&l[L]===l[G]&&l[++L]===l[G+1]){G+=2,L++;do{}while(l[++G]===l[++L]&&l[++G]===l[++L]&&l[++G]===l[++L]&&l[++G]===l[++L]&&l[++G]===l[++L]&&l[++G]===l[++L]&&l[++G]===l[++L]&&l[++G]===l[++L]&&G<e);if(F=M-(e-G),G=e-M,F>Y){if(I.match_start=x,Y=F,F>=p)break;g=l[G+Y-1],v=l[G+Y]}}}while((x=Q[x&W])>B&&0!==--X);return Y<=I.lookahead?Y:I.lookahead},J=I=>{const x=I.w_size;let L,F,X,G,Y;do{if(G=I.window_size-I.lookahead-I.strstart,I.strstart>=x+(x-K)){I.window.set(I.window.subarray(x,x+x),0),I.match_start-=x,I.strstart-=x,I.block_start-=x,F=I.hash_size,L=F;do{X=I.head[--L],I.head[L]=X>=x?X-x:0}while(--F);F=x,L=F;do{X=I.prev[--L],I.prev[L]=X>=x?X-x:0}while(--F);G+=x}if(0===I.strm.avail_in)break;if(F=c(I.strm,I.window,I.strstart+I.lookahead,G),I.lookahead+=F,I.lookahead+I.insert>=3)for(Y=I.strstart-I.insert,I.ins_h=I.window[Y],I.ins_h=a(I,I.ins_h,I.window[Y+1]);I.insert&&(I.ins_h=a(I,I.ins_h,I.window[Y+3-1]),I.prev[Y&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=Y,Y++,I.insert--,!(I.lookahead+I.insert<3)););}while(I.lookahead<K&&0!==I.strm.avail_in)},h=(I,x)=>{let L,F;for(;;){if(I.lookahead<K){if(J(I),I.lookahead<K&&x===Q)return 1;if(0===I.lookahead)break}if(L=0,I.lookahead>=3&&(I.ins_h=a(I,I.ins_h,I.window[I.strstart+3-1]),L=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),0!==L&&I.strstart-L<=I.w_size-K&&(I.match_length=o(I,L)),I.match_length>=3)if(F=Y(I,I.strstart-I.match_start,I.match_length-3),I.lookahead-=I.match_length,I.match_length<=I.max_lazy_match&&I.lookahead>=3){I.match_length--;do{I.strstart++,I.ins_h=a(I,I.ins_h,I.window[I.strstart+3-1]),L=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart}while(0!==--I.match_length);I.strstart++}else I.strstart+=I.match_length,I.match_length=0,I.ins_h=I.window[I.strstart],I.ins_h=a(I,I.ins_h,I.window[I.strstart+1]);else F=Y(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++;if(F&&(r(I,!1),0===I.strm.avail_out))return 1}return I.insert=I.strstart<2?I.strstart:2,x===v?(r(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(r(I,!1),0===I.strm.avail_out)?1:2},E=(I,x)=>{let L,F,X;for(;;){if(I.lookahead<K){if(J(I),I.lookahead<K&&x===Q)return 1;if(0===I.lookahead)break}if(L=0,I.lookahead>=3&&(I.ins_h=a(I,I.ins_h,I.window[I.strstart+3-1]),L=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),I.prev_length=I.match_length,I.prev_match=I.match_start,I.match_length=2,0!==L&&I.prev_length<I.max_lazy_match&&I.strstart-L<=I.w_size-K&&(I.match_length=o(I,L),I.match_length<=5&&(I.strategy===Z||3===I.match_length&&I.strstart-I.match_start>4096)&&(I.match_length=2)),I.prev_length>=3&&I.match_length<=I.prev_length){X=I.strstart+I.lookahead-3,F=Y(I,I.strstart-1-I.prev_match,I.prev_length-3),I.lookahead-=I.prev_length-1,I.prev_length-=2;do{++I.strstart<=X&&(I.ins_h=a(I,I.ins_h,I.window[I.strstart+3-1]),L=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart)}while(0!==--I.prev_length);if(I.match_available=0,I.match_length=2,I.strstart++,F&&(r(I,!1),0===I.strm.avail_out))return 1}else if(I.match_available){if(F=Y(I,0,I.window[I.strstart-1]),F&&r(I,!1),I.strstart++,I.lookahead--,0===I.strm.avail_out)return 1}else I.match_available=1,I.strstart++,I.lookahead--}return I.match_available&&(F=Y(I,0,I.window[I.strstart-1]),I.match_available=0),I.insert=I.strstart<2?I.strstart:2,x===v?(r(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(r(I,!1),0===I.strm.avail_out)?1:2};function i(I,x,L,F,X){this.good_length=I,this.max_lazy=x,this.nice_length=L,this.max_chain=F,this.func=X}const V=[new i(0,0,0,0,((I,x)=>{let L=65535;for(L>I.pending_buf_size-5&&(L=I.pending_buf_size-5);;){if(I.lookahead<=1){if(J(I),0===I.lookahead&&x===Q)return 1;if(0===I.lookahead)break}I.strstart+=I.lookahead,I.lookahead=0;const F=I.block_start+L;if((0===I.strstart||I.strstart>=F)&&(I.lookahead=I.strstart-F,I.strstart=F,r(I,!1),0===I.strm.avail_out))return 1;if(I.strstart-I.block_start>=I.w_size-K&&(r(I,!1),0===I.strm.avail_out))return 1}return I.insert=0,x===v?(r(I,!0),0===I.strm.avail_out?3:4):(I.strstart>I.block_start&&(r(I,!1),I.strm.avail_out),1)})),new i(4,4,8,4,h),new i(4,5,16,8,h),new i(4,6,32,32,h),new i(4,4,16,16,E),new i(8,16,32,32,E),new i(8,16,128,128,E),new i(8,32,128,256,E),new i(32,128,258,1024,E),new i(32,258,258,4096,E)];function j(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=d,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),k(this.dyn_ltree),k(this.dyn_dtree),k(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),k(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),k(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const C=I=>{if(!I||!I.state)return O(I,U);I.total_in=I.total_out=0,I.data_type=P;const x=I.state;return x.pending=0,x.pending_out=0,x.wrap<0&&(x.wrap=-x.wrap),x.status=x.wrap?42:A,I.adler=2===x.wrap?0:1,x.last_flush=Q,F(x),H},b=I=>{const x=C(I);var L;return x===H&&((L=I.state).window_size=2*L.w_size,k(L.head),L.max_lazy_match=V[L.level].max_lazy,L.good_match=V[L.level].good_length,L.nice_match=V[L.level].nice_length,L.max_chain_length=V[L.level].max_chain,L.strstart=0,L.block_start=0,L.lookahead=0,L.insert=0,L.match_length=L.prev_length=2,L.match_available=0,L.ins_h=0),x},II=(I,x,L,F,X,G)=>{if(!I)return U;let Y=1;if(x===T&&(x=6),F<0?(Y=0,F=-F):F>15&&(Y=2,F-=16),X<1||X>9||L!==d||F<8||F>15||x<0||x>9||G<0||G>R)return O(I,U);8===F&&(F=9);const p=new j;return I.state=p,p.strm=I,p.wrap=Y,p.gzhead=null,p.w_bits=F,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=X+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<X+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.d_buf=1*p.lit_bufsize,p.l_buf=3*p.lit_bufsize,p.level=x,p.strategy=G,p.method=L,b(I)};I.exports.deflateInit=(I,x)=>II(I,x,d,15,8,n),I.exports.deflateInit2=II,I.exports.deflateReset=b,I.exports.deflateResetKeep=C,I.exports.deflateSetHeader=(I,x)=>I&&I.state?2!==I.state.wrap?U:(I.state.gzhead=x,H):U,I.exports.deflate=(I,x)=>{let L,F;if(!I||!I.state||x>z||x<0)return I?O(I,U):U;const G=I.state;if(!I.output||!I.input&&0!==I.avail_in||G.status===mI&&x!==v)return O(I,0===I.avail_out?y:U);G.strm=I;const B=G.last_flush;if(G.last_flush=x,42===G.status)if(2===G.wrap)I.adler=0,N(G,31),N(G,139),N(G,8),G.gzhead?(N(G,(G.gzhead.text?1:0)+(G.gzhead.hcrc?2:0)+(G.gzhead.extra?4:0)+(G.gzhead.name?8:0)+(G.gzhead.comment?16:0)),N(G,255&G.gzhead.time),N(G,G.gzhead.time>>8&255),N(G,G.gzhead.time>>16&255),N(G,G.gzhead.time>>24&255),N(G,9===G.level?2:G.strategy>=t||G.level<2?4:0),N(G,255&G.gzhead.os),G.gzhead.extra&&G.gzhead.extra.length&&(N(G,255&G.gzhead.extra.length),N(G,G.gzhead.extra.length>>8&255)),G.gzhead.hcrc&&(I.adler=l(I.adler,G.pending_buf,G.pending,0)),G.gzindex=0,G.status=69):(N(G,0),N(G,0),N(G,0),N(G,0),N(G,0),N(G,9===G.level?2:G.strategy>=t||G.level<2?4:0),N(G,3),G.status=A);else{let x=d+(G.w_bits-8<<4)<<8,L=-1;L=G.strategy>=t||G.level<2?0:G.level<6?1:6===G.level?2:3,x|=L<<6,0!==G.strstart&&(x|=32),x+=31-x%31,G.status=A,S(G,x),0!==G.strstart&&(S(G,I.adler>>>16),S(G,65535&I.adler)),I.adler=1}if(69===G.status)if(G.gzhead.extra){for(L=G.pending;G.gzindex<(65535&G.gzhead.extra.length)&&(G.pending!==G.pending_buf_size||(G.gzhead.hcrc&&G.pending>L&&(I.adler=l(I.adler,G.pending_buf,G.pending-L,L)),D(I),L=G.pending,G.pending!==G.pending_buf_size));)N(G,255&G.gzhead.extra[G.gzindex]),G.gzindex++;G.gzhead.hcrc&&G.pending>L&&(I.adler=l(I.adler,G.pending_buf,G.pending-L,L)),G.gzindex===G.gzhead.extra.length&&(G.gzindex=0,G.status=73)}else G.status=73;if(73===G.status)if(G.gzhead.name){L=G.pending;do{if(G.pending===G.pending_buf_size&&(G.gzhead.hcrc&&G.pending>L&&(I.adler=l(I.adler,G.pending_buf,G.pending-L,L)),D(I),L=G.pending,G.pending===G.pending_buf_size)){F=1;break}F=G.gzindex<G.gzhead.name.length?255&G.gzhead.name.charCodeAt(G.gzindex++):0,N(G,F)}while(0!==F);G.gzhead.hcrc&&G.pending>L&&(I.adler=l(I.adler,G.pending_buf,G.pending-L,L)),0===F&&(G.gzindex=0,G.status=91)}else G.status=91;if(91===G.status)if(G.gzhead.comment){L=G.pending;do{if(G.pending===G.pending_buf_size&&(G.gzhead.hcrc&&G.pending>L&&(I.adler=l(I.adler,G.pending_buf,G.pending-L,L)),D(I),L=G.pending,G.pending===G.pending_buf_size)){F=1;break}F=G.gzindex<G.gzhead.comment.length?255&G.gzhead.comment.charCodeAt(G.gzindex++):0,N(G,F)}while(0!==F);G.gzhead.hcrc&&G.pending>L&&(I.adler=l(I.adler,G.pending_buf,G.pending-L,L)),0===F&&(G.status=u)}else G.status=u;if(G.status===u&&(G.gzhead.hcrc?(G.pending+2>G.pending_buf_size&&D(I),G.pending+2<=G.pending_buf_size&&(N(G,255&I.adler),N(G,I.adler>>8&255),I.adler=0,G.status=A)):G.status=A),0!==G.pending){if(D(I),0===I.avail_out)return G.last_flush=-1,H}else if(0===I.avail_in&&w(x)<=w(B)&&x!==v)return O(I,y);if(G.status===mI&&0!==I.avail_in)return O(I,y);if(0!==I.avail_in||0!==G.lookahead||x!==Q&&G.status!==mI){let L=G.strategy===t?((I,x)=>{let L;for(;;){if(0===I.lookahead&&(J(I),0===I.lookahead)){if(x===Q)return 1;break}if(I.match_length=0,L=Y(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++,L&&(r(I,!1),0===I.strm.avail_out))return 1}return I.insert=0,x===v?(r(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(r(I,!1),0===I.strm.avail_out)?1:2})(G,x):G.strategy===f?((I,x)=>{let L,F,X,G;const p=I.window;for(;;){if(I.lookahead<=M){if(J(I),I.lookahead<=M&&x===Q)return 1;if(0===I.lookahead)break}if(I.match_length=0,I.lookahead>=3&&I.strstart>0&&(X=I.strstart-1,F=p[X],F===p[++X]&&F===p[++X]&&F===p[++X])){G=I.strstart+M;do{}while(F===p[++X]&&F===p[++X]&&F===p[++X]&&F===p[++X]&&F===p[++X]&&F===p[++X]&&F===p[++X]&&F===p[++X]&&X<G);I.match_length=M-(G-X),I.match_length>I.lookahead&&(I.match_length=I.lookahead)}if(I.match_length>=3?(L=Y(I,1,I.match_length-3),I.lookahead-=I.match_length,I.strstart+=I.match_length,I.match_length=0):(L=Y(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++),L&&(r(I,!1),0===I.strm.avail_out))return 1}return I.insert=0,x===v?(r(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(r(I,!1),0===I.strm.avail_out)?1:2})(G,x):V[G.level].func(G,x);if(3!==L&&4!==L||(G.status=mI),1===L||3===L)return 0===I.avail_out&&(G.last_flush=-1),H;if(2===L&&(x===e?p(G):x!==z&&(X(G,0,0,!1),x===g&&(k(G.head),0===G.lookahead&&(G.strstart=0,G.block_start=0,G.insert=0))),D(I),0===I.avail_out))return G.last_flush=-1,H}return x!==v?H:G.wrap<=0?s:(2===G.wrap?(N(G,255&I.adler),N(G,I.adler>>8&255),N(G,I.adler>>16&255),N(G,I.adler>>24&255),N(G,255&I.total_in),N(G,I.total_in>>8&255),N(G,I.total_in>>16&255),N(G,I.total_in>>24&255)):(S(G,I.adler>>>16),S(G,65535&I.adler)),D(I),G.wrap>0&&(G.wrap=-G.wrap),0!==G.pending?H:s)},I.exports.deflateEnd=I=>{if(!I||!I.state)return U;const x=I.state.status;return 42!==x&&69!==x&&73!==x&&91!==x&&x!==u&&x!==A&&x!==mI?O(I,U):(I.state=null,x===A?O(I,q):H)},I.exports.deflateSetDictionary=(I,x)=>{let L=x.length;if(!I||!I.state)return U;const F=I.state,X=F.wrap;if(2===X||1===X&&42!==F.status||F.lookahead)return U;if(1===X&&(I.adler=B(I.adler,x,L,0)),F.wrap=0,L>=F.w_size){0===X&&(k(F.head),F.strstart=0,F.block_start=0,F.insert=0);let I=new Uint8Array(F.w_size);I.set(x.subarray(L-F.w_size,L),0),x=I,L=F.w_size}const G=I.avail_in,Y=I.next_in,p=I.input;for(I.avail_in=L,I.next_in=0,I.input=x,J(F);F.lookahead>=3;){let I=F.strstart,x=F.lookahead-2;do{F.ins_h=a(F,F.ins_h,F.window[I+3-1]),F.prev[I&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=I,I++}while(--x);F.strstart=I,F.lookahead=2,J(F)}return F.strstart+=F.lookahead,F.block_start=F.strstart,F.insert=F.lookahead,F.lookahead=0,F.match_length=F.prev_length=2,F.match_available=0,I.next_in=Y,I.input=p,I.avail_in=G,F.wrap=X,H},I.exports.deflateInfo="pako deflate (from Nodeca project)"},14976:I=>{"use strict";I.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},14966:I=>{"use strict";I.exports=function(I,x){let L,F,X,G,Y,p,B,l,W,Q,e,g,v,z,H,s,U,q,y,T,Z,t,f,R;const n=I.state;L=I.next_in,f=I.input,F=L+(I.avail_in-5),X=I.next_out,R=I.output,G=X-(x-I.avail_out),Y=X+(I.avail_out-257),p=n.dmax,B=n.wsize,l=n.whave,W=n.wnext,Q=n.window,e=n.hold,g=n.bits,v=n.lencode,z=n.distcode,H=(1<<n.lenbits)-1,s=(1<<n.distbits)-1;I:do{g<15&&(e+=f[L++]<<g,g+=8,e+=f[L++]<<g,g+=8),U=v[e&H];x:for(;;){if(q=U>>>24,e>>>=q,g-=q,q=U>>>16&255,0===q)R[X++]=65535&U;else{if(!(16&q)){if(0===(64&q)){U=v[(65535&U)+(e&(1<<q)-1)];continue x}if(32&q){n.mode=12;break I}I.Qx="invalid literal/length code",n.mode=30;break I}y=65535&U,q&=15,q&&(g<q&&(e+=f[L++]<<g,g+=8),y+=e&(1<<q)-1,e>>>=q,g-=q),g<15&&(e+=f[L++]<<g,g+=8,e+=f[L++]<<g,g+=8),U=z[e&s];L:for(;;){if(q=U>>>24,e>>>=q,g-=q,q=U>>>16&255,!(16&q)){if(0===(64&q)){U=z[(65535&U)+(e&(1<<q)-1)];continue L}I.Qx="invalid distance code",n.mode=30;break I}if(T=65535&U,q&=15,g<q&&(e+=f[L++]<<g,g+=8,g<q&&(e+=f[L++]<<g,g+=8)),T+=e&(1<<q)-1,T>p){I.Qx="invalid distance too far back",n.mode=30;break I}if(e>>>=q,g-=q,q=X-G,T>q){if(q=T-q,q>l&&n.sane){I.Qx="invalid distance too far back",n.mode=30;break I}if(Z=0,t=Q,0===W){if(Z+=B-q,q<y){y-=q;do{R[X++]=Q[Z++]}while(--q);Z=X-T,t=R}}else if(W<q){if(Z+=B+W-q,q-=W,q<y){y-=q;do{R[X++]=Q[Z++]}while(--q);if(Z=0,W<y){q=W,y-=q;do{R[X++]=Q[Z++]}while(--q);Z=X-T,t=R}}}else if(Z+=W-q,q<y){y-=q;do{R[X++]=Q[Z++]}while(--q);Z=X-T,t=R}for(;y>2;)R[X++]=t[Z++],R[X++]=t[Z++],R[X++]=t[Z++],y-=3;y&&(R[X++]=t[Z++],y>1&&(R[X++]=t[Z++]))}else{Z=X-T;do{R[X++]=R[Z++],R[X++]=R[Z++],R[X++]=R[Z++],y-=3}while(y>2);y&&(R[X++]=R[Z++],y>1&&(R[X++]=R[Z++]))}break}}break}}while(L<F&&X<Y);y=g>>3,L-=y,g-=y<<3,e&=(1<<g)-1,I.next_in=L,I.next_out=X,I.avail_in=L<F?F-L+5:5-(L-F),I.avail_out=X<Y?Y-X+257:257-(X-Y),n.hold=e,n.bits=g}},14958:(I,x,L)=>{"use strict";const F=L(14912),X=L(14921),G=L(14966),Y=L(14972),{Z_FINISH:p,Z_BLOCK:B,Z_TREES:l,Z_OK:W,Z_STREAM_END:Q,Z_NEED_DICT:e,Z_STREAM_ERROR:g,Z_DATA_ERROR:v,Z_MEM_ERROR:z,Z_BUF_ERROR:H,Z_DEFLATED:s}=L(14926),U=12,q=30,y=I=>(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24);function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Z=I=>{if(!I||!I.state)return g;const x=I.state;return I.total_in=I.total_out=x.total=0,I.Qx="",x.wrap&&(I.adler=1&x.wrap),x.mode=1,x.last=0,x.havedict=0,x.dmax=32768,x.head=null,x.hold=0,x.bits=0,x.lencode=x.lendyn=new Int32Array(852),x.distcode=x.distdyn=new Int32Array(592),x.sane=1,x.back=-1,W},t=I=>{if(!I||!I.state)return g;const x=I.state;return x.wsize=0,x.whave=0,x.wnext=0,Z(I)},f=(I,x)=>{let L;if(!I||!I.state)return g;const F=I.state;return x<0?(L=0,x=-x):(L=1+(x>>4),x<48&&(x&=15)),x&&(x<8||x>15)?g:(null!==F.window&&F.wbits!==x&&(F.window=null),F.wrap=L,F.wbits=x,t(I))},R=(I,x)=>{if(!I)return g;const L=new T;I.state=L,L.window=null;const F=f(I,x);return F!==W&&(I.state=null),F};let n,P,d=!0;const M=I=>{if(d){n=new Int32Array(512),P=new Int32Array(32);let x=0;for(;x<144;)I.lens[x++]=8;for(;x<256;)I.lens[x++]=9;for(;x<280;)I.lens[x++]=7;for(;x<288;)I.lens[x++]=8;for(Y(1,I.lens,0,288,n,0,I.work,{bits:9}),x=0;x<32;)I.lens[x++]=5;Y(2,I.lens,0,32,P,0,I.work,{bits:5}),d=!1}I.lencode=n,I.lenbits=9,I.distcode=P,I.distbits=5},K=(I,x,L,F)=>{let X;const G=I.state;return null===G.window&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new Uint8Array(G.wsize)),F>=G.wsize?(G.window.set(x.subarray(L-G.wsize,L),0),G.wnext=0,G.whave=G.wsize):(X=G.wsize-G.wnext,X>F&&(X=F),G.window.set(x.subarray(L-F,L-F+X),G.wnext),(F-=X)?(G.window.set(x.subarray(L-F,L),0),G.wnext=F,G.whave=G.wsize):(G.wnext+=X,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=X))),0};I.exports.inflateReset=t,I.exports.inflateReset2=f,I.exports.inflateResetKeep=Z,I.exports.inflateInit=I=>R(I,15),I.exports.inflateInit2=R,I.exports.inflate=(I,x)=>{let L,T,Z,t,f,R,n,P,d,u,A,mI,O,w,k,a,D,r,N,S,c,o,J=0;const h=new Uint8Array(4);let E,i;const V=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!I||!I.state||!I.output||!I.input&&0!==I.avail_in)return g;L=I.state,L.mode===U&&(L.mode=13),f=I.next_out,Z=I.output,n=I.avail_out,t=I.next_in,T=I.input,R=I.avail_in,P=L.hold,d=L.bits,u=R,A=n,o=W;I:for(;;)switch(L.mode){case 1:if(0===L.wrap){L.mode=13;break}for(;d<16;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}if(2&L.wrap&&35615===P){L.check=0,h[0]=255&P,h[1]=P>>>8&255,L.check=X(L.check,h,2,0),P=0,d=0,L.mode=2;break}if(L.flags=0,L.head&&(L.head.done=!1),!(1&L.wrap)||(((255&P)<<8)+(P>>8))%31){I.Qx="incorrect header check",L.mode=q;break}if((15&P)!==s){I.Qx="unknown compression method",L.mode=q;break}if(P>>>=4,d-=4,c=8+(15&P),0===L.wbits)L.wbits=c;else if(c>L.wbits){I.Qx="invalid window size",L.mode=q;break}L.dmax=1<<L.wbits,I.adler=L.check=1,L.mode=512&P?10:U,P=0,d=0;break;case 2:for(;d<16;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}if(L.flags=P,(255&L.flags)!==s){I.Qx="unknown compression method",L.mode=q;break}if(57344&L.flags){I.Qx="unknown header flags set",L.mode=q;break}L.head&&(L.head.text=P>>8&1),512&L.flags&&(h[0]=255&P,h[1]=P>>>8&255,L.check=X(L.check,h,2,0)),P=0,d=0,L.mode=3;case 3:for(;d<32;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}L.head&&(L.head.time=P),512&L.flags&&(h[0]=255&P,h[1]=P>>>8&255,h[2]=P>>>16&255,h[3]=P>>>24&255,L.check=X(L.check,h,4,0)),P=0,d=0,L.mode=4;case 4:for(;d<16;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}L.head&&(L.head.xflags=255&P,L.head.os=P>>8),512&L.flags&&(h[0]=255&P,h[1]=P>>>8&255,L.check=X(L.check,h,2,0)),P=0,d=0,L.mode=5;case 5:if(1024&L.flags){for(;d<16;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}L.length=P,L.head&&(L.head.extra_len=P),512&L.flags&&(h[0]=255&P,h[1]=P>>>8&255,L.check=X(L.check,h,2,0)),P=0,d=0}else L.head&&(L.head.extra=null);L.mode=6;case 6:if(1024&L.flags&&(mI=L.length,mI>R&&(mI=R),mI&&(L.head&&(c=L.head.extra_len-L.length,L.head.extra||(L.head.extra=new Uint8Array(L.head.extra_len)),L.head.extra.set(T.subarray(t,t+mI),c)),512&L.flags&&(L.check=X(L.check,T,mI,t)),R-=mI,t+=mI,L.length-=mI),L.length))break I;L.length=0,L.mode=7;case 7:if(2048&L.flags){if(0===R)break I;mI=0;do{c=T[t+mI++],L.head&&c&&L.length<65536&&(L.head.name+=String.fromCharCode(c))}while(c&&mI<R);if(512&L.flags&&(L.check=X(L.check,T,mI,t)),R-=mI,t+=mI,c)break I}else L.head&&(L.head.name=null);L.length=0,L.mode=8;case 8:if(4096&L.flags){if(0===R)break I;mI=0;do{c=T[t+mI++],L.head&&c&&L.length<65536&&(L.head.comment+=String.fromCharCode(c))}while(c&&mI<R);if(512&L.flags&&(L.check=X(L.check,T,mI,t)),R-=mI,t+=mI,c)break I}else L.head&&(L.head.comment=null);L.mode=9;case 9:if(512&L.flags){for(;d<16;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}if(P!==(65535&L.check)){I.Qx="header crc mismatch",L.mode=q;break}P=0,d=0}L.head&&(L.head.hcrc=L.flags>>9&1,L.head.done=!0),I.adler=L.check=0,L.mode=U;break;case 10:for(;d<32;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}I.adler=L.check=y(P),P=0,d=0,L.mode=11;case 11:if(0===L.havedict)return I.next_out=f,I.avail_out=n,I.next_in=t,I.avail_in=R,L.hold=P,L.bits=d,e;I.adler=L.check=1,L.mode=U;case U:if(x===B||x===l)break I;case 13:if(L.last){P>>>=7&d,d-=7&d,L.mode=27;break}for(;d<3;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}switch(L.last=1&P,P>>>=1,d-=1,3&P){case 0:L.mode=14;break;case 1:if(M(L),L.mode=20,x===l){P>>>=2,d-=2;break I}break;case 2:L.mode=17;break;case 3:I.Qx="invalid block type",L.mode=q}P>>>=2,d-=2;break;case 14:for(P>>>=7&d,d-=7&d;d<32;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}if((65535&P)!==(P>>>16^65535)){I.Qx="invalid stored block lengths",L.mode=q;break}if(L.length=65535&P,P=0,d=0,L.mode=15,x===l)break I;case 15:L.mode=16;case 16:if(mI=L.length,mI){if(mI>R&&(mI=R),mI>n&&(mI=n),0===mI)break I;Z.set(T.subarray(t,t+mI),f),R-=mI,t+=mI,n-=mI,f+=mI,L.length-=mI;break}L.mode=U;break;case 17:for(;d<14;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}if(L.nlen=257+(31&P),P>>>=5,d-=5,L.ndist=1+(31&P),P>>>=5,d-=5,L.ncode=4+(15&P),P>>>=4,d-=4,L.nlen>286||L.ndist>30){I.Qx="too many length or distance symbols",L.mode=q;break}L.have=0,L.mode=18;case 18:for(;L.have<L.ncode;){for(;d<3;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}L.lens[V[L.have++]]=7&P,P>>>=3,d-=3}for(;L.have<19;)L.lens[V[L.have++]]=0;if(L.lencode=L.lendyn,L.lenbits=7,E={bits:L.lenbits},o=Y(0,L.lens,0,19,L.lencode,0,L.work,E),L.lenbits=E.bits,o){I.Qx="invalid code lengths set",L.mode=q;break}L.have=0,L.mode=19;case 19:for(;L.have<L.nlen+L.ndist;){for(;J=L.lencode[P&(1<<L.lenbits)-1],k=J>>>24,a=J>>>16&255,D=65535&J,!(k<=d);){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}if(D<16)P>>>=k,d-=k,L.lens[L.have++]=D;else{if(16===D){for(i=k+2;d<i;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}if(P>>>=k,d-=k,0===L.have){I.Qx="invalid bit length repeat",L.mode=q;break}c=L.lens[L.have-1],mI=3+(3&P),P>>>=2,d-=2}else if(17===D){for(i=k+3;d<i;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}P>>>=k,d-=k,c=0,mI=3+(7&P),P>>>=3,d-=3}else{for(i=k+7;d<i;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}P>>>=k,d-=k,c=0,mI=11+(127&P),P>>>=7,d-=7}if(L.have+mI>L.nlen+L.ndist){I.Qx="invalid bit length repeat",L.mode=q;break}for(;mI--;)L.lens[L.have++]=c}}if(L.mode===q)break;if(0===L.lens[256]){I.Qx="invalid code -- missing end-of-block",L.mode=q;break}if(L.lenbits=9,E={bits:L.lenbits},o=Y(1,L.lens,0,L.nlen,L.lencode,0,L.work,E),L.lenbits=E.bits,o){I.Qx="invalid literal/lengths set",L.mode=q;break}if(L.distbits=6,L.distcode=L.distdyn,E={bits:L.distbits},o=Y(2,L.lens,L.nlen,L.ndist,L.distcode,0,L.work,E),L.distbits=E.bits,o){I.Qx="invalid distances set",L.mode=q;break}if(L.mode=20,x===l)break I;case 20:L.mode=21;case 21:if(R>=6&&n>=258){I.next_out=f,I.avail_out=n,I.next_in=t,I.avail_in=R,L.hold=P,L.bits=d,G(I,A),f=I.next_out,Z=I.output,n=I.avail_out,t=I.next_in,T=I.input,R=I.avail_in,P=L.hold,d=L.bits,L.mode===U&&(L.back=-1);break}for(L.back=0;J=L.lencode[P&(1<<L.lenbits)-1],k=J>>>24,a=J>>>16&255,D=65535&J,!(k<=d);){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}if(a&&0===(240&a)){for(r=k,N=a,S=D;J=L.lencode[S+((P&(1<<r+N)-1)>>r)],k=J>>>24,a=J>>>16&255,D=65535&J,!(r+k<=d);){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}P>>>=r,d-=r,L.back+=r}if(P>>>=k,d-=k,L.back+=k,L.length=D,0===a){L.mode=26;break}if(32&a){L.back=-1,L.mode=U;break}if(64&a){I.Qx="invalid literal/length code",L.mode=q;break}L.extra=15&a,L.mode=22;case 22:if(L.extra){for(i=L.extra;d<i;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}L.length+=P&(1<<L.extra)-1,P>>>=L.extra,d-=L.extra,L.back+=L.extra}L.was=L.length,L.mode=23;case 23:for(;J=L.distcode[P&(1<<L.distbits)-1],k=J>>>24,a=J>>>16&255,D=65535&J,!(k<=d);){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}if(0===(240&a)){for(r=k,N=a,S=D;J=L.distcode[S+((P&(1<<r+N)-1)>>r)],k=J>>>24,a=J>>>16&255,D=65535&J,!(r+k<=d);){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}P>>>=r,d-=r,L.back+=r}if(P>>>=k,d-=k,L.back+=k,64&a){I.Qx="invalid distance code",L.mode=q;break}L.offset=D,L.extra=15&a,L.mode=24;case 24:if(L.extra){for(i=L.extra;d<i;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}L.offset+=P&(1<<L.extra)-1,P>>>=L.extra,d-=L.extra,L.back+=L.extra}if(L.offset>L.dmax){I.Qx="invalid distance too far back",L.mode=q;break}L.mode=25;case 25:if(0===n)break I;if(mI=A-n,L.offset>mI){if(mI=L.offset-mI,mI>L.whave&&L.sane){I.Qx="invalid distance too far back",L.mode=q;break}mI>L.wnext?(mI-=L.wnext,O=L.wsize-mI):O=L.wnext-mI,mI>L.length&&(mI=L.length),w=L.window}else w=Z,O=f-L.offset,mI=L.length;mI>n&&(mI=n),n-=mI,L.length-=mI;do{Z[f++]=w[O++]}while(--mI);0===L.length&&(L.mode=21);break;case 26:if(0===n)break I;Z[f++]=L.length,n--,L.mode=21;break;case 27:if(L.wrap){for(;d<32;){if(0===R)break I;R--,P|=T[t++]<<d,d+=8}if(A-=n,I.total_out+=A,L.total+=A,A&&(I.adler=L.check=L.flags?X(L.check,Z,A,f-A):F(L.check,Z,A,f-A)),A=n,(L.flags?P:y(P))!==L.check){I.Qx="incorrect data check",L.mode=q;break}P=0,d=0}L.mode=28;case 28:if(L.wrap&&L.flags){for(;d<32;){if(0===R)break I;R--,P+=T[t++]<<d,d+=8}if(P!==(4294967295&L.total)){I.Qx="incorrect length check",L.mode=q;break}P=0,d=0}L.mode=29;case 29:o=Q;break I;case q:o=v;break I;case 31:return z;default:return g}return I.next_out=f,I.avail_out=n,I.next_in=t,I.avail_in=R,L.hold=P,L.bits=d,(L.wsize||A!==I.avail_out&&L.mode<q&&(L.mode<27||x!==p))&&K(I,I.output,I.next_out,A-I.avail_out)?(L.mode=31,z):(u-=I.avail_in,A-=I.avail_out,I.total_in+=u,I.total_out+=A,L.total+=A,L.wrap&&A&&(I.adler=L.check=L.flags?X(L.check,Z,A,I.next_out-A):F(L.check,Z,A,I.next_out-A)),I.data_type=L.bits+(L.last?64:0)+(L.mode===U?128:0)+(20===L.mode||15===L.mode?256:0),(0===u&&0===A||x===p)&&o===W&&(o=H),o)},I.exports.inflateEnd=I=>{if(!I||!I.state)return g;let x=I.state;return x.window&&(x.window=null),I.state=null,W},I.exports.inflateGetHeader=(I,x)=>{if(!I||!I.state)return g;const L=I.state;return 0===(2&L.wrap)?g:(L.head=x,x.done=!1,W)},I.exports.inflateSetDictionary=(I,x)=>{const L=x.length;let X,G,Y;return I&&I.state?(X=I.state,0!==X.wrap&&11!==X.mode?g:11===X.mode&&(G=1,G=F(G,x,L,0),G!==X.check)?v:(Y=K(I,x,L,L),Y?(X.mode=31,z):(X.havedict=1,W))):g},I.exports.inflateInfo="pako inflate (from Nodeca project)"},14972:I=>{"use strict";const x=15,L=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),F=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),X=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),G=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);I.exports=(I,Y,p,B,l,W,Q,e)=>{const g=e.bits;let v,z,H,s,U,q,y=0,T=0,Z=0,t=0,f=0,R=0,n=0,P=0,d=0,M=0,K=null,u=0;const A=new Uint16Array(16),mI=new Uint16Array(16);let O,w,k,a=null,D=0;for(y=0;y<=x;y++)A[y]=0;for(T=0;T<B;T++)A[Y[p+T]]++;for(f=g,t=x;t>=1&&0===A[t];t--);if(f>t&&(f=t),0===t)return l[W++]=20971520,l[W++]=20971520,e.bits=1,0;for(Z=1;Z<t&&0===A[Z];Z++);for(f<Z&&(f=Z),P=1,y=1;y<=x;y++)if(P<<=1,P-=A[y],P<0)return-1;if(P>0&&(0===I||1!==t))return-1;for(mI[1]=0,y=1;y<x;y++)mI[y+1]=mI[y]+A[y];for(T=0;T<B;T++)0!==Y[p+T]&&(Q[mI[Y[p+T]]++]=T);if(0===I?(K=a=Q,q=19):1===I?(K=L,u-=257,a=F,D-=257,q=256):(K=X,a=G,q=-1),M=0,T=0,y=Z,U=W,R=f,n=0,H=-1,d=1<<f,s=d-1,1===I&&d>852||2===I&&d>592)return 1;for(;;){O=y-n,Q[T]<q?(w=0,k=Q[T]):Q[T]>q?(w=a[D+Q[T]],k=K[u+Q[T]]):(w=96,k=0),v=1<<y-n,z=1<<R,Z=z;do{z-=v,l[U+(M>>n)+z]=O<<24|w<<16|k}while(0!==z);for(v=1<<y-1;M&v;)v>>=1;if(0!==v?(M&=v-1,M+=v):M=0,T++,0===--A[y]){if(y===t)break;y=Y[p+Q[T]]}if(y>f&&(M&s)!==H){for(0===n&&(n=f),U+=Z,R=y-n,P=1<<R;R+n<t&&(P-=A[R+n],!(P<=0));)R++,P<<=1;if(d+=1<<R,1===I&&d>852||2===I&&d>592)return 1;H=M&s,l[H]=f<<24|R<<16|U-W}}return 0!==M&&(l[U+M]=y-n<<24|64<<16),e.bits=f,0}},14923:I=>{"use strict";I.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},14904:I=>{"use strict";function x(I){let x=I.length;for(;--x>=0;)I[x]=0}const L=256,F=286,X=30,G=15,Y=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),p=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),B=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),l=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),W=new Array(576);x(W);const Q=new Array(60);x(Q);const e=new Array(512);x(e);const g=new Array(256);x(g);const v=new Array(29);x(v);const z=new Array(X);function H(I,x,L,F,X){this.static_tree=I,this.extra_bits=x,this.extra_base=L,this.elems=F,this.max_length=X,this.has_stree=I&&I.length}let s,U,q;function y(I,x){this.dyn_tree=I,this.max_code=0,this.stat_desc=x}x(z);const T=I=>I<256?e[I]:e[256+(I>>>7)],Z=(I,x)=>{I.pending_buf[I.pending++]=255&x,I.pending_buf[I.pending++]=x>>>8&255},t=(I,x,L)=>{I.bi_valid>16-L?(I.bi_buf|=x<<I.bi_valid&65535,Z(I,I.bi_buf),I.bi_buf=x>>16-I.bi_valid,I.bi_valid+=L-16):(I.bi_buf|=x<<I.bi_valid&65535,I.bi_valid+=L)},f=(I,x,L)=>{t(I,L[2*x],L[2*x+1])},R=(I,x)=>{let L=0;do{L|=1&I,I>>>=1,L<<=1}while(--x>0);return L>>>1},n=(I,x,L)=>{const F=new Array(16);let X,Y,p=0;for(X=1;X<=G;X++)F[X]=p=p+L[X-1]<<1;for(Y=0;Y<=x;Y++){let x=I[2*Y+1];0!==x&&(I[2*Y]=R(F[x]++,x))}},P=I=>{let x;for(x=0;x<F;x++)I.dyn_ltree[2*x]=0;for(x=0;x<X;x++)I.dyn_dtree[2*x]=0;for(x=0;x<19;x++)I.bl_tree[2*x]=0;I.dyn_ltree[512]=1,I.opt_len=I.static_len=0,I.last_lit=I.matches=0},d=I=>{I.bi_valid>8?Z(I,I.bi_buf):I.bi_valid>0&&(I.pending_buf[I.pending++]=I.bi_buf),I.bi_buf=0,I.bi_valid=0},M=(I,x,L,F)=>{const X=2*x,G=2*L;return I[X]<I[G]||I[X]===I[G]&&F[x]<=F[L]},K=(I,x,L)=>{const F=I.heap[L];let X=L<<1;for(;X<=I.heap_len&&(X<I.heap_len&&M(x,I.heap[X+1],I.heap[X],I.depth)&&X++,!M(x,F,I.heap[X],I.depth));)I.heap[L]=I.heap[X],L=X,X<<=1;I.heap[L]=F},u=(I,x,F)=>{let X,G,B,l,W=0;if(0!==I.last_lit)do{X=I.pending_buf[I.d_buf+2*W]<<8|I.pending_buf[I.d_buf+2*W+1],G=I.pending_buf[I.l_buf+W],W++,0===X?f(I,G,x):(B=g[G],f(I,B+L+1,x),l=Y[B],0!==l&&(G-=v[B],t(I,G,l)),X--,B=T(X),f(I,B,F),l=p[B],0!==l&&(X-=z[B],t(I,X,l)))}while(W<I.last_lit);f(I,256,x)},A=(I,x)=>{const L=x.dyn_tree,F=x.stat_desc.static_tree,X=x.stat_desc.has_stree,Y=x.stat_desc.elems;let p,B,l,W=-1;for(I.heap_len=0,I.heap_max=573,p=0;p<Y;p++)0!==L[2*p]?(I.heap[++I.heap_len]=W=p,I.depth[p]=0):L[2*p+1]=0;for(;I.heap_len<2;)l=I.heap[++I.heap_len]=W<2?++W:0,L[2*l]=1,I.depth[l]=0,I.opt_len--,X&&(I.static_len-=F[2*l+1]);for(x.max_code=W,p=I.heap_len>>1;p>=1;p--)K(I,L,p);l=Y;do{p=I.heap[1],I.heap[1]=I.heap[I.heap_len--],K(I,L,1),B=I.heap[1],I.heap[--I.heap_max]=p,I.heap[--I.heap_max]=B,L[2*l]=L[2*p]+L[2*B],I.depth[l]=(I.depth[p]>=I.depth[B]?I.depth[p]:I.depth[B])+1,L[2*p+1]=L[2*B+1]=l,I.heap[1]=l++,K(I,L,1)}while(I.heap_len>=2);I.heap[--I.heap_max]=I.heap[1],((I,x)=>{const L=x.dyn_tree,F=x.max_code,X=x.stat_desc.static_tree,Y=x.stat_desc.has_stree,p=x.stat_desc.extra_bits,B=x.stat_desc.extra_base,l=x.stat_desc.max_length;let W,Q,e,g,v,z,H=0;for(g=0;g<=G;g++)I.bl_count[g]=0;for(L[2*I.heap[I.heap_max]+1]=0,W=I.heap_max+1;W<573;W++)Q=I.heap[W],g=L[2*L[2*Q+1]+1]+1,g>l&&(g=l,H++),L[2*Q+1]=g,Q>F||(I.bl_count[g]++,v=0,Q>=B&&(v=p[Q-B]),z=L[2*Q],I.opt_len+=z*(g+v),Y&&(I.static_len+=z*(X[2*Q+1]+v)));if(0!==H){do{for(g=l-1;0===I.bl_count[g];)g--;I.bl_count[g]--,I.bl_count[g+1]+=2,I.bl_count[l]--,H-=2}while(H>0);for(g=l;0!==g;g--)for(Q=I.bl_count[g];0!==Q;)e=I.heap[--W],e>F||(L[2*e+1]!==g&&(I.opt_len+=(g-L[2*e+1])*L[2*e],L[2*e+1]=g),Q--)}})(I,x),n(L,W,I.bl_count)},mI=(I,x,L)=>{let F,X,G=-1,Y=x[1],p=0,B=7,l=4;for(0===Y&&(B=138,l=3),x[2*(L+1)+1]=65535,F=0;F<=L;F++)X=Y,Y=x[2*(F+1)+1],++p<B&&X===Y||(p<l?I.bl_tree[2*X]+=p:0!==X?(X!==G&&I.bl_tree[2*X]++,I.bl_tree[32]++):p<=10?I.bl_tree[34]++:I.bl_tree[36]++,p=0,G=X,0===Y?(B=138,l=3):X===Y?(B=6,l=3):(B=7,l=4))},O=(I,x,L)=>{let F,X,G=-1,Y=x[1],p=0,B=7,l=4;for(0===Y&&(B=138,l=3),F=0;F<=L;F++)if(X=Y,Y=x[2*(F+1)+1],!(++p<B&&X===Y)){if(p<l)do{f(I,X,I.bl_tree)}while(0!==--p);else 0!==X?(X!==G&&(f(I,X,I.bl_tree),p--),f(I,16,I.bl_tree),t(I,p-3,2)):p<=10?(f(I,17,I.bl_tree),t(I,p-3,3)):(f(I,18,I.bl_tree),t(I,p-11,7));p=0,G=X,0===Y?(B=138,l=3):X===Y?(B=6,l=3):(B=7,l=4)}};let w=!1;const k=(I,x,L,F)=>{t(I,0+(F?1:0),3),((I,x,L,F)=>{d(I),F&&(Z(I,L),Z(I,~L)),I.pending_buf.set(I.window.subarray(x,x+L),I.pending),I.pending+=L})(I,x,L,!0)};I.exports._tr_init=I=>{w||((()=>{let I,x,L,l,y;const T=new Array(16);for(L=0,l=0;l<28;l++)for(v[l]=L,I=0;I<1<<Y[l];I++)g[L++]=l;for(g[L-1]=l,y=0,l=0;l<16;l++)for(z[l]=y,I=0;I<1<<p[l];I++)e[y++]=l;for(y>>=7;l<X;l++)for(z[l]=y<<7,I=0;I<1<<p[l]-7;I++)e[256+y++]=l;for(x=0;x<=G;x++)T[x]=0;for(I=0;I<=143;)W[2*I+1]=8,I++,T[8]++;for(;I<=255;)W[2*I+1]=9,I++,T[9]++;for(;I<=279;)W[2*I+1]=7,I++,T[7]++;for(;I<=287;)W[2*I+1]=8,I++,T[8]++;for(n(W,287,T),I=0;I<X;I++)Q[2*I+1]=5,Q[2*I]=R(I,5);s=new H(W,Y,257,F,G),U=new H(Q,p,0,X,G),q=new H(new Array(0),B,0,19,7)})(),w=!0),I.l_desc=new y(I.dyn_ltree,s),I.d_desc=new y(I.dyn_dtree,U),I.bl_desc=new y(I.bl_tree,q),I.bi_buf=0,I.bi_valid=0,P(I)},I.exports._tr_stored_block=k,I.exports._tr_flush_block=(I,x,F,X)=>{let G,Y,p=0;I.level>0?(2===I.strm.data_type&&(I.strm.data_type=(I=>{let x,F=4093624447;for(x=0;x<=31;x++,F>>>=1)if(1&F&&0!==I.dyn_ltree[2*x])return 0;if(0!==I.dyn_ltree[18]||0!==I.dyn_ltree[20]||0!==I.dyn_ltree[26])return 1;for(x=32;x<L;x++)if(0!==I.dyn_ltree[2*x])return 1;return 0})(I)),A(I,I.l_desc),A(I,I.d_desc),p=(I=>{let x;for(mI(I,I.dyn_ltree,I.l_desc.max_code),mI(I,I.dyn_dtree,I.d_desc.max_code),A(I,I.bl_desc),x=18;x>=3&&0===I.bl_tree[2*l[x]+1];x--);return I.opt_len+=3*(x+1)+5+5+4,x})(I),G=I.opt_len+3+7>>>3,Y=I.static_len+3+7>>>3,Y<=G&&(G=Y)):G=Y=F+5,F+4<=G&&-1!==x?k(I,x,F,X):4===I.strategy||Y===G?(t(I,2+(X?1:0),3),u(I,W,Q)):(t(I,4+(X?1:0),3),((I,x,L,F)=>{let X;for(t(I,x-257,5),t(I,L-1,5),t(I,F-4,4),X=0;X<F;X++)t(I,I.bl_tree[2*l[X]+1],3);O(I,I.dyn_ltree,x-1),O(I,I.dyn_dtree,L-1)})(I,I.l_desc.max_code+1,I.d_desc.max_code+1,p+1),u(I,I.dyn_ltree,I.dyn_dtree)),P(I),X&&d(I)},I.exports._tr_tally=(I,x,F)=>(I.pending_buf[I.d_buf+2*I.last_lit]=x>>>8&255,I.pending_buf[I.d_buf+2*I.last_lit+1]=255&x,I.pending_buf[I.l_buf+I.last_lit]=255&F,I.last_lit++,0===x?I.dyn_ltree[2*F]++:(I.matches++,x--,I.dyn_ltree[2*(g[F]+L+1)]++,I.dyn_dtree[2*T(x)]++),I.last_lit===I.lit_bufsize-1),I.exports._tr_align=I=>{t(I,2,3),f(I,256,W),(I=>{16===I.bi_valid?(Z(I,I.bi_buf),I.bi_buf=0,I.bi_valid=0):I.bi_valid>=8&&(I.pending_buf[I.pending++]=255&I.bi_buf,I.bi_buf>>=8,I.bi_valid-=8)})(I)}},14940:I=>{"use strict";I.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Qx="",this.state=null,this.data_type=2,this.adler=0}},13751:I=>{function x(I,x,L){for(var F=I.length,X=-1/0,G=1/0,Y=0;Y<F;Y++){var p=(L[0][Y]-I[Y])/x[Y],B=(L[1][Y]-I[Y])/x[Y];if(p>B){var l=p;p=B,B=l}if(B<X||p>G)return 1/0;p>X&&(X=p),B<G&&(G=B)}return X>G?1/0:X}I.exports=function(I,L,F,X){var G=x(L,F,X);if(G===1/0)I=null;else{I=I||[];for(var Y=0;Y<L.length;Y++)I[Y]=L[Y]+F[Y]*G}return I},I.exports.distance=x},15042:(I,x,L)=>{"use strict";L.d(x,{d:()=>Y});var F=L(23);const X=F.useLayoutEffect;const G=function(I){var x=(0,F.useRef)(I);return X((function(){x.current=I})),x};var Y=function(I){var x=G(I);(0,F.Bx)((function(){var I=function(I){var L;if(null!=x.current&&(L=x.current(I)),I.defaultPrevented&&(I.returnValue=""),"string"===typeof L)return I.returnValue=L,L};return window.addEventListener("beforeunload",I),function(){window.removeEventListener("beforeunload",I)}}),[])}},15005:(I,x,L)=>{"use strict";var F=L(15013),X=Array.prototype.concat,G=Array.prototype.slice,Y=I.exports=function(I){for(var x=[],L=0,Y=I.length;L<Y;L++){var p=I[L];F(p)?x=X.call(x,G.call(p)):x.push(p)}return x};Y.wrap=function(I){return function(){return I(Y(arguments))}}},15013:I=>{I.exports=function(I){return!(!I||"string"===typeof I)&&(I instanceof Array||Array.isArray(I)||I.length>=0&&(I.splice instanceof Function||Object.getOwnPropertyDescriptor(I,I.length-1)&&"String"!==I.constructor.name))}},14853:(I,x,L)=>{var F=L(14857);function X(I){for(var x,L,X=0,G=I.length,Y=0;Y<I.length;){for(x=I[Y],L=0;Y<G&&I[Y]===x;)++Y,++L;X+=F.log2(L)/7|0,X+=F.log2(x>>>0)/7|0,X+=2}return X}x.size=X,x.encode=function(I,x){x||(x=new Uint8Array(X(I)));for(var L,F,G=0,Y=x.length,p=0;p<I.length;){for(L=I[p],F=0;p<I.length&&I[p]===L;)++p,++F;for(;G<Y&&F>=128;)x[G++]=128+(127&F),F>>>=7;if(G>=Y)throw new Error("RLE buffer overflow");for(x[G++]=F,L>>>=0;G<Y&&L>=128;)x[G++]=128+(127&L),L>>>=7;if(G>=Y)throw new Error("RLE buffer overflow");x[G++]=L}return x},x.decode=function(I,x){for(var L,F,X,G,Y=x.length,p=I.length,B=0,l=0;l<p;){for(L=0,F=0;l<p&&I[l]>=128;)L+=(127&I[l++])<<F,F+=7;if(L+=I[l++]<<F,l>=p)throw new Error("RLE buffer underrun");if(B+L>Y)throw new Error("Chunk buffer overflow");for(X=0,F=0;l<p&&I[l]>=128;)X+=(127&I[l++])<<F,F+=7;if(l>=p)throw new Error("RLE buffer underrun");for(X+=I[l++]<<F,G=0;G<L;++G)x[B++]=X}return x}},14857:(I,x)=>{"use strict";function L(I){var x=32;return(I&=-I)&&x--,65535&I&&(x-=16),16711935&I&&(x-=8),252645135&I&&(x-=4),858993459&I&&(x-=2),1431655765&I&&(x-=1),x}x.INT_BITS=32,x.INT_MAX=2147483647,x.INT_MIN=-1<<31,x.sign=function(I){return(I>0)-(I<0)},x.abs=function(I){var x=I>>31;return(I^x)-x},x.min=function(I,x){return x^(I^x)&-(I<x)},x.max=function(I,x){return I^(I^x)&-(I<x)},x.isPow2=function(I){return!(I&I-1)&&!!I},x.log2=function(I){var x,L;return x=(I>65535)<<4,x|=L=((I>>>=x)>255)<<3,x|=L=((I>>>=L)>15)<<2,(x|=L=((I>>>=L)>3)<<1)|(I>>>=L)>>1},x.log10=function(I){return I>=1e9?9:I>=1e8?8:I>=1e7?7:I>=1e6?6:I>=1e5?5:I>=1e4?4:I>=1e3?3:I>=100?2:I>=10?1:0},x.popCount=function(I){return 16843009*((I=(858993459&(I-=I>>>1&1431655765))+(I>>>2&858993459))+(I>>>4)&252645135)>>>24},x.countTrailingZeros=L,x.nextPow2=function(I){return I+=0===I,--I,I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)+1},x.prevPow2=function(I){return I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)-(I>>>1)},x.parity=function(I){return I^=I>>>16,I^=I>>>8,I^=I>>>4,27030>>>(I&=15)&1};var F=new Array(256);!function(I){for(var x=0;x<256;++x){var L=x,F=x,X=7;for(L>>>=1;L;L>>>=1)F<<=1,F|=1&L,--X;I[x]=F<<X&255}}(F),x.reverse=function(I){return F[255&I]<<24|F[I>>>8&255]<<16|F[I>>>16&255]<<8|F[I>>>24&255]},x.interleave2=function(I,x){return(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))|(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x&=65535)|x<<8))|x<<4))|x<<2))|x<<1))<<1},x.deinterleave2=function(I,x){return(I=65535&((I=16711935&((I=252645135&((I=858993459&((I=I>>>x&1431655765)|I>>>1))|I>>>2))|I>>>4))|I>>>16))<<16>>16},x.interleave3=function(I,x,L){return I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2),(I|=(x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2))<<1)|(L=1227133513&((L=3272356035&((L=251719695&((L=4278190335&((L&=1023)|L<<16))|L<<8))|L<<4))|L<<2))<<2},x.deinterleave3=function(I,x){return(I=1023&((I=4278190335&((I=251719695&((I=3272356035&((I=I>>>x&1227133513)|I>>>2))|I>>>4))|I>>>8))|I>>>16))<<22>>22},x.nextCombination=function(I){var x=I|I-1;return x+1|(~x&-~x)-1>>>L(I)+1}},14886:I=>{"use strict";I.exports=function(I,x,L,F){var X=self||window;try{try{var G;try{G=new X.Blob([I])}catch(l){(G=new(X.BlobBuilder||X.WebKitBlobBuilder||X.MozBlobBuilder||X.MSBlobBuilder)).append(I),G=G.getBlob()}var Y=X.URL||X.webkitURL,p=Y.createObjectURL(G),B=new X[x](p,L);return Y.revokeObjectURL(p),B}catch(l){return new X[x]("data:application/javascript,".concat(encodeURIComponent(I)),L)}}catch(l){if(!F)throw Error("Inline worker is not supported");return new X[x](F,L)}}},13732:(I,x,L)=>{"use strict";function F(I,x,L,F,X){var G={};return Object.keys(F).forEach((function(I){G[I]=F[I]})),G.enumerable=!!G.enumerable,G.configurable=!!G.configurable,("value"in G||G.initializer)&&(G.writable=!0),G=L.slice().reverse().reduce((function(L,F){return F(I,x,L)||L}),G),X&&void 0!==G.initializer&&(G.value=G.initializer?G.initializer.call(X):void 0,G.initializer=void 0),void 0===G.initializer&&(Object.defineProperty(I,x,G),G=null),G}L.d(x,{b:()=>F})},13728:(I,x,L)=>{"use strict";function F(I,x,L,F){L&&Object.defineProperty(I,x,{enumerable:L.enumerable,configurable:L.configurable,writable:L.writable,value:L.initializer?L.initializer.call(F):void 0})}L.d(x,{b:()=>F})},15056:(I,x,L)=>{"use strict";L.d(x,{e:()=>Y,f:()=>Q,g:()=>p,k:()=>G,l:()=>B,m:()=>X,p:()=>l,s:()=>W});var F=L(13194);class X{constructor(){this._easingMode=X.EASINGMODE_EASEIN}setEasingMode(I){const x=Math.min(Math.max(I,0),2);this._easingMode=x}getEasingMode(){return this._easingMode}easeInCore(I){throw new Error("You must implement this method")}ease(I){switch(this._easingMode){case X.EASINGMODE_EASEIN:return this.easeInCore(I);case X.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-I)}return I>=.5?.5*(1-this.easeInCore(2*(1-I)))+.5:.5*this.easeInCore(2*I)}}X.EASINGMODE_EASEIN=0,X.EASINGMODE_EASEOUT=1,X.EASINGMODE_EASEINOUT=2;class G extends X{easeInCore(I){return I=Math.max(0,Math.min(1,I)),1-Math.sqrt(1-I*I)}}class Y extends X{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=I}easeInCore(I){const x=Math.max(0,this.amplitude);return Math.pow(I,3)-I*x*Math.sin(3.141592653589793*I)}}class p extends X{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=I,this.bounciness=x}easeInCore(I){const x=Math.max(0,this.bounces);let L=this.bounciness;L<=1&&(L=1.001);const F=Math.pow(L,x),X=1-L,G=(1-F)/X+.5*F,Y=I*G,p=Math.log(-Y*(1-L)+1)/Math.log(L),B=Math.floor(p),l=B+1,W=(1-Math.pow(L,B))/(X*G),Q=.5*(W+(1-Math.pow(L,l))/(X*G)),e=I-Q,g=Q-W;return-Math.pow(1/L,x-B)/(g*g)*(e-g)*(e+g)}}class B extends X{easeInCore(I){return I*I*I}}class l extends X{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=I,this.springiness=x}easeInCore(I){let x;const L=Math.max(0,this.oscillations),F=Math.max(0,this.springiness);return x=0==F?I:(Math.exp(F*I)-1)/(Math.exp(F)-1),x*Math.sin((6.283185307179586*L+1.5707963267948966)*I)}}class W extends X{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=I}easeInCore(I){return this.exponent<=0?I:(Math.exp(this.exponent*I)-1)/(Math.exp(this.exponent)-1)}}class Q extends X{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=I,this.y1=x,this.x2=L,this.y2=F}easeInCore(I){return F.e.Interpolate(I,this.x1,this.y1,this.x2,this.y2)}}},14420:(I,x,L)=>{"use strict";L.d(x,{b:()=>Y});var F=L(12983),X=L(12996),G=L(13406);class Y extends G.c{get _matrix(){return this._compose(),this.Ag}set _matrix(I){(I.updateFlag!==this.Ag.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Ag.X(I),this._markAsDirtyAndDecompose())}constructor(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(I,x.tI(),!1),this.name=I,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=x,this.Ag=(null===X||void 0===X?void 0:X.clone())??F.Matrix.Identity(),this._restMatrix=G??this.Ag.clone(),this._bindMatrix=Y??this.Ag.clone(),this._index=p,this._absoluteMatrix=new F.Matrix,this._absoluteBindMatrix=new F.Matrix,this._absoluteInverseBindMatrix=new F.Matrix,this._finalMatrix=new F.Matrix,x.bones.push(this),this.setParent(L,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(I){this.setParent(I)}setParent(I){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==I){if(this.parent){const I=this.parent.children.indexOf(this);-1!==I&&this.parent.children.splice(I,1)}this._parentNode=I,this.parent&&this.parent.children.push(this),x&&this._updateAbsoluteBindMatrices(),this.nW()}}getLocalMatrix(){return this._compose(),this.Ag}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(I){this._restMatrix.X(I)}setRestPose(I){this.setRestMatrix(I)}getBindPose(){return this.getBindMatrix()}setBindMatrix(I){this.xB(I)}setBindPose(I){this.setBindMatrix(I)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const I=F.TmpVectors.sx[0],x=F.TmpVectors.Quaternion[0],L=F.TmpVectors.sx[1];this.getRestMatrix().decompose(I,x,L),this._linkedTransformNode.position.X(L),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??F.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.X(x),this._linkedTransformNode.pB.X(I)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(I){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=I,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.uB}set position(I){this._decompose(),this.uB.X(I),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(I){this.setRotation(I)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(I){this.setRotationQuaternion(I)}get pB(){return this.getScale()}set pB(I){this.setScale(I)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=F.sx.Zero(),this._localRotation=F.Quaternion.Zero(),this.uB=F.sx.Zero()),this.Ag.decompose(this._localScaling,this._localRotation,this.uB))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,F.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.uB,this.Ag)):this._needToCompose=!1)}xB(I){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.X(I),x&&this._updateAbsoluteBindMatrices(),L?this._matrix=I:this.nW()}_updateAbsoluteBindMatrices(I){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(I||(I=this._bindMatrix),this.parent?I.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.X(I),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),x)for(let L=0;L<this.children.length;L++)this.children[L]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}nW(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.nW(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.nW(),this._needToDecompose=!0}_updatePosition(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const G=this.getLocalMatrix();if(0==x)X?(G.addAtIndex(12,I.x),G.addAtIndex(13,I.y),G.addAtIndex(14,I.z)):G.setTranslationFromFloats(I.x,I.y,I.z);else{let x=null;L&&(x=L.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const p=Y._TmpMats[0],B=Y._TmpVecs[0];this.parent?L&&x?(p.X(this.parent.getAbsoluteMatrix()),p.multiplyToRef(x,p)):p.X(this.parent.getAbsoluteMatrix()):F.Matrix.IdentityToRef(p),X&&p.setTranslationFromFloats(0,0,0),p.invert(),F.sx.TransformCoordinatesToRef(I,p,B),X?(G.addAtIndex(12,B.x),G.addAtIndex(13,B.y),G.addAtIndex(14,B.z)):G.setTranslationFromFloats(B.x,B.y,B.z)}this._markAsDirtyAndDecompose()}translate(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;this._updatePosition(I,x,L,!0)}setPosition(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;this._updatePosition(I,x,L,!1)}setAbsolutePosition(I,x){this.setPosition(I,1,x)}scale(I,x,L){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const G=this.getLocalMatrix(),p=Y._TmpMats[0];F.Matrix.ScalingToRef(I,x,L,p),p.multiplyToRef(G,G),p.invert();for(const F of this.children){const X=F.getLocalMatrix();X.multiplyToRef(p,X),X.multiplyAtIndex(12,I),X.multiplyAtIndex(13,x),X.multiplyAtIndex(14,L),F._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),X)for(const F of this.children)F.scale(I,x,L,X)}setScale(I){this._decompose(),this._localScaling.X(I),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(I){this._decompose(),I.X(this._localScaling)}setYawPitchRoll(I,x,L){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4?arguments[4]:void 0;if(0===X){const p=Y._TmpQuat;return F.Quaternion.RotationYawPitchRollToRef(I,x,L,p),void this.setRotationQuaternion(p,X,G)}const p=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(p,G))return;const B=Y._TmpMats[1];F.Matrix.RotationYawPitchRollToRef(I,x,L,B),p.multiplyToRef(B,B),this._rotateWithMatrix(B,X,G)}rotate(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3?arguments[3]:void 0;const G=Y._TmpMats[0];G.setTranslationFromFloats(0,0,0),F.Matrix.RotationAxisToRef(I,x,G),this._rotateWithMatrix(G,L,X)}setAxisAngle(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3?arguments[3]:void 0;if(0===L){const G=Y._TmpQuat;return F.Quaternion.RotationAxisToRef(I,x,G),void this.setRotationQuaternion(G,L,X)}const G=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(G,X))return;const p=Y._TmpMats[1];F.Matrix.RotationAxisToRef(I,x,p),G.multiplyToRef(p,p),this._rotateWithMatrix(p,L,X)}setRotation(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(I.y,I.x,I.z,x,L)}setRotationQuaternion(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;if(0===x)return this._decompose(),this._localRotation.X(I),void this._markAsDirtyAndCompose();const X=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,L))return;const G=Y._TmpMats[1];F.Matrix.FromQuaternionToRef(I,G),X.multiplyToRef(G,G),this._rotateWithMatrix(G,x,L)}setRotationMatrix(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;if(0===x){const X=Y._TmpQuat;return F.Quaternion.FromRotationMatrixToRef(I,X),void this.setRotationQuaternion(X,x,L)}const X=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,L))return;const G=Y._TmpMats[1];G.X(I),X.multiplyToRef(I,G),this._rotateWithMatrix(G,x,L)}_rotateWithMatrix(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;const F=this.getLocalMatrix(),X=F.m[12],G=F.m[13],p=F.m[14],B=this.getParent(),l=Y._TmpMats[3],W=Y._TmpMats[4];B&&1==x?(L?(l.X(L.getWorldMatrix()),B.getAbsoluteMatrix().multiplyToRef(l,l)):l.X(B.getAbsoluteMatrix()),W.X(l),W.invert(),F.multiplyToRef(l,F),F.multiplyToRef(I,F),F.multiplyToRef(W,F)):1==x&&L?(l.X(L.getWorldMatrix()),W.X(l),W.invert(),F.multiplyToRef(l,F),F.multiplyToRef(I,F),F.multiplyToRef(W,F)):F.multiplyToRef(I,F),F.setTranslationFromFloats(X,G,p),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(I,x){const L=Y._TmpMats[2];return I.X(this.getAbsoluteMatrix()),x?(I.multiplyToRef(x.getWorldMatrix(),I),F.Matrix.ScalingToRef(x.pB.x,x.pB.y,x.pB.z,L)):F.Matrix.IdentityToRef(L),I.invert(),!isNaN(I.m[0])&&(L.multiplyAtIndex(0,this._scalingDeterminant),I.multiplyToRef(L,I),!0)}IX(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=F.sx.Zero();return this.getPositionToRef(I,x,L),L}getPositionToRef(){let I=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const I=this.getLocalMatrix();x.x=I.m[12],x.y=I.m[13],x.z=I.m[14]}else{let L=null;I&&(L=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let F=Y._TmpMats[0];I&&L?(F.X(this.getAbsoluteMatrix()),F.multiplyToRef(L,F)):F=this.getAbsoluteMatrix(),x.x=F.m[12],x.y=F.m[13],x.z=F.m[14]}}getAbsolutePosition(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const x=F.sx.Zero();return this.getPositionToRef(1,I,x),x}getAbsolutePositionToRef(I,x){this.getPositionToRef(1,I,x)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Ag.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.X(this.Ag);const I=this._skeleton.getPoseMatrix();I&&this._absoluteMatrix.multiplyToRef(I,this._absoluteMatrix)}const I=this.children,x=I.length;for(let L=0;L<x;L++)I[L].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Gl(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=F.sx.Zero();return this.getDirectionToRef(I,x,L),L}getDirectionToRef(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,X=null;x&&(X=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=Y._TmpMats[0];G.X(this.getAbsoluteMatrix()),x&&X&&G.multiplyToRef(X,G),F.sx.TransformNormalToRef(I,G,L),L.normalize()}getRotation(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=F.sx.Zero();return this.getRotationToRef(I,x,L),L}getRotationToRef(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0;const F=Y._TmpQuat;this.getRotationQuaternionToRef(I,x,F),F.toEulerAnglesToRef(L)}getRotationQuaternion(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=F.Quaternion.Identity();return this.getRotationQuaternionToRef(I,x,L),L}getRotationQuaternionToRef(){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),x.X(this._localRotation);else{const L=Y._TmpMats[0],F=this.getAbsoluteMatrix();I?F.multiplyToRef(I.getWorldMatrix(),L):L.X(F),L.multiplyAtIndex(0,this._scalingDeterminant),L.multiplyAtIndex(1,this._scalingDeterminant),L.multiplyAtIndex(2,this._scalingDeterminant),L.decompose(void 0,x,void 0)}}getRotationMatrix(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1?arguments[1]:void 0;const L=F.Matrix.Identity();return this.getRotationMatrixToRef(I,x,L),L}getRotationMatrixToRef(){let I=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(x);else{const L=Y._TmpMats[0],F=this.getAbsoluteMatrix();I?F.multiplyToRef(I.getWorldMatrix(),L):L.X(F),L.multiplyAtIndex(0,this._scalingDeterminant),L.multiplyAtIndex(1,this._scalingDeterminant),L.multiplyAtIndex(2,this._scalingDeterminant),L.getRotationMatrixToRef(x)}}getAbsolutePositionFromLocal(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=F.sx.Zero();return this.getAbsolutePositionFromLocalToRef(I,x,L),L}getAbsolutePositionFromLocalToRef(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,X=null;x&&(X=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=Y._TmpMats[0];G.X(this.getAbsoluteMatrix()),x&&X&&G.multiplyToRef(X,G),F.sx.TransformCoordinatesToRef(I,G,L)}getLocalPositionFromAbsolute(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=F.sx.Zero();return this.getLocalPositionFromAbsoluteToRef(I,x,L),L}getLocalPositionFromAbsoluteToRef(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,X=null;x&&(X=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=Y._TmpMats[0];G.X(this.getAbsoluteMatrix()),x&&X&&G.multiplyToRef(X,G),G.invert(),F.sx.TransformCoordinatesToRef(I,G,L)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const I=this._skeleton.bones.indexOf(this);if(-1!==I&&this._skeleton.bones.splice(I,1),this._parentNode&&this._parentNode.children){const I=this._parentNode.children,x=I.indexOf(this);-1!==x&&I.splice(x,1)}super.dispose()}}Y._TmpVecs=(0,X.c)(2,F.sx.Zero),Y._TmpQuat=F.Quaternion.Identity(),Y._TmpMats=(0,X.c)(5,F.Matrix.Identity)},15049:(I,x,L)=>{"use strict";L.d(x,{c:()=>A});var F=L(12969),X=L(12971),G=L(12797),Y=L(12983),p=L(13001),B=L(13406),l=L(13426),W=L(13255),Q=L(12823),e=L(12989);class g{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(I){this._zoomStopsAnimation=I}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(I){this._idleRotationSpeed=I}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(I){this._idleRotationWaitTime=I}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(I){this._idleRotationSpinupTime=I}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(I){this._attachedCamera=I;const x=this._attachedCamera.tI();this._onPrePointerObservableObserver=x.onPrePointerObservable.add((I=>{I.type!==W.e.POINTERDOWN?I.type===W.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=I.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const I=Q.c.Now;let x=0;null!=this._lastFrameTime&&(x=I-this._lastFrameTime),this._lastFrameTime=I,this._applyUserInteraction();const L=I-this._lastInteractionTime-this._idleRotationWaitTime,F=Math.max(Math.min(L/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*F,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(x/1e3))}))}detach(){if(!this._attachedCamera)return;const I=this._attachedCamera.tI();this._onPrePointerObservableObserver&&I.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(I){this._lastInteractionTime=I??Q.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<e.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let I=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(I=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?I:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Q.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var v=L(15056),z=L(13490);class H{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(I){if(this._autoTransitionRange===I)return;this._autoTransitionRange=I;const x=this._attachedCamera;x&&(I?this._onMeshTargetChangedObserver=x.onMeshTargetChangedObservable.add((I=>{if(I&&(I.LB(!0),I.getBoundingInfo)){const x=I.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*x,this.upperRadiusTransitionRange=.05*x}})):this._onMeshTargetChangedObserver&&x.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(I){this._attachedCamera=I,this._onAfterCheckInputsObserver=I.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(I){return!!this._attachedCamera&&(this._attachedCamera.radius===I&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(I){if(!this._attachedCamera)return;this._radiusBounceTransition||(H.EasingFunction.setEasingMode(H.EasingMode),this._radiusBounceTransition=z.d.CreateAnimation("radius",z.d.ANIMATIONTYPE_FLOAT,60,H.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const x=z.d.TransitionTo("radius",this._attachedCamera.radius+I,this._attachedCamera,this._attachedCamera.tI(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));x&&this._animatables.push(x)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}H.EasingFunction=new v.e(.3),H.EasingMode=v.m.EASINGMODE_EASEOUT;class s{constructor(){this.onTargetFramingAnimationEndObservable=new G.c,this._mode=s.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(I){this._mode=I}get mode(){return this._mode}set radiusScale(I){this._radiusScale=I}get radiusScale(){return this._radiusScale}set positionScale(I){this._positionScale=I}get positionScale(){return this._positionScale}set defaultElevation(I){this._defaultElevation=I}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(I){this._elevationReturnTime=I}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(I){this._elevationReturnWaitTime=I}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(I){this._zoomStopsAnimation=I}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(I){this._framingTime=I}get framingTime(){return this._framingTime}init(){}attach(I){this._attachedCamera=I;const x=this._attachedCamera.tI();s.EasingFunction.setEasingMode(s.EasingMode),this._onPrePointerObservableObserver=x.onPrePointerObservable.add((I=>{I.type!==W.e.POINTERDOWN?I.type===W.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=I.onMeshTargetChangedObservable.add((I=>{I&&I.getBoundingInfo&&this.zoomOnMesh(I,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=I.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const I=this._attachedCamera.tI();this._onPrePointerObservableObserver&&I.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(I){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;I.LB(!0);const F=I.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(F.minimumWorld,F.maximumWorld,x,L)}zoomOnMeshHierarchy(I){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;I.LB(!0);const F=I.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(F.min,F.max,x,L)}zoomOnMeshesHierarchy(I){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new Y.sx(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),X=new Y.sx(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let G=0;G<I.length;G++){const x=I[G].getHierarchyBoundingVectors(!0);Y.sx.CheckExtends(x.min,F,X),Y.sx.CheckExtends(x.max,F,X)}this.zoomOnBoundingInfo(F,X,x,L)}zoomOnBoundingInfo(I,x){let L,F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const G=I.y,p=G+(x.y-G)*this._positionScale,B=x.Ux(I).scale(.5);if(!isFinite(p))return!1;if(F)L=new Y.sx(0,p,0);else{const x=I.add(B);L=new Y.sx(x.x,p,x.z)}this._vectorTransition||(this._vectorTransition=z.d.CreateAnimation("target",z.d.ANIMATIONTYPE_VECTOR3,60,s.EasingFunction)),this._betaIsAnimating=!0;let l=z.d.TransitionTo("target",L,this._attachedCamera,this._attachedCamera.tI(),60,this._vectorTransition,this._framingTime);l&&this._animatables.push(l);let W=0;if(this._mode===s.FitFrustumSidesMode){const L=this._calculateLowerRadiusFromModelBoundingSphere(I,x);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=B.length()+this._attachedCamera.IB),W=L}else this._mode===s.IgnoreBoundsSizeMode&&(W=this._calculateLowerRadiusFromModelBoundingSphere(I,x),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.IB));if(this.autoCorrectCameraLimitsAndSensibility){const L=x.Ux(I).length();this._attachedCamera.panningSensibility=5e3/L,this._attachedCamera.wheelPrecision=100/W}return this._radiusTransition||(this._radiusTransition=z.d.CreateAnimation("radius",z.d.ANIMATIONTYPE_FLOAT,60,s.EasingFunction)),l=z.d.TransitionTo("radius",W,this._attachedCamera,this._attachedCamera.tI(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),X&&X(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),l&&this._animatables.push(l),!0}_calculateLowerRadiusFromModelBoundingSphere(I,x){const L=this._attachedCamera;if(!L)return 0;let F=L._calculateLowerRadiusFromModelBoundingSphere(I,x,this._radiusScale);return L.lowerRadiusLimit&&this._mode===s.IgnoreBoundsSizeMode&&(F=F<L.lowerRadiusLimit?L.lowerRadiusLimit:F),L.upperRadiusLimit&&(F=F>L.upperRadiusLimit?L.upperRadiusLimit:F),F}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const I=Q.c.Now-this._lastInteractionTime,x=.5*Math.PI-this._defaultElevation,L=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>L&&I>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=z.d.CreateAnimation("beta",z.d.ANIMATIONTYPE_FLOAT,60,s.EasingFunction));const I=z.d.TransitionTo("beta",x,this._attachedCamera,this._attachedCamera.tI(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));I&&this._animatables.push(I)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=Q.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}s.EasingFunction=new v.s,s.EasingMode=v.m.EASINGMODE_EASEINOUT,s.IgnoreBoundsSizeMode=0,s.FitFrustumSidesMode=1;var U=L(13434),q=L(13459),y=L(14416),T=L(12791);class Z{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(I){I=T.Tools.BackCompatCameraNoPreventDefault(arguments);const x=this.camera.getEngine(),L=x.getInputElement();let F=0,X=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=G=>{var Y,p;const B=G.event,l="touch"===B.pointerType;if(G.type!==W.e.POINTERMOVE&&-1===this.buttons.indexOf(B.button))return;const Q=B.target;if(this._altKey=B.altKey,this._ctrlKey=B.ctrlKey,this._metaKey=B.metaKey,this._shiftKey=B.shiftKey,this._buttonsPressed=B.buttons,x.isPointerLock){const I=B.movementX,x=B.movementY;this.onTouch(null,I,x),this._pointA=null,this._pointB=null}else{if(G.type!==W.e.POINTERDOWN&&G.type!==W.e.POINTERDOUBLETAP&&l&&(null===(Y=this._pointA)||void 0===Y?void 0:Y.pointerId)!==B.pointerId&&(null===(p=this._pointB)||void 0===p?void 0:p.pointerId)!==B.pointerId)return;if(G.type!==W.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!l)if(G.type===W.e.POINTERDOUBLETAP)this.onDoubleTap(B.pointerType);else if(G.type!==W.e.POINTERUP||this._currentMousePointerIdDown!==B.pointerId&&!l){if(G.type===W.e.POINTERMOVE)if(I||B.preventDefault(),this._pointA&&null===this._pointB){const I=B.clientX-this._pointA.x,x=B.clientY-this._pointA.y;this._pointA.x=B.clientX,this._pointA.y=B.clientY,this.onTouch(this._pointA,I,x)}else if(this._pointA&&this._pointB){const I=this._pointA.pointerId===B.pointerId?this._pointA:this._pointB;I.x=B.clientX,I.y=B.clientY;const x=this._pointA.x-this._pointB.x,L=this._pointA.y-this._pointB.y,Y=x*x+L*L,p={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:B.pointerId,type:G.type};this.onMultiTouch(this._pointA,this._pointB,F,Y,X,p),X=p,F=Y}}else{try{null===Q||void 0===Q||Q.releasePointerCapture(B.pointerId)}catch(e){}l||(this._pointB=null),x._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==B.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==B.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==F||X)&&(this.onMultiTouch(this._pointA,this._pointB,F,0,X,null),F=0,X=null),this._currentMousePointerIdDown=-1,this.onButtonUp(B),I||B.preventDefault()}else{try{null===Q||void 0===Q||Q.setPointerCapture(B.pointerId)}catch(e){}if(null===this._pointA)this._pointA={x:B.clientX,y:B.clientY,pointerId:B.pointerId,type:B.pointerType};else{if(null!==this._pointB)return;this._pointB={x:B.clientX,y:B.clientY,pointerId:B.pointerId,type:B.pointerType}}-1!==this._currentMousePointerIdDown||l||(this._currentMousePointerIdDown=B.pointerId),this.onButtonDown(B),I||(B.preventDefault(),L&&L.focus())}}},this._observer=this.camera.tI()._inputManager._addCameraPointerObserver(this._pointerInput,W.e.POINTERDOWN|W.e.POINTERUP|W.e.POINTERMOVE|W.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,F=0,X=null,this.onLostFocus()},this._contextMenuBind=I=>this.onContextMenu(I),L&&L.addEventListener("contextmenu",this._contextMenuBind,!1);const G=this.camera.tI().getEngine().getHostWindow();G&&T.Tools.RegisterTopRootEvents(G,[{name:"blur",handler:this._onLostFocus}])}ye(){if(this._onLostFocus){const I=this.camera.tI().getEngine().getHostWindow();I&&T.Tools.UnregisterTopRootEvents(I,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.tI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const I=this.camera.tI().getEngine().getInputElement();I&&I.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(I){}onTouch(I,x,L){}onMultiTouch(I,x,L,F,X,G){}onContextMenu(I){I.preventDefault()}onButtonDown(I){}onButtonUp(I){}onLostFocus(){}}(0,F.d)([(0,X.K)()],Z.prototype,"buttons",void 0);class t extends Z{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(I,x){if(0!==this.panningSensibility&&I&&x){const L=x.x-I.x,F=x.y-I.y;this.camera.inertialPanningX+=-L/this.panningSensibility,this.camera.inertialPanningY+=F/this.panningSensibility}}_computePinchZoom(I,x){const L=this.camera.radius||t.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=L*Math.sqrt(I)/Math.sqrt(x):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(x-I)*L*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(x-I)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(I,x,L){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-x/this.panningSensibility,this.camera.inertialPanningY+=L/this.panningSensibility):(this.camera.inertialAlphaOffset-=x/this.angularSensibilityX,this.camera.inertialBetaOffset-=L/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(I,x,L,F,X,G){0===L&&null===X||0===F&&null===G||(this.multiTouchPanAndZoom?(this._computePinchZoom(L,F),this._computeMultiTouchPanning(X,G)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(F)-Math.sqrt(L))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(L,F),this._isPinching=!0):this._computeMultiTouchPanning(X,G)):this.multiTouchPanning?this._computeMultiTouchPanning(X,G):this.pinchZoom&&this._computePinchZoom(L,F))}onButtonDown(I){this._isPanClick=I.button===this.camera._panningMouseButton}onButtonUp(I){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}t.MinimumRadiusForPinch=.001,(0,F.d)([(0,X.K)()],t.prototype,"buttons",void 0),(0,F.d)([(0,X.K)()],t.prototype,"angularSensibilityX",void 0),(0,F.d)([(0,X.K)()],t.prototype,"angularSensibilityY",void 0),(0,F.d)([(0,X.K)()],t.prototype,"pinchPrecision",void 0),(0,F.d)([(0,X.K)()],t.prototype,"pinchDeltaPercentage",void 0),(0,F.d)([(0,X.K)()],t.prototype,"useNaturalPinchZoom",void 0),(0,F.d)([(0,X.K)()],t.prototype,"pinchZoom",void 0),(0,F.d)([(0,X.K)()],t.prototype,"panningSensibility",void 0),(0,F.d)([(0,X.K)()],t.prototype,"multiTouchPanning",void 0),(0,F.d)([(0,X.K)()],t.prototype,"multiTouchPanAndZoom",void 0),y.c.ArcRotateCameraPointersInput=t;var f=L(13262);class R{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(I){I=T.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.tI(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((x=>{const L=x.event;if(!L.metaKey)if(x.type===f.d.KEYDOWN){if(this._ctrlPressed=L.ctrlKey,this._altPressed=L.altKey,-1!==this.keysUp.indexOf(L.keyCode)||-1!==this.keysDown.indexOf(L.keyCode)||-1!==this.keysLeft.indexOf(L.keyCode)||-1!==this.keysRight.indexOf(L.keyCode)||-1!==this.keysReset.indexOf(L.keyCode)){-1===this._keys.indexOf(L.keyCode)&&this._keys.push(L.keyCode),L.preventDefault&&(I||L.preventDefault())}}else if(-1!==this.keysUp.indexOf(L.keyCode)||-1!==this.keysDown.indexOf(L.keyCode)||-1!==this.keysLeft.indexOf(L.keyCode)||-1!==this.keysRight.indexOf(L.keyCode)||-1!==this.keysReset.indexOf(L.keyCode)){const x=this._keys.indexOf(L.keyCode);x>=0&&this._keys.splice(x,1),L.preventDefault&&(I||L.preventDefault())}})))}ye(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const I=this.camera;for(let x=0;x<this._keys.length;x++){const L=this._keys[x];-1!==this.keysLeft.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningX-=1/this.panningSensibility:I.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?I.inertialRadiusOffset+=1/this.zoomingSensibility:I.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningX+=1/this.panningSensibility:I.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?I.inertialRadiusOffset-=1/this.zoomingSensibility:I.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(L)&&I.useInputToRestoreState&&I.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,F.d)([(0,X.K)()],R.prototype,"keysUp",void 0),(0,F.d)([(0,X.K)()],R.prototype,"keysDown",void 0),(0,F.d)([(0,X.K)()],R.prototype,"keysLeft",void 0),(0,F.d)([(0,X.K)()],R.prototype,"keysRight",void 0),(0,F.d)([(0,X.K)()],R.prototype,"keysReset",void 0),(0,F.d)([(0,X.K)()],R.prototype,"panningSensibility",void 0),(0,F.d)([(0,X.K)()],R.prototype,"zoomingSensibility",void 0),(0,F.d)([(0,X.K)()],R.prototype,"useAltToZoom",void 0),(0,F.d)([(0,X.K)()],R.prototype,"angularSpeed",void 0),y.c.ArcRotateCameraKeyboardMoveInput=R;var n=L(13026),P=L(13269);class d{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new Y.sx(0,0,0),this._globalOffset=new Y.sx(0,0,0),this._inertialPanning=Y.sx.Zero()}_computeDeltaFromMouseWheelLegacyEvent(I,x){let L=0;const F=.01*I*this.wheelDeltaPercentage*x;return L=I>0?F/(1+this.wheelDeltaPercentage):F*(1+this.wheelDeltaPercentage),L}attachControl(I){I=T.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=x=>{if(x.type!==W.e.POINTERWHEEL)return;const L=x.event;let F=0;const X=L.deltaMode===P.c.DOM_DELTA_LINE?40:1,G=-L.deltaY*X;if(this.customComputeDeltaFromMouseWheel)F=this.customComputeDeltaFromMouseWheel(G,this,L);else if(this.wheelDeltaPercentage){if(F=this._computeDeltaFromMouseWheelLegacyEvent(G,this.camera.radius),F>0){let I=this.camera.radius,x=this.camera.inertialRadiusOffset+F;for(let L=0;L<20&&!(I<=x)&&!(Math.abs(x*this.camera.inertia)<.001);L++)I-=x,x*=this.camera.inertia;I=(0,p.Clamp)(I,0,Number.MAX_VALUE),F=this._computeDeltaFromMouseWheelLegacyEvent(G,I)}}else F=G/(40*this.wheelPrecision);F&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(F)):this.camera.inertialRadiusOffset+=F),L.preventDefault&&(I||L.preventDefault())},this._observer=this.camera.tI()._inputManager._addCameraPointerObserver(this._wheel,W.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.BB(0)}ye(){this._observer&&(this.camera.tI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const I=this.camera;0+I.inertialAlphaOffset+I.inertialBetaOffset+I.inertialRadiusOffset&&(this._updateHitPlane(),I.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(I.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const I=this.camera,x=I.target.Ux(I.position);this._hitPlane=n.b.FromPositionAndNormal(I.target,x)}_getPosition(){const I=this.camera,x=I.tI(),L=x.createPickingRay(x.pointerX,x.pointerY,Y.Matrix.Identity(),I,!1);0===I.targetScreenOffset.x&&0===I.targetScreenOffset.y||(this._viewOffset.set(I.targetScreenOffset.x,I.targetScreenOffset.y,0),I.getViewMatrix().invertToRef(I._cameraTransformMatrix),this._globalOffset=Y.sx.TransformNormal(this._viewOffset,I._cameraTransformMatrix),L.origin.addInPlace(this._globalOffset));let F=0;return this._hitPlane&&(F=L.intersectsPlane(this._hitPlane)??0),L.origin.addInPlace(L.direction.scaleInPlace(F))}_zoomToMouse(I){const x=this.camera,L=1-x.inertia;if(x.lowerRadiusLimit){const F=x.lowerRadiusLimit??0;x.radius-(x.inertialRadiusOffset+I)/L<F&&(I=(x.radius-F)*L-x.inertialRadiusOffset)}if(x.upperRadiusLimit){const F=x.upperRadiusLimit??0;x.radius-(x.inertialRadiusOffset+I)/L>F&&(I=(x.radius-F)*L-x.inertialRadiusOffset)}const F=I/L/x.radius,X=this._getPosition(),G=Y.TmpVectors.sx[6];X.subtractToRef(x.target,G),G.scaleInPlace(F),G.scaleInPlace(L),this._inertialPanning.addInPlace(G),x.inertialRadiusOffset+=I}_zeroIfClose(I){Math.abs(I.x)<e.e&&(I.x=0),Math.abs(I.y)<e.e&&(I.y=0),Math.abs(I.z)<e.e&&(I.z=0)}}(0,F.d)([(0,X.K)()],d.prototype,"wheelPrecision",void 0),(0,F.d)([(0,X.K)()],d.prototype,"zoomToMouseLocation",void 0),(0,F.d)([(0,X.K)()],d.prototype,"wheelDeltaPercentage",void 0),y.c.ArcRotateCameraMouseWheelInput=d;class M extends y.f{constructor(I){super(I)}addMouseWheel(){return this.add(new d),this}addPointers(){return this.add(new t),this}addKeyboard(){return this.add(new R),this}}var K=L(12938);function u(I,x){return isNaN(I)?x:I}B.c.AddNodeConstructor("ArcRotateCamera",((I,x)=>()=>new A(I,0,0,1,Y.sx.Zero(),x)));class A extends q.b{get target(){return this._target}set target(I){this.setTarget(I)}get targetHost(){return this._targetHost}set targetHost(I){I&&this.setTarget(I)}getTarget(){return this.target}get position(){return this._position}set position(I){this.setPosition(I)}set upVector(I){this._upToYMatrix||(this._yToUpMatrix=new Y.Matrix,this._upToYMatrix=new Y.Matrix,this._upVector=Y.sx.Zero()),I.normalize(),this._upVector.X(I),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){Y.Matrix.RotationAlignToRef(Y.sx.UpReadOnly,this._upVector,this._yToUpMatrix),Y.Matrix.RotationAlignToRef(this._upVector,Y.sx.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const I=this.inputs.attached.pointers;return I?I.angularSensibilityX:0}set angularSensibilityX(I){const x=this.inputs.attached.pointers;x&&(x.angularSensibilityX=I)}get angularSensibilityY(){const I=this.inputs.attached.pointers;return I?I.angularSensibilityY:0}set angularSensibilityY(I){const x=this.inputs.attached.pointers;x&&(x.angularSensibilityY=I)}get pinchPrecision(){const I=this.inputs.attached.pointers;return I?I.pinchPrecision:0}set pinchPrecision(I){const x=this.inputs.attached.pointers;x&&(x.pinchPrecision=I)}get pinchDeltaPercentage(){const I=this.inputs.attached.pointers;return I?I.pinchDeltaPercentage:0}set pinchDeltaPercentage(I){const x=this.inputs.attached.pointers;x&&(x.pinchDeltaPercentage=I)}get useNaturalPinchZoom(){const I=this.inputs.attached.pointers;return!!I&&I.useNaturalPinchZoom}set useNaturalPinchZoom(I){const x=this.inputs.attached.pointers;x&&(x.useNaturalPinchZoom=I)}get panningSensibility(){const I=this.inputs.attached.pointers;return I?I.panningSensibility:0}set panningSensibility(I){const x=this.inputs.attached.pointers;x&&(x.panningSensibility=I)}get keysUp(){const I=this.inputs.attached.keyboard;return I?I.keysUp:[]}set keysUp(I){const x=this.inputs.attached.keyboard;x&&(x.keysUp=I)}get keysDown(){const I=this.inputs.attached.keyboard;return I?I.keysDown:[]}set keysDown(I){const x=this.inputs.attached.keyboard;x&&(x.keysDown=I)}get keysLeft(){const I=this.inputs.attached.keyboard;return I?I.keysLeft:[]}set keysLeft(I){const x=this.inputs.attached.keyboard;x&&(x.keysLeft=I)}get keysRight(){const I=this.inputs.attached.keyboard;return I?I.keysRight:[]}set keysRight(I){const x=this.inputs.attached.keyboard;x&&(x.keysRight=I)}get wheelPrecision(){const I=this.inputs.attached.mousewheel;return I?I.wheelPrecision:0}set wheelPrecision(I){const x=this.inputs.attached.mousewheel;x&&(x.wheelPrecision=I)}get zoomToMouseLocation(){const I=this.inputs.attached.mousewheel;return!!I&&I.zoomToMouseLocation}set zoomToMouseLocation(I){const x=this.inputs.attached.mousewheel;x&&(x.zoomToMouseLocation=I)}get wheelDeltaPercentage(){const I=this.inputs.attached.mousewheel;return I?I.wheelDeltaPercentage:0}set wheelDeltaPercentage(I){const x=this.inputs.attached.mousewheel;x&&(x.wheelDeltaPercentage=I)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(I){I!==this.useBouncingBehavior&&(I?(this._bouncingBehavior=new H,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(I){I!==this.useFramingBehavior&&(I?(this._framingBehavior=new s,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(I){I!==this.useAutoRotationBehavior&&(I?(this._autoRotationBehavior=new g,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(I,x,L,F,X,p){var B;let l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(I,Y.sx.Zero(),p,l),B=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=Y.sx.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Y.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new Y.Matrix,this.panningAxis=new Y.sx(1,1,0),this._transformedDirection=new Y.sx,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new G.c,this.checkCollisions=!1,this.collisionRadius=new Y.sx(.5,.5,.5),this._previousPosition=Y.sx.Zero(),this._collisionVelocity=Y.sx.Zero(),this._newPosition=Y.sx.Zero(),this._computationVector=Y.sx.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new Y.sx(NaN,NaN,NaN),this._goalTargetScreenOffset=new Y.Vector2(NaN,NaN),this._onCollisionPositionChange=function(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;L?(B.setPosition(x),B.Kv&&B.Kv(L)):B._previousPosition.X(B._position);const F=Math.cos(B.alpha),X=Math.sin(B.alpha),G=Math.cos(B.beta);let Y=Math.sin(B.beta);0===Y&&(Y=1e-4);const p=B._getTargetPosition();B._computationVector.YB(B.radius*F*Y,B.radius*G,B.radius*X*Y),p.addToRef(B._computationVector,B._newPosition),B._position.X(B._newPosition);let l=B.upVector;B.allowUpsideDown&&B.beta<0&&(l=l.clone(),l=l.negate()),B._computeViewMatrix(B._position,p,l),B._viewMatrix.addAtIndex(12,B.targetScreenOffset.x),B._viewMatrix.addAtIndex(13,B.targetScreenOffset.y),B._collisionTriggered=!1},this._target=Y.sx.Zero(),X&&this.setTarget(X),this.alpha=x,this.beta=L,this.radius=F,this.getViewMatrix(),this.inputs=new M(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new Y.sx(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Y.Vector2.Zero()}_updateCache(I){I||super._updateCache(),this._cache._target.X(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.X(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const I=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?I.addToRef(this._targetBoundingCenter,this._target):this._target.X(I)}const I=this._getLockedTargetPosition();return I||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>e.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,G=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=G?this._currentInterpolationFactor=G:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=u(I,this._goalAlpha),this._goalBeta=u(x,this._goalBeta),this._goalRadius=u(L,this._goalRadius),this._goalTarget.set(u(F.x,this._goalTarget.x),u(F.y,this._goalTarget.y),u(F.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(u(X.x,this._goalTargetScreenOffset.x),u(X.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,p.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,p.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,p.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,p.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(I,x){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const X=arguments;x=T.Tools.BackCompatCameraNoPreventDefault(X),this._useCtrlForPanning=L,this._panningMouseButton=F,"boolean"===typeof X[0]&&(X.length>1&&(this._useCtrlForPanning=X[1]),X.length>2&&(this._panningMouseButton=X[2])),this.inputs.attachElement(x),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}ye(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let I=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){I=!0;const x=this.invertRotation?-1:1,L=this._calculateHandednessMultiplier();let F=this.inertialAlphaOffset*L;this.beta<0&&(F*=-1),this.alpha+=F*x,this.beta+=this.inertialBetaOffset*x,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<e.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<e.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*e.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){I=!0;const x=new Y.sx(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),x.multiplyInPlace(this.panningAxis),Y.sx.TransformNormalToRef(x,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const I=this.upVector,x=Y.sx.CrossToRef(this._transformedDirection,I,this._transformedDirection);Y.sx.CrossToRef(I,x,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);Y.sx.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.X(this._transformedDirection)}else{if(this.parent){const I=Y.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(I),I.transposeToRef(I),Y.sx.TransformCoordinatesToRef(this._transformedDirection,I,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*e.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*e.e&&(this.inertialPanningY=0)}if(I)this.stopInterpolation();else if(this._isInterpolating){let I=!1;const x=this._scene.getEngine().getDeltaTime()/1e3,L=1-Math.pow(2,-x/this._currentInterpolationFactor),F=u(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const x=Y.TmpVectors.sx[0].set(u(this._goalTarget.x,this._target.x),u(this._goalTarget.y,this._target.y),u(this._goalTarget.z,this._target.z));Y.sx.LerpToRef(this.target,x,L,this._target),10*Y.sx.Distance(this.target,x)/F<e.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.X(x),this.setTarget(this.target,!1,!0,!0)):I=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const x=Y.Quaternion.RotationAlphaBetaGammaToRef(u(this._goalAlpha,this.alpha),u(this._goalBeta,this.beta),0,Y.TmpVectors.Quaternion[0]),F=Y.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,Y.TmpVectors.Quaternion[1]),X=Y.Quaternion.SlerpToRef(F,x,L,Y.TmpVectors.Quaternion[2]);X.normalize();const G=X.toAlphaBetaGammaToRef(Y.TmpVectors.sx[0]);if(this.alpha=G.x,this.beta=G.y,X.isApprox(x,e.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const I=x.toAlphaBetaGammaToRef(Y.TmpVectors.sx[0]);this.alpha=I.x,this.beta=I.y}else I=!0}if(isNaN(this._goalRadius)||(this.radius+=(F-this.radius)*L,Math.abs(F/this.radius-1)<e.e?(this._goalRadius=NaN,this.radius=F):I=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const x=Y.TmpVectors.Vector2[0].set(u(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),u(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));Y.Vector2.LerpToRef(this.targetScreenOffset,x,L,this.targetScreenOffset),Y.Vector2.Distance(this.targetScreenOffset,x)<e.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.X(x)):I=!0}this._isInterpolating=I}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.sx.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const I=this.alpha;var x,L;this.alpha=function(I){let x=Math.PI/2;return 0===I.x&&0===I.z||(x=Math.acos(I.x/Math.sqrt(Math.pow(I.x,2)+Math.pow(I.z,2)))),I.z<0&&(x=2*Math.PI-x),x}(this._computationVector),this.beta=(x=this._computationVector.y,L=this.radius,Math.acos(x/L));const F=Math.round((I-this.alpha)/(2*Math.PI));this.alpha+=2*F*Math.PI,this._checkLimits()}setPosition(I){this._position.equals(I)||(this._position.X(I),this.rebuildAnglesAndRadius())}setTarget(I){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(F=this.overrideCloneAlphaBetaRadius??F,I.LB)x&&I.getBoundingInfo?this._targetBoundingCenter=I.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,I.LB(),this._targetHost=I,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const x=I,F=this._getTargetPosition();if(F&&!L&&F.equals(x))return;this._targetHost=null,this._target=x,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}F||this.rebuildAnglesAndRadius()}_getViewMatrix(){const I=Math.cos(this.alpha),x=Math.sin(this.alpha),L=Math.cos(this.beta);let F=Math.sin(this.beta);0===F&&(F=1e-4),0===this.radius&&(this.radius=1e-4);const X=this._getTargetPosition();if(this._computationVector.YB(this.radius*I*F,this.radius*L,this.radius*x*F),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.sx.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),X.addToRef(this._computationVector,this._newPosition),this.tI().collisionsEnabled&&this.checkCollisions){const I=this.tI().collisionCoordinator;this._collider||(this._collider=I.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,I.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.X(this._newPosition);let I=this.upVector;this.allowUpsideDown&&F<0&&(I=I.negate()),this._computeViewMatrix(this._position,X,I),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.X(X),this._viewMatrix}zoomOn(I){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I=I||this.tI().meshes;const L=l.e.MinMax(I);let F=this._calculateLowerRadiusFromModelBoundingSphere(L.min,L.max);if(F=Math.max(Math.min(F,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=F*this.zoomOnFactor,this.mode===U.b.ORTHOGRAPHIC_CAMERA){const I=this.tI().getEngine().getAspectRatio(this),x=F*this.zoomOnFactor/2;this.orthoLeft=-x*I,this.orthoRight=x*I,this.orthoBottom=-x,this.orthoTop=x}this.focusOn({min:L.min,max:L.max,distance:F},x)}focusOn(I){let x,L,F=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===I.min){const F=I||this.tI().meshes;x=l.e.MinMax(F),L=Y.sx.Distance(x.min,x.max)}else{x=I,L=I.distance}this._target=l.e.Center(x),F||(this.maxZ=2*L)}createRigCamera(I,x){let L=0;switch(this.cameraRigMode){case U.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.b.RIG_MODE_VR:L=this._cameraRigParams.stereoHalfAngle*(0===x?1:-1);break;case U.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:L=this._cameraRigParams.stereoHalfAngle*(0===x?-1:1)}const F=new A(I,this.alpha+L,this.beta,this.radius,this._target,this.tI());return F._cameraRigParams={},F.isRigCamera=!0,F.rigParent=this,F.upVector=this.upVector,F.mode=this.mode,F.orthoLeft=this.orthoLeft,F.orthoRight=this.orthoRight,F.orthoBottom=this.orthoBottom,F.orthoTop=this.orthoTop,F}_updateRigCameras(){const I=this._rigCameras[0],x=this._rigCameras[1];switch(I.beta=x.beta=this.beta,this.cameraRigMode){case U.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.b.RIG_MODE_VR:I.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,x.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case U.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:I.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,x.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const F=Y.sx.Distance(I,x),X=this.tI().getEngine().getAspectRatio(this),G=Math.tan(this.fov/2),p=G*X,B=.5*F*L,l=B*Math.sqrt(1+1/(p*p)),W=B*Math.sqrt(1+1/(G*G));return Math.max(l,W)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,F.d)([(0,X.K)()],A.prototype,"alpha",void 0),(0,F.d)([(0,X.K)()],A.prototype,"beta",void 0),(0,F.d)([(0,X.K)()],A.prototype,"radius",void 0),(0,F.d)([(0,X.K)()],A.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,F.d)([(0,X.I)("target")],A.prototype,"_target",void 0),(0,F.d)([(0,X.w)("targetHost")],A.prototype,"_targetHost",void 0),(0,F.d)([(0,X.K)()],A.prototype,"inertialAlphaOffset",void 0),(0,F.d)([(0,X.K)()],A.prototype,"inertialBetaOffset",void 0),(0,F.d)([(0,X.K)()],A.prototype,"inertialRadiusOffset",void 0),(0,F.d)([(0,X.K)()],A.prototype,"lowerAlphaLimit",void 0),(0,F.d)([(0,X.K)()],A.prototype,"upperAlphaLimit",void 0),(0,F.d)([(0,X.K)()],A.prototype,"lowerBetaLimit",void 0),(0,F.d)([(0,X.K)()],A.prototype,"upperBetaLimit",void 0),(0,F.d)([(0,X.K)()],A.prototype,"lowerRadiusLimit",void 0),(0,F.d)([(0,X.K)()],A.prototype,"upperRadiusLimit",void 0),(0,F.d)([(0,X.K)()],A.prototype,"lowerTargetYLimit",void 0),(0,F.d)([(0,X.K)()],A.prototype,"inertialPanningX",void 0),(0,F.d)([(0,X.K)()],A.prototype,"inertialPanningY",void 0),(0,F.d)([(0,X.K)()],A.prototype,"pinchToPanMaxDistance",void 0),(0,F.d)([(0,X.K)()],A.prototype,"panningDistanceLimit",void 0),(0,F.d)([(0,X.I)()],A.prototype,"panningOriginTarget",void 0),(0,F.d)([(0,X.K)()],A.prototype,"panningInertia",void 0),(0,F.d)([(0,X.K)()],A.prototype,"zoomToMouseLocation",null),(0,F.d)([(0,X.K)()],A.prototype,"zoomOnFactor",void 0),(0,F.d)([(0,X.F)()],A.prototype,"targetScreenOffset",void 0),(0,F.d)([(0,X.K)()],A.prototype,"allowUpsideDown",void 0),(0,F.d)([(0,X.K)()],A.prototype,"useInputToRestoreState",void 0),(0,F.d)([(0,X.K)()],A.prototype,"restoreStateInterpolationFactor",void 0),(0,K.d)("BABYLON.ArcRotateCamera",A)},14416:(I,x,L)=>{"use strict";L.d(x,{c:()=>Y,f:()=>p});var F=L(12809),X=L(13012),G=L(13434),Y={};class p{constructor(I){this.attachedToElement=!1,this.attached={},this.camera=I,this.checkInputs=()=>{}}add(I){const x=I.getSimpleName();this.attached[x]?F.c.Warn("camera input of type "+x+" already exists on camera"):(this.attached[x]=I,I.camera=this.camera,I.checkInputs&&(this.checkInputs=this._addCheckInputs(I.checkInputs.bind(I))),this.attachedToElement&&I.attachControl(this.noPreventDefault))}remove(I){for(const x in this.attached){const L=this.attached[x];if(L===I)return L.ye(),L.camera=null,delete this.attached[x],void this.rebuildInputCheck()}}removeByType(I){for(const x in this.attached){const L=this.attached[x];L.getClassName()===I&&(L.ye(),L.camera=null,delete this.attached[x],this.rebuildInputCheck())}}_addCheckInputs(I){const x=this.checkInputs;return()=>{x(),I()}}attachInput(I){this.attachedToElement&&I.attachControl(this.noPreventDefault)}attachElement(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){I=!G.b.ForceAttachControlToAlwaysPreventDefault&&I,this.attachedToElement=!0,this.noPreventDefault=I;for(const x in this.attached)this.attached[x].attachControl(I)}}detachElement(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const x in this.attached)this.attached[x].ye(),I&&(this.attached[x].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const I in this.attached){const x=this.attached[I];x.checkInputs&&(this.checkInputs=this._addCheckInputs(x.checkInputs.bind(x)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(I){const x={};for(const L in this.attached){const I=this.attached[L],F=X.c.Serialize(I);x[I.getClassName()]=F}I.inputsmgr=x}parse(I){const x=I.inputsmgr;if(x){this.clear();for(const I in x){const L=Y[I];if(L){const F=x[I],G=X.c.Parse((()=>new L),F,null);this.add(G)}}}else for(const L in this.attached){const x=Y[this.attached[L].getClassName()];if(x){const F=X.c.Parse((()=>new x),I,null);this.remove(this.attached[L]),this.add(F)}}}}},14407:(I,x,L)=>{"use strict";L.d(x,{e:()=>Z});var F=L(12969),X=L(12971),G=L(12983),Y=L(13459),p=L(14416),B=L(13262),l=L(12791);class W{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(I){I=l.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.tI(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((x=>{const L=x.event;if(!L.metaKey)if(x.type===B.d.KEYDOWN){if(-1!==this.keysUp.indexOf(L.keyCode)||-1!==this.keysDown.indexOf(L.keyCode)||-1!==this.keysLeft.indexOf(L.keyCode)||-1!==this.keysRight.indexOf(L.keyCode)||-1!==this.keysUpward.indexOf(L.keyCode)||-1!==this.keysDownward.indexOf(L.keyCode)||-1!==this.keysRotateLeft.indexOf(L.keyCode)||-1!==this.keysRotateRight.indexOf(L.keyCode)||-1!==this.keysRotateUp.indexOf(L.keyCode)||-1!==this.keysRotateDown.indexOf(L.keyCode)){-1===this._keys.indexOf(L.keyCode)&&this._keys.push(L.keyCode),I||L.preventDefault()}}else if(-1!==this.keysUp.indexOf(L.keyCode)||-1!==this.keysDown.indexOf(L.keyCode)||-1!==this.keysLeft.indexOf(L.keyCode)||-1!==this.keysRight.indexOf(L.keyCode)||-1!==this.keysUpward.indexOf(L.keyCode)||-1!==this.keysDownward.indexOf(L.keyCode)||-1!==this.keysRotateLeft.indexOf(L.keyCode)||-1!==this.keysRotateRight.indexOf(L.keyCode)||-1!==this.keysRotateUp.indexOf(L.keyCode)||-1!==this.keysRotateDown.indexOf(L.keyCode)){const x=this._keys.indexOf(L.keyCode);x>=0&&this._keys.splice(x,1),I||L.preventDefault()}})))}ye(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const I=this.camera;for(let x=0;x<this._keys.length;x++){const L=this._keys[x],F=I._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(L)?I._localDirection.YB(-F,0,0):-1!==this.keysUp.indexOf(L)?I._localDirection.YB(0,0,F):-1!==this.keysRight.indexOf(L)?I._localDirection.YB(F,0,0):-1!==this.keysDown.indexOf(L)?I._localDirection.YB(0,0,-F):-1!==this.keysUpward.indexOf(L)?I._localDirection.YB(0,F,0):-1!==this.keysDownward.indexOf(L)?I._localDirection.YB(0,-F,0):-1!==this.keysRotateLeft.indexOf(L)?(I._localDirection.YB(0,0,0),I.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(L)?(I._localDirection.YB(0,0,0),I.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(L)?(I._localDirection.YB(0,0,0),I.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(L)&&(I._localDirection.YB(0,0,0),I.cameraRotation.x+=this._getLocalRotation()),I.tI().useRightHandedSystem&&(I._localDirection.z*=-1),I.getViewMatrix().invertToRef(I._cameraTransformMatrix),G.sx.TransformNormalToRef(I._localDirection,I._cameraTransformMatrix,I._transformedDirection),I.cameraDirection.addInPlace(I._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const I=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*I}}(0,F.d)([(0,X.K)()],W.prototype,"keysUp",void 0),(0,F.d)([(0,X.K)()],W.prototype,"keysUpward",void 0),(0,F.d)([(0,X.K)()],W.prototype,"keysDown",void 0),(0,F.d)([(0,X.K)()],W.prototype,"keysDownward",void 0),(0,F.d)([(0,X.K)()],W.prototype,"keysLeft",void 0),(0,F.d)([(0,X.K)()],W.prototype,"keysRight",void 0),(0,F.d)([(0,X.K)()],W.prototype,"rotationSpeed",void 0),(0,F.d)([(0,X.K)()],W.prototype,"keysRotateLeft",void 0),(0,F.d)([(0,X.K)()],W.prototype,"keysRotateRight",void 0),(0,F.d)([(0,X.K)()],W.prototype,"keysRotateUp",void 0),(0,F.d)([(0,X.K)()],W.prototype,"keysRotateDown",void 0),p.c.FreeCameraKeyboardMoveInput=W;var Q=L(12797),e=L(13255);class g{constructor(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=I,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new Q.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(I){I=l.Tools.BackCompatCameraNoPreventDefault(arguments);const x=this.camera.getEngine(),L=x.getInputElement();this._pointerInput||(this._pointerInput=F=>{const X=F.event,G="touch"===X.pointerType;if(!this.touchEnabled&&G)return;if(F.type!==e.e.POINTERMOVE&&-1===this.buttons.indexOf(X.button))return;const Y=X.target;if(F.type===e.e.POINTERDOWN){if(G&&-1!==this._activePointerId||!G&&-1!==this._currentActiveButton)return;this._activePointerId=X.pointerId;try{null===Y||void 0===Y||Y.setPointerCapture(X.pointerId)}catch(p){}-1===this._currentActiveButton&&(this._currentActiveButton=X.button),this._previousPosition={x:X.clientX,y:X.clientY},I||(X.preventDefault(),L&&L.focus()),x.isPointerLock&&this._onMouseMove&&this._onMouseMove(F.event)}else if(F.type===e.e.POINTERUP){if(G&&this._activePointerId!==X.pointerId||!G&&this._currentActiveButton!==X.button)return;try{null===Y||void 0===Y||Y.releasePointerCapture(X.pointerId)}catch(p){}this._currentActiveButton=-1,this._previousPosition=null,I||X.preventDefault(),this._activePointerId=-1}else if(F.type===e.e.POINTERMOVE&&(this._activePointerId===X.pointerId||!G))if(x.isPointerLock&&this._onMouseMove)this._onMouseMove(F.event);else if(this._previousPosition){const x=this.camera._calculateHandednessMultiplier(),L=(X.clientX-this._previousPosition.x)*x,F=X.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=L/this.angularSensibility,this.camera.cameraRotation.x+=F/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:L,offsetY:F}),this._previousPosition={x:X.clientX,y:X.clientY},I||X.preventDefault()}}),this._onMouseMove=L=>{if(!x.isPointerLock)return;const F=this.camera._calculateHandednessMultiplier(),X=L.movementX*F;this.camera.cameraRotation.y+=X/this.angularSensibility;const G=L.movementY;this.camera.cameraRotation.x+=G/this.angularSensibility,this._previousPosition=null,I||L.preventDefault()},this._observer=this.camera.tI()._inputManager._addCameraPointerObserver(this._pointerInput,e.e.POINTERDOWN|e.e.POINTERUP|e.e.POINTERMOVE),L&&(this._contextMenuBind=I=>this.onContextMenu(I),L.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(I){I.preventDefault()}ye(){if(this._observer){if(this.camera.tI()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const I=this.camera.getEngine().getInputElement();I&&I.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,F.d)([(0,X.K)()],g.prototype,"buttons",void 0),(0,F.d)([(0,X.K)()],g.prototype,"angularSensibility",void 0),p.c.FreeCameraMouseInput=g;var v,z=L(13269);class H{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new Q.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(I){I=l.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=x=>{if(x.type!==e.e.POINTERWHEEL)return;const L=x.event,F=L.deltaMode===z.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*F*L.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*F*L.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*F*L.deltaZ/this._normalize,L.preventDefault&&(I||L.preventDefault())},this._observer=this.camera.tI()._inputManager._addCameraPointerObserver(this._wheel,e.e.POINTERWHEEL)}ye(){this._observer&&(this.camera.tI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,F.d)([(0,X.K)()],H.prototype,"wheelPrecisionX",void 0),(0,F.d)([(0,X.K)()],H.prototype,"wheelPrecisionY",void 0),(0,F.d)([(0,X.K)()],H.prototype,"wheelPrecisionZ",void 0),function(I){I[I.MoveRelative=0]="MoveRelative",I[I.RotateRelative=1]="RotateRelative",I[I.MoveScene=2]="MoveScene"}(v||(v={}));class s extends H{constructor(){super(...arguments),this._moveRelative=G.sx.Zero(),this._rotateRelative=G.sx.Zero(),this._moveScene=G.sx.Zero(),this._wheelXAction=v.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=v.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(I){null===I&&this._wheelXAction!==v.MoveRelative||(this._wheelXAction=v.MoveRelative,this._wheelXActionCoordinate=I)}get wheelXMoveRelative(){return this._wheelXAction!==v.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(I){null===I&&this._wheelYAction!==v.MoveRelative||(this._wheelYAction=v.MoveRelative,this._wheelYActionCoordinate=I)}get wheelYMoveRelative(){return this._wheelYAction!==v.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(I){null===I&&this._wheelZAction!==v.MoveRelative||(this._wheelZAction=v.MoveRelative,this._wheelZActionCoordinate=I)}get wheelZMoveRelative(){return this._wheelZAction!==v.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(I){null===I&&this._wheelXAction!==v.RotateRelative||(this._wheelXAction=v.RotateRelative,this._wheelXActionCoordinate=I)}get wheelXRotateRelative(){return this._wheelXAction!==v.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(I){null===I&&this._wheelYAction!==v.RotateRelative||(this._wheelYAction=v.RotateRelative,this._wheelYActionCoordinate=I)}get wheelYRotateRelative(){return this._wheelYAction!==v.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(I){null===I&&this._wheelZAction!==v.RotateRelative||(this._wheelZAction=v.RotateRelative,this._wheelZActionCoordinate=I)}get wheelZRotateRelative(){return this._wheelZAction!==v.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(I){null===I&&this._wheelXAction!==v.MoveScene||(this._wheelXAction=v.MoveScene,this._wheelXActionCoordinate=I)}get wheelXMoveScene(){return this._wheelXAction!==v.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(I){null===I&&this._wheelYAction!==v.MoveScene||(this._wheelYAction=v.MoveScene,this._wheelYActionCoordinate=I)}get wheelYMoveScene(){return this._wheelYAction!==v.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(I){null===I&&this._wheelZAction!==v.MoveScene||(this._wheelZAction=v.MoveScene,this._wheelZActionCoordinate=I)}get wheelZMoveScene(){return this._wheelZAction!==v.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.BB(0),this._rotateRelative.BB(0),this._moveScene.BB(0),this._updateCamera(),this.camera.tI().useRightHandedSystem&&(this._moveRelative.z*=-1);const I=G.Matrix.Zero();this.camera.getViewMatrix().invertToRef(I);const x=G.sx.Zero();G.sx.TransformNormalToRef(this._moveRelative,I,x),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(x),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(I,x,L){if(0===I)return;if(null===x||null===L)return;let F=null;switch(x){case v.MoveRelative:F=this._moveRelative;break;case v.RotateRelative:F=this._rotateRelative;break;case v.MoveScene:F=this._moveScene}switch(L){case 0:F.set(I,0,0);break;case 1:F.set(0,I,0);break;case 2:F.set(0,0,I)}}}(0,F.d)([(0,X.K)()],s.prototype,"wheelXMoveRelative",null),(0,F.d)([(0,X.K)()],s.prototype,"wheelYMoveRelative",null),(0,F.d)([(0,X.K)()],s.prototype,"wheelZMoveRelative",null),(0,F.d)([(0,X.K)()],s.prototype,"wheelXRotateRelative",null),(0,F.d)([(0,X.K)()],s.prototype,"wheelYRotateRelative",null),(0,F.d)([(0,X.K)()],s.prototype,"wheelZRotateRelative",null),(0,F.d)([(0,X.K)()],s.prototype,"wheelXMoveScene",null),(0,F.d)([(0,X.K)()],s.prototype,"wheelYMoveScene",null),(0,F.d)([(0,X.K)()],s.prototype,"wheelZMoveScene",null),p.c.FreeCameraMouseWheelInput=s;class U{constructor(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=I,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=l.Tools.IsSafari()}attachControl(I){I=l.Tools.BackCompatCameraNoPreventDefault(arguments);let x=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=L=>{const F=L.event,X="mouse"===F.pointerType||this._isSafari&&"undefined"===typeof F.pointerType;if(this.allowMouse||!X)if(L.type===e.e.POINTERDOWN){if(I||F.preventDefault(),this._pointerPressed.push(F.pointerId),1!==this._pointerPressed.length)return;x={x:F.clientX,y:F.clientY}}else if(L.type===e.e.POINTERUP){I||F.preventDefault();const L=this._pointerPressed.indexOf(F.pointerId);if(-1===L)return;if(this._pointerPressed.splice(L,1),0!=L)return;x=null,this._offsetX=null,this._offsetY=null}else if(L.type===e.e.POINTERMOVE){if(I||F.preventDefault(),!x)return;if(0!=this._pointerPressed.indexOf(F.pointerId))return;this._offsetX=F.clientX-x.x,this._offsetY=-(F.clientY-x.y)}}),this._observer=this.camera.tI()._inputManager._addCameraPointerObserver(this._pointerInput,e.e.POINTERDOWN|e.e.POINTERUP|e.e.POINTERMOVE),this._onLostFocus){const I=this.camera.getEngine().getInputElement();I&&I.addEventListener("blur",this._onLostFocus)}}ye(){if(this._pointerInput){if(this._observer&&(this.camera.tI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const I=this.camera.getEngine().getInputElement();I&&I.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const I=this.camera,x=I._calculateHandednessMultiplier();I.cameraRotation.y=x*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)I.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const x=I._computeLocalCameraSpeed(),L=new G.sx(0,0,0!==this.touchMoveSensibility?x*this._offsetY/this.touchMoveSensibility:0);G.Matrix.RotationYawPitchRollToRef(I.rotation.y,I.rotation.x,0,I._cameraRotationMatrix),I.cameraDirection.addInPlace(G.sx.TransformCoordinates(L,I._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,F.d)([(0,X.K)()],U.prototype,"touchAngularSensibility",void 0),(0,F.d)([(0,X.K)()],U.prototype,"touchMoveSensibility",void 0),p.c.FreeCameraTouchInput=U;class q extends p.f{constructor(I){super(I),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new W),this}addMouse(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new g(I),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new s,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new U),this}clear(){super.clear(),this._mouseInput=null}}var y=L(12938),T=L(12872);class Z extends Y.b{get angularSensibility(){const I=this.inputs.attached.mouse;return I?I.angularSensibility:0}set angularSensibility(I){const x=this.inputs.attached.mouse;x&&(x.angularSensibility=I)}get keysUp(){const I=this.inputs.attached.keyboard;return I?I.keysUp:[]}set keysUp(I){const x=this.inputs.attached.keyboard;x&&(x.keysUp=I)}get keysUpward(){const I=this.inputs.attached.keyboard;return I?I.keysUpward:[]}set keysUpward(I){const x=this.inputs.attached.keyboard;x&&(x.keysUpward=I)}get keysDown(){const I=this.inputs.attached.keyboard;return I?I.keysDown:[]}set keysDown(I){const x=this.inputs.attached.keyboard;x&&(x.keysDown=I)}get keysDownward(){const I=this.inputs.attached.keyboard;return I?I.keysDownward:[]}set keysDownward(I){const x=this.inputs.attached.keyboard;x&&(x.keysDownward=I)}get keysLeft(){const I=this.inputs.attached.keyboard;return I?I.keysLeft:[]}set keysLeft(I){const x=this.inputs.attached.keyboard;x&&(x.keysLeft=I)}get keysRight(){const I=this.inputs.attached.keyboard;return I?I.keysRight:[]}set keysRight(I){const x=this.inputs.attached.keyboard;x&&(x.keysRight=I)}get keysRotateLeft(){const I=this.inputs.attached.keyboard;return I?I.keysRotateLeft:[]}set keysRotateLeft(I){const x=this.inputs.attached.keyboard;x&&(x.keysRotateLeft=I)}get keysRotateRight(){const I=this.inputs.attached.keyboard;return I?I.keysRotateRight:[]}set keysRotateRight(I){const x=this.inputs.attached.keyboard;x&&(x.keysRotateRight=I)}get keysRotateUp(){const I=this.inputs.attached.keyboard;return I?I.keysRotateUp:[]}set keysRotateUp(I){const x=this.inputs.attached.keyboard;x&&(x.keysRotateUp=I)}get keysRotateDown(){const I=this.inputs.attached.keyboard;return I?I.keysRotateDown:[]}set keysRotateDown(I){const x=this.inputs.attached.keyboard;x&&(x.keysRotateDown=I)}constructor(I,x,L){var F;super(I,x,L,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),F=this,this.ellipsoid=new G.sx(.5,1,.5),this.ellipsoidOffset=new G.sx(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=G.sx.Zero(),this._diffPosition=G.sx.Zero(),this._newPosition=G.sx.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;F._newPosition.X(x),F._newPosition.subtractToRef(F._oldPosition,F._diffPosition),F._diffPosition.length()>T.d.CollisionsEpsilon&&(F.position.addToRef(F._diffPosition,F._deferredPositionUpdate),F._deferOnly?F._deferredUpdated=!0:F.position.X(F._deferredPositionUpdate),F.Kv&&L&&F.Kv(L))},this.inputs=new q(this),this.inputs.addKeyboard().addMouse()}attachControl(I,x){x=l.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(x)}ye(){this.inputs.detachElement(),this.cameraDirection=new G.sx(0,0,0),this.cameraRotation=new G.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(I){this._collisionMask=isNaN(I)?-1:I}_collideWithWorld(I){let x;x=this.parent?G.sx.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,x.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const L=this.tI().collisionCoordinator;this._collider||(this._collider=L.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let F=I;this.applyGravity&&(F=I.add(this.tI().gravity)),L.getNewPosition(this._oldPosition,F,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=G.sx.Zero(),this._transformedDirection=G.sx.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(I){this._needMoveForGravity=I}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.tI().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ve"}}(0,F.d)([(0,X.I)()],Z.prototype,"ellipsoid",void 0),(0,F.d)([(0,X.I)()],Z.prototype,"ellipsoidOffset",void 0),(0,F.d)([(0,X.K)()],Z.prototype,"checkCollisions",void 0),(0,F.d)([(0,X.K)()],Z.prototype,"applyGravity",void 0),(0,y.d)("BABYLON.FreeCamera",Z)},15100:(I,x,L)=>{"use strict";L.d(x,{b:()=>G});var F=L(13076),X=L(15107);class G{constructor(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=L,this.me=[],this._maxBlockCapacity=x||64,this._selectionContent=new F.b(1024),this._creationFunc=I}update(I,x,L){X.b._CreateBlocks(I,x,L,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}NW(I){for(let x=0;x<this.VW.length;x++){this.VW[x].addEntry(I)}}rW(I){for(let x=0;x<this.VW.length;x++){this.VW[x].removeEntry(I)}}select(I,x){this._selectionContent.reset();for(let L=0;L<this.VW.length;L++){this.VW[L].select(I,this._selectionContent,x)}return x?this._selectionContent.concat(this.me):this._selectionContent.concatWithNoDuplicate(this.me),this._selectionContent}intersects(I,x,L){this._selectionContent.reset();for(let F=0;F<this.VW.length;F++){this.VW[F].intersects(I,x,this._selectionContent,L)}return L?this._selectionContent.concat(this.me):this._selectionContent.concatWithNoDuplicate(this.me),this._selectionContent}intersectsRay(I){this._selectionContent.reset();for(let x=0;x<this.VW.length;x++){this.VW[x].intersectsRay(I,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.me),this._selectionContent}}G.CreationFuncForMeshes=(I,x)=>{const L=I.getBoundingInfo();!I.isBlocked&&L.boundingBox.intersectsMinMax(x.DQ,x.rQ)&&x.entries.push(I)},G.CreationFuncForSubMeshes=(I,x)=>{I.getBoundingInfo().boundingBox.intersectsMinMax(x.DQ,x.rQ)&&x.entries.push(I)}},15107:(I,x,L)=>{"use strict";L.d(x,{b:()=>G});var F=L(12983),X=L(13325);class G{constructor(I,x,L,F,X,G){this.entries=[],this.NQ=new Array,this._capacity=L,this._depth=F,this._maxDepth=X,this._creationFunc=G,this._minPoint=I,this._maxPoint=x,this.NQ.push(I.clone()),this.NQ.push(x.clone()),this.NQ.push(I.clone()),this.NQ[2].x=x.x,this.NQ.push(I.clone()),this.NQ[3].y=x.y,this.NQ.push(I.clone()),this.NQ[4].z=x.z,this.NQ.push(x.clone()),this.NQ[5].z=I.z,this.NQ.push(x.clone()),this.NQ[6].x=I.x,this.NQ.push(x.clone()),this.NQ[7].y=I.y}get tL(){return this._capacity}get DQ(){return this._minPoint}get rQ(){return this._maxPoint}addEntry(I){if(this.VW)for(let x=0;x<this.VW.length;x++){this.VW[x].addEntry(I)}else this._creationFunc(I,this),this.entries.length>this.tL&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(I){if(this.VW){for(let x=0;x<this.VW.length;x++){this.VW[x].removeEntry(I)}return}const x=this.entries.indexOf(I);x>-1&&this.entries.splice(x,1)}addEntries(I){for(let x=0;x<I.length;x++){const L=I[x];this.addEntry(L)}}select(I,x,L){if(X.e.IsInFrustum(this.NQ,I)){if(this.VW){for(let F=0;F<this.VW.length;F++){this.VW[F].select(I,x,L)}return}L?x.concat(this.entries):x.concatWithNoDuplicate(this.entries)}}intersects(I,x,L,F){if(X.e.IntersectsSphere(this._minPoint,this._maxPoint,I,x)){if(this.VW){for(let X=0;X<this.VW.length;X++){this.VW[X].intersects(I,x,L,F)}return}F?L.concat(this.entries):L.concatWithNoDuplicate(this.entries)}}intersectsRay(I,x){if(I.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.VW){for(let L=0;L<this.VW.length;L++){this.VW[L].intersectsRay(I,x)}return}x.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){G._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(I,x,L,X,Y,p,B,l){B.VW=new Array;const W=new F.sx((x.x-I.x)/2,(x.y-I.y)/2,(x.z-I.z)/2);for(let F=0;F<2;F++)for(let x=0;x<2;x++)for(let Q=0;Q<2;Q++){const e=I.add(W.multiplyByFloats(F,x,Q)),g=I.add(W.multiplyByFloats(F+1,x+1,Q+1)),v=new G(e,g,X,Y+1,p,l);v.addEntries(L),B.VW.push(v)}}}},15109:(I,x,L)=>{"use strict";L.d(x,{c:()=>W});var F=L(13218),X=L(12983),G=L(13411),Y=L(14187),p=L(13252),B=L(15100),l=L(12840);F.b.prototype.createOrUpdateSelectionOctree=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,L=this._getComponent(p.e.NAME_OCTREE);L||(L=new W(this),this.o(L)),this.uQ||(this.uQ=new B.b(B.b.CreationFuncForMeshes,I,x));const F=this.getWorldExtends();return this.uQ.update(F.min,F.max,this.meshes),this.uQ},Object.defineProperty(F.b.prototype,"selectionOctree",{get:function(){return this.uQ},enumerable:!0,configurable:!0}),G.b.prototype.createOrUpdateSubmeshesOctree=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const L=this.tI();let F=L._getComponent(p.e.NAME_OCTREE);F||(F=new W(L),L.o(F)),this._submeshesOctree||(this._submeshesOctree=new B.b(B.b.CreationFuncForSubMeshes,I,x)),this.LB(!0);const X=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(X.minimumWorld,X.maximumWorld,this.jp),this._submeshesOctree};class W{constructor(I){this.name=p.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Y.b(X.sx.Zero(),new X.sx(1,1,1)),(I=I||l.e.LastCreatedScene)&&(this.qx=I,this.qx.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.qx.getActiveSubMeshCandidates=I=>this.getActiveSubMeshCandidates(I),this.qx.getCollidingSubMeshCandidates=(I,x)=>this.getCollidingSubMeshCandidates(I,x),this.qx.getIntersectingSubMeshCandidates=(I,x)=>this.getIntersectingSubMeshCandidates(I,x))}register(){this.qx.onMeshRemovedObservable.add((I=>{const x=this.qx.selectionOctree;if(void 0!==x&&null!==x){const L=x.me.indexOf(I);-1!==L&&x.me.splice(L,1)}})),this.qx.onMeshImportedObservable.add((I=>{const x=this.qx.selectionOctree;void 0!==x&&null!==x&&x.NW(I)}))}getActiveMeshCandidates(){var I;return(null===(I=this.qx.uQ)||void 0===I?void 0:I.select(this.qx.frustumPlanes))||this.qx._getDefaultMeshCandidates()}getActiveSubMeshCandidates(I){if(I._submeshesOctree&&I.useOctreeForRenderingSelection){return I._submeshesOctree.select(this.qx.frustumPlanes)}return this.qx._getDefaultSubMeshCandidates(I)}getIntersectingSubMeshCandidates(I,x){if(I._submeshesOctree&&I.useOctreeForPicking){Y.b.TransformToRef(x,I.getWorldMatrix(),this._tempRay);return I._submeshesOctree.intersectsRay(this._tempRay)}return this.qx._getDefaultSubMeshCandidates(I)}getCollidingSubMeshCandidates(I,x){if(I._submeshesOctree&&I.useOctreeForCollisions){const L=x._velocityWorldLength+Math.max(x._radius.x,x._radius.y,x._radius.z);return I._submeshesOctree.intersects(x._basePointWorld,L)}return this.qx._getDefaultSubMeshCandidates(I)}rebuild(){}dispose(){}}},14187:(I,x,L)=>{"use strict";L.d(x,{b:()=>g});var F=L(13218),X=L(13434),G=L(12989),Y=L(12983),p=L(12996),B=L(13309),l=L(13245),W=L(12840),Q=L(13272);const e={internalPickerForMesh:void 0};class g{constructor(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.e;this.origin=I,this.direction=x,this.length=L,this.epsilon=F}clone(){return new g(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const F=g._TmpVector3[0].YB(I.x-L,I.y-L,I.z-L),X=g._TmpVector3[1].YB(x.x+L,x.y+L,x.z+L);let G,Y,p,B,l=0,W=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<F.x||this.origin.x>X.x)return!1}else if(G=1/this.direction.x,Y=(F.x-this.origin.x)*G,p=(X.x-this.origin.x)*G,p===-1/0&&(p=1/0),Y>p&&(B=Y,Y=p,p=B),l=Math.max(Y,l),W=Math.min(p,W),l>W)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<F.y||this.origin.y>X.y)return!1}else if(G=1/this.direction.y,Y=(F.y-this.origin.y)*G,p=(X.y-this.origin.y)*G,p===-1/0&&(p=1/0),Y>p&&(B=Y,Y=p,p=B),l=Math.max(Y,l),W=Math.min(p,W),l>W)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<F.z||this.origin.z>X.z)return!1}else if(G=1/this.direction.z,Y=(F.z-this.origin.z)*G,p=(X.z-this.origin.z)*G,p===-1/0&&(p=1/0),Y>p&&(B=Y,Y=p,p=B),l=Math.max(Y,l),W=Math.min(p,W),l>W)return!1;return!0}intersectsBox(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(I.minimum,I.maximum,x)}intersectsSphere(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=I.center.x-this.origin.x,F=I.center.y-this.origin.y,X=I.center.z-this.origin.z,G=L*L+F*F+X*X,Y=I.radius+x,p=Y*Y;if(G<=p)return!0;const B=L*this.direction.x+F*this.direction.y+X*this.direction.z;if(B<0)return!1;return G-B*B<=p}intersectsTriangle(I,x,L){const F=g._TmpVector3[0],X=g._TmpVector3[1],G=g._TmpVector3[2],p=g._TmpVector3[3],l=g._TmpVector3[4];x.subtractToRef(I,F),L.subtractToRef(I,X),Y.sx.CrossToRef(this.direction,X,G);const W=Y.sx.Dot(F,G);if(0===W)return null;const Q=1/W;this.origin.subtractToRef(I,p);const e=Y.sx.Dot(p,G)*Q;if(e<-this.epsilon||e>1+this.epsilon)return null;Y.sx.CrossToRef(p,F,l);const v=Y.sx.Dot(this.direction,l)*Q;if(v<-this.epsilon||e+v>1+this.epsilon)return null;const z=Y.sx.Dot(X,l)*Q;return z>this.length?null:new B.b(1-e-v,e,z)}intersectsPlane(I){let x;const L=Y.sx.Dot(I.normal,this.direction);if(Math.abs(L)<9.99999997475243e-7)return null;{const F=Y.sx.Dot(I.normal,this.origin);return x=(-I.d-F)/L,x<0?x<-9.99999997475243e-7?null:0:x}}intersectsAxis(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(I){case"y":{const I=(this.origin.y-x)/this.direction.y;return I>0?null:new Y.sx(this.origin.x+this.direction.x*-I,x,this.origin.z+this.direction.z*-I)}case"x":{const I=(this.origin.x-x)/this.direction.x;return I>0?null:new Y.sx(x,this.origin.y+this.direction.y*-I,this.origin.z+this.direction.z*-I)}case"z":{const I=(this.origin.z-x)/this.direction.z;return I>0?null:new Y.sx(this.origin.x+this.direction.x*-I,this.origin.y+this.direction.y*-I,x)}default:return null}}intersectsMesh(I,x,L){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const p=Y.TmpVectors.Matrix[0];return I.getWorldMatrix().invertToRef(p),this._tmpRay?g.TransformToRef(this,p,this._tmpRay):this._tmpRay=g.Transform(this,p),I.intersects(this._tmpRay,x,L,F,X,G)}intersectsMeshes(I,x,L){L?L.length=0:L=[];for(let F=0;F<I.length;F++){const X=this.intersectsMesh(I[F],x);X.hit&&L.push(X)}return L.sort(this._comparePickingInfo),L}_comparePickingInfo(I,x){return I.distance<x.distance?-1:I.distance>x.distance?1:0}intersectionSegment(I,x,L){const F=this.origin,X=Y.TmpVectors.sx[0],G=Y.TmpVectors.sx[1],p=Y.TmpVectors.sx[2],B=Y.TmpVectors.sx[3];x.subtractToRef(I,X),this.direction.scaleToRef(g._Rayl,p),F.addToRef(p,G),I.subtractToRef(F,B);const l=Y.sx.Dot(X,X),W=Y.sx.Dot(X,p),Q=Y.sx.Dot(p,p),e=Y.sx.Dot(X,B),v=Y.sx.Dot(p,B),z=l*Q-W*W;let H,s,U=z,q=z;z<g._Smallnum?(H=0,U=1,s=v,q=Q):(H=W*v-Q*e,s=l*v-W*e,H<0?(H=0,s=v,q=Q):H>U&&(H=U,s=v+W,q=Q)),s<0?(s=0,-e<0?H=0:-e>l?H=U:(H=-e,U=l)):s>q&&(s=q,-e+W<0?H=0:-e+W>l?H=U:(H=-e+W,U=l));const y=Math.abs(H)<g._Smallnum?0:H/U,T=Math.abs(s)<g._Smallnum?0:s/q,Z=Y.TmpVectors.sx[4];p.scaleToRef(T,Z);const t=Y.TmpVectors.sx[5];X.scaleToRef(y,t),t.addInPlace(B);const f=Y.TmpVectors.sx[6];t.subtractToRef(Z,f);return T>0&&T<=this.length&&f.lengthSquared()<L*L?t.length():-1}update(I,x,L,F,X,G,p){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){g._RayDistant||(g._RayDistant=g.Zero()),g._RayDistant.unprojectRayToRef(I,x,L,F,Y.Matrix.IdentityReadOnly,G,p);const B=Y.TmpVectors.Matrix[0];X.invertToRef(B),g.TransformToRef(g._RayDistant,B,this)}else this.unprojectRayToRef(I,x,L,F,X,G,p);return this}static Zero(){return new g(Y.sx.Zero(),Y.sx.Zero())}static CreateNew(I,x,L,F,X,G,Y){return g.Zero().update(I,x,L,F,X,G,Y)}static CreateNewFromTo(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.Matrix.IdentityReadOnly;const F=new g(new Y.sx(0,0,0),new Y.sx(0,0,0));return g.CreateFromToToRef(I,x,F,L)}static CreateFromToToRef(I,x,L){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.Matrix.IdentityReadOnly;L.origin.X(I);const X=x.subtractToRef(I,L.direction),G=Math.sqrt(X.x*X.x+X.y*X.y+X.z*X.z);return L.length=G,L.direction.normalize(),g.TransformToRef(L,F,L)}static Transform(I,x){const L=new g(new Y.sx(0,0,0),new Y.sx(0,0,0));return g.TransformToRef(I,x,L),L}static TransformToRef(I,x,L){Y.sx.TransformCoordinatesToRef(I.origin,x,L.origin),Y.sx.TransformNormalToRef(I.direction,x,L.direction),L.length=I.length,L.epsilon=I.epsilon;const F=L.direction,X=F.length();if(0!==X&&1!==X){const I=1/X;F.x*=I,F.y*=I,F.z*=I,L.length*=X}return L}unprojectRayToRef(I,x,L,F,X,G,p){const B=Y.TmpVectors.Matrix[0];X.multiplyToRef(G,B),B.multiplyToRef(p,B),B.invert();const l=W.e.LastCreatedEngine,Q=Y.TmpVectors.sx[0];Q.x=I/L*2-1,Q.y=-(x/F*2-1),Q.z=null!==l&&void 0!==l&&l.dp?1:null!==l&&void 0!==l&&l.isNDCHalfZRange?0:-1;const e=Y.TmpVectors.sx[1].YB(Q.x,Q.y,1-1e-8),g=Y.TmpVectors.sx[2],v=Y.TmpVectors.sx[3];Y.sx._UnprojectFromInvertedMatrixToRef(Q,B,g),Y.sx._UnprojectFromInvertedMatrixToRef(e,B,v),this.origin.X(g),v.subtractToRef(g,this.direction),this.direction.normalize()}}function v(I,x,L,F,X){let G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=g.Zero();return z(I,x,L,F,Y,X,G),Y}function z(I,x,L,F,X,G){let p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=I.getEngine();if(!G&&!(G=I.activeCamera))return I;const W=G.viewport,Q=l.getRenderHeight(),{x:e,y:g,width:v,height:z}=W.toGlobal(l.getRenderWidth(),Q),H=1/l.getHardwareScalingLevel();return x=x*H-e,L=L*H-(Q-g-z),X.update(x,L,v,z,F||Y.Matrix.IdentityReadOnly,p?Y.Matrix.IdentityReadOnly:G.getViewMatrix(),G.getProjectionMatrix(),B),I}function H(I,x,L,F,X){if(!l.e)return I;const G=I.getEngine();if(!X&&!(X=I.activeCamera))throw new Error("Active camera not set");const p=X.viewport,B=G.getRenderHeight(),{x:W,y:Q,width:e,height:g}=p.toGlobal(G.getRenderWidth(),B),v=Y.Matrix.Identity(),z=1/G.getHardwareScalingLevel();return x=x*z-W,L=L*z-(B-Q-g),F.update(x,L,e,g,v,v,X.getProjectionMatrix()),I}function s(I,x,L,F,X,G,Y,p){const B=x(F,L.enableDistantPicking),l=L.intersects(B,X,Y,G,F,p);return l&&l.hit?!X&&null!=I&&l.distance>=I.distance?null:l:null}function U(I,x,L,F,X,G){let p=null;const B=!!(I.activeCameras&&I.activeCameras.length>1&&I.cameraToUseForPointers!==I.activeCamera),W=I.cameraToUseForPointers||I.activeCamera,Q=e.internalPickerForMesh||s;for(let l=0;l<I.meshes.length;l++){const e=I.meshes[l];if(L){if(!L(e,-1))continue}else if(!e.isEnabled()||!e.isVisible||!e.Zl)continue;const g=B&&e.isWorldMatrixCameraDependent(),v=e.LB(g,W);if(e.hasThinInstances&&e.XW){const I=Q(p,x,e,v,!0,!0,G);if(I){if(X)return I;const B=Y.TmpVectors.Matrix[1],l=e.thinInstanceGetWorldMatrices();for(let I=0;I<l.length;I++){if(L&&!L(e,I))continue;l[I].multiplyToRef(v,B);const Y=Q(p,x,e,B,F,X,G,!0);if(Y&&(p=Y,p.thinInstanceIndex=I,F))return p}}}else{const I=Q(p,x,e,v,F,X,G);if(I&&(p=I,F))return p}}return p||new l.e}function q(I,x,L,F){if(!l.e)return null;const X=[],G=!!(I.activeCameras&&I.activeCameras.length>1&&I.cameraToUseForPointers!==I.activeCamera),p=I.cameraToUseForPointers||I.activeCamera,B=e.internalPickerForMesh||s;for(let l=0;l<I.meshes.length;l++){const W=I.meshes[l];if(L){if(!L(W,-1))continue}else if(!W.isEnabled()||!W.isVisible||!W.Zl)continue;const Q=G&&W.isWorldMatrixCameraDependent(),e=W.LB(Q,p);if(W.hasThinInstances&&W.XW){if(B(null,x,W,e,!0,!0,F)){const I=Y.TmpVectors.Matrix[1],G=W.thinInstanceGetWorldMatrices();for(let Y=0;Y<G.length;Y++){if(L&&!L(W,Y))continue;G[Y].multiplyToRef(e,I);const p=B(null,x,W,I,!1,!1,F,!0);p&&(p.thinInstanceIndex=Y,X.push(p))}}}else{const I=B(null,x,W,e,!1,!1,F);I&&X.push(I)}}return X}function y(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,F=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0;F||(F=I.getWorldMatrix()),x.length=L,X?x.origin.X(X):x.origin.X(I.position);const G=Y.TmpVectors.sx[2];G.set(0,0,I._scene.useRightHandedSystem?-1:1);const p=Y.TmpVectors.sx[3];return Y.sx.TransformNormalToRef(G,F,p),Y.sx.NormalizeToRef(p,x.direction),x}var T,Z;g._TmpVector3=(0,p.c)(6,Y.sx.Zero),g._RayDistant=g.Zero(),g._Smallnum=1e-8,g._Rayl=1e9,T=F.b,(Z=X.b)&&(Z.prototype.getForwardRay=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,x=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;return y(this,new g(Y.sx.Zero(),Y.sx.Zero(),I),I,x,L)},Z.prototype.getForwardRayToRef=function(I){return y(this,I,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),T&&(Q.e._IsPickingAvailable=!0,T.prototype.createPickingRay=function(I,x,L,F){return v(this,I,x,L,F,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),F.b.prototype.createPickingRayToRef=function(I,x,L,F,X){return z(this,I,x,L,F,X,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},F.b.prototype.createPickingRayInCameraSpace=function(I,x,L){return function(I,x,L,F){const X=g.Zero();return H(I,x,L,X,F),X}(this,I,x,L)},F.b.prototype.createPickingRayInCameraSpaceToRef=function(I,x,L,F){return H(this,I,x,L,F)},F.b.prototype.pickWithBoundingInfo=function(I,x,L,F,X){return function(I,x,L,F,X,G){if(!l.e)return null;const p=U(I,(F=>(I._tempPickingRay||(I._tempPickingRay=g.Zero()),z(I,x,L,F,I._tempPickingRay,G||null),I._tempPickingRay)),F,X,!0);return p&&(p.ray=v(I,x,L,Y.Matrix.Identity(),G||null)),p}(this,I,x,L,F,X)},F.b.prototype.nL=function(I,x,L,F,X,G){return function(I,x,L,F,X,G,p){const B=U(I,((F,X)=>(I._tempPickingRay||(I._tempPickingRay=g.Zero()),z(I,x,L,F,I._tempPickingRay,G||null,!1,X),I._tempPickingRay)),F,X,!1,p);return B&&(B.ray=v(I,x,L,Y.Matrix.Identity(),G||null)),B}(this,I,x,L,F,X,G)},F.b.prototype.pickWithRay=function(I,x,L,F){return function(I,x,L,F,X){const G=U(I,(L=>(I._pickWithRayInverseMatrix||(I._pickWithRayInverseMatrix=Y.Matrix.Identity()),L.invertToRef(I._pickWithRayInverseMatrix),I._cachedRayForTransform||(I._cachedRayForTransform=g.Zero()),g.TransformToRef(x,I._pickWithRayInverseMatrix,I._cachedRayForTransform),I._cachedRayForTransform)),L,F,!1,X);return G&&(G.ray=x),G}(this,I,x,L,F)},F.b.prototype.multiPick=function(I,x,L,F,X){return function(I,x,L,F,X,G){return q(I,(F=>v(I,x,L,F,X||null)),F,G)}(this,I,x,L,F,X)},F.b.prototype.multiPickWithRay=function(I,x,L){return function(I,x,L,F){return q(I,(L=>(I._pickWithRayInverseMatrix||(I._pickWithRayInverseMatrix=Y.Matrix.Identity()),L.invertToRef(I._pickWithRayInverseMatrix),I._cachedRayForTransform||(I._cachedRayForTransform=g.Zero()),g.TransformToRef(x,I._pickWithRayInverseMatrix,I._cachedRayForTransform),I._cachedRayForTransform)),L,F)}(this,I,x,L)}},14466:(I,x,L)=>{"use strict";var F=L(12909),X=L(12809),G=L(12842),Y=L(12945),p=L(12872),B=L(12924);p.d.prototype._partialLoadFile=function(I,x,L,F){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(I,(I=>{L[x]=I,L._internalCount++,6===L._internalCount&&F(L)}),void 0,void 0,!0,((I,x)=>{X&&I&&X(I.status+" "+I.statusText,x)}))},p.d.prototype._cascadeLoadFiles=function(I,x,L){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const X=[];X._internalCount=0;for(let G=0;G<6;G++)this._partialLoadFile(L[G],G,X,x,F)},p.d.prototype._cascadeLoadImgs=function(I,x,L,F){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5?arguments[5]:void 0;const Y=[];Y._internalCount=0;for(let p=0;p<6;p++)this._partialLoadImg(F[p],p,Y,I,x,L,X,G)},p.d.prototype._partialLoadImg=function(I,x,L,F,X,p){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7?arguments[7]:void 0;const W=(0,Y.e)();(0,G.p)(I,(I=>{L[x]=I,L._internalCount++,F&&F.removePendingData(W),6===L._internalCount&&p&&p(X,L)}),((I,x)=>{F&&F.removePendingData(W),B&&B(I,x)}),F?F.offlineProvider:null,l),F&&F.addPendingData(W)},p.d.prototype.createCubeTextureBase=function(I,x,L,G){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6?arguments[6]:void 0,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,H=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,s=arguments.length>14&&void 0!==arguments[14]&&arguments[14],U=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const q=v||new F.d(this,7);q.isCube=!0,q.url=I,q.generateMipMaps=!G,q._lodGenerationScale=e,q._lodGenerationOffset=g,q._useSRGBBuffer=!!s&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!G),q!==v&&(q.label=I.substring(0,60)),this._doNotHandleContextLost||(q._extension=W,q._files=L,q._buffer=U);const y=I;this._transformTextureUrl&&!v&&(I=this._transformTextureUrl(I));const T=W??function(I){const x=I.split("?")[0],L=x.lastIndexOf(".");return L>-1?x.substring(L).toLowerCase():""}(I),Z=(0,B.d)(T),t=(I,x)=>{q.dispose(),p?p(I,x):I&&X.c.Warn(I)},f=(F,p)=>{I===y?F&&t(F.status+" "+F.statusText,p):(X.c.Warn(`Failed to load ${I}, falling back to the ${y}`),this.createCubeTextureBase(y,x,L,!!G,Y,t,l,W,Q,e,g,q,z,H,s,U))};if(Z)Z.then((F=>{const X=I=>{z&&z(q,I),F.loadCubeData(I,q,Q,Y,((I,x)=>{t(I,x)}))};U?X(U):L&&6===L.length?F.supportCascades?this._cascadeLoadFiles(x,(I=>X(I.map((I=>new Uint8Array(I))))),L,t):t("Textures type does not support cascades."):this._loadFile(I,(I=>X(new Uint8Array(I))),void 0,void 0,!0,f)}));else{if(!L||0===L.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(x,q,((I,x)=>{H&&H(I,x)}),L,t)}return this._internalTexturesCache.push(q),q}},15117:(I,x,L)=>{"use strict";L(12809);var F=L(13112);L(12909),L(13056),L(12901),L(13162),L(13124);F.b},14493:(I,x,L)=>{"use strict";L.d(x,{b:()=>X});var F=L(12938);class X{constructor(I){this.value=this._toInt(I)}_toInt(I){return 0|I}add(I){return new X(this.value+I.value)}Ux(I){return new X(this.value-I.value)}multiply(I){return new X(Math.imul(this.value,I.value))}divide(I){return new X(this.value/I.value)}getClassName(){return X.ClassName}equals(I){return this.value===I.value}static FromValue(I){return new X(I)}toString(){return this.value.toString()}}X.ClassName="FlowGraphInteger",(0,F.d)("FlowGraphInteger",X)},14501:(I,x,L)=>{"use strict";L.d(x,{c:()=>X,f:()=>G});var F=L(12983);class X{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Jp=I}get m(){return this.Jp}transformVector(I){return this.transformVectorToRef(I,new F.Vector2)}transformVectorToRef(I,x){return x.x=I.x*this.Jp[0]+I.y*this.Jp[1],x.y=I.x*this.Jp[2]+I.y*this.Jp[3],x}Cp(){return this.toArray()}toArray(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let x=0;x<4;x++)I[x]=this.Jp[x];return I}PL(I){for(let x=0;x<4;x++)this.Jp[x]=I[x];return this}multiplyToRef(I,x){const L=I.Jp,F=this.Jp,X=x.Jp;return X[0]=L[0]*F[0]+L[1]*F[2],X[1]=L[0]*F[1]+L[1]*F[3],X[2]=L[2]*F[0]+L[3]*F[2],X[3]=L[2]*F[1]+L[3]*F[3],x}multiply(I){return this.multiplyToRef(I,new X)}divideToRef(I,x){const L=this.Jp,F=I.Jp,X=x.Jp;return X[0]=L[0]/F[0],X[1]=L[1]/F[1],X[2]=L[2]/F[2],X[3]=L[3]/F[3],x}divide(I){return this.divideToRef(I,new X)}addToRef(I,x){const L=this.Jp,F=I.m,X=x.m;return X[0]=L[0]+F[0],X[1]=L[1]+F[1],X[2]=L[2]+F[2],X[3]=L[3]+F[3],x}add(I){return this.addToRef(I,new X)}subtractToRef(I,x){const L=this.Jp,F=I.m,X=x.m;return X[0]=L[0]-F[0],X[1]=L[1]-F[1],X[2]=L[2]-F[2],X[3]=L[3]-F[3],x}Ux(I){return this.subtractToRef(I,new X)}transpose(){const I=this.Jp;return new X([I[0],I[2],I[1],I[3]])}determinant(){const I=this.Jp;return I[0]*I[3]-I[1]*I[2]}inverse(){const I=this.determinant();if(0===I)throw new Error("Matrix is not invertible");const x=this.Jp,L=1/I;return new X([x[3]*L,-x[1]*L,-x[2]*L,x[0]*L])}equals(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=this.Jp,F=I.m;return 0===x?L[0]===F[0]&&L[1]===F[1]&&L[2]===F[2]&&L[3]===F[3]:Math.abs(L[0]-F[0])<x&&Math.abs(L[1]-F[1])<x&&Math.abs(L[2]-F[2])<x&&Math.abs(L[3]-F[3])<x}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Jp.join(", ")})`}}class G{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Jp=I}get m(){return this.Jp}transformVector(I){return this.transformVectorToRef(I,new F.sx)}transformVectorToRef(I,x){const L=this.Jp;return x.x=I.x*L[0]+I.y*L[1]+I.z*L[2],x.y=I.x*L[3]+I.y*L[4]+I.z*L[5],x.z=I.x*L[6]+I.y*L[7]+I.z*L[8],x}multiplyToRef(I,x){const L=I.Jp,F=this.Jp,X=x.m;return X[0]=L[0]*F[0]+L[1]*F[3]+L[2]*F[6],X[1]=L[0]*F[1]+L[1]*F[4]+L[2]*F[7],X[2]=L[0]*F[2]+L[1]*F[5]+L[2]*F[8],X[3]=L[3]*F[0]+L[4]*F[3]+L[5]*F[6],X[4]=L[3]*F[1]+L[4]*F[4]+L[5]*F[7],X[5]=L[3]*F[2]+L[4]*F[5]+L[5]*F[8],X[6]=L[6]*F[0]+L[7]*F[3]+L[8]*F[6],X[7]=L[6]*F[1]+L[7]*F[4]+L[8]*F[7],X[8]=L[6]*F[2]+L[7]*F[5]+L[8]*F[8],x}multiply(I){return this.multiplyToRef(I,new G)}divideToRef(I,x){const L=this.Jp,F=I.m,X=x.m;return X[0]=L[0]/F[0],X[1]=L[1]/F[1],X[2]=L[2]/F[2],X[3]=L[3]/F[3],X[4]=L[4]/F[4],X[5]=L[5]/F[5],X[6]=L[6]/F[6],X[7]=L[7]/F[7],X[8]=L[8]/F[8],x}divide(I){return this.divideToRef(I,new G)}addToRef(I,x){const L=this.Jp,F=I.m,X=x.m;return X[0]=L[0]+F[0],X[1]=L[1]+F[1],X[2]=L[2]+F[2],X[3]=L[3]+F[3],X[4]=L[4]+F[4],X[5]=L[5]+F[5],X[6]=L[6]+F[6],X[7]=L[7]+F[7],X[8]=L[8]+F[8],x}add(I){return this.addToRef(I,new G)}subtractToRef(I,x){const L=this.Jp,F=I.m,X=x.m;return X[0]=L[0]-F[0],X[1]=L[1]-F[1],X[2]=L[2]-F[2],X[3]=L[3]-F[3],X[4]=L[4]-F[4],X[5]=L[5]-F[5],X[6]=L[6]-F[6],X[7]=L[7]-F[7],X[8]=L[8]-F[8],x}Ux(I){return this.subtractToRef(I,new G)}toArray(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let x=0;x<9;x++)I[x]=this.Jp[x];return I}Cp(){return this.toArray()}PL(I){for(let x=0;x<9;x++)this.Jp[x]=I[x];return this}transpose(){const I=this.Jp;return new G([I[0],I[3],I[6],I[1],I[4],I[7],I[2],I[5],I[8]])}determinant(){const I=this.Jp;return I[0]*(I[4]*I[8]-I[5]*I[7])-I[1]*(I[3]*I[8]-I[5]*I[6])+I[2]*(I[3]*I[7]-I[4]*I[6])}inverse(){const I=this.determinant();if(0===I)throw new Error("Matrix is not invertible");const x=this.Jp,L=1/I;return new G([(x[4]*x[8]-x[5]*x[7])*L,(x[2]*x[7]-x[1]*x[8])*L,(x[1]*x[5]-x[2]*x[4])*L,(x[5]*x[6]-x[3]*x[8])*L,(x[0]*x[8]-x[2]*x[6])*L,(x[2]*x[3]-x[0]*x[5])*L,(x[3]*x[7]-x[4]*x[6])*L,(x[1]*x[6]-x[0]*x[7])*L,(x[0]*x[4]-x[1]*x[3])*L])}equals(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=this.Jp,F=I.m;return 0===x?L[0]===F[0]&&L[1]===F[1]&&L[2]===F[2]&&L[3]===F[3]&&L[4]===F[4]&&L[5]===F[5]&&L[6]===F[6]&&L[7]===F[7]&&L[8]===F[8]:Math.abs(L[0]-F[0])<x&&Math.abs(L[1]-F[1])<x&&Math.abs(L[2]-F[2])<x&&Math.abs(L[3]-F[3])<x&&Math.abs(L[4]-F[4])<x&&Math.abs(L[5]-F[5])<x&&Math.abs(L[6]-F[6])<x&&Math.abs(L[7]-F[7])<x&&Math.abs(L[8]-F[8])<x}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Jp.join(", ")})`}}},14504:(I,x,L)=>{"use strict";var F;function X(I,x,L,F){switch(x){case"Animation":return F?I.animations.find((I=>I.uniqueId===L))??null:I.animations[L]??null;case"AnimationGroup":return F?I.animationGroups.find((I=>I.uniqueId===L))??null:I.animationGroups[L]??null;case"Mesh":return F?I.meshes.find((I=>I.uniqueId===L))??null:I.meshes[L]??null;case"Material":return F?I.materials.find((I=>I.uniqueId===L))??null:I.materials[L]??null;case"bW":return F?I.cameras.find((I=>I.uniqueId===L))??null:I.cameras[L]??null;case"Light":return F?I.lights.find((I=>I.uniqueId===L))??null:I.lights[L]??null;default:return null}}L.d(x,{b:()=>X}),function(I){I.Animation="Animation",I.AnimationGroup="AnimationGroup",I.Mesh="Mesh",I.Material="Material",I.bW="bW",I.Light="Light"}(F||(F={}))},14537:(I,x,L)=>{"use strict";L.d(x,{d:()=>X});var F=L(14540);class X extends F.e{constructor(I,x){if(super(I),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),x)for(const L of x)this._eventsSignalOutputs[L]=this._registerSignalOutput(L+"Event")}_executeOnTick(I){}_startPendingTasks(I){I._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(I),this._resetAfterCanceled(I)),this._preparePendingTasks(I),I._addPendingBlock(this),this.out._activateSignal(I),I._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(I){I._deleteExecutionVariable(this,"_initialized"),I._removePendingBlock(this)}}},14514:(I,x,L)=>{"use strict";L.d(x,{e:()=>l});var F=L(12945),X=L(12938),G=L(14517),Y=L(12797),p=L(14491);class B extends G.c{constructor(I,x,L,F){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:F.defaultValue,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(I,x,L),this.richType=F,this._defaultValue=X,this._optional=G,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new Y.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(I){this._isDisabled!==I&&(this._isDisabled=I,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(I,x){x._getConnectionValue(this)!==I&&(x._setConnectionValue(this,I),this.onValueChangedObservable.notifyObservers(I))}resetToDefaultValue(I){I._setConnectionValue(this,this._defaultValue)}connectTo(I){this._isDisabled||super.connectTo(I)}_getValueOrDefault(I){const x=I._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(x):x}getValue(I){if(1===this.connectionType){I._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(I);const x=this._getValueOrDefault(I);return this._lastValue=x,this.richType.typeTransformer?this.richType.typeTransformer(x):x}const x=this.isConnected()?this._connectedPoint[0].getValue(I):this._getValueOrDefault(I);return this._lastValue=x,this.richType.typeTransformer?this.richType.typeTransformer(x):x}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(I),I.richType={},this.richType.serialize(I.richType),I.optional=this._optional,(0,p.c)("defaultValue",this._defaultValue,I)}}(0,X.d)("FlowGraphDataConnection",B);class l{constructor(I){var x;this.config=I,this.uniqueId=(0,F.e)(),this.name=(null===(x=this.config)||void 0===x?void 0:x.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(I){}registerDataInput(I,x,L){const F=new B(I,0,this,x,L);return this.dataInputs.push(F),F}registerDataOutput(I,x,L){const F=new B(I,1,this,x,L);return this.dataOutputs.push(F),F}getDataInput(I){return this.dataInputs.find((x=>x.name===I))}getDataOutput(I){return this.dataOutputs.find((x=>x.name===I))}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.c;if(I.uniqueId=this.uniqueId,I.config={},this.config){const L=this.config,F=Object.keys(L);for(const X of F)x(X,L[X],I.config)}I.dataInputs=[],I.dataOutputs=[],I.className=this.getClassName();for(const L of this.dataInputs){const x={};L.serialize(x),I.dataInputs.push(x)}for(const L of this.dataOutputs){const x={};L.serialize(x),I.dataOutputs.push(x)}}deserialize(I){}_log(I,x,L){var F;null===(F=I.logger)||void 0===F||F.addLogItem({action:x,dL:L,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14517:(I,x,L)=>{"use strict";L.d(x,{c:()=>G});var F,X=L(12945);!function(I){I[I.Input=0]="Input",I[I.Output=1]="Output"}(F||(F={}));class G{constructor(I,x,L){this._ownerBlock=L,this._connectedPoint=[],this.uniqueId=(0,X.e)(),this.connectedPointIds=[],this.name=I,this._connectionType=x}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(I){if(this._connectionType===I._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||I._isSingularConnection()&&I._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(I),I._connectedPoint.push(this)}disconnectFrom(I){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const L=this._connectedPoint.indexOf(I),F=I._connectedPoint.indexOf(this);-1!==L&&-1!==F&&(x&&this._connectedPoint.splice(L,1),I._connectedPoint.splice(F,1))}disconnectFromAll(){for(const I of this._connectedPoint)this.disconnectFrom(I,!1);this._connectedPoint.length=0}dispose(){for(const I of this._connectedPoint)this.disconnectFrom(I)}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};I.uniqueId=this.uniqueId,I.name=this.name,I._connectionType=this._connectionType,I.connectedPointIds=[],I.className=this.getClassName();for(const x of this._connectedPoint)I.connectedPointIds.push(x.uniqueId)}getClassName(){return"FGConnection"}deserialize(I){this.uniqueId=I.uniqueId,this.name=I.name,this._connectionType=I._connectionType,this.connectedPointIds=I.connectedPointIds}}},14483:(I,x,L)=>{"use strict";L.d(x,{d:()=>q});var F,X=L(12797),G=L(12969),Y=L(12971),p=L(12945),B=L(14491),l=L(14504),W=L(12809);!function(I){I.ExecuteBlock="ExecuteBlock",I.ExecuteEvent="ExecuteEvent",I.TriggerConnection="TriggerConnection",I.ContextVariableSet="ContextVariableSet",I.GlobalVariableSet="GlobalVariableSet",I.GlobalVariableDelete="GlobalVariableDelete",I.GlobalVariableGet="GlobalVariableGet",I.AddConnection="AddConnection",I.GetConnectionValue="GetConnectionValue",I.SetConnectionValue="SetConnectionValue",I.ActivateSignal="ActivateSignal",I.ContextVariableGet="ContextVariableGet"}(F||(F={}));class Q{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(I){if(I.time||(I.time=Date.now()),this.log.push(I),this.logToConsole){var x;const L=null===(x=I.dL)||void 0===x?void 0:x.value;"object"===typeof L&&L.getClassName?W.c.Log(`[FGLog] ${I.className}:${I.uniqueId.split("-")[0]} ${I.action} - ${JSON.stringify(L.getClassName())}: ${L.toString()}`):W.c.Log(`[FGLog] ${I.className}:${I.uniqueId.split("-")[0]} ${I.action} - ${JSON.stringify(I.dL)}`)}}getItemsOfType(I){return this.log.filter((x=>x.action===I))}}class e{get enableLogging(){return this._enableLogging}set enableLogging(I){this._enableLogging!==I&&(this._enableLogging=I,this._enableLogging?(this.logger=new Q,this.logger.logToConsole=!0):this.logger=null)}constructor(I){this.uniqueId=(0,p.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new X.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=I,this.assetsContext=I.assetsContext??I.qx}hasVariable(I){return I in this._userVariables}setVariable(I,x){var L;this._userVariables[I]=x,null===(L=this.logger)||void 0===L||L.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",dL:{name:I,value:x}})}getAsset(I,x){return(0,l.b)(this.assetsContext,I,x)}getVariable(I){var x;return null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",dL:{name:I,value:this._userVariables[I]}}),this._userVariables[I]}get userVariables(){return this._userVariables}tI(){return this._configuration.qx}_getUniqueIdPrefixedName(I,x){return`${I.uniqueId}_${x}`}_getGlobalContextVariable(I,x){var L;return null===(L=this.logger)||void 0===L||L.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",dL:{name:I,defaultValue:x,possibleValue:this._globalContextVariables[I]}}),this._hasGlobalContextVariable(I)?this._globalContextVariables[I]:x}_setGlobalContextVariable(I,x){var L;null===(L=this.logger)||void 0===L||L.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",dL:{name:I,value:x}}),this._globalContextVariables[I]=x}_deleteGlobalContextVariable(I){var x;null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",dL:{name:I}}),delete this._globalContextVariables[I]}_hasGlobalContextVariable(I){return I in this._globalContextVariables}_setExecutionVariable(I,x,L){this._executionVariables[this._getUniqueIdPrefixedName(I,x)]=L}_getExecutionVariable(I,x,L){return this._hasExecutionVariable(I,x)?this._executionVariables[this._getUniqueIdPrefixedName(I,x)]:L}_deleteExecutionVariable(I,x){delete this._executionVariables[this._getUniqueIdPrefixedName(I,x)]}_hasExecutionVariable(I,x){return this._getUniqueIdPrefixedName(I,x)in this._executionVariables}_hasConnectionValue(I){return I.uniqueId in this._connectionValues}_setConnectionValue(I,x){var L;this._connectionValues[I.uniqueId]=x,null===(L=this.logger)||void 0===L||L.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",dL:{connectionPointId:I.uniqueId,value:x}})}_setConnectionValueByKey(I,x){this._connectionValues[I]=x}_getConnectionValue(I){var x;return null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",dL:{connectionPointId:I.uniqueId,value:this._connectionValues[I.uniqueId]}}),this._connectionValues[I.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(I){this._pendingBlocks.includes(I)||(this._pendingBlocks.push(I),this._pendingBlocks.sort(((I,x)=>I.priority-x.priority)))}_removePendingBlock(I){const x=this._pendingBlocks.indexOf(I);-1!==x&&this._pendingBlocks.splice(x,1)}_clearPendingBlocks(){for(const I of this._pendingBlocks)I._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(I){var x;this.onNodeExecutedObservable.notifyObservers(I),null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:I.getClassName(),uniqueId:I.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(I){this._setGlobalContextVariable("timeSinceStart",I.timeSinceStart),this._setGlobalContextVariable("deltaTime",I.deltaTime);for(const L of this._pendingBlocks){var x;null===(x=L._executeOnTick)||void 0===x||x.call(L,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.c;I.uniqueId=this.uniqueId,I._userVariables={};for(const F in this._userVariables)x(F,this._userVariables[F],I._userVariables);I._connectionValues={};for(const F in this._connectionValues)x(F,this._connectionValues[F],I._connectionValues);var L;this.assetsContext!==this.tI()&&(I._assetsContext={meshes:this.assetsContext.meshes.map((I=>I.id)),materials:this.assetsContext.materials.map((I=>I.id)),textures:this.assetsContext.textures.map((I=>I.name)),animations:this.assetsContext.animations.map((I=>I.name)),lights:this.assetsContext.lights.map((I=>I.id)),cameras:this.assetsContext.cameras.map((I=>I.id)),Vg:null===(L=this.assetsContext.Vg)||void 0===L?void 0:L.map((I=>I.name)),skeletons:this.assetsContext.skeletons.map((I=>I.id)),Gg:this.assetsContext.Gg.map((I=>I.name)),geometries:this.assetsContext.geometries.map((I=>I.id)),multiMaterials:this.assetsContext.multiMaterials.map((I=>I.id)),transformNodes:this.assetsContext.transformNodes.map((I=>I.id))})}getClassName(){return"FlowGraphContext"}}(0,G.d)([(0,Y.K)()],e.prototype,"uniqueId",void 0);var g=L(14512),v=L(13255);class z{constructor(I){this.onEventTriggeredObservable=new X.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=I,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.cp.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const I=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",dL:{timeSinceStart:this._startingTime,deltaTime:I}}),this._startingTime+=I})),this._meshPickedObserver=this._scene.onPointerObservable.add((I=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",dL:I})}),v.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((I=>{const x=I.pointerId,L=I.mesh,F=this._pointerUnderMeshState[x];!F&&L?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",dL:{pointerId:x,mesh:L}}):F&&!L?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",dL:{pointerId:x,mesh:F}}):F&&L&&F!==L&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",dL:{pointerId:x,mesh:F,over:L}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",dL:{pointerId:x,mesh:L,out:F}})),this._pointerUnderMeshState[x]=L}),v.e.POINTERMOVE)}dispose(){var I,x,L,F,X;null===(I=this._sceneDisposeObserver)||void 0===I||I.remove(),null===(x=this._sceneReadyObserver)||void 0===x||x.remove(),null===(L=this._sceneOnBeforeRenderObserver)||void 0===L||L.remove(),null===(F=this._meshPickedObserver)||void 0===F||F.remove(),null===(X=this._meshUnderPointerObserver)||void 0===X||X.remove(),this.onEventTriggeredObservable.clear()}}var H,s=L(14522);!function(I){I[I.Stopped=0]="Stopped",I[I.Started=1]="Started"}(H||(H={}));class U{get state(){return this._state}set state(I){this._state=I,this.onStateChangedObservable.notifyObservers(I)}constructor(I){this.onStateChangedObservable=new X.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=I.qx,this._sceneEventCoordinator=new z(this._scene),this._coordinator=I.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((I=>{for(const x of this._executionContexts){const L=this._getContextualOrder(I.type,x);for(const F of L)if(!F._executeEvent(x,I.dL))break}switch(I.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const x of this._executionContexts)x._notifyOnTick(I.dL);break;case"SceneDispose":this.dispose()}}))}createContext(){const I=new e({qx:this._scene,coordinator:this._coordinator});return this._executionContexts.push(I),I}getContext(I){return this._executionContexts[I]}addEventBlock(I){if("PointerOver"!==I.type&&"PointerOut"!==I.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==I.type&&this._eventBlocks[I.type].push(I),1===this.state)for(const x of this._executionContexts)I._startPendingTasks(x);else this.onStateChangedObservable.addOnce((x=>{if(1===x)for(const L of this._executionContexts)I._startPendingTasks(L)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((I=>{1===I&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const I of this._executionContexts)for(const x in this._eventBlocks){const L=this._getContextualOrder(x,I);for(const x of L)x._startPendingTasks(I)}}_getContextualOrder(I,x){const L=this._eventBlocks[I].sort(((I,x)=>x.initPriority-I.initPriority));if("MeshPick"===I){const I=[];for(const F of L){const X=F.asset.getValue(x);let G=0;for(;G<L.length;G++){const I=L[G].asset.getValue(x);if(X&&I&&(0,s.o)(X,I))break}I.splice(G,0,F)}return I}return L}dispose(){var I;if(0!==this.state){this.state=0;for(const I of this._executionContexts)I._clearPendingBlocks();this._executionContexts.length=0;for(const I in this._eventBlocks)this._eventBlocks[I].length=0;null===(I=this._eventObserver)||void 0===I||I.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(I){const x=[],L=new Set;for(const F in this._eventBlocks)for(const I of this._eventBlocks[F])x.push(I),L.add(I.uniqueId);for(;x.length>0;){const F=x.pop();I(F);for(const I of F.dataInputs)for(const F of I._connectedPoint)L.has(F._ownerBlock.uniqueId)||(x.push(F._ownerBlock),L.add(F._ownerBlock.uniqueId));if(F instanceof g.e)for(const I of F.signalOutputs)for(const F of I._connectedPoint)L.has(F._ownerBlock.uniqueId)||(x.push(F._ownerBlock),L.add(F._ownerBlock.uniqueId))}}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=arguments.length>1?arguments[1]:void 0;I.allBlocks=[],this.visitAllBlocks((x=>{const L={};x.serialize(L),I.allBlocks.push(L)})),I.executionContexts=[];for(const L of this._executionContexts){const F={};L.serialize(F,x),I.executionContexts.push(F)}}}class q{constructor(I){this.config=I,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.qx.cp.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.qx.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const I=this._executeOnNextFrame.slice(0);if(I.length)for(const x of I){this.notifyCustomEvent(x.id,x.data,!1);const I=this._executeOnNextFrame.findIndex((I=>I.uniqueId===x.uniqueId));-1!==I&&this._executeOnNextFrame.splice(I,1)}}));(q.SceneCoordinators.get(this.config.qx)??[]).push(this)}createGraph(){const I=new U({qx:this.config.qx,coordinator:this});return this._flowGraphs.push(I),I}removeGraph(I){const x=this._flowGraphs.indexOf(I);-1!==x&&(I.dispose(),this._flowGraphs.splice(x,1))}start(){for(const I of this._flowGraphs)I.start()}dispose(){var I,x;for(const X of this._flowGraphs)X.dispose();this._flowGraphs.length=0,null===(I=this._disposeObserver)||void 0===I||I.remove(),null===(x=this._onBeforeRenderObserver)||void 0===x||x.remove();const L=q.SceneCoordinators.get(this.config.qx)??[],F=L.indexOf(this);-1!==F&&L.splice(F,1)}serialize(I,x){I._flowGraphs=[];for(const L of this._flowGraphs){const F={};L.serialize(F,x),I._flowGraphs.push(F)}I.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(I){let x=this._customEventsMap.get(I);return x||(x=new X.c,this._customEventsMap.set(I,x)),x}notifyCustomEvent(I,x){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:I,data:x,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(I)){const x=this._eventExecutionCounter.get(I);if(this._eventExecutionCounter.set(I,x+1),x>=q.MaxEventTypeExecutionPerFrame)return void(x===q.MaxEventTypeExecutionPerFrame&&W.c.Warn(`FlowGraphCoordinator: Too many executions of event "${I}".`))}else this._eventExecutionCounter.set(I,1);const L=this._customEventsMap.get(I);L&&L.notifyObservers(x)}}q.MaxEventsPerType=30,q.MaxEventTypeExecutionPerFrame=30,q.SceneCoordinators=new Map},14530:(I,x,L)=>{"use strict";L.d(x,{e:()=>X});var F=L(14537);class X extends F.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(I){I._notifyExecuteNode(this),this.done._activateSignal(I)}}},14512:(I,x,L)=>{"use strict";L.d(x,{e:()=>p});var F=L(14514),X=L(14517),G=L(12938);class Y extends X.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(I){super.connectTo(I),this._connectedPoint.sort(((I,x)=>x.priority-I.priority))}_activateSignal(I){var x;if(null===(x=I.logger)||void 0===x||x.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,dL:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)I._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(I,this),I._increaseExecutionId();else for(const L of this._connectedPoint)L._activateSignal(I)}}(0,G.d)("FlowGraphSignalConnection",Y);class p extends F.e{constructor(I){super(I),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(I){const x=new Y(I,0,this);return this.signalInputs.push(x),x}_registerSignalOutput(I){const x=new Y(I,1,this);return this.signalOutputs.push(x),x}_unregisterSignalInput(I){const x=this.signalInputs.findIndex((x=>x.name===I));-1!==x&&(this.signalInputs[x].dispose(),this.signalInputs.splice(x,1))}_unregisterSignalOutput(I){const x=this.signalOutputs.findIndex((x=>x.name===I));-1!==x&&(this.signalOutputs[x].dispose(),this.signalOutputs.splice(x,1))}_reportError(I,x){this.error.dL="string"===typeof x?new Error(x):x,this.error._activateSignal(I)}getSignalInput(I){return this.signalInputs.find((x=>x.name===I))}getSignalOutput(I){return this.signalOutputs.find((x=>x.name===I))}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(I),I.signalInputs=[],I.signalOutputs=[];for(const x of this.signalInputs){const L={};x.serialize(L),I.signalInputs.push(L)}for(const x of this.signalOutputs){const L={};x.serialize(L),I.signalOutputs.push(L)}}deserialize(I){for(let x=0;x<I.signalInputs.length;x++){const L=this.getSignalInput(I.signalInputs[x].name);if(!L)throw new Error("Could not find signal input with name "+I.signalInputs[x].name+" in block "+I.className);L.deserialize(I.signalInputs[x])}for(let x=0;x<I.signalOutputs.length;x++){const L=this.getSignalOutput(I.signalOutputs[x].name);if(!L)throw new Error("Could not find signal output with name "+I.signalOutputs[x].name+" in block "+I.className);L.deserialize(I.signalOutputs[x])}}getClassName(){return"FlowGraphExecutionBlock"}}},14540:(I,x,L)=>{"use strict";L.d(x,{e:()=>X});var F=L(14512);class X extends F.e{constructor(I){super(I),this.out=this._registerSignalOutput("out")}}},14498:(I,x,L)=>{"use strict";L.d(x,{B:()=>T,F:()=>W,H:()=>g,K:()=>v,N:()=>z,Q:()=>R,R:()=>n,S:()=>f,U:()=>t,e:()=>l,i:()=>e,l:()=>Z,p:()=>H,s:()=>s,u:()=>U,x:()=>Q});var F,X=L(12983),G=L(13020),Y=L(14493),p=L(14501);!function(I){I.Any="any",I.String="string",I.Number="number",I.Boolean="boolean",I.Object="object",I.Integer="FlowGraphInteger",I.Vector2="Vector2",I.sx="sx",I.Vector4="Vector4",I.Quaternion="Quaternion",I.Matrix="Matrix",I.Matrix2D="Matrix2D",I.Matrix3D="Matrix3D",I.Tx="Tx",I.lB="lB"}(F||(F={}));class B{constructor(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=I,this.defaultValue=x,this.animationType=L}serialize(I){I.typeName=this.typeName,I.defaultValue=this.defaultValue}}const l=new B("any",void 0),W=new B("string",""),Q=new B("number",0,0),e=new B("boolean",!1),g=new B("Vector2",X.Vector2.Zero(),5),v=new B("sx",X.sx.Zero(),1),z=new B("Vector4",X.Vector4.Zero()),H=new B("Matrix",X.Matrix.Identity(),3),s=new B("Matrix2D",new p.c),U=new B("Matrix3D",new p.f),q=new B("Tx",G.Tx.Black(),4),y=new B("lB",new G.lB(0,0,0,0),7),T=new B("Quaternion",X.Quaternion.Identity(),2);T.typeTransformer=I=>{if(I.getClassName){if("Vector4"===I.getClassName())return X.Quaternion.tx(I.Cp());if("sx"===I.getClassName())return X.Quaternion.FromEulerVector(I);if("Matrix"===I.getClassName())return X.Quaternion.FromRotationMatrix(I)}return I};const Z=new B("FlowGraphInteger",new Y.b(0),0);function t(I){const x=I;switch(typeof I){case"string":return W;case"number":return Q;case"boolean":return e;case"object":if(x.getClassName)switch(x.getClassName()){case"Vector2":return g;case"sx":return v;case"Vector4":return z;case"Matrix":return H;case"Tx":return q;case"lB":return y;case"Quaternion":return T;case"FlowGraphInteger":return Z;case"Matrix2D":return s;case"Matrix3D":return U}return l;default:return l}}function f(I){switch(I){case"string":return W;case"number":return Q;case"boolean":return e;case"Vector2":return g;case"sx":return v;case"Vector4":return z;case"Matrix":return H;case"Tx":return q;case"lB":return y;case"Quaternion":return T;case"FlowGraphInteger":return Z;case"Matrix2D":return s;case"Matrix3D":return U;default:return l}}function R(I){switch(I){case"number":default:return 0;case"Vector2":return 5;case"sx":return 1;case"Matrix":return 3;case"Tx":return 4;case"lB":return 7;case"Quaternion":return 2}}function n(I){switch(I){case 0:return Q;case 5:return g;case 1:return v;case 3:return H;case 4:return q;case 7:return y;case 2:return T;default:return l}}},14491:(I,x,L)=>{"use strict";L.d(x,{b:()=>W,c:()=>l,d:()=>Q});var F=L(13020),X=L(12983),G=L(14493),Y=L(14498),p=L(14501);function B(I){return"Vector2"===I||"sx"===I||"Vector4"===I||"Quaternion"===I||"Tx"===I||"lB"===I}function l(I,x,L){var F;const X=(null===x||void 0===x||null===(F=x.getClassName)||void 0===F?void 0:F.call(x))??"";if(B(X)||function(I){return"Matrix"===I||"Matrix2D"===I||"Matrix3D"===I}(X))L[I]={value:x.Cp(),className:X};else if("FlowGraphInteger"===X)L[I]={value:x.value,className:X};else if(X&&(x.id||x.name))L[I]={id:x.id,name:x.name,className:X};else{if("object"===typeof x)throw new Error(`Could not serialize value ${x}`);L[I]=x}}function W(I,x,L,l){const Q=x[I];let e;const g=(null===Q||void 0===Q?void 0:Q.type)??(null===Q||void 0===Q?void 0:Q.className);if(function(I){return"Mesh"===I||"AbstractMesh"===I||"GroundMesh"===I||"InstanceMesh"===I||"LinesMesh"===I||"GoldbergMesh"===I||"GreasedLineMesh"===I||"TrailMesh"===I}(g)){let I=l.meshes.filter((I=>Q.id?I.id===Q.id:I.name===Q.name));0===I.length&&(I=l.transformNodes.filter((I=>Q.id?I.id===Q.id:I.name===Q.name))),e=Q.uniqueId?I.find((I=>I.uniqueId===Q.uniqueId)):I[0]}else if(B(g))e=function(I,x){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===I)return X.Vector2.tx(x);if("sx"===I)return L&&(x[2]*=-1),X.sx.tx(x);if("Vector4"===I)return X.Vector4.tx(x);if("Quaternion"===I)return L&&(x[2]*=-1,x[3]*=-1),X.Quaternion.tx(x);if("Tx"===I)return new F.Tx(x[0],x[1],x[2]);if("lB"===I)return new F.lB(x[0],x[1],x[2],x[3]);throw new Error(`Unknown vector class name ${I}`)}(g,Q.value);else if(function(I){return"AnimationGroup"===I}(g)){const I=l.animationGroups.filter((I=>I.name===Q.name));e=1===I.length?I[0]:I.find((I=>I.uniqueId===Q.uniqueId))}else e="Matrix"===g?X.Matrix.tx(Q.value):"Matrix2D"===g?new p.c(Q.value):"Matrix3D"===g?new p.f(Q.value):"FlowGraphInteger"===g?G.b.FromValue(Q.value):"number"===g||"string"===g||"boolean"===g?Q.value[0]:Q&&void 0!==Q.value?Q.value:Array.isArray(Q)?Q.reduce(((I,x)=>x.eventData?(I[x.id]={type:(0,Y.S)(x.type)},"undefined"!==typeof x.value&&(I[x.id].value=W("value",x,L,l)),I):I),{}):Q;return e}function Q(I){return"FlowGraphJsonPointerParserBlock"===I}},14522:(I,x,L)=>{"use strict";function F(I,x){return!(!I.parent||I.parent!==x&&!F(I.parent,x))}function X(I){if(I.getClassName)return I.getClassName()}function G(I,x){return I===x&&("Vector2"===I||"sx"===I||"Vector4"===I||"Quaternion"===I)}function Y(I,x){return I===x&&("Matrix"===I||"Matrix2D"===I||"Matrix3D"===I)}function p(I,x){return"FlowGraphInteger"===I&&"FlowGraphInteger"===x}function B(I,x){const L="number"===typeof I||"number"===typeof(null===I||void 0===I?void 0:I.value);return L&&!x?!isNaN(l(I)):L}function l(I){return"number"===typeof I?I:I.value}L.d(x,{c:()=>p,f:()=>Y,j:()=>G,m:()=>X,o:()=>F,r:()=>l,u:()=>B})},14880:(I,x,L)=>{"use strict";L.r(x),L.d(x,{SceneInstrumentation:()=>G});var F=L(12791),X=L(13197);class G{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(I){I!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=I,I?(this._onBeforeActiveMeshesEvaluationObserver=this.qx.onBeforeActiveMeshesEvaluationObservable.add((()=>{F.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.qx.onAfterActiveMeshesEvaluationObservable.add((()=>{F.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.qx.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.qx.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(I){I!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=I,I?(this._onBeforeRenderTargetsRenderObserver=this.qx.onBeforeRenderTargetsRenderObservable.add((()=>{F.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.qx.onAfterRenderTargetsRenderObservable.add((()=>{F.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.qx.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.qx.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(I){I!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=I,I?(this._onBeforeParticlesRenderingObserver=this.qx.onBeforeParticlesRenderingObservable.add((()=>{F.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.qx.onAfterParticlesRenderingObservable.add((()=>{F.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.qx.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.qx.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(I){I!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=I,this.qx.spriteManagers&&(I?(this._onBeforeSpritesRenderingObserver=this.qx.onBeforeSpritesRenderingObservable.add((()=>{F.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.qx.onAfterSpritesRenderingObservable.add((()=>{F.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.qx.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.qx.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(I){I!==this._capturePhysicsTime&&this.qx.onBeforePhysicsObservable&&(this._capturePhysicsTime=I,I?(this._onBeforePhysicsObserver=this.qx.onBeforePhysicsObservable.add((()=>{F.Tools.StartPerformanceCounter("ze"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.qx.onAfterPhysicsObservable.add((()=>{F.Tools.EndPerformanceCounter("ze"),this._physicsTime.endMonitoring()}))):(this.qx.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.qx.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(I){I!==this._captureAnimationsTime&&(this._captureAnimationsTime=I,I?this._onAfterAnimationsObserver=this.qx.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.qx.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(I){this._captureFrameTime=I}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(I){this._captureInterFrameTime=I}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(I){I!==this._captureRenderTime&&(this._captureRenderTime=I,I?(this._onBeforeDrawPhaseObserver=this.qx.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),F.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.qx.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),F.Tools.EndPerformanceCounter("Main render")}))):(this.qx.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.qx.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(I){I!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=I,I?(this._onBeforeCameraRenderObserver=this.qx.onBeforeCameraRenderObservable.add((I=>{this._cameraRenderTime.beginMonitoring(),F.Tools.StartPerformanceCounter(`Rendering camera ${I.name}`)})),this._onAfterCameraRenderObserver=this.qx.onAfterCameraRenderObservable.add((I=>{this._cameraRenderTime.endMonitoring(!1),F.Tools.EndPerformanceCounter(`Rendering camera ${I.name}`)}))):(this.qx.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.qx.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.qx.getEngine()._drawCalls}constructor(I){this.qx=I,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new X.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new X.c,this._captureFrameTime=!1,this._frameTime=new X.c,this._captureRenderTime=!1,this._renderTime=new X.c,this._captureInterFrameTime=!1,this._interFrameTime=new X.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new X.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new X.c,this._capturePhysicsTime=!1,this._physicsTime=new X.c,this._captureAnimationsTime=!1,this._animationsTime=new X.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new X.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=I.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(F.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.qx.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=I.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(F.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Sp(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Sp(),this._captureParticlesRenderTime&&this._particlesRenderTime.Sp(),this._captureSpritesRenderTime&&this._spritesRenderTime.Sp(),this._captureRenderTime&&this._renderTime.Sp(),this._captureCameraRenderTime&&this._cameraRenderTime.Sp()}))}dispose(){this._disposed||(this.qx.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.qx.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.qx.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.qx.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.qx.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.qx.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.qx.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.qx.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.qx.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.qx.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.qx.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.qx.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.qx.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.qx.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.qx.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.qx.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.qx.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.qx=null,this._disposed=!0)}}},14478:(I,x,L)=>{"use strict";L.d(x,{d:()=>W});var F=L(12969),X=L(12971),G=L(12983),Y=L(13406),p=L(13507),B=L(13553),l=L(12938);Y.c.AddNodeConstructor("Light_Type_1",((I,x)=>()=>new W(I,G.sx.Zero(),x)));class W extends B.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(I){this._shadowFrustumSize=I,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(I){this._shadowOrthoScale=I,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(I){this._orthoLeft=I}get orthoRight(){return this._orthoRight}set orthoRight(I){this._orthoRight=I}get orthoTop(){return this._orthoTop}set orthoTop(I){this._orthoTop=I}get orthoBottom(){return this._orthoBottom}set orthoBottom(I){this._orthoBottom=I}constructor(I,x,L){super(I,L),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=x.scale(-1),this.direction=x}getClassName(){return"se"}getTypeID(){return p.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(I,x,L){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(I):this._setDefaultAutoExtendShadowProjectionMatrix(I,x,L)}_setDefaultFixedFrustumShadowProjectionMatrix(I){const x=this.tI().activeCamera;x&&G.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:x.IB,void 0!==this.shadowMaxZ?this.shadowMaxZ:x.maxZ,I,this.tI().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(I,x,L){const F=this.tI().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const I=G.sx.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let F=Number.MAX_VALUE,X=-Number.MAX_VALUE;for(let Y=0;Y<L.length;Y++){const p=L[Y];if(!p)continue;const B=p.getBoundingInfo().boundingBox;for(let L=0;L<B.vectorsWorld.length;L++)G.sx.TransformCoordinatesToRef(B.vectorsWorld[L],x,I),I.x<this._orthoLeft&&(this._orthoLeft=I.x),I.y<this._orthoBottom&&(this._orthoBottom=I.y),I.x>this._orthoRight&&(this._orthoRight=I.x),I.y>this._orthoTop&&(this._orthoTop=I.y),this.autoCalcShadowZBounds&&(I.z<F&&(F=I.z),I.z>X&&(X=I.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=F,this._shadowMaxZ=X)}const X=this._orthoRight-this._orthoLeft,Y=this._orthoTop-this._orthoBottom,p=void 0!==this.shadowMinZ?this.shadowMinZ:(null===F||void 0===F?void 0:F.IB)||0,B=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===F||void 0===F?void 0:F.maxZ)||1e4,l=this.tI().getEngine().dp;G.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-X*this.shadowOrthoScale,this._orthoRight+X*this.shadowOrthoScale,this._orthoBottom-Y*this.shadowOrthoScale,this._orthoTop+Y*this.shadowOrthoScale,l?B:p,l?p:B,I,this.tI().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(I,x){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,x),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,x),this)}transferToNodeMaterialEffect(I,x){return this.computeTransformedInformation()?(I.setFloat3(x,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(I.setFloat3(x,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(I){const x=this._scene.getEngine();return!x.dp&&x.isNDCHalfZRange?0:1}getDepthMaxZ(I){const x=this._scene.getEngine();return x.dp&&x.isNDCHalfZRange?0:1}prepareLightSpecificDefines(I,x){I["DIRLIGHT"+x]=!0}}(0,F.d)([(0,X.K)()],W.prototype,"shadowFrustumSize",null),(0,F.d)([(0,X.K)()],W.prototype,"shadowOrthoScale",null),(0,F.d)([(0,X.K)()],W.prototype,"autoUpdateExtends",void 0),(0,F.d)([(0,X.K)()],W.prototype,"autoCalcShadowZBounds",void 0),(0,F.d)([(0,X.K)("orthoLeft")],W.prototype,"_orthoLeft",void 0),(0,F.d)([(0,X.K)("orthoRight")],W.prototype,"_orthoRight",void 0),(0,F.d)([(0,X.K)("orthoTop")],W.prototype,"_orthoTop",void 0),(0,F.d)([(0,X.K)("orthoBottom")],W.prototype,"_orthoBottom",void 0),(0,l.d)("BABYLON.DirectionalLight",W)},15059:(I,x,L)=>{"use strict";L.d(x,{c:()=>W});var F=L(12969),X=L(12971),G=L(12983),Y=L(13020),p=L(13406),B=L(13507),l=L(12938);p.c.AddNodeConstructor("Light_Type_3",((I,x)=>()=>new W(I,G.sx.Zero(),x)));class W extends B.c{constructor(I,x,L){super(I,L),this.groundColor=new Y.Tx(0,0,0),this.direction=x||G.sx.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"qe"}setDirectionToTarget(I){return this.direction=G.sx.Normalize(I.Ux(G.sx.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(I,x){const L=G.sx.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",L.x,L.y,L.z,0,x),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.eB),x),this}transferToNodeMaterialEffect(I,x){const L=G.sx.Normalize(this.direction);return I.setFloat3(x,L.x,L.y,L.z),this}LB(){return this._worldMatrix||(this._worldMatrix=G.Matrix.Identity()),this._worldMatrix}getTypeID(){return B.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(I,x){I["HEMILIGHT"+x]=!0}}(0,F.d)([(0,X.j)()],W.prototype,"groundColor",void 0),(0,F.d)([(0,X.I)()],W.prototype,"direction",void 0),(0,l.d)("BABYLON.HemisphericLight",W)},14440:(I,x,L)=>{"use strict";L.d(x,{c:()=>Q});var F=L(12969),X=L(12971),G=L(12983),Y=L(13406),p=L(13507),B=L(13553),l=L(12965),W=L(12938);Y.c.AddNodeConstructor("Light_Type_2",((I,x)=>()=>new Q(I,G.sx.Zero(),G.sx.Zero(),0,0,x)));class Q extends B.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(I){this._iesProfileTexture!==I&&(this._iesProfileTexture=I,this._iesProfileTexture&&Q._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(I){this._angle=I,this._cosHalfAngle=Math.cos(.5*I),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(I){this._innerAngle=I,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(I){this._shadowAngleScale=I,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(I){this._projectionTextureLightNear=I,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(I){this._projectionTextureLightFar=I,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(I){this._projectionTextureUpDirection=I,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(I){this._projectionTexture!==I&&(this._projectionTexture=I,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Q._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Q._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(I){return void 0!==I.onGeneratedObservable}static _IsTexture(I){return void 0!==I.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(I){this._projectionTextureProjectionLightMatrix=I,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(I,x,L,F,X,Y){super(I,Y),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=G.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=G.sx.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=G.sx.Zero(),this._projectionTextureViewLightMatrix=G.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=G.Matrix.Zero(),this._projectionTextureScalingMatrix=G.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=x,this.direction=L,this.angle=F,this.exponent=X}getClassName(){return"SpotLight"}getTypeID(){return p.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(I){super._setDirection(I),this._projectionTextureViewLightDirty=!0}_setPosition(I){super._setPosition(I),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(I,x,L){const F=this.tI().activeCamera;if(!F)return;this._shadowAngleScale=this._shadowAngleScale||1;const X=this._shadowAngleScale*this._angle,Y=void 0!==this.shadowMinZ?this.shadowMinZ:F.IB,p=void 0!==this.shadowMaxZ?this.shadowMaxZ:F.maxZ,B=this.tI().getEngine().dp;G.Matrix.PerspectiveFovLHToRef(X,1,B?p:Y,B?Y:p,I,!0,this._scene.getEngine().isNDCHalfZRange,void 0,B)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),G.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const I=this.projectionTextureLightFar,x=this.projectionTextureLightNear,L=I/(I-x),F=-L*x,X=1/Math.tan(this._angle/2);G.Matrix.FromValuesToRef(X/1,0,0,0,0,X,0,0,0,0,L,1,0,0,F,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof l.d){const I=this._projectionTexture.uScale/2,x=this._projectionTexture.vScale/2;G.Matrix.FromValuesToRef(I,0,0,0,0,x,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(I,x){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),I.setMatrix("textureProjectionMatrix"+x,this._projectionTextureMatrix),I.setTexture("projectionLightTexture"+x,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&I.setTexture("iesLightTexture"+x,this._iesProfileTexture),this}transferToEffect(I,x){let L;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,x),L=G.sx.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,x),L=G.sx.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",L.x,L.y,L.z,this._cosHalfAngle,x),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,x),this}transferToNodeMaterialEffect(I,x){let L;return L=this.computeTransformedInformation()?G.sx.Normalize(this.transformedDirection):G.sx.Normalize(this.direction),this.tI().useRightHandedSystem?I.setFloat3(x,-L.x,-L.y,-L.z):I.setFloat3(x,L.x,L.y,L.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(I){const x=this._scene.getEngine(),L=void 0!==this.shadowMinZ?this.shadowMinZ:(null===I||void 0===I?void 0:I.IB)??0;return x.dp&&x.isNDCHalfZRange?L:this._scene.getEngine().isNDCHalfZRange?0:L}getDepthMaxZ(I){const x=this._scene.getEngine(),L=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===I||void 0===I?void 0:I.maxZ)??1e4;return x.dp&&x.isNDCHalfZRange?0:L}prepareLightSpecificDefines(I,x){I["SPOTLIGHT"+x]=!0,I["PROJECTEDLIGHTTEXTURE"+x]=!(!this.projectionTexture||!this.projectionTexture.isReady()),I["IESLIGHTTEXTURE"+x]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,F.d)([(0,X.K)()],Q.prototype,"angle",null),(0,F.d)([(0,X.K)()],Q.prototype,"innerAngle",null),(0,F.d)([(0,X.K)()],Q.prototype,"shadowAngleScale",null),(0,F.d)([(0,X.K)()],Q.prototype,"exponent",void 0),(0,F.d)([(0,X.K)()],Q.prototype,"projectionTextureLightNear",null),(0,F.d)([(0,X.K)()],Q.prototype,"projectionTextureLightFar",null),(0,F.d)([(0,X.K)()],Q.prototype,"projectionTextureUpDirection",null),(0,F.d)([(0,X.C)("projectedLightTexture")],Q.prototype,"_projectionTexture",void 0),(0,W.d)("BABYLON.SpotLight",Q)},14174:(I,x,L)=>{"use strict";L.d(x,{b:()=>Y,d:()=>G,h:()=>p});const F={},X={};function G(I,x){F[I]=x}function Y(I,x){X[I]=x}function p(I){return X[I]?X[I]:null}},14078:(I,x,L)=>{"use strict";L.d(x,{d:()=>t,g:()=>O});var F,X=L(12791),G=L(12797),Y=L(13218),p=L(12840),B=L(12809),l=L(13443),W=L(12842),Q=L(12847),e=L(12945),g=L(12872),v=L(12832);!function(I){I[I.Clean=0]="Clean",I[I.Stop=1]="Stop",I[I.Sync=2]="Sync",I[I.NoSync=3]="NoSync"}(F||(F={}));const z=new G.c,H={};let s=!1;function U(){return H[".babylon"]}function q(I,x){const L=H[I];return L||(B.c.Warn("Unable to find a plugin to load "+I+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),x?U():void 0)}function y(I,x,L){let F="Unable to load from "+(I.rawData?"binary data":I.url);return x?F+=`: ${x}`:L&&(F+=`: ${L}`),F}async function T(I,x,L,F,X,G,Y,p,B){var l;const Q="data:"===(e=I.url).substring(0,5)?e.substring(5):null;var e;if(I.rawData&&!Y)throw"When using ArrayBufferView to load data the file extension must be provided.";const s=Q||Y?"":function(I){const x=I.indexOf("?");-1!==x&&(I=I.substring(0,x));const L=I.lastIndexOf(".");return I.substring(L,I.length).toLowerCase()}(I.url);let y=Y?q(Y,!0):Q?function(I){for(const x in H){const L=H[x].plugin;if(L.canDirectLoad&&L.canDirectLoad(I))return H[x]}return U()}(I.url):q(s,!1);if(!y&&s){if(I.url&&!I.url.startsWith("blob:")){const x=await async function(I,x){const L=x.method||"GET";return await new Promise(((F,X)=>{const G=new v.d;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const I={};if(x.responseHeaders)for(const L of x.responseHeaders)I[L]=G.getResponseHeader(L)||"";F({response:G.response,headerValues:I})}else X(`Unable to fetch data from ${I}. Error code: ${G.status}`)})),G.open(L,I),G.send()}))}(I.url,{method:"HEAD",responseHeaders:["Content-Type"]}),L=x.headerValues?x.headerValues["Content-Type"]:"";L&&(y=function(I){for(const x in H){const L=H[x];if(L.mimeType===I)return L}}(L))}y||(y=U())}if(!y)throw new Error(`No plugin or fallback for ${Y??I.url}`);if(!1===(null===B||void 0===B||null===(l=B[y.plugin.name])||void 0===l?void 0:l.enabled))throw new Error(`The '${y.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(I.rawData&&!y.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(I=>{if(y.plugin.createPlugin){const x=y.plugin.createPlugin(B??{});return x instanceof Promise?(x.then(I).catch((I=>{X("Error instantiating plugin.",I)})),null):(I(x),x)}return I(y.plugin),y.plugin})((B=>{var l;if(!B)throw`The loader plugin corresponding to the '${Y}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(z.notifyObservers(B),Q&&(B.canDirectLoad&&B.canDirectLoad(I.url)||!(0,W.j)(I.url))){if(B.directLoad){const I=B.directLoad(x,Q);I instanceof Promise?I.then((I=>{L(B,I)})).catch((I=>{X("Error in directLoad of _loadData: "+I,I)})):L(B,I)}else L(B,Q);return}const e=y.isBinary,v=(I,F)=>{x.p?X("Scene has been disposed"):L(B,I,F)};let H=null,s=!1;null===(l=B.cp)||void 0===l||l.add((()=>{s=!0,H&&(H.abort(),H=null),G()}));const U=()=>{if(s)return;const L=(I,x)=>{X(null===I||void 0===I?void 0:I.statusText,x)};if(!B.loadFile&&I.rawData)throw"Plugin does not support loading ArrayBufferView.";H=B.loadFile?B.loadFile(x,I.rawData||I.file||I.url,I.rootUrl,v,F,e,L,p):x._loadFile(I.file||I.url,v,F,!0,e,L)},q=x.getEngine();let T=q.enableOfflineSupport;if(T){let L=!1;for(const F of x.disableOfflineSupportExceptionRules)if(F.test(I.url)){L=!0;break}T=!L}T&&g.d.OfflineProviderFactory?x.offlineProvider=g.d.OfflineProviderFactory(I.url,U,q.disableManifestCheck):U()}))}function Z(I,x){let L,F,G=null,Y=null;if(x)if(x.name)L=`file:${x.name}`,F=x.name,G=x;else if(ArrayBuffer.isView(x))L="",F=(0,e.e)(),Y=x;else if(x.startsWith("data:"))L=x,F="";else if(I){const G=x;if("/"===G.substring(0,1))return X.Tools.Error("Wrong sceneFilename parameter"),null;L=I+G,F=G}else L=x,F=X.Tools.GetFilename(x),I=X.Tools.GetFolderPath(x);else L=I,F=X.Tools.GetFilename(I),I=X.Tools.GetFolderPath(I);return{url:L,rootUrl:I,name:F,file:G,rawData:Y}}function t(I){if("string"===typeof I.extensions){const x=I.extensions;H[x.toLowerCase()]={plugin:I,isBinary:!1}}else{const x=I.extensions,L=Object.keys(x);for(const F of L)H[F.toLowerCase()]={plugin:I,isBinary:x[F].isBinary,mimeType:x[F].mimeType}}}async function f(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.e.LastCreatedScene,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!F)return B.c.Error("No scene available to import mesh to"),null;const g=Z(x,L);if(!g)return null;const v={};F.addPendingData(v);const z=()=>{F.removePendingData(v)},H=(I,x)=>{const L=y(g,I,x);Y?Y(F,L,new Q.j(L,Q.f.SceneLoaderError,x)):B.c.Error(L),z()},s=G?I=>{try{G(I)}catch(x){H("Error in onProgress callback: "+x,x)}}:void 0,U=(I,x,L,G,Y,p,B,l)=>{if(F.importedMeshesFiles.push(g.url),X)try{X(I,x,L,G,Y,p,B,l)}catch(W){H("Error in onSuccess callback: "+W,W)}F.removePendingData(v)};return await T(g,F,((x,L,X)=>{if(x.rewriteRootURL&&(g.rootUrl=x.rewriteRootURL(g.rootUrl,X)),x.importMesh){const X=[],G=[],Y=[];if(!x.importMesh(I,F,L,g.rootUrl,X,G,Y,H))return;F.loadingPluginName=x.name,U(X,G,Y,[],[],[],[],[])}else{x.importMeshAsync(I,F,L,g.rootUrl,s,g.name).then((I=>{F.loadingPluginName=x.name,U(I.meshes,I.Gg,I.skeletons,I.animationGroups,I.transformNodes,I.geometries,I.lights,I.spriteManagers)})).catch((I=>{H(I.message,I)}))}}),s,H,z,l,W,e)}async function R(I,x,L,F,X,G,Y,p){return await new Promise(((B,l)=>{try{f(I,x,L,F,((I,x,L,F,X,G,Y,p)=>{B({meshes:I,Gg:x,skeletons:L,animationGroups:F,transformNodes:X,geometries:G,lights:Y,spriteManagers:p})}),X,((I,x,L)=>{l(L||new Error(x))}),G,Y,p).catch(l)}catch(Q){l(Q)}}))}async function n(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.e.LastCreatedEngine,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};L?await d(I,x,new Y.b(L),F,G,B,l,W,Q):X.Tools.Error("No engine available")}async function P(I,x,L,F,X,G,Y){return await new Promise(((p,B)=>{n(I,x,L,(I=>{p(I)}),F,((I,x,L)=>{B(L||new Error(x))}),X,G,Y)}))}async function d(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.e.LastCreatedScene,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!L)return B.c.Error("No scene available to append to"),null;const g=Z(I,x);if(!g)return null;const v={};L.addPendingData(v);const z=()=>{L.removePendingData(v)};l.c.ShowLoadingScreen&&!s&&(s=!0,L.getEngine().displayLoadingUI(),L.executeWhenReady((()=>{L.getEngine().hideLoadingUI(),s=!1})));const H=(I,x)=>{const F=y(g,I,x);G?G(L,F,new Q.j(F,Q.f.SceneLoaderError,x)):B.c.Error(F),z()},U=X?I=>{try{X(I)}catch(x){H("Error in onProgress callback",x)}}:void 0,q=()=>{if(F)try{F(L)}catch(I){H("Error in onSuccess callback",I)}L.removePendingData(v)};return await T(g,L,((I,x)=>{if(I.load){if(!I.load(L,x,g.rootUrl,H))return;L.loadingPluginName=I.name,q()}else{I.loadAsync(L,x,g.rootUrl,U,g.name).then((()=>{L.loadingPluginName=I.name,q()})).catch((I=>{H(I.message,I)}))}}),U,H,z,Y,W,e)}async function M(I,x,L,F,X,G,Y){return await new Promise(((p,B)=>{try{d(I,x,L,(I=>{p(I)}),F,((I,x,L)=>{B(L||new Error(x))}),X,G,Y).catch(B)}catch(Q){B(Q)}}))}async function K(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.e.LastCreatedScene,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!L)return B.c.Error("No scene available to load asset container to"),null;const e=Z(I,x);if(!e)return null;const g={};L.addPendingData(g);const v=()=>{L.removePendingData(g)},z=(I,x)=>{const F=y(e,I,x);G?G(L,F,new Q.j(F,Q.f.SceneLoaderError,x)):B.c.Error(F),v()},H=X?I=>{try{X(I)}catch(x){z("Error in onProgress callback",x)}}:void 0,s=I=>{if(F)try{F(I)}catch(x){z("Error in onSuccess callback",x)}L.removePendingData(g)};return await T(e,L,((I,x)=>{if(I.loadAssetContainer){const F=I.loadAssetContainer(L,x,e.rootUrl,z);if(!F)return;F.populateRootNodes(),L.loadingPluginName=I.name,s(F)}else if(I.loadAssetContainerAsync){I.loadAssetContainerAsync(L,x,e.rootUrl,H,e.name).then((x=>{x.populateRootNodes(),L.loadingPluginName=I.name,s(x)})).catch((I=>{z(I.message,I)}))}else z("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),H,z,v,Y,l,W)}async function u(I,x,L,F,X,G,Y){return await new Promise(((p,B)=>{try{K(I,x,L,(I=>{p(I)}),F,((I,x,L)=>{B(L||new Error(x))}),X,G,Y).catch(B)}catch(Q){B(Q)}}))}async function A(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.e.LastCreatedScene,F=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",g=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!L)return void B.c.Error("No scene available to load animations to");if(F){for(const F of L.animatables)F.reset();L.stopAllAnimations();const I=L.animationGroups.slice();for(const L of I)L.dispose();const x=L.getNodes();for(const L of x)L.animations&&(L.animations=[])}else switch(X){case 0:const I=L.animationGroups.slice();for(const x of I)x.dispose();break;case 1:for(const x of L.animationGroups)x.stop();break;case 2:for(const x of L.animationGroups)x.reset(),x.restart();break;case 3:break;default:return void B.c.Error("Unknown animation group loading mode value '"+X+"'")}const v=L.animatables.length;await K(I,x,L,(I=>{I.mergeAnimationsTo(L,L.animatables.slice(v),G),I.dispose(),L.onAnimationFileImportedObservable.notifyObservers(L),Y&&Y(L)}),l,W,Q,e,g)}async function mI(I,x,L,F,X,G,Y,p,B,l){return await new Promise(((W,e)=>{try{A(I,x,L,F,X,G,(I=>{W(I)}),Y,((I,x,L)=>{e(L||new Error(x))}),p,B,l).catch(e)}catch(Q){e(Q)}}))}class O{static get ForceFullSceneLoadingForIncremental(){return l.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(I){l.c.ForceFullSceneLoadingForIncremental=I}static get ShowLoadingScreen(){return l.c.ShowLoadingScreen}static set ShowLoadingScreen(I){l.c.ShowLoadingScreen=I}static get loggingLevel(){return l.c.loggingLevel}static set loggingLevel(I){l.c.loggingLevel=I}static get CleanBoneMatrixWeights(){return l.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(I){l.c.CleanBoneMatrixWeights=I}static GetDefaultPlugin(){return U()}static GetPluginForExtension(I){var x;return null===(x=q(I,!0))||void 0===x?void 0:x.plugin}static IsPluginForExtensionAvailable(I){return function(I){return!!H[I]}(I)}static RegisterPlugin(I){t(I)}static ImportMesh(I,x,L,F,X,G,Y,B,l){f(I,x,L,F,X,G,Y,B,l).catch((I=>null===Y||void 0===Y?void 0:Y(p.e.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async ImportMeshAsync(I,x,L,F,X,G,Y){return await R(I,x,L,F,X,G,Y)}static Load(I,x,L,F,X,G,Y,B){n(I,x,L,F,X,G,Y,B).catch((I=>null===G||void 0===G?void 0:G(p.e.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async LoadAsync(I,x,L,F,X,G){return await P(I,x,L,F,X,G)}static Append(I,x,L,F,X,G,Y,B){d(I,x,L,F,X,G,Y,B).catch((I=>null===G||void 0===G?void 0:G(L??p.e.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async AppendAsync(I,x,L,F,X,G){return await M(I,x,L,F,X,G)}static LoadAssetContainer(I,x,L,F,X,G,Y,B){K(I,x,L,F,X,G,Y,B).catch((I=>null===G||void 0===G?void 0:G(L??p.e.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async LoadAssetContainerAsync(I,x,L,F,X,G){return await u(I,x,L,F,X,G)}static ImportAnimations(I,x,L,F,X,G,Y,B,l,W,Q){A(I,x,L,F,X,G,Y,B,l,W,Q).catch((I=>null===l||void 0===l?void 0:l(L??p.e.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async ImportAnimationsAsync(I,x,L,F,X,G,Y,p,B,l,W){return await mI(I,x,L,F,X,G,p,l,W)}}O.NO_LOGGING=0,O.MINIMAL_LOGGING=1,O.SUMMARY_LOGGING=2,O.DETAILED_LOGGING=3,O.OnPluginActivatedObservable=z},14460:(I,x,L)=>{"use strict";L.d(x,{c:()=>e});var F=L(12969),X=L(12971),G=L(12791),Y=L(12983),p=L(13004),B=L(12965),l=L(12938),W=L(12797),Q=L(13012);L(14466);class e extends p.d{set boundingBoxSize(I){if(this._boundingBoxSize&&this._boundingBoxSize.equals(I))return;this._boundingBoxSize=I;const x=this.tI();x&&x.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(I){this._rotationY=I,this.setReflectionTextureMatrix(Y.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(I,x,L){let F="";for(const X of I)F+=X;return new e(F,x,null,L,I)}static CreateFromPrefilteredData(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const X=x.useDelayedTextureLoading;x.useDelayedTextureLoading=!1;const G=new e(I,x,null,!1,null,null,null,void 0,!0,L,F);return x.useDelayedTextureLoading=X,G}constructor(I,x){var L;let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,e=arguments.length>8&&void 0!==arguments[8]&&arguments[8],g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,v=arguments.length>10&&void 0!==arguments[10]&&arguments[10],z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,H=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,s=arguments.length>13?arguments[13]:void 0,U=arguments.length>14?arguments[14]:void 0;super(x),this.onLoadObservable=new W.c,this.boundingBoxPosition=Y.sx.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Y.Matrix,this._buffer=null,this.name=I,this.url=I,this._noMipmap=X,this.bp=!1,this.isCube=!0,this._textureMatrix=Y.Matrix.Identity(),this.coordinatesMode=B.d.CUBIC_MODE;let q=null,y=null;null===F||Array.isArray(F)?(this._noMipmap=X,this._format=Q,this._createPolynomials=v,q=F,this._loaderOptions=s,this._useSRGBBuffer=U,this._lodScale=z,this._lodOffset=H):(q=F.extensions??null,this._noMipmap=F.noMipmap??!1,G=F.files??null,y=F.buffer??null,this._format=F.format??5,e=F.prefiltered??!1,g=F.forcedExtension??null,this._createPolynomials=F.createPolynomials??!1,this._lodScale=F.lodScale??.8,this._lodOffset=F.lodOffset??0,this._loaderOptions=F.loaderOptions,this._useSRGBBuffer=F.useSRGBBuffer,p=F.h??null,l=F.onError??null),(I||G)&&this.updateURL(I,g,p,e,l,q,null===(L=this.tI())||void 0===L?void 0:L.useDelayedTextureLoading,G,y)}getClassName(){return"CubeTexture"}updateURL(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=I),this.url=I,x&&(this._forcedExtension=x);const l=I.lastIndexOf("."),W=x||(l>-1?I.substring(l).toLowerCase():""),Q=0===W.indexOf(".dds"),e=0===W.indexOf(".env"),g=0===W.indexOf(".basis");if(e?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=F,F&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),p)this._files=p;else if(g||e||Q||G||(G=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,G){for(let x=0;x<G.length;x++)this._files.push(I+G[x]);this._extensions=G}this._buffer=B,Y?(this.delayLoadState=4,this._delayedOnLoad=L,this._delayedOnError=X):this._loadTexture(L,X)}delayLoad(I){4===this.delayLoadState&&(I&&(this._forcedExtension=I),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(I){var x,L;if(I.updateFlag===this._textureMatrix.updateFlag)return;I.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(L=this.tI())||void 0===L||L.markAllMaterialsAsDirty(1,(I=>-1!==I.getActiveTextures().indexOf(this))));if(this._textureMatrix=I,null===(x=this.tI())||void 0===x||!x.useRightHandedSystem)return;const F=Y.TmpVectors.sx[0],X=Y.TmpVectors.Quaternion[0],G=Y.TmpVectors.sx[1];this._textureMatrix.decompose(F,X,G),X.z*=-1,X.w*=-1,Y.Matrix.ComposeToRef(F,X,G,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var I;return null!==(I=this.tI())&&void 0!==I&&I.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=this.tI(),F=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const X=()=>{var x;(this.onLoadObservable.notifyObservers(this),F)&&(F.dispose(),null===(x=this.tI())||void 0===x||x.markAllMaterialsAsDirty(1));I&&I()},Y=(I,L)=>{this._loadingError=!0,this._errorObject={message:I,exception:L},x&&x(I,L),B.d.OnTextureLoadErrorObservable.notifyObservers(this)};var p;this._texture?this._texture.isReady?G.Tools.SetImmediate((()=>X())):this._texture.onLoadedObservable.add((()=>X())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,L,this._lodScale,this._lodOffset,I,Y,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,L,this._files,this._noMipmap,I,Y,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(p=this._texture)||void 0===p||p.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(I,x,L){const F=Q.c.Parse((()=>{let F=!1;return I.prefiltered&&(F=I.prefiltered),new e(L+(I.url??I.name),x,I.extensions,!1,I.files||null,null,null,void 0,F,I.forcedExtension)}),I,x);if(I.boundingBoxPosition&&(F.boundingBoxPosition=Y.sx.tx(I.boundingBoxPosition)),I.boundingBoxSize&&(F.boundingBoxSize=Y.sx.tx(I.boundingBoxSize)),I.animations)for(let X=0;X<I.animations.length;X++){const x=I.animations[X],L=(0,l.b)("BABYLON.Animation");L&&F.animations.push(L.Parse(x))}return F}clone(){let I=0;const x=Q.c.Clone((()=>{const x=new e(this.url,this.tI()||this._getEngine(),this._extensions,this._noMipmap,this._files);return I=x.uniqueId,x}),this);return x.uniqueId=I,x}}(0,F.d)([(0,X.K)()],e.prototype,"url",void 0),(0,F.d)([(0,X.I)()],e.prototype,"boundingBoxPosition",void 0),(0,F.d)([(0,X.I)()],e.prototype,"boundingBoxSize",null),(0,F.d)([(0,X.K)("rotationY")],e.prototype,"rotationY",null),(0,F.d)([(0,X.K)("files")],e.prototype,"_files",void 0),(0,F.d)([(0,X.K)("forcedExtension")],e.prototype,"_forcedExtension",void 0),(0,F.d)([(0,X.K)("extensions")],e.prototype,"_extensions",void 0),(0,F.d)([(0,X.v)("textureMatrix")],e.prototype,"_textureMatrix",void 0),(0,F.d)([(0,X.v)("textureMatrixRefraction")],e.prototype,"_textureMatrixRefraction",void 0),B.d._CubeTextureParser=e.Parse,(0,l.d)("BABYLON.CubeTexture",e)},15061:(I,x,L)=>{"use strict";L.d(x,{d:()=>B});var F=L(12809),X=L(12965),G=L(12954),Y=L(13116),p=L(12909);Y.ThinEngine.prototype.createDynamicTexture=function(I,x,L,F){const X=new p.d(this,4);return X.baseWidth=I,X.baseHeight=x,L&&(I=this.needPOTTextures?(0,G.g)(I,this._caps.maxTextureSize):I,x=this.needPOTTextures?(0,G.g)(x,this._caps.maxTextureSize):x),X.width=I,X.height=x,X.isReady=!1,X.generateMipMaps=L,X.samplingMode=F,this.updateTextureSamplingMode(F,X),this._internalTexturesCache.push(X),X},Y.ThinEngine.prototype.updateDynamicTexture=function(I,x,L){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!I)return;const Y=this._gl,p=Y.TEXTURE_2D,B=this._bindTextureDirectly(p,I,!0,G);this._unpackFlipY(void 0===L?I.invertY:L),F&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const l=this._getWebGLTextureType(I.type),W=this._getInternalFormat(X||I.format),Q=this._getRGBABufferInternalSizedFormat(I.type,W);Y.texImage2D(p,0,Q,W,l,x),I.generateMipMaps&&Y.generateMipmap(p),B||this._bindTextureDirectly(p,null),F&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),X&&(I.format=X),I._dynamicTextureSource=x,I._premulAlpha=F,I.invertY=L||!1,I.isReady=!0};class B extends X.d{constructor(I,x,L){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,p=arguments.length>6?arguments[6]:void 0;const B=!L||L._isScene;super(null,B?L:null===L||void 0===L?void 0:L.qx,B?!F:L,p,G,void 0,void 0,void 0,void 0,Y),this.name=I,this.wrapU=X.d.CLAMP_ADDRESSMODE,this.wrapV=X.d.CLAMP_ADDRESSMODE,this._generateMipMaps=F;const l=this._getEngine();if(!l)return;if(x.getContext)this._canvas=x,this._ownCanvas=!1,this._texture=l.createDynamicTexture(this._canvas.width,this._canvas.height,F,G);else{this._canvas=l.createCanvas(1,1),this._ownCanvas=!0;const I=x;I.width||0===I.width?this._texture=l.createDynamicTexture(I.width,I.height,F,G):this._texture=l.createDynamicTexture(x,x,F,G)}const W=this.getSize();this._canvas.width!==W.width&&(this._canvas.width=W.width),this._canvas.height!==W.height&&(this._canvas.height=W.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(I){this._canvas.width=I.width,this._canvas.height=I.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(I.width,I.height,this._generateMipMaps,this.samplingMode)}scale(I){const x=this.getSize();x.width*=I,x.height*=I,this._recreate(x)}scaleTo(I,x){const L=this.getSize();L.width=I,L.height=x,this._recreate(L)}getContext(){return this._context}clear(I){const x=this.getSize();I&&(this._context.fillStyle=I),this._context.clearRect(0,0,x.width,x.height)}update(I){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===I||I,x,this._format||void 0,void 0,L)}drawText(I,x,L,F,X,G,Y){let p=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const B=this.getSize();if(G&&(this._context.fillStyle=G,this._context.fillRect(0,0,B.width,B.height)),this._context.font=F,null===x||void 0===x){const L=this._context.measureText(I);x=(B.width-L.width)/2}if(null===L||void 0===L){const I=parseInt(F.replace(/\D/g,""));L=B.height/2+I/3.65}this._context.fillStyle=X||"",this._context.fillText(I,x,L),p&&this.update(Y)}dispose(){var I,x;(super.dispose(),this._ownCanvas)&&(null===(I=this._canvas)||void 0===I||null===(x=I.remove)||void 0===x||x.call(I));this._canvas=null,this._context=null}clone(){const I=this.tI();if(!I)return this;const x=this.getSize(),L=new B(this.name,x,I,this._generateMipMaps);return L.bp=this.bp,L.level=this.level,L.wrapU=this.wrapU,L.wrapV=this.wrapV,L}serialize(){const I=this.tI();I&&!I.isReady()&&F.c.Warn("The scene must be ready before serializing the dynamic texture");const x=super.serialize();return B._IsCanvasElement(this._canvas)&&(x.base64String=this._canvas.toDataURL()),x.invertY=this._invertY,x.samplingMode=this.samplingMode,x}static _IsCanvasElement(I){return void 0!==I.toDataURL}_rebuild(){this.update()}}},14373:(I,x,L)=>{"use strict";L.d(x,{c:()=>X});var F=L(12965);class X extends F.d{get depth(){return this._depth}constructor(I,x,L,X,G,Y){let p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],B=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:F.d.TRILINEAR_SAMPLINGMODE,W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Q=arguments.length>10?arguments[10]:void 0;super(null,Y,!p,B),this.format=G,this._texture=Y.getEngine().createRawTexture2DArray(I,x,L,X,G,p,B,l,null,W,Q),this._depth=X,this.is2DArray=!0}update(I){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,I,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(I,x,L,F,G){return new X(I,x,L,F,5,G,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},14193:(I,x,L)=>{"use strict";L.d(x,{e:()=>p,g:()=>B,h:()=>G,l:()=>Y});var F=L(13001),X=L(12983);function G(I,x){return`{X: ${I.x.toFixed(x)} Y: ${I.y.toFixed(x)}}`}function Y(I,x){return`{X: ${I._x.toFixed(x)} Y: ${I._y.toFixed(x)} Z: ${I._z.toFixed(x)}}`}function p(I,x){return 2*Math.acos((0,F.Clamp)(X.Quaternion.Dot(I,x)))}function B(I,x){const L=new X.Quaternion;return function(I,x,L){const G=X.sx.Cross(I,x),Y=Math.acos((0,F.Clamp)(X.sx.Dot(I,x),-1,1));X.Quaternion.RotationAxisToRef(G,Y,L)}(I,x,L),L}},14035:(I,x,L)=>{"use strict";L.d(x,{b:()=>l});var F=L(12983),X=L(13020),G=L(13426),Y=L(13415),p=L(13033);L(14037);function B(I){let x=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const L=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],G=[];let B=[];const l=I.width||I.size||1,W=I.height||I.size||1,Q=I.depth||I.size||1,e=I.wrap||!1;let g=void 0===I.topBaseAt?1:I.topBaseAt,v=void 0===I.bottomBaseAt?0:I.bottomBaseAt;g=(g+4)%4,v=(v+4)%4;let z=[2,0,3,1][g],H=[2,0,1,3][v],s=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(e){x=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],s=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let I=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],L=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const F=[17,18,19,16],X=[22,23,20,21];for(;z>0;)I.unshift(I.pop()),F.unshift(F.pop()),z--;for(;H>0;)L.unshift(L.pop()),X.unshift(X.pop()),H--;I=I.flat(),L=L.flat(),s=s.concat(I).concat(L),x.push(F[0],F[2],F[3],F[0],F[1],F[2]),x.push(X[0],X[2],X[3],X[0],X[1],X[2])}const U=[l/2,W/2,Q/2];B=s.reduce(((I,x,L)=>I.concat(x*U[L%3])),[]);const q=0===I.sideOrientation?0:I.sideOrientation||Y.d.DEFAULTSIDE,y=I.faceUV||new Array(6),T=I.faceColors,Z=[];for(let Y=0;Y<6;Y++)void 0===y[Y]&&(y[Y]=new F.Vector4(0,0,1,1)),T&&void 0===T[Y]&&(T[Y]=new X.lB(1,1,1,1));for(let F=0;F<6;F++)if(G.push(y[F].z,p.e?1-y[F].w:y[F].w),G.push(y[F].x,p.e?1-y[F].w:y[F].w),G.push(y[F].x,p.e?1-y[F].y:y[F].y),G.push(y[F].z,p.e?1-y[F].y:y[F].y),T)for(let I=0;I<4;I++)Z.push(T[F].r,T[F].g,T[F].b,T[F].a);Y.d._ComputeSides(q,B,x,L,G,I.frontUVs,I.backUVs);const t=new Y.d;if(t.indices=x,t.RI=B,t.nI=L,t.MI=G,T){const I=q===Y.d.DOUBLESIDE?Z.concat(Z):Z;t.dI=I}return t}function l(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new G.e(I,L);x.sideOrientation=G.e._GetDefaultSideOrientation(x.sideOrientation),F._originalBuilderSideOrientation=x.sideOrientation;return B(x).uI(F,x.updatable),F}Y.d.CreateBox=B,G.e.CreateBox=function(I,x){return l(I,{size:x,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},14181:(I,x,L)=>{"use strict";L.d(x,{d:()=>p});var F=L(13426),X=L(13415),G=L(13033);function Y(I){const x=[],L=[],F=[],Y=[],p=I.radius||.5,B=I.tessellation||64,l=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1,W=0===I.sideOrientation?0:I.sideOrientation||X.d.DEFAULTSIDE;x.push(0,0,0),Y.push(.5,.5);const Q=2*Math.PI*l,e=1===l?Q/B:Q/(B-1);let g=0;for(let X=0;X<B;X++){const I=Math.cos(g),L=Math.sin(g),F=(I+1)/2,X=(1-L)/2;x.push(p*I,p*L,0),Y.push(F,G.e?1-X:X),g+=e}1===l&&(x.push(x[3],x[4],x[5]),Y.push(Y[2],G.e?1-Y[3]:Y[3]));const v=x.length/3;for(let X=1;X<v-1;X++)L.push(X+1,0,X);X.d.ComputeNormals(x,L,F),X.d._ComputeSides(W,x,L,F,Y,I.frontUVs,I.backUVs);const z=new X.d;return z.indices=L,z.RI=x,z.nI=F,z.MI=Y,z}function p(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new F.e(I,L);x.sideOrientation=F.e._GetDefaultSideOrientation(x.sideOrientation),X._originalBuilderSideOrientation=x.sideOrientation;return Y(x).uI(X,x.updatable),X}X.d.CreateDisc=Y,F.e.CreateDisc=function(I,x,L){return p(I,{radius:x,tessellation:L,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},14037:(I,x,L)=>{"use strict";L.d(x,{d:()=>H,b:()=>U,g:()=>s});var F=L(12983),X=L(13020),G=L(13426),Y=L(13415),p=L(13048);G.e._GroundMeshParser=(I,x)=>B.Parse(I,x);class B extends G.e{constructor(I,x){super(I,x),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=I,this._subdivisionsY=I,this.subdivide(I);const L=this;L.createOrUpdateSubmeshesOctree&&L.createOrUpdateSubmeshesOctree(x)}getHeightAtCoordinates(I,x){const L=this.getWorldMatrix(),X=F.TmpVectors.Matrix[5];L.invertToRef(X);const G=F.TmpVectors.sx[8];if(F.sx.TransformCoordinatesFromFloatsToRef(I,0,x,X,G),I=G.x,x=G.z,I<this._minX||I>=this._maxX||x<=this._minZ||x>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Y=this._getFacetAt(I,x),p=-(Y.x*I+Y.z*x+Y.w)/Y.y;return F.sx.TransformCoordinatesFromFloatsToRef(0,p,0,L,G),G.y}getNormalAtCoordinates(I,x){const L=new F.sx(0,1,0);return this.getNormalAtCoordinatesToRef(I,x,L),L}getNormalAtCoordinatesToRef(I,x,L){const X=this.getWorldMatrix(),G=F.TmpVectors.Matrix[5];X.invertToRef(G);const Y=F.TmpVectors.sx[8];if(F.sx.TransformCoordinatesFromFloatsToRef(I,0,x,G,Y),I=Y.x,x=Y.z,I<this._minX||I>this._maxX||x<this._minZ||x>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const p=this._getFacetAt(I,x);return F.sx.TransformNormalFromFloatsToRef(p.x,p.y,p.z,X,L),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(I,x){const L=Math.floor((I+this._maxX)*this._subdivisionsX/this._width),F=Math.floor(-(x+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),X=this._heightQuads[F*this._subdivisionsX+L];let G;return G=x<X.slope.x*I+X.slope.y?X.facet1:X.facet2,G}_initHeightQuads(){const I=this._subdivisionsX,x=this._subdivisionsY;this._heightQuads=[];for(let L=0;L<x;L++)for(let x=0;x<I;x++){const X={slope:F.Vector2.Zero(),facet1:new F.Vector4(0,0,0,0),facet2:new F.Vector4(0,0,0,0)};this._heightQuads[L*I+x]=X}return this}_computeHeightQuads(){const I=this.getVerticesData(p.g.PositionKind);if(!I)return this;const x=F.TmpVectors.sx[3],L=F.TmpVectors.sx[2],X=F.TmpVectors.sx[1],G=F.TmpVectors.sx[0],Y=F.TmpVectors.sx[4],B=F.TmpVectors.sx[5],l=F.TmpVectors.sx[6],W=F.TmpVectors.sx[7],Q=F.TmpVectors.sx[8];let e=0,g=0,v=0,z=0,H=0,s=0,U=0;const q=this._subdivisionsX,y=this._subdivisionsY;for(let p=0;p<y;p++)for(let y=0;y<q;y++){e=3*y,g=p*(q+1)*3,v=(p+1)*(q+1)*3,x.x=I[g+e],x.y=I[g+e+1],x.z=I[g+e+2],L.x=I[g+e+3],L.y=I[g+e+4],L.z=I[g+e+5],X.x=I[v+e],X.y=I[v+e+1],X.z=I[v+e+2],G.x=I[v+e+3],G.y=I[v+e+4],G.z=I[v+e+5],z=(G.z-x.z)/(G.x-x.x),H=x.z-z*x.x,L.subtractToRef(x,Y),X.subtractToRef(x,B),G.subtractToRef(x,l),F.sx.CrossToRef(l,B,W),F.sx.CrossToRef(Y,l,Q),W.normalize(),Q.normalize(),s=-(W.x*x.x+W.y*x.y+W.z*x.z),U=-(Q.x*L.x+Q.y*L.y+Q.z*L.z);const T=this._heightQuads[p*q+y];T.slope.YB(z,H),T.facet1.YB(W.x,W.y,W.z,s),T.facet2.YB(Q.x,Q.y,Q.z,U)}return this}serialize(I){super.serialize(I),I.subdivisionsX=this._subdivisionsX,I.subdivisionsY=this._subdivisionsY,I.minX=this._minX,I.maxX=this._maxX,I.IB=this._minZ,I.maxZ=this._maxZ,I.width=this._width,I.height=this._height}static Parse(I,x){const L=new B(I.name,x);return L._subdivisionsX=I.subdivisionsX||1,L._subdivisionsY=I.subdivisionsY||1,L._minX=I.minX,L._maxX=I.maxX,L._minZ=I.IB,L._maxZ=I.maxZ,L._width=I.width,L._height=I.height,L}}var l=L(12791),W=L(12840),Q=L(12989),e=L(13033);function g(I){const x=[],L=[],X=[],G=[];let p,B;const l=I.width||I.size||1,W=I.height||I.size||1,Q=0|(I.subdivisionsX||I.subdivisions||1),g=0|(I.subdivisionsY||I.subdivisions||1);for(p=0;p<=g;p++)for(B=0;B<=Q;B++){const I=new F.sx(B*l/Q-l/2,0,(g-p)*W/g-W/2),x=new F.sx(0,1,0);L.push(I.x,I.y,I.z),X.push(x.x,x.y,x.z),G.push(B/Q,e.e?p/g:1-p/g)}for(p=0;p<g;p++)for(B=0;B<Q;B++)x.push(B+1+(p+1)*(Q+1)),x.push(B+1+p*(Q+1)),x.push(B+p*(Q+1)),x.push(B+(p+1)*(Q+1)),x.push(B+1+(p+1)*(Q+1)),x.push(B+p*(Q+1));const v=new Y.d;return v.indices=x,v.RI=L,v.nI=X,v.MI=G,v}function v(I){const x=void 0!==I.xmin&&null!==I.xmin?I.xmin:-1,L=void 0!==I.zmin&&null!==I.zmin?I.zmin:-1,X=void 0!==I.xmax&&null!==I.xmax?I.xmax:1,G=void 0!==I.zmax&&null!==I.zmax?I.zmax:1,p=I.subdivisions||{w:1,h:1},B=I.precision||{w:1,h:1},l=[],W=[],Q=[],e=[];let g,v,z,H;p.h=p.h<1?1:p.h,p.w=p.w<1?1:p.w,B.w=B.w<1?1:B.w,B.h=B.h<1?1:B.h;const s=(X-x)/p.w,U=(G-L)/p.h;function q(I,x,L,X){const G=W.length/3,Y=B.w+1;for(g=0;g<B.h;g++)for(v=0;v<B.w;v++){const I=[G+v+g*Y,G+(v+1)+g*Y,G+(v+1)+(g+1)*Y,G+v+(g+1)*Y];l.push(I[1]),l.push(I[2]),l.push(I[3]),l.push(I[0]),l.push(I[1]),l.push(I[3])}const p=F.sx.Zero(),z=new F.sx(0,1,0);for(g=0;g<=B.h;g++)for(p.z=g*(X-x)/B.h+x,v=0;v<=B.w;v++)p.x=v*(L-I)/B.w+I,p.y=0,W.push(p.x,p.y,p.z),Q.push(z.x,z.y,z.z),e.push(v/B.w,g/B.h)}for(z=0;z<p.h;z++)for(H=0;H<p.w;H++)q(x+H*s,L+z*U,x+(H+1)*s,L+(z+1)*U);const y=new Y.d;return y.indices=l,y.RI=W,y.nI=Q,y.MI=e,y}function z(I){const x=[],L=[],G=[],p=[];let B,l;const W=I.colorFilter||new X.Tx(.3,.59,.11),e=I.alphaFilter||0;let g=!1;if(I.minHeight>I.maxHeight){g=!0;const x=I.maxHeight;I.maxHeight=I.minHeight,I.minHeight=x}for(B=0;B<=I.subdivisions;B++)for(l=0;l<=I.subdivisions;l++){const x=new F.sx(l*I.width/I.subdivisions-I.width/2,0,(I.subdivisions-B)*I.height/I.subdivisions-I.height/2),X=4*(((x.x+I.width/2)/I.width*(I.bufferWidth-1)|0)+((1-(x.z+I.height/2)/I.height)*(I.bufferHeight-1)|0)*I.bufferWidth);let Y=I.buffer[X]/255,v=I.buffer[X+1]/255,z=I.buffer[X+2]/255;const H=I.buffer[X+3]/255;g&&(Y=1-Y,v=1-v,z=1-z);const s=Y*W.r+v*W.g+z*W.b;x.y=H>=e?I.minHeight+(I.maxHeight-I.minHeight)*s:I.minHeight-Q.e,I.heightBuffer&&(I.heightBuffer[B*(I.subdivisions+1)+l]=x.y),L.push(x.x,x.y,x.z),G.push(0,0,0),p.push(l/I.subdivisions,1-B/I.subdivisions)}for(B=0;B<I.subdivisions;B++)for(l=0;l<I.subdivisions;l++){const F=l+1+(B+1)*(I.subdivisions+1),X=l+1+B*(I.subdivisions+1),G=l+B*(I.subdivisions+1),Y=l+(B+1)*(I.subdivisions+1),p=L[3*F+1]>=I.minHeight,W=L[3*X+1]>=I.minHeight,Q=L[3*G+1]>=I.minHeight;p&&W&&Q&&(x.push(F),x.push(X),x.push(G));L[3*Y+1]>=I.minHeight&&p&&Q&&(x.push(Y),x.push(F),x.push(G))}Y.d.ComputeNormals(L,x,G);const v=new Y.d;return v.indices=x,v.RI=L,v.nI=G,v.MI=p,v}function H(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const L=new B(I,arguments.length>2?arguments[2]:void 0);L._setReady(!1),L._subdivisionsX=x.subdivisionsX||x.subdivisions||1,L._subdivisionsY=x.subdivisionsY||x.subdivisions||1,L._width=x.width||1,L._height=x.height||1,L._maxX=L._width/2,L._maxZ=L._height/2,L._minX=-L._maxX,L._minZ=-L._maxZ;return g(x).uI(L,x.updatable),L._setReady(!0),L}function s(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new G.e(I,L);return v(x).uI(F,x.updatable),F}function U(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const G=L.width||10,Y=L.height||10,p=L.subdivisions||1,Q=L.minHeight||0,e=L.maxHeight||1,g=L.colorFilter||new X.Tx(.3,.59,.11),v=L.alphaFilter||0,H=L.updatable,s=L.onReady;F=F||W.e.LastCreatedScene;const U=new B(I,F);let q;U._subdivisionsX=p,U._subdivisionsY=p,U._width=G,U._height=Y,U._maxX=U._width/2,U._maxZ=U._height/2,U._minX=-U._maxX,U._minZ=-U._maxZ,U._setReady(!1),L.passHeightBufferInCallback&&(q=new Float32Array((p+1)*(p+1)));const y=(I,x,L)=>{z({width:G,height:Y,subdivisions:p,minHeight:Q,maxHeight:e,colorFilter:g,buffer:I,bufferWidth:x,bufferHeight:L,alphaFilter:v,heightBuffer:q}).uI(U,H),s&&s(U,q),U._setReady(!0)};if("string"===typeof x){const I=I=>{var x;const L=I.width,X=I.height;if(F.p)return;const G=null===(x=F)||void 0===x?void 0:x.getEngine().resizeImageBitmap(I,L,X);y(G,L,X)};l.Tools.LoadImage(x,I,L.onError?L.onError:()=>{},F.offlineProvider)}else y(x.data,x.width,x.height);return U}Y.d.CreateGround=g,Y.d.CreateTiledGround=v,Y.d.CreateGroundFromHeightMap=z,G.e.CreateGround=(I,x,L,F,X,G)=>H(I,{width:x,height:L,subdivisions:F,updatable:G},X),G.e.CreateTiledGround=(I,x,L,F,X,G,Y,p,B)=>s(I,{xmin:x,zmin:L,xmax:F,zmax:X,subdivisions:G,precision:Y,updatable:B},p),G.e.CreateGroundFromHeightMap=(I,x,L,F,X,G,Y,p,B,l,W)=>U(I,x,{width:L,height:F,subdivisions:X,minHeight:G,maxHeight:Y,updatable:B,onReady:l,alphaFilter:W},p)},14612:(I,x,L)=>{"use strict";L.d(x,{b:()=>g,d:()=>Q,f:()=>e});var F=L(12983),X=L(13426),G=L(13415),Y=L(13510),p=L(13048),B=L(12809);function l(I){const x=[],L=[],F=I.lines,X=I.dI,Y=[];let p=0;for(let G=0;G<F.length;G++){const I=F[G];for(let F=0;F<I.length;F++){const{x:B,y:l,z:W}=I[F];if(L.push(B,l,W),X){const I=X[G],{r:x,g:L,b:p,a:B}=I[F];Y.push(x,L,p,B)}F>0&&(x.push(p-1),x.push(p)),p++}}const B=new G.d;return B.indices=x,B.RI=L,X&&(B.dI=Y),B}function W(I){const x=I.dashSize||3,L=I.gapSize||1,X=I.dashNb||200,Y=I.points,p=[],B=[],l=F.sx.Zero();let W=0,Q=0,e=0,g=0,v=0,z=0,H=0;for(H=0;H<Y.length-1;H++)Y[H+1].subtractToRef(Y[H],l),W+=l.length();for(e=W/X,g=x*e/(x+L),H=0;H<Y.length-1;H++){Y[H+1].subtractToRef(Y[H],l),Q=Math.floor(l.length()/e),l.normalize();for(let I=0;I<Q;I++)v=e*I,p.push(Y[H].x+v*l.x,Y[H].y+v*l.y,Y[H].z+v*l.z),p.push(Y[H].x+(v+g)*l.x,Y[H].y+(v+g)*l.y,Y[H].z+(v+g)*l.z),B.push(z,z+1),z+=2}const s=new G.d;return s.RI=p,s.indices=B,s}function Q(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=x.instance,X=x.lines,G=x.dI;if(F){const I=F.getVerticesData(p.g.PositionKind);let x,L;G&&(x=F.getVerticesData(p.g.ColorKind));let Y=0,B=0;for(let F=0;F<X.length;F++){const p=X[F];for(let X=0;X<p.length;X++)I[Y]=p[X].x,I[Y+1]=p[X].y,I[Y+2]=p[X].z,G&&x&&(L=G[F],x[B]=L[X].r,x[B+1]=L[X].g,x[B+2]=L[X].b,x[B+3]=L[X].a,B+=4),Y+=3}return F.updateVerticesData(p.g.PositionKind,I,!1,!1),G&&x&&F.updateVerticesData(p.g.ColorKind,x,!1,!1),F.refreshBoundingInfo(),F}const B=!!G,W=new Y.c(I,L,null,void 0,void 0,B,x.useVertexAlpha,x.material);return l(x).uI(W,x.updatable),W}function e(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=x.dI?[x.dI]:null;return Q(I,{lines:[x.points],updatable:x.updatable,instance:x.instance,dI:F,useVertexAlpha:x.useVertexAlpha,material:x.material},L)}function g(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=x.points,p=x.instance,l=x.gapSize||1,Q=x.dashSize||3;if(p){const I=I=>{const x=F.sx.Zero(),L=I.length/6;let X=0,Y=0,B=0,l=0,W=0,Q=0,e=0,g=0;for(e=0;e<G.length-1;e++)G[e+1].subtractToRef(G[e],x),X+=x.length();B=X/L;const v=p._creationDataStorage.dashSize;for(l=v*B/(v+p._creationDataStorage.gapSize),e=0;e<G.length-1;e++)for(G[e+1].subtractToRef(G[e],x),Y=Math.floor(x.length()/B),x.normalize(),g=0;g<Y&&Q<I.length;)W=B*g,I[Q]=G[e].x+W*x.x,I[Q+1]=G[e].y+W*x.y,I[Q+2]=G[e].z+W*x.z,I[Q+3]=G[e].x+(W+l)*x.x,I[Q+4]=G[e].y+(W+l)*x.y,I[Q+5]=G[e].z+(W+l)*x.z,Q+=6,g++;for(;Q<I.length;)I[Q]=G[e].x,I[Q+1]=G[e].y,I[Q+2]=G[e].z,Q+=3};return(x.dashNb||x.dashSize||x.gapSize||x.useVertexAlpha||x.material)&&B.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),p.updateMeshPositions(I,!1),p}const e=new Y.c(I,L,null,void 0,void 0,void 0,x.useVertexAlpha,x.material);return W(x).uI(e,x.updatable),e._creationDataStorage=new X.i,e._creationDataStorage.dashSize=Q,e._creationDataStorage.gapSize=l,e}G.d.CreateLineSystem=l,G.d.CreateDashedLines=W,X.e.FW=function(I,x){return e(I,{points:x,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},X.e.CreateDashedLines=function(I,x,L,F,X){return g(I,{points:x,dashSize:L,gapSize:F,dashNb:X,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},14085:(I,x,L)=>{"use strict";L.d(x,{d:()=>p,e:()=>B});var F=L(13426),X=L(13415),G=L(13033);function Y(I){const x=[],L=[],F=[],Y=[],p=void 0!==I.width?I.width:void 0!==I.size?I.size:1,B=void 0!==I.height?I.height:void 0!==I.size?I.size:1,l=0===I.sideOrientation?0:I.sideOrientation||X.d.DEFAULTSIDE,W=p/2,Q=B/2;L.push(-W,-Q,0),F.push(0,0,-1),Y.push(0,G.e?1:0),L.push(W,-Q,0),F.push(0,0,-1),Y.push(1,G.e?1:0),L.push(W,Q,0),F.push(0,0,-1),Y.push(1,G.e?0:1),L.push(-W,Q,0),F.push(0,0,-1),Y.push(0,G.e?0:1),x.push(0),x.push(1),x.push(2),x.push(0),x.push(2),x.push(3),X.d._ComputeSides(l,L,x,F,Y,I.frontUVs,I.backUVs);const e=new X.d;return e.indices=x,e.RI=L,e.nI=F,e.MI=Y,e}function p(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new F.e(I,L);x.sideOrientation=F.e._GetDefaultSideOrientation(x.sideOrientation),X._originalBuilderSideOrientation=x.sideOrientation;return Y(x).uI(X,x.updatable),x.sourcePlane&&(X.translate(x.sourcePlane.normal,-x.sourcePlane.d),X.setDirection(x.sourcePlane.normal.scale(-1))),X}const B={YW:p};X.d.YW=Y,F.e.YW=(I,x,L,F,X)=>p(I,{size:x,width:x,height:x,sideOrientation:X,updatable:F},L)},14170:(I,x,L)=>{"use strict";L.d(x,{d:()=>B});var F=L(12983),X=L(13426),G=L(13415),Y=L(13033);function p(I){const x=0|(I.segments||32),L=I.diameterX||I.diameter||1,X=I.diameterY||I.diameter||1,p=I.diameterZ||I.diameter||1,B=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1,l=I.slice&&I.slice<=0?1:I.slice||1,W=0===I.sideOrientation?0:I.sideOrientation||G.d.DEFAULTSIDE,Q=!!I.dedupTopBottomIndices,e=new F.sx(L/2,X/2,p/2),g=2+x,v=2*g,z=[],H=[],s=[],U=[];for(let G=0;G<=g;G++){const I=G/g,x=I*Math.PI*l;for(let L=0;L<=v;L++){const X=L/v,G=X*Math.PI*2*B,p=F.Matrix.RotationZ(-x),l=F.Matrix.RotationY(G),W=F.sx.TransformCoordinates(F.sx.Up(),p),Q=F.sx.TransformCoordinates(W,l),g=Q.multiply(e),z=Q.divide(e).normalize();H.push(g.x,g.y,g.z),s.push(z.x,z.y,z.z),U.push(X,Y.e?1-I:I)}if(G>0){const I=H.length/3;for(let x=I-2*(v+1);x+v+2<I;x++)Q?(G>1&&(z.push(x),z.push(x+1),z.push(x+v+1)),(G<g||l<1)&&(z.push(x+v+1),z.push(x+1),z.push(x+v+2))):(z.push(x),z.push(x+1),z.push(x+v+1),z.push(x+v+1),z.push(x+1),z.push(x+v+2))}}G.d._ComputeSides(W,H,z,s,U,I.frontUVs,I.backUVs);const q=new G.d;return q.indices=z,q.RI=H,q.nI=s,q.MI=U,q}function B(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new X.e(I,L);x.sideOrientation=X.e._GetDefaultSideOrientation(x.sideOrientation),F._originalBuilderSideOrientation=x.sideOrientation;return p(x).uI(F,x.updatable),F}G.d.CreateSphere=p,X.e.CreateSphere=(I,x,L,F,X,G)=>B(I,{segments:x,diameterX:L,diameterY:L,diameterZ:L,sideOrientation:G,updatable:X},F)},15073:(I,x,L)=>{"use strict";L.d(x,{c:()=>p});var F=L(13533),X=L(14469),G=L(13543),Y=L(13415);class p{static get Configuration(){return{get decoder(){return X.b.DefaultConfiguration},set decoder(I){X.b.DefaultConfiguration=I}}}static set Configuration(I){X.b.DefaultConfiguration=I.decoder}static get DecoderAvailable(){return(0,F.i)(X.b.DefaultConfiguration)}static get Default(){return p._Default??(p._Default=new p),p._Default}static ResetDefault(I){p._Default&&(I||p._Default.dispose(),p._Default=null)}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.DefaultNumWorkers;const x="number"===typeof I?{...X.b.DefaultConfiguration,numWorkers:I}:{...X.b.DefaultConfiguration,...I};this._decoder=new X.b(x)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(I,x,L){return this._decoder.decodeMeshToMeshDataAsync(I,x,L)}async decodeMeshToGeometryAsync(I,x,L,F){return await this._decoder.decodeMeshToGeometryAsync(I,x,L,F)}async _decodeMeshToGeometryForGltfAsync(I,x,L,F,X,G){return await this._decoder._decodeMeshToGeometryForGltfAsync(I,x,L,F,X,G)}async decodeMeshAsync(I,x){const L=await this._decoder.decodeMeshToMeshDataAsync(I,x),F=new Y.d;L.indices&&(F.indices=L.indices);for(const X of L.attributes){const I=G.e.GetFloatData(X.data,X.size,G.e.GetDataType(X.data),X.byteOffset,X.byteStride,X.normalized,L.totalVertices);F.set(I,X.kind)}return F}}p.DefaultNumWorkers=(0,F.g)(),p._Default=null},14469:(I,x,L)=>{"use strict";L.d(x,{b:()=>l});var F=L(13533),X=L(12791),G=L(13437),Y=L(13543),p=L(12809),B=L(13541);class l extends F.e{static get DefaultAvailable(){return(0,F.i)(l.DefaultConfiguration)}static get Default(){return l._Default??(l._Default=new l),l._Default}static ResetDefault(I){l._Default&&(I||l._Default.dispose(),l._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(I,x){return{module:await(x||DracoDecoderModule)({wasmBinary:I})}}_getWorkerContent(){return`${B.e}(${B.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.DefaultConfiguration)}decodeMeshToMeshDataAsync(I,x,L){const F=I instanceof ArrayBuffer?new Int8Array(I):new Int8Array(I.buffer,I.byteOffset,I.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async I=>await new Promise(((X,G)=>{I.push(((I,Y)=>{let B=null;const l=[],W=x=>{I.removeEventListener("error",W),I.removeEventListener("message",Q),G(x),Y()},Q=x=>{const F=x.data;switch(F.id){case"indices":B=F.data;break;case"attribute":l.push({kind:F.kind,data:F.data,size:F.size,byteOffset:F.byteOffset,byteStride:F.byteStride,normalized:(G=F.kind,e=F.normalized,L&&void 0!==L[G]?(e!==L[G]&&p.c.Warn(`Normalized flag from Draco data (${e}) does not match normalized flag from glTF accessor (${L[G]}). Using flag from glTF accessor.`),L[G]):e)});break;case"decodeMeshDone":I.removeEventListener("error",W),I.removeEventListener("message",Q),X({indices:B,attributes:l,totalVertices:F.totalVertices}),Y()}var G,e};I.addEventListener("error",W),I.addEventListener("message",Q);const e=F.slice();I.postMessage({id:"decodeMesh",dataView:e,attributes:x},[e.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((I=>{let L=null;const X=[],G=(0,B.e)(I.module,F,x,(I=>{L=I}),((I,x,L,F,G,Y)=>{X.push({kind:I,data:x,size:L,byteOffset:F,byteStride:G,normalized:Y})}));return{indices:L,attributes:X,totalVertices:G}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(I,x,L,F){const X=await this.decodeMeshToMeshDataAsync(L,F),p=new G.e(I,x);X.indices&&p.setIndices(X.indices);for(const G of X.attributes)p.setVerticesBuffer(new Y.e(x.getEngine(),G.data,G.kind,!1,void 0,G.byteStride,void 0,G.byteOffset,G.size,void 0,G.normalized,!0),X.totalVertices);return p}async _decodeMeshToGeometryForGltfAsync(I,x,L,F,X,p){const B=await this.decodeMeshToMeshDataAsync(L,F,X),l=new G.e(I,x);p&&(l._boundingInfo=p,l.useBoundingInfoFromGeometry=!0),B.indices&&l.setIndices(B.indices);for(const G of B.attributes)l.setVerticesBuffer(new Y.e(x.getEngine(),G.data,G.kind,!1,void 0,G.byteStride,void 0,G.byteOffset,G.size,void 0,G.normalized,!0),B.totalVertices);return l}}l.DefaultConfiguration={wasmUrl:`${X.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${X.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${X.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},l._Default=null},14608:(I,x,L)=>{"use strict";L.d(x,{d:()=>pI});var F=L(12983),X=L(13426),G=L(13048),Y=L(13415),p=L(13033);function B(I){let x=I.pathArray;const L=I.closeArray||!1,F=I.closePath||!1,X=I.invertUV||!1,B=Math.floor(x[0].length/2);let l=I.offset||B;l=l>B?B:Math.floor(l);const W=0===I.sideOrientation?0:I.sideOrientation||Y.d.DEFAULTSIDE,Q=I.MI,e=I.dI,g=[],v=[],z=[],H=[],s=[],U=[],q=[],y=[];let T;const Z=[],t=[];let f,R,n;if(x.length<2){const I=[],L=[];for(R=0;R<x[0].length-l;R++)I.push(x[0][R]),L.push(x[0][R+l]);x=[I,L]}let P=0;const d=F?1:0,M=L?1:0;let K,u,A,mI,O,w;for(T=x[0].length,f=0;f<x.length+M;f++){for(q[f]=0,s[f]=[0],K=f===x.length?x[0]:x[f],u=K.length,T=T<u?T:u,n=0;n<u;)g.push(K[n].x,K[n].y,K[n].z),n>0&&(A=K[n].Ux(K[n-1]).length(),mI=A+q[f],s[f].push(mI),q[f]=mI),n++;F&&(n--,g.push(K[0].x,K[0].y,K[0].z),A=K[n].Ux(K[0]).length(),mI=A+q[f],s[f].push(mI),q[f]=mI),Z[f]=u+d,t[f]=P,P+=u+d}let k,a,D=null,r=null;for(R=0;R<T+d;R++)for(y[R]=0,U[R]=[0],f=0;f<x.length-1+M;f++)O=x[f],w=f===x.length-1?x[0]:x[f+1],R===T?(D=O[0],r=w[0]):(D=O[R],r=w[R]),A=r.Ux(D).length(),mI=A+y[R],U[R].push(mI),y[R]=mI;if(Q)for(f=0;f<Q.length;f++)H.push(Q[f].x,p.e?1-Q[f].y:Q[f].y);else for(f=0;f<x.length+M;f++)for(R=0;R<T+d;R++)k=0!=q[f]?s[f][R]/q[f]:0,a=0!=y[R]?U[R][f]/y[R]:0,X?H.push(a,k):H.push(k,p.e?1-a:a);f=0;let N=0,S=Z[f]-1,c=Z[f+1]-1,o=S<c?S:c,J=t[1]-t[0];const h=Z.length-1;for(;N<=o&&f<h;)v.push(N,N+J,N+1),v.push(N+J+1,N+1,N+J),N+=1,N===o&&(f++,J=t[f+1]-t[f],S=Z[f]-1,c=Z[f+1]-1,N=t[f],o=S<c?S+N:c+N);if(Y.d.ComputeNormals(g,v,z),F){let I=0,L=0;for(f=0;f<x.length;f++){I=3*t[f],L=f+1<x.length?3*(t[f+1]-1):z.length-3,z[I]=.5*(z[I]+z[L]),z[I+1]=.5*(z[I+1]+z[L+1]),z[I+2]=.5*(z[I+2]+z[L+2]);const F=Math.sqrt(z[I]*z[I]+z[I+1]*z[I+1]+z[I+2]*z[I+2]);z[I]/=F,z[I+1]/=F,z[I+2]/=F,z[L]=z[I],z[L+1]=z[I+1],z[L+2]=z[I+2]}}if(L){let I=3*t[0],L=3*t[x.length];for(R=0;R<T+d;R++){z[I]=.5*(z[I]+z[L]),z[I+1]=.5*(z[I+1]+z[L+1]),z[I+2]=.5*(z[I+2]+z[L+2]);const x=Math.sqrt(z[I]*z[I]+z[I+1]*z[I+1]+z[I+2]*z[I+2]);z[I]/=x,z[I+1]/=x,z[I+2]/=x,z[L]=z[I],z[L+1]=z[I+1],z[L+2]=z[I+2],I+=3,L+=3}}Y.d._ComputeSides(W,g,v,z,H,I.frontUVs,I.backUVs);let E=null;if(e){E=new Float32Array(4*e.length);for(let I=0;I<e.length;I++)E[4*I]=e[I].r,E[4*I+1]=e[I].g,E[4*I+2]=e[I].b,E[4*I+3]=e[I].a}const i=new Y.d,V=new Float32Array(g),j=new Float32Array(z),C=new Float32Array(H);return i.indices=v,i.RI=V,i.nI=j,i.MI=C,E&&i.set(E,G.g.ColorKind),F&&(i._idx=t),i}function l(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=x.pathArray,W=x.closeArray,Q=x.closePath,e=X.e._GetDefaultSideOrientation(x.sideOrientation),g=x.instance,v=x.updatable;if(g){const I=F.TmpVectors.sx[0].BB(Number.MAX_VALUE),L=F.TmpVectors.sx[1].BB(-Number.MAX_VALUE),B=x=>{let F=l[0].length;const G=g;let Y=0;const p=G._originalBuilderSideOrientation===X.e.DOUBLESIDE?2:1;for(let X=1;X<=p;++X)for(let p=0;p<l.length;++p){const X=l[p],B=X.length;F=F<B?F:B;for(let G=0;G<F;++G){const F=X[G];x[Y]=F.x,x[Y+1]=F.y,x[Y+2]=F.z,I.minimizeInPlaceFromFloats(F.x,F.y,F.z),L.maximizeInPlaceFromFloats(F.x,F.y,F.z),Y+=3}if(G._creationDataStorage&&G._creationDataStorage.closePath){const I=X[0];x[Y]=I.x,x[Y+1]=I.y,x[Y+2]=I.z,Y+=3}}},W=g.getVerticesData(G.g.PositionKind);if(B(W),g.hasBoundingInfo?g.getBoundingInfo().reConstruct(I,L,g._worldMatrix):g.buildBoundingInfo(I,L,g._worldMatrix),g.updateVerticesData(G.g.PositionKind,W,!1,!1),x.dI){const I=g.getVerticesData(G.g.ColorKind);for(let L=0,F=0;L<x.dI.length;L++,F+=4){const X=x.dI[L];I[F]=X.r,I[F+1]=X.g,I[F+2]=X.b,I[F+3]=X.a}g.updateVerticesData(G.g.ColorKind,I,!1,!1)}if(x.MI){const I=g.getVerticesData(G.g.UVKind);for(let L=0;L<x.MI.length;L++)I[2*L]=x.MI[L].x,I[2*L+1]=p.e?1-x.MI[L].y:x.MI[L].y;g.updateVerticesData(G.g.UVKind,I,!1,!1)}if(!g.areNormalsFrozen||g.isFacetDataEnabled){const I=g.XB(),x=g.getVerticesData(G.g.NormalKind),L=g.isFacetDataEnabled?g.getFacetDataParameters():null;if(Y.d.ComputeNormals(W,I,x,L),g._creationDataStorage&&g._creationDataStorage.closePath){let I=0,L=0;for(let F=0;F<l.length;F++)I=3*g._creationDataStorage.idx[F],L=F+1<l.length?3*(g._creationDataStorage.idx[F+1]-1):x.length-3,x[I]=.5*(x[I]+x[L]),x[I+1]=.5*(x[I+1]+x[L+1]),x[I+2]=.5*(x[I+2]+x[L+2]),x[L]=x[I],x[L+1]=x[I+1],x[L+2]=x[I+2]}g.areNormalsFrozen||g.updateVerticesData(G.g.NormalKind,x,!1,!1)}return g}{const F=new X.e(I,L);F._originalBuilderSideOrientation=e,F._creationDataStorage=new X.i;const G=B(x);return Q&&(F._creationDataStorage.idx=G._idx),F._creationDataStorage.closePath=Q,F._creationDataStorage.closeArray=W,G.uI(F,v),F}}Y.d.CreateRibbon=B,X.e.CreateRibbon=function(I,x){return l(I,{pathArray:x,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var W=L(14181),Q=L(14035),e=L(13020);function g(I){const x=I.pattern||X.e.NO_FLIP,L=I.tileWidth||I.tileSize||1,F=I.tileHeight||I.tileSize||1,G=I.alignHorizontal||0,p=I.alignVertical||0,B=I.width||I.size||1,l=Math.floor(B/L);let W=B-l*L;const Q=I.height||I.size||1,e=Math.floor(Q/F);let g=Q-e*F;const v=L*l/2,z=F*e/2;let H=0,s=0,U=0,q=0,y=0,T=0;if(W>0||g>0){switch(U=-v,q=-z,y=v,T=z,G){case X.e.CENTER:W/=2,U-=W,y+=W;break;case X.e.LEFT:y+=W,H=-W/2;break;case X.e.RIGHT:U-=W,H=W/2}switch(p){case X.e.CENTER:g/=2,q-=g,T+=g;break;case X.e.BOTTOM:T+=g,s=-g/2;break;case X.e.TOP:q-=g,s=g/2}}const Z=[],t=[],f=[];f[0]=[0,0,1,0,1,1,0,1],f[1]=[0,0,1,0,1,1,0,1],x!==X.e.ROTATE_TILE&&x!==X.e.ROTATE_ROW||(f[1]=[1,1,0,1,0,0,1,0]),x!==X.e.FLIP_TILE&&x!==X.e.FLIP_ROW||(f[1]=[1,0,0,0,0,1,1,1]),x!==X.e.FLIP_N_ROTATE_TILE&&x!==X.e.FLIP_N_ROTATE_ROW||(f[1]=[0,1,1,1,1,0,0,0]);let R=[];const n=[],P=[];let d=0;for(let Y=0;Y<e;Y++)for(let I=0;I<l;I++)Z.push(I*L-v+H,Y*F-z+s,0),Z.push((I+1)*L-v+H,Y*F-z+s,0),Z.push((I+1)*L-v+H,(Y+1)*F-z+s,0),Z.push(I*L-v+H,(Y+1)*F-z+s,0),P.push(d,d+1,d+3,d+1,d+2,d+3),R=x===X.e.FLIP_TILE||x===X.e.ROTATE_TILE||x===X.e.FLIP_N_ROTATE_TILE?R.concat(f[(I%2+Y%2)%2]):x===X.e.FLIP_ROW||x===X.e.ROTATE_ROW||x===X.e.FLIP_N_ROTATE_ROW?R.concat(f[Y%2]):R.concat(f[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),d+=4;if(W>0||g>0){const I=g>0&&(p===X.e.CENTER||p===X.e.TOP),Y=g>0&&(p===X.e.CENTER||p===X.e.BOTTOM),B=W>0&&(G===X.e.CENTER||G===X.e.RIGHT),Q=W>0&&(G===X.e.CENTER||G===X.e.LEFT);let f,M,K,u,A=[];if(I&&B&&(Z.push(U+H,q+s,0),Z.push(-v+H,q+s,0),Z.push(-v+H,q+g+s,0),Z.push(U+H,q+g+s,0),P.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,f=1-W/L,M=1-g/F,K=1,u=1,A=[f,M,K,M,K,u,f,u],x===X.e.ROTATE_ROW&&(A=[1-f,1-M,1-K,1-M,1-K,1-u,1-f,1-u]),x===X.e.FLIP_ROW&&(A=[1-f,M,1-K,M,1-K,u,1-f,u]),x===X.e.FLIP_N_ROTATE_ROW&&(A=[f,1-M,K,1-M,K,1-u,f,1-u]),R=R.concat(A),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),I&&Q&&(Z.push(v+H,q+s,0),Z.push(y+H,q+s,0),Z.push(y+H,q+g+s,0),Z.push(v+H,q+g+s,0),P.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,f=0,M=1-g/F,K=W/L,u=1,A=[f,M,K,M,K,u,f,u],(x===X.e.ROTATE_ROW||x===X.e.ROTATE_TILE&&l%2===0)&&(A=[1-f,1-M,1-K,1-M,1-K,1-u,1-f,1-u]),(x===X.e.FLIP_ROW||x===X.e.FLIP_TILE&&l%2===0)&&(A=[1-f,M,1-K,M,1-K,u,1-f,u]),(x===X.e.FLIP_N_ROTATE_ROW||x===X.e.FLIP_N_ROTATE_TILE&&l%2===0)&&(A=[f,1-M,K,1-M,K,1-u,f,1-u]),R=R.concat(A),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&B&&(Z.push(U+H,z+s,0),Z.push(-v+H,z+s,0),Z.push(-v+H,T+s,0),Z.push(U+H,T+s,0),P.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,f=1-W/L,M=0,K=1,u=g/F,A=[f,M,K,M,K,u,f,u],(x===X.e.ROTATE_ROW&&e%2===1||x===X.e.ROTATE_TILE&&e%1===0)&&(A=[1-f,1-M,1-K,1-M,1-K,1-u,1-f,1-u]),(x===X.e.FLIP_ROW&&e%2===1||x===X.e.FLIP_TILE&&e%2===0)&&(A=[1-f,M,1-K,M,1-K,u,1-f,u]),(x===X.e.FLIP_N_ROTATE_ROW&&e%2===1||x===X.e.FLIP_N_ROTATE_TILE&&e%2===0)&&(A=[f,1-M,K,1-M,K,1-u,f,1-u]),R=R.concat(A),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&Q&&(Z.push(v+H,z+s,0),Z.push(y+H,z+s,0),Z.push(y+H,T+s,0),Z.push(v+H,T+s,0),P.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,f=0,M=0,K=W/L,u=g/F,A=[f,M,K,M,K,u,f,u],(x===X.e.ROTATE_ROW&&e%2===1||x===X.e.ROTATE_TILE&&(e+l)%2===1)&&(A=[1-f,1-M,1-K,1-M,1-K,1-u,1-f,1-u]),(x===X.e.FLIP_ROW&&e%2===1||x===X.e.FLIP_TILE&&(e+l)%2===1)&&(A=[1-f,M,1-K,M,1-K,u,1-f,u]),(x===X.e.FLIP_N_ROTATE_ROW&&e%2===1||x===X.e.FLIP_N_ROTATE_TILE&&(e+l)%2===1)&&(A=[f,1-M,K,1-M,K,1-u,f,1-u]),R=R.concat(A),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),I){const I=[];f=0,M=1-g/F,K=1,u=1,I[0]=[f,M,K,M,K,u,f,u],I[1]=[f,M,K,M,K,u,f,u],x!==X.e.ROTATE_TILE&&x!==X.e.ROTATE_ROW||(I[1]=[1-f,1-M,1-K,1-M,1-K,1-u,1-f,1-u]),x!==X.e.FLIP_TILE&&x!==X.e.FLIP_ROW||(I[1]=[1-f,M,1-K,M,1-K,u,1-f,u]),x!==X.e.FLIP_N_ROTATE_TILE&&x!==X.e.FLIP_N_ROTATE_ROW||(I[1]=[f,1-M,K,1-M,K,1-u,f,1-u]);for(let F=0;F<l;F++)Z.push(F*L-v+H,q+s,0),Z.push((F+1)*L-v+H,q+s,0),Z.push((F+1)*L-v+H,q+g+s,0),Z.push(F*L-v+H,q+g+s,0),P.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,R=x===X.e.FLIP_TILE||x===X.e.ROTATE_TILE||x===X.e.FLIP_N_ROTATE_TILE?R.concat(I[(F+1)%2]):x===X.e.FLIP_ROW||x===X.e.ROTATE_ROW||x===X.e.FLIP_N_ROTATE_ROW?R.concat(I[1]):R.concat(I[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Y){const I=[];f=0,M=0,K=1,u=g/F,I[0]=[f,M,K,M,K,u,f,u],I[1]=[f,M,K,M,K,u,f,u],x!==X.e.ROTATE_TILE&&x!==X.e.ROTATE_ROW||(I[1]=[1-f,1-M,1-K,1-M,1-K,1-u,1-f,1-u]),x!==X.e.FLIP_TILE&&x!==X.e.FLIP_ROW||(I[1]=[1-f,M,1-K,M,1-K,u,1-f,u]),x!==X.e.FLIP_N_ROTATE_TILE&&x!==X.e.FLIP_N_ROTATE_ROW||(I[1]=[f,1-M,K,1-M,K,1-u,f,1-u]);for(let F=0;F<l;F++)Z.push(F*L-v+H,T-g+s,0),Z.push((F+1)*L-v+H,T-g+s,0),Z.push((F+1)*L-v+H,T+s,0),Z.push(F*L-v+H,T+s,0),P.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,R=x===X.e.FLIP_TILE||x===X.e.ROTATE_TILE||x===X.e.FLIP_N_ROTATE_TILE?R.concat(I[(F+e)%2]):x===X.e.FLIP_ROW||x===X.e.ROTATE_ROW||x===X.e.FLIP_N_ROTATE_ROW?R.concat(I[e%2]):R.concat(I[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(B){const I=[];f=1-W/L,M=0,K=1,u=1,I[0]=[f,M,K,M,K,u,f,u],I[1]=[f,M,K,M,K,u,f,u],x!==X.e.ROTATE_TILE&&x!==X.e.ROTATE_ROW||(I[1]=[1-f,1-M,1-K,1-M,1-K,1-u,1-f,1-u]),x!==X.e.FLIP_TILE&&x!==X.e.FLIP_ROW||(I[1]=[1-f,M,1-K,M,1-K,u,1-f,u]),x!==X.e.FLIP_N_ROTATE_TILE&&x!==X.e.FLIP_N_ROTATE_ROW||(I[1]=[f,1-M,K,1-M,K,1-u,f,1-u]);for(let L=0;L<e;L++)Z.push(U+H,L*F-z+s,0),Z.push(U+W+H,L*F-z+s,0),Z.push(U+W+H,(L+1)*F-z+s,0),Z.push(U+H,(L+1)*F-z+s,0),P.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,R=x===X.e.FLIP_TILE||x===X.e.ROTATE_TILE||x===X.e.FLIP_N_ROTATE_TILE?R.concat(I[(L+1)%2]):x===X.e.FLIP_ROW||x===X.e.ROTATE_ROW||x===X.e.FLIP_N_ROTATE_ROW?R.concat(I[L%2]):R.concat(I[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Q){const I=[];f=0,M=0,K=W/F,u=1,I[0]=[f,M,K,M,K,u,f,u],I[1]=[f,M,K,M,K,u,f,u],x!==X.e.ROTATE_TILE&&x!==X.e.ROTATE_ROW||(I[1]=[1-f,1-M,1-K,1-M,1-K,1-u,1-f,1-u]),x!==X.e.FLIP_TILE&&x!==X.e.FLIP_ROW||(I[1]=[1-f,M,1-K,M,1-K,u,1-f,u]),x!==X.e.FLIP_N_ROTATE_TILE&&x!==X.e.FLIP_N_ROTATE_ROW||(I[1]=[f,1-M,K,1-M,K,1-u,f,1-u]);for(let L=0;L<e;L++)Z.push(y-W+H,L*F-z+s,0),Z.push(y+H,L*F-z+s,0),Z.push(y+H,(L+1)*F-z+s,0),Z.push(y-W+H,(L+1)*F-z+s,0),P.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,R=x===X.e.FLIP_TILE||x===X.e.ROTATE_TILE||x===X.e.FLIP_N_ROTATE_TILE?R.concat(I[(L+l)%2]):x===X.e.FLIP_ROW||x===X.e.ROTATE_ROW||x===X.e.FLIP_N_ROTATE_ROW?R.concat(I[L%2]):R.concat(I[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const M=0===I.sideOrientation?0:I.sideOrientation||Y.d.DEFAULTSIDE;Y.d._ComputeSides(M,Z,P,t,R,I.frontUVs,I.backUVs);const K=new Y.d;K.indices=P,K.RI=Z,K.nI=t,K.MI=R;const u=M===Y.d.DOUBLESIDE?n.concat(n):n;return K.dI=u,K}function v(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new X.e(I,L);x.sideOrientation=X.e._GetDefaultSideOrientation(x.sideOrientation),F._originalBuilderSideOrientation=x.sideOrientation;return g(x).uI(F,x.updatable),F}function z(I){const x=I.faceUV||new Array(6),L=I.faceColors,G=I.pattern||X.e.NO_FLIP,B=I.width||I.size||1,l=I.height||I.size||1,W=I.depth||I.size||1,Q=I.tileWidth||I.tileSize||1,v=I.tileHeight||I.tileSize||1,z=I.alignHorizontal||0,H=I.alignVertical||0,s=0===I.sideOrientation?0:I.sideOrientation||Y.d.DEFAULTSIDE;for(let X=0;X<6;X++)void 0===x[X]&&(x[X]=new F.Vector4(0,0,1,1)),L&&void 0===L[X]&&(L[X]=new e.lB(1,1,1,1));const U=B/2,q=l/2,y=W/2,T=[];for(let F=0;F<2;F++)T[F]=g({pattern:G,tileWidth:Q,tileHeight:v,width:B,height:l,alignVertical:H,alignHorizontal:z,sideOrientation:s});for(let F=2;F<4;F++)T[F]=g({pattern:G,tileWidth:Q,tileHeight:v,width:W,height:l,alignVertical:H,alignHorizontal:z,sideOrientation:s});let Z=H;H===X.e.BOTTOM?Z=X.e.TOP:H===X.e.TOP&&(Z=X.e.BOTTOM);for(let F=4;F<6;F++)T[F]=g({pattern:G,tileWidth:Q,tileHeight:v,width:B,height:W,alignVertical:Z,alignHorizontal:z,sideOrientation:s});let t=[],f=[],R=[],n=[];const P=[],d=[],M=[],K=[];let u=0,A=0;for(let X=0;X<6;X++){const I=T[X].RI.length;d[X]=[],M[X]=[];for(let x=0;x<I/3;x++)d[X].push(new F.sx(T[X].RI[3*x],T[X].RI[3*x+1],T[X].RI[3*x+2])),M[X].push(new F.sx(T[X].nI[3*x],T[X].nI[3*x+1],T[X].nI[3*x+2]));u=T[X].MI.length,K[X]=[];for(let L=0;L<u;L+=2)K[X][L]=x[X].x+(x[X].z-x[X].x)*T[X].MI[L],K[X][L+1]=x[X].y+(x[X].w-x[X].y)*T[X].MI[L+1],p.e&&(K[X][L+1]=1-K[X][L+1]);if(R=R.concat(K[X]),n=n.concat(T[X].indices.map((I=>I+A))),A+=d[X].length,L)for(let x=0;x<4;x++)P.push(L[X].r,L[X].g,L[X].b,L[X].a)}const mI=new F.sx(0,0,y),O=F.Matrix.RotationY(Math.PI);t=d[0].map((I=>F.sx.TransformNormal(I,O).add(mI))).map((I=>[I.x,I.y,I.z])).reduce(((I,x)=>I.concat(x)),[]),f=M[0].map((I=>F.sx.TransformNormal(I,O))).map((I=>[I.x,I.y,I.z])).reduce(((I,x)=>I.concat(x)),[]),t=t.concat(d[1].map((I=>I.Ux(mI))).map((I=>[I.x,I.y,I.z])).reduce(((I,x)=>I.concat(x)),[])),f=f.concat(M[1].map((I=>[I.x,I.y,I.z])).reduce(((I,x)=>I.concat(x)),[]));const w=new F.sx(U,0,0),k=F.Matrix.RotationY(-Math.PI/2);t=t.concat(d[2].map((I=>F.sx.TransformNormal(I,k).add(w))).map((I=>[I.x,I.y,I.z])).reduce(((I,x)=>I.concat(x)),[])),f=f.concat(M[2].map((I=>F.sx.TransformNormal(I,k))).map((I=>[I.x,I.y,I.z])).reduce(((I,x)=>I.concat(x)),[]));const a=F.Matrix.RotationY(Math.PI/2);t=t.concat(d[3].map((I=>F.sx.TransformNormal(I,a).Ux(w))).map((I=>[I.x,I.y,I.z])).reduce(((I,x)=>I.concat(x)),[])),f=f.concat(M[3].map((I=>F.sx.TransformNormal(I,a))).map((I=>[I.x,I.y,I.z])).reduce(((I,x)=>I.concat(x)),[]));const D=new F.sx(0,q,0),r=F.Matrix.RotationX(Math.PI/2);t=t.concat(d[4].map((I=>F.sx.TransformNormal(I,r).add(D))).map((I=>[I.x,I.y,I.z])).reduce(((I,x)=>I.concat(x)),[])),f=f.concat(M[4].map((I=>F.sx.TransformNormal(I,r))).map((I=>[I.x,I.y,I.z])).reduce(((I,x)=>I.concat(x)),[]));const N=F.Matrix.RotationX(-Math.PI/2);t=t.concat(d[5].map((I=>F.sx.TransformNormal(I,N).Ux(D))).map((I=>[I.x,I.y,I.z])).reduce(((I,x)=>I.concat(x)),[])),f=f.concat(M[5].map((I=>F.sx.TransformNormal(I,N))).map((I=>[I.x,I.y,I.z])).reduce(((I,x)=>I.concat(x)),[])),Y.d._ComputeSides(s,t,n,f,R);const S=new Y.d;if(S.indices=n,S.RI=t,S.nI=f,S.MI=R,L){const I=s===Y.d.DOUBLESIDE?P.concat(P):P;S.dI=I}return S}function H(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new X.e(I,L);x.sideOrientation=X.e._GetDefaultSideOrientation(x.sideOrientation),F._originalBuilderSideOrientation=x.sideOrientation;return z(x).uI(F,x.updatable),F}Y.d.CreateTiledPlane=g;Y.d.CreateTiledBox=z;var s=L(14170),U=L(13218),q=L(13182);function y(I){const x=I.height||2;let L=0===I.diameterTop?0:I.diameterTop||I.diameter||1,G=0===I.diameterBottom?0:I.diameterBottom||I.diameter||1;L=L||1e-5,G=G||1e-5;const B=0|(I.tessellation||24),l=0|(I.subdivisions||1),W=!!I.hasRings,Q=!!I.enclose,g=0===I.cap?0:I.cap||X.e.CAP_ALL,v=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1,z=0===I.sideOrientation?0:I.sideOrientation||Y.d.DEFAULTSIDE,H=I.faceUV||new Array(3),s=I.faceColors,U=2+(1+(1!==v&&Q?2:0))*(W?l:1);let y;for(y=0;y<U;y++)s&&void 0===s[y]&&(s[y]=new e.lB(1,1,1,1));for(y=0;y<U;y++)H&&void 0===H[y]&&(H[y]=new F.Vector4(0,0,1,1));const T=[],Z=[],t=[],f=[],R=[],n=2*Math.PI*v/B;let P,d,M;const K=(G-L)/2/x,u=F.sx.Zero(),A=F.sx.Zero(),mI=F.sx.Zero(),O=F.sx.Zero(),w=F.sx.Zero(),k=q.d.Y;let a,D,r,N=1,S=1,c=0,o=0;for(a=0;a<=l;a++)for(d=a/l,M=(d*(L-G)+G)/2,N=W&&0!==a&&a!==l?2:1,r=0;r<N;r++){for(W&&(S+=r),Q&&(S+=2*r),D=0;D<=B;D++)P=D*n,u.x=Math.cos(-P)*M,u.y=-x/2+d*x,u.z=Math.sin(-P)*M,0===L&&a===l?(A.x=t[t.length-3*(B+1)],A.y=t[t.length-3*(B+1)+1],A.z=t[t.length-3*(B+1)+2]):(A.x=u.x,A.z=u.z,A.y=Math.sqrt(A.x*A.x+A.z*A.z)*K,A.normalize()),0===D&&(mI.X(u),O.X(A)),Z.push(u.x,u.y,u.z),t.push(A.x,A.y,A.z),o=W?c!==S?H[S].y:H[S].w:H[S].y+(H[S].w-H[S].y)*d,f.push(H[S].x+(H[S].z-H[S].x)*D/B,p.e?1-o:o),s&&R.push(s[S].r,s[S].g,s[S].b,s[S].a);1!==v&&Q&&(Z.push(u.x,u.y,u.z),Z.push(0,u.y,0),Z.push(0,u.y,0),Z.push(mI.x,mI.y,mI.z),F.sx.CrossToRef(k,A,w),w.normalize(),t.push(w.x,w.y,w.z,w.x,w.y,w.z),F.sx.CrossToRef(O,k,w),w.normalize(),t.push(w.x,w.y,w.z,w.x,w.y,w.z),o=W?c!==S?H[S+1].y:H[S+1].w:H[S+1].y+(H[S+1].w-H[S+1].y)*d,f.push(H[S+1].x,p.e?1-o:o),f.push(H[S+1].z,p.e?1-o:o),o=W?c!==S?H[S+2].y:H[S+2].w:H[S+2].y+(H[S+2].w-H[S+2].y)*d,f.push(H[S+2].x,p.e?1-o:o),f.push(H[S+2].z,p.e?1-o:o),s&&(R.push(s[S+1].r,s[S+1].g,s[S+1].b,s[S+1].a),R.push(s[S+1].r,s[S+1].g,s[S+1].b,s[S+1].a),R.push(s[S+2].r,s[S+2].g,s[S+2].b,s[S+2].a),R.push(s[S+2].r,s[S+2].g,s[S+2].b,s[S+2].a))),c!==S&&(c=S)}const J=1!==v&&Q?B+4:B;for(a=0,S=0;S<l;S++){let I=0,x=0,L=0,F=0;for(D=0;D<B;D++)I=a*(J+1)+D,x=(a+1)*(J+1)+D,L=a*(J+1)+(D+1),F=(a+1)*(J+1)+(D+1),T.push(I,x,L),T.push(F,L,x);1!==v&&Q&&(T.push(I+2,x+2,L+2),T.push(F+2,L+2,x+2),T.push(I+4,x+4,L+4),T.push(F+4,L+4,x+4)),a=W?a+2:a+1}const h=I=>{const X=I?L/2:G/2;if(0===X)return;let Y,l,W;const Q=I?H[U-1]:H[0];let e=null;s&&(e=I?s[U-1]:s[0]);const g=Z.length/3,z=I?x/2:-x/2,q=new F.sx(0,z,0);Z.push(q.x,q.y,q.z),t.push(0,I?1:-1,0);const y=Q.y+.5*(Q.w-Q.y);f.push(Q.x+.5*(Q.z-Q.x),p.e?1-y:y),e&&R.push(e.r,e.g,e.b,e.a);const n=new F.Vector2(.5,.5);for(W=0;W<=B;W++){Y=2*Math.PI*W*v/B;const x=Math.cos(-Y),L=Math.sin(-Y);l=new F.sx(x*X,z,L*X);const G=new F.Vector2(x*n.x+.5,L*n.y+.5);Z.push(l.x,l.y,l.z),t.push(0,I?1:-1,0);const g=Q.y+(Q.w-Q.y)*G.y;f.push(Q.x+(Q.z-Q.x)*G.x,p.e?1-g:g),e&&R.push(e.r,e.g,e.b,e.a)}for(W=0;W<B;W++)I?(T.push(g),T.push(g+(W+2)),T.push(g+(W+1))):(T.push(g),T.push(g+(W+1)),T.push(g+(W+2)))};g!==X.e.CAP_START&&g!==X.e.CAP_ALL||h(!1),g!==X.e.CAP_END&&g!==X.e.CAP_ALL||h(!0),Y.d._ComputeSides(z,Z,T,t,f,I.frontUVs,I.backUVs);const E=new Y.d;return E.indices=T,E.RI=Z,E.nI=t,E.MI=f,s&&(E.dI=R),E}function T(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;const F=new X.e(I,L);x.sideOrientation=X.e._GetDefaultSideOrientation(x.sideOrientation),F._originalBuilderSideOrientation=x.sideOrientation;return y(x).uI(F,x.updatable),F}function Z(I){const x=[],L=[],X=[],G=[],B=I.diameter||1,l=I.thickness||.5,W=0|(I.tessellation||16),Q=0===I.sideOrientation?0:I.sideOrientation||Y.d.DEFAULTSIDE,e=W+1;for(let Y=0;Y<=W;Y++){const I=Y/W,Q=Y*Math.PI*2/W-Math.PI/2,g=F.Matrix.Translation(B/2,0,0).multiply(F.Matrix.RotationY(Q));for(let B=0;B<=W;B++){const Q=1-B/W,v=B*Math.PI*2/W+Math.PI,z=Math.cos(v),H=Math.sin(v);let s=new F.sx(z,H,0),U=s.scale(l/2);const q=new F.Vector2(I,Q);U=F.sx.TransformCoordinates(U,g),s=F.sx.TransformNormal(s,g),L.push(U.x,U.y,U.z),X.push(s.x,s.y,s.z),G.push(q.x,p.e?1-q.y:q.y);const y=(Y+1)%e,T=(B+1)%e;x.push(Y*e+B),x.push(Y*e+T),x.push(y*e+B),x.push(Y*e+T),x.push(y*e+T),x.push(y*e+B)}}Y.d._ComputeSides(Q,L,x,X,G,I.frontUVs,I.backUVs);const g=new Y.d;return g.indices=x,g.RI=L,g.nI=X,g.MI=G,g}function t(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;const F=new X.e(I,L);x.sideOrientation=X.e._GetDefaultSideOrientation(x.sideOrientation),F._originalBuilderSideOrientation=x.sideOrientation;return Z(x).uI(F,x.updatable),F}Y.d.CreateCylinder=y,X.e.CreateCylinder=(I,x,L,F,G,Y,p,B,l)=>{void 0!==p&&p instanceof U.b||(void 0!==p&&(l=B||X.e.DEFAULTSIDE,B=p),p=Y,Y=1);return T(I,{height:x,diameterTop:L,diameterBottom:F,tessellation:G,subdivisions:Y,sideOrientation:l,updatable:B},p)};function f(I){const x=[],L=[],X=[],G=[],B=I.radius||2,l=I.tube||.5,W=I.radialSegments||32,Q=I.tubularSegments||32,e=I.p||2,g=I.q||3,v=0===I.sideOrientation?0:I.sideOrientation||Y.d.DEFAULTSIDE,z=I=>{const x=Math.cos(I),L=Math.sin(I),X=g/e*I,G=Math.cos(X),Y=B*(2+G)*.5*x,p=B*(2+G)*L*.5,l=B*Math.sin(X)*.5;return new F.sx(Y,p,l)};let H,s;for(H=0;H<=W;H++){const I=H%W/W*2*e*Math.PI,x=z(I),X=z(I+.01),Y=X.Ux(x);let B=X.add(x);const g=F.sx.Cross(Y,B);for(B=F.sx.Cross(g,Y),g.normalize(),B.normalize(),s=0;s<Q;s++){const I=s%Q/Q*2*Math.PI,F=-l*Math.cos(I),X=l*Math.sin(I);L.push(x.x+F*B.x+X*g.x),L.push(x.y+F*B.y+X*g.y),L.push(x.z+F*B.z+X*g.z),G.push(H/W),G.push(p.e?1-s/Q:s/Q)}}for(H=0;H<W;H++)for(s=0;s<Q;s++){const I=(s+1)%Q,L=H*Q+s,F=(H+1)*Q+s,X=(H+1)*Q+I,G=H*Q+I;x.push(G),x.push(F),x.push(L),x.push(G),x.push(X),x.push(F)}Y.d.ComputeNormals(L,x,X),Y.d._ComputeSides(v,L,x,X,G,I.frontUVs,I.backUVs);const U=new Y.d;return U.indices=x,U.RI=L,U.nI=X,U.MI=G,U}function R(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;const F=new X.e(I,L);x.sideOrientation=X.e._GetDefaultSideOrientation(x.sideOrientation),F._originalBuilderSideOrientation=x.sideOrientation;return f(x).uI(F,x.updatable),F}Y.d.CreateTorus=Z,X.e.CreateTorus=(I,x,L,F,X,G,Y)=>t(I,{diameter:x,thickness:L,tessellation:F,sideOrientation:Y,updatable:G},X);Y.d.CreateTorusKnot=f,X.e.CreateTorusKnot=(I,x,L,F,X,G,Y,p,B,l)=>R(I,{radius:x,tube:L,radialSegments:F,tubularSegments:X,p:G,q:Y,sideOrientation:l,updatable:B},p);var n=L(14612),P=L(13522),d=L(13194);function M(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=x.path,G=x.shape,Y=x.scale||1,p=x.rotation||0,B=0===x.cap?0:x.cap||X.e.NO_CAP,l=x.updatable,W=X.e._GetDefaultSideOrientation(x.sideOrientation),Q=x.instance||null,e=x.invertUV||!1,g=x.closeShape||!1,v=x.closePath||!1,z=x.capFunction||null;return u(I,G,F,Y,p,null,null,v,g,B,!1,L,!!l,W,Q,e,x.frontUVs||null,x.backUVs||null,x.firstNormal||null,!!x.adjustFrame,z)}function K(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=x.path,G=x.shape,Y=x.scaleFunction||(()=>1),p=x.rotationFunction||(()=>0),B=x.closePath||x.ribbonCloseArray||!1,l=x.closeShape||x.ribbonClosePath||!1,W=0===x.cap?0:x.cap||X.e.NO_CAP,Q=x.updatable,e=x.firstNormal||null,g=x.adjustFrame||!1,v=X.e._GetDefaultSideOrientation(x.sideOrientation),z=x.instance,H=x.invertUV||!1,s=x.capFunction||null;return u(I,G,F,null,null,Y,p,B,l,W,!0,L,!!Q,v,z||null,H,x.frontUVs||null,x.backUVs||null,e,g,s||null)}function u(I,x,L,G,Y,p,B,W,Q,e,g,v,z,H,s,U,q,y,T,Z,t){const f=(I,x,L,G,Y,p,B,l,W,Q,e)=>{const g=L.getTangents(),v=L.getNormals(),z=L.getBinormals(),H=L.getDistances();if(e)for(let X=0;X<g.length;X++)if(0==g[X].x&&0==g[X].y&&0==g[X].z&&g[X].X(g[X-1]),0==v[X].x&&0==v[X].y&&0==v[X].z&&v[X].X(v[X-1]),0==z[X].x&&0==z[X].y&&0==z[X].z&&z[X].X(z[X-1]),X>0){let I=g[X-1];F.sx.Dot(I,g[X])<0&&g[X].scaleInPlace(-1),I=v[X-1],F.sx.Dot(I,v[X])<0&&v[X].scaleInPlace(-1),I=z[X-1],F.sx.Dot(I,z[X])<0&&z[X].scaleInPlace(-1)}let s=0;const U=Q&&l?l:()=>null!==p?p:0,q=Q&&B?B:()=>null!==Y?Y:1;let y=W===X.e.NO_CAP||W===X.e.CAP_END?0:2;const T=F.TmpVectors.Matrix[0];for(let X=0;X<x.length;X++){const L=[],Y=U(X,H[X]),p=q(X,H[X]);F.Matrix.RotationAxisToRef(g[X],s,T);for(let G=0;G<I.length;G++){const Y=g[X].scale(I[G].z).add(v[X].scale(I[G].x)).add(z[X].scale(I[G].y)),B=F.sx.Zero();F.sx.TransformCoordinatesToRef(Y,T,B),B.scaleInPlace(p).addInPlace(x[X]),L[G]=B}G[y]=L,s+=Y,y++}const Z=t||(I=>{const x=Array(),L=F.sx.Zero();let X;for(X=0;X<I.length;X++)L.addInPlace(I[X]);for(L.scaleInPlace(1/I.length),X=0;X<I.length;X++)x.push(L);return x});switch(W){case X.e.NO_CAP:break;case X.e.CAP_START:G[0]=Z(G[2]),G[1]=G[2];break;case X.e.CAP_END:G[y]=G[y-1],G[y+1]=Z(G[y-1]);break;case X.e.CAP_ALL:G[0]=Z(G[2]),G[1]=G[2],G[y]=G[y-1],G[y+1]=Z(G[y-1])}return G};let R,n;if(s){const I=s._creationDataStorage;return R=T?I.path3D.update(L,T):I.path3D.update(L),n=f(x,L,I.path3D,I.pathArray,G,Y,p,B,I.cap,g,Z),s=l("",{pathArray:n,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:s},v||void 0)}R=T?new d.l(L,T):new d.l(L);n=f(x,L,R,new Array,G,Y,p,B,e=e<0||e>3?0:e,g,Z);const P=l(I,{pathArray:n,closeArray:W,closePath:Q,updatable:z,sideOrientation:H,invertUV:U,frontUVs:q||void 0,backUVs:y||void 0},v);return P._creationDataStorage.pathArray=n,P._creationDataStorage.path3D=R,P._creationDataStorage.cap=e,P}function A(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=x.arc?x.arc<=0||x.arc>1?1:x.arc:1,Y=void 0===x.closed||x.closed,p=x.shape,B=x.radius||1,W=x.tessellation||64,Q=x.clip||0,e=x.updatable,g=X.e._GetDefaultSideOrientation(x.sideOrientation),v=x.cap||X.e.NO_CAP,z=2*Math.PI,H=[],s=x.invertUV||!1;let U=0,q=0;const y=z/W*G;let T,Z;for(U=0;U<=W-Q;U++){for(Z=[],v!=X.e.CAP_START&&v!=X.e.CAP_ALL||(Z.push(new F.sx(0,p[0].y,0)),Z.push(new F.sx(Math.cos(U*y)*p[0].x*B,p[0].y,Math.sin(U*y)*p[0].x*B))),q=0;q<p.length;q++)T=new F.sx(Math.cos(U*y)*p[q].x*B,p[q].y,Math.sin(U*y)*p[q].x*B),Z.push(T);v!=X.e.CAP_END&&v!=X.e.CAP_ALL||(Z.push(new F.sx(Math.cos(U*y)*p[p.length-1].x*B,p[p.length-1].y,Math.sin(U*y)*p[p.length-1].x*B)),Z.push(new F.sx(0,p[p.length-1].y,0))),H.push(Z)}return l(I,{pathArray:H,closeArray:Y,sideOrientation:g,updatable:e,invertUV:s,frontUVs:x.frontUVs,backUVs:x.backUVs},L)}X.e.ExtrudeShape=function(I,x,L,F,G,Y){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0,W=arguments.length>9?arguments[9]:void 0;return M(I,{shape:x,path:L,scale:F,rotation:G,cap:0===Y?0:Y||X.e.NO_CAP,sideOrientation:l,instance:W,updatable:B},p)},X.e.ExtrudeShapeCustom=(I,x,L,F,G,Y,p,B,l,W,Q,e)=>K(I,{shape:x,path:L,scaleFunction:F,rotationFunction:G,ribbonCloseArray:Y,ribbonClosePath:p,cap:0===B?0:B||X.e.NO_CAP,sideOrientation:Q,instance:e,updatable:W},l);X.e.CreateLathe=(I,x,L,F,X,G,Y)=>A(I,{shape:x,radius:L,tessellation:F,sideOrientation:Y,updatable:G},X);var mI=L(14085),O=L(14037);function w(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=x.path;let Y=x.instance,p=1;void 0!==x.radius?p=x.radius:Y&&(p=Y._creationDataStorage.radius);const B=x.tessellation||64,W=x.radiusFunction||null;let Q=x.cap||X.e.NO_CAP;const e=x.invertUV||!1,g=x.updatable,v=X.e._GetDefaultSideOrientation(x.sideOrientation);x.arc=x.arc&&(x.arc<=0||x.arc>1)?1:x.arc||1;const z=(I,x,L,G,Y,p,B,l)=>{const W=x.getTangents(),Q=x.getNormals(),e=x.getDistances(),g=2*Math.PI/Y*l,v=p||(()=>G);let z,H,s,U;const q=F.TmpVectors.Matrix[0];let y=B===X.e.NO_CAP||B===X.e.CAP_END?0:2;for(let X=0;X<I.length;X++){H=v(X,e[X]),z=Array(),s=Q[X];for(let x=0;x<Y;x++)F.Matrix.RotationAxisToRef(W[X],g*x,q),U=z[x]?z[x]:F.sx.Zero(),F.sx.TransformCoordinatesToRef(s,q,U),U.scaleInPlace(H).addInPlace(I[X]),z[x]=U;L[y]=z,y++}const T=(x,L)=>{const F=Array();for(let X=0;X<x;X++)F.push(I[L]);return F};switch(B){case X.e.NO_CAP:break;case X.e.CAP_START:L[0]=T(Y,0),L[1]=L[2].slice(0);break;case X.e.CAP_END:L[y]=L[y-1].slice(0),L[y+1]=T(Y,I.length-1);break;case X.e.CAP_ALL:L[0]=T(Y,0),L[1]=L[2].slice(0),L[y]=L[y-1].slice(0),L[y+1]=T(Y,I.length-1)}return L};let H,s;if(Y){const I=Y._creationDataStorage,L=x.arc||I.arc;return H=I.path3D.update(G),s=z(G,H,I.pathArray,p,I.tessellation,W,I.cap,L),Y=l("",{pathArray:s,instance:Y}),I.path3D=H,I.pathArray=s,I.arc=L,I.radius=p,Y}H=new d.l(G);Q=Q<0||Q>3?0:Q,s=z(G,H,new Array,p,B,W,Q,x.arc);const U=l(I,{pathArray:s,closePath:!0,closeArray:!1,updatable:g,sideOrientation:v,invertUV:e,frontUVs:x.frontUVs,backUVs:x.backUVs},L);return U._creationDataStorage.pathArray=s,U._creationDataStorage.path3D=H,U._creationDataStorage.tessellation=B,U._creationDataStorage.cap=Q,U._creationDataStorage.arc=x.arc,U._creationDataStorage.radius=p,U}function k(I){const x=[];x[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},x[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},x[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},x[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},x[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},x[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},x[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},x[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},x[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},x[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},x[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},x[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},x[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},x[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},x[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const L=I.type&&(I.type<0||I.type>=x.length)?0:I.type||0,X=I.size,G=I.sizeX||X||1,B=I.sizeY||X||1,l=I.sizeZ||X||1,W=I.custom||x[L],Q=W.face.length,g=I.faceUV||new Array(Q),v=I.faceColors,z=void 0===I.flat||I.flat,H=0===I.sideOrientation?0:I.sideOrientation||Y.d.DEFAULTSIDE,s=[],U=[],q=[],y=[],T=[];let Z=0,t=0;const f=[];let R,n,P,d,M,K,u=0,A=0;if(z)for(A=0;A<Q;A++)v&&void 0===v[A]&&(v[A]=new e.lB(1,1,1,1)),g&&void 0===g[A]&&(g[A]=new F.Vector4(0,0,1,1));if(z)for(A=0;A<Q;A++){const I=W.face[A].length;for(P=2*Math.PI/I,d=.5*Math.tan(P/2),M=.5,u=0;u<I;u++)s.push(W.vertex[W.face[A][u]][0]*G,W.vertex[W.face[A][u]][1]*B,W.vertex[W.face[A][u]][2]*l),f.push(Z),Z++,R=g[A].x+(g[A].z-g[A].x)*(.5+d),n=g[A].y+(g[A].w-g[A].y)*(M-.5),y.push(R,p.e?1-n:n),K=d*Math.cos(P)-M*Math.sin(P),M=d*Math.sin(P)+M*Math.cos(P),d=K,v&&T.push(v[A].r,v[A].g,v[A].b,v[A].a);for(u=0;u<I-2;u++)U.push(f[0+t],f[u+2+t],f[u+1+t]);t+=I}else{for(u=0;u<W.vertex.length;u++)s.push(W.vertex[u][0]*G,W.vertex[u][1]*B,W.vertex[u][2]*l),y.push(0,p.e?1:0);for(A=0;A<Q;A++)for(u=0;u<W.face[A].length-2;u++)U.push(W.face[A][0],W.face[A][u+2],W.face[A][u+1])}Y.d.ComputeNormals(s,U,q),Y.d._ComputeSides(H,s,U,q,y,I.frontUVs,I.backUVs);const mI=new Y.d;return mI.RI=s,mI.indices=U,mI.nI=q,mI.MI=y,v&&z&&(mI.dI=T),mI}function a(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new X.e(I,L);x.sideOrientation=X.e._GetDefaultSideOrientation(x.sideOrientation),F._originalBuilderSideOrientation=x.sideOrientation;return k(x).uI(F,x.updatable),F}X.e.CreateTube=(I,x,L,F,X,G,Y,p,B,l)=>w(I,{path:x,radius:L,tessellation:F,radiusFunction:X,arc:1,cap:G,updatable:p,sideOrientation:B,instance:l},Y);function D(I){const x=I.sideOrientation||Y.d.DEFAULTSIDE,L=I.radius||1,X=void 0===I.flat||I.flat,G=0|(I.subdivisions||4),B=I.radiusX||L,l=I.radiusY||L,W=I.radiusZ||L,Q=(1+Math.sqrt(5))/2,e=[-1,Q,-0,1,Q,0,-1,-Q,0,1,-Q,0,0,-1,-Q,0,1,-Q,0,-1,Q,0,1,Q,Q,0,1,Q,0,-1,-Q,0,1,-Q,0,-1],g=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],v=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],z=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],H=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],s=[],U=[],q=[],y=[];let T=0;const Z=new Array(3),t=new Array(3);let f;for(f=0;f<3;f++)Z[f]=F.sx.Zero(),t[f]=F.Vector2.Zero();for(let Y=0;Y<20;Y++){for(f=0;f<3;f++){const I=g[3*Y+f];Z[f].YB(e[3*v[I]],e[3*v[I]+1],e[3*v[I]+2]),Z[f].normalize(),t[f].YB(.134765625*z[2*I]+.05859375+-.0390625*H[Y],.2333984375*z[2*I+1]+.025390625+.01953125*H[Y])}const I=(I,x,L,Y)=>{const Q=F.sx.Lerp(Z[0],Z[2],x/G),e=F.sx.Lerp(Z[1],Z[2],x/G),g=G===x?Z[2]:F.sx.Lerp(Q,e,I/(G-x));let v;if(g.normalize(),X){const I=F.sx.Lerp(Z[0],Z[2],Y/G),x=F.sx.Lerp(Z[1],Z[2],Y/G);v=F.sx.Lerp(I,x,L/(G-Y))}else v=new F.sx(g.x,g.y,g.z);v.x/=B,v.y/=l,v.z/=W,v.normalize();const z=F.Vector2.Lerp(t[0],t[2],x/G),H=F.Vector2.Lerp(t[1],t[2],x/G),f=G===x?t[2]:F.Vector2.Lerp(z,H,I/(G-x));U.push(g.x*B,g.y*l,g.z*W),q.push(v.x,v.y,v.z),y.push(f.x,p.e?1-f.y:f.y),s.push(T),T++};for(let x=0;x<G;x++)for(let L=0;L+x<G;L++)I(L,x,L+1/3,x+1/3),I(L+1,x,L+1/3,x+1/3),I(L,x+1,L+1/3,x+1/3),L+x+1<G&&(I(L+1,x,L+2/3,x+2/3),I(L+1,x+1,L+2/3,x+2/3),I(L,x+1,L+2/3,x+2/3))}Y.d._ComputeSides(x,U,s,q,y,I.frontUVs,I.backUVs);const R=new Y.d;return R.indices=s,R.RI=U,R.nI=q,R.MI=y,R}function r(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new X.e(I,L);x.sideOrientation=X.e._GetDefaultSideOrientation(x.sideOrientation),F._originalBuilderSideOrientation=x.sideOrientation;return D(x).uI(F,x.updatable),F}Y.d.CreatePolyhedron=k,X.e.CreatePolyhedron=(I,x,L)=>a(I,x,L);Y.d.CreateIcoSphere=D,X.e.CreateIcoSphere=(I,x,L)=>r(I,x,L);var N=L(13001);const S=new F.sx(1,0,0),c=new F.sx(-1,0,0),o=new F.sx(0,1,0),J=new F.sx(0,-1,0),h=new F.sx(0,0,1),E=new F.sx(0,0,-1);class i{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.sx.Zero(),x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.sx.Up(),L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.Vector2.Zero(),X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=I,this.normal=x,this.uv=L,this.vertexIdx=X,this.vertexIdxForBones=G,this.localPositionOverride=Y,this.localNormalOverride=p,this.matrixIndicesOverride=B,this.matrixWeightsOverride=l}clone(){var I,x,L,F;return new i(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(I=this.localPositionOverride)||void 0===I?void 0:I.slice(),null===(x=this.localNormalOverride)||void 0===x?void 0:x.slice(),null===(L=this.matrixIndicesOverride)||void 0===L?void 0:L.slice(),null===(F=this.matrixWeightsOverride)||void 0===F?void 0:F.slice())}}function V(I,x,L){var B,l,W,Q,e;const g=!!x.skeleton,v=!(null===(B=x.morphTargetManager)||void 0===B||!B.numTargets),z=L.localMode||g,H=x.XB(),s=g||v?x.TB(!0,!0):x.getVerticesData(G.g.PositionKind),U=g||v?x.getNormalsData(!0,!0):x.getVerticesData(G.g.NormalKind),q=z?g?x.getVerticesData(G.g.PositionKind):s:null,y=z?g?x.getVerticesData(G.g.NormalKind):U:null,T=x.getVerticesData(G.g.UVKind),Z=g?x.getVerticesData(G.g.MatricesIndicesKind):null,t=g?x.getVerticesData(G.g.MatricesWeightsKind):null,f=g?x.getVerticesData(G.g.MatricesIndicesExtraKind):null,R=g?x.getVerticesData(G.g.MatricesWeightsExtraKind):null,n=L.position||F.sx.Zero();let P=L.normal||F.sx.Up();const d=L.size||F.sx.One(),M=L.angle||0;if(!P){const I=new F.sx(0,0,1),L=x.tI().activeCamera,X=F.sx.TransformCoordinates(I,L.getWorldMatrix());P=L.globalPosition.Ux(X)}const K=-Math.atan2(P.z,P.x)-Math.PI/2,u=Math.sqrt(P.x*P.x+P.z*P.z),A=Math.atan2(P.y,u),mI=new Y.d;mI.indices=[],mI.RI=[],mI.nI=[],mI.MI=[],mI.matricesIndices=g?[]:null,mI.matricesWeights=g?[]:null,mI.matricesIndicesExtra=f?[]:null,mI.matricesWeightsExtra=R?[]:null;let O=0;const w=(I,x)=>{const X=new i;if(!H||!s||!U)return X;const G=H[I];if(X.vertexIdx=3*G,X.vertexIdxForBones=4*G,X.position=new F.sx(s[3*G],s[3*G+1],s[3*G+2]),F.sx.TransformCoordinatesToRef(X.position,x,X.position),X.normal=new F.sx(U[3*G],U[3*G+1],U[3*G+2]),F.sx.TransformNormalToRef(X.normal,x,X.normal),L.captureUVS&&T){const I=T[2*G+1];X.uv=new F.Vector2(T[2*G],p.e?1-I:I)}return X},k=[0,0,0,0],a=(I,x)=>{if(0===I.length)return I;const L=.5*Math.abs(F.sx.Dot(d,x)),X=(I,x,L,F)=>{for(let X=0;X<F;++X)if(I[L+X]===x)return L+X;return-1},G=(I,G)=>{const Y=F.sx.GetClipFactor(I.position,G.position,x,L);let p=k,B=k;if(Z&&t){const x=I.matrixIndicesOverride?0:I.vertexIdxForBones,L=I.matrixIndicesOverride??Z,F=I.matrixWeightsOverride??t,l=G.matrixIndicesOverride?0:G.vertexIdxForBones,W=G.matrixIndicesOverride??Z,Q=G.matrixWeightsOverride??t;p=[0,0,0,0],B=[0,0,0,0];let e=0;for(let I=0;I<4;++I)if(F[x+I]>0){const G=X(W,L[x+I],l,4);p[e]=L[x+I],B[e]=(0,N.Lerp)(F[x+I],G>=0?Q[G]:0,Y),e++}for(let I=0;I<4&&e<4;++I){const F=W[l+I];-1===X(L,F,x,4)&&(p[e]=F,B[e]=(0,N.Lerp)(0,Q[l+I],Y),e++)}const g=B[0]+B[1]+B[2]+B[3];B[0]/=g,B[1]/=g,B[2]/=g,B[3]/=g}const l=I.localPositionOverride?I.localPositionOverride[0]:(null===q||void 0===q?void 0:q[I.vertexIdx])??0,W=I.localPositionOverride?I.localPositionOverride[1]:(null===q||void 0===q?void 0:q[I.vertexIdx+1])??0,Q=I.localPositionOverride?I.localPositionOverride[2]:(null===q||void 0===q?void 0:q[I.vertexIdx+2])??0,e=G.localPositionOverride?G.localPositionOverride[0]:(null===q||void 0===q?void 0:q[G.vertexIdx])??0,g=G.localPositionOverride?G.localPositionOverride[1]:(null===q||void 0===q?void 0:q[G.vertexIdx+1])??0,v=G.localPositionOverride?G.localPositionOverride[2]:(null===q||void 0===q?void 0:q[G.vertexIdx+2])??0,z=I.localNormalOverride?I.localNormalOverride[0]:(null===y||void 0===y?void 0:y[I.vertexIdx])??0,H=I.localNormalOverride?I.localNormalOverride[1]:(null===y||void 0===y?void 0:y[I.vertexIdx+1])??0,s=I.localNormalOverride?I.localNormalOverride[2]:(null===y||void 0===y?void 0:y[I.vertexIdx+2])??0,U=z+((G.localNormalOverride?G.localNormalOverride[0]:(null===y||void 0===y?void 0:y[G.vertexIdx])??0)-z)*Y,T=H+((G.localNormalOverride?G.localNormalOverride[1]:(null===y||void 0===y?void 0:y[G.vertexIdx+1])??0)-H)*Y,f=s+((G.localNormalOverride?G.localNormalOverride[2]:(null===y||void 0===y?void 0:y[G.vertexIdx+2])??0)-s)*Y,R=Math.sqrt(U*U+T*T+f*f);return new i(F.sx.Lerp(I.position,G.position,Y),F.sx.Lerp(I.normal,G.normal,Y).normalize(),F.Vector2.Lerp(I.uv,G.uv,Y),-1,-1,q?[l+(e-l)*Y,W+(g-W)*Y,Q+(v-Q)*Y]:null,y?[U/R,T/R,f/R]:null,p,B)};let Y=null;I.length>3&&(Y=[]);for(let p=0;p<I.length;p+=3){let X=0,B=null,l=null,W=null,Q=null;const e=F.sx.Dot(I[p].position,x)-L>0,g=F.sx.Dot(I[p+1].position,x)-L>0,v=F.sx.Dot(I[p+2].position,x)-L>0;switch(X=(e?1:0)+(g?1:0)+(v?1:0),X){case 0:I.length>3?(Y.push(I[p]),Y.push(I[p+1]),Y.push(I[p+2])):Y=I;break;case 1:if(Y=Y??new Array,e&&(B=I[p+1],l=I[p+2],W=G(I[p],B),Q=G(I[p],l)),g){B=I[p],l=I[p+2],W=G(I[p+1],B),Q=G(I[p+1],l),Y.push(W),Y.push(l.clone()),Y.push(B.clone()),Y.push(l.clone()),Y.push(W.clone()),Y.push(Q);break}v&&(B=I[p],l=I[p+1],W=G(I[p+2],B),Q=G(I[p+2],l)),B&&l&&W&&Q&&(Y.push(B.clone()),Y.push(l.clone()),Y.push(W),Y.push(Q),Y.push(W.clone()),Y.push(l.clone()));break;case 2:Y=Y??new Array,e||(B=I[p].clone(),l=G(B,I[p+1]),W=G(B,I[p+2]),Y.push(B),Y.push(l),Y.push(W)),g||(B=I[p+1].clone(),l=G(B,I[p+2]),W=G(B,I[p]),Y.push(B),Y.push(l),Y.push(W)),v||(B=I[p+2].clone(),l=G(B,I[p]),W=G(B,I[p+1]),Y.push(B),Y.push(l),Y.push(W))}}return Y},D=x instanceof X.e?x:null,r=null===D||void 0===D?void 0:D._thinInstanceDataStorage.matrixData,V=(null===D||void 0===D?void 0:D.QB)||1,j=F.TmpVectors.Matrix[0];j.X(F.Matrix.IdentityReadOnly);for(let X=0;X<V;++X){if(null!==D&&void 0!==D&&D.hasThinInstances&&r){const I=16*X;j.setRowFromFloats(0,r[I+0],r[I+1],r[I+2],r[I+3]),j.setRowFromFloats(1,r[I+4],r[I+5],r[I+6],r[I+7]),j.setRowFromFloats(2,r[I+8],r[I+9],r[I+10],r[I+11]),j.setRowFromFloats(3,r[I+12],r[I+13],r[I+14],r[I+15])}const I=F.Matrix.RotationYawPitchRoll(K,A,M).multiply(F.Matrix.Translation(n.x,n.y,n.z)),G=F.Matrix.Invert(I),Y=x.getWorldMatrix(),B=j.multiply(Y).multiply(G),l=new Array(3);for(let x=0;x<H.length;x+=3){let I=l;if(I[0]=w(x,B),I[1]=w(x+1,B),I[2]=w(x+2,B),!(L.cullBackFaces&&-I[0].normal.z<=0&&-I[1].normal.z<=0&&-I[2].normal.z<=0)&&(I=a(I,S),I&&(I=a(I,c),I&&(I=a(I,o),I&&(I=a(I,J),I&&(I=a(I,h),I&&(I=a(I,E),I)))))))for(let x=0;x<I.length;x++){const F=I[x];if(mI.indices.push(O),z?(F.localPositionOverride?(mI.RI[3*O]=F.localPositionOverride[0],mI.RI[3*O+1]=F.localPositionOverride[1],mI.RI[3*O+2]=F.localPositionOverride[2]):q&&(mI.RI[3*O]=q[F.vertexIdx],mI.RI[3*O+1]=q[F.vertexIdx+1],mI.RI[3*O+2]=q[F.vertexIdx+2]),F.localNormalOverride?(mI.nI[3*O]=F.localNormalOverride[0],mI.nI[3*O+1]=F.localNormalOverride[1],mI.nI[3*O+2]=F.localNormalOverride[2]):y&&(mI.nI[3*O]=y[F.vertexIdx],mI.nI[3*O+1]=y[F.vertexIdx+1],mI.nI[3*O+2]=y[F.vertexIdx+2])):(F.position.toArray(mI.RI,3*O),F.normal.toArray(mI.nI,3*O)),mI.matricesIndices&&mI.matricesWeights&&(F.matrixIndicesOverride?(mI.matricesIndices[4*O]=F.matrixIndicesOverride[0],mI.matricesIndices[4*O+1]=F.matrixIndicesOverride[1],mI.matricesIndices[4*O+2]=F.matrixIndicesOverride[2],mI.matricesIndices[4*O+3]=F.matrixIndicesOverride[3]):(Z&&(mI.matricesIndices[4*O]=Z[F.vertexIdxForBones],mI.matricesIndices[4*O+1]=Z[F.vertexIdxForBones+1],mI.matricesIndices[4*O+2]=Z[F.vertexIdxForBones+2],mI.matricesIndices[4*O+3]=Z[F.vertexIdxForBones+3]),f&&mI.matricesIndicesExtra&&(mI.matricesIndicesExtra[4*O]=f[F.vertexIdxForBones],mI.matricesIndicesExtra[4*O+1]=f[F.vertexIdxForBones+1],mI.matricesIndicesExtra[4*O+2]=f[F.vertexIdxForBones+2],mI.matricesIndicesExtra[4*O+3]=f[F.vertexIdxForBones+3])),F.matrixWeightsOverride?(mI.matricesWeights[4*O]=F.matrixWeightsOverride[0],mI.matricesWeights[4*O+1]=F.matrixWeightsOverride[1],mI.matricesWeights[4*O+2]=F.matrixWeightsOverride[2],mI.matricesWeights[4*O+3]=F.matrixWeightsOverride[3]):(t&&(mI.matricesWeights[4*O]=t[F.vertexIdxForBones],mI.matricesWeights[4*O+1]=t[F.vertexIdxForBones+1],mI.matricesWeights[4*O+2]=t[F.vertexIdxForBones+2],mI.matricesWeights[4*O+3]=t[F.vertexIdxForBones+3]),R&&mI.matricesWeightsExtra&&(mI.matricesWeightsExtra[4*O]=R[F.vertexIdxForBones],mI.matricesWeightsExtra[4*O+1]=R[F.vertexIdxForBones+1],mI.matricesWeightsExtra[4*O+2]=R[F.vertexIdxForBones+2],mI.matricesWeightsExtra[4*O+3]=R[F.vertexIdxForBones+3]))),L.captureUVS)F.uv.toArray(mI.MI,2*O);else{mI.MI.push(.5+F.position.x/d.x);const I=.5+F.position.y/d.y;mI.MI.push(p.e?1-I:I)}O++}}}0===mI.indices.length&&(mI.indices=null),0===mI.RI.length&&(mI.RI=null),0===mI.nI.length&&(mI.nI=null),0===mI.MI.length&&(mI.MI=null),0===(null===(l=mI.matricesIndices)||void 0===l?void 0:l.length)&&(mI.matricesIndices=null),0===(null===(W=mI.matricesWeights)||void 0===W?void 0:W.length)&&(mI.matricesWeights=null),0===(null===(Q=mI.matricesIndicesExtra)||void 0===Q?void 0:Q.length)&&(mI.matricesIndicesExtra=null),0===(null===(e=mI.matricesWeightsExtra)||void 0===e?void 0:e.length)&&(mI.matricesWeightsExtra=null);const C=new X.e(I,x.tI());return mI.uI(C),z?(C.skeleton=x.skeleton,C.parent=x):(C.position=n.clone(),C.rotation=new F.sx(A,K,M)),C.LB(!0),C.refreshBoundingInfo(!0,!0),C}function j(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const x=0|Math.max(I.subdivisions?I.subdivisions:2,1),L=0|Math.max(I.tessellation?I.tessellation:16,3),X=Math.max(I.height?I.height:1,0),G=Math.max(I.radius?I.radius:.25,0),B=0|Math.max(I.capSubdivisions?I.capSubdivisions:6,1),l=L,W=x,Q=Math.max(I.radiusTop?I.radiusTop:G,0),e=Math.max(I.radiusBottom?I.radiusBottom:G,0),g=X-(Q+e),v=2*Math.PI,z=Math.max(I.topCapSubdivisions?I.topCapSubdivisions:B,1),H=Math.max(I.bottomCapSubdivisions?I.bottomCapSubdivisions:B,1),s=Math.acos((e-Q)/X);let U=[];const q=[],y=[],T=[];let Z=0;const t=[],f=.5*g,R=.5*Math.PI;let n,P;const d=F.sx.Zero(),M=F.sx.Zero(),K=Math.cos(s),u=Math.sin(s),A=new F.Vector2(Q*u,f+Q*K).Ux(new F.Vector2(e*u,e*K-f)).length(),mI=Q*s+A+e*(R-s);let O=0;for(P=0;P<=z;P++){const I=[],x=R-s*(P/z);O+=Q*s/z;const L=Math.cos(x),F=Math.sin(x),X=L*Q;for(n=0;n<=l;n++){const x=n/l,G=x*v+0,Y=Math.sin(G),B=Math.cos(G);M.x=X*Y,M.y=f+F*Q,M.z=X*B,q.push(M.x,M.y,M.z),d.set(L*Y,F,L*B),y.push(d.x,d.y,d.z),T.push(x,p.e?O/mI:1-O/mI),I.push(Z),Z++}t.push(I)}const w=X-Q-e+K*Q-K*e,k=u*(e-Q)/w;for(P=1;P<=W;P++){const I=[];O+=A/W;const x=u*(P*(e-Q)/W+Q);for(n=0;n<=l;n++){const L=n/l,F=L*v+0,X=Math.sin(F),G=Math.cos(F);M.x=x*X,M.y=f+K*Q-P*w/W,M.z=x*G,q.push(M.x,M.y,M.z),d.set(X,k,G).normalize(),y.push(d.x,d.y,d.z),T.push(L,p.e?O/mI:1-O/mI),I.push(Z),Z++}t.push(I)}for(P=1;P<=H;P++){const I=[],x=R-s-(Math.PI-s)*(P/H);O+=e*s/H;const L=Math.cos(x),F=Math.sin(x),X=L*e;for(n=0;n<=l;n++){const x=n/l,G=x*v+0,Y=Math.sin(G),B=Math.cos(G);M.x=X*Y,M.y=F*e-f,M.z=X*B,q.push(M.x,M.y,M.z),d.set(L*Y,F,L*B),y.push(d.x,d.y,d.z),T.push(x,p.e?O/mI:1-O/mI),I.push(Z),Z++}t.push(I)}for(n=0;n<l;n++)for(P=0;P<z+W+H;P++){const I=t[P][n],x=t[P+1][n],L=t[P+1][n+1],F=t[P][n+1];U.push(I),U.push(x),U.push(F),U.push(x),U.push(L),U.push(F)}if(U=U.reverse(),I.orientation&&!I.orientation.equals(F.sx.Up())){const x=new F.Matrix;I.orientation.clone().scale(.5*Math.PI).cross(F.sx.Up()).toQuaternion().toRotationMatrix(x);const L=F.sx.Zero();for(let I=0;I<q.length;I+=3)L.set(q[I],q[I+1],q[I+2]),F.sx.TransformCoordinatesToRef(L.clone(),x,L),q[I]=L.x,q[I+1]=L.y,q[I+2]=L.z}const a=new Y.d;return a.RI=q,a.nI=y,a.MI=T,a.indices=U,a}function C(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:F.sx.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new X.e(I,L);return j(x).uI(G,x.updatable),G}X.e.CreateDecal=(I,x,L,F,X,G)=>V(I,x,{position:L,normal:F,size:X,angle:G});X.e.CreateCapsule=(I,x,L)=>C(I,x,L),Y.d.CreateCapsule=j;var b=L(12809),II=L(12989);class xI{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=I,this.y=x,I!==Math.floor(I)&&(I=Math.floor(I),b.c.Warn("x is not an integer, floor(x) used")),x!==Math.floor(x)&&(x=Math.floor(x),b.c.Warn("y is not an integer, floor(y) used"))}clone(){return new xI(this.x,this.y)}rotate60About(I){const x=this.x;return this.x=I.x+I.y-this.y,this.y=x+this.y-I.x,this}rotateNeg60About(I){const x=this.x;return this.x=x+this.y-I.y,this.y=I.x+I.y-x,this}rotate120(I,x){I!==Math.floor(I)&&(I=Math.floor(I),b.c.Warn("m not an integer only floor(m) used")),x!==Math.floor(x)&&(x=Math.floor(x),b.c.Warn("n not an integer only floor(n) used"));const L=this.x;return this.x=I-L-this.y,this.y=x+L,this}rotateNeg120(I,x){I!==Math.floor(I)&&(I=Math.floor(I),b.c.Warn("m is not an integer, floor(m) used")),x!==Math.floor(x)&&(x=Math.floor(x),b.c.Warn("n is not an integer,   floor(n) used"));const L=this.x;return this.x=this.y-x,this.y=I+x-L-this.y,this}toCartesianOrigin(I,x){const L=F.sx.Zero();return L.x=I.x+2*this.x*x+this.y*x,L.y=I.y+Math.sqrt(3)*this.y*x,L}static Zero(){return new xI(0,0)}}class LI{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new FI("icosahedron","Regular",[[0,II.h,-1],[-II.h,1,0],[-1,0,-II.h],[1,0,-II.h],[II.h,1,0],[0,II.h,1],[-1,0,II.h],[-II.h,-1,0],[0,-II.h,-1],[II.h,-1,0],[1,0,II.h],[0,-II.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let I=12;const x={},L=this.m,F=this.n;let X,G,Y,p,B,l=L,W=1,Q=0;0!==F&&(l=(0,N.HighestCommonFactor)(L,F)),W=L/l,Q=F/l;const e=xI.Zero(),g=new xI(L,F),v=new xI(-F,L+F),z=xI.Zero(),H=xI.Zero(),s=xI.Zero();let U,q,y,T,Z=[];const t=[],f=this.vertByDist,R=(L,F,X,G)=>{U=L+"|"+X,q=F+"|"+G,U in x||q in x?U in x&&!(q in x)?x[q]=x[U]:q in x&&!(U in x)&&(x[U]=x[q]):(x[U]=I,x[q]=I,I++),f[X][0]>2?t[x[U]]=[-f[X][0],f[X][1],x[U]]:t[x[U]]=[Z[f[X][0]],f[X][1],x[U]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let n=0;n<20;n++){if(Z=this.IDATA.face[n],Y=Z[2],p=Z[1],B=Z[0],y=e.x+"|"+e.y,U=n+"|"+y,U in x||(x[U]=Y,t[Y]=[Z[f[y][0]],f[y][1]]),y=g.x+"|"+g.y,U=n+"|"+y,U in x||(x[U]=p,t[p]=[Z[f[y][0]],f[y][1]]),y=v.x+"|"+v.y,U=n+"|"+y,U in x||(x[U]=B,t[B]=[Z[f[y][0]],f[y][1]]),X=this.IDATA.edgematch[n][0],G=this.IDATA.edgematch[n][1],"B"===G)for(let I=1;I<l;I++)H.x=L-I*(W+Q),H.y=F+I*W,s.x=-I*Q,s.y=I*(W+Q),y=H.x+"|"+H.y,T=s.x+"|"+s.y,R(n,X,y,T);if("O"===G)for(let I=1;I<l;I++)s.x=-I*Q,s.y=I*(W+Q),z.x=I*W,z.y=I*Q,y=s.x+"|"+s.y,T=z.x+"|"+z.y,R(n,X,y,T);if(X=this.IDATA.edgematch[n][2],G=this.IDATA.edgematch[n][3],G&&"A"===G)for(let I=1;I<l;I++)z.x=I*W,z.y=I*Q,H.x=L-(l-I)*(W+Q),H.y=F+(l-I)*W,y=z.x+"|"+z.y,T=H.x+"|"+H.y,R(n,X,y,T);for(let L=0;L<this.vertices.length;L++)y=this.vertices[L].x+"|"+this.vertices[L].y,U=n+"|"+y,U in x||(x[U]=I++,f[y][0]>2?t[x[U]]=[-f[y][0],f[y][1],x[U]]:t[x[U]]=[Z[f[y][0]],f[y][1],x[U]])}this.closestTo=t,this.vecToidx=x}calcCoeffs(){const I=this.m,x=this.n,L=Math.sqrt(3)/3,F=I*I+x*x+I*x;this.coau=(I+x)/F,this.cobu=-x/F,this.coav=-L*(I-x)/F,this.cobv=L*(2*I+x)/F}createInnerFacets(){const I=this.m,x=this.n;for(let L=0;L<x+I+1;L++)for(let I=this.min[L];I<this.max[L]+1;I++)I<this.max[L]&&I<this.max[L+1]+1&&this.innerFacets.push(["|"+I+"|"+L,"|"+I+"|"+(L+1),"|"+(I+1)+"|"+L]),L>0&&I<this.max[L-1]&&I+1<this.max[L]+1&&this.innerFacets.push(["|"+I+"|"+L,"|"+(I+1)+"|"+L,"|"+(I+1)+"|"+(L-1)])}edgeVecsABOB(){const I=this.m,x=this.n,L=new xI(-x,I+x);for(let F=1;F<I+x;F++){const I=new xI(this.min[F],F),x=new xI(this.min[F-1],F-1),X=new xI(this.min[F+1],F+1),G=I.clone(),Y=x.clone(),p=X.clone();G.rotate60About(L),Y.rotate60About(L),p.rotate60About(L);const B=new xI(this.max[G.y],G.y),l=new xI(this.max[G.y-1],G.y-1),W=new xI(this.max[G.y-1]-1,G.y-1);G.x===B.x&&G.y===B.y||(G.x!==l.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([I,l,W]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([I,W,B])):G.y===p.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([I,x,l]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([I,l,X])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([I,x,l]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([I,l,B])))}}mapABOBtoOBOA(){const I=new xI(0,0);for(let x=0;x<this.isoVecsABOB.length;x++){const L=[];for(let F=0;F<3;F++)I.x=this.isoVecsABOB[x][F].x,I.y=this.isoVecsABOB[x][F].y,0===this.vertexTypes[x][F]&&I.rotateNeg120(this.m,this.n),L.push(I.clone());this.isoVecsOBOA.push(L)}}mapABOBtoBAOA(){const I=new xI(0,0);for(let x=0;x<this.isoVecsABOB.length;x++){const L=[];for(let F=0;F<3;F++)I.x=this.isoVecsABOB[x][F].x,I.y=this.isoVecsABOB[x][F].y,1===this.vertexTypes[x][F]&&I.rotate120(this.m,this.n),L.push(I.clone());this.isoVecsBAOA.push(L)}}MapToFace(I,x){const L=this.IDATA.face[I],X=L[2],G=L[1],Y=L[0],p=F.sx.tx(this.IDATA.vertex[X]),B=F.sx.tx(this.IDATA.vertex[G]),l=F.sx.tx(this.IDATA.vertex[Y]),W=B.Ux(p),Q=l.Ux(p),e=W.scale(this.coau).add(Q.scale(this.cobu)),g=W.scale(this.coav).add(Q.scale(this.cobv)),v=[];let z,H=F.TmpVectors.sx[0];for(let F=0;F<this.cartesian.length;F++)H=e.scale(this.cartesian[F].x).add(g.scale(this.cartesian[F].y)).add(p),v[F]=[H.x,H.y,H.z],z=I+"|"+this.vertices[F].x+"|"+this.vertices[F].y,x.vertex[this.vecToidx[z]]=[H.x,H.y,H.z]}build(I,x){const L=[],F=xI.Zero(),X=new xI(I,x),G=new xI(-x,I+x);L.push(F,X,G);for(let y=x;y<I+1;y++)for(let x=0;x<I+1-y;x++)L.push(new xI(x,y));if(x>0){const F=(0,N.HighestCommonFactor)(I,x),X=I/F,G=x/F;for(let p=1;p<F;p++)L.push(new xI(p*X,p*G)),L.push(new xI(-p*G,p*(X+G))),L.push(new xI(I-p*(X+G),x+p*X));const Y=I/x;for(let p=1;p<x;p++)for(let F=0;F<p*Y;F++)L.push(new xI(F,p)),L.push(new xI(F,p).rotate120(I,x)),L.push(new xI(F,p).rotateNeg120(I,x))}L.sort(((I,x)=>I.x-x.x)),L.sort(((I,x)=>I.y-x.y));const Y=new Array(I+x+1),p=new Array(I+x+1);for(let y=0;y<Y.length;y++)Y[y]=1/0,p[y]=-1/0;let B=0,l=0;const W=L.length;for(let y=0;y<W;y++)l=L[y].x,B=L[y].y,Y[B]=Math.min(l,Y[B]),p[B]=Math.max(l,p[B]);const Q=(L,F)=>{const X=L.clone();return"A"===F&&X.rotateNeg120(I,x),"B"===F&&X.rotate120(I,x),X.x<0?X.y:X.x+X.y},e=[],g=[],v=[],z=[],H={},s=[];let U=-1,q=-1;for(let y=0;y<W;y++)e[y]=L[y].toCartesianOrigin(new xI(0,0),.5),g[y]=Q(L[y],"O"),v[y]=Q(L[y],"A"),z[y]=Q(L[y],"B"),g[y]===v[y]&&v[y]===z[y]?(U=3,q=g[y]):g[y]===v[y]?(U=4,q=g[y]):v[y]===z[y]?(U=5,q=v[y]):z[y]===g[y]&&(U=6,q=g[y]),g[y]<v[y]&&g[y]<z[y]&&(U=2,q=g[y]),v[y]<g[y]&&v[y]<z[y]&&(U=1,q=v[y]),z[y]<v[y]&&z[y]<g[y]&&(U=0,q=z[y]),s.push([U,q,L[y].x,L[y].y]);s.sort(((I,x)=>I[2]-x[2])),s.sort(((I,x)=>I[3]-x[3])),s.sort(((I,x)=>I[1]-x[1])),s.sort(((I,x)=>I[0]-x[0]));for(let y=0;y<s.length;y++)H[s[y][2]+"|"+s[y][3]]=[s[y][0],s[y][1],y];return this.m=I,this.n=x,this.vertices=L,this.vertByDist=H,this.cartesian=e,this.min=Y,this.max=p,this}}class FI{constructor(I,x,L,F){this.name=I,this.category=x,this.vertex=L,this.face=F}}class XI extends FI{innerToData(I,x){for(let L=0;L<x.innerFacets.length;L++)this.face.push(x.innerFacets[L].map((L=>x.vecToidx[I+L])))}mapABOBtoDATA(I,x){const L=x.IDATA.edgematch[I][0];for(let F=0;F<x.isoVecsABOB.length;F++){const X=[];for(let G=0;G<3;G++)0===x.vertexTypes[F][G]?X.push(I+"|"+x.isoVecsABOB[F][G].x+"|"+x.isoVecsABOB[F][G].y):X.push(L+"|"+x.isoVecsABOB[F][G].x+"|"+x.isoVecsABOB[F][G].y);this.face.push([x.vecToidx[X[0]],x.vecToidx[X[1]],x.vecToidx[X[2]]])}}mapOBOAtoDATA(I,x){const L=x.IDATA.edgematch[I][0];for(let F=0;F<x.isoVecsOBOA.length;F++){const X=[];for(let G=0;G<3;G++)1===x.vertexTypes[F][G]?X.push(I+"|"+x.isoVecsOBOA[F][G].x+"|"+x.isoVecsOBOA[F][G].y):X.push(L+"|"+x.isoVecsOBOA[F][G].x+"|"+x.isoVecsOBOA[F][G].y);this.face.push([x.vecToidx[X[0]],x.vecToidx[X[1]],x.vecToidx[X[2]]])}}mapBAOAtoDATA(I,x){const L=x.IDATA.edgematch[I][2];for(let F=0;F<x.isoVecsBAOA.length;F++){const X=[];for(let G=0;G<3;G++)1===x.vertexTypes[F][G]?X.push(I+"|"+x.isoVecsBAOA[F][G].x+"|"+x.isoVecsBAOA[F][G].y):X.push(L+"|"+x.isoVecsBAOA[F][G].x+"|"+x.isoVecsBAOA[F][G].y);this.face.push([x.vecToidx[X[0]],x.vecToidx[X[1]],x.vecToidx[X[2]]])}}orderData(I){const x=[];for(let G=0;G<13;G++)x[G]=[];const L=I.closestTo;for(let G=0;G<L.length;G++)L[G][0]>-1?L[G][1]>0&&x[L[G][0]].push([G,L[G][1]]):x[12].push([G,L[G][0]]);const F=[];for(let G=0;G<12;G++)F[G]=G;let X=12;for(let G=0;G<12;G++){x[G].sort(((I,x)=>I[1]-x[1]));for(let I=0;I<x[G].length;I++)F[x[G][I][0]]=X++}for(let G=0;G<x[12].length;G++)F[x[12][G][0]]=X++;for(let G=0;G<this.vertex.length;G++)this.vertex[G].push(F[G]);this.vertex.sort(((I,x)=>I[3]-x[3]));for(let G=0;G<this.vertex.length;G++)this.vertex[G].pop();for(let G=0;G<this.face.length;G++)for(let I=0;I<this.face[G].length;I++)this.face[G][I]=F[this.face[G][I]];this.sharedNodes=x[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(I,x){const L=[],F=[];let X=x.pop();F.push(X);let G=this.face[X].indexOf(I);G=(G+2)%3;let Y=this.face[X][G];L.push(Y);let p=0;for(;x.length>0;)X=x[p],this.face[X].indexOf(Y)>-1?(G=(this.face[X].indexOf(Y)+1)%3,Y=this.face[X][G],L.push(Y),F.push(X),x.splice(p,1),p=0):p++;return this.adjacentFaces.push(L),F}toGoldbergPolyhedronData(){const I=new FI("GeoDual","Goldberg",[],[]);I.name="GD dual";const x=this.vertex.length,L=new Array(x);for(let B=0;B<x;B++)L[B]=[];for(let B=0;B<this.face.length;B++)for(let I=0;I<3;I++)L[this.face[B][I]].push(B);let F=0,X=0,G=0,Y=[],p=[];this.adjacentFaces=[];for(let B=0;B<L.length;B++){I.face[B]=this.setOrder(B,L[B].concat([]));for(const x of L[B]){F=0,X=0,G=0,Y=this.face[x];for(let I=0;I<3;I++)p=this.vertex[Y[I]],F+=p[0],X+=p[1],G+=p[2];I.vertex[x]=[F/3,X/3,G/3]}}return I}static BuildGeodesicData(I){const x=new XI("Geodesic-m-n","Geodesic",[[0,II.h,-1],[-II.h,1,0],[-1,0,-II.h],[1,0,-II.h],[II.h,1,0],[0,II.h,1],[-1,0,II.h],[-II.h,-1,0],[0,-II.h,-1],[II.h,-1,0],[1,0,II.h],[0,-II.h,1]],[]);I.setIndices(),I.calcCoeffs(),I.createInnerFacets(),I.edgeVecsABOB(),I.mapABOBtoOBOA(),I.mapABOBtoBAOA();for(let L=0;L<I.IDATA.face.length;L++)I.MapToFace(L,x),x.innerToData(L,I),"B"===I.IDATA.edgematch[L][1]&&x.mapABOBtoDATA(L,I),"O"===I.IDATA.edgematch[L][1]&&x.mapOBOAtoDATA(L,I),"A"===I.IDATA.edgematch[L][3]&&x.mapBAOAtoDATA(L,I);x.orderData(I);return x.vertex=x.vertex.map((function(I){const x=I[0],L=I[1],F=I[2],X=Math.sqrt(x*x+L*L+F*F);return I[0]*=1/X,I[1]*=1/X,I[2]*=1/X,I})),x}}X.e._GoldbergMeshParser=(I,x)=>GI.Parse(I,x);class GI extends X.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(I,x){return void 0===x?(I>this.goldbergData.nbUnsharedFaces-1&&(b.c.Warn("Maximum number of unshared faces used"),I=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+I):(I>11&&(b.c.Warn("Last pole used"),I=11),x>this.goldbergData.nbFacesAtPole-1&&(b.c.Warn("Maximum number of faces at a pole used"),x=this.goldbergData.nbFacesAtPole-1),12+I*this.goldbergData.nbFacesAtPole+x)}_changeGoldbergFaceColors(I){for(let L=0;L<I.length;L++){const x=I[L][0],F=I[L][1],X=I[L][2];for(let I=x;I<F+1;I++)this.goldbergData.faceColors[I]=X}const x=[];for(let L=0;L<12;L++)for(let I=0;I<5;I++)x.push(this.goldbergData.faceColors[L].r,this.goldbergData.faceColors[L].g,this.goldbergData.faceColors[L].b,this.goldbergData.faceColors[L].a);for(let L=12;L<this.goldbergData.faceColors.length;L++)for(let I=0;I<6;I++)x.push(this.goldbergData.faceColors[L].r,this.goldbergData.faceColors[L].g,this.goldbergData.faceColors[L].b,this.goldbergData.faceColors[L].a);return x}setGoldbergFaceColors(I){const x=this._changeGoldbergFaceColors(I);this.wI(G.g.ColorKind,x)}updateGoldbergFaceColors(I){const x=this._changeGoldbergFaceColors(I);this.updateVerticesData(G.g.ColorKind,x)}_changeGoldbergFaceUVs(I){const x=this.getVerticesData(G.g.UVKind);for(let L=0;L<I.length;L++){const F=I[L][0],X=I[L][1],G=I[L][2],Y=I[L][3],p=I[L][4],B=[],l=[];let W,Q;for(let I=0;I<5;I++)W=G.x+Y*Math.cos(p+I*Math.PI/2.5),Q=G.y+Y*Math.sin(p+I*Math.PI/2.5),W<0&&(W=0),W>1&&(W=1),B.push(W,Q);for(let I=0;I<6;I++)W=G.x+Y*Math.cos(p+I*Math.PI/3),Q=G.y+Y*Math.sin(p+I*Math.PI/3),W<0&&(W=0),W>1&&(W=1),l.push(W,Q);for(let I=F;I<Math.min(12,X+1);I++)for(let L=0;L<5;L++)x[10*I+2*L]=B[2*L],x[10*I+2*L+1]=B[2*L+1];for(let I=Math.max(12,F);I<X+1;I++)for(let L=0;L<6;L++)x[12*I-24+2*L]=l[2*L],x[12*I-23+2*L]=l[2*L+1]}return x}setGoldbergFaceUVs(I){const x=this._changeGoldbergFaceUVs(I);this.wI(G.g.UVKind,x)}updateGoldbergFaceUVs(I){const x=this._changeGoldbergFaceUVs(I);this.updateVerticesData(G.g.UVKind,x)}placeOnGoldbergFaceAt(I,x,L){const X=F.sx.RotationFromAxis(this.goldbergData.faceXaxis[x],this.goldbergData.faceYaxis[x],this.goldbergData.faceZaxis[x]);I.rotation=X,I.position=this.goldbergData.faceCenters[x].add(this.goldbergData.faceXaxis[x].scale(L.x)).add(this.goldbergData.faceYaxis[x].scale(L.y)).add(this.goldbergData.faceZaxis[x].scale(L.z))}serialize(I){super.serialize(I),I.type="GoldbergMesh";const x={};if(x.adjacentFaces=this.goldbergData.adjacentFaces,x.nbSharedFaces=this.goldbergData.nbSharedFaces,x.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,x.nbFaces=this.goldbergData.nbFaces,x.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){x.faceColors=[];for(const I of this.goldbergData.faceColors)x.faceColors.push(I.Cp())}if(this.goldbergData.faceCenters){x.faceCenters=[];for(const I of this.goldbergData.faceCenters)x.faceCenters.push(I.Cp())}if(this.goldbergData.faceZaxis){x.faceZaxis=[];for(const I of this.goldbergData.faceZaxis)x.faceZaxis.push(I.Cp())}if(this.goldbergData.faceYaxis){x.faceYaxis=[];for(const I of this.goldbergData.faceYaxis)x.faceYaxis.push(I.Cp())}if(this.goldbergData.faceXaxis){x.faceXaxis=[];for(const I of this.goldbergData.faceXaxis)x.faceXaxis.push(I.Cp())}I.goldbergData=x}static Parse(I,x){const L=I.goldbergData;L.faceColors=L.faceColors.map((I=>e.lB.tx(I))),L.faceCenters=L.faceCenters.map((I=>F.sx.tx(I))),L.faceZaxis=L.faceZaxis.map((I=>F.sx.tx(I))),L.faceXaxis=L.faceXaxis.map((I=>F.sx.tx(I))),L.faceYaxis=L.faceYaxis.map((I=>F.sx.tx(I)));const X=new GI(I.name,x);return X.goldbergData=L,X}}var YI=L(13517);const pI={CreateBox:Q.b,CreateTiledBox:H,CreateSphere:s.d,CreateDisc:W.d,CreateIcoSphere:r,CreateRibbon:l,CreateCylinder:T,CreateTorus:t,CreateTorusKnot:R,CreateLineSystem:n.d,FW:n.f,CreateDashedLines:n.b,ExtrudeShape:M,ExtrudeShapeCustom:K,CreateLathe:A,CreateTiledPlane:v,YW:mI.d,CreateGround:O.d,CreateTiledGround:O.g,CreateGroundFromHeightMap:O.b,CreatePolygon:P.d,ExtrudePolygon:P.e,CreateTube:w,CreatePolyhedron:a,CreateGeodesic:function(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=x.m||1;F!==Math.floor(F)&&(F=Math.floor(F),b.c.Warn("m not an integer only floor(m) used"));let X=x.n||0;if(X!==Math.floor(X)&&(X=Math.floor(X),b.c.Warn("n not an integer only floor(n) used")),X>F){const I=X;X=F,F=I,b.c.Warn("n > m therefore m and n swapped")}const G=new LI;return G.build(F,X),a(I,{custom:XI.BuildGeodesicData(G),size:x.size,sizeX:x.sizeX,sizeY:x.sizeY,sizeZ:x.sizeZ,faceUV:x.faceUV,faceColors:x.faceColors,flat:x.flat,updatable:x.updatable,sideOrientation:x.sideOrientation,frontUVs:x.frontUVs,backUVs:x.backUVs},L)},CreateGoldberg:function(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=x.size,B=x.sizeX||G||1,l=x.sizeY||G||1,W=x.sizeZ||G||1;let Q=x.m||1;Q!==Math.floor(Q)&&(Q=Math.floor(Q),b.c.Warn("m not an integer only floor(m) used"));let g=x.n||0;if(g!==Math.floor(g)&&(g=Math.floor(g),b.c.Warn("n not an integer only floor(n) used")),g>Q){const I=g;g=Q,Q=I,b.c.Warn("n > m therefore m and n swapped")}const v=new LI;v.build(Q,g);const z=XI.BuildGeodesicData(v),H=z.toGoldbergPolyhedronData(),s=new GI(I,L);x.sideOrientation=X.e._GetDefaultSideOrientation(x.sideOrientation),s._originalBuilderSideOrientation=x.sideOrientation;(function(I,x){const L=I.size,X=I.sizeX||L||1,G=I.sizeY||L||1,B=I.sizeZ||L||1,l=0===I.sideOrientation?0:I.sideOrientation||Y.d.DEFAULTSIDE,W=[],Q=[],e=[],g=[];let v=1/0,z=-1/0,H=1/0,s=-1/0;for(let F=0;F<x.vertex.length;F++)v=Math.min(v,x.vertex[F][0]*X),z=Math.max(z,x.vertex[F][0]*X),H=Math.min(H,x.vertex[F][1]*G),s=Math.max(s,x.vertex[F][1]*G);let U=0;for(let Y=0;Y<x.face.length;Y++){const I=x.face[Y],L=F.sx.tx(x.vertex[I[0]]),l=F.sx.tx(x.vertex[I[2]]),q=F.sx.tx(x.vertex[I[1]]),y=l.Ux(L),T=q.Ux(L),Z=F.sx.Cross(T,y).normalize();for(let F=0;F<I.length;F++){e.push(Z.x,Z.y,Z.z);const L=x.vertex[I[F]];W.push(L[0]*X,L[1]*G,L[2]*B);const Y=(L[1]*G-H)/(s-H);g.push((L[0]*X-v)/(z-v),p.e?1-Y:Y)}for(let x=0;x<I.length-2;x++)Q.push(U,U+x+2,U+x+1);U+=I.length}Y.d._ComputeSides(l,W,Q,e,g);const q=new Y.d;return q.RI=W,q.indices=Q,q.nI=e,q.MI=g,q})(x,H).uI(s,x.updatable),s.goldbergData.nbSharedFaces=z.sharedNodes,s.goldbergData.nbUnsharedFaces=z.poleNodes,s.goldbergData.adjacentFaces=z.adjacentFaces,s.goldbergData.nbFaces=s.goldbergData.nbSharedFaces+s.goldbergData.nbUnsharedFaces,s.goldbergData.nbFacesAtPole=(s.goldbergData.nbUnsharedFaces-12)/12;for(let X=0;X<z.vertex.length;X++)s.goldbergData.faceCenters.push(F.sx.tx(z.vertex[X])),s.goldbergData.faceCenters[X].x*=B,s.goldbergData.faceCenters[X].y*=l,s.goldbergData.faceCenters[X].z*=W,s.goldbergData.faceColors.push(new e.lB(1,1,1,1));for(let X=0;X<H.face.length;X++){const I=H.face[X],x=F.sx.tx(H.vertex[I[0]]),L=F.sx.tx(H.vertex[I[2]]),G=F.sx.tx(H.vertex[I[1]]),Y=L.Ux(x),p=G.Ux(x),B=F.sx.Cross(p,Y).normalize(),l=F.sx.Cross(p,B).normalize();s.goldbergData.faceXaxis.push(p.normalize()),s.goldbergData.faceYaxis.push(B),s.goldbergData.faceZaxis.push(l)}return s},CreateDecal:V,CreateCapsule:C,CreateText:YI.h}},14102:(I,x,L)=>{"use strict";L.d(x,{b:()=>px});var F=L(12983),X=L(13365);class G extends X.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var Y=L(13020),p=(L(13152),L(12938));class B{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(I){this._targetStopDuration!==I&&(this._targetStopDuration=I)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(I){this._noiseTexture!==I&&(this._noiseTexture=I,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(I){this._animationSheetEnabled!==I&&(this._animationSheetEnabled=I)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(I){this._isAnimationSheetEnabled!=I&&(this._isAnimationSheetEnabled=I,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(I){this._useLogarithmicDepth=I&&this.tI().getEngine().getCaps().fragmentDepthSupported}tI(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(I){switch(I){case B.BLENDMODE_MULTIPLYADD:return;case B.BLENDMODE_ADD:I=1;break;case B.BLENDMODE_ONEONE:I=6;break;case B.BLENDMODE_STANDARD:I=2;break;case B.BLENDMODE_MULTIPLY:I=4;break;case B.BLENDMODE_SUBTRACT:I=3}this._engine.setAlphaMode(I)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:F.sx.Zero()}set direction1(I){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=I)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:F.sx.Zero()}set direction2(I){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=I)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:F.sx.Zero()}set minEmitBox(I){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=I)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:F.sx.Zero()}set maxEmitBox(I){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=I)}get billboardMode(){return this._billboardMode}set billboardMode(I){this._billboardMode!==I&&(this._billboardMode=I,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(I){this._isBillboardBased!==I&&(this._isBillboardBased=I,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(I){this._attachImageProcessingConfiguration(I)}_attachImageProcessingConfiguration(I){I!==this._imageProcessingConfiguration&&(!I&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=I)}_reset(){}_removeGradientAndTexture(I,x,L){if(!x)return this;let F=0;for(const X of x){if(X.gradient===I){x.splice(F,1);break}F++}return L&&L.dispose(),this}constructor(I){this.animations=[],this.renderingGroupId=0,this.Xx=F.sx.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new F.sx(10,10,10),this.onAnimationEnd=null,this.blendMode=B.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new F.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.IW=new F.sx(0,0,0),this._useLogarithmicDepth=!1,this.gravity=F.sx.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Y.lB(1,1,1,1),this.color2=new Y.lB(1,1,1,1),this.colorDead=new Y.lB(0,0,0,1),this.textureMask=new Y.lB(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new G,this.id=I,this.name=I}createPointEmitter(I,x){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new F.sx(0,1,0),arguments.length>2&&void 0!==arguments[2]||new F.sx(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new F.sx(0,1,0),arguments.length>4&&void 0!==arguments[4]||new F.sx(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new F.sx(0,1,0),arguments.length>3&&void 0!==arguments[3]||new F.sx(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(I,x,L,F){throw new Error("Method not implemented.")}}B.BLENDMODE_ONEONE=0,B.BLENDMODE_STANDARD=1,B.BLENDMODE_ADD=2,B.BLENDMODE_MULTIPLY=3,B.BLENDMODE_MULTIPLYADD=4,B.BLENDMODE_SUBTRACT=-1,(0,p.d)("BABYLON.BaseParticleSystem",B);var l=L(13001),W=L(12818);class Q{constructor(){this.direction1=new F.sx(0,1,0),this.direction2=new F.sx(0,1,0),this.minEmitBox=new F.sx(-.5,-.5,-.5),this.maxEmitBox=new F.sx(.5,.5,.5)}startDirectionFunction(I,x,L,X){const G=(0,l.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,l.RandomRange)(this.direction1.y,this.direction2.y),p=(0,l.RandomRange)(this.direction1.z,this.direction2.z);if(X)return x.x=G,x.y=Y,void(x.z=p);F.sx.TransformNormalFromFloatsToRef(G,Y,p,I,x)}startPositionFunction(I,x,L,X){const G=(0,l.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),Y=(0,l.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),p=(0,l.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(X)return x.x=G,x.y=Y,void(x.z=p);F.sx.TransformCoordinatesFromFloatsToRef(G,Y,p,I,x)}clone(){const I=new Q;return W.b.DeepCopy(this,I),I}applyToShader(I){I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2),I.setVector3("minEmitBox",this.minEmitBox),I.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(I){I.addUniform("direction1",3),I.addUniform("direction2",3),I.addUniform("minEmitBox",3),I.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.direction1=this.direction1.Cp(),I.direction2=this.direction2.Cp(),I.minEmitBox=this.minEmitBox.Cp(),I.maxEmitBox=this.maxEmitBox.Cp(),I}parse(I){F.sx.FromArrayToRef(I.direction1,0,this.direction1),F.sx.FromArrayToRef(I.direction2,0,this.direction2),F.sx.FromArrayToRef(I.minEmitBox,0,this.minEmitBox),F.sx.FromArrayToRef(I.maxEmitBox,0,this.maxEmitBox)}}class e{get radius(){return this._radius}set radius(I){this._radius=I,this._buildHeight()}get angle(){return this._angle}set angle(I){this._angle=I,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=L,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=x,this.radius=I}startDirectionFunction(I,x,L,X){X?F.TmpVectors.sx[0].X(L.uB).normalize():L.position.subtractToRef(I.getTranslation(),F.TmpVectors.sx[0]).normalize();const G=(0,l.RandomRange)(0,this.directionRandomizer),Y=(0,l.RandomRange)(0,this.directionRandomizer),p=(0,l.RandomRange)(0,this.directionRandomizer);x.x=F.TmpVectors.sx[0].x+G,x.y=F.TmpVectors.sx[0].y+Y,x.z=F.TmpVectors.sx[0].z+p,x.normalize()}startPositionFunction(I,x,L,X){const G=(0,l.RandomRange)(0,2*Math.PI);let Y;this.emitFromSpawnPointOnly?Y=1e-4:(Y=(0,l.RandomRange)(0,this.heightRange),Y=1-Y*Y);let p=this._radius-(0,l.RandomRange)(0,this._radius*this.radiusRange);p*=Y;const B=p*Math.sin(G),W=p*Math.cos(G),Q=Y*this._height;if(X)return x.x=B,x.y=Q,void(x.z=W);F.sx.TransformCoordinatesFromFloatsToRef(B,Q,W,I,x)}clone(){const I=new e(this._radius,this._angle,this.directionRandomizer);return W.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat2("radius",this._radius,this.radiusRange),I.setFloat("coneAngle",this._angle),I.setFloat2("height",this._height,this.heightRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",2),I.addUniform("coneAngle",1),I.addUniform("height",2),I.addUniform("directionRandomizer",1)}getEffectDefines(){let I="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(I+="\n#define CONEEMITTERSPAWNPOINT"),I}getClassName(){return"ConeParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this._radius,I.angle=this._angle,I.directionRandomizer=this.directionRandomizer,I.radiusRange=this.radiusRange,I.heightRange=this.heightRange,I.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,I}parse(I){this.radius=I.radius,this.angle=I.angle,this.directionRandomizer=I.directionRandomizer,this.radiusRange=void 0!==I.radiusRange?I.radiusRange:1,this.heightRange=void 0!==I.radiusRange?I.heightRange:1,this.emitFromSpawnPointOnly=void 0!==I.emitFromSpawnPointOnly&&I.emitFromSpawnPointOnly}}class g extends e{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.sx(0,1,0),X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.sx(0,1,0);super(I,x),this.direction1=L,this.direction2=X}startDirectionFunction(I,x){const L=(0,l.RandomRange)(this.direction1.x,this.direction2.x),X=(0,l.RandomRange)(this.direction1.y,this.direction2.y),G=(0,l.RandomRange)(this.direction1.z,this.direction2.z);F.sx.TransformNormalFromFloatsToRef(L,X,G,I,x)}clone(){const I=new g(this.radius,this.angle,this.direction1,this.direction2);return W.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const I=super.serialize();return I.direction1=this.direction1.Cp(),I.direction2=this.direction2.Cp(),I}parse(I){super.parse(I),this.direction1.X(I.direction1),this.direction2.X(I.direction2)}}class v{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=I,this.height=x,this.radiusRange=L,this.directionRandomizer=X,this._tempVector=F.sx.Zero()}startDirectionFunction(I,x,L,X,G){L.position.subtractToRef(I.getTranslation(),this._tempVector),this._tempVector.normalize(),F.sx.TransformNormalToRef(this._tempVector,G,this._tempVector);const Y=(0,l.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let p=Math.atan2(this._tempVector.x,this._tempVector.z);p+=(0,l.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=Y,this._tempVector.x=Math.sin(p),this._tempVector.z=Math.cos(p),this._tempVector.normalize(),X?x.X(this._tempVector):F.sx.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,I,x)}startPositionFunction(I,x,L,X){const G=(0,l.RandomRange)(-this.height/2,this.height/2),Y=(0,l.RandomRange)(0,2*Math.PI),p=(0,l.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),B=Math.sqrt(p)*this.radius,W=B*Math.cos(Y),Q=B*Math.sin(Y);X?x.YB(W,G,Q):F.sx.TransformCoordinatesFromFloatsToRef(W,G,Q,I,x)}clone(){const I=new v(this.radius,this.directionRandomizer);return W.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("height",this.height),I.setFloat("radiusRange",this.radiusRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("height",1),I.addUniform("radiusRange",1),I.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this.radius,I.height=this.height,I.radiusRange=this.radiusRange,I.directionRandomizer=this.directionRandomizer,I}parse(I){this.radius=I.radius,this.height=I.height,this.radiusRange=I.radiusRange,this.directionRandomizer=I.directionRandomizer}}class z extends v{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.sx(0,1,0),G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new F.sx(0,1,0);super(I,x,L),this.direction1=X,this.direction2=G}startDirectionFunction(I,x,L,X){const G=(0,l.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,l.RandomRange)(this.direction1.y,this.direction2.y),p=(0,l.RandomRange)(this.direction1.z,this.direction2.z);X?x.YB(G,Y,p):F.sx.TransformNormalFromFloatsToRef(G,Y,p,I,x)}clone(){const I=new z(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return W.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("height",this.height),I.setFloat("radiusRange",this.radiusRange),I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("height",1),I.addUniform("radiusRange",1),I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const I=super.serialize();return I.direction1=this.direction1.Cp(),I.direction2=this.direction2.Cp(),I}parse(I){super.parse(I),F.sx.FromArrayToRef(I.direction1,0,this.direction1),F.sx.FromArrayToRef(I.direction2,0,this.direction2)}}class H{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=I,this.radiusRange=x,this.directionRandomizer=L}startDirectionFunction(I,x,L,X){const G=L.position.Ux(I.getTranslation()).normalize(),Y=(0,l.RandomRange)(0,this.directionRandomizer),p=(0,l.RandomRange)(0,this.directionRandomizer),B=(0,l.RandomRange)(0,this.directionRandomizer);G.x+=Y,G.y+=p,G.z+=B,G.normalize(),X?x.X(G):F.sx.TransformNormalFromFloatsToRef(G.x,G.y,G.z,I,x)}startPositionFunction(I,x,L,X){const G=this.radius-(0,l.RandomRange)(0,this.radius*this.radiusRange),Y=(0,l.RandomRange)(0,1),p=(0,l.RandomRange)(0,2*Math.PI),B=Math.acos(2*Y-1),W=G*Math.cos(p)*Math.sin(B),Q=G*Math.cos(B),e=G*Math.sin(p)*Math.sin(B);X?x.YB(W,Math.abs(Q),e):F.sx.TransformCoordinatesFromFloatsToRef(W,Math.abs(Q),e,I,x)}clone(){const I=new H(this.radius,this.directionRandomizer);return W.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this.radius,I.radiusRange=this.radiusRange,I.directionRandomizer=this.directionRandomizer,I}parse(I){this.radius=I.radius,this.radiusRange=I.radiusRange,this.directionRandomizer=I.directionRandomizer}}class s{constructor(){this.direction1=new F.sx(0,1,0),this.direction2=new F.sx(0,1,0)}startDirectionFunction(I,x,L,X){const G=(0,l.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,l.RandomRange)(this.direction1.y,this.direction2.y),p=(0,l.RandomRange)(this.direction1.z,this.direction2.z);X?x.YB(G,Y,p):F.sx.TransformNormalFromFloatsToRef(G,Y,p,I,x)}startPositionFunction(I,x,L,X){X?x.YB(0,0,0):F.sx.TransformCoordinatesFromFloatsToRef(0,0,0,I,x)}clone(){const I=new s;return W.b.DeepCopy(this,I),I}applyToShader(I){I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.direction1=this.direction1.Cp(),I.direction2=this.direction2.Cp(),I}parse(I){F.sx.FromArrayToRef(I.direction1,0,this.direction1),F.sx.FromArrayToRef(I.direction2,0,this.direction2)}}class U{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=I,this.radiusRange=x,this.directionRandomizer=L}startDirectionFunction(I,x,L,X){const G=L.position.Ux(I.getTranslation()).normalize(),Y=(0,l.RandomRange)(0,this.directionRandomizer),p=(0,l.RandomRange)(0,this.directionRandomizer),B=(0,l.RandomRange)(0,this.directionRandomizer);G.x+=Y,G.y+=p,G.z+=B,G.normalize(),X?x.X(G):F.sx.TransformNormalFromFloatsToRef(G.x,G.y,G.z,I,x)}startPositionFunction(I,x,L,X){const G=this.radius-(0,l.RandomRange)(0,this.radius*this.radiusRange),Y=(0,l.RandomRange)(0,1),p=(0,l.RandomRange)(0,2*Math.PI),B=Math.acos(2*Y-1),W=G*Math.cos(p)*Math.sin(B),Q=G*Math.cos(B),e=G*Math.sin(p)*Math.sin(B);X?x.YB(W,Q,e):F.sx.TransformCoordinatesFromFloatsToRef(W,Q,e,I,x)}clone(){const I=new U(this.radius,this.directionRandomizer);return W.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this.radius,I.radiusRange=this.radiusRange,I.directionRandomizer=this.directionRandomizer,I}parse(I){this.radius=I.radius,this.radiusRange=I.radiusRange,this.directionRandomizer=I.directionRandomizer}}class q extends U{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new F.sx(0,1,0),L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.sx(0,1,0);super(I),this.direction1=x,this.direction2=L}startDirectionFunction(I,x){const L=(0,l.RandomRange)(this.direction1.x,this.direction2.x),X=(0,l.RandomRange)(this.direction1.y,this.direction2.y),G=(0,l.RandomRange)(this.direction1.z,this.direction2.z);F.sx.TransformNormalFromFloatsToRef(L,X,G,I,x)}clone(){const I=new q(this.radius,this.direction1,this.direction2);return W.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const I=super.serialize();return I.direction1=this.direction1.Cp(),I.direction2=this.direction2.Cp(),I}parse(I){super.parse(I),this.direction1.X(I.direction1),this.direction2.X(I.direction2)}}class y{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(I,x,L,X){const G=F.TmpVectors.sx[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,L,G);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,L,G);const I=F.TmpVectors.sx[1];G.subtractToRef(L.position,I),I.scaleToRef(1/L.lifeTime,G)}else G.set(0,0,0);X?x.X(G):F.sx.TransformNormalToRef(G,I,x)}startPositionFunction(I,x,L,X){const G=F.TmpVectors.sx[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,L,G):G.set(0,0,0),X?x.X(G):F.sx.TransformCoordinatesToRef(G,I,x)}clone(){const I=new y;return W.b.DeepCopy(this,I),I}applyToShader(I){}buildUniformLayout(I){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.particlePositionGenerator=this.particlePositionGenerator,I.particleDestinationGenerator=this.particleDestinationGenerator,I}parse(I){I.particlePositionGenerator&&(this.particlePositionGenerator=I.particlePositionGenerator),I.particleDestinationGenerator&&(this.particleDestinationGenerator=I.particleDestinationGenerator)}}var T=L(13048);class Z{get mesh(){return this._mesh}set mesh(I){this._mesh!==I&&(this._mesh=I,I?(this._indices=I.XB(),this._positions=I.getVerticesData(T.g.PositionKind),this._normals=I.getVerticesData(T.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=F.sx.Zero(),this._mesh=null,this.direction1=new F.sx(0,1,0),this.direction2=new F.sx(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=I}startDirectionFunction(I,x,L,X){if(this.useMeshNormalsForDirection&&this._normals)return void F.sx.TransformNormalToRef(this._storedNormal,I,x);const G=(0,l.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,l.RandomRange)(this.direction1.y,this.direction2.y),p=(0,l.RandomRange)(this.direction1.z,this.direction2.z);X?x.YB(G,Y,p):F.sx.TransformNormalFromFloatsToRef(G,Y,p,I,x)}startPositionFunction(I,x,L,X){if(!this._indices||!this._positions)return;const G=3*(Math.random()*(this._indices.length/3)|0),Y=Math.random(),p=Math.random()*(1-Y),B=1-Y-p,l=this._indices[G],W=this._indices[G+1],Q=this._indices[G+2],e=F.TmpVectors.sx[0],g=F.TmpVectors.sx[1],v=F.TmpVectors.sx[2],z=F.TmpVectors.sx[3];F.sx.FromArrayToRef(this._positions,3*l,e),F.sx.FromArrayToRef(this._positions,3*W,g),F.sx.FromArrayToRef(this._positions,3*Q,v),z.x=Y*e.x+p*g.x+B*v.x,z.y=Y*e.y+p*g.y+B*v.y,z.z=Y*e.z+p*g.z+B*v.z,X?x.YB(z.x,z.y,z.z):F.sx.TransformCoordinatesFromFloatsToRef(z.x,z.y,z.z,I,x),this.useMeshNormalsForDirection&&this._normals&&(F.sx.FromArrayToRef(this._normals,3*l,e),F.sx.FromArrayToRef(this._normals,3*W,g),F.sx.FromArrayToRef(this._normals,3*Q,v),this._storedNormal.x=Y*e.x+p*g.x+B*v.x,this._storedNormal.y=Y*e.y+p*g.y+B*v.y,this._storedNormal.z=Y*e.z+p*g.z+B*v.z)}clone(){const I=new Z(this.mesh);return W.b.DeepCopy(this,I),I}applyToShader(I){I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var I;const x={};return x.type=this.getClassName(),x.direction1=this.direction1.Cp(),x.direction2=this.direction2.Cp(),x.meshId=null===(I=this.mesh)||void 0===I?void 0:I.id,x.useMeshNormalsForDirection=this.useMeshNormalsForDirection,x}parse(I,x){F.sx.FromArrayToRef(I.direction1,0,this.direction1),F.sx.FromArrayToRef(I.direction2,0,this.direction2),I.meshId&&x&&(this.mesh=x.getLastMeshById(I.meshId)),this.useMeshNormalsForDirection=I.useMeshNormalsForDirection}}class t{_isUbo(I){return void 0!==I.addUniform}constructor(I){this._isUbo(I)?(this.setMatrix3x3=I.updateMatrix3x3.bind(I),this.setMatrix2x2=I.updateMatrix2x2.bind(I),this.setFloat=I.updateFloat.bind(I),this.setFloat2=I.updateFloat2.bind(I),this.setFloat3=I.updateFloat3.bind(I),this.setFloat4=I.updateFloat4.bind(I),this.setFloatArray=I.updateFloatArray.bind(I),this.setArray=I.updateArray.bind(I),this.setIntArray=I.updateIntArray.bind(I),this.setMatrix=I.xB.bind(I),this.setMatrices=I.updateMatrices.bind(I),this.setVector3=I.updateVector3.bind(I),this.setVector4=I.updateVector4.bind(I),this.setColor3=I.updateColor3.bind(I),this.setColor4=I.updateColor4.bind(I),this.setDirectColor4=I.updateDirectColor4.bind(I),this.setInt=I.updateInt.bind(I),this.setInt2=I.updateInt2.bind(I),this.setInt3=I.updateInt3.bind(I),this.setInt4=I.updateInt4.bind(I)):(this.setMatrix3x3=I.setMatrix3x3.bind(I),this.setMatrix2x2=I.setMatrix2x2.bind(I),this.setFloat=I.setFloat.bind(I),this.setFloat2=I.setFloat2.bind(I),this.setFloat3=I.setFloat3.bind(I),this.setFloat4=I.setFloat4.bind(I),this.setFloatArray=I.setFloatArray.bind(I),this.setArray=I.setArray.bind(I),this.setIntArray=I.setIntArray.bind(I),this.setMatrix=I.setMatrix.bind(I),this.setMatrices=I.setMatrices.bind(I),this.setVector3=I.setVector3.bind(I),this.setVector4=I.setVector4.bind(I),this.setColor3=I.setColor3.bind(I),this.setColor4=I.setColor4.bind(I),this.setDirectColor4=I.setDirectColor4.bind(I),this.setInt=I.setInt.bind(I),this.setInt2=I.setInt2.bind(I),this.setInt3=I.setInt3.bind(I),this.setInt4=I.setInt4.bind(I))}}var f=L(12885);const R="gpuUpdateParticlesPixelShader",n="#version 300 es\nvoid main() {discard;}\n";f.d.ShadersStore[R]||(f.d.ShadersStore[R]=n);const P="gpuUpdateParticlesVertexShader",d="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";f.d.ShadersStore[P]||(f.d.ShadersStore[P]=d);(0,p.d)("BABYLON.WebGL2ParticleSystem",class{constructor(I,x){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=I,this._engine=x,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var I;return(null===(I=this._updateEffect)||void 0===I?void 0:I.isReady())??!1}createUpdateBuffer(I){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof y&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=I,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new t(this._updateEffect)}createVertexBuffers(I,x){this._updateVAO.push(this._createUpdateVAO(I)),this._renderVAO.push(this._engine.recordVertexArrayObject(x,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=x}createParticleBuffer(I){return I}bindDrawBuffers(I,x,L){L?this._engine.bindBuffers(this._renderVertexBuffers,L,x):this._engine.bindVertexArrayObject(this._renderVAO[I],null)}preUpdateParticleBuffer(){const I=this._engine;if(this._engine.enableEffect(this._updateEffect),!I.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(I,x,L){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[I],null);const F=this._engine;F.bindTransformFeedbackBuffer(x.getBuffer()),F.setRasterizerState(!1),F.beginTransformFeedback(!0),F.drawArraysType(3,0,L),F.endTransformFeedback(),F.setRasterizerState(!0),F.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let I=0;I<this._updateVAO.length;I++)this._engine.releaseVertexArrayObject(this._updateVAO[I]);this._updateVAO.length=0;for(let I=0;I<this._renderVAO.length;I++)this._engine.releaseVertexArrayObject(this._renderVAO[I]);this._renderVAO.length=0}_createUpdateVAO(I){const x={};x.position=I.createVertexBuffer("position",0,3);let L=3;x.age=I.createVertexBuffer("age",L,1),L+=1,x.size=I.createVertexBuffer("size",L,3),L+=3,x.life=I.createVertexBuffer("life",L,1),L+=1,x.seed=I.createVertexBuffer("seed",L,4),L+=4,x.direction=I.createVertexBuffer("direction",L,3),L+=3,this._parent.particleEmitterType instanceof y&&(x.initialPosition=I.createVertexBuffer("initialPosition",L,3),L+=3),this._parent._colorGradientsTexture||(x.color=I.createVertexBuffer("color",L,4),L+=4),this._parent._isBillboardBased||(x.initialDirection=I.createVertexBuffer("initialDirection",L,3),L+=3),this._parent.noiseTexture&&(x.noiseCoordinates1=I.createVertexBuffer("noiseCoordinates1",L,3),L+=3,x.noiseCoordinates2=I.createVertexBuffer("noiseCoordinates2",L,3),L+=3),this._parent._angularSpeedGradientsTexture?(x.angle=I.createVertexBuffer("angle",L,1),L+=1):(x.angle=I.createVertexBuffer("angle",L,2),L+=2),this._parent._isAnimationSheetEnabled&&(x.cellIndex=I.createVertexBuffer("cellIndex",L,1),L+=1,this._parent.spriteRandomStartCell&&(x.cellStartOffset=I.createVertexBuffer("cellStartOffset",L,1),L+=1));const F=this._engine.recordVertexArrayObject(x,null,this._updateEffect);return this._engine.bindArrayBuffer(null),F}});class M{constructor(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,F=arguments.length>3?arguments[3]:void 0;this._engine=I,this._label=F,this._engine._storageBuffers.push(this),this._create(x,L)}_create(I,x){this._bufferSize=I,this._creationFlags=x,this._buffer=this._engine.createStorageBuffer(I,x,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(I,x,L){this._buffer&&this._engine.updateStorageBuffer(this._buffer,I,x,L)}async read(I,x,L,F){return await this._engine.readFromStorageBuffer(this._buffer,I,x,L,F)}dispose(){const I=this._engine._storageBuffers,x=I.indexOf(this);-1!==x&&(I[x]=I[I.length-1],I.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var K=L(12969),u=L(12971),A=L(13012),mI=L(12965),O=L(13275),w=L(12809),k=L(12916),a=L(13197);class D{constructor(){this._gpuTimeInFrameId=-1,this.counter=new a.c}_addDuration(I,x){I<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==I?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(x,!1),this._gpuTimeInFrameId=I):this.counter.addCount(x,!1))}}var r=L(12865);class N{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(I,x,L){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=I,this._engine=x,this.uniqueId=O.c.UniqueId,x.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new D),this._engine.getCaps().supportComputeShaders?F.bindingsMapping?(this._context=x.createComputeContext(),this._shaderPath=L,this._options={bindingsMapping:{},defines:[],...F}):w.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):w.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(I,x){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const F=this._bindings[I];this._bindings[I]={type:L?0:4,object:x,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!F||F.object!==x||F.type!==this._bindings[I].type)}setStorageTexture(I,x){const L=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==x),this._bindings[I]={type:1,object:x,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}setExternalTexture(I,x){const L=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==x),this._bindings[I]={type:6,object:x,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}setVideoTexture(I,x){return!!x.externalTexture&&(this.setExternalTexture(I,x.externalTexture),!0)}setUniformBuffer(I,x){const L=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==x),this._bindings[I]={type:N._BufferIsDataBuffer(x)?7:2,object:x,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}setStorageBuffer(I,x){const L=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==x),this._bindings[I]={type:N._BufferIsDataBuffer(x)?7:3,object:x,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}setTextureSampler(I,x){const L=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!L||!x.compareSampler(L.object)),this._bindings[I]={type:5,object:x,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}isReady(){let I=this._effect;for(const X in this._bindings){const I=this._bindings[X],x=I.type,L=I.object;switch(x){case 0:case 4:case 1:if(!L.isReady())return!1;break;case 6:if(!L.isReady())return!1;break}}const x=[],L=this._shaderPath;if(this._options.defines)for(let X=0;X<this._options.defines.length;X++)x.push(this._options.defines[X]);const F=x.join("\n");return this._cachedDefines!==F&&(this._cachedDefines=F,I=this._engine.createComputeEffect(L,{defines:F,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=I),!!I.isReady()}dispatch(I,x,L){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,I,x,L,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const L=N._BufferIsDataBuffer(I)?I:I.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,L,x,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const x in this._bindings){const L=this._bindings[x];if(!this._options.bindingsMapping[x])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+x+"'");switch(L.type){case 0:{const F=this._samplers[x],X=L.object;var I;if(!F||!X._texture||!F.compareSampler(X._texture))this._samplers[x]=(new k.c).setParameters(X.wrapU,X.wrapV,X.wrapR,X.anisotropicFilteringLevel,X._texture.samplingMode,null===(I=X._texture)||void 0===I?void 0:I._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const I=L.object;I.getBuffer()!==L.buffer&&(L.buffer=I.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(I,x,L){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((X=>{(0,r.e)((()=>this.dispatch(I,x,L)),X,void 0,F)}))}serialize(){const I=A.c.Serialize(this);I.options=this._options,I.shaderPath=this._shaderPath,I.gg={},I.textures={};for(const x in this._bindings){const L=this._bindings[x],F=L.object;switch(L.type){case 0:case 4:case 1:{const X=F.serialize();X&&(I.textures[x]=X,I.gg[x]={type:L.type});break}}}return I}static Parse(I,x,L){const F=A.c.Parse((()=>new N(I.name,x.getEngine(),I.shaderPath,I.options)),I,x,L);for(const X in I.textures){const G=I.gg[X],Y=mI.d.Parse(I.textures[X],x,L);0===G.type?F.setTexture(X,Y):4===G.type?F.setTexture(X,Y,!1):F.setStorageTexture(X,Y)}return F}static _BufferIsDataBuffer(I){return void 0!==I.underlyingResource}}(0,K.d)([(0,u.K)()],N.prototype,"name",void 0),(0,K.d)([(0,u.K)()],N.prototype,"fastMode",void 0),(0,p.d)("BABYLON.ComputeShader",N);var S=L(13239);const c="gpuUpdateParticlesComputeShader",o="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";f.d.ShadersStoreWGSL[c]||(f.d.ShadersStoreWGSL[c]=o);(0,p.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(I,x){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=I,this._engine=x}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var I;return(null===(I=this._updateComputeShader)||void 0===I?void 0:I.isReady())??!1}createUpdateBuffer(I){var x;const L={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(L.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(L.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(L.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(L.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(L.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(L.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(L.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new N("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:L,defines:I.split("\n")}),null===(x=this._simParamsComputeShader)||void 0===x||x.dispose(),this._simParamsComputeShader=new S.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new t(this._simParamsComputeShader)}createVertexBuffers(I,x){this._renderVertexBuffers.push(x)}createParticleBuffer(I){const x=new M(this._engine,4*I.length,11,"ComputeShaderParticleSystemBuffer");return x.update(I),this._bufferComputeShader.push(x),x.getBuffer()}bindDrawBuffers(I,x,L){this._engine.bindBuffers(this._renderVertexBuffers[I],L,x)}preUpdateParticleBuffer(){}updateParticleBuffer(I,x,L){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[I]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^I]),this._updateComputeShader.dispatch(Math.ceil(L/64))}releaseBuffers(){var I;for(let x=0;x<this._bufferComputeShader.length;++x)this._bufferComputeShader[x].dispose();this._bufferComputeShader.length=0,null===(I=this._simParamsComputeShader)||void 0===I||I.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class J{constructor(I,x,L){this.gradient=I,this.color1=x,this.color2=L}getColorToRef(I){this.color2?Y.lB.LerpToRef(this.color1,this.color2,Math.random(),I):I.X(this.color1)}}class h{constructor(I,x){this.gradient=I,this.color=x}}class E{constructor(I,x,L){this.gradient=I,this.factor1=x,this.factor2=L}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class i{static GetCurrentGradient(I,x,L){if(x[0].gradient>I)return void L(x[0],x[0],1);for(let X=0;X<x.length-1;X++){const F=x[X],G=x[X+1];if(I>=F.gradient&&I<=G.gradient){return void L(F,G,(I-F.gradient)/(G.gradient-F.gradient))}}const F=x.length-1;L(x[F],x[F],1)}}var V=L(12797),j=L(13451),C=L(12840);class b{constructor(I){this.particleSystem=I,this.position=F.sx.Zero(),this.direction=F.sx.Zero(),this.color=new Y.lB(0,0,0,0),this.colorStep=new Y.lB(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new F.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new Y.lB(0,0,0,0),this._currentColor2=new Y.lB(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=b._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let I=this.age,x=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===x?(x=1,I=this._randomCellOffset):I+=this._randomCellOffset);const L=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let F;F=this._initialSpriteCellLoop?(0,l.Clamp)(I*x%this.lifeTime/this.lifeTime):(0,l.Clamp)(I*x/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+F*L|0}_inheritParticleInfoToSubEmitter(I){if(I.particleSystem.Xx.position){const x=I.particleSystem.Xx;if(x.position.X(this.position),I.inheritDirection){const I=F.TmpVectors.sx[0];this.direction.normalizeToRef(I),x.setDirection(I,0,Math.PI/2)}}else{I.particleSystem.Xx.X(this.position)}this.direction.scaleToRef(I.inheritedVelocityAmount/2,F.TmpVectors.sx[0]),I.particleSystem._inheritedVelocityOffset.X(F.TmpVectors.sx[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const I of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(I)}_reset(){this.age=0,this.id=b._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(I){I.position.X(this.position),this._initialDirection?I._initialDirection?I._initialDirection.X(this._initialDirection):I._initialDirection=this._initialDirection.clone():I._initialDirection=null,I.direction.X(this.direction),this.uB&&(I.uB?I.uB.X(this.uB):I.uB=this.uB.clone()),I.color.X(this.color),I.colorStep.X(this.colorStep),I.lifeTime=this.lifeTime,I.age=this.age,I._randomCellOffset=this._randomCellOffset,I.size=this.size,I.scale.X(this.scale),I.angle=this.angle,I.angularSpeed=this.angularSpeed,I.particleSystem=this.particleSystem,I.cellIndex=this.cellIndex,I.id=this.id,I._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(I._currentColorGradient=this._currentColorGradient,I._currentColor1.X(this._currentColor1),I._currentColor2.X(this._currentColor2)),this._currentSizeGradient&&(I._currentSizeGradient=this._currentSizeGradient,I._currentSize1=this._currentSize1,I._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(I._currentAngularSpeedGradient=this._currentAngularSpeedGradient,I._currentAngularSpeed1=this._currentAngularSpeed1,I._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(I._currentVelocityGradient=this._currentVelocityGradient,I._currentVelocity1=this._currentVelocity1,I._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(I._currentLimitVelocityGradient=this._currentLimitVelocityGradient,I._currentLimitVelocity1=this._currentLimitVelocity1,I._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(I._currentDragGradient=this._currentDragGradient,I._currentDrag1=this._currentDrag1,I._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(I._initialStartSpriteCellId=this._initialStartSpriteCellId,I._initialEndSpriteCellId=this._initialEndSpriteCellId,I._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(I.remapData&&this.remapData?I.remapData.X(this.remapData):I.remapData=new F.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(I._randomNoiseCoordinates1?(I._randomNoiseCoordinates1.X(this._randomNoiseCoordinates1),I._randomNoiseCoordinates2.X(this._randomNoiseCoordinates2)):(I._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),I._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}b._Count=0;var II=L(13101),xI=(L(13149),L(13340)),LI=L(13336),FI=L(13232);function XI(I,x){const L=(0,l.RandomRange)(0,1);Y.lB.LerpToRef(x.color1,x.color2,L,I.color),x.colorDead.subtractToRef(I.color,x._colorDiff),x._colorDiff.scaleToRef(1/I.lifeTime,I.colorStep)}function GI(I,x){I._currentColorGradient=x._colorGradients[0],I._currentColorGradient.getColorToRef(I.color),I._currentColor1.X(I.color),x._colorGradients.length>1?x._colorGradients[1].getColorToRef(I._currentColor2):I._currentColor2.X(I.color)}function YI(I,x){const L=x._colorGradients;i.GetCurrentGradient(x._ratio,L,((x,L,F)=>{x!==I._currentColorGradient&&(I._currentColor1.X(I._currentColor2),L.getColorToRef(I._currentColor2),I._currentColorGradient=x),Y.lB.LerpToRef(I._currentColor1,I._currentColor2,F,I.color)}))}function pI(I,x){I.colorStep.scaleToRef(x._scaledUpdateSpeed,x._scaledColorStep),I.color.addInPlace(x._scaledColorStep),I.color.a<0&&(I.color.a=0)}function BI(I,x){i.GetCurrentGradient(x._ratio,x._angularSpeedGradients,((x,L,F)=>{x!==I._currentAngularSpeedGradient&&(I._currentAngularSpeed1=I._currentAngularSpeed2,I._currentAngularSpeed2=L.getFactor(),I._currentAngularSpeedGradient=x),I.angularSpeed=(0,l.Lerp)(I._currentAngularSpeed1,I._currentAngularSpeed2,F)}))}function lI(I,x){I.angle+=I.angularSpeed*x._scaledUpdateSpeed}function WI(I,x){x.particleEmitterType.startDirectionFunction(x._emitterWorldMatrix,I.direction,I,x.isLocal,x._emitterInverseWorldMatrix)}function QI(I,x){x.startDirectionFunction(x._emitterWorldMatrix,I.direction,I,x.isLocal)}function eI(I,x){I._currentVelocityGradient=x._velocityGradients[0],I._currentVelocity1=I._currentVelocityGradient.getFactor(),x._velocityGradients.length>1?I._currentVelocity2=x._velocityGradients[1].getFactor():I._currentVelocity2=I._currentVelocity1}function gI(I,x){I._currentLimitVelocityGradient=x._limitVelocityGradients[0],I._currentLimitVelocity1=I._currentLimitVelocityGradient.getFactor(),x._limitVelocityGradients.length>1?I._currentLimitVelocity2=x._limitVelocityGradients[1].getFactor():I._currentLimitVelocity2=I._currentLimitVelocity1}function vI(I,x){i.GetCurrentGradient(x._ratio,x._velocityGradients,((L,F,X)=>{L!==I._currentVelocityGradient&&(I._currentVelocity1=I._currentVelocity2,I._currentVelocity2=F.getFactor(),I._currentVelocityGradient=L),x._directionScale*=(0,l.Lerp)(I._currentVelocity1,I._currentVelocity2,X)}))}function zI(I,x){i.GetCurrentGradient(x._ratio,x._limitVelocityGradients,((L,F,X)=>{L!==I._currentLimitVelocityGradient&&(I._currentLimitVelocity1=I._currentLimitVelocity2,I._currentLimitVelocity2=F.getFactor(),I._currentLimitVelocityGradient=L);const G=(0,l.Lerp)(I._currentLimitVelocity1,I._currentLimitVelocity2,X);I.direction.length()>G&&I.direction.scaleInPlace(x.limitVelocityDamping)}))}function HI(I,x){I.direction.scaleToRef(x._directionScale,x._scaledDirection)}function sI(I,x){x.particleEmitterType.startPositionFunction(x._emitterWorldMatrix,I.position,I,x.isLocal)}function UI(I,x){x.startPositionFunction(x._emitterWorldMatrix,I.position,I,x.isLocal)}function qI(I,x){I.uB?I.uB.X(I.position):I.uB=I.position.clone(),F.sx.TransformCoordinatesToRef(I.uB,x._emitterWorldMatrix,I.position)}function yI(I,x){x.isLocal&&I.uB?(I.uB.addInPlace(x._scaledDirection),F.sx.TransformCoordinatesToRef(I.uB,x._emitterWorldMatrix,I.position)):I.position.addInPlace(x._scaledDirection)}function TI(I,x){I._currentDragGradient=x._dragGradients[0],I._currentDrag1=I._currentDragGradient.getFactor(),x._dragGradients.length>1?I._currentDrag2=x._dragGradients[1].getFactor():I._currentDrag2=I._currentDrag1}function ZI(I,x){i.GetCurrentGradient(x._ratio,x._dragGradients,((L,F,X)=>{L!==I._currentDragGradient&&(I._currentDrag1=I._currentDrag2,I._currentDrag2=F.getFactor(),I._currentDragGradient=L);const G=(0,l.Lerp)(I._currentDrag1,I._currentDrag2,X);x._scaledDirection.scaleInPlace(1-G)}))}function tI(I,x){I._randomNoiseCoordinates1?(I._randomNoiseCoordinates1.YB(Math.random(),Math.random(),Math.random()),I._randomNoiseCoordinates2.YB(Math.random(),Math.random(),Math.random())):(I._randomNoiseCoordinates1=new F.sx(Math.random(),Math.random(),Math.random()),I._randomNoiseCoordinates2=new F.sx(Math.random(),Math.random(),Math.random()))}function fI(I,x){const L=x._noiseTextureData,X=x._noiseTextureSize;if(L&&X&&I._randomNoiseCoordinates1){const G=x._fetchR(I._randomNoiseCoordinates1.x,I._randomNoiseCoordinates1.y,X.width,X.height,L),Y=x._fetchR(I._randomNoiseCoordinates1.z,I._randomNoiseCoordinates2.x,X.width,X.height,L),p=x._fetchR(I._randomNoiseCoordinates2.y,I._randomNoiseCoordinates2.z,X.width,X.height,L),B=F.TmpVectors.sx[0],l=F.TmpVectors.sx[1];B.YB((2*G-1)*x.noiseStrength.x,(2*Y-1)*x.noiseStrength.y,(2*p-1)*x.noiseStrength.z),B.scaleToRef(x._tempScaledUpdateSpeed,l),I.direction.addInPlace(l)}}function RI(I,x){x.gravity.scaleToRef(x._tempScaledUpdateSpeed,x._scaledGravity),I.direction.addInPlace(x._scaledGravity)}function nI(I,x){I.size=(0,l.RandomRange)(x.minSize,x.maxSize),I.scale.YB((0,l.RandomRange)(x.minScaleX,x.maxScaleX),(0,l.RandomRange)(x.minScaleY,x.maxScaleY))}function PI(I,x){I._currentSizeGradient=x._sizeGradients[0],I._currentSize1=I._currentSizeGradient.getFactor(),I.size=I._currentSize1,x._sizeGradients.length>1?I._currentSize2=x._sizeGradients[1].getFactor():I._currentSize2=I._currentSize1,I.scale.YB((0,l.RandomRange)(x.minScaleX,x.maxScaleX),(0,l.RandomRange)(x.minScaleY,x.maxScaleY))}function dI(I,x){const L=x._actualFrame/x.targetStopDuration;i.GetCurrentGradient(L,x._startSizeGradients,((L,F,X)=>{L!==x._currentStartSizeGradient&&(x._currentStartSize1=x._currentStartSize2,x._currentStartSize2=F.getFactor(),x._currentStartSizeGradient=L);const G=(0,l.Lerp)(x._currentStartSize1,x._currentStartSize2,X);I.scale.scaleInPlace(G)}))}function MI(I,x){i.GetCurrentGradient(x._ratio,x._sizeGradients,((x,L,F)=>{x!==I._currentSizeGradient&&(I._currentSize1=I._currentSize2,I._currentSize2=L.getFactor(),I._currentSizeGradient=x),I.size=(0,l.Lerp)(I._currentSize1,I._currentSize2,F)}))}function KI(I,x){I.remapData=new F.Vector4(0,1,0,1)}function uI(I,x){x._colorRemapGradients&&x._colorRemapGradients.length>0&&i.GetCurrentGradient(x._ratio,x._colorRemapGradients,((x,L,F)=>{const X=(0,l.Lerp)(x.factor1,L.factor1,F),G=(0,l.Lerp)(x.factor2,L.factor2,F);I.remapData.x=X,I.remapData.y=G-X})),x._alphaRemapGradients&&x._alphaRemapGradients.length>0&&i.GetCurrentGradient(x._ratio,x._alphaRemapGradients,((x,L,F)=>{const X=(0,l.Lerp)(x.factor1,L.factor1,F),G=(0,l.Lerp)(x.factor2,L.factor2,F);I.remapData.z=X,I.remapData.w=G-X}))}function AI(I,x){const L=(0,l.Clamp)(x._actualFrame/x.targetStopDuration);i.GetCurrentGradient(L,x._lifeTimeGradients,((x,F)=>{const X=x,G=F,Y=X.getFactor(),p=G.getFactor(),B=(L-X.gradient)/(G.gradient-X.gradient);I.lifeTime=(0,l.Lerp)(Y,p,B)})),x._emitPower=(0,l.RandomRange)(x.minEmitPower,x.maxEmitPower)}function mx(I,x){I.lifeTime=(0,l.RandomRange)(x.minLifeTime,x.maxLifeTime),x._emitPower=(0,l.RandomRange)(x.minEmitPower,x.maxEmitPower)}function OI(I,x){0===x._emitPower?(I._initialDirection?I._initialDirection.X(I.direction):I._initialDirection=I.direction.clone(),I.direction.set(0,0,0)):(I._initialDirection=null,I.direction.scaleInPlace(x._emitPower)),I.direction.addInPlace(x._inheritedVelocityOffset)}function wI(I,x){I.angularSpeed=(0,l.RandomRange)(x.minAngularSpeed,x.maxAngularSpeed),I.angle=(0,l.RandomRange)(x.minInitialRotation,x.maxInitialRotation)}function kI(I,x){I._currentAngularSpeedGradient=x._angularSpeedGradients[0],I.angularSpeed=I._currentAngularSpeedGradient.getFactor(),I._currentAngularSpeed1=I.angularSpeed,x._angularSpeedGradients.length>1?I._currentAngularSpeed2=x._angularSpeedGradients[1].getFactor():I._currentAngularSpeed2=I._currentAngularSpeed1,I.angle=(0,l.RandomRange)(x.minInitialRotation,x.maxInitialRotation)}function aI(I,x){I._initialStartSpriteCellId=x.startSpriteCellID,I._initialEndSpriteCellId=x.endSpriteCellID,I._initialSpriteCellLoop=x.spriteCellLoop}function DI(I,x){I.previousItem=x.previousItem,I.nextItem=x,x.previousItem&&(x.previousItem.nextItem=I),x.previousItem=I}function rI(I,x){I.previousItem=x,I.nextItem=x.nextItem,x.nextItem&&(x.nextItem.previousItem=I),x.nextItem=I}function NI(I,x){let L=x;for(;L.nextItem;)L=L.nextItem;I.previousItem=L,I.nextItem=L.nextItem,L.nextItem=I}function SI(I){I.previousItem&&(I.previousItem.nextItem=I.nextItem),I.nextItem&&(I.nextItem.previousItem=I.previousItem)}class cI extends B{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(I){this._startDirectionFunction!==I&&(this._startDirectionFunction=I,this._directionProcessing.process=I?QI:WI)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(I){this._startPositionFunction!==I&&(this._startPositionFunction=I,this._positionCreation.process=I?UI:sI)}set onDispose(I){this._onDisposeObserver&&this.cp.remove(this._onDisposeObserver),this._onDisposeObserver=this.cp.add(I)}get p(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(I){this._useRampGradients!==I&&(this._useRampGradients=I,this._resetEffect(),I?(this._rampCreation={process:KI,previousItem:null,nextItem:null},rI(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:uI,previousItem:null,nextItem:null},rI(this._remapGradientProcessing,this._gravityProcessing)):(SI(this._rampCreation),SI(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(I){this._isLocal!==I&&(this._isLocal=I,I?(this._isLocalCreation={process:qI,previousItem:null,nextItem:null},rI(this._isLocalCreation,this._positionCreation)):SI(this._isLocalCreation))}get particles(){return this.pg}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(I){this._animationSheetEnabled!==I&&(this._animationSheetEnabled=I,I?(this._sheetCreation={process:aI,previousItem:null,nextItem:null},rI(this._sheetCreation,this._colorCreation)):SI(this._sheetCreation),this._reset())}getActiveCount(){return this.pg.length}getClassName(){return"rl"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var I;let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(I=this._customWrappers[x])||void 0===I?void 0:I.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[I]??this._customWrappers[0]}setCustomEffect(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[x]=new II.d(this._engine),this._customWrappers[x].effect=I,this._customWrappers[x].drawContext&&(this._customWrappers[x].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new V.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(I){if(this.noiseTexture!==I){if(this._noiseTexture=I,!I)return SI(this._noiseCreation),void SI(this._noiseProcessing);this._noiseCreation={process:tI,previousItem:null,nextItem:null},rI(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:fI,previousItem:null,nextItem:null},rI(this._noiseProcessing,this._positionProcessing)}}constructor(I,x,L){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(I),this._emitterInverseWorldMatrix=F.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new F.sx,this.cp=new V.c,this.onStoppedObservable=new V.c,this.onStartedObservable=new V.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.pg=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new Y.lB(0,0,0,0),this._colorDiff=new Y.lB(0,0,0,0),this._scaledDirection=F.sx.Zero(),this._scaledGravity=F.sx.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=I=>{},this.recycleParticle=I=>{const x=this.pg.pop();x!==I&&x.copyTo(I),this._stockParticles.push(x)},this._createParticle=()=>{let I;return 0!==this._stockParticles.length?(I=this._stockParticles.pop(),I._reset()):I=new b(this),this._prepareParticle(I),I},this.paused=!1,this._shadersLoaded=!1,this._capacity=x,this._epsilon=p,L&&"Scene"!==L.getClassName()?(this._engine=L,this.defaultProjectionMatrix=F.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=L||C.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Gg.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:mx,previousItem:null,nextItem:null},this._positionCreation={process:sI,previousItem:null,nextItem:null},rI(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:WI,previousItem:null,nextItem:null},rI(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:OI,previousItem:null,nextItem:null},rI(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:nI,previousItem:null,nextItem:null},rI(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:wI,previousItem:null,nextItem:null},rI(this._angleCreation,this._sizeCreation),this._colorCreation={process:XI,previousItem:null,nextItem:null},rI(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,B||(this._colorProcessing={process:pI,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:lI,previousItem:null,nextItem:null},rI(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:HI,previousItem:null,nextItem:null},rI(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:yI,previousItem:null,nextItem:null},rI(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:RI,previousItem:null,nextItem:null},rI(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=G,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new II.d(this._engine)},this._customWrappers[0].effect=X,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new Q,this.updateFunction=I=>{var x;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(x=this.noiseTexture.getContent())||void 0===x||x.then((I=>{this._noiseTextureData=I})));const L=I===this.pg;for(let F=0;F<I.length;F++){const x=I[F];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const X=x.age;if(x.age+=this._tempScaledUpdateSpeed,x.age>x.lifeTime){const I=x.age-X,L=x.lifeTime-X;this._tempScaledUpdateSpeed=L*this._tempScaledUpdateSpeed/I,x.age=x.lifeTime}this._ratio=x.age/x.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let G=this._updateQueueStart;for(;G;)G.process(x,this),G=G.nextItem;if(this._isAnimationSheetEnabled&&!B&&x.updateCellIndex(),x._inheritParticleInfoToSubEmitters(),x.age>=x.lifeTime){if(this._emitFromParticle(x),x._attachedSubEmitters){for(const I of x._attachedSubEmitters)I.particleSystem.disposeOnStop=!0,I.particleSystem.stop();x._attachedSubEmitters=null}this.recycleParticle(x),L&&F--}else;}}}serialize(I){throw new Error("Method not implemented.")}clone(I,x){throw new Error("Method not implemented.")}_addFactorGradient(I,x,L,F){const X=new E(x,L,F);I.push(X),I.sort(((I,x)=>I.gradient<x.gradient?-1:I.gradient>x.gradient?1:0))}_removeFactorGradient(I,x){if(!I)return;let L=0;for(const F of I){if(F.gradient===x){I.splice(L,1);break}L++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=AI:this._lifeTimeCreation.process=mx}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:dI,previousItem:null,nextItem:null},rI(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(SI(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(I){this.targetStopDuration!==I&&(this._targetStopDuration=I,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(I,x,L){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,I,x,L),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(I){return this._removeFactorGradient(this._lifeTimeGradients,I),this._syncLifeTimeCreation(),this}addSizeGradient(I,x,L){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=PI,this._sizeGradientProcessing={process:MI,previousItem:null,nextItem:null},DI(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,I,x,L),this}removeSizeGradient(I){var x;return this._removeFactorGradient(this._sizeGradients,I),0===(null===(x=this._sizeGradients)||void 0===x?void 0:x.length)&&(SI(this._sizeGradientProcessing),this._sizeCreation.process=nI),this}addColorRemapGradient(I,x,L){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,I,x,L),this}removeColorRemapGradient(I){return this._removeFactorGradient(this._colorRemapGradients,I),this}addAlphaRemapGradient(I,x,L){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,I,x,L),this}removeAlphaRemapGradient(I){return this._removeFactorGradient(this._alphaRemapGradients,I),this}addAngularSpeedGradient(I,x,L){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=kI,this._angularSpeedGradientProcessing={process:BI,previousItem:null,nextItem:null},DI(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,I,x,L),this}removeAngularSpeedGradient(I){var x;return this._removeFactorGradient(this._angularSpeedGradients,I),0===(null===(x=this._angularSpeedGradients)||void 0===x?void 0:x.length)&&(this._angleCreation.process=wI,SI(this._angularSpeedGradientProcessing)),this}addVelocityGradient(I,x,L){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:eI,previousItem:null,nextItem:null},rI(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:vI,previousItem:null,nextItem:null},DI(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,I,x,L),this}removeVelocityGradient(I){var x;return this._removeFactorGradient(this._velocityGradients,I),0===(null===(x=this._velocityGradients)||void 0===x?void 0:x.length)&&(SI(this._velocityCreation),SI(this._velocityGradientProcessing)),this}addLimitVelocityGradient(I,x,L){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:gI,previousItem:null,nextItem:null},rI(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:zI,previousItem:null,nextItem:null},rI(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,I,x,L),this}removeLimitVelocityGradient(I){var x;return this._removeFactorGradient(this._limitVelocityGradients,I),0===(null===(x=this._limitVelocityGradients)||void 0===x?void 0:x.length)&&(SI(this._limitVelocityCreation),SI(this._limitVelocityGradientProcessing)),this}addDragGradient(I,x,L){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:TI,previousItem:null,nextItem:null},DI(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:ZI,previousItem:null,nextItem:null},DI(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,I,x,L),this}removeDragGradient(I){var x;return this._removeFactorGradient(this._dragGradients,I),0===(null===(x=this._dragGradients)||void 0===x?void 0:x.length)&&(SI(this._dragCreation),SI(this._dragGradientProcessing)),this}addEmitRateGradient(I,x,L){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,I,x,L),this}removeEmitRateGradient(I){return this._removeFactorGradient(this._emitRateGradients,I),this}addStartSizeGradient(I,x,L){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,I,x,L),this._syncStartSizeCreation(),this}removeStartSizeGradient(I){return this._removeFactorGradient(this._startSizeGradients,I),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const I=new Uint8Array(4*this._rawTextureWidth),x=Y.TmpColors.Tx[0];for(let L=0;L<this._rawTextureWidth;L++){const F=L/this._rawTextureWidth;i.GetCurrentGradient(F,this._rampGradients,((F,X,G)=>{Y.Tx.LerpToRef(F.color,X.color,G,x),I[4*L]=255*x.r,I[4*L+1]=255*x.g,I[4*L+2]=255*x.b,I[4*L+3]=255}))}this._rampGradientsTexture=j.c.CreateRGBATexture(I,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((I,x)=>I.gradient<x.gradient?-1:I.gradient>x.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(I,x){this._rampGradients||(this._rampGradients=[]);const L=new h(I,x);return this._rampGradients.push(L),this._syncRampGradientTexture(),this}removeRampGradient(I){return this._removeGradientAndTexture(I,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(I,x,L){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=GI,this._colorProcessing.process=YI);const F=new J(I,x,L);return this._colorGradients.push(F),this._colorGradients.sort(((I,x)=>I.gradient<x.gradient?-1:I.gradient>x.gradient?1:0)),this}removeColorGradient(I){if(!this._colorGradients)return this;let x=0;for(const L of this._colorGradients){if(L.gradient===I){this._colorGradients.splice(x,1);break}x++}return 0===this._colorGradients.length&&(this._colorCreation.process=XI,this._colorProcessing.process=pI),this}resetDrawCache(){if(this._drawWrappers){for(const I of this._drawWrappers)if(I)for(const x of I)null===x||void 0===x||x.dispose();this._drawWrappers=[]}}_fetchR(I,x,L,F,X){return X[4*(((I=.5*Math.abs(I)+.5)*L%L|0)+((x=.5*Math.abs(x)+.5)*F%F|0)*L)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const I=this._engine,x=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*x),this._vertexBuffer=new T.e(I,this._vertexData,!0,x);let L=0;const F=this._vertexBuffer.createVertexBuffer(T.g.PositionKind,L,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[T.g.PositionKind]=F,L+=3;const X=this._vertexBuffer.createVertexBuffer(T.g.ColorKind,L,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[T.g.ColorKind]=X,L+=4;const G=this._vertexBuffer.createVertexBuffer("angle",L,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=G,L+=1;const Y=this._vertexBuffer.createVertexBuffer("size",L,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=Y,L+=2,this._isAnimationSheetEnabled){const I=this._vertexBuffer.createVertexBuffer("cellIndex",L,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=I,L+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const I=this._vertexBuffer.createVertexBuffer("direction",L,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=I,L+=3}if(this._useRampGradients){const I=this._vertexBuffer.createVertexBuffer("remapData",L,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=I,L+=4}let p;if(this._useInstancing){const x=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new T.e(I,x,!1,2),p=this._spriteBuffer.createVertexBuffer("offset",0,2)}else p=this._vertexBuffer.createVertexBuffer("offset",L,2,this._vertexBufferSize,this._useInstancing),L+=2;this._vertexBuffers.offset=p,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const I=[],x=[];let L=0;for(let F=0;F<this._capacity;F++)I.push(L),I.push(L+1),I.push(L+2),I.push(L),I.push(L+2),I.push(L+3),x.push(L,L+1,L+1,L+2,L+2,L+3,L+3,L,L,L+3),L+=4;this._indexBuffer=this._engine.createIndexBuffer(I),this._linesIndexBuffer=this._engine.createIndexBuffer(x)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(I)setTimeout((()=>{this.start(0)}),I);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var x;-1!==(null===(x=this.Xx)||void 0===x?void 0:x.getClassName().indexOf("Mesh"))&&this.Xx.LB(!0);const I=this.noiseTexture;if(I&&I.onGeneratedObservable)I.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let x=0;x<this.preWarmCycles;x++)this.animate(!0),I.render()}))}));else for(let x=0;x<this.preWarmCycles;x++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(I))}_postStop(I){}reset(){this._stockParticles.length=0,this.pg.length=0}_appendParticleVertex(I,x,L,X){let G=I*this._vertexBufferSize;if(this._vertexData[G++]=x.position.x+this.IW.x,this._vertexData[G++]=x.position.y+this.IW.y,this._vertexData[G++]=x.position.z+this.IW.z,this._vertexData[G++]=x.color.r,this._vertexData[G++]=x.color.g,this._vertexData[G++]=x.color.b,this._vertexData[G++]=x.color.a,this._vertexData[G++]=x.angle,this._vertexData[G++]=x.scale.x*x.size,this._vertexData[G++]=x.scale.y*x.size,this._isAnimationSheetEnabled&&(this._vertexData[G++]=x.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[G++]=x.direction.x,this._vertexData[G++]=x.direction.y,this._vertexData[G++]=x.direction.z);else if(x._initialDirection){let I=x._initialDirection;this.isLocal&&(F.sx.TransformNormalToRef(I,this._emitterWorldMatrix,F.TmpVectors.sx[0]),I=F.TmpVectors.sx[0]),0===I.x&&0===I.z&&(I.x=.001),this._vertexData[G++]=I.x,this._vertexData[G++]=I.y,this._vertexData[G++]=I.z}else{let I=x.direction;this.isLocal&&(F.sx.TransformNormalToRef(I,this._emitterWorldMatrix,F.TmpVectors.sx[0]),I=F.TmpVectors.sx[0]),0===I.x&&0===I.z&&(I.x=.001),this._vertexData[G++]=I.x,this._vertexData[G++]=I.y,this._vertexData[G++]=I.z}this._useRampGradients&&x.remapData&&(this._vertexData[G++]=x.remapData.x,this._vertexData[G++]=x.remapData.y,this._vertexData[G++]=x.remapData.z,this._vertexData[G++]=x.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===L?L=this._epsilon:1===L&&(L=1-this._epsilon),0===X?X=this._epsilon:1===X&&(X=1-this._epsilon)),this._vertexData[G++]=L,this._vertexData[G++]=X)}_prepareParticle(I){}_createNewOnes(I){let x;for(let L=0;L<I&&this.pg.length!==this._capacity;L++){x=this._createParticle(),this.pg.push(x);let I=this._createQueueStart;for(;I;)I.process(x,this),I=I.nextItem;x._inheritParticleInfoToSubEmitters()}}_update(I){if(this._alive=this.pg.length>0,this.Xx.position){const I=this.Xx;this._emitterWorldMatrix=I.getWorldMatrix()}else{const I=this.Xx;this._emitterWorldMatrix=F.Matrix.Translation(I.x,I.y,I.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.pg),this._createNewOnes(I)}static _GetAttributeNamesOrOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const F=[T.g.PositionKind,T.g.ColorKind,"angle","offset","size"];return I&&F.push("cellIndex"),x||F.push("direction"),L&&F.push("remapData"),F}static _GetEffectCreationOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const F=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,xI.d)(F),I&&F.push("particlesInfos"),x&&F.push("logarithmicDepthConstant"),L&&(F.push("vFogInfos"),F.push("vFogColor")),F}fillDefines(I,x){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,xI.j)(this,this._scene,I),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&I.push("#define FOG")),this._isAnimationSheetEnabled&&I.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&I.push("#define LOGARITHMICDEPTH"),x===B.BLENDMODE_MULTIPLY&&I.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&I.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(I.push("#define BILLBOARD"),this.billboardMode){case 2:I.push("#define BILLBOARDY");break;case 8:case 9:I.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&I.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:I.push("#define BILLBOARDMODE_ALL")}L&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),I.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(I,x,L){x.push(...cI._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),I.push(...cI._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),L.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,FI.h)(I,this._imageProcessingConfigurationDefines),(0,FI.d)(L,this._imageProcessingConfigurationDefines))}_getWrapper(I){const x=this._getCustomDrawWrapper(I);if(null!==x&&void 0!==x&&x.effect)return x;const L=[];this.fillDefines(L,I);const F=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let X=this._drawWrappers[F];X||(X=this._drawWrappers[F]=[]);let G=X[I];G||(G=new II.d(this._engine),G.drawContext&&(G.drawContext.useInstancing=this._useInstancing),X[I]=G);const Y=L.join("\n");if(G.defines!==Y){const I=[],x=[],L=[];this.fillUniformsAttributesAndSamplerNames(x,I,L),G.setEffect(this._engine.createEffect("particles",I,x,L,Y,void 0,void 0,void 0,void 0,this._shaderLanguage),Y)}return G}animate(){var I;let x,L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!L&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(L?this.preWarmStepOffset:(null===(I=this._scene)||void 0===I?void 0:I.getAnimationRatio())||1),this.manualEmitCount>-1)x=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let I=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const x=this._actualFrame/this.targetStopDuration;i.GetCurrentGradient(x,this._emitRateGradients,((x,L,F)=>{x!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=L.getFactor(),this._currentEmitRateGradient=x),I=(0,l.Lerp)(this._currentEmitRate1,this._currentEmitRate2,F)}))}x=I*this._scaledUpdateSpeed|0,this._newPartsExcess+=I*this._scaledUpdateSpeed-x}if(this._newPartsExcess>1&&(x+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?x=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(x),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!L){let I=0;for(let x=0;x<this.pg.length;x++){const L=this.pg[x];this._appendParticleVertices(I,L),I+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.pg.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(I,x){this._appendParticleVertex(I++,x,0,0),this._useInstancing||(this._appendParticleVertex(I++,x,1,0),this._appendParticleVertex(I++,x,1,1),this._appendParticleVertex(I++,x,0,1))}rebuild(){var I;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(I=this._spriteBuffer)||void 0===I||I._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!cI.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(L.bind(L,14268)),Promise.resolve().then(L.bind(L,14225))])):await Promise.all([Promise.resolve().then(L.bind(L,14214)),Promise.resolve().then(L.bind(L,14202))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Xx||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==B.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(B.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(B.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(I){const x=this._getWrapper(I),L=x.effect,X=this._engine;X.enableEffect(x);const G=this.defaultViewMatrix??this._scene.getViewMatrix();if(L.setTexture("diffuseSampler",this.particleTexture),L.setMatrix("view",G),L.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const I=this.particleTexture.getBaseSize();L.setFloat3("particlesInfos",this.spriteCellWidth/I.width,this.spriteCellHeight/I.height,this.spriteCellWidth/I.width)}if(L.setVector2("translationPivot",this.translationPivot),L.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const I=this._scene.activeCamera;L.setVector3("eyePosition",I.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),L.setTexture("rampSampler",this._rampGradientsTexture));const Y=L.defines;var p,B,l,W,Q,e;(this._scene&&((0,xI.e)(L,this,this._scene),this.applyFog&&(0,LI.e)(this._scene,void 0,L)),Y.indexOf("#define BILLBOARDMODE_ALL")>=0&&(G.invertToRef(F.TmpVectors.Matrix[0]),L.setMatrix("invView",F.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?X.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,L):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,L)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?X.bindBuffers(this._vertexBuffers,null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?this._linesIndexBuffer:this._indexBuffer,L):X.bindBuffers(this._vertexBuffers,null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?this._linesIndexBufferUseInstancing:null,L);(this.useLogarithmicDepth&&this._scene&&(0,LI.g)(Y,L,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(L),this._setEngineBasedOnBlendMode(I),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(L),this._useInstancing)?null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?X.drawElementsType(6,0,10,this.pg.length):X.drawArraysType(7,0,4,this.pg.length):null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?X.drawElementsType(1,0,10*this.pg.length):X.drawElementsType(0,0,6*this.pg.length);return this.pg.length}render(){if(!this.isReady()||!this.pg.length)return 0;const I=this._engine;I.setState&&(I.setState(!1),this.forceDepthWrite&&I.setDepthWrite(!0));let x=0;return x=this.blendMode===B.BLENDMODE_MULTIPLYADD?this._render(B.BLENDMODE_MULTIPLY)+this._render(B.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),x}_onDispose(){}dispose(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),I&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),I&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(x,L),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const I=this._scene.Gg.indexOf(this);I>-1&&this._scene.Gg.splice(I,1),this._scene._activeParticleSystems.dispose()}this.cp.notifyObservers(this),this.cp.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}cI.ForceGLSL=!1;var oI,JI=L(12825);!function(I){I[I.ATTACHED=0]="ATTACHED",I[I.END=1]="END"}(oI||(oI={}));class hI{constructor(I){if(this.particleSystem=I,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!I.Xx||!I.Xx.dispose){const x=(0,p.b)("BABYLON.AbstractMesh");I.Xx=new x("SubemitterSystemEmitter",I.tI()),I._disposeEmitterOnDispose=!0}}clone(){let I=this.particleSystem.Xx;if(I){if(I instanceof F.sx)I=I.clone();else if(-1!==I.getClassName().indexOf("Mesh")){I=new((0,p.b)("BABYLON.Mesh"))("",I.tI()),I.isVisible=!1}}else I=new F.sx;const x=new hI(this.particleSystem.clone(this.particleSystem.name,I));return x.particleSystem.name+="Clone",x.type=this.type,x.inheritDirection=this.inheritDirection,x.inheritedVelocityAmount=this.inheritedVelocityAmount,x.particleSystem._disposeEmitterOnDispose=!0,x.particleSystem.disposeOnStop=!0,x}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={};return x.type=this.type,x.inheritDirection=this.inheritDirection,x.inheritedVelocityAmount=this.inheritedVelocityAmount,x.particleSystem=this.particleSystem.serialize(I),x}static _ParseParticleSystem(I,x,L){throw(0,JI.e)("ParseParticle")}static Parse(I,x,L){const F=I.particleSystem,X=new hI(hI._ParseParticleSystem(F,x,L,!0));return X.type=I.type,X.inheritDirection=I.inheritDirection,X.inheritedVelocityAmount=I.inheritedVelocityAmount,X.particleSystem._isSubEmitter=!0,X}dispose(){this.particleSystem.dispose()}}var EI=L(12872);function iI(I,x){const L=new s;return L.direction1=I,L.direction2=x,L}function VI(){return new H(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function jI(){return new U(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function CI(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new F.sx(0,1,0),L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.sx(0,1,0);return new q(I,x,L)}function bI(){return new v(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Ix(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.sx(0,1,0),G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new F.sx(0,1,0);return new z(I,x,L,X,G)}function xx(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new e(I,x)}function Lx(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.sx(0,1,0),X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.sx(0,1,0);return new g(I,x,L,X)}const Fx=F.sx.Zero(),Xx=F.sx.Zero(),Gx=F.sx.Zero();class Yx{constructor(){this.strength=0,this.position=F.sx.Zero()}_processParticle(I,x){this.position.subtractToRef(I.position,Fx);const L=Fx.lengthSquared()+1;Fx.normalize().scaleToRef(this.strength/L,Xx),Xx.scaleToRef(x._tempScaledUpdateSpeed,Gx),I.direction.addInPlace(Gx)}serialize(){return{position:this.position.Cp(),strength:this.strength}}}class px extends cI{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=I=>{if(!this._subEmitters||0===this._subEmitters.length)return;const x=Math.floor(Math.random()*this._subEmitters.length);for(const L of this._subEmitters[x])if(1===L.type){const x=L.clone();I._inheritParticleInfoToSubEmitter(x),x.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(x.particleSystem),x.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(I,x){const L=iI(I,x);return this.particleEmitterType=L,L}get flowMap(){return this._flowMap}set flowMap(I){this._flowMap!==I&&(this._flowMap=I,this._flowMapUpdate&&(SI(this._flowMapUpdate),this._flowMapUpdate=null),I&&(this._flowMapUpdate={process:I=>{var x;const L=null===(x=this.tI())||void 0===x?void 0:x.getTransformMatrix();this._flowMap._processParticle(I,this.flowMapStrength*this._tempScaledUpdateSpeed,L)},previousItem:null,nextItem:null},rI(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(I){this._attractors.push(I),1===this._attractors.length&&(this._attractorUpdate={process:I=>{for(const x of this._attractors)x._processParticle(I,this)},previousItem:null,nextItem:null},rI(this._attractorUpdate,this._directionProcessing))}removeAttractor(I){const x=this._attractors.indexOf(I);-1!==x&&this._attractors.splice(x,1),0===this._attractors.length&&SI(this._attractorUpdate)}start(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(I)}createHemisphericEmitter(){const I=VI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createSphereEmitter(){const I=jI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createDirectedSphereEmitter(){const I=CI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new F.sx(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.sx(0,1,0));return this.particleEmitterType=I,I}createCylinderEmitter(){const I=bI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=I,I}createDirectedCylinderEmitter(){const I=Ix(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.sx(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new F.sx(0,1,0));return this.particleEmitterType=I,I}createConeEmitter(){const I=xx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=I,I}createDirectedConeEmitter(){const I=Lx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.sx(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.sx(0,1,0));return this.particleEmitterType=I,I}createBoxEmitter(I,x,L,F){const X=new Q;return this.particleEmitterType=X,this.direction1=I,this.direction2=x,this.minEmitBox=L,this.maxEmitBox=F,X}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const I of this.subEmitters)I instanceof px?this._subEmitters.push([new hI(I)]):I instanceof hI?this._subEmitters.push([I]):I instanceof Array&&this._subEmitters.push(I)}_stopSubEmitters(){if(this.activeSubSystems){for(const I of this.activeSubSystems)I.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const I=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==I&&this._rootParticleSystem.activeSubSystems.splice(I,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(I){I&&this._stopSubEmitters()}_prepareParticle(I){if(this._subEmitters&&this._subEmitters.length>0){const x=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];I._attachedSubEmitters=[];for(const L of x)if(0===L.type){const x=L.clone();I._attachedSubEmitters.push(x),x.particleSystem.start()}}}_onDispose(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),I&&this.particles)for(const L of this.particles)if(L._attachedSubEmitters)for(let I=L._attachedSubEmitters.length-1;I>=0;I-=1)L._attachedSubEmitters[I].dispose();if(x&&this.activeSubSystems)for(let L=this.activeSubSystems.length-1;L>=0;L-=1)this.activeSubSystems[L].dispose();if(this._subEmitters&&this._subEmitters.length){for(let I=0;I<this._subEmitters.length;I++)for(const x of this._subEmitters[I])x.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Xx&&this.Xx.dispose&&this.Xx.dispose(!0)}static _Parse(I,x,L,X){let G;G=L instanceof EI.d?null:L;const B=(0,p.b)("BABYLON.Texture");if(B&&G&&(I.texture?x.particleTexture=B.Parse(I.texture,G,X):I.textureName&&(x.particleTexture=new B(X+I.textureName,G,!1,void 0===I.invertY||I.invertY),x.particleTexture.name=I.textureName)),I.emitterId||0===I.emitterId||void 0!==I.Xx?I.emitterId&&G?x.Xx=G.getLastMeshById(I.emitterId):x.Xx=F.sx.tx(I.Xx):x.Xx=F.sx.Zero(),x.isLocal=!!I.isLocal,void 0!==I.renderingGroupId&&(x.renderingGroupId=I.renderingGroupId),void 0!==I.isBillboardBased&&(x.isBillboardBased=I.isBillboardBased),void 0!==I.billboardMode&&(x.billboardMode=I.billboardMode),void 0!==I.useLogarithmicDepth&&(x.useLogarithmicDepth=I.useLogarithmicDepth),I.animations){for(let L=0;L<I.animations.length;L++){const F=I.animations[L],X=(0,p.b)("BABYLON.Animation");X&&x.animations.push(X.Parse(F))}x.beginAnimationOnStart=I.beginAnimationOnStart,x.beginAnimationFrom=I.beginAnimationFrom,x.beginAnimationTo=I.beginAnimationTo,x.beginAnimationLoop=I.beginAnimationLoop}if(I.autoAnimate&&G&&G.beginAnimation(x,I.autoAnimateFrom,I.autoAnimateTo,I.autoAnimateLoop,I.autoAnimateSpeed||1),x.startDelay=0|I.startDelay,x.minAngularSpeed=I.minAngularSpeed,x.maxAngularSpeed=I.maxAngularSpeed,x.minSize=I.minSize,x.maxSize=I.maxSize,I.minScaleX&&(x.minScaleX=I.minScaleX,x.maxScaleX=I.maxScaleX,x.minScaleY=I.minScaleY,x.maxScaleY=I.maxScaleY),void 0!==I.preWarmCycles&&(x.preWarmCycles=I.preWarmCycles,x.preWarmStepOffset=I.preWarmStepOffset),void 0!==I.minInitialRotation&&(x.minInitialRotation=I.minInitialRotation,x.maxInitialRotation=I.maxInitialRotation),x.minLifeTime=I.minLifeTime,x.maxLifeTime=I.maxLifeTime,x.minEmitPower=I.minEmitPower,x.maxEmitPower=I.maxEmitPower,x.emitRate=I.emitRate,x.gravity=F.sx.tx(I.gravity),I.noiseStrength&&(x.noiseStrength=F.sx.tx(I.noiseStrength)),x.color1=Y.lB.tx(I.color1),x.color2=Y.lB.tx(I.color2),x.colorDead=Y.lB.tx(I.colorDead),x.updateSpeed=I.updateSpeed,x.targetStopDuration=I.targetStopDuration,x.blendMode=I.blendMode,I.colorGradients)for(const F of I.colorGradients)x.addColorGradient(F.gradient,Y.lB.tx(F.color1),F.color2?Y.lB.tx(F.color2):void 0);if(I.rampGradients){for(const L of I.rampGradients)x.addRampGradient(L.gradient,Y.Tx.tx(L.color));x.useRampGradients=I.useRampGradients}if(I.colorRemapGradients)for(const F of I.colorRemapGradients)x.addColorRemapGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(I.alphaRemapGradients)for(const F of I.alphaRemapGradients)x.addAlphaRemapGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(I.sizeGradients)for(const F of I.sizeGradients)x.addSizeGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(I.angularSpeedGradients)for(const F of I.angularSpeedGradients)x.addAngularSpeedGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(I.velocityGradients)for(const F of I.velocityGradients)x.addVelocityGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(I.dragGradients)for(const F of I.dragGradients)x.addDragGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(I.emitRateGradients)for(const F of I.emitRateGradients)x.addEmitRateGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(I.startSizeGradients)for(const F of I.startSizeGradients)x.addStartSizeGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(I.lifeTimeGradients)for(const F of I.lifeTimeGradients)x.addLifeTimeGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(I.limitVelocityGradients){for(const L of I.limitVelocityGradients)x.addLimitVelocityGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2);x.limitVelocityDamping=I.limitVelocityDamping}if(I.noiseTexture&&G){const L=(0,p.b)("BABYLON.ProceduralTexture");x.noiseTexture=L.Parse(I.noiseTexture,G,X)}let l;if(I.particleEmitterType){switch(I.particleEmitterType.type){case"SphereParticleEmitter":l=new U;break;case"SphereDirectedParticleEmitter":l=new q;break;case"ConeEmitter":case"ConeParticleEmitter":l=new e;break;case"ConeDirectedParticleEmitter":l=new g;break;case"CylinderParticleEmitter":l=new v;break;case"CylinderDirectedParticleEmitter":l=new z;break;case"HemisphericParticleEmitter":l=new H;break;case"PointParticleEmitter":l=new s;break;case"MeshParticleEmitter":l=new Z;break;case"CustomParticleEmitter":l=new y;break;default:l=new Q}l.parse(I.particleEmitterType,G)}else l=new Q,l.parse(I,G);x.particleEmitterType=l,x.startSpriteCellID=I.startSpriteCellID,x.endSpriteCellID=I.endSpriteCellID,x.spriteCellLoop=I.spriteCellLoop??!0,x.spriteCellWidth=I.spriteCellWidth,x.spriteCellHeight=I.spriteCellHeight,x.spriteCellChangeSpeed=I.spriteCellChangeSpeed,x.spriteRandomStartCell=I.spriteRandomStartCell,x.disposeOnStop=I.disposeOnStop??!1,x.manualEmitCount=I.manualEmitCount??-1}static Parse(I,x,L){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4?arguments[4]:void 0;const p=I.name;let B,l,W=null,Q=null;if(x instanceof EI.d?B=x:(l=x,B=l.getEngine()),I.customShader&&B.createEffectForParticles){Q=I.customShader;const x=Q.shaderOptions.defines.length>0?Q.shaderOptions.defines.join("\n"):"";W=B.createEffectForParticles(Q.shaderPath.fragmentElement,Q.shaderOptions.uniforms,Q.shaderOptions.samplers,x)}const e=new px(p,G||I.tL,x,W,I.isAnimationSheetEnabled);if(e.customShader=Q,e._rootUrl=L,I.id&&(e.id=I.id),I.subEmitters){e.subEmitters=[];for(const F of I.subEmitters){const I=[];for(const X of F)I.push(hI.Parse(X,x,L));e.subEmitters.push(I)}}if(I.attractors)for(const Y of I.attractors){const I=new Yx;I.position=F.sx.tx(Y.position),I.strength=Y.strength,e.addAttractor(I)}return px._Parse(I,e,x,L),I.textureMask&&(e.textureMask=Y.lB.tx(I.textureMask)),I.IW&&(e.IW=F.sx.tx(I.IW)),I.preventAutoStart&&(e.preventAutoStart=I.preventAutoStart),X||e.preventAutoStart||e.start(),e}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={};if(px._Serialize(x,this,I),x.textureMask=this.textureMask.Cp(),x.customShader=this.customShader,x.preventAutoStart=this.preventAutoStart,x.IW=this.IW.Cp(),this.subEmitters){x.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const L of this._subEmitters){const F=[];for(const x of L)F.push(x.serialize(I));x.subEmitters.push(F)}}if(this._attractors&&this._attractors.length){x.attractors=[];for(const I of this._attractors)x.attractors.push(I.serialize())}return x}static _Serialize(I,x,L){if(I.name=x.name,I.id=x.id,I.tL=x.getCapacity(),I.disposeOnStop=x.disposeOnStop,I.manualEmitCount=x.manualEmitCount,x.Xx.position){const L=x.Xx;I.emitterId=L.id}else{const L=x.Xx;I.Xx=L.Cp()}x.particleEmitterType&&(I.particleEmitterType=x.particleEmitterType.serialize()),x.particleTexture&&(L?I.texture=x.particleTexture.serialize():(I.textureName=x.particleTexture.name,I.invertY=!!x.particleTexture._invertY)),I.isLocal=x.isLocal,A.c.AppendSerializedAnimations(x,I),I.beginAnimationOnStart=x.beginAnimationOnStart,I.beginAnimationFrom=x.beginAnimationFrom,I.beginAnimationTo=x.beginAnimationTo,I.beginAnimationLoop=x.beginAnimationLoop,I.startDelay=x.startDelay,I.renderingGroupId=x.renderingGroupId,I.isBillboardBased=x.isBillboardBased,I.billboardMode=x.billboardMode,I.minAngularSpeed=x.minAngularSpeed,I.maxAngularSpeed=x.maxAngularSpeed,I.minSize=x.minSize,I.maxSize=x.maxSize,I.minScaleX=x.minScaleX,I.maxScaleX=x.maxScaleX,I.minScaleY=x.minScaleY,I.maxScaleY=x.maxScaleY,I.minEmitPower=x.minEmitPower,I.maxEmitPower=x.maxEmitPower,I.minLifeTime=x.minLifeTime,I.maxLifeTime=x.maxLifeTime,I.emitRate=x.emitRate,I.gravity=x.gravity.Cp(),I.noiseStrength=x.noiseStrength.Cp(),I.color1=x.color1.Cp(),I.color2=x.color2.Cp(),I.colorDead=x.colorDead.Cp(),I.updateSpeed=x.updateSpeed,I.targetStopDuration=x.targetStopDuration,I.blendMode=x.blendMode,I.preWarmCycles=x.preWarmCycles,I.preWarmStepOffset=x.preWarmStepOffset,I.minInitialRotation=x.minInitialRotation,I.maxInitialRotation=x.maxInitialRotation,I.startSpriteCellID=x.startSpriteCellID,I.spriteCellLoop=x.spriteCellLoop,I.endSpriteCellID=x.endSpriteCellID,I.spriteCellChangeSpeed=x.spriteCellChangeSpeed,I.spriteCellWidth=x.spriteCellWidth,I.spriteCellHeight=x.spriteCellHeight,I.spriteRandomStartCell=x.spriteRandomStartCell,I.isAnimationSheetEnabled=x.isAnimationSheetEnabled,I.useLogarithmicDepth=x.useLogarithmicDepth;const F=x.getColorGradients();if(F){I.colorGradients=[];for(const x of F){const L={gradient:x.gradient,color1:x.color1.Cp()};x.color2?L.color2=x.color2.Cp():L.color2=x.color1.Cp(),I.colorGradients.push(L)}}const X=x.getRampGradients();if(X){I.rampGradients=[];for(const x of X){const L={gradient:x.gradient,color:x.color.Cp()};I.rampGradients.push(L)}I.useRampGradients=x.useRampGradients}const G=x.getColorRemapGradients();if(G){I.colorRemapGradients=[];for(const x of G){const L={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?L.factor2=x.factor2:L.factor2=x.factor1,I.colorRemapGradients.push(L)}}const Y=x.getAlphaRemapGradients();if(Y){I.alphaRemapGradients=[];for(const x of Y){const L={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?L.factor2=x.factor2:L.factor2=x.factor1,I.alphaRemapGradients.push(L)}}const p=x.getSizeGradients();if(p){I.sizeGradients=[];for(const x of p){const L={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?L.factor2=x.factor2:L.factor2=x.factor1,I.sizeGradients.push(L)}}const B=x.getAngularSpeedGradients();if(B){I.angularSpeedGradients=[];for(const x of B){const L={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?L.factor2=x.factor2:L.factor2=x.factor1,I.angularSpeedGradients.push(L)}}const l=x.getVelocityGradients();if(l){I.velocityGradients=[];for(const x of l){const L={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?L.factor2=x.factor2:L.factor2=x.factor1,I.velocityGradients.push(L)}}const W=x.getDragGradients();if(W){I.dragGradients=[];for(const x of W){const L={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?L.factor2=x.factor2:L.factor2=x.factor1,I.dragGradients.push(L)}}const Q=x.getEmitRateGradients();if(Q){I.emitRateGradients=[];for(const x of Q){const L={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?L.factor2=x.factor2:L.factor2=x.factor1,I.emitRateGradients.push(L)}}const e=x.getStartSizeGradients();if(e){I.startSizeGradients=[];for(const x of e){const L={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?L.factor2=x.factor2:L.factor2=x.factor1,I.startSizeGradients.push(L)}}const g=x.getLifeTimeGradients();if(g){I.lifeTimeGradients=[];for(const x of g){const L={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?L.factor2=x.factor2:L.factor2=x.factor1,I.lifeTimeGradients.push(L)}}const v=x.getLimitVelocityGradients();if(v){I.limitVelocityGradients=[];for(const x of v){const L={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?L.factor2=x.factor2:L.factor2=x.factor1,I.limitVelocityGradients.push(L)}I.limitVelocityDamping=x.limitVelocityDamping}x.noiseTexture&&(I.noiseTexture=x.noiseTexture.serialize())}clone(I,x){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const F={...this._customWrappers};let X=null;const G=this._engine;if(G.createEffectForParticles&&null!=this.customShader){X=this.customShader;const I=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"",x=G.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,I);F[0]?F[0].effect=x:this.setCustomEffect(x,0)}const Y=this.serialize(L),p=px.Parse(Y,this._scene||this._engine,this._rootUrl);return p.name=I,p.customShader=X,p._customWrappers=F,void 0===x&&(x=this.Xx),this.noiseTexture&&(p.noiseTexture=this.noiseTexture.clone()),p.Xx=x,this.preventAutoStart||p.start(),p}}px.BILLBOARDMODE_Y=2,px.BILLBOARDMODE_ALL=7,px.BILLBOARDMODE_STRETCHED=8,px.BILLBOARDMODE_STRETCHED_LOCAL=9,hI._ParseParticleSystem=px.Parse;var Bx=L(13220),lx=L(13218),Wx=L(13112);Wx.b.prototype.createTransformFeedback=function(){const I=this._gl.createTransformFeedback();if(!I)throw new Error("Unable to create Transform Feedback");return I},Wx.b.prototype.deleteTransformFeedback=function(I){this._gl.deleteTransformFeedback(I)},Wx.b.prototype.bindTransformFeedback=function(I){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,I)},Wx.b.prototype.beginTransformFeedback=function(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(I?this._gl.POINTS:this._gl.TRIANGLES)},Wx.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Wx.b.prototype.setTranformFeedbackVaryings=function(I,x){this._gl.transformFeedbackVaryings(I,x,this._gl.INTERLEAVED_ATTRIBS)},Wx.b.prototype.bindTransformFeedbackBuffer=function(I){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,I?I.underlyingResource:null)},Wx.b.prototype.readTransformFeedbackBuffer=function(I){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,I)};const Qx="clipPlaneFragmentDeclaration2",ex="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";f.d.IncludesShadersStore[Qx]||(f.d.IncludesShadersStore[Qx]=ex);L(14107),L(14115),L(14121),L(14124),L(14133),L(14137),L(14143),L(14147);const gx="gpuRenderParticlesPixelShader",vx="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";f.d.ShadersStore[gx]||(f.d.ShadersStore[gx]=vx);const zx="clipPlaneVertexDeclaration2",Hx="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";f.d.IncludesShadersStore[zx]||(f.d.IncludesShadersStore[zx]=Hx);L(14156),L(14160),L(14165),L(14168);const sx="gpuRenderParticlesVertexShader",Ux="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";f.d.ShadersStore[sx]||(f.d.ShadersStore[sx]=Ux);class qx extends B{static get IsSupported(){if(!C.e.LastCreatedEngine)return!1;const I=C.e.LastCreatedEngine.getCaps();return I.supportTransformFeedbacks||I.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(I){this._maxActiveParticleCount=Math.min(I,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(I){this.maxActiveParticleCount=I}createPointEmitter(I,x){const L=iI(I,x);return this.particleEmitterType=L,L}createHemisphericEmitter(){const I=VI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createSphereEmitter(){const I=jI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createDirectedSphereEmitter(){const I=CI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new F.sx(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.sx(0,1,0));return this.particleEmitterType=I,I}createCylinderEmitter(){const I=bI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=I,I}createDirectedCylinderEmitter(){const I=Ix(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.sx(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new F.sx(0,1,0));return this.particleEmitterType=I,I}createConeEmitter(){const I=xx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=I,I}createDirectedConeEmitter(){const I=Lx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.sx(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.sx(0,1,0));return this.particleEmitterType=I,I}createBoxEmitter(I,x,L,F){const X=new Q;return this.particleEmitterType=X,this.direction1=I,this.direction2=x,this.minEmitBox=L,this.maxEmitBox=F,X}get flowMap(){return this._flowMap}set flowMap(I){this._flowMap!==I&&(this._flowMap=I)}isReady(){if(!this.Xx||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==px.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(px.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(px.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";I?setTimeout((()=>{this.start(0)}),I):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var I;let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(I=this._customWrappers[x])||void 0===I?void 0:I.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[I]??this._customWrappers[0]}setCustomEffect(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[x]=new II.d(this._engine),this._customWrappers[x].effect=I}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new V.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(I,x,L){return super._removeGradientAndTexture(I,x,L),this._releaseBuffers(),this}addColorGradient(I,x){this._colorGradients||(this._colorGradients=[]);const L=new J(I,x);return this._colorGradients.push(L),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(I&&this._colorGradients.sort(((I,x)=>I.gradient<x.gradient?-1:I.gradient>x.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(I){return this._removeGradientAndTexture(I,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const x in this._drawWrappers){var I;null===(I=this._drawWrappers[x].drawContext)||void 0===I||I.reset()}}_addFactorGradient(I,x,L){const F=new E(x,L);I.push(F),this._releaseBuffers()}addSizeGradient(I,x){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,I,x),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(I){return this._removeGradientAndTexture(I,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(I,x){if(!I)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&I.sort(((I,x)=>I.gradient<x.gradient?-1:I.gradient>x.gradient?1:0));const L=this;L[x]&&(L[x].dispose(),L[x]=null)}addAngularSpeedGradient(I,x){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,I,x),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(I){return this._removeGradientAndTexture(I,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(I,x){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,I,x),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(I){return this._removeGradientAndTexture(I,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(I,x){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,I,x),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(I){return this._removeGradientAndTexture(I,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(I,x){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,I,x),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(I){return this._removeGradientAndTexture(I,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(I){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(I,x,L){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(I),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.cp=new V.c,this.onStoppedObservable=new V.c,this.onStartedObservable=new V.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,L&&"Scene"!==L.getClassName()?(this._engine=L,this.defaultProjectionMatrix=F.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=L||C.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Gg.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,p.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,p.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,p.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,p.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new II.d(this._engine)},this._customWrappers[0].effect=X,this._drawWrappers={0:new II.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(x=x??{}).randomTextureSize||delete x.randomTextureSize;const Y={tL:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...x},B=x;isFinite(B)&&(Y.tL=B),this._capacity=Y.tL,this._maxActiveParticleCount=Y.tL,this._currentActiveCount=0,this._isAnimationSheetEnabled=G,this.particleEmitterType=new Q;const l=Math.min(this._engine.getCaps().maxTextureSize,Y.randomTextureSize);let W=[];for(let F=0;F<l;++F)W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),W.push(Math.random());this._randomTexture=new j.c(new Float32Array(W),l,1,5,L,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,W=[];for(let F=0;F<l;++F)W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),W.push(Math.random());this._randomTexture2=new j.c(new Float32Array(W),l,1,5,L,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=l}_reset(){this._releaseBuffers()}_createVertexBuffers(I,x,L){const F={};F.position=x.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let X=3;F.age=x.createVertexBuffer("age",X,1,this._attributesStrideSize,!0),X+=1,F.size=x.createVertexBuffer("size",X,3,this._attributesStrideSize,!0),X+=3,F.life=x.createVertexBuffer("life",X,1,this._attributesStrideSize,!0),X+=1,X+=4,this.billboardMode===px.BILLBOARDMODE_STRETCHED&&(F.direction=x.createVertexBuffer("direction",X,3,this._attributesStrideSize,!0)),X+=3,this._platform.alignDataInBuffer&&(X+=1),this.particleEmitterType instanceof y&&(X+=3,this._platform.alignDataInBuffer&&(X+=1)),this._colorGradientsTexture||(F.color=x.createVertexBuffer("color",X,4,this._attributesStrideSize,!0),X+=4),this._isBillboardBased||(F.initialDirection=x.createVertexBuffer("initialDirection",X,3,this._attributesStrideSize,!0),X+=3,this._platform.alignDataInBuffer&&(X+=1)),this.noiseTexture&&(F.noiseCoordinates1=x.createVertexBuffer("noiseCoordinates1",X,3,this._attributesStrideSize,!0),X+=3,this._platform.alignDataInBuffer&&(X+=1),F.noiseCoordinates2=x.createVertexBuffer("noiseCoordinates2",X,3,this._attributesStrideSize,!0),X+=3,this._platform.alignDataInBuffer&&(X+=1)),F.angle=x.createVertexBuffer("angle",X,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?X++:X+=2,this._isAnimationSheetEnabled&&(F.cellIndex=x.createVertexBuffer("cellIndex",X,1,this._attributesStrideSize,!0),X+=1,this.spriteRandomStartCell&&(F.cellStartOffset=x.createVertexBuffer("cellStartOffset",X,1,this._attributesStrideSize,!0),X+=1)),F.offset=L.createVertexBuffer("offset",0,2),F.uv=L.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(F),this._platform.createVertexBuffers(I,F),this.resetDrawCache()}_initialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!I)return;const x=this._engine,L=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof y&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const X=this.particleEmitterType instanceof y,G=F.TmpVectors.sx[0];let Y=0;for(let F=0;F<this._capacity;F++)if(L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),X?(this.particleEmitterType.particleDestinationGenerator(F,null,G),L.push(G.x),L.push(G.y),L.push(G.z)):(L.push(0),L.push(0),L.push(0)),this._platform.alignDataInBuffer&&L.push(0),Y+=16,X&&(this.particleEmitterType.particlePositionGenerator(F,null,G),L.push(G.x),L.push(G.y),L.push(G.z),this._platform.alignDataInBuffer&&L.push(0),Y+=4),this._colorGradientsTexture||(L.push(0),L.push(0),L.push(0),L.push(0),Y+=4),this.isBillboardBased||(L.push(0),L.push(0),L.push(0),this._platform.alignDataInBuffer&&L.push(0),Y+=4),this.noiseTexture&&(L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),this._platform.alignDataInBuffer&&L.push(0),L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),this._platform.alignDataInBuffer&&L.push(0),Y+=8),L.push(0),Y+=1,this._angularSpeedGradientsTexture||(L.push(0),Y+=1),this._isAnimationSheetEnabled&&(L.push(0),Y+=1,this.spriteRandomStartCell&&(L.push(0),Y+=1)),this._platform.alignDataInBuffer){let I=3-(Y+3&3);for(Y+=I;I-- >0;)L.push(0)}const p=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),B=this._platform.createParticleBuffer(L),l=this._platform.createParticleBuffer(L);this._buffer0=new T.e(x,B,!1,this._attributesStrideSize),this._buffer1=new T.e(x,l,!1,this._attributesStrideSize),this._spriteBuffer=new T.e(x,p,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let I=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(I+="\n#define BILLBOARD"),this._colorGradientsTexture&&(I+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(I+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(I+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(I+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(I+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(I+="\n#define DRAGGRADIENTS"),this._flowMap&&(I+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(I+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(I+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(I+="\n#define NOISE"),this.isLocal&&(I+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===I||(this._cachedUpdateDefines=I,this._updateBuffer=this._platform.createUpdateBuffer(I)),this._platform.isUpdateBufferReady()}_getWrapper(I){const x=this._getCustomDrawWrapper(I);if(null!==x&&void 0!==x&&x.effect)return x;const L=[];this.fillDefines(L,I);let F=this._drawWrappers[I];F||(F=new II.d(this._engine),F.drawContext&&(F.drawContext.useInstancing=!0),this._drawWrappers[I]=F);const X=L.join("\n");if(F.defines!==X){const I=[],x=[],L=[];this.fillUniformsAttributesAndSamplerNames(x,I,L),F.setEffect(this._engine.createEffect("gpuRenderParticles",I,x,L,X),X)}return F}static _GetAttributeNamesOrOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const X=[T.g.PositionKind,"age","life","size","angle"];return I||X.push(T.g.ColorKind),x&&X.push("cellIndex"),L||X.push("initialDirection"),F&&X.push("direction"),X.push("offset",T.g.UVKind),X}static _GetEffectCreationOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const F=["emitterWM","IW","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,xI.d)(F),I&&F.push("sheetInfos"),x&&F.push("logarithmicDepthConstant"),L&&(F.push("vFogInfos"),F.push("vFogColor")),F}fillDefines(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,xI.j)(this,this._scene,I),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==lx.b.FOGMODE_NONE&&I.push("#define FOG")),x===px.BLENDMODE_MULTIPLY&&I.push("#define BLENDMULTIPLYMODE"),this.isLocal&&I.push("#define LOCAL"),this.useLogarithmicDepth&&I.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(I.push("#define BILLBOARD"),this.billboardMode){case px.BILLBOARDMODE_Y:I.push("#define BILLBOARDY");break;case px.BILLBOARDMODE_STRETCHED:I.push("#define BILLBOARDSTRETCHED");break;case px.BILLBOARDMODE_ALL:I.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&I.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&I.push("#define ANIMATESHEET"),L&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),I.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(I,x,L){x.push(...qx._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===px.BILLBOARDMODE_STRETCHED)),I.push(...qx._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),L.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Bx.d.PrepareUniforms(I,this._imageProcessingConfigurationDefines),Bx.d.PrepareSamplers(L,this._imageProcessingConfigurationDefines))}animate(){var I;let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(x?this.preWarmStepOffset:(null===(I=this._scene)||void 0===I?void 0:I.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(I,x){const L=this[x];if(!I||!I.length||L)return;const F=new Float32Array(this._rawTextureWidth);for(let X=0;X<this._rawTextureWidth;X++){const x=X/this._rawTextureWidth;i.GetCurrentGradient(x,I,((I,x,L)=>{F[X]=(0,l.Lerp)(I.factor1,x.factor1,L)}))}this[x]=j.c.CreateRTexture(F,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[x].name=x.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const I=new Uint8Array(4*this._rawTextureWidth),x=Y.TmpColors.lB[0];for(let L=0;L<this._rawTextureWidth;L++){const F=L/this._rawTextureWidth;i.GetCurrentGradient(F,this._colorGradients,((F,X,G)=>{Y.lB.LerpToRef(F.color1,X.color1,G,x),I[4*L]=255*x.r,I[4*L+1]=255*x.g,I[4*L+2]=255*x.b,I[4*L+3]=255*x.a}))}this._colorGradientsTexture=j.c.CreateRGBATexture(I,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(I,x){var L,X,G,Y;const p=this._getWrapper(I),B=p.effect;this._engine.enableEffect(p);const l=(null===(L=this._scene)||void 0===L?void 0:L.getViewMatrix())||F.Matrix.IdentityReadOnly;if(B.setMatrix("view",l),B.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),B.setTexture("diffuseSampler",this.particleTexture),B.setVector2("translationPivot",this.translationPivot),B.setVector3("IW",this.IW),this.isLocal&&B.setMatrix("emitterWM",x),this._colorGradientsTexture?B.setTexture("colorGradientSampler",this._colorGradientsTexture):B.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const I=this.particleTexture.getBaseSize();B.setFloat3("sheetInfos",this.spriteCellWidth/I.width,this.spriteCellHeight/I.height,I.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const I=this._scene.activeCamera;B.setVector3("eyePosition",I.globalPosition)}const W=B.defines;if(this._scene&&((0,xI.e)(B,this,this._scene),this.applyFog&&(0,LI.e)(this._scene,void 0,B)),W.indexOf("#define BILLBOARDMODE_ALL")>=0){const I=l.clone();I.invert(),B.setMatrix("invView",I)}return this.useLogarithmicDepth&&this._scene&&(0,LI.g)(W,B,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(B),this._setEngineBasedOnBlendMode(I),this._platform.bindDrawBuffers(this._targetIndex,B,null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(B),null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(I){if(!this.Xx||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!I)if(this.Xx.position){I=this.Xx.getWorldMatrix()}else{const x=this.Xx;I=F.TmpVectors.Matrix[0],F.Matrix.TranslationToRef(x.x,x.y,x.z,I)}const x=this._engine,L=x.getDepthWrite();if(x.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const I=this.tI();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",I.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",I),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const X=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=X,x.setDepthWrite(L)}render(){let I,x=arguments.length>0&&void 0!==arguments[0]&&arguments[0],L=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!x&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let I=0;I<this.preWarmCycles;I++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const I=0|this._accumulatedCount;this._accumulatedCount-=I,this._currentActiveCount+=I}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Xx.position){I=this.Xx.getWorldMatrix()}else{const x=this.Xx;I=F.TmpVectors.Matrix[0],F.Matrix.TranslationToRef(x.x,x.y,x.z,I)}const X=this._engine;this.updateInAnimate||this._update(I);let G=0;return x||L||(X.setState(!1),this.forceDepthWrite&&X.setDepthWrite(!0),G=this.blendMode===px.BLENDMODE_MULTIPLYADD?this._render(px.BLENDMODE_MULTIPLY,I)+this._render(px.BLENDMODE_ADD,I):this._render(this.blendMode,I),this._engine.setAlphaMode(0)),G}rebuild(){const I=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(I,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,I()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const x in this._drawWrappers){this._drawWrappers[x].dispose()}if(this._drawWrappers={},this._scene){const I=this._scene.Gg.indexOf(this);I>-1&&this._scene.Gg.splice(I,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let x=0;x<this._renderVertexBuffers.length;++x){const I=this._renderVertexBuffers[x];for(const x in I)I[x].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),I&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),I&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.cp.notifyObservers(this),this.cp.clear()}clone(I,x){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const F={...this._customWrappers};let X=null;const G=this._engine;if(G.createEffectForParticles&&null!=this.customShader){X=this.customShader;const I=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"";F[0]=G.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,I,void 0,void 0,void 0,this)}const Y=this.serialize(L),p=qx.Parse(Y,this._scene||this._engine,this._rootUrl);return p.name=I,p.customShader=X,p._customWrappers=F,void 0===x&&(x=this.Xx),this.noiseTexture&&(p.noiseTexture=this.noiseTexture.clone()),p.Xx=x,p}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={};return px._Serialize(x,this,I),x.activeParticleCount=this.activeParticleCount,x.randomTextureSize=this._randomTextureSize,x.customShader=this.customShader,x}static Parse(I,x,L){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4?arguments[4]:void 0;const G=I.name;let Y,p;x instanceof EI.d?Y=x:(p=x,Y=p.getEngine());const B=new qx(G,{tL:X||I.tL,randomTextureSize:I.randomTextureSize},x,null,I.isAnimationSheetEnabled);if(B._rootUrl=L,I.customShader&&Y.createEffectForParticles){const x=I.customShader,L=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"",F=Y.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,L,void 0,void 0,void 0,B);B.setCustomEffect(F,0),B.customShader=x}return I.id&&(B.id=I.id),I.activeParticleCount&&(B.activeParticleCount=I.activeParticleCount),px._Parse(I,B,x,L),I.preventAutoStart&&(B.preventAutoStart=I.preventAutoStart),F||B.preventAutoStart||B.start(),B}}var yx=L(12791),Tx=L(14170),Zx=L(13349);class tx{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(I){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const x of this.systems)x.Xx=I;this._emitterNode=I}setEmitterAsSphere(I,x,L){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:I,renderingGroupId:x};const F=(0,Tx.d)("emitterSphere",{diameter:I.diameter,segments:I.segments},L);F.renderingGroupId=x;const X=new Zx.yx("emitterSphereMaterial",L);X.emissiveColor=I.color,F.material=X;for(const G of this.systems)G.Xx=F;this._emitterNode=F}start(I){for(const x of this.systems)I&&(x.Xx=I),x.start()}dispose(){for(const I of this.systems)I.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={systems:[]};for(const L of this.systems)x.systems.push(L.serialize(I));return this._emitterNode&&(x.Xx=this._emitterCreationOptions),x}static Parse(I,x){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3?arguments[3]:void 0;const X=new tx,G=this.BaseAssetsUrl+"/textures/";x=x||C.e.LastCreatedScene;for(const Y of I.systems)X.systems.push(L?qx.Parse(Y,x,G,!0,F):px.Parse(Y,x,G,!0,F));if(I.Xx){const L=I.Xx.options;if("Sphere"===I.Xx.kind)X.setEmitterAsSphere({diameter:L.diameter,segments:L.segments,color:Y.Tx.tx(L.color)},I.Xx.renderingGroupId,x)}return X}}tx.BaseAssetsUrl="https://assets.babylonjs.com/particles";var fx=L(12832);class Rx{static CreateDefault(I){let x,L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,F=arguments.length>2?arguments[2]:void 0;x=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new qx("default system",{tL:L},F):new px("default system",L,F),x.Xx=I;const X=yx.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return x.particleTexture=new mI.d(X,x.tI()),x.createConeEmitter(.1,Math.PI/4),x.color1=new Y.lB(1,1,1,1),x.color2=new Y.lB(1,1,1,1),x.colorDead=new Y.lB(1,1,1,0),x.minSize=.1,x.maxSize=.1,x.minEmitPower=2,x.maxEmitPower=2,x.updateSpeed=1/60,x.emitRate=30,x}static CreateAsync(I,x){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3?arguments[3]:void 0;x||(x=C.e.LastCreatedScene);const X={};return x.addPendingData(X),new Promise(((G,Y)=>{if(L&&!qx.IsSupported)return x.removePendingData(X),Y("Particle system with GPU is not supported.");yx.Tools.LoadFile(`${Rx.BaseAssetsUrl}/systems/${I}.json`,(I=>{x.removePendingData(X);const Y=JSON.parse(I.toString());return G(tx.Parse(Y,x,L,F))}),void 0,void 0,void 0,(()=>(x.removePendingData(X),Y(`An error occurred with the creation of your particle system. Check if your type '${I}' exists.`))))}))}static ExportSet(I){const x=new tx;for(const L of I)x.systems.push(L);return x}static ParseFromFileAsync(I,x,L){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",G=arguments.length>5?arguments[5]:void 0;return new Promise(((Y,p)=>{const B=new fx.d;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const x=JSON.parse(B.responseText);let p;p=F?qx.Parse(x,L,X,!1,G):px.Parse(x,L,X,!1,G),I&&(p.name=I),Y(p)}else p("Unable to load the particle system")})),B.open("GET",x),B.send()}))}static ParseFromSnippetAsync(I,x){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",X=arguments.length>4?arguments[4]:void 0;if("_BLANK"===I){const I=this.CreateDefault(null);return I.start(),Promise.resolve(I)}return new Promise(((G,Y)=>{const p=new fx.d;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const Y=JSON.parse(JSON.parse(p.responseText).jsonPayload),B=JSON.parse(Y.particleSystem);let l;l=L?qx.Parse(B,x,F,!1,X):px.Parse(B,x,F,!1,X),l.snippetId=I,G(l)}else Y("Unable to load the snippet "+I)})),p.open("GET",this.SnippetUrl+"/"+I.replace(/#/g,"/")),p.send()}))}}Rx.BaseAssetsUrl=tx.BaseAssetsUrl,Rx.SnippetUrl="https://snippet.babylonjs.com",Rx.CreateFromSnippetAsync=Rx.ParseFromSnippetAsync;var nx=L(13426),Px=L(13252),dx=L(14174);(0,dx.d)(Px.e.NAME_PARTICLESYSTEM,((I,x,L,F)=>{const X=(0,dx.h)(Px.e.NAME_PARTICLESYSTEM);if(X&&void 0!==I.Gg&&null!==I.Gg)for(let G=0,Y=I.Gg.length;G<Y;G++){const Y=I.Gg[G];L.Gg.push(X(Y,x,F))}})),(0,dx.b)(Px.e.NAME_PARTICLESYSTEM,((I,x,L)=>{if(I.activeParticleCount){return qx.Parse(I,x,L)}return px.Parse(I,x,L)})),EI.d.prototype.createEffectForParticles=function(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",G=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0,B=arguments.length>7?arguments[7]:void 0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,W=arguments.length>9?arguments[9]:void 0,Q=[],e=[];const g=[];return B?B.fillUniformsAttributesAndSamplerNames(e,Q,g):(Q=px._GetAttributeNamesOrOptions(),e=px._GetEffectCreationOptions()),-1===X.indexOf(" BILLBOARD")&&(X+="\n#define BILLBOARD\n"),null!==B&&void 0!==B&&B.isAnimationSheetEnabled&&-1===X.indexOf(" ANIMATESHEET")&&(X+="\n#define ANIMATESHEET\n"),-1===F.indexOf("diffuseSampler")&&F.push("diffuseSampler"),this.createEffect({vertex:W??(null===B||void 0===B?void 0:B.vertexShaderName)??"particles",fragmentElement:I},Q,e.concat(x),g.concat(F),X,G,Y,p,void 0,l,(async()=>{0===l?await Promise.resolve().then(L.bind(L,14214)):await Promise.resolve().then(L.bind(L,14268))}))},nx.e.prototype.getEmittedParticleSystems=function(){const I=[];for(let x=0;x<this.tI().Gg.length;x++){const L=this.tI().Gg[x];L.Xx===this&&I.push(L)}return I},nx.e.prototype.getHierarchyEmittedParticleSystems=function(){const I=[],x=this.getDescendants();x.push(this);for(let L=0;L<this.tI().Gg.length;L++){const F=this.tI().Gg[L],X=F.Xx;X.position&&-1!==x.indexOf(X)&&I.push(F)}return I};L(13318),L(13327),L(13411);L(13415),L(14181),L(13182),L(13301),L(13448);L(13176);var Mx;L(14187),L(13004);!function(I){I[I.Color=2]="Color",I[I.UV=1]="UV",I[I.Random=0]="Random",I[I.Stated=3]="Stated"}(Mx||(Mx={}));var Kx=L(13209);const ux=new F.sx(0,0,0),Ax=new F.sx(0,0,0),mL=new F.sx(0,0,0);class Ox{constructor(I,x,L){this.width=I,this.height=x,this.data=L}processFlowable(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2?arguments[2]:void 0;if(!L)return;L instanceof F.Matrix?F.sx.TransformCoordinatesToRef(I.position,L,mL):(mL.x=L.x,mL.y=L.y,mL.z=L.z);const X=.5*mL.x+.5,G=1-(.5*mL.y+.5),Y=Math.floor(X*this.width),p=Math.floor(G*this.height);if(Y<0||Y>=this.width||p<0||p>=this.height)return;const B=4*(p*this.width+Y),l=this.data[B]/255*2-1,W=this.data[B+1]/255*2-1,Q=this.data[B+2]/255*2-1,e=this.data[B+3]/255;ux.set(l,W,Q),ux.scaleToRef(x*e,Ax),I.direction.addInPlace(Ax)}_processParticle(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2?arguments[2]:void 0;this.processFlowable(I,x,L)}static async FromUrlAsync(I){return await new Promise(((x,L)=>{const F=document.createElement("canvas"),X=F.getContext("2d");let G=null;const Y=new Image;Y.crossOrigin="anonymous",Y.src=I,Y.onerror=x=>{L(new Error(`Failed to load image: ${I} : ${x}`))},Y.onload=()=>{F.width=Y.width,F.height=Y.height,X.drawImage(Y,0,0),G=X.getImageData(0,0,F.width,F.height),x(new Ox(F.width,F.height,G.data))}}))}static async ExtractFromTextureAsync(I){return await new Promise(((x,L)=>{if(!I.isReady())return void I.onLoadObservable.addOnce((async()=>{try{const L=await this.ExtractFromTextureAsync(I);x(L)}catch(F){L(F)}}));const F=I.getSize();Kx.i.GetTextureDataAsync(I,F.width,F.height).then((I=>{x(new Ox(F.width,F.height,new Uint8ClampedArray(I)))})).catch(L)}))}}var wx,kx,ax,Dx,rx,Nx,Sx,cx,ox;!function(I){I[I.Int=1]="Int",I[I.Float=2]="Float",I[I.Vector2=4]="Vector2",I[I.sx=8]="sx",I[I.Matrix=16]="Matrix",I[I.Particle=32]="Particle",I[I.Texture=64]="Texture",I[I.lB=128]="lB",I[I.FloatGradient=256]="FloatGradient",I[I.Vector2Gradient=512]="Vector2Gradient",I[I.Vector3Gradient=1024]="Vector3Gradient",I[I.Color4Gradient=2048]="Color4Gradient",I[I.System=4096]="System",I[I.AutoDetect=8192]="AutoDetect",I[I.BasedOnInput=16384]="BasedOnInput",I[I.Undefined=32768]="Undefined",I[I.All=65535]="All"}(wx||(wx={})),function(I){I[I.Compatible=0]="Compatible",I[I.TypeIncompatible=1]="TypeIncompatible",I[I.HierarchyIssue=2]="HierarchyIssue"}(kx||(kx={})),function(I){I[I.Input=0]="Input",I[I.Output=1]="Output"}(ax||(ax={}));class Jx{get direction(){return this._direction}get type(){if(this._type===wx.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===wx.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(I){this._type=I}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((I=>I.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(I,x,L){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=wx.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new V.c,this.onDisconnectionObservable=new V.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=x,this.name=I,this._direction=L}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(I){var x;return this.isConnected?null!==(x=this._connectedPoint)&&void 0!==x&&x._storedFunction?this._connectedPoint._storedFunction(I):this._connectedPoint._storedValue:this.value}canConnectTo(I){return 0===this.checkCompatibilityState(I)}checkCompatibilityState(I){const x=this._ownerBlock,L=I.ownerBlock;if(this.type!==I.type&&I.innerType!==wx.AutoDetect)return I.acceptedConnectionPointTypes&&-1!==I.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(I.excludedConnectionPointTypes&&-1!==I.excludedConnectionPointTypes.indexOf(this.type))return 1;let F=L,X=x;return 0===this.direction&&(F=x,X=L),F.isAnAncestorOf(X)?2:0}connectTo(I){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(I))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${I.ownerBlock.name}".${I.name}`;return this._endpoints.push(I),I._connectedPoint=this,this.onConnectionObservable.notifyObservers(I),I.onConnectionObservable.notifyObservers(this),this}disconnectFrom(I){const x=this._endpoints.indexOf(I);return-1===x||(this._endpoints.splice(x,1),I._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(I),I.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(I){let x=1;for(;x<wx.All;)I&x||this.excludedConnectionPointTypes.push(x),x<<=1}serialize(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const x={};return x.name=this.name,x.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Cp?(x.valueType="BABYLON."+this.value.getClassName(),x.value=this.value.Cp()):(x.valueType="number",x.value=this.value)),I&&this.connectedPoint&&(x.inputName=this.name,x.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,x.targetConnectionName=this.connectedPoint.name,x.isExposedOnFrame=!0,x.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(x.isExposedOnFrame=!0,x.exposedPortPosition=this.exposedPortPosition),x}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class hx{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(I){this._name=I}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(I){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new V.c,this.cp=new V.c,this.onInputChangedObservable=new V.c,this.visibleOnFrame=!1,this._name=I,this.uniqueId=O.c.UniqueId}_inputRename(I){return I}_outputRename(I){return I}isAnAncestorOf(I){for(const x of this._outputs)if(x.hasEndpoints)for(const L of x.endpoints){if(L.ownerBlock===I)return!0;if(L.ownerBlock.isAnAncestorOf(I))return!0}return!1}isAnAncestorOfType(I){if(this.getClassName()===I)return!0;for(const x of this._outputs)if(x.hasEndpoints)for(const L of x.endpoints)if(L.ownerBlock.isAnAncestorOfType(I))return!0;return!1}getInputByName(I){const x=this._inputs.filter((x=>x.name===I));return x.length?x[0]:null}_linkConnectionTypes(I,x){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[x]._acceptedConnectionPointType=this._inputs[I]:(this._inputs[I]._linkedConnectionSource=this._inputs[x],this._inputs[I]._isMainLinkSource=!0),this._inputs[x]._linkedConnectionSource=this._inputs[I]}registerInput(I,x){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0;const Y=new Jx(I,this,0);return Y.type=x,Y.isOptional=L,Y.defaultValue=F,Y.value=F,Y.valueMin=X,Y.valueMax=G,this._inputs.push(Y),this.onInputChangedObservable.notifyObservers(Y),this}registerOutput(I,x,L){return(L=L??new Jx(I,this,1)).type=x,this._outputs.push(L),this}_build(I){}_customBuildStep(I){}build(I){if(this._buildId===I.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((I=>I.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=I.buildId;for(const x of this._inputs){if(!x.connectedPoint){x.isOptional||I.notConnectedNonOptionalInputs.push(x);continue}const L=x.connectedPoint.ownerBlock;L&&L!==this&&!L.isSystem&&L.build(I)}return this._customBuildStep(I),I.verbose&&w.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(I),this.onBuildObservable.notifyObservers(this),!1}serialize(){const I={};I.customType="BABYLON."+this.getClassName(),I.id=this.uniqueId,I.name=this.name,I.visibleOnFrame=this.visibleOnFrame,I.inputs=[],I.outputs=[];for(const x of this.inputs)I.inputs.push(x.serialize());for(const x of this.outputs)I.outputs.push(x.serialize(!1));return I}_deserialize(I){this._name=I.name,this.comments=I.comments,this.visibleOnFrame=!!I.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(I)}_deserializePortDisplayNamesAndExposedOnFrame(I){const x=I.inputs,L=I.outputs;if(x)for(const F of x){const I=this.inputs.find((I=>I.name===F.name));if(!I)return;if(F.displayName&&(I.displayName=F.displayName),F.isExposedOnFrame&&(I.isExposedOnFrame=F.isExposedOnFrame,I.exposedPortPosition=F.exposedPortPosition),void 0!==F.value&&null!==F.value)if("number"===F.valueType)I.value=F.value;else{const x=(0,p.b)(F.valueType);x&&(I.value=x.tx(F.value))}}if(L)for(let F=0;F<L.length;F++){const I=L[F];I.displayName&&(this.outputs[F].displayName=I.displayName),I.isExposedOnFrame&&(this.outputs[F].isExposedOnFrame=I.isExposedOnFrame,this.outputs[F].exposedPortPosition=I.exposedPortPosition)}}clone(){const I=this.serialize(),x=(0,p.b)(I.customType);if(x){const L=new x;return L._deserialize(I),L}return null}dispose(){this.cp.notifyObservers(this),this.cp.clear();for(const I of this.inputs)I.dispose();for(const I of this.outputs)I.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Ex(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",F=arguments.length>3?arguments[3]:void 0;return(X,G)=>{let Y=X._propStore;Y||(Y=[],X._propStore=Y),Y.push({propertyName:G,displayName:I,type:x,groupName:L,options:F??{},className:X.getClassName()})}}(0,K.d)([(0,u.K)("comment")],hx.prototype,"comments",void 0),function(I){I[I.Boolean=0]="Boolean",I[I.Float=1]="Float",I[I.Int=2]="Int",I[I.Vector2=3]="Vector2",I[I.List=4]="List",I[I.lB=5]="lB",I[I.SamplingMode=6]="SamplingMode",I[I.TextureFormat=7]="TextureFormat",I[I.TextureType=8]="TextureType"}(Dx||(Dx={})),function(I){I[I.None=0]="None",I[I.Position=1]="Position",I[I.Direction=2]="Direction",I[I.Age=3]="Age",I[I.Lifetime=4]="Lifetime",I[I.Color=5]="Color",I[I.ScaledDirection=6]="ScaledDirection",I[I.Scale=7]="Scale",I[I.AgeGradient=8]="AgeGradient",I[I.Angle=9]="Angle",I[I.SpriteCellIndex=16]="SpriteCellIndex",I[I.SpriteCellStart=17]="SpriteCellStart",I[I.SpriteCellEnd=18]="SpriteCellEnd"}(rx||(rx={})),function(I){I[I.None=0]="None",I[I.Time=1]="Time",I[I.Delta=2]="Delta",I[I.Emitter=3]="Emitter"}(Nx||(Nx={}));class ix{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let I="";for(const x of this.notConnectedNonOptionalInputs)I+=`input ${x.name} from block ${x.ownerBlock.name}[${x.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(I)throw"Build of Node Particle System Set failed:\n"+I}adapt(I,x){const L=I.getConnectedValue(this)||0;if(I.type===x)return L;switch(x){case wx.Vector2:return new F.Vector2(L,L);case wx.sx:return new F.sx(L,L,L);case wx.lB:return new Y.lB(L,L,L,L)}return null}getContextualValue(I){if(!this.particleContext||!this.systemContext)return null;switch(I){case rx.Position:return this.particleContext.position;case rx.Direction:return this.particleContext.direction;case rx.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case rx.Color:return this.particleContext.color;case rx.Age:return this.particleContext.age;case rx.Lifetime:return this.particleContext.lifeTime;case rx.Angle:return this.particleContext.angle;case rx.Scale:return this.particleContext.scale;case rx.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case rx.SpriteCellEnd:return this.systemContext.endSpriteCellID;case rx.SpriteCellIndex:return this.particleContext.cellIndex;case rx.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Xx.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Xx.absolutePosition:this.systemContext.Xx:null}getSystemValue(I){if(!this.particleContext||!this.systemContext)return null;switch(I){case Nx.Time:return this.systemContext._actualFrame;case Nx.Delta:return this.systemContext._scaledUpdateSpeed;case Nx.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Xx.absolutePosition}return this.systemContext.Xx}return null}}function Vx(I,x,L){const F=new ix;F.qx=x;const X=I.createSystem(F);return X.canStart=()=>!0,X.Xx=L.clone(),X.disposeOnStop=!0,X.start(),X}class jx extends hx{constructor(I){super(I),this.blendMode=B.BLENDMODE_ONEONE,this.tL=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",wx.Particle),this.registerInput("texture",wx.Texture),this.registerInput("onStart",wx.System,!0),this.registerInput("onEnd",wx.System,!0),this.registerOutput("system",wx.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(I){I.tL=this.tL,I.buildId=this._buildId++,this.build(I);const x=this.particle.getConnectedValue(I);return x.particleTexture=this.texture.getConnectedValue(I),x.emitRate=this.emitRate,x.blendMode=this.blendMode,x.name=this.name,x._nodeGenerated=!0,x._targetStopDuration=this.targetStopDuration,x.startDelay=this.startDelay,this.system._storedValue=this,x.canStart=()=>!this.doNoStart,x.onStartedObservable.add((L=>{const F=this.onStart.getConnectedValue(I);F&&L.onStartedObservable.addOnce((()=>{I.systemContext=x;const L=Vx(F,I.qx,I.emitterPosition);this.cp.addOnce((()=>{L.dispose()}))}));const X=this.onEnd.getConnectedValue(I);X&&L.onStoppedObservable.addOnce((()=>{I.systemContext=x;const L=Vx(X,I.qx,I.emitterPosition);this.cp.addOnce((()=>{L.dispose()}))}))})),this.cp.addOnce((()=>{x.dispose()})),x}serialize(){const I=super.serialize();return I.tL=this.tL,I.emitRate=this.emitRate,I.blendMode=this.blendMode,I.doNoStart=this.doNoStart,I.targetStopDuration=this.targetStopDuration,I.startDelay=this.startDelay,I}_deserialize(I){super._deserialize(I),this.tL=I.tL,this.emitRate=I.emitRate,this.doNoStart=!!I.doNoStart,void 0!==I.blendMode&&(this.blendMode=I.blendMode),void 0!==I.targetStopDuration&&(this.targetStopDuration=I.targetStopDuration),void 0!==I.startDelay&&(this.startDelay=I.startDelay)}}(0,K.d)([Ex("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:B.BLENDMODE_ONEONE},{label:"Standard",value:B.BLENDMODE_STANDARD},{label:"Add",value:B.BLENDMODE_ADD},{label:"Multiply",value:B.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:B.BLENDMODE_MULTIPLYADD}]})],jx.prototype,"blendMode",void 0),(0,K.d)([Ex("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],jx.prototype,"tL",void 0),(0,K.d)([Ex("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jx.prototype,"emitRate",void 0),(0,K.d)([Ex("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jx.prototype,"targetStopDuration",void 0),(0,K.d)([Ex("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jx.prototype,"startDelay",void 0),(0,K.d)([Ex("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],jx.prototype,"doNoStart",void 0),(0,p.d)("BABYLON.SystemBlock",jx);class Cx extends hx{get type(){if(this._type===wx.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=wx.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=wx.Vector2,this._type;case"sx":return this._type=wx.sx,this._type;case"lB":return this._type=wx.lB,this._type;case"Matrix":return this._type=wx.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===rx.None&&this._systemSource!==Nx.None}get systemSource(){return this._systemSource}set systemSource(I){if(this._systemSource=I,I!==Nx.None){switch(this._contextualSource=rx.None,this._type=wx.Float,I){case Nx.Time:case Nx.Delta:this._type=wx.Float;break;case Nx.Emitter:this._type=wx.sx}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==rx.None}get contextualValue(){return this._contextualSource}set contextualValue(I){if(this._contextualSource=I,I!==rx.None){switch(this._systemSource=Nx.None,I){case rx.Scale:this._type=wx.Vector2;break;case rx.Position:case rx.Direction:case rx.ScaledDirection:this._type=wx.sx;break;case rx.Color:this._type=wx.lB;break;case rx.Age:case rx.Lifetime:case rx.Angle:case rx.AgeGradient:this._type=wx.Float;break;case rx.SpriteCellEnd:case rx.SpriteCellStart:case rx.SpriteCellIndex:this._type=wx.Int}this.output&&(this.output.type=this._type)}}constructor(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wx.AutoDetect;super(I),this._type=wx.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new V.c,this._systemSource=Nx.None,this._contextualSource=rx.None,this._type=x,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",x)}get value(){return this._storedValue}set value(I){this.type===wx.Float&&this.min!==this.max&&(I=Math.max(this.min,I),I=Math.min(this.max,I)),this._storedValue=I,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(I){this._valueCallback=I}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case wx.Int:case wx.Float:this.value=0;break;case wx.Vector2:this.value=F.Vector2.Zero();break;case wx.sx:this.value=F.sx.Zero();break;case wx.lB:this.value=new Y.lB(1,1,1,1);break;case wx.Matrix:this.value=F.Matrix.Identity()}}_build(I){super._build(I),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=I=>I.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=I=>I.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const I=super.serialize();return I.type=this.type,I.contextualValue=this.contextualValue,I.systemSource=this.systemSource,I.min=this.min,I.max=this.max,I.groupInInspector=this.groupInInspector,I.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Cp?(I.valueType="BABYLON."+this._storedValue.getClassName(),I.value=this._storedValue.Cp()):(I.valueType="number",I.value=this._storedValue)),I}_deserialize(I){if(super._deserialize(I),this._type=I.type,this.contextualValue=I.contextualValue,this.systemSource=I.systemSource||Nx.None,this.min=I.min||0,this.max=I.max||0,this.groupInInspector=I.groupInInspector||"",void 0!==I.displayInInspector&&(this.displayInInspector=I.displayInInspector),I.valueType)if("number"===I.valueType)this._storedValue=I.value;else{const x=(0,p.b)(I.valueType);x&&(this._storedValue=x.tx(I.value))}}}(0,p.d)("BABYLON.ParticleInputBlock",Cx);class bx extends hx{get url(){return this._url}set url(I){this._url!==I&&(this._cachedData=null,this._url=I,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(I){this._textureDataUrl!==I&&(this._cachedData=null,this._textureDataUrl=I,this._url="",this._sourceTexture=null)}set sourceTexture(I){this._sourceTexture!==I&&(this._cachedData=null,this._sourceTexture=I,this._url="",this._textureDataUrl="")}constructor(I){super(I),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",wx.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const I=this.texture._storedValue;return await new Promise(((x,L)=>{if(!I.isReady())return void I.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),x(this._cachedData)}catch(I){L(I)}}));const F=I.getSize();Kx.i.GetTextureDataAsync(I,F.width,F.height).then((L=>{this._cachedData={width:F.width,height:F.height,data:new Uint8ClampedArray(L)},I.dispose(),x(this._cachedData)})).catch(L)}))}_build(I){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new mI.d(this._textureDataUrl,I.qx):this.texture._storedValue=new mI.d(this._url,I.qx):this.texture._storedValue=null}serialize(){const I=super.serialize();return I.url=this.url,I.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(I.textureDataUrl=this.textureDataUrl),I}_deserialize(I){super._deserialize(I),this.url=I.url,this.serializedCachedData=!!I.serializedCachedData,I.textureDataUrl&&(this.textureDataUrl=I.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,p.d)("BABYLON.ParticleTextureSourceBlock",bx);class IL extends hx{constructor(I){super(I),this.registerInput("particle",wx.Particle),this.registerInput("position",wx.sx),this.registerOutput("output",wx.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(I){const x=this.particle.getConnectedValue(I);if(this.output._storedValue=x,!this.position.isConnected)return;const L={process:L=>{I.particleContext=L,I.systemContext=x,L.position.X(this.position.getConnectedValue(I))},previousItem:null,nextItem:null};x._updateQueueStart?NI(L,x._updateQueueStart):x._updateQueueStart=L}}(0,p.d)("BABYLON.UpdatePositionBlock",IL),function(I){I[I.Add=0]="Add",I[I.Subtract=1]="Subtract",I[I.Multiply=2]="Multiply",I[I.Divide=3]="Divide",I[I.Max=4]="Max",I[I.Min=5]="Min"}(Sx||(Sx={}));class xL extends hx{constructor(I){super(I),this.operation=Sx.Add,this.registerInput("left",wx.AutoDetect),this.registerInput("right",wx.AutoDetect),this.registerOutput("output",wx.BasedOnInput),this.output._typeConnectionSource=this.left;const x=[wx.Matrix,wx.Particle,wx.Texture,wx.System,wx.FloatGradient,wx.Color4Gradient,wx.Vector2Gradient,wx.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...x),this.right.excludedConnectionPointTypes.push(...x),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(I){let x;const L=this.left,X=this.right;if(!L.isConnected||!X.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const G=L.type===wx.Float||L.type===wx.Int,p=X.type===wx.Float||X.type===wx.Int,B=G&&p;switch(this.operation){case Sx.Add:x=B?I=>L.getConnectedValue(I)+X.getConnectedValue(I):G?I=>I.adapt(L,X.type).add(X.getConnectedValue(I)):I=>L.getConnectedValue(I).add(I.adapt(X,L.type));break;case Sx.Subtract:x=B?I=>L.getConnectedValue(I)-X.getConnectedValue(I):G?I=>I.adapt(L,X.type).Ux(X.getConnectedValue(I)):I=>L.getConnectedValue(I).Ux(I.adapt(X,L.type));break;case Sx.Multiply:x=B?I=>L.getConnectedValue(I)*X.getConnectedValue(I):G?I=>I.adapt(L,X.type).multiply(X.getConnectedValue(I)):I=>L.getConnectedValue(I).multiply(I.adapt(X,L.type));break;case Sx.Divide:x=B?I=>L.getConnectedValue(I)/X.getConnectedValue(I):G?I=>I.adapt(L,X.type).divide(X.getConnectedValue(I)):I=>L.getConnectedValue(I).divide(I.adapt(X,L.type));break;case Sx.Min:if(B)x=I=>Math.min(L.getConnectedValue(I),X.getConnectedValue(I));else{const[I,p]=G?[X,L]:[L,X];switch(I.type){case wx.Vector2:x=x=>F.Vector2.Minimize(I.getConnectedValue(x),x.adapt(p,I.type));break;case wx.sx:x=x=>F.sx.Minimize(I.getConnectedValue(x),x.adapt(p,I.type));break;case wx.lB:x=x=>{const L=I.getConnectedValue(x),{r:F,g:X,b:G,a:B}=x.adapt(p,I.type);return new Y.lB(Math.min(L.r,F),Math.min(L.g,X),Math.min(L.b,G),Math.min(L.a,B))}}}break;case Sx.Max:if(!B){const[I,p]=G?[X,L]:[L,X];switch(I.type){case wx.Vector2:x=x=>F.Vector2.Maximize(I.getConnectedValue(x),x.adapt(p,I.type));break;case wx.sx:x=x=>F.sx.Maximize(I.getConnectedValue(x),x.adapt(p,I.type));break;case wx.lB:x=x=>{const L=I.getConnectedValue(x),{r:F,g:X,b:G,a:B}=x.adapt(p,I.type);return new Y.lB(Math.max(L.r,F),Math.min(L.g,X),Math.min(L.b,G),Math.min(L.a,B))}}break}x=I=>Math.max(L.getConnectedValue(I),X.getConnectedValue(I))}this.output._storedFunction=I=>L.type===wx.Int?0|x(I):x(I)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===wx.Int||this.left.type===wx.Float&&this.right.type!==wx.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[I,x]of[[this.left,this.right],[this.right,this.left]])I.acceptedConnectionPointTypes=[wx.Int,wx.Float],x.isConnected&&(I.acceptedConnectionPointTypes.push(x.type),x.type!==wx.Int&&x.type!==wx.Float||I.acceptedConnectionPointTypes.push(wx.Vector2,wx.sx,wx.lB))}dispose(){super.dispose();for(const I of this._connectionObservers)I.remove();this._connectionObservers.length=0}serialize(){const I=super.serialize();return I.operation=this.operation,I}_deserialize(I){super._deserialize(I),this.operation=I.operation}}(0,K.d)([Ex("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Sx.Add},{label:"Subtract",value:Sx.Subtract},{label:"Multiply",value:Sx.Multiply},{label:"Divide",value:Sx.Divide},{label:"Max",value:Sx.Max},{label:"Min",value:Sx.Min}]})],xL.prototype,"operation",void 0),(0,p.d)("BABYLON.ParticleMathBlock",xL);class LL extends hx{constructor(I){super(I),this.registerInput("particle",wx.Particle),this.registerInput("direction1",wx.sx,!0,new F.sx(0,1,0)),this.registerInput("direction2",wx.sx,!0,new F.sx(0,1,0)),this.registerInput("minEmitBox",wx.sx,!0,new F.sx(-.5,-.5,-.5)),this.registerInput("maxEmitBox",wx.sx,!0,new F.sx(.5,.5,.5)),this.registerOutput("output",wx.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(I){const x=this.particle.getConnectedValue(I);x._directionCreation.process=L=>{I.particleContext=L,I.systemContext=x;const X=this.direction1.getConnectedValue(I),G=this.direction2.getConnectedValue(I),Y=(0,l.RandomRange)(X.x,G.x),p=(0,l.RandomRange)(X.y,G.y),B=(0,l.RandomRange)(X.z,G.z);I.isEmitterTransformNode?F.sx.TransformNormalFromFloatsToRef(Y,p,B,I.emitterWorldMatrix,L.direction):L.direction.YB(Y,p,B)},x._positionCreation.process=L=>{I.particleContext=L,I.systemContext=x;const X=this.minEmitBox.getConnectedValue(I),G=this.maxEmitBox.getConnectedValue(I),Y=(0,l.RandomRange)(X.x,G.x),p=(0,l.RandomRange)(X.y,G.y),B=(0,l.RandomRange)(X.z,G.z);I.isEmitterTransformNode?F.sx.TransformCoordinatesFromFloatsToRef(Y,p,B,I.emitterWorldMatrix,L.position):(L.position.YB(Y,p,B),L.position.addInPlace(I.emitterPosition))},this.output._storedValue=x}}(0,p.d)("BABYLON.BoxShapeBlock",LL);class FL extends hx{constructor(I){super(I),this.registerInput("emitPower",wx.Float,!0,1),this.registerInput("lifeTime",wx.Float,!0,1),this.registerInput("color",wx.lB,!0,new Y.lB(1,1,1,1)),this.registerInput("scale",wx.Vector2,!0,new F.Vector2(1,1)),this.registerInput("angle",wx.Float,!0,0),this.registerOutput("particle",wx.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(I){const x=new px(this.name,I.tL,I.qx,null,!1,void 0,!0);x.particleEmitterType=new s,x._lifeTimeCreation.process=(x,L)=>{I.particleContext=x,x.lifeTime=this.lifeTime.getConnectedValue(I),L._emitPower=this.emitPower.getConnectedValue(I)},x._colorCreation.process=x=>{I.particleContext=x,x.color.X(this.color.getConnectedValue(I))},x._sizeCreation.process=x=>{I.particleContext=x,x.size=1,x.scale.X(this.scale.getConnectedValue(I))},x._angleCreation.process=x=>{I.particleContext=x,x.angle=this.angle.getConnectedValue(I)},this.particle._storedValue=x}}(0,p.d)("BABYLON.CreateParticleBlock",FL);class XL{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const I=[];for(const x of this.attachedBlocks)x.isInput&&I.push(x);return I}constructor(I){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new V.c,this.name=I}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(I){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(I)&&this.attachedBlocks.push(I);for(const L of I.inputs){const F=L.connectedPoint;if(F){const L=F.ownerBlock;L!==I&&this._initializeBlock(L,x)}}}async buildAsync(I){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((L=>{const F=new tx;for(const I of this._systemBlocks)this._initializeBlock(I);for(const X of this.systemBlocks){const L=new ix;L.buildId=this._buildId++,L.qx=I,L.verbose=x;const G=X.createSystem(L);L.emitErrors(),F.systems.push(G)}this.onBuildObservable.notifyObservers(this),L(F)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const I=new jx("Particle system"),x=new IL("Update position");x.output.connectTo(I.particle);const L=new Cx("Position");L.contextualValue=rx.Position;const F=new Cx("Scaled direction");F.contextualValue=rx.ScaledDirection;const X=new xL("Add");X.operation=Sx.Add,L.output.connectTo(X.left),F.output.connectTo(X.right),X.output.connectTo(x.position);const G=new FL("Create particle"),Y=new LL("Box shape");G.particle.connectTo(Y.particle),Y.output.connectTo(x.particle);const p=new bx("Texture");p.texture.connectTo(I.texture),p.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(I)}removeBlock(I){const x=this.attachedBlocks.indexOf(I);if(x>-1&&this.attachedBlocks.splice(x,1),I.isSystem){const x=this._systemBlocks.indexOf(I);x>-1&&this._systemBlocks.splice(x,1)}}parseSerializedObject(I){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];x||this.clear();const L={};for(const F of I.VW){const I=(0,p.b)(F.customType);if(I){const x=new I;x._deserialize(F),L[F.id]=x,this.attachedBlocks.push(x),x.isSystem&&this._systemBlocks.push(x)}}for(const F of this.attachedBlocks)if(F.isTeleportOut){const I=F,x=I._tempEntryPointUniqueId;if(x){const F=L[x];F&&F.attachToEndpoint(I)}}for(let F=0;F<I.VW.length;F++){const X=I.VW[F],G=L[X.id];G&&(G.inputs.length&&X.inputs.some((I=>I.targetConnectionName))&&!x||this._restoreConnections(G,I,L))}if(I.locations||I.editorData&&I.editorData.locations){const F=I.locations||I.editorData.locations;for(const I of F)L[I.CX]&&(I.CX=L[I.CX].uniqueId);x&&this.editorData&&this.editorData.locations&&F.concat(this.editorData.locations),I.locations?this.editorData={locations:F}:(this.editorData=I.editorData,this.editorData.locations=F);const X=[];for(const I in L)X[I]=L[I].uniqueId;this.editorData.map=X}this.comment=I.comment}_restoreConnections(I,x,L){for(const F of I.outputs)for(const X of x.VW){const G=L[X.id];if(G)for(const Y of X.inputs)if(L[Y.targetBlockId]!==I||Y.targetConnectionName!==F.name);else{const I=G.getInputByName(Y.inputName);if(!I||I.isConnected)continue;F.connectTo(I,!0),this._restoreConnections(G,x,L)}}}serialize(I){const x=I?{}:A.c.Serialize(this);x.editorData=JSON.parse(JSON.stringify(this.editorData));let L=[];I?L=I:x.customType="BABYLON.NodeParticleSystemSet",x.VW=[];for(const F of L)x.VW.push(F.serialize());if(!I)for(const F of this.attachedBlocks)-1===L.indexOf(F)&&x.VW.push(F.serialize());return x}dispose(){for(const I of this.attachedBlocks)I.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(I){const x=new XL(I);return x.setToDefault(),x}static Parse(I){const x=A.c.Parse((()=>new XL(I.name)),I,null);return x.parseSerializedObject(I),x}static ParseFromSnippetAsync(I,x){return"_BLANK"===I?Promise.resolve(XL.CreateDefault("blank")):new Promise(((L,F)=>{const X=new fx.d;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const Y=JSON.parse(JSON.parse(X.responseText).jsonPayload),p=JSON.parse(Y.nodeParticle);x||(x=A.c.Parse((()=>new XL(I)),p,null)),x.parseSerializedObject(p),x.snippetId=I;try{L(x)}catch(G){F(G)}}else F("Unable to load the snippet "+I)})),X.open("GET",this.SnippetUrl+"/"+I.replace(/#/g,"/")),X.send()}))}}XL.EditorURL=`${yx.Tools._DefaultCdnUrl}/v${EI.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,XL.SnippetUrl="https://snippet.babylonjs.com",(0,K.d)([(0,u.K)()],XL.prototype,"name",void 0),(0,K.d)([(0,u.K)("comment")],XL.prototype,"comment",void 0),function(I){I[I.None=0]="None",I[I.PerParticle=1]="PerParticle",I[I.PerSystem=2]="PerSystem"}(cx||(cx={}));class GL extends hx{constructor(I){super(I),this._currentLockId=-2,this.lockMode=cx.PerParticle,this.registerInput("min",wx.AutoDetect,!0,0),this.registerInput("max",wx.AutoDetect,!0,1),this.registerOutput("output",wx.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wx.Float|wx.Int|wx.Vector2|wx.sx|wx.lB),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(wx.Float|wx.Int|wx.Vector2|wx.sx|wx.lB),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=wx.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let I=null;switch(this._currentLockId=-2,this.min.type){case wx.AutoDetect:case wx.Int:case wx.Float:I=I=>{const x=this.min.getConnectedValue(I)||0,L=this.max.getConnectedValue(I)||1;return x+Math.random()*(L-x)};break;case wx.Vector2:I=I=>{const x=this.min.getConnectedValue(I)||F.Vector2.Zero(),L=this.max.getConnectedValue(I)||F.Vector2.One();return new F.Vector2(x.x+Math.random()*(L.x-x.x),x.y+Math.random()*(L.y-x.y))};break;case wx.sx:I=I=>{const x=this.min.getConnectedValue(I)||F.sx.Zero(),L=this.max.getConnectedValue(I)||F.sx.One();return new F.sx(x.x+Math.random()*(L.x-x.x),x.y+Math.random()*(L.y-x.y),x.z+Math.random()*(L.z-x.z))};break;case wx.lB:I=I=>{const x=this.min.getConnectedValue(I)||new Y.lB(0,0,0,0),L=this.max.getConnectedValue(I)||new Y.lB(1,1,1,1);return new Y.lB(x.x+Math.random()*(L.x-x.x),x.y+Math.random()*(L.y-x.y),x.z+Math.random()*(L.z-x.z),x.w+Math.random()*(L.w-x.w))}}this.output._storedFunction=x=>{var L;let F=0;switch(this.lockMode){case cx.PerParticle:F=(null===(L=x.particleContext)||void 0===L?void 0:L.id)||-1;break;case cx.PerSystem:F=x.buildId||0}return this._currentLockId!==F&&(this.lockMode!==cx.None&&(this._currentLockId=F),this.output._storedValue=I(x)),this.output._storedValue}}serialize(){const I=super.serialize();return I.lockMode=this.lockMode,I}_deserialize(I){super._deserialize(I),this.lockMode=I.lockMode}}(0,K.d)([Ex("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:cx.None},{label:"Per particle",value:cx.PerParticle},{label:"Per system",value:cx.PerSystem}]})],GL.prototype,"lockMode",void 0),(0,p.d)("BABYLON.ParticleRandomBlock",GL);class YL extends hx{constructor(I){super(I),this._currentLockId=-2,this.lockMode=cx.PerParticle,this.registerInput("min",wx.AutoDetect),this.registerInput("max",wx.AutoDetect),this.registerOutput("output",wx.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const x=[wx.Matrix,wx.Particle,wx.Texture,wx.System,wx.FloatGradient,wx.Color4Gradient,wx.Vector2Gradient,wx.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...x),this.max.excludedConnectionPointTypes.push(...x)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let I=null;switch(this._currentLockId=-2,this.min.type){case wx.Float:case wx.Int:I=I=>{const x=this.min.getConnectedValue(I),L=this.max.getConnectedValue(I);return Math.random()*(L-x)+x};break;case wx.Vector2:I=I=>{const x=this.min.getConnectedValue(I),L=this.max.getConnectedValue(I);return new F.Vector2(Math.random()*(L.x-x.x)+x.x,Math.random()*(L.y-x.y)+x.y)};break;case wx.sx:I=I=>{const x=this.min.getConnectedValue(I),L=this.max.getConnectedValue(I);return new F.sx(Math.random()*(L.x-x.x)+x.x,Math.random()*(L.y-x.y)+x.y,Math.random()*(L.z-x.z)+x.z)};break;case wx.lB:I=I=>{const x=this.min.getConnectedValue(I),L=this.max.getConnectedValue(I);return new Y.lB(Math.random()*(L.r-x.r)+x.r,Math.random()*(L.g-x.g)+x.g,Math.random()*(L.b-x.b)+x.b,Math.random()*(L.a-x.a)+x.a)}}this.output._storedFunction=x=>{var L;let F=0;switch(this.lockMode){case cx.PerParticle:F=(null===(L=x.particleContext)||void 0===L?void 0:L.id)||-1;break;case cx.PerSystem:F=x.buildId||0}return this._currentLockId!==F&&(this.lockMode!==cx.None&&(this._currentLockId=F),this.output._storedValue=I(x)),this.output._storedValue}}serialize(){const I=super.serialize();return I.lockMode=this.lockMode,I}_deserialize(I){super._deserialize(I),void 0!==I.lockMode&&(this.lockMode=I.lockMode)}}(0,K.d)([Ex("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:cx.None},{label:"Per particle",value:cx.PerParticle},{label:"Per system",value:cx.PerSystem}]})],YL.prototype,"lockMode",void 0),(0,p.d)("BABYLON.RandomRangeBlock",YL);(0,p.d)("BABYLON.ParticleLerpBlock",class extends hx{constructor(I){super(I),this.registerInput("left",wx.AutoDetect),this.registerInput("right",wx.AutoDetect),this.registerInput("gradient",wx.Float,!0,0,0,1),this.registerOutput("output",wx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wx.Float|wx.Int|wx.Vector2|wx.sx|wx.lB)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const I=(I,x,L)=>(1-I)*x+I*L;this.output._storedFunction=x=>{const L=this.left.getConnectedValue(x),X=this.right.getConnectedValue(x),G=this.gradient.getConnectedValue(x);switch(this.left.type){case wx.Int:case wx.Float:return I(G,L,X);case wx.Vector2:return new F.Vector2(I(G,L.x,X.x),I(G,L.y,X.y));case wx.sx:return new F.sx(I(G,L.x,X.x),I(G,L.y,X.y),I(G,L.z,X.z));case wx.lB:return new Y.lB(I(G,L.r,X.r),I(G,L.g,X.g),I(G,L.b,X.b),I(G,L.a,X.a))}return 0}}});(0,p.d)("BABYLON.UpdateDirectionBlock",class extends hx{constructor(I){super(I),this.registerInput("particle",wx.Particle),this.registerInput("direction",wx.sx),this.registerOutput("output",wx.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(I){const x=this.particle.getConnectedValue(I);if(this.output._storedValue=x,!this.direction.isConnected)return;const L={process:L=>{I.particleContext=L,I.systemContext=x,L.direction.X(this.direction.getConnectedValue(I))},previousItem:null,nextItem:null};x._updateQueueStart?NI(L,x._updateQueueStart):x._updateQueueStart=L}});(0,p.d)("BABYLON.UpdateColorBlock",class extends hx{constructor(I){super(I),this.registerInput("particle",wx.Particle),this.registerInput("color",wx.lB),this.registerOutput("output",wx.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(I){const x=this.particle.getConnectedValue(I);if(this.output._storedValue=x,!this.color.isConnected)return;const L={process:L=>{I.particleContext=L,I.systemContext=x,L.color.X(this.color.getConnectedValue(I))},previousItem:null,nextItem:null};x._updateQueueStart?NI(L,x._updateQueueStart):x._updateQueueStart=L}});(0,p.d)("BABYLON.UpdateScaleBlock",class extends hx{constructor(I){super(I),this.registerInput("particle",wx.Particle),this.registerInput("scale",wx.Vector2),this.registerOutput("output",wx.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(I){const x=this.particle.getConnectedValue(I);if(this.output._storedValue=x,!this.scale.isConnected)return;const L={process:L=>{I.particleContext=L,I.systemContext=x,L.scale.X(this.scale.getConnectedValue(I))},previousItem:null,nextItem:null};x._updateQueueStart?NI(L,x._updateQueueStart):x._updateQueueStart=L}});(0,p.d)("BABYLON.UpdateAngleBlock",class extends hx{constructor(I){super(I),this.registerInput("particle",wx.Particle),this.registerInput("angle",wx.Float),this.registerOutput("output",wx.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(I){const x=this.particle.getConnectedValue(I);if(this.output._storedValue=x,!this.angle.isConnected)return;const L={process:L=>{I.particleContext=L,I.systemContext=x,L.angle=this.angle.getConnectedValue(I)},previousItem:null,nextItem:null};x._updateQueueStart?NI(L,x._updateQueueStart):x._updateQueueStart=L}});(0,p.d)("BABYLON.BasicPositionUpdateBlock",class extends hx{constructor(I){super(I),this.registerInput("particle",wx.Particle),this.registerOutput("output",wx.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(I){const x=this.particle.getConnectedValue(I),L={process:L=>{I.particleContext=L,I.systemContext=x,L.direction.scaleToRef(x._directionScale,x._scaledDirection),L.position.addInPlace(x._scaledDirection)},previousItem:null,nextItem:null};x._updateQueueStart?NI(L,x._updateQueueStart):x._updateQueueStart=L,this.output._storedValue=x}});(0,p.d)("BABYLON.BasicSpriteUpdateBlock",class extends hx{constructor(I){super(I),this.registerInput("particle",wx.Particle),this.registerOutput("output",wx.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(I){const x=this.particle.getConnectedValue(I),L={process:L=>{I.particleContext=L,I.systemContext=x,L.updateCellIndex()},previousItem:null,nextItem:null};x._updateQueueStart?NI(L,x._updateQueueStart):x._updateQueueStart=L,this.output._storedValue=x}});(0,p.d)("BABYLON.UpdateSpriteCellIndexBlock",class extends hx{constructor(I){super(I),this.registerInput("particle",wx.Particle),this.registerInput("cellIndex",wx.Int),this.registerOutput("output",wx.Particle),this.cellIndex.acceptedConnectionPointTypes=[wx.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(I){const x=this.particle.getConnectedValue(I);if(this.output._storedValue=x,!this.cellIndex.isConnected)return;const L={process:L=>{I.particleContext=L,I.systemContext=x,L.cellIndex=Math.floor(this.cellIndex.getConnectedValue(I))},previousItem:null,nextItem:null};x._updateQueueStart?NI(L,x._updateQueueStart):x._updateQueueStart=L}});class pL extends hx{constructor(I){super(I),this.strength=1,this.registerInput("particle",wx.Particle),this.registerInput("flowMap",wx.Texture),this.registerOutput("output",wx.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(I){var x;const L=this.particle.getConnectedValue(I),F=I.qx;let X;(null===(x=this.flowMap.connectedPoint)||void 0===x?void 0:x.ownerBlock).extractTextureContentAsync().then((I=>{I&&(X=new Ox(I.width,I.height,I.data))}));const G={process:I=>{const x=F.getTransformMatrix();X&&X._processParticle(I,this.strength*L._tempScaledUpdateSpeed,x)},previousItem:null,nextItem:null};L._updateQueueStart?NI(G,L._updateQueueStart):L._updateQueueStart=G,this.output._storedValue=L}serialize(){const I=super.serialize();return I.strength=this.strength,I}_deserialize(I){super._deserialize(I),this.strength=I.strength}}(0,K.d)([Ex("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pL.prototype,"strength",void 0),(0,p.d)("BABYLON.UpdateFlowMapBlock",pL);(0,p.d)("BABYLON.SphereShapeBlock",class extends hx{constructor(I){super(I),this.registerInput("input",wx.Particle),this.registerInput("radius",wx.Float,!0,1),this.registerInput("radiusRange",wx.Float,!0,1,0,1),this.registerInput("directionRandomizer",wx.Float,!0,0,0,1),this.registerOutput("output",wx.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(I){const x=this.input.getConnectedValue(I);x._directionCreation.process=L=>{I.particleContext=L,I.systemContext=x;const X=this.directionRandomizer.getConnectedValue(I),G=L.position.Ux(I.emitterPosition).normalize(),Y=(0,l.RandomRange)(0,X),p=(0,l.RandomRange)(0,X),B=(0,l.RandomRange)(0,X);G.x+=Y,G.y+=p,G.z+=B,G.normalize(),I.isEmitterTransformNode?F.sx.TransformNormalFromFloatsToRef(Y,p,B,I.emitterWorldMatrix,L.direction):L.direction.YB(Y,p,B)},x._positionCreation.process=L=>{I.particleContext=L,I.systemContext=x;const X=this.radius.getConnectedValue(I),G=this.radiusRange.getConnectedValue(I),Y=X-(0,l.RandomRange)(0,X*G),p=(0,l.RandomRange)(0,1),B=(0,l.RandomRange)(0,2*Math.PI),W=Math.acos(2*p-1),Q=Y*Math.cos(B)*Math.sin(W),e=Y*Math.cos(W),g=Y*Math.sin(B)*Math.sin(W);I.isEmitterTransformNode?F.sx.TransformCoordinatesFromFloatsToRef(Q,e,g,I.emitterWorldMatrix,L.position):(L.position.YB(Q,e,g),L.position.addInPlace(I.emitterPosition))},this.output._storedValue=x}});(0,p.d)("BABYLON.PointShapeBlock",class extends hx{constructor(I){super(I),this.registerInput("particle",wx.Particle),this.registerInput("direction1",wx.sx,!0,new F.sx(0,1,0)),this.registerInput("direction2",wx.sx,!0,new F.sx(0,1,0)),this.registerOutput("output",wx.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(I){const x=this.particle.getConnectedValue(I);x._directionCreation.process=L=>{I.particleContext=L,I.systemContext=x;const X=this.direction1.getConnectedValue(I),G=this.direction2.getConnectedValue(I),Y=(0,l.RandomRange)(X.x,G.x),p=(0,l.RandomRange)(X.y,G.y),B=(0,l.RandomRange)(X.z,G.z);I.isEmitterTransformNode?F.sx.TransformNormalFromFloatsToRef(Y,p,B,I.emitterWorldMatrix,L.direction):L.direction.YB(Y,p,B)},x._positionCreation.process=L=>{I.systemContext=x,I.isEmitterTransformNode?F.sx.TransformCoordinatesFromFloatsToRef(0,0,0,I.emitterWorldMatrix,L.position):L.position.X(I.emitterPosition)},this.output._storedValue=x}});(0,p.d)("BABYLON.CustomShapeBlock",class extends hx{constructor(I){super(I),this.registerInput("particle",wx.Particle),this.registerInput("position",wx.sx,!0,new F.sx(0,0,0)),this.registerInput("direction",wx.sx,!0,new F.sx(0,1,0)),this.registerOutput("output",wx.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(I){const x=this.particle.getConnectedValue(I);x._directionCreation.process=L=>{I.particleContext=L,I.systemContext=x;const X=this.direction.getConnectedValue(I);I.isEmitterTransformNode?F.sx.TransformNormalToRef(X,I.emitterWorldMatrix,L.direction):L.direction.X(X)},x._positionCreation.process=L=>{I.particleContext=L,I.systemContext=x;const X=this.position.getConnectedValue(I);I.isEmitterTransformNode?F.sx.TransformCoordinatesToRef(X,I.emitterWorldMatrix,L.position):(L.position.X(X),L.position.addInPlace(I.emitterPosition))},this.output._storedValue=x}});(0,p.d)("BABYLON.CylinderShapeBlock",class extends hx{constructor(I){super(I),this._tempVector=F.sx.Zero(),this.registerInput("particle",wx.Particle),this.registerInput("radius",wx.Float,!0,1),this.registerInput("height",wx.Float,!0,1,0),this.registerInput("radiusRange",wx.Float,!0,1,0,1),this.registerInput("directionRandomizer",wx.Float,!0,0,0,1),this.registerOutput("output",wx.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(I){const x=this.particle.getConnectedValue(I);x._directionCreation.process=L=>{I.particleContext=L,I.systemContext=x;const X=this.directionRandomizer.getConnectedValue(I);L.position.subtractToRef(I.emitterPosition,this._tempVector),this._tempVector.normalize(),I.isEmitterTransformNode&&F.sx.TransformNormalToRef(this._tempVector,I.emitterInverseWorldMatrix,this._tempVector);const G=(0,l.RandomRange)(-X/2,X/2);let Y=Math.atan2(this._tempVector.x,this._tempVector.z);Y+=(0,l.RandomRange)(-Math.PI/2,Math.PI/2)*X,this._tempVector.y=G,this._tempVector.x=Math.sin(Y),this._tempVector.z=Math.cos(Y),this._tempVector.normalize(),I.isEmitterTransformNode?F.sx.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,I.emitterWorldMatrix,L.direction):L.direction.X(this._tempVector)},x._positionCreation.process=L=>{I.particleContext=L,I.systemContext=x;const X=this.height.getConnectedValue(I),G=this.radiusRange.getConnectedValue(I),Y=this.radius.getConnectedValue(I),p=(0,l.RandomRange)(-X/2,X/2),B=(0,l.RandomRange)(0,2*Math.PI),W=(0,l.RandomRange)((1-G)*(1-G),1),Q=Math.sqrt(W)*Y,e=Q*Math.cos(B),g=Q*Math.sin(B);I.isEmitterTransformNode?F.sx.TransformCoordinatesFromFloatsToRef(e,p,g,I.emitterWorldMatrix,L.position):(L.position.YB(e,p,g),L.position.addInPlace(I.emitterPosition))},this.output._storedValue=x}});class BL extends hx{constructor(I){super(I),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",wx.Particle),this.registerOutput("output",wx.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){super._build(I);const x=this.particle.getConnectedValue(I);x._isAnimationSheetEnabled=!0,x.spriteCellWidth=this.width,x.spriteCellHeight=this.height,x.startSpriteCellID=this.start,x.endSpriteCellID=this.end,x.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=x}serialize(){const I=super.serialize();return I.width=this.width,I.height=this.height,I.start=this.start,I.end=this.end,I.randomStartCell=this.randomStartCell,I}_deserialize(I){super._deserialize(I),this.width=I.width,this.height=I.height,this.start=I.start,this.end=I.end,this.randomStartCell=I.randomStartCell}}(0,K.d)([Ex("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BL.prototype,"start",void 0),(0,K.d)([Ex("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BL.prototype,"end",void 0),(0,K.d)([Ex("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BL.prototype,"width",void 0),(0,K.d)([Ex("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BL.prototype,"height",void 0),(0,K.d)([Ex("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],BL.prototype,"loop",void 0),(0,K.d)([Ex("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],BL.prototype,"randomStartCell",void 0),(0,p.d)("BABYLON.SetupSpriteSheetBlock",BL);class lL extends hx{constructor(I){super(I),this.reference=0,this.registerInput("value",wx.AutoDetect),this.registerOutput("output",wx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=I=>{switch(I){case wx.Float:return wx.FloatGradient;case wx.Vector2:return wx.Vector2Gradient;case wx.sx:return wx.Vector3Gradient;case wx.lB:return wx.Color4Gradient}return I},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wx.Float|wx.Vector2|wx.sx|wx.lB)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=I=>null}serialize(){const I=super.serialize();return I.reference=this.reference,I}_deserialize(I){super._deserialize(I),this.reference=I.reference}}(0,K.d)([Ex("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],lL.prototype,"reference",void 0),(0,p.d)("BABYLON.ParticleGradientValueBlock",lL);(0,p.d)("BABYLON.ParticleGradientBlock",class extends hx{constructor(I){super(I),this._entryCount=1,this.registerInput("gradient",wx.Float,!0,1,0,1),this.registerInput("value0",wx.AutoDetect),this.registerOutput("output",wx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=I=>{switch(I){case wx.FloatGradient:return wx.Float;case wx.Vector2Gradient:return wx.Vector2;case wx.Vector3Gradient:return wx.sx;case wx.Color4Gradient:return wx.lB}return I},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(wx.FloatGradient|wx.Vector2Gradient|wx.Vector3Gradient|wx.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(I){this._inputs[I].onConnectionObservable.add((()=>{this._entryCount>I||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),wx.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const I=[];for(let L=1;L<this._inputs.length;L++){var x;if(this._inputs[L].isConnected)I.push(null===(x=this._inputs[L].connectedPoint)||void 0===x?void 0:x.ownerBlock)}I.sort(((I,x)=>I.reference-x.reference)),this.output._storedFunction=x=>{const L=this.gradient.getConnectedValue(x);if(1===I.length)return I[0].value.getConnectedValue(x);let X=null;for(let G=I.length-1;G>=0;G--){const p=I[G];if(p.reference<=L){const I=p.value.getConnectedValue(x);if(X){const G=X.value.getConnectedValue(x),B=X.reference,W=p.reference,Q=Math.max(0,Math.min(1,(L-W)/(B-W)));switch(this.output.type){case wx.Float:return(0,l.Lerp)(I,G,Q);case wx.Vector2:return F.Vector2.Lerp(I,G,Q);case wx.sx:return F.sx.Lerp(I,G,Q);case wx.lB:return Y.lB.Lerp(I,G,Q)}}return I}X=p}return 0}}});(0,p.d)("BABYLON.ParticleConverterBlock",class extends hx{constructor(I){super(I),this.registerInput("color ",wx.lB,!0),this.registerInput("xyz ",wx.sx,!0),this.registerInput("xy ",wx.Vector2,!0),this.registerInput("zw ",wx.Vector2,!0),this.registerInput("x ",wx.Float,!0),this.registerInput("y ",wx.Float,!0),this.registerInput("z ",wx.Float,!0),this.registerInput("w ",wx.Float,!0),this.registerOutput("color",wx.lB),this.registerOutput("xyz",wx.sx),this.registerOutput("xy",wx.Vector2),this.registerOutput("zw",wx.Vector2),this.registerOutput("x",wx.Float),this.registerOutput("y",wx.Float),this.registerOutput("z",wx.Float),this.registerOutput("w",wx.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(I){return"color "===I?"colorIn":"xyz "===I?"xyzIn":"xy "===I?"xyIn":"zw "===I?"zwIn":"x "===I?"xIn":"y "===I?"yIn":"z "===I?"zIn":"w "===I?"wIn":I}_outputRename(I){switch(I){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return I}}_build(I){super._build(I);const x=this.xIn,L=this.yIn,X=this.zIn,G=this.wIn,p=this.xyIn,B=this.zwIn,l=this.xyzIn,W=this.colorIn,Q=this.colorOut,e=this.xyzOut,g=this.xyOut,v=this.zwOut,z=this.xOut,H=this.yOut,s=this.zOut,U=this.wOut,q=I=>{if(W.isConnected)return W.getConnectedValue(I);let F=0,Q=0,e=0,g=0;if(x.isConnected&&(F=x.getConnectedValue(I)),L.isConnected&&(Q=L.getConnectedValue(I)),X.isConnected&&(e=X.getConnectedValue(I)),G.isConnected&&(g=G.getConnectedValue(I)),p.isConnected){const x=p.getConnectedValue(I);x&&(F=x.x,Q=x.y)}if(B.isConnected){const x=B.getConnectedValue(I);x&&(e=x.x,g=x.y)}if(l.isConnected){const x=l.getConnectedValue(I);x&&(F=x.x,Q=x.y,e=x.z)}return new Y.lB(F,Q,e,g)};Q._storedFunction=I=>q(I),e._storedFunction=I=>{const x=q(I);return new F.sx(x.r,x.g,x.b)},g._storedFunction=I=>{const x=q(I);return new F.Vector2(x.r,x.g)},v._storedFunction=I=>{const x=q(I);return new F.Vector2(x.b,x.a)},z._storedFunction=I=>q(I).r,H._storedFunction=I=>q(I).g,s._storedFunction=I=>q(I).b,U._storedFunction=I=>q(I).a}}),function(I){I[I.Cos=0]="Cos",I[I.Sin=1]="Sin",I[I.Abs=2]="Abs",I[I.Exp=3]="Exp",I[I.Exp2=4]="Exp2",I[I.Round=5]="Round",I[I.Floor=6]="Floor",I[I.Ceiling=7]="Ceiling",I[I.Sqrt=8]="Sqrt",I[I.Log=9]="Log",I[I.Tan=10]="Tan",I[I.ArcTan=11]="ArcTan",I[I.ArcCos=12]="ArcCos",I[I.ArcSin=13]="ArcSin",I[I.Sign=14]="Sign",I[I.Negate=15]="Negate",I[I.OneMinus=16]="OneMinus",I[I.Reciprocal=17]="Reciprocal",I[I.ToDegrees=18]="ToDegrees",I[I.ToRadians=19]="ToRadians",I[I.Fract=20]="Fract"}(ox||(ox={}));class WL extends hx{constructor(I){super(I),this.operation=ox.Cos,this.registerInput("input",wx.AutoDetect),this.registerOutput("output",wx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wx.Float|wx.Int|wx.Vector2|wx.sx|wx.lB)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){super._build(I);let x=null;switch(this.operation){case ox.Cos:x=I=>Math.cos(I);break;case ox.Sin:x=I=>Math.sin(I);break;case ox.Abs:x=I=>Math.abs(I);break;case ox.Exp:x=I=>Math.exp(I);break;case ox.Exp2:x=I=>Math.pow(2,I);break;case ox.Round:x=I=>Math.round(I);break;case ox.Floor:x=I=>Math.floor(I);break;case ox.Ceiling:x=I=>Math.ceil(I);break;case ox.Sqrt:x=I=>Math.sqrt(I);break;case ox.Log:x=I=>Math.log(I);break;case ox.Tan:x=I=>Math.tan(I);break;case ox.ArcTan:x=I=>Math.atan(I);break;case ox.ArcCos:x=I=>Math.acos(I);break;case ox.ArcSin:x=I=>Math.asin(I);break;case ox.Sign:x=I=>Math.sign(I);break;case ox.Negate:x=I=>-I;break;case ox.OneMinus:x=I=>1-I;break;case ox.Reciprocal:x=I=>1/I;break;case ox.ToRadians:x=I=>I*Math.PI/180;break;case ox.ToDegrees:x=I=>180*I/Math.PI;break;case ox.Fract:x=I=>I>=0?I-Math.floor(I):I-Math.ceil(I)}if(!x)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case wx.Int:case wx.Float:this.output._storedFunction=I=>{const L=this.input.getConnectedValue(I);return x(L)};break;case wx.Vector2:this.output._storedFunction=I=>{const L=this.input.getConnectedValue(I);return new F.Vector2(x(L.x),x(L.y))};break;case wx.sx:this.output._storedFunction=I=>{const L=this.input.getConnectedValue(I);return new F.sx(x(L.x),x(L.y),x(L.z))};break;case wx.lB:this.output._storedFunction=I=>{const L=this.input.getConnectedValue(I);return new Y.lB(x(L.r),x(L.g),x(L.b),x(L.a))}}return this}serialize(){const I=super.serialize();return I.operation=this.operation,I}_deserialize(I){super._deserialize(I),this.operation=I.operation}}(0,K.d)([Ex("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:ox.Cos},{label:"Sin",value:ox.Sin},{label:"Abs",value:ox.Abs},{label:"Exp",value:ox.Exp},{label:"Exp2",value:ox.Exp2},{label:"Round",value:ox.Round},{label:"Floor",value:ox.Floor},{label:"Ceiling",value:ox.Ceiling},{label:"Sqrt",value:ox.Sqrt},{label:"Log",value:ox.Log},{label:"Tan",value:ox.Tan},{label:"ArcTan",value:ox.ArcTan},{label:"ArcCos",value:ox.ArcCos},{label:"ArcSin",value:ox.ArcSin},{label:"Sign",value:ox.Sign},{label:"Negate",value:ox.Negate},{label:"OneMinus",value:ox.OneMinus},{label:"Reciprocal",value:ox.Reciprocal},{label:"ToDegrees",value:ox.ToDegrees},{label:"ToRadians",value:ox.ToRadians},{label:"Fract",value:ox.Fract}]})],WL.prototype,"operation",void 0),(0,p.d)("BABYLON.ParticleTrigonometryBlock",WL);var QL,eL=L(14193);class gL extends hx{constructor(I){super(I),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",wx.AutoDetect),this.registerOutput("output",wx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(wx.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(wx.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(wx.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(wx.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(wx.System),this._inputs[0].excludedConnectionPointTypes.push(wx.Particle),this._inputs[0].excludedConnectionPointTypes.push(wx.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const x=I=>{const x=this.input.getConnectedValue(I);if(this.log.length>=this.stackSize)return x;if(null===x||void 0===x)return this.log.push(["null",""]),x;switch(this.input.type){case wx.Vector2:this.log.push([(0,eL.h)(x,4),x.toString()]);break;case wx.sx:this.log.push([(0,eL.l)(x,4),x.toString()]);break;case wx.lB:this.log.push([`{R: ${x.r.toFixed(4)} G: ${x.g.toFixed(4)} B: ${x.b.toFixed(4)} A: ${x.a.toFixed(4)}}`,x.toString()]);break;default:this.log.push([x.toString(),x.toString()])}return x};this.output.isConnected?this.output._storedFunction=x:this.output._storedValue=x(I)}serialize(){const I=super.serialize();return I.stackSize=this.stackSize,I}_deserialize(I){super._deserialize(I),this.stackSize=I.stackSize}}(0,K.d)([Ex("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],gL.prototype,"stackSize",void 0),(0,p.d)("BABYLON.ParticleDebugBlock",gL);(0,p.d)("BABYLON.ParticleElbowBlock",class extends hx{constructor(I){super(I),this.registerInput("input",wx.AutoDetect),this.registerOutput("output",wx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){super._build(I);const x=this._outputs[0],L=this._inputs[0];x._storedFunction=I=>L.getConnectedValue(I)}});(0,p.d)("BABYLON.ParticleTeleportInBlock",class extends hx{get endpoints(){return this._endpoints}constructor(I){super(I),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",wx.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(I){if(this.getClassName()===I)return!0;for(const x of this.endpoints)if(x.isAnAncestorOfType(I))return!0;return!1}isAnAncestorOf(I){for(const x of this.endpoints){if(x===I)return!0;if(x.isAnAncestorOf(I))return!0}return!1}attachToEndpoint(I){I.detach(),this._endpoints.push(I),I._entryPoint=this,I._outputs[0]._typeConnectionSource=this._inputs[0],I._tempEntryPointUniqueId=null,I.name="> "+this.name}detachFromEndpoint(I){const x=this._endpoints.indexOf(I);-1!==x&&(this._endpoints.splice(x,1),I._outputs[0]._typeConnectionSource=null,I._entryPoint=null)}_build(){for(const I of this._endpoints)I.output._storedFunction=I=>this.input.getConnectedValue(I)}});(0,p.d)("BABYLON.ParticleTeleportOutBlock",class extends hx{constructor(I){super(I),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",wx.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(I){this.entryPoint&&this.entryPoint.build(I)}clone(){const I=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(I),I}serialize(){var I;const x=super.serialize();return x.entryPoint=(null===(I=this.entryPoint)||void 0===I?void 0:I.uniqueId)??"",x}_deserialize(I){super._deserialize(I),this._tempEntryPointUniqueId=I.entryPoint}}),function(I){I[I.Equal=0]="Equal",I[I.NotEqual=1]="NotEqual",I[I.LessThan=2]="LessThan",I[I.GreaterThan=3]="GreaterThan",I[I.LessOrEqual=4]="LessOrEqual",I[I.GreaterOrEqual=5]="GreaterOrEqual",I[I.Xor=6]="Xor",I[I.Or=7]="Or",I[I.And=8]="And"}(QL||(QL={}));class vL extends hx{constructor(I){super(I),this.test=QL.Equal,this.epsilon=0,this.registerInput("left",wx.Float),this.registerInput("right",wx.Float,!0,0),this.registerInput("ifTrue",wx.AutoDetect,!0,1),this.registerInput("ifFalse",wx.AutoDetect,!0,0),this.registerOutput("output",wx.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=wx.Float,this._inputs[0].acceptedConnectionPointTypes.push(wx.Int),this._inputs[1].acceptedConnectionPointTypes.push(wx.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const I=I=>{const x=this.left.getConnectedValue(I),L=this.right.getConnectedValue(I);let F=!1;switch(this.test){case QL.Equal:F=(0,l.WithinEpsilon)(x,L,this.epsilon);break;case QL.NotEqual:F=!(0,l.WithinEpsilon)(x,L,this.epsilon);break;case QL.LessThan:F=x<L+this.epsilon;break;case QL.GreaterThan:F=x>L-this.epsilon;break;case QL.LessOrEqual:F=x<=L+this.epsilon;break;case QL.GreaterOrEqual:F=x>=L-this.epsilon;break;case QL.Xor:F=!!x&&!L||!x&&!!L;break;case QL.Or:F=!!x||!!L;break;case QL.And:F=!!x&&!!L}return F};this.output._storedFunction=x=>I(x)?this.ifTrue.getConnectedValue(x):this.ifFalse.getConnectedValue(x)}serialize(){const I=super.serialize();return I.test=this.test,I.epsilon=this.epsilon,I}_deserialize(I){super._deserialize(I),this.test=I.test,void 0!==I.epsilon&&(this.epsilon=I.epsilon)}}(0,K.d)([Ex("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:QL.Equal},{label:"NotEqual",value:QL.NotEqual},{label:"LessThan",value:QL.LessThan},{label:"GreaterThan",value:QL.GreaterThan},{label:"LessOrEqual",value:QL.LessOrEqual},{label:"GreaterOrEqual",value:QL.GreaterOrEqual},{label:"Xor",value:QL.Xor},{label:"Or",value:QL.Or},{label:"And",value:QL.And}]})],vL.prototype,"test",void 0),(0,K.d)([Ex("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],vL.prototype,"epsilon",void 0),(0,p.d)("BABYLON.ParticleConditionBlock",vL);class zL extends hx{constructor(I){super(I),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",wx.Particle),this.registerInput("condition",wx.Float,!0,0),this.registerInput("system",wx.System),this.registerOutput("output",wx.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(I){this._triggerCount=0;const x=this.input.getConnectedValue(I),L={process:L=>{if(I.particleContext=L,I.systemContext=x,0!==this.condition.getConnectedValue(I)&&(0===this.limit||this._triggerCount<this.limit)){const F=(new Date).getTime();if(this._previousOne&&F-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=F;const X=this.system.getConnectedValue(I);if(X){const F=Vx(X,I.qx,L.position);F.cp.addOnce((()=>{this._triggerCount--})),x.cp.addOnce((()=>{F.dispose()}))}}},previousItem:null,nextItem:null};x._updateQueueStart?NI(L,x._updateQueueStart):x._updateQueueStart=L,this.output._storedValue=x}serialize(){const I=super.serialize();return I.limit=this.limit,I.delay=this.delay,I}_deserialize(I){super._deserialize(I),void 0!==I.limit&&(this.limit=I.limit),void 0!==I.delay&&(this.delay=I.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,K.d)([Ex("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zL.prototype,"limit",void 0),(0,K.d)([Ex("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zL.prototype,"delay",void 0),(0,p.d)("BABYLON.ParticleTriggerBlock",zL);L(14202),L(14214),L(14225),L(14268)},14256:(I,x,L)=>{"use strict";var F=L(12885);const X="clipPlaneFragment",G="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14227:(I,x,L)=>{"use strict";var F=L(12885);const X="clipPlaneFragmentDeclaration",G="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14279:(I,x,L)=>{"use strict";var F=L(12885);const X="clipPlaneVertex",G="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14273:(I,x,L)=>{"use strict";var F=L(12885);const X="clipPlaneVertexDeclaration",G="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14266:(I,x,L)=>{"use strict";var F=L(12885);const X="fogFragment",G="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14252:(I,x,L)=>{"use strict";var F=L(12885);const X="fogFragmentDeclaration",G="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14283:(I,x,L)=>{"use strict";var F=L(12885);const X="fogVertex",G="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14277:(I,x,L)=>{"use strict";var F=L(12885);const X="fogVertexDeclaration",G="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14240:(I,x,L)=>{"use strict";var F=L(12885);const X="helperFunctions",G="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14230:(I,x,L)=>{"use strict";var F=L(12885);const X="imageProcessingDeclaration",G="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14249:(I,x,L)=>{"use strict";var F=L(12885);const X="imageProcessingFunctions",G="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14238:(I,x,L)=>{"use strict";var F=L(12885);const X="logDepthDeclaration",G="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14263:(I,x,L)=>{"use strict";var F=L(12885);const X="logDepthFragment",G="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14286:(I,x,L)=>{"use strict";var F=L(12885);const X="logDepthVertex",G="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";F.d.IncludesShadersStoreWGSL[X]||(F.d.IncludesShadersStoreWGSL[X]=G)},14225:(I,x,L)=>{"use strict";L.r(x),L.d(x,{particlesPixelShaderWGSL:()=>Y});var F=L(12885);L(14227),L(14230),L(14238),L(14240),L(14249),L(14252),L(14256),L(14263),L(14266);const X="particlesPixelShader",G="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";F.d.ShadersStoreWGSL[X]||(F.d.ShadersStoreWGSL[X]=G);const Y={name:X,shader:G}},14268:(I,x,L)=>{"use strict";L.r(x),L.d(x,{particlesVertexShaderWGSL:()=>Y});var F=L(12885);L(14273),L(14277),L(14238),L(14279),L(14283),L(14286);const X="particlesVertexShader",G="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";F.d.ShadersStoreWGSL[X]||(F.d.ShadersStoreWGSL[X]=G);const Y={name:X,shader:G}},14137:(I,x,L)=>{"use strict";var F=L(12885);const X="clipPlaneFragment",G="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14205:(I,x,L)=>{"use strict";var F=L(12885);const X="clipPlaneFragmentDeclaration",G="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14160:(I,x,L)=>{"use strict";var F=L(12885);const X="clipPlaneVertex",G="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14217:(I,x,L)=>{"use strict";var F=L(12885);const X="clipPlaneVertexDeclaration",G="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14147:(I,x,L)=>{"use strict";var F=L(12885);const X="fogFragment",G="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14133:(I,x,L)=>{"use strict";var F=L(12885);const X="fogFragmentDeclaration",G="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14165:(I,x,L)=>{"use strict";var F=L(12885);const X="fogVertex",G="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14156:(I,x,L)=>{"use strict";var F=L(12885);const X="fogVertexDeclaration",G="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14121:(I,x,L)=>{"use strict";var F=L(12885);const X="helperFunctions",G="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14107:(I,x,L)=>{"use strict";var F=L(12885);const X="imageProcessingDeclaration",G="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14124:(I,x,L)=>{"use strict";var F=L(12885);const X="imageProcessingFunctions",G="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14115:(I,x,L)=>{"use strict";var F=L(12885);const X="logDepthDeclaration",G="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14143:(I,x,L)=>{"use strict";var F=L(12885);const X="logDepthFragment",G="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14168:(I,x,L)=>{"use strict";var F=L(12885);const X="logDepthVertex",G="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";F.d.IncludesShadersStore[X]||(F.d.IncludesShadersStore[X]=G)},14202:(I,x,L)=>{"use strict";L.r(x),L.d(x,{particlesPixelShader:()=>Y});var F=L(12885);L(14205),L(14107),L(14115),L(14121),L(14124),L(14133),L(14137),L(14143),L(14147);const X="particlesPixelShader",G="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";F.d.ShadersStore[X]||(F.d.ShadersStore[X]=G);const Y={name:X,shader:G}},14214:(I,x,L)=>{"use strict";L.r(x),L.d(x,{particlesVertexShader:()=>Y});var F=L(12885);L(14217),L(14156),L(14115),L(14160),L(14165),L(14168);const X="particlesVertexShader",G="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";F.d.ShadersStore[X]||(F.d.ShadersStore[X]=G);const Y={name:X,shader:G}},14548:(I,x,L)=>{"use strict";L.r(x),L.d(x,{FlowGraphGLTFDataProvider:()=>G});var F=L(14514),X=L(14498);class G extends F.e{constructor(I){var x,L;super();const F=I.glTF,G=(null===(x=F.animations)||void 0===x?void 0:x.map((I=>I._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",X.e,G);const Y=(null===(L=F.nodes)||void 0===L?void 0:L.map((I=>I._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",X.e,Y)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14437:(I,x,L)=>{"use strict";L.d(x,{b:()=>H,e:()=>v,f:()=>g,j:()=>z});var F=L(12983),X=L(13456),G=L(13020),Y=L(14440);const p=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class B{constructor(I,x){this._gltf=I,this._infoTree=x}convert(I){let x,L=this._gltf,F=this._infoTree;if(!I.startsWith("/"))throw new Error("Path must start with a /");const X=I.split("/");if(X.shift(),X[X.length-1].includes(".length")){const I=X[X.length-1].split(".");X.pop(),X.push(...I)}let G=!1;for(const B of X){const X="length"===B;if(X&&!F.__array__)throw new Error(`Path ${I} is invalid`);if(F.__ignoreObjectTree__&&(G=!0),F.__array__&&!X)F=F.__array__;else if(F=F[B],!F)throw new Error(`Path ${I} is invalid`);if(!G)if(void 0===L){if(!p.find((x=>x.regex.test(I))))throw new Error(`Path ${I} is invalid`)}else if(!X){var Y;L=null===(Y=L)||void 0===Y?void 0:Y[B]}(F.__target__||X)&&(x=L)}return{object:x,info:F}}}function l(I,x,L,F){const X=W(I,x);return F?X[L][F]:X[L]}function W(I,x,L){var F,G;return null===(F=I._data)||void 0===F||null===(G=F[(null===L||void 0===L?void 0:L.fillMode)??X.c.MATERIAL_TriangleFillMode])||void 0===G?void 0:G.babylonMaterial}function Q(I,x){return{offset:{componentsCount:2,type:"Vector2",get:(L,X,G)=>{const Y=l(L,G,I,x);return new F.Vector2(null===Y||void 0===Y?void 0:Y.uOffset,null===Y||void 0===Y?void 0:Y.vOffset)},getTarget:W,set:(L,F,X,G)=>{const Y=l(F,G,I,x);Y.uOffset=L.x,Y.vOffset=L.y},getPropertyName:[()=>`${I}${x?"."+x:""}.uOffset`,()=>`${I}${x?"."+x:""}.vOffset`]},rotation:{type:"number",get:(L,F,X)=>{var G;return null===(G=l(L,X,I,x))||void 0===G?void 0:G.wAng},getTarget:W,set:(L,F,X,G)=>l(F,G,I,x).wAng=L,getPropertyName:[()=>`${I}${x?"."+x:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(L,X,G)=>{const Y=l(L,G,I,x);return new F.Vector2(null===Y||void 0===Y?void 0:Y.uScale,null===Y||void 0===Y?void 0:Y.vScale)},getTarget:W,set:(L,F,X,G)=>{const Y=l(F,G,I,x);Y.uScale=L.x,Y.vScale=L.y},getPropertyName:[()=>`${I}${x?"."+x:""}.uScale`,()=>`${I}${x?"."+x:""}.vScale`]}}}const e={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:I=>{var x,L;return new F.Vector2((null===(x=I._babylonCamera)||void 0===x?void 0:x.orthoLeft)??0,(null===(L=I._babylonCamera)||void 0===L?void 0:L.orthoRight)??0)},set:(I,x)=>{x._babylonCamera&&(x._babylonCamera.orthoLeft=I.x,x._babylonCamera.orthoRight=I.y)},getTarget:I=>I,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:I=>{var x,L;return new F.Vector2((null===(x=I._babylonCamera)||void 0===x?void 0:x.orthoBottom)??0,(null===(L=I._babylonCamera)||void 0===L?void 0:L.orthoTop)??0)},set:(I,x)=>{x._babylonCamera&&(x._babylonCamera.orthoBottom=I.x,x._babylonCamera.orthoTop=I.y)},getTarget:I=>I,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:I=>{var x;return null===(x=I._babylonCamera)||void 0===x?void 0:x.maxZ},set:(I,x)=>{x._babylonCamera&&(x._babylonCamera.maxZ=I)},getTarget:I=>I,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:I=>{var x;return null===(x=I._babylonCamera)||void 0===x?void 0:x.IB},set:(I,x)=>{x._babylonCamera&&(x._babylonCamera.IB=I)},getTarget:I=>I,getPropertyName:[()=>"IB"]}},perspective:{aspectRatio:{type:"number",get:I=>{var x;return null===(x=I._babylonCamera)||void 0===x?void 0:x.getEngine().getAspectRatio(I._babylonCamera)},getTarget:I=>I,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:I=>{var x;return null===(x=I._babylonCamera)||void 0===x?void 0:x.fov},set:(I,x)=>{x._babylonCamera&&(x._babylonCamera.fov=I)},getTarget:I=>I,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:I=>{var x;return null===(x=I._babylonCamera)||void 0===x?void 0:x.maxZ},set:(I,x)=>{x._babylonCamera&&(x._babylonCamera.maxZ=I)},getTarget:I=>I,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:I=>{var x;return null===(x=I._babylonCamera)||void 0===x?void 0:x.IB},set:(I,x)=>{x._babylonCamera&&(x._babylonCamera.IB=I)},getTarget:I=>I,getPropertyName:[()=>"IB"]}}}},nodes:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"sx",get:I=>{var x;return null===(x=I._babylonTransformNode)||void 0===x?void 0:x.position},set:(I,x)=>{var L;return null===(L=x._babylonTransformNode)||void 0===L?void 0:L.position.X(I)},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:I=>{var x;return null===(x=I._babylonTransformNode)||void 0===x?void 0:x.rotationQuaternion},set:(I,x)=>{var L,F;return null===(L=x._babylonTransformNode)||void 0===L||null===(F=L.rotationQuaternion)||void 0===F?void 0:F.X(I)},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"sx",get:I=>{var x;return null===(x=I._babylonTransformNode)||void 0===x?void 0:x.pB},set:(I,x)=>{var L;return null===(L=x._babylonTransformNode)||void 0===L?void 0:L.pB.X(I)},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"pB"]},weights:{length:{type:"number",get:I=>I._numMorphTargets,getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(I,x)=>{var L,F;return void 0!==x?null===(L=I._primitiveBabylonMeshes)||void 0===L||null===(F=L[0].morphTargetManager)||void 0===F?void 0:F.getTarget(x).influence:void 0},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(I,x)=>[0],getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:I=>{var x,L,X;return F.Matrix.Compose(null===(x=I._babylonTransformNode)||void 0===x?void 0:x.pB,null===(L=I._babylonTransformNode)||void 0===L?void 0:L.rotationQuaternion,null===(X=I._babylonTransformNode)||void 0===X?void 0:X.position)},getTarget:I=>I._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:I=>{var x,L,X,G;const Y=F.Matrix.Identity();let p=I.parent;for(;p&&p.parent;)p=p.parent;const B=(null===(x=I._babylonTransformNode)||void 0===x?void 0:x.position._isDirty)||(null===(L=I._babylonTransformNode)||void 0===L||null===(X=L.rotationQuaternion)||void 0===X?void 0:X._isDirty)||(null===(G=I._babylonTransformNode)||void 0===G?void 0:G.pB._isDirty);if(p){var l;const x=null===(l=p._babylonTransformNode)||void 0===l?void 0:l.LB(!0).invert();var W,Q;if(x)null===(W=I._babylonTransformNode)||void 0===W||null===(Q=W.LB(B))||void 0===Q||Q.multiplyToRef(x,Y)}else I._babylonTransformNode&&Y.X(I._babylonTransformNode.LB(B));return Y},getTarget:I=>I._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:I=>{var x,L;return null===(x=I._babylonTransformNode)||void 0===x||null===(L=x.getChildren((I=>I instanceof Y.c),!0)[0])||void 0===L?void 0:L.eB},getTarget:I=>{var x;return null===(x=I._babylonTransformNode)||void 0===x?void 0:x.getChildren((I=>I instanceof Y.c),!0)[0]},set:(I,x)=>{if(x._babylonTransformNode){const L=x._babylonTransformNode.getChildren((I=>I instanceof Y.c),!0)[0];L&&(L.eB=I)}}},color:{type:"Tx",get:I=>{var x,L;return null===(x=I._babylonTransformNode)||void 0===x||null===(L=x.getChildren((I=>I instanceof Y.c),!0)[0])||void 0===L?void 0:L.gB},getTarget:I=>{var x;return null===(x=I._babylonTransformNode)||void 0===x?void 0:x.getChildren((I=>I instanceof Y.c),!0)[0]},set:(I,x)=>{if(x._babylonTransformNode){const L=x._babylonTransformNode.getChildren((I=>I instanceof Y.c),!0)[0];L&&(L.gB=I)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Tx",get:(I,x,L)=>W(I,x,L).emissiveColor,set:(I,x,L,F)=>W(x,L,F).emissiveColor.X(I),getTarget:(I,x,L)=>W(I,x,L),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:Q("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(I,x,L)=>{var F;return null===(F=l(I,L,"bumpTexture"))||void 0===F?void 0:F.level},set:(I,x,L,F)=>{const X=l(x,F,"bumpTexture");X&&(X.level=I)},getTarget:(I,x,L)=>W(I,x,L),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:Q("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(I,x,L)=>W(I,x,L).ambientTextureStrength,set:(I,x,L,F)=>{const X=W(x,L,F);X&&(X.ambientTextureStrength=I)},getTarget:(I,x,L)=>W(I,x,L),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:Q("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"lB",get:(I,x,L)=>{const F=W(I,x,L);return G.lB.FromColor3(F.albedoColor,F.alpha)},set:(I,x,L,F)=>{const X=W(x,L,F);X.albedoColor.set(I.r,I.g,I.b),X.alpha=I.a},getTarget:(I,x,L)=>W(I,x,L),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:Q("albedoTexture")}},metallicFactor:{type:"number",get:(I,x,L)=>W(I,x,L).metallic,set:(I,x,L,F)=>{const X=W(x,L,F);X&&(X.metallic=I)},getTarget:(I,x,L)=>W(I,x,L),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(I,x,L)=>W(I,x,L).roughness,set:(I,x,L,F)=>{const X=W(x,L,F);X&&(X.roughness=I)},getTarget:(I,x,L)=>W(I,x,L),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Q("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(I,x,L)=>W(I,x,L).anisotropy.eB,set:(I,x,L,F)=>{W(x,L,F).anisotropy.eB=I},getTarget:(I,x,L)=>W(I,x,L),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(I,x,L)=>W(I,x,L).anisotropy.angle,set:(I,x,L,F)=>{W(x,L,F).anisotropy.angle=I},getTarget:(I,x,L)=>W(I,x,L),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:Q("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(I,x,L)=>W(I,x,L).clearCoat.eB,set:(I,x,L,F)=>{W(x,L,F).clearCoat.eB=I},getTarget:(I,x,L)=>W(I,x,L),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(I,x,L)=>W(I,x,L).clearCoat.roughness,set:(I,x,L,F)=>{W(x,L,F).clearCoat.roughness=I},getTarget:(I,x,L)=>W(I,x,L),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:Q("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(I,x,L)=>{var F;return null===(F=W(I,x,L).clearCoat.bumpTexture)||void 0===F?void 0:F.level},getTarget:W,set:(I,x,L,F)=>W(x,L,F).clearCoat.bumpTexture.level=I},extensions:{KHR_texture_transform:Q("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Q("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(I,x,L)=>W(I,x,L).subSurface.dispersion,getTarget:W,set:(I,x,L,F)=>W(x,L,F).subSurface.dispersion=I}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(I,x,L)=>W(I,x,L).emissiveIntensity,getTarget:W,set:(I,x,L,F)=>W(x,L,F).emissiveIntensity=I}},KHR_materials_ior:{ior:{type:"number",get:(I,x,L)=>W(I,x,L).indexOfRefraction,getTarget:W,set:(I,x,L,F)=>W(x,L,F).indexOfRefraction=I}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(I,x,L)=>W(I,x,L).iridescence.eB,getTarget:W,set:(I,x,L,F)=>W(x,L,F).iridescence.eB=I},iridescenceIor:{type:"number",get:(I,x,L)=>W(I,x,L).iridescence.indexOfRefraction,getTarget:W,set:(I,x,L,F)=>W(x,L,F).iridescence.indexOfRefraction=I},iridescenceTexture:{extensions:{KHR_texture_transform:Q("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(I,x,L)=>W(I,x,L).iridescence.maximumThickness,getTarget:W,set:(I,x,L,F)=>W(x,L,F).iridescence.maximumThickness=I},iridescenceThicknessMinimum:{type:"number",get:(I,x,L)=>W(I,x,L).iridescence.minimumThickness,getTarget:W,set:(I,x,L,F)=>W(x,L,F).iridescence.minimumThickness=I},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Q("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Tx",get:(I,x,L)=>W(I,x,L).sheen.color,getTarget:W,set:(I,x,L,F)=>W(x,L,F).sheen.color.X(I)},sheenColorTexture:{extensions:{KHR_texture_transform:Q("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(I,x,L)=>W(I,x,L).sheen.eB,getTarget:W,set:(I,x,L,F)=>W(x,L,F).sheen.eB=I},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Q("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(I,x,L)=>W(I,x,L).metallicF0Factor,getTarget:W,set:(I,x,L,F)=>W(x,L,F).metallicF0Factor=I,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Tx",get:(I,x,L)=>W(I,x,L).metallicReflectanceColor,getTarget:W,set:(I,x,L,F)=>W(x,L,F).metallicReflectanceColor.X(I),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:Q("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Q("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(I,x,L)=>W(I,x,L).subSurface.refractionIntensity,getTarget:W,set:(I,x,L,F)=>W(x,L,F).subSurface.refractionIntensity=I,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:Q("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(I,x,L)=>W(I,x,L).subSurface.translucencyIntensity,getTarget:W,set:(I,x,L,F)=>W(x,L,F).subSurface.translucencyIntensity=I},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Q("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Tx",get:(I,x,L)=>W(I,x,L).subSurface.translucencyColor,getTarget:W,set:(I,x,L,F)=>{var X;return I&&(null===(X=W(x,L,F).subSurface.translucencyColor)||void 0===X?void 0:X.X(I))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Q("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Tx",get:(I,x,L)=>W(I,x,L).subSurface.tintColor,getTarget:W,set:(I,x,L,F)=>W(x,L,F).subSurface.tintColor.X(I)},attenuationDistance:{type:"number",get:(I,x,L)=>W(I,x,L).subSurface.tintColorAtDistance,getTarget:W,set:(I,x,L,F)=>W(x,L,F).subSurface.tintColorAtDistance=I},thicknessFactor:{type:"number",get:(I,x,L)=>W(I,x,L).subSurface.maximumThickness,getTarget:W,set:(I,x,L,F)=>W(x,L,F).subSurface.maximumThickness=I},thicknessTexture:{extensions:{KHR_texture_transform:Q("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonLight)),getPropertyName:[I=>"length"]},__array__:{__target__:!0,color:{type:"Tx",get:I=>{var x;return null===(x=I._babylonLight)||void 0===x?void 0:x.gB},set:(I,x)=>{var L;return null===(L=x._babylonLight)||void 0===L?void 0:L.gB.X(I)},getTarget:I=>I._babylonLight,getPropertyName:[I=>"diffuse"]},eB:{type:"number",get:I=>{var x;return null===(x=I._babylonLight)||void 0===x?void 0:x.eB},set:(I,x)=>x._babylonLight?x._babylonLight.eB=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"intensity"]},range:{type:"number",get:I=>{var x;return null===(x=I._babylonLight)||void 0===x?void 0:x.range},set:(I,x)=>x._babylonLight?x._babylonLight.range=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"range"]},spot:{innerConeAngle:{type:"number",get:I=>{var x;return null===(x=I._babylonLight)||void 0===x?void 0:x.innerAngle},set:(I,x)=>x._babylonLight?x._babylonLight.innerAngle=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"innerConeAngle"]},outerConeAngle:{type:"number",get:I=>{var x;return null===(x=I._babylonLight)||void 0===x?void 0:x.angle},set:(I,x)=>x._babylonLight?x._babylonLight.angle=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonLight)),getPropertyName:[I=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonTexture)),getPropertyName:[I=>"length"]},__array__:{__target__:!0,eB:{type:"number",get:I=>{var x;return null===(x=I._babylonTexture)||void 0===x?void 0:x.level},set:(I,x)=>{x._babylonTexture&&(x._babylonTexture.level=I)},getTarget:I=>I._babylonTexture},rotation:{type:"Quaternion",get:I=>{var x;return I._babylonTexture&&F.Quaternion.FromRotationMatrix(null===(x=I._babylonTexture)||void 0===x?void 0:x.getReflectionTextureMatrix())},set:(I,x)=>{var L;x._babylonTexture&&(null!==(L=x._babylonTexture.tI())&&void 0!==L&&L.useRightHandedSystem||(I=F.Quaternion.Inverse(I)),F.Matrix.FromQuaternionToRef(I,x._babylonTexture.getReflectionTextureMatrix()))},getTarget:I=>I._babylonTexture}}}}},animations:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>{var x;return null===(x=I.primitives[0]._instanceData)||void 0===x?void 0:x.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function g(I){return new B(I,e)}function v(I){const x=I.split("/").map((I=>I.replace(/{}/g,"__array__")));let L=e;for(const F of x)F&&(L=L[F]);if(L&&L.type&&L.get)return L}function z(I,x){const L=I.split("/").map((I=>I.replace(/{}/g,"__array__")));let F=e;for(const X of L)X&&(F=F[X]);F&&F.type&&F.get&&(F.interpolation=x)}function H(I,x){const L=I.split("/").map((I=>I.replace(/{}/g,"__array__")));let F=e;for(const X of L)if(X){if(!F[X]){if("?"===X){F.__ignoreObjectTree__=!0;continue}F[X]={},"__array__"===X&&(F[X].__target__=!0)}F=F[X]}Object.assign(F,x)}},14448:(I,x,L)=>{"use strict";L.r(x),L.d(x,{AnimationPropertyInfo:()=>l,TransformNodeAnimationPropertyInfo:()=>W,WeightAnimationPropertyInfo:()=>Q,getQuaternion:()=>p,getVector3:()=>Y,getWeights:()=>B});var F=L(13490),X=L(12983),G=L(14437);function Y(I,x,L,F){return X.sx.tx(x,L).scaleInPlace(F)}function p(I,x,L,F){return X.Quaternion.tx(x,L).scaleInPlace(F)}function B(I,x,L,F){const X=new Array(I._numMorphTargets);for(let G=0;G<X.length;G++)X[G]=x[L++]*F;return X}class l{constructor(I,x,L,F){this.type=I,this.name=x,this.getValue=L,this.getStride=F}_buildAnimation(I,x,L){const X=new F.d(I,this.name,x,this.type);return X.setKeys(L),X}}class W extends l{buildAnimations(I,x,L,F){const X=[];return X.push({babylonAnimatable:I._babylonTransformNode,babylonAnimation:this._buildAnimation(x,L,F)}),X}}class Q extends l{buildAnimations(I,x,L,X){const G=[];if(I._numMorphTargets)for(let Y=0;Y<I._numMorphTargets;Y++){const p=new F.d(`${x}_${Y}`,this.name,L,this.type);if(p.setKeys(X.map((I=>({frame:I.frame,inTangent:I.inTangent?I.inTangent[Y]:void 0,value:I.value[Y],outTangent:I.outTangent?I.outTangent[Y]:void 0,interpolation:I.interpolation})))),I._primitiveBabylonMeshes)for(const x of I._primitiveBabylonMeshes)if(x.morphTargetManager){const I=x.morphTargetManager.getTarget(Y),L=p.clone();I.animations.push(L),G.push({babylonAnimatable:I,babylonAnimation:L})}}return G}}(0,G.j)("/nodes/{}/translation",[new W(F.d.ANIMATIONTYPE_VECTOR3,"position",Y,(()=>3))]),(0,G.j)("/nodes/{}/rotation",[new W(F.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",p,(()=>4))]),(0,G.j)("/nodes/{}/scale",[new W(F.d.ANIMATIONTYPE_VECTOR3,"pB",Y,(()=>3))]),(0,G.j)("/nodes/{}/weights",[new Q(F.d.ANIMATIONTYPE_FLOAT,"influence",B,(I=>I._numMorphTargets))])},14402:(I,x,L)=>{"use strict";class F{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((I,x)=>{this._resolve=I,this._reject=x}))}}var X=L(12983),G=L(13020),Y=L(12791),p=L(13434),B=L(14407),l=L(14420),W=L(12797),Q=L(13451),e=L(13490),g=L(13495),v=L(12840),z=L(12809),H=L(12818);class s{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(I){this._useTextureToStoreBoneMatrices=I,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(I){this._animationPropertiesOverride=I}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(I,x,L){this.name=I,this.id=x,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=X.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new W.c,this.bones=[],this._scene=L||v.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const F=this._scene.getEngine().getCaps();this._canUseTextureForBones=F.textureFloat&&F.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((I=>!I.getParent()))}getTransformMatrices(I){if(this.needInitialSkinMatrix){if(!I)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return I._bonesTransformMatrices||this.prepare(!0),I._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(I){return this.needInitialSkinMatrix&&I._transformMatrixTexture?I._transformMatrixTexture:this._transformMatrixTexture}tI(){return this._scene}toString(I){let x=`Name: ${this.name}, nBones: ${this.bones.length}`;if(x+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,I){x+=", Ranges: {";let I=!0;for(const L in this._ranges)I&&(x+=", ",I=!1),x+=L;x+="}"}return x}getBoneIndexByName(I){for(let x=0,L=this.bones.length;x<L;x++)if(this.bones[x].name===I)return x;return-1}createAnimationRange(I,x,L){if(!this._ranges[I]){this._ranges[I]=new g.d(I,x,L);for(let F=0,X=this.bones.length;F<X;F++)this.bones[F].animations[0]&&this.bones[F].animations[0].createRange(I,x,L)}}deleteAnimationRange(I){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let L=0,F=this.bones.length;L<F;L++)this.bones[L].animations[0]&&this.bones[L].animations[0].deleteRange(I,x);this._ranges[I]=null}getAnimationRange(I){return this._ranges[I]||null}getAnimationRanges(){const I=[];let x;for(x in this._ranges)I.push(this._ranges[x]);return I}copyAnimationRange(I,x){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[x]||!I.getAnimationRange(x))return!1;let F=!0;const X=this._getHighestAnimationFrame()+1,G={},Y=I.bones;let p,B;for(B=0,p=Y.length;B<p;B++)G[Y[B].name]=Y[B];this.bones.length!==Y.length&&(z.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${Y.length}`),F=!1);const l=L&&this.dimensionsAtRest&&I.dimensionsAtRest?this.dimensionsAtRest.divide(I.dimensionsAtRest):null;for(B=0,p=this.bones.length;B<p;B++){const I=this.bones[B].name,Y=G[I];Y?F=F&&this.bones[B].copyAnimationRange(Y,x,X,L,l):(z.c.Warn("copyAnimationRange: not same rig, missing source bone "+I),F=!1)}const W=I.getAnimationRange(x);return W&&(this._ranges[x]=new g.d(x,W.from+X,W.to+X)),F}returnToRest(){for(const I of this.bones)-1!==I._index&&I.returnToRest()}_getHighestAnimationFrame(){let I=0;for(let x=0,L=this.bones.length;x<L;x++)if(this.bones[x].animations[0]){const L=this.bones[x].animations[0].getHighestFrame();I<L&&(I=L)}return I}beginAnimation(I,x,L,F){const X=this.getAnimationRange(I);return X?this._scene.beginAnimation(this,X.from,X.to,x,L,F):null}static MakeAnimationAdditive(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;const F=I.getAnimationRange(L);if(!F)return null;const X=I._scene.getAllAnimatablesByTarget(I);let G=null;for(let p=0;p<X.length;p++){const I=X[p];if(I.fromFrame===(null===F||void 0===F?void 0:F.from)&&I.toFrame===(null===F||void 0===F?void 0:F.to)){G=I;break}}const Y=I.getAnimatables();for(let p=0;p<Y.length;p++){const I=Y[p].animations;if(I)for(let F=0;F<I.length;F++)e.d.MakeAnimationAdditive(I[F],x,L)}return G&&(G.isAdditive=!0),I}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(I){this._meshesWithPoseMatrix.push(I)}_unregisterMeshWithPoseMatrix(I){const x=this._meshesWithPoseMatrix.indexOf(I);x>-1&&this._meshesWithPoseMatrix.splice(x,1)}_computeTransformMatrices(I,x){this.onBeforeComputeObservable.notifyObservers(this);for(let L=0;L<this.bones.length;L++){const F=this.bones[L];F._childUpdateId++;const X=F.getParent();if(X?F.getLocalMatrix().multiplyToRef(X.getFinalMatrix(),F.getFinalMatrix()):x?F.getLocalMatrix().multiplyToRef(x,F.getFinalMatrix()):F.getFinalMatrix().X(F.getLocalMatrix()),-1!==F._index){const x=null===F._index?L:F._index;F.getAbsoluteInverseBindMatrix().multiplyToArray(F.getFinalMatrix(),I,16*x)}}this._identity.copyToArray(I,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const I=this.tI().getRenderId();if(this._currentRenderId===I)return;this._currentRenderId=I}if(this._numBonesWithLinkedTransformNode>0)for(const I of this.bones)if(I._linkedTransformNode){const x=I._linkedTransformNode;I.position=x.position,x.rotationQuaternion?I.rotationQuaternion=x.rotationQuaternion:I.rotation=x.rotation,I.pB=x.pB}if(this.needInitialSkinMatrix)for(const I of this._meshesWithPoseMatrix){const x=I.getPoseMatrix();let L=this._isDirty;if(I._bonesTransformMatrices&&I._bonesTransformMatrices.length===16*(this.bones.length+1)||(I._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),L=!0),L){if(this._synchronizedWithMesh!==I){this._synchronizedWithMesh=I;for(const I of this.bones)if(!I.getParent()){I.getBindMatrix().multiplyToRef(x,X.TmpVectors.Matrix[1]),I._updateAbsoluteBindMatrices(X.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const x=4*(this.bones.length+1);I._transformMatrixTexture&&I._transformMatrixTexture.getSize().width===x||(I._transformMatrixTexture&&I._transformMatrixTexture.dispose(),I._transformMatrixTexture=Q.c.CreateRGBATexture(I._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(I._bonesTransformMatrices,x),this.isUsingTextureForMatrices&&I._transformMatrixTexture&&I._transformMatrixTexture.update(I._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=Q.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let I=0;I<this.bones.length;I++)this._animatables.push(this.bones[I])}return this._animatables}clone(I,x){const L=new s(I,x||I,this._scene);L.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let F=0;F<this.bones.length;F++){const I=this.bones[F];let x=null;const X=I.getParent();if(X){const I=this.bones.indexOf(X);x=L.bones[I]}const G=new l.b(I.name,L,x,I.getBindMatrix().clone(),I.getRestMatrix().clone());G._index=I._index,I._linkedTransformNode&&G.linkTransformNode(I._linkedTransformNode),H.b.DeepCopy(I.animations,G.animations)}if(this._ranges){L._ranges={};for(const I in this._ranges){const x=this._ranges[I];x&&(L._ranges[I]=x.clone())}}return this._isDirty=!0,L.prepare(!0),L}enableBlending(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const x of this.bones)for(const L of x.animations)L.enableBlending=!0,L.blendingSpeed=I}dispose(){if(this._meshesWithPoseMatrix.length=0,this.tI().stopAnimation(this),this.tI().removeSkeleton(this),this._parentContainer){const I=this._parentContainer.skeletons.indexOf(this);I>-1&&this._parentContainer.skeletons.splice(I,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const I={};I.name=this.name,I.id=this.id,this.dimensionsAtRest&&(I.dimensionsAtRest=this.dimensionsAtRest.Cp()),I.bones=[],I.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let L=0;L<this.bones.length;L++){var x;const F=this.bones[L],X=F.getParent(),G={parentBoneIndex:X?this.bones.indexOf(X):-1,index:F.getIndex(),name:F.name,id:F.id,matrix:F.getBindMatrix().Cp(),rest:F.getRestMatrix().Cp(),linkedTransformNodeId:null===(x=F.getTransformNode())||void 0===x?void 0:x.id};I.bones.push(G),F.length&&(G.length=F.length),F.metadata&&(G.metadata=F.metadata),F.animations&&F.animations.length>0&&(G.animation=F.animations[0].serialize()),I.ranges=[];for(const x in this._ranges){const L=this._ranges[x];if(!L)continue;const F={};F.name=x,F.from=L.from,F.to=L.to,I.ranges.push(F)}}return I}static Parse(I,x){const L=new s(I.name,I.id,x);let F;for(I.dimensionsAtRest&&(L.dimensionsAtRest=X.sx.tx(I.dimensionsAtRest)),L.needInitialSkinMatrix=I.needInitialSkinMatrix,F=0;F<I.bones.length;F++){const x=I.bones[F],G=I.bones[F].index;let Y=null;x.parentBoneIndex>-1&&(Y=L.bones[x.parentBoneIndex]);const p=x.rest?X.Matrix.tx(x.rest):null,B=new l.b(x.name,L,Y,X.Matrix.tx(x.matrix),p,null,G);void 0!==x.id&&null!==x.id&&(B.id=x.id),x.length&&(B.length=x.length),x.metadata&&(B.metadata=x.metadata),x.animation&&B.animations.push(e.d.Parse(x.animation)),void 0!==x.linkedTransformNodeId&&null!==x.linkedTransformNodeId&&(L._hasWaitingData=!0,B._waitingTransformNodeId=x.linkedTransformNodeId)}if(I.ranges)for(F=0;F<I.ranges.length;F++){const x=I.ranges[F];L.createAnimationRange(x.name,x.from,x.to)}return L}computeAbsoluteMatrices(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||I)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(I)}getPoseMatrix(){let I=null;return this._meshesWithPoseMatrix.length>0&&(I=this._meshesWithPoseMatrix[0].getPoseMatrix()),I}sortBones(){const I=[],x=new Array(this.bones.length);for(let L=0;L<this.bones.length;L++)this._sortBones(L,I,x);this.bones=I}_sortBones(I,x,L){if(L[I])return;L[I]=!0;const F=this.bones[I];if(!F)return;void 0===F._index&&(F._index=I);const X=F.getParent();X&&this._sortBones(this.bones.indexOf(X),x,L),x.push(F)}setCurrentPoseAsRest(){for(const I of this.bones)I.setCurrentPoseAsRest()}}var U=L(13299),q=L(13466),y=L(12965),T=L(13398),Z=L(13048),t=L(13437),f=L(13411),R=L(13426),n=L(13499),P=L(13076),d=L(14373);class M{set areUpdatesFrozen(I){I?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new P.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,I||(I=v.e.LastCreatedScene),this._scene=I,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const I=this._scene.getEngine().getCaps();this._canUseTextureForTargets=I.canUseGLVertexID&&I.textureFloat&&I.maxVertexTextureImageUnits>0&&I.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return M.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?M.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(I){this._numMaxInfluencers!==I&&(this._numMaxInfluencers=I,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(I){this._useTextureToStoreTargets!==I&&(this._useTextureToStoreTargets=I,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var I;return M.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(I=this._scene)&&void 0!==I&&I.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(I){return this._activeTargets.data[I]}getTarget(I){return this._targets[I]}getTargetByName(I){for(const x of this._targets)if(x.name===I)return x;return null}addTarget(I){this._targets.push(I),this._targetInfluenceChangedObservers.push(I.onInfluenceChanged.add((I=>{this.areUpdatesFrozen&&I&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(I)}))),this._targetDataLayoutChangedObservers.push(I._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(I){const x=this._targets.indexOf(I);x>=0&&(this._targets.splice(x,1),I.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(x,1)[0]),I._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(x,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(I)}_bind(I){I.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),I.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),I.setTexture("morphTargets",this._targetStoreTexture),I.setInt("morphTargetCount",this.numInfluencers)}clone(){const I=new M(this._scene);for(const x of this._targets)I.addTarget(x.clone());return I.enablePositionMorphing=this.enablePositionMorphing,I.enableNormalMorphing=this.enableNormalMorphing,I.enableTangentMorphing=this.enableTangentMorphing,I.enableUVMorphing=this.enableUVMorphing,I.enableUV2Morphing=this.enableUV2Morphing,I.enableColorMorphing=this.enableColorMorphing,I}serialize(){const I={};I.id=this.uniqueId,I.targets=[];for(const x of this._targets)I.targets.push(x.serialize());return I}_syncActiveTargets(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const x=!!this._targetStoreTexture,L=this.isUsingTextureForTargets;(this._mustSynchronize||x!==L)&&(this._mustSynchronize=!1,this.synchronize());let F=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let X=-1;for(const G of this._targets)if(X++,0!==G.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=M.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(G),this._morphTargetTextureIndices[F]=X,this._tempInfluences[F++]=G.influence}this._morphTargetTextureIndices.length!==F&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,F)),this._influences&&this._influences.length===F||(this._influences=new Float32Array(F));for(let G=0;G<F;G++)this._influences[G]=this._tempInfluences[G];if(I&&this._scene)for(const G of this._scene.meshes)G.morphTargetManager===this&&(L?G._markSubMeshesAsAttributesDirty():G._syncGeometryWithMorphTargetManager())}synchronize(){var I;if(!this._scene||this.areUpdatesFrozen)return;const x=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(I=this._targetStoreTexture)||void 0===I||I.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>x.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const L of this._targets){this._supportsPositions=this._supportsPositions&&L.hasPositions,this._supportsNormals=this._supportsNormals&&L.hasNormals,this._supportsTangents=this._supportsTangents&&L.hasTangents,this._supportsUVs=this._supportsUVs&&L.hasUVs,this._supportsUV2s=this._supportsUV2s&&L.hasUV2s,this._supportsColors=this._supportsColors&&L.hasColors;const I=L.vertexCount;if(0===this._vertexCount)this._vertexCount=I;else if(this._vertexCount!==I)return void z.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${L.name}": ${I}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const I=x.getCaps().maxTextureSize;this._textureWidth>I&&(this._textureHeight=Math.ceil(this._textureWidth/I),this._textureWidth=I);const L=this._targets.length,F=new Float32Array(L*this._textureWidth*this._textureHeight*4);let X=0;for(let x=0;x<L;x++){const I=this._targets[x],L=I.getPositions(),G=I.getNormals(),Y=I.getUVs(),p=I.getTangents(),B=I.getUV2s(),l=I.getColors();X=x*this._textureWidth*this._textureHeight*4;for(let x=0;x<this._vertexCount;x++)this._supportsPositions&&L&&(F[X]=L[3*x],F[X+1]=L[3*x+1],F[X+2]=L[3*x+2],X+=4),this._supportsNormals&&G&&(F[X]=G[3*x],F[X+1]=G[3*x+1],F[X+2]=G[3*x+2],X+=4),this._supportsUVs&&Y&&(F[X]=Y[2*x],F[X+1]=Y[2*x+1],X+=4),this._supportsTangents&&p&&(F[X]=p[3*x],F[X+1]=p[3*x+1],F[X+2]=p[3*x+2],X+=4),this._supportsUV2s&&B&&(F[X]=B[2*x],F[X+1]=B[2*x+1],X+=4),this._supportsColors&&l&&(F[X]=l[4*x],F[X+1]=l[4*x+1],F[X+2]=l[4*x+2],F[X+3]=l[4*x+3],X+=4)}this._targetStoreTexture=d.c.CreateRGBATexture(F,this._textureWidth,this._textureHeight,L,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const L of this._scene.meshes)L.morphTargetManager===this&&L._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const I=this._parentContainer.morphTargetManagers.indexOf(this);I>-1&&this._parentContainer.morphTargetManagers.splice(I,1),this._parentContainer=null}for(const I of this._targets)this._scene.stopAnimation(I)}}static Parse(I,x){const L=new M(x);for(const F of I.targets)L.addTarget(n.e.Parse(F,x));return L}}M.EnableTextureStorage=!0,M.MaxActiveMorphTargetsInVertexAttributeMode=8,M.ConstantTargetCountForTextureMode=0;var K=L(14424),u=L(12842),A=L(13318);const mI=new Map,O=mI;function w(I,x,L){k(I)&&z.c.Warn(`Extension with the name '${I}' already exists`),mI.set(I,{isGLTFExtension:x,factory:L})}function k(I){return mI.delete(I)}var a=L(14437),D=L(13546),r=L(13061);class N{static Get(I,x,L){if(!x||void 0==L||!x[L])throw new Error(`${I}: Failed to find index (${L})`);return x[L]}static TryGet(I,x){return I&&void 0!=x&&I[x]?I[x]:null}static Assign(I){if(I)for(let x=0;x<I.length;x++)I[x].index=x}}function S(I){if(I.min&&I.max){const x=I.min,L=I.max,F=X.TmpVectors.sx[0].YB(x[0],x[1],x[2]),G=X.TmpVectors.sx[1].YB(L[0],L[1],L[2]);if(I.normalized&&5126!==I.componentType){let x=1;switch(I.componentType){case 5120:x=127;break;case 5121:x=255;break;case 5122:x=32767;break;case 5123:x=65535}const L=1/x;F.scaleInPlace(L),G.scaleInPlace(L)}return new A.d(F,G)}return null}class c{static RegisterExtension(I,x){w(I,!1,x)}static UnregisterExtension(I){return k(I)}get Ep(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(I){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=I}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((I=>I.dispose&&I.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(I,x,L,F,X,G){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=x,this._assetContainer=L,this._loadData(F);let G=null;if(I){const x={};if(this._gltf.nodes)for(const I of this._gltf.nodes)I.name&&(x[I.name]=I.index);G=(I instanceof Array?I:[I]).map((I=>{const L=x[I];if(void 0===L)throw new Error(`Failed to find node '${I}'`);return L}))}return await this._loadAsync(X,Y,G,(()=>({meshes:this._getMeshes(),Gg:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(I,x,L,F){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=I,this._loadData(x),await this._loadAsync(L,X,null,(()=>{}))}async _loadAsync(I,x,L,F){return await Promise.resolve().then((async()=>{this._rootUrl=I,this._uniqueRootUrl=!I.startsWith("file:")&&x?I:`${I}${Date.now()}/`,this._fileName=x,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const X=`${K.m[K.m.LOADING]} => ${K.m[K.m.READY]}`,G=`${K.m[K.m.LOADING]} => ${K.m[K.m.COMPLETE]}`;this._parent._startPerformanceCounter(X),this._parent._startPerformanceCounter(G),this._parent._setState(K.m.LOADING),this._extensionsOnLoading();const p=new Array;if(!this.parent.loadOnlyMaterials)if(L)p.push(this.loadSceneAsync("/nodes",{nodes:L,index:-1}));else if(void 0!=this._gltf.qx||this._gltf.scenes&&this._gltf.scenes[0]){const I=N.Get("/scene",this._gltf.scenes,this._gltf.qx||0);p.push(this.loadSceneAsync(`/scenes/${I.index}`,I))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let I=0;I<this._gltf.materials.length;++I){const x=this._gltf.materials[I],L="/materials/"+I,F=U.e.TriangleFillMode;p.push(this._loadMaterialAsync(L,x,null,F,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&p.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&p.push(this._compileShadowGeneratorsAsync());const B=Promise.all(p).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.MB(!0);for(const I of this._babylonScene.materials){const x=I;void 0!==x.maxSimultaneousLights&&(x.maxSimultaneousLights=Math.max(x.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(K.m.READY),this._skipStartAnimationStep||this._startAnimations(),F()}));return await B.then((I=>(this._parent._endPerformanceCounter(X),Y.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(G),this._parent._setState(K.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(I=>{this._parent.onErrorObservable.notifyObservers(I),this._parent.onErrorObservable.clear(),this.dispose()}))})),I)))})).catch((I=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(I),this._parent.onErrorObservable.clear(),this.dispose()),I}))}_loadData(I){if(this._gltf=I.json,this._setupData(),I.bin){const x=this._gltf.buffers;if(x&&x[0]&&!x[0].uri){const L=x[0];(L.byteLength<I.bin.byteLength-3||L.byteLength>I.bin.byteLength)&&z.c.Warn(`Binary buffer length (${L.byteLength}) from JSON does not match chunk length (${I.bin.byteLength})`),this._bin=I.bin}else z.c.Warn("Unexpected BIN chunk")}}_setupData(){if(N.Assign(this._gltf.accessors),N.Assign(this._gltf.animations),N.Assign(this._gltf.buffers),N.Assign(this._gltf.bufferViews),N.Assign(this._gltf.cameras),N.Assign(this._gltf.images),N.Assign(this._gltf.materials),N.Assign(this._gltf.meshes),N.Assign(this._gltf.nodes),N.Assign(this._gltf.samplers),N.Assign(this._gltf.scenes),N.Assign(this._gltf.skins),N.Assign(this._gltf.textures),this._gltf.nodes){const I={};for(const L of this._gltf.nodes)if(L.children)for(const x of L.children)I[x]=L.index;const x=this._createRootNode();for(const L of this._gltf.nodes){const F=I[L.index];L.parent=void 0===F?x:this._gltf.nodes[F]}}}async _loadExtensionsAsync(){const I=[];if(O.forEach(((x,L)=>{var F;!1===(null===(F=this.parent.extensionOptions[L])||void 0===F?void 0:F.enabled)?x.isGLTFExtension&&this.isExtensionUsed(L)&&z.c.Warn(`Extension ${L} is used but has been explicitly disabled.`):x.isGLTFExtension&&!this.isExtensionUsed(L)||I.push((async()=>{const I=await x.factory(this);return I.name!==L&&z.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${I.name} !== ${L}`),this._parent.onExtensionLoadedObservable.notifyObservers(I),I})())})),this._extensions.push(...await Promise.all(I)),this._extensions.sort(((I,x)=>(I.order||Number.MAX_VALUE)-(x.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const L of this._gltf.extensionsRequired){if(!this._extensions.some((I=>I.name===L&&I.enabled))){var x;if(!1===(null===(x=this.parent.extensionOptions[L])||void 0===x?void 0:x.enabled))throw new Error(`Required extension ${L} is disabled`);throw new Error(`Required extension ${L} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const I=new R.e("__root__",this._babylonScene);this._rootBabylonMesh=I,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.MB(!1);const x={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case K.i.AUTO:this._babylonScene.useRightHandedSystem||(x.rotation=[0,1,0,0],x.scale=[1,1,-1],c._LoadTransform(x,this._rootBabylonMesh));break;case K.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(I),x}loadSceneAsync(I,x){const L=this._extensionsLoadSceneAsync(I,x);if(L)return L;const F=new Array;if(this.logOpen(`${I} ${x.name||""}`),x.nodes)for(const X of x.nodes){const x=N.Get(`${I}/nodes/${X}`,this._gltf.nodes,X);F.push(this.loadNodeAsync(`/nodes/${x.index}`,x,(I=>{I.parent=this._rootBabylonMesh})))}for(const X of this._postSceneLoadActions)X();return F.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(F).then((()=>{}))}_forEachPrimitive(I,x){if(I._primitiveBabylonMeshes)for(const L of I._primitiveBabylonMeshes)x(L)}_getGeometries(){const I=[],x=this._gltf.nodes;if(x)for(const L of x)this._forEachPrimitive(L,(x=>{const L=x.FB;L&&-1===I.indexOf(L)&&I.push(L)}));return I}_getMeshes(){const I=[];this._rootBabylonMesh instanceof f.b&&I.push(this._rootBabylonMesh);const x=this._gltf.nodes;if(x)for(const L of x)this._forEachPrimitive(L,(x=>{I.push(x)}));return I}_getTransformNodes(){const I=[],x=this._gltf.nodes;if(x)for(const L of x)L._babylonTransformNode&&"ee"===L._babylonTransformNode.getClassName()&&I.push(L._babylonTransformNode),L._babylonTransformNodeForSkin&&I.push(L._babylonTransformNodeForSkin);return I}_getSkeletons(){const I=[],x=this._gltf.skins;if(x)for(const L of x)L._data&&I.push(L._data.babylonSkeleton);return I}_getAnimationGroups(){const I=[],x=this._gltf.animations;if(x)for(const L of x)L._babylonAnimationGroup&&I.push(L._babylonAnimationGroup);return I}_startAnimations(){switch(this._parent.animationStartMode){case K.f.NONE:break;case K.f.FIRST:{const I=this._getAnimationGroups();0!==I.length&&I[0].start(!0);break}case K.f.ALL:{const I=this._getAnimationGroups();for(const x of I)x.start(!0);break}default:return void z.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const F=this._extensionsLoadNodeAsync(I,x,L);if(F)return F;if(x._babylonTransformNode)throw new Error(`${I}: Invalid recursive node hierarchy`);const X=new Array;this.logOpen(`${I} ${x.name||""}`);const G=F=>{if(c.AddPointerMetadata(F,I),c._LoadTransform(x,F),void 0!=x.camera){const L=N.Get(`${I}/camera`,this._gltf.cameras,x.camera);X.push(this.loadCameraAsync(`/cameras/${L.index}`,L,(I=>{I.parent=F,this._babylonScene.useRightHandedSystem||(F.pB.x=-1)})))}if(x.children)for(const L of x.children){const x=N.Get(`${I}/children/${L}`,this._gltf.nodes,L);X.push(this.loadNodeAsync(`/nodes/${x.index}`,x,(I=>{I.parent=F})))}L(F)},Y=void 0!=x.mesh,p=this._parent.loadSkins&&void 0!=x.skin;if(!Y||p){const I=x.name||`node${x.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new T.c(I,this._babylonScene);L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==x.mesh?x._babylonTransformNode=L:x._babylonTransformNodeForSkin=L,G(L)}if(Y)if(p){const L=N.Get(`${I}/mesh`,this._gltf.meshes,x.mesh);X.push(this._loadMeshAsync(`/meshes/${L.index}`,x,L,(L=>{const F=x._babylonTransformNodeForSkin;L.metadata=(0,D.b)(F.metadata,L.metadata||{});const G=N.Get(`${I}/skin`,this._gltf.skins,x.skin);X.push(this._loadSkinAsync(`/skins/${G.index}`,x,G,(I=>{this._forEachPrimitive(x,(x=>{x.skeleton=I})),this._postSceneLoadActions.push((()=>{if(void 0!=G.skeleton){const I=N.Get(`/skins/${G.index}/skeleton`,this._gltf.nodes,G.skeleton).parent;x.index===I.index?L.parent=F.parent:L.parent=I._babylonTransformNode}else L.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:F,skinnedNode:L})}))})))})))}else{const L=N.Get(`${I}/mesh`,this._gltf.meshes,x.mesh);X.push(this._loadMeshAsync(`/meshes/${L.index}`,x,L,G))}return this.logClose(),Promise.all(X).then((()=>(this._forEachPrimitive(x,(I=>{const x=I;!x.isAnInstance&&x.FB&&x.FB.useBoundingInfoFromGeometry?I.mx():I.refreshBoundingInfo(!0,!0)})),x._babylonTransformNode)))}_loadMeshAsync(I,x,L,F){const X=L.primitives;if(!X||!X.length)throw new Error(`${I}: Primitives are missing`);void 0==X[0].index&&N.Assign(X);const G=new Array;this.logOpen(`${I} ${L.name||""}`);const Y=x.name||`node${x.index}`;if(1===X.length){const F=L.primitives[0];G.push(this._loadMeshPrimitiveAsync(`${I}/primitives/${F.index}`,Y,x,L,F,(I=>{x._babylonTransformNode=I,x._primitiveBabylonMeshes=[I]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,x._babylonTransformNode=new T.c(Y,this._babylonScene),x._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x._primitiveBabylonMeshes=[];for(const F of X)G.push(this._loadMeshPrimitiveAsync(`${I}/primitives/${F.index}`,`${Y}_primitive${F.index}`,x,L,F,(I=>{I.parent=x._babylonTransformNode,x._primitiveBabylonMeshes.push(I)})))}return F(x._babylonTransformNode),this.logClose(),Promise.all(G).then((()=>x._babylonTransformNode))}_loadMeshPrimitiveAsync(I,x,L,F,X,G){const Y=this._extensionsLoadMeshPrimitiveAsync(I,x,L,F,X,G);if(Y)return Y;this.logOpen(`${I}`);const p=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==L.skin&&!F.primitives[0].targets;let B,l;if(p&&X._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,B=X._instanceData.babylonSourceMesh.createInstance(x),B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l=X._instanceData.promise;else{const G=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new R.e(x,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y.sideOrientation=this._babylonScene.useRightHandedSystem?U.e.CounterClockWiseSideOrientation:U.e.ClockWiseSideOrientation,this._createMorphTargets(I,L,F,X,Y),G.push(this._loadVertexDataAsync(I,X,Y).then((async x=>await this._loadMorphTargetsAsync(I,X,Y,x).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,x.uI(Y),x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const W=c._GetDrawMode(I,X.mode);if(void 0==X.material){let I=this._defaultBabylonMaterialData[W];I||(I=this._createDefaultMaterial("__GLTFLoader._default",W),this._parent.onMaterialLoadedObservable.notifyObservers(I),this._defaultBabylonMaterialData[W]=I),Y.material=I}else if(!this.parent.skipMaterials){const x=N.Get(`${I}/material`,this._gltf.materials,X.material);G.push(this._loadMaterialAsync(`/materials/${x.index}`,x,Y,W,(I=>{Y.material=I})))}l=Promise.all(G),p&&(X._instanceData={babylonSourceMesh:Y,promise:l}),B=Y}return c.AddPointerMetadata(B,I),this._parent.onMeshLoadedObservable.notifyObservers(B),G(B),this.logClose(),l.then((()=>B))}_loadVertexDataAsync(I,x,L){const F=this._extensionsLoadVertexDataAsync(I,x,L);if(F)return F;const X=x.attributes;if(!X)throw new Error(`${I}: Attributes are missing`);const G=new Array,Y=new t.e(L.name,this._babylonScene);if(void 0==x.indices)L.isUnIndexed=!0;else{const L=N.Get(`${I}/indices`,this._gltf.accessors,x.indices);G.push(this._loadIndicesAccessorAsync(`/accessors/${L.index}`,L).then((I=>{Y.setIndices(I)})))}const p=(x,F,p)=>{if(void 0==X[x])return;L._delayInfo=L._delayInfo||[],-1===L._delayInfo.indexOf(F)&&L._delayInfo.push(F);const B=N.Get(`${I}/attributes/${x}`,this._gltf.accessors,X[x]);G.push(this._loadVertexAccessorAsync(`/accessors/${B.index}`,B,F).then((I=>{if(I.getKind()===Z.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!L.skeleton){const I=S(B);I&&(Y._boundingInfo=I,Y.useBoundingInfoFromGeometry=!0)}Y.setVerticesBuffer(I,B.count)}))),F==Z.g.MatricesIndicesExtraKind&&(L.numBoneInfluencers=8),p&&p(B)};return p("POSITION",Z.g.PositionKind),p("NORMAL",Z.g.NormalKind),p("TANGENT",Z.g.TangentKind),p("TEXCOORD_0",Z.g.UVKind),p("TEXCOORD_1",Z.g.UV2Kind),p("TEXCOORD_2",Z.g.UV3Kind),p("TEXCOORD_3",Z.g.UV4Kind),p("TEXCOORD_4",Z.g.UV5Kind),p("TEXCOORD_5",Z.g.UV6Kind),p("JOINTS_0",Z.g.MatricesIndicesKind),p("WEIGHTS_0",Z.g.MatricesWeightsKind),p("JOINTS_1",Z.g.MatricesIndicesExtraKind),p("WEIGHTS_1",Z.g.MatricesWeightsExtraKind),p("COLOR_0",Z.g.ColorKind,(I=>{"VEC4"===I.type&&(L.hasVertexAlpha=!0)})),Promise.all(G).then((()=>Y))}_createMorphTargets(I,x,L,F,X){if(!F.targets||!this._parent.loadMorphTargets)return;if(void 0==x._numMorphTargets)x._numMorphTargets=F.targets.length;else if(F.targets.length!==x._numMorphTargets)throw new Error(`${I}: Primitives do not have the same number of targets`);const G=L.extras?L.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,X.morphTargetManager=new M(this._babylonScene),X.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X.morphTargetManager.areUpdatesFrozen=!0;for(let Y=0;Y<F.targets.length;Y++){const I=x.weights?x.weights[Y]:L.weights?L.weights[Y]:0,F=G?G[Y]:`morphTarget${Y}`;X.morphTargetManager.addTarget(new n.e(F,I,X.tI()))}}_loadMorphTargetsAsync(I,x,L,F){if(!x.targets||!this._parent.loadMorphTargets)return Promise.resolve();const X=new Array,G=L.morphTargetManager;for(let Y=0;Y<G.numTargets;Y++){const L=G.getTarget(Y);X.push(this._loadMorphTargetVertexDataAsync(`${I}/targets/${Y}`,F,x.targets[Y],L))}return Promise.all(X).then((()=>{G.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(I,x,L,F){const X=new Array,G=(F,G,Y)=>{if(void 0==L[F])return;const p=x.getVertexBuffer(G);if(!p)return;const B=N.Get(`${I}/${F}`,this._gltf.accessors,L[F]);X.push(this._loadFloatAccessorAsync(`/accessors/${B.index}`,B).then((I=>{Y(p,I)})))};return G("POSITION",Z.g.PositionKind,((I,x)=>{const L=new Float32Array(x.length);I.forEach(x.length,((I,F)=>{L[F]=x[F]+I})),F.setPositions(L)})),G("NORMAL",Z.g.NormalKind,((I,x)=>{const L=new Float32Array(x.length);I.forEach(L.length,((I,F)=>{L[F]=x[F]+I})),F.setNormals(L)})),G("TANGENT",Z.g.TangentKind,((I,x)=>{const L=new Float32Array(x.length/3*4);let X=0;I.forEach(x.length/3*4,((I,F)=>{(F+1)%4!==0&&(L[X]=x[X]+I,X++)})),F.setTangents(L)})),G("TEXCOORD_0",Z.g.UVKind,((I,x)=>{const L=new Float32Array(x.length);I.forEach(x.length,((I,F)=>{L[F]=x[F]+I})),F.setUVs(L)})),G("TEXCOORD_1",Z.g.UV2Kind,((I,x)=>{const L=new Float32Array(x.length);I.forEach(x.length,((I,F)=>{L[F]=x[F]+I})),F.setUV2s(L)})),G("COLOR_0",Z.g.ColorKind,((x,L)=>{let X=null;const G=x.getSize();if(3===G){X=new Float32Array(L.length/3*4),x.forEach(L.length,((I,x)=>{const F=Math.floor(x/3),G=x%3;X[4*F+G]=L[3*F+G]+I}));for(let I=0;I<L.length/3;++I)X[4*I+3]=1}else{if(4!==G)throw new Error(`${I}: Invalid number of components (${G}) for COLOR_0 attribute`);X=new Float32Array(L.length),x.forEach(L.length,((I,x)=>{X[x]=L[x]+I}))}F.setColors(X)})),await Promise.all(X).then((()=>{}))}static _LoadTransform(I,x){if(void 0!=I.skin)return;let L=X.sx.Zero(),F=X.Quaternion.Identity(),G=X.sx.One();if(I.matrix){X.Matrix.tx(I.matrix).decompose(G,F,L)}else I.translation&&(L=X.sx.tx(I.translation)),I.rotation&&(F=X.Quaternion.tx(I.rotation)),I.scale&&(G=X.sx.tx(I.scale));x.position=L,x.rotationQuaternion=F,x.pB=G}_loadSkinAsync(I,x,L,F){if(!this._parent.loadSkins)return Promise.resolve();const X=this._extensionsLoadSkinAsync(I,x,L);if(X)return X;if(L._data)return F(L._data.babylonSkeleton),L._data.promise;const G=`skeleton${L.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new s(L.name||G,G,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(I,L,Y);const p=this._loadSkinInverseBindMatricesDataAsync(I,L).then((I=>{this._updateBoneMatrices(Y,I)}));return L._data={babylonSkeleton:Y,promise:p},F(Y),p}_loadBones(I,x,L){if(void 0==x.skeleton||this._parent.alwaysComputeSkeletonRootNode){const L=this._findSkeletonRootNode(`${I}/joints`,x.joints);if(L)if(void 0===x.skeleton)x.skeleton=L.index;else{const F=(I,x)=>{for(;x.parent;x=x.parent)if(x.parent===I)return!0;return!1},X=N.Get(`${I}/skeleton`,this._gltf.nodes,x.skeleton);X===L||F(X,L)||(z.c.Warn(`${I}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),x.skeleton=L.index)}else z.c.Warn(`${I}: Failed to find common root`)}const F={};for(const X of x.joints){const G=N.Get(`${I}/joints/${X}`,this._gltf.nodes,X);this._loadBone(G,x,L,F)}}_findSkeletonRootNode(I,x){if(0===x.length)return null;const L={};for(const X of x){const x=[];let F=N.Get(`${I}/${X}`,this._gltf.nodes,X);for(;-1!==F.index;)x.unshift(F),F=F.parent;L[X]=x}let F=null;for(let X=0;;++X){let I=L[x[0]];if(X>=I.length)return F;const G=I[X];for(let Y=1;Y<x.length;++Y)if(I=L[x[Y]],X>=I.length||G!==I[X])return F;F=G}}_loadBone(I,x,L,F){I._isJoint=!0;let X=F[I.index];if(X)return X;let G=null;I.index!==x.skeleton&&(I.parent&&-1!==I.parent.index?G=this._loadBone(I.parent,x,L,F):void 0!==x.skeleton&&z.c.Warn(`/skins/${x.index}/skeleton: Skeleton node is not a common root`));const Y=x.joints.indexOf(I.index);return X=new l.b(I.name||`joint${I.index}`,L,G,this._getNodeMatrix(I),null,null,Y),F[I.index]=X,this._postSceneLoadActions.push((()=>{X.linkTransformNode(I._babylonTransformNode)})),X}_loadSkinInverseBindMatricesDataAsync(I,x){if(void 0==x.inverseBindMatrices)return Promise.resolve(null);const L=N.Get(`${I}/inverseBindMatrices`,this._gltf.accessors,x.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${L.index}`,L)}_updateBoneMatrices(I,x){for(const L of I.bones){const I=X.Matrix.Identity(),F=L._index;x&&-1!==F&&(X.Matrix.FromArrayToRef(x,16*F,I),I.invertToRef(I));const G=L.getParent();G&&I.multiplyToRef(G.getAbsoluteInverseBindMatrix(),I),L.xB(I,!1,!1),L._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(I){return I.matrix?X.Matrix.tx(I.matrix):X.Matrix.Compose(I.scale?X.sx.tx(I.scale):X.sx.One(),I.rotation?X.Quaternion.tx(I.rotation):X.Quaternion.Identity(),I.translation?X.sx.tx(I.translation):X.sx.Zero())}loadCameraAsync(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const F=this._extensionsLoadCameraAsync(I,x,L);if(F)return F;const G=new Array;this.logOpen(`${I} ${x.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new B.e(x.name||`camera${x.index}`,X.sx.Zero(),this._babylonScene,!1);switch(Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x._babylonCamera=Y,Y.setTarget(new X.sx(0,0,-1)),x.type){case"perspective":{const L=x.perspective;if(!L)throw new Error(`${I}: Camera perspective properties are missing`);Y.fov=L.yfov,Y.IB=L.znear,Y.maxZ=L.zfar||0;break}case"orthographic":if(!x.orthographic)throw new Error(`${I}: Camera orthographic properties are missing`);Y.mode=p.b.ORTHOGRAPHIC_CAMERA,Y.orthoLeft=-x.orthographic.xmag,Y.orthoRight=x.orthographic.xmag,Y.orthoBottom=-x.orthographic.ymag,Y.orthoTop=x.orthographic.ymag,Y.IB=x.orthographic.znear,Y.maxZ=x.orthographic.zfar;break;default:throw new Error(`${I}: Invalid camera type (${x.type})`)}return c.AddPointerMetadata(Y,I),this._parent.onCameraLoadedObservable.notifyObservers(Y),L(Y),this.logClose(),Promise.all(G).then((()=>Y))}_loadAnimationsAsync(){const I=this._gltf.animations;if(!I)return Promise.resolve();const x=new Array;for(let L=0;L<I.length;L++){const F=I[L];x.push(this.loadAnimationAsync(`/animations/${F.index}`,F).then((I=>{0===I.targetedAnimations.length&&I.dispose()})))}return Promise.all(x).then((()=>{}))}loadAnimationAsync(I,x){const F=this._extensionsLoadAnimationAsync(I,x);return F||L.e(78).then(L.bind(L,16029)).then((L=>{let{AnimationGroup:F}=L;this._babylonScene._blockEntityCollection=!!this._assetContainer;const X=new F(x.name||`animation${x.index}`,this._babylonScene);X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x._babylonAnimationGroup=X;const G=new Array;N.Assign(x.channels),N.Assign(x.samplers);for(const Y of x.channels)G.push(this._loadAnimationChannelAsync(`${I}/channels/${Y.index}`,I,x,Y,((I,x)=>{I.animations=I.animations||[],I.animations.push(x),X.addTargetedAnimation(x,I)})));return Promise.all(G).then((()=>(X.normalize(0),X)))}))}async _loadAnimationChannelAsync(I,x,F,X,G){const Y=this._extensionsLoadAnimationChannelAsync(I,x,F,X,G);if(Y)return await Y;if(void 0==X.target.node)return await Promise.resolve();const p=N.Get(`${I}/target/node`,this._gltf.nodes,X.target.node),B=X.target.path,l="weights"===B;if(l&&!p._numMorphTargets||!l&&!p._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!l&&!p._isJoint)return await Promise.resolve();let W;switch(await Promise.resolve().then(L.bind(L,14448)),B){case"translation":var Q;W=null===(Q=(0,a.e)("/nodes/{}/translation"))||void 0===Q?void 0:Q.interpolation;break;case"rotation":var e;W=null===(e=(0,a.e)("/nodes/{}/rotation"))||void 0===e?void 0:e.interpolation;break;case"scale":var g;W=null===(g=(0,a.e)("/nodes/{}/scale"))||void 0===g?void 0:g.interpolation;break;case"weights":var v;W=null===(v=(0,a.e)("/nodes/{}/weights"))||void 0===v?void 0:v.interpolation;break;default:throw new Error(`${I}/target/path: Invalid value (${X.target.path})`)}if(!W)throw new Error(`${I}/target/path: Could not find interpolation properties for target path (${X.target.path})`);const z={object:p,info:W};return await this._loadAnimationChannelFromTargetInfoAsync(I,x,F,X,z,G)}_loadAnimationChannelFromTargetInfoAsync(I,x,L,F,X,G){const Y=this.parent.targetFps,p=1/Y,B=N.Get(`${I}/sampler`,L.samplers,F.sampler);return this._loadAnimationSamplerAsync(`${x}/samplers/${F.sampler}`,B).then((I=>{let x=0;const B=X.object,l=X.info;for(const X of l){const l=X.getStride(B),W=I.input,Q=I.output,e=new Array(W.length);let g=0;switch(I.interpolation){case"STEP":for(let I=0;I<W.length;I++){const x=X.getValue(B,Q,g,1);g+=l,e[I]={frame:W[I]*Y,value:x,interpolation:1}}break;case"CUBICSPLINE":for(let I=0;I<W.length;I++){const x=X.getValue(B,Q,g,p);g+=l;const L=X.getValue(B,Q,g,1);g+=l;const F=X.getValue(B,Q,g,p);g+=l,e[I]={frame:W[I]*Y,inTangent:x,value:L,outTangent:F}}break;case"LINEAR":for(let I=0;I<W.length;I++){const x=X.getValue(B,Q,g,1);g+=l,e[I]={frame:W[I]*Y,value:x}}}if(g>0){const I=`${L.name||`animation${L.index}`}_channel${F.index}_${x}`,p=X.buildAnimations(B,I,Y,e);for(const L of p)x++,G(L.babylonAnimatable,L.babylonAnimation)}}}))}_loadAnimationSamplerAsync(I,x){if(x._data)return x._data;const L=x.interpolation||"LINEAR";switch(L){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${I}/interpolation: Invalid value (${x.interpolation})`)}const F=N.Get(`${I}/input`,this._gltf.accessors,x.input),X=N.Get(`${I}/output`,this._gltf.accessors,x.output);return x._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${F.index}`,F),this._loadFloatAccessorAsync(`/accessors/${X.index}`,X)]).then((I=>{let[x,F]=I;return{input:x,interpolation:L,output:F}})),x._data}loadBufferAsync(I,x,L,F){const X=this._extensionsLoadBufferAsync(I,x,L,F);if(X)return X;if(!x._data)if(x.uri)x._data=this.loadUriAsync(`${I}/uri`,x,x.uri);else{if(!this._bin)throw new Error(`${I}: Uri is missing or the binary glTF is missing its binary chunk`);x._data=this._bin.readAsync(0,x.byteLength)}return x._data.then((x=>{try{return new Uint8Array(x.buffer,x.byteOffset+L,F)}catch(X){throw new Error(`${I}: ${X.message}`)}}))}loadBufferViewAsync(I,x){const L=this._extensionsLoadBufferViewAsync(I,x);if(L)return L;if(x._data)return x._data;const F=N.Get(`${I}/buffer`,this._gltf.buffers,x.buffer);return x._data=this.loadBufferAsync(`/buffers/${F.index}`,F,x.byteOffset||0,x.byteLength),x._data}_loadAccessorAsync(I,x,L){if(x._data)return x._data;const F=c._GetNumComponents(I,x.type),X=F*Z.g.GetTypeByteLength(x.componentType),G=F*x.count;if(void 0==x.bufferView)x._data=Promise.resolve(new L(G));else{const Y=N.Get(`${I}/bufferView`,this._gltf.bufferViews,x.bufferView);x._data=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y).then((p=>{if(5126!==x.componentType||x.normalized||Y.byteStride&&Y.byteStride!==X){const I=new L(G);return Z.g.ForEach(p,x.byteOffset||0,Y.byteStride||X,F,x.componentType,I.length,x.normalized||!1,((x,L)=>{I[L]=x})),I}return c._GetTypedArray(I,x.componentType,p,x.byteOffset,G)}))}if(x.sparse){const G=x.sparse;x._data=x._data.then((Y=>{const p=Y,B=N.Get(`${I}/sparse/indices/bufferView`,this._gltf.bufferViews,G.indices.bufferView),l=N.Get(`${I}/sparse/values/bufferView`,this._gltf.bufferViews,G.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${B.index}`,B),this.loadBufferViewAsync(`/bufferViews/${l.index}`,l)]).then((Y=>{let[B,l]=Y;const W=c._GetTypedArray(`${I}/sparse/indices`,G.indices.componentType,B,G.indices.byteOffset,G.count),Q=F*G.count;let e;if(5126!==x.componentType||x.normalized){const Y=c._GetTypedArray(`${I}/sparse/values`,x.componentType,l,G.values.byteOffset,Q);e=new L(Q),Z.g.ForEach(Y,0,X,F,x.componentType,e.length,x.normalized||!1,((I,x)=>{e[x]=I}))}else e=c._GetTypedArray(`${I}/sparse/values`,x.componentType,l,G.values.byteOffset,Q);let g=0;for(let I=0;I<W.length;I++){let x=W[I]*F;for(let I=0;I<F;I++)p[x++]=e[g++]}return p}))}))}return x._data}_loadFloatAccessorAsync(I,x){return this._loadAccessorAsync(I,x,Float32Array)}_loadIndicesAccessorAsync(I,x){if("SCALAR"!==x.type)throw new Error(`${I}/type: Invalid value ${x.type}`);if(5121!==x.componentType&&5123!==x.componentType&&5125!==x.componentType)throw new Error(`${I}/componentType: Invalid value ${x.componentType}`);if(x._data)return x._data;if(x.sparse){const L=c._GetTypedArrayConstructor(`${I}/componentType`,x.componentType);x._data=this._loadAccessorAsync(I,x,L)}else{const L=N.Get(`${I}/bufferView`,this._gltf.bufferViews,x.bufferView);x._data=this.loadBufferViewAsync(`/bufferViews/${L.index}`,L).then((L=>c._GetTypedArray(I,x.componentType,L,x.byteOffset,x.count)))}return x._data}_loadVertexBufferViewAsync(I){if(I._babylonBuffer)return I._babylonBuffer;const x=this._babylonScene.getEngine();return I._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${I.index}`,I).then((I=>new Z.e(x,I,!1))),I._babylonBuffer}_loadVertexAccessorAsync(I,x,L){var F;if(null!==(F=x._babylonVertexBuffer)&&void 0!==F&&F[L])return x._babylonVertexBuffer[L];x._babylonVertexBuffer||(x._babylonVertexBuffer={});const X=this._babylonScene.getEngine();if(x.sparse||void 0==x.bufferView)x._babylonVertexBuffer[L]=this._loadFloatAccessorAsync(I,x).then((I=>new Z.g(X,I,L,!1)));else{const F=N.Get(`${I}/bufferView`,this._gltf.bufferViews,x.bufferView);x._babylonVertexBuffer[L]=this._loadVertexBufferViewAsync(F).then((G=>{const Y=c._GetNumComponents(I,x.type);return new Z.g(X,G,L,!1,void 0,F.byteStride,void 0,x.byteOffset,Y,x.componentType,x.normalized,!0,void 0,!0)}))}return x._babylonVertexBuffer[L]}_loadMaterialMetallicRoughnessPropertiesAsync(I,x,L){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);const F=new Array;return x&&(x.baseColorFactor?(L.albedoColor=G.Tx.tx(x.baseColorFactor),L.alpha=x.baseColorFactor[3]):L.albedoColor=G.Tx.White(),L.metallic=void 0==x.metallicFactor?1:x.metallicFactor,L.roughness=void 0==x.roughnessFactor?1:x.roughnessFactor,x.baseColorTexture&&F.push(this.loadTextureInfoAsync(`${I}/baseColorTexture`,x.baseColorTexture,(I=>{I.name=`${L.name} (Base Color)`,L.albedoTexture=I}))),x.metallicRoughnessTexture&&(x.metallicRoughnessTexture.nonColorData=!0,F.push(this.loadTextureInfoAsync(`${I}/metallicRoughnessTexture`,x.metallicRoughnessTexture,(I=>{I.name=`${L.name} (Metallic Roughness)`,L.metallicTexture=I}))),L.useMetallnessFromMetallicTextureBlue=!0,L.useRoughnessFromMetallicTextureGreen=!0,L.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(F).then((()=>{}))}_loadMaterialAsync(I,x,L,F){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const G=this._extensionsLoadMaterialAsync(I,x,L,F,X);if(G)return G;x._data=x._data||{};let Y=x._data[F];if(!Y){this.logOpen(`${I} ${x.name||""}`);const L=this.createMaterial(I,x,F);Y={babylonMaterial:L,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(I,x,L)},x._data[F]=Y,c.AddPointerMetadata(L,I),this._parent.onMaterialLoadedObservable.notifyObservers(L),this.logClose()}return L&&(Y.babylonMeshes.push(L),L.cp.addOnce((()=>{const I=Y.babylonMeshes.indexOf(L);-1!==I&&Y.babylonMeshes.splice(I,1)}))),X(Y.babylonMaterial),Y.promise.then((()=>Y.babylonMaterial))}_createDefaultMaterial(I,x){this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new q.b(I,this._babylonScene);return L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L.fillMode=x,L.enableSpecularAntiAliasing=!0,L.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,L.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,L.transparencyMode=q.b.PBRMATERIAL_OPAQUE,L.metallic=1,L.roughness=1,L}createMaterial(I,x,L){const F=this._extensionsCreateMaterial(I,x,L);if(F)return F;const X=x.name||`material${x.index}`;return this._createDefaultMaterial(X,L)}loadMaterialPropertiesAsync(I,x,L){const F=this._extensionsLoadMaterialPropertiesAsync(I,x,L);if(F)return F;const X=new Array;return X.push(this.loadMaterialBasePropertiesAsync(I,x,L)),x.pbrMetallicRoughness&&X.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${I}/pbrMetallicRoughness`,x.pbrMetallicRoughness,L)),this.loadMaterialAlphaProperties(I,x,L),Promise.all(X).then((()=>{}))}loadMaterialBasePropertiesAsync(I,x,L){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);const F=new Array;return L.emissiveColor=x.emissiveFactor?G.Tx.tx(x.emissiveFactor):new G.Tx(0,0,0),x.doubleSided&&(L.GB=!1,L.twoSidedLighting=!0),x.normalTexture&&(x.normalTexture.nonColorData=!0,F.push(this.loadTextureInfoAsync(`${I}/normalTexture`,x.normalTexture,(I=>{I.name=`${L.name} (Normal)`,L.bumpTexture=I}))),L.invertNormalMapX=!this._babylonScene.useRightHandedSystem,L.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=x.normalTexture.scale&&L.bumpTexture&&(L.bumpTexture.level=x.normalTexture.scale),L.forceIrradianceInFragment=!0),x.occlusionTexture&&(x.occlusionTexture.nonColorData=!0,F.push(this.loadTextureInfoAsync(`${I}/occlusionTexture`,x.occlusionTexture,(I=>{I.name=`${L.name} (Occlusion)`,L.ambientTexture=I}))),L.useAmbientInGrayScale=!0,void 0!=x.occlusionTexture.strength&&(L.ambientTextureStrength=x.occlusionTexture.strength)),x.emissiveTexture&&F.push(this.loadTextureInfoAsync(`${I}/emissiveTexture`,x.emissiveTexture,(I=>{I.name=`${L.name} (Emissive)`,L.emissiveTexture=I}))),Promise.all(F).then((()=>{}))}loadMaterialAlphaProperties(I,x,L){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);switch(x.alphaMode||"OPAQUE"){case"OPAQUE":L.transparencyMode=q.b.PBRMATERIAL_OPAQUE,L.alpha=1;break;case"MASK":L.transparencyMode=q.b.PBRMATERIAL_ALPHATEST,L.alphaCutOff=void 0==x.alphaCutoff?.5:x.alphaCutoff,L.albedoTexture&&(L.albedoTexture.bp=!0);break;case"BLEND":L.transparencyMode=q.b.PBRMATERIAL_ALPHABLEND,L.albedoTexture&&(L.albedoTexture.bp=!0,L.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${I}/alphaMode: Invalid value (${x.alphaMode})`)}}loadTextureInfoAsync(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const F=this._extensionsLoadTextureInfoAsync(I,x,L);if(F)return F;if(this.logOpen(`${I}`),x.texCoord>=6)throw new Error(`${I}/texCoord: Invalid value (${x.texCoord})`);const X=N.Get(`${I}/index`,this._gltf.textures,x.index);X._textureInfo=x;const G=this._loadTextureAsync(`/textures/${x.index}`,X,(F=>{F.coordinatesIndex=x.texCoord||0,c.AddPointerMetadata(F,I),this._parent.onTextureLoadedObservable.notifyObservers(F),L(F)}));return this.logClose(),G}_loadTextureAsync(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const F=this._extensionsLoadTextureAsync(I,x,L);if(F)return F;this.logOpen(`${I} ${x.name||""}`);const X=void 0==x.sampler?c.DefaultSampler:N.Get(`${I}/sampler`,this._gltf.samplers,x.sampler),G=N.Get(`${I}/source`,this._gltf.images,x.source),Y=this._createTextureAsync(I,X,G,L,void 0,!x._textureInfo.nonColorData);return this.logClose(),Y}_createTextureAsync(I,x,L){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},G=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0;const p=this._loadSampler(`/samplers/${x.index}`,x),B=new Array,l=new F;this._babylonScene._blockEntityCollection=!!this._assetContainer;const W={noMipmap:p.noMipMaps,invertY:!1,samplingMode:p.samplingMode,h:()=>{this._disposed||l.resolve()},onError:(x,L)=>{this._disposed||l.reject(new Error(`${I}: ${L&&L.message?L.message:x||"Failed to load texture"}`))},mimeType:L.mimeType??(0,u.i)(L.uri??""),loaderOptions:G,useSRGBBuffer:!!Y&&this._parent.useSRGBBuffers},Q=new y.d(null,this._babylonScene,W);return Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.push(l.promise),B.push(this.loadImageAsync(`/images/${L.index}`,L).then((I=>{const x=L.uri||`${this._fileName}#image${L.index}`,F=`data:${this._uniqueRootUrl}${x}`;Q.updateURL(F,I);const X=Q.getInternalTexture();X&&(X.label=L.name)}))),Q.wrapU=p.wrapU,Q.wrapV=p.wrapV,X(Q),this._parent.useGltfTextureNames&&(Q.name=L.name||L.uri||`image${L.index}`),Promise.all(B).then((()=>Q))}_loadSampler(I,x){return x._data||(x._data={noMipMaps:9728===x.minFilter||9729===x.minFilter,samplingMode:c._GetTextureSamplingMode(I,x),wrapU:c._GetTextureWrapMode(`${I}/wrapS`,x.wrapS),wrapV:c._GetTextureWrapMode(`${I}/wrapT`,x.wrapT)}),x._data}loadImageAsync(I,x){if(!x._data){if(this.logOpen(`${I} ${x.name||""}`),x.uri)x._data=this.loadUriAsync(`${I}/uri`,x,x.uri);else{const L=N.Get(`${I}/bufferView`,this._gltf.bufferViews,x.bufferView);x._data=this.loadBufferViewAsync(`/bufferViews/${L.index}`,L)}this.logClose()}return x._data}loadUriAsync(I,x,L){const F=this._extensionsLoadUriAsync(I,x,L);if(F)return F;if(!c._ValidateUri(L))throw new Error(`${I}: '${L}' is invalid`);if((0,u.j)(L)){const x=new Uint8Array((0,u.c)(L));return this.log(`${I}: Decoded ${L.substring(0,64)}... (${x.length} bytes)`),Promise.resolve(x)}return this.log(`${I}: Loading ${L}`),this._parent.preprocessUrlAsync(this._rootUrl+L).then((x=>new Promise(((F,X)=>{this._parent._loadFile(this._babylonScene,x,(x=>{this._disposed||(this.log(`${I}: Loaded ${L} (${x.byteLength} bytes)`),F(new Uint8Array(x)))}),!0,(x=>{X(new u.m(`${I}: Failed to load '${L}'${x?": "+x.status+" "+x.statusText:""}`,x))}))}))))}static AddPointerMetadata(I,x){I.metadata=I.metadata||{};const L=I._internalMetadata=I._internalMetadata||{},F=L.Ep=L.Ep||{};(F.pointers=F.pointers||[]).push(x)}static _GetTextureWrapMode(I,x){switch(x=void 0==x?10497:x){case 33071:return y.d.CLAMP_ADDRESSMODE;case 33648:return y.d.MIRROR_ADDRESSMODE;case 10497:return y.d.WRAP_ADDRESSMODE;default:return z.c.Warn(`${I}: Invalid value (${x})`),y.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(I,x){const L=void 0==x.magFilter?9729:x.magFilter,F=void 0==x.minFilter?9987:x.minFilter;if(9729===L)switch(F){case 9728:return y.d.LINEAR_NEAREST;case 9729:return y.d.LINEAR_LINEAR;case 9984:return y.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return y.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return y.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return y.d.LINEAR_LINEAR_MIPLINEAR;default:return z.c.Warn(`${I}/minFilter: Invalid value (${F})`),y.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==L&&z.c.Warn(`${I}/magFilter: Invalid value (${L})`),F){case 9728:return y.d.NEAREST_NEAREST;case 9729:return y.d.NEAREST_LINEAR;case 9984:return y.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return y.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return y.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return y.d.NEAREST_LINEAR_MIPLINEAR;default:return z.c.Warn(`${I}/minFilter: Invalid value (${F})`),y.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(I,x){try{return(0,r.n)(x)}catch(L){throw new Error(`${I}: ${L.message}`)}}static _GetTypedArray(I,x,L,F,X){const G=L.buffer;F=L.byteOffset+(F||0);const Y=c._GetTypedArrayConstructor(`${I}/componentType`,x),p=Z.g.GetTypeByteLength(x);return F%p!==0?(z.c.Warn(`${I}: Copying buffer as byte offset (${F}) is not a multiple of component type byte length (${p})`),new Y(G.slice(F,F+X*p),0)):new Y(G,F,X)}static _GetNumComponents(I,x){switch(x){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${I}: Invalid type (${x})`)}static _ValidateUri(I){return Y.Tools.IsBase64(I)||-1===I.indexOf("..")}static _GetDrawMode(I,x){switch(void 0==x&&(x=4),x){case 0:return U.e.PointListDrawMode;case 1:return U.e.LineListDrawMode;case 2:return U.e.LineLoopDrawMode;case 3:return U.e.LineStripDrawMode;case 4:return U.e.TriangleFillMode;case 5:return U.e.TriangleStripDrawMode;case 6:return U.e.TriangleFanDrawMode}throw new Error(`${I}: Invalid mesh primitive mode (${x})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const I=new Array;if(this._gltf.materials)for(const x of this._gltf.materials)if(x._data)for(const L in x._data){const F=x._data[L];for(const x of F.babylonMeshes){x.LB(!0);const L=F.babylonMaterial;I.push(L.forceCompilationAsync(x)),I.push(L.forceCompilationAsync(x,{useInstances:!0})),this._parent.useClipPlane&&(I.push(L.forceCompilationAsync(x,{clipPlane:!0})),I.push(L.forceCompilationAsync(x,{clipPlane:!0,useInstances:!0})))}}return Promise.all(I).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const I=new Array,x=this._babylonScene.lights;for(const L of x){const x=L.getShadowGenerator();x&&I.push(x.forceCompilationAsync())}return Promise.all(I).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(I){for(const x of this._extensions)x.enabled&&I(x)}_applyExtensions(I,x,L){for(const F of this._extensions)if(F.enabled){const X=`${F.name}.${x}`,G=I;G._activeLoaderExtensionFunctions=G._activeLoaderExtensionFunctions||{};const Y=G._activeLoaderExtensionFunctions;if(!Y[X]){Y[X]=!0;try{const I=L(F);if(I)return I}finally{delete Y[X]}}}return null}_extensionsOnLoading(){this._forEachExtensions((I=>I.onLoading&&I.onLoading()))}_extensionsOnReady(){this._forEachExtensions((I=>I.onReady&&I.onReady()))}_extensionsLoadSceneAsync(I,x){return this._applyExtensions(x,"loadScene",(L=>L.loadSceneAsync&&L.loadSceneAsync(I,x)))}_extensionsLoadNodeAsync(I,x,L){return this._applyExtensions(x,"loadNode",(F=>F.loadNodeAsync&&F.loadNodeAsync(I,x,L)))}_extensionsLoadCameraAsync(I,x,L){return this._applyExtensions(x,"loadCamera",(F=>F.loadCameraAsync&&F.loadCameraAsync(I,x,L)))}_extensionsLoadVertexDataAsync(I,x,L){return this._applyExtensions(x,"loadVertexData",(F=>F._loadVertexDataAsync&&F._loadVertexDataAsync(I,x,L)))}_extensionsLoadMeshPrimitiveAsync(I,x,L,F,X,G){return this._applyExtensions(X,"loadMeshPrimitive",(Y=>Y._loadMeshPrimitiveAsync&&Y._loadMeshPrimitiveAsync(I,x,L,F,X,G)))}_extensionsLoadMaterialAsync(I,x,L,F,X){return this._applyExtensions(x,"loadMaterial",(G=>G._loadMaterialAsync&&G._loadMaterialAsync(I,x,L,F,X)))}_extensionsCreateMaterial(I,x,L){return this._applyExtensions(x,"createMaterial",(F=>F.createMaterial&&F.createMaterial(I,x,L)))}_extensionsLoadMaterialPropertiesAsync(I,x,L){return this._applyExtensions(x,"loadMaterialProperties",(F=>F.loadMaterialPropertiesAsync&&F.loadMaterialPropertiesAsync(I,x,L)))}_extensionsLoadTextureInfoAsync(I,x,L){return this._applyExtensions(x,"loadTextureInfo",(F=>F.loadTextureInfoAsync&&F.loadTextureInfoAsync(I,x,L)))}_extensionsLoadTextureAsync(I,x,L){return this._applyExtensions(x,"loadTexture",(F=>F._loadTextureAsync&&F._loadTextureAsync(I,x,L)))}_extensionsLoadAnimationAsync(I,x){return this._applyExtensions(x,"loadAnimation",(L=>L.loadAnimationAsync&&L.loadAnimationAsync(I,x)))}_extensionsLoadAnimationChannelAsync(I,x,L,F,X){return this._applyExtensions(L,"loadAnimationChannel",(G=>G._loadAnimationChannelAsync&&G._loadAnimationChannelAsync(I,x,L,F,X)))}_extensionsLoadSkinAsync(I,x,L){return this._applyExtensions(L,"loadSkin",(F=>F._loadSkinAsync&&F._loadSkinAsync(I,x,L)))}_extensionsLoadUriAsync(I,x,L){return this._applyExtensions(x,"loadUri",(F=>F._loadUriAsync&&F._loadUriAsync(I,x,L)))}_extensionsLoadBufferViewAsync(I,x){return this._applyExtensions(x,"loadBufferView",(L=>L.loadBufferViewAsync&&L.loadBufferViewAsync(I,x)))}_extensionsLoadBufferAsync(I,x,L,F){return this._applyExtensions(x,"loadBuffer",(X=>X.loadBufferAsync&&X.loadBufferAsync(I,x,L,F)))}static LoadExtensionAsync(I,x,L,F){if(!x.extensions)return null;const X=x.extensions[L];return X?F(`${I}/extensions/${L}`,X):null}static LoadExtraAsync(I,x,L,F){if(!x.extras)return null;const X=x.extras[L];return X?F(`${I}/extras/${L}`,X):null}isExtensionUsed(I){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(I)}logOpen(I){this._parent._logOpen(I)}logClose(){this._parent._logClose()}log(I){this._parent._log(I)}startPerformanceCounter(I){this._parent._startPerformanceCounter(I)}endPerformanceCounter(I){this._parent._endPerformanceCounter(I)}}c.DefaultSampler={index:-1},K.c._CreateGLTF2Loader=I=>new c(I);var o=L(14448),J=L(13171),h=L(13012),E=L(14451),i=L(14460);class V extends i.c{constructor(I,x,L){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",I),this._texture=I.getEngine().createRawCubeTexture(x,L,F,X,G,Y,p,B)}update(I,x,L,F){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,I,x,L,F,X)}updateRGBDAsync(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,E.l)(this._texture,I,x,L,F).then((()=>{}))}clone(){return h.c.Clone((()=>{const I=this.tI(),x=this._texture,L=new V(I,x._bufferViewArray,x.width,x.format,x.type,x.generateMipMaps,x.invertY,x.samplingMode,x._compression);return 13===x.source&&L.updateRGBDAsync(x._bufferViewArrayArray,x._sphericalPolynomial,x._lodGenerationScale,x._lodGenerationOffset),L}),this)}}const j="EXT_lights_image_based";class C{constructor(I){this.name=j,this._loader=I,this.enabled=this._loader.isExtensionUsed(j)}dispose(){this._loader=null,delete this._lights}onLoading(){const I=this._loader.Ep.extensions;if(I&&I[this.name]){const x=I[this.name];this._lights=x.lights}}loadSceneAsync(I,x){return c.LoadExtensionAsync(I,x,this.name,(async(L,F)=>{this._loader._allMaterialsDirtyRequired=!0;const X=new Array;X.push(this._loader.loadSceneAsync(I,x)),this._loader.logOpen(`${L}`);const G=N.Get(`${L}/light`,this._lights,F.Up);return X.push(this._loadLightAsync(`/extensions/${this.name}/lights/${F.Up}`,G).then((I=>{this._loader.babylonScene.environmentTexture=I}))),this._loader.logClose(),await Promise.all(X).then((()=>{}))}))}_loadLightAsync(I,x){if(!x._loaded){const L=new Array;this._loader.logOpen(`${I}`);const F=new Array(x.specularImages.length);for(let X=0;X<x.specularImages.length;X++){const G=x.specularImages[X];F[X]=new Array(G.length);for(let x=0;x<G.length;x++){const Y=`${I}/specularImages/${X}/${x}`;this._loader.logOpen(`${Y}`);const p=G[x],B=N.Get(Y,this._loader.Ep.images,p);L.push(this._loader.loadImageAsync(`/images/${p}`,B).then((I=>{F[X][x]=I}))),this._loader.logClose()}}this._loader.logClose(),x._loaded=Promise.all(L).then((async()=>{const L=new V(this._loader.babylonScene,null,x.specularImageSize);if(L.name=x.name||"environment",x._babylonTexture=L,void 0!=x.eB&&(L.level=x.eB),x.rotation){let I=X.Quaternion.tx(x.rotation);this._loader.babylonScene.useRightHandedSystem||(I=X.Quaternion.Inverse(I)),X.Matrix.FromQuaternionToRef(I,L.getReflectionTextureMatrix())}if(!x.irradianceCoefficients)throw new Error(`${I}: Irradiance coefficients are missing`);const G=J.d.tx(x.irradianceCoefficients);G.scaleInPlace(x.eB),G.convertIrradianceToLambertianRadiance();const Y=J.g.FromHarmonics(G),p=(F.length-1)/Math.log2(x.specularImageSize);return await L.updateRGBDAsync(F,Y,p)}))}return x._loaded.then((()=>x._babylonTexture))}}k(j),w(j,!0,(I=>new C(I)));L(13525);const b="EXT_mesh_gpu_instancing";class II{constructor(I){this.name=b,this._loader=I,this.enabled=this._loader.isExtensionUsed(b)}dispose(){this._loader=null}loadNodeAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(I,F)=>{this._loader._disableInstancedMesh++;const G=this._loader.loadNodeAsync(`/nodes/${x.index}`,x,L);if(this._loader._disableInstancedMesh--,!x._primitiveBabylonMeshes)return await G;const Y=new Array;let p=0;const B=x=>{if(void 0==F.attributes[x])return void Y.push(Promise.resolve(null));const L=N.Get(`${I}/attributes/${x}`,this._loader.Ep.accessors,F.attributes[x]);if(Y.push(this._loader._loadFloatAccessorAsync(`/accessors/${L.bufferView}`,L)),0===p)p=L.count;else if(p!==L.count)throw new Error(`${I}/attributes: Instance buffer accessors do not have the same count.`)};return B("TRANSLATION"),B("ROTATION"),B("SCALE"),await G.then((async I=>{const[L,F,G]=await Promise.all(Y),B=new Float32Array(16*p);X.TmpVectors.sx[0].YB(0,0,0),X.TmpVectors.Quaternion[0].YB(0,0,0,1),X.TmpVectors.sx[1].YB(1,1,1);for(let x=0;x<p;++x)L&&X.sx.FromArrayToRef(L,3*x,X.TmpVectors.sx[0]),F&&X.Quaternion.FromArrayToRef(F,4*x,X.TmpVectors.Quaternion[0]),G&&X.sx.FromArrayToRef(G,3*x,X.TmpVectors.sx[1]),X.Matrix.ComposeToRef(X.TmpVectors.sx[1],X.TmpVectors.Quaternion[0],X.TmpVectors.sx[0],X.TmpVectors.Matrix[0]),X.TmpVectors.Matrix[0].copyToArray(B,16*x);for(const X of x._primitiveBabylonMeshes)X.Le("matrix",B,16,!0);return I}))}))}}k(b),w(b,!0,(I=>new II(I)));let xI=0,LI=null;class FI{static get Default(){return FI._Default||(FI._Default=new FI),FI._Default}constructor(){const I=FI.Configuration.decoder;this._decoderModulePromise=Y.Tools.LoadBabylonScriptAsync(I.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(I,x,L,F,X){await this._decoderModulePromise,0===xI&&(MeshoptDecoder.useWorkers(1),xI=1);const G=await MeshoptDecoder.decodeGltfBufferAsync(x,L,I,F,X);return null!==LI&&clearTimeout(LI),LI=setTimeout((()=>{MeshoptDecoder.useWorkers(0),xI=0,LI=null}),1e3),G}}FI.Configuration={decoder:{url:`${Y.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},FI._Default=null;const XI="EXT_meshopt_compression";class GI{constructor(I){this.name=XI,this.enabled=I.isExtensionUsed(XI),this._loader=I}dispose(){this._loader=null}loadBufferViewAsync(I,x){return c.LoadExtensionAsync(I,x,this.name,(async(L,F)=>{const X=x;if(X._meshOptData)return await X._meshOptData;const G=N.Get(`${I}/buffer`,this._loader.Ep.buffers,F.buffer);return X._meshOptData=this._loader.loadBufferAsync(`/buffers/${G.index}`,G,F.byteOffset||0,F.byteLength).then((async I=>await FI.Default.decodeGltfBufferAsync(I,F.count,F.byteStride,F.mode,F.filter))),await X._meshOptData}))}}k(XI),w(XI,!0,(I=>new GI(I)));const YI="EXT_texture_webp";class pI{constructor(I){this.name=YI,this._loader=I,this.enabled=I.isExtensionUsed(YI)}dispose(){this._loader=null}_loadTextureAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=void 0==x.sampler?c.DefaultSampler:N.Get(`${I}/sampler`,this._loader.Ep.samplers,x.sampler),Y=N.Get(`${F}/source`,this._loader.Ep.images,X.source);return await this._loader._createTextureAsync(I,G,Y,(I=>{L(I)}),void 0,!x._textureInfo.nonColorData)}))}}k(YI),w(YI,!0,(I=>new pI(I)));const BI="EXT_texture_avif";class lI{constructor(I){this.name=BI,this._loader=I,this.enabled=I.isExtensionUsed(BI)}dispose(){this._loader=null}_loadTextureAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=void 0==x.sampler?c.DefaultSampler:N.Get(`${I}/sampler`,this._loader.Ep.samplers,x.sampler),Y=N.Get(`${F}/source`,this._loader.Ep.images,X.source);return await this._loader._createTextureAsync(I,G,Y,(I=>{L(I)}),void 0,!x._textureInfo.nonColorData)}))}}k(BI),w(BI,!0,(I=>new lI(I)));var WI=L(14440),QI=L(13507);const eI="EXT_lights_ies";class gI{constructor(I){this.name=eI,this._loader=I,this.enabled=this._loader.isExtensionUsed(eI)}dispose(){this._loader=null,delete this._lights}onLoading(){const I=this._loader.Ep.extensions;if(I&&I[this.name]){const x=I[this.name];this._lights=x.lights,N.Assign(this._lights)}}loadNodeAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,Y)=>{let p,B;this._loader._allMaterialsDirtyRequired=!0;const l=await this._loader.loadNodeAsync(I,x,(I=>{B=N.Get(F,this._lights,Y.Up);const x=B.name||I.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,p=new WI.c(x,X.sx.Zero(),X.sx.Backward(),0,1,this._loader.babylonScene),p.angle=Math.PI/2,p.innerAngle=0,p._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,B._babylonLight=p,p.falloffType=QI.c.FALLOFF_GLTF,p.gB=Y.color?G.Tx.tx(Y.color):G.Tx.White(),p.eB=Y.multiplier||1,p.range=Number.MAX_VALUE,p.parent=I,this._loader._babylonLights.push(p),c.AddPointerMetadata(p,F),L(I)}));let W;if(B.uri)W=await this._loader.loadUriAsync(I,B,B.uri);else{const x=N.Get(`${I}/bufferView`,this._loader.Ep.bufferViews,B.bufferView);W=await this._loader.loadBufferViewAsync(`/bufferViews/${x.index}`,x)}return p.iesProfileTexture=new y.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,W,!0,void 0,void 0,void 0,void 0,".ies"),l}))}}k(eI),w(eI,!0,(I=>new gI(I)));var vI=L(14469);const zI="KHR_draco_mesh_compression";class HI{constructor(I){this.name=zI,this.useNormalizedFlagFromAccessor=!0,this._loader=I,this.enabled=vI.b.DefaultAvailable&&this._loader.isExtensionUsed(zI)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{if(void 0!=x.mode&&4!==x.mode&&5!==x.mode)throw new Error(`${I}: Unsupported mode ${x.mode}`);const G={},Y={},p=(I,F)=>{const p=X.attributes[I];if(void 0!=p&&(L._delayInfo=L._delayInfo||[],-1===L._delayInfo.indexOf(F)&&L._delayInfo.push(F),G[F]=p,this.useNormalizedFlagFromAccessor)){const L=N.TryGet(this._loader.Ep.accessors,x.attributes[I]);L&&(Y[F]=L.normalized||!1)}};p("POSITION",Z.g.PositionKind),p("NORMAL",Z.g.NormalKind),p("TANGENT",Z.g.TangentKind),p("TEXCOORD_0",Z.g.UVKind),p("TEXCOORD_1",Z.g.UV2Kind),p("TEXCOORD_2",Z.g.UV3Kind),p("TEXCOORD_3",Z.g.UV4Kind),p("TEXCOORD_4",Z.g.UV5Kind),p("TEXCOORD_5",Z.g.UV6Kind),p("JOINTS_0",Z.g.MatricesIndicesKind),p("WEIGHTS_0",Z.g.MatricesWeightsKind),p("COLOR_0",Z.g.ColorKind);const B=N.Get(F,this._loader.Ep.bufferViews,X.bufferView);return B._dracoBabylonGeometry||(B._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${B.index}`,B).then((async F=>{const X=this.dracoDecoder||vI.b.Default,p=N.TryGet(this._loader.Ep.accessors,x.attributes.POSITION),B=this._loader.parent.alwaysComputeBoundingBox||L.skeleton||!p?null:S(p);return await X._decodeMeshToGeometryForGltfAsync(L.name,this._loader.babylonScene,F,G,Y,B).catch((x=>{throw new Error(`${I}: ${x.message}`)}))}))),await B._dracoBabylonGeometry}))}}k(zI),w(zI,!0,(I=>new HI(I)));var sI=L(14478),UI=L(12969),qI=L(12971),yI=L(13406),TI=L(13553),ZI=L(12938);yI.c.AddNodeConstructor("Light_Type_0",((I,x)=>()=>new tI(I,X.sx.Zero(),x)));class tI extends TI.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(I){this._shadowAngle=I,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(I){const x=this.needCube();if(this._direction=I,this.needCube()!==x&&this._shadowGenerators){const I=this._shadowGenerators.values();for(let x=I.next();!0!==x.done;x=I.next()){x.value.recreateShadowMap()}}}constructor(I,x,L){super(I,L),this._shadowAngle=Math.PI/2,this.position=x}getClassName(){return"PointLight"}getTypeID(){return QI.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(I){if(this.direction)return super.getShadowDirection(I);switch(I){case 0:return new X.sx(1,0,0);case 1:return new X.sx(-1,0,0);case 2:return new X.sx(0,-1,0);case 3:return new X.sx(0,1,0);case 4:return new X.sx(0,0,1);case 5:return new X.sx(0,0,-1)}return X.sx.Zero()}_setDefaultShadowProjectionMatrix(I,x,L){const F=this.tI().activeCamera;if(!F)return;const G=void 0!==this.shadowMinZ?this.shadowMinZ:F.IB,Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:F.maxZ,p=this.tI().getEngine().dp;X.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,p?Y:G,p?G:Y,I,!0,this._scene.getEngine().isNDCHalfZRange,void 0,p)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(I,x){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,x):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,x),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,x),this}transferToNodeMaterialEffect(I,x){return this.computeTransformedInformation()?I.setFloat3(x,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):I.setFloat3(x,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(I,x){I["POINTLIGHT"+x]=!0}}(0,UI.d)([(0,qI.K)()],tI.prototype,"shadowAngle",null),(0,ZI.d)("BABYLON.PointLight",tI);const fI="KHR_lights_punctual";class RI{constructor(I){this.name=fI,this._loader=I,this.enabled=this._loader.isExtensionUsed(fI)}dispose(){this._loader=null,delete this._lights}onLoading(){const I=this._loader.Ep.extensions;if(I&&I[this.name]){const x=I[this.name];this._lights=x.lights,N.Assign(this._lights)}}loadNodeAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,Y)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(I,x,(I=>{let x;const p=N.Get(F,this._lights,Y.Up),B=p.name||I.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,p.type){case"directional":{const I=new sI.d(B,X.sx.Backward(),this._loader.babylonScene);I.position.BB(0),x=I;break}case"point":x=new tI(B,X.sx.Zero(),this._loader.babylonScene);break;case"spot":{const I=new WI.c(B,X.sx.Zero(),X.sx.Backward(),0,1,this._loader.babylonScene);I.angle=2*(p.spot&&p.spot.outerConeAngle||Math.PI/4),I.innerAngle=2*(p.spot&&p.spot.innerConeAngle||0),x=I;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${F}: Invalid light type (${p.type})`)}x._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,p._babylonLight=x,x.falloffType=QI.c.FALLOFF_GLTF,x.gB=p.color?G.Tx.tx(p.color):G.Tx.White(),x.eB=void 0==p.eB?1:p.eB,x.range=void 0==p.range?Number.MAX_VALUE:p.range,x.parent=I,this._loader._babylonLights.push(x),c.AddPointerMetadata(x,F),L(I)})))))}}k(fI),w(fI,!0,(I=>new RI(I)));const nI="KHR_materials_pbrSpecularGlossiness";class PI{constructor(I){this.name=nI,this.order=200,this._loader=I,this.enabled=this._loader.isExtensionUsed(nI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=new Array;return G.push(this._loader.loadMaterialBasePropertiesAsync(I,x,L)),G.push(this._loadSpecularGlossinessPropertiesAsync(F,X,L)),this._loader.loadMaterialAlphaProperties(I,x,L),await Promise.all(G).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(I,x,L){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);const F=new Array;return L.metallic=null,L.roughness=null,x.diffuseFactor?(L.albedoColor=G.Tx.tx(x.diffuseFactor),L.alpha=x.diffuseFactor[3]):L.albedoColor=G.Tx.White(),L.reflectivityColor=x.specularFactor?G.Tx.tx(x.specularFactor):G.Tx.White(),L.microSurface=void 0==x.glossinessFactor?1:x.glossinessFactor,x.diffuseTexture&&F.push(this._loader.loadTextureInfoAsync(`${I}/diffuseTexture`,x.diffuseTexture,(I=>{I.name=`${L.name} (Diffuse)`,L.albedoTexture=I}))),x.specularGlossinessTexture&&(F.push(this._loader.loadTextureInfoAsync(`${I}/specularGlossinessTexture`,x.specularGlossinessTexture,(I=>{I.name=`${L.name} (Specular Glossiness)`,L.reflectivityTexture=I,L.reflectivityTexture.bp=!0}))),L.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(F).then((()=>{}))}}k(nI),w(nI,!0,(I=>new PI(I)));const dI="KHR_materials_unlit";class MI{constructor(I){this.name=dI,this.order=210,this._loader=I,this.enabled=this._loader.isExtensionUsed(dI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async()=>await this._loadUnlitPropertiesAsync(I,x,L)))}_loadUnlitPropertiesAsync(I,x,L){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);const F=new Array;L.unlit=!0;const X=x.pbrMetallicRoughness;return X&&(X.baseColorFactor?(L.albedoColor=G.Tx.tx(X.baseColorFactor),L.alpha=X.baseColorFactor[3]):L.albedoColor=G.Tx.White(),X.baseColorTexture&&F.push(this._loader.loadTextureInfoAsync(`${I}/baseColorTexture`,X.baseColorTexture,(I=>{I.name=`${L.name} (Base Color)`,L.albedoTexture=I})))),x.doubleSided&&(L.GB=!1,L.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(I,x,L),Promise.all(F).then((()=>{}))}}k(dI),w(dI,!0,(I=>new MI(I)));const KI="KHR_materials_clearcoat";class uI{constructor(I){this.name=KI,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(KI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=new Array;G.push(this._loader.loadMaterialPropertiesAsync(I,x,L)),G.push(this._loadClearCoatPropertiesAsync(F,X,L)),await Promise.all(G)}))}_loadClearCoatPropertiesAsync(I,x,L){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);const F=new Array;return L.clearCoat.isEnabled=!0,L.clearCoat.useRoughnessFromMainTexture=!1,L.clearCoat.remapF0OnInterfaceChange=!1,void 0!=x.clearcoatFactor?L.clearCoat.eB=x.clearcoatFactor:L.clearCoat.eB=0,x.clearcoatTexture&&F.push(this._loader.loadTextureInfoAsync(`${I}/clearcoatTexture`,x.clearcoatTexture,(I=>{I.name=`${L.name} (ClearCoat)`,L.clearCoat.texture=I}))),void 0!=x.clearcoatRoughnessFactor?L.clearCoat.roughness=x.clearcoatRoughnessFactor:L.clearCoat.roughness=0,x.clearcoatRoughnessTexture&&(x.clearcoatRoughnessTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${I}/clearcoatRoughnessTexture`,x.clearcoatRoughnessTexture,(I=>{I.name=`${L.name} (ClearCoat Roughness)`,L.clearCoat.textureRoughness=I})))),x.clearcoatNormalTexture&&(x.clearcoatNormalTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${I}/clearcoatNormalTexture`,x.clearcoatNormalTexture,(I=>{I.name=`${L.name} (ClearCoat Normal)`,L.clearCoat.bumpTexture=I}))),L.invertNormalMapX=!L.tI().useRightHandedSystem,L.invertNormalMapY=L.tI().useRightHandedSystem,void 0!=x.clearcoatNormalTexture.scale&&(L.clearCoat.bumpTexture.level=x.clearcoatNormalTexture.scale)),Promise.all(F).then((()=>{}))}}k(KI),w(KI,!0,(I=>new uI(I)));const AI="KHR_materials_iridescence";class mx{constructor(I){this.name=AI,this.order=195,this._loader=I,this.enabled=this._loader.isExtensionUsed(AI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(I,x,L)),G.push(this._loadIridescencePropertiesAsync(F,X,L)),await Promise.all(G).then((()=>{}))}))}_loadIridescencePropertiesAsync(I,x,L){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);const F=new Array;return L.iridescence.isEnabled=!0,L.iridescence.eB=x.iridescenceFactor??0,L.iridescence.indexOfRefraction=x.iridescenceIor??x.iridescenceIOR??1.3,L.iridescence.minimumThickness=x.iridescenceThicknessMinimum??100,L.iridescence.maximumThickness=x.iridescenceThicknessMaximum??400,x.iridescenceTexture&&F.push(this._loader.loadTextureInfoAsync(`${I}/iridescenceTexture`,x.iridescenceTexture,(I=>{I.name=`${L.name} (Iridescence)`,L.iridescence.texture=I}))),x.iridescenceThicknessTexture&&F.push(this._loader.loadTextureInfoAsync(`${I}/iridescenceThicknessTexture`,x.iridescenceThicknessTexture,(I=>{I.name=`${L.name} (Iridescence Thickness)`,L.iridescence.thicknessTexture=I}))),Promise.all(F).then((()=>{}))}}k(AI),w(AI,!0,(I=>new mx(I)));const OI="KHR_materials_anisotropy";class wI{constructor(I){this.name=OI,this.order=195,this._loader=I,this.enabled=this._loader.isExtensionUsed(OI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=new Array;G.push(this._loader.loadMaterialPropertiesAsync(I,x,L)),G.push(this._loadIridescencePropertiesAsync(F,X,L)),await Promise.all(G)}))}async _loadIridescencePropertiesAsync(I,x,L){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);const F=new Array;L.anisotropy.isEnabled=!0,L.anisotropy.eB=x.anisotropyStrength??0,L.anisotropy.angle=x.anisotropyRotation??0,x.anisotropyTexture&&(x.anisotropyTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${I}/anisotropyTexture`,x.anisotropyTexture,(I=>{I.name=`${L.name} (Anisotropy Intensity)`,L.anisotropy.texture=I})))),await Promise.all(F)}}k(OI),w(OI,!0,(I=>new wI(I)));const kI="KHR_materials_emissive_strength";class aI{constructor(I){this.name=kI,this.order=170,this._loader=I,this.enabled=this._loader.isExtensionUsed(kI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>await this._loader.loadMaterialPropertiesAsync(I,x,L).then((()=>{this._loadEmissiveProperties(F,X,L)}))))}_loadEmissiveProperties(I,x,L){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);void 0!==x.emissiveStrength&&(L.emissiveIntensity=x.emissiveStrength)}}k(kI),w(kI,!0,(I=>new aI(I)));const DI="KHR_materials_sheen";class rI{constructor(I){this.name=DI,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(DI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(I,x,L)),G.push(this._loadSheenPropertiesAsync(F,X,L)),await Promise.all(G).then((()=>{}))}))}_loadSheenPropertiesAsync(I,x,L){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);const F=new Array;return L.sheen.isEnabled=!0,L.sheen.eB=1,void 0!=x.sheenColorFactor?L.sheen.color=G.Tx.tx(x.sheenColorFactor):L.sheen.color=G.Tx.Black(),x.sheenColorTexture&&F.push(this._loader.loadTextureInfoAsync(`${I}/sheenColorTexture`,x.sheenColorTexture,(I=>{I.name=`${L.name} (Sheen Color)`,L.sheen.texture=I}))),void 0!==x.sheenRoughnessFactor?L.sheen.roughness=x.sheenRoughnessFactor:L.sheen.roughness=0,x.sheenRoughnessTexture&&(x.sheenRoughnessTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${I}/sheenRoughnessTexture`,x.sheenRoughnessTexture,(I=>{I.name=`${L.name} (Sheen Roughness)`,L.sheen.textureRoughness=I})))),L.sheen.albedoScaling=!0,L.sheen.useRoughnessFromMainTexture=!1,Promise.all(F).then((()=>{}))}}k(DI),w(DI,!0,(I=>new rI(I)));var NI=L(13456);const SI="KHR_materials_specular";class cI{constructor(I){this.name=SI,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(SI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=new Array;if(G.push(this._loader.loadMaterialPropertiesAsync(I,x,L)),G.push(this._loadSpecularPropertiesAsync(F,X,L)),X.extensions&&X.extensions.EXT_materials_specular_edge_color&&L instanceof q.b){X.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(L.brdf.dielectricSpecularModel=NI.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,L.brdf.conductorSpecularModel=NI.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(G).then((()=>{}))}))}_loadSpecularPropertiesAsync(I,x,L){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);const F=new Array;return void 0!==x.specularFactor&&(L.metallicF0Factor=x.specularFactor),void 0!==x.specularColorFactor&&(L.metallicReflectanceColor=G.Tx.tx(x.specularColorFactor)),x.specularTexture&&(x.specularTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${I}/specularTexture`,x.specularTexture,(I=>{I.name=`${L.name} (Specular)`,L.metallicReflectanceTexture=I,L.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),x.specularColorTexture&&F.push(this._loader.loadTextureInfoAsync(`${I}/specularColorTexture`,x.specularColorTexture,(I=>{I.name=`${L.name} (Specular Color)`,L.reflectanceTexture=I}))),Promise.all(F).then((()=>{}))}}k(SI),w(SI,!0,(I=>new cI(I)));const oI="KHR_materials_ior";class JI{constructor(I){this.name=oI,this.order=180,this._loader=I,this.enabled=this._loader.isExtensionUsed(oI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(I,x,L)),G.push(this._loadIorPropertiesAsync(F,X,L)),await Promise.all(G).then((()=>{}))}))}_loadIorPropertiesAsync(I,x,L){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);return void 0!==x.ior?L.indexOfRefraction=x.ior:L.indexOfRefraction=JI._DEFAULT_IOR,Promise.resolve()}}JI._DEFAULT_IOR=1.5,k(oI),w(oI,!0,(I=>new JI(I)));const hI="KHR_materials_variants";class EI{constructor(I){this.name=hI,this._loader=I,this.enabled=this._loader.isExtensionUsed(hI)}dispose(){this._loader=null}static GetAvailableVariants(I){const x=this._GetExtensionMetadata(I);return x?Object.keys(x.variants):[]}getAvailableVariants(I){return EI.GetAvailableVariants(I)}static SelectVariant(I,x){const L=this._GetExtensionMetadata(I);if(!L)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${hI} extension`);const F=I=>{const x=L.variants[I];if(x)for(const L of x)L.mesh.material=L.material};if(x instanceof Array)for(const X of x)F(X);else F(x);L.lastSelected=x}selectVariant(I,x){EI.SelectVariant(I,x)}static Reset(I){const x=this._GetExtensionMetadata(I);if(!x)throw new Error(`Cannot reset on a glTF mesh that does not have the ${hI} extension`);for(const L of x.original)L.mesh.material=L.material;x.lastSelected=null}reset(I){EI.Reset(I)}static GetLastSelectedVariant(I){const x=this._GetExtensionMetadata(I);if(!x)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${hI} extension`);return x.lastSelected}getLastSelectedVariant(I){return EI.GetLastSelectedVariant(I)}static _GetExtensionMetadata(I){var x,L;return(null===I||void 0===I||null===(x=I._internalMetadata)||void 0===x||null===(L=x.Ep)||void 0===L?void 0:L[hI])||null}onLoading(){const I=this._loader.Ep.extensions;if(I&&I[this.name]){const x=I[this.name];this._variants=x.variants}}onReady(){const I=this._loader.rootBabylonMesh;if(I){var x;const L=this._loader.parent.extensionOptions[hI];null!==L&&void 0!==L&&L.defaultVariant&&EI.SelectVariant(I,L.defaultVariant),null===L||void 0===L||null===(x=L.onLoaded)||void 0===x||x.call(L,{get variants(){return EI.GetAvailableVariants(I)},get selectedVariant(){const x=EI.GetLastSelectedVariant(I);return x?Array.isArray(x)?x[0]:x:EI.GetAvailableVariants(I)[0]},set selectedVariant(x){EI.SelectVariant(I,x)}})}}_loadMeshPrimitiveAsync(I,x,L,F,X,G){return c.LoadExtensionAsync(I,X,this.name,(async(Y,p)=>{const B=new Array;return B.push(this._loader._loadMeshPrimitiveAsync(I,x,L,F,X,(x=>{if(G(x),x instanceof R.e){const L=c._GetDrawMode(I,X.mode),F=this._loader.rootBabylonMesh,G=F?F._internalMetadata=F._internalMetadata||{}:{},l=G.Ep=G.Ep||{},W=l[hI]=l[hI]||{lastSelected:null,original:[],variants:{}};W.original.push({mesh:x,material:x.material});for(let I=0;I<p.mappings.length;++I){const X=p.mappings[I],G=N.Get(`${Y}/mappings/${I}/material`,this._loader.Ep.materials,X.material);B.push(this._loader._loadMaterialAsync(`#/materials/${X.material}`,G,x,L,(I=>{for(let L=0;L<X.variants.length;++L){const G=X.variants[L],Y=N.Get(`/extensions/${hI}/variants/${G}`,this._variants,G);W.variants[Y.name]=W.variants[Y.name]||[],W.variants[Y.name].push({mesh:x,material:I}),x.onClonedObservable.add((I=>{const L=I;let X=null,G=L;do{if(G=G.parent,!G)return;X=EI._GetExtensionMetadata(G)}while(null===X);if(F&&X===EI._GetExtensionMetadata(F)){G._internalMetadata={};for(const I in F._internalMetadata)G._internalMetadata[I]=F._internalMetadata[I];G._internalMetadata.Ep=[];for(const I in F._internalMetadata.Ep)G._internalMetadata.Ep[I]=F._internalMetadata.Ep[I];G._internalMetadata.Ep[hI]={lastSelected:null,original:[],variants:{}};for(const I of X.original)G._internalMetadata.Ep[hI].original.push({mesh:I.mesh,material:I.material});for(const I in X.variants)if(Object.prototype.hasOwnProperty.call(X.variants,I)){G._internalMetadata.Ep[hI].variants[I]=[];for(const x of X.variants[I])G._internalMetadata.Ep[hI].variants[I].push({mesh:x.mesh,material:x.material})}X=G._internalMetadata.Ep[hI]}for(const F of X.original)F.mesh===x&&(F.mesh=L);for(const F of X.variants[Y.name])F.mesh===x&&(F.mesh=L)}))}})))}}}))),await Promise.all(B).then((I=>{let[x]=I;return x}))}))}}k(hI),w(hI,!0,(I=>new EI(I)));var iI=L(13042);class VI{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:NI.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(I,x){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...VI._GetDefaultOptions(),...I},this._scene=x,this._scene._transmissionHelper=this,this.onErrorObservable=new W.c,this._scene.cp.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(I){if(!Object.keys(I).filter((x=>this._options[x]!==I[x])).length)return;const x={...this._options,...I},L=this._options;this._options=x,x.renderSize===L.renderSize&&x.renderTargetTextureType===L.renderTargetTextureType&&x.generateMipmaps===L.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=x.samples,this._opaqueRenderTarget.lodGenerationScale=x.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=x.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(I){return!!I&&!!(I instanceof q.b&&I.subSurface.isRefractionEnabled)}_addMesh(I){this._materialObservers[I.uniqueId]=I.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),Y.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(I.material)?(I.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(I)&&this._transparentMeshesCache.push(I)):-1===this._opaqueMeshesCache.indexOf(I)&&this._opaqueMeshesCache.push(I)}))}_removeMesh(I){I.onMaterialChangedObservable.remove(this._materialObservers[I.uniqueId]),delete this._materialObservers[I.uniqueId];let x=this._transparentMeshesCache.indexOf(I);-1!==x&&this._transparentMeshesCache.splice(x,1),x=this._opaqueMeshesCache.indexOf(I),-1!==x&&this._opaqueMeshesCache.splice(x,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(I){const x=this._transparentMeshesCache.indexOf(I),L=this._opaqueMeshesCache.indexOf(I);this._shouldRenderAsTransmission(I.material)?(I.material instanceof q.b&&(I.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==L?(this._opaqueMeshesCache.splice(L,1),this._transparentMeshesCache.push(I)):-1===x&&this._transparentMeshesCache.push(I)):-1!==x?(this._transparentMeshesCache.splice(x,1),this._opaqueMeshesCache.push(I)):-1===L&&this._opaqueMeshesCache.push(I)}_isRenderTargetValid(){var I;return null!==(null===(I=this._opaqueRenderTarget)||void 0===I?void 0:I.getInternalTexture())}_setupRenderTargets(){var I;let x;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new iI.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(I=this._options.clearColor)||void 0===I?void 0:I.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((I=>{x=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?I.clearColor.X(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(I.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=x}));for(const L of this._transparentMeshesCache)this._shouldRenderAsTransmission(L.material)&&(L.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const jI="KHR_materials_transmission";class CI{constructor(I){this.name=jI,this.order=175,this._loader=I,this.enabled=this._loader.isExtensionUsed(jI),this.enabled&&(I.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(I,x,L)),G.push(this._loadTransparentPropertiesAsync(F,x,L,X)),await Promise.all(G).then((()=>{}))}))}_loadTransparentPropertiesAsync(I,x,L,F){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);const X=L;if(X.subSurface.isRefractionEnabled=!0,X.subSurface.volumeIndexOfRefraction=1,X.subSurface.useAlbedoToTintRefraction=!0,void 0===F.transmissionFactor)return X.subSurface.refractionIntensity=0,X.subSurface.isRefractionEnabled=!1,Promise.resolve();{var G;X.subSurface.refractionIntensity=F.transmissionFactor;const I=X.tI();if(X.subSurface.refractionIntensity&&!I._transmissionHelper)new VI({},X.tI());else if(X.subSurface.refractionIntensity&&(null===(G=I._transmissionHelper)||void 0===G||!G._isRenderTargetValid())){var Y;null===(Y=I._transmissionHelper)||void 0===Y||Y._setupRenderTargets()}}return X.subSurface.minimumThickness=0,X.subSurface.maximumThickness=0,F.transmissionTexture?(F.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${I}/transmissionTexture`,F.transmissionTexture,void 0).then((I=>{I.name=`${L.name} (Transmission)`,X.subSurface.refractionIntensityTexture=I,X.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}k(jI),w(jI,!0,(I=>new CI(I)));const bI="KHR_materials_diffuse_transmission";class Ix{constructor(I){this.name=bI,this.order=174,this._loader=I,this.enabled=this._loader.isExtensionUsed(bI),this.enabled&&(I.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(I,x,L)),G.push(this._loadTranslucentPropertiesAsync(F,x,L,X)),await Promise.all(G).then((()=>{}))}))}_loadTranslucentPropertiesAsync(I,x,L,F){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);const X=L;if(X.subSurface.isTranslucencyEnabled=!0,X.subSurface.volumeIndexOfRefraction=1,X.subSurface.minimumThickness=0,X.subSurface.maximumThickness=0,X.subSurface.useAlbedoToTintTranslucency=!1,void 0===F.diffuseTransmissionFactor)return X.subSurface.translucencyIntensity=0,X.subSurface.isTranslucencyEnabled=!1,Promise.resolve();X.subSurface.translucencyIntensity=F.diffuseTransmissionFactor;const Y=new Array;return X.subSurface.useGltfStyleTextures=!0,F.diffuseTransmissionTexture&&(F.diffuseTransmissionTexture.nonColorData=!0,Y.push(this._loader.loadTextureInfoAsync(`${I}/diffuseTransmissionTexture`,F.diffuseTransmissionTexture).then((I=>{I.name=`${L.name} (Diffuse Transmission)`,X.subSurface.translucencyIntensityTexture=I})))),void 0!==F.diffuseTransmissionColorFactor?X.subSurface.translucencyColor=G.Tx.tx(F.diffuseTransmissionColorFactor):X.subSurface.translucencyColor=G.Tx.White(),F.diffuseTransmissionColorTexture&&Y.push(this._loader.loadTextureInfoAsync(`${I}/diffuseTransmissionColorTexture`,F.diffuseTransmissionColorTexture).then((I=>{I.name=`${L.name} (Diffuse Transmission Color)`,X.subSurface.translucencyColorTexture=I}))),Promise.all(Y).then((()=>{}))}}k(bI),w(bI,!0,(I=>new Ix(I)));const xx="KHR_materials_volume";class Lx{constructor(I){this.name=xx,this.order=173,this._loader=I,this.enabled=this._loader.isExtensionUsed(xx),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(I,x,L)),G.push(this._loadVolumePropertiesAsync(F,x,L,X)),await Promise.all(G).then((()=>{}))}))}_loadVolumePropertiesAsync(I,x,L,F){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);if(!L.subSurface.isRefractionEnabled&&!L.subSurface.isTranslucencyEnabled||!F.thicknessFactor)return Promise.resolve();L.subSurface.volumeIndexOfRefraction=L.indexOfRefraction;const X=void 0!==F.attenuationDistance?F.attenuationDistance:Number.MAX_VALUE;return L.subSurface.tintColorAtDistance=X,void 0!==F.attenuationColor&&3==F.attenuationColor.length&&L.subSurface.tintColor.YB(F.attenuationColor[0],F.attenuationColor[1],F.attenuationColor[2]),L.subSurface.minimumThickness=0,L.subSurface.maximumThickness=F.thicknessFactor,L.subSurface.useThicknessAsDepth=!0,F.thicknessTexture?(F.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${I}/thicknessTexture`,F.thicknessTexture).then((I=>{I.name=`${L.name} (Thickness)`,L.subSurface.thicknessTexture=I,L.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}k(xx),w(xx,!0,(I=>new Lx(I)));const Fx="KHR_materials_dispersion";class Xx{constructor(I){this.name=Fx,this.order=174,this._loader=I,this.enabled=this._loader.isExtensionUsed(Fx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(I,x,L)),G.push(this._loadDispersionPropertiesAsync(F,x,L,X)),await Promise.all(G).then((()=>{}))}))}_loadDispersionPropertiesAsync(I,x,L,F){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);return L.subSurface.isRefractionEnabled&&F.dispersion?(L.subSurface.isDispersionEnabled=!0,L.subSurface.dispersion=F.dispersion,Promise.resolve()):Promise.resolve()}}k(Fx),w(Fx,!0,(I=>new Xx(I)));const Gx="EXT_materials_diffuse_roughness";class Yx{constructor(I){this.name=Gx,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(Gx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(I,x,L)),G.push(this._loadDiffuseRoughnessPropertiesAsync(F,X,L)),await Promise.all(G).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(I,x,L){if(!(L instanceof q.b))throw new Error(`${I}: Material type not supported`);const F=new Array;return L.brdf.baseDiffuseModel=NI.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=x.diffuseRoughnessFactor?L.baseDiffuseRoughness=x.diffuseRoughnessFactor:L.baseDiffuseRoughness=0,x.diffuseRoughnessTexture&&F.push(this._loader.loadTextureInfoAsync(`${I}/diffuseRoughnessTexture`,x.diffuseRoughnessTexture,(I=>{I.name=`${L.name} (Diffuse Roughness)`,L.baseDiffuseRoughnessTexture=I}))),Promise.all(F).then((()=>{}))}}k(Gx),w(Gx,!0,(I=>new Yx(I)));const px="KHR_mesh_quantization";class Bx{constructor(I){this.name=px,this.enabled=I.isExtensionUsed(px)}dispose(){}}k(px),w(px,!0,(I=>new Bx(I)));const lx="KHR_texture_basisu";class Wx{constructor(I){this.name=lx,this._loader=I,this.enabled=I.isExtensionUsed(lx)}dispose(){this._loader=null}_loadTextureAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>{const G=void 0==x.sampler?c.DefaultSampler:N.Get(`${I}/sampler`,this._loader.Ep.samplers,x.sampler),Y=N.Get(`${F}/source`,this._loader.Ep.images,X.source);return await this._loader._createTextureAsync(I,G,Y,(I=>{L(I)}),x._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!x._textureInfo.nonColorData)}))}}k(lx),w(lx,!0,(I=>new Wx(I)));const Qx="KHR_texture_transform";class ex{constructor(I){this.name=Qx,this._loader=I,this.enabled=this._loader.isExtensionUsed(Qx)}dispose(){this._loader=null}loadTextureInfoAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(F,X)=>await this._loader.loadTextureInfoAsync(I,x,(I=>{if(!(I instanceof y.d))throw new Error(`${F}: Texture type not supported`);X.offset&&(I.uOffset=X.offset[0],I.vOffset=X.offset[1]),I.uRotationCenter=0,I.vRotationCenter=0,X.rotation&&(I.wAng=-X.rotation),X.scale&&(I.uScale=X.scale[0],I.vScale=X.scale[1]),void 0!=X.texCoord&&(I.coordinatesIndex=X.texCoord),L(I)}))))}}k(Qx),w(Qx,!0,(I=>new ex(I)));const gx="KHR_xmp_json_ld";class vx{constructor(I){this.name=gx,this.order=100,this._loader=I,this.enabled=this._loader.isExtensionUsed(gx)}dispose(){this._loader=null}onLoading(){var I,x,L;if(null===this._loader.rootBabylonMesh)return;const F=null===(I=this._loader.Ep.extensions)||void 0===I?void 0:I.KHR_xmp_json_ld,X=null===(x=this._loader.Ep.asset)||void 0===x||null===(L=x.extensions)||void 0===L?void 0:L.KHR_xmp_json_ld;if(F&&X){const I=+X.packet;F.packets&&I<F.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=F.packets[I])}}}function zx(I,x,L,F){return G.Tx.tx(x,L).scale(F)}function Hx(I,x,L,F){return x[L]*F}function sx(I,x,L,F){return-x[L]*F}function Ux(I,x,L,F){return x[L+1]*F}function qx(I,x,L,F){return x[L]*F*2}function yx(I){return{scale:[new Zx(e.d.ANIMATIONTYPE_FLOAT,`${I}.uScale`,Hx,(()=>2)),new Zx(e.d.ANIMATIONTYPE_FLOAT,`${I}.vScale`,Ux,(()=>2))],offset:[new Zx(e.d.ANIMATIONTYPE_FLOAT,`${I}.uOffset`,Hx,(()=>2)),new Zx(e.d.ANIMATIONTYPE_FLOAT,`${I}.vOffset`,Ux,(()=>2))],rotation:[new Zx(e.d.ANIMATIONTYPE_FLOAT,`${I}.wAng`,sx,(()=>1))]}}k(gx),w(gx,!0,(I=>new vx(I)));class Tx extends o.AnimationPropertyInfo{buildAnimations(I,x,L,F){return[{babylonAnimatable:I._babylonCamera,babylonAnimation:this._buildAnimation(x,L,F)}]}}class Zx extends o.AnimationPropertyInfo{buildAnimations(I,x,L,F){const X=[];for(const G in I._data)X.push({babylonAnimatable:I._data[G].babylonMaterial,babylonAnimation:this._buildAnimation(x,L,F)});return X}}class tx extends o.AnimationPropertyInfo{buildAnimations(I,x,L,F){return[{babylonAnimatable:I._babylonLight,babylonAnimation:this._buildAnimation(x,L,F)}]}}(0,a.j)("/cameras/{}/orthographic/xmag",[new Tx(e.d.ANIMATIONTYPE_FLOAT,"orthoLeft",sx,(()=>1)),new Tx(e.d.ANIMATIONTYPE_FLOAT,"orthoRight",Ux,(()=>1))]),(0,a.j)("/cameras/{}/orthographic/ymag",[new Tx(e.d.ANIMATIONTYPE_FLOAT,"orthoBottom",sx,(()=>1)),new Tx(e.d.ANIMATIONTYPE_FLOAT,"orthoTop",Ux,(()=>1))]),(0,a.j)("/cameras/{}/orthographic/zfar",[new Tx(e.d.ANIMATIONTYPE_FLOAT,"maxZ",Hx,(()=>1))]),(0,a.j)("/cameras/{}/orthographic/znear",[new Tx(e.d.ANIMATIONTYPE_FLOAT,"IB",Hx,(()=>1))]),(0,a.j)("/cameras/{}/perspective/yfov",[new Tx(e.d.ANIMATIONTYPE_FLOAT,"fov",Hx,(()=>1))]),(0,a.j)("/cameras/{}/perspective/zfar",[new Tx(e.d.ANIMATIONTYPE_FLOAT,"maxZ",Hx,(()=>1))]),(0,a.j)("/cameras/{}/perspective/znear",[new Tx(e.d.ANIMATIONTYPE_FLOAT,"IB",Hx,(()=>1))]),(0,a.j)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Zx(e.d.ANIMATIONTYPE_COLOR3,"albedoColor",zx,(()=>4)),new Zx(e.d.ANIMATIONTYPE_FLOAT,"alpha",(function(I,x,L,F){return x[L+3]*F}),(()=>4))]),(0,a.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"metallic",Hx,(()=>1))]),(0,a.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"roughness",Hx,(()=>1))]);const fx=yx("albedoTexture");(0,a.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",fx.scale),(0,a.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",fx.offset),(0,a.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",fx.rotation);const Rx=yx("metallicTexture");(0,a.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Rx.scale),(0,a.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Rx.offset),(0,a.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Rx.rotation),(0,a.j)("/materials/{}/emissiveFactor",[new Zx(e.d.ANIMATIONTYPE_COLOR3,"emissiveColor",zx,(()=>3))]);const nx=yx("bumpTexture");(0,a.j)("/materials/{}/normalTexture/scale",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Hx,(()=>1))]),(0,a.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",nx.scale),(0,a.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",nx.offset),(0,a.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",nx.rotation),(0,a.j)("/materials/{}/occlusionTexture/strength",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Hx,(()=>1))]);const Px=yx("ambientTexture");(0,a.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Px.scale),(0,a.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Px.offset),(0,a.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Px.rotation);const dx=yx("emissiveTexture");(0,a.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",dx.scale),(0,a.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",dx.offset),(0,a.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",dx.rotation),(0,a.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Hx,(()=>1))]),(0,a.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Hx,(()=>1))]);const Mx=yx("anisotropy.texture");(0,a.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Mx.scale),(0,a.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Mx.offset),(0,a.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Mx.rotation),(0,a.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Hx,(()=>1))]),(0,a.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Hx,(()=>1))]);const Kx=yx("clearCoat.texture");(0,a.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Kx.scale),(0,a.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Kx.offset),(0,a.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Kx.rotation);const ux=yx("clearCoat.bumpTexture");(0,a.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Hx,(()=>1))]),(0,a.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",ux.scale),(0,a.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",ux.offset),(0,a.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",ux.rotation);const Ax=yx("clearCoat.textureRoughness");(0,a.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Ax.scale),(0,a.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Ax.offset),(0,a.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Ax.rotation),(0,a.j)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Hx,(()=>1))]),(0,a.j)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Hx,(()=>1))]),(0,a.j)("/materials/{}/extensions/KHR_materials_ior/ior",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Hx,(()=>1))]),(0,a.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Hx,(()=>1))]),(0,a.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Hx,(()=>1))]),(0,a.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Hx,(()=>1))]),(0,a.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Hx,(()=>1))]);const mL=yx("iridescence.texture");(0,a.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",mL.scale),(0,a.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",mL.offset),(0,a.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",mL.rotation);const Ox=yx("iridescence.thicknessTexture");(0,a.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Ox.scale),(0,a.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Ox.offset),(0,a.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Ox.rotation),(0,a.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Zx(e.d.ANIMATIONTYPE_COLOR3,"sheen.color",zx,(()=>3))]),(0,a.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",Hx,(()=>1))]);const wx=yx("sheen.texture");(0,a.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",wx.scale),(0,a.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",wx.offset),(0,a.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",wx.rotation);const kx=yx("sheen.textureRoughness");(0,a.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",kx.scale),(0,a.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",kx.offset),(0,a.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",kx.rotation),(0,a.j)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Hx,(()=>1))]),(0,a.j)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Zx(e.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",zx,(()=>3))]);const ax=yx("metallicReflectanceTexture");(0,a.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",ax.scale),(0,a.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",ax.offset),(0,a.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",ax.rotation);const Dx=yx("reflectanceTexture");(0,a.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Dx.scale),(0,a.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Dx.offset),(0,a.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Dx.rotation),(0,a.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Hx,(()=>1))]);const rx=yx("subSurface.refractionIntensityTexture");(0,a.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",rx.scale),(0,a.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",rx.offset),(0,a.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",rx.rotation),(0,a.j)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Zx(e.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",zx,(()=>3))]),(0,a.j)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Hx,(()=>1))]),(0,a.j)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Hx,(()=>1))]);const Nx=yx("subSurface.thicknessTexture");(0,a.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Nx.scale),(0,a.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Nx.offset),(0,a.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Nx.rotation),(0,a.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Zx(e.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Hx,(()=>1))]);const Sx=yx("subSurface.translucencyIntensityTexture");(0,a.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Sx.scale),(0,a.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Sx.offset),(0,a.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Sx.rotation),(0,a.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Zx(e.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",zx,(()=>3))]);const cx=yx("subSurface.translucencyColorTexture");(0,a.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",cx.scale),(0,a.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",cx.offset),(0,a.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",cx.rotation),(0,a.j)("/extensions/KHR_lights_punctual/lights/{}/color",[new tx(e.d.ANIMATIONTYPE_COLOR3,"diffuse",zx,(()=>3))]),(0,a.j)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new tx(e.d.ANIMATIONTYPE_FLOAT,"intensity",Hx,(()=>1))]),(0,a.j)("/extensions/KHR_lights_punctual/lights/{}/range",[new tx(e.d.ANIMATIONTYPE_FLOAT,"range",Hx,(()=>1))]),(0,a.j)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new tx(e.d.ANIMATIONTYPE_FLOAT,"innerAngle",qx,(()=>1))]),(0,a.j)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new tx(e.d.ANIMATIONTYPE_FLOAT,"angle",qx,(()=>1))]),(0,a.j)("/nodes/{}/extensions/EXT_lights_ies/color",[new tx(e.d.ANIMATIONTYPE_COLOR3,"diffuse",zx,(()=>3))]),(0,a.j)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new tx(e.d.ANIMATIONTYPE_FLOAT,"intensity",Hx,(()=>1))]);const ox="KHR_animation_pointer";class Jx{constructor(I){this.name=ox,this._loader=I,this._pathToObjectConverter=(0,a.f)(this._loader.Ep)}get enabled(){return this._loader.isExtensionUsed(ox)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(I,x,L,F,X){var G;const Y=null===(G=F.target.extensions)||void 0===G?void 0:G.KHR_animation_pointer;if(!Y||!this._pathToObjectConverter)return null;"pointer"!==F.target.path&&z.c.Warn(`${I}/target/path: Value (${F.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=F.target.node&&z.c.Warn(`${I}/target/node: Value (${F.target.node}) must not be present when using the ${this.name} extension`);const p=`${I}/extensions/${this.name}`,B=Y.pointer;if(!B)throw new Error(`${p}: Pointer is missing`);try{const G=this._pathToObjectConverter.convert(B);if(!G.info.interpolation)throw new Error(`${p}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(I,x,L,F,{object:G.object,info:G.info.interpolation},X)}catch(l){return z.c.Warn(`${p}/pointer: Invalid pointer (${B}) skipped`),null}}}k(ox),w(ox,!0,(I=>new Jx(I)));class hx{constructor(I,x,L){this.frame=I,this.action=x,this.onlyOnce=L,this.isDone=!1}_clone(){return new hx(this.frame,this.action,this.onlyOnce)}}var Ex=L(12825),ix=L(12872),Vx=L(12865);class jx{get loop(){return this._loop}set loop(I){I!==this._loop&&(this._loop=I,this.updateOptions({loop:I}))}get currentTime(){var I;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(I=ix.d.audioEngine)&&void 0!==I&&I.audioContext&&(this.isPlaying||this.isPaused)){const I=this.isPaused?0:ix.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+I}return 0}get spatialSound(){return this._spatialSound}set spatialSound(I){if(I==this._spatialSound)return;const x=this.isPlaying;this.pause(),I?(this._spatialSound=I,this._updateSpatialParameters()):this._disableSpatialSound(),x&&this.play()}constructor(I,x,L){var F;let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new W.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=X.sx.Zero(),this._localDirection=new X.sx(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=I,L=L||v.e.LastCreatedScene)if(this._scene=L,jx._SceneComponentInitialization(L),this._readyToPlayCallback=G,this._customAttenuationFunction=(I,x,L,F,X)=>x<L?I*(1-x/L):0,p&&(this.autoplay=p.autoplay||!1,this._loop=p.loop||!1,void 0!==p.volume&&(this._volume=p.volume),this._spatialSound=p.spatialSound??!1,this.maxDistance=p.maxDistance??100,this.useCustomAttenuation=p.useCustomAttenuation??!1,this.rolloffFactor=p.rolloffFactor||1,this.refDistance=p.refDistance||1,this.distanceModel=p.distanceModel||"linear",this._playbackRate=p.playbackRate||1,this._streaming=p.streaming??!1,this._length=p.length,this._offset=p.offset),null!==(F=ix.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&ix.d.audioEngine.audioContext){this._soundGain=ix.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let I=!0;if(x)try{"string"===typeof x?(this._urlType="String",this._url=x):x instanceof ArrayBuffer?this._urlType="ArrayBuffer":x instanceof HTMLMediaElement?this._urlType="MediaElement":x instanceof MediaStream?this._urlType="MediaStream":x instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(x)&&(this._urlType="Array");let L=[],F=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=ix.d.audioEngine.audioContext.createMediaElementSource(x),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=ix.d.audioEngine.audioContext.createMediaStreamSource(x),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":x.byteLength>0&&(F=!0,this._soundLoaded(x));break;case"AudioBuffer":this._audioBufferLoaded(x);break;case"String":L.push(x);case"Array":0===L.length&&(L=x);for(let I=0;I<L.length;I++){const x=L[I];if(F=p&&p.skipCodecCheck||-1!==x.indexOf(".mp3",x.length-4)&&ix.d.audioEngine.isMP3supported||-1!==x.indexOf(".ogg",x.length-4)&&ix.d.audioEngine.isOGGsupported||-1!==x.indexOf(".wav",x.length-4)||-1!==x.indexOf(".m4a",x.length-4)||-1!==x.indexOf(".mp4",x.length-4)||-1!==x.indexOf("blob:"),F){this._streaming?(this._htmlAudioElement=new Audio(x),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Y.Tools.SetCorsBehavior(x,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(x,(I=>{this._soundLoaded(I)}),void 0,!0,!0,(I=>{I&&z.c.Error("XHR "+I.status+" error on: "+x+"."),z.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:I=!1}I?F||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):z.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(B){z.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),ix.d.audioEngine&&!ix.d.audioEngine.WarnedWebAudioUnsupported&&(z.c.Error("Web Audio is not supported by your browser."),ix.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var I;null!==(I=ix.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(I){var x;null!==(x=ix.d.audioEngine)&&void 0!==x&&x.audioContext&&(this._audioBuffer=I,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(I){var x;null!==(x=ix.d.audioEngine)&&void 0!==x&&x.audioContext&&ix.d.audioEngine.audioContext.decodeAudioData(I,(I=>{this._audioBufferLoaded(I)}),(I=>{z.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+I)}))}setAudioBuffer(I){var x;null!==(x=ix.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&(this._audioBuffer=I,this._isReadyToPlay=!0)}updateOptions(I){I&&(this.loop=I.loop??this.loop,this.maxDistance=I.maxDistance??this.maxDistance,this.useCustomAttenuation=I.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=I.rolloffFactor??this.rolloffFactor,this.refDistance=I.refDistance??this.refDistance,this.distanceModel=I.distanceModel??this.distanceModel,this._playbackRate=I.playbackRate??this._playbackRate,this._length=I.length??void 0,this.spatialSound=I.spatialSound??this._spatialSound,this._setOffset(I.offset??void 0),this.setVolume(I.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var I;null!==(I=ix.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&ix.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??ix.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var I;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(I=this._soundPanner)||void 0===I||I.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var I;null!==(I=ix.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(I){var x;null!==(x=ix.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(I),this._isOutputConnected=!0)}setDirectionalCone(I,x,L){x<I?z.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=I,this._coneOuterAngle=x,this._coneOuterGain=L,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(I){if(I!=this._coneInnerAngle){var x;if(this._coneOuterAngle<I)return void z.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=I,null!==(x=ix.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(I){if(I!=this._coneOuterAngle){var x;if(I<this._coneInnerAngle)return void z.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=I,null!==(x=ix.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(I){var x;I.equals(this._position)||(this._position.X(I),null!==(x=ix.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(I){var x;this._localDirection=I,null!==(x=ix.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const I=this._connectedTransformNode.getWorldMatrix(),x=X.sx.TransformNormal(this._localDirection,I);x.normalize(),this._soundPanner.orientationX.value=x.x,this._soundPanner.orientationY.value=x.y,this._soundPanner.orientationZ.value=x.z}updateDistanceFromListener(){var I;if(null!==(I=ix.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const I=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Ux(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,I,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(I){this._customAttenuationFunction=I}play(I,x,L){var F;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(F=ix.d.audioEngine)&&void 0!==F&&F.audioContext)try{var X,G;this._clearTimeoutsAndObservers();let F=I?(null===(X=ix.d.audioEngine)||void 0===X?void 0:X.audioContext.currentTime)+I:null===(G=ix.d.audioEngine)||void 0===G?void 0:G.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=ix.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const I=()=>{var L;if(null!==(L=ix.d.audioEngine)&&void 0!==L&&L.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=x??0;const L=this._htmlAudioElement.play();void 0!==L&&L.catch((()=>{var x,L;(null===(x=ix.d.audioEngine)||void 0===x||x.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(L=ix.d.audioEngine)||void 0===L?void 0:L.onAudioUnlockedObservable.addOnce((()=>{I()})))}))}else{var F;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(F=ix.d.audioEngine)||void 0===F?void 0:F.onAudioUnlockedObservable.addOnce((()=>{I()}))}};I()}}else{var Y;const X=()=>{var X;if(null!==(X=ix.d.audioEngine)&&void 0!==X&&X.audioContext){var G;if(L=L||this._length,void 0!==x&&this._setOffset(x),this._soundSource){const I=this._soundSource;I.onended=()=>{I.disconnect()}}if(this._soundSource=null===(G=ix.d.audioEngine)||void 0===G?void 0:G.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var Y;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==x&&(this._soundSource.loopStart=x),void 0!==L&&(this._soundSource.loopEnd=(0|x)+L),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},F=I?(null===(Y=ix.d.audioEngine)||void 0===Y?void 0:Y.audioContext.currentTime)+I:ix.d.audioEngine.audioContext.currentTime;const X=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(F,X,this.loop?void 0:L)}}};"suspended"===(null===(Y=ix.d.audioEngine)||void 0===Y?void 0:Y.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var I;"suspended"===(null===(I=ix.d.audioEngine)||void 0===I?void 0:I.audioContext.state)?(ix.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=ix.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{X()})))):X()}),500):X()}this._startTime=F,this.isPlaying=!0,this.isPaused=!1}catch(p){z.c.Error("Error while trying to play audio: "+this.name+", "+p.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(I){var x;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var L;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(L=this._streamingSource)||void 0===L||L.disconnect();this.isPlaying=!1}else if(null!==(x=ix.d.audioEngine)&&void 0!==x&&x.audioContext&&this._soundSource){const x=I?ix.d.audioEngine.audioContext.currentTime+I:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(x)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var I;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var x;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(x=this._streamingSource)||void 0===x||x.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(I=ix.d.audioEngine)&&void 0!==I&&I.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=ix.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(I,x){var L;null!==(L=ix.d.audioEngine)&&void 0!==L&&L.canUseWebAudio&&this._soundGain&&(x&&ix.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(ix.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,ix.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(I,ix.d.audioEngine.audioContext.currentTime+x)):this._soundGain.gain.value=I),this._volume=I}setPlaybackRate(I){this._playbackRate=I,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(I){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=I,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=I=>this._onRegisterAfterWorldMatrixUpdate(I),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(I){var x;if(I.getBoundingInfo){const x=I.getBoundingInfo();this.setPosition(x.boundingSphere.centerWorld)}else this.setPosition(I.absolutePosition);null!==(x=ix.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const I=()=>{(0,Vx.e)((()=>this._isReadyToPlay),(()=>{L._audioBuffer=this.getAudioBuffer(),L._isReadyToPlay=!0,L.autoplay&&L.play(0,this._offset,this._length)}),void 0,300)},x={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},L=new jx(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,x);return this.useCustomAttenuation&&L.setAttenuationFunction(this._customAttenuationFunction),L.setPosition(this._position),L.setPlaybackRate(this._playbackRate),I(),L}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const I={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(I.connectedMeshId=this._connectedTransformNode.id),I.position=this._position.Cp(),I.refDistance=this.refDistance,I.distanceModel=this.distanceModel,I.isDirectional=this._isDirectional,I.localDirectionToMesh=this._localDirection.Cp(),I.coneInnerAngle=this._coneInnerAngle,I.coneOuterAngle=this._coneOuterAngle,I.coneOuterGain=this._coneOuterGain),I}static Parse(I,x,L,F){const G=I.name;let Y;Y=I.url?L+I.url:L+G;const p={autoplay:I.autoplay,loop:I.loop,volume:I.volume,spatialSound:I.spatialSound,maxDistance:I.maxDistance,rolloffFactor:I.rolloffFactor,refDistance:I.refDistance,distanceModel:I.distanceModel,playbackRate:I.playbackRate};let B;if(F){const I=()=>{(0,Vx.e)((()=>F._isReadyToPlay),(()=>{B._audioBuffer=F.getAudioBuffer(),B._isReadyToPlay=!0,B.autoplay&&B.play(0,B._offset,B._length)}),void 0,300)};B=new jx(G,new ArrayBuffer(0),x,null,p),I()}else B=new jx(G,Y,x,(()=>{x.removePendingData(B)}),p),x.addPendingData(B);if(I.position){const x=X.sx.tx(I.position);B.setPosition(x)}if(I.isDirectional&&(B.setDirectionalCone(I.coneInnerAngle||360,I.coneOuterAngle||360,I.coneOuterGain||0),I.localDirectionToMesh)){const x=X.sx.tx(I.localDirectionToMesh);B.setLocalDirectionToMesh(x)}if(I.connectedMeshId){const L=x.getMeshById(I.connectedMeshId);L&&B.attachToMesh(L)}return I.metadata&&(B.metadata=I.metadata),B}_setOffset(I){this._offset!==I&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=I)}_clearTimeoutsAndObservers(){var I;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(I=ix.d.audioEngine)||void 0===I||I.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}jx._SceneComponentInitialization=I=>{throw(0,Ex.e)("AudioSceneComponent")},(0,ZI.d)("BABYLON.Sound",jx);class Cx{constructor(I,x,L){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],x.length!==L.length)throw new Error("Sounds length does not equal weights length");this.loop=I,this._weights=L;let F=0;for(const G of L)F+=G;const X=F>0?1/F:0;for(let G=0;G<this._weights.length;G++)this._weights[G]*=X;this._sounds=x;for(const G of this._sounds)G.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(I){if(I!==this._coneInnerAngle){if(this._coneOuterAngle<I)return void z.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=I;for(const x of this._sounds)x.directionalConeInnerAngle=I}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(I){if(I!==this._coneOuterAngle){if(I<this._coneInnerAngle)return void z.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=I;for(const x of this._sounds)x.directionalConeOuterAngle=I}}get volume(){return this._volume}set volume(I){if(I!==this._volume)for(const x of this._sounds)x.setVolume(I)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(I){if(!this.isPaused){this.stop();const I=Math.random();let x=0;for(let L=0;L<this._weights.length;L++)if(x+=this._weights[L],I<=x){this._currentIndex=L;break}}const x=this._sounds[this._currentIndex??0];x.isReady()?x.play(0,this.isPaused?void 0:I):x.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class bx{constructor(I){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(I=I||v.e.LastCreatedScene)&&(this._scene=I,this.soundCollection=[],this._options=x,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var I;null!==(I=ix.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&ix.d.audioEngine.audioContext&&(this._outputAudioNode=ix.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(ix.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(ix.d.audioEngine&&ix.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(I){var x;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(x=ix.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&I.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==I.soundTrackId&&(-1===I.soundTrackId?this._scene.mainSoundTrack.removeSound(I):this._scene.soundTracks&&this._scene.soundTracks[I.soundTrackId].removeSound(I)),this.soundCollection.push(I),I.soundTrackId=this.id}removeSound(I){const x=this.soundCollection.indexOf(I);-1!==x&&this.soundCollection.splice(x,1)}setVolume(I){var x;null!==(x=ix.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=I)}switchPanningModelToHRTF(){var I;if(null!==(I=ix.d.audioEngine)&&void 0!==I&&I.canUseWebAudio)for(let x=0;x<this.soundCollection.length;x++)this.soundCollection[x].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var I;if(null!==(I=ix.d.audioEngine)&&void 0!==I&&I.canUseWebAudio)for(let x=0;x<this.soundCollection.length;x++)this.soundCollection[x].switchPanningModelToEqualPower()}connectToAnalyser(I){var x;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=I,null!==(x=ix.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,ix.d.audioEngine.masterGain))}}var IL=L(13252),xL=L(13218),LL=L(12805);ix.d.AudioEngineFactory=(I,x,L)=>new FL(I,x,L);class FL{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new W.c,this.onAudioLockedObservable=new W.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,LL.l)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const F=document.createElement("audio");this._hostElement=I,this._audioContext=x,this._audioDestination=L;try{F&&F.canPlayType&&(F.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||F.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(X){}try{F&&F.canPlayType&&F.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(X){}}lock(){this._triggerSuspendedState()}unlock(){var I,x;if("running"===(null===(I=this._audioContext)||void 0===I?void 0:I.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(x=this._audioContext)||void 0===x||x.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{z.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var I;null===(I=this._audioContext)||void 0===I||I.addEventListener("statechange",(()=>{var I;this.unlocked&&"running"!==(null===(I=this._audioContext)||void 0===I?void 0:I.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var I;return null!==(I=this._audioContext)&&void 0!==I&&I.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(I){this.canUseWebAudio=!1,z.c.Error("Web Audio: "+I.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(I){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const I=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",x=document.createElement("style");x.appendChild(document.createTextNode(I)),document.getElementsByTagName("head")[0].appendChild(x),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var I;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(I=this._audioContext)||void 0===I||I.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(I){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=I)}connectToAnalyser(I){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=I,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var XL=L(12823);(0,L(14174).d)(IL.e.NAME_AUDIO,((I,x,L,F)=>{let X,G=[];if(L.Vg=L.Vg||[],void 0!==I.Vg&&null!==I.Vg)for(let p=0,B=I.Vg.length;p<B;p++){var Y;const B=I.Vg[p];null!==(Y=ix.d.audioEngine)&&void 0!==Y&&Y.canUseWebAudio?(B.url||(B.url=B.name),G[B.url]?L.Vg.push(jx.Parse(B,x,F,G[B.url])):(X=jx.Parse(B,x,F),G[B.url]=X,L.Vg.push(X))):L.Vg.push(new jx(B.name,null,x))}G=[]})),Object.defineProperty(xL.b.prototype,"mainSoundTrack",{get:function(){let I=this._getComponent(IL.e.NAME_AUDIO);return I||(I=new GL(this),this.o(I)),this._mainSoundTrack||(this._mainSoundTrack=new bx(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),xL.b.prototype.getSoundByName=function(I){let x;for(x=0;x<this.mainSoundTrack.soundCollection.length;x++)if(this.mainSoundTrack.soundCollection[x].name===I)return this.mainSoundTrack.soundCollection[x];if(this.soundTracks)for(let L=0;L<this.soundTracks.length;L++)for(x=0;x<this.soundTracks[L].soundCollection.length;x++)if(this.soundTracks[L].soundCollection[x].name===I)return this.soundTracks[L].soundCollection[x];return null},Object.defineProperty(xL.b.prototype,"audioEnabled",{get:function(){let I=this._getComponent(IL.e.NAME_AUDIO);return I||(I=new GL(this),this.o(I)),I.audioEnabled},set:function(I){let x=this._getComponent(IL.e.NAME_AUDIO);x||(x=new GL(this),this.o(x)),I?x.enableAudio():x.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(xL.b.prototype,"headphone",{get:function(){let I=this._getComponent(IL.e.NAME_AUDIO);return I||(I=new GL(this),this.o(I)),I.headphone},set:function(I){let x=this._getComponent(IL.e.NAME_AUDIO);x||(x=new GL(this),this.o(x)),I?x.switchAudioModeForHeadphones():x.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(xL.b.prototype,"audioListenerPositionProvider",{get:function(){let I=this._getComponent(IL.e.NAME_AUDIO);return I||(I=new GL(this),this.o(I)),I.audioListenerPositionProvider},set:function(I){let x=this._getComponent(IL.e.NAME_AUDIO);if(x||(x=new GL(this),this.o(x)),I&&"function"!==typeof I)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");x.audioListenerPositionProvider=I},enumerable:!0,configurable:!0}),Object.defineProperty(xL.b.prototype,"audioListenerRotationProvider",{get:function(){let I=this._getComponent(IL.e.NAME_AUDIO);return I||(I=new GL(this),this.o(I)),I.audioListenerRotationProvider},set:function(I){let x=this._getComponent(IL.e.NAME_AUDIO);if(x||(x=new GL(this),this.o(x)),I&&"function"!==typeof I)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");x.audioListenerRotationProvider=I},enumerable:!0,configurable:!0}),Object.defineProperty(xL.b.prototype,"audioPositioningRefreshRate",{get:function(){let I=this._getComponent(IL.e.NAME_AUDIO);return I||(I=new GL(this),this.o(I)),I.audioPositioningRefreshRate},set:function(I){let x=this._getComponent(IL.e.NAME_AUDIO);x||(x=new GL(this),this.o(x)),x.audioPositioningRefreshRate=I},enumerable:!0,configurable:!0});class GL{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(I){this.name=IL.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new X.sx,this._cachedCameraPosition=new X.sx,this._lastCheck=0,this._invertMatrixTemp=new X.Matrix,this._cameraDirectionTemp=new X.sx,(I=I||v.e.LastCreatedScene)&&(this.qx=I,I.soundTracks=[],I.Vg=[])}register(){this.qx._afterRenderStage.registerStep(IL.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(I){if(I.Vg=[],this.qx.soundTracks)for(let x=0;x<this.qx.soundTracks.length;x++){const L=this.qx.soundTracks[x];for(let x=0;x<L.soundCollection.length;x++)I.Vg.push(L.soundCollection[x].serialize())}}addFromContainer(I){if(I.Vg)for(const x of I.Vg)x.play(),x.autoplay=!0,this.qx.mainSoundTrack.addSound(x)}removeFromContainer(I){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(I.Vg)for(const L of I.Vg)L.stop(),L.autoplay=!1,this.qx.mainSoundTrack.removeSound(L),x&&L.dispose()}dispose(){const I=this.qx;if(I._mainSoundTrack&&I.mainSoundTrack.dispose(),I.soundTracks)for(let x=0;x<I.soundTracks.length;x++)I.soundTracks[x].dispose()}disableAudio(){const I=this.qx;let x;for(this._audioEnabled=!1,ix.d.audioEngine&&ix.d.audioEngine.audioContext&&ix.d.audioEngine.audioContext.suspend(),x=0;x<I.mainSoundTrack.soundCollection.length;x++)I.mainSoundTrack.soundCollection[x].pause();if(I.soundTracks)for(x=0;x<I.soundTracks.length;x++)for(let L=0;L<I.soundTracks[x].soundCollection.length;L++)I.soundTracks[x].soundCollection[L].pause()}enableAudio(){const I=this.qx;let x;for(this._audioEnabled=!0,ix.d.audioEngine&&ix.d.audioEngine.audioContext&&ix.d.audioEngine.audioContext.resume(),x=0;x<I.mainSoundTrack.soundCollection.length;x++)I.mainSoundTrack.soundCollection[x].isPaused&&I.mainSoundTrack.soundCollection[x].play();if(I.soundTracks)for(x=0;x<I.soundTracks.length;x++)for(let L=0;L<I.soundTracks[x].soundCollection.length;L++)I.soundTracks[x].soundCollection[L].isPaused&&I.soundTracks[x].soundCollection[L].play()}switchAudioModeForHeadphones(){const I=this.qx;if(this._headphone=!0,I.mainSoundTrack.switchPanningModelToHRTF(),I.soundTracks)for(let x=0;x<I.soundTracks.length;x++)I.soundTracks[x].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const I=this.qx;if(this._headphone=!1,I.mainSoundTrack.switchPanningModelToEqualPower(),I.soundTracks)for(let x=0;x<I.soundTracks.length;x++)I.soundTracks[x].switchPanningModelToEqualPower()}_afterRender(){const I=XL.c.Now;if(this._lastCheck&&I-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=I;const x=this.qx;if(!this._audioEnabled||!x._mainSoundTrack||!x.soundTracks||0===x._mainSoundTrack.soundCollection.length&&1===x.soundTracks.length)return;const L=ix.d.audioEngine;if(L&&L.audioContext){let I,F=x.activeCamera;if(x.activeCameras&&x.activeCameras.length>0&&(F=x.activeCameras[0]),this.audioListenerPositionProvider){const I=this.audioListenerPositionProvider();L.audioContext.listener.setPosition(I.x||0,I.y||0,I.z||0)}else F?this._cachedCameraPosition.equals(F.globalPosition)||(this._cachedCameraPosition.X(F.globalPosition),L.audioContext.listener.setPosition(F.globalPosition.x,F.globalPosition.y,F.globalPosition.z)):L.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const I=this.audioListenerRotationProvider();L.audioContext.listener.setOrientation(I.x||0,I.y||0,I.z||0,0,1,0)}else F?(F.rigCameras&&F.rigCameras.length>0&&(F=F.rigCameras[0]),F.getViewMatrix().invertToRef(this._invertMatrixTemp),X.sx.TransformNormalToRef(GL._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.X(this._cameraDirectionTemp),L.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):L.audioContext.listener.setOrientation(0,0,0,0,1,0);for(I=0;I<x.mainSoundTrack.soundCollection.length;I++){const L=x.mainSoundTrack.soundCollection[I];L.useCustomAttenuation&&L.updateDistanceFromListener()}if(x.soundTracks)for(I=0;I<x.soundTracks.length;I++)for(let L=0;L<x.soundTracks[I].soundCollection.length;L++){const F=x.soundTracks[I].soundCollection[L];F.useCustomAttenuation&&F.updateDistanceFromListener()}}}}GL._CameraDirection=new X.sx(0,0,-1),jx._SceneComponentInitialization=I=>{let x=I._getComponent(IL.e.NAME_AUDIO);x||(x=new GL(I),I.o(x))};const YL="MSFT_audio_emitter";class pL{constructor(I){this.name=YL,this._loader=I,this.enabled=this._loader.isExtensionUsed(YL)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const I=this._loader.Ep.extensions;if(I&&I[this.name]){const x=I[this.name];this._clips=x.clips,this._emitters=x.emitters,N.Assign(this._clips),N.Assign(this._emitters)}}loadSceneAsync(I,x){return c.LoadExtensionAsync(I,x,this.name,(async(L,F)=>{const X=new Array;X.push(this._loader.loadSceneAsync(I,x));for(const I of F.emitters){const x=N.Get(`${L}/emitters`,this._emitters,I);if(void 0!=x.refDistance||void 0!=x.maxDistance||void 0!=x.rolloffFactor||void 0!=x.distanceModel||void 0!=x.innerAngle||void 0!=x.outerAngle)throw new Error(`${L}: Direction or Distance properties are not allowed on emitters attached to a scene`);X.push(this._loadEmitterAsync(`${L}/emitters/${x.index}`,x))}await Promise.all(X)}))}loadNodeAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(I,F)=>{const G=new Array,p=await this._loader.loadNodeAsync(I,x,(x=>{for(const L of F.emitters){const F=N.Get(`${I}/emitters`,this._emitters,L);G.push(this._loadEmitterAsync(`${I}/emitters/${F.index}`,F).then((()=>{for(const I of F._babylonSounds)I.attachToMesh(x),void 0==F.innerAngle&&void 0==F.outerAngle||(I.setLocalDirectionToMesh(X.sx.Forward()),I.setDirectionalCone(2*Y.Tools.ToDegrees(void 0==F.innerAngle?Math.PI:F.innerAngle),2*Y.Tools.ToDegrees(void 0==F.outerAngle?Math.PI:F.outerAngle),0))})))}L(x)}));return await Promise.all(G),p}))}loadAnimationAsync(I,x){return c.LoadExtensionAsync(I,x,this.name,(async(L,F)=>{const X=await this._loader.loadAnimationAsync(I,x),G=new Array;N.Assign(F.events);for(const Y of F.events)G.push(this._loadAnimationEventAsync(`${L}/events/${Y.index}`,I,x,Y,X));return await Promise.all(G),X}))}_loadClipAsync(I,x){if(x._objectURL)return x._objectURL;let L;if(x.uri)L=this._loader.loadUriAsync(I,x,x.uri);else{const F=N.Get(`${I}/bufferView`,this._loader.Ep.bufferViews,x.bufferView);L=this._loader.loadBufferViewAsync(`/bufferViews/${F.index}`,F)}return x._objectURL=L.then((I=>URL.createObjectURL(new Blob([I],{type:x.mimeType})))),x._objectURL}_loadEmitterAsync(I,x){if(x._babylonSounds=x._babylonSounds||[],!x._babylonData){const I=new Array,L=x.name||`emitter${x.index}`,F={loop:!1,autoplay:!1,volume:void 0==x.volume?1:x.volume};for(let G=0;G<x.clips.length;G++){const X=`/extensions/${this.name}/clips`,Y=N.Get(X,this._clips,x.clips[G].clip);I.push(this._loadClipAsync(`${X}/${x.clips[G].clip}`,Y).then((I=>{const X=x._babylonSounds[G]=new jx(L,I,this._loader.babylonScene,null,F);X.refDistance=x.refDistance||1,X.maxDistance=x.maxDistance||256,X.rolloffFactor=x.rolloffFactor||1,X.distanceModel=x.distanceModel||"exponential"})))}const X=Promise.all(I).then((()=>{const I=x.clips.map((I=>I.weight||1)),L=new Cx(x.loop||!1,x._babylonSounds,I);x.innerAngle&&(L.directionalConeInnerAngle=2*Y.Tools.ToDegrees(x.innerAngle)),x.outerAngle&&(L.directionalConeOuterAngle=2*Y.Tools.ToDegrees(x.outerAngle)),x.volume&&(L.volume=x.volume),x._babylonData.sound=L}));x._babylonData={loaded:X}}return x._babylonData.loaded}_getEventAction(I,x,L,F,X){switch(L){case"play":return I=>{const L=(X||0)+(I-F);x.play(L)};case"stop":return()=>{x.stop()};case"pause":return()=>{x.pause()};default:throw new Error(`${I}: Unsupported action ${L}`)}}_loadAnimationEventAsync(I,x,L,F,X){if(0==X.targetedAnimations.length)return Promise.resolve();const G=X.targetedAnimations[0],Y=F.Xx,p=N.Get(`/extensions/${this.name}/emitters`,this._emitters,Y);return this._loadEmitterAsync(I,p).then((()=>{const x=p._babylonData.sound;if(x){const L=new hx(F.time,this._getEventAction(I,x,F.action,F.time,F.startOffset));G.animation.addEvent(L),X.onAnimationGroupEndObservable.add((()=>{x.stop()})),X.onAnimationGroupPauseObservable.add((()=>{x.pause()}))}}))}}k(YL),w(YL,!0,(I=>new pL(I)));const BL="MSFT_lod";class lL{constructor(I){var x;this.name=BL,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new W.c,this.onMaterialLODsLoadedObservable=new W.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=I,this.maxLODsToLoad=(null===(x=this._loader.parent.extensionOptions[BL])||void 0===x?void 0:x.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(BL)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let I=0;I<this._nodePromiseLODs.length;I++){const x=Promise.all(this._nodePromiseLODs[I]).then((()=>{0!==I&&(this._loader.endPerformanceCounter(`Node LOD ${I}`),this._loader.log(`Loaded node LOD ${I}`)),this.onNodeLODsLoadedObservable.notifyObservers(I),I!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${I+1}`),this._loadBufferLOD(this._nodeBufferLODs,I+1),this._nodeSignalLODs[I]&&this._nodeSignalLODs[I].resolve())}));this._loader._completePromises.push(x)}for(let I=0;I<this._materialPromiseLODs.length;I++){const x=Promise.all(this._materialPromiseLODs[I]).then((()=>{0!==I&&(this._loader.endPerformanceCounter(`Material LOD ${I}`),this._loader.log(`Loaded material LOD ${I}`)),this.onMaterialLODsLoadedObservable.notifyObservers(I),I!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${I+1}`),this._loadBufferLOD(this._materialBufferLODs,I+1),this._materialSignalLODs[I]&&this._materialSignalLODs[I].resolve())}));this._loader._completePromises.push(x)}}loadSceneAsync(I,x){const L=this._loader.loadSceneAsync(I,x);return this._loadBufferLOD(this._bufferLODs,0),L}loadNodeAsync(I,x,L){return c.LoadExtensionAsync(I,x,this.name,(async(I,X)=>{let G;const Y=this._getLODs(I,x,this._loader.Ep.nodes,X.ids);this._loader.logOpen(`${I}`);for(let x=0;x<Y.length;x++){const I=Y[x];0!==x&&(this._nodeIndexLOD=x,this._nodeSignalLODs[x]=this._nodeSignalLODs[x]||new F);const X=I=>{L(I),I.MB(!1)},p=this._loader.loadNodeAsync(`/nodes/${I.index}`,I,X).then((I=>{if(0!==x){const I=Y[x-1];I._babylonTransformNode&&(this._disposeTransformNode(I._babylonTransformNode),delete I._babylonTransformNode)}return I.MB(!0),I}));this._nodePromiseLODs[x]=this._nodePromiseLODs[x]||[],0===x?G=p:(this._nodeIndexLOD=null,this._nodePromiseLODs[x].push(p))}return this._loader.logClose(),await G}))}_loadMaterialAsync(I,x,L,F,X){return this._nodeIndexLOD?null:c.LoadExtensionAsync(I,x,this.name,(async(I,G)=>{let Y;const p=this._getLODs(I,x,this._loader.Ep.materials,G.ids);this._loader.logOpen(`${I}`);for(let x=0;x<p.length;x++){const I=p[x];0!==x&&(this._materialIndexLOD=x);const G=this._loader._loadMaterialAsync(`/materials/${I.index}`,I,L,F,(I=>{0===x&&X(I)})).then((I=>{if(0!==x){X(I);const L=p[x-1]._data;L[F]&&(this._disposeMaterials([L[F].babylonMaterial]),delete L[F])}return I}));this._materialPromiseLODs[x]=this._materialPromiseLODs[x]||[],0===x?Y=G:(this._materialIndexLOD=null,this._materialPromiseLODs[x].push(G))}return this._loader.logClose(),await Y}))}_loadUriAsync(I,x,L){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const X=this._nodeIndexLOD-1;return this._nodeSignalLODs[X]=this._nodeSignalLODs[X]||new F,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(I,x,L)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const X=this._materialIndexLOD-1;return this._materialSignalLODs[X]=this._materialSignalLODs[X]||new F,this._materialSignalLODs[X].promise.then((async()=>await this._loader.loadUriAsync(I,x,L)))}return null}loadBufferAsync(I,x,L,X){if(this._loader.parent.useRangeRequests&&!x.uri){if(!this._loader.bin)throw new Error(`${I}: Uri is missing or the binary glTF is missing its binary chunk`);const x=async(I,x)=>{const G=L,Y=G+X-1;let p=I[x];return p?(p.start=Math.min(p.start,G),p.end=Math.max(p.end,Y)):(p={start:G,end:Y,loaded:new F},I[x]=p),await p.loaded.promise.then((I=>new Uint8Array(I.buffer,I.byteOffset+L-p.start,X)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?x(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?x(this._materialBufferLODs,this._materialIndexLOD):x(this._bufferLODs,0)}return null}_loadBufferLOD(I,x){const L=I[x];L&&(this._loader.log(`Loading buffer range [${L.start}-${L.end}]`),this._loader.bin.readAsync(L.start,L.end-L.start+1).then((I=>{L.loaded.resolve(I)}),(I=>{L.loaded.reject(I)})))}_getLODs(I,x,L,F){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const X=[];for(let G=F.length-1;G>=0;G--)if(X.push(N.Get(`${I}/ids/${F[G]}`,L,F[G])),X.length===this.maxLODsToLoad)return X;return X.push(x),X}_disposeTransformNode(I){const x=[],L=I.material;L&&x.push(L);for(const X of I.getChildMeshes())X.material&&x.push(X.material);I.dispose();const F=x.filter((I=>this._loader.babylonScene.meshes.every((x=>x.material!=I))));this._disposeMaterials(F)}_disposeMaterials(I){const x={};for(const L of I){for(const I of L.getActiveTextures())x[I.uniqueId]=I;L.dispose()}for(const L in x)for(const I of this._loader.babylonScene.materials)I.hasTexture(x[L])&&delete x[L];for(const L in x)x[L].dispose()}}k(BL),w(BL,!0,(I=>new lL(I)));const WL="MSFT_minecraftMesh";class QL{constructor(I){this.name=WL,this._loader=I,this.enabled=this._loader.isExtensionUsed(WL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtraAsync(I,x,this.name,(async(F,X)=>{if(X){if(!(L instanceof q.b))throw new Error(`${F}: Material type not supported`);const X=this._loader.loadMaterialPropertiesAsync(I,x,L);return L.needAlphaBlending()&&(L.forceDepthWrite=!0,L.separateCullingPass=!0),L.GB=L.forceDepthWrite,L.twoSidedLighting=!0,await X}}))}}k(WL),w(WL,!0,(I=>new QL(I)));const eL="MSFT_sRGBFactors";class gL{constructor(I){this.name=eL,this._loader=I,this.enabled=this._loader.isExtensionUsed(eL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,x,L){return c.LoadExtraAsync(I,x,this.name,(async(F,X)=>{if(X){if(!(L instanceof q.b))throw new Error(`${F}: Material type not supported`);const X=this._loader.loadMaterialPropertiesAsync(I,x,L),G=L.tI().getEngine().useExactSrgbConversions;return L.albedoTexture||L.albedoColor.toLinearSpaceToRef(L.albedoColor,G),L.reflectivityTexture||L.reflectivityColor.toLinearSpaceToRef(L.reflectivityColor,G),await X}}))}}k(eL),w(eL,!0,(I=>new gL(I)));var vL=L(14483);const zL={};var HL=L(14530),sL=L(14512),UL=L(14491),qL=L(14498);function yL(I,x){for(const L of I)for(const I of L.dataOutputs)if(I.uniqueId===x)return I;throw new Error("Could not find data out connection with unique id "+x)}function TL(I,x){for(const L of I)if(L instanceof sL.e)for(const I of L.signalInputs)if(I.uniqueId===x)return I;throw new Error("Could not find signal in connection with unique id "+x)}async function ZL(I,x){const F=await Promise.all(I.allBlocks.map((async I=>{const x=function(I){switch(I){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([L.e(78),L.e(79)]).then(L.bind(L,16032))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await L.e(80).then(L.bind(L,16037))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await L.e(81).then(L.bind(L,16042))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await L.e(82).then(L.bind(L,16045))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await L.e(83).then(L.bind(L,16048))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await L.e(84).then(L.bind(L,16051))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await L.e(85).then(L.bind(L,16054))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await L.e(86).then(L.bind(L,16058))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await L.e(87).then(L.bind(L,16062))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await L.e(89).then(L.bind(L,16087))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await L.e(89).then(L.bind(L,16087))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await L.e(89).then(L.bind(L,16087))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await L.e(89).then(L.bind(L,16087))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await L.e(89).then(L.bind(L,16087))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await L.e(89).then(L.bind(L,16087))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await L.e(90).then(L.bind(L,16090))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await L.e(90).then(L.bind(L,16090))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await L.e(90).then(L.bind(L,16090))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await L.e(90).then(L.bind(L,16090))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await L.e(95).then(L.bind(L,16095))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await L.e(96).then(L.bind(L,16098))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await L.e(97).then(L.bind(L,16107))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await L.e(98).then(L.bind(L,16112))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await L.e(99).then(L.bind(L,16115))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await L.e(100).then(L.bind(L,16118))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await L.e(101).then(L.bind(L,16120))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await L.e(102).then(L.bind(L,16125))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await L.e(103).then(L.bind(L,16130))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await L.e(104).then(L.bind(L,16134))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await L.e(105).then(L.bind(L,16137))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await L.e(106).then(L.bind(L,16146))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await L.e(107).then(L.bind(L,16149))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await L.e(108).then(L.bind(L,16152))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await L.e(109).then(L.bind(L,16154))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await L.e(110).then(L.bind(L,16162))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await L.e(111).then(L.bind(L,16170))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await L.e(112).then(L.bind(L,16177))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await L.e(113).then(L.bind(L,16181))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await L.e(92).then(L.bind(L,16183))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await L.e(114).then(L.bind(L,16191))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await L.e(115).then(L.bind(L,16196))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await L.e(116).then(L.bind(L,16201))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await L.e(93).then(L.bind(L,16206))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await L.e(88).then(L.bind(L,16068))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await L.e(94).then(L.bind(L,16211))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await L.e(94).then(L.bind(L,16211))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await L.e(94).then(L.bind(L,16211))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await L.e(94).then(L.bind(L,16211))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await L.e(94).then(L.bind(L,16211))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await L.e(94).then(L.bind(L,16211))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await L.e(94).then(L.bind(L,16211))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await L.e(94).then(L.bind(L,16211))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await L.e(89).then(L.bind(L,16087))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await L.e(89).then(L.bind(L,16087))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await L.e(89).then(L.bind(L,16087))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await L.e(89).then(L.bind(L,16087))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await L.e(89).then(L.bind(L,16087))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await L.e(89).then(L.bind(L,16087))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await L.e(89).then(L.bind(L,16087))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await L.e(90).then(L.bind(L,16090))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await L.e(90).then(L.bind(L,16090))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await L.e(91).then(L.bind(L,16213))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await L.e(91).then(L.bind(L,16213))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await L.e(91).then(L.bind(L,16213))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await L.e(91).then(L.bind(L,16213))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await L.e(91).then(L.bind(L,16213))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await L.e(91).then(L.bind(L,16213))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await L.e(117).then(L.bind(L,16217))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await L.e(118).then(L.bind(L,16222))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await L.e(119).then(L.bind(L,16226))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await L.e(120).then(L.bind(L,16229))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await L.e(121).then(L.bind(L,16236))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await L.e(122).then(L.bind(L,16243))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await L.e(123).then(L.bind(L,16245))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await L.e(124).then(L.bind(L,16247))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await L.e(125).then(L.bind(L,16254))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await L.e(126).then(L.bind(L,16260))).FlowGraphDataSwitchBlock;default:if(zL[I])return zL[I];throw new Error(`Unknown block name ${I}`)}}(I.className);return await x()})));return function(I,x,L){const F=x.coordinator.createGraph(),X=[],G=x.valueParseFunction??UL.b;for(let Y=0;Y<I.allBlocks.length;Y++){const p=fL(I.allBlocks[Y],{qx:x.coordinator.config.qx,pathConverter:x.pathConverter,assetsContainer:x.coordinator.config.qx,valueParseFunction:G},L[Y]);X.push(p),p instanceof HL.e&&F.addEventBlock(p)}for(const Y of X){for(const I of Y.dataInputs)for(const x of I.connectedPointIds){const L=yL(X,x);I.connectTo(L)}if(Y instanceof sL.e)for(const I of Y.signalOutputs)for(const x of I.connectedPointIds){const L=TL(X,x);I.connectTo(L)}}for(const Y of I.executionContexts)tL(Y,{graph:F,valueParseFunction:G},I.rightHanded);return F}(I,x,F)}function tL(I,x,L){const F=x.graph.createContext();I.enableLogging&&(F.enableLogging=!0),F.treatDataAsRightHanded=L||!1;const X=x.valueParseFunction??UL.b;F.uniqueId=I.uniqueId;const G=F.tI();if(I._assetsContext){var Y,p,B,l,W,Q,e,g,v,z;const x=I._assetsContext,L={meshes:null===(Y=x.meshes)||void 0===Y?void 0:Y.map((I=>G.getMeshById(I))),lights:null===(p=x.lights)||void 0===p?void 0:p.map((I=>G.getLightByName(I))),cameras:null===(B=x.cameras)||void 0===B?void 0:B.map((I=>G.getCameraByName(I))),materials:null===(l=x.materials)||void 0===l?void 0:l.map((I=>G.getMaterialById(I))),textures:null===(W=x.textures)||void 0===W?void 0:W.map((I=>G.getTextureByName(I))),animations:null===(Q=x.animations)||void 0===Q?void 0:Q.map((I=>G.animations.find((x=>x.name===I)))),skeletons:null===(e=x.skeletons)||void 0===e?void 0:e.map((I=>G.getSkeletonByName(I))),Gg:null===(g=x.Gg)||void 0===g?void 0:g.map((I=>G.getParticleSystemById(I))),animationGroups:null===(v=x.animationGroups)||void 0===v?void 0:v.map((I=>G.getAnimationGroupByName(I))),transformNodes:null===(z=x.transformNodes)||void 0===z?void 0:z.map((I=>G.getTransformNodeById(I))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Vg:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};F.assetsContext=L}for(const H in I._userVariables){const x=X(H,I._userVariables,F.assetsContext,G);F.userVariables[H]=x}for(const H in I._connectionValues){const x=X(H,I._connectionValues,F.assetsContext,G);F._setConnectionValueByKey(H,x)}return F}function fL(I,x,L){const F={},X=x.valueParseFunction??UL.b;if(I.config)for(const Y in I.config)F[Y]=X(Y,I.config,x.assetsContainer||x.qx,x.qx);if((0,UL.d)(I.className)){if(!x.pathConverter)throw new Error("Path converter is required for this block");F.pathConverter=x.pathConverter}const G=new L(F);G.uniqueId=I.uniqueId;for(let Y=0;Y<I.dataInputs.length;Y++){const x=G.getDataInput(I.dataInputs[Y].name);if(!x)throw new Error("Could not find data input with name "+I.dataInputs[Y].name+" in block "+I.className);x.deserialize(I.dataInputs[Y])}for(let Y=0;Y<I.dataOutputs.length;Y++){const x=G.getDataOutput(I.dataOutputs[Y].name);if(!x)throw new Error("Could not find data output with name "+I.dataOutputs[Y].name+" in block "+I.className);x.deserialize(I.dataOutputs[Y])}return G.metadata=I.metadata,G.deserialize&&G.deserialize(I),G}function RL(I){const[x,L]=I.split(":");return nL({op:x,extension:L})}function nL(I){var x;let L=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const F=I.extension?null===(x=dL[I.extension])||void 0===x?void 0:x[I.op]:ML[I.op];if(!F&&(z.c.Warn(`No mapping found for operation ${I.op} and extension ${I.extension||"KHR_interactivity"}`),L)){const x={},L={flows:{}};if(I.inputValueSockets){x.values={};for(const L in I.inputValueSockets)x.values[L]={name:L}}return I.outputValueSockets&&(L.values={},Object.keys(I.outputValueSockets).forEach((I=>{L.values[I]={name:I}}))),{VW:[],inputs:x,outputs:L}}return F}function PL(I,x,L){dL[x]||(dL[x]={}),dL[x][I]=L}const dL={BABYLON:{"flow/log":{VW:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},ML={"event/onStart":{VW:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{VW:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{VW:["FlowGraphSendCustomEventBlock"],extraProcessor(I,x,L,F,X){if("event/send"!==x.op||!I.configuration||1!==Object.keys(I.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const G=I.configuration.event.value[0];if("number"!==typeof G)throw new Error("Event id should be a number");const Y=F.arrays.events[G],p=X[0];return p.config||(p.config={}),p.config.eventId=Y.eventId,p.config.eventData=Y.eventData,X}},"event/receive":{VW:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(I,x){var L;if(!I.configuration)return z.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const F=I.configuration.event;if(!F)return z.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const X=F.value[0];if("number"!==typeof X)return z.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(L=x.events)||void 0===L?void 0:L[X])?{valid:!0}:(z.c.Error(`Event with id ${X} not found`),{valid:!1,error:`Event with id ${X} not found`})},extraProcessor(I,x,L,F,X){if("event/receive"!==x.op||!I.configuration||1!==Object.keys(I.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const G=I.configuration.event.value[0];if("number"!==typeof G)throw new Error("Event id should be a number");const Y=F.arrays.events[G],p=X[0];return p.config||(p.config={}),p.config.eventId=Y.eventId,p.config.eventData=Y.eventData,X}},"math/e":KL("FlowGraphEBlock"),"math/pi":KL("FlowGraphPIBlock"),"math/inf":KL("FlowGraphInfBlock"),"math/nan":KL("FlowGraphNaNBlock"),"math/abs":KL("FlowGraphAbsBlock"),"math/sign":KL("FlowGraphSignBlock"),"math/trunc":KL("FlowGraphTruncBlock"),"math/floor":KL("FlowGraphFloorBlock"),"math/ceil":KL("FlowGraphCeilBlock"),"math/round":{VW:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,x,L,F,X){var G;return(G=X[0]).config||(G.config={}),X[0].config.roundHalfAwayFromZero=!0,X}},"math/fract":KL("FlowGraphFractBlock"),"math/neg":KL("FlowGraphNegationBlock"),"math/add":KL("FlowGraphAddBlock",["a","b"],!0),"math/sub":KL("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{VW:["FlowGraphMultiplyBlock"],extraProcessor(I,x,L,F,X){var G;(G=X[0]).config||(G.config={}),X[0].config.useMatrixPerComponent=!0,X[0].config.preventIntegerFloatArithmetic=!0;let Y=-1;return Object.keys(I.values||{}).find((x=>{var L;return void 0!==(null===(L=I.values)||void 0===L?void 0:L[x].type)&&(Y=I.values[x].type,!0)})),-1!==Y&&(X[0].config.type=F.arrays.types[Y].flowGraphType),X},validation:I=>I.values?uL(I):{valid:!0}},"math/div":KL("FlowGraphDivideBlock",["a","b"],!0),"math/rem":KL("FlowGraphModuloBlock",["a","b"]),"math/min":KL("FlowGraphMinBlock",["a","b"]),"math/max":KL("FlowGraphMaxBlock",["a","b"]),"math/clamp":KL("FlowGraphClampBlock",["a","b","c"]),"math/saturate":KL("FlowGraphSaturateBlock"),"math/mix":KL("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":KL("FlowGraphEqualityBlock",["a","b"]),"math/lt":KL("FlowGraphLessThanBlock",["a","b"]),"math/le":KL("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":KL("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":KL("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":KL("FlowGraphIsNaNBlock"),"math/isinf":KL("FlowGraphIsInfBlock"),"math/select":{VW:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{VW:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":KL("FlowGraphSinBlock"),"math/cos":KL("FlowGraphCosBlock"),"math/tan":KL("FlowGraphTanBlock"),"math/asin":KL("FlowGraphASinBlock"),"math/acos":KL("FlowGraphACosBlock"),"math/atan":KL("FlowGraphATanBlock"),"math/atan2":KL("FlowGraphATan2Block",["a","b"]),"math/sinh":KL("FlowGraphSinhBlock"),"math/cosh":KL("FlowGraphCoshBlock"),"math/tanh":KL("FlowGraphTanhBlock"),"math/asinh":KL("FlowGraphASinhBlock"),"math/acosh":KL("FlowGraphACoshBlock"),"math/atanh":KL("FlowGraphATanhBlock"),"math/exp":KL("FlowGraphExponentialBlock"),"math/log":KL("FlowGraphLogBlock"),"math/log2":KL("FlowGraphLog2Block"),"math/log10":KL("FlowGraphLog10Block"),"math/sqrt":KL("FlowGraphSquareRootBlock"),"math/cbrt":KL("FlowGraphCubeRootBlock"),"math/pow":KL("FlowGraphPowerBlock",["a","b"]),"math/length":KL("FlowGraphLengthBlock"),"math/normalize":KL("FlowGraphNormalizeBlock"),"math/dot":KL("FlowGraphDotBlock",["a","b"]),"math/cross":KL("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":KL("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":KL("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{VW:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{VW:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{VW:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{VW:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{VW:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{VW:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{VW:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":KL("FlowGraphTransposeBlock"),"math/determinant":KL("FlowGraphDeterminantBlock"),"math/inverse":KL("FlowGraphInvertMatrixBlock"),"math/matmul":KL("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{VW:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"pB",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,x,L,F,X,G){const Y=X[0].dataInputs.find((I=>"rotationQuaternion"===I.name));if(!Y)throw new Error("Rotation quaternion input not found");return G._connectionValues[Y.uniqueId]&&(G._connectionValues[Y.uniqueId].type="Quaternion"),X}},"math/matDecompose":{VW:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"pB"}}}},"math/quatConjugate":KL("FlowGraphConjugateBlock",["a"]),"math/quatMul":{VW:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,x,L,F,X){var G;return(G=X[0]).config||(G.config={}),X[0].config.type="Quaternion",X}},"math/quatAngleBetween":KL("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{VW:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":KL("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":KL("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{VW:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,x,L,F,X){var G;return(G=X[0]).config||(G.config={}),X[0].config.inputIsColumnMajor=!0,X}},"math/extract2x2":{VW:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{VW:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,x,L,F,X){var G;return(G=X[0]).config||(G.config={}),X[0].config.inputIsColumnMajor=!0,X}},"math/extract3x3":{VW:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{VW:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,x,L,F,X){var G;return(G=X[0]).config||(G.config={}),X[0].config.inputIsColumnMajor=!0,X}},"math/extract4x4":{VW:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{VW:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,x,L,F,X,G){var Y,p;(p=X[0]).config||(p.config={});const B=X[0].dataInputs[0];return X[0].config.valueType=(null===(Y=G._connectionValues[B.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",X}},"math/and":{VW:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,x,L,F,X,G){var Y,p,B;(B=X[0]).config||(B.config={});const l=X[0].dataInputs[0],W=X[0].dataInputs[1];return X[0].config.valueType=(null===(Y=G._connectionValues[l.uniqueId])||void 0===Y?void 0:Y.type)??(null===(p=G._connectionValues[W.uniqueId])||void 0===p?void 0:p.type)??"FlowGraphInteger",X}},"math/or":{VW:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,x,L,F,X,G){var Y,p,B;(B=X[0]).config||(B.config={});const l=X[0].dataInputs[0],W=X[0].dataInputs[1];return X[0].config.valueType=(null===(Y=G._connectionValues[l.uniqueId])||void 0===Y?void 0:Y.type)??(null===(p=G._connectionValues[W.uniqueId])||void 0===p?void 0:p.type)??"FlowGraphInteger",X}},"math/xor":{VW:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,x,L,F,X,G){var Y,p,B;(B=X[0]).config||(B.config={});const l=X[0].dataInputs[0],W=X[0].dataInputs[1];return X[0].config.valueType=(null===(Y=G._connectionValues[l.uniqueId])||void 0===Y?void 0:Y.type)??(null===(p=G._connectionValues[W.uniqueId])||void 0===p?void 0:p.type)??"FlowGraphInteger",X}},"math/asr":KL("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":KL("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":KL("FlowGraphLeadingZerosBlock"),"math/ctz":KL("FlowGraphTrailingZerosBlock"),"math/popcnt":KL("FlowGraphOneBitsCounterBlock"),"math/rad":KL("FlowGraphDegToRadBlock"),"math/deg":KL("FlowGraphRadToDegBlock"),"type/boolToInt":KL("FlowGraphBooleanToInt"),"type/boolToFloat":KL("FlowGraphBooleanToFloat"),"type/intToBool":KL("FlowGraphIntToBoolean"),"type/intToFloat":KL("FlowGraphIntToFloat"),"type/floatToInt":KL("FlowGraphFloatToInt"),"type/floatToBool":KL("FlowGraphFloatToBoolean"),"flow/sequence":{VW:["FlowGraphSequenceBlock"],extraProcessor(I,x,L,F,X){const G=X[0];return G.config||(G.config={}),G.config.outputSignalCount=Object.keys(I.flows||[]).length,G.signalOutputs.forEach(((I,x)=>{I.name="out_"+x})),X}},"flow/branch":{VW:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{VW:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(I){if(I.configuration&&I.configuration.cases){const x=I.configuration.cases.value;if(!x.every((I=>"number"===typeof I&&/^-?\d+$/.test(I.toString()))))return z.c.Warn("Switch cases should be integers. Using empty array instead."),I.configuration.cases.value=[],{valid:!0};const L=new Set(x);I.configuration.cases.value=Array.from(L)}return{valid:!0}},extraProcessor(I,x,L,F,X){if("flow/switch"!==x.op||!I.flows||0===Object.keys(I.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return X[0].signalOutputs.forEach((I=>{"default"!==I.name&&(I.name="out_"+I.name)})),X}},"flow/while":{VW:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{VW:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(I,x,L,F,X){const G=X[0];return G.config||(G.config={}),G.config.incrementIndexWhenLoopDone=!0,X}},"flow/doN":{VW:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{VW:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(I,x,L,F,X){if("flow/multiGate"!==x.op||!I.flows||0===Object.keys(I.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const G=X[0];return G.config||(G.config={}),G.config.outputSignalCount=Object.keys(I.flows).length,G.signalOutputs.forEach(((I,x)=>{I.name="out_"+x})),X}},"flow/waitAll":{VW:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(I){var x,L;return"number"!==typeof(null===(x=I.configuration)||void 0===x||null===(L=x.inputFlows)||void 0===L?void 0:L.value[0])&&(I.configuration=I.configuration||{inputFlows:{value:[0]}},I.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{VW:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{VW:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{VW:["FlowGraphCancelDelayBlock"]},"variable/get":{VW:["FlowGraphGetVariableBlock"],validation(I){var x,L;return null!==(x=I.configuration)&&void 0!==x&&null!==(L=x.variable)&&void 0!==L&&L.value?{valid:!0}:(z.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(I,x)=>[x.getVariableName(I[0])]}}},"variable/set":{VW:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(I,x)=>[x.getVariableName(I[0])]}}},"variable/setMultiple":{VW:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(I,x)=>[I[0].map((I=>x.getVariableName(I)))]}},extraProcessor:(I,x,L,F,X)=>(X[0].dataInputs.forEach((I=>{I.name=F.getVariableName(+I.name)})),X)},"variable/interpolate":{VW:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(I,x)=>[x.getVariableName(I[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:I=>!0===I[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",uL:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",uL:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",uL:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",uL:"FlowGraphPlayAnimationBlock"},out:{name:"out",uL:"FlowGraphPlayAnimationBlock"},done:{name:"done",uL:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(I,x,L,F,X){var G,Y,p;const B=X[0],l=null===(G=I.configuration)||void 0===G?void 0:G.variable.value[0];if("number"!==typeof l)throw z.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const W=F.arrays.staticVariables[l];"undefined"===typeof B.config.animationType.value&&(F.arrays.staticVariables,B.config.animationType.value=(0,qL.Q)(W.type));const Q=X[4];return Q.config||(Q.config={}),(Y=Q.config).variable||(Y.variable={}),Q.config.variable.value=F.getVariableName(l),(p=X[3]).config||(p.config={}),X}},"pointer/get":{VW:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",uL:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",uL:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(I,x,L,F,X)=>(X.forEach((I=>{"FlowGraphJsonPointerParserBlock"===I.className&&(I.config||(I.config={}),I.config.outputValue=!0)})),X)},"pointer/set":{VW:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",uL:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",uL:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(I,x,L,F,X)=>(X.forEach((I=>{"FlowGraphJsonPointerParserBlock"===I.className&&(I.config||(I.config={}),I.config.outputValue=!0)})),X)},"pointer/interpolate":{VW:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",uL:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",uL:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",uL:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",uL:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",uL:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",uL:"FlowGraphPlayAnimationBlock"},out:{name:"out",uL:"FlowGraphPlayAnimationBlock"},done:{name:"done",uL:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(I,x,L,F,X)=>(X.forEach((x=>{"FlowGraphJsonPointerParserBlock"===x.className?(x.config||(x.config={}),x.config.outputValue=!0):"FlowGraphInterpolationBlock"===x.className&&(x.config||(x.config={}),Object.keys(I.values||[]).forEach((L=>{var X;const G=null===(X=I.values)||void 0===X?void 0:X[L];if("value"===L&&G){const I=G.type;void 0!==I&&(x.config.animationType=F.arrays.types[I].flowGraphType)}})))})),X)},"animation/start":{VW:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",uL:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(I,x)=>[I[0]*x._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(I,x)=>[I[0]*x._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(I,x,L,F,X,G,Y){const p=X[X.length-1];return p.config||(p.config={}),p.config.glTF=Y,X}},"animation/stop":{VW:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",uL:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(I,x,L,F,X,G,Y){const p=X[X.length-1];return p.config||(p.config={}),p.config.glTF=Y,X}},"animation/stopAt":{VW:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",uL:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(I,x)=>[I[0]*x._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(I,x,L,F,X,G,Y){const p=X[X.length-1];return p.config||(p.config={}),p.config.glTF=Y,X}},"math/switch":{VW:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(I){if(I.configuration&&I.configuration.cases){const x=I.configuration.cases.value;if(!x.every((I=>"number"===typeof I&&/^-?\d+$/.test(I.toString()))))return z.c.Warn("Switch cases should be integers. Using empty array instead."),I.configuration.cases.value=[],{valid:!0};const L=new Set(x);I.configuration.cases.value=Array.from(L)}return{valid:!0}},extraProcessor(I,x,L,F,X){const G=X[0];return G.dataInputs.forEach((I=>{"default"!==I.name&&"case"!==I.name&&(I.name="in_"+I.name)})),G.config||(G.config={}),G.config.treatCasesAsIntegers=!0,X}},"debug/log":{VW:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function KL(I){let x=arguments.length>2?arguments[2]:void 0;return{VW:[I],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((I,x)=>(I[x]={name:x},I)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(I,L,F,X,G){var Y;if(x){(Y=G[0]).config||(Y.config={}),G[0].config.preventIntegerFloatArithmetic=!0;let x=-1;Object.keys(I.values||{}).find((L=>{var F;return void 0!==(null===(F=I.values)||void 0===F?void 0:F[L].type)&&(x=I.values[L].type,!0)})),-1!==x&&(G[0].config.type=X.arrays.types[x].flowGraphType)}return G},validation:I=>x?uL(I):{valid:!0}}}function uL(I){if(I.values){const x=Object.keys(I.values).map((x=>I.values[x].type)).filter((I=>void 0!==I));if(!x.every((I=>I===x[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}ML["math/compose"]=ML["math/matCompose"],ML["math/decompose"]=ML["math/matDecompose"];var AL=L(12945);const mF={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"sx",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class OL{constructor(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=I,this._gltf=x,this._animationTargetFps=L,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const I of this._interactivityGraph.types)this._types.push(mF[I.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const I of this._interactivityGraph.declarations){const x=nL(I);if(!x)throw z.c.Error(["No mapping found for declaration",I]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:x,fullOperationName:I.extension?I.op+":"+I.extension:I.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const I of this._interactivityGraph.variables){const x=this._parseVariable(I);this._staticVariables.push(x)}}_parseVariable(I,x){const L=this._types[I.type];if(!L)throw z.c.Error(["No type found for variable",I]),new Error("Error parsing variables");if(I.value&&I.value.length!==L.length)throw z.c.Error(["Invalid value length for variable",I,L]),new Error("Error parsing variables");const F=I.value||[];if(!F.length)switch(L.flowGraphType){case"boolean":F.push(!1);break;case"FlowGraphInteger":F.push(0);break;case"number":F.push(NaN);break;case"Vector2":F.push(NaN,NaN);break;case"sx":F.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":F.fill(NaN,0,4);break;case"Matrix":F.fill(NaN,0,16);break;case"Matrix3D":F.fill(NaN,0,9)}return"number"===L.elementType&&"string"===typeof F[0]&&(F[0]=parseFloat(F[0])),{type:L.flowGraphType,value:x?x(F,this):F}}_parseEvents(){if(this._interactivityGraph.events)for(const I of this._interactivityGraph.events){const x={eventId:I.id||"internalEvent_"+this._internalEventsCounter++};I.values&&(x.eventData=Object.keys(I.values).map((x=>{var L;const F=null===(L=I.values)||void 0===L?void 0:L[x];if(!F)throw z.c.Error(["No value found for event key",x]),new Error("Error parsing events");const X=this._types[F.type];if(!X)throw z.c.Error(["No type found for event value",F]),new Error("Error parsing events");const G="undefined"!==typeof F.value?this._parseVariable(F):void 0;return{id:x,type:X.flowGraphType,eventData:!0,value:G}}))),this._events.push(x)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const x of this._interactivityGraph.nodes){if("number"!==typeof x.declaration)throw z.c.Error(["No declaration found for node",x]),new Error("Error parsing nodes");const L=this._mappings[x.declaration];if(!L)throw z.c.Error(["No mapping found for node",x]),new Error("Error parsing nodes");if(L.flowGraphMapping.validation){const F=L.flowGraphMapping.validation(x,this._interactivityGraph,this._gltf);var I;if(!F.valid)throw new Error(`Error validating interactivity node ${null===(I=this._interactivityGraph.declarations)||void 0===I?void 0:I[x.declaration].op} - ${F.error}`)}const F=[];for(const I of L.flowGraphMapping.VW){const X=this._getEmptyBlock(I,L.fullOperationName);this._parseNodeConfiguration(x,X,L.flowGraphMapping,I),F.push(X)}this._nodes.push({VW:F,fullOperationName:L.fullOperationName})}}_getEmptyBlock(I,x){return{uniqueId:(0,AL.e)(),className:I,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:x,metadata:{}}}_parseNodeConfiguration(I,x,L,F){const X=x.config;if(I.configuration){const x=Object.keys(I.configuration);for(const p of x){var G,Y;const x=null===(G=I.configuration)||void 0===G?void 0:G[p];if(!x)throw z.c.Error(["No value found for node configuration",p]),new Error("Error parsing node configuration");const B=null===(Y=L.configuration)||void 0===Y?void 0:Y[p];if(B&&B.uL?B.uL===F:0===L.VW.indexOf(F)){const I=(null===B||void 0===B?void 0:B.name)||p;x&&"undefined"!==typeof x.value||"undefined"===typeof(null===B||void 0===B?void 0:B.defaultValue)?x.value.length>=0?X[I]={value:1===x.value.length?x.value[0]:x.value}:z.c.Warn(["Invalid value for node configuration",x]):X[I]={value:B.defaultValue},B&&B.dataTransformer&&(X[I].value=B.dataTransformer([X[I].value],this)[0])}}}}_parseNodeConnections(I){for(let Z=0;Z<this._nodes.length;Z++){var x;const t=null===(x=this._interactivityGraph.nodes)||void 0===x?void 0:x[Z];if(!t)throw z.c.Error(["No node found for interactivity node",this._nodes[Z]]),new Error("Error parsing node connections");const f=this._nodes[Z],R=this._mappings[t.declaration];if(!R)throw z.c.Error(["No mapping found for node",t]),new Error("Error parsing node connections");const n=t.flows||{},P=Object.keys(n).sort();for(const I of P){var L,F,X,G;const x=n[I],l=null===(L=R.flowGraphMapping.outputs)||void 0===L||null===(F=L.flows)||void 0===F?void 0:F[I],W=(null===l||void 0===l?void 0:l.name)||I,Q=this._createNewSocketConnection(W,!0);(l&&l.uL&&f.VW.find((I=>I.className===l.uL))||f.VW[0]).signalOutputs.push(Q);const e=x.node,g=this._nodes[e];if(!g)throw z.c.Error(["No node found for input node id",e]),new Error("Error parsing node connections");const v=RL(g.fullOperationName);if(!v)throw z.c.Error(["No mapping found for input node",g]),new Error("Error parsing node connections");let H=null===(X=v.inputs)||void 0===X||null===(G=X.flows)||void 0===G?void 0:G[x.socket||"in"],s=!1;if(!H)for(const I in null===(Y=v.inputs)||void 0===Y?void 0:Y.flows){var Y,p,B;if(I.startsWith("[")&&I.endsWith("]"))s=!0,H=null===(p=v.inputs)||void 0===p||null===(B=p.flows)||void 0===B?void 0:B[I]}const U=H?s?H.name.replace("$1",x.socket||""):H.name:x.socket||"in",q=H&&H.uL&&g.VW.find((I=>I.className===H.uL))||g.VW[0];let y=q.signalInputs.find((I=>I.name===U));y||(y=this._createNewSocketConnection(U),q.signalInputs.push(y)),y.connectedPointIds.push(Q.uniqueId),Q.connectedPointIds.push(y.uniqueId)}const d=t.values||{},M=Object.keys(d);for(const x of M){var l,W;const L=d[x];let F=null===(l=R.flowGraphMapping.inputs)||void 0===l||null===(W=l.values)||void 0===W?void 0:W[x],X=!1;if(!F)for(const I in null===(Q=R.flowGraphMapping.inputs)||void 0===Q?void 0:Q.values){var Q,e,g;if(I.startsWith("[")&&I.endsWith("]"))X=!0,F=null===(e=R.flowGraphMapping.inputs)||void 0===e||null===(g=e.values)||void 0===g?void 0:g[I]}const G=F?X?F.name.replace("$1",x):F.name:x,Y=this._createNewSocketConnection(G);if((F&&F.uL&&f.VW.find((I=>I.className===F.uL))||f.VW[0]).dataInputs.push(Y),void 0!==L.value){const x=this._parseVariable(L,F&&F.dataTransformer);I._connectionValues[Y.uniqueId]=x}else{if("undefined"===typeof L.node)throw z.c.Error(["Invalid value for value connection",L]),new Error("Error parsing node connections");{var v,H,s;const I=L.node,x=L.socket||"value",F=this._nodes[I];if(!F)throw z.c.Error(["No node found for output socket reference",L]),new Error("Error parsing node connections");const X=RL(F.fullOperationName);if(!X)throw z.c.Error(["No mapping found for output socket reference",L]),new Error("Error parsing node connections");let G=null===(v=X.outputs)||void 0===v||null===(H=v.values)||void 0===H?void 0:H[x],p=!1;if(!G)for(const L in null===(U=X.outputs)||void 0===U?void 0:U.values){var U,q,y;if(L.startsWith("[")&&L.endsWith("]"))p=!0,G=null===(q=X.outputs)||void 0===q||null===(y=q.values)||void 0===y?void 0:y[L]}const B=G?p?G.name.replace("$1",x):null===(s=G)||void 0===s?void 0:s.name:x,l=G&&G.uL&&F.VW.find((I=>I.className===G.uL))||F.VW[0];let W=l.dataOutputs.find((I=>I.name===B));W||(W=this._createNewSocketConnection(B,!0),l.dataOutputs.push(W)),Y.connectedPointIds.push(W.uniqueId),W.connectedPointIds.push(Y.uniqueId)}}}if(R.flowGraphMapping.interBlockConnectors)for(const I of R.flowGraphMapping.interBlockConnectors){const x=I.input,L=I.output,F=I.isVariable;this._connectFlowGraphNodes(x,L,f.VW[I.inputBlockIndex],f.VW[I.outputBlockIndex],F)}if(R.flowGraphMapping.extraProcessor){var T;const x=null===(T=this._interactivityGraph.declarations)||void 0===T?void 0:T[t.declaration];if(!x)throw z.c.Error(["No declaration found for extra processor",t]),new Error("Error parsing node connections");f.VW=R.flowGraphMapping.extraProcessor(t,x,R.flowGraphMapping,this,f.VW,I,this._gltf)}}}_createNewSocketConnection(I,x){return{uniqueId:(0,AL.e)(),name:I,_connectionType:x?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(I,x,L,F,X){const G=X?L.dataInputs:L.signalInputs,Y=X?F.dataOutputs:F.signalOutputs,p=G.find((x=>x.name===I))||this._createNewSocketConnection(I),B=Y.find((I=>I.name===x))||this._createNewSocketConnection(x,!0);G.find((x=>x.name===I))||G.push(p),Y.find((I=>I.name===x))||Y.push(B),p.connectedPointIds.push(B.uniqueId),B.connectedPointIds.push(p.uniqueId)}getVariableName(I){return"staticVariable_"+I}serializeToFlowGraph(){const I={uniqueId:(0,AL.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(I);for(let x=0;x<this._staticVariables.length;x++){const L=this._staticVariables[x];I._userVariables[this.getVariableName(x)]=L}return{rightHanded:!0,allBlocks:this._nodes.reduce(((I,x)=>I.concat(x.VW)),[]),executionContexts:[I]}}}const wL="KHR_interactivity";class kL{constructor(I){this._loader=I,this.name=wL,this.enabled=this._loader.isExtensionUsed(wL),this._pathConverter=(0,a.f)(this._loader.Ep),I._skipStartAnimationStep=!0;const x=I.babylonScene;x&&function(I){(0,a.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!I.activeCamera)return new X.Quaternion(NaN,NaN,NaN,NaN);const x=X.Quaternion.FromRotationMatrix(I.activeCamera.getWorldMatrix()).normalize();return I.useRightHandedSystem||(x.w*=-1,x.x*=-1),x},type:"Quaternion",getTarget:()=>I.activeCamera}),(0,a.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!I.activeCamera)return new X.sx(NaN,NaN,NaN);const x=I.activeCamera.getWorldMatrix().getTranslation();return I.useRightHandedSystem||(x.x*=-1),x},type:"sx",getTarget:()=>I.activeCamera}),(0,a.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:I=>{var x;return(null===(x=I._babylonAnimationGroup)||void 0===x?void 0:x.isPlaying)??!1},type:"boolean",getTarget:I=>I._babylonAnimationGroup}),(0,a.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:I=>{var x;return((null===(x=I._babylonAnimationGroup)||void 0===x?void 0:x.from)??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup}),(0,a.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:I=>{var x;return((null===(x=I._babylonAnimationGroup)||void 0===x?void 0:x.to)??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup}),(0,a.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:I=>{var x;return((null===(x=I._babylonAnimationGroup)||void 0===x?void 0:x.getCurrentFrame())??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup}),(0,a.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:I=>{var x;return((null===(x=I._babylonAnimationGroup)||void 0===x?void 0:x.getCurrentFrame())??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup})}(x)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var I;if(!this._loader.babylonScene||!this._pathConverter)return;const x=this._loader.babylonScene,L=null===(I=this._loader.Ep.extensions)||void 0===I?void 0:I.KHR_interactivity;if(!L)return;const F=new vL.d({qx:x});F.dispatchEventsSynchronously=!1;const X=L.graphs.map((I=>new OL(I,this._loader.Ep,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(X.map((async I=>await ZL(I,{coordinator:F,pathConverter:this._pathConverter})))),F.start()}}var aL;aL=async()=>(await Promise.resolve().then(L.bind(L,14548))).FlowGraphGLTFDataProvider,zL[`${wL}/${"FlowGraphGLTFDataProvider"}`]=aL,k(wL),w(wL,!0,(I=>new kL(I)));const DL="KHR_node_visibility";(0,a.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:I=>{const x=I._babylonTransformNode;return!x||void 0===x.isVisible||x.isVisible},set:(I,x)=>{var L,F;null===(L=x._primitiveBabylonMeshes)||void 0===L||L.forEach((I=>{I.inheritVisibility=!0})),x._babylonTransformNode&&(x._babylonTransformNode.isVisible=I),null===(F=x._primitiveBabylonMeshes)||void 0===F||F.forEach((x=>{x.isVisible=I}))},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class rL{constructor(I){this.name=DL,this._loader=I,this.enabled=I.isExtensionUsed(DL)}async onReady(){var I;null===(I=this._loader.Ep.nodes)||void 0===I||I.forEach((I=>{var x,L,F,X;(null===(x=I._primitiveBabylonMeshes)||void 0===x||x.forEach((I=>{I.inheritVisibility=!0})),null!==(L=I.extensions)&&void 0!==L&&L.KHR_node_visibility)&&(!1===(null===(F=I.extensions)||void 0===F?void 0:F.KHR_node_visibility.visible)&&(I._babylonTransformNode&&(I._babylonTransformNode.isVisible=!1),null===(X=I._primitiveBabylonMeshes)||void 0===X||X.forEach((I=>{I.isVisible=!1}))))}))}dispose(){this._loader=null}}k(DL),w(DL,!0,(I=>new rL(I)));const NL="KHR_node_selectability";PL("event/onSelect",NL,{VW:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",uL:"FlowGraphGetVariableBlock",dataTransformer:I=>["pickedMesh_"+I[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",uL:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(I,x,L,F,X,G,Y){var p,B,l,W,Q,e;const g=X[X.length-1];g.config=g.config||{},g.config.glTF=Y;const v=null===(p=I.configuration)||void 0===p||null===(B=p.nodeIndex)||void 0===B?void 0:B.value[0];if(void 0===v||"number"!==typeof v)throw new Error("nodeIndex not found in configuration");const z="pickedMesh_"+v;return X[1].config.variable=z,G._userVariables[z]={className:"Mesh",id:null===Y||void 0===Y||null===(l=Y.nodes)||void 0===l||null===(W=l[v]._babylonTransformNode)||void 0===W?void 0:W.id,uniqueId:null===Y||void 0===Y||null===(Q=Y.nodes)||void 0===Q||null===(e=Q[v]._babylonTransformNode)||void 0===e?void 0:e.uniqueId},X}}),(0,a.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:I=>{const x=I._babylonTransformNode;return!x||void 0===x.Zl||x.Zl},set:(I,x)=>{var L;null===(L=x._primitiveBabylonMeshes)||void 0===L||L.forEach((x=>{x.Zl=I}))},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"Zl"],type:"boolean"});class SL{constructor(I){this.name=NL,this._loader=I,this.enabled=I.isExtensionUsed(NL)}async onReady(){var I;null===(I=this._loader.Ep.nodes)||void 0===I||I.forEach((I=>{var x,L,F;null!==(x=I.extensions)&&void 0!==x&&x.KHR_node_selectability&&!1===(null===(L=I.extensions)||void 0===L?void 0:L.KHR_node_selectability.selectable)&&(null===(F=I._babylonTransformNode)||void 0===F||F.getChildMeshes().forEach((I=>{I.Zl=!1})))}))}dispose(){this._loader=null}}k(NL),w(NL,!0,(I=>new SL(I)));const cL="KHR_node_hoverability",oL="targetMeshPointerOver_";PL("event/onHoverIn",cL,{VW:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",uL:"FlowGraphGetVariableBlock",dataTransformer:I=>[oL+I[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",uL:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(I,x,L,F,X,G,Y){var p,B,l,W,Q,e;const g=X[X.length-1];g.config=g.config||{},g.config.glTF=Y;const v=null===(p=I.configuration)||void 0===p||null===(B=p.nodeIndex)||void 0===B?void 0:B.value[0];if(void 0===v||"number"!==typeof v)throw new Error("nodeIndex not found in configuration");const z=oL+v;return X[1].config.variable=z,G._userVariables[z]={className:"Mesh",id:null===Y||void 0===Y||null===(l=Y.nodes)||void 0===l||null===(W=l[v]._babylonTransformNode)||void 0===W?void 0:W.id,uniqueId:null===Y||void 0===Y||null===(Q=Y.nodes)||void 0===Q||null===(e=Q[v]._babylonTransformNode)||void 0===e?void 0:e.uniqueId},X}});const JL="targetMeshPointerOut_";PL("event/onHoverOut",cL,{VW:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",uL:"FlowGraphGetVariableBlock",dataTransformer:I=>[JL+I[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",uL:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(I,x,L,F,X,G,Y){var p,B,l,W,Q,e;const g=X[X.length-1];g.config=g.config||{},g.config.glTF=Y;const v=null===(p=I.configuration)||void 0===p||null===(B=p.nodeIndex)||void 0===B?void 0:B.value[0];if(void 0===v||"number"!==typeof v)throw new Error("nodeIndex not found in configuration");const z=JL+v;return X[1].config.variable=z,G._userVariables[z]={className:"Mesh",id:null===Y||void 0===Y||null===(l=Y.nodes)||void 0===l||null===(W=l[v]._babylonTransformNode)||void 0===W?void 0:W.id,uniqueId:null===Y||void 0===Y||null===(Q=Y.nodes)||void 0===Q||null===(e=Q[v]._babylonTransformNode)||void 0===e?void 0:e.uniqueId},X}}),(0,a.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:I=>{const x=I._babylonTransformNode;return!x||void 0===x.pointerOverDisableMeshTesting||x.pointerOverDisableMeshTesting},set:(I,x)=>{var L;null===(L=x._primitiveBabylonMeshes)||void 0===L||L.forEach((x=>{x.pointerOverDisableMeshTesting=!I}))},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class hL{constructor(I){this.name=cL,this._loader=I,this.enabled=I.isExtensionUsed(cL)}async onReady(){var I;null===(I=this._loader.Ep.nodes)||void 0===I||I.forEach((I=>{var x,L,F;null!==(x=I.extensions)&&void 0!==x&&x.KHR_node_hoverability&&!1===(null===(L=I.extensions)||void 0===L?void 0:L.KHR_node_hoverability.hoverable)&&(null===(F=I._babylonTransformNode)||void 0===F||F.getChildMeshes().forEach((I=>{I.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}k(cL),w(cL,!0,(I=>new hL(I)));const EL="ExtrasAsMetadata";class iL{_assignExtras(I,x){if(x.extras&&Object.keys(x.extras).length>0){const L=I.metadata=I.metadata||{};(L.Ep=L.Ep||{}).extras=x.extras}}constructor(I){this.name=EL,this.enabled=!0,this._loader=I}dispose(){this._loader=null}loadNodeAsync(I,x,L){return this._loader.loadNodeAsync(I,x,(I=>{this._assignExtras(I,x),L(I)}))}loadCameraAsync(I,x,L){return this._loader.loadCameraAsync(I,x,(I=>{this._assignExtras(I,x),L(I)}))}createMaterial(I,x,L){const F=this._loader.createMaterial(I,x,L);return this._assignExtras(F,x),F}}k(EL),w(EL,!1,(I=>new iL(I)));L(14548)},14424:(I,x,L)=>{"use strict";L.d(x,{c:()=>u,f:()=>R,i:()=>f,m:()=>n});var F=L(12797),X=L(12791),G=L(14078),Y=L(13426),p=L(13398),B=L(13411),l=L(12809),W=L(12840),Q=L(13423),e=L(13507),g=L(13434),v=L(13014);class z{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Gg=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Vg=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(I){this._environmentTexture=I}getNodes(){let I=[];I=I.concat(this.meshes),I=I.concat(this.lights),I=I.concat(this.cameras),I=I.concat(this.transformNodes);for(const x of this.skeletons)I=I.concat(x.bones);return I}}class H extends z{}class s{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const I=this.rootNodes;for(const F of I)F.dispose();I.length=0;const x=this.skeletons;for(const F of x)F.dispose();x.length=0;const L=this.animationGroups;for(const F of L)F.dispose();L.length=0}}class U extends z{constructor(I){super(),this._wasAddedToScene=!1,(I=I||W.e.LastCreatedScene)&&(this.qx=I,this.proceduralTextures=[],I.cp.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=I.getEngine().onContextRestoredObservable.add((()=>{for(const I of this.geometries)I._rebuild();for(const I of this.meshes)I._rebuild();for(const I of this.Gg)I.rebuild();for(const I of this.textures)I._rebuild()})))}_topologicalSort(I){const x=new Map;for(const Y of I)x.set(Y.uniqueId,Y);const L={dependsOn:new Map,dependedBy:new Map};for(const Y of I){const I=Y.uniqueId;L.dependsOn.set(I,new Set),L.dependedBy.set(I,new Set)}for(const Y of I){const I=Y.uniqueId,F=L.dependsOn.get(I);if(Y instanceof Q.b){const X=Y.sourceMesh;x.has(X.uniqueId)&&(F.add(X.uniqueId),L.dependedBy.get(X.uniqueId).add(I))}const X=L.dependedBy.get(I);for(const G of Y.getDescendants()){const F=G.uniqueId;if(x.has(F)){X.add(F);L.dependsOn.get(F).add(I)}}}const F=[],X=[];for(const Y of I){const I=Y.uniqueId;0===L.dependsOn.get(I).size&&(X.push(Y),x.delete(I))}const G=X;for(;G.length>0;){const I=G.shift();F.push(I);const X=L.dependedBy.get(I.uniqueId);for(const F of Array.from(X.values())){const X=L.dependsOn.get(F);X.delete(I.uniqueId),0===X.size&&x.get(F)&&(G.push(x.get(F)),x.delete(F))}}return x.size>0&&(l.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),x.forEach((I=>{l.c.Error(I.name)}))),F}_addNodeAndDescendantsToList(I,x,L,F){if(L&&(!F||F(L))&&!x.has(L.uniqueId)){I.push(L),x.add(L.uniqueId);for(const X of L.getDescendants(!0))this._addNodeAndDescendantsToList(I,x,X,F)}}_isNodeInContainer(I){return I instanceof B.b&&-1!==this.meshes.indexOf(I)||(I instanceof p.c&&-1!==this.transformNodes.indexOf(I)||(I instanceof e.c&&-1!==this.lights.indexOf(I)||I instanceof g.b&&-1!==this.cameras.indexOf(I)))}_isValidHierarchy(){for(const I of this.meshes)if(I.parent&&!this._isNodeInContainer(I.parent))return l.c.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;for(const I of this.transformNodes)if(I.parent&&!this._isNodeInContainer(I.parent))return l.c.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;for(const I of this.lights)if(I.parent&&!this._isNodeInContainer(I.parent))return l.c.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;for(const I of this.cameras)if(I.parent&&!this._isNodeInContainer(I.parent))return l.c.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(I){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||X.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const F={},G={},p=new s,B=[],l=[],W={doNotInstantiate:!0,...L},Q=[],e=new Set;for(const X of this.transformNodes)null===X.parent&&this._addNodeAndDescendantsToList(Q,e,X,W.predicate);for(const X of this.meshes)null===X.parent&&this._addNodeAndDescendantsToList(Q,e,X,W.predicate);const g=this._topologicalSort(Q),v=(L,X)=>{if(((x,L)=>{if(F[x.uniqueId]=L.uniqueId,G[L.uniqueId]=L,I&&(L.name=I(x.name)),L instanceof Y.e){const I=L;if(I.morphTargetManager){const L=x.morphTargetManager;I.morphTargetManager=L.clone();for(let x=0;x<L.numTargets;x++){const X=L.getTarget(x),Y=I.morphTargetManager.getTarget(x);F[X.uniqueId]=Y.uniqueId,G[Y.uniqueId]=Y}}}})(L,X),L.parent){const I=F[L.parent.uniqueId],x=G[I];X.parent=x||L.parent}if(X.position&&L.position&&X.position.X(L.position),X.rotationQuaternion&&L.rotationQuaternion&&X.rotationQuaternion.X(L.rotationQuaternion),X.rotation&&L.rotation&&X.rotation.X(L.rotation),X.pB&&L.pB&&X.pB.X(L.pB),X.material){const Y=X;if(Y.material)if(x){const x=L.material;if(-1===l.indexOf(x)){let L=x.clone(I?I(x.name):"Clone of "+x.name);if(l.push(x),F[x.uniqueId]=L.uniqueId,G[L.uniqueId]=L,"MultiMaterial"===x.getClassName()){const X=x;for(const x of X.WB)x&&(L=x.clone(I?I(x.name):"Clone of "+x.name),l.push(x),F[x.uniqueId]=L.uniqueId,G[L.uniqueId]=L);X.WB=X.WB.map((I=>I&&G[F[I.uniqueId]]))}}"InstancedMesh"!==Y.getClassName()&&(Y.material=G[F[x.uniqueId]])}else"MultiMaterial"===Y.material.getClassName()?-1===this.qx.multiMaterials.indexOf(Y.material)&&this.qx.addMultiMaterial(Y.material):-1===this.qx.materials.indexOf(Y.material)&&this.qx.addMaterial(Y.material)}null===X.parent&&p.rootNodes.push(X)};for(const X of g)if("InstancedMesh"===X.getClassName()){const I=X,x=I.sourceMesh,L=F[x.uniqueId];v(I,("number"===typeof L?G[L]:x).createInstance(I.name))}else{let I=!0;"ee"===X.getClassName()||"Node"===X.getClassName()||X.skeleton||!X.getTotalVertices||0===X.getTotalVertices()?I=!1:W.doNotInstantiate&&(I="function"===typeof W.doNotInstantiate?!W.doNotInstantiate(X):!W.doNotInstantiate);const x=I?X.createInstance(`instance of ${X.name}`):X.clone(`Clone of ${X.name}`,null,!0);if(!x)throw new Error(`Could not clone or instantiate node on Asset Container ${X.name}`);v(X,x)}for(const X of this.skeletons){if(W.predicate&&!W.predicate(X))continue;const x=X.clone(I?I(X.name):"Clone of "+X.name);for(const I of this.meshes)if(I.skeleton===X&&!I.isAnInstance){const L=G[F[I.uniqueId]];if(!L||L.isAnInstance)continue;if(L.skeleton=x,-1!==B.indexOf(x))continue;B.push(x);for(const I of x.bones)I._linkedTransformNode&&(I._linkedTransformNode=G[F[I._linkedTransformNode.uniqueId]])}p.skeletons.push(x)}for(const X of this.animationGroups){if(W.predicate&&!W.predicate(X))continue;const x=X.clone(I?I(X.name):"Clone of "+X.name,(I=>G[F[I.uniqueId]]||I));p.animationGroups.push(x)}return p}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||X.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.qx.environmentTexture=this.environmentTexture);for(const I of this.qx._serializableComponents)I.addFromContainer(this);this.qx.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const x=[];for(const L of this.cameras)I&&!I(L)||(this.qx.addCamera(L),x.push(L));for(const L of this.lights)I&&!I(L)||(this.qx.addLight(L),x.push(L));for(const L of this.meshes)I&&!I(L)||(this.qx.NW(L),x.push(L));for(const L of this.skeletons)I&&!I(L)||this.qx.addSkeleton(L);for(const L of this.animations)I&&!I(L)||this.qx.addAnimation(L);for(const L of this.animationGroups)I&&!I(L)||this.qx.addAnimationGroup(L);for(const L of this.multiMaterials)I&&!I(L)||this.qx.addMultiMaterial(L);for(const L of this.materials)I&&!I(L)||this.qx.addMaterial(L);for(const L of this.morphTargetManagers)I&&!I(L)||this.qx.addMorphTargetManager(L);for(const L of this.geometries)I&&!I(L)||this.qx.addGeometry(L);for(const L of this.transformNodes)I&&!I(L)||(this.qx.addTransformNode(L),x.push(L));for(const L of this.actionManagers)I&&!I(L)||this.qx.addActionManager(L);for(const L of this.textures)I&&!I(L)||this.qx.addTexture(L);for(const L of this.reflectionProbes)I&&!I(L)||this.qx.addReflectionProbe(L);for(const L of x)L.parent&&-1===this.qx.getNodes().indexOf(L.parent)&&(L.setParent?L.setParent(null):L.parent=null)}removeAllFromScene(){this._isValidHierarchy()||X.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.qx.environmentTexture&&(this.qx.environmentTexture=null);for(const I of this.qx._serializableComponents)I.removeFromContainer(this)}removeFromScene(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const x of this.cameras)I&&!I(x)||this.qx.removeCamera(x);for(const x of this.lights)I&&!I(x)||this.qx.removeLight(x);for(const x of this.meshes)I&&!I(x)||this.qx.rW(x,!0);for(const x of this.skeletons)I&&!I(x)||this.qx.removeSkeleton(x);for(const x of this.animations)I&&!I(x)||this.qx.removeAnimation(x);for(const x of this.animationGroups)I&&!I(x)||this.qx.removeAnimationGroup(x);for(const x of this.multiMaterials)I&&!I(x)||this.qx.removeMultiMaterial(x);for(const x of this.materials)I&&!I(x)||this.qx.removeMaterial(x);for(const x of this.morphTargetManagers)I&&!I(x)||this.qx.removeMorphTargetManager(x);for(const x of this.geometries)I&&!I(x)||this.qx.removeGeometry(x);for(const x of this.transformNodes)I&&!I(x)||this.qx.removeTransformNode(x);for(const x of this.actionManagers)I&&!I(x)||this.qx.removeActionManager(x);for(const x of this.textures)I&&!I(x)||this.qx.removeTexture(x);for(const x of this.reflectionProbes)I&&!I(x)||this.qx.removeReflectionProbe(x)}dispose(){const I=this.cameras.slice(0);for(const g of I)g.dispose();this.cameras.length=0;const x=this.lights.slice(0);for(const g of x)g.dispose();this.lights.length=0;const L=this.meshes.slice(0);for(const g of L)g.dispose();this.meshes.length=0;const F=this.skeletons.slice(0);for(const g of F)g.dispose();this.skeletons.length=0;const X=this.animationGroups.slice(0);for(const g of X)g.dispose();this.animationGroups.length=0;const G=this.multiMaterials.slice(0);for(const g of G)g.dispose();this.multiMaterials.length=0;const Y=this.materials.slice(0);for(const g of Y)g.dispose();this.materials.length=0;const p=this.geometries.slice(0);for(const g of p)g.dispose();this.geometries.length=0;const B=this.transformNodes.slice(0);for(const g of B)g.dispose();this.transformNodes.length=0;const l=this.actionManagers.slice(0);for(const g of l)g.dispose();this.actionManagers.length=0;const W=this.textures.slice(0);for(const g of W)g.dispose();this.textures.length=0;const Q=this.reflectionProbes.slice(0);for(const g of Q)g.dispose();this.reflectionProbes.length=0;const e=this.morphTargetManagers.slice(0);for(const g of e)g.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const g of this.qx._serializableComponents)g.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.qx.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(I,x,L){if(I&&x)for(const F of I){let I=!0;if(L)for(const x of L)if(F===x){I=!1;break}I&&(x.push(F),F._parentContainer=this)}}moveAllFromScene(I){this._wasAddedToScene=!1,void 0===I&&(I=new H);for(const x in this)Object.prototype.hasOwnProperty.call(this,x)&&(this[x]=this[x]||("_environmentTexture"===x?null:[]),this._moveAssets(this.qx[x],this[x],I[x]));this.environmentTexture=this.qx.environmentTexture,this.removeAllFromScene()}createRootMesh(){const I=new Y.e("assetContainerRootMesh",this.qx);for(const x of this.meshes)x.parent||I.addChild(x);return this.meshes.unshift(I),I}mergeAnimationsTo(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W.e.LastCreatedScene,x=arguments.length>1?arguments[1]:void 0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!I)return l.c.Error("No scene available to merge animations to"),[];const F=L||(x=>{let L=null;const F=x.animations.length?x.animations[0].targetProperty:"",X=x.name.split(".").join("").split("_primitive")[0];switch(F){case"position":case"rotationQuaternion":L=I.getTransformNodeByName(x.name)||I.getTransformNodeByName(X);break;case"influence":L=I.getMorphTargetByName(x.name)||I.getMorphTargetByName(X);break;default:L=I.getNodeByName(x.name)||I.getNodeByName(X)}return L}),X=this.getNodes();for(const p of X){const I=F(p);if(null!==I){for(const x of p.animations){const L=I.animations.filter((I=>I.targetProperty===x.targetProperty));for(const x of L){const L=I.animations.indexOf(x,0);L>-1&&I.animations.splice(L,1)}}I.animations=I.animations.concat(p.animations)}}const G=[],Y=this.animationGroups.slice();for(const p of Y){G.push(p.clone(p.name,F));for(const I of p.animatables)I.stop()}for(const p of x){const x=F(p.target);x&&(I.beginAnimation(x,p.fromFrame,p.toFrame,p.loopAnimation,p.speedRatio,p.onAnimationEnd?p.onAnimationEnd:void 0,void 0,!0,void 0,p.onAnimationLoop?p.onAnimationLoop:void 0),I.stopAnimation(p.target))}return G}populateRootNodes(){this.rootNodes.length=0;for(const I of this.meshes)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I);for(const I of this.transformNodes)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I);for(const I of this.lights)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I);for(const I of this.cameras)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I)}addAllAssetsToContainer(I){if(!I)return;const x=[],L=new Set;for(x.push(I);x.length>0;){const I=x.pop();if(I instanceof Y.e?(I.FB&&-1===this.geometries.indexOf(I.FB)&&this.geometries.push(I.FB),this.meshes.push(I)):I instanceof Q.b?this.meshes.push(I):I instanceof p.c?this.transformNodes.push(I):I instanceof e.c?this.lights.push(I):I instanceof g.b&&this.cameras.push(I),I instanceof B.b){if(I.material&&-1===this.materials.indexOf(I.material)){this.materials.push(I.material);for(const x of I.material.getActiveTextures())-1===this.textures.indexOf(x)&&this.textures.push(x)}I.skeleton&&-1===this.skeletons.indexOf(I.skeleton)&&this.skeletons.push(I.skeleton),I.morphTargetManager&&-1===this.morphTargetManagers.indexOf(I.morphTargetManager)&&this.morphTargetManagers.push(I.morphTargetManager)}for(const F of I.getChildren())L.has(F)||x.push(F);L.add(I)}this.populateRootNodes()}_getByTags(I,x,L){if(void 0===x)return I;const F=[];for(const X in I){const G=I[X];v.d&&v.d.MatchesQuery(G,x)&&(!L||L(G))&&F.push(G)}return F}getMeshesByTags(I,x){return this._getByTags(this.meshes,I,x)}getCamerasByTags(I,x){return this._getByTags(this.cameras,I,x)}getLightsByTags(I,x){return this._getByTags(this.lights,I,x)}getMaterialsByTags(I,x){return this._getByTags(this.materials,I,x).concat(this._getByTags(this.multiMaterials,I,x))}getTransformNodesByTags(I,x){return this._getByTags(this.transformNodes,I,x)}}var q=L(12849);class y{constructor(I){this.byteOffset=0,this.buffer=I}async loadAsync(I){const x=await this.buffer.readAsync(this.byteOffset,I);this._dataView=new DataView(x.buffer,x.byteOffset,x.byteLength),this._dataByteOffset=0}readUint32(){const I=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,I}readUint8Array(I){const x=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,I);return this._dataByteOffset+=I,this.byteOffset+=I,x}readString(I){return(0,q.i)(this.readUint8Array(I))}skipBytes(I){this._dataByteOffset+=I,this.byteOffset+=I}}var T=L(14433);const Z="Z2xURg",t={name:"Ep",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:I=>-1!==I.indexOf("asset")&&-1!==I.indexOf("version")||I.startsWith("data:base64,"+Z)||I.startsWith("data:;base64,"+Z)||I.startsWith("data:application/octet-stream;base64,"+Z)||I.startsWith("data:model/gltf-binary;base64,"+Z)};var f,R,n,P=L(12842),d=L(12847);function M(I,x,L){try{return Promise.resolve(new Uint8Array(I,x,L))}catch(F){return Promise.reject(F)}}!function(I){I[I.AUTO=0]="AUTO",I[I.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(f||(f={})),function(I){I[I.NONE=0]="NONE",I[I.FIRST=1]="FIRST",I[I.ALL=2]="ALL"}(R||(R={})),function(I){I[I.LOADING=0]="LOADING",I[I.READY=1]="READY",I[I.COMPLETE=2]="COMPLETE"}(n||(n={}));class K{constructor(){this.coordinateSystemMode=f.AUTO,this.animationStartMode=R.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=I=>Promise.resolve(I),this.extensionOptions={}}X(I){I&&(this.onParsed=I.onParsed,this.coordinateSystemMode=I.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=I.animationStartMode??this.animationStartMode,this.loadNodeAnimations=I.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=I.loadSkins??this.loadSkins,this.loadMorphTargets=I.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=I.compileMaterials??this.compileMaterials,this.useClipPlane=I.useClipPlane??this.useClipPlane,this.compileShadowGenerators=I.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=I.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=I.useRangeRequests??this.useRangeRequests,this.createInstances=I.createInstances??this.createInstances,this.alwaysComputeBoundingBox=I.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=I.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=I.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=I.skipMaterials??this.skipMaterials,this.useSRGBBuffers=I.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=I.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=I.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=I.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=I.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=I.customRootNode,this.onMeshLoaded=I.onMeshLoaded,this.onSkinLoaded=I.onSkinLoaded,this.onTextureLoaded=I.onTextureLoaded,this.onMaterialLoaded=I.onMaterialLoaded,this.onCameraLoaded=I.onCameraLoaded,this.extensionOptions=I.extensionOptions??this.extensionOptions)}}class u extends K{constructor(I){super(),this.onParsedObservable=new F.c,this.onMeshLoadedObservable=new F.c,this.onSkinLoadedObservable=new F.c,this.onTextureLoadedObservable=new F.c,this.onMaterialLoadedObservable=new F.c,this.onCameraLoadedObservable=new F.c,this.onCompleteObservable=new F.c,this.onErrorObservable=new F.c,this.cp=new F.c,this.onExtensionLoadedObservable=new F.c,this.validate=!1,this.onValidatedObservable=new F.c,this._loader=null,this._state=null,this._requests=new Array,this.name=t.name,this.extensions=t.extensions,this.onLoaderStateChangedObservable=new F.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.X(I)}set onParsed(I){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),I&&(this._onParsedObserver=this.onParsedObservable.add(I))}set onMeshLoaded(I){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),I&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(I))}set onSkinLoaded(I){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),I&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((x=>I(x.node,x.skinnedNode))))}set onTextureLoaded(I){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),I&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(I))}set onMaterialLoaded(I){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),I&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(I))}set onCameraLoaded(I){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),I&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(I))}set onComplete(I){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(I)}set onError(I){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(I)}set onDispose(I){this._onDisposeObserver&&this.cp.remove(this._onDisposeObserver),this._onDisposeObserver=this.cp.add(I)}set onExtensionLoaded(I){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(I)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(I){this._loggingEnabled!==I&&(this._loggingEnabled=I,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(I){this._capturePerformanceCounters!==I&&(this._capturePerformanceCounters=I,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(I){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(I)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const I of this._requests)I.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=I=>Promise.resolve(I),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.cp.notifyObservers(void 0),this.cp.clear()}loadFile(I,x,L,G,Y,p,B,W){if(ArrayBuffer.isView(x))return this._loadBinary(I,x,L,G,B,W),null;this._progressCallback=Y;const Q=x.name||X.Tools.GetFilename(x);if(p){if(this.useRangeRequests){this.validate&&l.c.Warn("glTF validation is not supported when range requests are enabled");const L={abort:()=>{},onCompleteObservable:new F.c},X={readAsync:(L,F)=>new Promise(((X,G)=>{this._loadFile(I,x,(I=>{X(new Uint8Array(I))}),!0,(I=>{G(I)}),(I=>{I.setRequestHeader("Range",`bytes=${L}-${L+F-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new y(X)).then((I=>{L.onCompleteObservable.notifyObservers(L),G(I)}),B?I=>B(void 0,I):void 0),L}return this._loadFile(I,x,(x=>{this._validate(I,new Uint8Array(x,0,x.byteLength),L,Q),this._unpackBinaryAsync(new y({readAsync:(I,L)=>M(x,I,L),byteLength:x.byteLength})).then((I=>{G(I)}),B?I=>B(void 0,I):void 0)}),!0,B)}return this._loadFile(I,x,(x=>{try{this._validate(I,x,L,Q),G({json:this._parseJson(x)})}catch{B&&B()}}),!1,B)}_loadBinary(I,x,L,F,X,G){this._validate(I,new Uint8Array(x.buffer,x.byteOffset,x.byteLength),L,G),this._unpackBinaryAsync(new y({readAsync:(I,L)=>function(I,x,L){try{if(x<0||x>=I.byteLength)throw new RangeError("Offset is out of range.");if(x+L>I.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(I.buffer,I.byteOffset+x,L))}catch(F){return Promise.reject(F)}}(x,I,L),byteLength:x.byteLength})).then((I=>{F(I)}),X?I=>X(void 0,I):void 0)}importMeshAsync(I,x,L,F,X,G){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(L),this.onParsedObservable.clear(),this._log(`Loading ${G||""}`),this._loader=this._getLoader(L),this._loader.importMeshAsync(I,x,null,L,F,X,G))))}loadAsync(I,x,L,F,X){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(x),this.onParsedObservable.clear(),this._log(`Loading ${X||""}`),this._loader=this._getLoader(x),this._loader.loadAsync(I,x,L,F,X))))}loadAssetContainerAsync(I,x,L,F,X){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(x),this.onParsedObservable.clear(),this._log(`Loading ${X||""}`),this._loader=this._getLoader(x);const G=new U(I),Y=[];this.onMaterialLoadedObservable.add((I=>{Y.push(I)}));const p=[];this.onTextureLoadedObservable.add((I=>{p.push(I)}));const B=[];this.onCameraLoadedObservable.add((I=>{B.push(I)}));const l=[];return this.onMeshLoadedObservable.add((I=>{I.morphTargetManager&&l.push(I.morphTargetManager)})),this._loader.importMeshAsync(null,I,G,x,L,F,X).then((I=>(Array.prototype.push.apply(G.geometries,I.geometries),Array.prototype.push.apply(G.meshes,I.meshes),Array.prototype.push.apply(G.Gg,I.Gg),Array.prototype.push.apply(G.skeletons,I.skeletons),Array.prototype.push.apply(G.animationGroups,I.animationGroups),Array.prototype.push.apply(G.materials,Y),Array.prototype.push.apply(G.textures,p),Array.prototype.push.apply(G.lights,I.lights),Array.prototype.push.apply(G.transformNodes,I.transformNodes),Array.prototype.push.apply(G.cameras,B),Array.prototype.push.apply(G.morphTargetManagers,l),G)))}))}canDirectLoad(I){return t.canDirectLoad(I)}directLoad(I,x){if(x.startsWith("base64,"+Z)||x.startsWith(";base64,"+Z)||x.startsWith("application/octet-stream;base64,"+Z)||x.startsWith("model/gltf-binary;base64,"+Z)){const L=(0,P.c)(x);return this._validate(I,new Uint8Array(L,0,L.byteLength)),this._unpackBinaryAsync(new y({readAsync:(I,x)=>M(L,I,x),byteLength:L.byteLength}))}return this._validate(I,x),Promise.resolve({json:this._parseJson(x)})}createPlugin(I){return new u(I[t.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((I,x)=>{this.onCompleteObservable.addOnce((()=>{I()})),this.onErrorObservable.addOnce((I=>{x(I)}))}))}_setState(I){this._state!==I&&(this._state=I,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(n[this._state]))}_loadFile(I,x,L,F,X,G){const Y=I._loadFile(x,L,(I=>{this._onProgress(I,Y)}),!0,F,X,G);return Y.onCompleteObservable.add((()=>{Y._lengthComputable=!0,Y._total=Y._loaded})),this._requests.push(Y),Y}_onProgress(I,x){if(!this._progressCallback)return;x._lengthComputable=I.lengthComputable,x._loaded=I.loaded,x._total=I.total;let L=!0,F=0,X=0;for(const G of this._requests){if(void 0===G._lengthComputable||void 0===G._loaded||void 0===G._total)return;L=L&&G._lengthComputable,F+=G._loaded,X+=G._total}this._progressCallback({lengthComputable:L,loaded:F,total:L?X:0})}_validate(I,x){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),T.b.ValidateAsync(x,L,F,(x=>this.preprocessUrlAsync(L+x).then((x=>I._loadFileAsync(x,void 0,!0,!0).then((I=>new Uint8Array(I,0,I.byteLength))))))).then((I=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(I),this.onValidatedObservable.clear()}),(I=>{this._endPerformanceCounter("Validate JSON"),X.Tools.Warn(`Failed to validate: ${I.message}`),this.onValidatedObservable.clear()})))}_getLoader(I){const x=I.json.asset||{};this._log(`Asset version: ${x.version}`),x.minVersion&&this._log(`Asset minimum version: ${x.minVersion}`),x.generator&&this._log(`Asset generator: ${x.generator}`);const L=u._parseVersion(x.version);if(!L)throw new Error("Invalid version: "+x.version);if(void 0!==x.minVersion){const I=u._parseVersion(x.minVersion);if(!I)throw new Error("Invalid minimum version: "+x.minVersion);if(u._compareVersion(I,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+x.minVersion)}const F={1:u._CreateGLTF1Loader,2:u._CreateGLTF2Loader}[L.major];if(!F)throw new Error("Unsupported version: "+x.version);return F(this)}_parseJson(I){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${I.length}`);const x=JSON.parse(I);return this._endPerformanceCounter("Parse JSON"),x}_unpackBinaryAsync(I){return this._startPerformanceCounter("Unpack Binary"),I.loadAsync(20).then((()=>{const x=I.readUint32();if(1179937895!==x)throw new d.j("Unexpected magic: "+x,d.f.GLTFLoaderUnexpectedMagicError);const L=I.readUint32();this.loggingEnabled&&this._log(`Binary version: ${L}`);const F=I.readUint32();let X;switch(this.useRangeRequests||F===I.buffer.byteLength||l.c.Warn(`Length in header does not match actual data length: ${F} != ${I.buffer.byteLength}`),L){case 1:X=this._unpackBinaryV1Async(I,F);break;case 2:X=this._unpackBinaryV2Async(I,F);break;default:throw new Error("Unsupported version: "+L)}return this._endPerformanceCounter("Unpack Binary"),X}))}_unpackBinaryV1Async(I,x){const L=I.readUint32(),F=I.readUint32();if(0!==F)throw new Error(`Unexpected content format: ${F}`);const X=x-I.byteOffset,G={json:this._parseJson(I.readString(L)),bin:null};if(0!==X){const x=I.byteOffset;G.bin={readAsync:(L,F)=>I.buffer.readAsync(x+L,F),byteLength:X}}return Promise.resolve(G)}_unpackBinaryV2Async(I,x){const L=1313821514,F=5130562,X=I.readUint32();if(I.readUint32()!==L)throw new Error("First chunk format is not JSON");return I.byteOffset+X===x?I.loadAsync(X).then((()=>({json:this._parseJson(I.readString(X)),bin:null}))):I.loadAsync(X+8).then((()=>{const G={json:this._parseJson(I.readString(X)),bin:null},Y=()=>{const X=I.readUint32();switch(I.readUint32()){case L:throw new Error("Unexpected JSON chunk");case F:{const x=I.byteOffset;G.bin={readAsync:(L,F)=>I.buffer.readAsync(x+L,F),byteLength:X},I.skipBytes(X);break}default:I.skipBytes(X)}return I.byteOffset!==x?I.loadAsync(8).then(Y):Promise.resolve(G)};return Y()}))}static _parseVersion(I){if("1.0"===I||"1.0.1"===I)return{major:1,minor:0};const x=(I+"").match(/^(\d+)\.(\d+)/);return x?{major:parseInt(x[1]),minor:parseInt(x[2])}:null}static _compareVersion(I,x){return I.major>x.major?1:I.major<x.major?-1:I.minor>x.minor?1:I.minor<x.minor?-1:0}_logOpen(I){this._log(I),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(I){const x=u._logSpaces.substring(0,2*this._logIndentLevel);l.c.Log(`${x}${I}`)}_logDisabled(I){}_startPerformanceCounterEnabled(I){X.Tools.StartPerformanceCounter(I)}_startPerformanceCounterDisabled(I){}_endPerformanceCounterEnabled(I){X.Tools.EndPerformanceCounter(I)}_endPerformanceCounterDisabled(I){}}u.IncrementalLoading=!0,u.HomogeneousCoordinates=!1,u._logSpaces="                                ",(0,G.d)(new u)},14433:(I,x,L)=>{"use strict";L.d(x,{b:()=>Y});var F=L(12791);function X(I,x,L,F){const X={externalResourceFunction:F};return L&&(X.uri="file:"===x?L:x+L),ArrayBuffer.isView(I)?GLTFValidator.validateBytes(I,X):GLTFValidator.validateString(I,X)}function G(){const I=[];onmessage=x=>{const L=x.data;switch(L.id){case"init":importScripts(L.url);break;case"validate":X(L.data,L.rootUrl,L.fileName,(x=>new Promise(((L,F)=>{const X=I.length;I.push({resolve:L,reject:F}),postMessage({id:"getExternalResource",index:X,uri:x})})))).then((I=>{postMessage({id:"validate.resolve",value:I})}),(I=>{postMessage({id:"validate.reject",reason:I})}));break;case"getExternalResource.resolve":I[L.index].resolve(L.value);break;case"getExternalResource.reject":I[L.index].reject(L.reason)}}}class Y{static ValidateAsync(I,x,L,Y){return"function"===typeof Worker?new Promise(((p,B)=>{const l=`${X}(${G})()`,W=URL.createObjectURL(new Blob([l],{type:"application/javascript"})),Q=new Worker(W),e=I=>{Q.removeEventListener("error",e),Q.removeEventListener("message",g),B(I)},g=I=>{const x=I.data;switch(x.id){case"getExternalResource":Y(x.uri).then((I=>{Q.postMessage({id:"getExternalResource.resolve",index:x.index,value:I},[I.buffer])}),(I=>{Q.postMessage({id:"getExternalResource.reject",index:x.index,reason:I})}));break;case"validate.resolve":Q.removeEventListener("error",e),Q.removeEventListener("message",g),p(x.value),Q.terminate();break;case"validate.reject":Q.removeEventListener("error",e),Q.removeEventListener("message",g),B(x.reason),Q.terminate()}};if(Q.addEventListener("error",e),Q.addEventListener("message",g),Q.postMessage({id:"init",url:F.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(I)){const F=I.slice();Q.postMessage({id:"validate",data:F,rootUrl:x,fileName:L},[F.buffer])}else Q.postMessage({id:"validate",data:I,rootUrl:x,fileName:L})})):(this._LoadScriptPromise||(this._LoadScriptPromise=F.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>X(I,x,L,Y))))}}Y.Configuration={url:`${F.Tools._DefaultCdnUrl}/gltf_validator.js`}},15064:(I,x,L)=>{"use strict";L.d(x,{b:()=>t});var F=L(12969),X=L(12971),G=L(13012),Y=L(12983),p=L(13365),B=L(13295),l=L(13048),W=L(13218),Q=L(12938),e=L(12885);L(14205),L(14115),L(14133),L(14121),L(14137),L(14143),L(14147);const g="imageProcessingCompatibility",v="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";e.d.IncludesShadersStore[g]||(e.d.IncludesShadersStore[g]=v);const z="skyPixelShader",H="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";e.d.ShadersStore[z]||(e.d.ShadersStore[z]=H);L(14217),L(14156),L(14160),L(14168),L(14165);const s="skyVertexShader",U="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";e.d.ShadersStore[s]||(e.d.ShadersStore[s]=U);var q=L(13293),y=L(13340),T=L(13336);class Z extends p.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class t extends B.c{constructor(I,x){super(I,x),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new Y.sx(0,100,0),this.useSunPosition=!1,this.cameraOffset=Y.sx.Zero(),this.up=Y.sx.Up(),this.dithering=!1,this._cameraPosition=Y.sx.Zero(),this._skyOrientation=new Y.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(I,x){const L=x._drawWrapper;if(this.isFrozen&&L.effect&&L._wasPreviouslyReady)return!0;x.materialDefines||(x.materialDefines=new Z);const F=x.materialDefines,X=this.tI();if(this._isReadyForSubMesh(x))return!0;if((0,T.V)(I,X,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,F),(0,T.K)(I,F,!0,!1),F.IMAGEPROCESSINGPOSTPROCESS!==X.imageProcessingConfiguration.applyByPostProcess&&F.markAsMiscDirty(),F.DITHER!==this.dithering&&F.markAsMiscDirty(),F.isDirty){F.markAsProcessed(),X.resetCachedMaterial();const I=new q.e;F.FOG&&I.addFallback(1,"FOG"),F.IMAGEPROCESSINGPOSTPROCESS=X.imageProcessingConfiguration.applyByPostProcess,F.DITHER=this.dithering;const L=[l.g.PositionKind];F.VERTEXCOLOR&&L.push(l.g.ColorKind);const G="sky",Y=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,y.d)(Y);const p=F.toString();x.setEffect(X.getEngine().createEffect(G,L,Y,[],p,I,this.onCompiled,this.onError),F,this._materialContext)}return!(!x.effect||!x.effect.isReady())&&(F._renderId=X.getRenderId(),L._wasPreviouslyReady=!0,!0)}bindForSubMesh(I,x,L){const F=this.tI(),X=L.materialDefines;if(!X)return;const G=L.effect;if(!G)return;this._activeEffect=G,this.bindOnlyWorldMatrix(I),this._activeEffect.setMatrix("viewProjection",F.getTransformMatrix()),this._mustRebind(F,G,L)&&((0,y.e)(G,this,F),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,T.g)(X,G,F)),F.fogEnabled&&x.applyFog&&F.fogMode!==W.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",F.getViewMatrix()),(0,T.e)(F,x,this._activeEffect);const p=F.activeCamera;if(p){const I=p.getWorldMatrix();this._cameraPosition.x=I.m[12],this._cameraPosition.y=I.m[13],this._cameraPosition.z=I.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const I=Math.PI*(this.inclination-.5),x=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(x)*Math.cos(I),this.sunPosition.y=this.distance*Math.sin(-I),this.sunPosition.z=this.distance*Math.sin(x)*Math.cos(I),Y.Quaternion.FromUnitVectorsToRef(Y.sx.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(x,this._activeEffect,L)}getAnimatables(){return[]}dispose(I){super.dispose(I)}clone(I){return G.c.Clone((()=>new t(I,this.tI())),this)}serialize(){const I=super.serialize();return I.customType="BABYLON.SkyMaterial",I}getClassName(){return"SkyMaterial"}static Parse(I,x,L){return G.c.Parse((()=>new t(I.name,x)),I,x,L)}}(0,F.d)([(0,X.K)()],t.prototype,"luminance",void 0),(0,F.d)([(0,X.K)()],t.prototype,"turbidity",void 0),(0,F.d)([(0,X.K)()],t.prototype,"rayleigh",void 0),(0,F.d)([(0,X.K)()],t.prototype,"mieCoefficient",void 0),(0,F.d)([(0,X.K)()],t.prototype,"mieDirectionalG",void 0),(0,F.d)([(0,X.K)()],t.prototype,"distance",void 0),(0,F.d)([(0,X.K)()],t.prototype,"inclination",void 0),(0,F.d)([(0,X.K)()],t.prototype,"azimuth",void 0),(0,F.d)([(0,X.I)()],t.prototype,"sunPosition",void 0),(0,F.d)([(0,X.K)()],t.prototype,"useSunPosition",void 0),(0,F.d)([(0,X.I)()],t.prototype,"cameraOffset",void 0),(0,F.d)([(0,X.I)()],t.prototype,"up",void 0),(0,F.d)([(0,X.K)()],t.prototype,"dithering",void 0),(0,Q.d)("BABYLON.SkyMaterial",t)},13645:(I,x,L)=>{"use strict";function F(I,x){x.headers=I.headers||{},x.statusMessage=I.statusText,x.statusCode=I.status,x.data=I.response}function X(I,x,L){return new Promise((function(X,G){L=L||{};var Y,p,B,l=new XMLHttpRequest,W=L.body,Q=L.headers||{};for(Y in L.timeout&&(l.timeout=L.timeout),l.ontimeout=l.onerror=function(I){I.timeout="timeout"==I.type,G(I)},l.open(I,x.href||x),l.onload=function(){for(B=l.getAllResponseHeaders().trim().split(/[\r\n]+/),F(l,l);p=B.shift();)p=p.split(": "),l.headers[p.shift().toLowerCase()]=p.join(": ");if((p=l.headers["content-type"])&&~p.indexOf("application/json"))try{l.data=JSON.parse(l.data,L.reviver)}catch(I){return F(l,I),G(I)}(l.status>=400?G:X)(l)},typeof FormData<"u"&&W instanceof FormData||W&&"object"==typeof W&&(Q["content-type"]="application/json",W=JSON.stringify(W)),l.withCredentials=!!L.withCredentials,Q)l.setRequestHeader(Y,Q[Y]);l.send(W)}))}L.r(x),L.d(x,{del:()=>B,get:()=>G,patch:()=>p,post:()=>Y,put:()=>l,send:()=>X});var G=X.bind(X,"GET"),Y=X.bind(X,"POST"),p=X.bind(X,"PATCH"),B=X.bind(X,"DELETE"),l=X.bind(X,"PUT")},15180:(I,x,L)=>{"use strict";L.d(x,{b:()=>Q});const F=.5*(Math.sqrt(3)-1),X=(3-Math.sqrt(3))/6,G=1/3,Y=1/6,p=(Math.sqrt(5)-1)/4,B=(5-Math.sqrt(5))/20,l=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),W=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const Q=class{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const x="function"==typeof I?I:function(I){let x=0,L=0,F=0,X=1;const G=function(){let I=4022871197;return function(x){x=x.toString();for(let L=0;L<x.length;L++){I+=x.charCodeAt(L);let F=.02519603282416938*I;I=F>>>0,F-=I,F*=I,I=F>>>0,F-=I,I+=4294967296*F}return 2.3283064365386963e-10*(I>>>0)}}();x=G(" "),L=G(" "),F=G(" "),x-=G(I),x<0&&(x+=1);L-=G(I),L<0&&(L+=1);F-=G(I),F<0&&(F+=1);return function(){const I=2091639*x+2.3283064365386963e-10*X;return x=L,L=F,F=I-(X=0|I)}}(I);this.p=function(I){const x=new Uint8Array(256);for(let L=0;L<256;L++)x[L]=L;for(let L=0;L<255;L++){const F=L+~~(I()*(256-L)),X=x[L];x[L]=x[F],x[F]=X}return x}(x),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let L=0;L<512;L++)this.perm[L]=this.p[255&L],this.permMod12[L]=this.perm[L]%12}noise2D(I,x){const L=this.permMod12,G=this.perm;let Y=0,p=0,B=0;const W=(I+x)*F,Q=Math.floor(I+W),e=Math.floor(x+W),g=(Q+e)*X,v=I-(Q-g),z=x-(e-g);let H,s;v>z?(H=1,s=0):(H=0,s=1);const U=v-H+X,q=z-s+X,y=v-1+2*X,T=z-1+2*X,Z=255&Q,t=255&e;let f=.5-v*v-z*z;if(f>=0){const I=3*L[Z+G[t]];f*=f,Y=f*f*(l[I]*v+l[I+1]*z)}let R=.5-U*U-q*q;if(R>=0){const I=3*L[Z+H+G[t+s]];R*=R,p=R*R*(l[I]*U+l[I+1]*q)}let n=.5-y*y-T*T;if(n>=0){const I=3*L[Z+1+G[t+1]];n*=n,B=n*n*(l[I]*y+l[I+1]*T)}return 70*(Y+p+B)}noise3D(I,x,L){const F=this.permMod12,X=this.perm;let p,B,W,Q;const e=(I+x+L)*G,g=Math.floor(I+e),v=Math.floor(x+e),z=Math.floor(L+e),H=(g+v+z)*Y,s=I-(g-H),U=x-(v-H),q=L-(z-H);let y,T,Z,t,f,R;s>=U?U>=q?(y=1,T=0,Z=0,t=1,f=1,R=0):s>=q?(y=1,T=0,Z=0,t=1,f=0,R=1):(y=0,T=0,Z=1,t=1,f=0,R=1):U<q?(y=0,T=0,Z=1,t=0,f=1,R=1):s<q?(y=0,T=1,Z=0,t=0,f=1,R=1):(y=0,T=1,Z=0,t=1,f=1,R=0);const n=s-y+Y,P=U-T+Y,d=q-Z+Y,M=s-t+2*Y,K=U-f+2*Y,u=q-R+2*Y,A=s-1+.5,mI=U-1+.5,O=q-1+.5,w=255&g,k=255&v,a=255&z;let D=.6-s*s-U*U-q*q;if(D<0)p=0;else{const I=3*F[w+X[k+X[a]]];D*=D,p=D*D*(l[I]*s+l[I+1]*U+l[I+2]*q)}let r=.6-n*n-P*P-d*d;if(r<0)B=0;else{const I=3*F[w+y+X[k+T+X[a+Z]]];r*=r,B=r*r*(l[I]*n+l[I+1]*P+l[I+2]*d)}let N=.6-M*M-K*K-u*u;if(N<0)W=0;else{const I=3*F[w+t+X[k+f+X[a+R]]];N*=N,W=N*N*(l[I]*M+l[I+1]*K+l[I+2]*u)}let S=.6-A*A-mI*mI-O*O;if(S<0)Q=0;else{const I=3*F[w+1+X[k+1+X[a+1]]];S*=S,Q=S*S*(l[I]*A+l[I+1]*mI+l[I+2]*O)}return 32*(p+B+W+Q)}noise4D(I,x,L,F){const X=this.perm;let G,Y,l,Q,e;const g=(I+x+L+F)*p,v=Math.floor(I+g),z=Math.floor(x+g),H=Math.floor(L+g),s=Math.floor(F+g),U=(v+z+H+s)*B,q=I-(v-U),y=x-(z-U),T=L-(H-U),Z=F-(s-U);let t=0,f=0,R=0,n=0;q>y?t++:f++,q>T?t++:R++,q>Z?t++:n++,y>T?f++:R++,y>Z?f++:n++,T>Z?R++:n++;const P=t>=3?1:0,d=f>=3?1:0,M=R>=3?1:0,K=n>=3?1:0,u=t>=2?1:0,A=f>=2?1:0,mI=R>=2?1:0,O=n>=2?1:0,w=t>=1?1:0,k=f>=1?1:0,a=R>=1?1:0,D=n>=1?1:0,r=q-P+B,N=y-d+B,S=T-M+B,c=Z-K+B,o=q-u+2*B,J=y-A+2*B,h=T-mI+2*B,E=Z-O+2*B,i=q-w+3*B,V=y-k+3*B,j=T-a+3*B,C=Z-D+3*B,b=q-1+4*B,II=y-1+4*B,xI=T-1+4*B,LI=Z-1+4*B,FI=255&v,XI=255&z,GI=255&H,YI=255&s;let pI=.6-q*q-y*y-T*T-Z*Z;if(pI<0)G=0;else{const I=X[FI+X[XI+X[GI+X[YI]]]]%32*4;pI*=pI,G=pI*pI*(W[I]*q+W[I+1]*y+W[I+2]*T+W[I+3]*Z)}let BI=.6-r*r-N*N-S*S-c*c;if(BI<0)Y=0;else{const I=X[FI+P+X[XI+d+X[GI+M+X[YI+K]]]]%32*4;BI*=BI,Y=BI*BI*(W[I]*r+W[I+1]*N+W[I+2]*S+W[I+3]*c)}let lI=.6-o*o-J*J-h*h-E*E;if(lI<0)l=0;else{const I=X[FI+u+X[XI+A+X[GI+mI+X[YI+O]]]]%32*4;lI*=lI,l=lI*lI*(W[I]*o+W[I+1]*J+W[I+2]*h+W[I+3]*E)}let WI=.6-i*i-V*V-j*j-C*C;if(WI<0)Q=0;else{const I=X[FI+w+X[XI+k+X[GI+a+X[YI+D]]]]%32*4;WI*=WI,Q=WI*WI*(W[I]*i+W[I+1]*V+W[I+2]*j+W[I+3]*C)}let QI=.6-b*b-II*II-xI*xI-LI*LI;if(QI<0)e=0;else{const I=X[FI+1+X[XI+1+X[GI+1+X[YI+1]]]]%32*4;QI*=QI,e=QI*QI*(W[I]*b+W[I+1]*II+W[I+2]*xI+W[I+3]*LI)}return 27*(G+Y+l+Q+e)}}}}]);