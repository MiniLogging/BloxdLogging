/*! For license information please see 0j3gk8j.32.913df5c3.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[32],{13084:(h,V,i)=>{"use strict";var S=i(13089),l=i(13093),Y=i(13098);i.g.__TYPEDARRAY_POOL||(i.g.__TYPEDARRAY_POOL={UINT8:l([32,0]),UINT16:l([32,0]),UINT32:l([32,0]),INT8:l([32,0]),INT16:l([32,0]),INT32:l([32,0]),FLOAT:l([32,0]),DOUBLE:l([32,0]),DATA:l([32,0]),UINT8C:l([32,0]),BUFFER:l([32,0])});var g="undefined"!==typeof Uint8ClampedArray,q=i.g.__TYPEDARRAY_POOL;q.UINT8C||(q.UINT8C=l([32,0])),q.BUFFER||(q.BUFFER=l([32,0]));var B=q.DATA,J=q.BUFFER;function I(h){if(h){var V=h.length||h.byteLength,i=S.log2(V);B[i].push(h)}}function v(h){h=S.nextPow2(h);var V=S.log2(h),i=B[V];return i.length>0?i.pop():new ArrayBuffer(h)}function s(h){return new Uint8Array(v(h),0,h)}function t(h){return new Uint16Array(v(2*h),0,h)}function T(h){return new Uint32Array(v(4*h),0,h)}function e(h){return new Int8Array(v(h),0,h)}function n(h){return new Int16Array(v(2*h),0,h)}function c(h){return new Int32Array(v(4*h),0,h)}function f(h){return new Float32Array(v(4*h),0,h)}function P(h){return new Float64Array(v(8*h),0,h)}function L(h){return g?new Uint8ClampedArray(v(h),0,h):s(h)}function U(h){return new DataView(v(h),0,h)}V.free=function(h){if(Y(h))J[S.log2(h.length)].push(h);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(h)&&(h=h.buffer),!h)return;var V=h.length||h.byteLength,i=0|S.log2(V);B[i].push(h)}},V.freeUint8=V.freeUint16=V.freeUint32=V.freeInt8=V.freeInt16=V.freeInt32=V.freeFloat32=V.freeFloat=V.freeFloat64=V.freeDouble=V.freeUint8Clamped=V.freeDataView=function(h){I(h.buffer)},V.freeArrayBuffer=I,V.freeBuffer=function(h){J[S.log2(h.length)].push(h)},V.malloc=function(h,V){if(void 0===V||"arraybuffer"===V)return v(h);switch(V){case"uint8":return s(h);case"uint16":return t(h);case"uint32":return T(h);case"int8":return e(h);case"int16":return n(h);case"int32":return c(h);case"float":case"float32":return f(h);case"double":case"float64":return P(h);case"uint8_clamped":return L(h);case"buffer":throw"Buffer not supported";case"data":case"dataview":return U(h);default:return null}return null},V.mallocArrayBuffer=v,V.mallocUint8=s,V.mallocUint16=t,V.mallocUint32=T,V.mallocInt8=e,V.mallocInt16=n,V.mallocInt32=c,V.mallocFloat32=V.mallocFloat=f,V.mallocFloat64=V.mallocDouble=P,V.mallocUint8Clamped=L,V.mallocDataView=U,V.clearCache=function(){for(var h=0;h<32;++h)q.UINT8[h].length=0,q.UINT16[h].length=0,q.UINT32[h].length=0,q.INT8[h].length=0,q.INT16[h].length=0,q.INT32[h].length=0,q.FLOAT[h].length=0,q.DOUBLE[h].length=0,q.UINT8C[h].length=0,B[h].length=0,J[h].length=0}},13173:(h,V,i)=>{h.exports=l;var S=i(11932);function l(h,V){if(!(this instanceof l))return new l(h,V);var i=S.create();S.add(i,h,V),this.base=S.min(S.create(),h,i),this.EJ=S.clone(V),this.max=S.max(S.create(),h,i),this.mag=S.length(this.EJ)}var Y=l.prototype;Y.width=function(){return this.EJ[0]},Y.height=function(){return this.EJ[1]},Y.depth=function(){return this.EJ[2]},Y.x0=function(){return this.base[0]},Y.y0=function(){return this.base[1]},Y.z0=function(){return this.base[2]},Y.x1=function(){return this.max[0]},Y.y1=function(){return this.max[1]},Y.z1=function(){return this.max[2]},Y.translate=function(h){return S.add(this.max,this.max,h),S.add(this.base,this.base,h),this},Y.setPosition=function(h){return S.add(this.max,h,this.EJ),S.j(this.base,h),this},Y.expand=function(h){var V=S.create(),i=S.create();return S.max(V,h.max,this.max),S.min(i,h.base,this.base),S.cV(V,V,i),new l(i,V)},Y.intersects=function(h){return!(h.base[0]>this.max[0])&&(!(h.base[1]>this.max[1])&&(!(h.base[2]>this.max[2])&&(!(h.max[0]<this.base[0])&&(!(h.max[1]<this.base[1])&&!(h.max[2]<this.base[2])))))},Y.touches=function(h){var V=this.union(h);return null!==V&&(0==V.width()||0==V.height()||0==V.depth())},Y.union=function(h){if(!this.intersects(h))return null;var V=Math.max(h.base[0],this.base[0]),i=Math.max(h.base[1],this.base[1]),S=Math.max(h.base[2],this.base[2]);return new l([V,i,S],[Math.min(h.max[0],this.max[0])-V,Math.min(h.max[1],this.max[1])-i,Math.min(h.max[2],this.max[2])-S])}},13089:(h,V)=>{"use strict";function i(h){var V=32;return(h&=-h)&&V--,65535&h&&(V-=16),16711935&h&&(V-=8),252645135&h&&(V-=4),858993459&h&&(V-=2),1431655765&h&&(V-=1),V}V.INT_BITS=32,V.INT_MAX=2147483647,V.INT_MIN=-1<<31,V.sign=function(h){return(h>0)-(h<0)},V.abs=function(h){var V=h>>31;return(h^V)-V},V.min=function(h,V){return V^(h^V)&-(h<V)},V.max=function(h,V){return h^(h^V)&-(h<V)},V.isPow2=function(h){return!(h&h-1)&&!!h},V.log2=function(h){var V,i;return V=(h>65535)<<4,V|=i=((h>>>=V)>255)<<3,V|=i=((h>>>=i)>15)<<2,(V|=i=((h>>>=i)>3)<<1)|(h>>>=i)>>1},V.log10=function(h){return h>=1e9?9:h>=1e8?8:h>=1e7?7:h>=1e6?6:h>=1e5?5:h>=1e4?4:h>=1e3?3:h>=100?2:h>=10?1:0},V.popCount=function(h){return 16843009*((h=(858993459&(h-=h>>>1&1431655765))+(h>>>2&858993459))+(h>>>4)&252645135)>>>24},V.countTrailingZeros=i,V.nextPow2=function(h){return h+=0===h,--h,h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)+1},V.prevPow2=function(h){return h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)-(h>>>1)},V.parity=function(h){return h^=h>>>16,h^=h>>>8,h^=h>>>4,27030>>>(h&=15)&1};var S=new Array(256);!function(h){for(var V=0;V<256;++V){var i=V,S=V,l=7;for(i>>>=1;i;i>>>=1)S<<=1,S|=1&i,--l;h[V]=S<<l&255}}(S),V.reverse=function(h){return S[255&h]<<24|S[h>>>8&255]<<16|S[h>>>16&255]<<8|S[h>>>24&255]},V.interleave2=function(h,V){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))|(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))<<1},V.deinterleave2=function(h,V){return(h=65535&((h=16711935&((h=252645135&((h=858993459&((h=h>>>V&1431655765)|h>>>1))|h>>>2))|h>>>4))|h>>>16))<<16>>16},V.interleave3=function(h,V,i){return h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2),(h|=(V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},V.deinterleave3=function(h,V){return(h=1023&((h=4278190335&((h=251719695&((h=3272356035&((h=h>>>V&1227133513)|h>>>2))|h>>>4))|h>>>8))|h>>>16))<<22>>22},V.nextCombination=function(h){var V=h|h-1;return V+1|(~V&-~V)-1>>>i(h)+1}},13078:(h,V,i)=>{"use strict";h.exports=function(h,V,i){switch(arguments.length){case 1:return S=[],J(l=h,l,I,!0),S;case 2:return"function"===typeof V?J(h,h,V,!0):function(h,V){return S=[],J(h,V,I,!1),S}(h,V);case 3:return J(h,V,i,!1);default:throw new Error("box-intersect: Invalid arguments")}var l};var S,l=i(13084),Y=i(13104),g=i(13110);function q(h,V){for(var i=0;i<h;++i)if(!(V[i]<=V[i+h]))return!0;return!1}function B(h,V,i,S){for(var l=0,Y=0,g=0,B=h.length;g<B;++g){var J=h[g];if(!q(V,J)){for(var I=0;I<2*V;++I)i[l++]=J[I];S[Y++]=g}}return Y}function J(h,V,i,S){var q=h.length,J=V.length;if(!(q<=0||J<=0)){var I=h[0].length>>>1;if(!(I<=0)){var v,s=l.mallocDouble(2*I*q),t=l.mallocInt32(q);if((q=B(h,I,s,t))>0){if(1===I&&S)Y.init(q),v=Y.sweepComplete(I,i,0,q,s,t,0,q,s,t);else{var T=l.mallocDouble(2*I*J),e=l.mallocInt32(J);(J=B(V,I,T,e))>0&&(Y.init(q+J),v=1===I?Y.sweepBipartite(I,i,0,q,s,t,0,J,T,e):g(I,i,S,q,s,t,J,T,e),l.free(T),l.free(e))}l.free(s),l.free(t)}return v}}}function I(h,V){S.push([h,V])}},13113:(h,V)=>{"use strict";var i="d",S="ax",l="fp",Y="es",g="rs",q="re",B="rb",J="bs",I="be",v="bb",s=[i,S,"vv",g,q,B,"ri",J,I,v,"bi"];function t(h){var V="bruteForce"+(h?"Full":"Partial"),S=[],g=s.slice();h||g.splice(3,0,l);var q=["function "+V+"("+g.join()+"){"];function B(V,l){var g=function(h,V,S){var l="bruteForce"+(h?"Red":"Blue")+(V?"Flip":"")+(S?"Full":""),g=["function ",l,"(",s.join(),"){","var ",Y,"=2*",i,";"],q="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",B="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(S?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return h?g.push(q,"Q",":",B):g.push(B,"Q",":",q),S?g.push("if(y1<x0||x1<y0)continue;"):V?g.push("if(y0<=x0||x1<y0)continue;"):g.push("if(y0<x0||x1<y0)continue;"),g.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),V?g.push("yi,xi"):g.push("xi,yi"),g.push(");if(rv!==void 0)return rv;}}}"),{name:l,code:g.join("")}}(V,l,h);S.push(g.code),q.push("return "+g.name+"("+s.join()+");")}q.push("if(re-rs>be-bs){"),h?(B(!0,!1),q.push("}else{"),B(!1,!1)):(q.push("if(fp){"),B(!0,!0),q.push("}else{"),B(!0,!1),q.push("}}else{if(fp){"),B(!1,!0),q.push("}else{"),B(!1,!1),q.push("}")),q.push("}}return "+V);var J=S.join("")+q.join("");return new Function(J)()}V.partial=t(!1),V.full=t(!0)},13110:(h,V,i)=>{"use strict";h.exports=function(h,V,i,Y,I,F,E,H,j){!function(h,V){var i=8*l.log2(V+1)*(h+1)|0,Y=l.nextPow2(L*i);X.length<Y&&(S.free(X),X=S.mallocInt32(Y));var g=l.nextPow2(U*i);D.length<g&&(S.free(D),D=S.mallocDouble(g))}(h,Y+E);var m,G=0,w=2*h;O(G++,0,0,Y,0,E,i?16:0,-1/0,1/0),i||O(G++,0,0,E,0,Y,1,-1/0,1/0);for(;G>0;){var N=(G-=1)*L,r=X[N],k=X[N+1],R=X[N+2],Z=X[N+3],z=X[N+4],d=X[N+5],x=G*U,y=D[x],Q=D[x+1],A=1&d,b=!!(16&d),C=I,u=F,p=H,W=j;if(A&&(C=H,u=j,p=I,W=F),!(2&d&&k>=(R=n(h,r,k,R,C,u,Q)))&&!(4&d&&(k=c(h,r,k,R,C,u,y))>=R)){var a=R-k,K=z-Z;if(b){if(h*a*(a+K)<t){if(void 0!==(m=B.scanComplete(h,r,V,k,R,C,u,Z,z,p,W)))return m;continue}}else{if(h*Math.min(a,K)<v){if(void 0!==(m=g(h,r,V,A,k,R,C,u,Z,z,p,W)))return m;continue}if(h*a*K<s){if(void 0!==(m=B.scanBipartite(h,r,V,A,k,R,C,u,Z,z,p,W)))return m;continue}}var hh=T(h,r,k,R,C,u,y,Q);if(k<hh)if(h*(hh-k)<v){if(void 0!==(m=q(h,r+1,V,k,hh,C,u,Z,z,p,W)))return m}else if(r===h-2){if(void 0!==(m=A?B.sweepBipartite(h,V,Z,z,p,W,k,hh,C,u):B.sweepBipartite(h,V,k,hh,C,u,Z,z,p,W)))return m}else O(G++,r+1,k,hh,Z,z,A,-1/0,1/0),O(G++,r+1,Z,z,k,hh,1^A,-1/0,1/0);if(hh<R){var Vh=J(h,r,Z,z,p,W),ih=p[w*Vh+r],Sh=e(h,r,Vh,z,p,W,ih);if(Sh<z&&O(G++,r,hh,R,Sh,z,(4|A)+(b?16:0),ih,Q),Z<Vh&&O(G++,r,hh,R,Z,Vh,(2|A)+(b?16:0),y,ih),Vh+1===Sh){if(void 0!==(m=b?M(h,r,V,hh,R,C,u,Vh,p,W[Vh]):o(h,r,V,A,hh,R,C,u,Vh,p,W[Vh])))return m}else if(Vh<Sh){var lh;if(b){if(hh<(lh=f(h,r,hh,R,C,u,ih))){var Yh=e(h,r,hh,lh,C,u,ih);if(r===h-2){if(hh<Yh&&void 0!==(m=B.sweepComplete(h,V,hh,Yh,C,u,Vh,Sh,p,W)))return m;if(Yh<lh&&void 0!==(m=B.sweepBipartite(h,V,Yh,lh,C,u,Vh,Sh,p,W)))return m}else hh<Yh&&O(G++,r+1,hh,Yh,Vh,Sh,16,-1/0,1/0),Yh<lh&&(O(G++,r+1,Yh,lh,Vh,Sh,0,-1/0,1/0),O(G++,r+1,Vh,Sh,Yh,lh,1,-1/0,1/0))}}else hh<(lh=A?P(h,r,hh,R,C,u,ih):f(h,r,hh,R,C,u,ih))&&(r===h-2?m=A?B.sweepBipartite(h,V,Vh,Sh,p,W,hh,lh,C,u):B.sweepBipartite(h,V,hh,lh,C,u,Vh,Sh,p,W):(O(G++,r+1,hh,lh,Vh,Sh,A,-1/0,1/0),O(G++,r+1,Vh,Sh,hh,lh,1^A,-1/0,1/0)))}}}}};var S=i(13084),l=i(13089),Y=i(13113),g=Y.partial,q=Y.full,B=i(13104),J=i(13120),I=i(13126),v=128,s=1<<22,t=1<<22,T=I("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),e=I("lo===p0",["p0"]),n=I("lo<p0",["p0"]),c=I("hi<=p0",["p0"]),f=I("lo<=p0&&p0<=hi",["p0"]),P=I("lo<p0&&p0<=hi",["p0"]),L=6,U=2,X=S.mallocInt32(1024),D=S.mallocDouble(1024);function O(h,V,i,S,l,Y,g,q,B){var J=L*h;X[J]=V,X[J+1]=i,X[J+2]=S,X[J+3]=l,X[J+4]=Y,X[J+5]=g;var I=U*h;D[I]=q,D[I+1]=B}function o(h,V,i,S,l,Y,g,q,B,J,I){var v=2*h,s=B*v,t=J[s+V];h:for(var T=l,e=l*v;T<Y;++T,e+=v){var n=g[e+V],c=g[e+V+h];if(!(t<n||c<t)&&(!S||t!==n)){for(var f,P=q[T],L=V+1;L<h;++L){n=g[e+L],c=g[e+L+h];var U=J[s+L],X=J[s+L+h];if(c<U||X<n)continue h}if(void 0!==(f=S?i(I,P):i(P,I)))return f}}}function M(h,V,i,S,l,Y,g,q,B,J){var I=2*h,v=q*I,s=B[v+V];h:for(var t=S,T=S*I;t<l;++t,T+=I){var e=g[t];if(e!==J){var n=Y[T+V],c=Y[T+V+h];if(!(s<n||c<s)){for(var f=V+1;f<h;++f){n=Y[T+f],c=Y[T+f+h];var P=B[v+f],L=B[v+f+h];if(c<P||L<n)continue h}var U=i(e,J);if(void 0!==U)return U}}}}},13120:(h,V,i)=>{"use strict";h.exports=function(h,V,i,g,q,B){if(g<=i+1)return i;var J=i,I=g,v=g+i>>>1,s=2*h,t=v,T=q[s*v+V];for(;J<I;){if(I-J<l){Y(h,V,J,I,q,B),T=q[s*v+V];break}var e=I-J,n=Math.random()*e+J|0,c=q[s*n+V],f=Math.random()*e+J|0,P=q[s*f+V],L=Math.random()*e+J|0,U=q[s*L+V];c<=P?U>=P?(t=f,T=P):c>=U?(t=n,T=c):(t=L,T=U):P>=U?(t=f,T=P):U>=c?(t=n,T=c):(t=L,T=U);for(var X=s*(I-1),D=s*t,O=0;O<s;++O,++X,++D){var o=q[X];q[X]=q[D],q[D]=o}var M=B[I-1];B[I-1]=B[t],B[t]=M;for(X=s*(I-1),D=s*(t=S(h,V,J,I-1,q,B,T)),O=0;O<s;++O,++X,++D){o=q[X];q[X]=q[D],q[D]=o}M=B[I-1];if(B[I-1]=B[t],B[t]=M,v<t){for(I=t-1;J<I&&q[s*(I-1)+V]===T;)I-=1;I+=1}else{if(!(t<v))break;for(J=t+1;J<I&&q[s*J+V]===T;)J+=1}}return S(h,V,i,v,q,B,q[s*v+V])};var S=i(13126)("lo<p0",["p0"]),l=8;function Y(h,V,i,S,l,Y){for(var g=2*h,q=g*(i+1)+V,B=i+1;B<S;++B,q+=g)for(var J=l[q],I=B,v=g*(B-1);I>i&&l[v+V]>J;--I,v-=g){for(var s=v,t=v+g,T=0;T<g;++T,++s,++t){var e=l[s];l[s]=l[t],l[t]=e}var n=Y[I];Y[I]=Y[I-1],Y[I-1]=n}}},13126:h=>{"use strict";h.exports=function(h,i){var S="abcdef".split("").concat(i),l=[];h.indexOf("lo")>=0&&l.push("lo=e[k+n]");h.indexOf("hi")>=0&&l.push("hi=e[k+o]");return S.push(V.replace("_",l.join()).replace("$",h)),Function.apply(void 0,S)};var V="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13107:h=>{"use strict";h.exports=function(h,S){S<=4*V?i(0,S-1,h):J(0,S-1,h)};var V=32;function i(h,V,i){for(var S=2*(h+1),l=h+1;l<=V;++l){for(var Y=i[S++],g=i[S++],q=l,B=S-2;q-- >h;){var J=i[B-2],I=i[B-1];if(J<Y)break;if(J===Y&&I<g)break;i[B]=J,i[B+1]=I,B-=2}i[B]=Y,i[B+1]=g}}function S(h,V,i){V*=2;var S=i[h*=2],l=i[h+1];i[h]=i[V],i[h+1]=i[V+1],i[V]=S,i[V+1]=l}function l(h,V,i){V*=2,i[h*=2]=i[V],i[h+1]=i[V+1]}function Y(h,V,i,S){V*=2,i*=2;var l=S[h*=2],Y=S[h+1];S[h]=S[V],S[h+1]=S[V+1],S[V]=S[i],S[V+1]=S[i+1],S[i]=l,S[i+1]=Y}function g(h,V,i,S,l){V*=2,l[h*=2]=l[V],l[V]=i,l[h+1]=l[V+1],l[V+1]=S}function q(h,V,i){V*=2;var S=i[h*=2],l=i[V];return!(S<l)&&(S!==l||i[h+1]>i[V+1])}function B(h,V,i,S){var l=S[h*=2];return l<V||l===V&&S[h+1]<i}function J(h,I,v){var s=(I-h+1)/6|0,t=h+s,T=I-s,e=h+I>>1,n=e-s,c=e+s,f=t,P=n,L=e,U=c,X=T,D=h+1,O=I-1,o=0;q(f,P,v)&&(o=f,f=P,P=o),q(U,X,v)&&(o=U,U=X,X=o),q(f,L,v)&&(o=f,f=L,L=o),q(P,L,v)&&(o=P,P=L,L=o),q(f,U,v)&&(o=f,f=U,U=o),q(L,U,v)&&(o=L,L=U,U=o),q(P,X,v)&&(o=P,P=X,X=o),q(P,L,v)&&(o=P,P=L,L=o),q(U,X,v)&&(o=U,U=X,X=o);for(var M=v[2*P],F=v[2*P+1],E=v[2*U],H=v[2*U+1],j=2*f,m=2*L,G=2*X,w=2*t,N=2*e,r=2*T,k=0;k<2;++k){var R=v[j+k],Z=v[m+k],z=v[G+k];v[w+k]=R,v[N+k]=Z,v[r+k]=z}l(n,h,v),l(c,I,v);for(var d=D;d<=O;++d)if(B(d,M,F,v))d!==D&&S(d,D,v),++D;else if(!B(d,E,H,v))for(;;){if(B(O,E,H,v)){B(O,M,F,v)?(Y(d,D,O,v),++D,--O):(S(d,O,v),--O);break}if(--O<d)break}g(h,D-1,M,F,v),g(I,O+1,E,H,v),D-2-h<=V?i(h,D-2,v):J(h,D-2,v),I-(O+2)<=V?i(O+2,I,v):J(O+2,I,v),O-D<=V?i(D,O,v):J(D,O,v)}},13104:(h,V,i)=>{"use strict";h.exports={init:function(h){var V=l.nextPow2(h);B.length<V&&(S.free(B),B=S.mallocInt32(V));J.length<V&&(S.free(J),J=S.mallocInt32(V));I.length<V&&(S.free(I),I=S.mallocInt32(V));v.length<V&&(S.free(v),v=S.mallocInt32(V));s.length<V&&(S.free(s),s=S.mallocInt32(V));t.length<V&&(S.free(t),t=S.mallocInt32(V));var i=8*V;T.length<i&&(S.free(T),T=S.mallocDouble(i))},sweepBipartite:function(h,V,i,S,l,q,s,t,c,f){for(var P=0,L=2*h,U=h-1,X=L-1,D=i;D<S;++D){var O=q[D],o=L*D;T[P++]=l[o+U],T[P++]=-(O+1),T[P++]=l[o+X],T[P++]=O}for(D=s;D<t;++D){O=f[D]+g;var M=L*D;T[P++]=c[M+U],T[P++]=-O,T[P++]=c[M+X],T[P++]=O}var F=P>>>1;Y(T,F);var E=0,H=0;for(D=0;D<F;++D){var j=0|T[2*D+1];if(j>=g)e(I,v,H--,j=j-g|0);else if(j>=0)e(B,J,E--,j);else if(j<=-g){j=-j-g|0;for(var m=0;m<E;++m){if(void 0!==(G=V(B[m],j)))return G}n(I,v,H++,j)}else{j=-j-1|0;for(m=0;m<H;++m){var G;if(void 0!==(G=V(j,I[m])))return G}n(B,J,E++,j)}}},sweepComplete:function(h,V,i,S,l,g,q,c,f,P){for(var L=0,U=2*h,X=h-1,D=U-1,O=i;O<S;++O){var o=g[O]+1<<1,M=U*O;T[L++]=l[M+X],T[L++]=-o,T[L++]=l[M+D],T[L++]=o}for(O=q;O<c;++O){o=P[O]+1<<1;var F=U*O;T[L++]=f[F+X],T[L++]=1|-o,T[L++]=f[F+D],T[L++]=1|o}var E=L>>>1;Y(T,E);var H=0,j=0,m=0;for(O=0;O<E;++O){var G=0|T[2*O+1],w=1&G;if(O<E-1&&G>>1===T[2*O+3]>>1&&(w=2,O+=1),G<0){for(var N=-(G>>1)-1,r=0;r<m;++r){if(void 0!==(k=V(s[r],N)))return k}if(0!==w)for(r=0;r<H;++r){if(void 0!==(k=V(B[r],N)))return k}if(1!==w)for(r=0;r<j;++r){var k;if(void 0!==(k=V(I[r],N)))return k}0===w?n(B,J,H++,N):1===w?n(I,v,j++,N):2===w&&n(s,t,m++,N)}else{N=(G>>1)-1;0===w?e(B,J,H--,N):1===w?e(I,v,j--,N):2===w&&e(s,t,m--,N)}}},scanBipartite:function(h,V,i,S,l,q,I,v,s,t,c,f){var P=0,L=2*h,U=V,X=V+h,D=1,O=1;S?O=g:D=g;for(var o=l;o<q;++o){var M=o+D,F=L*o;T[P++]=I[F+U],T[P++]=-M,T[P++]=I[F+X],T[P++]=M}for(o=s;o<t;++o){M=o+O;var E=L*o;T[P++]=c[E+U],T[P++]=-M}var H=P>>>1;Y(T,H);var j=0;for(o=0;o<H;++o){var m=0|T[2*o+1];if(m<0){var G=!1;if((M=-m)>=g?(G=!S,M-=g):(G=!!S,M-=1),G)n(B,J,j++,M);else{var w=f[M],N=L*M,r=c[N+V+1],k=c[N+V+1+h];h:for(var R=0;R<j;++R){var Z=B[R],z=L*Z;if(!(k<I[z+V+1]||I[z+V+1+h]<r)){for(var d=V+2;d<h;++d)if(c[N+d+h]<I[z+d]||I[z+d+h]<c[N+d])continue h;var x,y=v[Z];if(void 0!==(x=S?i(w,y):i(y,w)))return x}}}}else e(B,J,j--,m-D)}},scanComplete:function(h,V,i,S,l,q,J,I,v,s,t){for(var e=0,n=2*h,c=V,f=V+h,P=S;P<l;++P){var L=P+g,U=n*P;T[e++]=q[U+c],T[e++]=-L,T[e++]=q[U+f],T[e++]=L}for(P=I;P<v;++P){L=P+1;var X=n*P;T[e++]=s[X+c],T[e++]=-L}var D=e>>>1;Y(T,D);var O=0;for(P=0;P<D;++P){var o=0|T[2*P+1];if(o<0){if((L=-o)>=g)B[O++]=L-g;else{var M=t[L-=1],F=n*L,E=s[F+V+1],H=s[F+V+1+h];h:for(var j=0;j<O;++j){var m=B[j],G=J[m];if(G===M)break;var w=n*m;if(!(H<q[w+V+1]||q[w+V+1+h]<E)){for(var N=V+2;N<h;++N)if(s[F+N+h]<q[w+N]||q[w+N+h]<s[F+N])continue h;var r=i(G,M);if(void 0!==r)return r}}}}else{for(L=o-g,j=O-1;j>=0;--j)if(B[j]===L){for(N=j+1;N<O;++N)B[N-1]=B[N];break}--O}}}};var S=i(13084),l=i(13089),Y=i(13107),g=1<<28,q=1024,B=S.mallocInt32(q),J=S.mallocInt32(q),I=S.mallocInt32(q),v=S.mallocInt32(q),s=S.mallocInt32(q),t=S.mallocInt32(q),T=S.mallocDouble(8192);function e(h,V,i,S){var l=V[S],Y=h[i-1];h[l]=Y,V[Y]=l}function n(h,V,i,S){h[i]=S,V[S]=i}},13093:h=>{"use strict";function V(h,i,S){var l=0|h[S];if(l<=0)return[];var Y,g=new Array(l);if(S===h.length-1)for(Y=0;Y<l;++Y)g[Y]=i;else for(Y=0;Y<l;++Y)g[Y]=V(h,i,S+1);return g}h.exports=function(h,i){switch("undefined"===typeof i&&(i=0),typeof h){case"number":if(h>0)return function(h,V){var i,S;for(i=new Array(h),S=0;S<h;++S)i[S]=V;return i}(0|h,i);break;case"object":if("number"===typeof h.length)return V(h,i,0)}return[]}},13046:(h,V,i)=>{h.exports=function(){var h=this;this.components={},this.comps=this.components;var V=this.components,i=1,l={},Y=[],g=[],q={timeout:!1,removals:[],multiComps:[]};function B(h,i){var S=V[i],Y=l[i],g=Y.hash[h];g&&(Y.remove(h),S.IV&&(S.multi?(g.forEach((V=>{V&&S.IV(h,V)})),g.length=0):S.IV(h,g)),q.removals.push(Y),J())}function J(){q.timeout||(q.timeout=!0,setTimeout(I,1))}function I(){q.timeout=!1,v()}function v(){q.multiComps.length&&function(h){for(var V=0;V<h.length;V++){var{entID:i,data:S}=h[V],l=S.hash[i];if(l){for(var Y=0;Y<l.length;Y++)l[Y]||(l.splice(Y,1),Y--);0===l.length&&(S.remove(i),q.removals.push(S))}}h.length=0}(q.multiComps),q.removals.length&&function(h){for(var V=0;V<h.length;V++){h[V].flush()}h.length=0}(q.removals)}this.QI=l,this._systems=Y,this._renderSystems=g,this.mJ=function(V){var S=i++;return Array.isArray(V)&&V.forEach((V=>h.nB(S,V))),S},this.deleteEntity=function(V){return Object.keys(l).forEach((h=>{l[h].hash[V]&&B(V,h)})),h},this.CJ=function(h){if(!h)throw new Error("Missing component definition");var i=h.name;if(!i)throw new Error("Component definition must have a name property.");if("string"!==typeof i)throw new Error("Component name must be a string.");if(""===i)throw new Error("Component name must be a non-empty string.");if(l[i])throw new Error(`Component ${i} already exists.`);var q={};return q.name=i,q.multi=!!h.multi,q.order=isNaN(h.order)?99:h.order,q.stateConstructor=h.stateConstructor||null,q.state=h.state||{},q.Xq=h.Xq||null,q.IV=h.IV||null,q.system=h.system||null,q.Eq=h.Eq||null,V[i]=q,l[i]=new S,l[i]._pendingMultiCleanup=!1,l[i]._multiCleanupIDs=q.multi?[]:null,q.system&&(Y.push(i),Y.sort(((h,i)=>V[h].order-V[i].order))),q.Eq&&(g.push(i),g.sort(((h,i)=>V[h].order-V[i].order))),i},this.overwriteComponent=function(h,i){var S=V[h];if(!S)throw new Error(`Unknown component: ${h}`);if(!i)throw new Error("Missing component definition");if(S.name!==i.name)throw new Error("Overwriting component must use the same name property.");var q={};q.name=h,q.multi=!!i.multi,q.order=isNaN(i.order)?99:i.order,q.state=i.state||{},q.Xq=i.Xq||null,q.IV=i.IV||null,q.system=i.system||null,q.Eq=i.Eq||null,V[h]=q,l[h]._pendingMultiCleanup=!1,l[h]._multiCleanupIDs=q.multi?[]:null;var B=Y.indexOf(h);q.system&&B<0&&Y.push(h),!q.system&&B>=0&&Y.splice(B,1),Y.sort(((h,i)=>V[h].order-V[i].order));var J=g.indexOf(h);q.Eq&&J<0&&g.push(h),!q.Eq&&J>=0&&g.splice(J,1),g.sort(((h,i)=>V[h].order-V[i].order));var I=q.state;return this.tJ(h).forEach((h=>{for(var V in I)V in h||(h[V]=I[V]);q.Xq&&q.Xq(h.Mq,h)})),h},this.deleteComponent=function(i){var S=l[i];if(!S)throw new Error(`Unknown component: ${i}`);S.flush(),S.list.forEach((h=>{h&&B(h.Mq||h[0].Mq,i)}));var q=Y.indexOf(i),J=g.indexOf(i);return q>-1&&Y.splice(q,1),J>-1&&g.splice(J,1),l[i].dispose(),delete l[i],delete V[i],h},this.nB=function(h,i,S){var Y,g=V[i],q=l[i];if(!q)throw new Error(`Unknown component: ${i}.`);if(q.hash[h]&&!g.multi)throw new Error(`Entity ${h} already has component: ${i}.`);if(g.stateConstructor){if(!(Y=new g.stateConstructor).hasOwnProperty("Mq"))throw new Error(`Component ${g.name} stateConstructor type does not have property __id`)}else Y=Object.assign({},{Mq:h},g.state,S);if(Y.Mq=h,g.multi){var B=q.hash[h];B||(B=[],q.add(h,B)),B.push(Y)}else q.add(h,Y);return g.Xq&&g.Xq(h,Y),this},this.MB=function(h,V){var i=l[V];if(!i)throw new Error(`Unknown component: ${V}.`);return!!i.hash[h]},this.LB=function(V,i){if(!l[i])throw new Error(`Unknown component: ${i}.`);return B(V,i),h},this.getState=function(h,V){var i=l[V];if(!i)throw new Error(`Unknown component: ${V}.`);return i.hash[h]},this.tJ=function(h){var V=l[h];if(!V)throw new Error(`Unknown component: ${h}.`);return v(),V.list},this.ws=function(h){if(!l[h])throw new Error(`Unknown component: ${h}.`);var V=l[h].hash;return h=>V[h]},this.ks=function(h){if(!l[h])throw new Error(`Unknown component: ${h}.`);var V=l[h].hash;return h=>!!V[h]},this.Bq=function(i){v();for(var S=0;S<Y.length;S++){var g=Y[S],q=V[g],B=l[g];q.system(i,B.list),v()}return h},this.render=function(i){v();for(var S=0;S<g.length;S++){var Y=g[S],q=V[Y],B=l[Y];q.Eq(i,B.list),v()}return h},this.removeMultiComponent=function(i,S,Y){var g=V[S],B=l[S];if(!B)throw new Error(`Unknown component: ${S}.`);if(!g.multi)throw new Error("removeMultiComponent called on non-multi component");return function(h,V,i,S){var l=i.hash[h];if(l){var Y=l[S];Y&&(l[S]=null,V.IV&&V.IV(h,Y),q.multiComps.push({entID:h,data:i}),J())}}(i,g,B,Y),h}};var S=i(13055)},13055:h=>{function V(h,V){var i=h._map[V];if(delete h.hash[V],delete h._map[V],i===h.list.length-1)h.list.pop();else{var S=h.list.pop();if(h.list[i]=S,null===S||null===S[0]){var l=h.list.length;for(var Y in h._map)if(h._map[Y]===l)return void(h._map[Y]=i)}else{var g=S.Mq||S[0].Mq;h._map[g]=i}}}h.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(h,V){if("number"===typeof this._map[h]){var i=this._map[h];this.hash[h]=V,this.list[i]=V}else this._map[h]=this.list.length,this.hash[h]=V,this.list.push(V)}remove(h){var V=this._map[h];this.hash[h]=null,this.list[V]=null,this._pendingRemovals.push(h)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var h=0;h<this._pendingRemovals.length;h++){var i=this._pendingRemovals[h];null===this.hash[i]&&V(this,i)}this._pendingRemovals.length=0}}},13010:h=>{"use strict";var V,i="object"===typeof Reflect?Reflect:null,S=function(h,V,i){return Function.prototype.apply.call(h,V,i)};V=i&&"function"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(h){return Object.getOwnPropertyNames(h).concat(Object.getOwnPropertySymbols(h))}:function(h){return Object.getOwnPropertyNames(h)};var l=Number.isNaN||function(h){return h!==h};function Y(){Y.init.call(this)}h.exports=Y,h.exports.once=function(h,V){return new Promise((function(i,S){function l(i){h.removeListener(V,Y),S(i)}function Y(){"function"===typeof h.removeListener&&h.removeListener("error",l),i([].slice.call(arguments))}e(h,V,Y,{once:!0}),"error"!==V&&function(h,V,i){"function"===typeof h.on&&e(h,"error",V,i)}(h,l,{once:!0})}))},Y.EventEmitter=Y,Y.prototype._events=void 0,Y.prototype._eventsCount=0,Y.prototype._maxListeners=void 0;var g=10;function q(h){if("function"!==typeof h)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof h)}function B(h){return void 0===h._maxListeners?Y.defaultMaxListeners:h._maxListeners}function J(h,V,i,S){var l,Y,g,J;if(q(i),void 0===(Y=h._events)?(Y=h._events=Object.create(null),h._eventsCount=0):(void 0!==Y.newListener&&(h.emit("newListener",V,i.listener?i.listener:i),Y=h._events),g=Y[V]),void 0===g)g=Y[V]=i,++h._eventsCount;else if("function"===typeof g?g=Y[V]=S?[i,g]:[g,i]:S?g.unshift(i):g.push(i),(l=B(h))>0&&g.length>l&&!g.warned){g.warned=!0;var I=new Error("Possible EventEmitter memory leak detected. "+g.length+" "+String(V)+" listeners added. Use emitter.setMaxListeners() to increase limit");I.name="MaxListenersExceededWarning",I.k=h,I.type=V,I.count=g.length,J=I,console&&console.warn&&console.warn(J)}return h}function I(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(h,V,i){var S={fired:!1,wrapFn:void 0,target:h,type:V,listener:i},l=I.bind(S);return l.listener=i,S.wrapFn=l,l}function s(h,V,i){var S=h._events;if(void 0===S)return[];var l=S[V];return void 0===l?[]:"function"===typeof l?i?[l.listener||l]:[l]:i?function(h){for(var V=new Array(h.length),i=0;i<V.length;++i)V[i]=h[i].listener||h[i];return V}(l):T(l,l.length)}function t(h){var V=this._events;if(void 0!==V){var i=V[h];if("function"===typeof i)return 1;if(void 0!==i)return i.length}return 0}function T(h,V){for(var i=new Array(V),S=0;S<V;++S)i[S]=h[S];return i}function e(h,V,i,S){if("function"===typeof h.on)S.once?h.once(V,i):h.on(V,i);else{if("function"!==typeof h.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof h);h.addEventListener(V,(function l(Y){S.once&&h.removeEventListener(V,l),i(Y)}))}}Object.defineProperty(Y,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(h){if("number"!==typeof h||h<0||l(h))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+h+".");g=h}}),Y.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Y.prototype.setMaxListeners=function(h){if("number"!==typeof h||h<0||l(h))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+h+".");return this._maxListeners=h,this},Y.prototype.getMaxListeners=function(){return B(this)},Y.prototype.emit=function(h){for(var V=[],i=1;i<arguments.length;i++)V.push(arguments[i]);var l="error"===h,Y=this._events;if(void 0!==Y)l=l&&void 0===Y.error;else if(!l)return!1;if(l){var g;if(V.length>0&&(g=V[0]),g instanceof Error)throw g;var q=new Error("Unhandled error."+(g?" ("+g.message+")":""));throw q.context=g,q}var B=Y[h];if(void 0===B)return!1;if("function"===typeof B)S(B,this,V);else{var J=B.length,I=T(B,J);for(i=0;i<J;++i)S(I[i],this,V)}return!0},Y.prototype.addListener=function(h,V){return J(this,h,V,!1)},Y.prototype.on=Y.prototype.addListener,Y.prototype.prependListener=function(h,V){return J(this,h,V,!0)},Y.prototype.once=function(h,V){return q(V),this.on(h,v(this,h,V)),this},Y.prototype.prependOnceListener=function(h,V){return q(V),this.prependListener(h,v(this,h,V)),this},Y.prototype.removeListener=function(h,V){var i,S,l,Y,g;if(q(V),void 0===(S=this._events))return this;if(void 0===(i=S[h]))return this;if(i===V||i.listener===V)0===--this._eventsCount?this._events=Object.create(null):(delete S[h],S.removeListener&&this.emit("removeListener",h,i.listener||V));else if("function"!==typeof i){for(l=-1,Y=i.length-1;Y>=0;Y--)if(i[Y]===V||i[Y].listener===V){g=i[Y].listener,l=Y;break}if(l<0)return this;0===l?i.shift():function(h,V){for(;V+1<h.length;V++)h[V]=h[V+1];h.pop()}(i,l),1===i.length&&(S[h]=i[0]),void 0!==S.removeListener&&this.emit("removeListener",h,g||V)}return this},Y.prototype.off=Y.prototype.removeListener,Y.prototype.removeAllListeners=function(h){var V,i,S;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[h]&&(0===--this._eventsCount?this._events=Object.create(null):delete i[h]),this;if(0===arguments.length){var l,Y=Object.keys(i);for(S=0;S<Y.length;++S)"removeListener"!==(l=Y[S])&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(V=i[h]))this.removeListener(h,V);else if(void 0!==V)for(S=V.length-1;S>=0;S--)this.removeListener(h,V[S]);return this},Y.prototype.listeners=function(h){return s(this,h,!0)},Y.prototype.rawListeners=function(h){return s(this,h,!1)},Y.listenerCount=function(h,V){return"function"===typeof h.listenerCount?h.listenerCount(V):t.call(h,V)},Y.prototype.listenerCount=t,Y.prototype.eventNames=function(){return this._eventsCount>0?V(this._events):[]}},13315:h=>{"use strict";h.exports=function(h,V,i,S,l,Y){var g=+V[0],q=+V[1],B=+V[2],J=+i[0],I=+i[1],v=+i[2],s=Math.sqrt(J*J+I*I+v*v);if(0===s)throw new Error("Can't raycast along a zero vector");return function(h,V,i,S,l,Y,g,q,B,J){for(var I=0,v=Math.floor,s=0|v(V),t=0|v(i),T=0|v(S),e=l>0?1:-1,n=Y>0?1:-1,c=g>0?1:-1,f=Math.abs(1/l),P=Math.abs(1/Y),L=Math.abs(1/g),U=f<1/0?f*(e>0?s+1-V:V-s):1/0,X=P<1/0?P*(n>0?t+1-i:i-t):1/0,D=L<1/0?L*(c>0?T+1-S:S-T):1/0,O=-1;I<=q;){var o=h(s,t,T);if(o)return B&&(B[0]=V+I*l,B[1]=i+I*Y,B[2]=S+I*g),J&&(J[0]=J[1]=J[2]=0,0===O&&(J[0]=-e),1===O&&(J[1]=-n),2===O&&(J[2]=-c)),o;U<X?U<D?(s+=e,I=U,U+=f,O=0):(T+=c,I=D,D+=L,O=2):X<D?(t+=n,I=X,X+=P,O=1):(T+=c,I=D,D+=L,O=2)}return B&&(B[0]=V+I*l,B[1]=i+I*Y,B[2]=S+I*g),J&&(J[0]=J[1]=J[2]=0),0}(h,g,q,B,J/=s,I/=s,v/=s,S="undefined"===typeof S?64:+S,l,Y)}},13344:(h,V,i)=>{"use strict";i.d(V,{b:()=>Y});var S=i(13010);function l(){this.Gv=!1,this.stopPropagation=!1,this.wv=!1,this.disabled=!1}class Y{constructor(h,V){this.version="0.7.0";var i=Object.assign({},new l,V||{});this.element=h||document,this.Gv=!!i.Gv,this.stopPropagation=!!i.stopPropagation,this.wv=!!i.wv,this.disabled=!!i.disabled,this.filterEvents=(h,V)=>!0,this.down=new S.EventEmitter,this.up=new S.EventEmitter,this.state={},this.qJ={dx:0,dy:0,Ds:0,gJ:0,Os:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?q(this):document.addEventListener("DOMContentLoaded",(h=>{q(this)}),{once:!0})}bind(h){for(var V=arguments.length,i=new Array(V>1?V-1:0),S=1;S<V;S++)i[S-1]=arguments[S];i.forEach((V=>{var i=this._keyBindmap[V]||[];i.includes(h)||(i.push(h),this._keyBindmap[V]=i)})),this.state[h]=!!this.state[h],this.pressCount[h]=this.pressCount[h]||0,this.releaseCount[h]=this.releaseCount[h]||0}unbind(h){for(var V in this._keyBindmap){var i=this._keyBindmap[V],S=i.indexOf(h);S>-1&&i.splice(S,1)}}getBindings(){var h={};for(var V in this._keyBindmap){this._keyBindmap[V].forEach((i=>{h[i]=h[i]||[],h[i].push(V)}))}return h}Bq(){g(this.qJ),g(this.pressCount),g(this.releaseCount)}}function g(h){for(var V in h)h[V]=0}function q(h){window.addEventListener("keydown",T.bind(null,h,!0),!1),window.addEventListener("keyup",T.bind(null,h,!1),!1);var V={passive:!0};h.element.addEventListener("touchstart",v.bind(void 0,h),{passive:!1}),h.element.addEventListener("touchend",t.bind(void 0,h),V),h.element.addEventListener("mousedown",e.bind(null,h,!0),V),window.document.addEventListener("mouseup",e.bind(null,h,!1),V),h.element.addEventListener("touchmove",n.bind(null,h),V),h.element.addEventListener("mousemove",n.bind(null,h),V),window.PointerEvent,h.element.addEventListener("wheel",c.bind(null,h),V),h.element.addEventListener("contextmenu",f.bind(null,h),!1),window.addEventListener("blur",P.bind(null,h),!1)}var B=0,J=0,I=null;function v(h,V){V.preventDefault(),s(V)}function s(h){let V=!1;for(let i=0;i<h.touches.length;++i)if(h.touches[i].identifier===I){V=!0;break}if(!V){const V=h.changedTouches[0];B=V.clientX,J=V.clientY,I=V.identifier}}function t(h,V){for(var i=V.changedTouches,S=0;S<i.length;++S)i[S].identifier===I&&(I=null)}function T(h,V,i){L(i.code,V,h,i)}function e(h,V,i){if("pointerId"in i)if(V){if(null!==h._touches.currID)return;h._touches.currID=i.pointerId}else{if(h._touches.currID!==i.pointerId)return;h._touches.currID=null}return L("Mouse"+("button"in i?i.button+1:1),V,h,i),!1}function n(h,V){var i=V.movementX||V.mozMovementX||0,S=V.movementY||V.mozMovementY||0;if(V.touches&&0===(i|S)){var l=function(h){s(h);for(let V=0;V<h.changedTouches.length;++V)if(h.changedTouches[V].identifier==I){const i=h.changedTouches[V],S=[i.clientX-B,i.clientY-J];return B=i.clientX,J=i.clientY,S}return console.error(`Did not find touch id ${I}`),[0,0]}(V);i=l[0],S=l[1]}h.qJ.dx+=i,h.qJ.dy+=S}function c(h,V){var i=1;switch(V.deltaMode){case 0:i=1;break;case 1:i=12;break;case 2:i=h.element.clientHeight||window.innerHeight}h.qJ.Ds+=(V.deltaX||0)*i,h.qJ.gJ+=(V.deltaY||0)*i,h.qJ.Os+=(V.deltaZ||0)*i}function f(h,V){if(!h.wv)return V.preventDefault(),!1}function P(h){for(var V in h._keyStates)h._keyStates[V]&&(/^Mouse\d/.test(V)||L(V,!1,h,{code:V,note:"yc5ptuwiz6f",preventDefault:()=>{},stopPropagation:()=>{}}))}function L(h,V,i,S){var l=i._keyBindmap[h];l&&(U(i._keyStates[h],V)&&(i._keyStates[h]=V,l.forEach((h=>{(!i.filterEvents||i.filterEvents(S,h))&&function(h,V,i,S){var l=V?i.pressCount:i.releaseCount;l[h]=(l[h]||0)+1;var Y=i._bindPressCount[h]||0;(Y+=V?1:-1)<0&&(Y=0);i._bindPressCount[h]=Y;var g=i.state[h];if(U(g,Y)){i.state[h]=Y>0;var q=V?i.down:i.up;i.disabled||q.emit(h,S)}}(h,V,i,S)}))),"button"in S||(i.Gv&&!S.defaultPrevented&&S.preventDefault(),i.stopPropagation&&S.stopPropagation()))}function U(h,V){return h?!V:V}},11993:h=>{h.exports=function(h,V,i){return h[0]=V[0]+i[0],h[1]=V[1]+i[1],h[2]=V[2]+i[2],h}},11947:(h,V,i)=>{h.exports=function(h,V){var i=S(h[0],h[1],h[2]),g=S(V[0],V[1],V[2]);l(i,i),l(g,g);var q=Y(i,g);return q>1?0:Math.acos(q)};var S=i(11953),l=i(11962),Y=i(11969)},12035:h=>{h.exports=function(h,V){return h[0]=Math.ceil(V[0]),h[1]=Math.ceil(V[1]),h[2]=Math.ceil(V[2]),h}},11943:h=>{h.exports=function(h){var V=new Float32Array(3);return V[0]=h[0],V[1]=h[1],V[2]=h[2],V}},11972:h=>{h.exports=function(h,V){return h[0]=V[0],h[1]=V[1],h[2]=V[2],h}},11936:h=>{h.exports=function(){var h=new Float32Array(3);return h[0]=0,h[1]=0,h[2]=0,h}},12097:h=>{h.exports=function(h,V,i){var S=V[0],l=V[1],Y=V[2],g=i[0],q=i[1],B=i[2];return h[0]=l*B-Y*q,h[1]=Y*g-S*B,h[2]=S*q-l*g,h}},12058:(h,V,i)=>{h.exports=i(12055)},12055:h=>{h.exports=function(h,V){var i=V[0]-h[0],S=V[1]-h[1],l=V[2]-h[2];return Math.sqrt(i*i+S*S+l*l)}},12016:(h,V,i)=>{h.exports=i(12010)},12010:h=>{h.exports=function(h,V,i){return h[0]=V[0]/i[0],h[1]=V[1]/i[1],h[2]=V[2]/i[2],h}},11969:h=>{h.exports=function(h,V){return h[0]*V[0]+h[1]*V[1]+h[2]*V[2]}},11934:h=>{h.exports=1e-6},11976:(h,V,i)=>{h.exports=function(h,V){var i=h[0],l=h[1],Y=h[2],g=V[0],q=V[1],B=V[2];return Math.abs(i-g)<=S*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(l-q)<=S*Math.max(1,Math.abs(l),Math.abs(q))&&Math.abs(Y-B)<=S*Math.max(1,Math.abs(Y),Math.abs(B))};var S=i(11934)},11984:h=>{h.exports=function(h,V){return h[0]===V[0]&&h[1]===V[1]&&h[2]===V[2]}},12029:h=>{h.exports=function(h,V){return h[0]=Math.floor(V[0]),h[1]=Math.floor(V[1]),h[2]=Math.floor(V[2]),h}},12149:(h,V,i)=>{h.exports=function(h,V,i,l,Y,g){var q,B;V||(V=3);i||(i=0);B=l?Math.min(l*V+i,h.length):h.length;for(q=i;q<B;q+=V)S[0]=h[q],S[1]=h[q+1],S[2]=h[q+2],Y(S,S,g),h[q]=S[0],h[q+1]=S[1],h[q+2]=S[2];return h};var S=i(11936)()},11953:h=>{h.exports=function(h,V,i){var S=new Float32Array(3);return S[0]=h,S[1]=V,S[2]=i,S}},11932:(h,V,i)=>{h.exports={EPSILON:i(11934),create:i(11936),clone:i(11943),angle:i(11947),ag:i(11953),j:i(11972),set:i(11974),equals:i(11976),exactEquals:i(11984),add:i(11993),cV:i(11998),sub:i(12002),multiply:i(12005),mul:i(12007),divide:i(12010),div:i(12016),min:i(12021),max:i(12024),floor:i(12029),ceil:i(12035),round:i(12039),scale:i(12044),hq:i(12052),distance:i(12055),i:i(12058),squaredDistance:i(12061),sqrDist:i(12063),length:i(12065),len:i(12070),squaredLength:i(12074),Vq:i(12078),negate:i(12083),inverse:i(12092),normalize:i(11962),dot:i(11969),cross:i(12097),Cg:i(12103),random:i(12110),transformMat4:i(12112),transformMat3:i(12119),transformQuat:i(12124),iq:i(12128),Sq:i(12133),lq:i(12141),forEach:i(12149)}},12092:h=>{h.exports=function(h,V){return h[0]=1/V[0],h[1]=1/V[1],h[2]=1/V[2],h}},12070:(h,V,i)=>{h.exports=i(12065)},12065:h=>{h.exports=function(h){var V=h[0],i=h[1],S=h[2];return Math.sqrt(V*V+i*i+S*S)}},12103:h=>{h.exports=function(h,V,i,S){var l=V[0],Y=V[1],g=V[2];return h[0]=l+S*(i[0]-l),h[1]=Y+S*(i[1]-Y),h[2]=g+S*(i[2]-g),h}},12024:h=>{h.exports=function(h,V,i){return h[0]=Math.max(V[0],i[0]),h[1]=Math.max(V[1],i[1]),h[2]=Math.max(V[2],i[2]),h}},12021:h=>{h.exports=function(h,V,i){return h[0]=Math.min(V[0],i[0]),h[1]=Math.min(V[1],i[1]),h[2]=Math.min(V[2],i[2]),h}},12007:(h,V,i)=>{h.exports=i(12005)},12005:h=>{h.exports=function(h,V,i){return h[0]=V[0]*i[0],h[1]=V[1]*i[1],h[2]=V[2]*i[2],h}},12083:h=>{h.exports=function(h,V){return h[0]=-V[0],h[1]=-V[1],h[2]=-V[2],h}},11962:h=>{h.exports=function(h,V){var i=V[0],S=V[1],l=V[2],Y=i*i+S*S+l*l;Y>0&&(Y=1/Math.sqrt(Y),h[0]=V[0]*Y,h[1]=V[1]*Y,h[2]=V[2]*Y);return h}},12110:h=>{h.exports=function(h,V){V=V||1;var i=2*Math.random()*Math.PI,S=2*Math.random()-1,l=Math.sqrt(1-S*S)*V;return h[0]=Math.cos(i)*l,h[1]=Math.sin(i)*l,h[2]=S*V,h}},12128:h=>{h.exports=function(h,V,i,S){var l=i[1],Y=i[2],g=V[1]-l,q=V[2]-Y,B=Math.sin(S),J=Math.cos(S);return h[0]=V[0],h[1]=l+g*J-q*B,h[2]=Y+g*B+q*J,h}},12133:h=>{h.exports=function(h,V,i,S){var l=i[0],Y=i[2],g=V[0]-l,q=V[2]-Y,B=Math.sin(S),J=Math.cos(S);return h[0]=l+q*B+g*J,h[1]=V[1],h[2]=Y+q*J-g*B,h}},12141:h=>{h.exports=function(h,V,i,S){var l=i[0],Y=i[1],g=V[0]-l,q=V[1]-Y,B=Math.sin(S),J=Math.cos(S);return h[0]=l+g*J-q*B,h[1]=Y+g*B+q*J,h[2]=V[2],h}},12039:h=>{h.exports=function(h,V){return h[0]=Math.round(V[0]),h[1]=Math.round(V[1]),h[2]=Math.round(V[2]),h}},12044:h=>{h.exports=function(h,V,i){return h[0]=V[0]*i,h[1]=V[1]*i,h[2]=V[2]*i,h}},12052:h=>{h.exports=function(h,V,i,S){return h[0]=V[0]+i[0]*S,h[1]=V[1]+i[1]*S,h[2]=V[2]+i[2]*S,h}},11974:h=>{h.exports=function(h,V,i,S){return h[0]=V,h[1]=i,h[2]=S,h}},12063:(h,V,i)=>{h.exports=i(12061)},12078:(h,V,i)=>{h.exports=i(12074)},12061:h=>{h.exports=function(h,V){var i=V[0]-h[0],S=V[1]-h[1],l=V[2]-h[2];return i*i+S*S+l*l}},12074:h=>{h.exports=function(h){var V=h[0],i=h[1],S=h[2];return V*V+i*i+S*S}},12002:(h,V,i)=>{h.exports=i(11998)},11998:h=>{h.exports=function(h,V,i){return h[0]=V[0]-i[0],h[1]=V[1]-i[1],h[2]=V[2]-i[2],h}},12119:h=>{h.exports=function(h,V,i){var S=V[0],l=V[1],Y=V[2];return h[0]=S*i[0]+l*i[3]+Y*i[6],h[1]=S*i[1]+l*i[4]+Y*i[7],h[2]=S*i[2]+l*i[5]+Y*i[8],h}},12112:h=>{h.exports=function(h,V,i){var S=V[0],l=V[1],Y=V[2],g=i[3]*S+i[7]*l+i[11]*Y+i[15];return g=g||1,h[0]=(i[0]*S+i[4]*l+i[8]*Y+i[12])/g,h[1]=(i[1]*S+i[5]*l+i[9]*Y+i[13])/g,h[2]=(i[2]*S+i[6]*l+i[10]*Y+i[14])/g,h}},12124:h=>{h.exports=function(h,V,i){var S=V[0],l=V[1],Y=V[2],g=i[0],q=i[1],B=i[2],J=i[3],I=J*S+q*Y-B*l,v=J*l+B*S-g*Y,s=J*Y+g*l-q*S,t=-g*S-q*l-B*Y;return h[0]=I*J+t*-g+v*-B-s*-q,h[1]=v*J+t*-q+s*-g-I*-B,h[2]=s*J+t*-B+I*-q-v*-g,h}},13039:h=>{"use strict";h.exports=function(h){for(var V=new Array(h),i=0;i<h;++i)V[i]=i;return V}},13098:h=>{h.exports=function(h){return null!=h&&null!=h.constructor&&"function"===typeof h.constructor.isBuffer&&h.constructor.isBuffer(h)}},13319:(h,V,i)=>{"use strict";i.d(V,{b:()=>S});class S{constructor(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.TI=!1,this.eI=!1,this.sI=30,this.tI=0,this.OI=!1,this.fullscreen=!1,this.cI=function(h){},this.fI=function(){},this.XI=function(){},this.hg=function(){},this.LI=function(h){},this.onFullscreenChanged=function(h){},J((()=>{!function(h,V){h._nowObject=performance||Date,h._lastTick=0,h._renderAccum=0,h._rt=0,h._frameCB=q.bind(null,h),requestAnimationFrame(h._frameCB),V>0&&(h._intervalCB=g.bind(null,h),h._interval=setInterval(h._intervalCB,Math.max(V,1e3/h.sI/2)))}(this,V),function(h,V){if(!V)return;var i=!1,S=!1;document.addEventListener("pointerlockchange",(S=>{i=document.pointerLockElement===V,h.LI(i)})),document.addEventListener("fullscreenchange",(i=>{S=document.fullscreenElement===V,h.onFullscreenChanged(S)})),Object.defineProperty(h,"OI",{get:()=>i,set:h=>{h&&!i?B(V):i&&!h&&function(h){h.exitPointerLock&&h.exitPointerLock()}(document)}}),Object.defineProperty(h,"fullscreen",{get:()=>S,set:h=>{h&&!S?V.requestFullscreen():S&&!h&&document.exitFullscreen()}}),V.addEventListener("click",(l=>{h.TI&&!i&&B(V),h.eI&&!S&&V.requestFullscreen()}));var l=()=>h.hg();if(window.ResizeObserver){new ResizeObserver(l).observe(V)}else window.addEventListener("resize",l)}(this,h),this.XI()}))}}var l=3,Y=20;function g(h){for(var V=1e3/h.sI,i=h._nowObject.now()+Y,S=0;h._nowObject.now()>=h._lastTick+V&&h._nowObject.now()<i&&++S<=l;)h.cI(V),h._lastTick+=V;var g=5*(V+5),q=h._nowObject.now();if(q-h._lastTick>g)for(;q>=h._lastTick+V;)h._lastTick+=V}function q(h){requestAnimationFrame(h._frameCB),g(h);var V=h._nowObject.now(),i=V-h._rt;if(h._rt=V,h.tI>0){h._renderAccum+=i;var S=1e3/h.tI;if(h._renderAccum<S)return;h._renderAccum=Math.min(h._renderAccum-S,S)}var l=1e3/h.sI,Y=(V-h._lastTick)/l;h.fI(i,Y,l)}function B(h){h.requestPointerLock&&h.requestPointerLock()}var J=h=>{if("loading"===document.readyState){var V=()=>{document.removeEventListener("readystatechange",V),h()};document.addEventListener("readystatechange",V)}else setTimeout(h,1)}},13036:(h,V,i)=>{var S=i(13039),l=i(13041),Y="undefined"!==typeof Float64Array;function g(h,V){return h[0]-V[0]}function q(){var h,V=this.stride,i=new Array(V.length);for(h=0;h<i.length;++h)i[h]=[Math.abs(V[h]),h];i.sort(g);var S=new Array(i.length);for(h=0;h<S.length;++h)S[h]=i[h][1];return S}function B(h,V){var i=["View",V,"d",h].join("");V<0&&(i="View_Nil"+h);var l="generic"===h;if(-1===V){var Y="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+h+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(Y)()}if(0===V){Y="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+h+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(l?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(l?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}";return new Function("TrivialArray",Y)(J[h][0])}Y=["'use strict'"];var g=S(V),B=g.map((function(h){return"i"+h})),I="this.offset+"+g.map((function(h){return"this.stride["+h+"]*i"+h})).join("+"),v=g.map((function(h){return"b"+h})).join(","),s=g.map((function(h){return"c"+h})).join(",");Y.push("function "+i+"(a,"+v+","+s+",d){this.data=a","this.shape=["+v+"]","this.stride=["+s+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+h+"'","proto.dimension="+V),Y.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+g.map((function(h){return"this.shape["+h+"]"})).join("*"),"}})"),1===V?Y.push("proto.order=[0]"):(Y.push("Object.defineProperty(proto,'order',{get:"),V<4?(Y.push("function "+i+"_order(){"),2===V?Y.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===V&&Y.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):Y.push("ORDER})")),Y.push("proto.set=function "+i+"_set("+B.join(",")+",v){"),l?Y.push("return this.data.set("+I+",v)}"):Y.push("return this.data["+I+"]=v}"),Y.push("proto.get=function "+i+"_get("+B.join(",")+"){"),l?Y.push("return this.data.get("+I+")}"):Y.push("return this.data["+I+"]}"),Y.push("proto.index=function "+i+"_index(",B.join(),"){return "+I+"}"),Y.push("proto.hi=function "+i+"_hi("+B.join(",")+"){return new "+i+"(this.data,"+g.map((function(h){return["(typeof i",h,"!=='number'||i",h,"<0)?this.shape[",h,"]:i",h,"|0"].join("")})).join(",")+","+g.map((function(h){return"this.stride["+h+"]"})).join(",")+",this.offset)}");var t=g.map((function(h){return"a"+h+"=this.shape["+h+"]"})),T=g.map((function(h){return"c"+h+"=this.stride["+h+"]"}));Y.push("proto.lo=function "+i+"_lo("+B.join(",")+"){var b=this.offset,d=0,"+t.join(",")+","+T.join(","));for(var e=0;e<V;++e)Y.push("if(typeof i"+e+"==='number'&&i"+e+">=0){d=i"+e+"|0;b+=c"+e+"*d;a"+e+"-=d}");Y.push("return new "+i+"(this.data,"+g.map((function(h){return"a"+h})).join(",")+","+g.map((function(h){return"c"+h})).join(",")+",b)}"),Y.push("proto.step=function "+i+"_step("+B.join(",")+"){var "+g.map((function(h){return"a"+h+"=this.shape["+h+"]"})).join(",")+","+g.map((function(h){return"b"+h+"=this.stride["+h+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(e=0;e<V;++e)Y.push("if(typeof i"+e+"==='number'){d=i"+e+"|0;if(d<0){c+=b"+e+"*(a"+e+"-1);a"+e+"=ceil(-a"+e+"/d)}else{a"+e+"=ceil(a"+e+"/d)}b"+e+"*=d}");Y.push("return new "+i+"(this.data,"+g.map((function(h){return"a"+h})).join(",")+","+g.map((function(h){return"b"+h})).join(",")+",c)}");var n=new Array(V),c=new Array(V);for(e=0;e<V;++e)n[e]="a[i"+e+"]",c[e]="b[i"+e+"]";Y.push("proto.transpose=function "+i+"_transpose("+B+"){"+B.map((function(h,V){return h+"=("+h+"===undefined?"+V+":"+h+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+n.join(",")+","+c.join(",")+",this.offset)}"),Y.push("proto.pick=function "+i+"_pick("+B+"){var a=[],b=[],c=this.offset");for(e=0;e<V;++e)Y.push("if(typeof i"+e+"==='number'&&i"+e+">=0){c=(c+this.stride["+e+"]*i"+e+")|0}else{a.push(this.shape["+e+"]);b.push(this.stride["+e+"])}");return Y.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),Y.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+g.map((function(h){return"shape["+h+"]"})).join(",")+","+g.map((function(h){return"stride["+h+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",Y.join("\n"))(J[h],q)}var J={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};h.exports=function(h,V,i,S){if(void 0===h)return(0,J.array[0])([]);"number"===typeof h&&(h=[h]),void 0===V&&(V=[h.length]);var g=V.length;if(void 0===i){i=new Array(g);for(var q=g-1,I=1;q>=0;--q)i[q]=I,I*=V[q]}if(void 0===S){S=0;for(q=0;q<g;++q)i[q]<0&&(S-=(V[q]-1)*i[q])}for(var v=function(h){if(l(h))return"buffer";if(Y)switch(Object.prototype.toString.call(h)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(h)?"array":"generic"}(h),s=J[v];s.length<=g+1;)s.push(B(v,s.length-1));return(0,s[g+1])(h,V,i,S)}},13041:h=>{function V(h){return!!h.constructor&&"function"===typeof h.constructor.isBuffer&&h.constructor.isBuffer(h)}h.exports=function(h){return null!=h&&(V(h)||function(h){return"function"===typeof h.readFloatLE&&"function"===typeof h.slice&&V(h.slice(0,0))}(h)||!!h._isBuffer)}},13182:h=>{"use strict";var V=[],i=[],S=[],l=[],Y=[],g=[],q=[],B=[],J=[],I=[],v=[],s=[];h.exports=function(h,t,T,e,n,c){for(var f=q,P=J,L=I,U=s,X=0;X<3;X++)f[X]=+T[X],L[X]=+t.max[X],P[X]=+t.base[X];c||(c=1e-10);var D=function(h,q,J,I,s,t){var T=V,e=i,n=S,c=l,f=Y,P=g,L=B,U=Math.floor,X=0,D=0,O=0,o=0,M=0;if(F(),0===O)return 0;for(o=j();D<=O;){if(E(o)&&H())return X;o=j()}for(X+=O,M=0;M<3;M++)I[M]+=J[M],s[M]+=J[M];return X;function F(){if(D=0,0!==(O=Math.sqrt(J[0]*J[0]+J[1]*J[1]+J[2]*J[2])))for(var h=0;h<3;h++){var V=J[h]>=0;c[h]=V?1:-1;var i=V?s[h]:I[h];T[h]=V?I[h]:s[h],e[h]=m(i,c[h]),n[h]=G(T[h],c[h]),L[h]=J[h]/O,f[h]=Math.abs(1/L[h]);var S=V?e[h]+1-i:i-e[h];P[h]=f[h]<1/0?f[h]*S:1/0}}function E(V){for(var i=c[0],S=0===V?e[0]:n[0],l=e[0]+i,Y=c[1],g=1===V?e[1]:n[1],q=e[1]+Y,B=c[2],J=2===V?e[2]:n[2],I=e[2]+B,v=S;v!=l;v+=i)for(var s=g;s!=q;s+=Y)for(var t=J;t!=I;t+=B)if(h(v,s,t))return!0;return!1}function H(){X+=D;var h=c[o],V=D/O,i=v;for(M=0;M<3;M++){var S=J[M]*V;I[M]+=S,s[M]+=S,i[M]=J[M]-S}if(h>0?s[o]=Math.round(s[o]):I[o]=Math.round(I[o]),q(X,o,h,i))return!0;for(M=0;M<3;M++)J[M]=i[M];return F(),0===O}function j(){var h=P[0]<P[1]?P[0]<P[2]?0:2:P[1]<P[2]?1:2,V=P[h]-D;for(D=P[h],e[h]+=c[h],P[h]+=f[h],M=0;M<3;M++)T[M]+=V*L[M],n[M]=G(T[M],c[M]);return h}function m(h,V){return U(h-V*t)}function G(h,V){return U(h+V*t)}}(h,e,f,P,L,c);if(!n){for(X=0;X<3;X++)U[X]=T[X]>0?L[X]-t.max[X]:P[X]-t.base[X];t.translate(U)}return D}},13352:(h,V,i)=>{"use strict";i.d(V,{d:()=>v});var S=i(13173),l=i(11932);class Y{constructor(h,V,i,Y,g,q,B){this.sJ=new S(h.base,h.EJ),this.DS=V,this.friction=i,this.restitution=Y,this.wg=g,this.As=q,this.rg=!!B,this.FJ=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.wt=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.xB=l.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=l.create(),this._impulses=l.create(),this._sleepFrameCount=10}loadFromCopy(h){l.j(this.sJ.base,h.sJ.base),l.j(this.sJ.EJ,h.sJ.EJ),l.j(this.sJ.max,h.sJ.max),this.sJ.mag=h.sJ.mag,this.DS=h.DS,this.friction=h.friction,this.restitution=h.restitution,this.wg=h.wg,this.As=h.As,this.rg=h.rg,this.FJ=h.FJ,this.fluidDrag=h.fluidDrag,this.wt=h.wt,this.preventFallOffEdge=h.preventFallOffEdge,this.rolledBackLastTick=h.rolledBackLastTick,l.j(this.xB,h.xB),l.j(this.resting,h.resting),this.inFluid=h.inFluid,this._ratioInFluid=h._ratioInFluid,l.j(this._forces,h._forces),l.j(this._impulses,h._impulses),this._sleepFrameCount=h._sleepFrameCount}setPosition(h){g(h),l.cV(h,h,this.sJ.base),this.sJ.translate(h),this.AB()}lg(){return l.clone(this.sJ.base)}applyForce(h){g(h),l.add(this._forces,this._forces,h),this.AB()}applyImpulse(h){g(h),l.add(this._impulses,this._impulses,h),this.AB()}AB(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var g=h=>{};var q=i(13173),B=i(11932),J=i(13182);function I(){this.FJ=.1,this.fluidDrag=.4,this.Qg=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function v(h,V,i){h=Object.assign(new I,h),this.gravity=h.gravity||[0,-10,0],this.FJ=h.FJ||.1,this.Qg=h.Qg||2,this.fluidDrag=h.fluidDrag||.4,this.minBounceImpulse=h.minBounceImpulse,this.bodies=[],this.ts=h.ts,this.testSolid=V,this.testFluid=i}v.prototype.ht=function(h,V,i,S,l,g){h=h||new q([0,0,0],[1,1,1]),"undefined"==typeof V&&(V=1),"undefined"==typeof i&&(i=1),"undefined"==typeof S&&(S=0),"undefined"==typeof l&&(l=1);var B=new Y(h,V,i,S,l,g);return this.bodies.push(B),B},v.prototype.Vt=function(h){var V=this.bodies.indexOf(h);V<0||(this.bodies.splice(V,1),h.sJ=h.As=null)};var s=B.create(),t=B.create(),T=B.create(),e=B.create(),n=B.create(),c=B.create(),f=B.create(),P=new q([0,0,0],[1,1,1]),L=new Y(P,1,1,0,1,(()=>{}),!1);function U(h,V,i){return V=i,V*=1-(1-h.ratioInFluid)**2}v.prototype.Bq=function(h){h/=1e3;var V=R(0,B.squaredLength(this.gravity));this.bodies.forEach((i=>function(h,V,i,S){B.j(n,V.resting),h.ts&&L.loadFromCopy(V);if(V.DS<=0)return B.set(V.xB,0,0,0),B.set(V._forces,0,0,0),void B.set(V._impulses,0,0,0);var l=S||0===V.wg;if(function(h,V,i,S){if(V._sleepFrameCount>0)return!1;if(S)return!0;var l=!1,Y=.5*i*i*V.wg;return B.scale(k,h.gravity,Y),J(h.testSolid,V.sJ,k,(function(){return l=!0,!0}),!0),l}(h,V,i,l))return;V._sleepFrameCount--,function(h,V){var i=V.sJ,S=Math.floor(i.base[0]),l=Math.floor(i.base[2]),Y=Math.floor(i.base[1]),g=Math.floor(i.max[1]);if(!h.testFluid(S,Y,l))return V.inFluid=!1,void(V.ratioInFluid=0);var q=1,J=Y+1;for(;J<=g&&h.testFluid(S,J,l);)q++,J++;var I=(Y+q-i.base[1])/i.EJ[1];I>1&&(I=1);var v=i.EJ[0]*i.EJ[1]*i.EJ[2]*I,s=D;B.scale(s,h.gravity,-h.Qg*v*V.wg),V.applyForce(s),V.inFluid=!0,V.ratioInFluid=I}(h,V),z(V._forces),z(V._impulses),z(V.xB),z(V.resting),B.scale(s,V._forces,1/V.DS),B.hq(s,s,h.gravity,V.wg),B.scale(t,V._impulses,1/V.DS),B.hq(t,t,s,i),B.add(V.xB,V.xB,t),V.friction&&(O(h,0,V,t,i),O(h,1,V,t,i),O(h,2,V,t,i));var Y=V.fluidDrag>=0?V.fluidDrag:h.fluidDrag,g=V.FJ>=0?V.FJ:h.FJ,q=g,I=g;V.inFluid&&(q=U(V,q,V.fluidDragHoriz>=0?V.fluidDragHoriz:Y),I=U(V,I,V.fluidDragVert>=0?V.fluidDragVert:Y));q=Math.max(1-q*i/V.DS,0),I=Math.max(1-I*i/V.DS,0),B.set(X,q,I,q),B.multiply(V.xB,V.xB,X),B.scale(T,V.xB,i),B.set(V._forces,0,0,0),B.set(V._impulses,0,0,0),V.rg&&Z(F,V.sJ);B.j(c,T),B.set(f,0,0,0),V.preventFallOffEdge&&function(h,V,i,S){if(!V.resting[1]||i[1]>0)return;var l=w;Z(l,V.sJ);for(var Y=0;Y<3;Y+=2){B.set(G,0,0,0),G[Y]=i[Y];var g=!0;(g=(g=(g=(g=g&&!r(h,l.base[0]+G[0]+1e-5,l.base[1],l.base[2]+G[2]+1e-5))&&!r(h,l.max[0]+G[0]-1e-5,l.base[1],l.base[2]+G[2]+1e-5))&&!r(h,l.base[0]+G[0]+1e-5,l.base[1],l.max[2]+G[2]-1e-5))&&!r(h,l.max[0]+G[0]-1e-5,l.base[1],l.max[2]+G[2]-1e-5))?(S[Y]=i[Y]>0?1:-1,i[Y]=0):0===Y&&(B.set(N,i[0],0,0),M(h,l,N,S,V.slideOnCollision))}}(h,V,T,f);M(h,V.sJ,T,V.resting,V.slideOnCollision),V.rg&&function(h,V,i,S){if(V.resting[1]>=0&&!V.inFluid)return;var l=0!==V.resting[0],Y=0!==V.resting[2];if(!l&&!Y)return;var g=Math.abs(S[0]/S[2]),q=4;if(!l&&g>q)return;if(!Y&&g<1/q)return;B.add(H,i.base,S);var I=h.testSolid;J(I,i,S,(function(h,V,i,S){if(1!==V)return!0;S[V]=0}));var v=i.base[1],s=V.inFluid?1.951:1.001,t=Math.floor(v+s)-v;B.set(j,0,t,0);var T=!1;if(J(I,i,j,(function(h,V,i,S){return T=!0,!0})),T)return;B.cV(m,H,i.base),m[1]=0,M(h,i,m,E,!0);var e=R(i.base[0],H[0]),n=R(i.base[2],H[2]);if(l&&!e&&(!n||!Y))return;if(Y&&(!e||!l)&&!n)return;var c=!0;if(c=c&&!r(h,i.base[0]+1e-5,i.base[1],i.base[2]+1e-5),c=c&&!r(h,i.max[0]-1e-5,i.base[1],i.base[2]+1e-5),c=c&&!r(h,i.base[0]+1e-5,i.base[1],i.max[2]-1e-5),c=c&&!r(h,i.max[0]-1e-5,i.base[1],i.max[2]-1e-5),c)return;Z(V.sJ,i),V.resting[0]=E[0],V.resting[2]=E[2],V.wt&&V.wt()}(h,V,F,c);for(var v=0;v<3;++v)V.resting[v]=V.resting[v]||f[v],e[v]=0,V.resting[v]&&(n[v]||(e[v]=-V.xB[v]),V.xB[v]=0);var P=B.length(e);P>.001&&(B.scale(e,e,V.DS),V.As&&V.As(e),V.restitution>0&&P>h.minBounceImpulse&&(B.scale(e,e,V.restitution),V.applyImpulse(e)));var o=B.squaredLength(V.xB);o>1e-5&&V.AB();h.ts&&h.ts(V)?(V.loadFromCopy(L),V.rolledBackLastTick=!0):V.rolledBackLastTick=!1}(this,i,h,V)))};var X=B.create([0,0,0]);var D=B.create();function O(h,V,i,S,l){var Y=i.resting[V],g=S[V];if(!i.alwaysApplyHorizFriction||1!==V){if(0===Y)return;if(Y*g<=0)return}B.j(o,i.xB),o[V]=0;var q=B.length(o);if(!R(q,0)){var J=Math.abs(i.friction*h.gravity[V]*l),I=q>J?(q-J)/q:0;i.xB[(V+1)%3]*=I,i.xB[(V+2)%3]*=I}}var o=B.create();function M(h,V,i,S,l){return B.set(S,0,0,0),J(h.testSolid,V,i,(function(h,V,i,Y){S[V]=i,Y[V]=0,l||(Y[0]=0,Y[1]=0,Y[2]=0)}))}var F=new q([],[]),E=B.create(),H=B.create(),j=B.create(),m=B.create();var G=B.create(),w=new q([],[]),N=B.create();function r(h,V,i,S){return h.testSolid(Math.floor(V),Math.floor(i-1),Math.floor(S))}var k=B.create();function R(h,V){return Math.abs(h-V)<1e-5}function Z(h,V){for(var i=0;i<3;i++)h.base[i]=V.base[i],h.max[i]=V.max[i],h.EJ[i]=V.EJ[i]}var z=function(h){}},11819:function(h,V){!function(h){"use strict";var V=function(h,i){return V=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,V){h.__proto__=V}||function(h,V){for(var i in V)Object.prototype.hasOwnProperty.call(V,i)&&(h[i]=V[i])},V(h,i)};function i(h,i){if("function"!==typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function S(){this.constructor=h}V(h,i),h.prototype=null===i?Object.create(i):(S.prototype=i.prototype,new S)}function S(h,V,i,S){var l,Y=arguments.length,g=Y<3?V:null===S?S=Object.getOwnPropertyDescriptor(V,i):S;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=Reflect.decorate(h,V,i,S);else for(var q=h.length-1;q>=0;q--)(l=h[q])&&(g=(Y<3?l(g):Y>3?l(V,i,g):l(V,i))||g);return Y>3&&g&&Object.defineProperty(V,i,g),g}function l(h,V,i){if(i||2===arguments.length)for(var S,l=0,Y=V.length;l<Y;l++)!S&&l in V||(S||(S=Array.prototype.slice.call(V,0,l)),S[l]=V[l]);return h.concat(S||Array.prototype.slice.call(V))}var Y,g=255,q=213;h.OPERATION=void 0,(Y=h.OPERATION||(h.OPERATION={}))[Y.ADD=128]="ADD",Y[Y.REPLACE=0]="REPLACE",Y[Y.DELETE=64]="DELETE",Y[Y.DELETE_AND_ADD=192]="DELETE_AND_ADD",Y[Y.TOUCH=1]="TOUCH",Y[Y.CLEAR=10]="CLEAR";var B=function(){function V(h,V,i){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=h,this.setParent(V,i)}return V.prototype.setParent=function(h,V,i){var S=this;if(this.indexes||(this.indexes=this.ref instanceof mh?this.ref._definition.indexes:{}),this.parent=h,this.parentIndex=i,V)if(this.root=V,this.ref instanceof mh){var l=this.ref._definition;for(var Y in l.schema){var g=this.ref[Y];if(g&&g.$changes){var q=l.indexes[Y];g.$changes.setParent(this.ref,V,q)}}}else"object"===typeof this.ref&&this.ref.forEach((function(h,V){if(h instanceof mh){var i=h.$changes,l=S.ref.$changes.indexes[V];i.setParent(S.ref,S.root,l)}}))},V.prototype.operation=function(h){this.changes.set(--this.currentCustomOperation,h)},V.prototype.change=function(V,i){void 0===i&&(i=h.OPERATION.ADD);var S="number"===typeof V?V:this.indexes[V];this.assertValidIndex(S,V);var l=this.changes.get(S);l&&l.op!==h.OPERATION.DELETE&&l.op!==h.OPERATION.TOUCH||this.changes.set(S,{op:l&&l.op===h.OPERATION.DELETE?h.OPERATION.DELETE_AND_ADD:i,index:S}),this.allChanges.add(S),this.changed=!0,this.touchParents()},V.prototype.touch=function(V){var i="number"===typeof V?V:this.indexes[V];this.assertValidIndex(i,V),this.changes.has(i)||this.changes.set(i,{op:h.OPERATION.TOUCH,index:i}),this.allChanges.add(i),this.touchParents()},V.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},V.prototype.getType=function(h){if(this.ref._definition)return(V=this.ref._definition).schema[V.fieldsByIndex[h]];var V,i=(V=this.parent._definition).schema[V.fieldsByIndex[this.parentIndex]];return Object.values(i)[0]},V.prototype.getChildrenFilter=function(){var h=this.parent._definition.childFilters;return h&&h[this.parentIndex]},V.prototype.getValue=function(h){return this.ref.getByIndex(h)},V.prototype.delete=function(V){var i="number"===typeof V?V:this.indexes[V];if(void 0!==i){var S=this.getValue(i);this.changes.set(i,{op:h.OPERATION.DELETE,index:i}),this.allChanges.delete(i),delete this.caches[i],S&&S.$changes&&(S.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(V," (").concat(i,")"))},V.prototype.discard=function(V,i){var S=this;void 0===V&&(V=!1),void 0===i&&(i=!1),this.ref instanceof mh||this.changes.forEach((function(V){if(V.op===h.OPERATION.DELETE){var i=S.ref.getIndex(V.index);delete S.indexes[i]}})),this.changes.clear(),this.changed=V,i&&this.allChanges.clear(),this.currentCustomOperation=0},V.prototype.discardAll=function(){var h=this;this.changes.forEach((function(V){var i=h.getValue(V.index);i&&i.$changes&&i.$changes.discardAll()})),this.discard()},V.prototype.cache=function(h,V){this.caches[h]=V},V.prototype.clone=function(){return new V(this.ref,this.parent,this.root)},V.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},V.prototype.assertValidIndex=function(h,V){if(void 0===h)throw new Error('ChangeTree: missing index for field "'.concat(V,'"'))},V}();function J(h,V,i,S){return h[V]||(h[V]=[]),h[V].push(i),null===S||void 0===S||S.forEach((function(h,V){return i(h,V)})),function(){return v(h[V],h[V].indexOf(i))}}function I(V){var i=this,S="string"!==typeof this.$changes.getType();this.$items.forEach((function(l,Y){V.push({refId:i.$changes.refId,op:h.OPERATION.DELETE,field:Y,value:void 0,previousValue:l}),S&&i.$changes.root.removeRef(l.$changes.refId)}))}function v(h,V){if(-1===V||V>=h.length)return!1;for(var i=h.length-1,S=V;S<i;S++)h[S]=h[S+1];return h.length=i,!0}var s=function(h,V){var i=h.toString(),S=V.toString();return i<S?-1:i>S?1:0};function t(h){return h.$proxy=!0,h=new Proxy(h,{get:function(h,V){return"symbol"===typeof V||isNaN(V)?h[V]:h.at(V)},set:function(h,V,i){if("symbol"===typeof V||isNaN(V))h[V]=i;else{var S=Array.from(h.$items.keys()),l=parseInt(S[V]||V);void 0===i||null===i?h.deleteAt(l):h.setAt(l,i)}return!0},deleteProperty:function(h,V){return"number"===typeof V?h.deleteAt(V):delete h[V],!0}})}var T=function(){function V(){for(var h=[],V=0;V<arguments.length;V++)h[V]=arguments[V];this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,h)}return V.prototype.Xq=function(V,i){return void 0===i&&(i=!0),J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,V,i?this.$items:void 0)},V.prototype.IV=function(V){return J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,V)},V.prototype.onChange=function(V){return J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,V)},V.is=function(h){return Array.isArray(h)||void 0!==h.array},Object.defineProperty(V.prototype,"length",{get:function(){return this.$items.size},set:function(h){0===h?this.clear():this.splice(h,this.length-h)},enumerable:!1,configurable:!0}),V.prototype.push=function(){for(var h,V=this,i=[],S=0;S<arguments.length;S++)i[S]=arguments[S];return i.forEach((function(i){h=V.$refId++,V.setAt(h,i)})),h},V.prototype.pop=function(){var h=Array.from(this.$indexes.values()).pop();if(void 0!==h){this.$changes.delete(h),this.$indexes.delete(h);var V=this.$items.get(h);return this.$items.delete(h),V}},V.prototype.at=function(h){var V=Array.from(this.$items.keys())[h];return this.$items.get(V)},V.prototype.setAt=function(V,i){var S,l;if(void 0!==i&&null!==i){if(this.$items.get(V)!==i){void 0!==i.$changes&&i.$changes.setParent(this,this.$changes.root,V);var Y=null!==(l=null===(S=this.$changes.indexes[V])||void 0===S?void 0:S.op)&&void 0!==l?l:h.OPERATION.ADD;this.$changes.indexes[V]=V,this.$indexes.set(V,V),this.$items.set(V,i),this.$changes.change(V,Y)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},V.prototype.deleteAt=function(h){var V=Array.from(this.$items.keys())[h];return void 0!==V&&this.$deleteAt(V)},V.prototype.$deleteAt=function(h){return this.$changes.delete(h),this.$indexes.delete(h),this.$items.delete(h)},V.prototype.clear=function(V){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),V&&I.call(this,V),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},V.prototype.concat=function(){for(var h,i=[],S=0;S<arguments.length;S++)i[S]=arguments[S];return new(V.bind.apply(V,l([void 0],(h=Array.from(this.$items.values())).concat.apply(h,i),!1)))},V.prototype.join=function(h){return Array.from(this.$items.values()).join(h)},V.prototype.reverse=function(){var h=this,V=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(i,S){h.setAt(V[S],i)})),this},V.prototype.shift=function(){var h=Array.from(this.$items.keys()).shift();if(void 0!==h){var V=this.$items.get(h);return this.$deleteAt(h),V}},V.prototype.slice=function(h,i){var S=new V;return S.push.apply(S,Array.from(this.$items.values()).slice(h,i)),S},V.prototype.sort=function(h){var V=this;void 0===h&&(h=s);var i=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(h).forEach((function(h,S){V.setAt(i[S],h)})),this},V.prototype.splice=function(h,V){void 0===V&&(V=this.length-h);for(var i=Array.from(this.$items.keys()),S=[],l=h;l<h+V;l++)S.push(this.$items.get(i[l])),this.$deleteAt(i[l]);return S},V.prototype.unshift=function(){for(var h=this,V=[],i=0;i<arguments.length;i++)V[i]=arguments[i];var S=this.length,l=V.length,Y=Array.from(this.$items.values());return V.forEach((function(V,i){h.setAt(i,V)})),Y.forEach((function(V,i){h.setAt(l+i,V)})),S+l},V.prototype.indexOf=function(h,V){return Array.from(this.$items.values()).indexOf(h,V)},V.prototype.lastIndexOf=function(h,V){return void 0===V&&(V=this.length-1),Array.from(this.$items.values()).lastIndexOf(h,V)},V.prototype.every=function(h,V){return Array.from(this.$items.values()).every(h,V)},V.prototype.some=function(h,V){return Array.from(this.$items.values()).some(h,V)},V.prototype.forEach=function(h,V){Array.from(this.$items.values()).forEach(h,V)},V.prototype.map=function(h,V){return Array.from(this.$items.values()).map(h,V)},V.prototype.filter=function(h,V){return Array.from(this.$items.values()).filter(h,V)},V.prototype.reduce=function(h,V){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},V.prototype.reduceRight=function(h,V){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},V.prototype.find=function(h,V){return Array.from(this.$items.values()).find(h,V)},V.prototype.findIndex=function(h,V){return Array.from(this.$items.values()).findIndex(h,V)},V.prototype.fill=function(h,V,i){throw new Error("ArraySchema#fill() not implemented")},V.prototype.copyWithin=function(h,V,i){throw new Error("ArraySchema#copyWithin() not implemented")},V.prototype.toString=function(){return this.$items.toString()},V.prototype.toLocaleString=function(){return this.$items.toLocaleString()},V.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(V,Symbol.species,{get:function(){return V},enumerable:!1,configurable:!0}),V.prototype.entries=function(){return this.$items.entries()},V.prototype.keys=function(){return this.$items.keys()},V.prototype.values=function(){return this.$items.values()},V.prototype.includes=function(h,V){return Array.from(this.$items.values()).includes(h,V)},V.prototype.flatMap=function(h,V){throw new Error("ArraySchema#flatMap() is not supported.")},V.prototype.flat=function(h){throw new Error("ArraySchema#flat() is not supported.")},V.prototype.findLast=function(){var h=Array.from(this.$items.values());return h.findLast.apply(h,arguments)},V.prototype.findLastIndex=function(){var h=Array.from(this.$items.values());return h.findLastIndex.apply(h,arguments)},V.prototype.setIndex=function(h,V){this.$indexes.set(h,V)},V.prototype.getIndex=function(h){return this.$indexes.get(h)},V.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},V.prototype.deleteByIndex=function(h){var V=this.$indexes.get(h);this.$items.delete(V),this.$indexes.delete(h)},V.prototype.toArray=function(){return Array.from(this.$items.values())},V.prototype.toJSON=function(){return this.toArray().map((function(h){return"function"===typeof h.toJSON?h.toJSON():h}))},V.prototype.clone=function(h){return h?new(V.bind.apply(V,l([void 0],Array.from(this.$items.values()),!1))):new(V.bind.apply(V,l([void 0],this.map((function(h){return h.$changes?h.clone():h})),!1)))},V}();function e(h){return h.$proxy=!0,h=new Proxy(h,{get:function(h,V){return"symbol"!==typeof V&&"undefined"===typeof h[V]?h.get(V):h[V]},set:function(h,V,i){return"symbol"!==typeof V&&-1===V.indexOf("$")&&"Xq"!==V&&"IV"!==V&&"onChange"!==V?h.set(V,i):h[V]=i,!0},deleteProperty:function(h,V){return h.delete(V),!0}})}var n=function(){function V(h){var i=this;if(this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,h)if(h instanceof Map||h instanceof V)h.forEach((function(h,V){return i.set(V,h)}));else for(var S in h)this.set(S,h[S])}return V.prototype.Xq=function(V,i){return void 0===i&&(i=!0),J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,V,i?this.$items:void 0)},V.prototype.IV=function(V){return J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,V)},V.prototype.onChange=function(V){return J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,V)},V.is=function(h){return void 0!==h.map},V.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(V.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(V,Symbol.species,{get:function(){return V},enumerable:!1,configurable:!0}),V.prototype.set=function(V,i){if(void 0===i||null===i)throw new Error("MapSchema#set('".concat(V,"', ").concat(i,"): trying to set ").concat(i," value on '").concat(V,"'."));V=V.toString();var S="undefined"!==typeof this.$changes.indexes[V],l=S?this.$changes.indexes[V]:this.$refId++,Y=S?h.OPERATION.REPLACE:h.OPERATION.ADD,g=void 0!==i.$changes;if(g&&i.$changes.setParent(this,this.$changes.root,l),S){if(!g&&this.$items.get(V)===i)return;g&&this.$items.get(V)!==i&&(Y=h.OPERATION.ADD)}else this.$changes.indexes[V]=l,this.$indexes.set(l,V);return this.$items.set(V,i),this.$changes.change(V,Y),this},V.prototype.get=function(h){return this.$items.get(h)},V.prototype.delete=function(h){return this.$changes.delete(h),this.$items.delete(h)},V.prototype.clear=function(V){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),V&&I.call(this,V),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},V.prototype.has=function(h){return this.$items.has(h)},V.prototype.forEach=function(h){this.$items.forEach(h)},V.prototype.entries=function(){return this.$items.entries()},V.prototype.keys=function(){return this.$items.keys()},V.prototype.values=function(){return this.$items.values()},Object.defineProperty(V.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),V.prototype.setIndex=function(h,V){this.$indexes.set(h,V)},V.prototype.getIndex=function(h){return this.$indexes.get(h)},V.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},V.prototype.deleteByIndex=function(h){var V=this.$indexes.get(h);this.$items.delete(V),this.$indexes.delete(h)},V.prototype.toJSON=function(){var h={};return this.forEach((function(V,i){h[i]="function"===typeof V.toJSON?V.toJSON():V})),h},V.prototype.clone=function(h){var i;return h?i=Object.assign(new V,this):(i=new V,this.forEach((function(h,V){h.$changes?i.set(V,h.clone()):i.set(V,h)}))),i},V}(),c={};function f(h,V){c[h]=V}function P(h){return c[h]}var L=function(){function h(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return h.create=function(V){var i=new h;return i.schema=Object.assign({},V&&V.schema||{}),i.indexes=Object.assign({},V&&V.indexes||{}),i.fieldsByIndex=Object.assign({},V&&V.fieldsByIndex||{}),i.descriptors=Object.assign({},V&&V.descriptors||{}),i.deprecated=Object.assign({},V&&V.deprecated||{}),i},h.prototype.addField=function(h,V){var i=this.getNextFieldIndex();this.fieldsByIndex[i]=h,this.indexes[h]=i,this.schema[h]=Array.isArray(V)?{array:V[0]}:V},h.prototype.hasField=function(h){return void 0!==this.indexes[h]},h.prototype.addFilter=function(h,V){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[h]]=V,this.indexesWithFilters.push(this.indexes[h]),!0},h.prototype.addChildrenFilter=function(h,V){var i=this.indexes[h],S=this.schema[h];if(P(Object.keys(S)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[i]=V,!0;console.warn("@filterChildren: field '".concat(h,"' can't have children. Ignoring filter."))},h.prototype.getChildrenFilter=function(h){return this.childFilters&&this.childFilters[this.indexes[h]]},h.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},h}();function U(h){return h._context&&h._context.useFilters}var X=function(){function h(){this.types={},this.schemas=new Map,this.useFilters=!1}return h.prototype.has=function(h){return this.schemas.has(h)},h.prototype.get=function(h){return this.types[h]},h.prototype.add=function(h,V){void 0===V&&(V=this.schemas.size),h._definition=L.create(h._definition),h._typeid=V,this.types[V]=h,this.schemas.set(h,V)},h.create=function(V){return void 0===V&&(V={}),function(i){return V.context||(V.context=new h),O(i,V)}},h}(),D=new X;function O(h,V){return void 0===V&&(V={}),function(i,S){var Y=V.context||D,g=i.constructor;if(g._context=Y,!h)throw new Error("".concat(g.name,': @type() reference provided for "').concat(S,"\" is undefined. Make sure you don't have any circular dependencies."));Y.has(g)||Y.add(g);var q=g._definition;if(q.addField(S,h),q.descriptors[S]){if(q.deprecated[S])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(S,"' definition on '").concat(g.name,"'.\nCheck @type() annotation"))}catch(c){var B=c.stack.split("\n")[4].trim();throw new Error("".concat(c.message," ").concat(B))}}var J=T.is(h),I=!J&&n.is(h);if("string"!==typeof h&&!mh.is(h)){var v=Object.values(h)[0];"string"===typeof v||Y.has(v)||Y.add(v)}if(V.manual)q.descriptors[S]={enumerable:!0,configurable:!0,writable:!0};else{var s="_".concat(S);q.descriptors[s]={enumerable:!1,configurable:!1,writable:!0},q.descriptors[S]={get:function(){return this[s]},set:function(h){h!==this[s]&&(void 0!==h&&null!==h?(!J||h instanceof T||(h=new(T.bind.apply(T,l([void 0],h,!1)))),!I||h instanceof n||(h=new n(h)),void 0===h.$proxy&&(I?h=e(h):J&&(h=t(h))),this.$changes.change(S),h.$changes&&h.$changes.setParent(this,this.$changes.root,this._definition.indexes[S])):this[s]&&this.$changes.delete(S),this[s]=h)},enumerable:!0,configurable:!0}}}}function o(h){return function(V,i){var S=V.constructor;S._definition.addFilter(i,h)&&(S._context.useFilters=!0)}}function M(h){return function(V,i){var S=V.constructor;S._definition.addChildrenFilter(i,h)&&(S._context.useFilters=!0)}}function F(h){return void 0===h&&(h=!0),function(V,i){var S=V.constructor._definition;S.deprecated[i]=!0,h&&(S.descriptors[i]={get:function(){throw new Error("".concat(i," is deprecated."))},set:function(h){},enumerable:!1,configurable:!0})}}function E(h,V,i){for(var S in void 0===i&&(i={}),i.context||(i.context=h._context||i.context||D),V)O(V[S],i)(h.prototype,S);return h}function H(h){for(var V=0,i=0,S=0,l=h.length;S<l;S++)(V=h.charCodeAt(S))<128?i+=1:V<2048?i+=2:V<55296||V>=57344?i+=3:(S++,i+=4);return i}function j(h,V,i){for(var S=0,l=0,Y=i.length;l<Y;l++)(S=i.charCodeAt(l))<128?h[V++]=S:S<2048?(h[V++]=192|S>>6,h[V++]=128|63&S):S<55296||S>=57344?(h[V++]=224|S>>12,h[V++]=128|S>>6&63,h[V++]=128|63&S):(l++,S=65536+((1023&S)<<10|1023&i.charCodeAt(l)),h[V++]=240|S>>18,h[V++]=128|S>>12&63,h[V++]=128|S>>6&63,h[V++]=128|63&S)}function m(h,V){h.push(255&V)}function G(h,V){h.push(255&V)}function w(h,V){h.push(255&V),h.push(V>>8&255)}function N(h,V){h.push(255&V),h.push(V>>8&255)}function r(h,V){h.push(255&V),h.push(V>>8&255),h.push(V>>16&255),h.push(V>>24&255)}function k(h,V){var i=V>>24,S=V>>16,l=V>>8,Y=V;h.push(255&Y),h.push(255&l),h.push(255&S),h.push(255&i)}function R(h,V){var i=Math.floor(V/Math.pow(2,32));k(h,V>>>0),k(h,i)}function Z(h,V){var i=V/Math.pow(2,32)|0;k(h,V>>>0),k(h,i)}function z(h,V){A(h,V)}function d(h,V){b(h,V)}var x=new Int32Array(2),y=new Float32Array(x.buffer),Q=new Float64Array(x.buffer);function A(h,V){y[0]=V,r(h,x[0])}function b(h,V){Q[0]=V,r(h,x[0]),r(h,x[1])}function C(h,V){return G(h,V?1:0)}function u(h,V){V||(V="");var i=H(V),S=0;if(i<32)h.push(160|i),S=1;else if(i<256)h.push(217),G(h,i),S=2;else if(i<65536)h.push(218),N(h,i),S=3;else{if(!(i<4294967296))throw new Error("String too long");h.push(219),k(h,i),S=5}return j(h,h.length,V),S+i}function p(h,V){return isNaN(V)?p(h,0):isFinite(V)?V!==(0|V)?(h.push(203),b(h,V),9):V>=0?V<128?(G(h,V),1):V<256?(h.push(204),G(h,V),2):V<65536?(h.push(205),N(h,V),3):V<4294967296?(h.push(206),k(h,V),5):(h.push(207),Z(h,V),9):V>=-32?(h.push(224|V+32),1):V>=-128?(h.push(208),m(h,V),2):V>=-32768?(h.push(209),w(h,V),3):V>=-2147483648?(h.push(210),r(h,V),5):(h.push(211),R(h,V),9):p(h,V>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var W=Object.freeze({__proto__:null,utf8Write:j,int8:m,uint8:G,int16:w,uint16:N,int32:r,uint32:k,int64:R,uint64:Z,float32:z,float64:d,writeFloat32:A,writeFloat64:b,boolean:C,string:u,number:p});function a(h,V,i){for(var S="",l=0,Y=V,g=V+i;Y<g;Y++){var q=h[Y];0!==(128&q)?192!==(224&q)?224!==(240&q)?240!==(248&q)?console.error("Invalid byte "+q.toString(16)):(l=(7&q)<<18|(63&h[++Y])<<12|(63&h[++Y])<<6|63&h[++Y])>=65536?(l-=65536,S+=String.fromCharCode(55296+(l>>>10),56320+(1023&l))):S+=String.fromCharCode(l):S+=String.fromCharCode((15&q)<<12|(63&h[++Y])<<6|63&h[++Y]):S+=String.fromCharCode((31&q)<<6|63&h[++Y]):S+=String.fromCharCode(q)}return S}function K(h,V){return hh(h,V)<<24>>24}function hh(h,V){return h[V.offset++]}function Vh(h,V){return ih(h,V)<<16>>16}function ih(h,V){return h[V.offset++]|h[V.offset++]<<8}function Sh(h,V){return h[V.offset++]|h[V.offset++]<<8|h[V.offset++]<<16|h[V.offset++]<<24}function lh(h,V){return Sh(h,V)>>>0}function Yh(h,V){return sh(h,V)}function gh(h,V){return th(h,V)}function qh(h,V){var i=lh(h,V);return Sh(h,V)*Math.pow(2,32)+i}function Bh(h,V){var i=lh(h,V);return lh(h,V)*Math.pow(2,32)+i}var Jh=new Int32Array(2),Ih=new Float32Array(Jh.buffer),vh=new Float64Array(Jh.buffer);function sh(h,V){return Jh[0]=Sh(h,V),Ih[0]}function th(h,V){return Jh[0]=Sh(h,V),Jh[1]=Sh(h,V),vh[0]}function Th(h,V){return hh(h,V)>0}function eh(h,V){var i,S=h[V.offset++];S<192?i=31&S:217===S?i=hh(h,V):218===S?i=ih(h,V):219===S&&(i=lh(h,V));var l=a(h,V.offset,i);return V.offset+=i,l}function nh(h,V){var i=h[V.offset];return i<192&&i>160||217===i||218===i||219===i}function ch(h,V){var i=h[V.offset++];return i<128?i:202===i?sh(h,V):203===i?th(h,V):204===i?hh(h,V):205===i?ih(h,V):206===i?lh(h,V):207===i?Bh(h,V):208===i?K(h,V):209===i?Vh(h,V):210===i?Sh(h,V):211===i?qh(h,V):i>223?-1*(255-i+1):void 0}function fh(h,V){var i=h[V.offset];return i<128||i>=202&&i<=211}function Ph(h,V){return h[V.offset]<160}function Lh(h,V){return h[V.offset-1]===g&&(h[V.offset]<128||h[V.offset]>=202&&h[V.offset]<=211)}var Uh=Object.freeze({__proto__:null,int8:K,uint8:hh,int16:Vh,uint16:ih,int32:Sh,uint32:lh,float32:Yh,float64:gh,int64:qh,uint64:Bh,readFloat32:sh,readFloat64:th,boolean:Th,string:eh,stringCheck:nh,number:ch,numberCheck:fh,arrayCheck:Ph,switchStructureCheck:Lh}),Xh=function(){function V(h){var V=this;this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,h&&h.forEach((function(h){return V.add(h)}))}return V.prototype.Xq=function(V,i){return void 0===i&&(i=!0),J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,V,i?this.$items:void 0)},V.prototype.IV=function(V){return J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,V)},V.prototype.onChange=function(V){return J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,V)},V.is=function(h){return void 0!==h.collection},V.prototype.add=function(h){var V=this.$refId++;return void 0!==h.$changes&&h.$changes.setParent(this,this.$changes.root,V),this.$changes.indexes[V]=V,this.$indexes.set(V,V),this.$items.set(V,h),this.$changes.change(V),V},V.prototype.at=function(h){var V=Array.from(this.$items.keys())[h];return this.$items.get(V)},V.prototype.entries=function(){return this.$items.entries()},V.prototype.delete=function(h){for(var V,i,S=this.$items.entries();(i=S.next())&&!i.done;)if(h===i.value[1]){V=i.value[0];break}return void 0!==V&&(this.$changes.delete(V),this.$indexes.delete(V),this.$items.delete(V))},V.prototype.clear=function(V){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),V&&I.call(this,V),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},V.prototype.has=function(h){return Array.from(this.$items.values()).some((function(V){return V===h}))},V.prototype.forEach=function(h){var V=this;this.$items.forEach((function(i,S,l){return h(i,S,V)}))},V.prototype.values=function(){return this.$items.values()},Object.defineProperty(V.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),V.prototype.setIndex=function(h,V){this.$indexes.set(h,V)},V.prototype.getIndex=function(h){return this.$indexes.get(h)},V.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},V.prototype.deleteByIndex=function(h){var V=this.$indexes.get(h);this.$items.delete(V),this.$indexes.delete(h)},V.prototype.toArray=function(){return Array.from(this.$items.values())},V.prototype.toJSON=function(){var h=[];return this.forEach((function(V,i){h.push("function"===typeof V.toJSON?V.toJSON():V)})),h},V.prototype.clone=function(h){var i;return h?i=Object.assign(new V,this):(i=new V,this.forEach((function(h){h.$changes?i.add(h.clone()):i.add(h)}))),i},V}(),Dh=function(){function V(h){var V=this;this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,h&&h.forEach((function(h){return V.add(h)}))}return V.prototype.Xq=function(V,i){return void 0===i&&(i=!0),J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,V,i?this.$items:void 0)},V.prototype.IV=function(V){return J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,V)},V.prototype.onChange=function(V){return J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,V)},V.is=function(h){return void 0!==h.set},V.prototype.add=function(V){var i,S;if(this.has(V))return!1;var l=this.$refId++;void 0!==V.$changes&&V.$changes.setParent(this,this.$changes.root,l);var Y=null!==(S=null===(i=this.$changes.indexes[l])||void 0===i?void 0:i.op)&&void 0!==S?S:h.OPERATION.ADD;return this.$changes.indexes[l]=l,this.$indexes.set(l,l),this.$items.set(l,V),this.$changes.change(l,Y),l},V.prototype.entries=function(){return this.$items.entries()},V.prototype.delete=function(h){for(var V,i,S=this.$items.entries();(i=S.next())&&!i.done;)if(h===i.value[1]){V=i.value[0];break}return void 0!==V&&(this.$changes.delete(V),this.$indexes.delete(V),this.$items.delete(V))},V.prototype.clear=function(V){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),V&&I.call(this,V),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},V.prototype.has=function(h){for(var V,i=this.$items.values(),S=!1;(V=i.next())&&!V.done;)if(h===V.value){S=!0;break}return S},V.prototype.forEach=function(h){var V=this;this.$items.forEach((function(i,S,l){return h(i,S,V)}))},V.prototype.values=function(){return this.$items.values()},Object.defineProperty(V.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),V.prototype.setIndex=function(h,V){this.$indexes.set(h,V)},V.prototype.getIndex=function(h){return this.$indexes.get(h)},V.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},V.prototype.deleteByIndex=function(h){var V=this.$indexes.get(h);this.$items.delete(V),this.$indexes.delete(h)},V.prototype.toArray=function(){return Array.from(this.$items.values())},V.prototype.toJSON=function(){var h=[];return this.forEach((function(V,i){h.push("function"===typeof V.toJSON?V.toJSON():V)})),h},V.prototype.clone=function(h){var i;return h?i=Object.assign(new V,this):(i=new V,this.forEach((function(h){h.$changes?i.add(h.clone()):i.add(h)}))),i},V}(),Oh=function(){function h(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return h.prototype.addRefId=function(h){this.refIds.has(h)||(this.refIds.add(h),this.containerIndexes.set(h,new Set))},h.get=function(V){return void 0===V.$filterState&&(V.$filterState=new h),V.$filterState},h}(),oh=function(){function h(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return h.prototype.getNextUniqueId=function(){return this.nextUniqueId++},h.prototype.addRef=function(h,V,i){void 0===i&&(i=!0),this.refs.set(h,V),i&&(this.refCounts[h]=(this.refCounts[h]||0)+1)},h.prototype.removeRef=function(h){this.refCounts[h]=this.refCounts[h]-1,this.deletedRefs.add(h)},h.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},h.prototype.garbageCollectDeletedRefs=function(){var h=this;this.deletedRefs.forEach((function(V){if(!(h.refCounts[V]>0)){var i=h.refs.get(V);if(i instanceof mh)for(var S in i._definition.schema)"string"!==typeof i._definition.schema[S]&&i[S]&&i[S].$changes&&h.removeRef(i[S].$changes.refId);else{var l=i.$changes.parent._definition,Y=l.schema[l.fieldsByIndex[i.$changes.parentIndex]];"function"===typeof Object.values(Y)[0]&&Array.from(i.values()).forEach((function(V){return h.removeRef(V.$changes.refId)}))}h.refs.delete(V),delete h.refCounts[V]}})),this.deletedRefs.clear()},h}(),Mh=function(h){function V(){return null!==h&&h.apply(this,arguments)||this}return i(V,h),V}(Error);function Fh(h,V,i,S){var l,Y=!1;switch(V){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":l="number",isNaN(h)&&console.log('trying to encode "NaN" in '.concat(i.constructor.name,"#").concat(S));break;case"string":l="string",Y=!0;break;case"boolean":return}if(typeof h!==l&&(!Y||Y&&null!==h)){var g="'".concat(JSON.stringify(h),"'").concat(h&&h.constructor&&" (".concat(h.constructor.name,")")||"");throw new Mh("a '".concat(l,"' was expected, but ").concat(g," was provided in ").concat(i.constructor.name,"#").concat(S))}}function Eh(h,V,i,S){if(!(h instanceof V))throw new Mh("a '".concat(V.name,"' was expected, but '").concat(h.constructor.name,"' was provided in ").concat(i.constructor.name,"#").concat(S))}function Hh(h,V,i,S,l){Fh(i,h,S,l);var Y=W[h];if(!Y)throw new Mh("a '".concat(h,"' was expected, but ").concat(i," was provided in ").concat(S.constructor.name,"#").concat(l));Y(V,i)}function jh(h,V,i){return Uh[h](V,i)}var mh=function(){function V(){for(var h=[],V=0;V<arguments.length;V++)h[V]=arguments[V];Object.defineProperties(this,{$changes:{value:new B(this,void 0,new oh),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var i=this._definition.descriptors;i&&Object.defineProperties(this,i),h[0]&&this.assign(h[0])}return V.onError=function(h){console.error(h)},V.is=function(h){return h._definition&&void 0!==h._definition.schema},V.prototype.onChange=function(V){return J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,V)},V.prototype.IV=function(V){return J(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,V)},V.prototype.assign=function(h){return Object.assign(this,h),this},Object.defineProperty(V.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),V.prototype.setDirty=function(h,V){this.$changes.change(h,V)},V.prototype.listen=function(h,V,i){var S=this;return void 0===i&&(i=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[h]||(this.$callbacks[h]=[]),this.$callbacks[h].push(V),i&&void 0!==this[h]&&V(this[h],void 0),function(){return v(S.$callbacks[h],S.$callbacks[h].indexOf(V))}},V.prototype.decode=function(i,S,l){var Y;void 0===S&&(S={offset:0}),void 0===l&&(l=this);var q=[],B=this.$changes.root,J=i.length,I=0;for(B.refs.set(I,this);S.offset<J;){var v=i[S.offset++];if(v!=g){var s=l.$changes,t=void 0!==l._definition,e=t?v>>6<<6:v;if(e!==h.OPERATION.CLEAR){var c=t?v%(e||255):ch(i,S),f=t?l._definition.fieldsByIndex[c]:"",L=s.getType(c),U=void 0,X=void 0,D=void 0;if(t?X=l["_".concat(f)]:(X=l.getByIndex(c),(e&h.OPERATION.ADD)===h.OPERATION.ADD?(D=l instanceof n?eh(i,S):c,l.setIndex(c,D)):D=l.getIndex(c)),(e&h.OPERATION.DELETE)===h.OPERATION.DELETE&&(e!==h.OPERATION.DELETE_AND_ADD&&l.deleteByIndex(c),X&&X.$changes&&B.removeRef(X.$changes.refId),U=null),void 0!==f){if(e===h.OPERATION.DELETE);else if(V.is(L)){var O=ch(i,S);if(U=B.refs.get(O),e!==h.OPERATION.REPLACE){var o=this.getSchemaType(i,S,L);U||((U=this.createTypeInstance(o)).$changes.refId=O,X&&(U.$callbacks=X.$callbacks,X.$changes.refId&&O!==X.$changes.refId&&B.removeRef(X.$changes.refId))),B.addRef(O,U,U!==X)}}else if("string"===typeof L)U=jh(L,i,S);else{var M=P(Object.keys(L)[0]),F=ch(i,S),E=B.refs.has(F)?X||B.refs.get(F):new M.constructor;if((U=E.clone(!0)).$changes.refId=F,X&&(U.$callbacks=X.$callbacks,X.$changes.refId&&F!==X.$changes.refId)){B.removeRef(X.$changes.refId);for(var H=X.entries(),j=void 0;(j=H.next())&&!j.done;){var m=(Y=j.value)[0],G=Y[1];q.push({refId:F,op:h.OPERATION.DELETE,field:m,value:void 0,previousValue:G})}}B.addRef(F,U,E!==X)}if(null!==U&&void 0!==U)if(U.$changes&&U.$changes.setParent(s.ref,s.root,c),l instanceof V)l[f]=U;else if(l instanceof n)m=D,l.$items.set(m,U),l.$changes.allChanges.add(c);else if(l instanceof T)l.setAt(c,U);else if(l instanceof Xh){var w=l.add(U);l.setIndex(c,w)}else l instanceof Dh&&!1!==(w=l.add(U))&&l.setIndex(c,w);X!==U&&q.push({refId:I,op:e,field:f,dynamicIndex:D,value:U,previousValue:X})}else{console.warn("@colyseus/schema: definition mismatch");for(var N={offset:S.offset};S.offset<J&&(!Lh(i,S)||(N.offset=S.offset+1,!B.refs.has(ch(i,N))));)S.offset++}}else l.clear(q)}else{I=ch(i,S);var r=B.refs.get(I);if(!r)throw new Error('"refId" not found: '.concat(I));l=r}}return this._triggerChanges(q),B.garbageCollectDeletedRefs(),q},V.prototype.encode=function(i,S,l){void 0===i&&(i=!1),void 0===S&&(S=[]),void 0===l&&(l=!1);for(var Y=this.$changes,q=new WeakSet,B=[Y],J=1,I=0;I<J;I++){var v=B[I],s=v.ref,t=s instanceof V;v.ensureRefId(),q.add(v),v!==Y&&(v.changed||i)&&(G(S,g),p(S,v.refId));for(var T=i?Array.from(v.allChanges):Array.from(v.changes.values()),e=0,c=T.length;e<c;e++){var f=i?{op:h.OPERATION.ADD,index:T[e]}:T[e],L=f.index,U=t?s._definition.fieldsByIndex&&s._definition.fieldsByIndex[L]:L,X=S.length;if(f.op!==h.OPERATION.TOUCH)if(t)G(S,L|f.op);else{if(G(S,f.op),f.op===h.OPERATION.CLEAR)continue;p(S,L)}if(t||(f.op&h.OPERATION.ADD)!=h.OPERATION.ADD||s instanceof n&&u(S,v.ref.$indexes.get(L)),f.op!==h.OPERATION.DELETE){var D=v.getType(L),O=v.getValue(L);if(O&&O.$changes&&!q.has(O.$changes)&&(B.push(O.$changes),O.$changes.ensureRefId(),J++),f.op!==h.OPERATION.TOUCH){if(V.is(D))Eh(O,D,s,U),p(S,O.$changes.refId),(f.op&h.OPERATION.ADD)===h.OPERATION.ADD&&this.tryEncodeTypeId(S,D,O.constructor);else if("string"===typeof D)Hh(D,S,O,s,U);else{var o=P(Object.keys(D)[0]);Eh(s["_".concat(U)],o.constructor,s,U),p(S,O.$changes.refId)}l&&v.cache(L,S.slice(X))}}}i||l||v.discard()}return S},V.prototype.encodeAll=function(h){return this.encode(!0,[],h)},V.prototype.applyFilters=function(i,S){var l,Y;void 0===S&&(S=!1);for(var q=this,B=new Set,J=Oh.get(i),I=[this.$changes],v=1,s=[],t=function(t){var T=I[t];if(B.has(T.refId))return"continue";var e=T.ref,c=e instanceof V;G(s,g),p(s,T.refId);var f=J.refIds.has(T),P=S||!f;J.addRefId(T);var L=J.containerIndexes.get(T),U=P?Array.from(T.allChanges):Array.from(T.changes.values());!S&&c&&e._definition.indexesWithFilters&&e._definition.indexesWithFilters.forEach((function(V){!L.has(V)&&T.allChanges.has(V)&&(P?U.push(V):U.push({op:h.OPERATION.ADD,index:V}))}));for(var X=0,D=U.length;X<D;X++){var O=P?{op:h.OPERATION.ADD,index:U[X]}:U[X];if(O.op!==h.OPERATION.CLEAR){var o=O.index;if(O.op!==h.OPERATION.DELETE){var M=T.getValue(o),F=T.getType(o);if(c){if((E=e._definition.filters&&e._definition.filters[o])&&!E.call(e,i,M,q)){M&&M.$changes&&B.add(M.$changes.refId);continue}}else{var E,H=T.parent;if((E=T.getChildrenFilter())&&!E.call(H,i,e.$indexes.get(o),M,q)){M&&M.$changes&&B.add(M.$changes.refId);continue}}if(M.$changes&&(I.push(M.$changes),v++),O.op!==h.OPERATION.TOUCH)if(O.op===h.OPERATION.ADD||c)s.push.apply(s,null!==(l=T.caches[o])&&void 0!==l?l:[]),L.add(o);else if(L.has(o))s.push.apply(s,null!==(Y=T.caches[o])&&void 0!==Y?Y:[]);else{if(L.add(o),G(s,h.OPERATION.ADD),p(s,o),e instanceof n){var j=T.ref.$indexes.get(o);u(s,j)}M.$changes?p(s,M.$changes.refId):W[F](s,M)}else M.$changes&&!c&&(G(s,h.OPERATION.ADD),p(s,o),e instanceof n&&(j=T.ref.$indexes.get(o),u(s,j)),p(s,M.$changes.refId))}else c?G(s,O.op|o):(G(s,O.op),p(s,o))}else G(s,O.op)}},T=0;T<v;T++)t(T);return s},V.prototype.clone=function(){var h,V=new this.constructor,i=this._definition.schema;for(var S in i)"object"===typeof this[S]&&"function"===typeof(null===(h=this[S])||void 0===h?void 0:h.clone)?V[S]=this[S].clone():V[S]=this[S];return V},V.prototype.toJSON=function(){var h=this._definition.schema,V=this._definition.deprecated,i={};for(var S in h)V[S]||null===this[S]||"undefined"===typeof this[S]||(i[S]="function"===typeof this[S].toJSON?this[S].toJSON():this["_".concat(S)]);return i},V.prototype.discardAllChanges=function(){this.$changes.discardAll()},V.prototype.getByIndex=function(h){return this[this._definition.fieldsByIndex[h]]},V.prototype.deleteByIndex=function(h){this[this._definition.fieldsByIndex[h]]=void 0},V.prototype.tryEncodeTypeId=function(h,V,i){V._typeid!==i._typeid&&(G(h,q),p(h,i._typeid))},V.prototype.getSchemaType=function(h,V,i){var S;return h[V.offset]===q&&(V.offset++,S=this.constructor._context.get(ch(h,V))),S||i},V.prototype.createTypeInstance=function(h){var V=new h;return V.$changes.root=this.$changes.root,V},V.prototype._triggerChanges=function(i){for(var S,l,Y,g,q,B,J,I,v,s=new Set,t=this.$changes.root.refs,T=function(T){var e=i[T],n=e.refId,c=t.get(n),f=c.$callbacks;if((e.op&h.OPERATION.DELETE)===h.OPERATION.DELETE&&e.previousValue instanceof V&&(null===(l=null===(S=e.previousValue.$callbacks)||void 0===S?void 0:S[h.OPERATION.DELETE])||void 0===l||l.forEach((function(h){return h()}))),!f)return"continue";if(c instanceof V){if(!s.has(n))try{null===(Y=null===f||void 0===f?void 0:f[h.OPERATION.REPLACE])||void 0===Y||Y.forEach((function(h){return h()}))}catch(P){V.onError(P)}try{f.hasOwnProperty(e.field)&&(null===(g=f[e.field])||void 0===g||g.forEach((function(h){return h(e.value,e.previousValue)})))}catch(P){V.onError(P)}}else e.op===h.OPERATION.ADD&&void 0===e.previousValue?null===(q=f[h.OPERATION.ADD])||void 0===q||q.forEach((function(h){var V;return h(e.value,null!==(V=e.dynamicIndex)&&void 0!==V?V:e.field)})):e.op===h.OPERATION.DELETE?void 0!==e.previousValue&&(null===(B=f[h.OPERATION.DELETE])||void 0===B||B.forEach((function(h){var V;return h(e.previousValue,null!==(V=e.dynamicIndex)&&void 0!==V?V:e.field)}))):e.op===h.OPERATION.DELETE_AND_ADD&&(void 0!==e.previousValue&&(null===(J=f[h.OPERATION.DELETE])||void 0===J||J.forEach((function(h){var V;return h(e.previousValue,null!==(V=e.dynamicIndex)&&void 0!==V?V:e.field)}))),null===(I=f[h.OPERATION.ADD])||void 0===I||I.forEach((function(h){var V;return h(e.value,null!==(V=e.dynamicIndex)&&void 0!==V?V:e.field)}))),e.value!==e.previousValue&&(null===(v=f[h.OPERATION.REPLACE])||void 0===v||v.forEach((function(h){var V;return h(e.value,null!==(V=e.dynamicIndex)&&void 0!==V?V:e.field)})));s.add(n)},e=0;e<i.length;e++)T(e)},V._definition=L.create(),V}();function Gh(h){for(var V=[h.$changes],i=1,S={},l=S,Y=function(h){var i=V[h];i.changes.forEach((function(h){var V=i.ref,S=h.index,Y=V._definition?V._definition.fieldsByIndex[S]:V.$indexes.get(S);l[Y]=i.getValue(S)}))},g=0;g<i;g++)Y(g);return S}var wh={context:new X},Nh=function(h){function V(){return null!==h&&h.apply(this,arguments)||this}return i(V,h),S([O("string",wh)],V.prototype,"name",void 0),S([O("string",wh)],V.prototype,"type",void 0),S([O("number",wh)],V.prototype,"referencedType",void 0),V}(mh),rh=function(h){function V(){var V=null!==h&&h.apply(this,arguments)||this;return V.fields=new T,V}return i(V,h),S([O("number",wh)],V.prototype,"id",void 0),S([O([Nh],wh)],V.prototype,"fields",void 0),V}(mh),kh=function(h){function V(){var V=null!==h&&h.apply(this,arguments)||this;return V.types=new T,V}return i(V,h),V.encode=function(h){var i=h.constructor,S=new V;S.rootType=i._typeid;var l=function(h,V){for(var i in V){var l=new Nh;l.name=i;var Y=void 0;if("string"===typeof V[i])Y=V[i];else{var g=V[i],q=void 0;mh.is(g)?(Y="ref",q=V[i]):"string"===typeof g[Y=Object.keys(g)[0]]?Y+=":"+g[Y]:q=g[Y],l.referencedType=q?q._typeid:-1}l.type=Y,h.fields.push(l)}S.types.push(h)},Y=i._context.types;for(var g in Y){var q=new rh;q.id=Number(g),l(q,Y[g]._definition.schema)}return S.encodeAll()},V.decode=function(h,S){var l=new X,Y=new V;Y.decode(h,S);var g=Y.types.reduce((function(h,V){var S=function(h){function V(){return null!==h&&h.apply(this,arguments)||this}return i(V,h),V}(mh),Y=V.id;return h[Y]=S,l.add(S,Y),h}),{});Y.types.forEach((function(h){var V=g[h.id];h.fields.forEach((function(h){var i;if(void 0!==h.referencedType){var S=h.type,Y=g[h.referencedType];if(!Y){var q=h.type.split(":");S=q[0],Y=q[1]}"ref"===S?O(Y,{context:l})(V.prototype,h.name):O(((i={})[S]=Y,i),{context:l})(V.prototype,h.name)}else O(h.type,{context:l})(V.prototype,h.name)}))}));var q=g[Y.rootType],B=new q;for(var J in q._definition.schema){var I=q._definition.schema[J];"string"!==typeof I&&(B[J]="function"===typeof I?new I:new(P(Object.keys(I)[0]).constructor))}return B},S([O([rh],wh)],V.prototype,"types",void 0),S([O("number",wh)],V.prototype,"rootType",void 0),V}(mh);f("map",{constructor:n}),f("array",{constructor:T}),f("set",{constructor:Dh}),f("collection",{constructor:Xh}),h.ArraySchema=T,h.CollectionSchema=Xh,h.Context=X,h.MapSchema=n,h.Reflection=kh,h.ReflectionField=Nh,h.ReflectionType=rh,h.Schema=mh,h.SchemaDefinition=L,h.SetSchema=Dh,h.decode=Uh,h.defineTypes=E,h.deprecated=F,h.dumpChanges=Gh,h.encode=W,h.filter=o,h.filterChildren=M,h.hasFilter=U,h.registerType=f,h.type=O,Object.defineProperty(h,"__esModule",{value:!0})}(V)},13223:h=>{"use strict";h.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13216:(h,V,i)=>{var S=i(13223),l=i(13229),Y=Object.hasOwnProperty,g=Object.create(null);for(var q in S)Y.call(S,q)&&(g[S[q]]=q);var B=h.exports={to:{},get:{}};function J(h,V,i){return Math.min(Math.max(V,h),i)}function I(h){var V=Math.round(h).toString(16).toUpperCase();return V.length<2?"0"+V:V}B.get=function(h){var V,i;switch(h.substring(0,3).toLowerCase()){case"hsl":V=B.get.hsl(h),i="hsl";break;case"hwb":V=B.get.hwb(h),i="hwb";break;default:V=B.get.rgb(h),i="rgb"}return V?{model:i,value:V}:null},B.get.rgb=function(h){if(!h)return null;var V,i,l,g=[0,0,0,1];if(V=h.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(l=V[2],V=V[1],i=0;i<3;i++){var q=2*i;g[i]=parseInt(V.slice(q,q+2),16)}l&&(g[3]=parseInt(l,16)/255)}else if(V=h.match(/^#([a-f0-9]{3,4})$/i)){for(l=(V=V[1])[3],i=0;i<3;i++)g[i]=parseInt(V[i]+V[i],16);l&&(g[3]=parseInt(l+l,16)/255)}else if(V=h.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(i=0;i<3;i++)g[i]=parseInt(V[i+1],0);V[4]&&(V[5]?g[3]=.01*parseFloat(V[4]):g[3]=parseFloat(V[4]))}else{if(!(V=h.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(V=h.match(/^(\w+)$/))?"transparent"===V[1]?[0,0,0,0]:Y.call(S,V[1])?((g=S[V[1]])[3]=1,g):null:null;for(i=0;i<3;i++)g[i]=Math.round(2.55*parseFloat(V[i+1]));V[4]&&(V[5]?g[3]=.01*parseFloat(V[4]):g[3]=parseFloat(V[4]))}for(i=0;i<3;i++)g[i]=J(g[i],0,255);return g[3]=J(g[3],0,1),g},B.get.hsl=function(h){if(!h)return null;var V=h.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(V){var i=parseFloat(V[4]);return[(parseFloat(V[1])%360+360)%360,J(parseFloat(V[2]),0,100),J(parseFloat(V[3]),0,100),J(isNaN(i)?1:i,0,1)]}return null},B.get.hwb=function(h){if(!h)return null;var V=h.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(V){var i=parseFloat(V[4]);return[(parseFloat(V[1])%360+360)%360,J(parseFloat(V[2]),0,100),J(parseFloat(V[3]),0,100),J(isNaN(i)?1:i,0,1)]}return null},B.to.hex=function(){var h=l(arguments);return"#"+I(h[0])+I(h[1])+I(h[2])+(h[3]<1?I(Math.round(255*h[3])):"")},B.to.rgb=function(){var h=l(arguments);return h.length<4||1===h[3]?"rgb("+Math.round(h[0])+", "+Math.round(h[1])+", "+Math.round(h[2])+")":"rgba("+Math.round(h[0])+", "+Math.round(h[1])+", "+Math.round(h[2])+", "+h[3]+")"},B.to.rgb.percent=function(){var h=l(arguments),V=Math.round(h[0]/255*100),i=Math.round(h[1]/255*100),S=Math.round(h[2]/255*100);return h.length<4||1===h[3]?"rgb("+V+"%, "+i+"%, "+S+"%)":"rgba("+V+"%, "+i+"%, "+S+"%, "+h[3]+")"},B.to.hsl=function(){var h=l(arguments);return h.length<4||1===h[3]?"hsl("+h[0]+", "+h[1]+"%, "+h[2]+"%)":"hsla("+h[0]+", "+h[1]+"%, "+h[2]+"%, "+h[3]+")"},B.to.hwb=function(){var h=l(arguments),V="";return h.length>=4&&1!==h[3]&&(V=", "+h[3]),"hwb("+h[0]+", "+h[1]+"%, "+h[2]+"%"+V+")"},B.to.keyword=function(h){return g[h.slice(0,3)]}},13207:(h,V,i)=>{const S=i(13216),l=i(13242),Y=["keyword","gray","hex"],g={};for(const t of Object.keys(l))g[[...l[t].labels].sort().join("")]=t;const q={};function B(h,V){if(!(this instanceof B))return new B(h,V);if(V&&V in Y&&(V=null),V&&!(V in l))throw new Error("Unknown model: "+V);let i,J;if(null==h)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(h instanceof B)this.model=h.model,this.color=[...h.color],this.valpha=h.valpha;else if("string"===typeof h){const V=S.get(h);if(null===V)throw new Error("Unable to parse color from string: "+h);this.model=V.model,J=l[this.model].channels,this.color=V.value.slice(0,J),this.valpha="number"===typeof V.value[J]?V.value[J]:1}else if(h.length>0){this.model=V||"rgb",J=l[this.model].channels;const i=Array.prototype.slice.call(h,0,J);this.color=s(i,J),this.valpha="number"===typeof h[J]?h[J]:1}else if("number"===typeof h)this.model="rgb",this.color=[h>>16&255,h>>8&255,255&h],this.valpha=1;else{this.valpha=1;const V=Object.keys(h);"alpha"in h&&(V.splice(V.indexOf("alpha"),1),this.valpha="number"===typeof h.alpha?h.alpha:0);const S=V.sort().join("");if(!(S in g))throw new Error("Unable to parse color from object: "+JSON.stringify(h));this.model=g[S];const{labels:Y}=l[this.model],q=[];for(i=0;i<Y.length;i++)q.push(h[Y[i]]);this.color=s(q)}if(q[this.model])for(J=l[this.model].channels,i=0;i<J;i++){const h=q[this.model][i];h&&(this.color[i]=h(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}B.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(h){let V=this.model in S.to?this:this.rgb();V=V.round("number"===typeof h?h:1);const i=1===V.valpha?V.color:[...V.color,this.valpha];return S.to[V.model](i)},percentString(h){const V=this.rgb().round("number"===typeof h?h:1),i=1===V.valpha?V.color:[...V.color,this.valpha];return S.to.rgb.percent(i)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const h={},{channels:V}=l[this.model],{labels:i}=l[this.model];for(let S=0;S<V;S++)h[i[S]]=this.color[S];return 1!==this.valpha&&(h.alpha=this.valpha),h},unitArray(){const h=this.rgb().color;return h[0]/=255,h[1]/=255,h[2]/=255,1!==this.valpha&&h.push(this.valpha),h},unitObject(){const h=this.rgb().object();return h.r/=255,h.g/=255,h.b/=255,1!==this.valpha&&(h.alpha=this.valpha),h},round(h){return h=Math.max(h||0,0),new B([...this.color.map(J(h)),this.valpha],this.model)},alpha(h){return void 0!==h?new B([...this.color,Math.max(0,Math.min(1,h))],this.model):this.valpha},red:I("rgb",0,v(255)),green:I("rgb",1,v(255)),blue:I("rgb",2,v(255)),hue:I(["hsl","hsv","hsl","hwb","hcg"],0,(h=>(h%360+360)%360)),saturationl:I("hsl",1,v(100)),lightness:I("hsl",2,v(100)),saturationv:I("hsv",1,v(100)),value:I("hsv",2,v(100)),chroma:I("hcg",1,v(100)),gray:I("hcg",2,v(100)),white:I("hwb",1,v(100)),wblack:I("hwb",2,v(100)),cyan:I("cmyk",0,v(100)),magenta:I("cmyk",1,v(100)),yellow:I("cmyk",2,v(100)),black:I("cmyk",3,v(100)),x:I("xyz",0,v(95.047)),y:I("xyz",1,v(100)),z:I("xyz",2,v(108.833)),l:I("lab",0,v(100)),a:I("lab",1),b:I("lab",2),keyword(h){return void 0!==h?new B(h):l[this.model].keyword(this.color)},hex(h){return void 0!==h?new B(h):S.to.hex(this.rgb().round().color)},hexa(h){if(void 0!==h)return new B(h);const V=this.rgb().round().color;let i=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===i.length&&(i="0"+i),S.to.hex(V)+i},rgbNumber(){const h=this.rgb().color;return(255&h[0])<<16|(255&h[1])<<8|255&h[2]},luminosity(){const h=this.rgb().color,V=[];for(const[i,S]of h.entries()){const h=S/255;V[i]=h<=.04045?h/12.92:((h+.055)/1.055)**2.4}return.2126*V[0]+.7152*V[1]+.0722*V[2]},contrast(h){const V=this.luminosity(),i=h.luminosity();return V>i?(V+.05)/(i+.05):(i+.05)/(V+.05)},level(h){const V=this.contrast(h);return V>=7?"AAA":V>=4.5?"AA":""},isDark(){const h=this.rgb().color;return(2126*h[0]+7152*h[1]+722*h[2])/1e4<128},isLight(){return!this.isDark()},negate(){const h=this.rgb();for(let V=0;V<3;V++)h.color[V]=255-h.color[V];return h},lighten(h){const V=this.hsl();return V.color[2]+=V.color[2]*h,V},darken(h){const V=this.hsl();return V.color[2]-=V.color[2]*h,V},saturate(h){const V=this.hsl();return V.color[1]+=V.color[1]*h,V},desaturate(h){const V=this.hsl();return V.color[1]-=V.color[1]*h,V},whiten(h){const V=this.hwb();return V.color[1]+=V.color[1]*h,V},blacken(h){const V=this.hwb();return V.color[2]+=V.color[2]*h,V},grayscale(){const h=this.rgb().color,V=.3*h[0]+.59*h[1]+.11*h[2];return B.rgb(V,V,V)},fade(h){return this.alpha(this.valpha-this.valpha*h)},opaquer(h){return this.alpha(this.valpha+this.valpha*h)},rotate(h){const V=this.hsl();let i=V.color[0];return i=(i+h)%360,i=i<0?360+i:i,V.color[0]=i,V},mix(h,V){if(!h||!h.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof h);const i=h.rgb(),S=this.rgb(),l=void 0===V?.5:V,Y=2*l-1,g=i.alpha()-S.alpha(),q=((Y*g===-1?Y:(Y+g)/(1+Y*g))+1)/2,J=1-q;return B.rgb(q*i.red()+J*S.red(),q*i.green()+J*S.green(),q*i.blue()+J*S.blue(),i.alpha()*l+S.alpha()*(1-l))}};for(const t of Object.keys(l)){if(Y.includes(t))continue;const{channels:h}=l[t];B.prototype[t]=function(){if(this.model===t)return new B(this);for(var h=arguments.length,V=new Array(h),i=0;i<h;i++)V[i]=arguments[i];return V.length>0?new B(V,t):new B([...(S=l[this.model][t].raw(this.color),Array.isArray(S)?S:[S]),this.valpha],t);var S},B[t]=function(){for(var V=arguments.length,i=new Array(V),S=0;S<V;S++)i[S]=arguments[S];let l=i[0];return"number"===typeof l&&(l=s(i,h)),new B(l,t)}}function J(h){return function(V){return function(h,V){return Number(h.toFixed(V))}(V,h)}}function I(h,V,i){h=Array.isArray(h)?h:[h];for(const S of h)(q[S]||(q[S]=[]))[V]=i;return h=h[0],function(S){let l;return void 0!==S?(i&&(S=i(S)),l=this[h](),l.color[V]=S,l):(l=this[h]().color[V],i&&(l=i(l)),l)}}function v(h){return function(V){return Math.max(0,Math.min(h,V))}}function s(h,V){for(let i=0;i<V;i++)"number"!==typeof h[i]&&(h[i]=0);return h}h.exports=B},13247:(h,V,i)=>{const S=i(13251),l={};for(const g of Object.keys(S))l[S[g]]=g;const Y={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};h.exports=Y;for(const g of Object.keys(Y)){if(!("channels"in Y[g]))throw new Error("missing channels property: "+g);if(!("labels"in Y[g]))throw new Error("missing channel labels property: "+g);if(Y[g].labels.length!==Y[g].channels)throw new Error("channel and label counts mismatch: "+g);const{channels:h,labels:V}=Y[g];delete Y[g].channels,delete Y[g].labels,Object.defineProperty(Y[g],"channels",{value:h}),Object.defineProperty(Y[g],"labels",{value:V})}Y.rgb.hsl=function(h){const V=h[0]/255,i=h[1]/255,S=h[2]/255,l=Math.min(V,i,S),Y=Math.max(V,i,S),g=Y-l;let q,B;Y===l?q=0:V===Y?q=(i-S)/g:i===Y?q=2+(S-V)/g:S===Y&&(q=4+(V-i)/g),q=Math.min(60*q,360),q<0&&(q+=360);const J=(l+Y)/2;return B=Y===l?0:J<=.5?g/(Y+l):g/(2-Y-l),[q,100*B,100*J]},Y.rgb.hsv=function(h){let V,i,S,l,Y;const g=h[0]/255,q=h[1]/255,B=h[2]/255,J=Math.max(g,q,B),I=J-Math.min(g,q,B),v=function(h){return(J-h)/6/I+.5};return 0===I?(l=0,Y=0):(Y=I/J,V=v(g),i=v(q),S=v(B),g===J?l=S-i:q===J?l=1/3+V-S:B===J&&(l=2/3+i-V),l<0?l+=1:l>1&&(l-=1)),[360*l,100*Y,100*J]},Y.rgb.hwb=function(h){const V=h[0],i=h[1];let S=h[2];const l=Y.rgb.hsl(h)[0],g=1/255*Math.min(V,Math.min(i,S));return S=1-1/255*Math.max(V,Math.max(i,S)),[l,100*g,100*S]},Y.rgb.cmyk=function(h){const V=h[0]/255,i=h[1]/255,S=h[2]/255,l=Math.min(1-V,1-i,1-S);return[100*((1-V-l)/(1-l)||0),100*((1-i-l)/(1-l)||0),100*((1-S-l)/(1-l)||0),100*l]},Y.rgb.keyword=function(h){const V=l[h];if(V)return V;let i,Y=1/0;for(const l of Object.keys(S)){const V=S[l],B=(q=V,((g=h)[0]-q[0])**2+(g[1]-q[1])**2+(g[2]-q[2])**2);B<Y&&(Y=B,i=l)}var g,q;return i},Y.keyword.rgb=function(h){return S[h]},Y.rgb.xyz=function(h){let V=h[0]/255,i=h[1]/255,S=h[2]/255;V=V>.04045?((V+.055)/1.055)**2.4:V/12.92,i=i>.04045?((i+.055)/1.055)**2.4:i/12.92,S=S>.04045?((S+.055)/1.055)**2.4:S/12.92;return[100*(.4124*V+.3576*i+.1805*S),100*(.2126*V+.7152*i+.0722*S),100*(.0193*V+.1192*i+.9505*S)]},Y.rgb.lab=function(h){const V=Y.rgb.xyz(h);let i=V[0],S=V[1],l=V[2];i/=95.047,S/=100,l/=108.883,i=i>.008856?i**(1/3):7.787*i+16/116,S=S>.008856?S**(1/3):7.787*S+16/116,l=l>.008856?l**(1/3):7.787*l+16/116;return[116*S-16,500*(i-S),200*(S-l)]},Y.hsl.rgb=function(h){const V=h[0]/360,i=h[1]/100,S=h[2]/100;let l,Y,g;if(0===i)return g=255*S,[g,g,g];l=S<.5?S*(1+i):S+i-S*i;const q=2*S-l,B=[0,0,0];for(let J=0;J<3;J++)Y=V+1/3*-(J-1),Y<0&&Y++,Y>1&&Y--,g=6*Y<1?q+6*(l-q)*Y:2*Y<1?l:3*Y<2?q+(l-q)*(2/3-Y)*6:q,B[J]=255*g;return B},Y.hsl.hsv=function(h){const V=h[0];let i=h[1]/100,S=h[2]/100,l=i;const Y=Math.max(S,.01);S*=2,i*=S<=1?S:2-S,l*=Y<=1?Y:2-Y;return[V,100*(0===S?2*l/(Y+l):2*i/(S+i)),100*((S+i)/2)]},Y.hsv.rgb=function(h){const V=h[0]/60,i=h[1]/100;let S=h[2]/100;const l=Math.floor(V)%6,Y=V-Math.floor(V),g=255*S*(1-i),q=255*S*(1-i*Y),B=255*S*(1-i*(1-Y));switch(S*=255,l){case 0:return[S,B,g];case 1:return[q,S,g];case 2:return[g,S,B];case 3:return[g,q,S];case 4:return[B,g,S];case 5:return[S,g,q]}},Y.hsv.hsl=function(h){const V=h[0],i=h[1]/100,S=h[2]/100,l=Math.max(S,.01);let Y,g;g=(2-i)*S;const q=(2-i)*l;return Y=i*l,Y/=q<=1?q:2-q,Y=Y||0,g/=2,[V,100*Y,100*g]},Y.hwb.rgb=function(h){const V=h[0]/360;let i=h[1]/100,S=h[2]/100;const l=i+S;let Y;l>1&&(i/=l,S/=l);const g=Math.floor(6*V),q=1-S;Y=6*V-g,0!==(1&g)&&(Y=1-Y);const B=i+Y*(q-i);let J,I,v;switch(g){default:case 6:case 0:J=q,I=B,v=i;break;case 1:J=B,I=q,v=i;break;case 2:J=i,I=q,v=B;break;case 3:J=i,I=B,v=q;break;case 4:J=B,I=i,v=q;break;case 5:J=q,I=i,v=B}return[255*J,255*I,255*v]},Y.cmyk.rgb=function(h){const V=h[0]/100,i=h[1]/100,S=h[2]/100,l=h[3]/100;return[255*(1-Math.min(1,V*(1-l)+l)),255*(1-Math.min(1,i*(1-l)+l)),255*(1-Math.min(1,S*(1-l)+l))]},Y.xyz.rgb=function(h){const V=h[0]/100,i=h[1]/100,S=h[2]/100;let l,Y,g;return l=3.2406*V+-1.5372*i+-.4986*S,Y=-.9689*V+1.8758*i+.0415*S,g=.0557*V+-.204*i+1.057*S,l=l>.0031308?1.055*l**(1/2.4)-.055:12.92*l,Y=Y>.0031308?1.055*Y**(1/2.4)-.055:12.92*Y,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,l=Math.min(Math.max(0,l),1),Y=Math.min(Math.max(0,Y),1),g=Math.min(Math.max(0,g),1),[255*l,255*Y,255*g]},Y.xyz.lab=function(h){let V=h[0],i=h[1],S=h[2];V/=95.047,i/=100,S/=108.883,V=V>.008856?V**(1/3):7.787*V+16/116,i=i>.008856?i**(1/3):7.787*i+16/116,S=S>.008856?S**(1/3):7.787*S+16/116;return[116*i-16,500*(V-i),200*(i-S)]},Y.lab.xyz=function(h){let V,i,S;i=(h[0]+16)/116,V=h[1]/500+i,S=i-h[2]/200;const l=i**3,Y=V**3,g=S**3;return i=l>.008856?l:(i-16/116)/7.787,V=Y>.008856?Y:(V-16/116)/7.787,S=g>.008856?g:(S-16/116)/7.787,V*=95.047,i*=100,S*=108.883,[V,i,S]},Y.lab.lch=function(h){const V=h[0],i=h[1],S=h[2];let l;l=360*Math.atan2(S,i)/2/Math.PI,l<0&&(l+=360);return[V,Math.sqrt(i*i+S*S),l]},Y.lch.lab=function(h){const V=h[0],i=h[1],S=h[2]/360*2*Math.PI;return[V,i*Math.cos(S),i*Math.sin(S)]},Y.rgb.ansi16=function(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[i,S,l]=h;let g=null===V?Y.rgb.hsv(h)[2]:V;if(g=Math.round(g/50),0===g)return 30;let q=30+(Math.round(l/255)<<2|Math.round(S/255)<<1|Math.round(i/255));return 2===g&&(q+=60),q},Y.hsv.ansi16=function(h){return Y.rgb.ansi16(Y.hsv.rgb(h),h[2])},Y.rgb.ansi256=function(h){const V=h[0],i=h[1],S=h[2];if(V===i&&i===S)return V<8?16:V>248?231:Math.round((V-8)/247*24)+232;return 16+36*Math.round(V/255*5)+6*Math.round(i/255*5)+Math.round(S/255*5)},Y.ansi16.rgb=function(h){let V=h%10;if(0===V||7===V)return h>50&&(V+=3.5),V=V/10.5*255,[V,V,V];const i=.5*(1+~~(h>50));return[(1&V)*i*255,(V>>1&1)*i*255,(V>>2&1)*i*255]},Y.ansi256.rgb=function(h){if(h>=232){const V=10*(h-232)+8;return[V,V,V]}let V;h-=16;return[Math.floor(h/36)/5*255,Math.floor((V=h%36)/6)/5*255,V%6/5*255]},Y.rgb.hex=function(h){const V=(((255&Math.round(h[0]))<<16)+((255&Math.round(h[1]))<<8)+(255&Math.round(h[2]))).toString(16).toUpperCase();return"000000".substring(V.length)+V},Y.hex.rgb=function(h){const V=h.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!V)return[0,0,0];let i=V[0];3===V[0].length&&(i=i.split("").map((h=>h+h)).join(""));const S=parseInt(i,16);return[S>>16&255,S>>8&255,255&S]},Y.rgb.hcg=function(h){const V=h[0]/255,i=h[1]/255,S=h[2]/255,l=Math.max(Math.max(V,i),S),Y=Math.min(Math.min(V,i),S),g=l-Y;let q,B;return q=g<1?Y/(1-g):0,B=g<=0?0:l===V?(i-S)/g%6:l===i?2+(S-V)/g:4+(V-i)/g,B/=6,B%=1,[360*B,100*g,100*q]},Y.hsl.hcg=function(h){const V=h[1]/100,i=h[2]/100,S=i<.5?2*V*i:2*V*(1-i);let l=0;return S<1&&(l=(i-.5*S)/(1-S)),[h[0],100*S,100*l]},Y.hsv.hcg=function(h){const V=h[1]/100,i=h[2]/100,S=V*i;let l=0;return S<1&&(l=(i-S)/(1-S)),[h[0],100*S,100*l]},Y.hcg.rgb=function(h){const V=h[0]/360,i=h[1]/100,S=h[2]/100;if(0===i)return[255*S,255*S,255*S];const l=[0,0,0],Y=V%1*6,g=Y%1,q=1-g;let B=0;switch(Math.floor(Y)){case 0:l[0]=1,l[1]=g,l[2]=0;break;case 1:l[0]=q,l[1]=1,l[2]=0;break;case 2:l[0]=0,l[1]=1,l[2]=g;break;case 3:l[0]=0,l[1]=q,l[2]=1;break;case 4:l[0]=g,l[1]=0,l[2]=1;break;default:l[0]=1,l[1]=0,l[2]=q}return B=(1-i)*S,[255*(i*l[0]+B),255*(i*l[1]+B),255*(i*l[2]+B)]},Y.hcg.hsv=function(h){const V=h[1]/100,i=V+h[2]/100*(1-V);let S=0;return i>0&&(S=V/i),[h[0],100*S,100*i]},Y.hcg.hsl=function(h){const V=h[1]/100,i=h[2]/100*(1-V)+.5*V;let S=0;return i>0&&i<.5?S=V/(2*i):i>=.5&&i<1&&(S=V/(2*(1-i))),[h[0],100*S,100*i]},Y.hcg.hwb=function(h){const V=h[1]/100,i=V+h[2]/100*(1-V);return[h[0],100*(i-V),100*(1-i)]},Y.hwb.hcg=function(h){const V=h[1]/100,i=1-h[2]/100,S=i-V;let l=0;return S<1&&(l=(i-S)/(1-S)),[h[0],100*S,100*l]},Y.apple.rgb=function(h){return[h[0]/65535*255,h[1]/65535*255,h[2]/65535*255]},Y.rgb.apple=function(h){return[h[0]/255*65535,h[1]/255*65535,h[2]/255*65535]},Y.gray.rgb=function(h){return[h[0]/100*255,h[0]/100*255,h[0]/100*255]},Y.gray.hsl=function(h){return[0,0,h[0]]},Y.gray.hsv=Y.gray.hsl,Y.gray.hwb=function(h){return[0,100,h[0]]},Y.gray.cmyk=function(h){return[0,0,0,h[0]]},Y.gray.lab=function(h){return[h[0],0,0]},Y.gray.hex=function(h){const V=255&Math.round(h[0]/100*255),i=((V<<16)+(V<<8)+V).toString(16).toUpperCase();return"000000".substring(i.length)+i},Y.rgb.gray=function(h){return[(h[0]+h[1]+h[2])/3/255*100]}},13242:(h,V,i)=>{const S=i(13247),l=i(13254),Y={};Object.keys(S).forEach((h=>{Y[h]={},Object.defineProperty(Y[h],"channels",{value:S[h].channels}),Object.defineProperty(Y[h],"labels",{value:S[h].labels});const V=l(h);Object.keys(V).forEach((i=>{const S=V[i];Y[h][i]=function(h){const V=function(){for(var V=arguments.length,i=new Array(V),S=0;S<V;S++)i[S]=arguments[S];const l=i[0];if(void 0===l||null===l)return l;l.length>1&&(i=l);const Y=h(i);if("object"===typeof Y)for(let h=Y.length,g=0;g<h;g++)Y[g]=Math.round(Y[g]);return Y};return"conversion"in h&&(V.conversion=h.conversion),V}(S),Y[h][i].raw=function(h){const V=function(){for(var V=arguments.length,i=new Array(V),S=0;S<V;S++)i[S]=arguments[S];const l=i[0];return void 0===l||null===l?l:(l.length>1&&(i=l),h(i))};return"conversion"in h&&(V.conversion=h.conversion),V}(S)}))})),h.exports=Y},13254:(h,V,i)=>{const S=i(13247);function l(h){const V=function(){const h={},V=Object.keys(S);for(let i=V.length,S=0;S<i;S++)h[V[S]]={distance:-1,parent:null};return h}(),i=[h];for(V[h].distance=0;i.length;){const h=i.pop(),l=Object.keys(S[h]);for(let S=l.length,Y=0;Y<S;Y++){const S=l[Y],g=V[S];-1===g.distance&&(g.distance=V[h].distance+1,g.parent=h,i.unshift(S))}}return V}function Y(h,V){return function(i){return V(h(i))}}function g(h,V){const i=[V[h].parent,h];let l=S[V[h].parent][h],g=V[h].parent;for(;V[g].parent;)i.unshift(V[g].parent),l=Y(S[V[g].parent][g],l),g=V[g].parent;return l.conversion=i,l}h.exports=function(h){const V=l(h),i={},S=Object.keys(V);for(let l=S.length,Y=0;Y<l;Y++){const h=S[Y];null!==V[h].parent&&(i[h]=g(h,V))}return i}},13251:h=>{"use strict";h.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11823:function(h,V,i){"use strict";var S=this&&this.__createBinding||(Object.create?function(h,V,i,S){void 0===S&&(S=i);var l=Object.getOwnPropertyDescriptor(V,i);l&&!("get"in l?!V.__esModule:l.writable||l.configurable)||(l={enumerable:!0,get:function(){return V[i]}}),Object.defineProperty(h,S,l)}:function(h,V,i,S){void 0===S&&(S=i),h[S]=V[i]}),l=this&&this.__setModuleDefault||(Object.create?function(h,V){Object.defineProperty(h,"default",{enumerable:!0,value:V})}:function(h,V){h.default=V}),Y=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var V={};if(null!=h)for(var i in h)"default"!==i&&Object.prototype.hasOwnProperty.call(h,i)&&S(V,h,i);return l(V,h),V},g=this&&this.__awaiter||function(h,V,i,S){return new(i||(i=Promise))((function(l,Y){function g(h){try{B(S.next(h))}catch(V){Y(V)}}function q(h){try{B(S.throw(h))}catch(V){Y(V)}}function B(h){var V;h.done?l(h.value):(V=h.value,V instanceof i?V:new i((function(h){h(V)}))).then(g,q)}B((S=S.apply(h,V||[])).next())}))};Object.defineProperty(V,"__esModule",{value:!0}),V.Auth=V.Platform=void 0;const q=Y(i(11764)),B=i(11829),J="colyseus-auth-token";!function(h){h.ios="ios",h.android="android"}(V.Platform||(V.Platform={}));V.Auth=class{constructor(h){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=h.replace("ws","http"),(0,B.getItem)(J,(h=>this.token=h))}get hasToken(){return!!this.token}login(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return g(this,void 0,void 0,(function*(){const V=Object.assign({},h);this.hasToken&&(V.token=this.token);const i=yield this.request("post","/auth",V);this.token=i.token,(0,B.setItem)(J,this.token);for(let h in i)this.hasOwnProperty(h)&&(this[h]=i[h]);return this.registerPingService(),this}))}save(){return g(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return g(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return g(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return g(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(h){return g(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:h})}))}acceptFriendRequest(h){return g(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:h})}))}declineFriendRequest(h){return g(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:h})}))}blockUser(h){return g(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:h})}))}unblockUser(h){return g(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:h})}))}request(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=arguments.length>3?arguments[3]:void 0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return g(this,void 0,void 0,(function*(){l.Accept="application/json",this.hasToken&&(l.Authorization="Bearer "+this.token);const Y=[];for(const h in i)Y.push(`${h}=${i[h]}`);const g=Y.length>0?`?${Y.join("&")}`:"",B={headers:l};return S&&(B.body=S),(yield q[h](`${this.endpoint}${V}${g}`,B)).data}))}logout(){this.token=void 0,(0,B.removeItem)(J),this.unregisterPingService()}registerPingService(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),h)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11756:function(h,V,i){"use strict";var S,l=this&&this.__awaiter||function(h,V,i,S){return new(i||(i=Promise))((function(l,Y){function g(h){try{B(S.next(h))}catch(V){Y(V)}}function q(h){try{B(S.throw(h))}catch(V){Y(V)}}function B(h){var V;h.done?l(h.value):(V=h.value,V instanceof i?V:new i((function(h){h(V)}))).then(g,q)}B((S=S.apply(h,V||[])).next())}))};Object.defineProperty(V,"__esModule",{value:!0}),V.Client=V.MatchMakeError=void 0;const Y=i(11764),g=i(11770),q=i(11776);class B extends Error{constructor(h,V){super(h),this.code=V,Object.setPrototypeOf(this,B.prototype)}}V.MatchMakeError=B;const J="undefined"!==typeof window&&"undefined"!==typeof(null===(S=null===window||void 0===window?void 0:window.location)||void 0===S?void 0:S.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";V.Client=class{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J;if("string"===typeof h){const V=new URL(h),i="https:"===V.protocol||"wss:"===V.protocol,S=Number(V.port||(i?443:80));this.settings={hostname:V.hostname,pathname:"/"!==V.pathname?V.pathname:"",port:S,secure:i}}else void 0===h.port&&(h.port=h.secure?443:80),void 0===h.pathname&&(h.pathname=""),this.settings=h}joinOrCreate(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return l(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",h,V,i)}))}create(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return l(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",h,V,i)}))}join(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return l(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",h,V,i)}))}joinById(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return l(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",h,V,i)}))}reconnect(h,V){return l(this,void 0,void 0,(function*(){if("string"===typeof h&&"string"===typeof V)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[i,S]=h.split(":");return yield this.createMatchMakeRequest("reconnect",i,{reconnectionToken:S},V)}))}getAvailableRooms(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return l(this,void 0,void 0,(function*(){return(yield(0,Y.get)(this.getHttpEndpoint(`${h}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(h,V,i){return l(this,void 0,void 0,(function*(){const S=this.createRoom(h.room.name,V);S.roomId=h.room.roomId,S.sessionId=h.sessionId;const Y={sessionId:S.sessionId};h.reconnectionToken&&(Y.reconnectionToken=h.reconnectionToken);const q=i||S;return S.connect(this.buildEndpoint(h.room,Y),h.devMode&&(()=>l(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${S.roomId}'...`);let i=0;const Y=()=>l(this,void 0,void 0,(function*(){i++;try{yield this.consumeSeatReservation(h,V,q),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${S.roomId}'`)}catch(l){i<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${i} out of 8)`),setTimeout(Y,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(Y,2e3)}))),q),new Promise(((h,V)=>{const i=(h,i)=>V(new g.ServerError(h,i));q.onError.once(i),q.onJoin.once((()=>{q.onError.remove(i),h(q)}))}))}))}createMatchMakeRequest(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;return l(this,void 0,void 0,(function*(){const l=(yield(0,Y.post)(this.getHttpEndpoint(`${h}/${V}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)})).data;if(l.error)throw new B(l.error,l.code);return"reconnect"===h&&(l.reconnectionToken=i.reconnectionToken),yield this.consumeSeatReservation(l,S,g)}))}createRoom(h,V){return new q.Room(h,V)}buildEndpoint(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=[];for(const l in V)V.hasOwnProperty(l)&&i.push(`${l}=${V[l]}`);let S=this.settings.secure?"wss://":"ws://";return h.publicAddress?S+=`${h.publicAddress}`:S+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${S}/${h.processId}/${h.roomId}?${i.join("&")}`}getHttpEndpoint(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${h}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11784:(h,V,i)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.Connection=void 0;const S=i(11787);V.Connection=class{constructor(){this.events={},this.transport=new S.WebSocketTransport(this.events)}send(h){this.transport.send(h)}connect(h){this.transport.connect(h)}close(h,V){this.transport.close(h,V)}get isOpen(){return this.transport.isOpen}}},11799:(h,V)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.utf8Length=V.utf8Read=V.ErrorCode=V.Protocol=void 0,function(h){h[h.HANDSHAKE=9]="HANDSHAKE",h[h.JOIN_ROOM=10]="JOIN_ROOM",h[h.ERROR=11]="ERROR",h[h.LEAVE_ROOM=12]="LEAVE_ROOM",h[h.ROOM_DATA=13]="ROOM_DATA",h[h.ROOM_STATE=14]="ROOM_STATE",h[h.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",h[h.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",h[h.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(V.Protocol||(V.Protocol={})),function(h){h[h.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",h[h.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",h[h.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",h[h.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",h[h.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",h[h.AUTH_FAILED=4215]="AUTH_FAILED",h[h.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(V.ErrorCode||(V.ErrorCode={})),V.utf8Read=function(h,V){const i=h[V++];for(var S="",l=0,Y=V,g=V+i;Y<g;Y++){var q=h[Y];if(0!==(128&q))if(192!==(224&q))if(224!==(240&q)){if(240!==(248&q))throw new Error("Invalid byte "+q.toString(16));(l=(7&q)<<18|(63&h[++Y])<<12|(63&h[++Y])<<6|63&h[++Y])>=65536?(l-=65536,S+=String.fromCharCode(55296+(l>>>10),56320+(1023&l))):S+=String.fromCharCode(l)}else S+=String.fromCharCode((15&q)<<12|(63&h[++Y])<<6|63&h[++Y]);else S+=String.fromCharCode((31&q)<<6|63&h[++Y]);else S+=String.fromCharCode(q)}return S},V.utf8Length=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",V=0,i=0;for(let S=0,l=h.length;S<l;S++)V=h.charCodeAt(S),V<128?i+=1:V<2048?i+=2:V<55296||V>=57344?i+=3:(S++,i+=4);return i+1}},11776:function(h,V,i){"use strict";var S=this&&this.__createBinding||(Object.create?function(h,V,i,S){void 0===S&&(S=i);var l=Object.getOwnPropertyDescriptor(V,i);l&&!("get"in l?!V.__esModule:l.writable||l.configurable)||(l={enumerable:!0,get:function(){return V[i]}}),Object.defineProperty(h,S,l)}:function(h,V,i,S){void 0===S&&(S=i),h[S]=V[i]}),l=this&&this.__setModuleDefault||(Object.create?function(h,V){Object.defineProperty(h,"default",{enumerable:!0,value:V})}:function(h,V){h.default=V}),Y=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var V={};if(null!=h)for(var i in h)"default"!==i&&Object.prototype.hasOwnProperty.call(h,i)&&S(V,h,i);return l(V,h),V};Object.defineProperty(V,"__esModule",{value:!0}),V.Room=void 0;const g=Y(i(11779)),q=i(11784),B=i(11799),J=i(11801),I=i(11809),v=i(11812),s=i(11819),t=i(11770);class T{constructor(h,V){this.onStateChange=(0,v.createSignal)(),this.onError=(0,v.createSignal)(),this.onLeave=(0,v.createSignal)(),this.onJoin=(0,v.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,I.createNanoEvents)(),this.roomId=null,this.name=h,V&&(this.serializer=new((0,J.getSerializer)("schema")),this.rootSchema=V,this.serializer.state=new V),this.onError(((h,V)=>{var i;return null===(i=console.warn)||void 0===i?void 0:i.call(console,`colyseus.js - onError => (${h}) ${V}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const S=new q.Connection;i.connection=S,S.events.onmessage=T.prototype.onMessageCallback.bind(i),S.events.onclose=function(h){var S;if(!i.hasJoined)return null===(S=console.warn)||void 0===S||S.call(console,`Room connection was closed unexpectedly (${h.code}): ${h.reason}`),void i.onError.invoke(h.code,h.reason);h.code===t.CloseCode.DEVMODE_RESTART&&V?V():(i.onLeave.invoke(h.code),i.destroy())},S.events.onerror=function(h){var V;null===(V=console.warn)||void 0===V||V.call(console,`Room, onError (${h.code}): ${h.reason}`),i.onError.invoke(h.code,h.reason)},S.connect(h)}leave(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((V=>{this.onLeave((h=>V(h))),this.connection?h?this.connection.send([B.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(t.CloseCode.CONSENTED)}))}onMessage(h,V){return this.onMessageHandlers.on(this.getMessageHandlerKey(h),V)}send(h,V){const i=[B.Protocol.ROOM_DATA];let S;if("string"===typeof h?s.encode.string(i,h):s.encode.number(i,h),void 0!==V){const h=g.encode(V);S=new Uint8Array(i.length+h.byteLength),S.set(new Uint8Array(i),0),S.set(new Uint8Array(h),i.length)}else S=new Uint8Array(i);this.connection.send(S.buffer)}sendBytes(h,V){const i=[B.Protocol.ROOM_DATA_BYTES];let S;"string"===typeof h?s.encode.string(i,h):s.encode.number(i,h),S=new Uint8Array(i.length+(V.byteLength||V.length)),S.set(new Uint8Array(i),0),S.set(new Uint8Array(V),i.length),this.connection.send(S.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(h){const V=Array.from(new Uint8Array(h.data)),i=V[0];if(i===B.Protocol.JOIN_ROOM){let h=1;const i=(0,B.utf8Read)(V,h);if(h+=(0,B.utf8Length)(i),this.serializerId=(0,B.utf8Read)(V,h),h+=(0,B.utf8Length)(this.serializerId),!this.serializer){const h=(0,J.getSerializer)(this.serializerId);this.serializer=new h}V.length>h&&this.serializer.handshake&&this.serializer.handshake(V,{offset:h}),this.reconnectionToken=`${this.roomId}:${i}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([B.Protocol.JOIN_ROOM])}else if(i===B.Protocol.ERROR){const h={offset:1},i=s.decode.number(V,h),S=s.decode.string(V,h);this.onError.invoke(i,S)}else if(i===B.Protocol.LEAVE_ROOM)this.leave();else if(i===B.Protocol.ROOM_DATA_SCHEMA){const h={offset:1},i=this.serializer.getState().constructor._context.get(s.decode.number(V,h)),S=new i;S.decode(V,h),this.dispatchMessage(i,S)}else if(i===B.Protocol.ROOM_STATE)V.shift(),this.setState(V);else if(i===B.Protocol.ROOM_STATE_PATCH)V.shift(),this.patch(V);else if(i===B.Protocol.ROOM_DATA){const i={offset:1},S=s.decode.stringCheck(V,i)?s.decode.string(V,i):s.decode.number(V,i),l=V.length>i.offset?g.decode(h.data,i.offset):void 0;this.dispatchMessage(S,l)}else if(i===B.Protocol.ROOM_DATA_BYTES){const h={offset:1},i=s.decode.stringCheck(V,h)?s.decode.string(V,h):s.decode.number(V,h);this.dispatchMessage(i,new Uint8Array(V.slice(h.offset)))}}setState(h){this.serializer.setState(h),this.onStateChange.invoke(this.serializer.getState())}patch(h){this.serializer.patch(h),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(h,V){var i;const S=this.getMessageHandlerKey(h);this.onMessageHandlers.events[S]?this.onMessageHandlers.emit(S,V):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",h,V):null===(i=console.warn)||void 0===i||i.call(console,`colyseus.js: onMessage() not registered for type '${h}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(h){switch(typeof h){case"function":return`$${h._typeid}`;case"string":return h;case"number":return`i${h}`;default:throw new Error("invalid message type.")}}}V.Room=T},11829:(h,V)=>{"use strict";let i;function S(){return i||(i="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(h,V){this.cache[h]=V},getItem:function(h){this.cache[h]},removeItem:function(h){delete this.cache[h]}}),i}Object.defineProperty(V,"__esModule",{value:!0}),V.getItem=V.removeItem=V.setItem=void 0,V.setItem=function(h,V){S().setItem(h,V)},V.removeItem=function(h){S().removeItem(h)},V.getItem=function(h,V){const i=S().getItem(h);"undefined"!==typeof Promise&&i instanceof Promise?i.then((h=>V(h))):V(i)}},11809:(h,V)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.createNanoEvents=void 0;V.createNanoEvents=()=>({emit(h){let V=this.events[h]||[];for(var i=arguments.length,S=new Array(i>1?i-1:0),l=1;l<i;l++)S[l-1]=arguments[l];for(let Y=0,g=V.length;Y<g;Y++)V[Y](...S)},events:{},on(h,V){var i;return(null===(i=this.events[h])||void 0===i?void 0:i.push(V))||(this.events[h]=[V]),()=>{var i;this.events[h]=null===(i=this.events[h])||void 0===i?void 0:i.filter((h=>V!==h))}}})},11812:(h,V)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.createSignal=V.EventEmitter=void 0;class i{constructor(){this.handlers=[]}register(h){return this.handlers.push(h),this}invoke(){for(var h=arguments.length,V=new Array(h),i=0;i<h;i++)V[i]=arguments[i];this.handlers.forEach((h=>h.apply(this,V)))}invokeAsync(){for(var h=arguments.length,V=new Array(h),i=0;i<h;i++)V[i]=arguments[i];return Promise.all(this.handlers.map((h=>h.apply(this,V))))}remove(h){const V=this.handlers.indexOf(h);this.handlers[V]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}V.EventEmitter=i,V.createSignal=function(){const h=new i;function V(V){return h.register(V,null===this)}return V.once=V=>{const i=function(){for(var S=arguments.length,l=new Array(S),Y=0;Y<S;Y++)l[Y]=arguments[Y];V.apply(this,l),h.remove(i)};h.register(i)},V.remove=V=>h.remove(V),V.invoke=function(){return h.invoke(...arguments)},V.invokeAsync=function(){return h.invokeAsync(...arguments)},V.clear=()=>h.clear(),V}},11770:(h,V)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.ServerError=V.CloseCode=void 0,function(h){h[h.CONSENTED=4e3]="CONSENTED",h[h.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(V.CloseCode||(V.CloseCode={}));class i extends Error{constructor(h,V){super(V),this.name="ServerError",this.code=h}}V.ServerError=i},11748:(h,V,i)=>{"use strict";V.e=void 0,i(11752);var S=i(11756);Object.defineProperty(V,"e",{enumerable:!0,get:function(){return S.Client}});var l=i(11799);var Y=i(11776);var g=i(11823);const q=i(11831);const B=i(11835),J=i(11801);(0,J.registerSerializer)("schema",q.SchemaSerializer),(0,J.registerSerializer)("none",B.NoneSerializer)},11752:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=h=>null!==h&&"object"===typeof h&&h.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11779:(h,V)=>{"use strict";function i(h,V){if(this._offset=V,h instanceof ArrayBuffer)this._buffer=h,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(h))throw new Error("Invalid argument");this._buffer=h.buffer,this._view=new DataView(this._buffer,h.byteOffset,h.byteLength)}}Object.defineProperty(V,"__esModule",{value:!0}),V.decode=V.encode=void 0,i.prototype._array=function(h){for(var V=new Array(h),i=0;i<h;i++)V[i]=this._parse();return V},i.prototype._map=function(h){for(var V={},i=0;i<h;i++)V[this._parse()]=this._parse();return V},i.prototype._str=function(h){var V=function(h,V,i){for(var S="",l=0,Y=V,g=V+i;Y<g;Y++){var q=h.getUint8(Y);if(0!==(128&q))if(192!==(224&q))if(224!==(240&q)){if(240!==(248&q))throw new Error("Invalid byte "+q.toString(16));(l=(7&q)<<18|(63&h.getUint8(++Y))<<12|(63&h.getUint8(++Y))<<6|63&h.getUint8(++Y))>=65536?(l-=65536,S+=String.fromCharCode(55296+(l>>>10),56320+(1023&l))):S+=String.fromCharCode(l)}else S+=String.fromCharCode((15&q)<<12|(63&h.getUint8(++Y))<<6|63&h.getUint8(++Y));else S+=String.fromCharCode((31&q)<<6|63&h.getUint8(++Y));else S+=String.fromCharCode(q)}return S}(this._view,this._offset,h);return this._offset+=h,V},i.prototype._bin=function(h){var V=this._buffer.slice(this._offset,this._offset+h);return this._offset+=h,V},i.prototype._parse=function(){var h,V=this._view.getUint8(this._offset++),i=0,S=0,l=0,Y=0;if(V<192)return V<128?V:V<144?this._map(15&V):V<160?this._array(15&V):this._str(31&V);if(V>223)return-1*(255-V+1);switch(V){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:if(i=this._view.getUint8(this._offset),S=this._view.getInt8(this._offset+1),this._offset+=2,-1===S){var g=this._view.getUint32(this._offset);return l=this._view.getInt32(this._offset+4),Y=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*l+Y)+g/1e6)}return[S,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),S=this._view.getInt8(this._offset+2),this._offset+=3,[S,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),S=this._view.getInt8(this._offset+4),this._offset+=5,[S,this._bin(i)];case 202:return h=this._view.getFloat32(this._offset),this._offset+=4,h;case 203:return h=this._view.getFloat64(this._offset),this._offset+=8,h;case 204:return h=this._view.getUint8(this._offset),this._offset+=1,h;case 205:return h=this._view.getUint16(this._offset),this._offset+=2,h;case 206:return h=this._view.getUint32(this._offset),this._offset+=4,h;case 207:return l=this._view.getUint32(this._offset)*Math.pow(2,32),Y=this._view.getUint32(this._offset+4),this._offset+=8,l+Y;case 208:return h=this._view.getInt8(this._offset),this._offset+=1,h;case 209:return h=this._view.getInt16(this._offset),this._offset+=2,h;case 210:return h=this._view.getInt32(this._offset),this._offset+=4,h;case 211:return l=this._view.getInt32(this._offset)*Math.pow(2,32),Y=this._view.getUint32(this._offset+4),this._offset+=8,l+Y;case 212:return S=this._view.getInt8(this._offset),this._offset+=1,0===S?void(this._offset+=1):[S,this._bin(1)];case 213:return S=this._view.getInt8(this._offset),this._offset+=1,[S,this._bin(2)];case 214:return S=this._view.getInt8(this._offset),this._offset+=1,-1===S?(h=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*h)):[S,this._bin(4)];case 215:return S=this._view.getInt8(this._offset),this._offset+=1,0===S?(l=this._view.getInt32(this._offset)*Math.pow(2,32),Y=this._view.getUint32(this._offset+4),this._offset+=8,new Date(l+Y)):-1===S?(l=this._view.getUint32(this._offset),Y=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&l)+Y)+(l>>>2)/1e6)):[S,this._bin(8)];case 216:return S=this._view.getInt8(this._offset),this._offset+=1,[S,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")},V.decode=function(h){var V=new i(h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),S=V._parse();if(V._offset!==h.byteLength)throw new Error(h.byteLength-V._offset+" trailing bytes");return S};function S(h,V,i){for(var S=0,l=0,Y=i.length;l<Y;l++)(S=i.charCodeAt(l))<128?h.setUint8(V++,S):S<2048?(h.setUint8(V++,192|S>>6),h.setUint8(V++,128|63&S)):S<55296||S>=57344?(h.setUint8(V++,224|S>>12),h.setUint8(V++,128|S>>6&63),h.setUint8(V++,128|63&S)):(l++,S=65536+((1023&S)<<10|1023&i.charCodeAt(l)),h.setUint8(V++,240|S>>18),h.setUint8(V++,128|S>>12&63),h.setUint8(V++,128|S>>6&63),h.setUint8(V++,128|63&S))}function l(h,V,i){var S=typeof i,Y=0,g=0,q=0,B=0,J=0,I=0;if("string"===S){if(J=function(h){for(var V=0,i=0,S=0,l=h.length;S<l;S++)(V=h.charCodeAt(S))<128?i+=1:V<2048?i+=2:V<55296||V>=57344?i+=3:(S++,i+=4);return i}(i),J<32)h.push(160|J),I=1;else if(J<256)h.push(217,J),I=2;else if(J<65536)h.push(218,J>>8,J),I=3;else{if(!(J<4294967296))throw new Error("String too long");h.push(219,J>>24,J>>16,J>>8,J),I=5}return V.push({_str:i,_length:J,_offset:h.length}),I+J}if("number"===S)return Math.floor(i)===i&&isFinite(i)?i>=0?i<128?(h.push(i),1):i<256?(h.push(204,i),2):i<65536?(h.push(205,i>>8,i),3):i<4294967296?(h.push(206,i>>24,i>>16,i>>8,i),5):(q=i/Math.pow(2,32)|0,B=i>>>0,h.push(207,q>>24,q>>16,q>>8,q,B>>24,B>>16,B>>8,B),9):i>=-32?(h.push(i),1):i>=-128?(h.push(208,i),2):i>=-32768?(h.push(209,i>>8,i),3):i>=-2147483648?(h.push(210,i>>24,i>>16,i>>8,i),5):(q=Math.floor(i/Math.pow(2,32)),B=i>>>0,h.push(211,q>>24,q>>16,q>>8,q,B>>24,B>>16,B>>8,B),9):(h.push(203),V.push({_float:i,_length:8,_offset:h.length}),9);if("object"===S){if(null===i)return h.push(192),1;if(Array.isArray(i)){if((J=i.length)<16)h.push(144|J),I=1;else if(J<65536)h.push(220,J>>8,J),I=3;else{if(!(J<4294967296))throw new Error("Array too large");h.push(221,J>>24,J>>16,J>>8,J),I=5}for(Y=0;Y<J;Y++)I+=l(h,V,i[Y]);return I}if(i instanceof Date){var v=i.getTime(),s=Math.floor(v/1e3),t=1e6*(v-1e3*s);return s>=0&&t>=0&&s<=17179869183?0===t&&s<=4294967295?(h.push(214,255,s>>24,s>>16,s>>8,s),6):(q=s/4294967296,B=4294967295&s,h.push(215,255,t>>22,t>>14,t>>6,q,B>>24,B>>16,B>>8,B),10):(q=Math.floor(s/4294967296),B=s>>>0,h.push(199,12,255,t>>24,t>>16,t>>8,t,q>>24,q>>16,q>>8,q,B>>24,B>>16,B>>8,B),15)}if(i instanceof ArrayBuffer){if((J=i.byteLength)<256)h.push(196,J),I=2;else if(J<65536)h.push(197,J>>8,J),I=3;else{if(!(J<4294967296))throw new Error("Buffer too large");h.push(198,J>>24,J>>16,J>>8,J),I=5}return V.push({_bin:i,_length:J,_offset:h.length}),I+J}if("function"===typeof i.toJSON)return l(h,V,i.toJSON());var T=[],e="",n=Object.keys(i);for(Y=0,g=n.length;Y<g;Y++)void 0!==i[e=n[Y]]&&"function"!==typeof i[e]&&T.push(e);if((J=T.length)<16)h.push(128|J),I=1;else if(J<65536)h.push(222,J>>8,J),I=3;else{if(!(J<4294967296))throw new Error("Object too large");h.push(223,J>>24,J>>16,J>>8,J),I=5}for(Y=0;Y<J;Y++)I+=l(h,V,e=T[Y]),I+=l(h,V,i[e]);return I}if("boolean"===S)return h.push(i?195:194),1;if("undefined"===S)return h.push(192),1;if("function"===typeof i.toJSON)return l(h,V,i.toJSON());throw new Error("Could not encode")}V.encode=function(h){var V=[],i=[],Y=l(V,i,h),g=new ArrayBuffer(Y),q=new DataView(g),B=0,J=0,I=-1;i.length>0&&(I=i[0]._offset);for(var v,s=0,t=0,T=0,e=V.length;T<e;T++)if(q.setUint8(J+T,V[T]),T+1===I){if(s=(v=i[B])._length,t=J+I,v._bin)for(var n=new Uint8Array(v._bin),c=0;c<s;c++)q.setUint8(t+c,n[c]);else v._str?S(q,t,v._str):void 0!==v._float&&q.setFloat64(t,v._float);J+=s,i[++B]&&(I=i[B]._offset)}return g}},11835:(h,V)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.NoneSerializer=void 0;V.NoneSerializer=class{setState(h){}getState(){return null}patch(h){}teardown(){}handshake(h){}}},11831:(h,V,i)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.SchemaSerializer=void 0;const S=i(11819);V.SchemaSerializer=class{setState(h){return this.state.decode(h)}getState(){return this.state}patch(h){return this.state.decode(h)}teardown(){var h,V;null===(V=null===(h=this.state)||void 0===h?void 0:h.$changes)||void 0===V||V.root.clearRefs()}handshake(h,V){if(this.state){(new S.Reflection).decode(h,V)}else this.state=S.Reflection.decode(h,V)}}},11801:(h,V)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.getSerializer=V.registerSerializer=void 0;const i={};V.registerSerializer=function(h,V){i[h]=V},V.getSerializer=function(h){const V=i[h];if(!V)throw new Error("missing serializer: "+h);return V}},11787:function(h,V,i){"use strict";var S=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(V,"__esModule",{value:!0}),V.WebSocketTransport=void 0;const l=S(i(11795)),Y=globalThis.WebSocket||l.default;V.WebSocketTransport=class{constructor(h){this.events=h}send(h){h instanceof ArrayBuffer?this.ws.send(h):Array.isArray(h)&&this.ws.send(new Uint8Array(h).buffer)}connect(h){this.ws=new Y(h,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(h,V){this.ws.close(h,V)}get isOpen(){return this.ws.readyState===Y.OPEN}}},11795:h=>{"use strict";h.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12190:h=>{"use strict";h.exports=function(h){for(var V=new Array(h),i=0;i<h;++i)V[i]=i;return V}},12194:h=>{function V(h){return!!h.constructor&&"function"===typeof h.constructor.isBuffer&&h.constructor.isBuffer(h)}h.exports=function(h){return null!=h&&(V(h)||function(h){return"function"===typeof h.readFloatLE&&"function"===typeof h.slice&&V(h.slice(0,0))}(h)||!!h._isBuffer)}},12182:(h,V,i)=>{var S=i(12190),l=i(12194),Y="undefined"!==typeof Float64Array;function g(h,V){return h[0]-V[0]}function q(){var h,V=this.stride,i=new Array(V.length);for(h=0;h<i.length;++h)i[h]=[Math.abs(V[h]),h];i.sort(g);var S=new Array(i.length);for(h=0;h<S.length;++h)S[h]=i[h][1];return S}function B(h,V){var i=["View",V,"d",h].join("");V<0&&(i="View_Nil"+h);var l="generic"===h;if(-1===V){var Y="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+h+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(Y)()}if(0===V){Y="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+h+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(l?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(l?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}";return new Function("TrivialArray",Y)(J[h][0])}Y=["'use strict'"];var g=S(V),B=g.map((function(h){return"i"+h})),I="this.offset+"+g.map((function(h){return"this.stride["+h+"]*i"+h})).join("+"),v=g.map((function(h){return"b"+h})).join(","),s=g.map((function(h){return"c"+h})).join(",");Y.push("function "+i+"(a,"+v+","+s+",d){this.data=a","this.shape=["+v+"]","this.stride=["+s+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+h+"'","proto.dimension="+V),Y.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+g.map((function(h){return"this.shape["+h+"]"})).join("*"),"}})"),1===V?Y.push("proto.order=[0]"):(Y.push("Object.defineProperty(proto,'order',{get:"),V<4?(Y.push("function "+i+"_order(){"),2===V?Y.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===V&&Y.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):Y.push("ORDER})")),Y.push("proto.set=function "+i+"_set("+B.join(",")+",v){"),l?Y.push("return this.data.set("+I+",v)}"):Y.push("return this.data["+I+"]=v}"),Y.push("proto.get=function "+i+"_get("+B.join(",")+"){"),l?Y.push("return this.data.get("+I+")}"):Y.push("return this.data["+I+"]}"),Y.push("proto.index=function "+i+"_index(",B.join(),"){return "+I+"}"),Y.push("proto.hi=function "+i+"_hi("+B.join(",")+"){return new "+i+"(this.data,"+g.map((function(h){return["(typeof i",h,"!=='number'||i",h,"<0)?this.shape[",h,"]:i",h,"|0"].join("")})).join(",")+","+g.map((function(h){return"this.stride["+h+"]"})).join(",")+",this.offset)}");var t=g.map((function(h){return"a"+h+"=this.shape["+h+"]"})),T=g.map((function(h){return"c"+h+"=this.stride["+h+"]"}));Y.push("proto.lo=function "+i+"_lo("+B.join(",")+"){var b=this.offset,d=0,"+t.join(",")+","+T.join(","));for(var e=0;e<V;++e)Y.push("if(typeof i"+e+"==='number'&&i"+e+">=0){d=i"+e+"|0;b+=c"+e+"*d;a"+e+"-=d}");Y.push("return new "+i+"(this.data,"+g.map((function(h){return"a"+h})).join(",")+","+g.map((function(h){return"c"+h})).join(",")+",b)}"),Y.push("proto.step=function "+i+"_step("+B.join(",")+"){var "+g.map((function(h){return"a"+h+"=this.shape["+h+"]"})).join(",")+","+g.map((function(h){return"b"+h+"=this.stride["+h+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(e=0;e<V;++e)Y.push("if(typeof i"+e+"==='number'){d=i"+e+"|0;if(d<0){c+=b"+e+"*(a"+e+"-1);a"+e+"=ceil(-a"+e+"/d)}else{a"+e+"=ceil(a"+e+"/d)}b"+e+"*=d}");Y.push("return new "+i+"(this.data,"+g.map((function(h){return"a"+h})).join(",")+","+g.map((function(h){return"b"+h})).join(",")+",c)}");var n=new Array(V),c=new Array(V);for(e=0;e<V;++e)n[e]="a[i"+e+"]",c[e]="b[i"+e+"]";Y.push("proto.transpose=function "+i+"_transpose("+B+"){"+B.map((function(h,V){return h+"=("+h+"===undefined?"+V+":"+h+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+n.join(",")+","+c.join(",")+",this.offset)}"),Y.push("proto.pick=function "+i+"_pick("+B+"){var a=[],b=[],c=this.offset");for(e=0;e<V;++e)Y.push("if(typeof i"+e+"==='number'&&i"+e+">=0){c=(c+this.stride["+e+"]*i"+e+")|0}else{a.push(this.shape["+e+"]);b.push(this.stride["+e+"])}");return Y.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),Y.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+g.map((function(h){return"shape["+h+"]"})).join(",")+","+g.map((function(h){return"stride["+h+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",Y.join("\n"))(J[h],q)}var J={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};h.exports=function(h,V,i,S){if(void 0===h)return(0,J.array[0])([]);"number"===typeof h&&(h=[h]),void 0===V&&(V=[h.length]);var g=V.length;if(void 0===i){i=new Array(g);for(var q=g-1,I=1;q>=0;--q)i[q]=I,I*=V[q]}if(void 0===S){S=0;for(q=0;q<g;++q)i[q]<0&&(S-=(V[q]-1)*i[q])}for(var v=function(h){if(l(h))return"buffer";if(Y)switch(Object.prototype.toString.call(h)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(h)?"array":"generic"}(h),s=J[v];s.length<=g+1;)s.push(B(v,s.length-1));return(0,s[g+1])(h,V,i,S)}},13192:h=>{var V;self,V=()=>(()=>{"use strict";var h={d:(V,i)=>{for(var S in i)h.o(i,S)&&!h.o(V,S)&&Object.defineProperty(V,S,{enumerable:!0,get:i[S]})},o:(h,V)=>Object.prototype.hasOwnProperty.call(h,V)},V={};h.d(V,{default:()=>G});var i,S=function(h,V){var i=V.x-h.x,S=V.y-h.y;return Math.sqrt(i*i+S*S)},l=function(h){return h*(Math.PI/180)},Y=new Map,g=function(h){Y.has(h)&&clearTimeout(Y.get(h)),Y.set(h,setTimeout(h,100))},q=function(h,V,i){for(var S,l=V.split(/[ ,]+/g),Y=0;Y<l.length;Y+=1)S=l[Y],h.addEventListener?h.addEventListener(S,i,!1):h.attachEvent&&h.attachEvent(S,i)},B=function(h,V,i){for(var S,l=V.split(/[ ,]+/g),Y=0;Y<l.length;Y+=1)S=l[Y],h.removeEventListener?h.removeEventListener(S,i):h.detachEvent&&h.detachEvent(S,i)},J=function(h){return h.preventDefault(),h.type.match(/^touch/)?h.changedTouches:h},I=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},v=function(h,V){V.top||V.right||V.bottom||V.left?(h.style.top=V.top,h.style.right=V.right,h.style.bottom=V.bottom,h.style.left=V.left):(h.style.left=V.x+"px",h.style.top=V.y+"px")},s=function(h,V,i){var S=t(h);for(var l in S)if(S.hasOwnProperty(l))if("string"==typeof V)S[l]=V+" "+i;else{for(var Y="",g=0,q=V.length;g<q;g+=1)Y+=V[g]+" "+i+", ";S[l]=Y.slice(0,-2)}return S},t=function(h){var V={};return V[h]="",["webkit","Moz","o"].forEach((function(i){V[i+h.charAt(0).toUpperCase()+h.slice(1)]=""})),V},T=function(h,V){for(var i in V)V.hasOwnProperty(i)&&(h[i]=V[i]);return h},e=function(h,V){if(h.length)for(var i=0,S=h.length;i<S;i+=1)V(h[i]);else V(h)},n="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,c=window.matchMedia("(any-hover: none)").matches,f=!!("ontouchstart"in window),P=!!window.PointerEvent,L=!!window.MSPointerEvent,U={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},X={start:"mousedown",move:"mousemove",end:"mouseup"},D={};function O(){}n&&!c?i=U:P?i={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:L?i={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:f?(i=U,D=X):i=X,O.prototype.on=function(h,V){var i,S=this,l=h.split(/[ ,]+/g);S._handlers_=S._handlers_||{};for(var Y=0;Y<l.length;Y+=1)i=l[Y],S._handlers_[i]=S._handlers_[i]||[],S._handlers_[i].push(V);return S},O.prototype.off=function(h,V){var i=this;return i._handlers_=i._handlers_||{},void 0===h?i._handlers_={}:void 0===V?i._handlers_[h]=null:i._handlers_[h]&&i._handlers_[h].indexOf(V)>=0&&i._handlers_[h].splice(i._handlers_[h].indexOf(V),1),i},O.prototype.trigger=function(h,V){var i,S=this,l=h.split(/[ ,]+/g);S._handlers_=S._handlers_||{};for(var Y=0;Y<l.length;Y+=1)i=l[Y],S._handlers_[i]&&S._handlers_[i].length&&S._handlers_[i].forEach((function(h){h.call(S,{type:i,target:S},V)}))},O.prototype.config=function(h){var V=this;V.options=V.defaults||{},h&&(V.options=function(h,V){var i={};for(var S in h)h.hasOwnProperty(S)&&V.hasOwnProperty(S)?i[S]=V[S]:h.hasOwnProperty(S)&&(i[S]=h[S]);return i}(V.options,h))},O.prototype.bindEvt=function(h,V){var S=this;return S._domHandlers_=S._domHandlers_||{},S._domHandlers_[V]=function(){"function"==typeof S["on"+V]?S["on"+V].apply(S,arguments):console.warn('[WARNING] : Missing "on'+V+'" handler.')},q(h,i[V],S._domHandlers_[V]),D[V]&&q(h,D[V],S._domHandlers_[V]),S},O.prototype.unbindEvt=function(h,V){var S=this;return S._domHandlers_=S._domHandlers_||{},B(h,i[V],S._domHandlers_[V]),D[V]&&B(h,D[V],S._domHandlers_[V]),delete S._domHandlers_[V],this};const o=O;function M(h,V){return this.identifier=V.identifier,this.position=V.position,this.frontPosition=V.frontPosition,this.collection=h,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(V),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=M.id,M.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}M.prototype=new o,M.constructor=M,M.id=0,M.prototype.buildEl=function(h){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},M.prototype.stylize=function(){if(this.options.dataOnly)return this;var h=this.options.fadeTime+"ms",V=function(){var h=t("borderRadius");for(var V in h)h.hasOwnProperty(V)&&(h[V]="50%");return h}(),i=s("transition","opacity",h),S={};return S.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},S.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},S.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},T(S.el,i),"circle"===this.options.shape&&T(S.back,V),T(S.front,V),this.applyStyles(S),this},M.prototype.applyStyles=function(h){for(var V in this.ui)if(this.ui.hasOwnProperty(V))for(var i in h[V])this.ui[V].style[i]=h[V][i];return this},M.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},M.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},M.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},M.prototype.show=function(h){var V=this;return V.options.dataOnly||(clearTimeout(V.removeTimeout),clearTimeout(V.showTimeout),clearTimeout(V.restTimeout),V.addToDom(),V.restCallback(),setTimeout((function(){V.ui.el.style.opacity=1}),0),V.showTimeout=setTimeout((function(){V.trigger("shown",V.instance),"function"==typeof h&&h.call(this)}),V.options.fadeTime)),V},M.prototype.hide=function(h){var V=this;if(V.options.dataOnly)return V;if(V.ui.el.style.opacity=V.options.restOpacity,clearTimeout(V.removeTimeout),clearTimeout(V.showTimeout),clearTimeout(V.restTimeout),V.removeTimeout=setTimeout((function(){var i="dynamic"===V.options.mode?"none":"block";V.ui.el.style.display=i,"function"==typeof h&&h.call(V),V.trigger("hidden",V.instance)}),V.options.fadeTime),V.options.restJoystick){var i=V.options.restJoystick,S={};S.x=!0===i||!1!==i.x?0:V.instance.frontPosition.x,S.y=!0===i||!1!==i.y?0:V.instance.frontPosition.y,V.setPosition(h,S)}return V},M.prototype.setPosition=function(h,V){var i=this;i.frontPosition={x:V.x,y:V.y};var S=i.options.fadeTime+"ms",l={};l.front=s("transition",["transform"],S);var Y={front:{}};Y.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(l),i.applyStyles(Y),i.restTimeout=setTimeout((function(){"function"==typeof h&&h.call(i),i.restCallback()}),i.options.fadeTime)},M.prototype.restCallback=function(){var h=this,V={};V.front=s("transition","none",""),h.applyStyles(V),h.trigger("rested",h.instance)},M.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},M.prototype.computeDirection=function(h){var V,i,S,l=h.angle.radian,Y=Math.PI/4,g=Math.PI/2;if(l>Y&&l<3*Y&&!h.lockX?V="up":l>-Y&&l<=Y&&!h.lockY?V="left":l>3*-Y&&l<=-Y&&!h.lockX?V="down":h.lockY||(V="right"),h.lockY||(i=l>-g&&l<g?"left":"right"),h.lockX||(S=l>0?"up":"down"),h.force>this.options.threshold){var q,B={};for(q in this.direction)this.direction.hasOwnProperty(q)&&(B[q]=this.direction[q]);var J={};for(q in this.direction={x:i,y:S,angle:V},h.direction=this.direction,B)B[q]===this.direction[q]&&(J[q]=!0);if(J.x&&J.y&&J.angle)return h;J.x&&J.y||this.trigger("plain",h),J.x||this.trigger("plain:"+i,h),J.y||this.trigger("plain:"+S,h),J.angle||this.trigger("dir dir:"+V,h)}else this.resetDirection();return h};const F=M;function E(h,V){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=h,i.id=E.id,E.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(V),"static"!==i.options.mode&&"semi"!==i.options.mode||(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);var S=getComputedStyle(i.options.zone.parentElement);return S&&"flex"===S.display&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.Nv(),i.begin(),i.nipples}E.prototype=new o,E.constructor=E,E.id=0,E.prototype.prepareNipples=function(){var h=this,V=h.nipples;V.on=h.on.bind(h),V.off=h.off.bind(h),V.options=h.options,V.destroy=h.destroy.bind(h),V.ids=h.ids,V.id=h.id,V.processOnMove=h.processOnMove.bind(h),V.processOnEnd=h.processOnEnd.bind(h),V.get=function(h){if(void 0===h)return V[0];for(var i=0,S=V.length;i<S;i+=1)if(V[i].identifier===h)return V[i];return!1}},E.prototype.Nv=function(){var h=this;h.bindEvt(h.options.zone,"start"),h.options.zone.style.touchAction="none",h.options.zone.style.msTouchAction="none"},E.prototype.begin=function(){var h=this,V=h.options;if("static"===V.mode){var i=h.createNipple(V.position,h.manager.getIdentifier());i.add(),h.idles.push(i)}},E.prototype.createNipple=function(h,V){var i=this,S=i.manager.scroll,l={},Y=i.options,g=i.parentIsFlex?S.x:S.x+i.box.left,q=i.parentIsFlex?S.y:S.y+i.box.top;if(h.x&&h.y)l={x:h.x-g,y:h.y-q};else if(h.top||h.right||h.bottom||h.left){var B=document.createElement("DIV");B.style.display="hidden",B.style.top=h.top,B.style.right=h.right,B.style.bottom=h.bottom,B.style.left=h.left,B.style.position="absolute",Y.zone.appendChild(B);var J=B.getBoundingClientRect();Y.zone.removeChild(B),l=h,h={x:J.left+S.x,y:J.top+S.y}}var I=new F(i,{color:Y.color,size:Y.size,threshold:Y.threshold,fadeTime:Y.fadeTime,dataOnly:Y.dataOnly,restJoystick:Y.restJoystick,restOpacity:Y.restOpacity,mode:Y.mode,identifier:V,position:h,zone:Y.zone,frontPosition:{x:0,y:0},shape:Y.shape});return Y.dataOnly||(v(I.ui.el,l),v(I.ui.front,I.frontPosition)),i.nipples.push(I),i.trigger("added "+I.identifier+":added",I),i.manager.trigger("added "+I.identifier+":added",I),i.bindNipple(I),I},E.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},E.prototype.bindNipple=function(h){var V,i=this,S=function(h,S){V=h.type+" "+S.id+":"+h.type,i.trigger(V,S)};h.on("destroyed",i.onDestroyed.bind(i)),h.on("shown hidden rested dir plain",S),h.on("dir:up dir:right dir:down dir:left",S),h.on("plain:up plain:right plain:down plain:left",S)},E.prototype.pressureFn=function(h,V,i){var S=this,l=0;clearInterval(S.pressureIntervals[i]),S.pressureIntervals[i]=setInterval(function(){var i=h.force||h.pressure||h.webkitForce||0;i!==l&&(V.trigger("pressure",i),S.trigger("pressure "+V.identifier+":pressure",i),l=i)}.bind(S),100)},E.prototype.onstart=function(h){var V=this,i=V.options,S=h;return h=J(h),V.updateBox(),e(h,(function(l){V.actives.length<i.maxNumberOfNipples?V.processOnStart(l):S.type.match(/^touch/)&&(Object.keys(V.manager.ids).forEach((function(i){if(Object.values(S.touches).findIndex((function(h){return h.identifier===i}))<0){var l=[h[0]];l.identifier=i,V.processOnEnd(l)}})),V.actives.length<i.maxNumberOfNipples&&V.processOnStart(l))})),V.manager.bindDocument(),!1},E.prototype.processOnStart=function(h){var V,i=this,l=i.options,Y=i.manager.getIdentifier(h),g=h.force||h.pressure||h.webkitForce||0,q={x:h.pageX,y:h.pageY},B=i.getOrCreate(Y,q);B.identifier!==Y&&i.manager.removeIdentifier(B.identifier),B.identifier=Y;var J=function(V){V.trigger("start",V),i.trigger("start "+V.id+":start",V),V.show(),g>0&&i.pressureFn(h,V,V.identifier),i.processOnMove(h)};if((V=i.idles.indexOf(B))>=0&&i.idles.splice(V,1),i.actives.push(B),i.ids.push(B.identifier),"semi"!==l.mode)J(B);else{if(!(S(q,B.position)<=l.catchDistance))return B.destroy(),void i.processOnStart(h);J(B)}return B},E.prototype.getOrCreate=function(h,V){var i,S=this,l=S.options;return/(semi|static)/.test(l.mode)?(i=S.idles[0])?(S.idles.splice(0,1),i):"semi"===l.mode?S.createNipple(V,h):(console.warn("Coudln't find the needed nipple."),!1):i=S.createNipple(V,h)},E.prototype.processOnMove=function(h){var V=this,i=V.options,Y=V.manager.getIdentifier(h),g=V.nipples.get(Y),q=V.manager.scroll;if(function(h){return isNaN(h.buttons)?0!==h.pressure:0!==h.buttons}(h)){if(!g)return console.error("Found zombie joystick with ID "+Y),void V.manager.removeIdentifier(Y);if(i.dynamicPage){var B=g.el.getBoundingClientRect();g.position={x:q.x+B.left,y:q.y+B.top}}g.identifier=Y;var J=g.options.size/2,I={x:h.pageX,y:h.pageY};i.lockX&&(I.y=g.position.y),i.lockY&&(I.x=g.position.x);var v,s,t,T,e,n,c,f,P,L,U=S(I,g.position),X=(v=I,t=(s=g.position).x-v.x,T=s.y-v.y,function(h){return h*(180/Math.PI)}(Math.atan2(T,t))),D=l(X),O=U/J,o={distance:U,position:I};if("circle"===g.options.shape?(e=Math.min(U,J),c=g.position,f=e,L={x:0,y:0},P=l(P=X),L.x=c.x-f*Math.cos(P),L.y=c.y-f*Math.sin(P),n=L):(n=function(h,V,i){return{x:Math.min(Math.max(h.x,V.x-i),V.x+i),y:Math.min(Math.max(h.y,V.y-i),V.y+i)}}(I,g.position,J),e=S(n,g.position)),i.follow){if(U>J){var M=I.x-n.x,F=I.y-n.y;g.position.x+=M,g.position.y+=F,g.el.style.top=g.position.y-(V.box.top+q.y)+"px",g.el.style.left=g.position.x-(V.box.left+q.x)+"px",U=S(I,g.position)}}else I=n,U=e;var E=I.x-g.position.x,H=I.y-g.position.y;g.frontPosition={x:E,y:H},i.dataOnly||(g.ui.front.style.transform="translate("+E+"px,"+H+"px)");var j={identifier:g.identifier,position:I,force:O,pressure:h.force||h.pressure||h.webkitForce||0,distance:U,angle:{radian:D,degree:X},vector:{x:E/J,y:-H/J},raw:o,instance:g,lockX:i.lockX,lockY:i.lockY};(j=g.computeDirection(j)).angle={radian:l(180-X),degree:180-X},g.trigger("move",j),V.trigger("move "+g.id+":move",j)}else this.processOnEnd(h)},E.prototype.processOnEnd=function(h){var V=this,i=V.options,S=V.manager.getIdentifier(h),l=V.nipples.get(S),Y=V.manager.removeIdentifier(l.identifier);l&&(i.dataOnly||l.hide((function(){"dynamic"===i.mode&&(l.trigger("removed",l),V.trigger("removed "+l.id+":removed",l),V.manager.trigger("removed "+l.id+":removed",l),l.destroy())})),clearInterval(V.pressureIntervals[l.identifier]),l.resetDirection(),l.trigger("end",l),V.trigger("end "+l.id+":end",l),V.ids.indexOf(l.identifier)>=0&&V.ids.splice(V.ids.indexOf(l.identifier),1),V.actives.indexOf(l)>=0&&V.actives.splice(V.actives.indexOf(l),1),/(semi|static)/.test(i.mode)?V.idles.push(l):V.nipples.indexOf(l)>=0&&V.nipples.splice(V.nipples.indexOf(l),1),V.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(V.manager.ids[Y.id]=Y.identifier))},E.prototype.onDestroyed=function(h,V){var i=this;i.nipples.indexOf(V)>=0&&i.nipples.splice(i.nipples.indexOf(V),1),i.actives.indexOf(V)>=0&&i.actives.splice(i.actives.indexOf(V),1),i.idles.indexOf(V)>=0&&i.idles.splice(i.idles.indexOf(V),1),i.ids.indexOf(V.identifier)>=0&&i.ids.splice(i.ids.indexOf(V.identifier),1),i.manager.removeIdentifier(V.identifier),i.manager.unbindDocument()},E.prototype.destroy=function(){var h=this;for(var V in h.unbindEvt(h.options.zone,"start"),h.nipples.forEach((function(h){h.destroy()})),h.pressureIntervals)h.pressureIntervals.hasOwnProperty(V)&&clearInterval(h.pressureIntervals[V]);h.trigger("destroyed",h.nipples),h.manager.unbindDocument(),h.off()};const H=E;function j(h){var V=this;V.ids={},V.index=0,V.collections=[],V.scroll=I(),V.config(h),V.prepareCollections();var i=function(){var h;V.collections.forEach((function(i){i.forEach((function(i){h=i.el.getBoundingClientRect(),i.position={x:V.scroll.x+h.left,y:V.scroll.y+h.top}}))}))};q(window,"resize",(function(){g(i)}));var S=function(){V.scroll=I()};return q(window,"scroll",(function(){g(S)})),V.collections}j.prototype=new o,j.constructor=j,j.prototype.prepareCollections=function(){var h=this;h.collections.create=h.create.bind(h),h.collections.on=h.on.bind(h),h.collections.off=h.off.bind(h),h.collections.destroy=h.destroy.bind(h),h.collections.get=function(V){var i;return h.collections.every((function(h){return!(i=h.get(V))})),i}},j.prototype.create=function(h){return this.createCollection(h)},j.prototype.createCollection=function(h){var V=this,i=new H(V,h);return V.bindCollection(i),V.collections.push(i),i},j.prototype.bindCollection=function(h){var V,i=this,S=function(h,S){V=h.type+" "+S.id+":"+h.type,i.trigger(V,S)};h.on("destroyed",i.onDestroyed.bind(i)),h.on("shown hidden rested dir plain",S),h.on("dir:up dir:right dir:down dir:left",S),h.on("plain:up plain:right plain:down plain:left",S)},j.prototype.bindDocument=function(){var h=this;h.binded||(h.bindEvt(document,"move").bindEvt(document,"end"),h.binded=!0)},j.prototype.unbindDocument=function(h){var V=this;Object.keys(V.ids).length&&!0!==h||(V.unbindEvt(document,"move").unbindEvt(document,"end"),V.binded=!1)},j.prototype.getIdentifier=function(h){var V;return h?void 0===(V=void 0===h.identifier?h.pointerId:h.identifier)&&(V=this.latest||0):V=this.index,void 0===this.ids[V]&&(this.ids[V]=this.index,this.index+=1),this.latest=V,this.ids[V]},j.prototype.removeIdentifier=function(h){var V={};for(var i in this.ids)if(this.ids[i]===h){V.id=i,V.identifier=this.ids[i],delete this.ids[i];break}return V},j.prototype.onmove=function(h){return this.onAny("move",h),!1},j.prototype.onend=function(h){return this.onAny("end",h),!1},j.prototype.oncancel=function(h){return this.onAny("end",h),!1},j.prototype.onAny=function(h,V){var i,S=this,l="processOn"+h.charAt(0).toUpperCase()+h.slice(1);V=J(V);var Y=function(h,V,i){i.ids.indexOf(V)>=0&&(i[l](h),h._found_=!0)};return e(V,(function(h){i=S.getIdentifier(h),e(S.collections,Y.bind(null,h,i)),h._found_||S.removeIdentifier(i)})),!1},j.prototype.destroy=function(){var h=this;h.unbindDocument(!0),h.ids={},h.index=0,h.collections.forEach((function(h){h.destroy()})),h.off()},j.prototype.onDestroyed=function(h,V){var i=this;if(i.collections.indexOf(V)<0)return!1;i.collections.splice(i.collections.indexOf(V),1)};var m=new j;const G={create:function(h){return m.create(h)},factory:m};return V.default})(),h.exports=V()},12212:(h,V,i)=>{"use strict";const{Deflate:S,deflate:l,deflateRaw:Y,gzip:g}=i(12221),{Inflate:q,inflate:B,inflateRaw:J,ungzip:I}=i(12279),v=i(12252);h.exports.Deflate=S,h.exports.deflate=l,h.exports.deflateRaw=Y,h.exports.gzip=g,h.exports.Inflate=q,h.exports.inflate=B,h.exports.inflateRaw=J,h.exports.ungzip=I,h.exports.constants=v},12221:(h,V,i)=>{"use strict";const S=i(12223),l=i(12261),Y=i(12265),g=i(12246),q=i(12271),B=Object.prototype.toString,{Z_NO_FLUSH:J,Z_SYNC_FLUSH:I,Z_FULL_FLUSH:v,Z_FINISH:s,Z_OK:t,Z_STREAM_END:T,Z_DEFAULT_COMPRESSION:e,Z_DEFAULT_STRATEGY:n,Z_DEFLATED:c}=i(12252);function f(h){this.options=l.assign({level:e,method:c,dh:16384,windowBits:15,memLevel:8,strategy:n},h||{});let V=this.options;V.raw&&V.windowBits>0?V.windowBits=-V.windowBits:V.gzip&&V.windowBits>0&&V.windowBits<16&&(V.windowBits+=16),this.err=0,this.vV="",this.ended=!1,this.chunks=[],this.strm=new q,this.strm.avail_out=0;let i=S.deflateInit2(this.strm,V.level,V.method,V.windowBits,V.memLevel,V.strategy);if(i!==t)throw new Error(g[i]);if(V.header&&S.deflateSetHeader(this.strm,V.header),V.dictionary){let h;if(h="string"===typeof V.dictionary?Y.string2buf(V.dictionary):"[object ArrayBuffer]"===B.call(V.dictionary)?new Uint8Array(V.dictionary):V.dictionary,i=S.deflateSetDictionary(this.strm,h),i!==t)throw new Error(g[i]);this._dict_set=!0}}function P(h,V){const i=new f(V);if(i.push(h,!0),i.err)throw i.vV||g[i.err];return i.result}f.prototype.push=function(h,V){const i=this.strm,l=this.options.dh;let g,q;if(this.ended)return!1;for(q=V===~~V?V:!0===V?s:J,"string"===typeof h?i.input=Y.string2buf(h):"[object ArrayBuffer]"===B.call(h)?i.input=new Uint8Array(h):i.input=h,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(l),i.next_out=0,i.avail_out=l),(q===I||q===v)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(g=S.deflate(i,q),g===T)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),g=S.deflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===t;if(0!==i.avail_out){if(q>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},f.prototype.onData=function(h){this.chunks.push(h)},f.prototype.onEnd=function(h){h===t&&(this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.vV=this.strm.vV},h.exports.Deflate=f,h.exports.deflate=P,h.exports.deflateRaw=function(h,V){return(V=V||{}).raw=!0,P(h,V)},h.exports.gzip=function(h,V){return(V=V||{}).gzip=!0,P(h,V)},h.exports.constants=i(12252)},12279:(h,V,i)=>{"use strict";const S=i(12281),l=i(12261),Y=i(12265),g=i(12246),q=i(12271),B=i(12297),J=Object.prototype.toString,{Z_NO_FLUSH:I,Z_FINISH:v,Z_OK:s,Z_STREAM_END:t,Z_NEED_DICT:T,Z_STREAM_ERROR:e,Z_DATA_ERROR:n,Z_MEM_ERROR:c}=i(12252);function f(h){this.options=l.assign({dh:65536,windowBits:15,to:""},h||{});const V=this.options;V.raw&&V.windowBits>=0&&V.windowBits<16&&(V.windowBits=-V.windowBits,0===V.windowBits&&(V.windowBits=-15)),!(V.windowBits>=0&&V.windowBits<16)||h&&h.windowBits||(V.windowBits+=32),V.windowBits>15&&V.windowBits<48&&0===(15&V.windowBits)&&(V.windowBits|=15),this.err=0,this.vV="",this.ended=!1,this.chunks=[],this.strm=new q,this.strm.avail_out=0;let i=S.inflateInit2(this.strm,V.windowBits);if(i!==s)throw new Error(g[i]);if(this.header=new B,S.inflateGetHeader(this.strm,this.header),V.dictionary&&("string"===typeof V.dictionary?V.dictionary=Y.string2buf(V.dictionary):"[object ArrayBuffer]"===J.call(V.dictionary)&&(V.dictionary=new Uint8Array(V.dictionary)),V.raw&&(i=S.inflateSetDictionary(this.strm,V.dictionary),i!==s)))throw new Error(g[i])}function P(h,V){const i=new f(V);if(i.push(h),i.err)throw i.vV||g[i.err];return i.result}f.prototype.push=function(h,V){const i=this.strm,l=this.options.dh,g=this.options.dictionary;let q,B,f;if(this.ended)return!1;for(B=V===~~V?V:!0===V?v:I,"[object ArrayBuffer]"===J.call(h)?i.input=new Uint8Array(h):i.input=h,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(l),i.next_out=0,i.avail_out=l),q=S.inflate(i,B),q===T&&g&&(q=S.inflateSetDictionary(i,g),q===s?q=S.inflate(i,B):q===n&&(q=T));i.avail_in>0&&q===t&&i.state.wrap>0&&0!==h[i.next_in];)S.inflateReset(i),q=S.inflate(i,B);switch(q){case e:case n:case T:case c:return this.onEnd(q),this.ended=!0,!1}if(f=i.avail_out,i.next_out&&(0===i.avail_out||q===t))if("string"===this.options.to){let h=Y.utf8border(i.output,i.next_out),V=i.next_out-h,S=Y.buf2string(i.output,h);i.next_out=V,i.avail_out=l-V,V&&i.output.set(i.output.subarray(h,h+V),0),this.onData(S)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(q!==s||0!==f){if(q===t)return q=S.inflateEnd(this.strm),this.onEnd(q),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},f.prototype.onData=function(h){this.chunks.push(h)},f.prototype.onEnd=function(h){h===s&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.vV=this.strm.vV},h.exports.Inflate=f,h.exports.inflate=P,h.exports.inflateRaw=function(h,V){return(V=V||{}).raw=!0,P(h,V)},h.exports.ungzip=P,h.exports.constants=i(12252)},12261:h=>{"use strict";const V=(h,V)=>Object.prototype.hasOwnProperty.call(h,V);h.exports.assign=function(h){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const S=i.shift();if(S){if("object"!==typeof S)throw new TypeError(S+"must be non-object");for(const i in S)V(S,i)&&(h[i]=S[i])}}return h},h.exports.flattenChunks=h=>{let V=0;for(let S=0,l=h.length;S<l;S++)V+=h[S].length;const i=new Uint8Array(V);for(let S=0,l=0,Y=h.length;S<Y;S++){let V=h[S];i.set(V,l),l+=V.length}return i}},12265:h=>{"use strict";let V=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(S){V=!1}const i=new Uint8Array(256);for(let l=0;l<256;l++)i[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;i[254]=i[254]=1,h.exports.string2buf=h=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(h);let V,i,S,l,Y,g=h.length,q=0;for(l=0;l<g;l++)i=h.charCodeAt(l),55296===(64512&i)&&l+1<g&&(S=h.charCodeAt(l+1),56320===(64512&S)&&(i=65536+(i-55296<<10)+(S-56320),l++)),q+=i<128?1:i<2048?2:i<65536?3:4;for(V=new Uint8Array(q),Y=0,l=0;Y<q;l++)i=h.charCodeAt(l),55296===(64512&i)&&l+1<g&&(S=h.charCodeAt(l+1),56320===(64512&S)&&(i=65536+(i-55296<<10)+(S-56320),l++)),i<128?V[Y++]=i:i<2048?(V[Y++]=192|i>>>6,V[Y++]=128|63&i):i<65536?(V[Y++]=224|i>>>12,V[Y++]=128|i>>>6&63,V[Y++]=128|63&i):(V[Y++]=240|i>>>18,V[Y++]=128|i>>>12&63,V[Y++]=128|i>>>6&63,V[Y++]=128|63&i);return V};h.exports.buf2string=(h,S)=>{const l=S||h.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(h.subarray(0,S));let Y,g;const q=new Array(2*l);for(g=0,Y=0;Y<l;){let V=h[Y++];if(V<128){q[g++]=V;continue}let S=i[V];if(S>4)q[g++]=65533,Y+=S-1;else{for(V&=2===S?31:3===S?15:7;S>1&&Y<l;)V=V<<6|63&h[Y++],S--;S>1?q[g++]=65533:V<65536?q[g++]=V:(V-=65536,q[g++]=55296|V>>10&1023,q[g++]=56320|1023&V)}}return((h,i)=>{if(i<65534&&h.subarray&&V)return String.fromCharCode.apply(null,h.length===i?h:h.subarray(0,i));let S="";for(let V=0;V<i;V++)S+=String.fromCharCode(h[V]);return S})(q,g)},h.exports.utf8border=(h,V)=>{(V=V||h.length)>h.length&&(V=h.length);let S=V-1;for(;S>=0&&128===(192&h[S]);)S--;return S<0||0===S?V:S+i[h[S]]>V?S:V}},12239:h=>{"use strict";h.exports=(h,V,i,S)=>{let l=65535&h,Y=h>>>16&65535,g=0;for(;0!==i;){g=i>2e3?2e3:i,i-=g;do{l=l+V[S++]|0,Y=Y+l|0}while(--g);l%=65521,Y%=65521}return l|Y<<16}},12252:h=>{"use strict";h.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12241:h=>{"use strict";const V=new Uint32Array((()=>{let h,V=[];for(var i=0;i<256;i++){h=i;for(var S=0;S<8;S++)h=1&h?3988292384^h>>>1:h>>>1;V[i]=h}return V})());h.exports=(h,i,S,l)=>{const Y=V,g=l+S;h^=-1;for(let V=l;V<g;V++)h=h>>>8^Y[255&(h^i[V])];return~h}},12223:(h,V,i)=>{"use strict";const{_tr_init:S,_tr_stored_block:l,_tr_flush_block:Y,_tr_tally:g,_tr_align:q}=i(12230),B=i(12239),J=i(12241),I=i(12246),{Z_NO_FLUSH:v,Z_PARTIAL_FLUSH:s,Z_FULL_FLUSH:t,Z_FINISH:T,Z_BLOCK:e,Z_OK:n,Z_STREAM_END:c,Z_STREAM_ERROR:f,Z_DATA_ERROR:P,Z_BUF_ERROR:L,Z_DEFAULT_COMPRESSION:U,Z_FILTERED:X,Z_HUFFMAN_ONLY:D,Z_RLE:O,Z_FIXED:o,Z_DEFAULT_STRATEGY:M,Z_UNKNOWN:F,Z_DEFLATED:E}=i(12252),H=258,j=262,m=103,G=113,w=666,N=(h,V)=>(h.vV=I[V],V),r=h=>(h<<1)-(h>4?9:0),k=h=>{let V=h.length;for(;--V>=0;)h[V]=0};let R=(h,V,i)=>(V<<h.hash_shift^i)&h.hash_mask;const Z=h=>{const V=h.state;let i=V.pending;i>h.avail_out&&(i=h.avail_out),0!==i&&(h.output.set(V.pending_buf.subarray(V.pending_out,V.pending_out+i),h.next_out),h.next_out+=i,V.pending_out+=i,h.total_out+=i,h.avail_out-=i,V.pending-=i,0===V.pending&&(V.pending_out=0))},z=(h,V)=>{Y(h,h.block_start>=0?h.block_start:-1,h.strstart-h.block_start,V),h.block_start=h.strstart,Z(h.strm)},d=(h,V)=>{h.pending_buf[h.pending++]=V},x=(h,V)=>{h.pending_buf[h.pending++]=V>>>8&255,h.pending_buf[h.pending++]=255&V},y=(h,V,i,S)=>{let l=h.avail_in;return l>S&&(l=S),0===l?0:(h.avail_in-=l,V.set(h.input.subarray(h.next_in,h.next_in+l),i),1===h.state.wrap?h.adler=B(h.adler,V,l,i):2===h.state.wrap&&(h.adler=J(h.adler,V,l,i)),h.next_in+=l,h.total_in+=l,l)},Q=(h,V)=>{let i,S,l=h.max_chain_length,Y=h.strstart,g=h.prev_length,q=h.nice_match;const B=h.strstart>h.w_size-j?h.strstart-(h.w_size-j):0,J=h.window,I=h.w_mask,v=h.prev,s=h.strstart+H;let t=J[Y+g-1],T=J[Y+g];h.prev_length>=h.good_match&&(l>>=2),q>h.lookahead&&(q=h.lookahead);do{if(i=V,J[i+g]===T&&J[i+g-1]===t&&J[i]===J[Y]&&J[++i]===J[Y+1]){Y+=2,i++;do{}while(J[++Y]===J[++i]&&J[++Y]===J[++i]&&J[++Y]===J[++i]&&J[++Y]===J[++i]&&J[++Y]===J[++i]&&J[++Y]===J[++i]&&J[++Y]===J[++i]&&J[++Y]===J[++i]&&Y<s);if(S=H-(s-Y),Y=s-H,S>g){if(h.match_start=V,g=S,S>=q)break;t=J[Y+g-1],T=J[Y+g]}}}while((V=v[V&I])>B&&0!==--l);return g<=h.lookahead?g:h.lookahead},A=h=>{const V=h.w_size;let i,S,l,Y,g;do{if(Y=h.window_size-h.lookahead-h.strstart,h.strstart>=V+(V-j)){h.window.set(h.window.subarray(V,V+V),0),h.match_start-=V,h.strstart-=V,h.block_start-=V,S=h.hash_size,i=S;do{l=h.head[--i],h.head[i]=l>=V?l-V:0}while(--S);S=V,i=S;do{l=h.prev[--i],h.prev[i]=l>=V?l-V:0}while(--S);Y+=V}if(0===h.strm.avail_in)break;if(S=y(h.strm,h.window,h.strstart+h.lookahead,Y),h.lookahead+=S,h.lookahead+h.insert>=3)for(g=h.strstart-h.insert,h.ins_h=h.window[g],h.ins_h=R(h,h.ins_h,h.window[g+1]);h.insert&&(h.ins_h=R(h,h.ins_h,h.window[g+3-1]),h.prev[g&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=g,g++,h.insert--,!(h.lookahead+h.insert<3)););}while(h.lookahead<j&&0!==h.strm.avail_in)},b=(h,V)=>{let i,S;for(;;){if(h.lookahead<j){if(A(h),h.lookahead<j&&V===v)return 1;if(0===h.lookahead)break}if(i=0,h.lookahead>=3&&(h.ins_h=R(h,h.ins_h,h.window[h.strstart+3-1]),i=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),0!==i&&h.strstart-i<=h.w_size-j&&(h.match_length=Q(h,i)),h.match_length>=3)if(S=g(h,h.strstart-h.match_start,h.match_length-3),h.lookahead-=h.match_length,h.match_length<=h.max_lazy_match&&h.lookahead>=3){h.match_length--;do{h.strstart++,h.ins_h=R(h,h.ins_h,h.window[h.strstart+3-1]),i=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart}while(0!==--h.match_length);h.strstart++}else h.strstart+=h.match_length,h.match_length=0,h.ins_h=h.window[h.strstart],h.ins_h=R(h,h.ins_h,h.window[h.strstart+1]);else S=g(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++;if(S&&(z(h,!1),0===h.strm.avail_out))return 1}return h.insert=h.strstart<2?h.strstart:2,V===T?(z(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(z(h,!1),0===h.strm.avail_out)?1:2},C=(h,V)=>{let i,S,l;for(;;){if(h.lookahead<j){if(A(h),h.lookahead<j&&V===v)return 1;if(0===h.lookahead)break}if(i=0,h.lookahead>=3&&(h.ins_h=R(h,h.ins_h,h.window[h.strstart+3-1]),i=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),h.prev_length=h.match_length,h.prev_match=h.match_start,h.match_length=2,0!==i&&h.prev_length<h.max_lazy_match&&h.strstart-i<=h.w_size-j&&(h.match_length=Q(h,i),h.match_length<=5&&(h.strategy===X||3===h.match_length&&h.strstart-h.match_start>4096)&&(h.match_length=2)),h.prev_length>=3&&h.match_length<=h.prev_length){l=h.strstart+h.lookahead-3,S=g(h,h.strstart-1-h.prev_match,h.prev_length-3),h.lookahead-=h.prev_length-1,h.prev_length-=2;do{++h.strstart<=l&&(h.ins_h=R(h,h.ins_h,h.window[h.strstart+3-1]),i=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart)}while(0!==--h.prev_length);if(h.match_available=0,h.match_length=2,h.strstart++,S&&(z(h,!1),0===h.strm.avail_out))return 1}else if(h.match_available){if(S=g(h,0,h.window[h.strstart-1]),S&&z(h,!1),h.strstart++,h.lookahead--,0===h.strm.avail_out)return 1}else h.match_available=1,h.strstart++,h.lookahead--}return h.match_available&&(S=g(h,0,h.window[h.strstart-1]),h.match_available=0),h.insert=h.strstart<2?h.strstart:2,V===T?(z(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(z(h,!1),0===h.strm.avail_out)?1:2};function u(h,V,i,S,l){this.good_length=h,this.max_lazy=V,this.nice_length=i,this.max_chain=S,this.func=l}const p=[new u(0,0,0,0,((h,V)=>{let i=65535;for(i>h.pending_buf_size-5&&(i=h.pending_buf_size-5);;){if(h.lookahead<=1){if(A(h),0===h.lookahead&&V===v)return 1;if(0===h.lookahead)break}h.strstart+=h.lookahead,h.lookahead=0;const S=h.block_start+i;if((0===h.strstart||h.strstart>=S)&&(h.lookahead=h.strstart-S,h.strstart=S,z(h,!1),0===h.strm.avail_out))return 1;if(h.strstart-h.block_start>=h.w_size-j&&(z(h,!1),0===h.strm.avail_out))return 1}return h.insert=0,V===T?(z(h,!0),0===h.strm.avail_out?3:4):(h.strstart>h.block_start&&(z(h,!1),h.strm.avail_out),1)})),new u(4,4,8,4,b),new u(4,5,16,8,b),new u(4,6,32,32,b),new u(4,4,16,16,C),new u(8,16,32,32,C),new u(8,16,128,128,C),new u(8,32,128,256,C),new u(32,128,258,1024,C),new u(32,258,258,4096,C)];function W(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),k(this.dyn_ltree),k(this.dyn_dtree),k(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),k(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),k(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const a=h=>{if(!h||!h.state)return N(h,f);h.total_in=h.total_out=0,h.data_type=F;const V=h.state;return V.pending=0,V.pending_out=0,V.wrap<0&&(V.wrap=-V.wrap),V.status=V.wrap?42:G,h.adler=2===V.wrap?0:1,V.last_flush=v,S(V),n},K=h=>{const V=a(h);var i;return V===n&&((i=h.state).window_size=2*i.w_size,k(i.head),i.max_lazy_match=p[i.level].max_lazy,i.good_match=p[i.level].good_length,i.nice_match=p[i.level].nice_length,i.max_chain_length=p[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),V},hh=(h,V,i,S,l,Y)=>{if(!h)return f;let g=1;if(V===U&&(V=6),S<0?(g=0,S=-S):S>15&&(g=2,S-=16),l<1||l>9||i!==E||S<8||S>15||V<0||V>9||Y<0||Y>o)return N(h,f);8===S&&(S=9);const q=new W;return h.state=q,q.strm=h,q.wrap=g,q.gzhead=null,q.w_bits=S,q.w_size=1<<q.w_bits,q.w_mask=q.w_size-1,q.hash_bits=l+7,q.hash_size=1<<q.hash_bits,q.hash_mask=q.hash_size-1,q.hash_shift=~~((q.hash_bits+3-1)/3),q.window=new Uint8Array(2*q.w_size),q.head=new Uint16Array(q.hash_size),q.prev=new Uint16Array(q.w_size),q.lit_bufsize=1<<l+6,q.pending_buf_size=4*q.lit_bufsize,q.pending_buf=new Uint8Array(q.pending_buf_size),q.d_buf=1*q.lit_bufsize,q.l_buf=3*q.lit_bufsize,q.level=V,q.strategy=Y,q.method=i,K(h)};h.exports.deflateInit=(h,V)=>hh(h,V,E,15,8,M),h.exports.deflateInit2=hh,h.exports.deflateReset=K,h.exports.deflateResetKeep=a,h.exports.deflateSetHeader=(h,V)=>h&&h.state?2!==h.state.wrap?f:(h.state.gzhead=V,n):f,h.exports.deflate=(h,V)=>{let i,S;if(!h||!h.state||V>e||V<0)return h?N(h,f):f;const Y=h.state;if(!h.output||!h.input&&0!==h.avail_in||Y.status===w&&V!==T)return N(h,0===h.avail_out?L:f);Y.strm=h;const B=Y.last_flush;if(Y.last_flush=V,42===Y.status)if(2===Y.wrap)h.adler=0,d(Y,31),d(Y,139),d(Y,8),Y.gzhead?(d(Y,(Y.gzhead.text?1:0)+(Y.gzhead.hcrc?2:0)+(Y.gzhead.extra?4:0)+(Y.gzhead.name?8:0)+(Y.gzhead.comment?16:0)),d(Y,255&Y.gzhead.time),d(Y,Y.gzhead.time>>8&255),d(Y,Y.gzhead.time>>16&255),d(Y,Y.gzhead.time>>24&255),d(Y,9===Y.level?2:Y.strategy>=D||Y.level<2?4:0),d(Y,255&Y.gzhead.os),Y.gzhead.extra&&Y.gzhead.extra.length&&(d(Y,255&Y.gzhead.extra.length),d(Y,Y.gzhead.extra.length>>8&255)),Y.gzhead.hcrc&&(h.adler=J(h.adler,Y.pending_buf,Y.pending,0)),Y.gzindex=0,Y.status=69):(d(Y,0),d(Y,0),d(Y,0),d(Y,0),d(Y,0),d(Y,9===Y.level?2:Y.strategy>=D||Y.level<2?4:0),d(Y,3),Y.status=G);else{let V=E+(Y.w_bits-8<<4)<<8,i=-1;i=Y.strategy>=D||Y.level<2?0:Y.level<6?1:6===Y.level?2:3,V|=i<<6,0!==Y.strstart&&(V|=32),V+=31-V%31,Y.status=G,x(Y,V),0!==Y.strstart&&(x(Y,h.adler>>>16),x(Y,65535&h.adler)),h.adler=1}if(69===Y.status)if(Y.gzhead.extra){for(i=Y.pending;Y.gzindex<(65535&Y.gzhead.extra.length)&&(Y.pending!==Y.pending_buf_size||(Y.gzhead.hcrc&&Y.pending>i&&(h.adler=J(h.adler,Y.pending_buf,Y.pending-i,i)),Z(h),i=Y.pending,Y.pending!==Y.pending_buf_size));)d(Y,255&Y.gzhead.extra[Y.gzindex]),Y.gzindex++;Y.gzhead.hcrc&&Y.pending>i&&(h.adler=J(h.adler,Y.pending_buf,Y.pending-i,i)),Y.gzindex===Y.gzhead.extra.length&&(Y.gzindex=0,Y.status=73)}else Y.status=73;if(73===Y.status)if(Y.gzhead.name){i=Y.pending;do{if(Y.pending===Y.pending_buf_size&&(Y.gzhead.hcrc&&Y.pending>i&&(h.adler=J(h.adler,Y.pending_buf,Y.pending-i,i)),Z(h),i=Y.pending,Y.pending===Y.pending_buf_size)){S=1;break}S=Y.gzindex<Y.gzhead.name.length?255&Y.gzhead.name.charCodeAt(Y.gzindex++):0,d(Y,S)}while(0!==S);Y.gzhead.hcrc&&Y.pending>i&&(h.adler=J(h.adler,Y.pending_buf,Y.pending-i,i)),0===S&&(Y.gzindex=0,Y.status=91)}else Y.status=91;if(91===Y.status)if(Y.gzhead.comment){i=Y.pending;do{if(Y.pending===Y.pending_buf_size&&(Y.gzhead.hcrc&&Y.pending>i&&(h.adler=J(h.adler,Y.pending_buf,Y.pending-i,i)),Z(h),i=Y.pending,Y.pending===Y.pending_buf_size)){S=1;break}S=Y.gzindex<Y.gzhead.comment.length?255&Y.gzhead.comment.charCodeAt(Y.gzindex++):0,d(Y,S)}while(0!==S);Y.gzhead.hcrc&&Y.pending>i&&(h.adler=J(h.adler,Y.pending_buf,Y.pending-i,i)),0===S&&(Y.status=m)}else Y.status=m;if(Y.status===m&&(Y.gzhead.hcrc?(Y.pending+2>Y.pending_buf_size&&Z(h),Y.pending+2<=Y.pending_buf_size&&(d(Y,255&h.adler),d(Y,h.adler>>8&255),h.adler=0,Y.status=G)):Y.status=G),0!==Y.pending){if(Z(h),0===h.avail_out)return Y.last_flush=-1,n}else if(0===h.avail_in&&r(V)<=r(B)&&V!==T)return N(h,L);if(Y.status===w&&0!==h.avail_in)return N(h,L);if(0!==h.avail_in||0!==Y.lookahead||V!==v&&Y.status!==w){let i=Y.strategy===D?((h,V)=>{let i;for(;;){if(0===h.lookahead&&(A(h),0===h.lookahead)){if(V===v)return 1;break}if(h.match_length=0,i=g(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++,i&&(z(h,!1),0===h.strm.avail_out))return 1}return h.insert=0,V===T?(z(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(z(h,!1),0===h.strm.avail_out)?1:2})(Y,V):Y.strategy===O?((h,V)=>{let i,S,l,Y;const q=h.window;for(;;){if(h.lookahead<=H){if(A(h),h.lookahead<=H&&V===v)return 1;if(0===h.lookahead)break}if(h.match_length=0,h.lookahead>=3&&h.strstart>0&&(l=h.strstart-1,S=q[l],S===q[++l]&&S===q[++l]&&S===q[++l])){Y=h.strstart+H;do{}while(S===q[++l]&&S===q[++l]&&S===q[++l]&&S===q[++l]&&S===q[++l]&&S===q[++l]&&S===q[++l]&&S===q[++l]&&l<Y);h.match_length=H-(Y-l),h.match_length>h.lookahead&&(h.match_length=h.lookahead)}if(h.match_length>=3?(i=g(h,1,h.match_length-3),h.lookahead-=h.match_length,h.strstart+=h.match_length,h.match_length=0):(i=g(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++),i&&(z(h,!1),0===h.strm.avail_out))return 1}return h.insert=0,V===T?(z(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(z(h,!1),0===h.strm.avail_out)?1:2})(Y,V):p[Y.level].func(Y,V);if(3!==i&&4!==i||(Y.status=w),1===i||3===i)return 0===h.avail_out&&(Y.last_flush=-1),n;if(2===i&&(V===s?q(Y):V!==e&&(l(Y,0,0,!1),V===t&&(k(Y.head),0===Y.lookahead&&(Y.strstart=0,Y.block_start=0,Y.insert=0))),Z(h),0===h.avail_out))return Y.last_flush=-1,n}return V!==T?n:Y.wrap<=0?c:(2===Y.wrap?(d(Y,255&h.adler),d(Y,h.adler>>8&255),d(Y,h.adler>>16&255),d(Y,h.adler>>24&255),d(Y,255&h.total_in),d(Y,h.total_in>>8&255),d(Y,h.total_in>>16&255),d(Y,h.total_in>>24&255)):(x(Y,h.adler>>>16),x(Y,65535&h.adler)),Z(h),Y.wrap>0&&(Y.wrap=-Y.wrap),0!==Y.pending?n:c)},h.exports.deflateEnd=h=>{if(!h||!h.state)return f;const V=h.state.status;return 42!==V&&69!==V&&73!==V&&91!==V&&V!==m&&V!==G&&V!==w?N(h,f):(h.state=null,V===G?N(h,P):n)},h.exports.deflateSetDictionary=(h,V)=>{let i=V.length;if(!h||!h.state)return f;const S=h.state,l=S.wrap;if(2===l||1===l&&42!==S.status||S.lookahead)return f;if(1===l&&(h.adler=B(h.adler,V,i,0)),S.wrap=0,i>=S.w_size){0===l&&(k(S.head),S.strstart=0,S.block_start=0,S.insert=0);let h=new Uint8Array(S.w_size);h.set(V.subarray(i-S.w_size,i),0),V=h,i=S.w_size}const Y=h.avail_in,g=h.next_in,q=h.input;for(h.avail_in=i,h.next_in=0,h.input=V,A(S);S.lookahead>=3;){let h=S.strstart,V=S.lookahead-2;do{S.ins_h=R(S,S.ins_h,S.window[h+3-1]),S.prev[h&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=h,h++}while(--V);S.strstart=h,S.lookahead=2,A(S)}return S.strstart+=S.lookahead,S.block_start=S.strstart,S.insert=S.lookahead,S.lookahead=0,S.match_length=S.prev_length=2,S.match_available=0,h.next_in=g,h.input=q,h.avail_in=Y,S.wrap=l,n},h.exports.deflateInfo="pako deflate (from Nodeca project)"},12297:h=>{"use strict";h.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12285:h=>{"use strict";h.exports=function(h,V){let i,S,l,Y,g,q,B,J,I,v,s,t,T,e,n,c,f,P,L,U,X,D,O,o;const M=h.state;i=h.next_in,O=h.input,S=i+(h.avail_in-5),l=h.next_out,o=h.output,Y=l-(V-h.avail_out),g=l+(h.avail_out-257),q=M.dmax,B=M.wsize,J=M.whave,I=M.wnext,v=M.window,s=M.hold,t=M.bits,T=M.lencode,e=M.distcode,n=(1<<M.lenbits)-1,c=(1<<M.distbits)-1;h:do{t<15&&(s+=O[i++]<<t,t+=8,s+=O[i++]<<t,t+=8),f=T[s&n];V:for(;;){if(P=f>>>24,s>>>=P,t-=P,P=f>>>16&255,0===P)o[l++]=65535&f;else{if(!(16&P)){if(0===(64&P)){f=T[(65535&f)+(s&(1<<P)-1)];continue V}if(32&P){M.mode=12;break h}h.vV="invalid literal/length code",M.mode=30;break h}L=65535&f,P&=15,P&&(t<P&&(s+=O[i++]<<t,t+=8),L+=s&(1<<P)-1,s>>>=P,t-=P),t<15&&(s+=O[i++]<<t,t+=8,s+=O[i++]<<t,t+=8),f=e[s&c];i:for(;;){if(P=f>>>24,s>>>=P,t-=P,P=f>>>16&255,!(16&P)){if(0===(64&P)){f=e[(65535&f)+(s&(1<<P)-1)];continue i}h.vV="invalid distance code",M.mode=30;break h}if(U=65535&f,P&=15,t<P&&(s+=O[i++]<<t,t+=8,t<P&&(s+=O[i++]<<t,t+=8)),U+=s&(1<<P)-1,U>q){h.vV="invalid distance too far back",M.mode=30;break h}if(s>>>=P,t-=P,P=l-Y,U>P){if(P=U-P,P>J&&M.sane){h.vV="invalid distance too far back",M.mode=30;break h}if(X=0,D=v,0===I){if(X+=B-P,P<L){L-=P;do{o[l++]=v[X++]}while(--P);X=l-U,D=o}}else if(I<P){if(X+=B+I-P,P-=I,P<L){L-=P;do{o[l++]=v[X++]}while(--P);if(X=0,I<L){P=I,L-=P;do{o[l++]=v[X++]}while(--P);X=l-U,D=o}}}else if(X+=I-P,P<L){L-=P;do{o[l++]=v[X++]}while(--P);X=l-U,D=o}for(;L>2;)o[l++]=D[X++],o[l++]=D[X++],o[l++]=D[X++],L-=3;L&&(o[l++]=D[X++],L>1&&(o[l++]=D[X++]))}else{X=l-U;do{o[l++]=o[X++],o[l++]=o[X++],o[l++]=o[X++],L-=3}while(L>2);L&&(o[l++]=o[X++],L>1&&(o[l++]=o[X++]))}break}}break}}while(i<S&&l<g);L=t>>3,i-=L,t-=L<<3,s&=(1<<t)-1,h.next_in=i,h.next_out=l,h.avail_in=i<S?S-i+5:5-(i-S),h.avail_out=l<g?g-l+257:257-(l-g),M.hold=s,M.bits=t}},12281:(h,V,i)=>{"use strict";const S=i(12239),l=i(12241),Y=i(12285),g=i(12291),{Z_FINISH:q,Z_BLOCK:B,Z_TREES:J,Z_OK:I,Z_STREAM_END:v,Z_NEED_DICT:s,Z_STREAM_ERROR:t,Z_DATA_ERROR:T,Z_MEM_ERROR:e,Z_BUF_ERROR:n,Z_DEFLATED:c}=i(12252),f=12,P=30,L=h=>(h>>>24&255)+(h>>>8&65280)+((65280&h)<<8)+((255&h)<<24);function U(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const X=h=>{if(!h||!h.state)return t;const V=h.state;return h.total_in=h.total_out=V.total=0,h.vV="",V.wrap&&(h.adler=1&V.wrap),V.mode=1,V.last=0,V.havedict=0,V.dmax=32768,V.head=null,V.hold=0,V.bits=0,V.lencode=V.lendyn=new Int32Array(852),V.distcode=V.distdyn=new Int32Array(592),V.sane=1,V.back=-1,I},D=h=>{if(!h||!h.state)return t;const V=h.state;return V.wsize=0,V.whave=0,V.wnext=0,X(h)},O=(h,V)=>{let i;if(!h||!h.state)return t;const S=h.state;return V<0?(i=0,V=-V):(i=1+(V>>4),V<48&&(V&=15)),V&&(V<8||V>15)?t:(null!==S.window&&S.wbits!==V&&(S.window=null),S.wrap=i,S.wbits=V,D(h))},o=(h,V)=>{if(!h)return t;const i=new U;h.state=i,i.window=null;const S=O(h,V);return S!==I&&(h.state=null),S};let M,F,E=!0;const H=h=>{if(E){M=new Int32Array(512),F=new Int32Array(32);let V=0;for(;V<144;)h.lens[V++]=8;for(;V<256;)h.lens[V++]=9;for(;V<280;)h.lens[V++]=7;for(;V<288;)h.lens[V++]=8;for(g(1,h.lens,0,288,M,0,h.work,{bits:9}),V=0;V<32;)h.lens[V++]=5;g(2,h.lens,0,32,F,0,h.work,{bits:5}),E=!1}h.lencode=M,h.lenbits=9,h.distcode=F,h.distbits=5},j=(h,V,i,S)=>{let l;const Y=h.state;return null===Y.window&&(Y.wsize=1<<Y.wbits,Y.wnext=0,Y.whave=0,Y.window=new Uint8Array(Y.wsize)),S>=Y.wsize?(Y.window.set(V.subarray(i-Y.wsize,i),0),Y.wnext=0,Y.whave=Y.wsize):(l=Y.wsize-Y.wnext,l>S&&(l=S),Y.window.set(V.subarray(i-S,i-S+l),Y.wnext),(S-=l)?(Y.window.set(V.subarray(i-S,i),0),Y.wnext=S,Y.whave=Y.wsize):(Y.wnext+=l,Y.wnext===Y.wsize&&(Y.wnext=0),Y.whave<Y.wsize&&(Y.whave+=l))),0};h.exports.inflateReset=D,h.exports.inflateReset2=O,h.exports.inflateResetKeep=X,h.exports.inflateInit=h=>o(h,15),h.exports.inflateInit2=o,h.exports.inflate=(h,V)=>{let i,U,X,D,O,o,M,F,E,m,G,w,N,r,k,R,Z,z,d,x,y,Q,A=0;const b=new Uint8Array(4);let C,u;const p=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!h||!h.state||!h.output||!h.input&&0!==h.avail_in)return t;i=h.state,i.mode===f&&(i.mode=13),O=h.next_out,X=h.output,M=h.avail_out,D=h.next_in,U=h.input,o=h.avail_in,F=i.hold,E=i.bits,m=o,G=M,Q=I;h:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;E<16;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}if(2&i.wrap&&35615===F){i.check=0,b[0]=255&F,b[1]=F>>>8&255,i.check=l(i.check,b,2,0),F=0,E=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&F)<<8)+(F>>8))%31){h.vV="incorrect header check",i.mode=P;break}if((15&F)!==c){h.vV="unknown compression method",i.mode=P;break}if(F>>>=4,E-=4,y=8+(15&F),0===i.wbits)i.wbits=y;else if(y>i.wbits){h.vV="invalid window size",i.mode=P;break}i.dmax=1<<i.wbits,h.adler=i.check=1,i.mode=512&F?10:f,F=0,E=0;break;case 2:for(;E<16;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}if(i.flags=F,(255&i.flags)!==c){h.vV="unknown compression method",i.mode=P;break}if(57344&i.flags){h.vV="unknown header flags set",i.mode=P;break}i.head&&(i.head.text=F>>8&1),512&i.flags&&(b[0]=255&F,b[1]=F>>>8&255,i.check=l(i.check,b,2,0)),F=0,E=0,i.mode=3;case 3:for(;E<32;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}i.head&&(i.head.time=F),512&i.flags&&(b[0]=255&F,b[1]=F>>>8&255,b[2]=F>>>16&255,b[3]=F>>>24&255,i.check=l(i.check,b,4,0)),F=0,E=0,i.mode=4;case 4:for(;E<16;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}i.head&&(i.head.xflags=255&F,i.head.os=F>>8),512&i.flags&&(b[0]=255&F,b[1]=F>>>8&255,i.check=l(i.check,b,2,0)),F=0,E=0,i.mode=5;case 5:if(1024&i.flags){for(;E<16;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}i.length=F,i.head&&(i.head.extra_len=F),512&i.flags&&(b[0]=255&F,b[1]=F>>>8&255,i.check=l(i.check,b,2,0)),F=0,E=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(w=i.length,w>o&&(w=o),w&&(i.head&&(y=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(U.subarray(D,D+w),y)),512&i.flags&&(i.check=l(i.check,U,w,D)),o-=w,D+=w,i.length-=w),i.length))break h;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===o)break h;w=0;do{y=U[D+w++],i.head&&y&&i.length<65536&&(i.head.name+=String.fromCharCode(y))}while(y&&w<o);if(512&i.flags&&(i.check=l(i.check,U,w,D)),o-=w,D+=w,y)break h}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===o)break h;w=0;do{y=U[D+w++],i.head&&y&&i.length<65536&&(i.head.comment+=String.fromCharCode(y))}while(y&&w<o);if(512&i.flags&&(i.check=l(i.check,U,w,D)),o-=w,D+=w,y)break h}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;E<16;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}if(F!==(65535&i.check)){h.vV="header crc mismatch",i.mode=P;break}F=0,E=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),h.adler=i.check=0,i.mode=f;break;case 10:for(;E<32;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}h.adler=i.check=L(F),F=0,E=0,i.mode=11;case 11:if(0===i.havedict)return h.next_out=O,h.avail_out=M,h.next_in=D,h.avail_in=o,i.hold=F,i.bits=E,s;h.adler=i.check=1,i.mode=f;case f:if(V===B||V===J)break h;case 13:if(i.last){F>>>=7&E,E-=7&E,i.mode=27;break}for(;E<3;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}switch(i.last=1&F,F>>>=1,E-=1,3&F){case 0:i.mode=14;break;case 1:if(H(i),i.mode=20,V===J){F>>>=2,E-=2;break h}break;case 2:i.mode=17;break;case 3:h.vV="invalid block type",i.mode=P}F>>>=2,E-=2;break;case 14:for(F>>>=7&E,E-=7&E;E<32;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}if((65535&F)!==(F>>>16^65535)){h.vV="invalid stored block lengths",i.mode=P;break}if(i.length=65535&F,F=0,E=0,i.mode=15,V===J)break h;case 15:i.mode=16;case 16:if(w=i.length,w){if(w>o&&(w=o),w>M&&(w=M),0===w)break h;X.set(U.subarray(D,D+w),O),o-=w,D+=w,M-=w,O+=w,i.length-=w;break}i.mode=f;break;case 17:for(;E<14;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}if(i.nlen=257+(31&F),F>>>=5,E-=5,i.ndist=1+(31&F),F>>>=5,E-=5,i.ncode=4+(15&F),F>>>=4,E-=4,i.nlen>286||i.ndist>30){h.vV="too many length or distance symbols",i.mode=P;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;E<3;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}i.lens[p[i.have++]]=7&F,F>>>=3,E-=3}for(;i.have<19;)i.lens[p[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,C={bits:i.lenbits},Q=g(0,i.lens,0,19,i.lencode,0,i.work,C),i.lenbits=C.bits,Q){h.vV="invalid code lengths set",i.mode=P;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;A=i.lencode[F&(1<<i.lenbits)-1],k=A>>>24,R=A>>>16&255,Z=65535&A,!(k<=E);){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}if(Z<16)F>>>=k,E-=k,i.lens[i.have++]=Z;else{if(16===Z){for(u=k+2;E<u;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}if(F>>>=k,E-=k,0===i.have){h.vV="invalid bit length repeat",i.mode=P;break}y=i.lens[i.have-1],w=3+(3&F),F>>>=2,E-=2}else if(17===Z){for(u=k+3;E<u;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}F>>>=k,E-=k,y=0,w=3+(7&F),F>>>=3,E-=3}else{for(u=k+7;E<u;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}F>>>=k,E-=k,y=0,w=11+(127&F),F>>>=7,E-=7}if(i.have+w>i.nlen+i.ndist){h.vV="invalid bit length repeat",i.mode=P;break}for(;w--;)i.lens[i.have++]=y}}if(i.mode===P)break;if(0===i.lens[256]){h.vV="invalid code -- missing end-of-block",i.mode=P;break}if(i.lenbits=9,C={bits:i.lenbits},Q=g(1,i.lens,0,i.nlen,i.lencode,0,i.work,C),i.lenbits=C.bits,Q){h.vV="invalid literal/lengths set",i.mode=P;break}if(i.distbits=6,i.distcode=i.distdyn,C={bits:i.distbits},Q=g(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,C),i.distbits=C.bits,Q){h.vV="invalid distances set",i.mode=P;break}if(i.mode=20,V===J)break h;case 20:i.mode=21;case 21:if(o>=6&&M>=258){h.next_out=O,h.avail_out=M,h.next_in=D,h.avail_in=o,i.hold=F,i.bits=E,Y(h,G),O=h.next_out,X=h.output,M=h.avail_out,D=h.next_in,U=h.input,o=h.avail_in,F=i.hold,E=i.bits,i.mode===f&&(i.back=-1);break}for(i.back=0;A=i.lencode[F&(1<<i.lenbits)-1],k=A>>>24,R=A>>>16&255,Z=65535&A,!(k<=E);){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}if(R&&0===(240&R)){for(z=k,d=R,x=Z;A=i.lencode[x+((F&(1<<z+d)-1)>>z)],k=A>>>24,R=A>>>16&255,Z=65535&A,!(z+k<=E);){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}F>>>=z,E-=z,i.back+=z}if(F>>>=k,E-=k,i.back+=k,i.length=Z,0===R){i.mode=26;break}if(32&R){i.back=-1,i.mode=f;break}if(64&R){h.vV="invalid literal/length code",i.mode=P;break}i.extra=15&R,i.mode=22;case 22:if(i.extra){for(u=i.extra;E<u;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}i.length+=F&(1<<i.extra)-1,F>>>=i.extra,E-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;A=i.distcode[F&(1<<i.distbits)-1],k=A>>>24,R=A>>>16&255,Z=65535&A,!(k<=E);){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}if(0===(240&R)){for(z=k,d=R,x=Z;A=i.distcode[x+((F&(1<<z+d)-1)>>z)],k=A>>>24,R=A>>>16&255,Z=65535&A,!(z+k<=E);){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}F>>>=z,E-=z,i.back+=z}if(F>>>=k,E-=k,i.back+=k,64&R){h.vV="invalid distance code",i.mode=P;break}i.offset=Z,i.extra=15&R,i.mode=24;case 24:if(i.extra){for(u=i.extra;E<u;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}i.offset+=F&(1<<i.extra)-1,F>>>=i.extra,E-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){h.vV="invalid distance too far back",i.mode=P;break}i.mode=25;case 25:if(0===M)break h;if(w=G-M,i.offset>w){if(w=i.offset-w,w>i.whave&&i.sane){h.vV="invalid distance too far back",i.mode=P;break}w>i.wnext?(w-=i.wnext,N=i.wsize-w):N=i.wnext-w,w>i.length&&(w=i.length),r=i.window}else r=X,N=O-i.offset,w=i.length;w>M&&(w=M),M-=w,i.length-=w;do{X[O++]=r[N++]}while(--w);0===i.length&&(i.mode=21);break;case 26:if(0===M)break h;X[O++]=i.length,M--,i.mode=21;break;case 27:if(i.wrap){for(;E<32;){if(0===o)break h;o--,F|=U[D++]<<E,E+=8}if(G-=M,h.total_out+=G,i.total+=G,G&&(h.adler=i.check=i.flags?l(i.check,X,G,O-G):S(i.check,X,G,O-G)),G=M,(i.flags?F:L(F))!==i.check){h.vV="incorrect data check",i.mode=P;break}F=0,E=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;E<32;){if(0===o)break h;o--,F+=U[D++]<<E,E+=8}if(F!==(4294967295&i.total)){h.vV="incorrect length check",i.mode=P;break}F=0,E=0}i.mode=29;case 29:Q=v;break h;case P:Q=T;break h;case 31:return e;default:return t}return h.next_out=O,h.avail_out=M,h.next_in=D,h.avail_in=o,i.hold=F,i.bits=E,(i.wsize||G!==h.avail_out&&i.mode<P&&(i.mode<27||V!==q))&&j(h,h.output,h.next_out,G-h.avail_out)?(i.mode=31,e):(m-=h.avail_in,G-=h.avail_out,h.total_in+=m,h.total_out+=G,i.total+=G,i.wrap&&G&&(h.adler=i.check=i.flags?l(i.check,X,G,h.next_out-G):S(i.check,X,G,h.next_out-G)),h.data_type=i.bits+(i.last?64:0)+(i.mode===f?128:0)+(20===i.mode||15===i.mode?256:0),(0===m&&0===G||V===q)&&Q===I&&(Q=n),Q)},h.exports.inflateEnd=h=>{if(!h||!h.state)return t;let V=h.state;return V.window&&(V.window=null),h.state=null,I},h.exports.inflateGetHeader=(h,V)=>{if(!h||!h.state)return t;const i=h.state;return 0===(2&i.wrap)?t:(i.head=V,V.done=!1,I)},h.exports.inflateSetDictionary=(h,V)=>{const i=V.length;let l,Y,g;return h&&h.state?(l=h.state,0!==l.wrap&&11!==l.mode?t:11===l.mode&&(Y=1,Y=S(Y,V,i,0),Y!==l.check)?T:(g=j(h,V,i,i),g?(l.mode=31,e):(l.havedict=1,I))):t},h.exports.inflateInfo="pako inflate (from Nodeca project)"},12291:h=>{"use strict";const V=15,i=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),S=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),l=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Y=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);h.exports=(h,g,q,B,J,I,v,s)=>{const t=s.bits;let T,e,n,c,f,P,L=0,U=0,X=0,D=0,O=0,o=0,M=0,F=0,E=0,H=0,j=null,m=0;const G=new Uint16Array(16),w=new Uint16Array(16);let N,r,k,R=null,Z=0;for(L=0;L<=V;L++)G[L]=0;for(U=0;U<B;U++)G[g[q+U]]++;for(O=t,D=V;D>=1&&0===G[D];D--);if(O>D&&(O=D),0===D)return J[I++]=20971520,J[I++]=20971520,s.bits=1,0;for(X=1;X<D&&0===G[X];X++);for(O<X&&(O=X),F=1,L=1;L<=V;L++)if(F<<=1,F-=G[L],F<0)return-1;if(F>0&&(0===h||1!==D))return-1;for(w[1]=0,L=1;L<V;L++)w[L+1]=w[L]+G[L];for(U=0;U<B;U++)0!==g[q+U]&&(v[w[g[q+U]]++]=U);if(0===h?(j=R=v,P=19):1===h?(j=i,m-=257,R=S,Z-=257,P=256):(j=l,R=Y,P=-1),H=0,U=0,L=X,f=I,o=O,M=0,n=-1,E=1<<O,c=E-1,1===h&&E>852||2===h&&E>592)return 1;for(;;){N=L-M,v[U]<P?(r=0,k=v[U]):v[U]>P?(r=R[Z+v[U]],k=j[m+v[U]]):(r=96,k=0),T=1<<L-M,e=1<<o,X=e;do{e-=T,J[f+(H>>M)+e]=N<<24|r<<16|k}while(0!==e);for(T=1<<L-1;H&T;)T>>=1;if(0!==T?(H&=T-1,H+=T):H=0,U++,0===--G[L]){if(L===D)break;L=g[q+v[U]]}if(L>O&&(H&c)!==n){for(0===M&&(M=O),f+=X,o=L-M,F=1<<o;o+M<D&&(F-=G[o+M],!(F<=0));)o++,F<<=1;if(E+=1<<o,1===h&&E>852||2===h&&E>592)return 1;n=H&c,J[n]=O<<24|o<<16|f-I}}return 0!==H&&(J[f+H]=L-M<<24|64<<16),s.bits=O,0}},12246:h=>{"use strict";h.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12230:h=>{"use strict";function V(h){let V=h.length;for(;--V>=0;)h[V]=0}const i=256,S=286,l=30,Y=15,g=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),q=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),B=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),J=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),I=new Array(576);V(I);const v=new Array(60);V(v);const s=new Array(512);V(s);const t=new Array(256);V(t);const T=new Array(29);V(T);const e=new Array(l);function n(h,V,i,S,l){this.static_tree=h,this.extra_bits=V,this.extra_base=i,this.elems=S,this.max_length=l,this.has_stree=h&&h.length}let c,f,P;function L(h,V){this.dyn_tree=h,this.max_code=0,this.stat_desc=V}V(e);const U=h=>h<256?s[h]:s[256+(h>>>7)],X=(h,V)=>{h.pending_buf[h.pending++]=255&V,h.pending_buf[h.pending++]=V>>>8&255},D=(h,V,i)=>{h.bi_valid>16-i?(h.bi_buf|=V<<h.bi_valid&65535,X(h,h.bi_buf),h.bi_buf=V>>16-h.bi_valid,h.bi_valid+=i-16):(h.bi_buf|=V<<h.bi_valid&65535,h.bi_valid+=i)},O=(h,V,i)=>{D(h,i[2*V],i[2*V+1])},o=(h,V)=>{let i=0;do{i|=1&h,h>>>=1,i<<=1}while(--V>0);return i>>>1},M=(h,V,i)=>{const S=new Array(16);let l,g,q=0;for(l=1;l<=Y;l++)S[l]=q=q+i[l-1]<<1;for(g=0;g<=V;g++){let V=h[2*g+1];0!==V&&(h[2*g]=o(S[V]++,V))}},F=h=>{let V;for(V=0;V<S;V++)h.dyn_ltree[2*V]=0;for(V=0;V<l;V++)h.dyn_dtree[2*V]=0;for(V=0;V<19;V++)h.bl_tree[2*V]=0;h.dyn_ltree[512]=1,h.opt_len=h.static_len=0,h.last_lit=h.matches=0},E=h=>{h.bi_valid>8?X(h,h.bi_buf):h.bi_valid>0&&(h.pending_buf[h.pending++]=h.bi_buf),h.bi_buf=0,h.bi_valid=0},H=(h,V,i,S)=>{const l=2*V,Y=2*i;return h[l]<h[Y]||h[l]===h[Y]&&S[V]<=S[i]},j=(h,V,i)=>{const S=h.heap[i];let l=i<<1;for(;l<=h.heap_len&&(l<h.heap_len&&H(V,h.heap[l+1],h.heap[l],h.depth)&&l++,!H(V,S,h.heap[l],h.depth));)h.heap[i]=h.heap[l],i=l,l<<=1;h.heap[i]=S},m=(h,V,S)=>{let l,Y,B,J,I=0;if(0!==h.last_lit)do{l=h.pending_buf[h.d_buf+2*I]<<8|h.pending_buf[h.d_buf+2*I+1],Y=h.pending_buf[h.l_buf+I],I++,0===l?O(h,Y,V):(B=t[Y],O(h,B+i+1,V),J=g[B],0!==J&&(Y-=T[B],D(h,Y,J)),l--,B=U(l),O(h,B,S),J=q[B],0!==J&&(l-=e[B],D(h,l,J)))}while(I<h.last_lit);O(h,256,V)},G=(h,V)=>{const i=V.dyn_tree,S=V.stat_desc.static_tree,l=V.stat_desc.has_stree,g=V.stat_desc.elems;let q,B,J,I=-1;for(h.heap_len=0,h.heap_max=573,q=0;q<g;q++)0!==i[2*q]?(h.heap[++h.heap_len]=I=q,h.depth[q]=0):i[2*q+1]=0;for(;h.heap_len<2;)J=h.heap[++h.heap_len]=I<2?++I:0,i[2*J]=1,h.depth[J]=0,h.opt_len--,l&&(h.static_len-=S[2*J+1]);for(V.max_code=I,q=h.heap_len>>1;q>=1;q--)j(h,i,q);J=g;do{q=h.heap[1],h.heap[1]=h.heap[h.heap_len--],j(h,i,1),B=h.heap[1],h.heap[--h.heap_max]=q,h.heap[--h.heap_max]=B,i[2*J]=i[2*q]+i[2*B],h.depth[J]=(h.depth[q]>=h.depth[B]?h.depth[q]:h.depth[B])+1,i[2*q+1]=i[2*B+1]=J,h.heap[1]=J++,j(h,i,1)}while(h.heap_len>=2);h.heap[--h.heap_max]=h.heap[1],((h,V)=>{const i=V.dyn_tree,S=V.max_code,l=V.stat_desc.static_tree,g=V.stat_desc.has_stree,q=V.stat_desc.extra_bits,B=V.stat_desc.extra_base,J=V.stat_desc.max_length;let I,v,s,t,T,e,n=0;for(t=0;t<=Y;t++)h.bl_count[t]=0;for(i[2*h.heap[h.heap_max]+1]=0,I=h.heap_max+1;I<573;I++)v=h.heap[I],t=i[2*i[2*v+1]+1]+1,t>J&&(t=J,n++),i[2*v+1]=t,v>S||(h.bl_count[t]++,T=0,v>=B&&(T=q[v-B]),e=i[2*v],h.opt_len+=e*(t+T),g&&(h.static_len+=e*(l[2*v+1]+T)));if(0!==n){do{for(t=J-1;0===h.bl_count[t];)t--;h.bl_count[t]--,h.bl_count[t+1]+=2,h.bl_count[J]--,n-=2}while(n>0);for(t=J;0!==t;t--)for(v=h.bl_count[t];0!==v;)s=h.heap[--I],s>S||(i[2*s+1]!==t&&(h.opt_len+=(t-i[2*s+1])*i[2*s],i[2*s+1]=t),v--)}})(h,V),M(i,I,h.bl_count)},w=(h,V,i)=>{let S,l,Y=-1,g=V[1],q=0,B=7,J=4;for(0===g&&(B=138,J=3),V[2*(i+1)+1]=65535,S=0;S<=i;S++)l=g,g=V[2*(S+1)+1],++q<B&&l===g||(q<J?h.bl_tree[2*l]+=q:0!==l?(l!==Y&&h.bl_tree[2*l]++,h.bl_tree[32]++):q<=10?h.bl_tree[34]++:h.bl_tree[36]++,q=0,Y=l,0===g?(B=138,J=3):l===g?(B=6,J=3):(B=7,J=4))},N=(h,V,i)=>{let S,l,Y=-1,g=V[1],q=0,B=7,J=4;for(0===g&&(B=138,J=3),S=0;S<=i;S++)if(l=g,g=V[2*(S+1)+1],!(++q<B&&l===g)){if(q<J)do{O(h,l,h.bl_tree)}while(0!==--q);else 0!==l?(l!==Y&&(O(h,l,h.bl_tree),q--),O(h,16,h.bl_tree),D(h,q-3,2)):q<=10?(O(h,17,h.bl_tree),D(h,q-3,3)):(O(h,18,h.bl_tree),D(h,q-11,7));q=0,Y=l,0===g?(B=138,J=3):l===g?(B=6,J=3):(B=7,J=4)}};let r=!1;const k=(h,V,i,S)=>{D(h,0+(S?1:0),3),((h,V,i,S)=>{E(h),S&&(X(h,i),X(h,~i)),h.pending_buf.set(h.window.subarray(V,V+i),h.pending),h.pending+=i})(h,V,i,!0)};h.exports._tr_init=h=>{r||((()=>{let h,V,i,J,L;const U=new Array(16);for(i=0,J=0;J<28;J++)for(T[J]=i,h=0;h<1<<g[J];h++)t[i++]=J;for(t[i-1]=J,L=0,J=0;J<16;J++)for(e[J]=L,h=0;h<1<<q[J];h++)s[L++]=J;for(L>>=7;J<l;J++)for(e[J]=L<<7,h=0;h<1<<q[J]-7;h++)s[256+L++]=J;for(V=0;V<=Y;V++)U[V]=0;for(h=0;h<=143;)I[2*h+1]=8,h++,U[8]++;for(;h<=255;)I[2*h+1]=9,h++,U[9]++;for(;h<=279;)I[2*h+1]=7,h++,U[7]++;for(;h<=287;)I[2*h+1]=8,h++,U[8]++;for(M(I,287,U),h=0;h<l;h++)v[2*h+1]=5,v[2*h]=o(h,5);c=new n(I,g,257,S,Y),f=new n(v,q,0,l,Y),P=new n(new Array(0),B,0,19,7)})(),r=!0),h.l_desc=new L(h.dyn_ltree,c),h.d_desc=new L(h.dyn_dtree,f),h.bl_desc=new L(h.bl_tree,P),h.bi_buf=0,h.bi_valid=0,F(h)},h.exports._tr_stored_block=k,h.exports._tr_flush_block=(h,V,S,l)=>{let Y,g,q=0;h.level>0?(2===h.strm.data_type&&(h.strm.data_type=(h=>{let V,S=4093624447;for(V=0;V<=31;V++,S>>>=1)if(1&S&&0!==h.dyn_ltree[2*V])return 0;if(0!==h.dyn_ltree[18]||0!==h.dyn_ltree[20]||0!==h.dyn_ltree[26])return 1;for(V=32;V<i;V++)if(0!==h.dyn_ltree[2*V])return 1;return 0})(h)),G(h,h.l_desc),G(h,h.d_desc),q=(h=>{let V;for(w(h,h.dyn_ltree,h.l_desc.max_code),w(h,h.dyn_dtree,h.d_desc.max_code),G(h,h.bl_desc),V=18;V>=3&&0===h.bl_tree[2*J[V]+1];V--);return h.opt_len+=3*(V+1)+5+5+4,V})(h),Y=h.opt_len+3+7>>>3,g=h.static_len+3+7>>>3,g<=Y&&(Y=g)):Y=g=S+5,S+4<=Y&&-1!==V?k(h,V,S,l):4===h.strategy||g===Y?(D(h,2+(l?1:0),3),m(h,I,v)):(D(h,4+(l?1:0),3),((h,V,i,S)=>{let l;for(D(h,V-257,5),D(h,i-1,5),D(h,S-4,4),l=0;l<S;l++)D(h,h.bl_tree[2*J[l]+1],3);N(h,h.dyn_ltree,V-1),N(h,h.dyn_dtree,i-1)})(h,h.l_desc.max_code+1,h.d_desc.max_code+1,q+1),m(h,h.dyn_ltree,h.dyn_dtree)),F(h),l&&E(h)},h.exports._tr_tally=(h,V,S)=>(h.pending_buf[h.d_buf+2*h.last_lit]=V>>>8&255,h.pending_buf[h.d_buf+2*h.last_lit+1]=255&V,h.pending_buf[h.l_buf+h.last_lit]=255&S,h.last_lit++,0===V?h.dyn_ltree[2*S]++:(h.matches++,V--,h.dyn_ltree[2*(t[S]+i+1)]++,h.dyn_dtree[2*U(V)]++),h.last_lit===h.lit_bufsize-1),h.exports._tr_align=h=>{D(h,2,3),O(h,256,I),(h=>{16===h.bi_valid?(X(h,h.bi_buf),h.bi_buf=0,h.bi_valid=0):h.bi_valid>=8&&(h.pending_buf[h.pending++]=255&h.bi_buf,h.bi_buf>>=8,h.bi_valid-=8)})(h)}},12271:h=>{"use strict";h.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.vV="",this.state=null,this.data_type=2,this.adler=0}},11925:h=>{function V(h,V,i){for(var S=h.length,l=-1/0,Y=1/0,g=0;g<S;g++){var q=(i[0][g]-h[g])/V[g],B=(i[1][g]-h[g])/V[g];if(q>B){var J=q;q=B,B=J}if(B<l||q>Y)return 1/0;q>l&&(l=q),B<Y&&(Y=B)}return l>Y?1/0:l}h.exports=function(h,i,S,l){var Y=V(i,S,l);if(Y===1/0)h=null;else{h=h||[];for(var g=0;g<i.length;g++)h[g]=i[g]+S[g]*Y}return h},h.exports.distance=V},13271:(h,V,i)=>{"use strict";i.d(V,{d:()=>g});var S=i(41);const l=S.useLayoutEffect;const Y=function(h){var V=(0,S.useRef)(h);return l((function(){V.current=h})),V};var g=function(h){var V=Y(h);(0,S.qV)((function(){var h=function(h){var i;if(null!=V.current&&(i=V.current(h)),h.defaultPrevented&&(h.returnValue=""),"string"===typeof i)return h.returnValue=i,i};return window.addEventListener("beforeunload",h),function(){window.removeEventListener("beforeunload",h)}}),[])}},13229:(h,V,i)=>{"use strict";var S=i(13237),l=Array.prototype.concat,Y=Array.prototype.slice,g=h.exports=function(h){for(var V=[],i=0,g=h.length;i<g;i++){var q=h[i];S(q)?V=l.call(V,Y.call(q)):V.push(q)}return V};g.wrap=function(h){return function(){return h(g(arguments))}}},13237:h=>{h.exports=function(h){return!(!h||"string"===typeof h)&&(h instanceof Array||Array.isArray(h)||h.length>=0&&(h.splice instanceof Function||Object.getOwnPropertyDescriptor(h,h.length-1)&&"String"!==h.constructor.name))}},12166:(h,V,i)=>{var S=i(12174);function l(h){for(var V,i,l=0,Y=h.length,g=0;g<h.length;){for(V=h[g],i=0;g<Y&&h[g]===V;)++g,++i;l+=S.log2(i)/7|0,l+=S.log2(V>>>0)/7|0,l+=2}return l}V.size=l,V.encode=function(h,V){V||(V=new Uint8Array(l(h)));for(var i,S,Y=0,g=V.length,q=0;q<h.length;){for(i=h[q],S=0;q<h.length&&h[q]===i;)++q,++S;for(;Y<g&&S>=128;)V[Y++]=128+(127&S),S>>>=7;if(Y>=g)throw new Error("RLE buffer overflow");for(V[Y++]=S,i>>>=0;Y<g&&i>=128;)V[Y++]=128+(127&i),i>>>=7;if(Y>=g)throw new Error("RLE buffer overflow");V[Y++]=i}return V},V.decode=function(h,V){for(var i,S,l,Y,g=V.length,q=h.length,B=0,J=0;J<q;){for(i=0,S=0;J<q&&h[J]>=128;)i+=(127&h[J++])<<S,S+=7;if(i+=h[J++]<<S,J>=q)throw new Error("RLE buffer underrun");if(B+i>g)throw new Error("Chunk buffer overflow");for(l=0,S=0;J<q&&h[J]>=128;)l+=(127&h[J++])<<S,S+=7;if(J>=q)throw new Error("RLE buffer underrun");for(l+=h[J++]<<S,Y=0;Y<i;++Y)V[B++]=l}return V}},12174:(h,V)=>{"use strict";function i(h){var V=32;return(h&=-h)&&V--,65535&h&&(V-=16),16711935&h&&(V-=8),252645135&h&&(V-=4),858993459&h&&(V-=2),1431655765&h&&(V-=1),V}V.INT_BITS=32,V.INT_MAX=2147483647,V.INT_MIN=-1<<31,V.sign=function(h){return(h>0)-(h<0)},V.abs=function(h){var V=h>>31;return(h^V)-V},V.min=function(h,V){return V^(h^V)&-(h<V)},V.max=function(h,V){return h^(h^V)&-(h<V)},V.isPow2=function(h){return!(h&h-1)&&!!h},V.log2=function(h){var V,i;return V=(h>65535)<<4,V|=i=((h>>>=V)>255)<<3,V|=i=((h>>>=i)>15)<<2,(V|=i=((h>>>=i)>3)<<1)|(h>>>=i)>>1},V.log10=function(h){return h>=1e9?9:h>=1e8?8:h>=1e7?7:h>=1e6?6:h>=1e5?5:h>=1e4?4:h>=1e3?3:h>=100?2:h>=10?1:0},V.popCount=function(h){return 16843009*((h=(858993459&(h-=h>>>1&1431655765))+(h>>>2&858993459))+(h>>>4)&252645135)>>>24},V.countTrailingZeros=i,V.nextPow2=function(h){return h+=0===h,--h,h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)+1},V.prevPow2=function(h){return h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)-(h>>>1)},V.parity=function(h){return h^=h>>>16,h^=h>>>8,h^=h>>>4,27030>>>(h&=15)&1};var S=new Array(256);!function(h){for(var V=0;V<256;++V){var i=V,S=V,l=7;for(i>>>=1;i;i>>>=1)S<<=1,S|=1&i,--l;h[V]=S<<l&255}}(S),V.reverse=function(h){return S[255&h]<<24|S[h>>>8&255]<<16|S[h>>>16&255]<<8|S[h>>>24&255]},V.interleave2=function(h,V){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))|(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))<<1},V.deinterleave2=function(h,V){return(h=65535&((h=16711935&((h=252645135&((h=858993459&((h=h>>>V&1431655765)|h>>>1))|h>>>2))|h>>>4))|h>>>16))<<16>>16},V.interleave3=function(h,V,i){return h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2),(h|=(V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},V.deinterleave3=function(h,V){return(h=1023&((h=4278190335&((h=251719695&((h=3272356035&((h=h>>>V&1227133513)|h>>>2))|h>>>4))|h>>>8))|h>>>16))<<22>>22},V.nextCombination=function(h){var V=h|h-1;return V+1|(~V&-~V)-1>>>i(h)+1}},12206:h=>{"use strict";h.exports=function(h,V,i,S){var l=self||window;try{try{var Y;try{Y=new l.Blob([h])}catch(J){(Y=new(l.BlobBuilder||l.WebKitBlobBuilder||l.MozBlobBuilder||l.MSBlobBuilder)).append(h),Y=Y.getBlob()}var g=l.URL||l.webkitURL,q=g.createObjectURL(Y),B=new l[V](q,i);return g.revokeObjectURL(q),B}catch(J){return new l[V]("data:application/javascript,".concat(encodeURIComponent(h)),i)}}catch(J){if(!S)throw Error("Inline worker is not supported");return new l[V](S,i)}}},11906:(h,V,i)=>{"use strict";function S(h,V,i,S,l){var Y={};return Object.keys(S).forEach((function(h){Y[h]=S[h]})),Y.enumerable=!!Y.enumerable,Y.configurable=!!Y.configurable,("value"in Y||Y.initializer)&&(Y.writable=!0),Y=i.slice().reverse().reduce((function(i,S){return S(h,V,i)||i}),Y),l&&void 0!==Y.initializer&&(Y.value=Y.initializer?Y.initializer.call(l):void 0,Y.initializer=void 0),void 0===Y.initializer&&(Object.defineProperty(h,V,Y),Y=null),Y}i.d(V,{d:()=>S})},11902:(h,V,i)=>{"use strict";function S(h,V,i,S){i&&Object.defineProperty(h,V,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(S):void 0})}i.d(V,{b:()=>S})},13259:(h,V,i)=>{"use strict";i.d(V,{b:()=>g,c:()=>v,e:()=>q,g:()=>Y,k:()=>B,l:()=>l,p:()=>J,s:()=>I});var S=i(11352);class l{constructor(){this._easingMode=l.EASINGMODE_EASEIN}setEasingMode(h){const V=Math.min(Math.max(h,0),2);this._easingMode=V}getEasingMode(){return this._easingMode}easeInCore(h){throw new Error("You must implement this method")}ease(h){switch(this._easingMode){case l.EASINGMODE_EASEIN:return this.easeInCore(h);case l.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-h)}return h>=.5?.5*(1-this.easeInCore(2*(1-h)))+.5:.5*this.easeInCore(2*h)}}l.EASINGMODE_EASEIN=0,l.EASINGMODE_EASEOUT=1,l.EASINGMODE_EASEINOUT=2;class Y extends l{easeInCore(h){return h=Math.max(0,Math.min(1,h)),1-Math.sqrt(1-h*h)}}class g extends l{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=h}easeInCore(h){const V=Math.max(0,this.amplitude);return Math.pow(h,3)-h*V*Math.sin(3.141592653589793*h)}}class q extends l{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=h,this.bounciness=V}easeInCore(h){const V=Math.max(0,this.bounces);let i=this.bounciness;i<=1&&(i=1.001);const S=Math.pow(i,V),l=1-i,Y=(1-S)/l+.5*S,g=h*Y,q=Math.log(-g*(1-i)+1)/Math.log(i),B=Math.floor(q),J=B+1,I=(1-Math.pow(i,B))/(l*Y),v=.5*(I+(1-Math.pow(i,J))/(l*Y)),s=h-v,t=v-I;return-Math.pow(1/i,V-B)/(t*t)*(s-t)*(s+t)}}class B extends l{easeInCore(h){return h*h*h}}class J extends l{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=h,this.springiness=V}easeInCore(h){let V;const i=Math.max(0,this.oscillations),S=Math.max(0,this.springiness);return V=0==S?h:(Math.exp(S*h)-1)/(Math.exp(S)-1),V*Math.sin((6.283185307179586*i+1.5707963267948966)*h)}}class I extends l{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=h}easeInCore(h){return this.exponent<=0?h:(Math.exp(this.exponent*h)-1)/(Math.exp(this.exponent)-1)}}class v extends l{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=h,this.y1=V,this.x2=i,this.y2=S}easeInCore(h){return S.b.Interpolate(h,this.x1,this.y1,this.x2,this.y2)}}},12722:(h,V,i)=>{"use strict";i.d(V,{e:()=>g});var S=i(11138),l=i(11156),Y=i(11564);class g extends Y.c{get _matrix(){return this._compose(),this.Wv}set _matrix(h){(h.updateFlag!==this.Wv.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Wv.l(h),this._markAsDirtyAndDecompose())}constructor(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(h,V.Mh(),!1),this.name=h,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=V,this.Wv=(null===l||void 0===l?void 0:l.clone())??S.Matrix.Identity(),this._restMatrix=Y??this.Wv.clone(),this._bindMatrix=g??this.Wv.clone(),this._index=q,this._absoluteMatrix=new S.Matrix,this._absoluteBindMatrix=new S.Matrix,this._absoluteInverseBindMatrix=new S.Matrix,this._finalMatrix=new S.Matrix,V.bones.push(this),this.setParent(i,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(h){this.setParent(h)}setParent(h){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==h){if(this.parent){const h=this.parent.children.indexOf(this);-1!==h&&this.parent.children.splice(h,1)}this._parentNode=h,this.parent&&this.parent.children.push(this),V&&this._updateAbsoluteBindMatrices(),this.LJ()}}getLocalMatrix(){return this._compose(),this.Wv}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(h){this._restMatrix.l(h)}setRestPose(h){this.setRestMatrix(h)}getBindPose(){return this.getBindMatrix()}setBindMatrix(h){this.xg(h)}setBindPose(h){this.setBindMatrix(h)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const h=S.TmpVectors.nV[0],V=S.TmpVectors.Quaternion[0],i=S.TmpVectors.nV[1];this.getRestMatrix().decompose(h,V,i),this._linkedTransformNode.position.l(i),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??S.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.l(V),this._linkedTransformNode.Jq.l(h)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(h){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=h,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Nq}set position(h){this._decompose(),this.Nq.l(h),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(h){this.setRotation(h)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(h){this.setRotationQuaternion(h)}get Jq(){return this.getScale()}set Jq(h){this.setScale(h)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=S.nV.Zero(),this._localRotation=S.Quaternion.Zero(),this.Nq=S.nV.Zero()),this.Wv.decompose(this._localScaling,this._localRotation,this.Nq))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,S.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Nq,this.Wv)):this._needToCompose=!1)}xg(h){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.l(h),V&&this._updateAbsoluteBindMatrices(),i?this._matrix=h:this.LJ()}_updateAbsoluteBindMatrices(h){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(h||(h=this._bindMatrix),this.parent?h.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.l(h),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),V)for(let i=0;i<this.children.length;i++)this.children[i]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}LJ(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.LJ(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.LJ(),this._needToDecompose=!0}_updatePosition(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Y=this.getLocalMatrix();if(0==V)l?(Y.addAtIndex(12,h.x),Y.addAtIndex(13,h.y),Y.addAtIndex(14,h.z)):Y.setTranslationFromFloats(h.x,h.y,h.z);else{let V=null;i&&(V=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const q=g._TmpMats[0],B=g._TmpVecs[0];this.parent?i&&V?(q.l(this.parent.getAbsoluteMatrix()),q.multiplyToRef(V,q)):q.l(this.parent.getAbsoluteMatrix()):S.Matrix.IdentityToRef(q),l&&q.setTranslationFromFloats(0,0,0),q.invert(),S.nV.TransformCoordinatesToRef(h,q,B),l?(Y.addAtIndex(12,B.x),Y.addAtIndex(13,B.y),Y.addAtIndex(14,B.z)):Y.setTranslationFromFloats(B.x,B.y,B.z)}this._markAsDirtyAndDecompose()}translate(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this._updatePosition(h,V,i,!0)}setPosition(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this._updatePosition(h,V,i,!1)}setAbsolutePosition(h,V){this.setPosition(h,1,V)}scale(h,V,i){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Y=this.getLocalMatrix(),q=g._TmpMats[0];S.Matrix.ScalingToRef(h,V,i,q),q.multiplyToRef(Y,Y),q.invert();for(const S of this.children){const l=S.getLocalMatrix();l.multiplyToRef(q,l),l.multiplyAtIndex(12,h),l.multiplyAtIndex(13,V),l.multiplyAtIndex(14,i),S._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),l)for(const S of this.children)S.scale(h,V,i,l)}setScale(h){this._decompose(),this._localScaling.l(h),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(h){this._decompose(),h.l(this._localScaling)}setYawPitchRoll(h,V,i){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Y=arguments.length>4?arguments[4]:void 0;if(0===l){const q=g._TmpQuat;return S.Quaternion.RotationYawPitchRollToRef(h,V,i,q),void this.setRotationQuaternion(q,l,Y)}const q=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,Y))return;const B=g._TmpMats[1];S.Matrix.RotationYawPitchRollToRef(h,V,i,B),q.multiplyToRef(B,B),this._rotateWithMatrix(B,l,Y)}rotate(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3?arguments[3]:void 0;const Y=g._TmpMats[0];Y.setTranslationFromFloats(0,0,0),S.Matrix.RotationAxisToRef(h,V,Y),this._rotateWithMatrix(Y,i,l)}setAxisAngle(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3?arguments[3]:void 0;if(0===i){const Y=g._TmpQuat;return S.Quaternion.RotationAxisToRef(h,V,Y),void this.setRotationQuaternion(Y,i,l)}const Y=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Y,l))return;const q=g._TmpMats[1];S.Matrix.RotationAxisToRef(h,V,q),Y.multiplyToRef(q,q),this._rotateWithMatrix(q,i,l)}setRotation(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(h.y,h.x,h.z,V,i)}setRotationQuaternion(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(0===V)return this._decompose(),this._localRotation.l(h),void this._markAsDirtyAndCompose();const l=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(l,i))return;const Y=g._TmpMats[1];S.Matrix.FromQuaternionToRef(h,Y),l.multiplyToRef(Y,Y),this._rotateWithMatrix(Y,V,i)}setRotationMatrix(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(0===V){const l=g._TmpQuat;return S.Quaternion.FromRotationMatrixToRef(h,l),void this.setRotationQuaternion(l,V,i)}const l=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(l,i))return;const Y=g._TmpMats[1];Y.l(h),l.multiplyToRef(h,Y),this._rotateWithMatrix(Y,V,i)}_rotateWithMatrix(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;const S=this.getLocalMatrix(),l=S.m[12],Y=S.m[13],q=S.m[14],B=this.getParent(),J=g._TmpMats[3],I=g._TmpMats[4];B&&1==V?(i?(J.l(i.getWorldMatrix()),B.getAbsoluteMatrix().multiplyToRef(J,J)):J.l(B.getAbsoluteMatrix()),I.l(J),I.invert(),S.multiplyToRef(J,S),S.multiplyToRef(h,S),S.multiplyToRef(I,S)):1==V&&i?(J.l(i.getWorldMatrix()),I.l(J),I.invert(),S.multiplyToRef(J,S),S.multiplyToRef(h,S),S.multiplyToRef(I,S)):S.multiplyToRef(h,S),S.setTranslationFromFloats(l,Y,q),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(h,V){const i=g._TmpMats[2];return h.l(this.getAbsoluteMatrix()),V?(h.multiplyToRef(V.getWorldMatrix(),h),S.Matrix.ScalingToRef(V.Jq.x,V.Jq.y,V.Jq.z,i)):S.Matrix.IdentityToRef(i),h.invert(),!isNaN(h.m[0])&&(i.multiplyAtIndex(0,this._scalingDeterminant),h.multiplyToRef(i,h),!0)}lg(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=S.nV.Zero();return this.getPositionToRef(h,V,i),i}getPositionToRef(){let h=arguments.length>1?arguments[1]:void 0,V=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const h=this.getLocalMatrix();V.x=h.m[12],V.y=h.m[13],V.z=h.m[14]}else{let i=null;h&&(i=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let S=g._TmpMats[0];h&&i?(S.l(this.getAbsoluteMatrix()),S.multiplyToRef(i,S)):S=this.getAbsoluteMatrix(),V.x=S.m[12],V.y=S.m[13],V.z=S.m[14]}}getAbsolutePosition(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const V=S.nV.Zero();return this.getPositionToRef(1,h,V),V}getAbsolutePositionToRef(h,V){this.getPositionToRef(1,h,V)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Wv.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.l(this.Wv);const h=this._skeleton.getPoseMatrix();h&&this._absoluteMatrix.multiplyToRef(h,this._absoluteMatrix)}const h=this.children,V=h.length;for(let i=0;i<V;i++)h[i].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}JB(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=S.nV.Zero();return this.getDirectionToRef(h,V,i),i}getDirectionToRef(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,l=null;V&&(l=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Y=g._TmpMats[0];Y.l(this.getAbsoluteMatrix()),V&&l&&Y.multiplyToRef(l,Y),S.nV.TransformNormalToRef(h,Y,i),i.normalize()}getRotation(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=S.nV.Zero();return this.getRotationToRef(h,V,i),i}getRotationToRef(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;const S=g._TmpQuat;this.getRotationQuaternionToRef(h,V,S),S.toEulerAnglesToRef(i)}getRotationQuaternion(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=S.Quaternion.Identity();return this.getRotationQuaternionToRef(h,V,i),i}getRotationQuaternionToRef(){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),V.l(this._localRotation);else{const i=g._TmpMats[0],S=this.getAbsoluteMatrix();h?S.multiplyToRef(h.getWorldMatrix(),i):i.l(S),i.multiplyAtIndex(0,this._scalingDeterminant),i.multiplyAtIndex(1,this._scalingDeterminant),i.multiplyAtIndex(2,this._scalingDeterminant),i.decompose(void 0,V,void 0)}}getRotationMatrix(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1?arguments[1]:void 0;const i=S.Matrix.Identity();return this.getRotationMatrixToRef(h,V,i),i}getRotationMatrixToRef(){let h=arguments.length>1?arguments[1]:void 0,V=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(V);else{const i=g._TmpMats[0],S=this.getAbsoluteMatrix();h?S.multiplyToRef(h.getWorldMatrix(),i):i.l(S),i.multiplyAtIndex(0,this._scalingDeterminant),i.multiplyAtIndex(1,this._scalingDeterminant),i.multiplyAtIndex(2,this._scalingDeterminant),i.getRotationMatrixToRef(V)}}getAbsolutePositionFromLocal(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=S.nV.Zero();return this.getAbsolutePositionFromLocalToRef(h,V,i),i}getAbsolutePositionFromLocalToRef(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,l=null;V&&(l=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Y=g._TmpMats[0];Y.l(this.getAbsoluteMatrix()),V&&l&&Y.multiplyToRef(l,Y),S.nV.TransformCoordinatesToRef(h,Y,i)}getLocalPositionFromAbsolute(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=S.nV.Zero();return this.getLocalPositionFromAbsoluteToRef(h,V,i),i}getLocalPositionFromAbsoluteToRef(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,l=null;V&&(l=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Y=g._TmpMats[0];Y.l(this.getAbsoluteMatrix()),V&&l&&Y.multiplyToRef(l,Y),Y.invert(),S.nV.TransformCoordinatesToRef(h,Y,i)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const h=this._skeleton.bones.indexOf(this);if(-1!==h&&this._skeleton.bones.splice(h,1),this._parentNode&&this._parentNode.children){const h=this._parentNode.children,V=h.indexOf(this);-1!==V&&h.splice(V,1)}super.dispose()}}g._TmpVecs=(0,l.c)(2,S.nV.Zero),g._TmpQuat=S.Quaternion.Identity(),g._TmpMats=(0,l.c)(5,S.Matrix.Identity)},13257:(h,V,i)=>{"use strict";i.d(V,{b:()=>G});var S=i(11123),l=i(11127),Y=i(10960),g=i(11138),q=i(11162),B=i(11564),J=i(11590),I=i(11416),v=i(10975),s=i(11147);class t{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(h){this._zoomStopsAnimation=h}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(h){this._idleRotationSpeed=h}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(h){this._idleRotationWaitTime=h}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(h){this._idleRotationSpinupTime=h}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(h){this._attachedCamera=h;const V=this._attachedCamera.Mh();this._onPrePointerObservableObserver=V.onPrePointerObservable.add((h=>{h.type!==I.e.POINTERDOWN?h.type===I.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=h.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const h=v.e.Now;let V=0;null!=this._lastFrameTime&&(V=h-this._lastFrameTime),this._lastFrameTime=h,this._applyUserInteraction();const i=h-this._lastInteractionTime-this._idleRotationWaitTime,S=Math.max(Math.min(i/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*S,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(V/1e3))}))}detach(){if(!this._attachedCamera)return;const h=this._attachedCamera.Mh();this._onPrePointerObservableObserver&&h.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(h){this._lastInteractionTime=h??v.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<s.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let h=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(h=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?h:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=v.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var T=i(13259),e=i(11665);class n{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(h){if(this._autoTransitionRange===h)return;this._autoTransitionRange=h;const V=this._attachedCamera;V&&(h?this._onMeshTargetChangedObserver=V.onMeshTargetChangedObservable.add((h=>{if(h&&(h.Ag(!0),h.getBoundingInfo)){const V=h.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*V,this.upperRadiusTransitionRange=.05*V}})):this._onMeshTargetChangedObserver&&V.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(h){this._attachedCamera=h,this._onAfterCheckInputsObserver=h.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(h){return!!this._attachedCamera&&(this._attachedCamera.radius===h&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(h){if(!this._attachedCamera)return;this._radiusBounceTransition||(n.EasingFunction.setEasingMode(n.EasingMode),this._radiusBounceTransition=e.d.CreateAnimation("radius",e.d.ANIMATIONTYPE_FLOAT,60,n.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const V=e.d.TransitionTo("radius",this._attachedCamera.radius+h,this._attachedCamera,this._attachedCamera.Mh(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));V&&this._animatables.push(V)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}n.EasingFunction=new T.b(.3),n.EasingMode=T.l.EASINGMODE_EASEOUT;class c{constructor(){this.onTargetFramingAnimationEndObservable=new Y.d,this._mode=c.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(h){this._mode=h}get mode(){return this._mode}set radiusScale(h){this._radiusScale=h}get radiusScale(){return this._radiusScale}set positionScale(h){this._positionScale=h}get positionScale(){return this._positionScale}set defaultElevation(h){this._defaultElevation=h}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(h){this._elevationReturnTime=h}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(h){this._elevationReturnWaitTime=h}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(h){this._zoomStopsAnimation=h}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(h){this._framingTime=h}get framingTime(){return this._framingTime}init(){}attach(h){this._attachedCamera=h;const V=this._attachedCamera.Mh();c.EasingFunction.setEasingMode(c.EasingMode),this._onPrePointerObservableObserver=V.onPrePointerObservable.add((h=>{h.type!==I.e.POINTERDOWN?h.type===I.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=h.onMeshTargetChangedObservable.add((h=>{h&&h.getBoundingInfo&&this.zoomOnMesh(h,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=h.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const h=this._attachedCamera.Mh();this._onPrePointerObservableObserver&&h.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h.Ag(!0);const S=h.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(S.minimumWorld,S.maximumWorld,V,i)}zoomOnMeshHierarchy(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h.Ag(!0);const S=h.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(S.min,S.max,V,i)}zoomOnMeshesHierarchy(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new g.nV(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),l=new g.nV(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let Y=0;Y<h.length;Y++){const V=h[Y].getHierarchyBoundingVectors(!0);g.nV.CheckExtends(V.min,S,l),g.nV.CheckExtends(V.max,S,l)}this.zoomOnBoundingInfo(S,l,V,i)}zoomOnBoundingInfo(h,V){let i,S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const Y=h.y,q=Y+(V.y-Y)*this._positionScale,B=V.cV(h).scale(.5);if(!isFinite(q))return!1;if(S)i=new g.nV(0,q,0);else{const V=h.add(B);i=new g.nV(V.x,q,V.z)}this._vectorTransition||(this._vectorTransition=e.d.CreateAnimation("target",e.d.ANIMATIONTYPE_VECTOR3,60,c.EasingFunction)),this._betaIsAnimating=!0;let J=e.d.TransitionTo("target",i,this._attachedCamera,this._attachedCamera.Mh(),60,this._vectorTransition,this._framingTime);J&&this._animatables.push(J);let I=0;if(this._mode===c.FitFrustumSidesMode){const i=this._calculateLowerRadiusFromModelBoundingSphere(h,V);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=B.length()+this._attachedCamera.Zg),I=i}else this._mode===c.IgnoreBoundsSizeMode&&(I=this._calculateLowerRadiusFromModelBoundingSphere(h,V),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Zg));if(this.autoCorrectCameraLimitsAndSensibility){const i=V.cV(h).length();this._attachedCamera.panningSensibility=5e3/i,this._attachedCamera.wheelPrecision=100/I}return this._radiusTransition||(this._radiusTransition=e.d.CreateAnimation("radius",e.d.ANIMATIONTYPE_FLOAT,60,c.EasingFunction)),J=e.d.TransitionTo("radius",I,this._attachedCamera,this._attachedCamera.Mh(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),l&&l(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),J&&this._animatables.push(J),!0}_calculateLowerRadiusFromModelBoundingSphere(h,V){const i=this._attachedCamera;if(!i)return 0;let S=i._calculateLowerRadiusFromModelBoundingSphere(h,V,this._radiusScale);return i.lowerRadiusLimit&&this._mode===c.IgnoreBoundsSizeMode&&(S=S<i.lowerRadiusLimit?i.lowerRadiusLimit:S),i.upperRadiusLimit&&(S=S>i.upperRadiusLimit?i.upperRadiusLimit:S),S}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const h=v.e.Now-this._lastInteractionTime,V=.5*Math.PI-this._defaultElevation,i=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>i&&h>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=e.d.CreateAnimation("beta",e.d.ANIMATIONTYPE_FLOAT,60,c.EasingFunction));const h=e.d.TransitionTo("beta",V,this._attachedCamera,this._attachedCamera.Mh(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));h&&this._animatables.push(h)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=v.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}c.EasingFunction=new T.s,c.EasingMode=T.l.EASINGMODE_EASEINOUT,c.IgnoreBoundsSizeMode=0,c.FitFrustumSidesMode=1;var f=i(11598),P=i(11623),L=i(12715),U=i(10952);class X{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(h){h=U.Tools.BackCompatCameraNoPreventDefault(arguments);const V=this.camera.getEngine(),i=V.getInputElement();let S=0,l=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=Y=>{var g,q;const B=Y.event,J="touch"===B.pointerType;if(Y.type!==I.e.POINTERMOVE&&-1===this.buttons.indexOf(B.button))return;const v=B.target;if(this._altKey=B.altKey,this._ctrlKey=B.ctrlKey,this._metaKey=B.metaKey,this._shiftKey=B.shiftKey,this._buttonsPressed=B.buttons,V.isPointerLock){const h=B.movementX,V=B.movementY;this.onTouch(null,h,V),this._pointA=null,this._pointB=null}else{if(Y.type!==I.e.POINTERDOWN&&Y.type!==I.e.POINTERDOUBLETAP&&J&&(null===(g=this._pointA)||void 0===g?void 0:g.pointerId)!==B.pointerId&&(null===(q=this._pointB)||void 0===q?void 0:q.pointerId)!==B.pointerId)return;if(Y.type!==I.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!J)if(Y.type===I.e.POINTERDOUBLETAP)this.onDoubleTap(B.pointerType);else if(Y.type!==I.e.POINTERUP||this._currentMousePointerIdDown!==B.pointerId&&!J){if(Y.type===I.e.POINTERMOVE)if(h||B.preventDefault(),this._pointA&&null===this._pointB){const h=B.clientX-this._pointA.x,V=B.clientY-this._pointA.y;this._pointA.x=B.clientX,this._pointA.y=B.clientY,this.onTouch(this._pointA,h,V)}else if(this._pointA&&this._pointB){const h=this._pointA.pointerId===B.pointerId?this._pointA:this._pointB;h.x=B.clientX,h.y=B.clientY;const V=this._pointA.x-this._pointB.x,i=this._pointA.y-this._pointB.y,g=V*V+i*i,q={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:B.pointerId,type:Y.type};this.onMultiTouch(this._pointA,this._pointB,S,g,l,q),l=q,S=g}}else{try{null===v||void 0===v||v.releasePointerCapture(B.pointerId)}catch(s){}J||(this._pointB=null),V._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==B.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==B.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==S||l)&&(this.onMultiTouch(this._pointA,this._pointB,S,0,l,null),S=0,l=null),this._currentMousePointerIdDown=-1,this.onButtonUp(B),h||B.preventDefault()}else{try{null===v||void 0===v||v.setPointerCapture(B.pointerId)}catch(s){}if(null===this._pointA)this._pointA={x:B.clientX,y:B.clientY,pointerId:B.pointerId,type:B.pointerType};else{if(null!==this._pointB)return;this._pointB={x:B.clientX,y:B.clientY,pointerId:B.pointerId,type:B.pointerType}}-1!==this._currentMousePointerIdDown||J||(this._currentMousePointerIdDown=B.pointerId),this.onButtonDown(B),h||(B.preventDefault(),i&&i.focus())}}},this._observer=this.camera.Mh()._inputManager._addCameraPointerObserver(this._pointerInput,I.e.POINTERDOWN|I.e.POINTERUP|I.e.POINTERMOVE|I.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,S=0,l=null,this.onLostFocus()},this._contextMenuBind=h=>this.onContextMenu(h),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);const Y=this.camera.Mh().getEngine().getHostWindow();Y&&U.Tools.RegisterTopRootEvents(Y,[{name:"blur",handler:this._onLostFocus}])}Bv(){if(this._onLostFocus){const h=this.camera.Mh().getEngine().getHostWindow();h&&U.Tools.UnregisterTopRootEvents(h,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Mh()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const h=this.camera.Mh().getEngine().getInputElement();h&&h.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(h){}onTouch(h,V,i){}onMultiTouch(h,V,i,S,l,Y){}onContextMenu(h){h.preventDefault()}onButtonDown(h){}onButtonUp(h){}onLostFocus(){}}(0,S.b)([(0,l.E)()],X.prototype,"buttons",void 0);class D extends X{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(h,V){if(0!==this.panningSensibility&&h&&V){const i=V.x-h.x,S=V.y-h.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=S/this.panningSensibility}}_computePinchZoom(h,V){const i=this.camera.radius||D.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(h)/Math.sqrt(V):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(V-h)*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(V-h)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(h,V,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-V/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=V/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(h,V,i,S,l,Y){0===i&&null===l||0===S&&null===Y||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,S),this._computeMultiTouchPanning(l,Y)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(S)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,S),this._isPinching=!0):this._computeMultiTouchPanning(l,Y)):this.multiTouchPanning?this._computeMultiTouchPanning(l,Y):this.pinchZoom&&this._computePinchZoom(i,S))}onButtonDown(h){this._isPanClick=h.button===this.camera._panningMouseButton}onButtonUp(h){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}D.MinimumRadiusForPinch=.001,(0,S.b)([(0,l.E)()],D.prototype,"buttons",void 0),(0,S.b)([(0,l.E)()],D.prototype,"angularSensibilityX",void 0),(0,S.b)([(0,l.E)()],D.prototype,"angularSensibilityY",void 0),(0,S.b)([(0,l.E)()],D.prototype,"pinchPrecision",void 0),(0,S.b)([(0,l.E)()],D.prototype,"pinchDeltaPercentage",void 0),(0,S.b)([(0,l.E)()],D.prototype,"useNaturalPinchZoom",void 0),(0,S.b)([(0,l.E)()],D.prototype,"pinchZoom",void 0),(0,S.b)([(0,l.E)()],D.prototype,"panningSensibility",void 0),(0,S.b)([(0,l.E)()],D.prototype,"multiTouchPanning",void 0),(0,S.b)([(0,l.E)()],D.prototype,"multiTouchPanAndZoom",void 0),L.e.ArcRotateCameraPointersInput=D;var O=i(11421);class o{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(h){h=U.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Mh(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((V=>{const i=V.event;if(!i.metaKey)if(V.type===O.e.KEYDOWN){if(this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&(h||i.preventDefault())}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){const V=this._keys.indexOf(i.keyCode);V>=0&&this._keys.splice(V,1),i.preventDefault&&(h||i.preventDefault())}})))}Bv(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const h=this.camera;for(let V=0;V<this._keys.length;V++){const i=this._keys[V];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningX-=1/this.panningSensibility:h.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?h.inertialRadiusOffset+=1/this.zoomingSensibility:h.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningX+=1/this.panningSensibility:h.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?h.inertialRadiusOffset-=1/this.zoomingSensibility:h.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&h.useInputToRestoreState&&h.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,S.b)([(0,l.E)()],o.prototype,"keysUp",void 0),(0,S.b)([(0,l.E)()],o.prototype,"keysDown",void 0),(0,S.b)([(0,l.E)()],o.prototype,"keysLeft",void 0),(0,S.b)([(0,l.E)()],o.prototype,"keysRight",void 0),(0,S.b)([(0,l.E)()],o.prototype,"keysReset",void 0),(0,S.b)([(0,l.E)()],o.prototype,"panningSensibility",void 0),(0,S.b)([(0,l.E)()],o.prototype,"zoomingSensibility",void 0),(0,S.b)([(0,l.E)()],o.prototype,"useAltToZoom",void 0),(0,S.b)([(0,l.E)()],o.prototype,"angularSpeed",void 0),L.e.ArcRotateCameraKeyboardMoveInput=o;var M=i(11198),F=i(11425);class E{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new g.nV(0,0,0),this._globalOffset=new g.nV(0,0,0),this._inertialPanning=g.nV.Zero()}_computeDeltaFromMouseWheelLegacyEvent(h,V){let i=0;const S=.01*h*this.wheelDeltaPercentage*V;return i=h>0?S/(1+this.wheelDeltaPercentage):S*(1+this.wheelDeltaPercentage),i}attachControl(h){h=U.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=V=>{if(V.type!==I.e.POINTERWHEEL)return;const i=V.event;let S=0;const l=i.deltaMode===F.c.DOM_DELTA_LINE?40:1,Y=-i.deltaY*l;if(this.customComputeDeltaFromMouseWheel)S=this.customComputeDeltaFromMouseWheel(Y,this,i);else if(this.wheelDeltaPercentage){if(S=this._computeDeltaFromMouseWheelLegacyEvent(Y,this.camera.radius),S>0){let h=this.camera.radius,V=this.camera.inertialRadiusOffset+S;for(let i=0;i<20&&!(h<=V)&&!(Math.abs(V*this.camera.inertia)<.001);i++)h-=V,V*=this.camera.inertia;h=(0,q.Clamp)(h,0,Number.MAX_VALUE),S=this._computeDeltaFromMouseWheelLegacyEvent(Y,h)}}else S=Y/(40*this.wheelPrecision);S&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(S)):this.camera.inertialRadiusOffset+=S),i.preventDefault&&(h||i.preventDefault())},this._observer=this.camera.Mh()._inputManager._addCameraPointerObserver(this._wheel,I.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Iq(0)}Bv(){this._observer&&(this.camera.Mh()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const h=this.camera;0+h.inertialAlphaOffset+h.inertialBetaOffset+h.inertialRadiusOffset&&(this._updateHitPlane(),h.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(h.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const h=this.camera,V=h.target.cV(h.position);this._hitPlane=M.b.FromPositionAndNormal(h.target,V)}_getPosition(){const h=this.camera,V=h.Mh(),i=V.createPickingRay(V.pointerX,V.pointerY,g.Matrix.Identity(),h,!1);0===h.targetScreenOffset.x&&0===h.targetScreenOffset.y||(this._viewOffset.set(h.targetScreenOffset.x,h.targetScreenOffset.y,0),h.getViewMatrix().invertToRef(h._cameraTransformMatrix),this._globalOffset=g.nV.TransformNormal(this._viewOffset,h._cameraTransformMatrix),i.origin.addInPlace(this._globalOffset));let S=0;return this._hitPlane&&(S=i.intersectsPlane(this._hitPlane)??0),i.origin.addInPlace(i.direction.scaleInPlace(S))}_zoomToMouse(h){const V=this.camera,i=1-V.inertia;if(V.lowerRadiusLimit){const S=V.lowerRadiusLimit??0;V.radius-(V.inertialRadiusOffset+h)/i<S&&(h=(V.radius-S)*i-V.inertialRadiusOffset)}if(V.upperRadiusLimit){const S=V.upperRadiusLimit??0;V.radius-(V.inertialRadiusOffset+h)/i>S&&(h=(V.radius-S)*i-V.inertialRadiusOffset)}const S=h/i/V.radius,l=this._getPosition(),Y=g.TmpVectors.nV[6];l.subtractToRef(V.target,Y),Y.scaleInPlace(S),Y.scaleInPlace(i),this._inertialPanning.addInPlace(Y),V.inertialRadiusOffset+=h}_zeroIfClose(h){Math.abs(h.x)<s.c&&(h.x=0),Math.abs(h.y)<s.c&&(h.y=0),Math.abs(h.z)<s.c&&(h.z=0)}}(0,S.b)([(0,l.E)()],E.prototype,"wheelPrecision",void 0),(0,S.b)([(0,l.E)()],E.prototype,"zoomToMouseLocation",void 0),(0,S.b)([(0,l.E)()],E.prototype,"wheelDeltaPercentage",void 0),L.e.ArcRotateCameraMouseWheelInput=E;class H extends L.f{constructor(h){super(h)}addMouseWheel(){return this.add(new E),this}addPointers(){return this.add(new D),this}addKeyboard(){return this.add(new o),this}}var j=i(11091);function m(h,V){return isNaN(h)?V:h}B.c.AddNodeConstructor("ArcRotateCamera",((h,V)=>()=>new G(h,0,0,1,g.nV.Zero(),V)));class G extends P.c{get target(){return this._target}set target(h){this.setTarget(h)}get targetHost(){return this._targetHost}set targetHost(h){h&&this.setTarget(h)}getTarget(){return this.target}get position(){return this._position}set position(h){this.setPosition(h)}set upVector(h){this._upToYMatrix||(this._yToUpMatrix=new g.Matrix,this._upToYMatrix=new g.Matrix,this._upVector=g.nV.Zero()),h.normalize(),this._upVector.l(h),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){g.Matrix.RotationAlignToRef(g.nV.UpReadOnly,this._upVector,this._yToUpMatrix),g.Matrix.RotationAlignToRef(this._upVector,g.nV.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const h=this.inputs.attached.pointers;return h?h.angularSensibilityX:0}set angularSensibilityX(h){const V=this.inputs.attached.pointers;V&&(V.angularSensibilityX=h)}get angularSensibilityY(){const h=this.inputs.attached.pointers;return h?h.angularSensibilityY:0}set angularSensibilityY(h){const V=this.inputs.attached.pointers;V&&(V.angularSensibilityY=h)}get pinchPrecision(){const h=this.inputs.attached.pointers;return h?h.pinchPrecision:0}set pinchPrecision(h){const V=this.inputs.attached.pointers;V&&(V.pinchPrecision=h)}get pinchDeltaPercentage(){const h=this.inputs.attached.pointers;return h?h.pinchDeltaPercentage:0}set pinchDeltaPercentage(h){const V=this.inputs.attached.pointers;V&&(V.pinchDeltaPercentage=h)}get useNaturalPinchZoom(){const h=this.inputs.attached.pointers;return!!h&&h.useNaturalPinchZoom}set useNaturalPinchZoom(h){const V=this.inputs.attached.pointers;V&&(V.useNaturalPinchZoom=h)}get panningSensibility(){const h=this.inputs.attached.pointers;return h?h.panningSensibility:0}set panningSensibility(h){const V=this.inputs.attached.pointers;V&&(V.panningSensibility=h)}get keysUp(){const h=this.inputs.attached.keyboard;return h?h.keysUp:[]}set keysUp(h){const V=this.inputs.attached.keyboard;V&&(V.keysUp=h)}get keysDown(){const h=this.inputs.attached.keyboard;return h?h.keysDown:[]}set keysDown(h){const V=this.inputs.attached.keyboard;V&&(V.keysDown=h)}get keysLeft(){const h=this.inputs.attached.keyboard;return h?h.keysLeft:[]}set keysLeft(h){const V=this.inputs.attached.keyboard;V&&(V.keysLeft=h)}get keysRight(){const h=this.inputs.attached.keyboard;return h?h.keysRight:[]}set keysRight(h){const V=this.inputs.attached.keyboard;V&&(V.keysRight=h)}get wheelPrecision(){const h=this.inputs.attached.mousewheel;return h?h.wheelPrecision:0}set wheelPrecision(h){const V=this.inputs.attached.mousewheel;V&&(V.wheelPrecision=h)}get zoomToMouseLocation(){const h=this.inputs.attached.mousewheel;return!!h&&h.zoomToMouseLocation}set zoomToMouseLocation(h){const V=this.inputs.attached.mousewheel;V&&(V.zoomToMouseLocation=h)}get wheelDeltaPercentage(){const h=this.inputs.attached.mousewheel;return h?h.wheelDeltaPercentage:0}set wheelDeltaPercentage(h){const V=this.inputs.attached.mousewheel;V&&(V.wheelDeltaPercentage=h)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(h){h!==this.useBouncingBehavior&&(h?(this._bouncingBehavior=new n,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(h){h!==this.useFramingBehavior&&(h?(this._framingBehavior=new c,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(h){h!==this.useAutoRotationBehavior&&(h?(this._autoRotationBehavior=new t,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(h,V,i,S,l,q){var B;let J=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(h,g.nV.Zero(),q,J),B=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=g.nV.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=g.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new g.Matrix,this.panningAxis=new g.nV(1,1,0),this._transformedDirection=new g.nV,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new Y.d,this.checkCollisions=!1,this.collisionRadius=new g.nV(.5,.5,.5),this._previousPosition=g.nV.Zero(),this._collisionVelocity=g.nV.Zero(),this._newPosition=g.nV.Zero(),this._computationVector=g.nV.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new g.nV(NaN,NaN,NaN),this._goalTargetScreenOffset=new g.Vector2(NaN,NaN),this._onCollisionPositionChange=function(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i?(B.setPosition(V),B.As&&B.As(i)):B._previousPosition.l(B._position);const S=Math.cos(B.alpha),l=Math.sin(B.alpha),Y=Math.cos(B.beta);let g=Math.sin(B.beta);0===g&&(g=1e-4);const q=B._getTargetPosition();B._computationVector.qq(B.radius*S*g,B.radius*Y,B.radius*l*g),q.addToRef(B._computationVector,B._newPosition),B._position.l(B._newPosition);let J=B.upVector;B.allowUpsideDown&&B.beta<0&&(J=J.clone(),J=J.negate()),B._computeViewMatrix(B._position,q,J),B._viewMatrix.addAtIndex(12,B.targetScreenOffset.x),B._viewMatrix.addAtIndex(13,B.targetScreenOffset.y),B._collisionTriggered=!1},this._target=g.nV.Zero(),l&&this.setTarget(l),this.alpha=V,this.beta=i,this.radius=S,this.getViewMatrix(),this.inputs=new H(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new g.nV(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=g.Vector2.Zero()}_updateCache(h){h||super._updateCache(),this._cache._target.l(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.l(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const h=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?h.addToRef(this._targetBoundingCenter,this._target):this._target.l(h)}const h=this._getLockedTargetPosition();return h||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>s.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,Y=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=Y?this._currentInterpolationFactor=Y:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=m(h,this._goalAlpha),this._goalBeta=m(V,this._goalBeta),this._goalRadius=m(i,this._goalRadius),this._goalTarget.set(m(S.x,this._goalTarget.x),m(S.y,this._goalTarget.y),m(S.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(m(l.x,this._goalTargetScreenOffset.x),m(l.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,q.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,q.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,q.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,q.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(h,V){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const l=arguments;V=U.Tools.BackCompatCameraNoPreventDefault(l),this._useCtrlForPanning=i,this._panningMouseButton=S,"boolean"===typeof l[0]&&(l.length>1&&(this._useCtrlForPanning=l[1]),l.length>2&&(this._panningMouseButton=l[2])),this.inputs.attachElement(V),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Bv(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let h=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){h=!0;const V=this.invertRotation?-1:1,i=this._calculateHandednessMultiplier();let S=this.inertialAlphaOffset*i;this.beta<0&&(S*=-1),this.alpha+=S*V,this.beta+=this.inertialBetaOffset*V,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<s.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<s.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*s.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){h=!0;const V=new g.nV(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),V.multiplyInPlace(this.panningAxis),g.nV.TransformNormalToRef(V,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const h=this.upVector,V=g.nV.CrossToRef(this._transformedDirection,h,this._transformedDirection);g.nV.CrossToRef(h,V,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);g.nV.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.l(this._transformedDirection)}else{if(this.parent){const h=g.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.transposeToRef(h),g.nV.TransformCoordinatesToRef(this._transformedDirection,h,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*s.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*s.c&&(this.inertialPanningY=0)}if(h)this.stopInterpolation();else if(this._isInterpolating){let h=!1;const V=this._scene.getEngine().getDeltaTime()/1e3,i=1-Math.pow(2,-V/this._currentInterpolationFactor),S=m(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const V=g.TmpVectors.nV[0].set(m(this._goalTarget.x,this._target.x),m(this._goalTarget.y,this._target.y),m(this._goalTarget.z,this._target.z));g.nV.LerpToRef(this.target,V,i,this._target),10*g.nV.Distance(this.target,V)/S<s.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.l(V),this.setTarget(this.target,!1,!0,!0)):h=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const V=g.Quaternion.RotationAlphaBetaGammaToRef(m(this._goalAlpha,this.alpha),m(this._goalBeta,this.beta),0,g.TmpVectors.Quaternion[0]),S=g.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,g.TmpVectors.Quaternion[1]),l=g.Quaternion.SlerpToRef(S,V,i,g.TmpVectors.Quaternion[2]);l.normalize();const Y=l.toAlphaBetaGammaToRef(g.TmpVectors.nV[0]);if(this.alpha=Y.x,this.beta=Y.y,l.isApprox(V,s.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const h=V.toAlphaBetaGammaToRef(g.TmpVectors.nV[0]);this.alpha=h.x,this.beta=h.y}else h=!0}if(isNaN(this._goalRadius)||(this.radius+=(S-this.radius)*i,Math.abs(S/this.radius-1)<s.c?(this._goalRadius=NaN,this.radius=S):h=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const V=g.TmpVectors.Vector2[0].set(m(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),m(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));g.Vector2.LerpToRef(this.targetScreenOffset,V,i,this.targetScreenOffset),g.Vector2.Distance(this.targetScreenOffset,V)<s.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.l(V)):h=!0}this._isInterpolating=h}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.nV.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const h=this.alpha;var V,i;this.alpha=function(h){let V=Math.PI/2;return 0===h.x&&0===h.z||(V=Math.acos(h.x/Math.sqrt(Math.pow(h.x,2)+Math.pow(h.z,2)))),h.z<0&&(V=2*Math.PI-V),V}(this._computationVector),this.beta=(V=this._computationVector.y,i=this.radius,Math.acos(V/i));const S=Math.round((h-this.alpha)/(2*Math.PI));this.alpha+=2*S*Math.PI,this._checkLimits()}setPosition(h){this._position.equals(h)||(this._position.l(h),this.rebuildAnglesAndRadius())}setTarget(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(S=this.overrideCloneAlphaBetaRadius??S,h.Ag)V&&h.getBoundingInfo?this._targetBoundingCenter=h.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,h.Ag(),this._targetHost=h,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const V=h,S=this._getTargetPosition();if(S&&!i&&S.equals(V))return;this._targetHost=null,this._target=V,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}S||this.rebuildAnglesAndRadius()}_getViewMatrix(){const h=Math.cos(this.alpha),V=Math.sin(this.alpha),i=Math.cos(this.beta);let S=Math.sin(this.beta);0===S&&(S=1e-4),0===this.radius&&(this.radius=1e-4);const l=this._getTargetPosition();if(this._computationVector.qq(this.radius*h*S,this.radius*i,this.radius*V*S),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.nV.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),l.addToRef(this._computationVector,this._newPosition),this.Mh().collisionsEnabled&&this.checkCollisions){const h=this.Mh().collisionCoordinator;this._collider||(this._collider=h.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,h.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.l(this._newPosition);let h=this.upVector;this.allowUpsideDown&&S<0&&(h=h.negate()),this._computeViewMatrix(this._position,l,h),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.l(l),this._viewMatrix}zoomOn(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h=h||this.Mh().meshes;const i=J.e.MinMax(h);let S=this._calculateLowerRadiusFromModelBoundingSphere(i.min,i.max);if(S=Math.max(Math.min(S,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=S*this.zoomOnFactor,this.mode===f.b.ORTHOGRAPHIC_CAMERA){const h=this.Mh().getEngine().getAspectRatio(this),V=S*this.zoomOnFactor/2;this.orthoLeft=-V*h,this.orthoRight=V*h,this.orthoBottom=-V,this.orthoTop=V}this.focusOn({min:i.min,max:i.max,distance:S},V)}focusOn(h){let V,i,S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===h.min){const S=h||this.Mh().meshes;V=J.e.MinMax(S),i=g.nV.Distance(V.min,V.max)}else{V=h,i=h.distance}this._target=J.e.Center(V),S||(this.maxZ=2*i)}createRigCamera(h,V){let i=0;switch(this.cameraRigMode){case f.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case f.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case f.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case f.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case f.b.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===V?1:-1);break;case f.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===V?-1:1)}const S=new G(h,this.alpha+i,this.beta,this.radius,this._target,this.Mh());return S._cameraRigParams={},S.isRigCamera=!0,S.rigParent=this,S.upVector=this.upVector,S.mode=this.mode,S.orthoLeft=this.orthoLeft,S.orthoRight=this.orthoRight,S.orthoBottom=this.orthoBottom,S.orthoTop=this.orthoTop,S}_updateRigCameras(){const h=this._rigCameras[0],V=this._rigCameras[1];switch(h.beta=V.beta=this.beta,this.cameraRigMode){case f.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case f.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case f.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case f.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case f.b.RIG_MODE_VR:h.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,V.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case f.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:h.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,V.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const S=g.nV.Distance(h,V),l=this.Mh().getEngine().getAspectRatio(this),Y=Math.tan(this.fov/2),q=Y*l,B=.5*S*i,J=B*Math.sqrt(1+1/(q*q)),I=B*Math.sqrt(1+1/(Y*Y));return Math.max(J,I)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,S.b)([(0,l.E)()],G.prototype,"alpha",void 0),(0,S.b)([(0,l.E)()],G.prototype,"beta",void 0),(0,S.b)([(0,l.E)()],G.prototype,"radius",void 0),(0,S.b)([(0,l.E)()],G.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,S.b)([(0,l.A)("target")],G.prototype,"_target",void 0),(0,S.b)([(0,l.q)("targetHost")],G.prototype,"_targetHost",void 0),(0,S.b)([(0,l.E)()],G.prototype,"inertialAlphaOffset",void 0),(0,S.b)([(0,l.E)()],G.prototype,"inertialBetaOffset",void 0),(0,S.b)([(0,l.E)()],G.prototype,"inertialRadiusOffset",void 0),(0,S.b)([(0,l.E)()],G.prototype,"lowerAlphaLimit",void 0),(0,S.b)([(0,l.E)()],G.prototype,"upperAlphaLimit",void 0),(0,S.b)([(0,l.E)()],G.prototype,"lowerBetaLimit",void 0),(0,S.b)([(0,l.E)()],G.prototype,"upperBetaLimit",void 0),(0,S.b)([(0,l.E)()],G.prototype,"lowerRadiusLimit",void 0),(0,S.b)([(0,l.E)()],G.prototype,"upperRadiusLimit",void 0),(0,S.b)([(0,l.E)()],G.prototype,"lowerTargetYLimit",void 0),(0,S.b)([(0,l.E)()],G.prototype,"inertialPanningX",void 0),(0,S.b)([(0,l.E)()],G.prototype,"inertialPanningY",void 0),(0,S.b)([(0,l.E)()],G.prototype,"pinchToPanMaxDistance",void 0),(0,S.b)([(0,l.E)()],G.prototype,"panningDistanceLimit",void 0),(0,S.b)([(0,l.A)()],G.prototype,"panningOriginTarget",void 0),(0,S.b)([(0,l.E)()],G.prototype,"panningInertia",void 0),(0,S.b)([(0,l.E)()],G.prototype,"zoomToMouseLocation",null),(0,S.b)([(0,l.E)()],G.prototype,"zoomOnFactor",void 0),(0,S.b)([(0,l.w)()],G.prototype,"targetScreenOffset",void 0),(0,S.b)([(0,l.E)()],G.prototype,"allowUpsideDown",void 0),(0,S.b)([(0,l.E)()],G.prototype,"useInputToRestoreState",void 0),(0,S.b)([(0,l.E)()],G.prototype,"restoreStateInterpolationFactor",void 0),(0,j.f)("BABYLON.ArcRotateCamera",G)},12715:(h,V,i)=>{"use strict";i.d(V,{e:()=>g,f:()=>q});var S=i(10967),l=i(11179),Y=i(11598),g={};class q{constructor(h){this.attachedToElement=!1,this.attached={},this.camera=h,this.checkInputs=()=>{}}add(h){const V=h.getSimpleName();this.attached[V]?S.d.Warn("camera input of type "+V+" already exists on camera"):(this.attached[V]=h,h.camera=this.camera,h.checkInputs&&(this.checkInputs=this._addCheckInputs(h.checkInputs.bind(h))),this.attachedToElement&&h.attachControl(this.noPreventDefault))}remove(h){for(const V in this.attached){const i=this.attached[V];if(i===h)return i.Bv(),i.camera=null,delete this.attached[V],void this.rebuildInputCheck()}}removeByType(h){for(const V in this.attached){const i=this.attached[V];i.getClassName()===h&&(i.Bv(),i.camera=null,delete this.attached[V],this.rebuildInputCheck())}}_addCheckInputs(h){const V=this.checkInputs;return()=>{V(),h()}}attachInput(h){this.attachedToElement&&h.attachControl(this.noPreventDefault)}attachElement(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){h=!Y.b.ForceAttachControlToAlwaysPreventDefault&&h,this.attachedToElement=!0,this.noPreventDefault=h;for(const V in this.attached)this.attached[V].attachControl(h)}}detachElement(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const V in this.attached)this.attached[V].Bv(),h&&(this.attached[V].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const h in this.attached){const V=this.attached[h];V.checkInputs&&(this.checkInputs=this._addCheckInputs(V.checkInputs.bind(V)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(h){const V={};for(const i in this.attached){const h=this.attached[i],S=l.d.Serialize(h);V[h.getClassName()]=S}h.inputsmgr=V}parse(h){const V=h.inputsmgr;if(V){this.clear();for(const h in V){const i=g[h];if(i){const S=V[h],Y=l.d.Parse((()=>new i),S,null);this.add(Y)}}}else for(const i in this.attached){const V=g[this.attached[i].getClassName()];if(V){const S=l.d.Parse((()=>new V),h,null);this.remove(this.attached[i]),this.add(S)}}}}},12708:(h,V,i)=>{"use strict";i.d(V,{c:()=>X});var S=i(11123),l=i(11127),Y=i(11138),g=i(11623),q=i(12715),B=i(11421),J=i(10952);class I{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(h){h=J.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Mh(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((V=>{const i=V.event;if(!i.metaKey)if(V.type===B.e.KEYDOWN){if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),h||i.preventDefault()}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){const V=this._keys.indexOf(i.keyCode);V>=0&&this._keys.splice(V,1),h||i.preventDefault()}})))}Bv(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const h=this.camera;for(let V=0;V<this._keys.length;V++){const i=this._keys[V],S=h._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?h._localDirection.qq(-S,0,0):-1!==this.keysUp.indexOf(i)?h._localDirection.qq(0,0,S):-1!==this.keysRight.indexOf(i)?h._localDirection.qq(S,0,0):-1!==this.keysDown.indexOf(i)?h._localDirection.qq(0,0,-S):-1!==this.keysUpward.indexOf(i)?h._localDirection.qq(0,S,0):-1!==this.keysDownward.indexOf(i)?h._localDirection.qq(0,-S,0):-1!==this.keysRotateLeft.indexOf(i)?(h._localDirection.qq(0,0,0),h.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(i)?(h._localDirection.qq(0,0,0),h.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(i)?(h._localDirection.qq(0,0,0),h.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(i)&&(h._localDirection.qq(0,0,0),h.cameraRotation.x+=this._getLocalRotation()),h.Mh().useRightHandedSystem&&(h._localDirection.z*=-1),h.getViewMatrix().invertToRef(h._cameraTransformMatrix),Y.nV.TransformNormalToRef(h._localDirection,h._cameraTransformMatrix,h._transformedDirection),h.cameraDirection.addInPlace(h._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const h=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*h}}(0,S.b)([(0,l.E)()],I.prototype,"keysUp",void 0),(0,S.b)([(0,l.E)()],I.prototype,"keysUpward",void 0),(0,S.b)([(0,l.E)()],I.prototype,"keysDown",void 0),(0,S.b)([(0,l.E)()],I.prototype,"keysDownward",void 0),(0,S.b)([(0,l.E)()],I.prototype,"keysLeft",void 0),(0,S.b)([(0,l.E)()],I.prototype,"keysRight",void 0),(0,S.b)([(0,l.E)()],I.prototype,"rotationSpeed",void 0),(0,S.b)([(0,l.E)()],I.prototype,"keysRotateLeft",void 0),(0,S.b)([(0,l.E)()],I.prototype,"keysRotateRight",void 0),(0,S.b)([(0,l.E)()],I.prototype,"keysRotateUp",void 0),(0,S.b)([(0,l.E)()],I.prototype,"keysRotateDown",void 0),q.e.FreeCameraKeyboardMoveInput=I;var v=i(10960),s=i(11416);class t{constructor(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=h,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new v.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(h){h=J.Tools.BackCompatCameraNoPreventDefault(arguments);const V=this.camera.getEngine(),i=V.getInputElement();this._pointerInput||(this._pointerInput=S=>{const l=S.event,Y="touch"===l.pointerType;if(!this.touchEnabled&&Y)return;if(S.type!==s.e.POINTERMOVE&&-1===this.buttons.indexOf(l.button))return;const g=l.target;if(S.type===s.e.POINTERDOWN){if(Y&&-1!==this._activePointerId||!Y&&-1!==this._currentActiveButton)return;this._activePointerId=l.pointerId;try{null===g||void 0===g||g.setPointerCapture(l.pointerId)}catch(q){}-1===this._currentActiveButton&&(this._currentActiveButton=l.button),this._previousPosition={x:l.clientX,y:l.clientY},h||(l.preventDefault(),i&&i.focus()),V.isPointerLock&&this._onMouseMove&&this._onMouseMove(S.event)}else if(S.type===s.e.POINTERUP){if(Y&&this._activePointerId!==l.pointerId||!Y&&this._currentActiveButton!==l.button)return;try{null===g||void 0===g||g.releasePointerCapture(l.pointerId)}catch(q){}this._currentActiveButton=-1,this._previousPosition=null,h||l.preventDefault(),this._activePointerId=-1}else if(S.type===s.e.POINTERMOVE&&(this._activePointerId===l.pointerId||!Y))if(V.isPointerLock&&this._onMouseMove)this._onMouseMove(S.event);else if(this._previousPosition){const V=this.camera._calculateHandednessMultiplier(),i=(l.clientX-this._previousPosition.x)*V,S=l.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=i/this.angularSensibility,this.camera.cameraRotation.x+=S/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:i,offsetY:S}),this._previousPosition={x:l.clientX,y:l.clientY},h||l.preventDefault()}}),this._onMouseMove=i=>{if(!V.isPointerLock)return;const S=this.camera._calculateHandednessMultiplier(),l=i.movementX*S;this.camera.cameraRotation.y+=l/this.angularSensibility;const Y=i.movementY;this.camera.cameraRotation.x+=Y/this.angularSensibility,this._previousPosition=null,h||i.preventDefault()},this._observer=this.camera.Mh()._inputManager._addCameraPointerObserver(this._pointerInput,s.e.POINTERDOWN|s.e.POINTERUP|s.e.POINTERMOVE),i&&(this._contextMenuBind=h=>this.onContextMenu(h),i.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(h){h.preventDefault()}Bv(){if(this._observer){if(this.camera.Mh()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const h=this.camera.getEngine().getInputElement();h&&h.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,S.b)([(0,l.E)()],t.prototype,"buttons",void 0),(0,S.b)([(0,l.E)()],t.prototype,"angularSensibility",void 0),q.e.FreeCameraMouseInput=t;var T,e=i(11425);class n{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new v.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(h){h=J.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=V=>{if(V.type!==s.e.POINTERWHEEL)return;const i=V.event,S=i.deltaMode===e.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*S*i.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*S*i.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*S*i.deltaZ/this._normalize,i.preventDefault&&(h||i.preventDefault())},this._observer=this.camera.Mh()._inputManager._addCameraPointerObserver(this._wheel,s.e.POINTERWHEEL)}Bv(){this._observer&&(this.camera.Mh()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,S.b)([(0,l.E)()],n.prototype,"wheelPrecisionX",void 0),(0,S.b)([(0,l.E)()],n.prototype,"wheelPrecisionY",void 0),(0,S.b)([(0,l.E)()],n.prototype,"wheelPrecisionZ",void 0),function(h){h[h.MoveRelative=0]="MoveRelative",h[h.RotateRelative=1]="RotateRelative",h[h.MoveScene=2]="MoveScene"}(T||(T={}));class c extends n{constructor(){super(...arguments),this._moveRelative=Y.nV.Zero(),this._rotateRelative=Y.nV.Zero(),this._moveScene=Y.nV.Zero(),this._wheelXAction=T.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=T.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(h){null===h&&this._wheelXAction!==T.MoveRelative||(this._wheelXAction=T.MoveRelative,this._wheelXActionCoordinate=h)}get wheelXMoveRelative(){return this._wheelXAction!==T.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(h){null===h&&this._wheelYAction!==T.MoveRelative||(this._wheelYAction=T.MoveRelative,this._wheelYActionCoordinate=h)}get wheelYMoveRelative(){return this._wheelYAction!==T.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(h){null===h&&this._wheelZAction!==T.MoveRelative||(this._wheelZAction=T.MoveRelative,this._wheelZActionCoordinate=h)}get wheelZMoveRelative(){return this._wheelZAction!==T.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(h){null===h&&this._wheelXAction!==T.RotateRelative||(this._wheelXAction=T.RotateRelative,this._wheelXActionCoordinate=h)}get wheelXRotateRelative(){return this._wheelXAction!==T.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(h){null===h&&this._wheelYAction!==T.RotateRelative||(this._wheelYAction=T.RotateRelative,this._wheelYActionCoordinate=h)}get wheelYRotateRelative(){return this._wheelYAction!==T.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(h){null===h&&this._wheelZAction!==T.RotateRelative||(this._wheelZAction=T.RotateRelative,this._wheelZActionCoordinate=h)}get wheelZRotateRelative(){return this._wheelZAction!==T.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(h){null===h&&this._wheelXAction!==T.MoveScene||(this._wheelXAction=T.MoveScene,this._wheelXActionCoordinate=h)}get wheelXMoveScene(){return this._wheelXAction!==T.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(h){null===h&&this._wheelYAction!==T.MoveScene||(this._wheelYAction=T.MoveScene,this._wheelYActionCoordinate=h)}get wheelYMoveScene(){return this._wheelYAction!==T.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(h){null===h&&this._wheelZAction!==T.MoveScene||(this._wheelZAction=T.MoveScene,this._wheelZActionCoordinate=h)}get wheelZMoveScene(){return this._wheelZAction!==T.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Iq(0),this._rotateRelative.Iq(0),this._moveScene.Iq(0),this._updateCamera(),this.camera.Mh().useRightHandedSystem&&(this._moveRelative.z*=-1);const h=Y.Matrix.Zero();this.camera.getViewMatrix().invertToRef(h);const V=Y.nV.Zero();Y.nV.TransformNormalToRef(this._moveRelative,h,V),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(V),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(h,V,i){if(0===h)return;if(null===V||null===i)return;let S=null;switch(V){case T.MoveRelative:S=this._moveRelative;break;case T.RotateRelative:S=this._rotateRelative;break;case T.MoveScene:S=this._moveScene}switch(i){case 0:S.set(h,0,0);break;case 1:S.set(0,h,0);break;case 2:S.set(0,0,h)}}}(0,S.b)([(0,l.E)()],c.prototype,"wheelXMoveRelative",null),(0,S.b)([(0,l.E)()],c.prototype,"wheelYMoveRelative",null),(0,S.b)([(0,l.E)()],c.prototype,"wheelZMoveRelative",null),(0,S.b)([(0,l.E)()],c.prototype,"wheelXRotateRelative",null),(0,S.b)([(0,l.E)()],c.prototype,"wheelYRotateRelative",null),(0,S.b)([(0,l.E)()],c.prototype,"wheelZRotateRelative",null),(0,S.b)([(0,l.E)()],c.prototype,"wheelXMoveScene",null),(0,S.b)([(0,l.E)()],c.prototype,"wheelYMoveScene",null),(0,S.b)([(0,l.E)()],c.prototype,"wheelZMoveScene",null),q.e.FreeCameraMouseWheelInput=c;class f{constructor(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=h,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=J.Tools.IsSafari()}attachControl(h){h=J.Tools.BackCompatCameraNoPreventDefault(arguments);let V=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=i=>{const S=i.event,l="mouse"===S.pointerType||this._isSafari&&"undefined"===typeof S.pointerType;if(this.allowMouse||!l)if(i.type===s.e.POINTERDOWN){if(h||S.preventDefault(),this._pointerPressed.push(S.pointerId),1!==this._pointerPressed.length)return;V={x:S.clientX,y:S.clientY}}else if(i.type===s.e.POINTERUP){h||S.preventDefault();const i=this._pointerPressed.indexOf(S.pointerId);if(-1===i)return;if(this._pointerPressed.splice(i,1),0!=i)return;V=null,this._offsetX=null,this._offsetY=null}else if(i.type===s.e.POINTERMOVE){if(h||S.preventDefault(),!V)return;if(0!=this._pointerPressed.indexOf(S.pointerId))return;this._offsetX=S.clientX-V.x,this._offsetY=-(S.clientY-V.y)}}),this._observer=this.camera.Mh()._inputManager._addCameraPointerObserver(this._pointerInput,s.e.POINTERDOWN|s.e.POINTERUP|s.e.POINTERMOVE),this._onLostFocus){const h=this.camera.getEngine().getInputElement();h&&h.addEventListener("blur",this._onLostFocus)}}Bv(){if(this._pointerInput){if(this._observer&&(this.camera.Mh()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const h=this.camera.getEngine().getInputElement();h&&h.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const h=this.camera,V=h._calculateHandednessMultiplier();h.cameraRotation.y=V*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)h.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const V=h._computeLocalCameraSpeed(),i=new Y.nV(0,0,0!==this.touchMoveSensibility?V*this._offsetY/this.touchMoveSensibility:0);Y.Matrix.RotationYawPitchRollToRef(h.rotation.y,h.rotation.x,0,h._cameraRotationMatrix),h.cameraDirection.addInPlace(Y.nV.TransformCoordinates(i,h._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,S.b)([(0,l.E)()],f.prototype,"touchAngularSensibility",void 0),(0,S.b)([(0,l.E)()],f.prototype,"touchMoveSensibility",void 0),q.e.FreeCameraTouchInput=f;class P extends q.f{constructor(h){super(h),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new I),this}addMouse(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new t(h),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new c,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new f),this}clear(){super.clear(),this._mouseInput=null}}var L=i(11091),U=i(11028);class X extends g.c{get angularSensibility(){const h=this.inputs.attached.mouse;return h?h.angularSensibility:0}set angularSensibility(h){const V=this.inputs.attached.mouse;V&&(V.angularSensibility=h)}get keysUp(){const h=this.inputs.attached.keyboard;return h?h.keysUp:[]}set keysUp(h){const V=this.inputs.attached.keyboard;V&&(V.keysUp=h)}get keysUpward(){const h=this.inputs.attached.keyboard;return h?h.keysUpward:[]}set keysUpward(h){const V=this.inputs.attached.keyboard;V&&(V.keysUpward=h)}get keysDown(){const h=this.inputs.attached.keyboard;return h?h.keysDown:[]}set keysDown(h){const V=this.inputs.attached.keyboard;V&&(V.keysDown=h)}get keysDownward(){const h=this.inputs.attached.keyboard;return h?h.keysDownward:[]}set keysDownward(h){const V=this.inputs.attached.keyboard;V&&(V.keysDownward=h)}get keysLeft(){const h=this.inputs.attached.keyboard;return h?h.keysLeft:[]}set keysLeft(h){const V=this.inputs.attached.keyboard;V&&(V.keysLeft=h)}get keysRight(){const h=this.inputs.attached.keyboard;return h?h.keysRight:[]}set keysRight(h){const V=this.inputs.attached.keyboard;V&&(V.keysRight=h)}get keysRotateLeft(){const h=this.inputs.attached.keyboard;return h?h.keysRotateLeft:[]}set keysRotateLeft(h){const V=this.inputs.attached.keyboard;V&&(V.keysRotateLeft=h)}get keysRotateRight(){const h=this.inputs.attached.keyboard;return h?h.keysRotateRight:[]}set keysRotateRight(h){const V=this.inputs.attached.keyboard;V&&(V.keysRotateRight=h)}get keysRotateUp(){const h=this.inputs.attached.keyboard;return h?h.keysRotateUp:[]}set keysRotateUp(h){const V=this.inputs.attached.keyboard;V&&(V.keysRotateUp=h)}get keysRotateDown(){const h=this.inputs.attached.keyboard;return h?h.keysRotateDown:[]}set keysRotateDown(h){const V=this.inputs.attached.keyboard;V&&(V.keysRotateDown=h)}constructor(h,V,i){var S;super(h,V,i,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),S=this,this.ellipsoid=new Y.nV(.5,1,.5),this.ellipsoidOffset=new Y.nV(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=Y.nV.Zero(),this._diffPosition=Y.nV.Zero(),this._newPosition=Y.nV.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;S._newPosition.l(V),S._newPosition.subtractToRef(S._oldPosition,S._diffPosition),S._diffPosition.length()>U.b.CollisionsEpsilon&&(S.position.addToRef(S._diffPosition,S._deferredPositionUpdate),S._deferOnly?S._deferredUpdated=!0:S.position.l(S._deferredPositionUpdate),S.As&&i&&S.As(i))},this.inputs=new P(this),this.inputs.addKeyboard().addMouse()}attachControl(h,V){V=J.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(V)}Bv(){this.inputs.detachElement(),this.cameraDirection=new Y.nV(0,0,0),this.cameraRotation=new Y.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(h){this._collisionMask=isNaN(h)?-1:h}_collideWithWorld(h){let V;V=this.parent?Y.nV.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,V.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const i=this.Mh().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let S=h;this.applyGravity&&(S=h.add(this.Mh().gravity)),i.getNewPosition(this._oldPosition,S,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=Y.nV.Zero(),this._transformedDirection=Y.nV.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(h){this._needMoveForGravity=h}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Mh().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"FT"}}(0,S.b)([(0,l.A)()],X.prototype,"ellipsoid",void 0),(0,S.b)([(0,l.A)()],X.prototype,"ellipsoidOffset",void 0),(0,S.b)([(0,l.E)()],X.prototype,"checkCollisions",void 0),(0,S.b)([(0,l.E)()],X.prototype,"applyGravity",void 0),(0,L.f)("BABYLON.FreeCamera",X)},13321:(h,V,i)=>{"use strict";i.d(V,{e:()=>Y});var S=i(11242),l=i(13330);class Y{constructor(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=i,this.FI=[],this._maxBlockCapacity=V||64,this._selectionContent=new S.c(1024),this._creationFunc=h}update(h,V,i){l.d._CreateBlocks(h,V,i,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}wJ(h){for(let V=0;V<this.bJ.length;V++){this.bJ[V].addEntry(h)}}GJ(h){for(let V=0;V<this.bJ.length;V++){this.bJ[V].removeEntry(h)}}select(h,V){this._selectionContent.reset();for(let i=0;i<this.bJ.length;i++){this.bJ[i].select(h,this._selectionContent,V)}return V?this._selectionContent.concat(this.FI):this._selectionContent.concatWithNoDuplicate(this.FI),this._selectionContent}intersects(h,V,i){this._selectionContent.reset();for(let S=0;S<this.bJ.length;S++){this.bJ[S].intersects(h,V,this._selectionContent,i)}return i?this._selectionContent.concat(this.FI):this._selectionContent.concatWithNoDuplicate(this.FI),this._selectionContent}intersectsRay(h){this._selectionContent.reset();for(let V=0;V<this.bJ.length;V++){this.bJ[V].intersectsRay(h,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.FI),this._selectionContent}}Y.CreationFuncForMeshes=(h,V)=>{const i=h.getBoundingInfo();!h.isBlocked&&i.boundingBox.intersectsMinMax(V.GI,V.wI)&&V.entries.push(h)},Y.CreationFuncForSubMeshes=(h,V)=>{h.getBoundingInfo().boundingBox.intersectsMinMax(V.GI,V.wI)&&V.entries.push(h)}},13330:(h,V,i)=>{"use strict";i.d(V,{d:()=>Y});var S=i(11138),l=i(11488);class Y{constructor(h,V,i,S,l,Y){this.entries=[],this.NI=new Array,this._capacity=i,this._depth=S,this._maxDepth=l,this._creationFunc=Y,this._minPoint=h,this._maxPoint=V,this.NI.push(h.clone()),this.NI.push(V.clone()),this.NI.push(h.clone()),this.NI[2].x=V.x,this.NI.push(h.clone()),this.NI[3].y=V.y,this.NI.push(h.clone()),this.NI[4].z=V.z,this.NI.push(V.clone()),this.NI[5].z=h.z,this.NI.push(V.clone()),this.NI[6].x=h.x,this.NI.push(V.clone()),this.NI[7].y=h.y}get Pq(){return this._capacity}get GI(){return this._minPoint}get wI(){return this._maxPoint}addEntry(h){if(this.bJ)for(let V=0;V<this.bJ.length;V++){this.bJ[V].addEntry(h)}else this._creationFunc(h,this),this.entries.length>this.Pq&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(h){if(this.bJ){for(let V=0;V<this.bJ.length;V++){this.bJ[V].removeEntry(h)}return}const V=this.entries.indexOf(h);V>-1&&this.entries.splice(V,1)}addEntries(h){for(let V=0;V<h.length;V++){const i=h[V];this.addEntry(i)}}select(h,V,i){if(l.e.IsInFrustum(this.NI,h)){if(this.bJ){for(let S=0;S<this.bJ.length;S++){this.bJ[S].select(h,V,i)}return}i?V.concat(this.entries):V.concatWithNoDuplicate(this.entries)}}intersects(h,V,i,S){if(l.e.IntersectsSphere(this._minPoint,this._maxPoint,h,V)){if(this.bJ){for(let l=0;l<this.bJ.length;l++){this.bJ[l].intersects(h,V,i,S)}return}S?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}}intersectsRay(h,V){if(h.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.bJ){for(let i=0;i<this.bJ.length;i++){this.bJ[i].intersectsRay(h,V)}return}V.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){Y._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(h,V,i,l,g,q,B,J){B.bJ=new Array;const I=new S.nV((V.x-h.x)/2,(V.y-h.y)/2,(V.z-h.z)/2);for(let S=0;S<2;S++)for(let V=0;V<2;V++)for(let v=0;v<2;v++){const s=h.add(I.multiplyByFloats(S,V,v)),t=h.add(I.multiplyByFloats(S+1,V+1,v+1)),T=new Y(s,t,l,g+1,q,J);T.addEntries(i),B.bJ.push(T)}}}},13333:(h,V,i)=>{"use strict";i.d(V,{d:()=>I});var S=i(11382),l=i(11138),Y=i(11570),g=i(12488),q=i(11413),B=i(13321),J=i(10988);S.d.prototype.createOrUpdateSelectionOctree=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=this._getComponent(q.e.NAME_OCTREE);i||(i=new I(this),this.o(i)),this.oI||(this.oI=new B.e(B.e.CreationFuncForMeshes,h,V));const S=this.getWorldExtends();return this.oI.update(S.min,S.max,this.meshes),this.oI},Object.defineProperty(S.d.prototype,"selectionOctree",{get:function(){return this.oI},enumerable:!0,configurable:!0}),Y.c.prototype.createOrUpdateSubmeshesOctree=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const i=this.Mh();let S=i._getComponent(q.e.NAME_OCTREE);S||(S=new I(i),i.o(S)),this._submeshesOctree||(this._submeshesOctree=new B.e(B.e.CreationFuncForSubMeshes,h,V)),this.Ag(!0);const l=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(l.minimumWorld,l.maximumWorld,this.Gg),this._submeshesOctree};class I{constructor(h){this.name=q.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new g.d(l.nV.Zero(),new l.nV(1,1,1)),(h=h||J.d.LastCreatedScene)&&(this.fV=h,this.fV.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.fV.getActiveSubMeshCandidates=h=>this.getActiveSubMeshCandidates(h),this.fV.getCollidingSubMeshCandidates=(h,V)=>this.getCollidingSubMeshCandidates(h,V),this.fV.getIntersectingSubMeshCandidates=(h,V)=>this.getIntersectingSubMeshCandidates(h,V))}register(){this.fV.onMeshRemovedObservable.add((h=>{const V=this.fV.selectionOctree;if(void 0!==V&&null!==V){const i=V.FI.indexOf(h);-1!==i&&V.FI.splice(i,1)}})),this.fV.onMeshImportedObservable.add((h=>{const V=this.fV.selectionOctree;void 0!==V&&null!==V&&V.wJ(h)}))}getActiveMeshCandidates(){var h;return(null===(h=this.fV.oI)||void 0===h?void 0:h.select(this.fV.frustumPlanes))||this.fV._getDefaultMeshCandidates()}getActiveSubMeshCandidates(h){if(h._submeshesOctree&&h.useOctreeForRenderingSelection){return h._submeshesOctree.select(this.fV.frustumPlanes)}return this.fV._getDefaultSubMeshCandidates(h)}getIntersectingSubMeshCandidates(h,V){if(h._submeshesOctree&&h.useOctreeForPicking){g.d.TransformToRef(V,h.getWorldMatrix(),this._tempRay);return h._submeshesOctree.intersectsRay(this._tempRay)}return this.fV._getDefaultSubMeshCandidates(h)}getCollidingSubMeshCandidates(h,V){if(h._submeshesOctree&&h.useOctreeForCollisions){const i=V._velocityWorldLength+Math.max(V._radius.x,V._radius.y,V._radius.z);return h._submeshesOctree.intersects(V._basePointWorld,i)}return this.fV._getDefaultSubMeshCandidates(h)}rebuild(){}dispose(){}}},12488:(h,V,i)=>{"use strict";i.d(V,{d:()=>t});var S=i(11382),l=i(11598),Y=i(11147),g=i(11138),q=i(11156),B=i(11474),J=i(11410),I=i(10988),v=i(11431);const s={internalPickerForMesh:void 0};class t{constructor(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.c;this.origin=h,this.direction=V,this.length=i,this.epsilon=S}clone(){return new t(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const S=t._TmpVector3[0].qq(h.x-i,h.y-i,h.z-i),l=t._TmpVector3[1].qq(V.x+i,V.y+i,V.z+i);let Y,g,q,B,J=0,I=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<S.x||this.origin.x>l.x)return!1}else if(Y=1/this.direction.x,g=(S.x-this.origin.x)*Y,q=(l.x-this.origin.x)*Y,q===-1/0&&(q=1/0),g>q&&(B=g,g=q,q=B),J=Math.max(g,J),I=Math.min(q,I),J>I)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<S.y||this.origin.y>l.y)return!1}else if(Y=1/this.direction.y,g=(S.y-this.origin.y)*Y,q=(l.y-this.origin.y)*Y,q===-1/0&&(q=1/0),g>q&&(B=g,g=q,q=B),J=Math.max(g,J),I=Math.min(q,I),J>I)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<S.z||this.origin.z>l.z)return!1}else if(Y=1/this.direction.z,g=(S.z-this.origin.z)*Y,q=(l.z-this.origin.z)*Y,q===-1/0&&(q=1/0),g>q&&(B=g,g=q,q=B),J=Math.max(g,J),I=Math.min(q,I),J>I)return!1;return!0}intersectsBox(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(h.minimum,h.maximum,V)}intersectsSphere(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=h.center.x-this.origin.x,S=h.center.y-this.origin.y,l=h.center.z-this.origin.z,Y=i*i+S*S+l*l,g=h.radius+V,q=g*g;if(Y<=q)return!0;const B=i*this.direction.x+S*this.direction.y+l*this.direction.z;if(B<0)return!1;return Y-B*B<=q}intersectsTriangle(h,V,i){const S=t._TmpVector3[0],l=t._TmpVector3[1],Y=t._TmpVector3[2],q=t._TmpVector3[3],J=t._TmpVector3[4];V.subtractToRef(h,S),i.subtractToRef(h,l),g.nV.CrossToRef(this.direction,l,Y);const I=g.nV.Dot(S,Y);if(0===I)return null;const v=1/I;this.origin.subtractToRef(h,q);const s=g.nV.Dot(q,Y)*v;if(s<-this.epsilon||s>1+this.epsilon)return null;g.nV.CrossToRef(q,S,J);const T=g.nV.Dot(this.direction,J)*v;if(T<-this.epsilon||s+T>1+this.epsilon)return null;const e=g.nV.Dot(l,J)*v;return e>this.length?null:new B.d(1-s-T,s,e)}intersectsPlane(h){let V;const i=g.nV.Dot(h.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;{const S=g.nV.Dot(h.normal,this.origin);return V=(-h.d-S)/i,V<0?V<-9.99999997475243e-7?null:0:V}}intersectsAxis(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(h){case"y":{const h=(this.origin.y-V)/this.direction.y;return h>0?null:new g.nV(this.origin.x+this.direction.x*-h,V,this.origin.z+this.direction.z*-h)}case"x":{const h=(this.origin.x-V)/this.direction.x;return h>0?null:new g.nV(V,this.origin.y+this.direction.y*-h,this.origin.z+this.direction.z*-h)}case"z":{const h=(this.origin.z-V)/this.direction.z;return h>0?null:new g.nV(this.origin.x+this.direction.x*-h,this.origin.y+this.direction.y*-h,V)}default:return null}}intersectsMesh(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const q=g.TmpVectors.Matrix[0];return h.getWorldMatrix().invertToRef(q),this._tmpRay?t.TransformToRef(this,q,this._tmpRay):this._tmpRay=t.Transform(this,q),h.intersects(this._tmpRay,V,i,S,l,Y)}intersectsMeshes(h,V,i){i?i.length=0:i=[];for(let S=0;S<h.length;S++){const l=this.intersectsMesh(h[S],V);l.hit&&i.push(l)}return i.sort(this._comparePickingInfo),i}_comparePickingInfo(h,V){return h.distance<V.distance?-1:h.distance>V.distance?1:0}intersectionSegment(h,V,i){const S=this.origin,l=g.TmpVectors.nV[0],Y=g.TmpVectors.nV[1],q=g.TmpVectors.nV[2],B=g.TmpVectors.nV[3];V.subtractToRef(h,l),this.direction.scaleToRef(t._Rayl,q),S.addToRef(q,Y),h.subtractToRef(S,B);const J=g.nV.Dot(l,l),I=g.nV.Dot(l,q),v=g.nV.Dot(q,q),s=g.nV.Dot(l,B),T=g.nV.Dot(q,B),e=J*v-I*I;let n,c,f=e,P=e;e<t._Smallnum?(n=0,f=1,c=T,P=v):(n=I*T-v*s,c=J*T-I*s,n<0?(n=0,c=T,P=v):n>f&&(n=f,c=T+I,P=v)),c<0?(c=0,-s<0?n=0:-s>J?n=f:(n=-s,f=J)):c>P&&(c=P,-s+I<0?n=0:-s+I>J?n=f:(n=-s+I,f=J));const L=Math.abs(n)<t._Smallnum?0:n/f,U=Math.abs(c)<t._Smallnum?0:c/P,X=g.TmpVectors.nV[4];q.scaleToRef(U,X);const D=g.TmpVectors.nV[5];l.scaleToRef(L,D),D.addInPlace(B);const O=g.TmpVectors.nV[6];D.subtractToRef(X,O);return U>0&&U<=this.length&&O.lengthSquared()<i*i?D.length():-1}update(h,V,i,S,l,Y,q){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){t._RayDistant||(t._RayDistant=t.Zero()),t._RayDistant.unprojectRayToRef(h,V,i,S,g.Matrix.IdentityReadOnly,Y,q);const B=g.TmpVectors.Matrix[0];l.invertToRef(B),t.TransformToRef(t._RayDistant,B,this)}else this.unprojectRayToRef(h,V,i,S,l,Y,q);return this}static Zero(){return new t(g.nV.Zero(),g.nV.Zero())}static CreateNew(h,V,i,S,l,Y,g){return t.Zero().update(h,V,i,S,l,Y,g)}static CreateNewFromTo(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.Matrix.IdentityReadOnly;const S=new t(new g.nV(0,0,0),new g.nV(0,0,0));return t.CreateFromToToRef(h,V,S,i)}static CreateFromToToRef(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.Matrix.IdentityReadOnly;i.origin.l(h);const l=V.subtractToRef(h,i.direction),Y=Math.sqrt(l.x*l.x+l.y*l.y+l.z*l.z);return i.length=Y,i.direction.normalize(),t.TransformToRef(i,S,i)}static Transform(h,V){const i=new t(new g.nV(0,0,0),new g.nV(0,0,0));return t.TransformToRef(h,V,i),i}static TransformToRef(h,V,i){g.nV.TransformCoordinatesToRef(h.origin,V,i.origin),g.nV.TransformNormalToRef(h.direction,V,i.direction),i.length=h.length,i.epsilon=h.epsilon;const S=i.direction,l=S.length();if(0!==l&&1!==l){const h=1/l;S.x*=h,S.y*=h,S.z*=h,i.length*=l}return i}unprojectRayToRef(h,V,i,S,l,Y,q){const B=g.TmpVectors.Matrix[0];l.multiplyToRef(Y,B),B.multiplyToRef(q,B),B.invert();const J=I.d.LastCreatedEngine,v=g.TmpVectors.nV[0];v.x=h/i*2-1,v.y=-(V/S*2-1),v.z=null!==J&&void 0!==J&&J.useReverseDepthBuffer?1:null!==J&&void 0!==J&&J.isNDCHalfZRange?0:-1;const s=g.TmpVectors.nV[1].qq(v.x,v.y,1-1e-8),t=g.TmpVectors.nV[2],T=g.TmpVectors.nV[3];g.nV._UnprojectFromInvertedMatrixToRef(v,B,t),g.nV._UnprojectFromInvertedMatrixToRef(s,B,T),this.origin.l(t),T.subtractToRef(t,this.direction),this.direction.normalize()}}function T(h,V,i,S,l){let Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const g=t.Zero();return e(h,V,i,S,g,l,Y),g}function e(h,V,i,S,l,Y){let q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const J=h.getEngine();if(!Y&&!(Y=h.activeCamera))return h;const I=Y.viewport,v=J.getRenderHeight(),{x:s,y:t,width:T,height:e}=I.toGlobal(J.getRenderWidth(),v),n=1/J.getHardwareScalingLevel();return V=V*n-s,i=i*n-(v-t-e),l.update(V,i,T,e,S||g.Matrix.IdentityReadOnly,q?g.Matrix.IdentityReadOnly:Y.getViewMatrix(),Y.getProjectionMatrix(),B),h}function n(h,V,i,S,l){if(!J.d)return h;const Y=h.getEngine();if(!l&&!(l=h.activeCamera))throw new Error("Active camera not set");const q=l.viewport,B=Y.getRenderHeight(),{x:I,y:v,width:s,height:t}=q.toGlobal(Y.getRenderWidth(),B),T=g.Matrix.Identity(),e=1/Y.getHardwareScalingLevel();return V=V*e-I,i=i*e-(B-v-t),S.update(V,i,s,t,T,T,l.getProjectionMatrix()),h}function c(h,V,i,S,l,Y,g,q){const B=V(S,i.enableDistantPicking),J=i.intersects(B,l,g,Y,S,q);return J&&J.hit?!l&&null!=h&&J.distance>=h.distance?null:J:null}function f(h,V,i,S,l,Y){let q=null;const B=!!(h.activeCameras&&h.activeCameras.length>1&&h.cameraToUseForPointers!==h.activeCamera),I=h.cameraToUseForPointers||h.activeCamera,v=s.internalPickerForMesh||c;for(let J=0;J<h.meshes.length;J++){const s=h.meshes[J];if(i){if(!i(s,-1))continue}else if(!s.isEnabled()||!s.isVisible||!s.fB)continue;const t=B&&s.isWorldMatrixCameraDependent(),T=s.Ag(t,I);if(s.hasThinInstances&&s.thinInstanceEnablePicking){const h=v(q,V,s,T,!0,!0,Y);if(h){if(l)return h;const B=g.TmpVectors.Matrix[1],J=s.thinInstanceGetWorldMatrices();for(let h=0;h<J.length;h++){if(i&&!i(s,h))continue;J[h].multiplyToRef(T,B);const g=v(q,V,s,B,S,l,Y,!0);if(g&&(q=g,q.thinInstanceIndex=h,S))return q}}}else{const h=v(q,V,s,T,S,l,Y);if(h&&(q=h,S))return q}}return q||new J.d}function P(h,V,i,S){if(!J.d)return null;const l=[],Y=!!(h.activeCameras&&h.activeCameras.length>1&&h.cameraToUseForPointers!==h.activeCamera),q=h.cameraToUseForPointers||h.activeCamera,B=s.internalPickerForMesh||c;for(let J=0;J<h.meshes.length;J++){const I=h.meshes[J];if(i){if(!i(I,-1))continue}else if(!I.isEnabled()||!I.isVisible||!I.fB)continue;const v=Y&&I.isWorldMatrixCameraDependent(),s=I.Ag(v,q);if(I.hasThinInstances&&I.thinInstanceEnablePicking){if(B(null,V,I,s,!0,!0,S)){const h=g.TmpVectors.Matrix[1],Y=I.thinInstanceGetWorldMatrices();for(let g=0;g<Y.length;g++){if(i&&!i(I,g))continue;Y[g].multiplyToRef(s,h);const q=B(null,V,I,h,!1,!1,S,!0);q&&(q.thinInstanceIndex=g,l.push(q))}}}else{const h=B(null,V,I,s,!1,!1,S);h&&l.push(h)}}return l}function L(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,S=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;S||(S=h.getWorldMatrix()),V.length=i,l?V.origin.l(l):V.origin.l(h.position);const Y=g.TmpVectors.nV[2];Y.set(0,0,h._scene.useRightHandedSystem?-1:1);const q=g.TmpVectors.nV[3];return g.nV.TransformNormalToRef(Y,S,q),g.nV.NormalizeToRef(q,V.direction),V}var U,X;t._TmpVector3=(0,q.c)(6,g.nV.Zero),t._RayDistant=t.Zero(),t._Smallnum=1e-8,t._Rayl=1e9,U=S.d,(X=l.b)&&(X.prototype.getForwardRay=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,V=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return L(this,new t(g.nV.Zero(),g.nV.Zero(),h),h,V,i)},X.prototype.getForwardRayToRef=function(h){return L(this,h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),U&&(v.c._IsPickingAvailable=!0,U.prototype.createPickingRay=function(h,V,i,S){return T(this,h,V,i,S,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),S.d.prototype.createPickingRayToRef=function(h,V,i,S,l){return e(this,h,V,i,S,l,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},S.d.prototype.createPickingRayInCameraSpace=function(h,V,i){return function(h,V,i,S){const l=t.Zero();return n(h,V,i,l,S),l}(this,h,V,i)},S.d.prototype.createPickingRayInCameraSpaceToRef=function(h,V,i,S){return n(this,h,V,i,S)},S.d.prototype.pickWithBoundingInfo=function(h,V,i,S,l){return function(h,V,i,S,l,Y){if(!J.d)return null;const q=f(h,(S=>(h._tempPickingRay||(h._tempPickingRay=t.Zero()),e(h,V,i,S,h._tempPickingRay,Y||null),h._tempPickingRay)),S,l,!0);return q&&(q.ray=T(h,V,i,g.Matrix.Identity(),Y||null)),q}(this,h,V,i,S,l)},S.d.prototype.Ti=function(h,V,i,S,l,Y){return function(h,V,i,S,l,Y,q){const B=f(h,((S,l)=>(h._tempPickingRay||(h._tempPickingRay=t.Zero()),e(h,V,i,S,h._tempPickingRay,Y||null,!1,l),h._tempPickingRay)),S,l,!1,q);return B&&(B.ray=T(h,V,i,g.Matrix.Identity(),Y||null)),B}(this,h,V,i,S,l,Y)},S.d.prototype.pickWithRay=function(h,V,i,S){return function(h,V,i,S,l){const Y=f(h,(i=>(h._pickWithRayInverseMatrix||(h._pickWithRayInverseMatrix=g.Matrix.Identity()),i.invertToRef(h._pickWithRayInverseMatrix),h._cachedRayForTransform||(h._cachedRayForTransform=t.Zero()),t.TransformToRef(V,h._pickWithRayInverseMatrix,h._cachedRayForTransform),h._cachedRayForTransform)),i,S,!1,l);return Y&&(Y.ray=V),Y}(this,h,V,i,S)},S.d.prototype.multiPick=function(h,V,i,S,l){return function(h,V,i,S,l,Y){return P(h,(S=>T(h,V,i,S,l||null)),S,Y)}(this,h,V,i,S,l)},S.d.prototype.multiPickWithRay=function(h,V,i){return function(h,V,i,S){return P(h,(i=>(h._pickWithRayInverseMatrix||(h._pickWithRayInverseMatrix=g.Matrix.Identity()),i.invertToRef(h._pickWithRayInverseMatrix),h._cachedRayForTransform||(h._cachedRayForTransform=t.Zero()),t.TransformToRef(V,h._pickWithRayInverseMatrix,h._cachedRayForTransform),h._cachedRayForTransform)),i,S)}(this,h,V,i)}},12762:(h,V,i)=>{"use strict";var S=i(11064),l=i(10967),Y=i(10993),g=i(11100),q=i(11028),B=i(11077);q.b.prototype._partialLoadFile=function(h,V,i,S){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(h,(h=>{i[V]=h,i._internalCount++,6===i._internalCount&&S(i)}),void 0,void 0,!0,((h,V)=>{l&&h&&l(h.status+" "+h.statusText,V)}))},q.b.prototype._cascadeLoadFiles=function(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const l=[];l._internalCount=0;for(let Y=0;Y<6;Y++)this._partialLoadFile(i[Y],Y,l,V,S)},q.b.prototype._cascadeLoadImgs=function(h,V,i,S){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5?arguments[5]:void 0;const g=[];g._internalCount=0;for(let q=0;q<6;q++)this._partialLoadImg(S[q],q,g,h,V,i,l,Y)},q.b.prototype._partialLoadImg=function(h,V,i,S,l,q){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7?arguments[7]:void 0;const I=(0,g.e)();(0,Y.s)(h,(h=>{i[V]=h,i._internalCount++,S&&S.removePendingData(I),6===i._internalCount&&q&&q(l,i)}),((h,V)=>{S&&S.removePendingData(I),B&&B(h,V)}),S?S.offlineProvider:null,J),S&&S.addPendingData(I)},q.b.prototype.createCubeTextureBase=function(h,V,i,Y){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6?arguments[6]:void 0,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]&&arguments[8],s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,t=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,T=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,e=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,n=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,c=arguments.length>14&&void 0!==arguments[14]&&arguments[14],f=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const P=T||new S.c(this,7);P.isCube=!0,P.url=h,P.generateMipMaps=!Y,P._lodGenerationScale=s,P._lodGenerationOffset=t,P._useSRGBBuffer=!!c&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!Y),P!==T&&(P.label=h.substring(0,60)),this._doNotHandleContextLost||(P._extension=I,P._files=i,P._buffer=f);const L=h;this._transformTextureUrl&&!T&&(h=this._transformTextureUrl(h));const U=I??function(h){const V=h.split("?")[0],i=V.lastIndexOf(".");return i>-1?V.substring(i).toLowerCase():""}(h),X=(0,B.b)(U),D=(h,V)=>{P.dispose(),q?q(h,V):h&&l.d.Warn(h)},O=(S,q)=>{h===L?S&&D(S.status+" "+S.statusText,q):(l.d.Warn(`Failed to load ${h}, falling back to the ${L}`),this.createCubeTextureBase(L,V,i,!!Y,g,D,J,I,v,s,t,P,e,n,c,f))};if(X)X.then((S=>{const l=h=>{e&&e(P,h),S.loadCubeData(h,P,v,g,((h,V)=>{D(h,V)}))};f?l(f):i&&6===i.length?S.supportCascades?this._cascadeLoadFiles(V,(h=>l(h.map((h=>new Uint8Array(h))))),i,D):D("Textures type does not support cascades."):this._loadFile(h,(h=>l(new Uint8Array(h))),void 0,void 0,!0,O)}));else{if(!i||0===i.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(V,P,((h,V)=>{n&&n(h,V)}),i,D)}return this._internalTexturesCache.push(P),P}},13338:(h,V,i)=>{"use strict";i(10967);var S=i(11280);i(11064),i(11222),i(11057),i(11326),i(11288);S.b},12800:(h,V,i)=>{"use strict";i.d(V,{b:()=>l});var S=i(11091);class l{constructor(h){this.value=this._toInt(h)}_toInt(h){return 0|h}add(h){return new l(this.value+h.value)}cV(h){return new l(this.value-h.value)}multiply(h){return new l(Math.imul(this.value,h.value))}divide(h){return new l(this.value/h.value)}getClassName(){return l.ClassName}equals(h){return this.value===h.value}static FromValue(h){return new l(h)}toString(){return this.value.toString()}}l.ClassName="FlowGraphInteger",(0,S.f)("FlowGraphInteger",l)},12814:(h,V,i)=>{"use strict";i.d(V,{e:()=>l,h:()=>Y});var S=i(11138);class l{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Tg=h}get m(){return this.Tg}transformVector(h){return this.transformVectorToRef(h,new S.Vector2)}transformVectorToRef(h,V){return V.x=h.x*this.Tg[0]+h.y*this.Tg[1],V.y=h.x*this.Tg[2]+h.y*this.Tg[3],V}Ng(){return this.toArray()}toArray(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let V=0;V<4;V++)h[V]=this.Tg[V];return h}ei(h){for(let V=0;V<4;V++)this.Tg[V]=h[V];return this}multiplyToRef(h,V){const i=h.Tg,S=this.Tg,l=V.Tg;return l[0]=i[0]*S[0]+i[1]*S[2],l[1]=i[0]*S[1]+i[1]*S[3],l[2]=i[2]*S[0]+i[3]*S[2],l[3]=i[2]*S[1]+i[3]*S[3],V}multiply(h){return this.multiplyToRef(h,new l)}divideToRef(h,V){const i=this.Tg,S=h.Tg,l=V.Tg;return l[0]=i[0]/S[0],l[1]=i[1]/S[1],l[2]=i[2]/S[2],l[3]=i[3]/S[3],V}divide(h){return this.divideToRef(h,new l)}addToRef(h,V){const i=this.Tg,S=h.m,l=V.m;return l[0]=i[0]+S[0],l[1]=i[1]+S[1],l[2]=i[2]+S[2],l[3]=i[3]+S[3],V}add(h){return this.addToRef(h,new l)}subtractToRef(h,V){const i=this.Tg,S=h.m,l=V.m;return l[0]=i[0]-S[0],l[1]=i[1]-S[1],l[2]=i[2]-S[2],l[3]=i[3]-S[3],V}cV(h){return this.subtractToRef(h,new l)}transpose(){const h=this.Tg;return new l([h[0],h[2],h[1],h[3]])}determinant(){const h=this.Tg;return h[0]*h[3]-h[1]*h[2]}inverse(){const h=this.determinant();if(0===h)throw new Error("Matrix is not invertible");const V=this.Tg,i=1/h;return new l([V[3]*i,-V[1]*i,-V[2]*i,V[0]*i])}equals(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.Tg,S=h.m;return 0===V?i[0]===S[0]&&i[1]===S[1]&&i[2]===S[2]&&i[3]===S[3]:Math.abs(i[0]-S[0])<V&&Math.abs(i[1]-S[1])<V&&Math.abs(i[2]-S[2])<V&&Math.abs(i[3]-S[3])<V}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Tg.join(", ")})`}}class Y{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Tg=h}get m(){return this.Tg}transformVector(h){return this.transformVectorToRef(h,new S.nV)}transformVectorToRef(h,V){const i=this.Tg;return V.x=h.x*i[0]+h.y*i[1]+h.z*i[2],V.y=h.x*i[3]+h.y*i[4]+h.z*i[5],V.z=h.x*i[6]+h.y*i[7]+h.z*i[8],V}multiplyToRef(h,V){const i=h.Tg,S=this.Tg,l=V.m;return l[0]=i[0]*S[0]+i[1]*S[3]+i[2]*S[6],l[1]=i[0]*S[1]+i[1]*S[4]+i[2]*S[7],l[2]=i[0]*S[2]+i[1]*S[5]+i[2]*S[8],l[3]=i[3]*S[0]+i[4]*S[3]+i[5]*S[6],l[4]=i[3]*S[1]+i[4]*S[4]+i[5]*S[7],l[5]=i[3]*S[2]+i[4]*S[5]+i[5]*S[8],l[6]=i[6]*S[0]+i[7]*S[3]+i[8]*S[6],l[7]=i[6]*S[1]+i[7]*S[4]+i[8]*S[7],l[8]=i[6]*S[2]+i[7]*S[5]+i[8]*S[8],V}multiply(h){return this.multiplyToRef(h,new Y)}divideToRef(h,V){const i=this.Tg,S=h.m,l=V.m;return l[0]=i[0]/S[0],l[1]=i[1]/S[1],l[2]=i[2]/S[2],l[3]=i[3]/S[3],l[4]=i[4]/S[4],l[5]=i[5]/S[5],l[6]=i[6]/S[6],l[7]=i[7]/S[7],l[8]=i[8]/S[8],V}divide(h){return this.divideToRef(h,new Y)}addToRef(h,V){const i=this.Tg,S=h.m,l=V.m;return l[0]=i[0]+S[0],l[1]=i[1]+S[1],l[2]=i[2]+S[2],l[3]=i[3]+S[3],l[4]=i[4]+S[4],l[5]=i[5]+S[5],l[6]=i[6]+S[6],l[7]=i[7]+S[7],l[8]=i[8]+S[8],V}add(h){return this.addToRef(h,new Y)}subtractToRef(h,V){const i=this.Tg,S=h.m,l=V.m;return l[0]=i[0]-S[0],l[1]=i[1]-S[1],l[2]=i[2]-S[2],l[3]=i[3]-S[3],l[4]=i[4]-S[4],l[5]=i[5]-S[5],l[6]=i[6]-S[6],l[7]=i[7]-S[7],l[8]=i[8]-S[8],V}cV(h){return this.subtractToRef(h,new Y)}toArray(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let V=0;V<9;V++)h[V]=this.Tg[V];return h}Ng(){return this.toArray()}ei(h){for(let V=0;V<9;V++)this.Tg[V]=h[V];return this}transpose(){const h=this.Tg;return new Y([h[0],h[3],h[6],h[1],h[4],h[7],h[2],h[5],h[8]])}determinant(){const h=this.Tg;return h[0]*(h[4]*h[8]-h[5]*h[7])-h[1]*(h[3]*h[8]-h[5]*h[6])+h[2]*(h[3]*h[7]-h[4]*h[6])}inverse(){const h=this.determinant();if(0===h)throw new Error("Matrix is not invertible");const V=this.Tg,i=1/h;return new Y([(V[4]*V[8]-V[5]*V[7])*i,(V[2]*V[7]-V[1]*V[8])*i,(V[1]*V[5]-V[2]*V[4])*i,(V[5]*V[6]-V[3]*V[8])*i,(V[0]*V[8]-V[2]*V[6])*i,(V[2]*V[3]-V[0]*V[5])*i,(V[3]*V[7]-V[4]*V[6])*i,(V[1]*V[6]-V[0]*V[7])*i,(V[0]*V[4]-V[1]*V[3])*i])}equals(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.Tg,S=h.m;return 0===V?i[0]===S[0]&&i[1]===S[1]&&i[2]===S[2]&&i[3]===S[3]&&i[4]===S[4]&&i[5]===S[5]&&i[6]===S[6]&&i[7]===S[7]&&i[8]===S[8]:Math.abs(i[0]-S[0])<V&&Math.abs(i[1]-S[1])<V&&Math.abs(i[2]-S[2])<V&&Math.abs(i[3]-S[3])<V&&Math.abs(i[4]-S[4])<V&&Math.abs(i[5]-S[5])<V&&Math.abs(i[6]-S[6])<V&&Math.abs(i[7]-S[7])<V&&Math.abs(i[8]-S[8])<V}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Tg.join(", ")})`}}},12821:(h,V,i)=>{"use strict";var S;function l(h,V,i,S){switch(V){case"Animation":return S?h.animations.find((h=>h.uniqueId===i))??null:h.animations[i]??null;case"AnimationGroup":return S?h.animationGroups.find((h=>h.uniqueId===i))??null:h.animationGroups[i]??null;case"Mesh":return S?h.meshes.find((h=>h.uniqueId===i))??null:h.meshes[i]??null;case"Material":return S?h.materials.find((h=>h.uniqueId===i))??null:h.materials[i]??null;case"xJ":return S?h.cameras.find((h=>h.uniqueId===i))??null:h.cameras[i]??null;case"Light":return S?h.lights.find((h=>h.uniqueId===i))??null:h.lights[i]??null;default:return null}}i.d(V,{b:()=>l}),function(h){h.Animation="Animation",h.AnimationGroup="AnimationGroup",h.Mesh="Mesh",h.Material="Material",h.xJ="xJ",h.Light="Light"}(S||(S={}))},12855:(h,V,i)=>{"use strict";i.d(V,{e:()=>l});var S=i(12861);class l extends S.e{constructor(h,V){if(super(h),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),V)for(const i of V)this._eventsSignalOutputs[i]=this._registerSignalOutput(i+"Event")}_executeOnTick(h){}_startPendingTasks(h){h._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(h),this._resetAfterCanceled(h)),this._preparePendingTasks(h),h._addPendingBlock(this),this.out._activateSignal(h),h._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(h){h._deleteExecutionVariable(this,"_initialized"),h._removePendingBlock(this)}}},12827:(h,V,i)=>{"use strict";i.d(V,{c:()=>J});var S=i(11100),l=i(11091),Y=i(12834),g=i(10960),q=i(12791);class B extends Y.c{constructor(h,V,i,S){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:S.defaultValue,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(h,V,i),this.richType=S,this._defaultValue=l,this._optional=Y,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new g.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(h){this._isDisabled!==h&&(this._isDisabled=h,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(h,V){V._getConnectionValue(this)!==h&&(V._setConnectionValue(this,h),this.onValueChangedObservable.notifyObservers(h))}resetToDefaultValue(h){h._setConnectionValue(this,this._defaultValue)}connectTo(h){this._isDisabled||super.connectTo(h)}_getValueOrDefault(h){const V=h._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(V):V}getValue(h){if(1===this.connectionType){h._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(h);const V=this._getValueOrDefault(h);return this._lastValue=V,this.richType.typeTransformer?this.richType.typeTransformer(V):V}const V=this.isConnected()?this._connectedPoint[0].getValue(h):this._getValueOrDefault(h);return this._lastValue=V,this.richType.typeTransformer?this.richType.typeTransformer(V):V}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(h),h.richType={},this.richType.serialize(h.richType),h.optional=this._optional,(0,q.h)("defaultValue",this._defaultValue,h)}}(0,l.f)("FlowGraphDataConnection",B);class J{constructor(h){var V;this.config=h,this.uniqueId=(0,S.e)(),this.name=(null===(V=this.config)||void 0===V?void 0:V.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(h){}registerDataInput(h,V,i){const S=new B(h,0,this,V,i);return this.dataInputs.push(S),S}registerDataOutput(h,V,i){const S=new B(h,1,this,V,i);return this.dataOutputs.push(S),S}getDataInput(h){return this.dataInputs.find((V=>V.name===h))}getDataOutput(h){return this.dataOutputs.find((V=>V.name===h))}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.h;if(h.uniqueId=this.uniqueId,h.config={},this.config){const i=this.config,S=Object.keys(i);for(const l of S)V(l,i[l],h.config)}h.dataInputs=[],h.dataOutputs=[],h.className=this.getClassName();for(const i of this.dataInputs){const V={};i.serialize(V),h.dataInputs.push(V)}for(const i of this.dataOutputs){const V={};i.serialize(V),h.dataOutputs.push(V)}}deserialize(h){}_log(h,V,i){var S;null===(S=h.logger)||void 0===S||S.addLogItem({action:V,payload:i,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12834:(h,V,i)=>{"use strict";i.d(V,{c:()=>Y});var S,l=i(11100);!function(h){h[h.Input=0]="Input",h[h.Output=1]="Output"}(S||(S={}));class Y{constructor(h,V,i){this._ownerBlock=i,this._connectedPoint=[],this.uniqueId=(0,l.e)(),this.connectedPointIds=[],this.name=h,this._connectionType=V}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(h){if(this._connectionType===h._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||h._isSingularConnection()&&h._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(h),h._connectedPoint.push(this)}disconnectFrom(h){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this._connectedPoint.indexOf(h),S=h._connectedPoint.indexOf(this);-1!==i&&-1!==S&&(V&&this._connectedPoint.splice(i,1),h._connectedPoint.splice(S,1))}disconnectFromAll(){for(const h of this._connectedPoint)this.disconnectFrom(h,!1);this._connectedPoint.length=0}dispose(){for(const h of this._connectedPoint)this.disconnectFrom(h)}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h.uniqueId=this.uniqueId,h.name=this.name,h._connectionType=this._connectionType,h.connectedPointIds=[],h.className=this.getClassName();for(const V of this._connectedPoint)h.connectedPointIds.push(V.uniqueId)}getClassName(){return"FGConnection"}deserialize(h){this.uniqueId=h.uniqueId,this.name=h.name,this._connectionType=h._connectionType,this.connectedPointIds=h.connectedPointIds}}},12787:(h,V,i)=>{"use strict";i.d(V,{e:()=>P});var S,l=i(10960),Y=i(11123),g=i(11127),q=i(11100),B=i(12791),J=i(12821),I=i(10967);!function(h){h.ExecuteBlock="ExecuteBlock",h.ExecuteEvent="ExecuteEvent",h.TriggerConnection="TriggerConnection",h.ContextVariableSet="ContextVariableSet",h.GlobalVariableSet="GlobalVariableSet",h.GlobalVariableDelete="GlobalVariableDelete",h.GlobalVariableGet="GlobalVariableGet",h.AddConnection="AddConnection",h.GetConnectionValue="GetConnectionValue",h.SetConnectionValue="SetConnectionValue",h.ActivateSignal="ActivateSignal",h.ContextVariableGet="ContextVariableGet"}(S||(S={}));class v{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(h){if(h.time||(h.time=Date.now()),this.log.push(h),this.logToConsole){var V;const i=null===(V=h.payload)||void 0===V?void 0:V.value;"object"===typeof i&&i.getClassName?I.d.Log(`[FGLog] ${h.className}:${h.uniqueId.split("-")[0]} ${h.action} - ${JSON.stringify(i.getClassName())}: ${i.toString()}`):I.d.Log(`[FGLog] ${h.className}:${h.uniqueId.split("-")[0]} ${h.action} - ${JSON.stringify(h.payload)}`)}}getItemsOfType(h){return this.log.filter((V=>V.action===h))}}class s{get enableLogging(){return this._enableLogging}set enableLogging(h){this._enableLogging!==h&&(this._enableLogging=h,this._enableLogging?(this.logger=new v,this.logger.logToConsole=!0):this.logger=null)}constructor(h){this.uniqueId=(0,q.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new l.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=h,this.assetsContext=h.assetsContext??h.fV}hasVariable(h){return h in this._userVariables}setVariable(h,V){var i;this._userVariables[h]=V,null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:h,value:V}})}getAsset(h,V){return(0,J.b)(this.assetsContext,h,V)}getVariable(h){var V;return null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:h,value:this._userVariables[h]}}),this._userVariables[h]}get userVariables(){return this._userVariables}Mh(){return this._configuration.fV}_getUniqueIdPrefixedName(h,V){return`${h.uniqueId}_${V}`}_getGlobalContextVariable(h,V){var i;return null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:h,defaultValue:V,possibleValue:this._globalContextVariables[h]}}),this._hasGlobalContextVariable(h)?this._globalContextVariables[h]:V}_setGlobalContextVariable(h,V){var i;null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:h,value:V}}),this._globalContextVariables[h]=V}_deleteGlobalContextVariable(h){var V;null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:h}}),delete this._globalContextVariables[h]}_hasGlobalContextVariable(h){return h in this._globalContextVariables}_setExecutionVariable(h,V,i){this._executionVariables[this._getUniqueIdPrefixedName(h,V)]=i}_getExecutionVariable(h,V,i){return this._hasExecutionVariable(h,V)?this._executionVariables[this._getUniqueIdPrefixedName(h,V)]:i}_deleteExecutionVariable(h,V){delete this._executionVariables[this._getUniqueIdPrefixedName(h,V)]}_hasExecutionVariable(h,V){return this._getUniqueIdPrefixedName(h,V)in this._executionVariables}_hasConnectionValue(h){return h.uniqueId in this._connectionValues}_setConnectionValue(h,V){var i;this._connectionValues[h.uniqueId]=V,null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:h.uniqueId,value:V}})}_setConnectionValueByKey(h,V){this._connectionValues[h]=V}_getConnectionValue(h){var V;return null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:h.uniqueId,value:this._connectionValues[h.uniqueId]}}),this._connectionValues[h.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(h){this._pendingBlocks.includes(h)||(this._pendingBlocks.push(h),this._pendingBlocks.sort(((h,V)=>h.priority-V.priority)))}_removePendingBlock(h){const V=this._pendingBlocks.indexOf(h);-1!==V&&this._pendingBlocks.splice(V,1)}_clearPendingBlocks(){for(const h of this._pendingBlocks)h._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(h){var V;this.onNodeExecutedObservable.notifyObservers(h),null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:h.getClassName(),uniqueId:h.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(h){this._setGlobalContextVariable("timeSinceStart",h.timeSinceStart),this._setGlobalContextVariable("deltaTime",h.deltaTime);for(const i of this._pendingBlocks){var V;null===(V=i._executeOnTick)||void 0===V||V.call(i,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.h;h.uniqueId=this.uniqueId,h._userVariables={};for(const S in this._userVariables)V(S,this._userVariables[S],h._userVariables);h._connectionValues={};for(const S in this._connectionValues)V(S,this._connectionValues[S],h._connectionValues);var i;this.assetsContext!==this.Mh()&&(h._assetsContext={meshes:this.assetsContext.meshes.map((h=>h.id)),materials:this.assetsContext.materials.map((h=>h.id)),textures:this.assetsContext.textures.map((h=>h.name)),animations:this.assetsContext.animations.map((h=>h.name)),lights:this.assetsContext.lights.map((h=>h.id)),cameras:this.assetsContext.cameras.map((h=>h.id)),Js:null===(i=this.assetsContext.Js)||void 0===i?void 0:i.map((h=>h.name)),skeletons:this.assetsContext.skeletons.map((h=>h.id)),Fv:this.assetsContext.Fv.map((h=>h.name)),geometries:this.assetsContext.geometries.map((h=>h.id)),multiMaterials:this.assetsContext.multiMaterials.map((h=>h.id)),transformNodes:this.assetsContext.transformNodes.map((h=>h.id))})}getClassName(){return"FlowGraphContext"}}(0,Y.b)([(0,g.E)()],s.prototype,"uniqueId",void 0);var t=i(12824),T=i(11416);class e{constructor(h){this.onEventTriggeredObservable=new l.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=h,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Ig.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const h=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:h}}),this._startingTime+=h})),this._meshPickedObserver=this._scene.onPointerObservable.add((h=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:h})}),T.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((h=>{const V=h.pointerId,i=h.mesh,S=this._pointerUnderMeshState[V];!S&&i?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:V,mesh:i}}):S&&!i?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:V,mesh:S}}):S&&i&&S!==i&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:V,mesh:S,over:i}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:V,mesh:i,out:S}})),this._pointerUnderMeshState[V]=i}),T.e.POINTERMOVE)}dispose(){var h,V,i,S,l;null===(h=this._sceneDisposeObserver)||void 0===h||h.remove(),null===(V=this._sceneReadyObserver)||void 0===V||V.remove(),null===(i=this._sceneOnBeforeRenderObserver)||void 0===i||i.remove(),null===(S=this._meshPickedObserver)||void 0===S||S.remove(),null===(l=this._meshUnderPointerObserver)||void 0===l||l.remove(),this.onEventTriggeredObservable.clear()}}var n,c=i(12841);!function(h){h[h.Stopped=0]="Stopped",h[h.Started=1]="Started"}(n||(n={}));class f{get state(){return this._state}set state(h){this._state=h,this.onStateChangedObservable.notifyObservers(h)}constructor(h){this.onStateChangedObservable=new l.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=h.fV,this._sceneEventCoordinator=new e(this._scene),this._coordinator=h.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((h=>{for(const V of this._executionContexts){const i=this._getContextualOrder(h.type,V);for(const S of i)if(!S._executeEvent(V,h.payload))break}switch(h.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const V of this._executionContexts)V._notifyOnTick(h.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const h=new s({fV:this._scene,coordinator:this._coordinator});return this._executionContexts.push(h),h}getContext(h){return this._executionContexts[h]}addEventBlock(h){if("PointerOver"!==h.type&&"PointerOut"!==h.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==h.type&&this._eventBlocks[h.type].push(h),1===this.state)for(const V of this._executionContexts)h._startPendingTasks(V);else this.onStateChangedObservable.addOnce((V=>{if(1===V)for(const i of this._executionContexts)h._startPendingTasks(i)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((h=>{1===h&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const h of this._executionContexts)for(const V in this._eventBlocks){const i=this._getContextualOrder(V,h);for(const V of i)V._startPendingTasks(h)}}_getContextualOrder(h,V){const i=this._eventBlocks[h].sort(((h,V)=>V.initPriority-h.initPriority));if("MeshPick"===h){const h=[];for(const S of i){const l=S.asset.getValue(V);let Y=0;for(;Y<i.length;Y++){const h=i[Y].asset.getValue(V);if(l&&h&&(0,c.l)(l,h))break}h.splice(Y,0,S)}return h}return i}dispose(){var h;if(0!==this.state){this.state=0;for(const h of this._executionContexts)h._clearPendingBlocks();this._executionContexts.length=0;for(const h in this._eventBlocks)this._eventBlocks[h].length=0;null===(h=this._eventObserver)||void 0===h||h.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(h){const V=[],i=new Set;for(const S in this._eventBlocks)for(const h of this._eventBlocks[S])V.push(h),i.add(h.uniqueId);for(;V.length>0;){const S=V.pop();h(S);for(const h of S.dataInputs)for(const S of h._connectedPoint)i.has(S._ownerBlock.uniqueId)||(V.push(S._ownerBlock),i.add(S._ownerBlock.uniqueId));if(S instanceof t.c)for(const h of S.signalOutputs)for(const S of h._connectedPoint)i.has(S._ownerBlock.uniqueId)||(V.push(S._ownerBlock),i.add(S._ownerBlock.uniqueId))}}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},V=arguments.length>1?arguments[1]:void 0;h.allBlocks=[],this.visitAllBlocks((V=>{const i={};V.serialize(i),h.allBlocks.push(i)})),h.executionContexts=[];for(const i of this._executionContexts){const S={};i.serialize(S,V),h.executionContexts.push(S)}}}class P{constructor(h){this.config=h,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.fV.Ig.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.fV.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const h=this._executeOnNextFrame.slice(0);if(h.length)for(const V of h){this.notifyCustomEvent(V.id,V.data,!1);const h=this._executeOnNextFrame.findIndex((h=>h.uniqueId===V.uniqueId));-1!==h&&this._executeOnNextFrame.splice(h,1)}}));(P.SceneCoordinators.get(this.config.fV)??[]).push(this)}createGraph(){const h=new f({fV:this.config.fV,coordinator:this});return this._flowGraphs.push(h),h}removeGraph(h){const V=this._flowGraphs.indexOf(h);-1!==V&&(h.dispose(),this._flowGraphs.splice(V,1))}start(){for(const h of this._flowGraphs)h.start()}dispose(){var h,V;for(const l of this._flowGraphs)l.dispose();this._flowGraphs.length=0,null===(h=this._disposeObserver)||void 0===h||h.remove(),null===(V=this._onBeforeRenderObserver)||void 0===V||V.remove();const i=P.SceneCoordinators.get(this.config.fV)??[],S=i.indexOf(this);-1!==S&&i.splice(S,1)}serialize(h,V){h._flowGraphs=[];for(const i of this._flowGraphs){const S={};i.serialize(S,V),h._flowGraphs.push(S)}h.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(h){let V=this._customEventsMap.get(h);return V||(V=new l.d,this._customEventsMap.set(h,V)),V}notifyCustomEvent(h,V){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:h,data:V,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(h)){const V=this._eventExecutionCounter.get(h);if(this._eventExecutionCounter.set(h,V+1),V>=P.MaxEventTypeExecutionPerFrame)return void(V===P.MaxEventTypeExecutionPerFrame&&I.d.Warn(`FlowGraphCoordinator: Too many executions of event "${h}".`))}else this._eventExecutionCounter.set(h,1);const i=this._customEventsMap.get(h);i&&i.notifyObservers(V)}}P.MaxEventsPerType=30,P.MaxEventTypeExecutionPerFrame=30,P.SceneCoordinators=new Map},12846:(h,V,i)=>{"use strict";i.d(V,{d:()=>l});var S=i(12855);class l extends S.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(h){h._notifyExecuteNode(this),this.done._activateSignal(h)}}},12824:(h,V,i)=>{"use strict";i.d(V,{c:()=>q});var S=i(12827),l=i(12834),Y=i(11091);class g extends l.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(h){super.connectTo(h),this._connectedPoint.sort(((h,V)=>V.priority-h.priority))}_activateSignal(h){var V;if(null===(V=h.logger)||void 0===V||V.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)h._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(h,this),h._increaseExecutionId();else for(const i of this._connectedPoint)i._activateSignal(h)}}(0,Y.f)("FlowGraphSignalConnection",g);class q extends S.c{constructor(h){super(h),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(h){const V=new g(h,0,this);return this.signalInputs.push(V),V}_registerSignalOutput(h){const V=new g(h,1,this);return this.signalOutputs.push(V),V}_unregisterSignalInput(h){const V=this.signalInputs.findIndex((V=>V.name===h));-1!==V&&(this.signalInputs[V].dispose(),this.signalInputs.splice(V,1))}_unregisterSignalOutput(h){const V=this.signalOutputs.findIndex((V=>V.name===h));-1!==V&&(this.signalOutputs[V].dispose(),this.signalOutputs.splice(V,1))}_reportError(h,V){this.error.payload="string"===typeof V?new Error(V):V,this.error._activateSignal(h)}getSignalInput(h){return this.signalInputs.find((V=>V.name===h))}getSignalOutput(h){return this.signalOutputs.find((V=>V.name===h))}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(h),h.signalInputs=[],h.signalOutputs=[];for(const V of this.signalInputs){const i={};V.serialize(i),h.signalInputs.push(i)}for(const V of this.signalOutputs){const i={};V.serialize(i),h.signalOutputs.push(i)}}deserialize(h){for(let V=0;V<h.signalInputs.length;V++){const i=this.getSignalInput(h.signalInputs[V].name);if(!i)throw new Error("Could not find signal input with name "+h.signalInputs[V].name+" in block "+h.className);i.deserialize(h.signalInputs[V])}for(let V=0;V<h.signalOutputs.length;V++){const i=this.getSignalOutput(h.signalOutputs[V].name);if(!i)throw new Error("Could not find signal output with name "+h.signalOutputs[V].name+" in block "+h.className);i.deserialize(h.signalOutputs[V])}}getClassName(){return"FlowGraphExecutionBlock"}}},12861:(h,V,i)=>{"use strict";i.d(V,{e:()=>l});var S=i(12824);class l extends S.c{constructor(h){super(h),this.out=this._registerSignalOutput("out")}}},12805:(h,V,i)=>{"use strict";i.d(V,{C:()=>t,F:()=>T,I:()=>e,J:()=>o,K:()=>M,M:()=>O,Q:()=>D,c:()=>J,f:()=>s,i:()=>X,m:()=>n,o:()=>c,s:()=>f,u:()=>v,y:()=>U,z:()=>I});var S,l=i(11138),Y=i(11189),g=i(12800),q=i(12814);!function(h){h.Any="any",h.String="string",h.Number="number",h.Boolean="boolean",h.Object="object",h.Integer="FlowGraphInteger",h.Vector2="Vector2",h.nV="nV",h.Vector4="Vector4",h.Quaternion="Quaternion",h.Matrix="Matrix",h.Matrix2D="Matrix2D",h.Matrix3D="Matrix3D",h.LV="LV",h.vq="vq"}(S||(S={}));class B{constructor(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=h,this.defaultValue=V,this.animationType=i}serialize(h){h.typeName=this.typeName,h.defaultValue=this.defaultValue}}const J=new B("any",void 0),I=new B("string",""),v=new B("number",0,0),s=new B("boolean",!1),t=new B("Vector2",l.Vector2.Zero(),5),T=new B("nV",l.nV.Zero(),1),e=new B("Vector4",l.Vector4.Zero()),n=new B("Matrix",l.Matrix.Identity(),3),c=new B("Matrix2D",new q.e),f=new B("Matrix3D",new q.h),P=new B("LV",Y.LV.Black(),4),L=new B("vq",new Y.vq(0,0,0,0),7),U=new B("Quaternion",l.Quaternion.Identity(),2);U.typeTransformer=h=>{if(h.getClassName){if("Vector4"===h.getClassName())return l.Quaternion.UV(h.Ng());if("nV"===h.getClassName())return l.Quaternion.FromEulerVector(h);if("Matrix"===h.getClassName())return l.Quaternion.FromRotationMatrix(h)}return h};const X=new B("FlowGraphInteger",new g.b(0),0);function D(h){const V=h;switch(typeof h){case"string":return I;case"number":return v;case"boolean":return s;case"object":if(V.getClassName)switch(V.getClassName()){case"Vector2":return t;case"nV":return T;case"Vector4":return e;case"Matrix":return n;case"LV":return P;case"vq":return L;case"Quaternion":return U;case"FlowGraphInteger":return X;case"Matrix2D":return c;case"Matrix3D":return f}return J;default:return J}}function O(h){switch(h){case"string":return I;case"number":return v;case"boolean":return s;case"Vector2":return t;case"nV":return T;case"Vector4":return e;case"Matrix":return n;case"LV":return P;case"vq":return L;case"Quaternion":return U;case"FlowGraphInteger":return X;case"Matrix2D":return c;case"Matrix3D":return f;default:return J}}function o(h){switch(h){case"number":default:return 0;case"Vector2":return 5;case"nV":return 1;case"Matrix":return 3;case"LV":return 4;case"vq":return 7;case"Quaternion":return 2}}function M(h){switch(h){case 0:return v;case 5:return t;case 1:return T;case 3:return n;case 4:return P;case 7:return L;case 2:return U;default:return J}}},12791:(h,V,i)=>{"use strict";i.d(V,{e:()=>I,h:()=>J,i:()=>v});var S=i(11189),l=i(11138),Y=i(12800),g=i(12805),q=i(12814);function B(h){return"Vector2"===h||"nV"===h||"Vector4"===h||"Quaternion"===h||"LV"===h||"vq"===h}function J(h,V,i){var S;const l=(null===V||void 0===V||null===(S=V.getClassName)||void 0===S?void 0:S.call(V))??"";if(B(l)||function(h){return"Matrix"===h||"Matrix2D"===h||"Matrix3D"===h}(l))i[h]={value:V.Ng(),className:l};else if("FlowGraphInteger"===l)i[h]={value:V.value,className:l};else if(l&&(V.id||V.name))i[h]={id:V.id,name:V.name,className:l};else{if("object"===typeof V)throw new Error(`Could not serialize value ${V}`);i[h]=V}}function I(h,V,i,J){const v=V[h];let s;const t=(null===v||void 0===v?void 0:v.type)??(null===v||void 0===v?void 0:v.className);if(function(h){return"Mesh"===h||"AbstractMesh"===h||"GroundMesh"===h||"InstanceMesh"===h||"LinesMesh"===h||"GoldbergMesh"===h||"GreasedLineMesh"===h||"TrailMesh"===h}(t)){let h=J.meshes.filter((h=>v.id?h.id===v.id:h.name===v.name));0===h.length&&(h=J.transformNodes.filter((h=>v.id?h.id===v.id:h.name===v.name))),s=v.uniqueId?h.find((h=>h.uniqueId===v.uniqueId)):h[0]}else if(B(t))s=function(h,V){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===h)return l.Vector2.UV(V);if("nV"===h)return i&&(V[2]*=-1),l.nV.UV(V);if("Vector4"===h)return l.Vector4.UV(V);if("Quaternion"===h)return i&&(V[2]*=-1,V[3]*=-1),l.Quaternion.UV(V);if("LV"===h)return new S.LV(V[0],V[1],V[2]);if("vq"===h)return new S.vq(V[0],V[1],V[2],V[3]);throw new Error(`Unknown vector class name ${h}`)}(t,v.value);else if(function(h){return"AnimationGroup"===h}(t)){const h=J.animationGroups.filter((h=>h.name===v.name));s=1===h.length?h[0]:h.find((h=>h.uniqueId===v.uniqueId))}else s="Matrix"===t?l.Matrix.UV(v.value):"Matrix2D"===t?new q.e(v.value):"Matrix3D"===t?new q.h(v.value):"FlowGraphInteger"===t?Y.b.FromValue(v.value):"number"===t||"string"===t||"boolean"===t?v.value[0]:v&&void 0!==v.value?v.value:Array.isArray(v)?v.reduce(((h,V)=>V.eventData?(h[V.id]={type:(0,g.M)(V.type)},"undefined"!==typeof V.value&&(h[V.id].value=I("value",V,i,J)),h):h),{}):v;return s}function v(h){return"FlowGraphJsonPointerParserBlock"===h}},12841:(h,V,i)=>{"use strict";function S(h,V){return!(!h.parent||h.parent!==V&&!S(h.parent,V))}function l(h){if(h.getClassName)return h.getClassName()}function Y(h,V){return h===V&&("Vector2"===h||"nV"===h||"Vector4"===h||"Quaternion"===h)}function g(h,V){return h===V&&("Matrix"===h||"Matrix2D"===h||"Matrix3D"===h)}function q(h,V){return"FlowGraphInteger"===h&&"FlowGraphInteger"===V}function B(h,V){const i="number"===typeof h||"number"===typeof(null===h||void 0===h?void 0:h.value);return i&&!V?!isNaN(J(h)):i}function J(h){return"number"===typeof h?h:h.value}i.d(V,{b:()=>q,c:()=>g,f:()=>Y,h:()=>l,l:()=>S,o:()=>J,r:()=>B})},12200:(h,V,i)=>{"use strict";i.r(V),i.d(V,{SceneInstrumentation:()=>Y});var S=i(10952),l=i(11358);class Y{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(h){h!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=h,h?(this._onBeforeActiveMeshesEvaluationObserver=this.fV.onBeforeActiveMeshesEvaluationObservable.add((()=>{S.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.fV.onAfterActiveMeshesEvaluationObservable.add((()=>{S.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.fV.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.fV.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(h){h!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=h,h?(this._onBeforeRenderTargetsRenderObserver=this.fV.onBeforeRenderTargetsRenderObservable.add((()=>{S.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.fV.onAfterRenderTargetsRenderObservable.add((()=>{S.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.fV.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.fV.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(h){h!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=h,h?(this._onBeforeParticlesRenderingObserver=this.fV.onBeforeParticlesRenderingObservable.add((()=>{S.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.fV.onAfterParticlesRenderingObservable.add((()=>{S.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.fV.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.fV.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(h){h!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=h,this.fV.spriteManagers&&(h?(this._onBeforeSpritesRenderingObserver=this.fV.onBeforeSpritesRenderingObservable.add((()=>{S.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.fV.onAfterSpritesRenderingObservable.add((()=>{S.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.fV.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.fV.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(h){h!==this._capturePhysicsTime&&this.fV.onBeforePhysicsObservable&&(this._capturePhysicsTime=h,h?(this._onBeforePhysicsObserver=this.fV.onBeforePhysicsObservable.add((()=>{S.Tools.StartPerformanceCounter("ET"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.fV.onAfterPhysicsObservable.add((()=>{S.Tools.EndPerformanceCounter("ET"),this._physicsTime.endMonitoring()}))):(this.fV.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.fV.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(h){h!==this._captureAnimationsTime&&(this._captureAnimationsTime=h,h?this._onAfterAnimationsObserver=this.fV.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.fV.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(h){this._captureFrameTime=h}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(h){this._captureInterFrameTime=h}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(h){h!==this._captureRenderTime&&(this._captureRenderTime=h,h?(this._onBeforeDrawPhaseObserver=this.fV.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),S.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.fV.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),S.Tools.EndPerformanceCounter("Main render")}))):(this.fV.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.fV.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(h){h!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=h,h?(this._onBeforeCameraRenderObserver=this.fV.onBeforeCameraRenderObservable.add((h=>{this._cameraRenderTime.beginMonitoring(),S.Tools.StartPerformanceCounter(`Rendering camera ${h.name}`)})),this._onAfterCameraRenderObserver=this.fV.onAfterCameraRenderObservable.add((h=>{this._cameraRenderTime.endMonitoring(!1),S.Tools.EndPerformanceCounter(`Rendering camera ${h.name}`)}))):(this.fV.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.fV.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.fV.getEngine()._drawCalls}constructor(h){this.fV=h,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new l.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new l.b,this._captureFrameTime=!1,this._frameTime=new l.b,this._captureRenderTime=!1,this._renderTime=new l.b,this._captureInterFrameTime=!1,this._interFrameTime=new l.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new l.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new l.b,this._capturePhysicsTime=!1,this._physicsTime=new l.b,this._captureAnimationsTime=!1,this._animationsTime=new l.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new l.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=h.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(S.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.fV.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=h.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(S.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Bg(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Bg(),this._captureParticlesRenderTime&&this._particlesRenderTime.Bg(),this._captureSpritesRenderTime&&this._spritesRenderTime.Bg(),this._captureRenderTime&&this._renderTime.Bg(),this._captureCameraRenderTime&&this._cameraRenderTime.Bg()}))}dispose(){this._disposed||(this.fV.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.fV.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.fV.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.fV.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.fV.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.fV.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.fV.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.fV.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.fV.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.fV.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.fV.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.fV.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.fV.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.fV.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.fV.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.fV.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.fV.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.fV=null,this._disposed=!0)}}},12780:(h,V,i)=>{"use strict";i.d(V,{b:()=>I});var S=i(11123),l=i(11127),Y=i(11138),g=i(11564),q=i(11681),B=i(11741),J=i(11091);g.c.AddNodeConstructor("Light_Type_1",((h,V)=>()=>new I(h,Y.nV.Zero(),V)));class I extends B.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(h){this._shadowFrustumSize=h,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(h){this._shadowOrthoScale=h,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(h){this._orthoLeft=h}get orthoRight(){return this._orthoRight}set orthoRight(h){this._orthoRight=h}get orthoTop(){return this._orthoTop}set orthoTop(h){this._orthoTop=h}get orthoBottom(){return this._orthoBottom}set orthoBottom(h){this._orthoBottom=h}constructor(h,V,i){super(h,i),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=V.scale(-1),this.direction=V}getClassName(){return"HT"}getTypeID(){return q.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(h,V,i){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(h):this._setDefaultAutoExtendShadowProjectionMatrix(h,V,i)}_setDefaultFixedFrustumShadowProjectionMatrix(h){const V=this.Mh().activeCamera;V&&Y.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:V.Zg,void 0!==this.shadowMaxZ?this.shadowMaxZ:V.maxZ,h,this.Mh().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(h,V,i){const S=this.Mh().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const h=Y.nV.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let S=Number.MAX_VALUE,l=-Number.MAX_VALUE;for(let g=0;g<i.length;g++){const q=i[g];if(!q)continue;const B=q.getBoundingInfo().boundingBox;for(let i=0;i<B.vectorsWorld.length;i++)Y.nV.TransformCoordinatesToRef(B.vectorsWorld[i],V,h),h.x<this._orthoLeft&&(this._orthoLeft=h.x),h.y<this._orthoBottom&&(this._orthoBottom=h.y),h.x>this._orthoRight&&(this._orthoRight=h.x),h.y>this._orthoTop&&(this._orthoTop=h.y),this.autoCalcShadowZBounds&&(h.z<S&&(S=h.z),h.z>l&&(l=h.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=S,this._shadowMaxZ=l)}const l=this._orthoRight-this._orthoLeft,g=this._orthoTop-this._orthoBottom,q=void 0!==this.shadowMinZ?this.shadowMinZ:(null===S||void 0===S?void 0:S.Zg)||0,B=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===S||void 0===S?void 0:S.maxZ)||1e4,J=this.Mh().getEngine().useReverseDepthBuffer;Y.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-l*this.shadowOrthoScale,this._orthoRight+l*this.shadowOrthoScale,this._orthoBottom-g*this.shadowOrthoScale,this._orthoTop+g*this.shadowOrthoScale,J?B:q,J?q:B,h,this.Mh().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(h,V){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,V),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,V),this)}transferToNodeMaterialEffect(h,V){return this.computeTransformedInformation()?(h.setFloat3(V,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(h.setFloat3(V,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(h){const V=this._scene.getEngine();return!V.useReverseDepthBuffer&&V.isNDCHalfZRange?0:1}getDepthMaxZ(h){const V=this._scene.getEngine();return V.useReverseDepthBuffer&&V.isNDCHalfZRange?0:1}prepareLightSpecificDefines(h,V){h["DIRLIGHT"+V]=!0}}(0,S.b)([(0,l.E)()],I.prototype,"shadowFrustumSize",null),(0,S.b)([(0,l.E)()],I.prototype,"shadowOrthoScale",null),(0,S.b)([(0,l.E)()],I.prototype,"autoUpdateExtends",void 0),(0,S.b)([(0,l.E)()],I.prototype,"autoCalcShadowZBounds",void 0),(0,S.b)([(0,l.E)("orthoLeft")],I.prototype,"_orthoLeft",void 0),(0,S.b)([(0,l.E)("orthoRight")],I.prototype,"_orthoRight",void 0),(0,S.b)([(0,l.E)("orthoTop")],I.prototype,"_orthoTop",void 0),(0,S.b)([(0,l.E)("orthoBottom")],I.prototype,"_orthoBottom",void 0),(0,J.f)("BABYLON.DirectionalLight",I)},13263:(h,V,i)=>{"use strict";i.d(V,{c:()=>I});var S=i(11123),l=i(11127),Y=i(11138),g=i(11189),q=i(11564),B=i(11681),J=i(11091);q.c.AddNodeConstructor("Light_Type_3",((h,V)=>()=>new I(h,Y.nV.Zero(),V)));class I extends B.b{constructor(h,V,i){super(h,i),this.groundColor=new g.LV(0,0,0),this.direction=V||Y.nV.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"jT"}setDirectionToTarget(h){return this.direction=Y.nV.Normalize(h.cV(Y.nV.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(h,V){const i=Y.nV.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,V),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Tq),V),this}transferToNodeMaterialEffect(h,V){const i=Y.nV.Normalize(this.direction);return h.setFloat3(V,i.x,i.y,i.z),this}Ag(){return this._worldMatrix||(this._worldMatrix=Y.Matrix.Identity()),this._worldMatrix}getTypeID(){return B.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(h,V){h["HEMILIGHT"+V]=!0}}(0,S.b)([(0,l.i)()],I.prototype,"groundColor",void 0),(0,S.b)([(0,l.A)()],I.prototype,"direction",void 0),(0,J.f)("BABYLON.HemisphericLight",I)},12743:(h,V,i)=>{"use strict";i.d(V,{b:()=>v});var S=i(11123),l=i(11127),Y=i(11138),g=i(11564),q=i(11681),B=i(11741),J=i(11117),I=i(11091);g.c.AddNodeConstructor("Light_Type_2",((h,V)=>()=>new v(h,Y.nV.Zero(),Y.nV.Zero(),0,0,V)));class v extends B.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(h){this._iesProfileTexture!==h&&(this._iesProfileTexture=h,this._iesProfileTexture&&v._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(h){this._angle=h,this._cosHalfAngle=Math.cos(.5*h),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(h){this._innerAngle=h,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(h){this._shadowAngleScale=h,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(h){this._projectionTextureLightNear=h,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(h){this._projectionTextureLightFar=h,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(h){this._projectionTextureUpDirection=h,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(h){this._projectionTexture!==h&&(this._projectionTexture=h,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(v._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):v._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(h){return void 0!==h.onGeneratedObservable}static _IsTexture(h){return void 0!==h.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(h){this._projectionTextureProjectionLightMatrix=h,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(h,V,i,S,l,g){super(h,g),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=Y.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=Y.nV.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=Y.nV.Zero(),this._projectionTextureViewLightMatrix=Y.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=Y.Matrix.Zero(),this._projectionTextureScalingMatrix=Y.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=V,this.direction=i,this.angle=S,this.exponent=l}getClassName(){return"SpotLight"}getTypeID(){return q.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(h){super._setDirection(h),this._projectionTextureViewLightDirty=!0}_setPosition(h){super._setPosition(h),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(h,V,i){const S=this.Mh().activeCamera;if(!S)return;this._shadowAngleScale=this._shadowAngleScale||1;const l=this._shadowAngleScale*this._angle,g=void 0!==this.shadowMinZ?this.shadowMinZ:S.Zg,q=void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,B=this.Mh().getEngine().useReverseDepthBuffer;Y.Matrix.PerspectiveFovLHToRef(l,1,B?q:g,B?g:q,h,!0,this._scene.getEngine().isNDCHalfZRange,void 0,B)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),Y.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const h=this.projectionTextureLightFar,V=this.projectionTextureLightNear,i=h/(h-V),S=-i*V,l=1/Math.tan(this._angle/2);Y.Matrix.FromValuesToRef(l/1,0,0,0,0,l,0,0,0,0,i,1,0,0,S,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof J.d){const h=this._projectionTexture.uScale/2,V=this._projectionTexture.vScale/2;Y.Matrix.FromValuesToRef(h,0,0,0,0,V,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(h,V){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),h.setMatrix("textureProjectionMatrix"+V,this._projectionTextureMatrix),h.setTexture("projectionLightTexture"+V,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&h.setTexture("iesLightTexture"+V,this._iesProfileTexture),this}transferToEffect(h,V){let i;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,V),i=Y.nV.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,V),i=Y.nV.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",i.x,i.y,i.z,this._cosHalfAngle,V),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,V),this}transferToNodeMaterialEffect(h,V){let i;return i=this.computeTransformedInformation()?Y.nV.Normalize(this.transformedDirection):Y.nV.Normalize(this.direction),this.Mh().useRightHandedSystem?h.setFloat3(V,-i.x,-i.y,-i.z):h.setFloat3(V,i.x,i.y,i.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(h){const V=this._scene.getEngine(),i=void 0!==this.shadowMinZ?this.shadowMinZ:(null===h||void 0===h?void 0:h.Zg)??0;return V.useReverseDepthBuffer&&V.isNDCHalfZRange?i:this._scene.getEngine().isNDCHalfZRange?0:i}getDepthMaxZ(h){const V=this._scene.getEngine(),i=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===h||void 0===h?void 0:h.maxZ)??1e4;return V.useReverseDepthBuffer&&V.isNDCHalfZRange?0:i}prepareLightSpecificDefines(h,V){h["SPOTLIGHT"+V]=!0,h["PROJECTEDLIGHTTEXTURE"+V]=!(!this.projectionTexture||!this.projectionTexture.isReady()),h["IESLIGHTTEXTURE"+V]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,S.b)([(0,l.E)()],v.prototype,"angle",null),(0,S.b)([(0,l.E)()],v.prototype,"innerAngle",null),(0,S.b)([(0,l.E)()],v.prototype,"shadowAngleScale",null),(0,S.b)([(0,l.E)()],v.prototype,"exponent",void 0),(0,S.b)([(0,l.E)()],v.prototype,"projectionTextureLightNear",null),(0,S.b)([(0,l.E)()],v.prototype,"projectionTextureLightFar",null),(0,S.b)([(0,l.E)()],v.prototype,"projectionTextureUpDirection",null),(0,S.b)([(0,l.v)("projectedLightTexture")],v.prototype,"_projectionTexture",void 0),(0,I.f)("BABYLON.SpotLight",v)},12471:(h,V,i)=>{"use strict";i.d(V,{c:()=>g,f:()=>Y,j:()=>q});const S={},l={};function Y(h,V){S[h]=V}function g(h,V){l[h]=V}function q(h){return l[h]?l[h]:null}},12390:(h,V,i)=>{"use strict";i.d(V,{d:()=>D,e:()=>N});var S,l=i(10952),Y=i(10960),g=i(11382),q=i(10988),B=i(10967),J=i(11605),I=i(10993),v=i(11002),s=i(11100),t=i(11028),T=i(10984);!function(h){h[h.Clean=0]="Clean",h[h.Stop=1]="Stop",h[h.Sync=2]="Sync",h[h.NoSync=3]="NoSync"}(S||(S={}));const e=new Y.d,n={};let c=!1;function f(){return n[".babylon"]}function P(h,V){const i=n[h];return i||(B.d.Warn("Unable to find a plugin to load "+h+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),V?f():void 0)}function L(h,V,i){let S="Unable to load from "+(h.rawData?"binary data":h.url);return V?S+=`: ${V}`:i&&(S+=`: ${i}`),S}async function U(h,V,i,S,l,Y,g,q,B){var J;const v="data:"===(s=h.url).substring(0,5)?s.substring(5):null;var s;if(h.rawData&&!g)throw"When using ArrayBufferView to load data the file extension must be provided.";const c=v||g?"":function(h){const V=h.indexOf("?");-1!==V&&(h=h.substring(0,V));const i=h.lastIndexOf(".");return h.substring(i,h.length).toLowerCase()}(h.url);let L=g?P(g,!0):v?function(h){for(const V in n){const i=n[V].plugin;if(i.canDirectLoad&&i.canDirectLoad(h))return n[V]}return f()}(h.url):P(c,!1);if(!L&&c){if(h.url&&!h.url.startsWith("blob:")){const V=await async function(h,V){const i=V.method||"GET";return await new Promise(((S,l)=>{const Y=new T.c;Y.addEventListener("readystatechange",(()=>{if(4==Y.readyState)if(200==Y.status){const h={};if(V.responseHeaders)for(const i of V.responseHeaders)h[i]=Y.getResponseHeader(i)||"";S({response:Y.response,headerValues:h})}else l(`Unable to fetch data from ${h}. Error code: ${Y.status}`)})),Y.open(i,h),Y.send()}))}(h.url,{method:"HEAD",responseHeaders:["Content-Type"]}),i=V.headerValues?V.headerValues["Content-Type"]:"";i&&(L=function(h){for(const V in n){const i=n[V];if(i.mimeType===h)return i}}(i))}L||(L=f())}if(!L)throw new Error(`No plugin or fallback for ${g??h.url}`);if(!1===(null===B||void 0===B||null===(J=B[L.plugin.name])||void 0===J?void 0:J.enabled))throw new Error(`The '${L.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(h.rawData&&!L.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(h=>{if(L.plugin.createPlugin){const V=L.plugin.createPlugin(B??{});return V instanceof Promise?(V.then(h).catch((h=>{l("Error instantiating plugin.",h)})),null):(h(V),V)}return h(L.plugin),L.plugin})((B=>{var J;if(!B)throw`The loader plugin corresponding to the '${g}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(e.notifyObservers(B),v&&(B.canDirectLoad&&B.canDirectLoad(h.url)||!(0,I.m)(h.url))){if(B.directLoad){const h=B.directLoad(V,v);h instanceof Promise?h.then((h=>{i(B,h)})).catch((h=>{l("Error in directLoad of _loadData: "+h,h)})):i(B,h)}else i(B,v);return}const s=L.isBinary,T=(h,S)=>{V.B?l("Scene has been disposed"):i(B,h,S)};let n=null,c=!1;null===(J=B.Ig)||void 0===J||J.add((()=>{c=!0,n&&(n.abort(),n=null),Y()}));const f=()=>{if(c)return;const i=(h,V)=>{l(null===h||void 0===h?void 0:h.statusText,V)};if(!B.loadFile&&h.rawData)throw"Plugin does not support loading ArrayBufferView.";n=B.loadFile?B.loadFile(V,h.rawData||h.file||h.url,h.rootUrl,T,S,s,i,q):V._loadFile(h.file||h.url,T,S,!0,s,i)},P=V.getEngine();let U=P.enableOfflineSupport;if(U){let i=!1;for(const S of V.disableOfflineSupportExceptionRules)if(S.test(h.url)){i=!0;break}U=!i}U&&t.b.OfflineProviderFactory?V.offlineProvider=t.b.OfflineProviderFactory(h.url,f,P.disableManifestCheck):f()}))}function X(h,V){let i,S,Y=null,g=null;if(V)if(V.name)i=`file:${V.name}`,S=V.name,Y=V;else if(ArrayBuffer.isView(V))i="",S=(0,s.e)(),g=V;else if(V.startsWith("data:"))i=V,S="";else if(h){const Y=V;if("/"===Y.substring(0,1))return l.Tools.Error("Wrong sceneFilename parameter"),null;i=h+Y,S=Y}else i=V,S=l.Tools.GetFilename(V),h=l.Tools.GetFolderPath(V);else i=h,S=l.Tools.GetFilename(h),h=l.Tools.GetFolderPath(h);return{url:i,rootUrl:h,name:S,file:Y,rawData:g}}function D(h){if("string"===typeof h.extensions){const V=h.extensions;n[V.toLowerCase()]={plugin:h,isBinary:!1}}else{const V=h.extensions,i=Object.keys(V);for(const S of i)n[S.toLowerCase()]={plugin:h,isBinary:V[S].isBinary,mimeType:V[S].mimeType}}}async function O(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.d.LastCreatedScene,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!S)return B.d.Error("No scene available to import mesh to"),null;const t=X(V,i);if(!t)return null;const T={};S.addPendingData(T);const e=()=>{S.removePendingData(T)},n=(h,V)=>{const i=L(t,h,V);g?g(S,i,new v.l(i,v.i.SceneLoaderError,V)):B.d.Error(i),e()},c=Y?h=>{try{Y(h)}catch(V){n("Error in onProgress callback: "+V,V)}}:void 0,f=(h,V,i,Y,g,q,B,J)=>{if(S.importedMeshesFiles.push(t.url),l)try{l(h,V,i,Y,g,q,B,J)}catch(I){n("Error in onSuccess callback: "+I,I)}S.removePendingData(T)};return await U(t,S,((V,i,l)=>{if(V.rewriteRootURL&&(t.rootUrl=V.rewriteRootURL(t.rootUrl,l)),V.importMesh){const l=[],Y=[],g=[];if(!V.importMesh(h,S,i,t.rootUrl,l,Y,g,n))return;S.loadingPluginName=V.name,f(l,Y,g,[],[],[],[],[])}else{V.importMeshAsync(h,S,i,t.rootUrl,c,t.name).then((h=>{S.loadingPluginName=V.name,f(h.meshes,h.Fv,h.skeletons,h.animationGroups,h.transformNodes,h.geometries,h.lights,h.spriteManagers)})).catch((h=>{n(h.message,h)}))}}),c,n,e,J,I,s)}async function o(h,V,i,S,l,Y,g,q){return await new Promise(((B,J)=>{try{O(h,V,i,S,((h,V,i,S,l,Y,g,q)=>{B({meshes:h,Fv:V,skeletons:i,animationGroups:S,transformNodes:l,geometries:Y,lights:g,spriteManagers:q})}),l,((h,V,i)=>{J(i||new Error(V))}),Y,g,q).catch(J)}catch(v){J(v)}}))}async function M(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.d.LastCreatedEngine,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};i?await E(h,V,new g.d(i),S,Y,B,J,I,v):l.Tools.Error("No engine available")}async function F(h,V,i,S,l,Y,g){return await new Promise(((q,B)=>{M(h,V,i,(h=>{q(h)}),S,((h,V,i)=>{B(i||new Error(V))}),l,Y,g)}))}async function E(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.d.LastCreatedScene,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!i)return B.d.Error("No scene available to append to"),null;const t=X(h,V);if(!t)return null;const T={};i.addPendingData(T);const e=()=>{i.removePendingData(T)};J.c.ShowLoadingScreen&&!c&&(c=!0,i.getEngine().displayLoadingUI(),i.executeWhenReady((()=>{i.getEngine().hideLoadingUI(),c=!1})));const n=(h,V)=>{const S=L(t,h,V);Y?Y(i,S,new v.l(S,v.i.SceneLoaderError,V)):B.d.Error(S),e()},f=l?h=>{try{l(h)}catch(V){n("Error in onProgress callback",V)}}:void 0,P=()=>{if(S)try{S(i)}catch(h){n("Error in onSuccess callback",h)}i.removePendingData(T)};return await U(t,i,((h,V)=>{if(h.load){if(!h.load(i,V,t.rootUrl,n))return;i.loadingPluginName=h.name,P()}else{h.loadAsync(i,V,t.rootUrl,f,t.name).then((()=>{i.loadingPluginName=h.name,P()})).catch((h=>{n(h.message,h)}))}}),f,n,e,g,I,s)}async function H(h,V,i,S,l,Y,g){return await new Promise(((q,B)=>{try{E(h,V,i,(h=>{q(h)}),S,((h,V,i)=>{B(i||new Error(V))}),l,Y,g).catch(B)}catch(v){B(v)}}))}async function j(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.d.LastCreatedScene,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!i)return B.d.Error("No scene available to load asset container to"),null;const s=X(h,V);if(!s)return null;const t={};i.addPendingData(t);const T=()=>{i.removePendingData(t)},e=(h,V)=>{const S=L(s,h,V);Y?Y(i,S,new v.l(S,v.i.SceneLoaderError,V)):B.d.Error(S),T()},n=l?h=>{try{l(h)}catch(V){e("Error in onProgress callback",V)}}:void 0,c=h=>{if(S)try{S(h)}catch(V){e("Error in onSuccess callback",V)}i.removePendingData(t)};return await U(s,i,((h,V)=>{if(h.loadAssetContainer){const S=h.loadAssetContainer(i,V,s.rootUrl,e);if(!S)return;S.populateRootNodes(),i.loadingPluginName=h.name,c(S)}else if(h.loadAssetContainerAsync){h.loadAssetContainerAsync(i,V,s.rootUrl,n,s.name).then((V=>{V.populateRootNodes(),i.loadingPluginName=h.name,c(V)})).catch((h=>{e(h.message,h)}))}else e("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),n,e,T,g,J,I)}async function m(h,V,i,S,l,Y,g){return await new Promise(((q,B)=>{try{j(h,V,i,(h=>{q(h)}),S,((h,V,i)=>{B(i||new Error(V))}),l,Y,g).catch(B)}catch(v){B(v)}}))}async function G(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.d.LastCreatedScene,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,v=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,s=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",t=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!i)return void B.d.Error("No scene available to load animations to");if(S){for(const S of i.animatables)S.reset();i.stopAllAnimations();const h=i.animationGroups.slice();for(const i of h)i.dispose();const V=i.getNodes();for(const i of V)i.animations&&(i.animations=[])}else switch(l){case 0:const h=i.animationGroups.slice();for(const V of h)V.dispose();break;case 1:for(const V of i.animationGroups)V.stop();break;case 2:for(const V of i.animationGroups)V.reset(),V.restart();break;case 3:break;default:return void B.d.Error("Unknown animation group loading mode value '"+l+"'")}const T=i.animatables.length;await j(h,V,i,(h=>{h.mergeAnimationsTo(i,i.animatables.slice(T),Y),h.dispose(),i.onAnimationFileImportedObservable.notifyObservers(i),g&&g(i)}),J,I,v,s,t)}async function w(h,V,i,S,l,Y,g,q,B,J){return await new Promise(((I,s)=>{try{G(h,V,i,S,l,Y,(h=>{I(h)}),g,((h,V,i)=>{s(i||new Error(V))}),q,B,J).catch(s)}catch(v){s(v)}}))}class N{static get ForceFullSceneLoadingForIncremental(){return J.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(h){J.c.ForceFullSceneLoadingForIncremental=h}static get ShowLoadingScreen(){return J.c.ShowLoadingScreen}static set ShowLoadingScreen(h){J.c.ShowLoadingScreen=h}static get loggingLevel(){return J.c.loggingLevel}static set loggingLevel(h){J.c.loggingLevel=h}static get CleanBoneMatrixWeights(){return J.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(h){J.c.CleanBoneMatrixWeights=h}static GetDefaultPlugin(){return f()}static GetPluginForExtension(h){var V;return null===(V=P(h,!0))||void 0===V?void 0:V.plugin}static IsPluginForExtensionAvailable(h){return function(h){return!!n[h]}(h)}static RegisterPlugin(h){D(h)}static ImportMesh(h,V,i,S,l,Y,g,B,J){O(h,V,i,S,l,Y,g,B,J).catch((h=>null===g||void 0===g?void 0:g(q.d.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async ImportMeshAsync(h,V,i,S,l,Y,g){return await o(h,V,i,S,l,Y,g)}static Load(h,V,i,S,l,Y,g,B){M(h,V,i,S,l,Y,g,B).catch((h=>null===Y||void 0===Y?void 0:Y(q.d.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async LoadAsync(h,V,i,S,l,Y){return await F(h,V,i,S,l,Y)}static Append(h,V,i,S,l,Y,g,B){E(h,V,i,S,l,Y,g,B).catch((h=>null===Y||void 0===Y?void 0:Y(i??q.d.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async AppendAsync(h,V,i,S,l,Y){return await H(h,V,i,S,l,Y)}static LoadAssetContainer(h,V,i,S,l,Y,g,B){j(h,V,i,S,l,Y,g,B).catch((h=>null===Y||void 0===Y?void 0:Y(i??q.d.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async LoadAssetContainerAsync(h,V,i,S,l,Y){return await m(h,V,i,S,l,Y)}static ImportAnimations(h,V,i,S,l,Y,g,B,J,I,v){G(h,V,i,S,l,Y,g,B,J,I,v).catch((h=>null===J||void 0===J?void 0:J(i??q.d.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async ImportAnimationsAsync(h,V,i,S,l,Y,g,q,B,J,I){return await w(h,V,i,S,l,Y,q,J,I)}}N.NO_LOGGING=0,N.MINIMAL_LOGGING=1,N.SUMMARY_LOGGING=2,N.DETAILED_LOGGING=3,N.OnPluginActivatedObservable=e},12755:(h,V,i)=>{"use strict";i.d(V,{e:()=>s});var S=i(11123),l=i(11127),Y=i(10952),g=i(11138),q=i(11167),B=i(11117),J=i(11091),I=i(10960),v=i(11179);i(12762);class s extends q.e{set boundingBoxSize(h){if(this._boundingBoxSize&&this._boundingBoxSize.equals(h))return;this._boundingBoxSize=h;const V=this.Mh();V&&V.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(h){this._rotationY=h,this.setReflectionTextureMatrix(g.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(h,V,i){let S="";for(const l of h)S+=l;return new s(S,V,null,i,h)}static CreateFromPrefilteredData(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const l=V.useDelayedTextureLoading;V.useDelayedTextureLoading=!1;const Y=new s(h,V,null,!1,null,null,null,void 0,!0,i,S);return V.useDelayedTextureLoading=l,Y}constructor(h,V){var i;let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,s=arguments.length>8&&void 0!==arguments[8]&&arguments[8],t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,T=arguments.length>10&&void 0!==arguments[10]&&arguments[10],e=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,n=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,c=arguments.length>13?arguments[13]:void 0,f=arguments.length>14?arguments[14]:void 0;super(V),this.onLoadObservable=new I.d,this.boundingBoxPosition=g.nV.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new g.Matrix,this._buffer=null,this.name=h,this.url=h,this._noMipmap=l,this.Rg=!1,this.isCube=!0,this._textureMatrix=g.Matrix.Identity(),this.coordinatesMode=B.d.CUBIC_MODE;let P=null,L=null;null===S||Array.isArray(S)?(this._noMipmap=l,this._format=v,this._createPolynomials=T,P=S,this._loaderOptions=c,this._useSRGBBuffer=f,this._lodScale=e,this._lodOffset=n):(P=S.extensions??null,this._noMipmap=S.noMipmap??!1,Y=S.files??null,L=S.buffer??null,this._format=S.format??5,s=S.prefiltered??!1,t=S.forcedExtension??null,this._createPolynomials=S.createPolynomials??!1,this._lodScale=S.lodScale??.8,this._lodOffset=S.lodOffset??0,this._loaderOptions=S.loaderOptions,this._useSRGBBuffer=S.useSRGBBuffer,q=S.p??null,J=S.onError??null),(h||Y)&&this.updateURL(h,t,q,s,J,P,null===(i=this.Mh())||void 0===i?void 0:i.useDelayedTextureLoading,Y,L)}getClassName(){return"CubeTexture"}updateURL(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=h),this.url=h,V&&(this._forcedExtension=V);const J=h.lastIndexOf("."),I=V||(J>-1?h.substring(J).toLowerCase():""),v=0===I.indexOf(".dds"),s=0===I.indexOf(".env"),t=0===I.indexOf(".basis");if(s?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=S,S&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),q)this._files=q;else if(t||s||v||Y||(Y=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,Y){for(let V=0;V<Y.length;V++)this._files.push(h+Y[V]);this._extensions=Y}this._buffer=B,g?(this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=l):this._loadTexture(i,l)}delayLoad(h){4===this.delayLoadState&&(h&&(this._forcedExtension=h),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(h){var V,i;if(h.updateFlag===this._textureMatrix.updateFlag)return;h.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(i=this.Mh())||void 0===i||i.markAllMaterialsAsDirty(1,(h=>-1!==h.getActiveTextures().indexOf(this))));if(this._textureMatrix=h,null===(V=this.Mh())||void 0===V||!V.useRightHandedSystem)return;const S=g.TmpVectors.nV[0],l=g.TmpVectors.Quaternion[0],Y=g.TmpVectors.nV[1];this._textureMatrix.decompose(S,l,Y),l.z*=-1,l.w*=-1,g.Matrix.ComposeToRef(S,l,Y,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var h;return null!==(h=this.Mh())&&void 0!==h&&h.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this.Mh(),S=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const l=()=>{var V;(this.onLoadObservable.notifyObservers(this),S)&&(S.dispose(),null===(V=this.Mh())||void 0===V||V.markAllMaterialsAsDirty(1));h&&h()},g=(h,i)=>{this._loadingError=!0,this._errorObject={message:h,exception:i},V&&V(h,i),B.d.OnTextureLoadErrorObservable.notifyObservers(this)};var q;this._texture?this._texture.isReady?Y.Tools.SetImmediate((()=>l())):this._texture.onLoadedObservable.add((()=>l())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,i,this._lodScale,this._lodOffset,h,g,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,i,this._files,this._noMipmap,h,g,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(q=this._texture)||void 0===q||q.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(h,V,i){const S=v.d.Parse((()=>{let S=!1;return h.prefiltered&&(S=h.prefiltered),new s(i+(h.url??h.name),V,h.extensions,!1,h.files||null,null,null,void 0,S,h.forcedExtension)}),h,V);if(h.boundingBoxPosition&&(S.boundingBoxPosition=g.nV.UV(h.boundingBoxPosition)),h.boundingBoxSize&&(S.boundingBoxSize=g.nV.UV(h.boundingBoxSize)),h.animations)for(let l=0;l<h.animations.length;l++){const V=h.animations[l],i=(0,J.b)("BABYLON.Animation");i&&S.animations.push(i.Parse(V))}return S}clone(){let h=0;const V=v.d.Clone((()=>{const V=new s(this.url,this.Mh()||this._getEngine(),this._extensions,this._noMipmap,this._files);return h=V.uniqueId,V}),this);return V.uniqueId=h,V}}(0,S.b)([(0,l.E)()],s.prototype,"url",void 0),(0,S.b)([(0,l.A)()],s.prototype,"boundingBoxPosition",void 0),(0,S.b)([(0,l.A)()],s.prototype,"boundingBoxSize",null),(0,S.b)([(0,l.E)("rotationY")],s.prototype,"rotationY",null),(0,S.b)([(0,l.E)("files")],s.prototype,"_files",void 0),(0,S.b)([(0,l.E)("forcedExtension")],s.prototype,"_forcedExtension",void 0),(0,S.b)([(0,l.E)("extensions")],s.prototype,"_extensions",void 0),(0,S.b)([(0,l.o)("textureMatrix")],s.prototype,"_textureMatrix",void 0),(0,S.b)([(0,l.o)("textureMatrixRefraction")],s.prototype,"_textureMatrixRefraction",void 0),B.d._CubeTextureParser=s.Parse,(0,J.f)("BABYLON.CubeTexture",s)},13280:(h,V,i)=>{"use strict";i.d(V,{d:()=>B});var S=i(10967),l=i(11117),Y=i(11104),g=i(11285),q=i(11064);g.ThinEngine.prototype.createDynamicTexture=function(h,V,i,S){const l=new q.c(this,4);return l.baseWidth=h,l.baseHeight=V,i&&(h=this.needPOTTextures?(0,Y.g)(h,this._caps.maxTextureSize):h,V=this.needPOTTextures?(0,Y.g)(V,this._caps.maxTextureSize):V),l.width=h,l.height=V,l.isReady=!1,l.generateMipMaps=i,l.samplingMode=S,this.updateTextureSamplingMode(S,l),this._internalTexturesCache.push(l),l},g.ThinEngine.prototype.updateDynamicTexture=function(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!h)return;const g=this._gl,q=g.TEXTURE_2D,B=this._bindTextureDirectly(q,h,!0,Y);this._unpackFlipY(void 0===i?h.invertY:i),S&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const J=this._getWebGLTextureType(h.type),I=this._getInternalFormat(l||h.format),v=this._getRGBABufferInternalSizedFormat(h.type,I);g.texImage2D(q,0,v,I,J,V),h.generateMipMaps&&g.generateMipmap(q),B||this._bindTextureDirectly(q,null),S&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),l&&(h.format=l),h._dynamicTextureSource=V,h._premulAlpha=S,h.invertY=i||!1,h.isReady=!0};class B extends l.d{constructor(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,q=arguments.length>6?arguments[6]:void 0;const B=!i||i._isScene;super(null,B?i:null===i||void 0===i?void 0:i.fV,B?!S:i,q,Y,void 0,void 0,void 0,void 0,g),this.name=h,this.wrapU=l.d.CLAMP_ADDRESSMODE,this.wrapV=l.d.CLAMP_ADDRESSMODE,this._generateMipMaps=S;const J=this._getEngine();if(!J)return;if(V.getContext)this._canvas=V,this._ownCanvas=!1,this._texture=J.createDynamicTexture(this._canvas.width,this._canvas.height,S,Y);else{this._canvas=J.createCanvas(1,1),this._ownCanvas=!0;const h=V;h.width||0===h.width?this._texture=J.createDynamicTexture(h.width,h.height,S,Y):this._texture=J.createDynamicTexture(V,V,S,Y)}const I=this.getSize();this._canvas.width!==I.width&&(this._canvas.width=I.width),this._canvas.height!==I.height&&(this._canvas.height=I.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(h){this._canvas.width=h.width,this._canvas.height=h.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(h.width,h.height,this._generateMipMaps,this.samplingMode)}scale(h){const V=this.getSize();V.width*=h,V.height*=h,this._recreate(V)}scaleTo(h,V){const i=this.getSize();i.width=h,i.height=V,this._recreate(i)}getContext(){return this._context}clear(h){const V=this.getSize();h&&(this._context.fillStyle=h),this._context.clearRect(0,0,V.width,V.height)}update(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===h||h,V,this._format||void 0,void 0,i)}drawText(h,V,i,S,l,Y,g){let q=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const B=this.getSize();if(Y&&(this._context.fillStyle=Y,this._context.fillRect(0,0,B.width,B.height)),this._context.font=S,null===V||void 0===V){const i=this._context.measureText(h);V=(B.width-i.width)/2}if(null===i||void 0===i){const h=parseInt(S.replace(/\D/g,""));i=B.height/2+h/3.65}this._context.fillStyle=l||"",this._context.fillText(h,V,i),q&&this.update(g)}dispose(){var h,V;(super.dispose(),this._ownCanvas)&&(null===(h=this._canvas)||void 0===h||null===(V=h.remove)||void 0===V||V.call(h));this._canvas=null,this._context=null}clone(){const h=this.Mh();if(!h)return this;const V=this.getSize(),i=new B(this.name,V,h,this._generateMipMaps);return i.Rg=this.Rg,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i}serialize(){const h=this.Mh();h&&!h.isReady()&&S.d.Warn("The scene must be ready before serializing the dynamic texture");const V=super.serialize();return B._IsCanvasElement(this._canvas)&&(V.base64String=this._canvas.toDataURL()),V.invertY=this._invertY,V.samplingMode=this.samplingMode,V}static _IsCanvasElement(h){return void 0!==h.toDataURL}_rebuild(){this.update()}}},12674:(h,V,i)=>{"use strict";i.d(V,{b:()=>l});var S=i(11117);class l extends S.d{get depth(){return this._depth}constructor(h,V,i,l,Y,g){let q=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],B=arguments.length>7&&void 0!==arguments[7]&&arguments[7],J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:S.d.TRILINEAR_SAMPLINGMODE,I=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,v=arguments.length>10?arguments[10]:void 0;super(null,g,!q,B),this.format=Y,this._texture=g.getEngine().createRawTexture2DArray(h,V,i,l,Y,q,B,J,null,I,v),this._depth=l,this.is2DArray=!0}update(h){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,h,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(h,V,i,S,Y){return new l(h,V,i,S,5,Y,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12493:(h,V,i)=>{"use strict";i.d(V,{b:()=>q,d:()=>B,e:()=>Y,f:()=>g});var S=i(11162),l=i(11138);function Y(h,V){return`{X: ${h.x.toFixed(V)} Y: ${h.y.toFixed(V)}}`}function g(h,V){return`{X: ${h._x.toFixed(V)} Y: ${h._y.toFixed(V)} Z: ${h._z.toFixed(V)}}`}function q(h,V){return 2*Math.acos((0,S.Clamp)(l.Quaternion.Dot(h,V)))}function B(h,V){const i=new l.Quaternion;return function(h,V,i){const Y=l.nV.Cross(h,V),g=Math.acos((0,S.Clamp)(l.nV.Dot(h,V),-1,1));l.Quaternion.RotationAxisToRef(Y,g,i)}(h,V,i),i}},12330:(h,V,i)=>{"use strict";i.d(V,{b:()=>J});var S=i(11138),l=i(11189),Y=i(11590),g=i(11579),q=i(11202);i(12335);function B(h){let V=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],Y=[];let B=[];const J=h.width||h.size||1,I=h.height||h.size||1,v=h.depth||h.size||1,s=h.wrap||!1;let t=void 0===h.topBaseAt?1:h.topBaseAt,T=void 0===h.bottomBaseAt?0:h.bottomBaseAt;t=(t+4)%4,T=(T+4)%4;let e=[2,0,3,1][t],n=[2,0,1,3][T],c=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(s){V=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],c=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let h=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],i=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const S=[17,18,19,16],l=[22,23,20,21];for(;e>0;)h.unshift(h.pop()),S.unshift(S.pop()),e--;for(;n>0;)i.unshift(i.pop()),l.unshift(l.pop()),n--;h=h.flat(),i=i.flat(),c=c.concat(h).concat(i),V.push(S[0],S[2],S[3],S[0],S[1],S[2]),V.push(l[0],l[2],l[3],l[0],l[1],l[2])}const f=[J/2,I/2,v/2];B=c.reduce(((h,V,i)=>h.concat(V*f[i%3])),[]);const P=0===h.sideOrientation?0:h.sideOrientation||g.d.DEFAULTSIDE,L=h.faceUV||new Array(6),U=h.faceColors,X=[];for(let g=0;g<6;g++)void 0===L[g]&&(L[g]=new S.Vector4(0,0,1,1)),U&&void 0===U[g]&&(U[g]=new l.vq(1,1,1,1));for(let S=0;S<6;S++)if(Y.push(L[S].z,q.c?1-L[S].w:L[S].w),Y.push(L[S].x,q.c?1-L[S].w:L[S].w),Y.push(L[S].x,q.c?1-L[S].y:L[S].y),Y.push(L[S].z,q.c?1-L[S].y:L[S].y),U)for(let h=0;h<4;h++)X.push(U[S].r,U[S].g,U[S].b,U[S].a);g.d._ComputeSides(P,B,V,i,Y,h.frontUVs,h.backUVs);const D=new g.d;if(D.indices=V,D.Eh=B,D.Hh=i,D.mh=Y,U){const h=P===g.d.DOUBLESIDE?X.concat(X):X;D.jh=h}return D}function J(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new Y.e(h,i);V.sideOrientation=Y.e._GetDefaultSideOrientation(V.sideOrientation),S._originalBuilderSideOrientation=V.sideOrientation;return B(V).wh(S,V.updatable),S}g.d.CreateBox=B,Y.e.CreateBox=function(h,V){return J(h,{size:V,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12480:(h,V,i)=>{"use strict";i.d(V,{c:()=>q});var S=i(11590),l=i(11579),Y=i(11202);function g(h){const V=[],i=[],S=[],g=[],q=h.radius||.5,B=h.tessellation||64,J=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1,I=0===h.sideOrientation?0:h.sideOrientation||l.d.DEFAULTSIDE;V.push(0,0,0),g.push(.5,.5);const v=2*Math.PI*J,s=1===J?v/B:v/(B-1);let t=0;for(let l=0;l<B;l++){const h=Math.cos(t),i=Math.sin(t),S=(h+1)/2,l=(1-i)/2;V.push(q*h,q*i,0),g.push(S,Y.c?1-l:l),t+=s}1===J&&(V.push(V[3],V[4],V[5]),g.push(g[2],Y.c?1-g[3]:g[3]));const T=V.length/3;for(let l=1;l<T-1;l++)i.push(l+1,0,l);l.d.ComputeNormals(V,i,S),l.d._ComputeSides(I,V,i,S,g,h.frontUVs,h.backUVs);const e=new l.d;return e.indices=i,e.Eh=V,e.Hh=S,e.mh=g,e}function q(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new S.e(h,i);V.sideOrientation=S.e._GetDefaultSideOrientation(V.sideOrientation),l._originalBuilderSideOrientation=V.sideOrientation;return g(V).wh(l,V.updatable),l}l.d.CreateDisc=g,S.e.CreateDisc=function(h,V,i){return q(h,{radius:V,tessellation:i,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12335:(h,V,i)=>{"use strict";i.d(V,{h:()=>n,e:()=>f,i:()=>c});var S=i(11138),l=i(11189),Y=i(11590),g=i(11579),q=i(11220);Y.e._GroundMeshParser=(h,V)=>B.Parse(h,V);class B extends Y.e{constructor(h,V){super(h,V),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=h,this._subdivisionsY=h,this.subdivide(h);const i=this;i.createOrUpdateSubmeshesOctree&&i.createOrUpdateSubmeshesOctree(V)}getHeightAtCoordinates(h,V){const i=this.getWorldMatrix(),l=S.TmpVectors.Matrix[5];i.invertToRef(l);const Y=S.TmpVectors.nV[8];if(S.nV.TransformCoordinatesFromFloatsToRef(h,0,V,l,Y),h=Y.x,V=Y.z,h<this._minX||h>=this._maxX||V<=this._minZ||V>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const g=this._getFacetAt(h,V),q=-(g.x*h+g.z*V+g.w)/g.y;return S.nV.TransformCoordinatesFromFloatsToRef(0,q,0,i,Y),Y.y}getNormalAtCoordinates(h,V){const i=new S.nV(0,1,0);return this.getNormalAtCoordinatesToRef(h,V,i),i}getNormalAtCoordinatesToRef(h,V,i){const l=this.getWorldMatrix(),Y=S.TmpVectors.Matrix[5];l.invertToRef(Y);const g=S.TmpVectors.nV[8];if(S.nV.TransformCoordinatesFromFloatsToRef(h,0,V,Y,g),h=g.x,V=g.z,h<this._minX||h>this._maxX||V<this._minZ||V>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const q=this._getFacetAt(h,V);return S.nV.TransformNormalFromFloatsToRef(q.x,q.y,q.z,l,i),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(h,V){const i=Math.floor((h+this._maxX)*this._subdivisionsX/this._width),S=Math.floor(-(V+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),l=this._heightQuads[S*this._subdivisionsX+i];let Y;return Y=V<l.slope.x*h+l.slope.y?l.facet1:l.facet2,Y}_initHeightQuads(){const h=this._subdivisionsX,V=this._subdivisionsY;this._heightQuads=[];for(let i=0;i<V;i++)for(let V=0;V<h;V++){const l={slope:S.Vector2.Zero(),facet1:new S.Vector4(0,0,0,0),facet2:new S.Vector4(0,0,0,0)};this._heightQuads[i*h+V]=l}return this}_computeHeightQuads(){const h=this.getVerticesData(q.h.PositionKind);if(!h)return this;const V=S.TmpVectors.nV[3],i=S.TmpVectors.nV[2],l=S.TmpVectors.nV[1],Y=S.TmpVectors.nV[0],g=S.TmpVectors.nV[4],B=S.TmpVectors.nV[5],J=S.TmpVectors.nV[6],I=S.TmpVectors.nV[7],v=S.TmpVectors.nV[8];let s=0,t=0,T=0,e=0,n=0,c=0,f=0;const P=this._subdivisionsX,L=this._subdivisionsY;for(let q=0;q<L;q++)for(let L=0;L<P;L++){s=3*L,t=q*(P+1)*3,T=(q+1)*(P+1)*3,V.x=h[t+s],V.y=h[t+s+1],V.z=h[t+s+2],i.x=h[t+s+3],i.y=h[t+s+4],i.z=h[t+s+5],l.x=h[T+s],l.y=h[T+s+1],l.z=h[T+s+2],Y.x=h[T+s+3],Y.y=h[T+s+4],Y.z=h[T+s+5],e=(Y.z-V.z)/(Y.x-V.x),n=V.z-e*V.x,i.subtractToRef(V,g),l.subtractToRef(V,B),Y.subtractToRef(V,J),S.nV.CrossToRef(J,B,I),S.nV.CrossToRef(g,J,v),I.normalize(),v.normalize(),c=-(I.x*V.x+I.y*V.y+I.z*V.z),f=-(v.x*i.x+v.y*i.y+v.z*i.z);const U=this._heightQuads[q*P+L];U.slope.qq(e,n),U.facet1.qq(I.x,I.y,I.z,c),U.facet2.qq(v.x,v.y,v.z,f)}return this}serialize(h){super.serialize(h),h.subdivisionsX=this._subdivisionsX,h.subdivisionsY=this._subdivisionsY,h.minX=this._minX,h.maxX=this._maxX,h.Zg=this._minZ,h.maxZ=this._maxZ,h.width=this._width,h.height=this._height}static Parse(h,V){const i=new B(h.name,V);return i._subdivisionsX=h.subdivisionsX||1,i._subdivisionsY=h.subdivisionsY||1,i._minX=h.minX,i._maxX=h.maxX,i._minZ=h.Zg,i._maxZ=h.maxZ,i._width=h.width,i._height=h.height,i}}var J=i(10952),I=i(10988),v=i(11147),s=i(11202);function t(h){const V=[],i=[],l=[],Y=[];let q,B;const J=h.width||h.size||1,I=h.height||h.size||1,v=0|(h.subdivisionsX||h.subdivisions||1),t=0|(h.subdivisionsY||h.subdivisions||1);for(q=0;q<=t;q++)for(B=0;B<=v;B++){const h=new S.nV(B*J/v-J/2,0,(t-q)*I/t-I/2),V=new S.nV(0,1,0);i.push(h.x,h.y,h.z),l.push(V.x,V.y,V.z),Y.push(B/v,s.c?q/t:1-q/t)}for(q=0;q<t;q++)for(B=0;B<v;B++)V.push(B+1+(q+1)*(v+1)),V.push(B+1+q*(v+1)),V.push(B+q*(v+1)),V.push(B+(q+1)*(v+1)),V.push(B+1+(q+1)*(v+1)),V.push(B+q*(v+1));const T=new g.d;return T.indices=V,T.Eh=i,T.Hh=l,T.mh=Y,T}function T(h){const V=void 0!==h.xmin&&null!==h.xmin?h.xmin:-1,i=void 0!==h.zmin&&null!==h.zmin?h.zmin:-1,l=void 0!==h.xmax&&null!==h.xmax?h.xmax:1,Y=void 0!==h.zmax&&null!==h.zmax?h.zmax:1,q=h.subdivisions||{w:1,h:1},B=h.precision||{w:1,h:1},J=[],I=[],v=[],s=[];let t,T,e,n;q.h=q.h<1?1:q.h,q.w=q.w<1?1:q.w,B.w=B.w<1?1:B.w,B.h=B.h<1?1:B.h;const c=(l-V)/q.w,f=(Y-i)/q.h;function P(h,V,i,l){const Y=I.length/3,g=B.w+1;for(t=0;t<B.h;t++)for(T=0;T<B.w;T++){const h=[Y+T+t*g,Y+(T+1)+t*g,Y+(T+1)+(t+1)*g,Y+T+(t+1)*g];J.push(h[1]),J.push(h[2]),J.push(h[3]),J.push(h[0]),J.push(h[1]),J.push(h[3])}const q=S.nV.Zero(),e=new S.nV(0,1,0);for(t=0;t<=B.h;t++)for(q.z=t*(l-V)/B.h+V,T=0;T<=B.w;T++)q.x=T*(i-h)/B.w+h,q.y=0,I.push(q.x,q.y,q.z),v.push(e.x,e.y,e.z),s.push(T/B.w,t/B.h)}for(e=0;e<q.h;e++)for(n=0;n<q.w;n++)P(V+n*c,i+e*f,V+(n+1)*c,i+(e+1)*f);const L=new g.d;return L.indices=J,L.Eh=I,L.Hh=v,L.mh=s,L}function e(h){const V=[],i=[],Y=[],q=[];let B,J;const I=h.colorFilter||new l.LV(.3,.59,.11),s=h.alphaFilter||0;let t=!1;if(h.minHeight>h.maxHeight){t=!0;const V=h.maxHeight;h.maxHeight=h.minHeight,h.minHeight=V}for(B=0;B<=h.subdivisions;B++)for(J=0;J<=h.subdivisions;J++){const V=new S.nV(J*h.width/h.subdivisions-h.width/2,0,(h.subdivisions-B)*h.height/h.subdivisions-h.height/2),l=4*(((V.x+h.width/2)/h.width*(h.bufferWidth-1)|0)+((1-(V.z+h.height/2)/h.height)*(h.bufferHeight-1)|0)*h.bufferWidth);let g=h.buffer[l]/255,T=h.buffer[l+1]/255,e=h.buffer[l+2]/255;const n=h.buffer[l+3]/255;t&&(g=1-g,T=1-T,e=1-e);const c=g*I.r+T*I.g+e*I.b;V.y=n>=s?h.minHeight+(h.maxHeight-h.minHeight)*c:h.minHeight-v.c,h.heightBuffer&&(h.heightBuffer[B*(h.subdivisions+1)+J]=V.y),i.push(V.x,V.y,V.z),Y.push(0,0,0),q.push(J/h.subdivisions,1-B/h.subdivisions)}for(B=0;B<h.subdivisions;B++)for(J=0;J<h.subdivisions;J++){const S=J+1+(B+1)*(h.subdivisions+1),l=J+1+B*(h.subdivisions+1),Y=J+B*(h.subdivisions+1),g=J+(B+1)*(h.subdivisions+1),q=i[3*S+1]>=h.minHeight,I=i[3*l+1]>=h.minHeight,v=i[3*Y+1]>=h.minHeight;q&&I&&v&&(V.push(S),V.push(l),V.push(Y));i[3*g+1]>=h.minHeight&&q&&v&&(V.push(g),V.push(S),V.push(Y))}g.d.ComputeNormals(i,V,Y);const T=new g.d;return T.indices=V,T.Eh=i,T.Hh=Y,T.mh=q,T}function n(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new B(h,arguments.length>2?arguments[2]:void 0);i._setReady(!1),i._subdivisionsX=V.subdivisionsX||V.subdivisions||1,i._subdivisionsY=V.subdivisionsY||V.subdivisions||1,i._width=V.width||1,i._height=V.height||1,i._maxX=i._width/2,i._maxZ=i._height/2,i._minX=-i._maxX,i._minZ=-i._maxZ;return t(V).wh(i,V.updatable),i._setReady(!0),i}function c(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new Y.e(h,i);return T(V).wh(S,V.updatable),S}function f(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Y=i.width||10,g=i.height||10,q=i.subdivisions||1,v=i.minHeight||0,s=i.maxHeight||1,t=i.colorFilter||new l.LV(.3,.59,.11),T=i.alphaFilter||0,n=i.updatable,c=i.onReady;S=S||I.d.LastCreatedScene;const f=new B(h,S);let P;f._subdivisionsX=q,f._subdivisionsY=q,f._width=Y,f._height=g,f._maxX=f._width/2,f._maxZ=f._height/2,f._minX=-f._maxX,f._minZ=-f._maxZ,f._setReady(!1),i.passHeightBufferInCallback&&(P=new Float32Array((q+1)*(q+1)));const L=(h,V,i)=>{e({width:Y,height:g,subdivisions:q,minHeight:v,maxHeight:s,colorFilter:t,buffer:h,bufferWidth:V,bufferHeight:i,alphaFilter:T,heightBuffer:P}).wh(f,n),c&&c(f,P),f._setReady(!0)};if("string"===typeof V){const h=h=>{var V;const i=h.width,l=h.height;if(S.B)return;const Y=null===(V=S)||void 0===V?void 0:V.getEngine().resizeImageBitmap(h,i,l);L(Y,i,l)};J.Tools.LoadImage(V,h,i.onError?i.onError:()=>{},S.offlineProvider)}else L(V.data,V.width,V.height);return f}g.d.CreateGround=t,g.d.CreateTiledGround=T,g.d.CreateGroundFromHeightMap=e,Y.e.CreateGround=(h,V,i,S,l,Y)=>n(h,{width:V,height:i,subdivisions:S,updatable:Y},l),Y.e.CreateTiledGround=(h,V,i,S,l,Y,g,q,B)=>c(h,{xmin:V,zmin:i,xmax:S,zmax:l,subdivisions:Y,precision:g,updatable:B},q),Y.e.CreateGroundFromHeightMap=(h,V,i,S,l,Y,g,q,B,J,I)=>f(h,V,{width:i,height:S,subdivisions:l,minHeight:Y,maxHeight:g,updatable:B,onReady:J,alphaFilter:I},q)},12974:(h,V,i)=>{"use strict";i.d(V,{c:()=>t,f:()=>v,g:()=>s});var S=i(11138),l=i(11590),Y=i(11579),g=i(11687),q=i(11220),B=i(10967);function J(h){const V=[],i=[],S=h.lines,l=h.jh,g=[];let q=0;for(let Y=0;Y<S.length;Y++){const h=S[Y];for(let S=0;S<h.length;S++){const{x:B,y:J,z:I}=h[S];if(i.push(B,J,I),l){const h=l[Y],{r:V,g:i,b:q,a:B}=h[S];g.push(V,i,q,B)}S>0&&(V.push(q-1),V.push(q)),q++}}const B=new Y.d;return B.indices=V,B.Eh=i,l&&(B.jh=g),B}function I(h){const V=h.dashSize||3,i=h.gapSize||1,l=h.dashNb||200,g=h.points,q=[],B=[],J=S.nV.Zero();let I=0,v=0,s=0,t=0,T=0,e=0,n=0;for(n=0;n<g.length-1;n++)g[n+1].subtractToRef(g[n],J),I+=J.length();for(s=I/l,t=V*s/(V+i),n=0;n<g.length-1;n++){g[n+1].subtractToRef(g[n],J),v=Math.floor(J.length()/s),J.normalize();for(let h=0;h<v;h++)T=s*h,q.push(g[n].x+T*J.x,g[n].y+T*J.y,g[n].z+T*J.z),q.push(g[n].x+(T+t)*J.x,g[n].y+(T+t)*J.y,g[n].z+(T+t)*J.z),B.push(e,e+1),e+=2}const c=new Y.d;return c.Eh=q,c.indices=B,c}function v(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=V.instance,l=V.lines,Y=V.jh;if(S){const h=S.getVerticesData(q.h.PositionKind);let V,i;Y&&(V=S.getVerticesData(q.h.ColorKind));let g=0,B=0;for(let S=0;S<l.length;S++){const q=l[S];for(let l=0;l<q.length;l++)h[g]=q[l].x,h[g+1]=q[l].y,h[g+2]=q[l].z,Y&&V&&(i=Y[S],V[B]=i[l].r,V[B+1]=i[l].g,V[B+2]=i[l].b,V[B+3]=i[l].a,B+=4),g+=3}return S.updateVerticesData(q.h.PositionKind,h,!1,!1),Y&&V&&S.updateVerticesData(q.h.ColorKind,V,!1,!1),S.refreshBoundingInfo(),S}const B=!!Y,I=new g.d(h,i,null,void 0,void 0,B,V.useVertexAlpha,V.material);return J(V).wh(I,V.updatable),I}function s(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=V.jh?[V.jh]:null;return v(h,{lines:[V.points],updatable:V.updatable,instance:V.instance,jh:S,useVertexAlpha:V.useVertexAlpha,material:V.material},i)}function t(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=V.points,q=V.instance,J=V.gapSize||1,v=V.dashSize||3;if(q){const h=h=>{const V=S.nV.Zero(),i=h.length/6;let l=0,g=0,B=0,J=0,I=0,v=0,s=0,t=0;for(s=0;s<Y.length-1;s++)Y[s+1].subtractToRef(Y[s],V),l+=V.length();B=l/i;const T=q._creationDataStorage.dashSize;for(J=T*B/(T+q._creationDataStorage.gapSize),s=0;s<Y.length-1;s++)for(Y[s+1].subtractToRef(Y[s],V),g=Math.floor(V.length()/B),V.normalize(),t=0;t<g&&v<h.length;)I=B*t,h[v]=Y[s].x+I*V.x,h[v+1]=Y[s].y+I*V.y,h[v+2]=Y[s].z+I*V.z,h[v+3]=Y[s].x+(I+J)*V.x,h[v+4]=Y[s].y+(I+J)*V.y,h[v+5]=Y[s].z+(I+J)*V.z,v+=6,t++;for(;v<h.length;)h[v]=Y[s].x,h[v+1]=Y[s].y,h[v+2]=Y[s].z,v+=3};return(V.dashNb||V.dashSize||V.gapSize||V.useVertexAlpha||V.material)&&B.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),q.updateMeshPositions(h,!1),q}const s=new g.d(h,i,null,void 0,void 0,void 0,V.useVertexAlpha,V.material);return I(V).wh(s,V.updatable),s._creationDataStorage=new l.g,s._creationDataStorage.dashSize=v,s._creationDataStorage.gapSize=J,s}Y.d.CreateLineSystem=J,Y.d.CreateDashedLines=I,l.e.WB=function(h,V){return s(h,{points:V,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},l.e.CreateDashedLines=function(h,V,i,S,l){return t(h,{points:V,dashSize:i,gapSize:S,dashNb:l,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12396:(h,V,i)=>{"use strict";i.d(V,{b:()=>q,d:()=>B});var S=i(11590),l=i(11579),Y=i(11202);function g(h){const V=[],i=[],S=[],g=[],q=void 0!==h.width?h.width:void 0!==h.size?h.size:1,B=void 0!==h.height?h.height:void 0!==h.size?h.size:1,J=0===h.sideOrientation?0:h.sideOrientation||l.d.DEFAULTSIDE,I=q/2,v=B/2;i.push(-I,-v,0),S.push(0,0,-1),g.push(0,Y.c?1:0),i.push(I,-v,0),S.push(0,0,-1),g.push(1,Y.c?1:0),i.push(I,v,0),S.push(0,0,-1),g.push(1,Y.c?0:1),i.push(-I,v,0),S.push(0,0,-1),g.push(0,Y.c?0:1),V.push(0),V.push(1),V.push(2),V.push(0),V.push(2),V.push(3),l.d._ComputeSides(J,i,V,S,g,h.frontUVs,h.backUVs);const s=new l.d;return s.indices=V,s.Eh=i,s.Hh=S,s.mh=g,s}function q(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new S.e(h,i);V.sideOrientation=S.e._GetDefaultSideOrientation(V.sideOrientation),l._originalBuilderSideOrientation=V.sideOrientation;return g(V).wh(l,V.updatable),V.sourcePlane&&(l.translate(V.sourcePlane.normal,-V.sourcePlane.d),l.setDirection(V.sourcePlane.normal.scale(-1))),l}const B={KB:q};l.d.KB=g,S.e.KB=(h,V,i,S,l)=>q(h,{size:V,width:V,height:V,sideOrientation:l,updatable:S},i)},12464:(h,V,i)=>{"use strict";i.d(V,{b:()=>B});var S=i(11138),l=i(11590),Y=i(11579),g=i(11202);function q(h){const V=0|(h.segments||32),i=h.diameterX||h.diameter||1,l=h.diameterY||h.diameter||1,q=h.diameterZ||h.diameter||1,B=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1,J=h.slice&&h.slice<=0?1:h.slice||1,I=0===h.sideOrientation?0:h.sideOrientation||Y.d.DEFAULTSIDE,v=!!h.dedupTopBottomIndices,s=new S.nV(i/2,l/2,q/2),t=2+V,T=2*t,e=[],n=[],c=[],f=[];for(let Y=0;Y<=t;Y++){const h=Y/t,V=h*Math.PI*J;for(let i=0;i<=T;i++){const l=i/T,Y=l*Math.PI*2*B,q=S.Matrix.RotationZ(-V),J=S.Matrix.RotationY(Y),I=S.nV.TransformCoordinates(S.nV.Up(),q),v=S.nV.TransformCoordinates(I,J),t=v.multiply(s),e=v.divide(s).normalize();n.push(t.x,t.y,t.z),c.push(e.x,e.y,e.z),f.push(l,g.c?1-h:h)}if(Y>0){const h=n.length/3;for(let V=h-2*(T+1);V+T+2<h;V++)v?(Y>1&&(e.push(V),e.push(V+1),e.push(V+T+1)),(Y<t||J<1)&&(e.push(V+T+1),e.push(V+1),e.push(V+T+2))):(e.push(V),e.push(V+1),e.push(V+T+1),e.push(V+T+1),e.push(V+1),e.push(V+T+2))}}Y.d._ComputeSides(I,n,e,c,f,h.frontUVs,h.backUVs);const P=new Y.d;return P.indices=e,P.Eh=n,P.Hh=c,P.mh=f,P}function B(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new l.e(h,i);V.sideOrientation=l.e._GetDefaultSideOrientation(V.sideOrientation),S._originalBuilderSideOrientation=V.sideOrientation;return q(V).wh(S,V.updatable),S}Y.d.CreateSphere=q,l.e.CreateSphere=(h,V,i,S,l,Y)=>B(h,{segments:V,diameterX:i,diameterY:i,diameterZ:i,sideOrientation:Y,updatable:l},S)},13294:(h,V,i)=>{"use strict";i.d(V,{d:()=>q});var S=i(11712),l=i(12771),Y=i(11728),g=i(11579);class q{static get Configuration(){return{get decoder(){return l.c.DefaultConfiguration},set decoder(h){l.c.DefaultConfiguration=h}}}static set Configuration(h){l.c.DefaultConfiguration=h.decoder}static get DecoderAvailable(){return(0,S.g)(l.c.DefaultConfiguration)}static get Default(){return q._Default??(q._Default=new q),q._Default}static ResetDefault(h){q._Default&&(h||q._Default.dispose(),q._Default=null)}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.DefaultNumWorkers;const V="number"===typeof h?{...l.c.DefaultConfiguration,numWorkers:h}:{...l.c.DefaultConfiguration,...h};this._decoder=new l.c(V)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(h,V,i){return this._decoder.decodeMeshToMeshDataAsync(h,V,i)}async decodeMeshToGeometryAsync(h,V,i,S){return await this._decoder.decodeMeshToGeometryAsync(h,V,i,S)}async _decodeMeshToGeometryForGltfAsync(h,V,i,S,l,Y){return await this._decoder._decodeMeshToGeometryForGltfAsync(h,V,i,S,l,Y)}async decodeMeshAsync(h,V){const i=await this._decoder.decodeMeshToMeshDataAsync(h,V),S=new g.d;i.indices&&(S.indices=i.indices);for(const l of i.attributes){const h=Y.c.GetFloatData(l.data,l.size,Y.c.GetDataType(l.data),l.byteOffset,l.byteStride,l.normalized,i.totalVertices);S.set(h,l.kind)}return S}}q.DefaultNumWorkers=(0,S.d)(),q._Default=null},12771:(h,V,i)=>{"use strict";i.d(V,{c:()=>J});var S=i(11712),l=i(10952),Y=i(11603),g=i(11728),q=i(10967),B=i(11721);class J extends S.c{static get DefaultAvailable(){return(0,S.g)(J.DefaultConfiguration)}static get Default(){return J._Default??(J._Default=new J),J._Default}static ResetDefault(h){J._Default&&(h||J._Default.dispose(),J._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(h,V){return{module:await(V||DracoDecoderModule)({wasmBinary:h})}}_getWorkerContent(){return`${B.b}(${B.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.DefaultConfiguration)}decodeMeshToMeshDataAsync(h,V,i){const S=h instanceof ArrayBuffer?new Int8Array(h):new Int8Array(h.buffer,h.byteOffset,h.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async h=>await new Promise(((l,Y)=>{h.push(((h,g)=>{let B=null;const J=[],I=V=>{h.removeEventListener("error",I),h.removeEventListener("message",v),Y(V),g()},v=V=>{const S=V.data;switch(S.id){case"indices":B=S.data;break;case"attribute":J.push({kind:S.kind,data:S.data,size:S.size,byteOffset:S.byteOffset,byteStride:S.byteStride,normalized:(Y=S.kind,s=S.normalized,i&&void 0!==i[Y]?(s!==i[Y]&&q.d.Warn(`Normalized flag from Draco data (${s}) does not match normalized flag from glTF accessor (${i[Y]}). Using flag from glTF accessor.`),i[Y]):s)});break;case"decodeMeshDone":h.removeEventListener("error",I),h.removeEventListener("message",v),l({indices:B,attributes:J,totalVertices:S.totalVertices}),g()}var Y,s};h.addEventListener("error",I),h.addEventListener("message",v);const s=S.slice();h.postMessage({id:"decodeMesh",dataView:s,attributes:V},[s.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((h=>{let i=null;const l=[],Y=(0,B.b)(h.module,S,V,(h=>{i=h}),((h,V,i,S,Y,g)=>{l.push({kind:h,data:V,size:i,byteOffset:S,byteStride:Y,normalized:g})}));return{indices:i,attributes:l,totalVertices:Y}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(h,V,i,S){const l=await this.decodeMeshToMeshDataAsync(i,S),q=new Y.b(h,V);l.indices&&q.setIndices(l.indices);for(const Y of l.attributes)q.setVerticesBuffer(new g.c(V.getEngine(),Y.data,Y.kind,!1,void 0,Y.byteStride,void 0,Y.byteOffset,Y.size,void 0,Y.normalized,!0),l.totalVertices);return q}async _decodeMeshToGeometryForGltfAsync(h,V,i,S,l,q){const B=await this.decodeMeshToMeshDataAsync(i,S,l),J=new Y.b(h,V);q&&(J._boundingInfo=q,J.useBoundingInfoFromGeometry=!0),B.indices&&J.setIndices(B.indices);for(const Y of B.attributes)J.setVerticesBuffer(new g.c(V.getEngine(),Y.data,Y.kind,!1,void 0,Y.byteStride,void 0,Y.byteOffset,Y.size,void 0,Y.normalized,!0),B.totalVertices);return J}}J.DefaultConfiguration={wasmUrl:`${l.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${l.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${l.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},J._Default=null},12969:(h,V,i)=>{"use strict";i.d(V,{c:()=>qh});var S=i(11138),l=i(11590),Y=i(11220),g=i(11579),q=i(11202);function B(h){let V=h.pathArray;const i=h.closeArray||!1,S=h.closePath||!1,l=h.invertUV||!1,B=Math.floor(V[0].length/2);let J=h.offset||B;J=J>B?B:Math.floor(J);const I=0===h.sideOrientation?0:h.sideOrientation||g.d.DEFAULTSIDE,v=h.mh,s=h.jh,t=[],T=[],e=[],n=[],c=[],f=[],P=[],L=[];let U;const X=[],D=[];let O,o,M;if(V.length<2){const h=[],i=[];for(o=0;o<V[0].length-J;o++)h.push(V[0][o]),i.push(V[0][o+J]);V=[h,i]}let F=0;const E=S?1:0,H=i?1:0;let j,m,G,w,N,r;for(U=V[0].length,O=0;O<V.length+H;O++){for(P[O]=0,c[O]=[0],j=O===V.length?V[0]:V[O],m=j.length,U=U<m?U:m,M=0;M<m;)t.push(j[M].x,j[M].y,j[M].z),M>0&&(G=j[M].cV(j[M-1]).length(),w=G+P[O],c[O].push(w),P[O]=w),M++;S&&(M--,t.push(j[0].x,j[0].y,j[0].z),G=j[M].cV(j[0]).length(),w=G+P[O],c[O].push(w),P[O]=w),X[O]=m+E,D[O]=F,F+=m+E}let k,R,Z=null,z=null;for(o=0;o<U+E;o++)for(L[o]=0,f[o]=[0],O=0;O<V.length-1+H;O++)N=V[O],r=O===V.length-1?V[0]:V[O+1],o===U?(Z=N[0],z=r[0]):(Z=N[o],z=r[o]),G=z.cV(Z).length(),w=G+L[o],f[o].push(w),L[o]=w;if(v)for(O=0;O<v.length;O++)n.push(v[O].x,q.c?1-v[O].y:v[O].y);else for(O=0;O<V.length+H;O++)for(o=0;o<U+E;o++)k=0!=P[O]?c[O][o]/P[O]:0,R=0!=L[o]?f[o][O]/L[o]:0,l?n.push(R,k):n.push(k,q.c?1-R:R);O=0;let d=0,x=X[O]-1,y=X[O+1]-1,Q=x<y?x:y,A=D[1]-D[0];const b=X.length-1;for(;d<=Q&&O<b;)T.push(d,d+A,d+1),T.push(d+A+1,d+1,d+A),d+=1,d===Q&&(O++,A=D[O+1]-D[O],x=X[O]-1,y=X[O+1]-1,d=D[O],Q=x<y?x+d:y+d);if(g.d.ComputeNormals(t,T,e),S){let h=0,i=0;for(O=0;O<V.length;O++){h=3*D[O],i=O+1<V.length?3*(D[O+1]-1):e.length-3,e[h]=.5*(e[h]+e[i]),e[h+1]=.5*(e[h+1]+e[i+1]),e[h+2]=.5*(e[h+2]+e[i+2]);const S=Math.sqrt(e[h]*e[h]+e[h+1]*e[h+1]+e[h+2]*e[h+2]);e[h]/=S,e[h+1]/=S,e[h+2]/=S,e[i]=e[h],e[i+1]=e[h+1],e[i+2]=e[h+2]}}if(i){let h=3*D[0],i=3*D[V.length];for(o=0;o<U+E;o++){e[h]=.5*(e[h]+e[i]),e[h+1]=.5*(e[h+1]+e[i+1]),e[h+2]=.5*(e[h+2]+e[i+2]);const V=Math.sqrt(e[h]*e[h]+e[h+1]*e[h+1]+e[h+2]*e[h+2]);e[h]/=V,e[h+1]/=V,e[h+2]/=V,e[i]=e[h],e[i+1]=e[h+1],e[i+2]=e[h+2],h+=3,i+=3}}g.d._ComputeSides(I,t,T,e,n,h.frontUVs,h.backUVs);let C=null;if(s){C=new Float32Array(4*s.length);for(let h=0;h<s.length;h++)C[4*h]=s[h].r,C[4*h+1]=s[h].g,C[4*h+2]=s[h].b,C[4*h+3]=s[h].a}const u=new g.d,p=new Float32Array(t),W=new Float32Array(e),a=new Float32Array(n);return u.indices=T,u.Eh=p,u.Hh=W,u.mh=a,C&&u.set(C,Y.h.ColorKind),S&&(u._idx=D),u}function J(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=V.pathArray,I=V.closeArray,v=V.closePath,s=l.e._GetDefaultSideOrientation(V.sideOrientation),t=V.instance,T=V.updatable;if(t){const h=S.TmpVectors.nV[0].Iq(Number.MAX_VALUE),i=S.TmpVectors.nV[1].Iq(-Number.MAX_VALUE),B=V=>{let S=J[0].length;const Y=t;let g=0;const q=Y._originalBuilderSideOrientation===l.e.DOUBLESIDE?2:1;for(let l=1;l<=q;++l)for(let q=0;q<J.length;++q){const l=J[q],B=l.length;S=S<B?S:B;for(let Y=0;Y<S;++Y){const S=l[Y];V[g]=S.x,V[g+1]=S.y,V[g+2]=S.z,h.minimizeInPlaceFromFloats(S.x,S.y,S.z),i.maximizeInPlaceFromFloats(S.x,S.y,S.z),g+=3}if(Y._creationDataStorage&&Y._creationDataStorage.closePath){const h=l[0];V[g]=h.x,V[g+1]=h.y,V[g+2]=h.z,g+=3}}},I=t.getVerticesData(Y.h.PositionKind);if(B(I),t.hasBoundingInfo?t.getBoundingInfo().reConstruct(h,i,t._worldMatrix):t.buildBoundingInfo(h,i,t._worldMatrix),t.updateVerticesData(Y.h.PositionKind,I,!1,!1),V.jh){const h=t.getVerticesData(Y.h.ColorKind);for(let i=0,S=0;i<V.jh.length;i++,S+=4){const l=V.jh[i];h[S]=l.r,h[S+1]=l.g,h[S+2]=l.b,h[S+3]=l.a}t.updateVerticesData(Y.h.ColorKind,h,!1,!1)}if(V.mh){const h=t.getVerticesData(Y.h.UVKind);for(let i=0;i<V.mh.length;i++)h[2*i]=V.mh[i].x,h[2*i+1]=q.c?1-V.mh[i].y:V.mh[i].y;t.updateVerticesData(Y.h.UVKind,h,!1,!1)}if(!t.areNormalsFrozen||t.isFacetDataEnabled){const h=t.ug(),V=t.getVerticesData(Y.h.NormalKind),i=t.isFacetDataEnabled?t.getFacetDataParameters():null;if(g.d.ComputeNormals(I,h,V,i),t._creationDataStorage&&t._creationDataStorage.closePath){let h=0,i=0;for(let S=0;S<J.length;S++)h=3*t._creationDataStorage.idx[S],i=S+1<J.length?3*(t._creationDataStorage.idx[S+1]-1):V.length-3,V[h]=.5*(V[h]+V[i]),V[h+1]=.5*(V[h+1]+V[i+1]),V[h+2]=.5*(V[h+2]+V[i+2]),V[i]=V[h],V[i+1]=V[h+1],V[i+2]=V[h+2]}t.areNormalsFrozen||t.updateVerticesData(Y.h.NormalKind,V,!1,!1)}return t}{const S=new l.e(h,i);S._originalBuilderSideOrientation=s,S._creationDataStorage=new l.g;const Y=B(V);return v&&(S._creationDataStorage.idx=Y._idx),S._creationDataStorage.closePath=v,S._creationDataStorage.closeArray=I,Y.wh(S,T),S}}g.d.CreateRibbon=B,l.e.CreateRibbon=function(h,V){return J(h,{pathArray:V,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var I=i(12480),v=i(12330),s=i(11189);function t(h){const V=h.pattern||l.e.NO_FLIP,i=h.tileWidth||h.tileSize||1,S=h.tileHeight||h.tileSize||1,Y=h.alignHorizontal||0,q=h.alignVertical||0,B=h.width||h.size||1,J=Math.floor(B/i);let I=B-J*i;const v=h.height||h.size||1,s=Math.floor(v/S);let t=v-s*S;const T=i*J/2,e=S*s/2;let n=0,c=0,f=0,P=0,L=0,U=0;if(I>0||t>0){switch(f=-T,P=-e,L=T,U=e,Y){case l.e.CENTER:I/=2,f-=I,L+=I;break;case l.e.LEFT:L+=I,n=-I/2;break;case l.e.RIGHT:f-=I,n=I/2}switch(q){case l.e.CENTER:t/=2,P-=t,U+=t;break;case l.e.BOTTOM:U+=t,c=-t/2;break;case l.e.TOP:P-=t,c=t/2}}const X=[],D=[],O=[];O[0]=[0,0,1,0,1,1,0,1],O[1]=[0,0,1,0,1,1,0,1],V!==l.e.ROTATE_TILE&&V!==l.e.ROTATE_ROW||(O[1]=[1,1,0,1,0,0,1,0]),V!==l.e.FLIP_TILE&&V!==l.e.FLIP_ROW||(O[1]=[1,0,0,0,0,1,1,1]),V!==l.e.FLIP_N_ROTATE_TILE&&V!==l.e.FLIP_N_ROTATE_ROW||(O[1]=[0,1,1,1,1,0,0,0]);let o=[];const M=[],F=[];let E=0;for(let g=0;g<s;g++)for(let h=0;h<J;h++)X.push(h*i-T+n,g*S-e+c,0),X.push((h+1)*i-T+n,g*S-e+c,0),X.push((h+1)*i-T+n,(g+1)*S-e+c,0),X.push(h*i-T+n,(g+1)*S-e+c,0),F.push(E,E+1,E+3,E+1,E+2,E+3),o=V===l.e.FLIP_TILE||V===l.e.ROTATE_TILE||V===l.e.FLIP_N_ROTATE_TILE?o.concat(O[(h%2+g%2)%2]):V===l.e.FLIP_ROW||V===l.e.ROTATE_ROW||V===l.e.FLIP_N_ROTATE_ROW?o.concat(O[g%2]):o.concat(O[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),E+=4;if(I>0||t>0){const h=t>0&&(q===l.e.CENTER||q===l.e.TOP),g=t>0&&(q===l.e.CENTER||q===l.e.BOTTOM),B=I>0&&(Y===l.e.CENTER||Y===l.e.RIGHT),v=I>0&&(Y===l.e.CENTER||Y===l.e.LEFT);let O,H,j,m,G=[];if(h&&B&&(X.push(f+n,P+c,0),X.push(-T+n,P+c,0),X.push(-T+n,P+t+c,0),X.push(f+n,P+t+c,0),F.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,O=1-I/i,H=1-t/S,j=1,m=1,G=[O,H,j,H,j,m,O,m],V===l.e.ROTATE_ROW&&(G=[1-O,1-H,1-j,1-H,1-j,1-m,1-O,1-m]),V===l.e.FLIP_ROW&&(G=[1-O,H,1-j,H,1-j,m,1-O,m]),V===l.e.FLIP_N_ROTATE_ROW&&(G=[O,1-H,j,1-H,j,1-m,O,1-m]),o=o.concat(G),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h&&v&&(X.push(T+n,P+c,0),X.push(L+n,P+c,0),X.push(L+n,P+t+c,0),X.push(T+n,P+t+c,0),F.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,O=0,H=1-t/S,j=I/i,m=1,G=[O,H,j,H,j,m,O,m],(V===l.e.ROTATE_ROW||V===l.e.ROTATE_TILE&&J%2===0)&&(G=[1-O,1-H,1-j,1-H,1-j,1-m,1-O,1-m]),(V===l.e.FLIP_ROW||V===l.e.FLIP_TILE&&J%2===0)&&(G=[1-O,H,1-j,H,1-j,m,1-O,m]),(V===l.e.FLIP_N_ROTATE_ROW||V===l.e.FLIP_N_ROTATE_TILE&&J%2===0)&&(G=[O,1-H,j,1-H,j,1-m,O,1-m]),o=o.concat(G),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&B&&(X.push(f+n,e+c,0),X.push(-T+n,e+c,0),X.push(-T+n,U+c,0),X.push(f+n,U+c,0),F.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,O=1-I/i,H=0,j=1,m=t/S,G=[O,H,j,H,j,m,O,m],(V===l.e.ROTATE_ROW&&s%2===1||V===l.e.ROTATE_TILE&&s%1===0)&&(G=[1-O,1-H,1-j,1-H,1-j,1-m,1-O,1-m]),(V===l.e.FLIP_ROW&&s%2===1||V===l.e.FLIP_TILE&&s%2===0)&&(G=[1-O,H,1-j,H,1-j,m,1-O,m]),(V===l.e.FLIP_N_ROTATE_ROW&&s%2===1||V===l.e.FLIP_N_ROTATE_TILE&&s%2===0)&&(G=[O,1-H,j,1-H,j,1-m,O,1-m]),o=o.concat(G),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&v&&(X.push(T+n,e+c,0),X.push(L+n,e+c,0),X.push(L+n,U+c,0),X.push(T+n,U+c,0),F.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,O=0,H=0,j=I/i,m=t/S,G=[O,H,j,H,j,m,O,m],(V===l.e.ROTATE_ROW&&s%2===1||V===l.e.ROTATE_TILE&&(s+J)%2===1)&&(G=[1-O,1-H,1-j,1-H,1-j,1-m,1-O,1-m]),(V===l.e.FLIP_ROW&&s%2===1||V===l.e.FLIP_TILE&&(s+J)%2===1)&&(G=[1-O,H,1-j,H,1-j,m,1-O,m]),(V===l.e.FLIP_N_ROTATE_ROW&&s%2===1||V===l.e.FLIP_N_ROTATE_TILE&&(s+J)%2===1)&&(G=[O,1-H,j,1-H,j,1-m,O,1-m]),o=o.concat(G),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h){const h=[];O=0,H=1-t/S,j=1,m=1,h[0]=[O,H,j,H,j,m,O,m],h[1]=[O,H,j,H,j,m,O,m],V!==l.e.ROTATE_TILE&&V!==l.e.ROTATE_ROW||(h[1]=[1-O,1-H,1-j,1-H,1-j,1-m,1-O,1-m]),V!==l.e.FLIP_TILE&&V!==l.e.FLIP_ROW||(h[1]=[1-O,H,1-j,H,1-j,m,1-O,m]),V!==l.e.FLIP_N_ROTATE_TILE&&V!==l.e.FLIP_N_ROTATE_ROW||(h[1]=[O,1-H,j,1-H,j,1-m,O,1-m]);for(let S=0;S<J;S++)X.push(S*i-T+n,P+c,0),X.push((S+1)*i-T+n,P+c,0),X.push((S+1)*i-T+n,P+t+c,0),X.push(S*i-T+n,P+t+c,0),F.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,o=V===l.e.FLIP_TILE||V===l.e.ROTATE_TILE||V===l.e.FLIP_N_ROTATE_TILE?o.concat(h[(S+1)%2]):V===l.e.FLIP_ROW||V===l.e.ROTATE_ROW||V===l.e.FLIP_N_ROTATE_ROW?o.concat(h[1]):o.concat(h[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(g){const h=[];O=0,H=0,j=1,m=t/S,h[0]=[O,H,j,H,j,m,O,m],h[1]=[O,H,j,H,j,m,O,m],V!==l.e.ROTATE_TILE&&V!==l.e.ROTATE_ROW||(h[1]=[1-O,1-H,1-j,1-H,1-j,1-m,1-O,1-m]),V!==l.e.FLIP_TILE&&V!==l.e.FLIP_ROW||(h[1]=[1-O,H,1-j,H,1-j,m,1-O,m]),V!==l.e.FLIP_N_ROTATE_TILE&&V!==l.e.FLIP_N_ROTATE_ROW||(h[1]=[O,1-H,j,1-H,j,1-m,O,1-m]);for(let S=0;S<J;S++)X.push(S*i-T+n,U-t+c,0),X.push((S+1)*i-T+n,U-t+c,0),X.push((S+1)*i-T+n,U+c,0),X.push(S*i-T+n,U+c,0),F.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,o=V===l.e.FLIP_TILE||V===l.e.ROTATE_TILE||V===l.e.FLIP_N_ROTATE_TILE?o.concat(h[(S+s)%2]):V===l.e.FLIP_ROW||V===l.e.ROTATE_ROW||V===l.e.FLIP_N_ROTATE_ROW?o.concat(h[s%2]):o.concat(h[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(B){const h=[];O=1-I/i,H=0,j=1,m=1,h[0]=[O,H,j,H,j,m,O,m],h[1]=[O,H,j,H,j,m,O,m],V!==l.e.ROTATE_TILE&&V!==l.e.ROTATE_ROW||(h[1]=[1-O,1-H,1-j,1-H,1-j,1-m,1-O,1-m]),V!==l.e.FLIP_TILE&&V!==l.e.FLIP_ROW||(h[1]=[1-O,H,1-j,H,1-j,m,1-O,m]),V!==l.e.FLIP_N_ROTATE_TILE&&V!==l.e.FLIP_N_ROTATE_ROW||(h[1]=[O,1-H,j,1-H,j,1-m,O,1-m]);for(let i=0;i<s;i++)X.push(f+n,i*S-e+c,0),X.push(f+I+n,i*S-e+c,0),X.push(f+I+n,(i+1)*S-e+c,0),X.push(f+n,(i+1)*S-e+c,0),F.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,o=V===l.e.FLIP_TILE||V===l.e.ROTATE_TILE||V===l.e.FLIP_N_ROTATE_TILE?o.concat(h[(i+1)%2]):V===l.e.FLIP_ROW||V===l.e.ROTATE_ROW||V===l.e.FLIP_N_ROTATE_ROW?o.concat(h[i%2]):o.concat(h[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(v){const h=[];O=0,H=0,j=I/S,m=1,h[0]=[O,H,j,H,j,m,O,m],h[1]=[O,H,j,H,j,m,O,m],V!==l.e.ROTATE_TILE&&V!==l.e.ROTATE_ROW||(h[1]=[1-O,1-H,1-j,1-H,1-j,1-m,1-O,1-m]),V!==l.e.FLIP_TILE&&V!==l.e.FLIP_ROW||(h[1]=[1-O,H,1-j,H,1-j,m,1-O,m]),V!==l.e.FLIP_N_ROTATE_TILE&&V!==l.e.FLIP_N_ROTATE_ROW||(h[1]=[O,1-H,j,1-H,j,1-m,O,1-m]);for(let i=0;i<s;i++)X.push(L-I+n,i*S-e+c,0),X.push(L+n,i*S-e+c,0),X.push(L+n,(i+1)*S-e+c,0),X.push(L-I+n,(i+1)*S-e+c,0),F.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,o=V===l.e.FLIP_TILE||V===l.e.ROTATE_TILE||V===l.e.FLIP_N_ROTATE_TILE?o.concat(h[(i+J)%2]):V===l.e.FLIP_ROW||V===l.e.ROTATE_ROW||V===l.e.FLIP_N_ROTATE_ROW?o.concat(h[i%2]):o.concat(h[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const H=0===h.sideOrientation?0:h.sideOrientation||g.d.DEFAULTSIDE;g.d._ComputeSides(H,X,F,D,o,h.frontUVs,h.backUVs);const j=new g.d;j.indices=F,j.Eh=X,j.Hh=D,j.mh=o;const m=H===g.d.DOUBLESIDE?M.concat(M):M;return j.jh=m,j}function T(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new l.e(h,i);V.sideOrientation=l.e._GetDefaultSideOrientation(V.sideOrientation),S._originalBuilderSideOrientation=V.sideOrientation;return t(V).wh(S,V.updatable),S}function e(h){const V=h.faceUV||new Array(6),i=h.faceColors,Y=h.pattern||l.e.NO_FLIP,B=h.width||h.size||1,J=h.height||h.size||1,I=h.depth||h.size||1,v=h.tileWidth||h.tileSize||1,T=h.tileHeight||h.tileSize||1,e=h.alignHorizontal||0,n=h.alignVertical||0,c=0===h.sideOrientation?0:h.sideOrientation||g.d.DEFAULTSIDE;for(let l=0;l<6;l++)void 0===V[l]&&(V[l]=new S.Vector4(0,0,1,1)),i&&void 0===i[l]&&(i[l]=new s.vq(1,1,1,1));const f=B/2,P=J/2,L=I/2,U=[];for(let S=0;S<2;S++)U[S]=t({pattern:Y,tileWidth:v,tileHeight:T,width:B,height:J,alignVertical:n,alignHorizontal:e,sideOrientation:c});for(let S=2;S<4;S++)U[S]=t({pattern:Y,tileWidth:v,tileHeight:T,width:I,height:J,alignVertical:n,alignHorizontal:e,sideOrientation:c});let X=n;n===l.e.BOTTOM?X=l.e.TOP:n===l.e.TOP&&(X=l.e.BOTTOM);for(let S=4;S<6;S++)U[S]=t({pattern:Y,tileWidth:v,tileHeight:T,width:B,height:I,alignVertical:X,alignHorizontal:e,sideOrientation:c});let D=[],O=[],o=[],M=[];const F=[],E=[],H=[],j=[];let m=0,G=0;for(let l=0;l<6;l++){const h=U[l].Eh.length;E[l]=[],H[l]=[];for(let V=0;V<h/3;V++)E[l].push(new S.nV(U[l].Eh[3*V],U[l].Eh[3*V+1],U[l].Eh[3*V+2])),H[l].push(new S.nV(U[l].Hh[3*V],U[l].Hh[3*V+1],U[l].Hh[3*V+2]));m=U[l].mh.length,j[l]=[];for(let i=0;i<m;i+=2)j[l][i]=V[l].x+(V[l].z-V[l].x)*U[l].mh[i],j[l][i+1]=V[l].y+(V[l].w-V[l].y)*U[l].mh[i+1],q.c&&(j[l][i+1]=1-j[l][i+1]);if(o=o.concat(j[l]),M=M.concat(U[l].indices.map((h=>h+G))),G+=E[l].length,i)for(let V=0;V<4;V++)F.push(i[l].r,i[l].g,i[l].b,i[l].a)}const w=new S.nV(0,0,L),N=S.Matrix.RotationY(Math.PI);D=E[0].map((h=>S.nV.TransformNormal(h,N).add(w))).map((h=>[h.x,h.y,h.z])).reduce(((h,V)=>h.concat(V)),[]),O=H[0].map((h=>S.nV.TransformNormal(h,N))).map((h=>[h.x,h.y,h.z])).reduce(((h,V)=>h.concat(V)),[]),D=D.concat(E[1].map((h=>h.cV(w))).map((h=>[h.x,h.y,h.z])).reduce(((h,V)=>h.concat(V)),[])),O=O.concat(H[1].map((h=>[h.x,h.y,h.z])).reduce(((h,V)=>h.concat(V)),[]));const r=new S.nV(f,0,0),k=S.Matrix.RotationY(-Math.PI/2);D=D.concat(E[2].map((h=>S.nV.TransformNormal(h,k).add(r))).map((h=>[h.x,h.y,h.z])).reduce(((h,V)=>h.concat(V)),[])),O=O.concat(H[2].map((h=>S.nV.TransformNormal(h,k))).map((h=>[h.x,h.y,h.z])).reduce(((h,V)=>h.concat(V)),[]));const R=S.Matrix.RotationY(Math.PI/2);D=D.concat(E[3].map((h=>S.nV.TransformNormal(h,R).cV(r))).map((h=>[h.x,h.y,h.z])).reduce(((h,V)=>h.concat(V)),[])),O=O.concat(H[3].map((h=>S.nV.TransformNormal(h,R))).map((h=>[h.x,h.y,h.z])).reduce(((h,V)=>h.concat(V)),[]));const Z=new S.nV(0,P,0),z=S.Matrix.RotationX(Math.PI/2);D=D.concat(E[4].map((h=>S.nV.TransformNormal(h,z).add(Z))).map((h=>[h.x,h.y,h.z])).reduce(((h,V)=>h.concat(V)),[])),O=O.concat(H[4].map((h=>S.nV.TransformNormal(h,z))).map((h=>[h.x,h.y,h.z])).reduce(((h,V)=>h.concat(V)),[]));const d=S.Matrix.RotationX(-Math.PI/2);D=D.concat(E[5].map((h=>S.nV.TransformNormal(h,d).cV(Z))).map((h=>[h.x,h.y,h.z])).reduce(((h,V)=>h.concat(V)),[])),O=O.concat(H[5].map((h=>S.nV.TransformNormal(h,d))).map((h=>[h.x,h.y,h.z])).reduce(((h,V)=>h.concat(V)),[])),g.d._ComputeSides(c,D,M,O,o);const x=new g.d;if(x.indices=M,x.Eh=D,x.Hh=O,x.mh=o,i){const h=c===g.d.DOUBLESIDE?F.concat(F):F;x.jh=h}return x}function n(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new l.e(h,i);V.sideOrientation=l.e._GetDefaultSideOrientation(V.sideOrientation),S._originalBuilderSideOrientation=V.sideOrientation;return e(V).wh(S,V.updatable),S}g.d.CreateTiledPlane=t;g.d.CreateTiledBox=e;var c=i(12464),f=i(11382),P=i(11345);function L(h){const V=h.height||2;let i=0===h.diameterTop?0:h.diameterTop||h.diameter||1,Y=0===h.diameterBottom?0:h.diameterBottom||h.diameter||1;i=i||1e-5,Y=Y||1e-5;const B=0|(h.tessellation||24),J=0|(h.subdivisions||1),I=!!h.hasRings,v=!!h.enclose,t=0===h.cap?0:h.cap||l.e.CAP_ALL,T=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1,e=0===h.sideOrientation?0:h.sideOrientation||g.d.DEFAULTSIDE,n=h.faceUV||new Array(3),c=h.faceColors,f=2+(1+(1!==T&&v?2:0))*(I?J:1);let L;for(L=0;L<f;L++)c&&void 0===c[L]&&(c[L]=new s.vq(1,1,1,1));for(L=0;L<f;L++)n&&void 0===n[L]&&(n[L]=new S.Vector4(0,0,1,1));const U=[],X=[],D=[],O=[],o=[],M=2*Math.PI*T/B;let F,E,H;const j=(Y-i)/2/V,m=S.nV.Zero(),G=S.nV.Zero(),w=S.nV.Zero(),N=S.nV.Zero(),r=S.nV.Zero(),k=P.c.Y;let R,Z,z,d=1,x=1,y=0,Q=0;for(R=0;R<=J;R++)for(E=R/J,H=(E*(i-Y)+Y)/2,d=I&&0!==R&&R!==J?2:1,z=0;z<d;z++){for(I&&(x+=z),v&&(x+=2*z),Z=0;Z<=B;Z++)F=Z*M,m.x=Math.cos(-F)*H,m.y=-V/2+E*V,m.z=Math.sin(-F)*H,0===i&&R===J?(G.x=D[D.length-3*(B+1)],G.y=D[D.length-3*(B+1)+1],G.z=D[D.length-3*(B+1)+2]):(G.x=m.x,G.z=m.z,G.y=Math.sqrt(G.x*G.x+G.z*G.z)*j,G.normalize()),0===Z&&(w.l(m),N.l(G)),X.push(m.x,m.y,m.z),D.push(G.x,G.y,G.z),Q=I?y!==x?n[x].y:n[x].w:n[x].y+(n[x].w-n[x].y)*E,O.push(n[x].x+(n[x].z-n[x].x)*Z/B,q.c?1-Q:Q),c&&o.push(c[x].r,c[x].g,c[x].b,c[x].a);1!==T&&v&&(X.push(m.x,m.y,m.z),X.push(0,m.y,0),X.push(0,m.y,0),X.push(w.x,w.y,w.z),S.nV.CrossToRef(k,G,r),r.normalize(),D.push(r.x,r.y,r.z,r.x,r.y,r.z),S.nV.CrossToRef(N,k,r),r.normalize(),D.push(r.x,r.y,r.z,r.x,r.y,r.z),Q=I?y!==x?n[x+1].y:n[x+1].w:n[x+1].y+(n[x+1].w-n[x+1].y)*E,O.push(n[x+1].x,q.c?1-Q:Q),O.push(n[x+1].z,q.c?1-Q:Q),Q=I?y!==x?n[x+2].y:n[x+2].w:n[x+2].y+(n[x+2].w-n[x+2].y)*E,O.push(n[x+2].x,q.c?1-Q:Q),O.push(n[x+2].z,q.c?1-Q:Q),c&&(o.push(c[x+1].r,c[x+1].g,c[x+1].b,c[x+1].a),o.push(c[x+1].r,c[x+1].g,c[x+1].b,c[x+1].a),o.push(c[x+2].r,c[x+2].g,c[x+2].b,c[x+2].a),o.push(c[x+2].r,c[x+2].g,c[x+2].b,c[x+2].a))),y!==x&&(y=x)}const A=1!==T&&v?B+4:B;for(R=0,x=0;x<J;x++){let h=0,V=0,i=0,S=0;for(Z=0;Z<B;Z++)h=R*(A+1)+Z,V=(R+1)*(A+1)+Z,i=R*(A+1)+(Z+1),S=(R+1)*(A+1)+(Z+1),U.push(h,V,i),U.push(S,i,V);1!==T&&v&&(U.push(h+2,V+2,i+2),U.push(S+2,i+2,V+2),U.push(h+4,V+4,i+4),U.push(S+4,i+4,V+4)),R=I?R+2:R+1}const b=h=>{const l=h?i/2:Y/2;if(0===l)return;let g,J,I;const v=h?n[f-1]:n[0];let s=null;c&&(s=h?c[f-1]:c[0]);const t=X.length/3,e=h?V/2:-V/2,P=new S.nV(0,e,0);X.push(P.x,P.y,P.z),D.push(0,h?1:-1,0);const L=v.y+.5*(v.w-v.y);O.push(v.x+.5*(v.z-v.x),q.c?1-L:L),s&&o.push(s.r,s.g,s.b,s.a);const M=new S.Vector2(.5,.5);for(I=0;I<=B;I++){g=2*Math.PI*I*T/B;const V=Math.cos(-g),i=Math.sin(-g);J=new S.nV(V*l,e,i*l);const Y=new S.Vector2(V*M.x+.5,i*M.y+.5);X.push(J.x,J.y,J.z),D.push(0,h?1:-1,0);const t=v.y+(v.w-v.y)*Y.y;O.push(v.x+(v.z-v.x)*Y.x,q.c?1-t:t),s&&o.push(s.r,s.g,s.b,s.a)}for(I=0;I<B;I++)h?(U.push(t),U.push(t+(I+2)),U.push(t+(I+1))):(U.push(t),U.push(t+(I+1)),U.push(t+(I+2)))};t!==l.e.CAP_START&&t!==l.e.CAP_ALL||b(!1),t!==l.e.CAP_END&&t!==l.e.CAP_ALL||b(!0),g.d._ComputeSides(e,X,U,D,O,h.frontUVs,h.backUVs);const C=new g.d;return C.indices=U,C.Eh=X,C.Hh=D,C.mh=O,c&&(C.jh=o),C}function U(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const S=new l.e(h,i);V.sideOrientation=l.e._GetDefaultSideOrientation(V.sideOrientation),S._originalBuilderSideOrientation=V.sideOrientation;return L(V).wh(S,V.updatable),S}function X(h){const V=[],i=[],l=[],Y=[],B=h.diameter||1,J=h.thickness||.5,I=0|(h.tessellation||16),v=0===h.sideOrientation?0:h.sideOrientation||g.d.DEFAULTSIDE,s=I+1;for(let g=0;g<=I;g++){const h=g/I,v=g*Math.PI*2/I-Math.PI/2,t=S.Matrix.Translation(B/2,0,0).multiply(S.Matrix.RotationY(v));for(let B=0;B<=I;B++){const v=1-B/I,T=B*Math.PI*2/I+Math.PI,e=Math.cos(T),n=Math.sin(T);let c=new S.nV(e,n,0),f=c.scale(J/2);const P=new S.Vector2(h,v);f=S.nV.TransformCoordinates(f,t),c=S.nV.TransformNormal(c,t),i.push(f.x,f.y,f.z),l.push(c.x,c.y,c.z),Y.push(P.x,q.c?1-P.y:P.y);const L=(g+1)%s,U=(B+1)%s;V.push(g*s+B),V.push(g*s+U),V.push(L*s+B),V.push(g*s+U),V.push(L*s+U),V.push(L*s+B)}}g.d._ComputeSides(v,i,V,l,Y,h.frontUVs,h.backUVs);const t=new g.d;return t.indices=V,t.Eh=i,t.Hh=l,t.mh=Y,t}function D(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const S=new l.e(h,i);V.sideOrientation=l.e._GetDefaultSideOrientation(V.sideOrientation),S._originalBuilderSideOrientation=V.sideOrientation;return X(V).wh(S,V.updatable),S}g.d.CreateCylinder=L,l.e.CreateCylinder=(h,V,i,S,Y,g,q,B,J)=>{void 0!==q&&q instanceof f.d||(void 0!==q&&(J=B||l.e.DEFAULTSIDE,B=q),q=g,g=1);return U(h,{height:V,diameterTop:i,diameterBottom:S,tessellation:Y,subdivisions:g,sideOrientation:J,updatable:B},q)};function O(h){const V=[],i=[],l=[],Y=[],B=h.radius||2,J=h.tube||.5,I=h.radialSegments||32,v=h.tubularSegments||32,s=h.p||2,t=h.q||3,T=0===h.sideOrientation?0:h.sideOrientation||g.d.DEFAULTSIDE,e=h=>{const V=Math.cos(h),i=Math.sin(h),l=t/s*h,Y=Math.cos(l),g=B*(2+Y)*.5*V,q=B*(2+Y)*i*.5,J=B*Math.sin(l)*.5;return new S.nV(g,q,J)};let n,c;for(n=0;n<=I;n++){const h=n%I/I*2*s*Math.PI,V=e(h),l=e(h+.01),g=l.cV(V);let B=l.add(V);const t=S.nV.Cross(g,B);for(B=S.nV.Cross(t,g),t.normalize(),B.normalize(),c=0;c<v;c++){const h=c%v/v*2*Math.PI,S=-J*Math.cos(h),l=J*Math.sin(h);i.push(V.x+S*B.x+l*t.x),i.push(V.y+S*B.y+l*t.y),i.push(V.z+S*B.z+l*t.z),Y.push(n/I),Y.push(q.c?1-c/v:c/v)}}for(n=0;n<I;n++)for(c=0;c<v;c++){const h=(c+1)%v,i=n*v+c,S=(n+1)*v+c,l=(n+1)*v+h,Y=n*v+h;V.push(Y),V.push(S),V.push(i),V.push(Y),V.push(l),V.push(S)}g.d.ComputeNormals(i,V,l),g.d._ComputeSides(T,i,V,l,Y,h.frontUVs,h.backUVs);const f=new g.d;return f.indices=V,f.Eh=i,f.Hh=l,f.mh=Y,f}function o(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const S=new l.e(h,i);V.sideOrientation=l.e._GetDefaultSideOrientation(V.sideOrientation),S._originalBuilderSideOrientation=V.sideOrientation;return O(V).wh(S,V.updatable),S}g.d.CreateTorus=X,l.e.CreateTorus=(h,V,i,S,l,Y,g)=>D(h,{diameter:V,thickness:i,tessellation:S,sideOrientation:g,updatable:Y},l);g.d.CreateTorusKnot=O,l.e.CreateTorusKnot=(h,V,i,S,l,Y,g,q,B,J)=>o(h,{radius:V,tube:i,radialSegments:S,tubularSegments:l,p:Y,q:g,sideOrientation:J,updatable:B},q);var M=i(12974),F=i(11699),E=i(11352);function H(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=V.path,Y=V.shape,g=V.scale||1,q=V.rotation||0,B=0===V.cap?0:V.cap||l.e.NO_CAP,J=V.updatable,I=l.e._GetDefaultSideOrientation(V.sideOrientation),v=V.instance||null,s=V.invertUV||!1,t=V.closeShape||!1,T=V.closePath||!1,e=V.capFunction||null;return m(h,Y,S,g,q,null,null,T,t,B,!1,i,!!J,I,v,s,V.frontUVs||null,V.backUVs||null,V.firstNormal||null,!!V.adjustFrame,e)}function j(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=V.path,Y=V.shape,g=V.scaleFunction||(()=>1),q=V.rotationFunction||(()=>0),B=V.closePath||V.ribbonCloseArray||!1,J=V.closeShape||V.ribbonClosePath||!1,I=0===V.cap?0:V.cap||l.e.NO_CAP,v=V.updatable,s=V.firstNormal||null,t=V.adjustFrame||!1,T=l.e._GetDefaultSideOrientation(V.sideOrientation),e=V.instance,n=V.invertUV||!1,c=V.capFunction||null;return m(h,Y,S,null,null,g,q,B,J,I,!0,i,!!v,T,e||null,n,V.frontUVs||null,V.backUVs||null,s,t,c||null)}function m(h,V,i,Y,g,q,B,I,v,s,t,T,e,n,c,f,P,L,U,X,D){const O=(h,V,i,Y,g,q,B,J,I,v,s)=>{const t=i.getTangents(),T=i.getNormals(),e=i.getBinormals(),n=i.getDistances();if(s)for(let l=0;l<t.length;l++)if(0==t[l].x&&0==t[l].y&&0==t[l].z&&t[l].l(t[l-1]),0==T[l].x&&0==T[l].y&&0==T[l].z&&T[l].l(T[l-1]),0==e[l].x&&0==e[l].y&&0==e[l].z&&e[l].l(e[l-1]),l>0){let h=t[l-1];S.nV.Dot(h,t[l])<0&&t[l].scaleInPlace(-1),h=T[l-1],S.nV.Dot(h,T[l])<0&&T[l].scaleInPlace(-1),h=e[l-1],S.nV.Dot(h,e[l])<0&&e[l].scaleInPlace(-1)}let c=0;const f=v&&J?J:()=>null!==q?q:0,P=v&&B?B:()=>null!==g?g:1;let L=I===l.e.NO_CAP||I===l.e.CAP_END?0:2;const U=S.TmpVectors.Matrix[0];for(let l=0;l<V.length;l++){const i=[],g=f(l,n[l]),q=P(l,n[l]);S.Matrix.RotationAxisToRef(t[l],c,U);for(let Y=0;Y<h.length;Y++){const g=t[l].scale(h[Y].z).add(T[l].scale(h[Y].x)).add(e[l].scale(h[Y].y)),B=S.nV.Zero();S.nV.TransformCoordinatesToRef(g,U,B),B.scaleInPlace(q).addInPlace(V[l]),i[Y]=B}Y[L]=i,c+=g,L++}const X=D||(h=>{const V=Array(),i=S.nV.Zero();let l;for(l=0;l<h.length;l++)i.addInPlace(h[l]);for(i.scaleInPlace(1/h.length),l=0;l<h.length;l++)V.push(i);return V});switch(I){case l.e.NO_CAP:break;case l.e.CAP_START:Y[0]=X(Y[2]),Y[1]=Y[2];break;case l.e.CAP_END:Y[L]=Y[L-1],Y[L+1]=X(Y[L-1]);break;case l.e.CAP_ALL:Y[0]=X(Y[2]),Y[1]=Y[2],Y[L]=Y[L-1],Y[L+1]=X(Y[L-1])}return Y};let o,M;if(c){const h=c._creationDataStorage;return o=U?h.path3D.update(i,U):h.path3D.update(i),M=O(V,i,h.path3D,h.pathArray,Y,g,q,B,h.cap,t,X),c=J("",{pathArray:M,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:c},T||void 0)}o=U?new E.k(i,U):new E.k(i);M=O(V,i,o,new Array,Y,g,q,B,s=s<0||s>3?0:s,t,X);const F=J(h,{pathArray:M,closeArray:I,closePath:v,updatable:e,sideOrientation:n,invertUV:f,frontUVs:P||void 0,backUVs:L||void 0},T);return F._creationDataStorage.pathArray=M,F._creationDataStorage.path3D=o,F._creationDataStorage.cap=s,F}function G(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=V.arc?V.arc<=0||V.arc>1?1:V.arc:1,g=void 0===V.closed||V.closed,q=V.shape,B=V.radius||1,I=V.tessellation||64,v=V.clip||0,s=V.updatable,t=l.e._GetDefaultSideOrientation(V.sideOrientation),T=V.cap||l.e.NO_CAP,e=2*Math.PI,n=[],c=V.invertUV||!1;let f=0,P=0;const L=e/I*Y;let U,X;for(f=0;f<=I-v;f++){for(X=[],T!=l.e.CAP_START&&T!=l.e.CAP_ALL||(X.push(new S.nV(0,q[0].y,0)),X.push(new S.nV(Math.cos(f*L)*q[0].x*B,q[0].y,Math.sin(f*L)*q[0].x*B))),P=0;P<q.length;P++)U=new S.nV(Math.cos(f*L)*q[P].x*B,q[P].y,Math.sin(f*L)*q[P].x*B),X.push(U);T!=l.e.CAP_END&&T!=l.e.CAP_ALL||(X.push(new S.nV(Math.cos(f*L)*q[q.length-1].x*B,q[q.length-1].y,Math.sin(f*L)*q[q.length-1].x*B)),X.push(new S.nV(0,q[q.length-1].y,0))),n.push(X)}return J(h,{pathArray:n,closeArray:g,sideOrientation:t,updatable:s,invertUV:c,frontUVs:V.frontUVs,backUVs:V.backUVs},i)}l.e.ExtrudeShape=function(h,V,i,S,Y,g){let q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7?arguments[7]:void 0,J=arguments.length>8?arguments[8]:void 0,I=arguments.length>9?arguments[9]:void 0;return H(h,{shape:V,path:i,scale:S,rotation:Y,cap:0===g?0:g||l.e.NO_CAP,sideOrientation:J,instance:I,updatable:B},q)},l.e.ExtrudeShapeCustom=(h,V,i,S,Y,g,q,B,J,I,v,s)=>j(h,{shape:V,path:i,scaleFunction:S,rotationFunction:Y,ribbonCloseArray:g,ribbonClosePath:q,cap:0===B?0:B||l.e.NO_CAP,sideOrientation:v,instance:s,updatable:I},J);l.e.CreateLathe=(h,V,i,S,l,Y,g)=>G(h,{shape:V,radius:i,tessellation:S,sideOrientation:g,updatable:Y},l);var w=i(12396),N=i(12335);function r(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=V.path;let g=V.instance,q=1;void 0!==V.radius?q=V.radius:g&&(q=g._creationDataStorage.radius);const B=V.tessellation||64,I=V.radiusFunction||null;let v=V.cap||l.e.NO_CAP;const s=V.invertUV||!1,t=V.updatable,T=l.e._GetDefaultSideOrientation(V.sideOrientation);V.arc=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1;const e=(h,V,i,Y,g,q,B,J)=>{const I=V.getTangents(),v=V.getNormals(),s=V.getDistances(),t=2*Math.PI/g*J,T=q||(()=>Y);let e,n,c,f;const P=S.TmpVectors.Matrix[0];let L=B===l.e.NO_CAP||B===l.e.CAP_END?0:2;for(let l=0;l<h.length;l++){n=T(l,s[l]),e=Array(),c=v[l];for(let V=0;V<g;V++)S.Matrix.RotationAxisToRef(I[l],t*V,P),f=e[V]?e[V]:S.nV.Zero(),S.nV.TransformCoordinatesToRef(c,P,f),f.scaleInPlace(n).addInPlace(h[l]),e[V]=f;i[L]=e,L++}const U=(V,i)=>{const S=Array();for(let l=0;l<V;l++)S.push(h[i]);return S};switch(B){case l.e.NO_CAP:break;case l.e.CAP_START:i[0]=U(g,0),i[1]=i[2].slice(0);break;case l.e.CAP_END:i[L]=i[L-1].slice(0),i[L+1]=U(g,h.length-1);break;case l.e.CAP_ALL:i[0]=U(g,0),i[1]=i[2].slice(0),i[L]=i[L-1].slice(0),i[L+1]=U(g,h.length-1)}return i};let n,c;if(g){const h=g._creationDataStorage,i=V.arc||h.arc;return n=h.path3D.update(Y),c=e(Y,n,h.pathArray,q,h.tessellation,I,h.cap,i),g=J("",{pathArray:c,instance:g}),h.path3D=n,h.pathArray=c,h.arc=i,h.radius=q,g}n=new E.k(Y);v=v<0||v>3?0:v,c=e(Y,n,new Array,q,B,I,v,V.arc);const f=J(h,{pathArray:c,closePath:!0,closeArray:!1,updatable:t,sideOrientation:T,invertUV:s,frontUVs:V.frontUVs,backUVs:V.backUVs},i);return f._creationDataStorage.pathArray=c,f._creationDataStorage.path3D=n,f._creationDataStorage.tessellation=B,f._creationDataStorage.cap=v,f._creationDataStorage.arc=V.arc,f._creationDataStorage.radius=q,f}function k(h){const V=[];V[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},V[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},V[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},V[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},V[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},V[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},V[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},V[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},V[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},V[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},V[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},V[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},V[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},V[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},V[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const i=h.type&&(h.type<0||h.type>=V.length)?0:h.type||0,l=h.size,Y=h.sizeX||l||1,B=h.sizeY||l||1,J=h.sizeZ||l||1,I=h.custom||V[i],v=I.face.length,t=h.faceUV||new Array(v),T=h.faceColors,e=void 0===h.flat||h.flat,n=0===h.sideOrientation?0:h.sideOrientation||g.d.DEFAULTSIDE,c=[],f=[],P=[],L=[],U=[];let X=0,D=0;const O=[];let o,M,F,E,H,j,m=0,G=0;if(e)for(G=0;G<v;G++)T&&void 0===T[G]&&(T[G]=new s.vq(1,1,1,1)),t&&void 0===t[G]&&(t[G]=new S.Vector4(0,0,1,1));if(e)for(G=0;G<v;G++){const h=I.face[G].length;for(F=2*Math.PI/h,E=.5*Math.tan(F/2),H=.5,m=0;m<h;m++)c.push(I.vertex[I.face[G][m]][0]*Y,I.vertex[I.face[G][m]][1]*B,I.vertex[I.face[G][m]][2]*J),O.push(X),X++,o=t[G].x+(t[G].z-t[G].x)*(.5+E),M=t[G].y+(t[G].w-t[G].y)*(H-.5),L.push(o,q.c?1-M:M),j=E*Math.cos(F)-H*Math.sin(F),H=E*Math.sin(F)+H*Math.cos(F),E=j,T&&U.push(T[G].r,T[G].g,T[G].b,T[G].a);for(m=0;m<h-2;m++)f.push(O[0+D],O[m+2+D],O[m+1+D]);D+=h}else{for(m=0;m<I.vertex.length;m++)c.push(I.vertex[m][0]*Y,I.vertex[m][1]*B,I.vertex[m][2]*J),L.push(0,q.c?1:0);for(G=0;G<v;G++)for(m=0;m<I.face[G].length-2;m++)f.push(I.face[G][0],I.face[G][m+2],I.face[G][m+1])}g.d.ComputeNormals(c,f,P),g.d._ComputeSides(n,c,f,P,L,h.frontUVs,h.backUVs);const w=new g.d;return w.Eh=c,w.indices=f,w.Hh=P,w.mh=L,T&&e&&(w.jh=U),w}function R(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new l.e(h,i);V.sideOrientation=l.e._GetDefaultSideOrientation(V.sideOrientation),S._originalBuilderSideOrientation=V.sideOrientation;return k(V).wh(S,V.updatable),S}l.e.CreateTube=(h,V,i,S,l,Y,g,q,B,J)=>r(h,{path:V,radius:i,tessellation:S,radiusFunction:l,arc:1,cap:Y,updatable:q,sideOrientation:B,instance:J},g);function Z(h){const V=h.sideOrientation||g.d.DEFAULTSIDE,i=h.radius||1,l=void 0===h.flat||h.flat,Y=0|(h.subdivisions||4),B=h.radiusX||i,J=h.radiusY||i,I=h.radiusZ||i,v=(1+Math.sqrt(5))/2,s=[-1,v,-0,1,v,0,-1,-v,0,1,-v,0,0,-1,-v,0,1,-v,0,-1,v,0,1,v,v,0,1,v,0,-1,-v,0,1,-v,0,-1],t=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],T=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],e=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],n=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],c=[],f=[],P=[],L=[];let U=0;const X=new Array(3),D=new Array(3);let O;for(O=0;O<3;O++)X[O]=S.nV.Zero(),D[O]=S.Vector2.Zero();for(let g=0;g<20;g++){for(O=0;O<3;O++){const h=t[3*g+O];X[O].qq(s[3*T[h]],s[3*T[h]+1],s[3*T[h]+2]),X[O].normalize(),D[O].qq(.134765625*e[2*h]+.05859375+-.0390625*n[g],.2333984375*e[2*h+1]+.025390625+.01953125*n[g])}const h=(h,V,i,g)=>{const v=S.nV.Lerp(X[0],X[2],V/Y),s=S.nV.Lerp(X[1],X[2],V/Y),t=Y===V?X[2]:S.nV.Lerp(v,s,h/(Y-V));let T;if(t.normalize(),l){const h=S.nV.Lerp(X[0],X[2],g/Y),V=S.nV.Lerp(X[1],X[2],g/Y);T=S.nV.Lerp(h,V,i/(Y-g))}else T=new S.nV(t.x,t.y,t.z);T.x/=B,T.y/=J,T.z/=I,T.normalize();const e=S.Vector2.Lerp(D[0],D[2],V/Y),n=S.Vector2.Lerp(D[1],D[2],V/Y),O=Y===V?D[2]:S.Vector2.Lerp(e,n,h/(Y-V));f.push(t.x*B,t.y*J,t.z*I),P.push(T.x,T.y,T.z),L.push(O.x,q.c?1-O.y:O.y),c.push(U),U++};for(let V=0;V<Y;V++)for(let i=0;i+V<Y;i++)h(i,V,i+1/3,V+1/3),h(i+1,V,i+1/3,V+1/3),h(i,V+1,i+1/3,V+1/3),i+V+1<Y&&(h(i+1,V,i+2/3,V+2/3),h(i+1,V+1,i+2/3,V+2/3),h(i,V+1,i+2/3,V+2/3))}g.d._ComputeSides(V,f,c,P,L,h.frontUVs,h.backUVs);const o=new g.d;return o.indices=c,o.Eh=f,o.Hh=P,o.mh=L,o}function z(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new l.e(h,i);V.sideOrientation=l.e._GetDefaultSideOrientation(V.sideOrientation),S._originalBuilderSideOrientation=V.sideOrientation;return Z(V).wh(S,V.updatable),S}g.d.CreatePolyhedron=k,l.e.CreatePolyhedron=(h,V,i)=>R(h,V,i);g.d.CreateIcoSphere=Z,l.e.CreateIcoSphere=(h,V,i)=>z(h,V,i);var d=i(11162);const x=new S.nV(1,0,0),y=new S.nV(-1,0,0),Q=new S.nV(0,1,0),A=new S.nV(0,-1,0),b=new S.nV(0,0,1),C=new S.nV(0,0,-1);class u{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.nV.Zero(),V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.nV.Up(),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.Vector2.Zero(),l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=h,this.normal=V,this.uv=i,this.vertexIdx=l,this.vertexIdxForBones=Y,this.localPositionOverride=g,this.localNormalOverride=q,this.matrixIndicesOverride=B,this.matrixWeightsOverride=J}clone(){var h,V,i,S;return new u(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(h=this.localPositionOverride)||void 0===h?void 0:h.slice(),null===(V=this.localNormalOverride)||void 0===V?void 0:V.slice(),null===(i=this.matrixIndicesOverride)||void 0===i?void 0:i.slice(),null===(S=this.matrixWeightsOverride)||void 0===S?void 0:S.slice())}}function p(h,V,i){var B,J,I,v,s;const t=!!V.skeleton,T=!(null===(B=V.morphTargetManager)||void 0===B||!B.numTargets),e=i.localMode||t,n=V.ug(),c=t||T?V.Oq(!0,!0):V.getVerticesData(Y.h.PositionKind),f=t||T?V.getNormalsData(!0,!0):V.getVerticesData(Y.h.NormalKind),P=e?t?V.getVerticesData(Y.h.PositionKind):c:null,L=e?t?V.getVerticesData(Y.h.NormalKind):f:null,U=V.getVerticesData(Y.h.UVKind),X=t?V.getVerticesData(Y.h.MatricesIndicesKind):null,D=t?V.getVerticesData(Y.h.MatricesWeightsKind):null,O=t?V.getVerticesData(Y.h.MatricesIndicesExtraKind):null,o=t?V.getVerticesData(Y.h.MatricesWeightsExtraKind):null,M=i.position||S.nV.Zero();let F=i.normal||S.nV.Up();const E=i.size||S.nV.One(),H=i.angle||0;if(!F){const h=new S.nV(0,0,1),i=V.Mh().activeCamera,l=S.nV.TransformCoordinates(h,i.getWorldMatrix());F=i.globalPosition.cV(l)}const j=-Math.atan2(F.z,F.x)-Math.PI/2,m=Math.sqrt(F.x*F.x+F.z*F.z),G=Math.atan2(F.y,m),w=new g.d;w.indices=[],w.Eh=[],w.Hh=[],w.mh=[],w.matricesIndices=t?[]:null,w.matricesWeights=t?[]:null,w.matricesIndicesExtra=O?[]:null,w.matricesWeightsExtra=o?[]:null;let N=0;const r=(h,V)=>{const l=new u;if(!n||!c||!f)return l;const Y=n[h];if(l.vertexIdx=3*Y,l.vertexIdxForBones=4*Y,l.position=new S.nV(c[3*Y],c[3*Y+1],c[3*Y+2]),S.nV.TransformCoordinatesToRef(l.position,V,l.position),l.normal=new S.nV(f[3*Y],f[3*Y+1],f[3*Y+2]),S.nV.TransformNormalToRef(l.normal,V,l.normal),i.captureUVS&&U){const h=U[2*Y+1];l.uv=new S.Vector2(U[2*Y],q.c?1-h:h)}return l},k=[0,0,0,0],R=(h,V)=>{if(0===h.length)return h;const i=.5*Math.abs(S.nV.Dot(E,V)),l=(h,V,i,S)=>{for(let l=0;l<S;++l)if(h[i+l]===V)return i+l;return-1},Y=(h,Y)=>{const g=S.nV.GetClipFactor(h.position,Y.position,V,i);let q=k,B=k;if(X&&D){const V=h.matrixIndicesOverride?0:h.vertexIdxForBones,i=h.matrixIndicesOverride??X,S=h.matrixWeightsOverride??D,J=Y.matrixIndicesOverride?0:Y.vertexIdxForBones,I=Y.matrixIndicesOverride??X,v=Y.matrixWeightsOverride??D;q=[0,0,0,0],B=[0,0,0,0];let s=0;for(let h=0;h<4;++h)if(S[V+h]>0){const Y=l(I,i[V+h],J,4);q[s]=i[V+h],B[s]=(0,d.Lerp)(S[V+h],Y>=0?v[Y]:0,g),s++}for(let h=0;h<4&&s<4;++h){const S=I[J+h];-1===l(i,S,V,4)&&(q[s]=S,B[s]=(0,d.Lerp)(0,v[J+h],g),s++)}const t=B[0]+B[1]+B[2]+B[3];B[0]/=t,B[1]/=t,B[2]/=t,B[3]/=t}const J=h.localPositionOverride?h.localPositionOverride[0]:(null===P||void 0===P?void 0:P[h.vertexIdx])??0,I=h.localPositionOverride?h.localPositionOverride[1]:(null===P||void 0===P?void 0:P[h.vertexIdx+1])??0,v=h.localPositionOverride?h.localPositionOverride[2]:(null===P||void 0===P?void 0:P[h.vertexIdx+2])??0,s=Y.localPositionOverride?Y.localPositionOverride[0]:(null===P||void 0===P?void 0:P[Y.vertexIdx])??0,t=Y.localPositionOverride?Y.localPositionOverride[1]:(null===P||void 0===P?void 0:P[Y.vertexIdx+1])??0,T=Y.localPositionOverride?Y.localPositionOverride[2]:(null===P||void 0===P?void 0:P[Y.vertexIdx+2])??0,e=h.localNormalOverride?h.localNormalOverride[0]:(null===L||void 0===L?void 0:L[h.vertexIdx])??0,n=h.localNormalOverride?h.localNormalOverride[1]:(null===L||void 0===L?void 0:L[h.vertexIdx+1])??0,c=h.localNormalOverride?h.localNormalOverride[2]:(null===L||void 0===L?void 0:L[h.vertexIdx+2])??0,f=e+((Y.localNormalOverride?Y.localNormalOverride[0]:(null===L||void 0===L?void 0:L[Y.vertexIdx])??0)-e)*g,U=n+((Y.localNormalOverride?Y.localNormalOverride[1]:(null===L||void 0===L?void 0:L[Y.vertexIdx+1])??0)-n)*g,O=c+((Y.localNormalOverride?Y.localNormalOverride[2]:(null===L||void 0===L?void 0:L[Y.vertexIdx+2])??0)-c)*g,o=Math.sqrt(f*f+U*U+O*O);return new u(S.nV.Lerp(h.position,Y.position,g),S.nV.Lerp(h.normal,Y.normal,g).normalize(),S.Vector2.Lerp(h.uv,Y.uv,g),-1,-1,P?[J+(s-J)*g,I+(t-I)*g,v+(T-v)*g]:null,L?[f/o,U/o,O/o]:null,q,B)};let g=null;h.length>3&&(g=[]);for(let q=0;q<h.length;q+=3){let l=0,B=null,J=null,I=null,v=null;const s=S.nV.Dot(h[q].position,V)-i>0,t=S.nV.Dot(h[q+1].position,V)-i>0,T=S.nV.Dot(h[q+2].position,V)-i>0;switch(l=(s?1:0)+(t?1:0)+(T?1:0),l){case 0:h.length>3?(g.push(h[q]),g.push(h[q+1]),g.push(h[q+2])):g=h;break;case 1:if(g=g??new Array,s&&(B=h[q+1],J=h[q+2],I=Y(h[q],B),v=Y(h[q],J)),t){B=h[q],J=h[q+2],I=Y(h[q+1],B),v=Y(h[q+1],J),g.push(I),g.push(J.clone()),g.push(B.clone()),g.push(J.clone()),g.push(I.clone()),g.push(v);break}T&&(B=h[q],J=h[q+1],I=Y(h[q+2],B),v=Y(h[q+2],J)),B&&J&&I&&v&&(g.push(B.clone()),g.push(J.clone()),g.push(I),g.push(v),g.push(I.clone()),g.push(J.clone()));break;case 2:g=g??new Array,s||(B=h[q].clone(),J=Y(B,h[q+1]),I=Y(B,h[q+2]),g.push(B),g.push(J),g.push(I)),t||(B=h[q+1].clone(),J=Y(B,h[q+2]),I=Y(B,h[q]),g.push(B),g.push(J),g.push(I)),T||(B=h[q+2].clone(),J=Y(B,h[q]),I=Y(B,h[q+1]),g.push(B),g.push(J),g.push(I))}}return g},Z=V instanceof l.e?V:null,z=null===Z||void 0===Z?void 0:Z._thinInstanceDataStorage.matrixData,p=(null===Z||void 0===Z?void 0:Z.tq)||1,W=S.TmpVectors.Matrix[0];W.l(S.Matrix.IdentityReadOnly);for(let l=0;l<p;++l){if(null!==Z&&void 0!==Z&&Z.hasThinInstances&&z){const h=16*l;W.setRowFromFloats(0,z[h+0],z[h+1],z[h+2],z[h+3]),W.setRowFromFloats(1,z[h+4],z[h+5],z[h+6],z[h+7]),W.setRowFromFloats(2,z[h+8],z[h+9],z[h+10],z[h+11]),W.setRowFromFloats(3,z[h+12],z[h+13],z[h+14],z[h+15])}const h=S.Matrix.RotationYawPitchRoll(j,G,H).multiply(S.Matrix.Translation(M.x,M.y,M.z)),Y=S.Matrix.Invert(h),g=V.getWorldMatrix(),B=W.multiply(g).multiply(Y),J=new Array(3);for(let V=0;V<n.length;V+=3){let h=J;if(h[0]=r(V,B),h[1]=r(V+1,B),h[2]=r(V+2,B),!(i.cullBackFaces&&-h[0].normal.z<=0&&-h[1].normal.z<=0&&-h[2].normal.z<=0)&&(h=R(h,x),h&&(h=R(h,y),h&&(h=R(h,Q),h&&(h=R(h,A),h&&(h=R(h,b),h&&(h=R(h,C),h)))))))for(let V=0;V<h.length;V++){const S=h[V];if(w.indices.push(N),e?(S.localPositionOverride?(w.Eh[3*N]=S.localPositionOverride[0],w.Eh[3*N+1]=S.localPositionOverride[1],w.Eh[3*N+2]=S.localPositionOverride[2]):P&&(w.Eh[3*N]=P[S.vertexIdx],w.Eh[3*N+1]=P[S.vertexIdx+1],w.Eh[3*N+2]=P[S.vertexIdx+2]),S.localNormalOverride?(w.Hh[3*N]=S.localNormalOverride[0],w.Hh[3*N+1]=S.localNormalOverride[1],w.Hh[3*N+2]=S.localNormalOverride[2]):L&&(w.Hh[3*N]=L[S.vertexIdx],w.Hh[3*N+1]=L[S.vertexIdx+1],w.Hh[3*N+2]=L[S.vertexIdx+2])):(S.position.toArray(w.Eh,3*N),S.normal.toArray(w.Hh,3*N)),w.matricesIndices&&w.matricesWeights&&(S.matrixIndicesOverride?(w.matricesIndices[4*N]=S.matrixIndicesOverride[0],w.matricesIndices[4*N+1]=S.matrixIndicesOverride[1],w.matricesIndices[4*N+2]=S.matrixIndicesOverride[2],w.matricesIndices[4*N+3]=S.matrixIndicesOverride[3]):(X&&(w.matricesIndices[4*N]=X[S.vertexIdxForBones],w.matricesIndices[4*N+1]=X[S.vertexIdxForBones+1],w.matricesIndices[4*N+2]=X[S.vertexIdxForBones+2],w.matricesIndices[4*N+3]=X[S.vertexIdxForBones+3]),O&&w.matricesIndicesExtra&&(w.matricesIndicesExtra[4*N]=O[S.vertexIdxForBones],w.matricesIndicesExtra[4*N+1]=O[S.vertexIdxForBones+1],w.matricesIndicesExtra[4*N+2]=O[S.vertexIdxForBones+2],w.matricesIndicesExtra[4*N+3]=O[S.vertexIdxForBones+3])),S.matrixWeightsOverride?(w.matricesWeights[4*N]=S.matrixWeightsOverride[0],w.matricesWeights[4*N+1]=S.matrixWeightsOverride[1],w.matricesWeights[4*N+2]=S.matrixWeightsOverride[2],w.matricesWeights[4*N+3]=S.matrixWeightsOverride[3]):(D&&(w.matricesWeights[4*N]=D[S.vertexIdxForBones],w.matricesWeights[4*N+1]=D[S.vertexIdxForBones+1],w.matricesWeights[4*N+2]=D[S.vertexIdxForBones+2],w.matricesWeights[4*N+3]=D[S.vertexIdxForBones+3]),o&&w.matricesWeightsExtra&&(w.matricesWeightsExtra[4*N]=o[S.vertexIdxForBones],w.matricesWeightsExtra[4*N+1]=o[S.vertexIdxForBones+1],w.matricesWeightsExtra[4*N+2]=o[S.vertexIdxForBones+2],w.matricesWeightsExtra[4*N+3]=o[S.vertexIdxForBones+3]))),i.captureUVS)S.uv.toArray(w.mh,2*N);else{w.mh.push(.5+S.position.x/E.x);const h=.5+S.position.y/E.y;w.mh.push(q.c?1-h:h)}N++}}}0===w.indices.length&&(w.indices=null),0===w.Eh.length&&(w.Eh=null),0===w.Hh.length&&(w.Hh=null),0===w.mh.length&&(w.mh=null),0===(null===(J=w.matricesIndices)||void 0===J?void 0:J.length)&&(w.matricesIndices=null),0===(null===(I=w.matricesWeights)||void 0===I?void 0:I.length)&&(w.matricesWeights=null),0===(null===(v=w.matricesIndicesExtra)||void 0===v?void 0:v.length)&&(w.matricesIndicesExtra=null),0===(null===(s=w.matricesWeightsExtra)||void 0===s?void 0:s.length)&&(w.matricesWeightsExtra=null);const a=new l.e(h,V.Mh());return w.wh(a),e?(a.skeleton=V.skeleton,a.parent=V):(a.position=M.clone(),a.rotation=new S.nV(G,j,H)),a.Ag(!0),a.refreshBoundingInfo(!0,!0),a}function W(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const V=0|Math.max(h.subdivisions?h.subdivisions:2,1),i=0|Math.max(h.tessellation?h.tessellation:16,3),l=Math.max(h.height?h.height:1,0),Y=Math.max(h.radius?h.radius:.25,0),B=0|Math.max(h.capSubdivisions?h.capSubdivisions:6,1),J=i,I=V,v=Math.max(h.radiusTop?h.radiusTop:Y,0),s=Math.max(h.radiusBottom?h.radiusBottom:Y,0),t=l-(v+s),T=2*Math.PI,e=Math.max(h.topCapSubdivisions?h.topCapSubdivisions:B,1),n=Math.max(h.bottomCapSubdivisions?h.bottomCapSubdivisions:B,1),c=Math.acos((s-v)/l);let f=[];const P=[],L=[],U=[];let X=0;const D=[],O=.5*t,o=.5*Math.PI;let M,F;const E=S.nV.Zero(),H=S.nV.Zero(),j=Math.cos(c),m=Math.sin(c),G=new S.Vector2(v*m,O+v*j).cV(new S.Vector2(s*m,s*j-O)).length(),w=v*c+G+s*(o-c);let N=0;for(F=0;F<=e;F++){const h=[],V=o-c*(F/e);N+=v*c/e;const i=Math.cos(V),S=Math.sin(V),l=i*v;for(M=0;M<=J;M++){const V=M/J,Y=V*T+0,g=Math.sin(Y),B=Math.cos(Y);H.x=l*g,H.y=O+S*v,H.z=l*B,P.push(H.x,H.y,H.z),E.set(i*g,S,i*B),L.push(E.x,E.y,E.z),U.push(V,q.c?N/w:1-N/w),h.push(X),X++}D.push(h)}const r=l-v-s+j*v-j*s,k=m*(s-v)/r;for(F=1;F<=I;F++){const h=[];N+=G/I;const V=m*(F*(s-v)/I+v);for(M=0;M<=J;M++){const i=M/J,S=i*T+0,l=Math.sin(S),Y=Math.cos(S);H.x=V*l,H.y=O+j*v-F*r/I,H.z=V*Y,P.push(H.x,H.y,H.z),E.set(l,k,Y).normalize(),L.push(E.x,E.y,E.z),U.push(i,q.c?N/w:1-N/w),h.push(X),X++}D.push(h)}for(F=1;F<=n;F++){const h=[],V=o-c-(Math.PI-c)*(F/n);N+=s*c/n;const i=Math.cos(V),S=Math.sin(V),l=i*s;for(M=0;M<=J;M++){const V=M/J,Y=V*T+0,g=Math.sin(Y),B=Math.cos(Y);H.x=l*g,H.y=S*s-O,H.z=l*B,P.push(H.x,H.y,H.z),E.set(i*g,S,i*B),L.push(E.x,E.y,E.z),U.push(V,q.c?N/w:1-N/w),h.push(X),X++}D.push(h)}for(M=0;M<J;M++)for(F=0;F<e+I+n;F++){const h=D[F][M],V=D[F+1][M],i=D[F+1][M+1],S=D[F][M+1];f.push(h),f.push(V),f.push(S),f.push(V),f.push(i),f.push(S)}if(f=f.reverse(),h.orientation&&!h.orientation.equals(S.nV.Up())){const V=new S.Matrix;h.orientation.clone().scale(.5*Math.PI).cross(S.nV.Up()).toQuaternion().toRotationMatrix(V);const i=S.nV.Zero();for(let h=0;h<P.length;h+=3)i.set(P[h],P[h+1],P[h+2]),S.nV.TransformCoordinatesToRef(i.clone(),V,i),P[h]=i.x,P[h+1]=i.y,P[h+2]=i.z}const R=new g.d;return R.Eh=P,R.Hh=L,R.mh=U,R.indices=f,R}function a(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:S.nV.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=new l.e(h,i);return W(V).wh(Y,V.updatable),Y}l.e.CreateDecal=(h,V,i,S,l,Y)=>p(h,V,{position:i,normal:S,size:l,angle:Y});l.e.CreateCapsule=(h,V,i)=>a(h,V,i),g.d.CreateCapsule=W;var K=i(10967),hh=i(11147);class Vh{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=h,this.y=V,h!==Math.floor(h)&&(h=Math.floor(h),K.d.Warn("x is not an integer, floor(x) used")),V!==Math.floor(V)&&(V=Math.floor(V),K.d.Warn("y is not an integer, floor(y) used"))}clone(){return new Vh(this.x,this.y)}rotate60About(h){const V=this.x;return this.x=h.x+h.y-this.y,this.y=V+this.y-h.x,this}rotateNeg60About(h){const V=this.x;return this.x=V+this.y-h.y,this.y=h.x+h.y-V,this}rotate120(h,V){h!==Math.floor(h)&&(h=Math.floor(h),K.d.Warn("m not an integer only floor(m) used")),V!==Math.floor(V)&&(V=Math.floor(V),K.d.Warn("n not an integer only floor(n) used"));const i=this.x;return this.x=h-i-this.y,this.y=V+i,this}rotateNeg120(h,V){h!==Math.floor(h)&&(h=Math.floor(h),K.d.Warn("m is not an integer, floor(m) used")),V!==Math.floor(V)&&(V=Math.floor(V),K.d.Warn("n is not an integer,   floor(n) used"));const i=this.x;return this.x=this.y-V,this.y=h+V-i-this.y,this}toCartesianOrigin(h,V){const i=S.nV.Zero();return i.x=h.x+2*this.x*V+this.y*V,i.y=h.y+Math.sqrt(3)*this.y*V,i}static Zero(){return new Vh(0,0)}}class ih{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Sh("icosahedron","Regular",[[0,hh.d,-1],[-hh.d,1,0],[-1,0,-hh.d],[1,0,-hh.d],[hh.d,1,0],[0,hh.d,1],[-1,0,hh.d],[-hh.d,-1,0],[0,-hh.d,-1],[hh.d,-1,0],[1,0,hh.d],[0,-hh.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let h=12;const V={},i=this.m,S=this.n;let l,Y,g,q,B,J=i,I=1,v=0;0!==S&&(J=(0,d.HighestCommonFactor)(i,S)),I=i/J,v=S/J;const s=Vh.Zero(),t=new Vh(i,S),T=new Vh(-S,i+S),e=Vh.Zero(),n=Vh.Zero(),c=Vh.Zero();let f,P,L,U,X=[];const D=[],O=this.vertByDist,o=(i,S,l,Y)=>{f=i+"|"+l,P=S+"|"+Y,f in V||P in V?f in V&&!(P in V)?V[P]=V[f]:P in V&&!(f in V)&&(V[f]=V[P]):(V[f]=h,V[P]=h,h++),O[l][0]>2?D[V[f]]=[-O[l][0],O[l][1],V[f]]:D[V[f]]=[X[O[l][0]],O[l][1],V[f]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let M=0;M<20;M++){if(X=this.IDATA.face[M],g=X[2],q=X[1],B=X[0],L=s.x+"|"+s.y,f=M+"|"+L,f in V||(V[f]=g,D[g]=[X[O[L][0]],O[L][1]]),L=t.x+"|"+t.y,f=M+"|"+L,f in V||(V[f]=q,D[q]=[X[O[L][0]],O[L][1]]),L=T.x+"|"+T.y,f=M+"|"+L,f in V||(V[f]=B,D[B]=[X[O[L][0]],O[L][1]]),l=this.IDATA.edgematch[M][0],Y=this.IDATA.edgematch[M][1],"B"===Y)for(let h=1;h<J;h++)n.x=i-h*(I+v),n.y=S+h*I,c.x=-h*v,c.y=h*(I+v),L=n.x+"|"+n.y,U=c.x+"|"+c.y,o(M,l,L,U);if("O"===Y)for(let h=1;h<J;h++)c.x=-h*v,c.y=h*(I+v),e.x=h*I,e.y=h*v,L=c.x+"|"+c.y,U=e.x+"|"+e.y,o(M,l,L,U);if(l=this.IDATA.edgematch[M][2],Y=this.IDATA.edgematch[M][3],Y&&"A"===Y)for(let h=1;h<J;h++)e.x=h*I,e.y=h*v,n.x=i-(J-h)*(I+v),n.y=S+(J-h)*I,L=e.x+"|"+e.y,U=n.x+"|"+n.y,o(M,l,L,U);for(let i=0;i<this.vertices.length;i++)L=this.vertices[i].x+"|"+this.vertices[i].y,f=M+"|"+L,f in V||(V[f]=h++,O[L][0]>2?D[V[f]]=[-O[L][0],O[L][1],V[f]]:D[V[f]]=[X[O[L][0]],O[L][1],V[f]])}this.closestTo=D,this.vecToidx=V}calcCoeffs(){const h=this.m,V=this.n,i=Math.sqrt(3)/3,S=h*h+V*V+h*V;this.coau=(h+V)/S,this.cobu=-V/S,this.coav=-i*(h-V)/S,this.cobv=i*(2*h+V)/S}createInnerFacets(){const h=this.m,V=this.n;for(let i=0;i<V+h+1;i++)for(let h=this.min[i];h<this.max[i]+1;h++)h<this.max[i]&&h<this.max[i+1]+1&&this.innerFacets.push(["|"+h+"|"+i,"|"+h+"|"+(i+1),"|"+(h+1)+"|"+i]),i>0&&h<this.max[i-1]&&h+1<this.max[i]+1&&this.innerFacets.push(["|"+h+"|"+i,"|"+(h+1)+"|"+i,"|"+(h+1)+"|"+(i-1)])}edgeVecsABOB(){const h=this.m,V=this.n,i=new Vh(-V,h+V);for(let S=1;S<h+V;S++){const h=new Vh(this.min[S],S),V=new Vh(this.min[S-1],S-1),l=new Vh(this.min[S+1],S+1),Y=h.clone(),g=V.clone(),q=l.clone();Y.rotate60About(i),g.rotate60About(i),q.rotate60About(i);const B=new Vh(this.max[Y.y],Y.y),J=new Vh(this.max[Y.y-1],Y.y-1),I=new Vh(this.max[Y.y-1]-1,Y.y-1);Y.x===B.x&&Y.y===B.y||(Y.x!==J.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([h,J,I]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([h,I,B])):Y.y===q.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([h,V,J]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([h,J,l])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([h,V,J]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([h,J,B])))}}mapABOBtoOBOA(){const h=new Vh(0,0);for(let V=0;V<this.isoVecsABOB.length;V++){const i=[];for(let S=0;S<3;S++)h.x=this.isoVecsABOB[V][S].x,h.y=this.isoVecsABOB[V][S].y,0===this.vertexTypes[V][S]&&h.rotateNeg120(this.m,this.n),i.push(h.clone());this.isoVecsOBOA.push(i)}}mapABOBtoBAOA(){const h=new Vh(0,0);for(let V=0;V<this.isoVecsABOB.length;V++){const i=[];for(let S=0;S<3;S++)h.x=this.isoVecsABOB[V][S].x,h.y=this.isoVecsABOB[V][S].y,1===this.vertexTypes[V][S]&&h.rotate120(this.m,this.n),i.push(h.clone());this.isoVecsBAOA.push(i)}}MapToFace(h,V){const i=this.IDATA.face[h],l=i[2],Y=i[1],g=i[0],q=S.nV.UV(this.IDATA.vertex[l]),B=S.nV.UV(this.IDATA.vertex[Y]),J=S.nV.UV(this.IDATA.vertex[g]),I=B.cV(q),v=J.cV(q),s=I.scale(this.coau).add(v.scale(this.cobu)),t=I.scale(this.coav).add(v.scale(this.cobv)),T=[];let e,n=S.TmpVectors.nV[0];for(let S=0;S<this.cartesian.length;S++)n=s.scale(this.cartesian[S].x).add(t.scale(this.cartesian[S].y)).add(q),T[S]=[n.x,n.y,n.z],e=h+"|"+this.vertices[S].x+"|"+this.vertices[S].y,V.vertex[this.vecToidx[e]]=[n.x,n.y,n.z]}build(h,V){const i=[],S=Vh.Zero(),l=new Vh(h,V),Y=new Vh(-V,h+V);i.push(S,l,Y);for(let L=V;L<h+1;L++)for(let V=0;V<h+1-L;V++)i.push(new Vh(V,L));if(V>0){const S=(0,d.HighestCommonFactor)(h,V),l=h/S,Y=V/S;for(let q=1;q<S;q++)i.push(new Vh(q*l,q*Y)),i.push(new Vh(-q*Y,q*(l+Y))),i.push(new Vh(h-q*(l+Y),V+q*l));const g=h/V;for(let q=1;q<V;q++)for(let S=0;S<q*g;S++)i.push(new Vh(S,q)),i.push(new Vh(S,q).rotate120(h,V)),i.push(new Vh(S,q).rotateNeg120(h,V))}i.sort(((h,V)=>h.x-V.x)),i.sort(((h,V)=>h.y-V.y));const g=new Array(h+V+1),q=new Array(h+V+1);for(let L=0;L<g.length;L++)g[L]=1/0,q[L]=-1/0;let B=0,J=0;const I=i.length;for(let L=0;L<I;L++)J=i[L].x,B=i[L].y,g[B]=Math.min(J,g[B]),q[B]=Math.max(J,q[B]);const v=(i,S)=>{const l=i.clone();return"A"===S&&l.rotateNeg120(h,V),"B"===S&&l.rotate120(h,V),l.x<0?l.y:l.x+l.y},s=[],t=[],T=[],e=[],n={},c=[];let f=-1,P=-1;for(let L=0;L<I;L++)s[L]=i[L].toCartesianOrigin(new Vh(0,0),.5),t[L]=v(i[L],"O"),T[L]=v(i[L],"A"),e[L]=v(i[L],"B"),t[L]===T[L]&&T[L]===e[L]?(f=3,P=t[L]):t[L]===T[L]?(f=4,P=t[L]):T[L]===e[L]?(f=5,P=T[L]):e[L]===t[L]&&(f=6,P=t[L]),t[L]<T[L]&&t[L]<e[L]&&(f=2,P=t[L]),T[L]<t[L]&&T[L]<e[L]&&(f=1,P=T[L]),e[L]<T[L]&&e[L]<t[L]&&(f=0,P=e[L]),c.push([f,P,i[L].x,i[L].y]);c.sort(((h,V)=>h[2]-V[2])),c.sort(((h,V)=>h[3]-V[3])),c.sort(((h,V)=>h[1]-V[1])),c.sort(((h,V)=>h[0]-V[0]));for(let L=0;L<c.length;L++)n[c[L][2]+"|"+c[L][3]]=[c[L][0],c[L][1],L];return this.m=h,this.n=V,this.vertices=i,this.vertByDist=n,this.cartesian=s,this.min=g,this.max=q,this}}class Sh{constructor(h,V,i,S){this.name=h,this.category=V,this.vertex=i,this.face=S}}class lh extends Sh{innerToData(h,V){for(let i=0;i<V.innerFacets.length;i++)this.face.push(V.innerFacets[i].map((i=>V.vecToidx[h+i])))}mapABOBtoDATA(h,V){const i=V.IDATA.edgematch[h][0];for(let S=0;S<V.isoVecsABOB.length;S++){const l=[];for(let Y=0;Y<3;Y++)0===V.vertexTypes[S][Y]?l.push(h+"|"+V.isoVecsABOB[S][Y].x+"|"+V.isoVecsABOB[S][Y].y):l.push(i+"|"+V.isoVecsABOB[S][Y].x+"|"+V.isoVecsABOB[S][Y].y);this.face.push([V.vecToidx[l[0]],V.vecToidx[l[1]],V.vecToidx[l[2]]])}}mapOBOAtoDATA(h,V){const i=V.IDATA.edgematch[h][0];for(let S=0;S<V.isoVecsOBOA.length;S++){const l=[];for(let Y=0;Y<3;Y++)1===V.vertexTypes[S][Y]?l.push(h+"|"+V.isoVecsOBOA[S][Y].x+"|"+V.isoVecsOBOA[S][Y].y):l.push(i+"|"+V.isoVecsOBOA[S][Y].x+"|"+V.isoVecsOBOA[S][Y].y);this.face.push([V.vecToidx[l[0]],V.vecToidx[l[1]],V.vecToidx[l[2]]])}}mapBAOAtoDATA(h,V){const i=V.IDATA.edgematch[h][2];for(let S=0;S<V.isoVecsBAOA.length;S++){const l=[];for(let Y=0;Y<3;Y++)1===V.vertexTypes[S][Y]?l.push(h+"|"+V.isoVecsBAOA[S][Y].x+"|"+V.isoVecsBAOA[S][Y].y):l.push(i+"|"+V.isoVecsBAOA[S][Y].x+"|"+V.isoVecsBAOA[S][Y].y);this.face.push([V.vecToidx[l[0]],V.vecToidx[l[1]],V.vecToidx[l[2]]])}}orderData(h){const V=[];for(let Y=0;Y<13;Y++)V[Y]=[];const i=h.closestTo;for(let Y=0;Y<i.length;Y++)i[Y][0]>-1?i[Y][1]>0&&V[i[Y][0]].push([Y,i[Y][1]]):V[12].push([Y,i[Y][0]]);const S=[];for(let Y=0;Y<12;Y++)S[Y]=Y;let l=12;for(let Y=0;Y<12;Y++){V[Y].sort(((h,V)=>h[1]-V[1]));for(let h=0;h<V[Y].length;h++)S[V[Y][h][0]]=l++}for(let Y=0;Y<V[12].length;Y++)S[V[12][Y][0]]=l++;for(let Y=0;Y<this.vertex.length;Y++)this.vertex[Y].push(S[Y]);this.vertex.sort(((h,V)=>h[3]-V[3]));for(let Y=0;Y<this.vertex.length;Y++)this.vertex[Y].pop();for(let Y=0;Y<this.face.length;Y++)for(let h=0;h<this.face[Y].length;h++)this.face[Y][h]=S[this.face[Y][h]];this.sharedNodes=V[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(h,V){const i=[],S=[];let l=V.pop();S.push(l);let Y=this.face[l].indexOf(h);Y=(Y+2)%3;let g=this.face[l][Y];i.push(g);let q=0;for(;V.length>0;)l=V[q],this.face[l].indexOf(g)>-1?(Y=(this.face[l].indexOf(g)+1)%3,g=this.face[l][Y],i.push(g),S.push(l),V.splice(q,1),q=0):q++;return this.adjacentFaces.push(i),S}toGoldbergPolyhedronData(){const h=new Sh("GeoDual","Goldberg",[],[]);h.name="GD dual";const V=this.vertex.length,i=new Array(V);for(let B=0;B<V;B++)i[B]=[];for(let B=0;B<this.face.length;B++)for(let h=0;h<3;h++)i[this.face[B][h]].push(B);let S=0,l=0,Y=0,g=[],q=[];this.adjacentFaces=[];for(let B=0;B<i.length;B++){h.face[B]=this.setOrder(B,i[B].concat([]));for(const V of i[B]){S=0,l=0,Y=0,g=this.face[V];for(let h=0;h<3;h++)q=this.vertex[g[h]],S+=q[0],l+=q[1],Y+=q[2];h.vertex[V]=[S/3,l/3,Y/3]}}return h}static BuildGeodesicData(h){const V=new lh("Geodesic-m-n","Geodesic",[[0,hh.d,-1],[-hh.d,1,0],[-1,0,-hh.d],[1,0,-hh.d],[hh.d,1,0],[0,hh.d,1],[-1,0,hh.d],[-hh.d,-1,0],[0,-hh.d,-1],[hh.d,-1,0],[1,0,hh.d],[0,-hh.d,1]],[]);h.setIndices(),h.calcCoeffs(),h.createInnerFacets(),h.edgeVecsABOB(),h.mapABOBtoOBOA(),h.mapABOBtoBAOA();for(let i=0;i<h.IDATA.face.length;i++)h.MapToFace(i,V),V.innerToData(i,h),"B"===h.IDATA.edgematch[i][1]&&V.mapABOBtoDATA(i,h),"O"===h.IDATA.edgematch[i][1]&&V.mapOBOAtoDATA(i,h),"A"===h.IDATA.edgematch[i][3]&&V.mapBAOAtoDATA(i,h);V.orderData(h);return V.vertex=V.vertex.map((function(h){const V=h[0],i=h[1],S=h[2],l=Math.sqrt(V*V+i*i+S*S);return h[0]*=1/l,h[1]*=1/l,h[2]*=1/l,h})),V}}l.e._GoldbergMeshParser=(h,V)=>Yh.Parse(h,V);class Yh extends l.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(h,V){return void 0===V?(h>this.goldbergData.nbUnsharedFaces-1&&(K.d.Warn("Maximum number of unshared faces used"),h=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+h):(h>11&&(K.d.Warn("Last pole used"),h=11),V>this.goldbergData.nbFacesAtPole-1&&(K.d.Warn("Maximum number of faces at a pole used"),V=this.goldbergData.nbFacesAtPole-1),12+h*this.goldbergData.nbFacesAtPole+V)}_changeGoldbergFaceColors(h){for(let i=0;i<h.length;i++){const V=h[i][0],S=h[i][1],l=h[i][2];for(let h=V;h<S+1;h++)this.goldbergData.faceColors[h]=l}const V=[];for(let i=0;i<12;i++)for(let h=0;h<5;h++)V.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);for(let i=12;i<this.goldbergData.faceColors.length;i++)for(let h=0;h<6;h++)V.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);return V}setGoldbergFaceColors(h){const V=this._changeGoldbergFaceColors(h);this.Rh(Y.h.ColorKind,V)}updateGoldbergFaceColors(h){const V=this._changeGoldbergFaceColors(h);this.updateVerticesData(Y.h.ColorKind,V)}_changeGoldbergFaceUVs(h){const V=this.getVerticesData(Y.h.UVKind);for(let i=0;i<h.length;i++){const S=h[i][0],l=h[i][1],Y=h[i][2],g=h[i][3],q=h[i][4],B=[],J=[];let I,v;for(let h=0;h<5;h++)I=Y.x+g*Math.cos(q+h*Math.PI/2.5),v=Y.y+g*Math.sin(q+h*Math.PI/2.5),I<0&&(I=0),I>1&&(I=1),B.push(I,v);for(let h=0;h<6;h++)I=Y.x+g*Math.cos(q+h*Math.PI/3),v=Y.y+g*Math.sin(q+h*Math.PI/3),I<0&&(I=0),I>1&&(I=1),J.push(I,v);for(let h=S;h<Math.min(12,l+1);h++)for(let i=0;i<5;i++)V[10*h+2*i]=B[2*i],V[10*h+2*i+1]=B[2*i+1];for(let h=Math.max(12,S);h<l+1;h++)for(let i=0;i<6;i++)V[12*h-24+2*i]=J[2*i],V[12*h-23+2*i]=J[2*i+1]}return V}setGoldbergFaceUVs(h){const V=this._changeGoldbergFaceUVs(h);this.Rh(Y.h.UVKind,V)}updateGoldbergFaceUVs(h){const V=this._changeGoldbergFaceUVs(h);this.updateVerticesData(Y.h.UVKind,V)}placeOnGoldbergFaceAt(h,V,i){const l=S.nV.RotationFromAxis(this.goldbergData.faceXaxis[V],this.goldbergData.faceYaxis[V],this.goldbergData.faceZaxis[V]);h.rotation=l,h.position=this.goldbergData.faceCenters[V].add(this.goldbergData.faceXaxis[V].scale(i.x)).add(this.goldbergData.faceYaxis[V].scale(i.y)).add(this.goldbergData.faceZaxis[V].scale(i.z))}serialize(h){super.serialize(h),h.type="GoldbergMesh";const V={};if(V.adjacentFaces=this.goldbergData.adjacentFaces,V.nbSharedFaces=this.goldbergData.nbSharedFaces,V.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,V.nbFaces=this.goldbergData.nbFaces,V.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){V.faceColors=[];for(const h of this.goldbergData.faceColors)V.faceColors.push(h.Ng())}if(this.goldbergData.faceCenters){V.faceCenters=[];for(const h of this.goldbergData.faceCenters)V.faceCenters.push(h.Ng())}if(this.goldbergData.faceZaxis){V.faceZaxis=[];for(const h of this.goldbergData.faceZaxis)V.faceZaxis.push(h.Ng())}if(this.goldbergData.faceYaxis){V.faceYaxis=[];for(const h of this.goldbergData.faceYaxis)V.faceYaxis.push(h.Ng())}if(this.goldbergData.faceXaxis){V.faceXaxis=[];for(const h of this.goldbergData.faceXaxis)V.faceXaxis.push(h.Ng())}h.goldbergData=V}static Parse(h,V){const i=h.goldbergData;i.faceColors=i.faceColors.map((h=>s.vq.UV(h))),i.faceCenters=i.faceCenters.map((h=>S.nV.UV(h))),i.faceZaxis=i.faceZaxis.map((h=>S.nV.UV(h))),i.faceXaxis=i.faceXaxis.map((h=>S.nV.UV(h))),i.faceYaxis=i.faceYaxis.map((h=>S.nV.UV(h)));const l=new Yh(h.name,V);return l.goldbergData=i,l}}var gh=i(11691);const qh={CreateBox:v.b,CreateTiledBox:n,CreateSphere:c.b,CreateDisc:I.c,CreateIcoSphere:z,CreateRibbon:J,CreateCylinder:U,CreateTorus:D,CreateTorusKnot:o,CreateLineSystem:M.f,WB:M.g,CreateDashedLines:M.c,ExtrudeShape:H,ExtrudeShapeCustom:j,CreateLathe:G,CreateTiledPlane:T,KB:w.b,CreateGround:N.h,CreateTiledGround:N.i,CreateGroundFromHeightMap:N.e,CreatePolygon:F.d,ExtrudePolygon:F.f,CreateTube:r,CreatePolyhedron:R,CreateGeodesic:function(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=V.m||1;S!==Math.floor(S)&&(S=Math.floor(S),K.d.Warn("m not an integer only floor(m) used"));let l=V.n||0;if(l!==Math.floor(l)&&(l=Math.floor(l),K.d.Warn("n not an integer only floor(n) used")),l>S){const h=l;l=S,S=h,K.d.Warn("n > m therefore m and n swapped")}const Y=new ih;return Y.build(S,l),R(h,{custom:lh.BuildGeodesicData(Y),size:V.size,sizeX:V.sizeX,sizeY:V.sizeY,sizeZ:V.sizeZ,faceUV:V.faceUV,faceColors:V.faceColors,flat:V.flat,updatable:V.updatable,sideOrientation:V.sideOrientation,frontUVs:V.frontUVs,backUVs:V.backUVs},i)},CreateGoldberg:function(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=V.size,B=V.sizeX||Y||1,J=V.sizeY||Y||1,I=V.sizeZ||Y||1;let v=V.m||1;v!==Math.floor(v)&&(v=Math.floor(v),K.d.Warn("m not an integer only floor(m) used"));let t=V.n||0;if(t!==Math.floor(t)&&(t=Math.floor(t),K.d.Warn("n not an integer only floor(n) used")),t>v){const h=t;t=v,v=h,K.d.Warn("n > m therefore m and n swapped")}const T=new ih;T.build(v,t);const e=lh.BuildGeodesicData(T),n=e.toGoldbergPolyhedronData(),c=new Yh(h,i);V.sideOrientation=l.e._GetDefaultSideOrientation(V.sideOrientation),c._originalBuilderSideOrientation=V.sideOrientation;(function(h,V){const i=h.size,l=h.sizeX||i||1,Y=h.sizeY||i||1,B=h.sizeZ||i||1,J=0===h.sideOrientation?0:h.sideOrientation||g.d.DEFAULTSIDE,I=[],v=[],s=[],t=[];let T=1/0,e=-1/0,n=1/0,c=-1/0;for(let S=0;S<V.vertex.length;S++)T=Math.min(T,V.vertex[S][0]*l),e=Math.max(e,V.vertex[S][0]*l),n=Math.min(n,V.vertex[S][1]*Y),c=Math.max(c,V.vertex[S][1]*Y);let f=0;for(let g=0;g<V.face.length;g++){const h=V.face[g],i=S.nV.UV(V.vertex[h[0]]),J=S.nV.UV(V.vertex[h[2]]),P=S.nV.UV(V.vertex[h[1]]),L=J.cV(i),U=P.cV(i),X=S.nV.Cross(U,L).normalize();for(let S=0;S<h.length;S++){s.push(X.x,X.y,X.z);const i=V.vertex[h[S]];I.push(i[0]*l,i[1]*Y,i[2]*B);const g=(i[1]*Y-n)/(c-n);t.push((i[0]*l-T)/(e-T),q.c?1-g:g)}for(let V=0;V<h.length-2;V++)v.push(f,f+V+2,f+V+1);f+=h.length}g.d._ComputeSides(J,I,v,s,t);const P=new g.d;return P.Eh=I,P.indices=v,P.Hh=s,P.mh=t,P})(V,n).wh(c,V.updatable),c.goldbergData.nbSharedFaces=e.sharedNodes,c.goldbergData.nbUnsharedFaces=e.poleNodes,c.goldbergData.adjacentFaces=e.adjacentFaces,c.goldbergData.nbFaces=c.goldbergData.nbSharedFaces+c.goldbergData.nbUnsharedFaces,c.goldbergData.nbFacesAtPole=(c.goldbergData.nbUnsharedFaces-12)/12;for(let l=0;l<e.vertex.length;l++)c.goldbergData.faceCenters.push(S.nV.UV(e.vertex[l])),c.goldbergData.faceCenters[l].x*=B,c.goldbergData.faceCenters[l].y*=J,c.goldbergData.faceCenters[l].z*=I,c.goldbergData.faceColors.push(new s.vq(1,1,1,1));for(let l=0;l<n.face.length;l++){const h=n.face[l],V=S.nV.UV(n.vertex[h[0]]),i=S.nV.UV(n.vertex[h[2]]),Y=S.nV.UV(n.vertex[h[1]]),g=i.cV(V),q=Y.cV(V),B=S.nV.Cross(q,g).normalize(),J=S.nV.Cross(q,B).normalize();c.goldbergData.faceXaxis.push(q.normalize()),c.goldbergData.faceYaxis.push(B),c.goldbergData.faceZaxis.push(J)}return c},CreateDecal:p,CreateCapsule:a,CreateText:gh.g}},12405:(h,V,i)=>{"use strict";i.d(V,{b:()=>qV});var S=i(11138),l=i(11520);class Y extends l.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var g=i(11189),q=(i(11317),i(11091));class B{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(h){this._targetStopDuration!==h&&(this._targetStopDuration=h)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(h){this._noiseTexture!==h&&(this._noiseTexture=h,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(h){this._animationSheetEnabled!==h&&(this._animationSheetEnabled=h)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(h){this._isAnimationSheetEnabled!=h&&(this._isAnimationSheetEnabled=h,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(h){this._useLogarithmicDepth=h&&this.Mh().getEngine().getCaps().fragmentDepthSupported}Mh(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(h){switch(h){case B.BLENDMODE_MULTIPLYADD:return;case B.BLENDMODE_ADD:h=1;break;case B.BLENDMODE_ONEONE:h=6;break;case B.BLENDMODE_STANDARD:h=2;break;case B.BLENDMODE_MULTIPLY:h=4;break;case B.BLENDMODE_SUBTRACT:h=3}this._engine.setAlphaMode(h)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:S.nV.Zero()}set direction1(h){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=h)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:S.nV.Zero()}set direction2(h){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=h)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:S.nV.Zero()}set minEmitBox(h){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=h)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:S.nV.Zero()}set maxEmitBox(h){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=h)}get billboardMode(){return this._billboardMode}set billboardMode(h){this._billboardMode!==h&&(this._billboardMode=h,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(h){this._isBillboardBased!==h&&(this._isBillboardBased=h,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(h){this._attachImageProcessingConfiguration(h)}_attachImageProcessingConfiguration(h){h!==this._imageProcessingConfiguration&&(!h&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=h)}_reset(){}_removeGradientAndTexture(h,V,i){if(!V)return this;let S=0;for(const l of V){if(l.gradient===h){V.splice(S,1);break}S++}return i&&i.dispose(),this}constructor(h){this.animations=[],this.renderingGroupId=0,this.k=S.nV.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new S.nV(10,10,10),this.onAnimationEnd=null,this.blendMode=B.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new S.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.CB=new S.nV(0,0,0),this._useLogarithmicDepth=!1,this.gravity=S.nV.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new g.vq(1,1,1,1),this.color2=new g.vq(1,1,1,1),this.colorDead=new g.vq(0,0,0,1),this.textureMask=new g.vq(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Y,this.id=h,this.name=h}createPointEmitter(h,V){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new S.nV(0,1,0),arguments.length>2&&void 0!==arguments[2]||new S.nV(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new S.nV(0,1,0),arguments.length>4&&void 0!==arguments[4]||new S.nV(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new S.nV(0,1,0),arguments.length>3&&void 0!==arguments[3]||new S.nV(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(h,V,i,S){throw new Error("Method not implemented.")}}B.BLENDMODE_ONEONE=0,B.BLENDMODE_STANDARD=1,B.BLENDMODE_ADD=2,B.BLENDMODE_MULTIPLY=3,B.BLENDMODE_MULTIPLYADD=4,B.BLENDMODE_SUBTRACT=-1,(0,q.f)("BABYLON.BaseParticleSystem",B);var J=i(11162),I=i(10972);class v{constructor(){this.direction1=new S.nV(0,1,0),this.direction2=new S.nV(0,1,0),this.minEmitBox=new S.nV(-.5,-.5,-.5),this.maxEmitBox=new S.nV(.5,.5,.5)}startDirectionFunction(h,V,i,l){const Y=(0,J.RandomRange)(this.direction1.x,this.direction2.x),g=(0,J.RandomRange)(this.direction1.y,this.direction2.y),q=(0,J.RandomRange)(this.direction1.z,this.direction2.z);if(l)return V.x=Y,V.y=g,void(V.z=q);S.nV.TransformNormalFromFloatsToRef(Y,g,q,h,V)}startPositionFunction(h,V,i,l){const Y=(0,J.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),g=(0,J.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),q=(0,J.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(l)return V.x=Y,V.y=g,void(V.z=q);S.nV.TransformCoordinatesFromFloatsToRef(Y,g,q,h,V)}clone(){const h=new v;return I.d.DeepCopy(this,h),h}applyToShader(h){h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2),h.setVector3("minEmitBox",this.minEmitBox),h.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(h){h.addUniform("direction1",3),h.addUniform("direction2",3),h.addUniform("minEmitBox",3),h.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.direction1=this.direction1.Ng(),h.direction2=this.direction2.Ng(),h.minEmitBox=this.minEmitBox.Ng(),h.maxEmitBox=this.maxEmitBox.Ng(),h}parse(h){S.nV.FromArrayToRef(h.direction1,0,this.direction1),S.nV.FromArrayToRef(h.direction2,0,this.direction2),S.nV.FromArrayToRef(h.minEmitBox,0,this.minEmitBox),S.nV.FromArrayToRef(h.maxEmitBox,0,this.maxEmitBox)}}class s{get radius(){return this._radius}set radius(h){this._radius=h,this._buildHeight()}get angle(){return this._angle}set angle(h){this._angle=h,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=i,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=V,this.radius=h}startDirectionFunction(h,V,i,l){l?S.TmpVectors.nV[0].l(i.Nq).normalize():i.position.subtractToRef(h.getTranslation(),S.TmpVectors.nV[0]).normalize();const Y=(0,J.RandomRange)(0,this.directionRandomizer),g=(0,J.RandomRange)(0,this.directionRandomizer),q=(0,J.RandomRange)(0,this.directionRandomizer);V.x=S.TmpVectors.nV[0].x+Y,V.y=S.TmpVectors.nV[0].y+g,V.z=S.TmpVectors.nV[0].z+q,V.normalize()}startPositionFunction(h,V,i,l){const Y=(0,J.RandomRange)(0,2*Math.PI);let g;this.emitFromSpawnPointOnly?g=1e-4:(g=(0,J.RandomRange)(0,this.heightRange),g=1-g*g);let q=this._radius-(0,J.RandomRange)(0,this._radius*this.radiusRange);q*=g;const B=q*Math.sin(Y),I=q*Math.cos(Y),v=g*this._height;if(l)return V.x=B,V.y=v,void(V.z=I);S.nV.TransformCoordinatesFromFloatsToRef(B,v,I,h,V)}clone(){const h=new s(this._radius,this._angle,this.directionRandomizer);return I.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat2("radius",this._radius,this.radiusRange),h.setFloat("coneAngle",this._angle),h.setFloat2("height",this._height,this.heightRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",2),h.addUniform("coneAngle",1),h.addUniform("height",2),h.addUniform("directionRandomizer",1)}getEffectDefines(){let h="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(h+="\n#define CONEEMITTERSPAWNPOINT"),h}getClassName(){return"ConeParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this._radius,h.angle=this._angle,h.directionRandomizer=this.directionRandomizer,h.radiusRange=this.radiusRange,h.heightRange=this.heightRange,h.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,h}parse(h){this.radius=h.radius,this.angle=h.angle,this.directionRandomizer=h.directionRandomizer,this.radiusRange=void 0!==h.radiusRange?h.radiusRange:1,this.heightRange=void 0!==h.radiusRange?h.heightRange:1,this.emitFromSpawnPointOnly=void 0!==h.emitFromSpawnPointOnly&&h.emitFromSpawnPointOnly}}class t extends s{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.nV(0,1,0),l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.nV(0,1,0);super(h,V),this.direction1=i,this.direction2=l}startDirectionFunction(h,V){const i=(0,J.RandomRange)(this.direction1.x,this.direction2.x),l=(0,J.RandomRange)(this.direction1.y,this.direction2.y),Y=(0,J.RandomRange)(this.direction1.z,this.direction2.z);S.nV.TransformNormalFromFloatsToRef(i,l,Y,h,V)}clone(){const h=new t(this.radius,this.angle,this.direction1,this.direction2);return I.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const h=super.serialize();return h.direction1=this.direction1.Ng(),h.direction2=this.direction2.Ng(),h}parse(h){super.parse(h),this.direction1.l(h.direction1),this.direction2.l(h.direction2)}}class T{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=h,this.height=V,this.radiusRange=i,this.directionRandomizer=l,this._tempVector=S.nV.Zero()}startDirectionFunction(h,V,i,l,Y){i.position.subtractToRef(h.getTranslation(),this._tempVector),this._tempVector.normalize(),S.nV.TransformNormalToRef(this._tempVector,Y,this._tempVector);const g=(0,J.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let q=Math.atan2(this._tempVector.x,this._tempVector.z);q+=(0,J.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=g,this._tempVector.x=Math.sin(q),this._tempVector.z=Math.cos(q),this._tempVector.normalize(),l?V.l(this._tempVector):S.nV.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,h,V)}startPositionFunction(h,V,i,l){const Y=(0,J.RandomRange)(-this.height/2,this.height/2),g=(0,J.RandomRange)(0,2*Math.PI),q=(0,J.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),B=Math.sqrt(q)*this.radius,I=B*Math.cos(g),v=B*Math.sin(g);l?V.qq(I,Y,v):S.nV.TransformCoordinatesFromFloatsToRef(I,Y,v,h,V)}clone(){const h=new T(this.radius,this.directionRandomizer);return I.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("height",this.height),h.setFloat("radiusRange",this.radiusRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("height",1),h.addUniform("radiusRange",1),h.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this.radius,h.height=this.height,h.radiusRange=this.radiusRange,h.directionRandomizer=this.directionRandomizer,h}parse(h){this.radius=h.radius,this.height=h.height,this.radiusRange=h.radiusRange,this.directionRandomizer=h.directionRandomizer}}class e extends T{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.nV(0,1,0),Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.nV(0,1,0);super(h,V,i),this.direction1=l,this.direction2=Y}startDirectionFunction(h,V,i,l){const Y=(0,J.RandomRange)(this.direction1.x,this.direction2.x),g=(0,J.RandomRange)(this.direction1.y,this.direction2.y),q=(0,J.RandomRange)(this.direction1.z,this.direction2.z);l?V.qq(Y,g,q):S.nV.TransformNormalFromFloatsToRef(Y,g,q,h,V)}clone(){const h=new e(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return I.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("height",this.height),h.setFloat("radiusRange",this.radiusRange),h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("height",1),h.addUniform("radiusRange",1),h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const h=super.serialize();return h.direction1=this.direction1.Ng(),h.direction2=this.direction2.Ng(),h}parse(h){super.parse(h),S.nV.FromArrayToRef(h.direction1,0,this.direction1),S.nV.FromArrayToRef(h.direction2,0,this.direction2)}}class n{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=h,this.radiusRange=V,this.directionRandomizer=i}startDirectionFunction(h,V,i,l){const Y=i.position.cV(h.getTranslation()).normalize(),g=(0,J.RandomRange)(0,this.directionRandomizer),q=(0,J.RandomRange)(0,this.directionRandomizer),B=(0,J.RandomRange)(0,this.directionRandomizer);Y.x+=g,Y.y+=q,Y.z+=B,Y.normalize(),l?V.l(Y):S.nV.TransformNormalFromFloatsToRef(Y.x,Y.y,Y.z,h,V)}startPositionFunction(h,V,i,l){const Y=this.radius-(0,J.RandomRange)(0,this.radius*this.radiusRange),g=(0,J.RandomRange)(0,1),q=(0,J.RandomRange)(0,2*Math.PI),B=Math.acos(2*g-1),I=Y*Math.cos(q)*Math.sin(B),v=Y*Math.cos(B),s=Y*Math.sin(q)*Math.sin(B);l?V.qq(I,Math.abs(v),s):S.nV.TransformCoordinatesFromFloatsToRef(I,Math.abs(v),s,h,V)}clone(){const h=new n(this.radius,this.directionRandomizer);return I.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this.radius,h.radiusRange=this.radiusRange,h.directionRandomizer=this.directionRandomizer,h}parse(h){this.radius=h.radius,this.radiusRange=h.radiusRange,this.directionRandomizer=h.directionRandomizer}}class c{constructor(){this.direction1=new S.nV(0,1,0),this.direction2=new S.nV(0,1,0)}startDirectionFunction(h,V,i,l){const Y=(0,J.RandomRange)(this.direction1.x,this.direction2.x),g=(0,J.RandomRange)(this.direction1.y,this.direction2.y),q=(0,J.RandomRange)(this.direction1.z,this.direction2.z);l?V.qq(Y,g,q):S.nV.TransformNormalFromFloatsToRef(Y,g,q,h,V)}startPositionFunction(h,V,i,l){l?V.qq(0,0,0):S.nV.TransformCoordinatesFromFloatsToRef(0,0,0,h,V)}clone(){const h=new c;return I.d.DeepCopy(this,h),h}applyToShader(h){h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.direction1=this.direction1.Ng(),h.direction2=this.direction2.Ng(),h}parse(h){S.nV.FromArrayToRef(h.direction1,0,this.direction1),S.nV.FromArrayToRef(h.direction2,0,this.direction2)}}class f{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=h,this.radiusRange=V,this.directionRandomizer=i}startDirectionFunction(h,V,i,l){const Y=i.position.cV(h.getTranslation()).normalize(),g=(0,J.RandomRange)(0,this.directionRandomizer),q=(0,J.RandomRange)(0,this.directionRandomizer),B=(0,J.RandomRange)(0,this.directionRandomizer);Y.x+=g,Y.y+=q,Y.z+=B,Y.normalize(),l?V.l(Y):S.nV.TransformNormalFromFloatsToRef(Y.x,Y.y,Y.z,h,V)}startPositionFunction(h,V,i,l){const Y=this.radius-(0,J.RandomRange)(0,this.radius*this.radiusRange),g=(0,J.RandomRange)(0,1),q=(0,J.RandomRange)(0,2*Math.PI),B=Math.acos(2*g-1),I=Y*Math.cos(q)*Math.sin(B),v=Y*Math.cos(B),s=Y*Math.sin(q)*Math.sin(B);l?V.qq(I,v,s):S.nV.TransformCoordinatesFromFloatsToRef(I,v,s,h,V)}clone(){const h=new f(this.radius,this.directionRandomizer);return I.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this.radius,h.radiusRange=this.radiusRange,h.directionRandomizer=this.directionRandomizer,h}parse(h){this.radius=h.radius,this.radiusRange=h.radiusRange,this.directionRandomizer=h.directionRandomizer}}class P extends f{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.nV(0,1,0),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.nV(0,1,0);super(h),this.direction1=V,this.direction2=i}startDirectionFunction(h,V){const i=(0,J.RandomRange)(this.direction1.x,this.direction2.x),l=(0,J.RandomRange)(this.direction1.y,this.direction2.y),Y=(0,J.RandomRange)(this.direction1.z,this.direction2.z);S.nV.TransformNormalFromFloatsToRef(i,l,Y,h,V)}clone(){const h=new P(this.radius,this.direction1,this.direction2);return I.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const h=super.serialize();return h.direction1=this.direction1.Ng(),h.direction2=this.direction2.Ng(),h}parse(h){super.parse(h),this.direction1.l(h.direction1),this.direction2.l(h.direction2)}}class L{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(h,V,i,l){const Y=S.TmpVectors.nV[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,i,Y);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,i,Y);const h=S.TmpVectors.nV[1];Y.subtractToRef(i.position,h),h.scaleToRef(1/i.lifeTime,Y)}else Y.set(0,0,0);l?V.l(Y):S.nV.TransformNormalToRef(Y,h,V)}startPositionFunction(h,V,i,l){const Y=S.TmpVectors.nV[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,i,Y):Y.set(0,0,0),l?V.l(Y):S.nV.TransformCoordinatesToRef(Y,h,V)}clone(){const h=new L;return I.d.DeepCopy(this,h),h}applyToShader(h){}buildUniformLayout(h){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.particlePositionGenerator=this.particlePositionGenerator,h.particleDestinationGenerator=this.particleDestinationGenerator,h}parse(h){h.particlePositionGenerator&&(this.particlePositionGenerator=h.particlePositionGenerator),h.particleDestinationGenerator&&(this.particleDestinationGenerator=h.particleDestinationGenerator)}}var U=i(11220);class X{get mesh(){return this._mesh}set mesh(h){this._mesh!==h&&(this._mesh=h,h?(this._indices=h.ug(),this._positions=h.getVerticesData(U.h.PositionKind),this._normals=h.getVerticesData(U.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=S.nV.Zero(),this._mesh=null,this.direction1=new S.nV(0,1,0),this.direction2=new S.nV(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=h}startDirectionFunction(h,V,i,l){if(this.useMeshNormalsForDirection&&this._normals)return void S.nV.TransformNormalToRef(this._storedNormal,h,V);const Y=(0,J.RandomRange)(this.direction1.x,this.direction2.x),g=(0,J.RandomRange)(this.direction1.y,this.direction2.y),q=(0,J.RandomRange)(this.direction1.z,this.direction2.z);l?V.qq(Y,g,q):S.nV.TransformNormalFromFloatsToRef(Y,g,q,h,V)}startPositionFunction(h,V,i,l){if(!this._indices||!this._positions)return;const Y=3*(Math.random()*(this._indices.length/3)|0),g=Math.random(),q=Math.random()*(1-g),B=1-g-q,J=this._indices[Y],I=this._indices[Y+1],v=this._indices[Y+2],s=S.TmpVectors.nV[0],t=S.TmpVectors.nV[1],T=S.TmpVectors.nV[2],e=S.TmpVectors.nV[3];S.nV.FromArrayToRef(this._positions,3*J,s),S.nV.FromArrayToRef(this._positions,3*I,t),S.nV.FromArrayToRef(this._positions,3*v,T),e.x=g*s.x+q*t.x+B*T.x,e.y=g*s.y+q*t.y+B*T.y,e.z=g*s.z+q*t.z+B*T.z,l?V.qq(e.x,e.y,e.z):S.nV.TransformCoordinatesFromFloatsToRef(e.x,e.y,e.z,h,V),this.useMeshNormalsForDirection&&this._normals&&(S.nV.FromArrayToRef(this._normals,3*J,s),S.nV.FromArrayToRef(this._normals,3*I,t),S.nV.FromArrayToRef(this._normals,3*v,T),this._storedNormal.x=g*s.x+q*t.x+B*T.x,this._storedNormal.y=g*s.y+q*t.y+B*T.y,this._storedNormal.z=g*s.z+q*t.z+B*T.z)}clone(){const h=new X(this.mesh);return I.d.DeepCopy(this,h),h}applyToShader(h){h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var h;const V={};return V.type=this.getClassName(),V.direction1=this.direction1.Ng(),V.direction2=this.direction2.Ng(),V.meshId=null===(h=this.mesh)||void 0===h?void 0:h.id,V.useMeshNormalsForDirection=this.useMeshNormalsForDirection,V}parse(h,V){S.nV.FromArrayToRef(h.direction1,0,this.direction1),S.nV.FromArrayToRef(h.direction2,0,this.direction2),h.meshId&&V&&(this.mesh=V.getLastMeshById(h.meshId)),this.useMeshNormalsForDirection=h.useMeshNormalsForDirection}}class D{_isUbo(h){return void 0!==h.addUniform}constructor(h){this._isUbo(h)?(this.setMatrix3x3=h.updateMatrix3x3.bind(h),this.setMatrix2x2=h.updateMatrix2x2.bind(h),this.setFloat=h.updateFloat.bind(h),this.setFloat2=h.updateFloat2.bind(h),this.setFloat3=h.updateFloat3.bind(h),this.setFloat4=h.updateFloat4.bind(h),this.setFloatArray=h.updateFloatArray.bind(h),this.setArray=h.updateArray.bind(h),this.setIntArray=h.updateIntArray.bind(h),this.setMatrix=h.xg.bind(h),this.setMatrices=h.updateMatrices.bind(h),this.setVector3=h.updateVector3.bind(h),this.setVector4=h.updateVector4.bind(h),this.setColor3=h.updateColor3.bind(h),this.setColor4=h.updateColor4.bind(h),this.setDirectColor4=h.updateDirectColor4.bind(h),this.setInt=h.updateInt.bind(h),this.setInt2=h.updateInt2.bind(h),this.setInt3=h.updateInt3.bind(h),this.setInt4=h.updateInt4.bind(h)):(this.setMatrix3x3=h.setMatrix3x3.bind(h),this.setMatrix2x2=h.setMatrix2x2.bind(h),this.setFloat=h.setFloat.bind(h),this.setFloat2=h.setFloat2.bind(h),this.setFloat3=h.setFloat3.bind(h),this.setFloat4=h.setFloat4.bind(h),this.setFloatArray=h.setFloatArray.bind(h),this.setArray=h.setArray.bind(h),this.setIntArray=h.setIntArray.bind(h),this.setMatrix=h.setMatrix.bind(h),this.setMatrices=h.setMatrices.bind(h),this.setVector3=h.setVector3.bind(h),this.setVector4=h.setVector4.bind(h),this.setColor3=h.setColor3.bind(h),this.setColor4=h.setColor4.bind(h),this.setDirectColor4=h.setDirectColor4.bind(h),this.setInt=h.setInt.bind(h),this.setInt2=h.setInt2.bind(h),this.setInt3=h.setInt3.bind(h),this.setInt4=h.setInt4.bind(h))}}var O=i(11042);const o="gpuUpdateParticlesPixelShader",M="#version 300 es\nvoid main() {discard;}\n";O.d.ShadersStore[o]||(O.d.ShadersStore[o]=M);const F="gpuUpdateParticlesVertexShader",E="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";O.d.ShadersStore[F]||(O.d.ShadersStore[F]=E);(0,q.f)("BABYLON.WebGL2ParticleSystem",class{constructor(h,V){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=h,this._engine=V,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var h;return(null===(h=this._updateEffect)||void 0===h?void 0:h.isReady())??!1}createUpdateBuffer(h){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof L&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=h,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new D(this._updateEffect)}createVertexBuffers(h,V){this._updateVAO.push(this._createUpdateVAO(h)),this._renderVAO.push(this._engine.recordVertexArrayObject(V,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=V}createParticleBuffer(h){return h}bindDrawBuffers(h,V,i){i?this._engine.bindBuffers(this._renderVertexBuffers,i,V):this._engine.bindVertexArrayObject(this._renderVAO[h],null)}preUpdateParticleBuffer(){const h=this._engine;if(this._engine.enableEffect(this._updateEffect),!h.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(h,V,i){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[h],null);const S=this._engine;S.bindTransformFeedbackBuffer(V.getBuffer()),S.setRasterizerState(!1),S.beginTransformFeedback(!0),S.drawArraysType(3,0,i),S.endTransformFeedback(),S.setRasterizerState(!0),S.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let h=0;h<this._updateVAO.length;h++)this._engine.releaseVertexArrayObject(this._updateVAO[h]);this._updateVAO.length=0;for(let h=0;h<this._renderVAO.length;h++)this._engine.releaseVertexArrayObject(this._renderVAO[h]);this._renderVAO.length=0}_createUpdateVAO(h){const V={};V.position=h.createVertexBuffer("position",0,3);let i=3;V.age=h.createVertexBuffer("age",i,1),i+=1,V.size=h.createVertexBuffer("size",i,3),i+=3,V.life=h.createVertexBuffer("life",i,1),i+=1,V.seed=h.createVertexBuffer("seed",i,4),i+=4,V.direction=h.createVertexBuffer("direction",i,3),i+=3,this._parent.particleEmitterType instanceof L&&(V.initialPosition=h.createVertexBuffer("initialPosition",i,3),i+=3),this._parent._colorGradientsTexture||(V.color=h.createVertexBuffer("color",i,4),i+=4),this._parent._isBillboardBased||(V.initialDirection=h.createVertexBuffer("initialDirection",i,3),i+=3),this._parent.noiseTexture&&(V.noiseCoordinates1=h.createVertexBuffer("noiseCoordinates1",i,3),i+=3,V.noiseCoordinates2=h.createVertexBuffer("noiseCoordinates2",i,3),i+=3),this._parent._angularSpeedGradientsTexture?(V.angle=h.createVertexBuffer("angle",i,1),i+=1):(V.angle=h.createVertexBuffer("angle",i,2),i+=2),this._parent._isAnimationSheetEnabled&&(V.cellIndex=h.createVertexBuffer("cellIndex",i,1),i+=1,this._parent.spriteRandomStartCell&&(V.cellStartOffset=h.createVertexBuffer("cellStartOffset",i,1),i+=1));const S=this._engine.recordVertexArrayObject(V,null,this._updateEffect);return this._engine.bindArrayBuffer(null),S}});class H{constructor(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,S=arguments.length>3?arguments[3]:void 0;this._engine=h,this._label=S,this._engine._storageBuffers.push(this),this._create(V,i)}_create(h,V){this._bufferSize=h,this._creationFlags=V,this._buffer=this._engine.createStorageBuffer(h,V,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(h,V,i){this._buffer&&this._engine.updateStorageBuffer(this._buffer,h,V,i)}async read(h,V,i,S){return await this._engine.readFromStorageBuffer(this._buffer,h,V,i,S)}dispose(){const h=this._engine._storageBuffers,V=h.indexOf(this);-1!==V&&(h[V]=h[h.length-1],h.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var j=i(11123),m=i(11127),G=i(11179),w=i(11117),N=i(11435),r=i(10967),k=i(11072),R=i(11358);class Z{constructor(){this._gpuTimeInFrameId=-1,this.counter=new R.b}_addDuration(h,V){h<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==h?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(V,!1),this._gpuTimeInFrameId=h):this.counter.addCount(V,!1))}}var z=i(11021);class d{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=h,this._engine=V,this.uniqueId=N.d.UniqueId,V.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Z),this._engine.getCaps().supportComputeShaders?S.bindingsMapping?(this._context=V.createComputeContext(),this._shaderPath=i,this._options={bindingsMapping:{},defines:[],...S}):r.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):r.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(h,V){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const S=this._bindings[h];this._bindings[h]={type:i?0:4,object:V,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!S||S.object!==V||S.type!==this._bindings[h].type)}setStorageTexture(h,V){const i=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==V),this._bindings[h]={type:1,object:V,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setExternalTexture(h,V){const i=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==V),this._bindings[h]={type:6,object:V,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setVideoTexture(h,V){return!!V.externalTexture&&(this.setExternalTexture(h,V.externalTexture),!0)}setUniformBuffer(h,V){const i=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==V),this._bindings[h]={type:d._BufferIsDataBuffer(V)?7:2,object:V,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setStorageBuffer(h,V){const i=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==V),this._bindings[h]={type:d._BufferIsDataBuffer(V)?7:3,object:V,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setTextureSampler(h,V){const i=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!i||!V.compareSampler(i.object)),this._bindings[h]={type:5,object:V,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}isReady(){let h=this._effect;for(const l in this._bindings){const h=this._bindings[l],V=h.type,i=h.object;switch(V){case 0:case 4:case 1:if(!i.isReady())return!1;break;case 6:if(!i.isReady())return!1;break}}const V=[],i=this._shaderPath;if(this._options.defines)for(let l=0;l<this._options.defines.length;l++)V.push(this._options.defines[l]);const S=V.join("\n");return this._cachedDefines!==S&&(this._cachedDefines=S,h=this._engine.createComputeEffect(i,{defines:S,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=h),!!h.isReady()}dispatch(h,V,i){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,h,V,i,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const i=d._BufferIsDataBuffer(h)?h:h.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,i,V,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const V in this._bindings){const i=this._bindings[V];if(!this._options.bindingsMapping[V])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+V+"'");switch(i.type){case 0:{const S=this._samplers[V],l=i.object;var h;if(!S||!l._texture||!S.compareSampler(l._texture))this._samplers[V]=(new k.c).setParameters(l.wrapU,l.wrapV,l.wrapR,l.anisotropicFilteringLevel,l._texture.samplingMode,null===(h=l._texture)||void 0===h?void 0:h._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const h=i.object;h.getBuffer()!==i.buffer&&(i.buffer=h.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((l=>{(0,z.h)((()=>this.dispatch(h,V,i)),l,void 0,S)}))}serialize(){const h=G.d.Serialize(this);h.options=this._options,h.shaderPath=this._shaderPath,h.Nv={},h.textures={};for(const V in this._bindings){const i=this._bindings[V],S=i.object;switch(i.type){case 0:case 4:case 1:{const l=S.serialize();l&&(h.textures[V]=l,h.Nv[V]={type:i.type});break}}}return h}static Parse(h,V,i){const S=G.d.Parse((()=>new d(h.name,V.getEngine(),h.shaderPath,h.options)),h,V,i);for(const l in h.textures){const Y=h.Nv[l],g=w.d.Parse(h.textures[l],V,i);0===Y.type?S.setTexture(l,g):4===Y.type?S.setTexture(l,g,!1):S.setStorageTexture(l,g)}return S}static _BufferIsDataBuffer(h){return void 0!==h.underlyingResource}}(0,j.b)([(0,m.E)()],d.prototype,"name",void 0),(0,j.b)([(0,m.E)()],d.prototype,"fastMode",void 0),(0,q.f)("BABYLON.ComputeShader",d);var x=i(11403);const y="gpuUpdateParticlesComputeShader",Q="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";O.d.ShadersStoreWGSL[y]||(O.d.ShadersStoreWGSL[y]=Q);(0,q.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(h,V){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=h,this._engine=V}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var h;return(null===(h=this._updateComputeShader)||void 0===h?void 0:h.isReady())??!1}createUpdateBuffer(h){var V;const i={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(i.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(i.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(i.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(i.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(i.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(i.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(i.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new d("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:i,defines:h.split("\n")}),null===(V=this._simParamsComputeShader)||void 0===V||V.dispose(),this._simParamsComputeShader=new x.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new D(this._simParamsComputeShader)}createVertexBuffers(h,V){this._renderVertexBuffers.push(V)}createParticleBuffer(h){const V=new H(this._engine,4*h.length,11,"ComputeShaderParticleSystemBuffer");return V.update(h),this._bufferComputeShader.push(V),V.getBuffer()}bindDrawBuffers(h,V,i){this._engine.bindBuffers(this._renderVertexBuffers[h],i,V)}preUpdateParticleBuffer(){}updateParticleBuffer(h,V,i){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[h]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^h]),this._updateComputeShader.dispatch(Math.ceil(i/64))}releaseBuffers(){var h;for(let V=0;V<this._bufferComputeShader.length;++V)this._bufferComputeShader[V].dispose();this._bufferComputeShader.length=0,null===(h=this._simParamsComputeShader)||void 0===h||h.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class A{constructor(h,V,i){this.gradient=h,this.color1=V,this.color2=i}getColorToRef(h){this.color2?g.vq.LerpToRef(this.color1,this.color2,Math.random(),h):h.l(this.color1)}}class b{constructor(h,V){this.gradient=h,this.color=V}}class C{constructor(h,V,i){this.gradient=h,this.factor1=V,this.factor2=i}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class u{static GetCurrentGradient(h,V,i){if(V[0].gradient>h)return void i(V[0],V[0],1);for(let l=0;l<V.length-1;l++){const S=V[l],Y=V[l+1];if(h>=S.gradient&&h<=Y.gradient){return void i(S,Y,(h-S.gradient)/(Y.gradient-S.gradient))}}const S=V.length-1;i(V[S],V[S],1)}}var p=i(10960),W=i(11613),a=i(10988);class K{constructor(h){this.particleSystem=h,this.position=S.nV.Zero(),this.direction=S.nV.Zero(),this.color=new g.vq(0,0,0,0),this.colorStep=new g.vq(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new S.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new g.vq(0,0,0,0),this._currentColor2=new g.vq(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=K._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let h=this.age,V=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===V?(V=1,h=this._randomCellOffset):h+=this._randomCellOffset);const i=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let S;S=this._initialSpriteCellLoop?(0,J.Clamp)(h*V%this.lifeTime/this.lifeTime):(0,J.Clamp)(h*V/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+S*i|0}_inheritParticleInfoToSubEmitter(h){if(h.particleSystem.k.position){const V=h.particleSystem.k;if(V.position.l(this.position),h.inheritDirection){const h=S.TmpVectors.nV[0];this.direction.normalizeToRef(h),V.setDirection(h,0,Math.PI/2)}}else{h.particleSystem.k.l(this.position)}this.direction.scaleToRef(h.inheritedVelocityAmount/2,S.TmpVectors.nV[0]),h.particleSystem._inheritedVelocityOffset.l(S.TmpVectors.nV[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const h of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(h)}_reset(){this.age=0,this.id=K._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(h){h.position.l(this.position),this._initialDirection?h._initialDirection?h._initialDirection.l(this._initialDirection):h._initialDirection=this._initialDirection.clone():h._initialDirection=null,h.direction.l(this.direction),this.Nq&&(h.Nq?h.Nq.l(this.Nq):h.Nq=this.Nq.clone()),h.color.l(this.color),h.colorStep.l(this.colorStep),h.lifeTime=this.lifeTime,h.age=this.age,h._randomCellOffset=this._randomCellOffset,h.size=this.size,h.scale.l(this.scale),h.angle=this.angle,h.angularSpeed=this.angularSpeed,h.particleSystem=this.particleSystem,h.cellIndex=this.cellIndex,h.id=this.id,h._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(h._currentColorGradient=this._currentColorGradient,h._currentColor1.l(this._currentColor1),h._currentColor2.l(this._currentColor2)),this._currentSizeGradient&&(h._currentSizeGradient=this._currentSizeGradient,h._currentSize1=this._currentSize1,h._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(h._currentAngularSpeedGradient=this._currentAngularSpeedGradient,h._currentAngularSpeed1=this._currentAngularSpeed1,h._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(h._currentVelocityGradient=this._currentVelocityGradient,h._currentVelocity1=this._currentVelocity1,h._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(h._currentLimitVelocityGradient=this._currentLimitVelocityGradient,h._currentLimitVelocity1=this._currentLimitVelocity1,h._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(h._currentDragGradient=this._currentDragGradient,h._currentDrag1=this._currentDrag1,h._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(h._initialStartSpriteCellId=this._initialStartSpriteCellId,h._initialEndSpriteCellId=this._initialEndSpriteCellId,h._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(h.remapData&&this.remapData?h.remapData.l(this.remapData):h.remapData=new S.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(h._randomNoiseCoordinates1?(h._randomNoiseCoordinates1.l(this._randomNoiseCoordinates1),h._randomNoiseCoordinates2.l(this._randomNoiseCoordinates2)):(h._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),h._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}K._Count=0;var hh=i(11271),Vh=(i(11311),i(11504)),ih=i(11501),Sh=i(11399);function lh(h,V){const i=(0,J.RandomRange)(0,1);g.vq.LerpToRef(V.color1,V.color2,i,h.color),V.colorDead.subtractToRef(h.color,V._colorDiff),V._colorDiff.scaleToRef(1/h.lifeTime,h.colorStep)}function Yh(h,V){h._currentColorGradient=V._colorGradients[0],h._currentColorGradient.getColorToRef(h.color),h._currentColor1.l(h.color),V._colorGradients.length>1?V._colorGradients[1].getColorToRef(h._currentColor2):h._currentColor2.l(h.color)}function gh(h,V){const i=V._colorGradients;u.GetCurrentGradient(V._ratio,i,((V,i,S)=>{V!==h._currentColorGradient&&(h._currentColor1.l(h._currentColor2),i.getColorToRef(h._currentColor2),h._currentColorGradient=V),g.vq.LerpToRef(h._currentColor1,h._currentColor2,S,h.color)}))}function qh(h,V){h.colorStep.scaleToRef(V._scaledUpdateSpeed,V._scaledColorStep),h.color.addInPlace(V._scaledColorStep),h.color.a<0&&(h.color.a=0)}function Bh(h,V){u.GetCurrentGradient(V._ratio,V._angularSpeedGradients,((V,i,S)=>{V!==h._currentAngularSpeedGradient&&(h._currentAngularSpeed1=h._currentAngularSpeed2,h._currentAngularSpeed2=i.getFactor(),h._currentAngularSpeedGradient=V),h.angularSpeed=(0,J.Lerp)(h._currentAngularSpeed1,h._currentAngularSpeed2,S)}))}function Jh(h,V){h.angle+=h.angularSpeed*V._scaledUpdateSpeed}function Ih(h,V){V.particleEmitterType.startDirectionFunction(V._emitterWorldMatrix,h.direction,h,V.isLocal,V._emitterInverseWorldMatrix)}function vh(h,V){V.startDirectionFunction(V._emitterWorldMatrix,h.direction,h,V.isLocal)}function sh(h,V){h._currentVelocityGradient=V._velocityGradients[0],h._currentVelocity1=h._currentVelocityGradient.getFactor(),V._velocityGradients.length>1?h._currentVelocity2=V._velocityGradients[1].getFactor():h._currentVelocity2=h._currentVelocity1}function th(h,V){h._currentLimitVelocityGradient=V._limitVelocityGradients[0],h._currentLimitVelocity1=h._currentLimitVelocityGradient.getFactor(),V._limitVelocityGradients.length>1?h._currentLimitVelocity2=V._limitVelocityGradients[1].getFactor():h._currentLimitVelocity2=h._currentLimitVelocity1}function Th(h,V){u.GetCurrentGradient(V._ratio,V._velocityGradients,((i,S,l)=>{i!==h._currentVelocityGradient&&(h._currentVelocity1=h._currentVelocity2,h._currentVelocity2=S.getFactor(),h._currentVelocityGradient=i),V._directionScale*=(0,J.Lerp)(h._currentVelocity1,h._currentVelocity2,l)}))}function eh(h,V){u.GetCurrentGradient(V._ratio,V._limitVelocityGradients,((i,S,l)=>{i!==h._currentLimitVelocityGradient&&(h._currentLimitVelocity1=h._currentLimitVelocity2,h._currentLimitVelocity2=S.getFactor(),h._currentLimitVelocityGradient=i);const Y=(0,J.Lerp)(h._currentLimitVelocity1,h._currentLimitVelocity2,l);h.direction.length()>Y&&h.direction.scaleInPlace(V.limitVelocityDamping)}))}function nh(h,V){h.direction.scaleToRef(V._directionScale,V._scaledDirection)}function ch(h,V){V.particleEmitterType.startPositionFunction(V._emitterWorldMatrix,h.position,h,V.isLocal)}function fh(h,V){V.startPositionFunction(V._emitterWorldMatrix,h.position,h,V.isLocal)}function Ph(h,V){h.Nq?h.Nq.l(h.position):h.Nq=h.position.clone(),S.nV.TransformCoordinatesToRef(h.Nq,V._emitterWorldMatrix,h.position)}function Lh(h,V){V.isLocal&&h.Nq?(h.Nq.addInPlace(V._scaledDirection),S.nV.TransformCoordinatesToRef(h.Nq,V._emitterWorldMatrix,h.position)):h.position.addInPlace(V._scaledDirection)}function Uh(h,V){h._currentDragGradient=V._dragGradients[0],h._currentDrag1=h._currentDragGradient.getFactor(),V._dragGradients.length>1?h._currentDrag2=V._dragGradients[1].getFactor():h._currentDrag2=h._currentDrag1}function Xh(h,V){u.GetCurrentGradient(V._ratio,V._dragGradients,((i,S,l)=>{i!==h._currentDragGradient&&(h._currentDrag1=h._currentDrag2,h._currentDrag2=S.getFactor(),h._currentDragGradient=i);const Y=(0,J.Lerp)(h._currentDrag1,h._currentDrag2,l);V._scaledDirection.scaleInPlace(1-Y)}))}function Dh(h,V){h._randomNoiseCoordinates1?(h._randomNoiseCoordinates1.qq(Math.random(),Math.random(),Math.random()),h._randomNoiseCoordinates2.qq(Math.random(),Math.random(),Math.random())):(h._randomNoiseCoordinates1=new S.nV(Math.random(),Math.random(),Math.random()),h._randomNoiseCoordinates2=new S.nV(Math.random(),Math.random(),Math.random()))}function Oh(h,V){const i=V._noiseTextureData,l=V._noiseTextureSize;if(i&&l&&h._randomNoiseCoordinates1){const Y=V._fetchR(h._randomNoiseCoordinates1.x,h._randomNoiseCoordinates1.y,l.width,l.height,i),g=V._fetchR(h._randomNoiseCoordinates1.z,h._randomNoiseCoordinates2.x,l.width,l.height,i),q=V._fetchR(h._randomNoiseCoordinates2.y,h._randomNoiseCoordinates2.z,l.width,l.height,i),B=S.TmpVectors.nV[0],J=S.TmpVectors.nV[1];B.qq((2*Y-1)*V.noiseStrength.x,(2*g-1)*V.noiseStrength.y,(2*q-1)*V.noiseStrength.z),B.scaleToRef(V._tempScaledUpdateSpeed,J),h.direction.addInPlace(J)}}function oh(h,V){V.gravity.scaleToRef(V._tempScaledUpdateSpeed,V._scaledGravity),h.direction.addInPlace(V._scaledGravity)}function Mh(h,V){h.size=(0,J.RandomRange)(V.minSize,V.maxSize),h.scale.qq((0,J.RandomRange)(V.minScaleX,V.maxScaleX),(0,J.RandomRange)(V.minScaleY,V.maxScaleY))}function Fh(h,V){h._currentSizeGradient=V._sizeGradients[0],h._currentSize1=h._currentSizeGradient.getFactor(),h.size=h._currentSize1,V._sizeGradients.length>1?h._currentSize2=V._sizeGradients[1].getFactor():h._currentSize2=h._currentSize1,h.scale.qq((0,J.RandomRange)(V.minScaleX,V.maxScaleX),(0,J.RandomRange)(V.minScaleY,V.maxScaleY))}function Eh(h,V){const i=V._actualFrame/V.targetStopDuration;u.GetCurrentGradient(i,V._startSizeGradients,((i,S,l)=>{i!==V._currentStartSizeGradient&&(V._currentStartSize1=V._currentStartSize2,V._currentStartSize2=S.getFactor(),V._currentStartSizeGradient=i);const Y=(0,J.Lerp)(V._currentStartSize1,V._currentStartSize2,l);h.scale.scaleInPlace(Y)}))}function Hh(h,V){u.GetCurrentGradient(V._ratio,V._sizeGradients,((V,i,S)=>{V!==h._currentSizeGradient&&(h._currentSize1=h._currentSize2,h._currentSize2=i.getFactor(),h._currentSizeGradient=V),h.size=(0,J.Lerp)(h._currentSize1,h._currentSize2,S)}))}function jh(h,V){h.remapData=new S.Vector4(0,1,0,1)}function mh(h,V){V._colorRemapGradients&&V._colorRemapGradients.length>0&&u.GetCurrentGradient(V._ratio,V._colorRemapGradients,((V,i,S)=>{const l=(0,J.Lerp)(V.factor1,i.factor1,S),Y=(0,J.Lerp)(V.factor2,i.factor2,S);h.remapData.x=l,h.remapData.y=Y-l})),V._alphaRemapGradients&&V._alphaRemapGradients.length>0&&u.GetCurrentGradient(V._ratio,V._alphaRemapGradients,((V,i,S)=>{const l=(0,J.Lerp)(V.factor1,i.factor1,S),Y=(0,J.Lerp)(V.factor2,i.factor2,S);h.remapData.z=l,h.remapData.w=Y-l}))}function Gh(h,V){const i=(0,J.Clamp)(V._actualFrame/V.targetStopDuration);u.GetCurrentGradient(i,V._lifeTimeGradients,((V,S)=>{const l=V,Y=S,g=l.getFactor(),q=Y.getFactor(),B=(i-l.gradient)/(Y.gradient-l.gradient);h.lifeTime=(0,J.Lerp)(g,q,B)})),V._emitPower=(0,J.RandomRange)(V.minEmitPower,V.maxEmitPower)}function wh(h,V){h.lifeTime=(0,J.RandomRange)(V.minLifeTime,V.maxLifeTime),V._emitPower=(0,J.RandomRange)(V.minEmitPower,V.maxEmitPower)}function Nh(h,V){0===V._emitPower?(h._initialDirection?h._initialDirection.l(h.direction):h._initialDirection=h.direction.clone(),h.direction.set(0,0,0)):(h._initialDirection=null,h.direction.scaleInPlace(V._emitPower)),h.direction.addInPlace(V._inheritedVelocityOffset)}function rh(h,V){h.angularSpeed=(0,J.RandomRange)(V.minAngularSpeed,V.maxAngularSpeed),h.angle=(0,J.RandomRange)(V.minInitialRotation,V.maxInitialRotation)}function kh(h,V){h._currentAngularSpeedGradient=V._angularSpeedGradients[0],h.angularSpeed=h._currentAngularSpeedGradient.getFactor(),h._currentAngularSpeed1=h.angularSpeed,V._angularSpeedGradients.length>1?h._currentAngularSpeed2=V._angularSpeedGradients[1].getFactor():h._currentAngularSpeed2=h._currentAngularSpeed1,h.angle=(0,J.RandomRange)(V.minInitialRotation,V.maxInitialRotation)}function Rh(h,V){h._initialStartSpriteCellId=V.startSpriteCellID,h._initialEndSpriteCellId=V.endSpriteCellID,h._initialSpriteCellLoop=V.spriteCellLoop}function Zh(h,V){h.previousItem=V.previousItem,h.nextItem=V,V.previousItem&&(V.previousItem.nextItem=h),V.previousItem=h}function zh(h,V){h.previousItem=V,h.nextItem=V.nextItem,V.nextItem&&(V.nextItem.previousItem=h),V.nextItem=h}function dh(h,V){let i=V;for(;i.nextItem;)i=i.nextItem;h.previousItem=i,h.nextItem=i.nextItem,i.nextItem=h}function xh(h){h.previousItem&&(h.previousItem.nextItem=h.nextItem),h.nextItem&&(h.nextItem.previousItem=h.previousItem)}class yh extends B{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(h){this._startDirectionFunction!==h&&(this._startDirectionFunction=h,this._directionProcessing.process=h?vh:Ih)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(h){this._startPositionFunction!==h&&(this._startPositionFunction=h,this._positionCreation.process=h?fh:ch)}set onDispose(h){this._onDisposeObserver&&this.Ig.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ig.add(h)}get B(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(h){this._useRampGradients!==h&&(this._useRampGradients=h,this._resetEffect(),h?(this._rampCreation={process:jh,previousItem:null,nextItem:null},zh(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:mh,previousItem:null,nextItem:null},zh(this._remapGradientProcessing,this._gravityProcessing)):(xh(this._rampCreation),xh(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(h){this._isLocal!==h&&(this._isLocal=h,h?(this._isLocalCreation={process:Ph,previousItem:null,nextItem:null},zh(this._isLocalCreation,this._positionCreation)):xh(this._isLocalCreation))}get particles(){return this.Hv}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(h){this._animationSheetEnabled!==h&&(this._animationSheetEnabled=h,h?(this._sheetCreation={process:Rh,previousItem:null,nextItem:null},zh(this._sheetCreation,this._colorCreation)):xh(this._sheetCreation),this._reset())}getActiveCount(){return this.Hv.length}getClassName(){return"OT"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var h;let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(h=this._customWrappers[V])||void 0===h?void 0:h.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[h]??this._customWrappers[0]}setCustomEffect(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[V]=new hh.b(this._engine),this._customWrappers[V].effect=h,this._customWrappers[V].drawContext&&(this._customWrappers[V].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new p.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(h){if(this.noiseTexture!==h){if(this._noiseTexture=h,!h)return xh(this._noiseCreation),void xh(this._noiseProcessing);this._noiseCreation={process:Dh,previousItem:null,nextItem:null},zh(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Oh,previousItem:null,nextItem:null},zh(this._noiseProcessing,this._positionProcessing)}}constructor(h,V,i){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4&&void 0!==arguments[4]&&arguments[4],q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(h),this._emitterInverseWorldMatrix=S.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new S.nV,this.Ig=new p.d,this.onStoppedObservable=new p.d,this.onStartedObservable=new p.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.Hv=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new g.vq(0,0,0,0),this._colorDiff=new g.vq(0,0,0,0),this._scaledDirection=S.nV.Zero(),this._scaledGravity=S.nV.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=h=>{},this.recycleParticle=h=>{const V=this.Hv.pop();V!==h&&V.copyTo(h),this._stockParticles.push(V)},this._createParticle=()=>{let h;return 0!==this._stockParticles.length?(h=this._stockParticles.pop(),h._reset()):h=new K(this),this._prepareParticle(h),h},this.paused=!1,this._shadersLoaded=!1,this._capacity=V,this._epsilon=q,i&&"Scene"!==i.getClassName()?(this._engine=i,this.defaultProjectionMatrix=S.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=i||a.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Fv.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:wh,previousItem:null,nextItem:null},this._positionCreation={process:ch,previousItem:null,nextItem:null},zh(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Ih,previousItem:null,nextItem:null},zh(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Nh,previousItem:null,nextItem:null},zh(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Mh,previousItem:null,nextItem:null},zh(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:rh,previousItem:null,nextItem:null},zh(this._angleCreation,this._sizeCreation),this._colorCreation={process:lh,previousItem:null,nextItem:null},zh(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,B||(this._colorProcessing={process:qh,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Jh,previousItem:null,nextItem:null},zh(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:nh,previousItem:null,nextItem:null},zh(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Lh,previousItem:null,nextItem:null},zh(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:oh,previousItem:null,nextItem:null},zh(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=Y,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new hh.b(this._engine)},this._customWrappers[0].effect=l,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new v,this.updateFunction=h=>{var V;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(V=this.noiseTexture.getContent())||void 0===V||V.then((h=>{this._noiseTextureData=h})));const i=h===this.Hv;for(let S=0;S<h.length;S++){const V=h[S];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const l=V.age;if(V.age+=this._tempScaledUpdateSpeed,V.age>V.lifeTime){const h=V.age-l,i=V.lifeTime-l;this._tempScaledUpdateSpeed=i*this._tempScaledUpdateSpeed/h,V.age=V.lifeTime}this._ratio=V.age/V.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let Y=this._updateQueueStart;for(;Y;)Y.process(V,this),Y=Y.nextItem;if(this._isAnimationSheetEnabled&&!B&&V.updateCellIndex(),V._inheritParticleInfoToSubEmitters(),V.age>=V.lifeTime){if(this._emitFromParticle(V),V._attachedSubEmitters){for(const h of V._attachedSubEmitters)h.particleSystem.disposeOnStop=!0,h.particleSystem.stop();V._attachedSubEmitters=null}this.recycleParticle(V),i&&S--}else;}}}serialize(h){throw new Error("Method not implemented.")}clone(h,V){throw new Error("Method not implemented.")}_addFactorGradient(h,V,i,S){const l=new C(V,i,S);h.push(l),h.sort(((h,V)=>h.gradient<V.gradient?-1:h.gradient>V.gradient?1:0))}_removeFactorGradient(h,V){if(!h)return;let i=0;for(const S of h){if(S.gradient===V){h.splice(i,1);break}i++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Gh:this._lifeTimeCreation.process=wh}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Eh,previousItem:null,nextItem:null},zh(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(xh(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(h){this.targetStopDuration!==h&&(this._targetStopDuration=h,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(h,V,i){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,h,V,i),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(h){return this._removeFactorGradient(this._lifeTimeGradients,h),this._syncLifeTimeCreation(),this}addSizeGradient(h,V,i){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Fh,this._sizeGradientProcessing={process:Hh,previousItem:null,nextItem:null},Zh(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,h,V,i),this}removeSizeGradient(h){var V;return this._removeFactorGradient(this._sizeGradients,h),0===(null===(V=this._sizeGradients)||void 0===V?void 0:V.length)&&(xh(this._sizeGradientProcessing),this._sizeCreation.process=Mh),this}addColorRemapGradient(h,V,i){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,h,V,i),this}removeColorRemapGradient(h){return this._removeFactorGradient(this._colorRemapGradients,h),this}addAlphaRemapGradient(h,V,i){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,h,V,i),this}removeAlphaRemapGradient(h){return this._removeFactorGradient(this._alphaRemapGradients,h),this}addAngularSpeedGradient(h,V,i){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=kh,this._angularSpeedGradientProcessing={process:Bh,previousItem:null,nextItem:null},Zh(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,h,V,i),this}removeAngularSpeedGradient(h){var V;return this._removeFactorGradient(this._angularSpeedGradients,h),0===(null===(V=this._angularSpeedGradients)||void 0===V?void 0:V.length)&&(this._angleCreation.process=rh,xh(this._angularSpeedGradientProcessing)),this}addVelocityGradient(h,V,i){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:sh,previousItem:null,nextItem:null},zh(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Th,previousItem:null,nextItem:null},Zh(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,h,V,i),this}removeVelocityGradient(h){var V;return this._removeFactorGradient(this._velocityGradients,h),0===(null===(V=this._velocityGradients)||void 0===V?void 0:V.length)&&(xh(this._velocityCreation),xh(this._velocityGradientProcessing)),this}addLimitVelocityGradient(h,V,i){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:th,previousItem:null,nextItem:null},zh(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:eh,previousItem:null,nextItem:null},zh(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,h,V,i),this}removeLimitVelocityGradient(h){var V;return this._removeFactorGradient(this._limitVelocityGradients,h),0===(null===(V=this._limitVelocityGradients)||void 0===V?void 0:V.length)&&(xh(this._limitVelocityCreation),xh(this._limitVelocityGradientProcessing)),this}addDragGradient(h,V,i){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Uh,previousItem:null,nextItem:null},Zh(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Xh,previousItem:null,nextItem:null},Zh(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,h,V,i),this}removeDragGradient(h){var V;return this._removeFactorGradient(this._dragGradients,h),0===(null===(V=this._dragGradients)||void 0===V?void 0:V.length)&&(xh(this._dragCreation),xh(this._dragGradientProcessing)),this}addEmitRateGradient(h,V,i){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,h,V,i),this}removeEmitRateGradient(h){return this._removeFactorGradient(this._emitRateGradients,h),this}addStartSizeGradient(h,V,i){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,h,V,i),this._syncStartSizeCreation(),this}removeStartSizeGradient(h){return this._removeFactorGradient(this._startSizeGradients,h),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const h=new Uint8Array(4*this._rawTextureWidth),V=g.TmpColors.LV[0];for(let i=0;i<this._rawTextureWidth;i++){const S=i/this._rawTextureWidth;u.GetCurrentGradient(S,this._rampGradients,((S,l,Y)=>{g.LV.LerpToRef(S.color,l.color,Y,V),h[4*i]=255*V.r,h[4*i+1]=255*V.g,h[4*i+2]=255*V.b,h[4*i+3]=255}))}this._rampGradientsTexture=W.d.CreateRGBATexture(h,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((h,V)=>h.gradient<V.gradient?-1:h.gradient>V.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(h,V){this._rampGradients||(this._rampGradients=[]);const i=new b(h,V);return this._rampGradients.push(i),this._syncRampGradientTexture(),this}removeRampGradient(h){return this._removeGradientAndTexture(h,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(h,V,i){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Yh,this._colorProcessing.process=gh);const S=new A(h,V,i);return this._colorGradients.push(S),this._colorGradients.sort(((h,V)=>h.gradient<V.gradient?-1:h.gradient>V.gradient?1:0)),this}removeColorGradient(h){if(!this._colorGradients)return this;let V=0;for(const i of this._colorGradients){if(i.gradient===h){this._colorGradients.splice(V,1);break}V++}return 0===this._colorGradients.length&&(this._colorCreation.process=lh,this._colorProcessing.process=qh),this}resetDrawCache(){if(this._drawWrappers){for(const h of this._drawWrappers)if(h)for(const V of h)null===V||void 0===V||V.dispose();this._drawWrappers=[]}}_fetchR(h,V,i,S,l){return l[4*(((h=.5*Math.abs(h)+.5)*i%i|0)+((V=.5*Math.abs(V)+.5)*S%S|0)*i)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const h=this._engine,V=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*V),this._vertexBuffer=new U.e(h,this._vertexData,!0,V);let i=0;const S=this._vertexBuffer.createVertexBuffer(U.h.PositionKind,i,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[U.h.PositionKind]=S,i+=3;const l=this._vertexBuffer.createVertexBuffer(U.h.ColorKind,i,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[U.h.ColorKind]=l,i+=4;const Y=this._vertexBuffer.createVertexBuffer("angle",i,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=Y,i+=1;const g=this._vertexBuffer.createVertexBuffer("size",i,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=g,i+=2,this._isAnimationSheetEnabled){const h=this._vertexBuffer.createVertexBuffer("cellIndex",i,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=h,i+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const h=this._vertexBuffer.createVertexBuffer("direction",i,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=h,i+=3}if(this._useRampGradients){const h=this._vertexBuffer.createVertexBuffer("remapData",i,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=h,i+=4}let q;if(this._useInstancing){const V=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new U.e(h,V,!1,2),q=this._spriteBuffer.createVertexBuffer("offset",0,2)}else q=this._vertexBuffer.createVertexBuffer("offset",i,2,this._vertexBufferSize,this._useInstancing),i+=2;this._vertexBuffers.offset=q,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const h=[],V=[];let i=0;for(let S=0;S<this._capacity;S++)h.push(i),h.push(i+1),h.push(i+2),h.push(i),h.push(i+2),h.push(i+3),V.push(i,i+1,i+1,i+2,i+2,i+3,i+3,i,i,i+3),i+=4;this._indexBuffer=this._engine.createIndexBuffer(h),this._linesIndexBuffer=this._engine.createIndexBuffer(V)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(h)setTimeout((()=>{this.start(0)}),h);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var V;-1!==(null===(V=this.k)||void 0===V?void 0:V.getClassName().indexOf("Mesh"))&&this.k.Ag(!0);const h=this.noiseTexture;if(h&&h.onGeneratedObservable)h.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let V=0;V<this.preWarmCycles;V++)this.animate(!0),h.render()}))}));else for(let V=0;V<this.preWarmCycles;V++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(h))}_postStop(h){}reset(){this._stockParticles.length=0,this.Hv.length=0}_appendParticleVertex(h,V,i,l){let Y=h*this._vertexBufferSize;if(this._vertexData[Y++]=V.position.x+this.CB.x,this._vertexData[Y++]=V.position.y+this.CB.y,this._vertexData[Y++]=V.position.z+this.CB.z,this._vertexData[Y++]=V.color.r,this._vertexData[Y++]=V.color.g,this._vertexData[Y++]=V.color.b,this._vertexData[Y++]=V.color.a,this._vertexData[Y++]=V.angle,this._vertexData[Y++]=V.scale.x*V.size,this._vertexData[Y++]=V.scale.y*V.size,this._isAnimationSheetEnabled&&(this._vertexData[Y++]=V.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[Y++]=V.direction.x,this._vertexData[Y++]=V.direction.y,this._vertexData[Y++]=V.direction.z);else if(V._initialDirection){let h=V._initialDirection;this.isLocal&&(S.nV.TransformNormalToRef(h,this._emitterWorldMatrix,S.TmpVectors.nV[0]),h=S.TmpVectors.nV[0]),0===h.x&&0===h.z&&(h.x=.001),this._vertexData[Y++]=h.x,this._vertexData[Y++]=h.y,this._vertexData[Y++]=h.z}else{let h=V.direction;this.isLocal&&(S.nV.TransformNormalToRef(h,this._emitterWorldMatrix,S.TmpVectors.nV[0]),h=S.TmpVectors.nV[0]),0===h.x&&0===h.z&&(h.x=.001),this._vertexData[Y++]=h.x,this._vertexData[Y++]=h.y,this._vertexData[Y++]=h.z}this._useRampGradients&&V.remapData&&(this._vertexData[Y++]=V.remapData.x,this._vertexData[Y++]=V.remapData.y,this._vertexData[Y++]=V.remapData.z,this._vertexData[Y++]=V.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),0===l?l=this._epsilon:1===l&&(l=1-this._epsilon)),this._vertexData[Y++]=i,this._vertexData[Y++]=l)}_prepareParticle(h){}_createNewOnes(h){let V;for(let i=0;i<h&&this.Hv.length!==this._capacity;i++){V=this._createParticle(),this.Hv.push(V);let h=this._createQueueStart;for(;h;)h.process(V,this),h=h.nextItem;V._inheritParticleInfoToSubEmitters()}}_update(h){if(this._alive=this.Hv.length>0,this.k.position){const h=this.k;this._emitterWorldMatrix=h.getWorldMatrix()}else{const h=this.k;this._emitterWorldMatrix=S.Matrix.Translation(h.x,h.y,h.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Hv),this._createNewOnes(h)}static _GetAttributeNamesOrOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=[U.h.PositionKind,U.h.ColorKind,"angle","offset","size"];return h&&S.push("cellIndex"),V||S.push("direction"),i&&S.push("remapData"),S}static _GetEffectCreationOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Vh.d)(S),h&&S.push("particlesInfos"),V&&S.push("logarithmicDepthConstant"),i&&(S.push("vFogInfos"),S.push("vFogColor")),S}fillDefines(h,V){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Vh.o)(this,this._scene,h),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&h.push("#define FOG")),this._isAnimationSheetEnabled&&h.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&h.push("#define LOGARITHMICDEPTH"),V===B.BLENDMODE_MULTIPLY&&h.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&h.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(h.push("#define BILLBOARD"),this.billboardMode){case 2:h.push("#define BILLBOARDY");break;case 8:case 9:h.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&h.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:h.push("#define BILLBOARDMODE_ALL")}i&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),h.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(h,V,i){V.push(...yh._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),h.push(...yh._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),i.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Sh.d)(h,this._imageProcessingConfigurationDefines),(0,Sh.c)(i,this._imageProcessingConfigurationDefines))}_getWrapper(h){const V=this._getCustomDrawWrapper(h);if(null!==V&&void 0!==V&&V.effect)return V;const i=[];this.fillDefines(i,h);const S=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let l=this._drawWrappers[S];l||(l=this._drawWrappers[S]=[]);let Y=l[h];Y||(Y=new hh.b(this._engine),Y.drawContext&&(Y.drawContext.useInstancing=this._useInstancing),l[h]=Y);const g=i.join("\n");if(Y.defines!==g){const h=[],V=[],i=[];this.fillUniformsAttributesAndSamplerNames(V,h,i),Y.setEffect(this._engine.createEffect("particles",h,V,i,g,void 0,void 0,void 0,void 0,this._shaderLanguage),g)}return Y}animate(){var h;let V,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!i&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(i?this.preWarmStepOffset:(null===(h=this._scene)||void 0===h?void 0:h.getAnimationRatio())||1),this.manualEmitCount>-1)V=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let h=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const V=this._actualFrame/this.targetStopDuration;u.GetCurrentGradient(V,this._emitRateGradients,((V,i,S)=>{V!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=i.getFactor(),this._currentEmitRateGradient=V),h=(0,J.Lerp)(this._currentEmitRate1,this._currentEmitRate2,S)}))}V=h*this._scaledUpdateSpeed|0,this._newPartsExcess+=h*this._scaledUpdateSpeed-V}if(this._newPartsExcess>1&&(V+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?V=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(V),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!i){let h=0;for(let V=0;V<this.Hv.length;V++){const i=this.Hv[V];this._appendParticleVertices(h,i),h+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Hv.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(h,V){this._appendParticleVertex(h++,V,0,0),this._useInstancing||(this._appendParticleVertex(h++,V,1,0),this._appendParticleVertex(h++,V,1,1),this._appendParticleVertex(h++,V,0,1))}rebuild(){var h;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(h=this._spriteBuffer)||void 0===h||h._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!yh.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(i.bind(i,12568)),Promise.resolve().then(i.bind(i,12520))])):await Promise.all([Promise.resolve().then(i.bind(i,12508)),Promise.resolve().then(i.bind(i,12498))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==B.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(B.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(B.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(h){const V=this._getWrapper(h),i=V.effect,l=this._engine;l.enableEffect(V);const Y=this.defaultViewMatrix??this._scene.getViewMatrix();if(i.setTexture("diffuseSampler",this.particleTexture),i.setMatrix("view",Y),i.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const h=this.particleTexture.getBaseSize();i.setFloat3("particlesInfos",this.spriteCellWidth/h.width,this.spriteCellHeight/h.height,this.spriteCellWidth/h.width)}if(i.setVector2("translationPivot",this.translationPivot),i.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const h=this._scene.activeCamera;i.setVector3("eyePosition",h.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),i.setTexture("rampSampler",this._rampGradientsTexture));const g=i.defines;var q,B,J,I,v,s;(this._scene&&((0,Vh.g)(i,this,this._scene),this.applyFog&&(0,ih.e)(this._scene,void 0,i)),g.indexOf("#define BILLBOARDMODE_ALL")>=0&&(Y.invertToRef(S.TmpVectors.Matrix[0]),i.setMatrix("invView",S.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?l.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,i):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,i)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?l.bindBuffers(this._vertexBuffers,null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._linesIndexBuffer:this._indexBuffer,i):l.bindBuffers(this._vertexBuffers,null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?this._linesIndexBufferUseInstancing:null,i);(this.useLogarithmicDepth&&this._scene&&(0,ih.j)(g,i,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(i),this._setEngineBasedOnBlendMode(h),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(i),this._useInstancing)?null!==(v=this._scene)&&void 0!==v&&v.forceWireframe?l.drawElementsType(6,0,10,this.Hv.length):l.drawArraysType(7,0,4,this.Hv.length):null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?l.drawElementsType(1,0,10*this.Hv.length):l.drawElementsType(0,0,6*this.Hv.length);return this.Hv.length}render(){if(!this.isReady()||!this.Hv.length)return 0;const h=this._engine;h.setState&&(h.setState(!1),this.forceDepthWrite&&h.setDepthWrite(!0));let V=0;return V=this.blendMode===B.BLENDMODE_MULTIPLYADD?this._render(B.BLENDMODE_MULTIPLY)+this._render(B.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),V}_onDispose(){}dispose(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),h&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),h&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(V,i),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const h=this._scene.Fv.indexOf(this);h>-1&&this._scene.Fv.splice(h,1),this._scene._activeParticleSystems.dispose()}this.Ig.notifyObservers(this),this.Ig.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}yh.ForceGLSL=!1;var Qh,Ah=i(10980);!function(h){h[h.ATTACHED=0]="ATTACHED",h[h.END=1]="END"}(Qh||(Qh={}));class bh{constructor(h){if(this.particleSystem=h,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!h.k||!h.k.dispose){const V=(0,q.b)("BABYLON.AbstractMesh");h.k=new V("SubemitterSystemEmitter",h.Mh()),h._disposeEmitterOnDispose=!0}}clone(){let h=this.particleSystem.k;if(h){if(h instanceof S.nV)h=h.clone();else if(-1!==h.getClassName().indexOf("Mesh")){h=new((0,q.b)("BABYLON.Mesh"))("",h.Mh()),h.isVisible=!1}}else h=new S.nV;const V=new bh(this.particleSystem.clone(this.particleSystem.name,h));return V.particleSystem.name+="Clone",V.type=this.type,V.inheritDirection=this.inheritDirection,V.inheritedVelocityAmount=this.inheritedVelocityAmount,V.particleSystem._disposeEmitterOnDispose=!0,V.particleSystem.disposeOnStop=!0,V}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V={};return V.type=this.type,V.inheritDirection=this.inheritDirection,V.inheritedVelocityAmount=this.inheritedVelocityAmount,V.particleSystem=this.particleSystem.serialize(h),V}static _ParseParticleSystem(h,V,i){throw(0,Ah.d)("ParseParticle")}static Parse(h,V,i){const S=h.particleSystem,l=new bh(bh._ParseParticleSystem(S,V,i,!0));return l.type=h.type,l.inheritDirection=h.inheritDirection,l.inheritedVelocityAmount=h.inheritedVelocityAmount,l.particleSystem._isSubEmitter=!0,l}dispose(){this.particleSystem.dispose()}}var Ch=i(11028);function uh(h,V){const i=new c;return i.direction1=h,i.direction2=V,i}function ph(){return new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Wh(){return new f(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ah(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.nV(0,1,0),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.nV(0,1,0);return new P(h,V,i)}function Kh(){return new T(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function hV(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.nV(0,1,0),Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.nV(0,1,0);return new e(h,V,i,l,Y)}function VV(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new s(h,V)}function iV(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.nV(0,1,0),l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.nV(0,1,0);return new t(h,V,i,l)}const SV=S.nV.Zero(),lV=S.nV.Zero(),YV=S.nV.Zero();class gV{constructor(){this.strength=0,this.position=S.nV.Zero()}_processParticle(h,V){this.position.subtractToRef(h.position,SV);const i=SV.lengthSquared()+1;SV.normalize().scaleToRef(this.strength/i,lV),lV.scaleToRef(V._tempScaledUpdateSpeed,YV),h.direction.addInPlace(YV)}serialize(){return{position:this.position.Ng(),strength:this.strength}}}class qV extends yh{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=h=>{if(!this._subEmitters||0===this._subEmitters.length)return;const V=Math.floor(Math.random()*this._subEmitters.length);for(const i of this._subEmitters[V])if(1===i.type){const V=i.clone();h._inheritParticleInfoToSubEmitter(V),V.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(V.particleSystem),V.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(h,V){const i=uh(h,V);return this.particleEmitterType=i,i}get flowMap(){return this._flowMap}set flowMap(h){this._flowMap!==h&&(this._flowMap=h,this._flowMapUpdate&&(xh(this._flowMapUpdate),this._flowMapUpdate=null),h&&(this._flowMapUpdate={process:h=>{var V;const i=null===(V=this.Mh())||void 0===V?void 0:V.getTransformMatrix();this._flowMap._processParticle(h,this.flowMapStrength*this._tempScaledUpdateSpeed,i)},previousItem:null,nextItem:null},zh(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(h){this._attractors.push(h),1===this._attractors.length&&(this._attractorUpdate={process:h=>{for(const V of this._attractors)V._processParticle(h,this)},previousItem:null,nextItem:null},zh(this._attractorUpdate,this._directionProcessing))}removeAttractor(h){const V=this._attractors.indexOf(h);-1!==V&&this._attractors.splice(V,1),0===this._attractors.length&&xh(this._attractorUpdate)}start(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(h)}createHemisphericEmitter(){const h=ph(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createSphereEmitter(){const h=Wh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createDirectedSphereEmitter(){const h=ah(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.nV(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.nV(0,1,0));return this.particleEmitterType=h,h}createCylinderEmitter(){const h=Kh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=h,h}createDirectedCylinderEmitter(){const h=hV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.nV(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.nV(0,1,0));return this.particleEmitterType=h,h}createConeEmitter(){const h=VV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=h,h}createDirectedConeEmitter(){const h=iV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.nV(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.nV(0,1,0));return this.particleEmitterType=h,h}createBoxEmitter(h,V,i,S){const l=new v;return this.particleEmitterType=l,this.direction1=h,this.direction2=V,this.minEmitBox=i,this.maxEmitBox=S,l}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const h of this.subEmitters)h instanceof qV?this._subEmitters.push([new bh(h)]):h instanceof bh?this._subEmitters.push([h]):h instanceof Array&&this._subEmitters.push(h)}_stopSubEmitters(){if(this.activeSubSystems){for(const h of this.activeSubSystems)h.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const h=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==h&&this._rootParticleSystem.activeSubSystems.splice(h,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(h){h&&this._stopSubEmitters()}_prepareParticle(h){if(this._subEmitters&&this._subEmitters.length>0){const V=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];h._attachedSubEmitters=[];for(const i of V)if(0===i.type){const V=i.clone();h._attachedSubEmitters.push(V),V.particleSystem.start()}}}_onDispose(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),h&&this.particles)for(const i of this.particles)if(i._attachedSubEmitters)for(let h=i._attachedSubEmitters.length-1;h>=0;h-=1)i._attachedSubEmitters[h].dispose();if(V&&this.activeSubSystems)for(let i=this.activeSubSystems.length-1;i>=0;i-=1)this.activeSubSystems[i].dispose();if(this._subEmitters&&this._subEmitters.length){for(let h=0;h<this._subEmitters.length;h++)for(const V of this._subEmitters[h])V.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(h,V,i,l){let Y;Y=i instanceof Ch.b?null:i;const B=(0,q.b)("BABYLON.Texture");if(B&&Y&&(h.texture?V.particleTexture=B.Parse(h.texture,Y,l):h.textureName&&(V.particleTexture=new B(l+h.textureName,Y,!1,void 0===h.invertY||h.invertY),V.particleTexture.name=h.textureName)),h.emitterId||0===h.emitterId||void 0!==h.k?h.emitterId&&Y?V.k=Y.getLastMeshById(h.emitterId):V.k=S.nV.UV(h.k):V.k=S.nV.Zero(),V.isLocal=!!h.isLocal,void 0!==h.renderingGroupId&&(V.renderingGroupId=h.renderingGroupId),void 0!==h.isBillboardBased&&(V.isBillboardBased=h.isBillboardBased),void 0!==h.billboardMode&&(V.billboardMode=h.billboardMode),void 0!==h.useLogarithmicDepth&&(V.useLogarithmicDepth=h.useLogarithmicDepth),h.animations){for(let i=0;i<h.animations.length;i++){const S=h.animations[i],l=(0,q.b)("BABYLON.Animation");l&&V.animations.push(l.Parse(S))}V.beginAnimationOnStart=h.beginAnimationOnStart,V.beginAnimationFrom=h.beginAnimationFrom,V.beginAnimationTo=h.beginAnimationTo,V.beginAnimationLoop=h.beginAnimationLoop}if(h.autoAnimate&&Y&&Y.beginAnimation(V,h.autoAnimateFrom,h.autoAnimateTo,h.autoAnimateLoop,h.autoAnimateSpeed||1),V.startDelay=0|h.startDelay,V.minAngularSpeed=h.minAngularSpeed,V.maxAngularSpeed=h.maxAngularSpeed,V.minSize=h.minSize,V.maxSize=h.maxSize,h.minScaleX&&(V.minScaleX=h.minScaleX,V.maxScaleX=h.maxScaleX,V.minScaleY=h.minScaleY,V.maxScaleY=h.maxScaleY),void 0!==h.preWarmCycles&&(V.preWarmCycles=h.preWarmCycles,V.preWarmStepOffset=h.preWarmStepOffset),void 0!==h.minInitialRotation&&(V.minInitialRotation=h.minInitialRotation,V.maxInitialRotation=h.maxInitialRotation),V.minLifeTime=h.minLifeTime,V.maxLifeTime=h.maxLifeTime,V.minEmitPower=h.minEmitPower,V.maxEmitPower=h.maxEmitPower,V.emitRate=h.emitRate,V.gravity=S.nV.UV(h.gravity),h.noiseStrength&&(V.noiseStrength=S.nV.UV(h.noiseStrength)),V.color1=g.vq.UV(h.color1),V.color2=g.vq.UV(h.color2),V.colorDead=g.vq.UV(h.colorDead),V.updateSpeed=h.updateSpeed,V.targetStopDuration=h.targetStopDuration,V.blendMode=h.blendMode,h.colorGradients)for(const S of h.colorGradients)V.addColorGradient(S.gradient,g.vq.UV(S.color1),S.color2?g.vq.UV(S.color2):void 0);if(h.rampGradients){for(const i of h.rampGradients)V.addRampGradient(i.gradient,g.LV.UV(i.color));V.useRampGradients=h.useRampGradients}if(h.colorRemapGradients)for(const S of h.colorRemapGradients)V.addColorRemapGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(h.alphaRemapGradients)for(const S of h.alphaRemapGradients)V.addAlphaRemapGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(h.sizeGradients)for(const S of h.sizeGradients)V.addSizeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(h.angularSpeedGradients)for(const S of h.angularSpeedGradients)V.addAngularSpeedGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(h.velocityGradients)for(const S of h.velocityGradients)V.addVelocityGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(h.dragGradients)for(const S of h.dragGradients)V.addDragGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(h.emitRateGradients)for(const S of h.emitRateGradients)V.addEmitRateGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(h.startSizeGradients)for(const S of h.startSizeGradients)V.addStartSizeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(h.lifeTimeGradients)for(const S of h.lifeTimeGradients)V.addLifeTimeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(h.limitVelocityGradients){for(const i of h.limitVelocityGradients)V.addLimitVelocityGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);V.limitVelocityDamping=h.limitVelocityDamping}if(h.noiseTexture&&Y){const i=(0,q.b)("BABYLON.ProceduralTexture");V.noiseTexture=i.Parse(h.noiseTexture,Y,l)}let J;if(h.particleEmitterType){switch(h.particleEmitterType.type){case"SphereParticleEmitter":J=new f;break;case"SphereDirectedParticleEmitter":J=new P;break;case"ConeEmitter":case"ConeParticleEmitter":J=new s;break;case"ConeDirectedParticleEmitter":J=new t;break;case"CylinderParticleEmitter":J=new T;break;case"CylinderDirectedParticleEmitter":J=new e;break;case"HemisphericParticleEmitter":J=new n;break;case"PointParticleEmitter":J=new c;break;case"MeshParticleEmitter":J=new X;break;case"CustomParticleEmitter":J=new L;break;default:J=new v}J.parse(h.particleEmitterType,Y)}else J=new v,J.parse(h,Y);V.particleEmitterType=J,V.startSpriteCellID=h.startSpriteCellID,V.endSpriteCellID=h.endSpriteCellID,V.spriteCellLoop=h.spriteCellLoop??!0,V.spriteCellWidth=h.spriteCellWidth,V.spriteCellHeight=h.spriteCellHeight,V.spriteCellChangeSpeed=h.spriteCellChangeSpeed,V.spriteRandomStartCell=h.spriteRandomStartCell,V.disposeOnStop=h.disposeOnStop??!1,V.manualEmitCount=h.manualEmitCount??-1}static Parse(h,V,i){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Y=arguments.length>4?arguments[4]:void 0;const q=h.name;let B,J,I=null,v=null;if(V instanceof Ch.b?B=V:(J=V,B=J.getEngine()),h.customShader&&B.createEffectForParticles){v=h.customShader;const V=v.shaderOptions.defines.length>0?v.shaderOptions.defines.join("\n"):"";I=B.createEffectForParticles(v.shaderPath.fragmentElement,v.shaderOptions.uniforms,v.shaderOptions.samplers,V)}const s=new qV(q,Y||h.Pq,V,I,h.isAnimationSheetEnabled);if(s.customShader=v,s._rootUrl=i,h.id&&(s.id=h.id),h.subEmitters){s.subEmitters=[];for(const S of h.subEmitters){const h=[];for(const l of S)h.push(bh.Parse(l,V,i));s.subEmitters.push(h)}}if(h.attractors)for(const g of h.attractors){const h=new gV;h.position=S.nV.UV(g.position),h.strength=g.strength,s.addAttractor(h)}return qV._Parse(h,s,V,i),h.textureMask&&(s.textureMask=g.vq.UV(h.textureMask)),h.CB&&(s.CB=S.nV.UV(h.CB)),h.preventAutoStart&&(s.preventAutoStart=h.preventAutoStart),l||s.preventAutoStart||s.start(),s}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V={};if(qV._Serialize(V,this,h),V.textureMask=this.textureMask.Ng(),V.customShader=this.customShader,V.preventAutoStart=this.preventAutoStart,V.CB=this.CB.Ng(),this.subEmitters){V.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const i of this._subEmitters){const S=[];for(const V of i)S.push(V.serialize(h));V.subEmitters.push(S)}}if(this._attractors&&this._attractors.length){V.attractors=[];for(const h of this._attractors)V.attractors.push(h.serialize())}return V}static _Serialize(h,V,i){if(h.name=V.name,h.id=V.id,h.Pq=V.getCapacity(),h.disposeOnStop=V.disposeOnStop,h.manualEmitCount=V.manualEmitCount,V.k.position){const i=V.k;h.emitterId=i.id}else{const i=V.k;h.k=i.Ng()}V.particleEmitterType&&(h.particleEmitterType=V.particleEmitterType.serialize()),V.particleTexture&&(i?h.texture=V.particleTexture.serialize():(h.textureName=V.particleTexture.name,h.invertY=!!V.particleTexture._invertY)),h.isLocal=V.isLocal,G.d.AppendSerializedAnimations(V,h),h.beginAnimationOnStart=V.beginAnimationOnStart,h.beginAnimationFrom=V.beginAnimationFrom,h.beginAnimationTo=V.beginAnimationTo,h.beginAnimationLoop=V.beginAnimationLoop,h.startDelay=V.startDelay,h.renderingGroupId=V.renderingGroupId,h.isBillboardBased=V.isBillboardBased,h.billboardMode=V.billboardMode,h.minAngularSpeed=V.minAngularSpeed,h.maxAngularSpeed=V.maxAngularSpeed,h.minSize=V.minSize,h.maxSize=V.maxSize,h.minScaleX=V.minScaleX,h.maxScaleX=V.maxScaleX,h.minScaleY=V.minScaleY,h.maxScaleY=V.maxScaleY,h.minEmitPower=V.minEmitPower,h.maxEmitPower=V.maxEmitPower,h.minLifeTime=V.minLifeTime,h.maxLifeTime=V.maxLifeTime,h.emitRate=V.emitRate,h.gravity=V.gravity.Ng(),h.noiseStrength=V.noiseStrength.Ng(),h.color1=V.color1.Ng(),h.color2=V.color2.Ng(),h.colorDead=V.colorDead.Ng(),h.updateSpeed=V.updateSpeed,h.targetStopDuration=V.targetStopDuration,h.blendMode=V.blendMode,h.preWarmCycles=V.preWarmCycles,h.preWarmStepOffset=V.preWarmStepOffset,h.minInitialRotation=V.minInitialRotation,h.maxInitialRotation=V.maxInitialRotation,h.startSpriteCellID=V.startSpriteCellID,h.spriteCellLoop=V.spriteCellLoop,h.endSpriteCellID=V.endSpriteCellID,h.spriteCellChangeSpeed=V.spriteCellChangeSpeed,h.spriteCellWidth=V.spriteCellWidth,h.spriteCellHeight=V.spriteCellHeight,h.spriteRandomStartCell=V.spriteRandomStartCell,h.isAnimationSheetEnabled=V.isAnimationSheetEnabled,h.useLogarithmicDepth=V.useLogarithmicDepth;const S=V.getColorGradients();if(S){h.colorGradients=[];for(const V of S){const i={gradient:V.gradient,color1:V.color1.Ng()};V.color2?i.color2=V.color2.Ng():i.color2=V.color1.Ng(),h.colorGradients.push(i)}}const l=V.getRampGradients();if(l){h.rampGradients=[];for(const V of l){const i={gradient:V.gradient,color:V.color.Ng()};h.rampGradients.push(i)}h.useRampGradients=V.useRampGradients}const Y=V.getColorRemapGradients();if(Y){h.colorRemapGradients=[];for(const V of Y){const i={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?i.factor2=V.factor2:i.factor2=V.factor1,h.colorRemapGradients.push(i)}}const g=V.getAlphaRemapGradients();if(g){h.alphaRemapGradients=[];for(const V of g){const i={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?i.factor2=V.factor2:i.factor2=V.factor1,h.alphaRemapGradients.push(i)}}const q=V.getSizeGradients();if(q){h.sizeGradients=[];for(const V of q){const i={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?i.factor2=V.factor2:i.factor2=V.factor1,h.sizeGradients.push(i)}}const B=V.getAngularSpeedGradients();if(B){h.angularSpeedGradients=[];for(const V of B){const i={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?i.factor2=V.factor2:i.factor2=V.factor1,h.angularSpeedGradients.push(i)}}const J=V.getVelocityGradients();if(J){h.velocityGradients=[];for(const V of J){const i={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?i.factor2=V.factor2:i.factor2=V.factor1,h.velocityGradients.push(i)}}const I=V.getDragGradients();if(I){h.dragGradients=[];for(const V of I){const i={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?i.factor2=V.factor2:i.factor2=V.factor1,h.dragGradients.push(i)}}const v=V.getEmitRateGradients();if(v){h.emitRateGradients=[];for(const V of v){const i={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?i.factor2=V.factor2:i.factor2=V.factor1,h.emitRateGradients.push(i)}}const s=V.getStartSizeGradients();if(s){h.startSizeGradients=[];for(const V of s){const i={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?i.factor2=V.factor2:i.factor2=V.factor1,h.startSizeGradients.push(i)}}const t=V.getLifeTimeGradients();if(t){h.lifeTimeGradients=[];for(const V of t){const i={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?i.factor2=V.factor2:i.factor2=V.factor1,h.lifeTimeGradients.push(i)}}const T=V.getLimitVelocityGradients();if(T){h.limitVelocityGradients=[];for(const V of T){const i={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?i.factor2=V.factor2:i.factor2=V.factor1,h.limitVelocityGradients.push(i)}h.limitVelocityDamping=V.limitVelocityDamping}V.noiseTexture&&(h.noiseTexture=V.noiseTexture.serialize())}clone(h,V){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S={...this._customWrappers};let l=null;const Y=this._engine;if(Y.createEffectForParticles&&null!=this.customShader){l=this.customShader;const h=l.shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"",V=Y.createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,h);S[0]?S[0].effect=V:this.setCustomEffect(V,0)}const g=this.serialize(i),q=qV.Parse(g,this._scene||this._engine,this._rootUrl);return q.name=h,q.customShader=l,q._customWrappers=S,void 0===V&&(V=this.k),this.noiseTexture&&(q.noiseTexture=this.noiseTexture.clone()),q.k=V,this.preventAutoStart||q.start(),q}}qV.BILLBOARDMODE_Y=2,qV.BILLBOARDMODE_ALL=7,qV.BILLBOARDMODE_STRETCHED=8,qV.BILLBOARDMODE_STRETCHED_LOCAL=9,bh._ParseParticleSystem=qV.Parse;var BV=i(11389),JV=i(11382),IV=i(11280);IV.b.prototype.createTransformFeedback=function(){const h=this._gl.createTransformFeedback();if(!h)throw new Error("Unable to create Transform Feedback");return h},IV.b.prototype.deleteTransformFeedback=function(h){this._gl.deleteTransformFeedback(h)},IV.b.prototype.bindTransformFeedback=function(h){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,h)},IV.b.prototype.beginTransformFeedback=function(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(h?this._gl.POINTS:this._gl.TRIANGLES)},IV.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},IV.b.prototype.setTranformFeedbackVaryings=function(h,V){this._gl.transformFeedbackVaryings(h,V,this._gl.INTERLEAVED_ATTRIBS)},IV.b.prototype.bindTransformFeedbackBuffer=function(h){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,h?h.underlyingResource:null)},IV.b.prototype.readTransformFeedbackBuffer=function(h){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,h)};const vV="clipPlaneFragmentDeclaration2",sV="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";O.d.IncludesShadersStore[vV]||(O.d.IncludesShadersStore[vV]=sV);i(12411),i(12417),i(12425),i(12428),i(12431),i(12434),i(12440),i(12442);const tV="gpuRenderParticlesPixelShader",TV="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";O.d.ShadersStore[tV]||(O.d.ShadersStore[tV]=TV);const eV="clipPlaneVertexDeclaration2",nV="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";O.d.IncludesShadersStore[eV]||(O.d.IncludesShadersStore[eV]=nV);i(12446),i(12452),i(12455),i(12461);const cV="gpuRenderParticlesVertexShader",fV="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";O.d.ShadersStore[cV]||(O.d.ShadersStore[cV]=fV);class PV extends B{static get IsSupported(){if(!a.d.LastCreatedEngine)return!1;const h=a.d.LastCreatedEngine.getCaps();return h.supportTransformFeedbacks||h.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(h){this._maxActiveParticleCount=Math.min(h,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(h){this.maxActiveParticleCount=h}createPointEmitter(h,V){const i=uh(h,V);return this.particleEmitterType=i,i}createHemisphericEmitter(){const h=ph(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createSphereEmitter(){const h=Wh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createDirectedSphereEmitter(){const h=ah(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.nV(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.nV(0,1,0));return this.particleEmitterType=h,h}createCylinderEmitter(){const h=Kh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=h,h}createDirectedCylinderEmitter(){const h=hV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.nV(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.nV(0,1,0));return this.particleEmitterType=h,h}createConeEmitter(){const h=VV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=h,h}createDirectedConeEmitter(){const h=iV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.nV(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.nV(0,1,0));return this.particleEmitterType=h,h}createBoxEmitter(h,V,i,S){const l=new v;return this.particleEmitterType=l,this.direction1=h,this.direction2=V,this.minEmitBox=i,this.maxEmitBox=S,l}get flowMap(){return this._flowMap}set flowMap(h){this._flowMap!==h&&(this._flowMap=h)}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==qV.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(qV.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(qV.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";h?setTimeout((()=>{this.start(0)}),h):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var h;let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(h=this._customWrappers[V])||void 0===h?void 0:h.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[h]??this._customWrappers[0]}setCustomEffect(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[V]=new hh.b(this._engine),this._customWrappers[V].effect=h}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new p.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(h,V,i){return super._removeGradientAndTexture(h,V,i),this._releaseBuffers(),this}addColorGradient(h,V){this._colorGradients||(this._colorGradients=[]);const i=new A(h,V);return this._colorGradients.push(i),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(h&&this._colorGradients.sort(((h,V)=>h.gradient<V.gradient?-1:h.gradient>V.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(h){return this._removeGradientAndTexture(h,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const V in this._drawWrappers){var h;null===(h=this._drawWrappers[V].drawContext)||void 0===h||h.reset()}}_addFactorGradient(h,V,i){const S=new C(V,i);h.push(S),this._releaseBuffers()}addSizeGradient(h,V){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,h,V),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(h){return this._removeGradientAndTexture(h,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(h,V){if(!h)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&h.sort(((h,V)=>h.gradient<V.gradient?-1:h.gradient>V.gradient?1:0));const i=this;i[V]&&(i[V].dispose(),i[V]=null)}addAngularSpeedGradient(h,V){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,h,V),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(h){return this._removeGradientAndTexture(h,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(h,V){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,h,V),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(h){return this._removeGradientAndTexture(h,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(h,V){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,h,V),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(h){return this._removeGradientAndTexture(h,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(h,V){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,h,V),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(h){return this._removeGradientAndTexture(h,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(h){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(h,V,i){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(h),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Ig=new p.d,this.onStoppedObservable=new p.d,this.onStartedObservable=new p.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,i&&"Scene"!==i.getClassName()?(this._engine=i,this.defaultProjectionMatrix=S.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=i||a.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Fv.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,q.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,q.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,q.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,q.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new hh.b(this._engine)},this._customWrappers[0].effect=l,this._drawWrappers={0:new hh.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(V=V??{}).randomTextureSize||delete V.randomTextureSize;const g={Pq:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...V},B=V;isFinite(B)&&(g.Pq=B),this._capacity=g.Pq,this._maxActiveParticleCount=g.Pq,this._currentActiveCount=0,this._isAnimationSheetEnabled=Y,this.particleEmitterType=new v;const J=Math.min(this._engine.getCaps().maxTextureSize,g.randomTextureSize);let I=[];for(let S=0;S<J;++S)I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),I.push(Math.random());this._randomTexture=new W.d(new Float32Array(I),J,1,5,i,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,I=[];for(let S=0;S<J;++S)I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),I.push(Math.random());this._randomTexture2=new W.d(new Float32Array(I),J,1,5,i,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=J}_reset(){this._releaseBuffers()}_createVertexBuffers(h,V,i){const S={};S.position=V.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let l=3;S.age=V.createVertexBuffer("age",l,1,this._attributesStrideSize,!0),l+=1,S.size=V.createVertexBuffer("size",l,3,this._attributesStrideSize,!0),l+=3,S.life=V.createVertexBuffer("life",l,1,this._attributesStrideSize,!0),l+=1,l+=4,this.billboardMode===qV.BILLBOARDMODE_STRETCHED&&(S.direction=V.createVertexBuffer("direction",l,3,this._attributesStrideSize,!0)),l+=3,this._platform.alignDataInBuffer&&(l+=1),this.particleEmitterType instanceof L&&(l+=3,this._platform.alignDataInBuffer&&(l+=1)),this._colorGradientsTexture||(S.color=V.createVertexBuffer("color",l,4,this._attributesStrideSize,!0),l+=4),this._isBillboardBased||(S.initialDirection=V.createVertexBuffer("initialDirection",l,3,this._attributesStrideSize,!0),l+=3,this._platform.alignDataInBuffer&&(l+=1)),this.noiseTexture&&(S.noiseCoordinates1=V.createVertexBuffer("noiseCoordinates1",l,3,this._attributesStrideSize,!0),l+=3,this._platform.alignDataInBuffer&&(l+=1),S.noiseCoordinates2=V.createVertexBuffer("noiseCoordinates2",l,3,this._attributesStrideSize,!0),l+=3,this._platform.alignDataInBuffer&&(l+=1)),S.angle=V.createVertexBuffer("angle",l,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?l++:l+=2,this._isAnimationSheetEnabled&&(S.cellIndex=V.createVertexBuffer("cellIndex",l,1,this._attributesStrideSize,!0),l+=1,this.spriteRandomStartCell&&(S.cellStartOffset=V.createVertexBuffer("cellStartOffset",l,1,this._attributesStrideSize,!0),l+=1)),S.offset=i.createVertexBuffer("offset",0,2),S.uv=i.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(S),this._platform.createVertexBuffers(h,S),this.resetDrawCache()}_initialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!h)return;const V=this._engine,i=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof L&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const l=this.particleEmitterType instanceof L,Y=S.TmpVectors.nV[0];let g=0;for(let S=0;S<this._capacity;S++)if(i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),l?(this.particleEmitterType.particleDestinationGenerator(S,null,Y),i.push(Y.x),i.push(Y.y),i.push(Y.z)):(i.push(0),i.push(0),i.push(0)),this._platform.alignDataInBuffer&&i.push(0),g+=16,l&&(this.particleEmitterType.particlePositionGenerator(S,null,Y),i.push(Y.x),i.push(Y.y),i.push(Y.z),this._platform.alignDataInBuffer&&i.push(0),g+=4),this._colorGradientsTexture||(i.push(0),i.push(0),i.push(0),i.push(0),g+=4),this.isBillboardBased||(i.push(0),i.push(0),i.push(0),this._platform.alignDataInBuffer&&i.push(0),g+=4),this.noiseTexture&&(i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),this._platform.alignDataInBuffer&&i.push(0),i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),this._platform.alignDataInBuffer&&i.push(0),g+=8),i.push(0),g+=1,this._angularSpeedGradientsTexture||(i.push(0),g+=1),this._isAnimationSheetEnabled&&(i.push(0),g+=1,this.spriteRandomStartCell&&(i.push(0),g+=1)),this._platform.alignDataInBuffer){let h=3-(g+3&3);for(g+=h;h-- >0;)i.push(0)}const q=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),B=this._platform.createParticleBuffer(i),J=this._platform.createParticleBuffer(i);this._buffer0=new U.e(V,B,!1,this._attributesStrideSize),this._buffer1=new U.e(V,J,!1,this._attributesStrideSize),this._spriteBuffer=new U.e(V,q,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let h=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(h+="\n#define BILLBOARD"),this._colorGradientsTexture&&(h+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(h+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(h+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(h+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(h+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(h+="\n#define DRAGGRADIENTS"),this._flowMap&&(h+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(h+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(h+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(h+="\n#define NOISE"),this.isLocal&&(h+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===h||(this._cachedUpdateDefines=h,this._updateBuffer=this._platform.createUpdateBuffer(h)),this._platform.isUpdateBufferReady()}_getWrapper(h){const V=this._getCustomDrawWrapper(h);if(null!==V&&void 0!==V&&V.effect)return V;const i=[];this.fillDefines(i,h);let S=this._drawWrappers[h];S||(S=new hh.b(this._engine),S.drawContext&&(S.drawContext.useInstancing=!0),this._drawWrappers[h]=S);const l=i.join("\n");if(S.defines!==l){const h=[],V=[],i=[];this.fillUniformsAttributesAndSamplerNames(V,h,i),S.setEffect(this._engine.createEffect("gpuRenderParticles",h,V,i,l),l)}return S}static _GetAttributeNamesOrOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const l=[U.h.PositionKind,"age","life","size","angle"];return h||l.push(U.h.ColorKind),V&&l.push("cellIndex"),i||l.push("initialDirection"),S&&l.push("direction"),l.push("offset",U.h.UVKind),l}static _GetEffectCreationOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=["emitterWM","CB","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Vh.d)(S),h&&S.push("sheetInfos"),V&&S.push("logarithmicDepthConstant"),i&&(S.push("vFogInfos"),S.push("vFogColor")),S}fillDefines(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Vh.o)(this,this._scene,h),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==JV.d.FOGMODE_NONE&&h.push("#define FOG")),V===qV.BLENDMODE_MULTIPLY&&h.push("#define BLENDMULTIPLYMODE"),this.isLocal&&h.push("#define LOCAL"),this.useLogarithmicDepth&&h.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(h.push("#define BILLBOARD"),this.billboardMode){case qV.BILLBOARDMODE_Y:h.push("#define BILLBOARDY");break;case qV.BILLBOARDMODE_STRETCHED:h.push("#define BILLBOARDSTRETCHED");break;case qV.BILLBOARDMODE_ALL:h.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&h.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&h.push("#define ANIMATESHEET"),i&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),h.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(h,V,i){V.push(...PV._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===qV.BILLBOARDMODE_STRETCHED)),h.push(...PV._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),i.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(BV.b.PrepareUniforms(h,this._imageProcessingConfigurationDefines),BV.b.PrepareSamplers(i,this._imageProcessingConfigurationDefines))}animate(){var h;let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(V?this.preWarmStepOffset:(null===(h=this._scene)||void 0===h?void 0:h.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(h,V){const i=this[V];if(!h||!h.length||i)return;const S=new Float32Array(this._rawTextureWidth);for(let l=0;l<this._rawTextureWidth;l++){const V=l/this._rawTextureWidth;u.GetCurrentGradient(V,h,((h,V,i)=>{S[l]=(0,J.Lerp)(h.factor1,V.factor1,i)}))}this[V]=W.d.CreateRTexture(S,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[V].name=V.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const h=new Uint8Array(4*this._rawTextureWidth),V=g.TmpColors.vq[0];for(let i=0;i<this._rawTextureWidth;i++){const S=i/this._rawTextureWidth;u.GetCurrentGradient(S,this._colorGradients,((S,l,Y)=>{g.vq.LerpToRef(S.color1,l.color1,Y,V),h[4*i]=255*V.r,h[4*i+1]=255*V.g,h[4*i+2]=255*V.b,h[4*i+3]=255*V.a}))}this._colorGradientsTexture=W.d.CreateRGBATexture(h,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(h,V){var i,l,Y,g;const q=this._getWrapper(h),B=q.effect;this._engine.enableEffect(q);const J=(null===(i=this._scene)||void 0===i?void 0:i.getViewMatrix())||S.Matrix.IdentityReadOnly;if(B.setMatrix("view",J),B.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),B.setTexture("diffuseSampler",this.particleTexture),B.setVector2("translationPivot",this.translationPivot),B.setVector3("CB",this.CB),this.isLocal&&B.setMatrix("emitterWM",V),this._colorGradientsTexture?B.setTexture("colorGradientSampler",this._colorGradientsTexture):B.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const h=this.particleTexture.getBaseSize();B.setFloat3("sheetInfos",this.spriteCellWidth/h.width,this.spriteCellHeight/h.height,h.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const h=this._scene.activeCamera;B.setVector3("eyePosition",h.globalPosition)}const I=B.defines;if(this._scene&&((0,Vh.g)(B,this,this._scene),this.applyFog&&(0,ih.e)(this._scene,void 0,B)),I.indexOf("#define BILLBOARDMODE_ALL")>=0){const h=J.clone();h.invert(),B.setMatrix("invView",h)}return this.useLogarithmicDepth&&this._scene&&(0,ih.j)(I,B,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(B),this._setEngineBasedOnBlendMode(h),this._platform.bindDrawBuffers(this._targetIndex,B,null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(B),null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(g=this._scene)&&void 0!==g&&g.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(h){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!h)if(this.k.position){h=this.k.getWorldMatrix()}else{const V=this.k;h=S.TmpVectors.Matrix[0],S.Matrix.TranslationToRef(V.x,V.y,V.z,h)}const V=this._engine,i=V.getDepthWrite();if(V.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const h=this.Mh();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",h.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",h),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const l=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=l,V.setDepthWrite(i)}render(){let h,V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!V&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let h=0;h<this.preWarmCycles;h++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const h=0|this._accumulatedCount;this._accumulatedCount-=h,this._currentActiveCount+=h}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){h=this.k.getWorldMatrix()}else{const V=this.k;h=S.TmpVectors.Matrix[0],S.Matrix.TranslationToRef(V.x,V.y,V.z,h)}const l=this._engine;this.updateInAnimate||this._update(h);let Y=0;return V||i||(l.setState(!1),this.forceDepthWrite&&l.setDepthWrite(!0),Y=this.blendMode===qV.BLENDMODE_MULTIPLYADD?this._render(qV.BLENDMODE_MULTIPLY,h)+this._render(qV.BLENDMODE_ADD,h):this._render(this.blendMode,h),this._engine.setAlphaMode(0)),Y}rebuild(){const h=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(h,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,h()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const V in this._drawWrappers){this._drawWrappers[V].dispose()}if(this._drawWrappers={},this._scene){const h=this._scene.Fv.indexOf(this);h>-1&&this._scene.Fv.splice(h,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let V=0;V<this._renderVertexBuffers.length;++V){const h=this._renderVertexBuffers[V];for(const V in h)h[V].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),h&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),h&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Ig.notifyObservers(this),this.Ig.clear()}clone(h,V){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S={...this._customWrappers};let l=null;const Y=this._engine;if(Y.createEffectForParticles&&null!=this.customShader){l=this.customShader;const h=l.shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"";S[0]=Y.createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,h,void 0,void 0,void 0,this)}const g=this.serialize(i),q=PV.Parse(g,this._scene||this._engine,this._rootUrl);return q.name=h,q.customShader=l,q._customWrappers=S,void 0===V&&(V=this.k),this.noiseTexture&&(q.noiseTexture=this.noiseTexture.clone()),q.k=V,q}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V={};return qV._Serialize(V,this,h),V.activeParticleCount=this.activeParticleCount,V.randomTextureSize=this._randomTextureSize,V.customShader=this.customShader,V}static Parse(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4?arguments[4]:void 0;const Y=h.name;let g,q;V instanceof Ch.b?g=V:(q=V,g=q.getEngine());const B=new PV(Y,{Pq:l||h.Pq,randomTextureSize:h.randomTextureSize},V,null,h.isAnimationSheetEnabled);if(B._rootUrl=i,h.customShader&&g.createEffectForParticles){const V=h.customShader,i=V.shaderOptions.defines.length>0?V.shaderOptions.defines.join("\n"):"",S=g.createEffectForParticles(V.shaderPath.fragmentElement,V.shaderOptions.uniforms,V.shaderOptions.samplers,i,void 0,void 0,void 0,B);B.setCustomEffect(S,0),B.customShader=V}return h.id&&(B.id=h.id),h.activeParticleCount&&(B.activeParticleCount=h.activeParticleCount),qV._Parse(h,B,V,i),h.preventAutoStart&&(B.preventAutoStart=h.preventAutoStart),S||B.preventAutoStart||B.start(),B}}var LV=i(10952),UV=i(12464),XV=i(11509);class DV{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(h){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const V of this.systems)V.k=h;this._emitterNode=h}setEmitterAsSphere(h,V,i){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:h,renderingGroupId:V};const S=(0,UV.b)("emitterSphere",{diameter:h.diameter,segments:h.segments},i);S.renderingGroupId=V;const l=new XV.PV("emitterSphereMaterial",i);l.emissiveColor=h.color,S.material=l;for(const Y of this.systems)Y.k=S;this._emitterNode=S}start(h){for(const V of this.systems)h&&(V.k=h),V.start()}dispose(){for(const h of this.systems)h.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V={systems:[]};for(const i of this.systems)V.systems.push(i.serialize(h));return this._emitterNode&&(V.k=this._emitterCreationOptions),V}static Parse(h,V){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;const l=new DV,Y=this.BaseAssetsUrl+"/textures/";V=V||a.d.LastCreatedScene;for(const g of h.systems)l.systems.push(i?PV.Parse(g,V,Y,!0,S):qV.Parse(g,V,Y,!0,S));if(h.k){const i=h.k.options;if("Sphere"===h.k.kind)l.setEmitterAsSphere({diameter:i.diameter,segments:i.segments,color:g.LV.UV(i.color)},h.k.renderingGroupId,V)}return l}}DV.BaseAssetsUrl="https://assets.babylonjs.com/particles";var OV=i(10984);class oV{static CreateDefault(h){let V,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,S=arguments.length>2?arguments[2]:void 0;V=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new PV("default system",{Pq:i},S):new qV("default system",i,S),V.k=h;const l=LV.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return V.particleTexture=new w.d(l,V.Mh()),V.createConeEmitter(.1,Math.PI/4),V.color1=new g.vq(1,1,1,1),V.color2=new g.vq(1,1,1,1),V.colorDead=new g.vq(1,1,1,0),V.minSize=.1,V.maxSize=.1,V.minEmitPower=2,V.maxEmitPower=2,V.updateSpeed=1/60,V.emitRate=30,V}static CreateAsync(h,V){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;V||(V=a.d.LastCreatedScene);const l={};return V.addPendingData(l),new Promise(((Y,g)=>{if(i&&!PV.IsSupported)return V.removePendingData(l),g("Particle system with GPU is not supported.");LV.Tools.LoadFile(`${oV.BaseAssetsUrl}/systems/${h}.json`,(h=>{V.removePendingData(l);const g=JSON.parse(h.toString());return Y(DV.Parse(g,V,i,S))}),void 0,void 0,void 0,(()=>(V.removePendingData(l),g(`An error occurred with the creation of your particle system. Check if your type '${h}' exists.`))))}))}static ExportSet(h){const V=new DV;for(const i of h)V.systems.push(i);return V}static ParseFromFileAsync(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",Y=arguments.length>5?arguments[5]:void 0;return new Promise(((g,q)=>{const B=new OV.c;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const V=JSON.parse(B.responseText);let q;q=S?PV.Parse(V,i,l,!1,Y):qV.Parse(V,i,l,!1,Y),h&&(q.name=h),g(q)}else q("Unable to load the particle system")})),B.open("GET",V),B.send()}))}static ParseFromSnippetAsync(h,V){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",l=arguments.length>4?arguments[4]:void 0;if("_BLANK"===h){const h=this.CreateDefault(null);return h.start(),Promise.resolve(h)}return new Promise(((Y,g)=>{const q=new OV.c;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const g=JSON.parse(JSON.parse(q.responseText).jsonPayload),B=JSON.parse(g.particleSystem);let J;J=i?PV.Parse(B,V,S,!1,l):qV.Parse(B,V,S,!1,l),J.snippetId=h,Y(J)}else g("Unable to load the snippet "+h)})),q.open("GET",this.SnippetUrl+"/"+h.replace(/#/g,"/")),q.send()}))}}oV.BaseAssetsUrl=DV.BaseAssetsUrl,oV.SnippetUrl="https://snippet.babylonjs.com",oV.CreateFromSnippetAsync=oV.ParseFromSnippetAsync;var MV=i(11590),FV=i(11413),EV=i(12471);(0,EV.f)(FV.e.NAME_PARTICLESYSTEM,((h,V,i,S)=>{const l=(0,EV.j)(FV.e.NAME_PARTICLESYSTEM);if(l&&void 0!==h.Fv&&null!==h.Fv)for(let Y=0,g=h.Fv.length;Y<g;Y++){const g=h.Fv[Y];i.Fv.push(l(g,V,S))}})),(0,EV.c)(FV.e.NAME_PARTICLESYSTEM,((h,V,i)=>{if(h.activeParticleCount){return PV.Parse(h,V,i)}return qV.Parse(h,V,i)})),Ch.b.prototype.createEffectForParticles=function(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Y=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0,q=arguments.length>6?arguments[6]:void 0,B=arguments.length>7?arguments[7]:void 0,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,I=arguments.length>9?arguments[9]:void 0,v=[],s=[];const t=[];return B?B.fillUniformsAttributesAndSamplerNames(s,v,t):(v=qV._GetAttributeNamesOrOptions(),s=qV._GetEffectCreationOptions()),-1===l.indexOf(" BILLBOARD")&&(l+="\n#define BILLBOARD\n"),null!==B&&void 0!==B&&B.isAnimationSheetEnabled&&-1===l.indexOf(" ANIMATESHEET")&&(l+="\n#define ANIMATESHEET\n"),-1===S.indexOf("diffuseSampler")&&S.push("diffuseSampler"),this.createEffect({vertex:I??(null===B||void 0===B?void 0:B.vertexShaderName)??"particles",fragmentElement:h},v,s.concat(V),t.concat(S),l,Y,g,q,void 0,J,(async()=>{0===J?await Promise.resolve().then(i.bind(i,12508)):await Promise.resolve().then(i.bind(i,12568))}))},MV.e.prototype.getEmittedParticleSystems=function(){const h=[];for(let V=0;V<this.Mh().Fv.length;V++){const i=this.Mh().Fv[V];i.k===this&&h.push(i)}return h},MV.e.prototype.getHierarchyEmittedParticleSystems=function(){const h=[],V=this.getDescendants();V.push(this);for(let i=0;i<this.Mh().Fv.length;i++){const S=this.Mh().Fv[i],l=S.k;l.position&&-1!==V.indexOf(l)&&h.push(S)}return h};i(11481),i(11491),i(11570);i(11579),i(12480),i(11345),i(11466),i(11607);i(11343);var HV;i(12488),i(11167);!function(h){h[h.Color=2]="Color",h[h.UV=1]="UV",h[h.Random=0]="Random",h[h.Stated=3]="Stated"}(HV||(HV={}));var jV=i(11371);const mV=new S.nV(0,0,0),GV=new S.nV(0,0,0),wV=new S.nV(0,0,0);class NV{constructor(h,V,i){this.width=h,this.height=V,this.data=i}processFlowable(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0;if(!i)return;i instanceof S.Matrix?S.nV.TransformCoordinatesToRef(h.position,i,wV):(wV.x=i.x,wV.y=i.y,wV.z=i.z);const l=.5*wV.x+.5,Y=1-(.5*wV.y+.5),g=Math.floor(l*this.width),q=Math.floor(Y*this.height);if(g<0||g>=this.width||q<0||q>=this.height)return;const B=4*(q*this.width+g),J=this.data[B]/255*2-1,I=this.data[B+1]/255*2-1,v=this.data[B+2]/255*2-1,s=this.data[B+3]/255;mV.set(J,I,v),mV.scaleToRef(V*s,GV),h.direction.addInPlace(GV)}_processParticle(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0;this.processFlowable(h,V,i)}static async FromUrlAsync(h){return await new Promise(((V,i)=>{const S=document.createElement("canvas"),l=S.getContext("2d");let Y=null;const g=new Image;g.crossOrigin="anonymous",g.src=h,g.onerror=V=>{i(new Error(`Failed to load image: ${h} : ${V}`))},g.onload=()=>{S.width=g.width,S.height=g.height,l.drawImage(g,0,0),Y=l.getImageData(0,0,S.width,S.height),V(new NV(S.width,S.height,Y.data))}}))}static async ExtractFromTextureAsync(h){return await new Promise(((V,i)=>{if(!h.isReady())return void h.onLoadObservable.addOnce((async()=>{try{const i=await this.ExtractFromTextureAsync(h);V(i)}catch(S){i(S)}}));const S=h.getSize();jV.k.GetTextureDataAsync(h,S.width,S.height).then((h=>{V(new NV(S.width,S.height,new Uint8ClampedArray(h)))})).catch(i)}))}}var rV,kV,RV,ZV,zV,dV,xV,yV,QV;!function(h){h[h.Int=1]="Int",h[h.Float=2]="Float",h[h.Vector2=4]="Vector2",h[h.nV=8]="nV",h[h.Matrix=16]="Matrix",h[h.Particle=32]="Particle",h[h.Texture=64]="Texture",h[h.vq=128]="vq",h[h.FloatGradient=256]="FloatGradient",h[h.Vector2Gradient=512]="Vector2Gradient",h[h.Vector3Gradient=1024]="Vector3Gradient",h[h.Color4Gradient=2048]="Color4Gradient",h[h.System=4096]="System",h[h.AutoDetect=8192]="AutoDetect",h[h.BasedOnInput=16384]="BasedOnInput",h[h.Undefined=32768]="Undefined",h[h.All=65535]="All"}(rV||(rV={})),function(h){h[h.Compatible=0]="Compatible",h[h.TypeIncompatible=1]="TypeIncompatible",h[h.HierarchyIssue=2]="HierarchyIssue"}(kV||(kV={})),function(h){h[h.Input=0]="Input",h[h.Output=1]="Output"}(RV||(RV={}));class AV{get direction(){return this._direction}get type(){if(this._type===rV.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===rV.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(h){this._type=h}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((h=>h.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(h,V,i){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=rV.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new p.d,this.onDisconnectionObservable=new p.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=V,this.name=h,this._direction=i}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(h){var V;return this.isConnected?null!==(V=this._connectedPoint)&&void 0!==V&&V._storedFunction?this._connectedPoint._storedFunction(h):this._connectedPoint._storedValue:this.value}canConnectTo(h){return 0===this.checkCompatibilityState(h)}checkCompatibilityState(h){const V=this._ownerBlock,i=h.ownerBlock;if(this.type!==h.type&&h.innerType!==rV.AutoDetect)return h.acceptedConnectionPointTypes&&-1!==h.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(h.excludedConnectionPointTypes&&-1!==h.excludedConnectionPointTypes.indexOf(this.type))return 1;let S=i,l=V;return 0===this.direction&&(S=V,l=i),S.isAnAncestorOf(l)?2:0}connectTo(h){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(h))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${h.ownerBlock.name}".${h.name}`;return this._endpoints.push(h),h._connectedPoint=this,this.onConnectionObservable.notifyObservers(h),h.onConnectionObservable.notifyObservers(this),this}disconnectFrom(h){const V=this._endpoints.indexOf(h);return-1===V||(this._endpoints.splice(V,1),h._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(h),h.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(h){let V=1;for(;V<rV.All;)h&V||this.excludedConnectionPointTypes.push(V),V<<=1}serialize(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const V={};return V.name=this.name,V.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Ng?(V.valueType="BABYLON."+this.value.getClassName(),V.value=this.value.Ng()):(V.valueType="number",V.value=this.value)),h&&this.connectedPoint&&(V.inputName=this.name,V.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,V.targetConnectionName=this.connectedPoint.name,V.isExposedOnFrame=!0,V.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(V.isExposedOnFrame=!0,V.exposedPortPosition=this.exposedPortPosition),V}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class bV{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(h){this._name=h}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(h){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new p.d,this.Ig=new p.d,this.onInputChangedObservable=new p.d,this.visibleOnFrame=!1,this._name=h,this.uniqueId=N.d.UniqueId}_inputRename(h){return h}_outputRename(h){return h}isAnAncestorOf(h){for(const V of this._outputs)if(V.hasEndpoints)for(const i of V.endpoints){if(i.ownerBlock===h)return!0;if(i.ownerBlock.isAnAncestorOf(h))return!0}return!1}isAnAncestorOfType(h){if(this.getClassName()===h)return!0;for(const V of this._outputs)if(V.hasEndpoints)for(const i of V.endpoints)if(i.ownerBlock.isAnAncestorOfType(h))return!0;return!1}getInputByName(h){const V=this._inputs.filter((V=>V.name===h));return V.length?V[0]:null}_linkConnectionTypes(h,V){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[V]._acceptedConnectionPointType=this._inputs[h]:(this._inputs[h]._linkedConnectionSource=this._inputs[V],this._inputs[h]._isMainLinkSource=!0),this._inputs[V]._linkedConnectionSource=this._inputs[h]}registerInput(h,V){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0;const g=new AV(h,this,0);return g.type=V,g.isOptional=i,g.defaultValue=S,g.value=S,g.valueMin=l,g.valueMax=Y,this._inputs.push(g),this.onInputChangedObservable.notifyObservers(g),this}registerOutput(h,V,i){return(i=i??new AV(h,this,1)).type=V,this._outputs.push(i),this}_build(h){}_customBuildStep(h){}build(h){if(this._buildId===h.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((h=>h.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=h.buildId;for(const V of this._inputs){if(!V.connectedPoint){V.isOptional||h.notConnectedNonOptionalInputs.push(V);continue}const i=V.connectedPoint.ownerBlock;i&&i!==this&&!i.isSystem&&i.build(h)}return this._customBuildStep(h),h.verbose&&r.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(h),this.onBuildObservable.notifyObservers(this),!1}serialize(){const h={};h.customType="BABYLON."+this.getClassName(),h.id=this.uniqueId,h.name=this.name,h.visibleOnFrame=this.visibleOnFrame,h.inputs=[],h.outputs=[];for(const V of this.inputs)h.inputs.push(V.serialize());for(const V of this.outputs)h.outputs.push(V.serialize(!1));return h}_deserialize(h){this._name=h.name,this.comments=h.comments,this.visibleOnFrame=!!h.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(h)}_deserializePortDisplayNamesAndExposedOnFrame(h){const V=h.inputs,i=h.outputs;if(V)for(const S of V){const h=this.inputs.find((h=>h.name===S.name));if(!h)return;if(S.displayName&&(h.displayName=S.displayName),S.isExposedOnFrame&&(h.isExposedOnFrame=S.isExposedOnFrame,h.exposedPortPosition=S.exposedPortPosition),void 0!==S.value&&null!==S.value)if("number"===S.valueType)h.value=S.value;else{const V=(0,q.b)(S.valueType);V&&(h.value=V.UV(S.value))}}if(i)for(let S=0;S<i.length;S++){const h=i[S];h.displayName&&(this.outputs[S].displayName=h.displayName),h.isExposedOnFrame&&(this.outputs[S].isExposedOnFrame=h.isExposedOnFrame,this.outputs[S].exposedPortPosition=h.exposedPortPosition)}}clone(){const h=this.serialize(),V=(0,q.b)(h.customType);if(V){const i=new V;return i._deserialize(h),i}return null}dispose(){this.Ig.notifyObservers(this),this.Ig.clear();for(const h of this.inputs)h.dispose();for(const h of this.outputs)h.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function CV(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",S=arguments.length>3?arguments[3]:void 0;return(l,Y)=>{let g=l._propStore;g||(g=[],l._propStore=g),g.push({propertyName:Y,displayName:h,type:V,groupName:i,options:S??{},className:l.getClassName()})}}(0,j.b)([(0,m.E)("comment")],bV.prototype,"comments",void 0),function(h){h[h.Boolean=0]="Boolean",h[h.Float=1]="Float",h[h.Int=2]="Int",h[h.Vector2=3]="Vector2",h[h.List=4]="List",h[h.vq=5]="vq",h[h.SamplingMode=6]="SamplingMode",h[h.TextureFormat=7]="TextureFormat",h[h.TextureType=8]="TextureType"}(ZV||(ZV={})),function(h){h[h.None=0]="None",h[h.Position=1]="Position",h[h.Direction=2]="Direction",h[h.Age=3]="Age",h[h.Lifetime=4]="Lifetime",h[h.Color=5]="Color",h[h.ScaledDirection=6]="ScaledDirection",h[h.Scale=7]="Scale",h[h.AgeGradient=8]="AgeGradient",h[h.Angle=9]="Angle",h[h.SpriteCellIndex=16]="SpriteCellIndex",h[h.SpriteCellStart=17]="SpriteCellStart",h[h.SpriteCellEnd=18]="SpriteCellEnd"}(zV||(zV={})),function(h){h[h.None=0]="None",h[h.Time=1]="Time",h[h.Delta=2]="Delta",h[h.Emitter=3]="Emitter"}(dV||(dV={}));class uV{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let h="";for(const V of this.notConnectedNonOptionalInputs)h+=`input ${V.name} from block ${V.ownerBlock.name}[${V.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(h)throw"Build of Node Particle System Set failed:\n"+h}adapt(h,V){const i=h.getConnectedValue(this)||0;if(h.type===V)return i;switch(V){case rV.Vector2:return new S.Vector2(i,i);case rV.nV:return new S.nV(i,i,i);case rV.vq:return new g.vq(i,i,i,i)}return null}getContextualValue(h){if(!this.particleContext||!this.systemContext)return null;switch(h){case zV.Position:return this.particleContext.position;case zV.Direction:return this.particleContext.direction;case zV.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case zV.Color:return this.particleContext.color;case zV.Age:return this.particleContext.age;case zV.Lifetime:return this.particleContext.lifeTime;case zV.Angle:return this.particleContext.angle;case zV.Scale:return this.particleContext.scale;case zV.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case zV.SpriteCellEnd:return this.systemContext.endSpriteCellID;case zV.SpriteCellIndex:return this.particleContext.cellIndex;case zV.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.k.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.k.absolutePosition:this.systemContext.k:null}getSystemValue(h){if(!this.particleContext||!this.systemContext)return null;switch(h){case dV.Time:return this.systemContext._actualFrame;case dV.Delta:return this.systemContext._scaledUpdateSpeed;case dV.Emitter:if(this.isEmitterTransformNode){return this.systemContext.k.absolutePosition}return this.systemContext.k}return null}}function pV(h,V,i){const S=new uV;S.fV=V;const l=h.createSystem(S);return l.canStart=()=>!0,l.k=i.clone(),l.disposeOnStop=!0,l.start(),l}class WV extends bV{constructor(h){super(h),this.blendMode=B.BLENDMODE_ONEONE,this.Pq=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",rV.Particle),this.registerInput("texture",rV.Texture),this.registerInput("onStart",rV.System,!0),this.registerInput("onEnd",rV.System,!0),this.registerOutput("system",rV.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(h){h.Pq=this.Pq,h.buildId=this._buildId++,this.build(h);const V=this.particle.getConnectedValue(h);return V.particleTexture=this.texture.getConnectedValue(h),V.emitRate=this.emitRate,V.blendMode=this.blendMode,V.name=this.name,V._nodeGenerated=!0,V._targetStopDuration=this.targetStopDuration,V.startDelay=this.startDelay,this.system._storedValue=this,V.canStart=()=>!this.doNoStart,V.onStartedObservable.add((i=>{const S=this.onStart.getConnectedValue(h);S&&i.onStartedObservable.addOnce((()=>{h.systemContext=V;const i=pV(S,h.fV,h.emitterPosition);this.Ig.addOnce((()=>{i.dispose()}))}));const l=this.onEnd.getConnectedValue(h);l&&i.onStoppedObservable.addOnce((()=>{h.systemContext=V;const i=pV(l,h.fV,h.emitterPosition);this.Ig.addOnce((()=>{i.dispose()}))}))})),this.Ig.addOnce((()=>{V.dispose()})),V}serialize(){const h=super.serialize();return h.Pq=this.Pq,h.emitRate=this.emitRate,h.blendMode=this.blendMode,h.doNoStart=this.doNoStart,h.targetStopDuration=this.targetStopDuration,h.startDelay=this.startDelay,h}_deserialize(h){super._deserialize(h),this.Pq=h.Pq,this.emitRate=h.emitRate,this.doNoStart=!!h.doNoStart,void 0!==h.blendMode&&(this.blendMode=h.blendMode),void 0!==h.targetStopDuration&&(this.targetStopDuration=h.targetStopDuration),void 0!==h.startDelay&&(this.startDelay=h.startDelay)}}(0,j.b)([CV("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:B.BLENDMODE_ONEONE},{label:"Standard",value:B.BLENDMODE_STANDARD},{label:"Add",value:B.BLENDMODE_ADD},{label:"Multiply",value:B.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:B.BLENDMODE_MULTIPLYADD}]})],WV.prototype,"blendMode",void 0),(0,j.b)([CV("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],WV.prototype,"Pq",void 0),(0,j.b)([CV("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WV.prototype,"emitRate",void 0),(0,j.b)([CV("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WV.prototype,"targetStopDuration",void 0),(0,j.b)([CV("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WV.prototype,"startDelay",void 0),(0,j.b)([CV("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],WV.prototype,"doNoStart",void 0),(0,q.f)("BABYLON.SystemBlock",WV);class aV extends bV{get type(){if(this._type===rV.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=rV.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=rV.Vector2,this._type;case"nV":return this._type=rV.nV,this._type;case"vq":return this._type=rV.vq,this._type;case"Matrix":return this._type=rV.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===zV.None&&this._systemSource!==dV.None}get systemSource(){return this._systemSource}set systemSource(h){if(this._systemSource=h,h!==dV.None){switch(this._contextualSource=zV.None,this._type=rV.Float,h){case dV.Time:case dV.Delta:this._type=rV.Float;break;case dV.Emitter:this._type=rV.nV}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==zV.None}get contextualValue(){return this._contextualSource}set contextualValue(h){if(this._contextualSource=h,h!==zV.None){switch(this._systemSource=dV.None,h){case zV.Scale:this._type=rV.Vector2;break;case zV.Position:case zV.Direction:case zV.ScaledDirection:this._type=rV.nV;break;case zV.Color:this._type=rV.vq;break;case zV.Age:case zV.Lifetime:case zV.Angle:case zV.AgeGradient:this._type=rV.Float;break;case zV.SpriteCellEnd:case zV.SpriteCellStart:case zV.SpriteCellIndex:this._type=rV.Int}this.output&&(this.output.type=this._type)}}constructor(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rV.AutoDetect;super(h),this._type=rV.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new p.d,this._systemSource=dV.None,this._contextualSource=zV.None,this._type=V,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",V)}get value(){return this._storedValue}set value(h){this.type===rV.Float&&this.min!==this.max&&(h=Math.max(this.min,h),h=Math.min(this.max,h)),this._storedValue=h,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(h){this._valueCallback=h}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case rV.Int:case rV.Float:this.value=0;break;case rV.Vector2:this.value=S.Vector2.Zero();break;case rV.nV:this.value=S.nV.Zero();break;case rV.vq:this.value=new g.vq(1,1,1,1);break;case rV.Matrix:this.value=S.Matrix.Identity()}}_build(h){super._build(h),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=h=>h.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=h=>h.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const h=super.serialize();return h.type=this.type,h.contextualValue=this.contextualValue,h.systemSource=this.systemSource,h.min=this.min,h.max=this.max,h.groupInInspector=this.groupInInspector,h.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Ng?(h.valueType="BABYLON."+this._storedValue.getClassName(),h.value=this._storedValue.Ng()):(h.valueType="number",h.value=this._storedValue)),h}_deserialize(h){if(super._deserialize(h),this._type=h.type,this.contextualValue=h.contextualValue,this.systemSource=h.systemSource||dV.None,this.min=h.min||0,this.max=h.max||0,this.groupInInspector=h.groupInInspector||"",void 0!==h.displayInInspector&&(this.displayInInspector=h.displayInInspector),h.valueType)if("number"===h.valueType)this._storedValue=h.value;else{const V=(0,q.b)(h.valueType);V&&(this._storedValue=V.UV(h.value))}}}(0,q.f)("BABYLON.ParticleInputBlock",aV);class KV extends bV{get url(){return this._url}set url(h){this._url!==h&&(this._cachedData=null,this._url=h,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(h){this._textureDataUrl!==h&&(this._cachedData=null,this._textureDataUrl=h,this._url="",this._sourceTexture=null)}set sourceTexture(h){this._sourceTexture!==h&&(this._cachedData=null,this._sourceTexture=h,this._url="",this._textureDataUrl="")}constructor(h){super(h),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",rV.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const h=this.texture._storedValue;return await new Promise(((V,i)=>{if(!h.isReady())return void h.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),V(this._cachedData)}catch(h){i(h)}}));const S=h.getSize();jV.k.GetTextureDataAsync(h,S.width,S.height).then((i=>{this._cachedData={width:S.width,height:S.height,data:new Uint8ClampedArray(i)},h.dispose(),V(this._cachedData)})).catch(i)}))}_build(h){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new w.d(this._textureDataUrl,h.fV):this.texture._storedValue=new w.d(this._url,h.fV):this.texture._storedValue=null}serialize(){const h=super.serialize();return h.url=this.url,h.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(h.textureDataUrl=this.textureDataUrl),h}_deserialize(h){super._deserialize(h),this.url=h.url,this.serializedCachedData=!!h.serializedCachedData,h.textureDataUrl&&(this.textureDataUrl=h.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,q.f)("BABYLON.ParticleTextureSourceBlock",KV);class hi extends bV{constructor(h){super(h),this.registerInput("particle",rV.Particle),this.registerInput("position",rV.nV),this.registerOutput("output",rV.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(h){const V=this.particle.getConnectedValue(h);if(this.output._storedValue=V,!this.position.isConnected)return;const i={process:i=>{h.particleContext=i,h.systemContext=V,i.position.l(this.position.getConnectedValue(h))},previousItem:null,nextItem:null};V._updateQueueStart?dh(i,V._updateQueueStart):V._updateQueueStart=i}}(0,q.f)("BABYLON.UpdatePositionBlock",hi),function(h){h[h.Add=0]="Add",h[h.Subtract=1]="Subtract",h[h.Multiply=2]="Multiply",h[h.Divide=3]="Divide",h[h.Max=4]="Max",h[h.Min=5]="Min"}(xV||(xV={}));class Vi extends bV{constructor(h){super(h),this.operation=xV.Add,this.registerInput("left",rV.AutoDetect),this.registerInput("right",rV.AutoDetect),this.registerOutput("output",rV.BasedOnInput),this.output._typeConnectionSource=this.left;const V=[rV.Matrix,rV.Particle,rV.Texture,rV.System,rV.FloatGradient,rV.Color4Gradient,rV.Vector2Gradient,rV.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...V),this.right.excludedConnectionPointTypes.push(...V),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(h){let V;const i=this.left,l=this.right;if(!i.isConnected||!l.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Y=i.type===rV.Float||i.type===rV.Int,q=l.type===rV.Float||l.type===rV.Int,B=Y&&q;switch(this.operation){case xV.Add:V=B?h=>i.getConnectedValue(h)+l.getConnectedValue(h):Y?h=>h.adapt(i,l.type).add(l.getConnectedValue(h)):h=>i.getConnectedValue(h).add(h.adapt(l,i.type));break;case xV.Subtract:V=B?h=>i.getConnectedValue(h)-l.getConnectedValue(h):Y?h=>h.adapt(i,l.type).cV(l.getConnectedValue(h)):h=>i.getConnectedValue(h).cV(h.adapt(l,i.type));break;case xV.Multiply:V=B?h=>i.getConnectedValue(h)*l.getConnectedValue(h):Y?h=>h.adapt(i,l.type).multiply(l.getConnectedValue(h)):h=>i.getConnectedValue(h).multiply(h.adapt(l,i.type));break;case xV.Divide:V=B?h=>i.getConnectedValue(h)/l.getConnectedValue(h):Y?h=>h.adapt(i,l.type).divide(l.getConnectedValue(h)):h=>i.getConnectedValue(h).divide(h.adapt(l,i.type));break;case xV.Min:if(B)V=h=>Math.min(i.getConnectedValue(h),l.getConnectedValue(h));else{const[h,q]=Y?[l,i]:[i,l];switch(h.type){case rV.Vector2:V=V=>S.Vector2.Minimize(h.getConnectedValue(V),V.adapt(q,h.type));break;case rV.nV:V=V=>S.nV.Minimize(h.getConnectedValue(V),V.adapt(q,h.type));break;case rV.vq:V=V=>{const i=h.getConnectedValue(V),{r:S,g:l,b:Y,a:B}=V.adapt(q,h.type);return new g.vq(Math.min(i.r,S),Math.min(i.g,l),Math.min(i.b,Y),Math.min(i.a,B))}}}break;case xV.Max:if(!B){const[h,q]=Y?[l,i]:[i,l];switch(h.type){case rV.Vector2:V=V=>S.Vector2.Maximize(h.getConnectedValue(V),V.adapt(q,h.type));break;case rV.nV:V=V=>S.nV.Maximize(h.getConnectedValue(V),V.adapt(q,h.type));break;case rV.vq:V=V=>{const i=h.getConnectedValue(V),{r:S,g:l,b:Y,a:B}=V.adapt(q,h.type);return new g.vq(Math.max(i.r,S),Math.min(i.g,l),Math.min(i.b,Y),Math.min(i.a,B))}}break}V=h=>Math.max(i.getConnectedValue(h),l.getConnectedValue(h))}this.output._storedFunction=h=>i.type===rV.Int?0|V(h):V(h)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===rV.Int||this.left.type===rV.Float&&this.right.type!==rV.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[h,V]of[[this.left,this.right],[this.right,this.left]])h.acceptedConnectionPointTypes=[rV.Int,rV.Float],V.isConnected&&(h.acceptedConnectionPointTypes.push(V.type),V.type!==rV.Int&&V.type!==rV.Float||h.acceptedConnectionPointTypes.push(rV.Vector2,rV.nV,rV.vq))}dispose(){super.dispose();for(const h of this._connectionObservers)h.remove();this._connectionObservers.length=0}serialize(){const h=super.serialize();return h.operation=this.operation,h}_deserialize(h){super._deserialize(h),this.operation=h.operation}}(0,j.b)([CV("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:xV.Add},{label:"Subtract",value:xV.Subtract},{label:"Multiply",value:xV.Multiply},{label:"Divide",value:xV.Divide},{label:"Max",value:xV.Max},{label:"Min",value:xV.Min}]})],Vi.prototype,"operation",void 0),(0,q.f)("BABYLON.ParticleMathBlock",Vi);class ii extends bV{constructor(h){super(h),this.registerInput("particle",rV.Particle),this.registerInput("direction1",rV.nV,!0,new S.nV(0,1,0)),this.registerInput("direction2",rV.nV,!0,new S.nV(0,1,0)),this.registerInput("minEmitBox",rV.nV,!0,new S.nV(-.5,-.5,-.5)),this.registerInput("maxEmitBox",rV.nV,!0,new S.nV(.5,.5,.5)),this.registerOutput("output",rV.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(h){const V=this.particle.getConnectedValue(h);V._directionCreation.process=i=>{h.particleContext=i,h.systemContext=V;const l=this.direction1.getConnectedValue(h),Y=this.direction2.getConnectedValue(h),g=(0,J.RandomRange)(l.x,Y.x),q=(0,J.RandomRange)(l.y,Y.y),B=(0,J.RandomRange)(l.z,Y.z);h.isEmitterTransformNode?S.nV.TransformNormalFromFloatsToRef(g,q,B,h.emitterWorldMatrix,i.direction):i.direction.qq(g,q,B)},V._positionCreation.process=i=>{h.particleContext=i,h.systemContext=V;const l=this.minEmitBox.getConnectedValue(h),Y=this.maxEmitBox.getConnectedValue(h),g=(0,J.RandomRange)(l.x,Y.x),q=(0,J.RandomRange)(l.y,Y.y),B=(0,J.RandomRange)(l.z,Y.z);h.isEmitterTransformNode?S.nV.TransformCoordinatesFromFloatsToRef(g,q,B,h.emitterWorldMatrix,i.position):(i.position.qq(g,q,B),i.position.addInPlace(h.emitterPosition))},this.output._storedValue=V}}(0,q.f)("BABYLON.BoxShapeBlock",ii);class Si extends bV{constructor(h){super(h),this.registerInput("emitPower",rV.Float,!0,1),this.registerInput("lifeTime",rV.Float,!0,1),this.registerInput("color",rV.vq,!0,new g.vq(1,1,1,1)),this.registerInput("scale",rV.Vector2,!0,new S.Vector2(1,1)),this.registerInput("angle",rV.Float,!0,0),this.registerOutput("particle",rV.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(h){const V=new qV(this.name,h.Pq,h.fV,null,!1,void 0,!0);V.particleEmitterType=new c,V._lifeTimeCreation.process=(V,i)=>{h.particleContext=V,V.lifeTime=this.lifeTime.getConnectedValue(h),i._emitPower=this.emitPower.getConnectedValue(h)},V._colorCreation.process=V=>{h.particleContext=V,V.color.l(this.color.getConnectedValue(h))},V._sizeCreation.process=V=>{h.particleContext=V,V.size=1,V.scale.l(this.scale.getConnectedValue(h))},V._angleCreation.process=V=>{h.particleContext=V,V.angle=this.angle.getConnectedValue(h)},this.particle._storedValue=V}}(0,q.f)("BABYLON.CreateParticleBlock",Si);class li{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const h=[];for(const V of this.attachedBlocks)V.isInput&&h.push(V);return h}constructor(h){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new p.d,this.name=h}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(h){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(h)&&this.attachedBlocks.push(h);for(const i of h.inputs){const S=i.connectedPoint;if(S){const i=S.ownerBlock;i!==h&&this._initializeBlock(i,V)}}}async buildAsync(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((i=>{const S=new DV;for(const h of this._systemBlocks)this._initializeBlock(h);for(const l of this.systemBlocks){const i=new uV;i.buildId=this._buildId++,i.fV=h,i.verbose=V;const Y=l.createSystem(i);i.emitErrors(),S.systems.push(Y)}this.onBuildObservable.notifyObservers(this),i(S)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const h=new WV("Particle system"),V=new hi("Update position");V.output.connectTo(h.particle);const i=new aV("Position");i.contextualValue=zV.Position;const S=new aV("Scaled direction");S.contextualValue=zV.ScaledDirection;const l=new Vi("Add");l.operation=xV.Add,i.output.connectTo(l.left),S.output.connectTo(l.right),l.output.connectTo(V.position);const Y=new Si("Create particle"),g=new ii("Box shape");Y.particle.connectTo(g.particle),g.output.connectTo(V.particle);const q=new KV("Texture");q.texture.connectTo(h.texture),q.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(h)}removeBlock(h){const V=this.attachedBlocks.indexOf(h);if(V>-1&&this.attachedBlocks.splice(V,1),h.isSystem){const V=this._systemBlocks.indexOf(h);V>-1&&this._systemBlocks.splice(V,1)}}parseSerializedObject(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V||this.clear();const i={};for(const S of h.bJ){const h=(0,q.b)(S.customType);if(h){const V=new h;V._deserialize(S),i[S.id]=V,this.attachedBlocks.push(V),V.isSystem&&this._systemBlocks.push(V)}}for(const S of this.attachedBlocks)if(S.isTeleportOut){const h=S,V=h._tempEntryPointUniqueId;if(V){const S=i[V];S&&S.attachToEndpoint(h)}}for(let S=0;S<h.bJ.length;S++){const l=h.bJ[S],Y=i[l.id];Y&&(Y.inputs.length&&l.inputs.some((h=>h.targetConnectionName))&&!V||this._restoreConnections(Y,h,i))}if(h.locations||h.editorData&&h.editorData.locations){const S=h.locations||h.editorData.locations;for(const h of S)i[h.xi]&&(h.xi=i[h.xi].uniqueId);V&&this.editorData&&this.editorData.locations&&S.concat(this.editorData.locations),h.locations?this.editorData={locations:S}:(this.editorData=h.editorData,this.editorData.locations=S);const l=[];for(const h in i)l[h]=i[h].uniqueId;this.editorData.map=l}this.comment=h.comment}_restoreConnections(h,V,i){for(const S of h.outputs)for(const l of V.bJ){const Y=i[l.id];if(Y)for(const g of l.inputs)if(i[g.targetBlockId]!==h||g.targetConnectionName!==S.name);else{const h=Y.getInputByName(g.inputName);if(!h||h.isConnected)continue;S.connectTo(h,!0),this._restoreConnections(Y,V,i)}}}serialize(h){const V=h?{}:G.d.Serialize(this);V.editorData=JSON.parse(JSON.stringify(this.editorData));let i=[];h?i=h:V.customType="BABYLON.NodeParticleSystemSet",V.bJ=[];for(const S of i)V.bJ.push(S.serialize());if(!h)for(const S of this.attachedBlocks)-1===i.indexOf(S)&&V.bJ.push(S.serialize());return V}dispose(){for(const h of this.attachedBlocks)h.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(h){const V=new li(h);return V.setToDefault(),V}static Parse(h){const V=G.d.Parse((()=>new li(h.name)),h,null);return V.parseSerializedObject(h),V}static ParseFromSnippetAsync(h,V){return"_BLANK"===h?Promise.resolve(li.CreateDefault("blank")):new Promise(((i,S)=>{const l=new OV.c;l.addEventListener("readystatechange",(()=>{if(4==l.readyState)if(200==l.status){const g=JSON.parse(JSON.parse(l.responseText).jsonPayload),q=JSON.parse(g.nodeParticle);V||(V=G.d.Parse((()=>new li(h)),q,null)),V.parseSerializedObject(q),V.snippetId=h;try{i(V)}catch(Y){S(Y)}}else S("Unable to load the snippet "+h)})),l.open("GET",this.SnippetUrl+"/"+h.replace(/#/g,"/")),l.send()}))}}li.EditorURL=`${LV.Tools._DefaultCdnUrl}/v${Ch.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,li.SnippetUrl="https://snippet.babylonjs.com",(0,j.b)([(0,m.E)()],li.prototype,"name",void 0),(0,j.b)([(0,m.E)("comment")],li.prototype,"comment",void 0),function(h){h[h.None=0]="None",h[h.PerParticle=1]="PerParticle",h[h.PerSystem=2]="PerSystem"}(yV||(yV={}));class Yi extends bV{constructor(h){super(h),this._currentLockId=-2,this.lockMode=yV.PerParticle,this.registerInput("min",rV.AutoDetect,!0,0),this.registerInput("max",rV.AutoDetect,!0,1),this.registerOutput("output",rV.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(rV.Float|rV.Int|rV.Vector2|rV.nV|rV.vq),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(rV.Float|rV.Int|rV.Vector2|rV.nV|rV.vq),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=rV.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let h=null;switch(this._currentLockId=-2,this.min.type){case rV.AutoDetect:case rV.Int:case rV.Float:h=h=>{const V=this.min.getConnectedValue(h)||0,i=this.max.getConnectedValue(h)||1;return V+Math.random()*(i-V)};break;case rV.Vector2:h=h=>{const V=this.min.getConnectedValue(h)||S.Vector2.Zero(),i=this.max.getConnectedValue(h)||S.Vector2.One();return new S.Vector2(V.x+Math.random()*(i.x-V.x),V.y+Math.random()*(i.y-V.y))};break;case rV.nV:h=h=>{const V=this.min.getConnectedValue(h)||S.nV.Zero(),i=this.max.getConnectedValue(h)||S.nV.One();return new S.nV(V.x+Math.random()*(i.x-V.x),V.y+Math.random()*(i.y-V.y),V.z+Math.random()*(i.z-V.z))};break;case rV.vq:h=h=>{const V=this.min.getConnectedValue(h)||new g.vq(0,0,0,0),i=this.max.getConnectedValue(h)||new g.vq(1,1,1,1);return new g.vq(V.x+Math.random()*(i.x-V.x),V.y+Math.random()*(i.y-V.y),V.z+Math.random()*(i.z-V.z),V.w+Math.random()*(i.w-V.w))}}this.output._storedFunction=V=>{var i;let S=0;switch(this.lockMode){case yV.PerParticle:S=(null===(i=V.particleContext)||void 0===i?void 0:i.id)||-1;break;case yV.PerSystem:S=V.buildId||0}return this._currentLockId!==S&&(this.lockMode!==yV.None&&(this._currentLockId=S),this.output._storedValue=h(V)),this.output._storedValue}}serialize(){const h=super.serialize();return h.lockMode=this.lockMode,h}_deserialize(h){super._deserialize(h),this.lockMode=h.lockMode}}(0,j.b)([CV("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:yV.None},{label:"Per particle",value:yV.PerParticle},{label:"Per system",value:yV.PerSystem}]})],Yi.prototype,"lockMode",void 0),(0,q.f)("BABYLON.ParticleRandomBlock",Yi);class gi extends bV{constructor(h){super(h),this._currentLockId=-2,this.lockMode=yV.PerParticle,this.registerInput("min",rV.AutoDetect),this.registerInput("max",rV.AutoDetect),this.registerOutput("output",rV.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const V=[rV.Matrix,rV.Particle,rV.Texture,rV.System,rV.FloatGradient,rV.Color4Gradient,rV.Vector2Gradient,rV.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...V),this.max.excludedConnectionPointTypes.push(...V)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let h=null;switch(this._currentLockId=-2,this.min.type){case rV.Float:case rV.Int:h=h=>{const V=this.min.getConnectedValue(h),i=this.max.getConnectedValue(h);return Math.random()*(i-V)+V};break;case rV.Vector2:h=h=>{const V=this.min.getConnectedValue(h),i=this.max.getConnectedValue(h);return new S.Vector2(Math.random()*(i.x-V.x)+V.x,Math.random()*(i.y-V.y)+V.y)};break;case rV.nV:h=h=>{const V=this.min.getConnectedValue(h),i=this.max.getConnectedValue(h);return new S.nV(Math.random()*(i.x-V.x)+V.x,Math.random()*(i.y-V.y)+V.y,Math.random()*(i.z-V.z)+V.z)};break;case rV.vq:h=h=>{const V=this.min.getConnectedValue(h),i=this.max.getConnectedValue(h);return new g.vq(Math.random()*(i.r-V.r)+V.r,Math.random()*(i.g-V.g)+V.g,Math.random()*(i.b-V.b)+V.b,Math.random()*(i.a-V.a)+V.a)}}this.output._storedFunction=V=>{var i;let S=0;switch(this.lockMode){case yV.PerParticle:S=(null===(i=V.particleContext)||void 0===i?void 0:i.id)||-1;break;case yV.PerSystem:S=V.buildId||0}return this._currentLockId!==S&&(this.lockMode!==yV.None&&(this._currentLockId=S),this.output._storedValue=h(V)),this.output._storedValue}}serialize(){const h=super.serialize();return h.lockMode=this.lockMode,h}_deserialize(h){super._deserialize(h),void 0!==h.lockMode&&(this.lockMode=h.lockMode)}}(0,j.b)([CV("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:yV.None},{label:"Per particle",value:yV.PerParticle},{label:"Per system",value:yV.PerSystem}]})],gi.prototype,"lockMode",void 0),(0,q.f)("BABYLON.RandomRangeBlock",gi);(0,q.f)("BABYLON.ParticleLerpBlock",class extends bV{constructor(h){super(h),this.registerInput("left",rV.AutoDetect),this.registerInput("right",rV.AutoDetect),this.registerInput("gradient",rV.Float,!0,0,0,1),this.registerOutput("output",rV.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(rV.Float|rV.Int|rV.Vector2|rV.nV|rV.vq)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const h=(h,V,i)=>(1-h)*V+h*i;this.output._storedFunction=V=>{const i=this.left.getConnectedValue(V),l=this.right.getConnectedValue(V),Y=this.gradient.getConnectedValue(V);switch(this.left.type){case rV.Int:case rV.Float:return h(Y,i,l);case rV.Vector2:return new S.Vector2(h(Y,i.x,l.x),h(Y,i.y,l.y));case rV.nV:return new S.nV(h(Y,i.x,l.x),h(Y,i.y,l.y),h(Y,i.z,l.z));case rV.vq:return new g.vq(h(Y,i.r,l.r),h(Y,i.g,l.g),h(Y,i.b,l.b),h(Y,i.a,l.a))}return 0}}});(0,q.f)("BABYLON.UpdateDirectionBlock",class extends bV{constructor(h){super(h),this.registerInput("particle",rV.Particle),this.registerInput("direction",rV.nV),this.registerOutput("output",rV.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(h){const V=this.particle.getConnectedValue(h);if(this.output._storedValue=V,!this.direction.isConnected)return;const i={process:i=>{h.particleContext=i,h.systemContext=V,i.direction.l(this.direction.getConnectedValue(h))},previousItem:null,nextItem:null};V._updateQueueStart?dh(i,V._updateQueueStart):V._updateQueueStart=i}});(0,q.f)("BABYLON.UpdateColorBlock",class extends bV{constructor(h){super(h),this.registerInput("particle",rV.Particle),this.registerInput("color",rV.vq),this.registerOutput("output",rV.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(h){const V=this.particle.getConnectedValue(h);if(this.output._storedValue=V,!this.color.isConnected)return;const i={process:i=>{h.particleContext=i,h.systemContext=V,i.color.l(this.color.getConnectedValue(h))},previousItem:null,nextItem:null};V._updateQueueStart?dh(i,V._updateQueueStart):V._updateQueueStart=i}});(0,q.f)("BABYLON.UpdateScaleBlock",class extends bV{constructor(h){super(h),this.registerInput("particle",rV.Particle),this.registerInput("scale",rV.Vector2),this.registerOutput("output",rV.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(h){const V=this.particle.getConnectedValue(h);if(this.output._storedValue=V,!this.scale.isConnected)return;const i={process:i=>{h.particleContext=i,h.systemContext=V,i.scale.l(this.scale.getConnectedValue(h))},previousItem:null,nextItem:null};V._updateQueueStart?dh(i,V._updateQueueStart):V._updateQueueStart=i}});(0,q.f)("BABYLON.UpdateAngleBlock",class extends bV{constructor(h){super(h),this.registerInput("particle",rV.Particle),this.registerInput("angle",rV.Float),this.registerOutput("output",rV.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(h){const V=this.particle.getConnectedValue(h);if(this.output._storedValue=V,!this.angle.isConnected)return;const i={process:i=>{h.particleContext=i,h.systemContext=V,i.angle=this.angle.getConnectedValue(h)},previousItem:null,nextItem:null};V._updateQueueStart?dh(i,V._updateQueueStart):V._updateQueueStart=i}});(0,q.f)("BABYLON.BasicPositionUpdateBlock",class extends bV{constructor(h){super(h),this.registerInput("particle",rV.Particle),this.registerOutput("output",rV.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(h){const V=this.particle.getConnectedValue(h),i={process:i=>{h.particleContext=i,h.systemContext=V,i.direction.scaleToRef(V._directionScale,V._scaledDirection),i.position.addInPlace(V._scaledDirection)},previousItem:null,nextItem:null};V._updateQueueStart?dh(i,V._updateQueueStart):V._updateQueueStart=i,this.output._storedValue=V}});(0,q.f)("BABYLON.BasicSpriteUpdateBlock",class extends bV{constructor(h){super(h),this.registerInput("particle",rV.Particle),this.registerOutput("output",rV.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(h){const V=this.particle.getConnectedValue(h),i={process:i=>{h.particleContext=i,h.systemContext=V,i.updateCellIndex()},previousItem:null,nextItem:null};V._updateQueueStart?dh(i,V._updateQueueStart):V._updateQueueStart=i,this.output._storedValue=V}});(0,q.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends bV{constructor(h){super(h),this.registerInput("particle",rV.Particle),this.registerInput("cellIndex",rV.Int),this.registerOutput("output",rV.Particle),this.cellIndex.acceptedConnectionPointTypes=[rV.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(h){const V=this.particle.getConnectedValue(h);if(this.output._storedValue=V,!this.cellIndex.isConnected)return;const i={process:i=>{h.particleContext=i,h.systemContext=V,i.cellIndex=Math.floor(this.cellIndex.getConnectedValue(h))},previousItem:null,nextItem:null};V._updateQueueStart?dh(i,V._updateQueueStart):V._updateQueueStart=i}});class qi extends bV{constructor(h){super(h),this.strength=1,this.registerInput("particle",rV.Particle),this.registerInput("flowMap",rV.Texture),this.registerOutput("output",rV.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(h){var V;const i=this.particle.getConnectedValue(h),S=h.fV;let l;(null===(V=this.flowMap.connectedPoint)||void 0===V?void 0:V.ownerBlock).extractTextureContentAsync().then((h=>{h&&(l=new NV(h.width,h.height,h.data))}));const Y={process:h=>{const V=S.getTransformMatrix();l&&l._processParticle(h,this.strength*i._tempScaledUpdateSpeed,V)},previousItem:null,nextItem:null};i._updateQueueStart?dh(Y,i._updateQueueStart):i._updateQueueStart=Y,this.output._storedValue=i}serialize(){const h=super.serialize();return h.strength=this.strength,h}_deserialize(h){super._deserialize(h),this.strength=h.strength}}(0,j.b)([CV("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qi.prototype,"strength",void 0),(0,q.f)("BABYLON.UpdateFlowMapBlock",qi);(0,q.f)("BABYLON.SphereShapeBlock",class extends bV{constructor(h){super(h),this.registerInput("input",rV.Particle),this.registerInput("radius",rV.Float,!0,1),this.registerInput("radiusRange",rV.Float,!0,1,0,1),this.registerInput("directionRandomizer",rV.Float,!0,0,0,1),this.registerOutput("output",rV.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(h){const V=this.input.getConnectedValue(h);V._directionCreation.process=i=>{h.particleContext=i,h.systemContext=V;const l=this.directionRandomizer.getConnectedValue(h),Y=i.position.cV(h.emitterPosition).normalize(),g=(0,J.RandomRange)(0,l),q=(0,J.RandomRange)(0,l),B=(0,J.RandomRange)(0,l);Y.x+=g,Y.y+=q,Y.z+=B,Y.normalize(),h.isEmitterTransformNode?S.nV.TransformNormalFromFloatsToRef(g,q,B,h.emitterWorldMatrix,i.direction):i.direction.qq(g,q,B)},V._positionCreation.process=i=>{h.particleContext=i,h.systemContext=V;const l=this.radius.getConnectedValue(h),Y=this.radiusRange.getConnectedValue(h),g=l-(0,J.RandomRange)(0,l*Y),q=(0,J.RandomRange)(0,1),B=(0,J.RandomRange)(0,2*Math.PI),I=Math.acos(2*q-1),v=g*Math.cos(B)*Math.sin(I),s=g*Math.cos(I),t=g*Math.sin(B)*Math.sin(I);h.isEmitterTransformNode?S.nV.TransformCoordinatesFromFloatsToRef(v,s,t,h.emitterWorldMatrix,i.position):(i.position.qq(v,s,t),i.position.addInPlace(h.emitterPosition))},this.output._storedValue=V}});(0,q.f)("BABYLON.PointShapeBlock",class extends bV{constructor(h){super(h),this.registerInput("particle",rV.Particle),this.registerInput("direction1",rV.nV,!0,new S.nV(0,1,0)),this.registerInput("direction2",rV.nV,!0,new S.nV(0,1,0)),this.registerOutput("output",rV.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(h){const V=this.particle.getConnectedValue(h);V._directionCreation.process=i=>{h.particleContext=i,h.systemContext=V;const l=this.direction1.getConnectedValue(h),Y=this.direction2.getConnectedValue(h),g=(0,J.RandomRange)(l.x,Y.x),q=(0,J.RandomRange)(l.y,Y.y),B=(0,J.RandomRange)(l.z,Y.z);h.isEmitterTransformNode?S.nV.TransformNormalFromFloatsToRef(g,q,B,h.emitterWorldMatrix,i.direction):i.direction.qq(g,q,B)},V._positionCreation.process=i=>{h.systemContext=V,h.isEmitterTransformNode?S.nV.TransformCoordinatesFromFloatsToRef(0,0,0,h.emitterWorldMatrix,i.position):i.position.l(h.emitterPosition)},this.output._storedValue=V}});(0,q.f)("BABYLON.CustomShapeBlock",class extends bV{constructor(h){super(h),this.registerInput("particle",rV.Particle),this.registerInput("position",rV.nV,!0,new S.nV(0,0,0)),this.registerInput("direction",rV.nV,!0,new S.nV(0,1,0)),this.registerOutput("output",rV.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(h){const V=this.particle.getConnectedValue(h);V._directionCreation.process=i=>{h.particleContext=i,h.systemContext=V;const l=this.direction.getConnectedValue(h);h.isEmitterTransformNode?S.nV.TransformNormalToRef(l,h.emitterWorldMatrix,i.direction):i.direction.l(l)},V._positionCreation.process=i=>{h.particleContext=i,h.systemContext=V;const l=this.position.getConnectedValue(h);h.isEmitterTransformNode?S.nV.TransformCoordinatesToRef(l,h.emitterWorldMatrix,i.position):(i.position.l(l),i.position.addInPlace(h.emitterPosition))},this.output._storedValue=V}});(0,q.f)("BABYLON.CylinderShapeBlock",class extends bV{constructor(h){super(h),this._tempVector=S.nV.Zero(),this.registerInput("particle",rV.Particle),this.registerInput("radius",rV.Float,!0,1),this.registerInput("height",rV.Float,!0,1,0),this.registerInput("radiusRange",rV.Float,!0,1,0,1),this.registerInput("directionRandomizer",rV.Float,!0,0,0,1),this.registerOutput("output",rV.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(h){const V=this.particle.getConnectedValue(h);V._directionCreation.process=i=>{h.particleContext=i,h.systemContext=V;const l=this.directionRandomizer.getConnectedValue(h);i.position.subtractToRef(h.emitterPosition,this._tempVector),this._tempVector.normalize(),h.isEmitterTransformNode&&S.nV.TransformNormalToRef(this._tempVector,h.emitterInverseWorldMatrix,this._tempVector);const Y=(0,J.RandomRange)(-l/2,l/2);let g=Math.atan2(this._tempVector.x,this._tempVector.z);g+=(0,J.RandomRange)(-Math.PI/2,Math.PI/2)*l,this._tempVector.y=Y,this._tempVector.x=Math.sin(g),this._tempVector.z=Math.cos(g),this._tempVector.normalize(),h.isEmitterTransformNode?S.nV.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,h.emitterWorldMatrix,i.direction):i.direction.l(this._tempVector)},V._positionCreation.process=i=>{h.particleContext=i,h.systemContext=V;const l=this.height.getConnectedValue(h),Y=this.radiusRange.getConnectedValue(h),g=this.radius.getConnectedValue(h),q=(0,J.RandomRange)(-l/2,l/2),B=(0,J.RandomRange)(0,2*Math.PI),I=(0,J.RandomRange)((1-Y)*(1-Y),1),v=Math.sqrt(I)*g,s=v*Math.cos(B),t=v*Math.sin(B);h.isEmitterTransformNode?S.nV.TransformCoordinatesFromFloatsToRef(s,q,t,h.emitterWorldMatrix,i.position):(i.position.qq(s,q,t),i.position.addInPlace(h.emitterPosition))},this.output._storedValue=V}});class Bi extends bV{constructor(h){super(h),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",rV.Particle),this.registerOutput("output",rV.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){super._build(h);const V=this.particle.getConnectedValue(h);V._isAnimationSheetEnabled=!0,V.spriteCellWidth=this.width,V.spriteCellHeight=this.height,V.startSpriteCellID=this.start,V.endSpriteCellID=this.end,V.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=V}serialize(){const h=super.serialize();return h.width=this.width,h.height=this.height,h.start=this.start,h.end=this.end,h.randomStartCell=this.randomStartCell,h}_deserialize(h){super._deserialize(h),this.width=h.width,this.height=h.height,this.start=h.start,this.end=h.end,this.randomStartCell=h.randomStartCell}}(0,j.b)([CV("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bi.prototype,"start",void 0),(0,j.b)([CV("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bi.prototype,"end",void 0),(0,j.b)([CV("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bi.prototype,"width",void 0),(0,j.b)([CV("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bi.prototype,"height",void 0),(0,j.b)([CV("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Bi.prototype,"loop",void 0),(0,j.b)([CV("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Bi.prototype,"randomStartCell",void 0),(0,q.f)("BABYLON.SetupSpriteSheetBlock",Bi);class Ji extends bV{constructor(h){super(h),this.reference=0,this.registerInput("value",rV.AutoDetect),this.registerOutput("output",rV.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=h=>{switch(h){case rV.Float:return rV.FloatGradient;case rV.Vector2:return rV.Vector2Gradient;case rV.nV:return rV.Vector3Gradient;case rV.vq:return rV.Color4Gradient}return h},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(rV.Float|rV.Vector2|rV.nV|rV.vq)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=h=>null}serialize(){const h=super.serialize();return h.reference=this.reference,h}_deserialize(h){super._deserialize(h),this.reference=h.reference}}(0,j.b)([CV("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Ji.prototype,"reference",void 0),(0,q.f)("BABYLON.ParticleGradientValueBlock",Ji);(0,q.f)("BABYLON.ParticleGradientBlock",class extends bV{constructor(h){super(h),this._entryCount=1,this.registerInput("gradient",rV.Float,!0,1,0,1),this.registerInput("value0",rV.AutoDetect),this.registerOutput("output",rV.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=h=>{switch(h){case rV.FloatGradient:return rV.Float;case rV.Vector2Gradient:return rV.Vector2;case rV.Vector3Gradient:return rV.nV;case rV.Color4Gradient:return rV.vq}return h},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(rV.FloatGradient|rV.Vector2Gradient|rV.Vector3Gradient|rV.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(h){this._inputs[h].onConnectionObservable.add((()=>{this._entryCount>h||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),rV.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const h=[];for(let i=1;i<this._inputs.length;i++){var V;if(this._inputs[i].isConnected)h.push(null===(V=this._inputs[i].connectedPoint)||void 0===V?void 0:V.ownerBlock)}h.sort(((h,V)=>h.reference-V.reference)),this.output._storedFunction=V=>{const i=this.gradient.getConnectedValue(V);if(1===h.length)return h[0].value.getConnectedValue(V);let l=null;for(let Y=h.length-1;Y>=0;Y--){const q=h[Y];if(q.reference<=i){const h=q.value.getConnectedValue(V);if(l){const Y=l.value.getConnectedValue(V),B=l.reference,I=q.reference,v=Math.max(0,Math.min(1,(i-I)/(B-I)));switch(this.output.type){case rV.Float:return(0,J.Lerp)(h,Y,v);case rV.Vector2:return S.Vector2.Lerp(h,Y,v);case rV.nV:return S.nV.Lerp(h,Y,v);case rV.vq:return g.vq.Lerp(h,Y,v)}}return h}l=q}return 0}}});(0,q.f)("BABYLON.ParticleConverterBlock",class extends bV{constructor(h){super(h),this.registerInput("color ",rV.vq,!0),this.registerInput("xyz ",rV.nV,!0),this.registerInput("xy ",rV.Vector2,!0),this.registerInput("zw ",rV.Vector2,!0),this.registerInput("x ",rV.Float,!0),this.registerInput("y ",rV.Float,!0),this.registerInput("z ",rV.Float,!0),this.registerInput("w ",rV.Float,!0),this.registerOutput("color",rV.vq),this.registerOutput("xyz",rV.nV),this.registerOutput("xy",rV.Vector2),this.registerOutput("zw",rV.Vector2),this.registerOutput("x",rV.Float),this.registerOutput("y",rV.Float),this.registerOutput("z",rV.Float),this.registerOutput("w",rV.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(h){return"color "===h?"colorIn":"xyz "===h?"xyzIn":"xy "===h?"xyIn":"zw "===h?"zwIn":"x "===h?"xIn":"y "===h?"yIn":"z "===h?"zIn":"w "===h?"wIn":h}_outputRename(h){switch(h){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return h}}_build(h){super._build(h);const V=this.xIn,i=this.yIn,l=this.zIn,Y=this.wIn,q=this.xyIn,B=this.zwIn,J=this.xyzIn,I=this.colorIn,v=this.colorOut,s=this.xyzOut,t=this.xyOut,T=this.zwOut,e=this.xOut,n=this.yOut,c=this.zOut,f=this.wOut,P=h=>{if(I.isConnected)return I.getConnectedValue(h);let S=0,v=0,s=0,t=0;if(V.isConnected&&(S=V.getConnectedValue(h)),i.isConnected&&(v=i.getConnectedValue(h)),l.isConnected&&(s=l.getConnectedValue(h)),Y.isConnected&&(t=Y.getConnectedValue(h)),q.isConnected){const V=q.getConnectedValue(h);V&&(S=V.x,v=V.y)}if(B.isConnected){const V=B.getConnectedValue(h);V&&(s=V.x,t=V.y)}if(J.isConnected){const V=J.getConnectedValue(h);V&&(S=V.x,v=V.y,s=V.z)}return new g.vq(S,v,s,t)};v._storedFunction=h=>P(h),s._storedFunction=h=>{const V=P(h);return new S.nV(V.r,V.g,V.b)},t._storedFunction=h=>{const V=P(h);return new S.Vector2(V.r,V.g)},T._storedFunction=h=>{const V=P(h);return new S.Vector2(V.b,V.a)},e._storedFunction=h=>P(h).r,n._storedFunction=h=>P(h).g,c._storedFunction=h=>P(h).b,f._storedFunction=h=>P(h).a}}),function(h){h[h.Cos=0]="Cos",h[h.Sin=1]="Sin",h[h.Abs=2]="Abs",h[h.Exp=3]="Exp",h[h.Exp2=4]="Exp2",h[h.Round=5]="Round",h[h.Floor=6]="Floor",h[h.Ceiling=7]="Ceiling",h[h.Sqrt=8]="Sqrt",h[h.Log=9]="Log",h[h.Tan=10]="Tan",h[h.ArcTan=11]="ArcTan",h[h.ArcCos=12]="ArcCos",h[h.ArcSin=13]="ArcSin",h[h.Sign=14]="Sign",h[h.Negate=15]="Negate",h[h.OneMinus=16]="OneMinus",h[h.Reciprocal=17]="Reciprocal",h[h.ToDegrees=18]="ToDegrees",h[h.ToRadians=19]="ToRadians",h[h.Fract=20]="Fract"}(QV||(QV={}));class Ii extends bV{constructor(h){super(h),this.operation=QV.Cos,this.registerInput("input",rV.AutoDetect),this.registerOutput("output",rV.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(rV.Float|rV.Int|rV.Vector2|rV.nV|rV.vq)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){super._build(h);let V=null;switch(this.operation){case QV.Cos:V=h=>Math.cos(h);break;case QV.Sin:V=h=>Math.sin(h);break;case QV.Abs:V=h=>Math.abs(h);break;case QV.Exp:V=h=>Math.exp(h);break;case QV.Exp2:V=h=>Math.pow(2,h);break;case QV.Round:V=h=>Math.round(h);break;case QV.Floor:V=h=>Math.floor(h);break;case QV.Ceiling:V=h=>Math.ceil(h);break;case QV.Sqrt:V=h=>Math.sqrt(h);break;case QV.Log:V=h=>Math.log(h);break;case QV.Tan:V=h=>Math.tan(h);break;case QV.ArcTan:V=h=>Math.atan(h);break;case QV.ArcCos:V=h=>Math.acos(h);break;case QV.ArcSin:V=h=>Math.asin(h);break;case QV.Sign:V=h=>Math.sign(h);break;case QV.Negate:V=h=>-h;break;case QV.OneMinus:V=h=>1-h;break;case QV.Reciprocal:V=h=>1/h;break;case QV.ToRadians:V=h=>h*Math.PI/180;break;case QV.ToDegrees:V=h=>180*h/Math.PI;break;case QV.Fract:V=h=>h>=0?h-Math.floor(h):h-Math.ceil(h)}if(!V)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case rV.Int:case rV.Float:this.output._storedFunction=h=>{const i=this.input.getConnectedValue(h);return V(i)};break;case rV.Vector2:this.output._storedFunction=h=>{const i=this.input.getConnectedValue(h);return new S.Vector2(V(i.x),V(i.y))};break;case rV.nV:this.output._storedFunction=h=>{const i=this.input.getConnectedValue(h);return new S.nV(V(i.x),V(i.y),V(i.z))};break;case rV.vq:this.output._storedFunction=h=>{const i=this.input.getConnectedValue(h);return new g.vq(V(i.r),V(i.g),V(i.b),V(i.a))}}return this}serialize(){const h=super.serialize();return h.operation=this.operation,h}_deserialize(h){super._deserialize(h),this.operation=h.operation}}(0,j.b)([CV("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:QV.Cos},{label:"Sin",value:QV.Sin},{label:"Abs",value:QV.Abs},{label:"Exp",value:QV.Exp},{label:"Exp2",value:QV.Exp2},{label:"Round",value:QV.Round},{label:"Floor",value:QV.Floor},{label:"Ceiling",value:QV.Ceiling},{label:"Sqrt",value:QV.Sqrt},{label:"Log",value:QV.Log},{label:"Tan",value:QV.Tan},{label:"ArcTan",value:QV.ArcTan},{label:"ArcCos",value:QV.ArcCos},{label:"ArcSin",value:QV.ArcSin},{label:"Sign",value:QV.Sign},{label:"Negate",value:QV.Negate},{label:"OneMinus",value:QV.OneMinus},{label:"Reciprocal",value:QV.Reciprocal},{label:"ToDegrees",value:QV.ToDegrees},{label:"ToRadians",value:QV.ToRadians},{label:"Fract",value:QV.Fract}]})],Ii.prototype,"operation",void 0),(0,q.f)("BABYLON.ParticleTrigonometryBlock",Ii);var vi,si=i(12493);class ti extends bV{constructor(h){super(h),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",rV.AutoDetect),this.registerOutput("output",rV.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(rV.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(rV.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(rV.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(rV.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(rV.System),this._inputs[0].excludedConnectionPointTypes.push(rV.Particle),this._inputs[0].excludedConnectionPointTypes.push(rV.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const V=h=>{const V=this.input.getConnectedValue(h);if(this.log.length>=this.stackSize)return V;if(null===V||void 0===V)return this.log.push(["null",""]),V;switch(this.input.type){case rV.Vector2:this.log.push([(0,si.e)(V,4),V.toString()]);break;case rV.nV:this.log.push([(0,si.f)(V,4),V.toString()]);break;case rV.vq:this.log.push([`{R: ${V.r.toFixed(4)} G: ${V.g.toFixed(4)} B: ${V.b.toFixed(4)} A: ${V.a.toFixed(4)}}`,V.toString()]);break;default:this.log.push([V.toString(),V.toString()])}return V};this.output.isConnected?this.output._storedFunction=V:this.output._storedValue=V(h)}serialize(){const h=super.serialize();return h.stackSize=this.stackSize,h}_deserialize(h){super._deserialize(h),this.stackSize=h.stackSize}}(0,j.b)([CV("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],ti.prototype,"stackSize",void 0),(0,q.f)("BABYLON.ParticleDebugBlock",ti);(0,q.f)("BABYLON.ParticleElbowBlock",class extends bV{constructor(h){super(h),this.registerInput("input",rV.AutoDetect),this.registerOutput("output",rV.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){super._build(h);const V=this._outputs[0],i=this._inputs[0];V._storedFunction=h=>i.getConnectedValue(h)}});(0,q.f)("BABYLON.ParticleTeleportInBlock",class extends bV{get endpoints(){return this._endpoints}constructor(h){super(h),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",rV.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(h){if(this.getClassName()===h)return!0;for(const V of this.endpoints)if(V.isAnAncestorOfType(h))return!0;return!1}isAnAncestorOf(h){for(const V of this.endpoints){if(V===h)return!0;if(V.isAnAncestorOf(h))return!0}return!1}attachToEndpoint(h){h.detach(),this._endpoints.push(h),h._entryPoint=this,h._outputs[0]._typeConnectionSource=this._inputs[0],h._tempEntryPointUniqueId=null,h.name="> "+this.name}detachFromEndpoint(h){const V=this._endpoints.indexOf(h);-1!==V&&(this._endpoints.splice(V,1),h._outputs[0]._typeConnectionSource=null,h._entryPoint=null)}_build(){for(const h of this._endpoints)h.output._storedFunction=h=>this.input.getConnectedValue(h)}});(0,q.f)("BABYLON.ParticleTeleportOutBlock",class extends bV{constructor(h){super(h),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",rV.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(h){this.entryPoint&&this.entryPoint.build(h)}clone(){const h=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(h),h}serialize(){var h;const V=super.serialize();return V.entryPoint=(null===(h=this.entryPoint)||void 0===h?void 0:h.uniqueId)??"",V}_deserialize(h){super._deserialize(h),this._tempEntryPointUniqueId=h.entryPoint}}),function(h){h[h.Equal=0]="Equal",h[h.NotEqual=1]="NotEqual",h[h.LessThan=2]="LessThan",h[h.GreaterThan=3]="GreaterThan",h[h.LessOrEqual=4]="LessOrEqual",h[h.GreaterOrEqual=5]="GreaterOrEqual",h[h.Xor=6]="Xor",h[h.Or=7]="Or",h[h.And=8]="And"}(vi||(vi={}));class Ti extends bV{constructor(h){super(h),this.test=vi.Equal,this.epsilon=0,this.registerInput("left",rV.Float),this.registerInput("right",rV.Float,!0,0),this.registerInput("ifTrue",rV.AutoDetect,!0,1),this.registerInput("ifFalse",rV.AutoDetect,!0,0),this.registerOutput("output",rV.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=rV.Float,this._inputs[0].acceptedConnectionPointTypes.push(rV.Int),this._inputs[1].acceptedConnectionPointTypes.push(rV.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const h=h=>{const V=this.left.getConnectedValue(h),i=this.right.getConnectedValue(h);let S=!1;switch(this.test){case vi.Equal:S=(0,J.WithinEpsilon)(V,i,this.epsilon);break;case vi.NotEqual:S=!(0,J.WithinEpsilon)(V,i,this.epsilon);break;case vi.LessThan:S=V<i+this.epsilon;break;case vi.GreaterThan:S=V>i-this.epsilon;break;case vi.LessOrEqual:S=V<=i+this.epsilon;break;case vi.GreaterOrEqual:S=V>=i-this.epsilon;break;case vi.Xor:S=!!V&&!i||!V&&!!i;break;case vi.Or:S=!!V||!!i;break;case vi.And:S=!!V&&!!i}return S};this.output._storedFunction=V=>h(V)?this.ifTrue.getConnectedValue(V):this.ifFalse.getConnectedValue(V)}serialize(){const h=super.serialize();return h.test=this.test,h.epsilon=this.epsilon,h}_deserialize(h){super._deserialize(h),this.test=h.test,void 0!==h.epsilon&&(this.epsilon=h.epsilon)}}(0,j.b)([CV("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:vi.Equal},{label:"NotEqual",value:vi.NotEqual},{label:"LessThan",value:vi.LessThan},{label:"GreaterThan",value:vi.GreaterThan},{label:"LessOrEqual",value:vi.LessOrEqual},{label:"GreaterOrEqual",value:vi.GreaterOrEqual},{label:"Xor",value:vi.Xor},{label:"Or",value:vi.Or},{label:"And",value:vi.And}]})],Ti.prototype,"test",void 0),(0,j.b)([CV("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ti.prototype,"epsilon",void 0),(0,q.f)("BABYLON.ParticleConditionBlock",Ti);class ei extends bV{constructor(h){super(h),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",rV.Particle),this.registerInput("condition",rV.Float,!0,0),this.registerInput("system",rV.System),this.registerOutput("output",rV.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(h){this._triggerCount=0;const V=this.input.getConnectedValue(h),i={process:i=>{if(h.particleContext=i,h.systemContext=V,0!==this.condition.getConnectedValue(h)&&(0===this.limit||this._triggerCount<this.limit)){const S=(new Date).getTime();if(this._previousOne&&S-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=S;const l=this.system.getConnectedValue(h);if(l){const S=pV(l,h.fV,i.position);S.Ig.addOnce((()=>{this._triggerCount--})),V.Ig.addOnce((()=>{S.dispose()}))}}},previousItem:null,nextItem:null};V._updateQueueStart?dh(i,V._updateQueueStart):V._updateQueueStart=i,this.output._storedValue=V}serialize(){const h=super.serialize();return h.limit=this.limit,h.delay=this.delay,h}_deserialize(h){super._deserialize(h),void 0!==h.limit&&(this.limit=h.limit),void 0!==h.delay&&(this.delay=h.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,j.b)([CV("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ei.prototype,"limit",void 0),(0,j.b)([CV("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ei.prototype,"delay",void 0),(0,q.f)("BABYLON.ParticleTriggerBlock",ei);i(12498),i(12508),i(12520),i(12568)},12546:(h,V,i)=>{"use strict";var S=i(11042);const l="clipPlaneFragment",Y="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12522:(h,V,i)=>{"use strict";var S=i(11042);const l="clipPlaneFragmentDeclaration",Y="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12583:(h,V,i)=>{"use strict";var S=i(11042);const l="clipPlaneVertex",Y="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12577:(h,V,i)=>{"use strict";var S=i(11042);const l="clipPlaneVertexDeclaration",Y="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12560:(h,V,i)=>{"use strict";var S=i(11042);const l="fogFragment",Y="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12544:(h,V,i)=>{"use strict";var S=i(11042);const l="fogFragmentDeclaration",Y="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12590:(h,V,i)=>{"use strict";var S=i(11042);const l="fogVertex",Y="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12581:(h,V,i)=>{"use strict";var S=i(11042);const l="fogVertexDeclaration",Y="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12534:(h,V,i)=>{"use strict";var S=i(11042);const l="helperFunctions",Y="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12526:(h,V,i)=>{"use strict";var S=i(11042);const l="imageProcessingDeclaration",Y="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12542:(h,V,i)=>{"use strict";var S=i(11042);const l="imageProcessingFunctions",Y="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12531:(h,V,i)=>{"use strict";var S=i(11042);const l="logDepthDeclaration",Y="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12551:(h,V,i)=>{"use strict";var S=i(11042);const l="logDepthFragment",Y="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12596:(h,V,i)=>{"use strict";var S=i(11042);const l="logDepthVertex",Y="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";S.d.IncludesShadersStoreWGSL[l]||(S.d.IncludesShadersStoreWGSL[l]=Y)},12520:(h,V,i)=>{"use strict";i.r(V),i.d(V,{particlesPixelShaderWGSL:()=>g});var S=i(11042);i(12522),i(12526),i(12531),i(12534),i(12542),i(12544),i(12546),i(12551),i(12560);const l="particlesPixelShader",Y="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";S.d.ShadersStoreWGSL[l]||(S.d.ShadersStoreWGSL[l]=Y);const g={name:l,shader:Y}},12568:(h,V,i)=>{"use strict";i.r(V),i.d(V,{particlesVertexShaderWGSL:()=>g});var S=i(11042);i(12577),i(12581),i(12531),i(12583),i(12590),i(12596);const l="particlesVertexShader",Y="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";S.d.ShadersStoreWGSL[l]||(S.d.ShadersStoreWGSL[l]=Y);const g={name:l,shader:Y}},12434:(h,V,i)=>{"use strict";var S=i(11042);const l="clipPlaneFragment",Y="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12503:(h,V,i)=>{"use strict";var S=i(11042);const l="clipPlaneFragmentDeclaration",Y="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12452:(h,V,i)=>{"use strict";var S=i(11042);const l="clipPlaneVertex",Y="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12512:(h,V,i)=>{"use strict";var S=i(11042);const l="clipPlaneVertexDeclaration",Y="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12442:(h,V,i)=>{"use strict";var S=i(11042);const l="fogFragment",Y="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12431:(h,V,i)=>{"use strict";var S=i(11042);const l="fogFragmentDeclaration",Y="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12455:(h,V,i)=>{"use strict";var S=i(11042);const l="fogVertex",Y="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12446:(h,V,i)=>{"use strict";var S=i(11042);const l="fogVertexDeclaration",Y="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12425:(h,V,i)=>{"use strict";var S=i(11042);const l="helperFunctions",Y="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12411:(h,V,i)=>{"use strict";var S=i(11042);const l="imageProcessingDeclaration",Y="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12428:(h,V,i)=>{"use strict";var S=i(11042);const l="imageProcessingFunctions",Y="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12417:(h,V,i)=>{"use strict";var S=i(11042);const l="logDepthDeclaration",Y="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12440:(h,V,i)=>{"use strict";var S=i(11042);const l="logDepthFragment",Y="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12461:(h,V,i)=>{"use strict";var S=i(11042);const l="logDepthVertex",Y="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";S.d.IncludesShadersStore[l]||(S.d.IncludesShadersStore[l]=Y)},12498:(h,V,i)=>{"use strict";i.r(V),i.d(V,{particlesPixelShader:()=>g});var S=i(11042);i(12503),i(12411),i(12417),i(12425),i(12428),i(12431),i(12434),i(12440),i(12442);const l="particlesPixelShader",Y="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";S.d.ShadersStore[l]||(S.d.ShadersStore[l]=Y);const g={name:l,shader:Y}},12508:(h,V,i)=>{"use strict";i.r(V),i.d(V,{particlesVertexShader:()=>g});var S=i(11042);i(12512),i(12446),i(12417),i(12452),i(12455),i(12461);const l="particlesVertexShader",Y="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";S.d.ShadersStore[l]||(S.d.ShadersStore[l]=Y);const g={name:l,shader:Y}},12868:(h,V,i)=>{"use strict";i.r(V),i.d(V,{FlowGraphGLTFDataProvider:()=>Y});var S=i(12827),l=i(12805);class Y extends S.c{constructor(h){var V,i;super();const S=h.glTF,Y=(null===(V=S.animations)||void 0===V?void 0:V.map((h=>h._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",l.c,Y);const g=(null===(i=S.nodes)||void 0===i?void 0:i.map((h=>h._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",l.c,g)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12737:(h,V,i)=>{"use strict";i.d(V,{b:()=>n,f:()=>T,g:()=>t,k:()=>e});var S=i(11138),l=i(11620),Y=i(11189),g=i(12743);const q=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class B{constructor(h,V){this._gltf=h,this._infoTree=V}convert(h){let V,i=this._gltf,S=this._infoTree;if(!h.startsWith("/"))throw new Error("Path must start with a /");const l=h.split("/");if(l.shift(),l[l.length-1].includes(".length")){const h=l[l.length-1].split(".");l.pop(),l.push(...h)}let Y=!1;for(const B of l){const l="length"===B;if(l&&!S.__array__)throw new Error(`Path ${h} is invalid`);if(S.__ignoreObjectTree__&&(Y=!0),S.__array__&&!l)S=S.__array__;else if(S=S[B],!S)throw new Error(`Path ${h} is invalid`);if(!Y)if(void 0===i){if(!q.find((V=>V.regex.test(h))))throw new Error(`Path ${h} is invalid`)}else if(!l){var g;i=null===(g=i)||void 0===g?void 0:g[B]}(S.__target__||l)&&(V=i)}return{object:V,info:S}}}function J(h,V,i,S){const l=I(h,V);return S?l[i][S]:l[i]}function I(h,V,i){var S,Y;return null===(S=h._data)||void 0===S||null===(Y=S[(null===i||void 0===i?void 0:i.fillMode)??l.e.MATERIAL_TriangleFillMode])||void 0===Y?void 0:Y.babylonMaterial}function v(h,V){return{offset:{componentsCount:2,type:"Vector2",get:(i,l,Y)=>{const g=J(i,Y,h,V);return new S.Vector2(null===g||void 0===g?void 0:g.uOffset,null===g||void 0===g?void 0:g.vOffset)},getTarget:I,set:(i,S,l,Y)=>{const g=J(S,Y,h,V);g.uOffset=i.x,g.vOffset=i.y},getPropertyName:[()=>`${h}${V?"."+V:""}.uOffset`,()=>`${h}${V?"."+V:""}.vOffset`]},rotation:{type:"number",get:(i,S,l)=>{var Y;return null===(Y=J(i,l,h,V))||void 0===Y?void 0:Y.wAng},getTarget:I,set:(i,S,l,Y)=>J(S,Y,h,V).wAng=i,getPropertyName:[()=>`${h}${V?"."+V:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(i,l,Y)=>{const g=J(i,Y,h,V);return new S.Vector2(null===g||void 0===g?void 0:g.uScale,null===g||void 0===g?void 0:g.vScale)},getTarget:I,set:(i,S,l,Y)=>{const g=J(S,Y,h,V);g.uScale=i.x,g.vScale=i.y},getPropertyName:[()=>`${h}${V?"."+V:""}.uScale`,()=>`${h}${V?"."+V:""}.vScale`]}}}const s={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:h=>{var V,i;return new S.Vector2((null===(V=h._babylonCamera)||void 0===V?void 0:V.orthoLeft)??0,(null===(i=h._babylonCamera)||void 0===i?void 0:i.orthoRight)??0)},set:(h,V)=>{V._babylonCamera&&(V._babylonCamera.orthoLeft=h.x,V._babylonCamera.orthoRight=h.y)},getTarget:h=>h,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:h=>{var V,i;return new S.Vector2((null===(V=h._babylonCamera)||void 0===V?void 0:V.orthoBottom)??0,(null===(i=h._babylonCamera)||void 0===i?void 0:i.orthoTop)??0)},set:(h,V)=>{V._babylonCamera&&(V._babylonCamera.orthoBottom=h.x,V._babylonCamera.orthoTop=h.y)},getTarget:h=>h,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:h=>{var V;return null===(V=h._babylonCamera)||void 0===V?void 0:V.maxZ},set:(h,V)=>{V._babylonCamera&&(V._babylonCamera.maxZ=h)},getTarget:h=>h,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:h=>{var V;return null===(V=h._babylonCamera)||void 0===V?void 0:V.Zg},set:(h,V)=>{V._babylonCamera&&(V._babylonCamera.Zg=h)},getTarget:h=>h,getPropertyName:[()=>"Zg"]}},perspective:{aspectRatio:{type:"number",get:h=>{var V;return null===(V=h._babylonCamera)||void 0===V?void 0:V.getEngine().getAspectRatio(h._babylonCamera)},getTarget:h=>h,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:h=>{var V;return null===(V=h._babylonCamera)||void 0===V?void 0:V.fov},set:(h,V)=>{V._babylonCamera&&(V._babylonCamera.fov=h)},getTarget:h=>h,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:h=>{var V;return null===(V=h._babylonCamera)||void 0===V?void 0:V.maxZ},set:(h,V)=>{V._babylonCamera&&(V._babylonCamera.maxZ=h)},getTarget:h=>h,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:h=>{var V;return null===(V=h._babylonCamera)||void 0===V?void 0:V.Zg},set:(h,V)=>{V._babylonCamera&&(V._babylonCamera.Zg=h)},getTarget:h=>h,getPropertyName:[()=>"Zg"]}}}},nodes:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"nV",get:h=>{var V;return null===(V=h._babylonTransformNode)||void 0===V?void 0:V.position},set:(h,V)=>{var i;return null===(i=V._babylonTransformNode)||void 0===i?void 0:i.position.l(h)},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:h=>{var V;return null===(V=h._babylonTransformNode)||void 0===V?void 0:V.rotationQuaternion},set:(h,V)=>{var i,S;return null===(i=V._babylonTransformNode)||void 0===i||null===(S=i.rotationQuaternion)||void 0===S?void 0:S.l(h)},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"nV",get:h=>{var V;return null===(V=h._babylonTransformNode)||void 0===V?void 0:V.Jq},set:(h,V)=>{var i;return null===(i=V._babylonTransformNode)||void 0===i?void 0:i.Jq.l(h)},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"Jq"]},weights:{length:{type:"number",get:h=>h._numMorphTargets,getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(h,V)=>{var i,S;return void 0!==V?null===(i=h._primitiveBabylonMeshes)||void 0===i||null===(S=i[0].morphTargetManager)||void 0===S?void 0:S.getTarget(V).influence:void 0},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(h,V)=>[0],getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:h=>{var V,i,l;return S.Matrix.Compose(null===(V=h._babylonTransformNode)||void 0===V?void 0:V.Jq,null===(i=h._babylonTransformNode)||void 0===i?void 0:i.rotationQuaternion,null===(l=h._babylonTransformNode)||void 0===l?void 0:l.position)},getTarget:h=>h._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:h=>{var V,i,l,Y;const g=S.Matrix.Identity();let q=h.parent;for(;q&&q.parent;)q=q.parent;const B=(null===(V=h._babylonTransformNode)||void 0===V?void 0:V.position._isDirty)||(null===(i=h._babylonTransformNode)||void 0===i||null===(l=i.rotationQuaternion)||void 0===l?void 0:l._isDirty)||(null===(Y=h._babylonTransformNode)||void 0===Y?void 0:Y.Jq._isDirty);if(q){var J;const V=null===(J=q._babylonTransformNode)||void 0===J?void 0:J.Ag(!0).invert();var I,v;if(V)null===(I=h._babylonTransformNode)||void 0===I||null===(v=I.Ag(B))||void 0===v||v.multiplyToRef(V,g)}else h._babylonTransformNode&&g.l(h._babylonTransformNode.Ag(B));return g},getTarget:h=>h._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:h=>{var V,i;return null===(V=h._babylonTransformNode)||void 0===V||null===(i=V.getChildren((h=>h instanceof g.b),!0)[0])||void 0===i?void 0:i.Tq},getTarget:h=>{var V;return null===(V=h._babylonTransformNode)||void 0===V?void 0:V.getChildren((h=>h instanceof g.b),!0)[0]},set:(h,V)=>{if(V._babylonTransformNode){const i=V._babylonTransformNode.getChildren((h=>h instanceof g.b),!0)[0];i&&(i.Tq=h)}}},color:{type:"LV",get:h=>{var V,i;return null===(V=h._babylonTransformNode)||void 0===V||null===(i=V.getChildren((h=>h instanceof g.b),!0)[0])||void 0===i?void 0:i.eq},getTarget:h=>{var V;return null===(V=h._babylonTransformNode)||void 0===V?void 0:V.getChildren((h=>h instanceof g.b),!0)[0]},set:(h,V)=>{if(V._babylonTransformNode){const i=V._babylonTransformNode.getChildren((h=>h instanceof g.b),!0)[0];i&&(i.eq=h)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"LV",get:(h,V,i)=>I(h,V,i).emissiveColor,set:(h,V,i,S)=>I(V,i,S).emissiveColor.l(h),getTarget:(h,V,i)=>I(h,V,i),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:v("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(h,V,i)=>{var S;return null===(S=J(h,i,"bumpTexture"))||void 0===S?void 0:S.level},set:(h,V,i,S)=>{const l=J(V,S,"bumpTexture");l&&(l.level=h)},getTarget:(h,V,i)=>I(h,V,i),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:v("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(h,V,i)=>I(h,V,i).ambientTextureStrength,set:(h,V,i,S)=>{const l=I(V,i,S);l&&(l.ambientTextureStrength=h)},getTarget:(h,V,i)=>I(h,V,i),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:v("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"vq",get:(h,V,i)=>{const S=I(h,V,i);return Y.vq.FromColor3(S.albedoColor,S.alpha)},set:(h,V,i,S)=>{const l=I(V,i,S);l.albedoColor.set(h.r,h.g,h.b),l.alpha=h.a},getTarget:(h,V,i)=>I(h,V,i),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:v("albedoTexture")}},metallicFactor:{type:"number",get:(h,V,i)=>I(h,V,i).metallic,set:(h,V,i,S)=>{const l=I(V,i,S);l&&(l.metallic=h)},getTarget:(h,V,i)=>I(h,V,i),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(h,V,i)=>I(h,V,i).roughness,set:(h,V,i,S)=>{const l=I(V,i,S);l&&(l.roughness=h)},getTarget:(h,V,i)=>I(h,V,i),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:v("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(h,V,i)=>I(h,V,i).anisotropy.Tq,set:(h,V,i,S)=>{I(V,i,S).anisotropy.Tq=h},getTarget:(h,V,i)=>I(h,V,i),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(h,V,i)=>I(h,V,i).anisotropy.angle,set:(h,V,i,S)=>{I(V,i,S).anisotropy.angle=h},getTarget:(h,V,i)=>I(h,V,i),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:v("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(h,V,i)=>I(h,V,i).clearCoat.Tq,set:(h,V,i,S)=>{I(V,i,S).clearCoat.Tq=h},getTarget:(h,V,i)=>I(h,V,i),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(h,V,i)=>I(h,V,i).clearCoat.roughness,set:(h,V,i,S)=>{I(V,i,S).clearCoat.roughness=h},getTarget:(h,V,i)=>I(h,V,i),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:v("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(h,V,i)=>{var S;return null===(S=I(h,V,i).clearCoat.bumpTexture)||void 0===S?void 0:S.level},getTarget:I,set:(h,V,i,S)=>I(V,i,S).clearCoat.bumpTexture.level=h},extensions:{KHR_texture_transform:v("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:v("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(h,V,i)=>I(h,V,i).subSurface.dispersion,getTarget:I,set:(h,V,i,S)=>I(V,i,S).subSurface.dispersion=h}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(h,V,i)=>I(h,V,i).emissiveIntensity,getTarget:I,set:(h,V,i,S)=>I(V,i,S).emissiveIntensity=h}},KHR_materials_ior:{ior:{type:"number",get:(h,V,i)=>I(h,V,i).indexOfRefraction,getTarget:I,set:(h,V,i,S)=>I(V,i,S).indexOfRefraction=h}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(h,V,i)=>I(h,V,i).iridescence.Tq,getTarget:I,set:(h,V,i,S)=>I(V,i,S).iridescence.Tq=h},iridescenceIor:{type:"number",get:(h,V,i)=>I(h,V,i).iridescence.indexOfRefraction,getTarget:I,set:(h,V,i,S)=>I(V,i,S).iridescence.indexOfRefraction=h},iridescenceTexture:{extensions:{KHR_texture_transform:v("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(h,V,i)=>I(h,V,i).iridescence.maximumThickness,getTarget:I,set:(h,V,i,S)=>I(V,i,S).iridescence.maximumThickness=h},iridescenceThicknessMinimum:{type:"number",get:(h,V,i)=>I(h,V,i).iridescence.minimumThickness,getTarget:I,set:(h,V,i,S)=>I(V,i,S).iridescence.minimumThickness=h},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:v("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"LV",get:(h,V,i)=>I(h,V,i).sheen.color,getTarget:I,set:(h,V,i,S)=>I(V,i,S).sheen.color.l(h)},sheenColorTexture:{extensions:{KHR_texture_transform:v("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(h,V,i)=>I(h,V,i).sheen.Tq,getTarget:I,set:(h,V,i,S)=>I(V,i,S).sheen.Tq=h},sheenRoughnessTexture:{extensions:{KHR_texture_transform:v("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(h,V,i)=>I(h,V,i).metallicF0Factor,getTarget:I,set:(h,V,i,S)=>I(V,i,S).metallicF0Factor=h,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"LV",get:(h,V,i)=>I(h,V,i).metallicReflectanceColor,getTarget:I,set:(h,V,i,S)=>I(V,i,S).metallicReflectanceColor.l(h),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:v("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:v("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(h,V,i)=>I(h,V,i).subSurface.refractionIntensity,getTarget:I,set:(h,V,i,S)=>I(V,i,S).subSurface.refractionIntensity=h,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:v("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(h,V,i)=>I(h,V,i).subSurface.translucencyIntensity,getTarget:I,set:(h,V,i,S)=>I(V,i,S).subSurface.translucencyIntensity=h},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:v("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"LV",get:(h,V,i)=>I(h,V,i).subSurface.translucencyColor,getTarget:I,set:(h,V,i,S)=>{var l;return h&&(null===(l=I(V,i,S).subSurface.translucencyColor)||void 0===l?void 0:l.l(h))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:v("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"LV",get:(h,V,i)=>I(h,V,i).subSurface.tintColor,getTarget:I,set:(h,V,i,S)=>I(V,i,S).subSurface.tintColor.l(h)},attenuationDistance:{type:"number",get:(h,V,i)=>I(h,V,i).subSurface.tintColorAtDistance,getTarget:I,set:(h,V,i,S)=>I(V,i,S).subSurface.tintColorAtDistance=h},thicknessFactor:{type:"number",get:(h,V,i)=>I(h,V,i).subSurface.maximumThickness,getTarget:I,set:(h,V,i,S)=>I(V,i,S).subSurface.maximumThickness=h},thicknessTexture:{extensions:{KHR_texture_transform:v("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonLight)),getPropertyName:[h=>"length"]},__array__:{__target__:!0,color:{type:"LV",get:h=>{var V;return null===(V=h._babylonLight)||void 0===V?void 0:V.eq},set:(h,V)=>{var i;return null===(i=V._babylonLight)||void 0===i?void 0:i.eq.l(h)},getTarget:h=>h._babylonLight,getPropertyName:[h=>"diffuse"]},Tq:{type:"number",get:h=>{var V;return null===(V=h._babylonLight)||void 0===V?void 0:V.Tq},set:(h,V)=>V._babylonLight?V._babylonLight.Tq=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"intensity"]},range:{type:"number",get:h=>{var V;return null===(V=h._babylonLight)||void 0===V?void 0:V.range},set:(h,V)=>V._babylonLight?V._babylonLight.range=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"range"]},spot:{innerConeAngle:{type:"number",get:h=>{var V;return null===(V=h._babylonLight)||void 0===V?void 0:V.innerAngle},set:(h,V)=>V._babylonLight?V._babylonLight.innerAngle=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"innerConeAngle"]},outerConeAngle:{type:"number",get:h=>{var V;return null===(V=h._babylonLight)||void 0===V?void 0:V.angle},set:(h,V)=>V._babylonLight?V._babylonLight.angle=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonLight)),getPropertyName:[h=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonTexture)),getPropertyName:[h=>"length"]},__array__:{__target__:!0,Tq:{type:"number",get:h=>{var V;return null===(V=h._babylonTexture)||void 0===V?void 0:V.level},set:(h,V)=>{V._babylonTexture&&(V._babylonTexture.level=h)},getTarget:h=>h._babylonTexture},rotation:{type:"Quaternion",get:h=>{var V;return h._babylonTexture&&S.Quaternion.FromRotationMatrix(null===(V=h._babylonTexture)||void 0===V?void 0:V.getReflectionTextureMatrix())},set:(h,V)=>{var i;V._babylonTexture&&(null!==(i=V._babylonTexture.Mh())&&void 0!==i&&i.useRightHandedSystem||(h=S.Quaternion.Inverse(h)),S.Matrix.FromQuaternionToRef(h,V._babylonTexture.getReflectionTextureMatrix()))},getTarget:h=>h._babylonTexture}}}}},animations:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>{var V;return null===(V=h.primitives[0]._instanceData)||void 0===V?void 0:V.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function t(h){return new B(h,s)}function T(h){const V=h.split("/").map((h=>h.replace(/{}/g,"__array__")));let i=s;for(const S of V)S&&(i=i[S]);if(i&&i.type&&i.get)return i}function e(h,V){const i=h.split("/").map((h=>h.replace(/{}/g,"__array__")));let S=s;for(const l of i)l&&(S=S[l]);S&&S.type&&S.get&&(S.interpolation=V)}function n(h,V){const i=h.split("/").map((h=>h.replace(/{}/g,"__array__")));let S=s;for(const l of i)if(l){if(!S[l]){if("?"===l){S.__ignoreObjectTree__=!0;continue}S[l]={},"__array__"===l&&(S[l].__target__=!0)}S=S[l]}Object.assign(S,V)}},12747:(h,V,i)=>{"use strict";i.r(V),i.d(V,{AnimationPropertyInfo:()=>J,TransformNodeAnimationPropertyInfo:()=>I,WeightAnimationPropertyInfo:()=>v,getQuaternion:()=>q,getVector3:()=>g,getWeights:()=>B});var S=i(11665),l=i(11138),Y=i(12737);function g(h,V,i,S){return l.nV.UV(V,i).scaleInPlace(S)}function q(h,V,i,S){return l.Quaternion.UV(V,i).scaleInPlace(S)}function B(h,V,i,S){const l=new Array(h._numMorphTargets);for(let Y=0;Y<l.length;Y++)l[Y]=V[i++]*S;return l}class J{constructor(h,V,i,S){this.type=h,this.name=V,this.getValue=i,this.getStride=S}_buildAnimation(h,V,i){const l=new S.d(h,this.name,V,this.type);return l.setKeys(i),l}}class I extends J{buildAnimations(h,V,i,S){const l=[];return l.push({babylonAnimatable:h._babylonTransformNode,babylonAnimation:this._buildAnimation(V,i,S)}),l}}class v extends J{buildAnimations(h,V,i,l){const Y=[];if(h._numMorphTargets)for(let g=0;g<h._numMorphTargets;g++){const q=new S.d(`${V}_${g}`,this.name,i,this.type);if(q.setKeys(l.map((h=>({frame:h.frame,inTangent:h.inTangent?h.inTangent[g]:void 0,value:h.value[g],outTangent:h.outTangent?h.outTangent[g]:void 0,interpolation:h.interpolation})))),h._primitiveBabylonMeshes)for(const V of h._primitiveBabylonMeshes)if(V.morphTargetManager){const h=V.morphTargetManager.getTarget(g),i=q.clone();h.animations.push(i),Y.push({babylonAnimatable:h,babylonAnimation:i})}}return Y}}(0,Y.k)("/nodes/{}/translation",[new I(S.d.ANIMATIONTYPE_VECTOR3,"position",g,(()=>3))]),(0,Y.k)("/nodes/{}/rotation",[new I(S.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",q,(()=>4))]),(0,Y.k)("/nodes/{}/scale",[new I(S.d.ANIMATIONTYPE_VECTOR3,"Jq",g,(()=>3))]),(0,Y.k)("/nodes/{}/weights",[new v(S.d.ANIMATIONTYPE_FLOAT,"influence",B,(h=>h._numMorphTargets))])},12705:(h,V,i)=>{"use strict";class S{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((h,V)=>{this._resolve=h,this._reject=V}))}}var l=i(11138),Y=i(11189),g=i(10952),q=i(11598),B=i(12708),J=i(12722),I=i(10960),v=i(11613),s=i(11665),t=i(11668),T=i(10988),e=i(10967),n=i(10972);class c{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(h){this._useTextureToStoreBoneMatrices=h,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(h){this._animationPropertiesOverride=h}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(h,V,i){this.name=h,this.id=V,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=l.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new I.d,this.bones=[],this._scene=i||T.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const S=this._scene.getEngine().getCaps();this._canUseTextureForBones=S.textureFloat&&S.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((h=>!h.getParent()))}getTransformMatrices(h){if(this.needInitialSkinMatrix){if(!h)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return h._bonesTransformMatrices||this.prepare(!0),h._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(h){return this.needInitialSkinMatrix&&h._transformMatrixTexture?h._transformMatrixTexture:this._transformMatrixTexture}Mh(){return this._scene}toString(h){let V=`Name: ${this.name}, nBones: ${this.bones.length}`;if(V+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,h){V+=", Ranges: {";let h=!0;for(const i in this._ranges)h&&(V+=", ",h=!1),V+=i;V+="}"}return V}getBoneIndexByName(h){for(let V=0,i=this.bones.length;V<i;V++)if(this.bones[V].name===h)return V;return-1}createAnimationRange(h,V,i){if(!this._ranges[h]){this._ranges[h]=new t.c(h,V,i);for(let S=0,l=this.bones.length;S<l;S++)this.bones[S].animations[0]&&this.bones[S].animations[0].createRange(h,V,i)}}deleteAnimationRange(h){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let i=0,S=this.bones.length;i<S;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].deleteRange(h,V);this._ranges[h]=null}getAnimationRange(h){return this._ranges[h]||null}getAnimationRanges(){const h=[];let V;for(V in this._ranges)h.push(this._ranges[V]);return h}copyAnimationRange(h,V){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[V]||!h.getAnimationRange(V))return!1;let S=!0;const l=this._getHighestAnimationFrame()+1,Y={},g=h.bones;let q,B;for(B=0,q=g.length;B<q;B++)Y[g[B].name]=g[B];this.bones.length!==g.length&&(e.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${g.length}`),S=!1);const J=i&&this.dimensionsAtRest&&h.dimensionsAtRest?this.dimensionsAtRest.divide(h.dimensionsAtRest):null;for(B=0,q=this.bones.length;B<q;B++){const h=this.bones[B].name,g=Y[h];g?S=S&&this.bones[B].copyAnimationRange(g,V,l,i,J):(e.d.Warn("copyAnimationRange: not same rig, missing source bone "+h),S=!1)}const I=h.getAnimationRange(V);return I&&(this._ranges[V]=new t.c(V,I.from+l,I.to+l)),S}returnToRest(){for(const h of this.bones)-1!==h._index&&h.returnToRest()}_getHighestAnimationFrame(){let h=0;for(let V=0,i=this.bones.length;V<i;V++)if(this.bones[V].animations[0]){const i=this.bones[V].animations[0].getHighestFrame();h<i&&(h=i)}return h}beginAnimation(h,V,i,S){const l=this.getAnimationRange(h);return l?this._scene.beginAnimation(this,l.from,l.to,V,i,S):null}static MakeAnimationAdditive(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;const S=h.getAnimationRange(i);if(!S)return null;const l=h._scene.getAllAnimatablesByTarget(h);let Y=null;for(let q=0;q<l.length;q++){const h=l[q];if(h.fromFrame===(null===S||void 0===S?void 0:S.from)&&h.toFrame===(null===S||void 0===S?void 0:S.to)){Y=h;break}}const g=h.getAnimatables();for(let q=0;q<g.length;q++){const h=g[q].animations;if(h)for(let S=0;S<h.length;S++)s.d.MakeAnimationAdditive(h[S],V,i)}return Y&&(Y.isAdditive=!0),h}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(h){this._meshesWithPoseMatrix.push(h)}_unregisterMeshWithPoseMatrix(h){const V=this._meshesWithPoseMatrix.indexOf(h);V>-1&&this._meshesWithPoseMatrix.splice(V,1)}_computeTransformMatrices(h,V){this.onBeforeComputeObservable.notifyObservers(this);for(let i=0;i<this.bones.length;i++){const S=this.bones[i];S._childUpdateId++;const l=S.getParent();if(l?S.getLocalMatrix().multiplyToRef(l.getFinalMatrix(),S.getFinalMatrix()):V?S.getLocalMatrix().multiplyToRef(V,S.getFinalMatrix()):S.getFinalMatrix().l(S.getLocalMatrix()),-1!==S._index){const V=null===S._index?i:S._index;S.getAbsoluteInverseBindMatrix().multiplyToArray(S.getFinalMatrix(),h,16*V)}}this._identity.copyToArray(h,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const h=this.Mh().getRenderId();if(this._currentRenderId===h)return;this._currentRenderId=h}if(this._numBonesWithLinkedTransformNode>0)for(const h of this.bones)if(h._linkedTransformNode){const V=h._linkedTransformNode;h.position=V.position,V.rotationQuaternion?h.rotationQuaternion=V.rotationQuaternion:h.rotation=V.rotation,h.Jq=V.Jq}if(this.needInitialSkinMatrix)for(const h of this._meshesWithPoseMatrix){const V=h.getPoseMatrix();let i=this._isDirty;if(h._bonesTransformMatrices&&h._bonesTransformMatrices.length===16*(this.bones.length+1)||(h._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),i=!0),i){if(this._synchronizedWithMesh!==h){this._synchronizedWithMesh=h;for(const h of this.bones)if(!h.getParent()){h.getBindMatrix().multiplyToRef(V,l.TmpVectors.Matrix[1]),h._updateAbsoluteBindMatrices(l.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const V=4*(this.bones.length+1);h._transformMatrixTexture&&h._transformMatrixTexture.getSize().width===V||(h._transformMatrixTexture&&h._transformMatrixTexture.dispose(),h._transformMatrixTexture=v.d.CreateRGBATexture(h._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(h._bonesTransformMatrices,V),this.isUsingTextureForMatrices&&h._transformMatrixTexture&&h._transformMatrixTexture.update(h._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=v.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let h=0;h<this.bones.length;h++)this._animatables.push(this.bones[h])}return this._animatables}clone(h,V){const i=new c(h,V||h,this._scene);i.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let S=0;S<this.bones.length;S++){const h=this.bones[S];let V=null;const l=h.getParent();if(l){const h=this.bones.indexOf(l);V=i.bones[h]}const Y=new J.e(h.name,i,V,h.getBindMatrix().clone(),h.getRestMatrix().clone());Y._index=h._index,h._linkedTransformNode&&Y.linkTransformNode(h._linkedTransformNode),n.d.DeepCopy(h.animations,Y.animations)}if(this._ranges){i._ranges={};for(const h in this._ranges){const V=this._ranges[h];V&&(i._ranges[h]=V.clone())}}return this._isDirty=!0,i.prepare(!0),i}enableBlending(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const V of this.bones)for(const i of V.animations)i.enableBlending=!0,i.blendingSpeed=h}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Mh().stopAnimation(this),this.Mh().removeSkeleton(this),this._parentContainer){const h=this._parentContainer.skeletons.indexOf(this);h>-1&&this._parentContainer.skeletons.splice(h,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const h={};h.name=this.name,h.id=this.id,this.dimensionsAtRest&&(h.dimensionsAtRest=this.dimensionsAtRest.Ng()),h.bones=[],h.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let i=0;i<this.bones.length;i++){var V;const S=this.bones[i],l=S.getParent(),Y={parentBoneIndex:l?this.bones.indexOf(l):-1,index:S.getIndex(),name:S.name,id:S.id,matrix:S.getBindMatrix().Ng(),rest:S.getRestMatrix().Ng(),linkedTransformNodeId:null===(V=S.getTransformNode())||void 0===V?void 0:V.id};h.bones.push(Y),S.length&&(Y.length=S.length),S.metadata&&(Y.metadata=S.metadata),S.animations&&S.animations.length>0&&(Y.animation=S.animations[0].serialize()),h.ranges=[];for(const V in this._ranges){const i=this._ranges[V];if(!i)continue;const S={};S.name=V,S.from=i.from,S.to=i.to,h.ranges.push(S)}}return h}static Parse(h,V){const i=new c(h.name,h.id,V);let S;for(h.dimensionsAtRest&&(i.dimensionsAtRest=l.nV.UV(h.dimensionsAtRest)),i.needInitialSkinMatrix=h.needInitialSkinMatrix,S=0;S<h.bones.length;S++){const V=h.bones[S],Y=h.bones[S].index;let g=null;V.parentBoneIndex>-1&&(g=i.bones[V.parentBoneIndex]);const q=V.rest?l.Matrix.UV(V.rest):null,B=new J.e(V.name,i,g,l.Matrix.UV(V.matrix),q,null,Y);void 0!==V.id&&null!==V.id&&(B.id=V.id),V.length&&(B.length=V.length),V.metadata&&(B.metadata=V.metadata),V.animation&&B.animations.push(s.d.Parse(V.animation)),void 0!==V.linkedTransformNodeId&&null!==V.linkedTransformNodeId&&(i._hasWaitingData=!0,B._waitingTransformNodeId=V.linkedTransformNodeId)}if(h.ranges)for(S=0;S<h.ranges.length;S++){const V=h.ranges[S];i.createAnimationRange(V.name,V.from,V.to)}return i}computeAbsoluteMatrices(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||h)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(h)}getPoseMatrix(){let h=null;return this._meshesWithPoseMatrix.length>0&&(h=this._meshesWithPoseMatrix[0].getPoseMatrix()),h}sortBones(){const h=[],V=new Array(this.bones.length);for(let i=0;i<this.bones.length;i++)this._sortBones(i,h,V);this.bones=h}_sortBones(h,V,i){if(i[h])return;i[h]=!0;const S=this.bones[h];if(!S)return;void 0===S._index&&(S._index=h);const l=S.getParent();l&&this._sortBones(this.bones.indexOf(l),V,i),V.push(S)}setCurrentPoseAsRest(){for(const h of this.bones)h.setCurrentPoseAsRest()}}var f=i(11459),P=i(11629),L=i(11117),U=i(11556),X=i(11220),D=i(11603),O=i(11570),o=i(11590),M=i(11672),F=i(11242),E=i(12674);class H{set areUpdatesFrozen(h){h?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new F.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,h||(h=T.d.LastCreatedScene),this._scene=h,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const h=this._scene.getEngine().getCaps();this._canUseTextureForTargets=h.canUseGLVertexID&&h.textureFloat&&h.maxVertexTextureImageUnits>0&&h.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return H.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?H.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(h){this._numMaxInfluencers!==h&&(this._numMaxInfluencers=h,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(h){this._useTextureToStoreTargets!==h&&(this._useTextureToStoreTargets=h,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var h;return H.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(h=this._scene)&&void 0!==h&&h.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(h){return this._activeTargets.data[h]}getTarget(h){return this._targets[h]}getTargetByName(h){for(const V of this._targets)if(V.name===h)return V;return null}addTarget(h){this._targets.push(h),this._targetInfluenceChangedObservers.push(h.onInfluenceChanged.add((h=>{this.areUpdatesFrozen&&h&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(h)}))),this._targetDataLayoutChangedObservers.push(h._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(h){const V=this._targets.indexOf(h);V>=0&&(this._targets.splice(V,1),h.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(V,1)[0]),h._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(V,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(h)}_bind(h){h.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),h.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),h.setTexture("morphTargets",this._targetStoreTexture),h.setInt("morphTargetCount",this.numInfluencers)}clone(){const h=new H(this._scene);for(const V of this._targets)h.addTarget(V.clone());return h.enablePositionMorphing=this.enablePositionMorphing,h.enableNormalMorphing=this.enableNormalMorphing,h.enableTangentMorphing=this.enableTangentMorphing,h.enableUVMorphing=this.enableUVMorphing,h.enableUV2Morphing=this.enableUV2Morphing,h.enableColorMorphing=this.enableColorMorphing,h}serialize(){const h={};h.id=this.uniqueId,h.targets=[];for(const V of this._targets)h.targets.push(V.serialize());return h}_syncActiveTargets(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const V=!!this._targetStoreTexture,i=this.isUsingTextureForTargets;(this._mustSynchronize||V!==i)&&(this._mustSynchronize=!1,this.synchronize());let S=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let l=-1;for(const Y of this._targets)if(l++,0!==Y.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=H.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(Y),this._morphTargetTextureIndices[S]=l,this._tempInfluences[S++]=Y.influence}this._morphTargetTextureIndices.length!==S&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,S)),this._influences&&this._influences.length===S||(this._influences=new Float32Array(S));for(let Y=0;Y<S;Y++)this._influences[Y]=this._tempInfluences[Y];if(h&&this._scene)for(const Y of this._scene.meshes)Y.morphTargetManager===this&&(i?Y._markSubMeshesAsAttributesDirty():Y._syncGeometryWithMorphTargetManager())}synchronize(){var h;if(!this._scene||this.areUpdatesFrozen)return;const V=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(h=this._targetStoreTexture)||void 0===h||h.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>V.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const i of this._targets){this._supportsPositions=this._supportsPositions&&i.hasPositions,this._supportsNormals=this._supportsNormals&&i.hasNormals,this._supportsTangents=this._supportsTangents&&i.hasTangents,this._supportsUVs=this._supportsUVs&&i.hasUVs,this._supportsUV2s=this._supportsUV2s&&i.hasUV2s,this._supportsColors=this._supportsColors&&i.hasColors;const h=i.vertexCount;if(0===this._vertexCount)this._vertexCount=h;else if(this._vertexCount!==h)return void e.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${i.name}": ${h}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const h=V.getCaps().maxTextureSize;this._textureWidth>h&&(this._textureHeight=Math.ceil(this._textureWidth/h),this._textureWidth=h);const i=this._targets.length,S=new Float32Array(i*this._textureWidth*this._textureHeight*4);let l=0;for(let V=0;V<i;V++){const h=this._targets[V],i=h.getPositions(),Y=h.getNormals(),g=h.getUVs(),q=h.getTangents(),B=h.getUV2s(),J=h.getColors();l=V*this._textureWidth*this._textureHeight*4;for(let V=0;V<this._vertexCount;V++)this._supportsPositions&&i&&(S[l]=i[3*V],S[l+1]=i[3*V+1],S[l+2]=i[3*V+2],l+=4),this._supportsNormals&&Y&&(S[l]=Y[3*V],S[l+1]=Y[3*V+1],S[l+2]=Y[3*V+2],l+=4),this._supportsUVs&&g&&(S[l]=g[2*V],S[l+1]=g[2*V+1],l+=4),this._supportsTangents&&q&&(S[l]=q[3*V],S[l+1]=q[3*V+1],S[l+2]=q[3*V+2],l+=4),this._supportsUV2s&&B&&(S[l]=B[2*V],S[l+1]=B[2*V+1],l+=4),this._supportsColors&&J&&(S[l]=J[4*V],S[l+1]=J[4*V+1],S[l+2]=J[4*V+2],S[l+3]=J[4*V+3],l+=4)}this._targetStoreTexture=E.b.CreateRGBATexture(S,this._textureWidth,this._textureHeight,i,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const i of this._scene.meshes)i.morphTargetManager===this&&i._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const h=this._parentContainer.morphTargetManagers.indexOf(this);h>-1&&this._parentContainer.morphTargetManagers.splice(h,1),this._parentContainer=null}for(const h of this._targets)this._scene.stopAnimation(h)}}static Parse(h,V){const i=new H(V);for(const S of h.targets)i.addTarget(M.d.Parse(S,V));return i}}H.EnableTextureStorage=!0,H.MaxActiveMorphTargetsInVertexAttributeMode=8,H.ConstantTargetCountForTextureMode=0;var j=i(12727),m=i(10993),G=i(11481);const w=new Map,N=w;function r(h,V,i){k(h)&&e.d.Warn(`Extension with the name '${h}' already exists`),w.set(h,{isGLTFExtension:V,factory:i})}function k(h){return w.delete(h)}var R=i(12737),Z=i(11732),z=i(11230);class d{static Get(h,V,i){if(!V||void 0==i||!V[i])throw new Error(`${h}: Failed to find index (${i})`);return V[i]}static TryGet(h,V){return h&&void 0!=V&&h[V]?h[V]:null}static Assign(h){if(h)for(let V=0;V<h.length;V++)h[V].index=V}}function x(h){if(h.min&&h.max){const V=h.min,i=h.max,S=l.TmpVectors.nV[0].qq(V[0],V[1],V[2]),Y=l.TmpVectors.nV[1].qq(i[0],i[1],i[2]);if(h.normalized&&5126!==h.componentType){let V=1;switch(h.componentType){case 5120:V=127;break;case 5121:V=255;break;case 5122:V=32767;break;case 5123:V=65535}const i=1/V;S.scaleInPlace(i),Y.scaleInPlace(i)}return new G.e(S,Y)}return null}class y{static RegisterExtension(h,V){r(h,!1,V)}static UnregisterExtension(h){return k(h)}get fg(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(h){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=h}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((h=>h.dispose&&h.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(h,V,i,S,l,Y){let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=V,this._assetContainer=i,this._loadData(S);let Y=null;if(h){const V={};if(this._gltf.nodes)for(const h of this._gltf.nodes)h.name&&(V[h.name]=h.index);Y=(h instanceof Array?h:[h]).map((h=>{const i=V[h];if(void 0===i)throw new Error(`Failed to find node '${h}'`);return i}))}return await this._loadAsync(l,g,Y,(()=>({meshes:this._getMeshes(),Fv:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(h,V,i,S){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=h,this._loadData(V),await this._loadAsync(i,l,null,(()=>{}))}async _loadAsync(h,V,i,S){return await Promise.resolve().then((async()=>{this._rootUrl=h,this._uniqueRootUrl=!h.startsWith("file:")&&V?h:`${h}${Date.now()}/`,this._fileName=V,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const l=`${j.o[j.o.LOADING]} => ${j.o[j.o.READY]}`,Y=`${j.o[j.o.LOADING]} => ${j.o[j.o.COMPLETE]}`;this._parent._startPerformanceCounter(l),this._parent._startPerformanceCounter(Y),this._parent._setState(j.o.LOADING),this._extensionsOnLoading();const q=new Array;if(!this.parent.loadOnlyMaterials)if(i)q.push(this.loadSceneAsync("/nodes",{nodes:i,index:-1}));else if(void 0!=this._gltf.fV||this._gltf.scenes&&this._gltf.scenes[0]){const h=d.Get("/scene",this._gltf.scenes,this._gltf.fV||0);q.push(this.loadSceneAsync(`/scenes/${h.index}`,h))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let h=0;h<this._gltf.materials.length;++h){const V=this._gltf.materials[h],i="/materials/"+h,S=f.e.TriangleFillMode;q.push(this._loadMaterialAsync(i,V,null,S,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&q.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&q.push(this._compileShadowGeneratorsAsync());const B=Promise.all(q).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Gq(!0);for(const h of this._babylonScene.materials){const V=h;void 0!==V.maxSimultaneousLights&&(V.maxSimultaneousLights=Math.max(V.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(j.o.READY),this._skipStartAnimationStep||this._startAnimations(),S()}));return await B.then((h=>(this._parent._endPerformanceCounter(l),g.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(Y),this._parent._setState(j.o.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(h=>{this._parent.onErrorObservable.notifyObservers(h),this._parent.onErrorObservable.clear(),this.dispose()}))})),h)))})).catch((h=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(h),this._parent.onErrorObservable.clear(),this.dispose()),h}))}_loadData(h){if(this._gltf=h.json,this._setupData(),h.bin){const V=this._gltf.buffers;if(V&&V[0]&&!V[0].uri){const i=V[0];(i.byteLength<h.bin.byteLength-3||i.byteLength>h.bin.byteLength)&&e.d.Warn(`Binary buffer length (${i.byteLength}) from JSON does not match chunk length (${h.bin.byteLength})`),this._bin=h.bin}else e.d.Warn("Unexpected BIN chunk")}}_setupData(){if(d.Assign(this._gltf.accessors),d.Assign(this._gltf.animations),d.Assign(this._gltf.buffers),d.Assign(this._gltf.bufferViews),d.Assign(this._gltf.cameras),d.Assign(this._gltf.images),d.Assign(this._gltf.materials),d.Assign(this._gltf.meshes),d.Assign(this._gltf.nodes),d.Assign(this._gltf.samplers),d.Assign(this._gltf.scenes),d.Assign(this._gltf.skins),d.Assign(this._gltf.textures),this._gltf.nodes){const h={};for(const i of this._gltf.nodes)if(i.children)for(const V of i.children)h[V]=i.index;const V=this._createRootNode();for(const i of this._gltf.nodes){const S=h[i.index];i.parent=void 0===S?V:this._gltf.nodes[S]}}}async _loadExtensionsAsync(){const h=[];if(N.forEach(((V,i)=>{var S;!1===(null===(S=this.parent.extensionOptions[i])||void 0===S?void 0:S.enabled)?V.isGLTFExtension&&this.isExtensionUsed(i)&&e.d.Warn(`Extension ${i} is used but has been explicitly disabled.`):V.isGLTFExtension&&!this.isExtensionUsed(i)||h.push((async()=>{const h=await V.factory(this);return h.name!==i&&e.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${h.name} !== ${i}`),this._parent.onExtensionLoadedObservable.notifyObservers(h),h})())})),this._extensions.push(...await Promise.all(h)),this._extensions.sort(((h,V)=>(h.order||Number.MAX_VALUE)-(V.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const i of this._gltf.extensionsRequired){if(!this._extensions.some((h=>h.name===i&&h.enabled))){var V;if(!1===(null===(V=this.parent.extensionOptions[i])||void 0===V?void 0:V.enabled))throw new Error(`Required extension ${i} is disabled`);throw new Error(`Required extension ${i} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new o.e("__root__",this._babylonScene);this._rootBabylonMesh=h,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Gq(!1);const V={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case j.l.AUTO:this._babylonScene.useRightHandedSystem||(V.rotation=[0,1,0,0],V.scale=[1,1,-1],y._LoadTransform(V,this._rootBabylonMesh));break;case j.l.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(h),V}loadSceneAsync(h,V){const i=this._extensionsLoadSceneAsync(h,V);if(i)return i;const S=new Array;if(this.logOpen(`${h} ${V.name||""}`),V.nodes)for(const l of V.nodes){const V=d.Get(`${h}/nodes/${l}`,this._gltf.nodes,l);S.push(this.loadNodeAsync(`/nodes/${V.index}`,V,(h=>{h.parent=this._rootBabylonMesh})))}for(const l of this._postSceneLoadActions)l();return S.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(S).then((()=>{}))}_forEachPrimitive(h,V){if(h._primitiveBabylonMeshes)for(const i of h._primitiveBabylonMeshes)V(i)}_getGeometries(){const h=[],V=this._gltf.nodes;if(V)for(const i of V)this._forEachPrimitive(i,(V=>{const i=V.bg;i&&-1===h.indexOf(i)&&h.push(i)}));return h}_getMeshes(){const h=[];this._rootBabylonMesh instanceof O.c&&h.push(this._rootBabylonMesh);const V=this._gltf.nodes;if(V)for(const i of V)this._forEachPrimitive(i,(V=>{h.push(V)}));return h}_getTransformNodes(){const h=[],V=this._gltf.nodes;if(V)for(const i of V)i._babylonTransformNode&&"MT"===i._babylonTransformNode.getClassName()&&h.push(i._babylonTransformNode),i._babylonTransformNodeForSkin&&h.push(i._babylonTransformNodeForSkin);return h}_getSkeletons(){const h=[],V=this._gltf.skins;if(V)for(const i of V)i._data&&h.push(i._data.babylonSkeleton);return h}_getAnimationGroups(){const h=[],V=this._gltf.animations;if(V)for(const i of V)i._babylonAnimationGroup&&h.push(i._babylonAnimationGroup);return h}_startAnimations(){switch(this._parent.animationStartMode){case j.h.NONE:break;case j.h.FIRST:{const h=this._getAnimationGroups();0!==h.length&&h[0].start(!0);break}case j.h.ALL:{const h=this._getAnimationGroups();for(const V of h)V.start(!0);break}default:return void e.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadNodeAsync(h,V,i);if(S)return S;if(V._babylonTransformNode)throw new Error(`${h}: Invalid recursive node hierarchy`);const l=new Array;this.logOpen(`${h} ${V.name||""}`);const Y=S=>{if(y.AddPointerMetadata(S,h),y._LoadTransform(V,S),void 0!=V.camera){const i=d.Get(`${h}/camera`,this._gltf.cameras,V.camera);l.push(this.loadCameraAsync(`/cameras/${i.index}`,i,(h=>{h.parent=S,this._babylonScene.useRightHandedSystem||(S.Jq.x=-1)})))}if(V.children)for(const i of V.children){const V=d.Get(`${h}/children/${i}`,this._gltf.nodes,i);l.push(this.loadNodeAsync(`/nodes/${V.index}`,V,(h=>{h.parent=S})))}i(S)},g=void 0!=V.mesh,q=this._parent.loadSkins&&void 0!=V.skin;if(!g||q){const h=V.name||`node${V.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new U.e(h,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==V.mesh?V._babylonTransformNode=i:V._babylonTransformNodeForSkin=i,Y(i)}if(g)if(q){const i=d.Get(`${h}/mesh`,this._gltf.meshes,V.mesh);l.push(this._loadMeshAsync(`/meshes/${i.index}`,V,i,(i=>{const S=V._babylonTransformNodeForSkin;i.metadata=(0,Z.e)(S.metadata,i.metadata||{});const Y=d.Get(`${h}/skin`,this._gltf.skins,V.skin);l.push(this._loadSkinAsync(`/skins/${Y.index}`,V,Y,(h=>{this._forEachPrimitive(V,(V=>{V.skeleton=h})),this._postSceneLoadActions.push((()=>{if(void 0!=Y.skeleton){const h=d.Get(`/skins/${Y.index}/skeleton`,this._gltf.nodes,Y.skeleton).parent;V.index===h.index?i.parent=S.parent:i.parent=h._babylonTransformNode}else i.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:S,skinnedNode:i})}))})))})))}else{const i=d.Get(`${h}/mesh`,this._gltf.meshes,V.mesh);l.push(this._loadMeshAsync(`/meshes/${i.index}`,V,i,Y))}return this.logClose(),Promise.all(l).then((()=>(this._forEachPrimitive(V,(h=>{const V=h;!V.isAnInstance&&V.bg&&V.bg.useBoundingInfoFromGeometry?h.rh():h.refreshBoundingInfo(!0,!0)})),V._babylonTransformNode)))}_loadMeshAsync(h,V,i,S){const l=i.primitives;if(!l||!l.length)throw new Error(`${h}: Primitives are missing`);void 0==l[0].index&&d.Assign(l);const Y=new Array;this.logOpen(`${h} ${i.name||""}`);const g=V.name||`node${V.index}`;if(1===l.length){const S=i.primitives[0];Y.push(this._loadMeshPrimitiveAsync(`${h}/primitives/${S.index}`,g,V,i,S,(h=>{V._babylonTransformNode=h,V._primitiveBabylonMeshes=[h]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,V._babylonTransformNode=new U.e(g,this._babylonScene),V._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V._primitiveBabylonMeshes=[];for(const S of l)Y.push(this._loadMeshPrimitiveAsync(`${h}/primitives/${S.index}`,`${g}_primitive${S.index}`,V,i,S,(h=>{h.parent=V._babylonTransformNode,V._primitiveBabylonMeshes.push(h)})))}return S(V._babylonTransformNode),this.logClose(),Promise.all(Y).then((()=>V._babylonTransformNode))}_loadMeshPrimitiveAsync(h,V,i,S,l,Y){const g=this._extensionsLoadMeshPrimitiveAsync(h,V,i,S,l,Y);if(g)return g;this.logOpen(`${h}`);const q=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==i.skin&&!S.primitives[0].targets;let B,J;if(q&&l._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,B=l._instanceData.babylonSourceMesh.createInstance(V),B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J=l._instanceData.promise;else{const Y=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new o.e(V,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.sideOrientation=this._babylonScene.useRightHandedSystem?f.e.CounterClockWiseSideOrientation:f.e.ClockWiseSideOrientation,this._createMorphTargets(h,i,S,l,g),Y.push(this._loadVertexDataAsync(h,l,g).then((async V=>await this._loadMorphTargetsAsync(h,l,g,V).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,V.wh(g),V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const I=y._GetDrawMode(h,l.mode);if(void 0==l.material){let h=this._defaultBabylonMaterialData[I];h||(h=this._createDefaultMaterial("__GLTFLoader._default",I),this._parent.onMaterialLoadedObservable.notifyObservers(h),this._defaultBabylonMaterialData[I]=h),g.material=h}else if(!this.parent.skipMaterials){const V=d.Get(`${h}/material`,this._gltf.materials,l.material);Y.push(this._loadMaterialAsync(`/materials/${V.index}`,V,g,I,(h=>{g.material=h})))}J=Promise.all(Y),q&&(l._instanceData={babylonSourceMesh:g,promise:J}),B=g}return y.AddPointerMetadata(B,h),this._parent.onMeshLoadedObservable.notifyObservers(B),Y(B),this.logClose(),J.then((()=>B))}_loadVertexDataAsync(h,V,i){const S=this._extensionsLoadVertexDataAsync(h,V,i);if(S)return S;const l=V.attributes;if(!l)throw new Error(`${h}: Attributes are missing`);const Y=new Array,g=new D.b(i.name,this._babylonScene);if(void 0==V.indices)i.isUnIndexed=!0;else{const i=d.Get(`${h}/indices`,this._gltf.accessors,V.indices);Y.push(this._loadIndicesAccessorAsync(`/accessors/${i.index}`,i).then((h=>{g.setIndices(h)})))}const q=(V,S,q)=>{if(void 0==l[V])return;i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(S)&&i._delayInfo.push(S);const B=d.Get(`${h}/attributes/${V}`,this._gltf.accessors,l[V]);Y.push(this._loadVertexAccessorAsync(`/accessors/${B.index}`,B,S).then((h=>{if(h.getKind()===X.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!i.skeleton){const h=x(B);h&&(g._boundingInfo=h,g.useBoundingInfoFromGeometry=!0)}g.setVerticesBuffer(h,B.count)}))),S==X.h.MatricesIndicesExtraKind&&(i.numBoneInfluencers=8),q&&q(B)};return q("POSITION",X.h.PositionKind),q("NORMAL",X.h.NormalKind),q("TANGENT",X.h.TangentKind),q("TEXCOORD_0",X.h.UVKind),q("TEXCOORD_1",X.h.UV2Kind),q("TEXCOORD_2",X.h.UV3Kind),q("TEXCOORD_3",X.h.UV4Kind),q("TEXCOORD_4",X.h.UV5Kind),q("TEXCOORD_5",X.h.UV6Kind),q("JOINTS_0",X.h.MatricesIndicesKind),q("WEIGHTS_0",X.h.MatricesWeightsKind),q("JOINTS_1",X.h.MatricesIndicesExtraKind),q("WEIGHTS_1",X.h.MatricesWeightsExtraKind),q("COLOR_0",X.h.ColorKind,(h=>{"VEC4"===h.type&&(i.hasVertexAlpha=!0)})),Promise.all(Y).then((()=>g))}_createMorphTargets(h,V,i,S,l){if(!S.targets||!this._parent.loadMorphTargets)return;if(void 0==V._numMorphTargets)V._numMorphTargets=S.targets.length;else if(S.targets.length!==V._numMorphTargets)throw new Error(`${h}: Primitives do not have the same number of targets`);const Y=i.extras?i.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,l.morphTargetManager=new H(this._babylonScene),l.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.morphTargetManager.areUpdatesFrozen=!0;for(let g=0;g<S.targets.length;g++){const h=V.weights?V.weights[g]:i.weights?i.weights[g]:0,S=Y?Y[g]:`morphTarget${g}`;l.morphTargetManager.addTarget(new M.d(S,h,l.Mh()))}}_loadMorphTargetsAsync(h,V,i,S){if(!V.targets||!this._parent.loadMorphTargets)return Promise.resolve();const l=new Array,Y=i.morphTargetManager;for(let g=0;g<Y.numTargets;g++){const i=Y.getTarget(g);l.push(this._loadMorphTargetVertexDataAsync(`${h}/targets/${g}`,S,V.targets[g],i))}return Promise.all(l).then((()=>{Y.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(h,V,i,S){const l=new Array,Y=(S,Y,g)=>{if(void 0==i[S])return;const q=V.getVertexBuffer(Y);if(!q)return;const B=d.Get(`${h}/${S}`,this._gltf.accessors,i[S]);l.push(this._loadFloatAccessorAsync(`/accessors/${B.index}`,B).then((h=>{g(q,h)})))};return Y("POSITION",X.h.PositionKind,((h,V)=>{const i=new Float32Array(V.length);h.forEach(V.length,((h,S)=>{i[S]=V[S]+h})),S.setPositions(i)})),Y("NORMAL",X.h.NormalKind,((h,V)=>{const i=new Float32Array(V.length);h.forEach(i.length,((h,S)=>{i[S]=V[S]+h})),S.setNormals(i)})),Y("TANGENT",X.h.TangentKind,((h,V)=>{const i=new Float32Array(V.length/3*4);let l=0;h.forEach(V.length/3*4,((h,S)=>{(S+1)%4!==0&&(i[l]=V[l]+h,l++)})),S.setTangents(i)})),Y("TEXCOORD_0",X.h.UVKind,((h,V)=>{const i=new Float32Array(V.length);h.forEach(V.length,((h,S)=>{i[S]=V[S]+h})),S.setUVs(i)})),Y("TEXCOORD_1",X.h.UV2Kind,((h,V)=>{const i=new Float32Array(V.length);h.forEach(V.length,((h,S)=>{i[S]=V[S]+h})),S.setUV2s(i)})),Y("COLOR_0",X.h.ColorKind,((V,i)=>{let l=null;const Y=V.getSize();if(3===Y){l=new Float32Array(i.length/3*4),V.forEach(i.length,((h,V)=>{const S=Math.floor(V/3),Y=V%3;l[4*S+Y]=i[3*S+Y]+h}));for(let h=0;h<i.length/3;++h)l[4*h+3]=1}else{if(4!==Y)throw new Error(`${h}: Invalid number of components (${Y}) for COLOR_0 attribute`);l=new Float32Array(i.length),V.forEach(i.length,((h,V)=>{l[V]=i[V]+h}))}S.setColors(l)})),await Promise.all(l).then((()=>{}))}static _LoadTransform(h,V){if(void 0!=h.skin)return;let i=l.nV.Zero(),S=l.Quaternion.Identity(),Y=l.nV.One();if(h.matrix){l.Matrix.UV(h.matrix).decompose(Y,S,i)}else h.translation&&(i=l.nV.UV(h.translation)),h.rotation&&(S=l.Quaternion.UV(h.rotation)),h.scale&&(Y=l.nV.UV(h.scale));V.position=i,V.rotationQuaternion=S,V.Jq=Y}_loadSkinAsync(h,V,i,S){if(!this._parent.loadSkins)return Promise.resolve();const l=this._extensionsLoadSkinAsync(h,V,i);if(l)return l;if(i._data)return S(i._data.babylonSkeleton),i._data.promise;const Y=`skeleton${i.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new c(i.name||Y,Y,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(h,i,g);const q=this._loadSkinInverseBindMatricesDataAsync(h,i).then((h=>{this._updateBoneMatrices(g,h)}));return i._data={babylonSkeleton:g,promise:q},S(g),q}_loadBones(h,V,i){if(void 0==V.skeleton||this._parent.alwaysComputeSkeletonRootNode){const i=this._findSkeletonRootNode(`${h}/joints`,V.joints);if(i)if(void 0===V.skeleton)V.skeleton=i.index;else{const S=(h,V)=>{for(;V.parent;V=V.parent)if(V.parent===h)return!0;return!1},l=d.Get(`${h}/skeleton`,this._gltf.nodes,V.skeleton);l===i||S(l,i)||(e.d.Warn(`${h}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),V.skeleton=i.index)}else e.d.Warn(`${h}: Failed to find common root`)}const S={};for(const l of V.joints){const Y=d.Get(`${h}/joints/${l}`,this._gltf.nodes,l);this._loadBone(Y,V,i,S)}}_findSkeletonRootNode(h,V){if(0===V.length)return null;const i={};for(const l of V){const V=[];let S=d.Get(`${h}/${l}`,this._gltf.nodes,l);for(;-1!==S.index;)V.unshift(S),S=S.parent;i[l]=V}let S=null;for(let l=0;;++l){let h=i[V[0]];if(l>=h.length)return S;const Y=h[l];for(let g=1;g<V.length;++g)if(h=i[V[g]],l>=h.length||Y!==h[l])return S;S=Y}}_loadBone(h,V,i,S){h._isJoint=!0;let l=S[h.index];if(l)return l;let Y=null;h.index!==V.skeleton&&(h.parent&&-1!==h.parent.index?Y=this._loadBone(h.parent,V,i,S):void 0!==V.skeleton&&e.d.Warn(`/skins/${V.index}/skeleton: Skeleton node is not a common root`));const g=V.joints.indexOf(h.index);return l=new J.e(h.name||`joint${h.index}`,i,Y,this._getNodeMatrix(h),null,null,g),S[h.index]=l,this._postSceneLoadActions.push((()=>{l.linkTransformNode(h._babylonTransformNode)})),l}_loadSkinInverseBindMatricesDataAsync(h,V){if(void 0==V.inverseBindMatrices)return Promise.resolve(null);const i=d.Get(`${h}/inverseBindMatrices`,this._gltf.accessors,V.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${i.index}`,i)}_updateBoneMatrices(h,V){for(const i of h.bones){const h=l.Matrix.Identity(),S=i._index;V&&-1!==S&&(l.Matrix.FromArrayToRef(V,16*S,h),h.invertToRef(h));const Y=i.getParent();Y&&h.multiplyToRef(Y.getAbsoluteInverseBindMatrix(),h),i.xg(h,!1,!1),i._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(h){return h.matrix?l.Matrix.UV(h.matrix):l.Matrix.Compose(h.scale?l.nV.UV(h.scale):l.nV.One(),h.rotation?l.Quaternion.UV(h.rotation):l.Quaternion.Identity(),h.translation?l.nV.UV(h.translation):l.nV.Zero())}loadCameraAsync(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadCameraAsync(h,V,i);if(S)return S;const Y=new Array;this.logOpen(`${h} ${V.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new B.c(V.name||`camera${V.index}`,l.nV.Zero(),this._babylonScene,!1);switch(g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V._babylonCamera=g,g.setTarget(new l.nV(0,0,-1)),V.type){case"perspective":{const i=V.perspective;if(!i)throw new Error(`${h}: Camera perspective properties are missing`);g.fov=i.yfov,g.Zg=i.znear,g.maxZ=i.zfar||0;break}case"orthographic":if(!V.orthographic)throw new Error(`${h}: Camera orthographic properties are missing`);g.mode=q.b.ORTHOGRAPHIC_CAMERA,g.orthoLeft=-V.orthographic.xmag,g.orthoRight=V.orthographic.xmag,g.orthoBottom=-V.orthographic.ymag,g.orthoTop=V.orthographic.ymag,g.Zg=V.orthographic.znear,g.maxZ=V.orthographic.zfar;break;default:throw new Error(`${h}: Invalid camera type (${V.type})`)}return y.AddPointerMetadata(g,h),this._parent.onCameraLoadedObservable.notifyObservers(g),i(g),this.logClose(),Promise.all(Y).then((()=>g))}_loadAnimationsAsync(){const h=this._gltf.animations;if(!h)return Promise.resolve();const V=new Array;for(let i=0;i<h.length;i++){const S=h[i];V.push(this.loadAnimationAsync(`/animations/${S.index}`,S).then((h=>{0===h.targetedAnimations.length&&h.dispose()})))}return Promise.all(V).then((()=>{}))}loadAnimationAsync(h,V){const S=this._extensionsLoadAnimationAsync(h,V);return S||i.e(78).then(i.bind(i,14304)).then((i=>{let{AnimationGroup:S}=i;this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new S(V.name||`animation${V.index}`,this._babylonScene);l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V._babylonAnimationGroup=l;const Y=new Array;d.Assign(V.channels),d.Assign(V.samplers);for(const g of V.channels)Y.push(this._loadAnimationChannelAsync(`${h}/channels/${g.index}`,h,V,g,((h,V)=>{h.animations=h.animations||[],h.animations.push(V),l.addTargetedAnimation(V,h)})));return Promise.all(Y).then((()=>(l.normalize(0),l)))}))}async _loadAnimationChannelAsync(h,V,S,l,Y){const g=this._extensionsLoadAnimationChannelAsync(h,V,S,l,Y);if(g)return await g;if(void 0==l.target.node)return await Promise.resolve();const q=d.Get(`${h}/target/node`,this._gltf.nodes,l.target.node),B=l.target.path,J="weights"===B;if(J&&!q._numMorphTargets||!J&&!q._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!J&&!q._isJoint)return await Promise.resolve();let I;switch(await Promise.resolve().then(i.bind(i,12747)),B){case"translation":var v;I=null===(v=(0,R.f)("/nodes/{}/translation"))||void 0===v?void 0:v.interpolation;break;case"rotation":var s;I=null===(s=(0,R.f)("/nodes/{}/rotation"))||void 0===s?void 0:s.interpolation;break;case"scale":var t;I=null===(t=(0,R.f)("/nodes/{}/scale"))||void 0===t?void 0:t.interpolation;break;case"weights":var T;I=null===(T=(0,R.f)("/nodes/{}/weights"))||void 0===T?void 0:T.interpolation;break;default:throw new Error(`${h}/target/path: Invalid value (${l.target.path})`)}if(!I)throw new Error(`${h}/target/path: Could not find interpolation properties for target path (${l.target.path})`);const e={object:q,info:I};return await this._loadAnimationChannelFromTargetInfoAsync(h,V,S,l,e,Y)}_loadAnimationChannelFromTargetInfoAsync(h,V,i,S,l,Y){const g=this.parent.targetFps,q=1/g,B=d.Get(`${h}/sampler`,i.samplers,S.sampler);return this._loadAnimationSamplerAsync(`${V}/samplers/${S.sampler}`,B).then((h=>{let V=0;const B=l.object,J=l.info;for(const l of J){const J=l.getStride(B),I=h.input,v=h.output,s=new Array(I.length);let t=0;switch(h.interpolation){case"STEP":for(let h=0;h<I.length;h++){const V=l.getValue(B,v,t,1);t+=J,s[h]={frame:I[h]*g,value:V,interpolation:1}}break;case"CUBICSPLINE":for(let h=0;h<I.length;h++){const V=l.getValue(B,v,t,q);t+=J;const i=l.getValue(B,v,t,1);t+=J;const S=l.getValue(B,v,t,q);t+=J,s[h]={frame:I[h]*g,inTangent:V,value:i,outTangent:S}}break;case"LINEAR":for(let h=0;h<I.length;h++){const V=l.getValue(B,v,t,1);t+=J,s[h]={frame:I[h]*g,value:V}}}if(t>0){const h=`${i.name||`animation${i.index}`}_channel${S.index}_${V}`,q=l.buildAnimations(B,h,g,s);for(const i of q)V++,Y(i.babylonAnimatable,i.babylonAnimation)}}}))}_loadAnimationSamplerAsync(h,V){if(V._data)return V._data;const i=V.interpolation||"LINEAR";switch(i){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${h}/interpolation: Invalid value (${V.interpolation})`)}const S=d.Get(`${h}/input`,this._gltf.accessors,V.input),l=d.Get(`${h}/output`,this._gltf.accessors,V.output);return V._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${S.index}`,S),this._loadFloatAccessorAsync(`/accessors/${l.index}`,l)]).then((h=>{let[V,S]=h;return{input:V,interpolation:i,output:S}})),V._data}loadBufferAsync(h,V,i,S){const l=this._extensionsLoadBufferAsync(h,V,i,S);if(l)return l;if(!V._data)if(V.uri)V._data=this.loadUriAsync(`${h}/uri`,V,V.uri);else{if(!this._bin)throw new Error(`${h}: Uri is missing or the binary glTF is missing its binary chunk`);V._data=this._bin.readAsync(0,V.byteLength)}return V._data.then((V=>{try{return new Uint8Array(V.buffer,V.byteOffset+i,S)}catch(l){throw new Error(`${h}: ${l.message}`)}}))}loadBufferViewAsync(h,V){const i=this._extensionsLoadBufferViewAsync(h,V);if(i)return i;if(V._data)return V._data;const S=d.Get(`${h}/buffer`,this._gltf.buffers,V.buffer);return V._data=this.loadBufferAsync(`/buffers/${S.index}`,S,V.byteOffset||0,V.byteLength),V._data}_loadAccessorAsync(h,V,i){if(V._data)return V._data;const S=y._GetNumComponents(h,V.type),l=S*X.h.GetTypeByteLength(V.componentType),Y=S*V.count;if(void 0==V.bufferView)V._data=Promise.resolve(new i(Y));else{const g=d.Get(`${h}/bufferView`,this._gltf.bufferViews,V.bufferView);V._data=this.loadBufferViewAsync(`/bufferViews/${g.index}`,g).then((q=>{if(5126!==V.componentType||V.normalized||g.byteStride&&g.byteStride!==l){const h=new i(Y);return X.h.ForEach(q,V.byteOffset||0,g.byteStride||l,S,V.componentType,h.length,V.normalized||!1,((V,i)=>{h[i]=V})),h}return y._GetTypedArray(h,V.componentType,q,V.byteOffset,Y)}))}if(V.sparse){const Y=V.sparse;V._data=V._data.then((g=>{const q=g,B=d.Get(`${h}/sparse/indices/bufferView`,this._gltf.bufferViews,Y.indices.bufferView),J=d.Get(`${h}/sparse/values/bufferView`,this._gltf.bufferViews,Y.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${B.index}`,B),this.loadBufferViewAsync(`/bufferViews/${J.index}`,J)]).then((g=>{let[B,J]=g;const I=y._GetTypedArray(`${h}/sparse/indices`,Y.indices.componentType,B,Y.indices.byteOffset,Y.count),v=S*Y.count;let s;if(5126!==V.componentType||V.normalized){const g=y._GetTypedArray(`${h}/sparse/values`,V.componentType,J,Y.values.byteOffset,v);s=new i(v),X.h.ForEach(g,0,l,S,V.componentType,s.length,V.normalized||!1,((h,V)=>{s[V]=h}))}else s=y._GetTypedArray(`${h}/sparse/values`,V.componentType,J,Y.values.byteOffset,v);let t=0;for(let h=0;h<I.length;h++){let V=I[h]*S;for(let h=0;h<S;h++)q[V++]=s[t++]}return q}))}))}return V._data}_loadFloatAccessorAsync(h,V){return this._loadAccessorAsync(h,V,Float32Array)}_loadIndicesAccessorAsync(h,V){if("SCALAR"!==V.type)throw new Error(`${h}/type: Invalid value ${V.type}`);if(5121!==V.componentType&&5123!==V.componentType&&5125!==V.componentType)throw new Error(`${h}/componentType: Invalid value ${V.componentType}`);if(V._data)return V._data;if(V.sparse){const i=y._GetTypedArrayConstructor(`${h}/componentType`,V.componentType);V._data=this._loadAccessorAsync(h,V,i)}else{const i=d.Get(`${h}/bufferView`,this._gltf.bufferViews,V.bufferView);V._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i).then((i=>y._GetTypedArray(h,V.componentType,i,V.byteOffset,V.count)))}return V._data}_loadVertexBufferViewAsync(h){if(h._babylonBuffer)return h._babylonBuffer;const V=this._babylonScene.getEngine();return h._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h).then((h=>new X.e(V,h,!1))),h._babylonBuffer}_loadVertexAccessorAsync(h,V,i){var S;if(null!==(S=V._babylonVertexBuffer)&&void 0!==S&&S[i])return V._babylonVertexBuffer[i];V._babylonVertexBuffer||(V._babylonVertexBuffer={});const l=this._babylonScene.getEngine();if(V.sparse||void 0==V.bufferView)V._babylonVertexBuffer[i]=this._loadFloatAccessorAsync(h,V).then((h=>new X.h(l,h,i,!1)));else{const S=d.Get(`${h}/bufferView`,this._gltf.bufferViews,V.bufferView);V._babylonVertexBuffer[i]=this._loadVertexBufferViewAsync(S).then((Y=>{const g=y._GetNumComponents(h,V.type);return new X.h(l,Y,i,!1,void 0,S.byteStride,void 0,V.byteOffset,g,V.componentType,V.normalized,!0,void 0,!0)}))}return V._babylonVertexBuffer[i]}_loadMaterialMetallicRoughnessPropertiesAsync(h,V,i){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);const S=new Array;return V&&(V.baseColorFactor?(i.albedoColor=Y.LV.UV(V.baseColorFactor),i.alpha=V.baseColorFactor[3]):i.albedoColor=Y.LV.White(),i.metallic=void 0==V.metallicFactor?1:V.metallicFactor,i.roughness=void 0==V.roughnessFactor?1:V.roughnessFactor,V.baseColorTexture&&S.push(this.loadTextureInfoAsync(`${h}/baseColorTexture`,V.baseColorTexture,(h=>{h.name=`${i.name} (Base Color)`,i.albedoTexture=h}))),V.metallicRoughnessTexture&&(V.metallicRoughnessTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync(`${h}/metallicRoughnessTexture`,V.metallicRoughnessTexture,(h=>{h.name=`${i.name} (Metallic Roughness)`,i.metallicTexture=h}))),i.useMetallnessFromMetallicTextureBlue=!0,i.useRoughnessFromMetallicTextureGreen=!0,i.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(S).then((()=>{}))}_loadMaterialAsync(h,V,i,S){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const Y=this._extensionsLoadMaterialAsync(h,V,i,S,l);if(Y)return Y;V._data=V._data||{};let g=V._data[S];if(!g){this.logOpen(`${h} ${V.name||""}`);const i=this.createMaterial(h,V,S);g={babylonMaterial:i,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(h,V,i)},V._data[S]=g,y.AddPointerMetadata(i,h),this._parent.onMaterialLoadedObservable.notifyObservers(i),this.logClose()}return i&&(g.babylonMeshes.push(i),i.Ig.addOnce((()=>{const h=g.babylonMeshes.indexOf(i);-1!==h&&g.babylonMeshes.splice(h,1)}))),l(g.babylonMaterial),g.promise.then((()=>g.babylonMaterial))}_createDefaultMaterial(h,V){this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new P.e(h,this._babylonScene);return i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.fillMode=V,i.enableSpecularAntiAliasing=!0,i.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,i.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,i.transparencyMode=P.e.PBRMATERIAL_OPAQUE,i.metallic=1,i.roughness=1,i}createMaterial(h,V,i){const S=this._extensionsCreateMaterial(h,V,i);if(S)return S;const l=V.name||`material${V.index}`;return this._createDefaultMaterial(l,i)}loadMaterialPropertiesAsync(h,V,i){const S=this._extensionsLoadMaterialPropertiesAsync(h,V,i);if(S)return S;const l=new Array;return l.push(this.loadMaterialBasePropertiesAsync(h,V,i)),V.pbrMetallicRoughness&&l.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${h}/pbrMetallicRoughness`,V.pbrMetallicRoughness,i)),this.loadMaterialAlphaProperties(h,V,i),Promise.all(l).then((()=>{}))}loadMaterialBasePropertiesAsync(h,V,i){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);const S=new Array;return i.emissiveColor=V.emissiveFactor?Y.LV.UV(V.emissiveFactor):new Y.LV(0,0,0),V.doubleSided&&(i.Kg=!1,i.twoSidedLighting=!0),V.normalTexture&&(V.normalTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync(`${h}/normalTexture`,V.normalTexture,(h=>{h.name=`${i.name} (Normal)`,i.bumpTexture=h}))),i.invertNormalMapX=!this._babylonScene.useRightHandedSystem,i.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=V.normalTexture.scale&&i.bumpTexture&&(i.bumpTexture.level=V.normalTexture.scale),i.forceIrradianceInFragment=!0),V.occlusionTexture&&(V.occlusionTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync(`${h}/occlusionTexture`,V.occlusionTexture,(h=>{h.name=`${i.name} (Occlusion)`,i.ambientTexture=h}))),i.useAmbientInGrayScale=!0,void 0!=V.occlusionTexture.strength&&(i.ambientTextureStrength=V.occlusionTexture.strength)),V.emissiveTexture&&S.push(this.loadTextureInfoAsync(`${h}/emissiveTexture`,V.emissiveTexture,(h=>{h.name=`${i.name} (Emissive)`,i.emissiveTexture=h}))),Promise.all(S).then((()=>{}))}loadMaterialAlphaProperties(h,V,i){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);switch(V.alphaMode||"OPAQUE"){case"OPAQUE":i.transparencyMode=P.e.PBRMATERIAL_OPAQUE,i.alpha=1;break;case"MASK":i.transparencyMode=P.e.PBRMATERIAL_ALPHATEST,i.alphaCutOff=void 0==V.alphaCutoff?.5:V.alphaCutoff,i.albedoTexture&&(i.albedoTexture.Rg=!0);break;case"BLEND":i.transparencyMode=P.e.PBRMATERIAL_ALPHABLEND,i.albedoTexture&&(i.albedoTexture.Rg=!0,i.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${h}/alphaMode: Invalid value (${V.alphaMode})`)}}loadTextureInfoAsync(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadTextureInfoAsync(h,V,i);if(S)return S;if(this.logOpen(`${h}`),V.texCoord>=6)throw new Error(`${h}/texCoord: Invalid value (${V.texCoord})`);const l=d.Get(`${h}/index`,this._gltf.textures,V.index);l._textureInfo=V;const Y=this._loadTextureAsync(`/textures/${V.index}`,l,(S=>{S.coordinatesIndex=V.texCoord||0,y.AddPointerMetadata(S,h),this._parent.onTextureLoadedObservable.notifyObservers(S),i(S)}));return this.logClose(),Y}_loadTextureAsync(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadTextureAsync(h,V,i);if(S)return S;this.logOpen(`${h} ${V.name||""}`);const l=void 0==V.sampler?y.DefaultSampler:d.Get(`${h}/sampler`,this._gltf.samplers,V.sampler),Y=d.Get(`${h}/source`,this._gltf.images,V.source),g=this._createTextureAsync(h,l,Y,i,void 0,!V._textureInfo.nonColorData);return this.logClose(),g}_createTextureAsync(h,V,i){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},Y=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0;const q=this._loadSampler(`/samplers/${V.index}`,V),B=new Array,J=new S;this._babylonScene._blockEntityCollection=!!this._assetContainer;const I={noMipmap:q.noMipMaps,invertY:!1,samplingMode:q.samplingMode,p:()=>{this._disposed||J.resolve()},onError:(V,i)=>{this._disposed||J.reject(new Error(`${h}: ${i&&i.message?i.message:V||"Failed to load texture"}`))},mimeType:i.mimeType??(0,m.i)(i.uri??""),loaderOptions:Y,useSRGBBuffer:!!g&&this._parent.useSRGBBuffers},v=new L.d(null,this._babylonScene,I);return v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.push(J.promise),B.push(this.loadImageAsync(`/images/${i.index}`,i).then((h=>{const V=i.uri||`${this._fileName}#image${i.index}`,S=`data:${this._uniqueRootUrl}${V}`;v.updateURL(S,h);const l=v.getInternalTexture();l&&(l.label=i.name)}))),v.wrapU=q.wrapU,v.wrapV=q.wrapV,l(v),this._parent.useGltfTextureNames&&(v.name=i.name||i.uri||`image${i.index}`),Promise.all(B).then((()=>v))}_loadSampler(h,V){return V._data||(V._data={noMipMaps:9728===V.minFilter||9729===V.minFilter,samplingMode:y._GetTextureSamplingMode(h,V),wrapU:y._GetTextureWrapMode(`${h}/wrapS`,V.wrapS),wrapV:y._GetTextureWrapMode(`${h}/wrapT`,V.wrapT)}),V._data}loadImageAsync(h,V){if(!V._data){if(this.logOpen(`${h} ${V.name||""}`),V.uri)V._data=this.loadUriAsync(`${h}/uri`,V,V.uri);else{const i=d.Get(`${h}/bufferView`,this._gltf.bufferViews,V.bufferView);V._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i)}this.logClose()}return V._data}loadUriAsync(h,V,i){const S=this._extensionsLoadUriAsync(h,V,i);if(S)return S;if(!y._ValidateUri(i))throw new Error(`${h}: '${i}' is invalid`);if((0,m.m)(i)){const V=new Uint8Array((0,m.c)(i));return this.log(`${h}: Decoded ${i.substring(0,64)}... (${V.length} bytes)`),Promise.resolve(V)}return this.log(`${h}: Loading ${i}`),this._parent.preprocessUrlAsync(this._rootUrl+i).then((V=>new Promise(((S,l)=>{this._parent._loadFile(this._babylonScene,V,(V=>{this._disposed||(this.log(`${h}: Loaded ${i} (${V.byteLength} bytes)`),S(new Uint8Array(V)))}),!0,(V=>{l(new m.o(`${h}: Failed to load '${i}'${V?": "+V.status+" "+V.statusText:""}`,V))}))}))))}static AddPointerMetadata(h,V){h.metadata=h.metadata||{};const i=h._internalMetadata=h._internalMetadata||{},S=i.fg=i.fg||{};(S.pointers=S.pointers||[]).push(V)}static _GetTextureWrapMode(h,V){switch(V=void 0==V?10497:V){case 33071:return L.d.CLAMP_ADDRESSMODE;case 33648:return L.d.MIRROR_ADDRESSMODE;case 10497:return L.d.WRAP_ADDRESSMODE;default:return e.d.Warn(`${h}: Invalid value (${V})`),L.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(h,V){const i=void 0==V.magFilter?9729:V.magFilter,S=void 0==V.minFilter?9987:V.minFilter;if(9729===i)switch(S){case 9728:return L.d.LINEAR_NEAREST;case 9729:return L.d.LINEAR_LINEAR;case 9984:return L.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return L.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return L.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return L.d.LINEAR_LINEAR_MIPLINEAR;default:return e.d.Warn(`${h}/minFilter: Invalid value (${S})`),L.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==i&&e.d.Warn(`${h}/magFilter: Invalid value (${i})`),S){case 9728:return L.d.NEAREST_NEAREST;case 9729:return L.d.NEAREST_LINEAR;case 9984:return L.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return L.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return L.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return L.d.NEAREST_LINEAR_MIPLINEAR;default:return e.d.Warn(`${h}/minFilter: Invalid value (${S})`),L.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(h,V){try{return(0,z.u)(V)}catch(i){throw new Error(`${h}: ${i.message}`)}}static _GetTypedArray(h,V,i,S,l){const Y=i.buffer;S=i.byteOffset+(S||0);const g=y._GetTypedArrayConstructor(`${h}/componentType`,V),q=X.h.GetTypeByteLength(V);return S%q!==0?(e.d.Warn(`${h}: Copying buffer as byte offset (${S}) is not a multiple of component type byte length (${q})`),new g(Y.slice(S,S+l*q),0)):new g(Y,S,l)}static _GetNumComponents(h,V){switch(V){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${h}: Invalid type (${V})`)}static _ValidateUri(h){return g.Tools.IsBase64(h)||-1===h.indexOf("..")}static _GetDrawMode(h,V){switch(void 0==V&&(V=4),V){case 0:return f.e.PointListDrawMode;case 1:return f.e.LineListDrawMode;case 2:return f.e.LineLoopDrawMode;case 3:return f.e.LineStripDrawMode;case 4:return f.e.TriangleFillMode;case 5:return f.e.TriangleStripDrawMode;case 6:return f.e.TriangleFanDrawMode}throw new Error(`${h}: Invalid mesh primitive mode (${V})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const h=new Array;if(this._gltf.materials)for(const V of this._gltf.materials)if(V._data)for(const i in V._data){const S=V._data[i];for(const V of S.babylonMeshes){V.Ag(!0);const i=S.babylonMaterial;h.push(i.forceCompilationAsync(V)),h.push(i.forceCompilationAsync(V,{useInstances:!0})),this._parent.useClipPlane&&(h.push(i.forceCompilationAsync(V,{clipPlane:!0})),h.push(i.forceCompilationAsync(V,{clipPlane:!0,useInstances:!0})))}}return Promise.all(h).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const h=new Array,V=this._babylonScene.lights;for(const i of V){const V=i.getShadowGenerator();V&&h.push(V.forceCompilationAsync())}return Promise.all(h).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(h){for(const V of this._extensions)V.enabled&&h(V)}_applyExtensions(h,V,i){for(const S of this._extensions)if(S.enabled){const l=`${S.name}.${V}`,Y=h;Y._activeLoaderExtensionFunctions=Y._activeLoaderExtensionFunctions||{};const g=Y._activeLoaderExtensionFunctions;if(!g[l]){g[l]=!0;try{const h=i(S);if(h)return h}finally{delete g[l]}}}return null}_extensionsOnLoading(){this._forEachExtensions((h=>h.onLoading&&h.onLoading()))}_extensionsOnReady(){this._forEachExtensions((h=>h.onReady&&h.onReady()))}_extensionsLoadSceneAsync(h,V){return this._applyExtensions(V,"loadScene",(i=>i.loadSceneAsync&&i.loadSceneAsync(h,V)))}_extensionsLoadNodeAsync(h,V,i){return this._applyExtensions(V,"loadNode",(S=>S.loadNodeAsync&&S.loadNodeAsync(h,V,i)))}_extensionsLoadCameraAsync(h,V,i){return this._applyExtensions(V,"loadCamera",(S=>S.loadCameraAsync&&S.loadCameraAsync(h,V,i)))}_extensionsLoadVertexDataAsync(h,V,i){return this._applyExtensions(V,"loadVertexData",(S=>S._loadVertexDataAsync&&S._loadVertexDataAsync(h,V,i)))}_extensionsLoadMeshPrimitiveAsync(h,V,i,S,l,Y){return this._applyExtensions(l,"loadMeshPrimitive",(g=>g._loadMeshPrimitiveAsync&&g._loadMeshPrimitiveAsync(h,V,i,S,l,Y)))}_extensionsLoadMaterialAsync(h,V,i,S,l){return this._applyExtensions(V,"loadMaterial",(Y=>Y._loadMaterialAsync&&Y._loadMaterialAsync(h,V,i,S,l)))}_extensionsCreateMaterial(h,V,i){return this._applyExtensions(V,"createMaterial",(S=>S.createMaterial&&S.createMaterial(h,V,i)))}_extensionsLoadMaterialPropertiesAsync(h,V,i){return this._applyExtensions(V,"loadMaterialProperties",(S=>S.loadMaterialPropertiesAsync&&S.loadMaterialPropertiesAsync(h,V,i)))}_extensionsLoadTextureInfoAsync(h,V,i){return this._applyExtensions(V,"loadTextureInfo",(S=>S.loadTextureInfoAsync&&S.loadTextureInfoAsync(h,V,i)))}_extensionsLoadTextureAsync(h,V,i){return this._applyExtensions(V,"loadTexture",(S=>S._loadTextureAsync&&S._loadTextureAsync(h,V,i)))}_extensionsLoadAnimationAsync(h,V){return this._applyExtensions(V,"loadAnimation",(i=>i.loadAnimationAsync&&i.loadAnimationAsync(h,V)))}_extensionsLoadAnimationChannelAsync(h,V,i,S,l){return this._applyExtensions(i,"loadAnimationChannel",(Y=>Y._loadAnimationChannelAsync&&Y._loadAnimationChannelAsync(h,V,i,S,l)))}_extensionsLoadSkinAsync(h,V,i){return this._applyExtensions(i,"loadSkin",(S=>S._loadSkinAsync&&S._loadSkinAsync(h,V,i)))}_extensionsLoadUriAsync(h,V,i){return this._applyExtensions(V,"loadUri",(S=>S._loadUriAsync&&S._loadUriAsync(h,V,i)))}_extensionsLoadBufferViewAsync(h,V){return this._applyExtensions(V,"loadBufferView",(i=>i.loadBufferViewAsync&&i.loadBufferViewAsync(h,V)))}_extensionsLoadBufferAsync(h,V,i,S){return this._applyExtensions(V,"loadBuffer",(l=>l.loadBufferAsync&&l.loadBufferAsync(h,V,i,S)))}static LoadExtensionAsync(h,V,i,S){if(!V.extensions)return null;const l=V.extensions[i];return l?S(`${h}/extensions/${i}`,l):null}static LoadExtraAsync(h,V,i,S){if(!V.extras)return null;const l=V.extras[i];return l?S(`${h}/extras/${i}`,l):null}isExtensionUsed(h){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(h)}logOpen(h){this._parent._logOpen(h)}logClose(){this._parent._logClose()}log(h){this._parent._log(h)}startPerformanceCounter(h){this._parent._startPerformanceCounter(h)}endPerformanceCounter(h){this._parent._endPerformanceCounter(h)}}y.DefaultSampler={index:-1},j.e._CreateGLTF2Loader=h=>new y(h);var Q=i(12747),A=i(11335),b=i(11179),C=i(12750),u=i(12755);class p extends u.e{constructor(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",h),this._texture=h.getEngine().createRawCubeTexture(V,i,S,l,Y,g,q,B)}update(h,V,i,S){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,h,V,i,S,l)}updateRGBDAsync(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,C.j)(this._texture,h,V,i,S).then((()=>{}))}clone(){return b.d.Clone((()=>{const h=this.Mh(),V=this._texture,i=new p(h,V._bufferViewArray,V.width,V.format,V.type,V.generateMipMaps,V.invertY,V.samplingMode,V._compression);return 13===V.source&&i.updateRGBDAsync(V._bufferViewArrayArray,V._sphericalPolynomial,V._lodGenerationScale,V._lodGenerationOffset),i}),this)}}const W="EXT_lights_image_based";class a{constructor(h){this.name=W,this._loader=h,this.enabled=this._loader.isExtensionUsed(W)}dispose(){this._loader=null,delete this._lights}onLoading(){const h=this._loader.fg.extensions;if(h&&h[this.name]){const V=h[this.name];this._lights=V.lights}}loadSceneAsync(h,V){return y.LoadExtensionAsync(h,V,this.name,(async(i,S)=>{this._loader._allMaterialsDirtyRequired=!0;const l=new Array;l.push(this._loader.loadSceneAsync(h,V)),this._loader.logOpen(`${i}`);const Y=d.Get(`${i}/light`,this._lights,S.Yg);return l.push(this._loadLightAsync(`/extensions/${this.name}/lights/${S.Yg}`,Y).then((h=>{this._loader.babylonScene.environmentTexture=h}))),this._loader.logClose(),await Promise.all(l).then((()=>{}))}))}_loadLightAsync(h,V){if(!V._loaded){const i=new Array;this._loader.logOpen(`${h}`);const S=new Array(V.specularImages.length);for(let l=0;l<V.specularImages.length;l++){const Y=V.specularImages[l];S[l]=new Array(Y.length);for(let V=0;V<Y.length;V++){const g=`${h}/specularImages/${l}/${V}`;this._loader.logOpen(`${g}`);const q=Y[V],B=d.Get(g,this._loader.fg.images,q);i.push(this._loader.loadImageAsync(`/images/${q}`,B).then((h=>{S[l][V]=h}))),this._loader.logClose()}}this._loader.logClose(),V._loaded=Promise.all(i).then((async()=>{const i=new p(this._loader.babylonScene,null,V.specularImageSize);if(i.name=V.name||"environment",V._babylonTexture=i,void 0!=V.Tq&&(i.level=V.Tq),V.rotation){let h=l.Quaternion.UV(V.rotation);this._loader.babylonScene.useRightHandedSystem||(h=l.Quaternion.Inverse(h)),l.Matrix.FromQuaternionToRef(h,i.getReflectionTextureMatrix())}if(!V.irradianceCoefficients)throw new Error(`${h}: Irradiance coefficients are missing`);const Y=A.b.UV(V.irradianceCoefficients);Y.scaleInPlace(V.Tq),Y.convertIrradianceToLambertianRadiance();const g=A.e.FromHarmonics(Y),q=(S.length-1)/Math.log2(V.specularImageSize);return await i.updateRGBDAsync(S,g,q)}))}return V._loaded.then((()=>V._babylonTexture))}}k(W),r(W,!0,(h=>new a(h)));i(11708);const K="EXT_mesh_gpu_instancing";class hh{constructor(h){this.name=K,this._loader=h,this.enabled=this._loader.isExtensionUsed(K)}dispose(){this._loader=null}loadNodeAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(h,S)=>{this._loader._disableInstancedMesh++;const Y=this._loader.loadNodeAsync(`/nodes/${V.index}`,V,i);if(this._loader._disableInstancedMesh--,!V._primitiveBabylonMeshes)return await Y;const g=new Array;let q=0;const B=V=>{if(void 0==S.attributes[V])return void g.push(Promise.resolve(null));const i=d.Get(`${h}/attributes/${V}`,this._loader.fg.accessors,S.attributes[V]);if(g.push(this._loader._loadFloatAccessorAsync(`/accessors/${i.bufferView}`,i)),0===q)q=i.count;else if(q!==i.count)throw new Error(`${h}/attributes: Instance buffer accessors do not have the same count.`)};return B("TRANSLATION"),B("ROTATION"),B("SCALE"),await Y.then((async h=>{const[i,S,Y]=await Promise.all(g),B=new Float32Array(16*q);l.TmpVectors.nV[0].qq(0,0,0),l.TmpVectors.Quaternion[0].qq(0,0,0,1),l.TmpVectors.nV[1].qq(1,1,1);for(let V=0;V<q;++V)i&&l.nV.FromArrayToRef(i,3*V,l.TmpVectors.nV[0]),S&&l.Quaternion.FromArrayToRef(S,4*V,l.TmpVectors.Quaternion[0]),Y&&l.nV.FromArrayToRef(Y,3*V,l.TmpVectors.nV[1]),l.Matrix.ComposeToRef(l.TmpVectors.nV[1],l.TmpVectors.Quaternion[0],l.TmpVectors.nV[0],l.TmpVectors.Matrix[0]),l.TmpVectors.Matrix[0].copyToArray(B,16*V);for(const l of V._primitiveBabylonMeshes)l.uI("matrix",B,16,!0);return h}))}))}}k(K),r(K,!0,(h=>new hh(h)));let Vh=0,ih=null;class Sh{static get Default(){return Sh._Default||(Sh._Default=new Sh),Sh._Default}constructor(){const h=Sh.Configuration.decoder;this._decoderModulePromise=g.Tools.LoadBabylonScriptAsync(h.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(h,V,i,S,l){await this._decoderModulePromise,0===Vh&&(MeshoptDecoder.useWorkers(1),Vh=1);const Y=await MeshoptDecoder.decodeGltfBufferAsync(V,i,h,S,l);return null!==ih&&clearTimeout(ih),ih=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Vh=0,ih=null}),1e3),Y}}Sh.Configuration={decoder:{url:`${g.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Sh._Default=null;const lh="EXT_meshopt_compression";class Yh{constructor(h){this.name=lh,this.enabled=h.isExtensionUsed(lh),this._loader=h}dispose(){this._loader=null}loadBufferViewAsync(h,V){return y.LoadExtensionAsync(h,V,this.name,(async(i,S)=>{const l=V;if(l._meshOptData)return await l._meshOptData;const Y=d.Get(`${h}/buffer`,this._loader.fg.buffers,S.buffer);return l._meshOptData=this._loader.loadBufferAsync(`/buffers/${Y.index}`,Y,S.byteOffset||0,S.byteLength).then((async h=>await Sh.Default.decodeGltfBufferAsync(h,S.count,S.byteStride,S.mode,S.filter))),await l._meshOptData}))}}k(lh),r(lh,!0,(h=>new Yh(h)));const gh="EXT_texture_webp";class qh{constructor(h){this.name=gh,this._loader=h,this.enabled=h.isExtensionUsed(gh)}dispose(){this._loader=null}_loadTextureAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=void 0==V.sampler?y.DefaultSampler:d.Get(`${h}/sampler`,this._loader.fg.samplers,V.sampler),g=d.Get(`${S}/source`,this._loader.fg.images,l.source);return await this._loader._createTextureAsync(h,Y,g,(h=>{i(h)}),void 0,!V._textureInfo.nonColorData)}))}}k(gh),r(gh,!0,(h=>new qh(h)));const Bh="EXT_texture_avif";class Jh{constructor(h){this.name=Bh,this._loader=h,this.enabled=h.isExtensionUsed(Bh)}dispose(){this._loader=null}_loadTextureAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=void 0==V.sampler?y.DefaultSampler:d.Get(`${h}/sampler`,this._loader.fg.samplers,V.sampler),g=d.Get(`${S}/source`,this._loader.fg.images,l.source);return await this._loader._createTextureAsync(h,Y,g,(h=>{i(h)}),void 0,!V._textureInfo.nonColorData)}))}}k(Bh),r(Bh,!0,(h=>new Jh(h)));var Ih=i(12743),vh=i(11681);const sh="EXT_lights_ies";class th{constructor(h){this.name=sh,this._loader=h,this.enabled=this._loader.isExtensionUsed(sh)}dispose(){this._loader=null,delete this._lights}onLoading(){const h=this._loader.fg.extensions;if(h&&h[this.name]){const V=h[this.name];this._lights=V.lights,d.Assign(this._lights)}}loadNodeAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,g)=>{let q,B;this._loader._allMaterialsDirtyRequired=!0;const J=await this._loader.loadNodeAsync(h,V,(h=>{B=d.Get(S,this._lights,g.Yg);const V=B.name||h.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,q=new Ih.b(V,l.nV.Zero(),l.nV.Backward(),0,1,this._loader.babylonScene),q.angle=Math.PI/2,q.innerAngle=0,q._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,B._babylonLight=q,q.falloffType=vh.b.FALLOFF_GLTF,q.eq=g.color?Y.LV.UV(g.color):Y.LV.White(),q.Tq=g.multiplier||1,q.range=Number.MAX_VALUE,q.parent=h,this._loader._babylonLights.push(q),y.AddPointerMetadata(q,S),i(h)}));let I;if(B.uri)I=await this._loader.loadUriAsync(h,B,B.uri);else{const V=d.Get(`${h}/bufferView`,this._loader.fg.bufferViews,B.bufferView);I=await this._loader.loadBufferViewAsync(`/bufferViews/${V.index}`,V)}return q.iesProfileTexture=new L.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,I,!0,void 0,void 0,void 0,void 0,".ies"),J}))}}k(sh),r(sh,!0,(h=>new th(h)));var Th=i(12771);const eh="KHR_draco_mesh_compression";class nh{constructor(h){this.name=eh,this.useNormalizedFlagFromAccessor=!0,this._loader=h,this.enabled=Th.c.DefaultAvailable&&this._loader.isExtensionUsed(eh)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{if(void 0!=V.mode&&4!==V.mode&&5!==V.mode)throw new Error(`${h}: Unsupported mode ${V.mode}`);const Y={},g={},q=(h,S)=>{const q=l.attributes[h];if(void 0!=q&&(i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(S)&&i._delayInfo.push(S),Y[S]=q,this.useNormalizedFlagFromAccessor)){const i=d.TryGet(this._loader.fg.accessors,V.attributes[h]);i&&(g[S]=i.normalized||!1)}};q("POSITION",X.h.PositionKind),q("NORMAL",X.h.NormalKind),q("TANGENT",X.h.TangentKind),q("TEXCOORD_0",X.h.UVKind),q("TEXCOORD_1",X.h.UV2Kind),q("TEXCOORD_2",X.h.UV3Kind),q("TEXCOORD_3",X.h.UV4Kind),q("TEXCOORD_4",X.h.UV5Kind),q("TEXCOORD_5",X.h.UV6Kind),q("JOINTS_0",X.h.MatricesIndicesKind),q("WEIGHTS_0",X.h.MatricesWeightsKind),q("COLOR_0",X.h.ColorKind);const B=d.Get(S,this._loader.fg.bufferViews,l.bufferView);return B._dracoBabylonGeometry||(B._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${B.index}`,B).then((async S=>{const l=this.dracoDecoder||Th.c.Default,q=d.TryGet(this._loader.fg.accessors,V.attributes.POSITION),B=this._loader.parent.alwaysComputeBoundingBox||i.skeleton||!q?null:x(q);return await l._decodeMeshToGeometryForGltfAsync(i.name,this._loader.babylonScene,S,Y,g,B).catch((V=>{throw new Error(`${h}: ${V.message}`)}))}))),await B._dracoBabylonGeometry}))}}k(eh),r(eh,!0,(h=>new nh(h)));var ch=i(12780),fh=i(11123),Ph=i(11127),Lh=i(11564),Uh=i(11741),Xh=i(11091);Lh.c.AddNodeConstructor("Light_Type_0",((h,V)=>()=>new Dh(h,l.nV.Zero(),V)));class Dh extends Uh.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(h){this._shadowAngle=h,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(h){const V=this.needCube();if(this._direction=h,this.needCube()!==V&&this._shadowGenerators){const h=this._shadowGenerators.values();for(let V=h.next();!0!==V.done;V=h.next()){V.value.recreateShadowMap()}}}constructor(h,V,i){super(h,i),this._shadowAngle=Math.PI/2,this.position=V}getClassName(){return"PointLight"}getTypeID(){return vh.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(h){if(this.direction)return super.getShadowDirection(h);switch(h){case 0:return new l.nV(1,0,0);case 1:return new l.nV(-1,0,0);case 2:return new l.nV(0,-1,0);case 3:return new l.nV(0,1,0);case 4:return new l.nV(0,0,1);case 5:return new l.nV(0,0,-1)}return l.nV.Zero()}_setDefaultShadowProjectionMatrix(h,V,i){const S=this.Mh().activeCamera;if(!S)return;const Y=void 0!==this.shadowMinZ?this.shadowMinZ:S.Zg,g=void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,q=this.Mh().getEngine().useReverseDepthBuffer;l.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,q?g:Y,q?Y:g,h,!0,this._scene.getEngine().isNDCHalfZRange,void 0,q)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(h,V){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,V):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,V),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,V),this}transferToNodeMaterialEffect(h,V){return this.computeTransformedInformation()?h.setFloat3(V,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):h.setFloat3(V,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(h,V){h["POINTLIGHT"+V]=!0}}(0,fh.b)([(0,Ph.E)()],Dh.prototype,"shadowAngle",null),(0,Xh.f)("BABYLON.PointLight",Dh);const Oh="KHR_lights_punctual";class oh{constructor(h){this.name=Oh,this._loader=h,this.enabled=this._loader.isExtensionUsed(Oh)}dispose(){this._loader=null,delete this._lights}onLoading(){const h=this._loader.fg.extensions;if(h&&h[this.name]){const V=h[this.name];this._lights=V.lights,d.Assign(this._lights)}}loadNodeAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,g)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(h,V,(h=>{let V;const q=d.Get(S,this._lights,g.Yg),B=q.name||h.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,q.type){case"directional":{const h=new ch.b(B,l.nV.Backward(),this._loader.babylonScene);h.position.Iq(0),V=h;break}case"point":V=new Dh(B,l.nV.Zero(),this._loader.babylonScene);break;case"spot":{const h=new Ih.b(B,l.nV.Zero(),l.nV.Backward(),0,1,this._loader.babylonScene);h.angle=2*(q.spot&&q.spot.outerConeAngle||Math.PI/4),h.innerAngle=2*(q.spot&&q.spot.innerConeAngle||0),V=h;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${S}: Invalid light type (${q.type})`)}V._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,q._babylonLight=V,V.falloffType=vh.b.FALLOFF_GLTF,V.eq=q.color?Y.LV.UV(q.color):Y.LV.White(),V.Tq=void 0==q.Tq?1:q.Tq,V.range=void 0==q.range?Number.MAX_VALUE:q.range,V.parent=h,this._loader._babylonLights.push(V),y.AddPointerMetadata(V,S),i(h)})))))}}k(Oh),r(Oh,!0,(h=>new oh(h)));const Mh="KHR_materials_pbrSpecularGlossiness";class Fh{constructor(h){this.name=Mh,this.order=200,this._loader=h,this.enabled=this._loader.isExtensionUsed(Mh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=new Array;return Y.push(this._loader.loadMaterialBasePropertiesAsync(h,V,i)),Y.push(this._loadSpecularGlossinessPropertiesAsync(S,l,i)),this._loader.loadMaterialAlphaProperties(h,V,i),await Promise.all(Y).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(h,V,i){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);const S=new Array;return i.metallic=null,i.roughness=null,V.diffuseFactor?(i.albedoColor=Y.LV.UV(V.diffuseFactor),i.alpha=V.diffuseFactor[3]):i.albedoColor=Y.LV.White(),i.reflectivityColor=V.specularFactor?Y.LV.UV(V.specularFactor):Y.LV.White(),i.microSurface=void 0==V.glossinessFactor?1:V.glossinessFactor,V.diffuseTexture&&S.push(this._loader.loadTextureInfoAsync(`${h}/diffuseTexture`,V.diffuseTexture,(h=>{h.name=`${i.name} (Diffuse)`,i.albedoTexture=h}))),V.specularGlossinessTexture&&(S.push(this._loader.loadTextureInfoAsync(`${h}/specularGlossinessTexture`,V.specularGlossinessTexture,(h=>{h.name=`${i.name} (Specular Glossiness)`,i.reflectivityTexture=h,i.reflectivityTexture.Rg=!0}))),i.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(S).then((()=>{}))}}k(Mh),r(Mh,!0,(h=>new Fh(h)));const Eh="KHR_materials_unlit";class Hh{constructor(h){this.name=Eh,this.order=210,this._loader=h,this.enabled=this._loader.isExtensionUsed(Eh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async()=>await this._loadUnlitPropertiesAsync(h,V,i)))}_loadUnlitPropertiesAsync(h,V,i){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);const S=new Array;i.unlit=!0;const l=V.pbrMetallicRoughness;return l&&(l.baseColorFactor?(i.albedoColor=Y.LV.UV(l.baseColorFactor),i.alpha=l.baseColorFactor[3]):i.albedoColor=Y.LV.White(),l.baseColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${h}/baseColorTexture`,l.baseColorTexture,(h=>{h.name=`${i.name} (Base Color)`,i.albedoTexture=h})))),V.doubleSided&&(i.Kg=!1,i.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(h,V,i),Promise.all(S).then((()=>{}))}}k(Eh),r(Eh,!0,(h=>new Hh(h)));const jh="KHR_materials_clearcoat";class mh{constructor(h){this.name=jh,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(jh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=new Array;Y.push(this._loader.loadMaterialPropertiesAsync(h,V,i)),Y.push(this._loadClearCoatPropertiesAsync(S,l,i)),await Promise.all(Y)}))}_loadClearCoatPropertiesAsync(h,V,i){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);const S=new Array;return i.clearCoat.isEnabled=!0,i.clearCoat.useRoughnessFromMainTexture=!1,i.clearCoat.remapF0OnInterfaceChange=!1,void 0!=V.clearcoatFactor?i.clearCoat.Tq=V.clearcoatFactor:i.clearCoat.Tq=0,V.clearcoatTexture&&S.push(this._loader.loadTextureInfoAsync(`${h}/clearcoatTexture`,V.clearcoatTexture,(h=>{h.name=`${i.name} (ClearCoat)`,i.clearCoat.texture=h}))),void 0!=V.clearcoatRoughnessFactor?i.clearCoat.roughness=V.clearcoatRoughnessFactor:i.clearCoat.roughness=0,V.clearcoatRoughnessTexture&&(V.clearcoatRoughnessTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${h}/clearcoatRoughnessTexture`,V.clearcoatRoughnessTexture,(h=>{h.name=`${i.name} (ClearCoat Roughness)`,i.clearCoat.textureRoughness=h})))),V.clearcoatNormalTexture&&(V.clearcoatNormalTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${h}/clearcoatNormalTexture`,V.clearcoatNormalTexture,(h=>{h.name=`${i.name} (ClearCoat Normal)`,i.clearCoat.bumpTexture=h}))),i.invertNormalMapX=!i.Mh().useRightHandedSystem,i.invertNormalMapY=i.Mh().useRightHandedSystem,void 0!=V.clearcoatNormalTexture.scale&&(i.clearCoat.bumpTexture.level=V.clearcoatNormalTexture.scale)),Promise.all(S).then((()=>{}))}}k(jh),r(jh,!0,(h=>new mh(h)));const Gh="KHR_materials_iridescence";class wh{constructor(h){this.name=Gh,this.order=195,this._loader=h,this.enabled=this._loader.isExtensionUsed(Gh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(h,V,i)),Y.push(this._loadIridescencePropertiesAsync(S,l,i)),await Promise.all(Y).then((()=>{}))}))}_loadIridescencePropertiesAsync(h,V,i){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);const S=new Array;return i.iridescence.isEnabled=!0,i.iridescence.Tq=V.iridescenceFactor??0,i.iridescence.indexOfRefraction=V.iridescenceIor??V.iridescenceIOR??1.3,i.iridescence.minimumThickness=V.iridescenceThicknessMinimum??100,i.iridescence.maximumThickness=V.iridescenceThicknessMaximum??400,V.iridescenceTexture&&S.push(this._loader.loadTextureInfoAsync(`${h}/iridescenceTexture`,V.iridescenceTexture,(h=>{h.name=`${i.name} (Iridescence)`,i.iridescence.texture=h}))),V.iridescenceThicknessTexture&&S.push(this._loader.loadTextureInfoAsync(`${h}/iridescenceThicknessTexture`,V.iridescenceThicknessTexture,(h=>{h.name=`${i.name} (Iridescence Thickness)`,i.iridescence.thicknessTexture=h}))),Promise.all(S).then((()=>{}))}}k(Gh),r(Gh,!0,(h=>new wh(h)));const Nh="KHR_materials_anisotropy";class rh{constructor(h){this.name=Nh,this.order=195,this._loader=h,this.enabled=this._loader.isExtensionUsed(Nh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=new Array;Y.push(this._loader.loadMaterialPropertiesAsync(h,V,i)),Y.push(this._loadIridescencePropertiesAsync(S,l,i)),await Promise.all(Y)}))}async _loadIridescencePropertiesAsync(h,V,i){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);const S=new Array;i.anisotropy.isEnabled=!0,i.anisotropy.Tq=V.anisotropyStrength??0,i.anisotropy.angle=V.anisotropyRotation??0,V.anisotropyTexture&&(V.anisotropyTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${h}/anisotropyTexture`,V.anisotropyTexture,(h=>{h.name=`${i.name} (Anisotropy Intensity)`,i.anisotropy.texture=h})))),await Promise.all(S)}}k(Nh),r(Nh,!0,(h=>new rh(h)));const kh="KHR_materials_emissive_strength";class Rh{constructor(h){this.name=kh,this.order=170,this._loader=h,this.enabled=this._loader.isExtensionUsed(kh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>await this._loader.loadMaterialPropertiesAsync(h,V,i).then((()=>{this._loadEmissiveProperties(S,l,i)}))))}_loadEmissiveProperties(h,V,i){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);void 0!==V.emissiveStrength&&(i.emissiveIntensity=V.emissiveStrength)}}k(kh),r(kh,!0,(h=>new Rh(h)));const Zh="KHR_materials_sheen";class zh{constructor(h){this.name=Zh,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(Zh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(h,V,i)),Y.push(this._loadSheenPropertiesAsync(S,l,i)),await Promise.all(Y).then((()=>{}))}))}_loadSheenPropertiesAsync(h,V,i){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);const S=new Array;return i.sheen.isEnabled=!0,i.sheen.Tq=1,void 0!=V.sheenColorFactor?i.sheen.color=Y.LV.UV(V.sheenColorFactor):i.sheen.color=Y.LV.Black(),V.sheenColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${h}/sheenColorTexture`,V.sheenColorTexture,(h=>{h.name=`${i.name} (Sheen Color)`,i.sheen.texture=h}))),void 0!==V.sheenRoughnessFactor?i.sheen.roughness=V.sheenRoughnessFactor:i.sheen.roughness=0,V.sheenRoughnessTexture&&(V.sheenRoughnessTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${h}/sheenRoughnessTexture`,V.sheenRoughnessTexture,(h=>{h.name=`${i.name} (Sheen Roughness)`,i.sheen.textureRoughness=h})))),i.sheen.albedoScaling=!0,i.sheen.useRoughnessFromMainTexture=!1,Promise.all(S).then((()=>{}))}}k(Zh),r(Zh,!0,(h=>new zh(h)));var dh=i(11620);const xh="KHR_materials_specular";class yh{constructor(h){this.name=xh,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(xh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=new Array;if(Y.push(this._loader.loadMaterialPropertiesAsync(h,V,i)),Y.push(this._loadSpecularPropertiesAsync(S,l,i)),l.extensions&&l.extensions.EXT_materials_specular_edge_color&&i instanceof P.e){l.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(i.brdf.dielectricSpecularModel=dh.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,i.brdf.conductorSpecularModel=dh.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(Y).then((()=>{}))}))}_loadSpecularPropertiesAsync(h,V,i){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);const S=new Array;return void 0!==V.specularFactor&&(i.metallicF0Factor=V.specularFactor),void 0!==V.specularColorFactor&&(i.metallicReflectanceColor=Y.LV.UV(V.specularColorFactor)),V.specularTexture&&(V.specularTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${h}/specularTexture`,V.specularTexture,(h=>{h.name=`${i.name} (Specular)`,i.metallicReflectanceTexture=h,i.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),V.specularColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${h}/specularColorTexture`,V.specularColorTexture,(h=>{h.name=`${i.name} (Specular Color)`,i.reflectanceTexture=h}))),Promise.all(S).then((()=>{}))}}k(xh),r(xh,!0,(h=>new yh(h)));const Qh="KHR_materials_ior";class Ah{constructor(h){this.name=Qh,this.order=180,this._loader=h,this.enabled=this._loader.isExtensionUsed(Qh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(h,V,i)),Y.push(this._loadIorPropertiesAsync(S,l,i)),await Promise.all(Y).then((()=>{}))}))}_loadIorPropertiesAsync(h,V,i){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);return void 0!==V.ior?i.indexOfRefraction=V.ior:i.indexOfRefraction=Ah._DEFAULT_IOR,Promise.resolve()}}Ah._DEFAULT_IOR=1.5,k(Qh),r(Qh,!0,(h=>new Ah(h)));const bh="KHR_materials_variants";class Ch{constructor(h){this.name=bh,this._loader=h,this.enabled=this._loader.isExtensionUsed(bh)}dispose(){this._loader=null}static GetAvailableVariants(h){const V=this._GetExtensionMetadata(h);return V?Object.keys(V.variants):[]}getAvailableVariants(h){return Ch.GetAvailableVariants(h)}static SelectVariant(h,V){const i=this._GetExtensionMetadata(h);if(!i)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${bh} extension`);const S=h=>{const V=i.variants[h];if(V)for(const i of V)i.mesh.material=i.material};if(V instanceof Array)for(const l of V)S(l);else S(V);i.lastSelected=V}selectVariant(h,V){Ch.SelectVariant(h,V)}static Reset(h){const V=this._GetExtensionMetadata(h);if(!V)throw new Error(`Cannot reset on a glTF mesh that does not have the ${bh} extension`);for(const i of V.original)i.mesh.material=i.material;V.lastSelected=null}reset(h){Ch.Reset(h)}static GetLastSelectedVariant(h){const V=this._GetExtensionMetadata(h);if(!V)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${bh} extension`);return V.lastSelected}getLastSelectedVariant(h){return Ch.GetLastSelectedVariant(h)}static _GetExtensionMetadata(h){var V,i;return(null===h||void 0===h||null===(V=h._internalMetadata)||void 0===V||null===(i=V.fg)||void 0===i?void 0:i[bh])||null}onLoading(){const h=this._loader.fg.extensions;if(h&&h[this.name]){const V=h[this.name];this._variants=V.variants}}onReady(){const h=this._loader.rootBabylonMesh;if(h){var V;const i=this._loader.parent.extensionOptions[bh];null!==i&&void 0!==i&&i.defaultVariant&&Ch.SelectVariant(h,i.defaultVariant),null===i||void 0===i||null===(V=i.onLoaded)||void 0===V||V.call(i,{get variants(){return Ch.GetAvailableVariants(h)},get selectedVariant(){const V=Ch.GetLastSelectedVariant(h);return V?Array.isArray(V)?V[0]:V:Ch.GetAvailableVariants(h)[0]},set selectedVariant(V){Ch.SelectVariant(h,V)}})}}_loadMeshPrimitiveAsync(h,V,i,S,l,Y){return y.LoadExtensionAsync(h,l,this.name,(async(g,q)=>{const B=new Array;return B.push(this._loader._loadMeshPrimitiveAsync(h,V,i,S,l,(V=>{if(Y(V),V instanceof o.e){const i=y._GetDrawMode(h,l.mode),S=this._loader.rootBabylonMesh,Y=S?S._internalMetadata=S._internalMetadata||{}:{},J=Y.fg=Y.fg||{},I=J[bh]=J[bh]||{lastSelected:null,original:[],variants:{}};I.original.push({mesh:V,material:V.material});for(let h=0;h<q.mappings.length;++h){const l=q.mappings[h],Y=d.Get(`${g}/mappings/${h}/material`,this._loader.fg.materials,l.material);B.push(this._loader._loadMaterialAsync(`#/materials/${l.material}`,Y,V,i,(h=>{for(let i=0;i<l.variants.length;++i){const Y=l.variants[i],g=d.Get(`/extensions/${bh}/variants/${Y}`,this._variants,Y);I.variants[g.name]=I.variants[g.name]||[],I.variants[g.name].push({mesh:V,material:h}),V.onClonedObservable.add((h=>{const i=h;let l=null,Y=i;do{if(Y=Y.parent,!Y)return;l=Ch._GetExtensionMetadata(Y)}while(null===l);if(S&&l===Ch._GetExtensionMetadata(S)){Y._internalMetadata={};for(const h in S._internalMetadata)Y._internalMetadata[h]=S._internalMetadata[h];Y._internalMetadata.fg=[];for(const h in S._internalMetadata.fg)Y._internalMetadata.fg[h]=S._internalMetadata.fg[h];Y._internalMetadata.fg[bh]={lastSelected:null,original:[],variants:{}};for(const h of l.original)Y._internalMetadata.fg[bh].original.push({mesh:h.mesh,material:h.material});for(const h in l.variants)if(Object.prototype.hasOwnProperty.call(l.variants,h)){Y._internalMetadata.fg[bh].variants[h]=[];for(const V of l.variants[h])Y._internalMetadata.fg[bh].variants[h].push({mesh:V.mesh,material:V.material})}l=Y._internalMetadata.fg[bh]}for(const S of l.original)S.mesh===V&&(S.mesh=i);for(const S of l.variants[g.name])S.mesh===V&&(S.mesh=i)}))}})))}}}))),await Promise.all(B).then((h=>{let[V]=h;return V}))}))}}k(bh),r(bh,!0,(h=>new Ch(h)));var uh=i(11211);class ph{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:dh.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(h,V){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...ph._GetDefaultOptions(),...h},this._scene=V,this._scene._transmissionHelper=this,this.onErrorObservable=new I.d,this._scene.Ig.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(h){if(!Object.keys(h).filter((V=>this._options[V]!==h[V])).length)return;const V={...this._options,...h},i=this._options;this._options=V,V.renderSize===i.renderSize&&V.renderTargetTextureType===i.renderTargetTextureType&&V.generateMipmaps===i.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=V.samples,this._opaqueRenderTarget.lodGenerationScale=V.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=V.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(h){return!!h&&!!(h instanceof P.e&&h.subSurface.isRefractionEnabled)}_addMesh(h){this._materialObservers[h.uniqueId]=h.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),g.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(h.material)?(h.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(h)&&this._transparentMeshesCache.push(h)):-1===this._opaqueMeshesCache.indexOf(h)&&this._opaqueMeshesCache.push(h)}))}_removeMesh(h){h.onMaterialChangedObservable.remove(this._materialObservers[h.uniqueId]),delete this._materialObservers[h.uniqueId];let V=this._transparentMeshesCache.indexOf(h);-1!==V&&this._transparentMeshesCache.splice(V,1),V=this._opaqueMeshesCache.indexOf(h),-1!==V&&this._opaqueMeshesCache.splice(V,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(h){const V=this._transparentMeshesCache.indexOf(h),i=this._opaqueMeshesCache.indexOf(h);this._shouldRenderAsTransmission(h.material)?(h.material instanceof P.e&&(h.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==i?(this._opaqueMeshesCache.splice(i,1),this._transparentMeshesCache.push(h)):-1===V&&this._transparentMeshesCache.push(h)):-1!==V?(this._transparentMeshesCache.splice(V,1),this._opaqueMeshesCache.push(h)):-1===i&&this._opaqueMeshesCache.push(h)}_isRenderTargetValid(){var h;return null!==(null===(h=this._opaqueRenderTarget)||void 0===h?void 0:h.getInternalTexture())}_setupRenderTargets(){var h;let V;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new uh.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(h=this._options.clearColor)||void 0===h?void 0:h.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((h=>{V=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?h.clearColor.l(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(h.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=V}));for(const i of this._transparentMeshesCache)this._shouldRenderAsTransmission(i.material)&&(i.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Wh="KHR_materials_transmission";class ah{constructor(h){this.name=Wh,this.order=175,this._loader=h,this.enabled=this._loader.isExtensionUsed(Wh),this.enabled&&(h.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(h,V,i)),Y.push(this._loadTransparentPropertiesAsync(S,V,i,l)),await Promise.all(Y).then((()=>{}))}))}_loadTransparentPropertiesAsync(h,V,i,S){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);const l=i;if(l.subSurface.isRefractionEnabled=!0,l.subSurface.volumeIndexOfRefraction=1,l.subSurface.useAlbedoToTintRefraction=!0,void 0===S.transmissionFactor)return l.subSurface.refractionIntensity=0,l.subSurface.isRefractionEnabled=!1,Promise.resolve();{var Y;l.subSurface.refractionIntensity=S.transmissionFactor;const h=l.Mh();if(l.subSurface.refractionIntensity&&!h._transmissionHelper)new ph({},l.Mh());else if(l.subSurface.refractionIntensity&&(null===(Y=h._transmissionHelper)||void 0===Y||!Y._isRenderTargetValid())){var g;null===(g=h._transmissionHelper)||void 0===g||g._setupRenderTargets()}}return l.subSurface.minimumThickness=0,l.subSurface.maximumThickness=0,S.transmissionTexture?(S.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${h}/transmissionTexture`,S.transmissionTexture,void 0).then((h=>{h.name=`${i.name} (Transmission)`,l.subSurface.refractionIntensityTexture=h,l.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}k(Wh),r(Wh,!0,(h=>new ah(h)));const Kh="KHR_materials_diffuse_transmission";class hV{constructor(h){this.name=Kh,this.order=174,this._loader=h,this.enabled=this._loader.isExtensionUsed(Kh),this.enabled&&(h.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(h,V,i)),Y.push(this._loadTranslucentPropertiesAsync(S,V,i,l)),await Promise.all(Y).then((()=>{}))}))}_loadTranslucentPropertiesAsync(h,V,i,S){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);const l=i;if(l.subSurface.isTranslucencyEnabled=!0,l.subSurface.volumeIndexOfRefraction=1,l.subSurface.minimumThickness=0,l.subSurface.maximumThickness=0,l.subSurface.useAlbedoToTintTranslucency=!1,void 0===S.diffuseTransmissionFactor)return l.subSurface.translucencyIntensity=0,l.subSurface.isTranslucencyEnabled=!1,Promise.resolve();l.subSurface.translucencyIntensity=S.diffuseTransmissionFactor;const g=new Array;return l.subSurface.useGltfStyleTextures=!0,S.diffuseTransmissionTexture&&(S.diffuseTransmissionTexture.nonColorData=!0,g.push(this._loader.loadTextureInfoAsync(`${h}/diffuseTransmissionTexture`,S.diffuseTransmissionTexture).then((h=>{h.name=`${i.name} (Diffuse Transmission)`,l.subSurface.translucencyIntensityTexture=h})))),void 0!==S.diffuseTransmissionColorFactor?l.subSurface.translucencyColor=Y.LV.UV(S.diffuseTransmissionColorFactor):l.subSurface.translucencyColor=Y.LV.White(),S.diffuseTransmissionColorTexture&&g.push(this._loader.loadTextureInfoAsync(`${h}/diffuseTransmissionColorTexture`,S.diffuseTransmissionColorTexture).then((h=>{h.name=`${i.name} (Diffuse Transmission Color)`,l.subSurface.translucencyColorTexture=h}))),Promise.all(g).then((()=>{}))}}k(Kh),r(Kh,!0,(h=>new hV(h)));const VV="KHR_materials_volume";class iV{constructor(h){this.name=VV,this.order=173,this._loader=h,this.enabled=this._loader.isExtensionUsed(VV),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(h,V,i)),Y.push(this._loadVolumePropertiesAsync(S,V,i,l)),await Promise.all(Y).then((()=>{}))}))}_loadVolumePropertiesAsync(h,V,i,S){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);if(!i.subSurface.isRefractionEnabled&&!i.subSurface.isTranslucencyEnabled||!S.thicknessFactor)return Promise.resolve();i.subSurface.volumeIndexOfRefraction=i.indexOfRefraction;const l=void 0!==S.attenuationDistance?S.attenuationDistance:Number.MAX_VALUE;return i.subSurface.tintColorAtDistance=l,void 0!==S.attenuationColor&&3==S.attenuationColor.length&&i.subSurface.tintColor.qq(S.attenuationColor[0],S.attenuationColor[1],S.attenuationColor[2]),i.subSurface.minimumThickness=0,i.subSurface.maximumThickness=S.thicknessFactor,i.subSurface.useThicknessAsDepth=!0,S.thicknessTexture?(S.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${h}/thicknessTexture`,S.thicknessTexture).then((h=>{h.name=`${i.name} (Thickness)`,i.subSurface.thicknessTexture=h,i.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}k(VV),r(VV,!0,(h=>new iV(h)));const SV="KHR_materials_dispersion";class lV{constructor(h){this.name=SV,this.order=174,this._loader=h,this.enabled=this._loader.isExtensionUsed(SV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(h,V,i)),Y.push(this._loadDispersionPropertiesAsync(S,V,i,l)),await Promise.all(Y).then((()=>{}))}))}_loadDispersionPropertiesAsync(h,V,i,S){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);return i.subSurface.isRefractionEnabled&&S.dispersion?(i.subSurface.isDispersionEnabled=!0,i.subSurface.dispersion=S.dispersion,Promise.resolve()):Promise.resolve()}}k(SV),r(SV,!0,(h=>new lV(h)));const YV="EXT_materials_diffuse_roughness";class gV{constructor(h){this.name=YV,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(YV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(h,V,i)),Y.push(this._loadDiffuseRoughnessPropertiesAsync(S,l,i)),await Promise.all(Y).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(h,V,i){if(!(i instanceof P.e))throw new Error(`${h}: Material type not supported`);const S=new Array;return i.brdf.baseDiffuseModel=dh.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=V.diffuseRoughnessFactor?i.baseDiffuseRoughness=V.diffuseRoughnessFactor:i.baseDiffuseRoughness=0,V.diffuseRoughnessTexture&&S.push(this._loader.loadTextureInfoAsync(`${h}/diffuseRoughnessTexture`,V.diffuseRoughnessTexture,(h=>{h.name=`${i.name} (Diffuse Roughness)`,i.baseDiffuseRoughnessTexture=h}))),Promise.all(S).then((()=>{}))}}k(YV),r(YV,!0,(h=>new gV(h)));const qV="KHR_mesh_quantization";class BV{constructor(h){this.name=qV,this.enabled=h.isExtensionUsed(qV)}dispose(){}}k(qV),r(qV,!0,(h=>new BV(h)));const JV="KHR_texture_basisu";class IV{constructor(h){this.name=JV,this._loader=h,this.enabled=h.isExtensionUsed(JV)}dispose(){this._loader=null}_loadTextureAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>{const Y=void 0==V.sampler?y.DefaultSampler:d.Get(`${h}/sampler`,this._loader.fg.samplers,V.sampler),g=d.Get(`${S}/source`,this._loader.fg.images,l.source);return await this._loader._createTextureAsync(h,Y,g,(h=>{i(h)}),V._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!V._textureInfo.nonColorData)}))}}k(JV),r(JV,!0,(h=>new IV(h)));const vV="KHR_texture_transform";class sV{constructor(h){this.name=vV,this._loader=h,this.enabled=this._loader.isExtensionUsed(vV)}dispose(){this._loader=null}loadTextureInfoAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(S,l)=>await this._loader.loadTextureInfoAsync(h,V,(h=>{if(!(h instanceof L.d))throw new Error(`${S}: Texture type not supported`);l.offset&&(h.uOffset=l.offset[0],h.vOffset=l.offset[1]),h.uRotationCenter=0,h.vRotationCenter=0,l.rotation&&(h.wAng=-l.rotation),l.scale&&(h.uScale=l.scale[0],h.vScale=l.scale[1]),void 0!=l.texCoord&&(h.coordinatesIndex=l.texCoord),i(h)}))))}}k(vV),r(vV,!0,(h=>new sV(h)));const tV="KHR_xmp_json_ld";class TV{constructor(h){this.name=tV,this.order=100,this._loader=h,this.enabled=this._loader.isExtensionUsed(tV)}dispose(){this._loader=null}onLoading(){var h,V,i;if(null===this._loader.rootBabylonMesh)return;const S=null===(h=this._loader.fg.extensions)||void 0===h?void 0:h.KHR_xmp_json_ld,l=null===(V=this._loader.fg.asset)||void 0===V||null===(i=V.extensions)||void 0===i?void 0:i.KHR_xmp_json_ld;if(S&&l){const h=+l.packet;S.packets&&h<S.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=S.packets[h])}}}function eV(h,V,i,S){return Y.LV.UV(V,i).scale(S)}function nV(h,V,i,S){return V[i]*S}function cV(h,V,i,S){return-V[i]*S}function fV(h,V,i,S){return V[i+1]*S}function PV(h,V,i,S){return V[i]*S*2}function LV(h){return{scale:[new XV(s.d.ANIMATIONTYPE_FLOAT,`${h}.uScale`,nV,(()=>2)),new XV(s.d.ANIMATIONTYPE_FLOAT,`${h}.vScale`,fV,(()=>2))],offset:[new XV(s.d.ANIMATIONTYPE_FLOAT,`${h}.uOffset`,nV,(()=>2)),new XV(s.d.ANIMATIONTYPE_FLOAT,`${h}.vOffset`,fV,(()=>2))],rotation:[new XV(s.d.ANIMATIONTYPE_FLOAT,`${h}.wAng`,cV,(()=>1))]}}k(tV),r(tV,!0,(h=>new TV(h)));class UV extends Q.AnimationPropertyInfo{buildAnimations(h,V,i,S){return[{babylonAnimatable:h._babylonCamera,babylonAnimation:this._buildAnimation(V,i,S)}]}}class XV extends Q.AnimationPropertyInfo{buildAnimations(h,V,i,S){const l=[];for(const Y in h._data)l.push({babylonAnimatable:h._data[Y].babylonMaterial,babylonAnimation:this._buildAnimation(V,i,S)});return l}}class DV extends Q.AnimationPropertyInfo{buildAnimations(h,V,i,S){return[{babylonAnimatable:h._babylonLight,babylonAnimation:this._buildAnimation(V,i,S)}]}}(0,R.k)("/cameras/{}/orthographic/xmag",[new UV(s.d.ANIMATIONTYPE_FLOAT,"orthoLeft",cV,(()=>1)),new UV(s.d.ANIMATIONTYPE_FLOAT,"orthoRight",fV,(()=>1))]),(0,R.k)("/cameras/{}/orthographic/ymag",[new UV(s.d.ANIMATIONTYPE_FLOAT,"orthoBottom",cV,(()=>1)),new UV(s.d.ANIMATIONTYPE_FLOAT,"orthoTop",fV,(()=>1))]),(0,R.k)("/cameras/{}/orthographic/zfar",[new UV(s.d.ANIMATIONTYPE_FLOAT,"maxZ",nV,(()=>1))]),(0,R.k)("/cameras/{}/orthographic/znear",[new UV(s.d.ANIMATIONTYPE_FLOAT,"Zg",nV,(()=>1))]),(0,R.k)("/cameras/{}/perspective/yfov",[new UV(s.d.ANIMATIONTYPE_FLOAT,"fov",nV,(()=>1))]),(0,R.k)("/cameras/{}/perspective/zfar",[new UV(s.d.ANIMATIONTYPE_FLOAT,"maxZ",nV,(()=>1))]),(0,R.k)("/cameras/{}/perspective/znear",[new UV(s.d.ANIMATIONTYPE_FLOAT,"Zg",nV,(()=>1))]),(0,R.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new XV(s.d.ANIMATIONTYPE_COLOR3,"albedoColor",eV,(()=>4)),new XV(s.d.ANIMATIONTYPE_FLOAT,"alpha",(function(h,V,i,S){return V[i+3]*S}),(()=>4))]),(0,R.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new XV(s.d.ANIMATIONTYPE_FLOAT,"metallic",nV,(()=>1))]),(0,R.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new XV(s.d.ANIMATIONTYPE_FLOAT,"roughness",nV,(()=>1))]);const OV=LV("albedoTexture");(0,R.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",OV.scale),(0,R.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",OV.offset),(0,R.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",OV.rotation);const oV=LV("metallicTexture");(0,R.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",oV.scale),(0,R.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",oV.offset),(0,R.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",oV.rotation),(0,R.k)("/materials/{}/emissiveFactor",[new XV(s.d.ANIMATIONTYPE_COLOR3,"emissiveColor",eV,(()=>3))]);const MV=LV("bumpTexture");(0,R.k)("/materials/{}/normalTexture/scale",[new XV(s.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",nV,(()=>1))]),(0,R.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",MV.scale),(0,R.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",MV.offset),(0,R.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",MV.rotation),(0,R.k)("/materials/{}/occlusionTexture/strength",[new XV(s.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",nV,(()=>1))]);const FV=LV("ambientTexture");(0,R.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",FV.scale),(0,R.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",FV.offset),(0,R.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",FV.rotation);const EV=LV("emissiveTexture");(0,R.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",EV.scale),(0,R.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",EV.offset),(0,R.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",EV.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new XV(s.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",nV,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new XV(s.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",nV,(()=>1))]);const HV=LV("anisotropy.texture");(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",HV.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",HV.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",HV.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new XV(s.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",nV,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new XV(s.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",nV,(()=>1))]);const jV=LV("clearCoat.texture");(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",jV.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",jV.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",jV.rotation);const mV=LV("clearCoat.bumpTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new XV(s.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",nV,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",mV.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",mV.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",mV.rotation);const GV=LV("clearCoat.textureRoughness");(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",GV.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",GV.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",GV.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new XV(s.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",nV,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new XV(s.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",nV,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new XV(s.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",nV,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new XV(s.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",nV,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new XV(s.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",nV,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new XV(s.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",nV,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new XV(s.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",nV,(()=>1))]);const wV=LV("iridescence.texture");(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",wV.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",wV.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",wV.rotation);const NV=LV("iridescence.thicknessTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",NV.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",NV.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",NV.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new XV(s.d.ANIMATIONTYPE_COLOR3,"sheen.color",eV,(()=>3))]),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new XV(s.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",nV,(()=>1))]);const rV=LV("sheen.texture");(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",rV.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",rV.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",rV.rotation);const kV=LV("sheen.textureRoughness");(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",kV.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",kV.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",kV.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new XV(s.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",nV,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new XV(s.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",eV,(()=>3))]);const RV=LV("metallicReflectanceTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",RV.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",RV.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",RV.rotation);const ZV=LV("reflectanceTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",ZV.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",ZV.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",ZV.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new XV(s.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",nV,(()=>1))]);const zV=LV("subSurface.refractionIntensityTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",zV.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",zV.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",zV.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new XV(s.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",eV,(()=>3))]),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new XV(s.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",nV,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new XV(s.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",nV,(()=>1))]);const dV=LV("subSurface.thicknessTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",dV.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",dV.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",dV.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new XV(s.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",nV,(()=>1))]);const xV=LV("subSurface.translucencyIntensityTexture");(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",xV.scale),(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",xV.offset),(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",xV.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new XV(s.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",eV,(()=>3))]);const yV=LV("subSurface.translucencyColorTexture");(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",yV.scale),(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",yV.offset),(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",yV.rotation),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new DV(s.d.ANIMATIONTYPE_COLOR3,"diffuse",eV,(()=>3))]),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new DV(s.d.ANIMATIONTYPE_FLOAT,"intensity",nV,(()=>1))]),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new DV(s.d.ANIMATIONTYPE_FLOAT,"range",nV,(()=>1))]),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new DV(s.d.ANIMATIONTYPE_FLOAT,"innerAngle",PV,(()=>1))]),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new DV(s.d.ANIMATIONTYPE_FLOAT,"angle",PV,(()=>1))]),(0,R.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new DV(s.d.ANIMATIONTYPE_COLOR3,"diffuse",eV,(()=>3))]),(0,R.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new DV(s.d.ANIMATIONTYPE_FLOAT,"intensity",nV,(()=>1))]);const QV="KHR_animation_pointer";class AV{constructor(h){this.name=QV,this._loader=h,this._pathToObjectConverter=(0,R.g)(this._loader.fg)}get enabled(){return this._loader.isExtensionUsed(QV)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(h,V,i,S,l){var Y;const g=null===(Y=S.target.extensions)||void 0===Y?void 0:Y.KHR_animation_pointer;if(!g||!this._pathToObjectConverter)return null;"pointer"!==S.target.path&&e.d.Warn(`${h}/target/path: Value (${S.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=S.target.node&&e.d.Warn(`${h}/target/node: Value (${S.target.node}) must not be present when using the ${this.name} extension`);const q=`${h}/extensions/${this.name}`,B=g.pointer;if(!B)throw new Error(`${q}: Pointer is missing`);try{const Y=this._pathToObjectConverter.convert(B);if(!Y.info.interpolation)throw new Error(`${q}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(h,V,i,S,{object:Y.object,info:Y.info.interpolation},l)}catch(J){return e.d.Warn(`${q}/pointer: Invalid pointer (${B}) skipped`),null}}}k(QV),r(QV,!0,(h=>new AV(h)));class bV{constructor(h,V,i){this.frame=h,this.action=V,this.onlyOnce=i,this.isDone=!1}_clone(){return new bV(this.frame,this.action,this.onlyOnce)}}var CV=i(10980),uV=i(11028),pV=i(11021);class WV{get loop(){return this._loop}set loop(h){h!==this._loop&&(this._loop=h,this.updateOptions({loop:h}))}get currentTime(){var h;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(h=uV.b.audioEngine)&&void 0!==h&&h.audioContext&&(this.isPlaying||this.isPaused)){const h=this.isPaused?0:uV.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+h}return 0}get spatialSound(){return this._spatialSound}set spatialSound(h){if(h==this._spatialSound)return;const V=this.isPlaying;this.pause(),h?(this._spatialSound=h,this._updateSpatialParameters()):this._disableSpatialSound(),V&&this.play()}constructor(h,V,i){var S;let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new I.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=l.nV.Zero(),this._localDirection=new l.nV(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=h,i=i||T.d.LastCreatedScene)if(this._scene=i,WV._SceneComponentInitialization(i),this._readyToPlayCallback=Y,this._customAttenuationFunction=(h,V,i,S,l)=>V<i?h*(1-V/i):0,q&&(this.autoplay=q.autoplay||!1,this._loop=q.loop||!1,void 0!==q.volume&&(this._volume=q.volume),this._spatialSound=q.spatialSound??!1,this.maxDistance=q.maxDistance??100,this.useCustomAttenuation=q.useCustomAttenuation??!1,this.rolloffFactor=q.rolloffFactor||1,this.refDistance=q.refDistance||1,this.distanceModel=q.distanceModel||"linear",this._playbackRate=q.playbackRate||1,this._streaming=q.streaming??!1,this._length=q.length,this._offset=q.offset),null!==(S=uV.b.audioEngine)&&void 0!==S&&S.canUseWebAudio&&uV.b.audioEngine.audioContext){this._soundGain=uV.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let h=!0;if(V)try{"string"===typeof V?(this._urlType="String",this._url=V):V instanceof ArrayBuffer?this._urlType="ArrayBuffer":V instanceof HTMLMediaElement?this._urlType="MediaElement":V instanceof MediaStream?this._urlType="MediaStream":V instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(V)&&(this._urlType="Array");let i=[],S=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=uV.b.audioEngine.audioContext.createMediaElementSource(V),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=uV.b.audioEngine.audioContext.createMediaStreamSource(V),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":V.byteLength>0&&(S=!0,this._soundLoaded(V));break;case"AudioBuffer":this._audioBufferLoaded(V);break;case"String":i.push(V);case"Array":0===i.length&&(i=V);for(let h=0;h<i.length;h++){const V=i[h];if(S=q&&q.skipCodecCheck||-1!==V.indexOf(".mp3",V.length-4)&&uV.b.audioEngine.isMP3supported||-1!==V.indexOf(".ogg",V.length-4)&&uV.b.audioEngine.isOGGsupported||-1!==V.indexOf(".wav",V.length-4)||-1!==V.indexOf(".m4a",V.length-4)||-1!==V.indexOf(".mp4",V.length-4)||-1!==V.indexOf("blob:"),S){this._streaming?(this._htmlAudioElement=new Audio(V),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,g.Tools.SetCorsBehavior(V,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(V,(h=>{this._soundLoaded(h)}),void 0,!0,!0,(h=>{h&&e.d.Error("XHR "+h.status+" error on: "+V+"."),e.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:h=!1}h?S||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):e.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(B){e.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),uV.b.audioEngine&&!uV.b.audioEngine.WarnedWebAudioUnsupported&&(e.d.Error("Web Audio is not supported by your browser."),uV.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var h;null!==(h=uV.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(h){var V;null!==(V=uV.b.audioEngine)&&void 0!==V&&V.audioContext&&(this._audioBuffer=h,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(h){var V;null!==(V=uV.b.audioEngine)&&void 0!==V&&V.audioContext&&uV.b.audioEngine.audioContext.decodeAudioData(h,(h=>{this._audioBufferLoaded(h)}),(h=>{e.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+h)}))}setAudioBuffer(h){var V;null!==(V=uV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&(this._audioBuffer=h,this._isReadyToPlay=!0)}updateOptions(h){h&&(this.loop=h.loop??this.loop,this.maxDistance=h.maxDistance??this.maxDistance,this.useCustomAttenuation=h.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=h.rolloffFactor??this.rolloffFactor,this.refDistance=h.refDistance??this.refDistance,this.distanceModel=h.distanceModel??this.distanceModel,this._playbackRate=h.playbackRate??this._playbackRate,this._length=h.length??void 0,this.spatialSound=h.spatialSound??this._spatialSound,this._setOffset(h.offset??void 0),this.setVolume(h.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var h;null!==(h=uV.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&uV.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??uV.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var h;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(h=this._soundPanner)||void 0===h||h.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var h;null!==(h=uV.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(h){var V;null!==(V=uV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(h),this._isOutputConnected=!0)}setDirectionalCone(h,V,i){V<h?e.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=h,this._coneOuterAngle=V,this._coneOuterGain=i,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(h){if(h!=this._coneInnerAngle){var V;if(this._coneOuterAngle<h)return void e.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=h,null!==(V=uV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(h){if(h!=this._coneOuterAngle){var V;if(h<this._coneInnerAngle)return void e.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=h,null!==(V=uV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(h){var V;h.equals(this._position)||(this._position.l(h),null!==(V=uV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(h){var V;this._localDirection=h,null!==(V=uV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const h=this._connectedTransformNode.getWorldMatrix(),V=l.nV.TransformNormal(this._localDirection,h);V.normalize(),this._soundPanner.orientationX.value=V.x,this._soundPanner.orientationY.value=V.y,this._soundPanner.orientationZ.value=V.z}updateDistanceFromListener(){var h;if(null!==(h=uV.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const h=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.cV(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,h,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(h){this._customAttenuationFunction=h}play(h,V,i){var S;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(S=uV.b.audioEngine)&&void 0!==S&&S.audioContext)try{var l,Y;this._clearTimeoutsAndObservers();let S=h?(null===(l=uV.b.audioEngine)||void 0===l?void 0:l.audioContext.currentTime)+h:null===(Y=uV.b.audioEngine)||void 0===Y?void 0:Y.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=uV.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const h=()=>{var i;if(null!==(i=uV.b.audioEngine)&&void 0!==i&&i.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=V??0;const i=this._htmlAudioElement.play();void 0!==i&&i.catch((()=>{var V,i;(null===(V=uV.b.audioEngine)||void 0===V||V.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(i=uV.b.audioEngine)||void 0===i?void 0:i.onAudioUnlockedObservable.addOnce((()=>{h()})))}))}else{var S;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(S=uV.b.audioEngine)||void 0===S?void 0:S.onAudioUnlockedObservable.addOnce((()=>{h()}))}};h()}}else{var g;const l=()=>{var l;if(null!==(l=uV.b.audioEngine)&&void 0!==l&&l.audioContext){var Y;if(i=i||this._length,void 0!==V&&this._setOffset(V),this._soundSource){const h=this._soundSource;h.onended=()=>{h.disconnect()}}if(this._soundSource=null===(Y=uV.b.audioEngine)||void 0===Y?void 0:Y.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var g;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==V&&(this._soundSource.loopStart=V),void 0!==i&&(this._soundSource.loopEnd=(0|V)+i),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},S=h?(null===(g=uV.b.audioEngine)||void 0===g?void 0:g.audioContext.currentTime)+h:uV.b.audioEngine.audioContext.currentTime;const l=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(S,l,this.loop?void 0:i)}}};"suspended"===(null===(g=uV.b.audioEngine)||void 0===g?void 0:g.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var h;"suspended"===(null===(h=uV.b.audioEngine)||void 0===h?void 0:h.audioContext.state)?(uV.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=uV.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{l()})))):l()}),500):l()}this._startTime=S,this.isPlaying=!0,this.isPaused=!1}catch(q){e.d.Error("Error while trying to play audio: "+this.name+", "+q.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(h){var V;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var i;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(i=this._streamingSource)||void 0===i||i.disconnect();this.isPlaying=!1}else if(null!==(V=uV.b.audioEngine)&&void 0!==V&&V.audioContext&&this._soundSource){const V=h?uV.b.audioEngine.audioContext.currentTime+h:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(V)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var h;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var V;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(V=this._streamingSource)||void 0===V||V.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(h=uV.b.audioEngine)&&void 0!==h&&h.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=uV.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(h,V){var i;null!==(i=uV.b.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._soundGain&&(V&&uV.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(uV.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,uV.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(h,uV.b.audioEngine.audioContext.currentTime+V)):this._soundGain.gain.value=h),this._volume=h}setPlaybackRate(h){this._playbackRate=h,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(h){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=h,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=h=>this._onRegisterAfterWorldMatrixUpdate(h),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(h){var V;if(h.getBoundingInfo){const V=h.getBoundingInfo();this.setPosition(V.boundingSphere.centerWorld)}else this.setPosition(h.absolutePosition);null!==(V=uV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const h=()=>{(0,pV.h)((()=>this._isReadyToPlay),(()=>{i._audioBuffer=this.getAudioBuffer(),i._isReadyToPlay=!0,i.autoplay&&i.play(0,this._offset,this._length)}),void 0,300)},V={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},i=new WV(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,V);return this.useCustomAttenuation&&i.setAttenuationFunction(this._customAttenuationFunction),i.setPosition(this._position),i.setPlaybackRate(this._playbackRate),h(),i}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const h={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(h.connectedMeshId=this._connectedTransformNode.id),h.position=this._position.Ng(),h.refDistance=this.refDistance,h.distanceModel=this.distanceModel,h.isDirectional=this._isDirectional,h.localDirectionToMesh=this._localDirection.Ng(),h.coneInnerAngle=this._coneInnerAngle,h.coneOuterAngle=this._coneOuterAngle,h.coneOuterGain=this._coneOuterGain),h}static Parse(h,V,i,S){const Y=h.name;let g;g=h.url?i+h.url:i+Y;const q={autoplay:h.autoplay,loop:h.loop,volume:h.volume,spatialSound:h.spatialSound,maxDistance:h.maxDistance,rolloffFactor:h.rolloffFactor,refDistance:h.refDistance,distanceModel:h.distanceModel,playbackRate:h.playbackRate};let B;if(S){const h=()=>{(0,pV.h)((()=>S._isReadyToPlay),(()=>{B._audioBuffer=S.getAudioBuffer(),B._isReadyToPlay=!0,B.autoplay&&B.play(0,B._offset,B._length)}),void 0,300)};B=new WV(Y,new ArrayBuffer(0),V,null,q),h()}else B=new WV(Y,g,V,(()=>{V.removePendingData(B)}),q),V.addPendingData(B);if(h.position){const V=l.nV.UV(h.position);B.setPosition(V)}if(h.isDirectional&&(B.setDirectionalCone(h.coneInnerAngle||360,h.coneOuterAngle||360,h.coneOuterGain||0),h.localDirectionToMesh)){const V=l.nV.UV(h.localDirectionToMesh);B.setLocalDirectionToMesh(V)}if(h.connectedMeshId){const i=V.getMeshById(h.connectedMeshId);i&&B.attachToMesh(i)}return h.metadata&&(B.metadata=h.metadata),B}_setOffset(h){this._offset!==h&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=h)}_clearTimeoutsAndObservers(){var h;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(h=uV.b.audioEngine)||void 0===h||h.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}WV._SceneComponentInitialization=h=>{throw(0,CV.d)("AudioSceneComponent")},(0,Xh.f)("BABYLON.Sound",WV);class aV{constructor(h,V,i){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],V.length!==i.length)throw new Error("Sounds length does not equal weights length");this.loop=h,this._weights=i;let S=0;for(const Y of i)S+=Y;const l=S>0?1/S:0;for(let Y=0;Y<this._weights.length;Y++)this._weights[Y]*=l;this._sounds=V;for(const Y of this._sounds)Y.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(h){if(h!==this._coneInnerAngle){if(this._coneOuterAngle<h)return void e.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=h;for(const V of this._sounds)V.directionalConeInnerAngle=h}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(h){if(h!==this._coneOuterAngle){if(h<this._coneInnerAngle)return void e.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=h;for(const V of this._sounds)V.directionalConeOuterAngle=h}}get volume(){return this._volume}set volume(h){if(h!==this._volume)for(const V of this._sounds)V.setVolume(h)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(h){if(!this.isPaused){this.stop();const h=Math.random();let V=0;for(let i=0;i<this._weights.length;i++)if(V+=this._weights[i],h<=V){this._currentIndex=i;break}}const V=this._sounds[this._currentIndex??0];V.isReady()?V.play(0,this.isPaused?void 0:h):V.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class KV{constructor(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(h=h||T.d.LastCreatedScene)&&(this._scene=h,this.soundCollection=[],this._options=V,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var h;null!==(h=uV.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&uV.b.audioEngine.audioContext&&(this._outputAudioNode=uV.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(uV.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(uV.b.audioEngine&&uV.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(h){var V;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(V=uV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._outputAudioNode&&h.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==h.soundTrackId&&(-1===h.soundTrackId?this._scene.mainSoundTrack.removeSound(h):this._scene.soundTracks&&this._scene.soundTracks[h.soundTrackId].removeSound(h)),this.soundCollection.push(h),h.soundTrackId=this.id}removeSound(h){const V=this.soundCollection.indexOf(h);-1!==V&&this.soundCollection.splice(V,1)}setVolume(h){var V;null!==(V=uV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=h)}switchPanningModelToHRTF(){var h;if(null!==(h=uV.b.audioEngine)&&void 0!==h&&h.canUseWebAudio)for(let V=0;V<this.soundCollection.length;V++)this.soundCollection[V].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var h;if(null!==(h=uV.b.audioEngine)&&void 0!==h&&h.canUseWebAudio)for(let V=0;V<this.soundCollection.length;V++)this.soundCollection[V].switchPanningModelToEqualPower()}connectToAnalyser(h){var V;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=h,null!==(V=uV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,uV.b.audioEngine.masterGain))}}var hi=i(11413),Vi=i(11382),ii=i(10963);uV.b.AudioEngineFactory=(h,V,i)=>new Si(h,V,i);class Si{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new I.d,this.onAudioLockedObservable=new I.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,ii.j)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const S=document.createElement("audio");this._hostElement=h,this._audioContext=V,this._audioDestination=i;try{S&&S.canPlayType&&(S.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||S.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(l){}try{S&&S.canPlayType&&S.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(l){}}lock(){this._triggerSuspendedState()}unlock(){var h,V;if("running"===(null===(h=this._audioContext)||void 0===h?void 0:h.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(V=this._audioContext)||void 0===V||V.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{e.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var h;null===(h=this._audioContext)||void 0===h||h.addEventListener("statechange",(()=>{var h;this.unlocked&&"running"!==(null===(h=this._audioContext)||void 0===h?void 0:h.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var h;return null!==(h=this._audioContext)&&void 0!==h&&h.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(h){this.canUseWebAudio=!1,e.d.Error("Web Audio: "+h.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(h){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const h=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",V=document.createElement("style");V.appendChild(document.createTextNode(h)),document.getElementsByTagName("head")[0].appendChild(V),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var h;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(h=this._audioContext)||void 0===h||h.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(h){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=h)}connectToAnalyser(h){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=h,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var li=i(10975);(0,i(12471).f)(hi.e.NAME_AUDIO,((h,V,i,S)=>{let l,Y=[];if(i.Js=i.Js||[],void 0!==h.Js&&null!==h.Js)for(let q=0,B=h.Js.length;q<B;q++){var g;const B=h.Js[q];null!==(g=uV.b.audioEngine)&&void 0!==g&&g.canUseWebAudio?(B.url||(B.url=B.name),Y[B.url]?i.Js.push(WV.Parse(B,V,S,Y[B.url])):(l=WV.Parse(B,V,S),Y[B.url]=l,i.Js.push(l))):i.Js.push(new WV(B.name,null,V))}Y=[]})),Object.defineProperty(Vi.d.prototype,"mainSoundTrack",{get:function(){let h=this._getComponent(hi.e.NAME_AUDIO);return h||(h=new Yi(this),this.o(h)),this._mainSoundTrack||(this._mainSoundTrack=new KV(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Vi.d.prototype.getSoundByName=function(h){let V;for(V=0;V<this.mainSoundTrack.soundCollection.length;V++)if(this.mainSoundTrack.soundCollection[V].name===h)return this.mainSoundTrack.soundCollection[V];if(this.soundTracks)for(let i=0;i<this.soundTracks.length;i++)for(V=0;V<this.soundTracks[i].soundCollection.length;V++)if(this.soundTracks[i].soundCollection[V].name===h)return this.soundTracks[i].soundCollection[V];return null},Object.defineProperty(Vi.d.prototype,"audioEnabled",{get:function(){let h=this._getComponent(hi.e.NAME_AUDIO);return h||(h=new Yi(this),this.o(h)),h.audioEnabled},set:function(h){let V=this._getComponent(hi.e.NAME_AUDIO);V||(V=new Yi(this),this.o(V)),h?V.enableAudio():V.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Vi.d.prototype,"headphone",{get:function(){let h=this._getComponent(hi.e.NAME_AUDIO);return h||(h=new Yi(this),this.o(h)),h.headphone},set:function(h){let V=this._getComponent(hi.e.NAME_AUDIO);V||(V=new Yi(this),this.o(V)),h?V.switchAudioModeForHeadphones():V.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Vi.d.prototype,"audioListenerPositionProvider",{get:function(){let h=this._getComponent(hi.e.NAME_AUDIO);return h||(h=new Yi(this),this.o(h)),h.audioListenerPositionProvider},set:function(h){let V=this._getComponent(hi.e.NAME_AUDIO);if(V||(V=new Yi(this),this.o(V)),h&&"function"!==typeof h)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");V.audioListenerPositionProvider=h},enumerable:!0,configurable:!0}),Object.defineProperty(Vi.d.prototype,"audioListenerRotationProvider",{get:function(){let h=this._getComponent(hi.e.NAME_AUDIO);return h||(h=new Yi(this),this.o(h)),h.audioListenerRotationProvider},set:function(h){let V=this._getComponent(hi.e.NAME_AUDIO);if(V||(V=new Yi(this),this.o(V)),h&&"function"!==typeof h)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");V.audioListenerRotationProvider=h},enumerable:!0,configurable:!0}),Object.defineProperty(Vi.d.prototype,"audioPositioningRefreshRate",{get:function(){let h=this._getComponent(hi.e.NAME_AUDIO);return h||(h=new Yi(this),this.o(h)),h.audioPositioningRefreshRate},set:function(h){let V=this._getComponent(hi.e.NAME_AUDIO);V||(V=new Yi(this),this.o(V)),V.audioPositioningRefreshRate=h},enumerable:!0,configurable:!0});class Yi{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(h){this.name=hi.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new l.nV,this._cachedCameraPosition=new l.nV,this._lastCheck=0,this._invertMatrixTemp=new l.Matrix,this._cameraDirectionTemp=new l.nV,(h=h||T.d.LastCreatedScene)&&(this.fV=h,h.soundTracks=[],h.Js=[])}register(){this.fV._afterRenderStage.registerStep(hi.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(h){if(h.Js=[],this.fV.soundTracks)for(let V=0;V<this.fV.soundTracks.length;V++){const i=this.fV.soundTracks[V];for(let V=0;V<i.soundCollection.length;V++)h.Js.push(i.soundCollection[V].serialize())}}addFromContainer(h){if(h.Js)for(const V of h.Js)V.play(),V.autoplay=!0,this.fV.mainSoundTrack.addSound(V)}removeFromContainer(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(h.Js)for(const i of h.Js)i.stop(),i.autoplay=!1,this.fV.mainSoundTrack.removeSound(i),V&&i.dispose()}dispose(){const h=this.fV;if(h._mainSoundTrack&&h.mainSoundTrack.dispose(),h.soundTracks)for(let V=0;V<h.soundTracks.length;V++)h.soundTracks[V].dispose()}disableAudio(){const h=this.fV;let V;for(this._audioEnabled=!1,uV.b.audioEngine&&uV.b.audioEngine.audioContext&&uV.b.audioEngine.audioContext.suspend(),V=0;V<h.mainSoundTrack.soundCollection.length;V++)h.mainSoundTrack.soundCollection[V].pause();if(h.soundTracks)for(V=0;V<h.soundTracks.length;V++)for(let i=0;i<h.soundTracks[V].soundCollection.length;i++)h.soundTracks[V].soundCollection[i].pause()}enableAudio(){const h=this.fV;let V;for(this._audioEnabled=!0,uV.b.audioEngine&&uV.b.audioEngine.audioContext&&uV.b.audioEngine.audioContext.resume(),V=0;V<h.mainSoundTrack.soundCollection.length;V++)h.mainSoundTrack.soundCollection[V].isPaused&&h.mainSoundTrack.soundCollection[V].play();if(h.soundTracks)for(V=0;V<h.soundTracks.length;V++)for(let i=0;i<h.soundTracks[V].soundCollection.length;i++)h.soundTracks[V].soundCollection[i].isPaused&&h.soundTracks[V].soundCollection[i].play()}switchAudioModeForHeadphones(){const h=this.fV;if(this._headphone=!0,h.mainSoundTrack.switchPanningModelToHRTF(),h.soundTracks)for(let V=0;V<h.soundTracks.length;V++)h.soundTracks[V].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const h=this.fV;if(this._headphone=!1,h.mainSoundTrack.switchPanningModelToEqualPower(),h.soundTracks)for(let V=0;V<h.soundTracks.length;V++)h.soundTracks[V].switchPanningModelToEqualPower()}_afterRender(){const h=li.e.Now;if(this._lastCheck&&h-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=h;const V=this.fV;if(!this._audioEnabled||!V._mainSoundTrack||!V.soundTracks||0===V._mainSoundTrack.soundCollection.length&&1===V.soundTracks.length)return;const i=uV.b.audioEngine;if(i&&i.audioContext){let h,S=V.activeCamera;if(V.activeCameras&&V.activeCameras.length>0&&(S=V.activeCameras[0]),this.audioListenerPositionProvider){const h=this.audioListenerPositionProvider();i.audioContext.listener.setPosition(h.x||0,h.y||0,h.z||0)}else S?this._cachedCameraPosition.equals(S.globalPosition)||(this._cachedCameraPosition.l(S.globalPosition),i.audioContext.listener.setPosition(S.globalPosition.x,S.globalPosition.y,S.globalPosition.z)):i.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const h=this.audioListenerRotationProvider();i.audioContext.listener.setOrientation(h.x||0,h.y||0,h.z||0,0,1,0)}else S?(S.rigCameras&&S.rigCameras.length>0&&(S=S.rigCameras[0]),S.getViewMatrix().invertToRef(this._invertMatrixTemp),l.nV.TransformNormalToRef(Yi._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.l(this._cameraDirectionTemp),i.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):i.audioContext.listener.setOrientation(0,0,0,0,1,0);for(h=0;h<V.mainSoundTrack.soundCollection.length;h++){const i=V.mainSoundTrack.soundCollection[h];i.useCustomAttenuation&&i.updateDistanceFromListener()}if(V.soundTracks)for(h=0;h<V.soundTracks.length;h++)for(let i=0;i<V.soundTracks[h].soundCollection.length;i++){const S=V.soundTracks[h].soundCollection[i];S.useCustomAttenuation&&S.updateDistanceFromListener()}}}}Yi._CameraDirection=new l.nV(0,0,-1),WV._SceneComponentInitialization=h=>{let V=h._getComponent(hi.e.NAME_AUDIO);V||(V=new Yi(h),h.o(V))};const gi="MSFT_audio_emitter";class qi{constructor(h){this.name=gi,this._loader=h,this.enabled=this._loader.isExtensionUsed(gi)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const h=this._loader.fg.extensions;if(h&&h[this.name]){const V=h[this.name];this._clips=V.clips,this._emitters=V.emitters,d.Assign(this._clips),d.Assign(this._emitters)}}loadSceneAsync(h,V){return y.LoadExtensionAsync(h,V,this.name,(async(i,S)=>{const l=new Array;l.push(this._loader.loadSceneAsync(h,V));for(const h of S.emitters){const V=d.Get(`${i}/emitters`,this._emitters,h);if(void 0!=V.refDistance||void 0!=V.maxDistance||void 0!=V.rolloffFactor||void 0!=V.distanceModel||void 0!=V.innerAngle||void 0!=V.outerAngle)throw new Error(`${i}: Direction or Distance properties are not allowed on emitters attached to a scene`);l.push(this._loadEmitterAsync(`${i}/emitters/${V.index}`,V))}await Promise.all(l)}))}loadNodeAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(h,S)=>{const Y=new Array,q=await this._loader.loadNodeAsync(h,V,(V=>{for(const i of S.emitters){const S=d.Get(`${h}/emitters`,this._emitters,i);Y.push(this._loadEmitterAsync(`${h}/emitters/${S.index}`,S).then((()=>{for(const h of S._babylonSounds)h.attachToMesh(V),void 0==S.innerAngle&&void 0==S.outerAngle||(h.setLocalDirectionToMesh(l.nV.Forward()),h.setDirectionalCone(2*g.Tools.ToDegrees(void 0==S.innerAngle?Math.PI:S.innerAngle),2*g.Tools.ToDegrees(void 0==S.outerAngle?Math.PI:S.outerAngle),0))})))}i(V)}));return await Promise.all(Y),q}))}loadAnimationAsync(h,V){return y.LoadExtensionAsync(h,V,this.name,(async(i,S)=>{const l=await this._loader.loadAnimationAsync(h,V),Y=new Array;d.Assign(S.events);for(const g of S.events)Y.push(this._loadAnimationEventAsync(`${i}/events/${g.index}`,h,V,g,l));return await Promise.all(Y),l}))}_loadClipAsync(h,V){if(V._objectURL)return V._objectURL;let i;if(V.uri)i=this._loader.loadUriAsync(h,V,V.uri);else{const S=d.Get(`${h}/bufferView`,this._loader.fg.bufferViews,V.bufferView);i=this._loader.loadBufferViewAsync(`/bufferViews/${S.index}`,S)}return V._objectURL=i.then((h=>URL.createObjectURL(new Blob([h],{type:V.mimeType})))),V._objectURL}_loadEmitterAsync(h,V){if(V._babylonSounds=V._babylonSounds||[],!V._babylonData){const h=new Array,i=V.name||`emitter${V.index}`,S={loop:!1,autoplay:!1,volume:void 0==V.volume?1:V.volume};for(let Y=0;Y<V.clips.length;Y++){const l=`/extensions/${this.name}/clips`,g=d.Get(l,this._clips,V.clips[Y].clip);h.push(this._loadClipAsync(`${l}/${V.clips[Y].clip}`,g).then((h=>{const l=V._babylonSounds[Y]=new WV(i,h,this._loader.babylonScene,null,S);l.refDistance=V.refDistance||1,l.maxDistance=V.maxDistance||256,l.rolloffFactor=V.rolloffFactor||1,l.distanceModel=V.distanceModel||"exponential"})))}const l=Promise.all(h).then((()=>{const h=V.clips.map((h=>h.weight||1)),i=new aV(V.loop||!1,V._babylonSounds,h);V.innerAngle&&(i.directionalConeInnerAngle=2*g.Tools.ToDegrees(V.innerAngle)),V.outerAngle&&(i.directionalConeOuterAngle=2*g.Tools.ToDegrees(V.outerAngle)),V.volume&&(i.volume=V.volume),V._babylonData.sound=i}));V._babylonData={loaded:l}}return V._babylonData.loaded}_getEventAction(h,V,i,S,l){switch(i){case"play":return h=>{const i=(l||0)+(h-S);V.play(i)};case"stop":return()=>{V.stop()};case"pause":return()=>{V.pause()};default:throw new Error(`${h}: Unsupported action ${i}`)}}_loadAnimationEventAsync(h,V,i,S,l){if(0==l.targetedAnimations.length)return Promise.resolve();const Y=l.targetedAnimations[0],g=S.k,q=d.Get(`/extensions/${this.name}/emitters`,this._emitters,g);return this._loadEmitterAsync(h,q).then((()=>{const V=q._babylonData.sound;if(V){const i=new bV(S.time,this._getEventAction(h,V,S.action,S.time,S.startOffset));Y.animation.addEvent(i),l.onAnimationGroupEndObservable.add((()=>{V.stop()})),l.onAnimationGroupPauseObservable.add((()=>{V.pause()}))}}))}}k(gi),r(gi,!0,(h=>new qi(h)));const Bi="MSFT_lod";class Ji{constructor(h){var V;this.name=Bi,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new I.d,this.onMaterialLODsLoadedObservable=new I.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=h,this.maxLODsToLoad=(null===(V=this._loader.parent.extensionOptions[Bi])||void 0===V?void 0:V.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Bi)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let h=0;h<this._nodePromiseLODs.length;h++){const V=Promise.all(this._nodePromiseLODs[h]).then((()=>{0!==h&&(this._loader.endPerformanceCounter(`Node LOD ${h}`),this._loader.log(`Loaded node LOD ${h}`)),this.onNodeLODsLoadedObservable.notifyObservers(h),h!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${h+1}`),this._loadBufferLOD(this._nodeBufferLODs,h+1),this._nodeSignalLODs[h]&&this._nodeSignalLODs[h].resolve())}));this._loader._completePromises.push(V)}for(let h=0;h<this._materialPromiseLODs.length;h++){const V=Promise.all(this._materialPromiseLODs[h]).then((()=>{0!==h&&(this._loader.endPerformanceCounter(`Material LOD ${h}`),this._loader.log(`Loaded material LOD ${h}`)),this.onMaterialLODsLoadedObservable.notifyObservers(h),h!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${h+1}`),this._loadBufferLOD(this._materialBufferLODs,h+1),this._materialSignalLODs[h]&&this._materialSignalLODs[h].resolve())}));this._loader._completePromises.push(V)}}loadSceneAsync(h,V){const i=this._loader.loadSceneAsync(h,V);return this._loadBufferLOD(this._bufferLODs,0),i}loadNodeAsync(h,V,i){return y.LoadExtensionAsync(h,V,this.name,(async(h,l)=>{let Y;const g=this._getLODs(h,V,this._loader.fg.nodes,l.ids);this._loader.logOpen(`${h}`);for(let V=0;V<g.length;V++){const h=g[V];0!==V&&(this._nodeIndexLOD=V,this._nodeSignalLODs[V]=this._nodeSignalLODs[V]||new S);const l=h=>{i(h),h.Gq(!1)},q=this._loader.loadNodeAsync(`/nodes/${h.index}`,h,l).then((h=>{if(0!==V){const h=g[V-1];h._babylonTransformNode&&(this._disposeTransformNode(h._babylonTransformNode),delete h._babylonTransformNode)}return h.Gq(!0),h}));this._nodePromiseLODs[V]=this._nodePromiseLODs[V]||[],0===V?Y=q:(this._nodeIndexLOD=null,this._nodePromiseLODs[V].push(q))}return this._loader.logClose(),await Y}))}_loadMaterialAsync(h,V,i,S,l){return this._nodeIndexLOD?null:y.LoadExtensionAsync(h,V,this.name,(async(h,Y)=>{let g;const q=this._getLODs(h,V,this._loader.fg.materials,Y.ids);this._loader.logOpen(`${h}`);for(let V=0;V<q.length;V++){const h=q[V];0!==V&&(this._materialIndexLOD=V);const Y=this._loader._loadMaterialAsync(`/materials/${h.index}`,h,i,S,(h=>{0===V&&l(h)})).then((h=>{if(0!==V){l(h);const i=q[V-1]._data;i[S]&&(this._disposeMaterials([i[S].babylonMaterial]),delete i[S])}return h}));this._materialPromiseLODs[V]=this._materialPromiseLODs[V]||[],0===V?g=Y:(this._materialIndexLOD=null,this._materialPromiseLODs[V].push(Y))}return this._loader.logClose(),await g}))}_loadUriAsync(h,V,i){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const l=this._nodeIndexLOD-1;return this._nodeSignalLODs[l]=this._nodeSignalLODs[l]||new S,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(h,V,i)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const l=this._materialIndexLOD-1;return this._materialSignalLODs[l]=this._materialSignalLODs[l]||new S,this._materialSignalLODs[l].promise.then((async()=>await this._loader.loadUriAsync(h,V,i)))}return null}loadBufferAsync(h,V,i,l){if(this._loader.parent.useRangeRequests&&!V.uri){if(!this._loader.bin)throw new Error(`${h}: Uri is missing or the binary glTF is missing its binary chunk`);const V=async(h,V)=>{const Y=i,g=Y+l-1;let q=h[V];return q?(q.start=Math.min(q.start,Y),q.end=Math.max(q.end,g)):(q={start:Y,end:g,loaded:new S},h[V]=q),await q.loaded.promise.then((h=>new Uint8Array(h.buffer,h.byteOffset+i-q.start,l)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?V(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?V(this._materialBufferLODs,this._materialIndexLOD):V(this._bufferLODs,0)}return null}_loadBufferLOD(h,V){const i=h[V];i&&(this._loader.log(`Loading buffer range [${i.start}-${i.end}]`),this._loader.bin.readAsync(i.start,i.end-i.start+1).then((h=>{i.loaded.resolve(h)}),(h=>{i.loaded.reject(h)})))}_getLODs(h,V,i,S){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const l=[];for(let Y=S.length-1;Y>=0;Y--)if(l.push(d.Get(`${h}/ids/${S[Y]}`,i,S[Y])),l.length===this.maxLODsToLoad)return l;return l.push(V),l}_disposeTransformNode(h){const V=[],i=h.material;i&&V.push(i);for(const l of h.getChildMeshes())l.material&&V.push(l.material);h.dispose();const S=V.filter((h=>this._loader.babylonScene.meshes.every((V=>V.material!=h))));this._disposeMaterials(S)}_disposeMaterials(h){const V={};for(const i of h){for(const h of i.getActiveTextures())V[h.uniqueId]=h;i.dispose()}for(const i in V)for(const h of this._loader.babylonScene.materials)h.hasTexture(V[i])&&delete V[i];for(const i in V)V[i].dispose()}}k(Bi),r(Bi,!0,(h=>new Ji(h)));const Ii="MSFT_minecraftMesh";class vi{constructor(h){this.name=Ii,this._loader=h,this.enabled=this._loader.isExtensionUsed(Ii)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtraAsync(h,V,this.name,(async(S,l)=>{if(l){if(!(i instanceof P.e))throw new Error(`${S}: Material type not supported`);const l=this._loader.loadMaterialPropertiesAsync(h,V,i);return i.needAlphaBlending()&&(i.forceDepthWrite=!0,i.separateCullingPass=!0),i.Kg=i.forceDepthWrite,i.twoSidedLighting=!0,await l}}))}}k(Ii),r(Ii,!0,(h=>new vi(h)));const si="MSFT_sRGBFactors";class ti{constructor(h){this.name=si,this._loader=h,this.enabled=this._loader.isExtensionUsed(si)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,V,i){return y.LoadExtraAsync(h,V,this.name,(async(S,l)=>{if(l){if(!(i instanceof P.e))throw new Error(`${S}: Material type not supported`);const l=this._loader.loadMaterialPropertiesAsync(h,V,i),Y=i.Mh().getEngine().useExactSrgbConversions;return i.albedoTexture||i.albedoColor.toLinearSpaceToRef(i.albedoColor,Y),i.reflectivityTexture||i.reflectivityColor.toLinearSpaceToRef(i.reflectivityColor,Y),await l}}))}}k(si),r(si,!0,(h=>new ti(h)));var Ti=i(12787);const ei={};var ni=i(12846),ci=i(12824),fi=i(12791),Pi=i(12805);function Li(h,V){for(const i of h)for(const h of i.dataOutputs)if(h.uniqueId===V)return h;throw new Error("Could not find data out connection with unique id "+V)}function Ui(h,V){for(const i of h)if(i instanceof ci.c)for(const h of i.signalInputs)if(h.uniqueId===V)return h;throw new Error("Could not find signal in connection with unique id "+V)}async function Xi(h,V){const S=await Promise.all(h.allBlocks.map((async h=>{const V=function(h){switch(h){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([i.e(78),i.e(79)]).then(i.bind(i,14311))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await i.e(80).then(i.bind(i,14320))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await i.e(81).then(i.bind(i,14322))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await i.e(82).then(i.bind(i,14331))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await i.e(83).then(i.bind(i,14333))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await i.e(84).then(i.bind(i,14338))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await i.e(85).then(i.bind(i,14340))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await i.e(86).then(i.bind(i,14349))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await i.e(87).then(i.bind(i,14358))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await i.e(89).then(i.bind(i,14397))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await i.e(89).then(i.bind(i,14397))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await i.e(89).then(i.bind(i,14397))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await i.e(89).then(i.bind(i,14397))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await i.e(89).then(i.bind(i,14397))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await i.e(89).then(i.bind(i,14397))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await i.e(90).then(i.bind(i,14401))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await i.e(90).then(i.bind(i,14401))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await i.e(90).then(i.bind(i,14401))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await i.e(90).then(i.bind(i,14401))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await i.e(95).then(i.bind(i,14406))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await i.e(96).then(i.bind(i,14410))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await i.e(97).then(i.bind(i,14419))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await i.e(98).then(i.bind(i,14426))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await i.e(99).then(i.bind(i,14430))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await i.e(100).then(i.bind(i,14438))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await i.e(101).then(i.bind(i,14444))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await i.e(102).then(i.bind(i,14453))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await i.e(103).then(i.bind(i,14460))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await i.e(104).then(i.bind(i,14466))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await i.e(105).then(i.bind(i,14470))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await i.e(106).then(i.bind(i,14478))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await i.e(107).then(i.bind(i,14480))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await i.e(108).then(i.bind(i,14483))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await i.e(109).then(i.bind(i,14492))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await i.e(110).then(i.bind(i,14496))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await i.e(111).then(i.bind(i,14500))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await i.e(112).then(i.bind(i,14508))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await i.e(113).then(i.bind(i,14510))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await i.e(92).then(i.bind(i,14512))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await i.e(114).then(i.bind(i,14518))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await i.e(115).then(i.bind(i,14523))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await i.e(116).then(i.bind(i,14525))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await i.e(93).then(i.bind(i,14531))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await i.e(88).then(i.bind(i,14366))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await i.e(94).then(i.bind(i,14538))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await i.e(94).then(i.bind(i,14538))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await i.e(94).then(i.bind(i,14538))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await i.e(94).then(i.bind(i,14538))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await i.e(94).then(i.bind(i,14538))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await i.e(94).then(i.bind(i,14538))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await i.e(94).then(i.bind(i,14538))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await i.e(94).then(i.bind(i,14538))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await i.e(89).then(i.bind(i,14397))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await i.e(89).then(i.bind(i,14397))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await i.e(89).then(i.bind(i,14397))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await i.e(89).then(i.bind(i,14397))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await i.e(89).then(i.bind(i,14397))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await i.e(89).then(i.bind(i,14397))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await i.e(89).then(i.bind(i,14397))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await i.e(90).then(i.bind(i,14401))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await i.e(90).then(i.bind(i,14401))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await i.e(91).then(i.bind(i,14545))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await i.e(91).then(i.bind(i,14545))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await i.e(91).then(i.bind(i,14545))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await i.e(91).then(i.bind(i,14545))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await i.e(91).then(i.bind(i,14545))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await i.e(91).then(i.bind(i,14545))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await i.e(117).then(i.bind(i,14547))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await i.e(118).then(i.bind(i,14555))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await i.e(119).then(i.bind(i,14564))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await i.e(120).then(i.bind(i,14571))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await i.e(121).then(i.bind(i,14573))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await i.e(122).then(i.bind(i,14579))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await i.e(123).then(i.bind(i,14581))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await i.e(124).then(i.bind(i,14589))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await i.e(125).then(i.bind(i,14594))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await i.e(126).then(i.bind(i,14602))).FlowGraphDataSwitchBlock;default:if(ei[h])return ei[h];throw new Error(`Unknown block name ${h}`)}}(h.className);return await V()})));return function(h,V,i){const S=V.coordinator.createGraph(),l=[],Y=V.valueParseFunction??fi.e;for(let g=0;g<h.allBlocks.length;g++){const q=Oi(h.allBlocks[g],{fV:V.coordinator.config.fV,pathConverter:V.pathConverter,assetsContainer:V.coordinator.config.fV,valueParseFunction:Y},i[g]);l.push(q),q instanceof ni.d&&S.addEventBlock(q)}for(const g of l){for(const h of g.dataInputs)for(const V of h.connectedPointIds){const i=Li(l,V);h.connectTo(i)}if(g instanceof ci.c)for(const h of g.signalOutputs)for(const V of h.connectedPointIds){const i=Ui(l,V);h.connectTo(i)}}for(const g of h.executionContexts)Di(g,{graph:S,valueParseFunction:Y},h.rightHanded);return S}(h,V,S)}function Di(h,V,i){const S=V.graph.createContext();h.enableLogging&&(S.enableLogging=!0),S.treatDataAsRightHanded=i||!1;const l=V.valueParseFunction??fi.e;S.uniqueId=h.uniqueId;const Y=S.Mh();if(h._assetsContext){var g,q,B,J,I,v,s,t,T,e;const V=h._assetsContext,i={meshes:null===(g=V.meshes)||void 0===g?void 0:g.map((h=>Y.getMeshById(h))),lights:null===(q=V.lights)||void 0===q?void 0:q.map((h=>Y.getLightByName(h))),cameras:null===(B=V.cameras)||void 0===B?void 0:B.map((h=>Y.getCameraByName(h))),materials:null===(J=V.materials)||void 0===J?void 0:J.map((h=>Y.getMaterialById(h))),textures:null===(I=V.textures)||void 0===I?void 0:I.map((h=>Y.getTextureByName(h))),animations:null===(v=V.animations)||void 0===v?void 0:v.map((h=>Y.animations.find((V=>V.name===h)))),skeletons:null===(s=V.skeletons)||void 0===s?void 0:s.map((h=>Y.getSkeletonByName(h))),Fv:null===(t=V.Fv)||void 0===t?void 0:t.map((h=>Y.getParticleSystemById(h))),animationGroups:null===(T=V.animationGroups)||void 0===T?void 0:T.map((h=>Y.getAnimationGroupByName(h))),transformNodes:null===(e=V.transformNodes)||void 0===e?void 0:e.map((h=>Y.getTransformNodeById(h))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Js:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};S.assetsContext=i}for(const n in h._userVariables){const V=l(n,h._userVariables,S.assetsContext,Y);S.userVariables[n]=V}for(const n in h._connectionValues){const V=l(n,h._connectionValues,S.assetsContext,Y);S._setConnectionValueByKey(n,V)}return S}function Oi(h,V,i){const S={},l=V.valueParseFunction??fi.e;if(h.config)for(const g in h.config)S[g]=l(g,h.config,V.assetsContainer||V.fV,V.fV);if((0,fi.i)(h.className)){if(!V.pathConverter)throw new Error("Path converter is required for this block");S.pathConverter=V.pathConverter}const Y=new i(S);Y.uniqueId=h.uniqueId;for(let g=0;g<h.dataInputs.length;g++){const V=Y.getDataInput(h.dataInputs[g].name);if(!V)throw new Error("Could not find data input with name "+h.dataInputs[g].name+" in block "+h.className);V.deserialize(h.dataInputs[g])}for(let g=0;g<h.dataOutputs.length;g++){const V=Y.getDataOutput(h.dataOutputs[g].name);if(!V)throw new Error("Could not find data output with name "+h.dataOutputs[g].name+" in block "+h.className);V.deserialize(h.dataOutputs[g])}return Y.metadata=h.metadata,Y.deserialize&&Y.deserialize(h),Y}function oi(h){const[V,i]=h.split(":");return Mi({op:V,extension:i})}function Mi(h){var V;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const S=h.extension?null===(V=Ei[h.extension])||void 0===V?void 0:V[h.op]:Hi[h.op];if(!S&&(e.d.Warn(`No mapping found for operation ${h.op} and extension ${h.extension||"KHR_interactivity"}`),i)){const V={},i={flows:{}};if(h.inputValueSockets){V.values={};for(const i in h.inputValueSockets)V.values[i]={name:i}}return h.outputValueSockets&&(i.values={},Object.keys(h.outputValueSockets).forEach((h=>{i.values[h]={name:h}}))),{bJ:[],inputs:V,outputs:i}}return S}function Fi(h,V,i){Ei[V]||(Ei[V]={}),Ei[V][h]=i}const Ei={BABYLON:{"flow/log":{bJ:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Hi={"event/onStart":{bJ:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{bJ:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{bJ:["FlowGraphSendCustomEventBlock"],extraProcessor(h,V,i,S,l){if("event/send"!==V.op||!h.configuration||1!==Object.keys(h.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Y=h.configuration.event.value[0];if("number"!==typeof Y)throw new Error("Event id should be a number");const g=S.arrays.events[Y],q=l[0];return q.config||(q.config={}),q.config.eventId=g.eventId,q.config.eventData=g.eventData,l}},"event/receive":{bJ:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(h,V){var i;if(!h.configuration)return e.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const S=h.configuration.event;if(!S)return e.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const l=S.value[0];if("number"!==typeof l)return e.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(i=V.events)||void 0===i?void 0:i[l])?{valid:!0}:(e.d.Error(`Event with id ${l} not found`),{valid:!1,error:`Event with id ${l} not found`})},extraProcessor(h,V,i,S,l){if("event/receive"!==V.op||!h.configuration||1!==Object.keys(h.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Y=h.configuration.event.value[0];if("number"!==typeof Y)throw new Error("Event id should be a number");const g=S.arrays.events[Y],q=l[0];return q.config||(q.config={}),q.config.eventId=g.eventId,q.config.eventData=g.eventData,l}},"math/e":ji("FlowGraphEBlock"),"math/pi":ji("FlowGraphPIBlock"),"math/inf":ji("FlowGraphInfBlock"),"math/nan":ji("FlowGraphNaNBlock"),"math/abs":ji("FlowGraphAbsBlock"),"math/sign":ji("FlowGraphSignBlock"),"math/trunc":ji("FlowGraphTruncBlock"),"math/floor":ji("FlowGraphFloorBlock"),"math/ceil":ji("FlowGraphCeilBlock"),"math/round":{bJ:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,V,i,S,l){var Y;return(Y=l[0]).config||(Y.config={}),l[0].config.roundHalfAwayFromZero=!0,l}},"math/fract":ji("FlowGraphFractBlock"),"math/neg":ji("FlowGraphNegationBlock"),"math/add":ji("FlowGraphAddBlock",["a","b"],!0),"math/sub":ji("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{bJ:["FlowGraphMultiplyBlock"],extraProcessor(h,V,i,S,l){var Y;(Y=l[0]).config||(Y.config={}),l[0].config.useMatrixPerComponent=!0,l[0].config.preventIntegerFloatArithmetic=!0;let g=-1;return Object.keys(h.values||{}).find((V=>{var i;return void 0!==(null===(i=h.values)||void 0===i?void 0:i[V].type)&&(g=h.values[V].type,!0)})),-1!==g&&(l[0].config.type=S.arrays.types[g].flowGraphType),l},validation:h=>h.values?mi(h):{valid:!0}},"math/div":ji("FlowGraphDivideBlock",["a","b"],!0),"math/rem":ji("FlowGraphModuloBlock",["a","b"]),"math/min":ji("FlowGraphMinBlock",["a","b"]),"math/max":ji("FlowGraphMaxBlock",["a","b"]),"math/clamp":ji("FlowGraphClampBlock",["a","b","c"]),"math/saturate":ji("FlowGraphSaturateBlock"),"math/mix":ji("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":ji("FlowGraphEqualityBlock",["a","b"]),"math/lt":ji("FlowGraphLessThanBlock",["a","b"]),"math/le":ji("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":ji("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":ji("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":ji("FlowGraphIsNaNBlock"),"math/isinf":ji("FlowGraphIsInfBlock"),"math/select":{bJ:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{bJ:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":ji("FlowGraphSinBlock"),"math/cos":ji("FlowGraphCosBlock"),"math/tan":ji("FlowGraphTanBlock"),"math/asin":ji("FlowGraphASinBlock"),"math/acos":ji("FlowGraphACosBlock"),"math/atan":ji("FlowGraphATanBlock"),"math/atan2":ji("FlowGraphATan2Block",["a","b"]),"math/sinh":ji("FlowGraphSinhBlock"),"math/cosh":ji("FlowGraphCoshBlock"),"math/tanh":ji("FlowGraphTanhBlock"),"math/asinh":ji("FlowGraphASinhBlock"),"math/acosh":ji("FlowGraphACoshBlock"),"math/atanh":ji("FlowGraphATanhBlock"),"math/exp":ji("FlowGraphExponentialBlock"),"math/log":ji("FlowGraphLogBlock"),"math/log2":ji("FlowGraphLog2Block"),"math/log10":ji("FlowGraphLog10Block"),"math/sqrt":ji("FlowGraphSquareRootBlock"),"math/cbrt":ji("FlowGraphCubeRootBlock"),"math/pow":ji("FlowGraphPowerBlock",["a","b"]),"math/length":ji("FlowGraphLengthBlock"),"math/normalize":ji("FlowGraphNormalizeBlock"),"math/dot":ji("FlowGraphDotBlock",["a","b"]),"math/cross":ji("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":ji("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":ji("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{bJ:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{bJ:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{bJ:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{bJ:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{bJ:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{bJ:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{bJ:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":ji("FlowGraphTransposeBlock"),"math/determinant":ji("FlowGraphDeterminantBlock"),"math/inverse":ji("FlowGraphInvertMatrixBlock"),"math/matmul":ji("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{bJ:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Jq",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,V,i,S,l,Y){const g=l[0].dataInputs.find((h=>"rotationQuaternion"===h.name));if(!g)throw new Error("Rotation quaternion input not found");return Y._connectionValues[g.uniqueId]&&(Y._connectionValues[g.uniqueId].type="Quaternion"),l}},"math/matDecompose":{bJ:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Jq"}}}},"math/quatConjugate":ji("FlowGraphConjugateBlock",["a"]),"math/quatMul":{bJ:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,V,i,S,l){var Y;return(Y=l[0]).config||(Y.config={}),l[0].config.type="Quaternion",l}},"math/quatAngleBetween":ji("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{bJ:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":ji("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":ji("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{bJ:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,V,i,S,l){var Y;return(Y=l[0]).config||(Y.config={}),l[0].config.inputIsColumnMajor=!0,l}},"math/extract2x2":{bJ:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{bJ:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,V,i,S,l){var Y;return(Y=l[0]).config||(Y.config={}),l[0].config.inputIsColumnMajor=!0,l}},"math/extract3x3":{bJ:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{bJ:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,V,i,S,l){var Y;return(Y=l[0]).config||(Y.config={}),l[0].config.inputIsColumnMajor=!0,l}},"math/extract4x4":{bJ:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{bJ:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,V,i,S,l,Y){var g,q;(q=l[0]).config||(q.config={});const B=l[0].dataInputs[0];return l[0].config.valueType=(null===(g=Y._connectionValues[B.uniqueId])||void 0===g?void 0:g.type)??"FlowGraphInteger",l}},"math/and":{bJ:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,V,i,S,l,Y){var g,q,B;(B=l[0]).config||(B.config={});const J=l[0].dataInputs[0],I=l[0].dataInputs[1];return l[0].config.valueType=(null===(g=Y._connectionValues[J.uniqueId])||void 0===g?void 0:g.type)??(null===(q=Y._connectionValues[I.uniqueId])||void 0===q?void 0:q.type)??"FlowGraphInteger",l}},"math/or":{bJ:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,V,i,S,l,Y){var g,q,B;(B=l[0]).config||(B.config={});const J=l[0].dataInputs[0],I=l[0].dataInputs[1];return l[0].config.valueType=(null===(g=Y._connectionValues[J.uniqueId])||void 0===g?void 0:g.type)??(null===(q=Y._connectionValues[I.uniqueId])||void 0===q?void 0:q.type)??"FlowGraphInteger",l}},"math/xor":{bJ:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,V,i,S,l,Y){var g,q,B;(B=l[0]).config||(B.config={});const J=l[0].dataInputs[0],I=l[0].dataInputs[1];return l[0].config.valueType=(null===(g=Y._connectionValues[J.uniqueId])||void 0===g?void 0:g.type)??(null===(q=Y._connectionValues[I.uniqueId])||void 0===q?void 0:q.type)??"FlowGraphInteger",l}},"math/asr":ji("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":ji("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":ji("FlowGraphLeadingZerosBlock"),"math/ctz":ji("FlowGraphTrailingZerosBlock"),"math/popcnt":ji("FlowGraphOneBitsCounterBlock"),"math/rad":ji("FlowGraphDegToRadBlock"),"math/deg":ji("FlowGraphRadToDegBlock"),"type/boolToInt":ji("FlowGraphBooleanToInt"),"type/boolToFloat":ji("FlowGraphBooleanToFloat"),"type/intToBool":ji("FlowGraphIntToBoolean"),"type/intToFloat":ji("FlowGraphIntToFloat"),"type/floatToInt":ji("FlowGraphFloatToInt"),"type/floatToBool":ji("FlowGraphFloatToBoolean"),"flow/sequence":{bJ:["FlowGraphSequenceBlock"],extraProcessor(h,V,i,S,l){const Y=l[0];return Y.config||(Y.config={}),Y.config.outputSignalCount=Object.keys(h.flows||[]).length,Y.signalOutputs.forEach(((h,V)=>{h.name="out_"+V})),l}},"flow/branch":{bJ:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{bJ:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(h){if(h.configuration&&h.configuration.cases){const V=h.configuration.cases.value;if(!V.every((h=>"number"===typeof h&&/^-?\d+$/.test(h.toString()))))return e.d.Warn("Switch cases should be integers. Using empty array instead."),h.configuration.cases.value=[],{valid:!0};const i=new Set(V);h.configuration.cases.value=Array.from(i)}return{valid:!0}},extraProcessor(h,V,i,S,l){if("flow/switch"!==V.op||!h.flows||0===Object.keys(h.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return l[0].signalOutputs.forEach((h=>{"default"!==h.name&&(h.name="out_"+h.name)})),l}},"flow/while":{bJ:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{bJ:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(h,V,i,S,l){const Y=l[0];return Y.config||(Y.config={}),Y.config.incrementIndexWhenLoopDone=!0,l}},"flow/doN":{bJ:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{bJ:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(h,V,i,S,l){if("flow/multiGate"!==V.op||!h.flows||0===Object.keys(h.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const Y=l[0];return Y.config||(Y.config={}),Y.config.outputSignalCount=Object.keys(h.flows).length,Y.signalOutputs.forEach(((h,V)=>{h.name="out_"+V})),l}},"flow/waitAll":{bJ:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(h){var V,i;return"number"!==typeof(null===(V=h.configuration)||void 0===V||null===(i=V.inputFlows)||void 0===i?void 0:i.value[0])&&(h.configuration=h.configuration||{inputFlows:{value:[0]}},h.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{bJ:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{bJ:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{bJ:["FlowGraphCancelDelayBlock"]},"variable/get":{bJ:["FlowGraphGetVariableBlock"],validation(h){var V,i;return null!==(V=h.configuration)&&void 0!==V&&null!==(i=V.variable)&&void 0!==i&&i.value?{valid:!0}:(e.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(h,V)=>[V.getVariableName(h[0])]}}},"variable/set":{bJ:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(h,V)=>[V.getVariableName(h[0])]}}},"variable/setMultiple":{bJ:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(h,V)=>[h[0].map((h=>V.getVariableName(h)))]}},extraProcessor:(h,V,i,S,l)=>(l[0].dataInputs.forEach((h=>{h.name=S.getVariableName(+h.name)})),l)},"variable/interpolate":{bJ:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(h,V)=>[V.getVariableName(h[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:h=>!0===h[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Pi:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Pi:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Pi:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Pi:"FlowGraphPlayAnimationBlock"},out:{name:"out",Pi:"FlowGraphPlayAnimationBlock"},done:{name:"done",Pi:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(h,V,i,S,l){var Y,g,q;const B=l[0],J=null===(Y=h.configuration)||void 0===Y?void 0:Y.variable.value[0];if("number"!==typeof J)throw e.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const I=S.arrays.staticVariables[J];"undefined"===typeof B.config.animationType.value&&(S.arrays.staticVariables,B.config.animationType.value=(0,Pi.J)(I.type));const v=l[4];return v.config||(v.config={}),(g=v.config).variable||(g.variable={}),v.config.variable.value=S.getVariableName(J),(q=l[3]).config||(q.config={}),l}},"pointer/get":{bJ:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Pi:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Pi:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(h,V,i,S,l)=>(l.forEach((h=>{"FlowGraphJsonPointerParserBlock"===h.className&&(h.config||(h.config={}),h.config.outputValue=!0)})),l)},"pointer/set":{bJ:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Pi:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Pi:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(h,V,i,S,l)=>(l.forEach((h=>{"FlowGraphJsonPointerParserBlock"===h.className&&(h.config||(h.config={}),h.config.outputValue=!0)})),l)},"pointer/interpolate":{bJ:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Pi:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Pi:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Pi:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Pi:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Pi:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Pi:"FlowGraphPlayAnimationBlock"},out:{name:"out",Pi:"FlowGraphPlayAnimationBlock"},done:{name:"done",Pi:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(h,V,i,S,l)=>(l.forEach((V=>{"FlowGraphJsonPointerParserBlock"===V.className?(V.config||(V.config={}),V.config.outputValue=!0):"FlowGraphInterpolationBlock"===V.className&&(V.config||(V.config={}),Object.keys(h.values||[]).forEach((i=>{var l;const Y=null===(l=h.values)||void 0===l?void 0:l[i];if("value"===i&&Y){const h=Y.type;void 0!==h&&(V.config.animationType=S.arrays.types[h].flowGraphType)}})))})),l)},"animation/start":{bJ:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Pi:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(h,V)=>[h[0]*V._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(h,V)=>[h[0]*V._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(h,V,i,S,l,Y,g){const q=l[l.length-1];return q.config||(q.config={}),q.config.glTF=g,l}},"animation/stop":{bJ:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Pi:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(h,V,i,S,l,Y,g){const q=l[l.length-1];return q.config||(q.config={}),q.config.glTF=g,l}},"animation/stopAt":{bJ:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Pi:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(h,V)=>[h[0]*V._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(h,V,i,S,l,Y,g){const q=l[l.length-1];return q.config||(q.config={}),q.config.glTF=g,l}},"math/switch":{bJ:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(h){if(h.configuration&&h.configuration.cases){const V=h.configuration.cases.value;if(!V.every((h=>"number"===typeof h&&/^-?\d+$/.test(h.toString()))))return e.d.Warn("Switch cases should be integers. Using empty array instead."),h.configuration.cases.value=[],{valid:!0};const i=new Set(V);h.configuration.cases.value=Array.from(i)}return{valid:!0}},extraProcessor(h,V,i,S,l){const Y=l[0];return Y.dataInputs.forEach((h=>{"default"!==h.name&&"case"!==h.name&&(h.name="in_"+h.name)})),Y.config||(Y.config={}),Y.config.treatCasesAsIntegers=!0,l}},"debug/log":{bJ:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function ji(h){let V=arguments.length>2?arguments[2]:void 0;return{bJ:[h],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((h,V)=>(h[V]={name:V},h)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(h,i,S,l,Y){var g;if(V){(g=Y[0]).config||(g.config={}),Y[0].config.preventIntegerFloatArithmetic=!0;let V=-1;Object.keys(h.values||{}).find((i=>{var S;return void 0!==(null===(S=h.values)||void 0===S?void 0:S[i].type)&&(V=h.values[i].type,!0)})),-1!==V&&(Y[0].config.type=l.arrays.types[V].flowGraphType)}return Y},validation:h=>V?mi(h):{valid:!0}}}function mi(h){if(h.values){const V=Object.keys(h.values).map((V=>h.values[V].type)).filter((h=>void 0!==h));if(!V.every((h=>h===V[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Hi["math/compose"]=Hi["math/matCompose"],Hi["math/decompose"]=Hi["math/matDecompose"];var Gi=i(11100);const wi={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"nV",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Ni{constructor(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=h,this._gltf=V,this._animationTargetFps=i,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const h of this._interactivityGraph.types)this._types.push(wi[h.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const h of this._interactivityGraph.declarations){const V=Mi(h);if(!V)throw e.d.Error(["No mapping found for declaration",h]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:V,fullOperationName:h.extension?h.op+":"+h.extension:h.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const h of this._interactivityGraph.variables){const V=this._parseVariable(h);this._staticVariables.push(V)}}_parseVariable(h,V){const i=this._types[h.type];if(!i)throw e.d.Error(["No type found for variable",h]),new Error("Error parsing variables");if(h.value&&h.value.length!==i.length)throw e.d.Error(["Invalid value length for variable",h,i]),new Error("Error parsing variables");const S=h.value||[];if(!S.length)switch(i.flowGraphType){case"boolean":S.push(!1);break;case"FlowGraphInteger":S.push(0);break;case"number":S.push(NaN);break;case"Vector2":S.push(NaN,NaN);break;case"nV":S.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":S.fill(NaN,0,4);break;case"Matrix":S.fill(NaN,0,16);break;case"Matrix3D":S.fill(NaN,0,9)}return"number"===i.elementType&&"string"===typeof S[0]&&(S[0]=parseFloat(S[0])),{type:i.flowGraphType,value:V?V(S,this):S}}_parseEvents(){if(this._interactivityGraph.events)for(const h of this._interactivityGraph.events){const V={eventId:h.id||"internalEvent_"+this._internalEventsCounter++};h.values&&(V.eventData=Object.keys(h.values).map((V=>{var i;const S=null===(i=h.values)||void 0===i?void 0:i[V];if(!S)throw e.d.Error(["No value found for event key",V]),new Error("Error parsing events");const l=this._types[S.type];if(!l)throw e.d.Error(["No type found for event value",S]),new Error("Error parsing events");const Y="undefined"!==typeof S.value?this._parseVariable(S):void 0;return{id:V,type:l.flowGraphType,eventData:!0,value:Y}}))),this._events.push(V)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const V of this._interactivityGraph.nodes){if("number"!==typeof V.declaration)throw e.d.Error(["No declaration found for node",V]),new Error("Error parsing nodes");const i=this._mappings[V.declaration];if(!i)throw e.d.Error(["No mapping found for node",V]),new Error("Error parsing nodes");if(i.flowGraphMapping.validation){const S=i.flowGraphMapping.validation(V,this._interactivityGraph,this._gltf);var h;if(!S.valid)throw new Error(`Error validating interactivity node ${null===(h=this._interactivityGraph.declarations)||void 0===h?void 0:h[V.declaration].op} - ${S.error}`)}const S=[];for(const h of i.flowGraphMapping.bJ){const l=this._getEmptyBlock(h,i.fullOperationName);this._parseNodeConfiguration(V,l,i.flowGraphMapping,h),S.push(l)}this._nodes.push({bJ:S,fullOperationName:i.fullOperationName})}}_getEmptyBlock(h,V){return{uniqueId:(0,Gi.e)(),className:h,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:V,metadata:{}}}_parseNodeConfiguration(h,V,i,S){const l=V.config;if(h.configuration){const V=Object.keys(h.configuration);for(const q of V){var Y,g;const V=null===(Y=h.configuration)||void 0===Y?void 0:Y[q];if(!V)throw e.d.Error(["No value found for node configuration",q]),new Error("Error parsing node configuration");const B=null===(g=i.configuration)||void 0===g?void 0:g[q];if(B&&B.Pi?B.Pi===S:0===i.bJ.indexOf(S)){const h=(null===B||void 0===B?void 0:B.name)||q;V&&"undefined"!==typeof V.value||"undefined"===typeof(null===B||void 0===B?void 0:B.defaultValue)?V.value.length>=0?l[h]={value:1===V.value.length?V.value[0]:V.value}:e.d.Warn(["Invalid value for node configuration",V]):l[h]={value:B.defaultValue},B&&B.dataTransformer&&(l[h].value=B.dataTransformer([l[h].value],this)[0])}}}}_parseNodeConnections(h){for(let X=0;X<this._nodes.length;X++){var V;const D=null===(V=this._interactivityGraph.nodes)||void 0===V?void 0:V[X];if(!D)throw e.d.Error(["No node found for interactivity node",this._nodes[X]]),new Error("Error parsing node connections");const O=this._nodes[X],o=this._mappings[D.declaration];if(!o)throw e.d.Error(["No mapping found for node",D]),new Error("Error parsing node connections");const M=D.flows||{},F=Object.keys(M).sort();for(const h of F){var i,S,l,Y;const V=M[h],J=null===(i=o.flowGraphMapping.outputs)||void 0===i||null===(S=i.flows)||void 0===S?void 0:S[h],I=(null===J||void 0===J?void 0:J.name)||h,v=this._createNewSocketConnection(I,!0);(J&&J.Pi&&O.bJ.find((h=>h.className===J.Pi))||O.bJ[0]).signalOutputs.push(v);const s=V.node,t=this._nodes[s];if(!t)throw e.d.Error(["No node found for input node id",s]),new Error("Error parsing node connections");const T=oi(t.fullOperationName);if(!T)throw e.d.Error(["No mapping found for input node",t]),new Error("Error parsing node connections");let n=null===(l=T.inputs)||void 0===l||null===(Y=l.flows)||void 0===Y?void 0:Y[V.socket||"in"],c=!1;if(!n)for(const h in null===(g=T.inputs)||void 0===g?void 0:g.flows){var g,q,B;if(h.startsWith("[")&&h.endsWith("]"))c=!0,n=null===(q=T.inputs)||void 0===q||null===(B=q.flows)||void 0===B?void 0:B[h]}const f=n?c?n.name.replace("$1",V.socket||""):n.name:V.socket||"in",P=n&&n.Pi&&t.bJ.find((h=>h.className===n.Pi))||t.bJ[0];let L=P.signalInputs.find((h=>h.name===f));L||(L=this._createNewSocketConnection(f),P.signalInputs.push(L)),L.connectedPointIds.push(v.uniqueId),v.connectedPointIds.push(L.uniqueId)}const E=D.values||{},H=Object.keys(E);for(const V of H){var J,I;const i=E[V];let S=null===(J=o.flowGraphMapping.inputs)||void 0===J||null===(I=J.values)||void 0===I?void 0:I[V],l=!1;if(!S)for(const h in null===(v=o.flowGraphMapping.inputs)||void 0===v?void 0:v.values){var v,s,t;if(h.startsWith("[")&&h.endsWith("]"))l=!0,S=null===(s=o.flowGraphMapping.inputs)||void 0===s||null===(t=s.values)||void 0===t?void 0:t[h]}const Y=S?l?S.name.replace("$1",V):S.name:V,g=this._createNewSocketConnection(Y);if((S&&S.Pi&&O.bJ.find((h=>h.className===S.Pi))||O.bJ[0]).dataInputs.push(g),void 0!==i.value){const V=this._parseVariable(i,S&&S.dataTransformer);h._connectionValues[g.uniqueId]=V}else{if("undefined"===typeof i.node)throw e.d.Error(["Invalid value for value connection",i]),new Error("Error parsing node connections");{var T,n,c;const h=i.node,V=i.socket||"value",S=this._nodes[h];if(!S)throw e.d.Error(["No node found for output socket reference",i]),new Error("Error parsing node connections");const l=oi(S.fullOperationName);if(!l)throw e.d.Error(["No mapping found for output socket reference",i]),new Error("Error parsing node connections");let Y=null===(T=l.outputs)||void 0===T||null===(n=T.values)||void 0===n?void 0:n[V],q=!1;if(!Y)for(const i in null===(f=l.outputs)||void 0===f?void 0:f.values){var f,P,L;if(i.startsWith("[")&&i.endsWith("]"))q=!0,Y=null===(P=l.outputs)||void 0===P||null===(L=P.values)||void 0===L?void 0:L[i]}const B=Y?q?Y.name.replace("$1",V):null===(c=Y)||void 0===c?void 0:c.name:V,J=Y&&Y.Pi&&S.bJ.find((h=>h.className===Y.Pi))||S.bJ[0];let I=J.dataOutputs.find((h=>h.name===B));I||(I=this._createNewSocketConnection(B,!0),J.dataOutputs.push(I)),g.connectedPointIds.push(I.uniqueId),I.connectedPointIds.push(g.uniqueId)}}}if(o.flowGraphMapping.interBlockConnectors)for(const h of o.flowGraphMapping.interBlockConnectors){const V=h.input,i=h.output,S=h.isVariable;this._connectFlowGraphNodes(V,i,O.bJ[h.inputBlockIndex],O.bJ[h.outputBlockIndex],S)}if(o.flowGraphMapping.extraProcessor){var U;const V=null===(U=this._interactivityGraph.declarations)||void 0===U?void 0:U[D.declaration];if(!V)throw e.d.Error(["No declaration found for extra processor",D]),new Error("Error parsing node connections");O.bJ=o.flowGraphMapping.extraProcessor(D,V,o.flowGraphMapping,this,O.bJ,h,this._gltf)}}}_createNewSocketConnection(h,V){return{uniqueId:(0,Gi.e)(),name:h,_connectionType:V?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(h,V,i,S,l){const Y=l?i.dataInputs:i.signalInputs,g=l?S.dataOutputs:S.signalOutputs,q=Y.find((V=>V.name===h))||this._createNewSocketConnection(h),B=g.find((h=>h.name===V))||this._createNewSocketConnection(V,!0);Y.find((V=>V.name===h))||Y.push(q),g.find((h=>h.name===V))||g.push(B),q.connectedPointIds.push(B.uniqueId),B.connectedPointIds.push(q.uniqueId)}getVariableName(h){return"staticVariable_"+h}serializeToFlowGraph(){const h={uniqueId:(0,Gi.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(h);for(let V=0;V<this._staticVariables.length;V++){const i=this._staticVariables[V];h._userVariables[this.getVariableName(V)]=i}return{rightHanded:!0,allBlocks:this._nodes.reduce(((h,V)=>h.concat(V.bJ)),[]),executionContexts:[h]}}}const ri="KHR_interactivity";class ki{constructor(h){this._loader=h,this.name=ri,this.enabled=this._loader.isExtensionUsed(ri),this._pathConverter=(0,R.g)(this._loader.fg),h._skipStartAnimationStep=!0;const V=h.babylonScene;V&&function(h){(0,R.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!h.activeCamera)return new l.Quaternion(NaN,NaN,NaN,NaN);const V=l.Quaternion.FromRotationMatrix(h.activeCamera.getWorldMatrix()).normalize();return h.useRightHandedSystem||(V.w*=-1,V.x*=-1),V},type:"Quaternion",getTarget:()=>h.activeCamera}),(0,R.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!h.activeCamera)return new l.nV(NaN,NaN,NaN);const V=h.activeCamera.getWorldMatrix().getTranslation();return h.useRightHandedSystem||(V.x*=-1),V},type:"nV",getTarget:()=>h.activeCamera}),(0,R.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:h=>{var V;return(null===(V=h._babylonAnimationGroup)||void 0===V?void 0:V.isPlaying)??!1},type:"boolean",getTarget:h=>h._babylonAnimationGroup}),(0,R.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:h=>{var V;return((null===(V=h._babylonAnimationGroup)||void 0===V?void 0:V.from)??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup}),(0,R.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:h=>{var V;return((null===(V=h._babylonAnimationGroup)||void 0===V?void 0:V.to)??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup}),(0,R.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:h=>{var V;return((null===(V=h._babylonAnimationGroup)||void 0===V?void 0:V.getCurrentFrame())??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup}),(0,R.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:h=>{var V;return((null===(V=h._babylonAnimationGroup)||void 0===V?void 0:V.getCurrentFrame())??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup})}(V)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var h;if(!this._loader.babylonScene||!this._pathConverter)return;const V=this._loader.babylonScene,i=null===(h=this._loader.fg.extensions)||void 0===h?void 0:h.KHR_interactivity;if(!i)return;const S=new Ti.e({fV:V});S.dispatchEventsSynchronously=!1;const l=i.graphs.map((h=>new Ni(h,this._loader.fg,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(l.map((async h=>await Xi(h,{coordinator:S,pathConverter:this._pathConverter})))),S.start()}}var Ri;Ri=async()=>(await Promise.resolve().then(i.bind(i,12868))).FlowGraphGLTFDataProvider,ei[`${ri}/${"FlowGraphGLTFDataProvider"}`]=Ri,k(ri),r(ri,!0,(h=>new ki(h)));const Zi="KHR_node_visibility";(0,R.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:h=>{const V=h._babylonTransformNode;return!V||void 0===V.isVisible||V.isVisible},set:(h,V)=>{var i,S;null===(i=V._primitiveBabylonMeshes)||void 0===i||i.forEach((h=>{h.inheritVisibility=!0})),V._babylonTransformNode&&(V._babylonTransformNode.isVisible=h),null===(S=V._primitiveBabylonMeshes)||void 0===S||S.forEach((V=>{V.isVisible=h}))},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class zi{constructor(h){this.name=Zi,this._loader=h,this.enabled=h.isExtensionUsed(Zi)}async onReady(){var h;null===(h=this._loader.fg.nodes)||void 0===h||h.forEach((h=>{var V,i,S,l;(null===(V=h._primitiveBabylonMeshes)||void 0===V||V.forEach((h=>{h.inheritVisibility=!0})),null!==(i=h.extensions)&&void 0!==i&&i.KHR_node_visibility)&&(!1===(null===(S=h.extensions)||void 0===S?void 0:S.KHR_node_visibility.visible)&&(h._babylonTransformNode&&(h._babylonTransformNode.isVisible=!1),null===(l=h._primitiveBabylonMeshes)||void 0===l||l.forEach((h=>{h.isVisible=!1}))))}))}dispose(){this._loader=null}}k(Zi),r(Zi,!0,(h=>new zi(h)));const di="KHR_node_selectability";Fi("event/onSelect",di,{bJ:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Pi:"FlowGraphGetVariableBlock",dataTransformer:h=>["pickedMesh_"+h[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Pi:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(h,V,i,S,l,Y,g){var q,B,J,I,v,s;const t=l[l.length-1];t.config=t.config||{},t.config.glTF=g;const T=null===(q=h.configuration)||void 0===q||null===(B=q.nodeIndex)||void 0===B?void 0:B.value[0];if(void 0===T||"number"!==typeof T)throw new Error("nodeIndex not found in configuration");const e="pickedMesh_"+T;return l[1].config.variable=e,Y._userVariables[e]={className:"Mesh",id:null===g||void 0===g||null===(J=g.nodes)||void 0===J||null===(I=J[T]._babylonTransformNode)||void 0===I?void 0:I.id,uniqueId:null===g||void 0===g||null===(v=g.nodes)||void 0===v||null===(s=v[T]._babylonTransformNode)||void 0===s?void 0:s.uniqueId},l}}),(0,R.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:h=>{const V=h._babylonTransformNode;return!V||void 0===V.fB||V.fB},set:(h,V)=>{var i;null===(i=V._primitiveBabylonMeshes)||void 0===i||i.forEach((V=>{V.fB=h}))},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"fB"],type:"boolean"});class xi{constructor(h){this.name=di,this._loader=h,this.enabled=h.isExtensionUsed(di)}async onReady(){var h;null===(h=this._loader.fg.nodes)||void 0===h||h.forEach((h=>{var V,i,S;null!==(V=h.extensions)&&void 0!==V&&V.KHR_node_selectability&&!1===(null===(i=h.extensions)||void 0===i?void 0:i.KHR_node_selectability.selectable)&&(null===(S=h._babylonTransformNode)||void 0===S||S.getChildMeshes().forEach((h=>{h.fB=!1})))}))}dispose(){this._loader=null}}k(di),r(di,!0,(h=>new xi(h)));const yi="KHR_node_hoverability",Qi="targetMeshPointerOver_";Fi("event/onHoverIn",yi,{bJ:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Pi:"FlowGraphGetVariableBlock",dataTransformer:h=>[Qi+h[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Pi:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(h,V,i,S,l,Y,g){var q,B,J,I,v,s;const t=l[l.length-1];t.config=t.config||{},t.config.glTF=g;const T=null===(q=h.configuration)||void 0===q||null===(B=q.nodeIndex)||void 0===B?void 0:B.value[0];if(void 0===T||"number"!==typeof T)throw new Error("nodeIndex not found in configuration");const e=Qi+T;return l[1].config.variable=e,Y._userVariables[e]={className:"Mesh",id:null===g||void 0===g||null===(J=g.nodes)||void 0===J||null===(I=J[T]._babylonTransformNode)||void 0===I?void 0:I.id,uniqueId:null===g||void 0===g||null===(v=g.nodes)||void 0===v||null===(s=v[T]._babylonTransformNode)||void 0===s?void 0:s.uniqueId},l}});const Ai="targetMeshPointerOut_";Fi("event/onHoverOut",yi,{bJ:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Pi:"FlowGraphGetVariableBlock",dataTransformer:h=>[Ai+h[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Pi:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(h,V,i,S,l,Y,g){var q,B,J,I,v,s;const t=l[l.length-1];t.config=t.config||{},t.config.glTF=g;const T=null===(q=h.configuration)||void 0===q||null===(B=q.nodeIndex)||void 0===B?void 0:B.value[0];if(void 0===T||"number"!==typeof T)throw new Error("nodeIndex not found in configuration");const e=Ai+T;return l[1].config.variable=e,Y._userVariables[e]={className:"Mesh",id:null===g||void 0===g||null===(J=g.nodes)||void 0===J||null===(I=J[T]._babylonTransformNode)||void 0===I?void 0:I.id,uniqueId:null===g||void 0===g||null===(v=g.nodes)||void 0===v||null===(s=v[T]._babylonTransformNode)||void 0===s?void 0:s.uniqueId},l}}),(0,R.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:h=>{const V=h._babylonTransformNode;return!V||void 0===V.pointerOverDisableMeshTesting||V.pointerOverDisableMeshTesting},set:(h,V)=>{var i;null===(i=V._primitiveBabylonMeshes)||void 0===i||i.forEach((V=>{V.pointerOverDisableMeshTesting=!h}))},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class bi{constructor(h){this.name=yi,this._loader=h,this.enabled=h.isExtensionUsed(yi)}async onReady(){var h;null===(h=this._loader.fg.nodes)||void 0===h||h.forEach((h=>{var V,i,S;null!==(V=h.extensions)&&void 0!==V&&V.KHR_node_hoverability&&!1===(null===(i=h.extensions)||void 0===i?void 0:i.KHR_node_hoverability.hoverable)&&(null===(S=h._babylonTransformNode)||void 0===S||S.getChildMeshes().forEach((h=>{h.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}k(yi),r(yi,!0,(h=>new bi(h)));const Ci="ExtrasAsMetadata";class ui{_assignExtras(h,V){if(V.extras&&Object.keys(V.extras).length>0){const i=h.metadata=h.metadata||{};(i.fg=i.fg||{}).extras=V.extras}}constructor(h){this.name=Ci,this.enabled=!0,this._loader=h}dispose(){this._loader=null}loadNodeAsync(h,V,i){return this._loader.loadNodeAsync(h,V,(h=>{this._assignExtras(h,V),i(h)}))}loadCameraAsync(h,V,i){return this._loader.loadCameraAsync(h,V,(h=>{this._assignExtras(h,V),i(h)}))}createMaterial(h,V,i){const S=this._loader.createMaterial(h,V,i);return this._assignExtras(S,V),S}}k(Ci),r(Ci,!1,(h=>new ui(h)));i(12868)},12727:(h,V,i)=>{"use strict";i.d(V,{e:()=>m,h:()=>o,l:()=>O,o:()=>M});var S=i(10960),l=i(10952),Y=i(12390),g=i(11590),q=i(11556),B=i(11570),J=i(10967),I=i(10988),v=i(11586),s=i(11681),t=i(11598),T=i(11186);class e{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Fv=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Js=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(h){this._environmentTexture=h}getNodes(){let h=[];h=h.concat(this.meshes),h=h.concat(this.lights),h=h.concat(this.cameras),h=h.concat(this.transformNodes);for(const V of this.skeletons)h=h.concat(V.bones);return h}}class n extends e{}class c{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const h=this.rootNodes;for(const S of h)S.dispose();h.length=0;const V=this.skeletons;for(const S of V)S.dispose();V.length=0;const i=this.animationGroups;for(const S of i)S.dispose();i.length=0}}class f extends e{constructor(h){super(),this._wasAddedToScene=!1,(h=h||I.d.LastCreatedScene)&&(this.fV=h,this.proceduralTextures=[],h.Ig.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=h.getEngine().onContextRestoredObservable.add((()=>{for(const h of this.geometries)h._rebuild();for(const h of this.meshes)h._rebuild();for(const h of this.Fv)h.rebuild();for(const h of this.textures)h._rebuild()})))}_topologicalSort(h){const V=new Map;for(const g of h)V.set(g.uniqueId,g);const i={dependsOn:new Map,dependedBy:new Map};for(const g of h){const h=g.uniqueId;i.dependsOn.set(h,new Set),i.dependedBy.set(h,new Set)}for(const g of h){const h=g.uniqueId,S=i.dependsOn.get(h);if(g instanceof v.e){const l=g.sourceMesh;V.has(l.uniqueId)&&(S.add(l.uniqueId),i.dependedBy.get(l.uniqueId).add(h))}const l=i.dependedBy.get(h);for(const Y of g.getDescendants()){const S=Y.uniqueId;if(V.has(S)){l.add(S);i.dependsOn.get(S).add(h)}}}const S=[],l=[];for(const g of h){const h=g.uniqueId;0===i.dependsOn.get(h).size&&(l.push(g),V.delete(h))}const Y=l;for(;Y.length>0;){const h=Y.shift();S.push(h);const l=i.dependedBy.get(h.uniqueId);for(const S of Array.from(l.values())){const l=i.dependsOn.get(S);l.delete(h.uniqueId),0===l.size&&V.get(S)&&(Y.push(V.get(S)),V.delete(S))}}return V.size>0&&(J.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),V.forEach((h=>{J.d.Error(h.name)}))),S}_addNodeAndDescendantsToList(h,V,i,S){if(i&&(!S||S(i))&&!V.has(i.uniqueId)){h.push(i),V.add(i.uniqueId);for(const l of i.getDescendants(!0))this._addNodeAndDescendantsToList(h,V,l,S)}}_isNodeInContainer(h){return h instanceof B.c&&-1!==this.meshes.indexOf(h)||(h instanceof q.e&&-1!==this.transformNodes.indexOf(h)||(h instanceof s.b&&-1!==this.lights.indexOf(h)||h instanceof t.b&&-1!==this.cameras.indexOf(h)))}_isValidHierarchy(){for(const h of this.meshes)if(h.parent&&!this._isNodeInContainer(h.parent))return J.d.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;for(const h of this.transformNodes)if(h.parent&&!this._isNodeInContainer(h.parent))return J.d.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;for(const h of this.lights)if(h.parent&&!this._isNodeInContainer(h.parent))return J.d.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;for(const h of this.cameras)if(h.parent&&!this._isNodeInContainer(h.parent))return J.d.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||l.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const S={},Y={},q=new c,B=[],J=[],I={doNotInstantiate:!0,...i},v=[],s=new Set;for(const l of this.transformNodes)null===l.parent&&this._addNodeAndDescendantsToList(v,s,l,I.predicate);for(const l of this.meshes)null===l.parent&&this._addNodeAndDescendantsToList(v,s,l,I.predicate);const t=this._topologicalSort(v),T=(i,l)=>{if(((V,i)=>{if(S[V.uniqueId]=i.uniqueId,Y[i.uniqueId]=i,h&&(i.name=h(V.name)),i instanceof g.e){const h=i;if(h.morphTargetManager){const i=V.morphTargetManager;h.morphTargetManager=i.clone();for(let V=0;V<i.numTargets;V++){const l=i.getTarget(V),g=h.morphTargetManager.getTarget(V);S[l.uniqueId]=g.uniqueId,Y[g.uniqueId]=g}}}})(i,l),i.parent){const h=S[i.parent.uniqueId],V=Y[h];l.parent=V||i.parent}if(l.position&&i.position&&l.position.l(i.position),l.rotationQuaternion&&i.rotationQuaternion&&l.rotationQuaternion.l(i.rotationQuaternion),l.rotation&&i.rotation&&l.rotation.l(i.rotation),l.Jq&&i.Jq&&l.Jq.l(i.Jq),l.material){const g=l;if(g.material)if(V){const V=i.material;if(-1===J.indexOf(V)){let i=V.clone(h?h(V.name):"Clone of "+V.name);if(J.push(V),S[V.uniqueId]=i.uniqueId,Y[i.uniqueId]=i,"MultiMaterial"===V.getClassName()){const l=V;for(const V of l.sq)V&&(i=V.clone(h?h(V.name):"Clone of "+V.name),J.push(V),S[V.uniqueId]=i.uniqueId,Y[i.uniqueId]=i);l.sq=l.sq.map((h=>h&&Y[S[h.uniqueId]]))}}"InstancedMesh"!==g.getClassName()&&(g.material=Y[S[V.uniqueId]])}else"MultiMaterial"===g.material.getClassName()?-1===this.fV.multiMaterials.indexOf(g.material)&&this.fV.addMultiMaterial(g.material):-1===this.fV.materials.indexOf(g.material)&&this.fV.addMaterial(g.material)}null===l.parent&&q.rootNodes.push(l)};for(const l of t)if("InstancedMesh"===l.getClassName()){const h=l,V=h.sourceMesh,i=S[V.uniqueId];T(h,("number"===typeof i?Y[i]:V).createInstance(h.name))}else{let h=!0;"MT"===l.getClassName()||"Node"===l.getClassName()||l.skeleton||!l.getTotalVertices||0===l.getTotalVertices()?h=!1:I.doNotInstantiate&&(h="function"===typeof I.doNotInstantiate?!I.doNotInstantiate(l):!I.doNotInstantiate);const V=h?l.createInstance(`instance of ${l.name}`):l.clone(`Clone of ${l.name}`,null,!0);if(!V)throw new Error(`Could not clone or instantiate node on Asset Container ${l.name}`);T(l,V)}for(const l of this.skeletons){if(I.predicate&&!I.predicate(l))continue;const V=l.clone(h?h(l.name):"Clone of "+l.name);for(const h of this.meshes)if(h.skeleton===l&&!h.isAnInstance){const i=Y[S[h.uniqueId]];if(!i||i.isAnInstance)continue;if(i.skeleton=V,-1!==B.indexOf(V))continue;B.push(V);for(const h of V.bones)h._linkedTransformNode&&(h._linkedTransformNode=Y[S[h._linkedTransformNode.uniqueId]])}q.skeletons.push(V)}for(const l of this.animationGroups){if(I.predicate&&!I.predicate(l))continue;const V=l.clone(h?h(l.name):"Clone of "+l.name,(h=>Y[S[h.uniqueId]]||h));q.animationGroups.push(V)}return q}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||l.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.fV.environmentTexture=this.environmentTexture);for(const h of this.fV._serializableComponents)h.addFromContainer(this);this.fV.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const V=[];for(const i of this.cameras)h&&!h(i)||(this.fV.addCamera(i),V.push(i));for(const i of this.lights)h&&!h(i)||(this.fV.addLight(i),V.push(i));for(const i of this.meshes)h&&!h(i)||(this.fV.wJ(i),V.push(i));for(const i of this.skeletons)h&&!h(i)||this.fV.addSkeleton(i);for(const i of this.animations)h&&!h(i)||this.fV.addAnimation(i);for(const i of this.animationGroups)h&&!h(i)||this.fV.addAnimationGroup(i);for(const i of this.multiMaterials)h&&!h(i)||this.fV.addMultiMaterial(i);for(const i of this.materials)h&&!h(i)||this.fV.addMaterial(i);for(const i of this.morphTargetManagers)h&&!h(i)||this.fV.addMorphTargetManager(i);for(const i of this.geometries)h&&!h(i)||this.fV.addGeometry(i);for(const i of this.transformNodes)h&&!h(i)||(this.fV.addTransformNode(i),V.push(i));for(const i of this.actionManagers)h&&!h(i)||this.fV.addActionManager(i);for(const i of this.textures)h&&!h(i)||this.fV.addTexture(i);for(const i of this.reflectionProbes)h&&!h(i)||this.fV.addReflectionProbe(i);for(const i of V)i.parent&&-1===this.fV.getNodes().indexOf(i.parent)&&(i.setParent?i.setParent(null):i.parent=null)}removeAllFromScene(){this._isValidHierarchy()||l.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.fV.environmentTexture&&(this.fV.environmentTexture=null);for(const h of this.fV._serializableComponents)h.removeFromContainer(this)}removeFromScene(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const V of this.cameras)h&&!h(V)||this.fV.removeCamera(V);for(const V of this.lights)h&&!h(V)||this.fV.removeLight(V);for(const V of this.meshes)h&&!h(V)||this.fV.GJ(V,!0);for(const V of this.skeletons)h&&!h(V)||this.fV.removeSkeleton(V);for(const V of this.animations)h&&!h(V)||this.fV.removeAnimation(V);for(const V of this.animationGroups)h&&!h(V)||this.fV.removeAnimationGroup(V);for(const V of this.multiMaterials)h&&!h(V)||this.fV.removeMultiMaterial(V);for(const V of this.materials)h&&!h(V)||this.fV.removeMaterial(V);for(const V of this.morphTargetManagers)h&&!h(V)||this.fV.removeMorphTargetManager(V);for(const V of this.geometries)h&&!h(V)||this.fV.removeGeometry(V);for(const V of this.transformNodes)h&&!h(V)||this.fV.removeTransformNode(V);for(const V of this.actionManagers)h&&!h(V)||this.fV.removeActionManager(V);for(const V of this.textures)h&&!h(V)||this.fV.removeTexture(V);for(const V of this.reflectionProbes)h&&!h(V)||this.fV.removeReflectionProbe(V)}dispose(){const h=this.cameras.slice(0);for(const t of h)t.dispose();this.cameras.length=0;const V=this.lights.slice(0);for(const t of V)t.dispose();this.lights.length=0;const i=this.meshes.slice(0);for(const t of i)t.dispose();this.meshes.length=0;const S=this.skeletons.slice(0);for(const t of S)t.dispose();this.skeletons.length=0;const l=this.animationGroups.slice(0);for(const t of l)t.dispose();this.animationGroups.length=0;const Y=this.multiMaterials.slice(0);for(const t of Y)t.dispose();this.multiMaterials.length=0;const g=this.materials.slice(0);for(const t of g)t.dispose();this.materials.length=0;const q=this.geometries.slice(0);for(const t of q)t.dispose();this.geometries.length=0;const B=this.transformNodes.slice(0);for(const t of B)t.dispose();this.transformNodes.length=0;const J=this.actionManagers.slice(0);for(const t of J)t.dispose();this.actionManagers.length=0;const I=this.textures.slice(0);for(const t of I)t.dispose();this.textures.length=0;const v=this.reflectionProbes.slice(0);for(const t of v)t.dispose();this.reflectionProbes.length=0;const s=this.morphTargetManagers.slice(0);for(const t of s)t.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const t of this.fV._serializableComponents)t.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.fV.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(h,V,i){if(h&&V)for(const S of h){let h=!0;if(i)for(const V of i)if(S===V){h=!1;break}h&&(V.push(S),S._parentContainer=this)}}moveAllFromScene(h){this._wasAddedToScene=!1,void 0===h&&(h=new n);for(const V in this)Object.prototype.hasOwnProperty.call(this,V)&&(this[V]=this[V]||("_environmentTexture"===V?null:[]),this._moveAssets(this.fV[V],this[V],h[V]));this.environmentTexture=this.fV.environmentTexture,this.removeAllFromScene()}createRootMesh(){const h=new g.e("assetContainerRootMesh",this.fV);for(const V of this.meshes)V.parent||h.addChild(V);return this.meshes.unshift(h),h}mergeAnimationsTo(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.d.LastCreatedScene,V=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!h)return J.d.Error("No scene available to merge animations to"),[];const S=i||(V=>{let i=null;const S=V.animations.length?V.animations[0].targetProperty:"",l=V.name.split(".").join("").split("_primitive")[0];switch(S){case"position":case"rotationQuaternion":i=h.getTransformNodeByName(V.name)||h.getTransformNodeByName(l);break;case"influence":i=h.getMorphTargetByName(V.name)||h.getMorphTargetByName(l);break;default:i=h.getNodeByName(V.name)||h.getNodeByName(l)}return i}),l=this.getNodes();for(const q of l){const h=S(q);if(null!==h){for(const V of q.animations){const i=h.animations.filter((h=>h.targetProperty===V.targetProperty));for(const V of i){const i=h.animations.indexOf(V,0);i>-1&&h.animations.splice(i,1)}}h.animations=h.animations.concat(q.animations)}}const Y=[],g=this.animationGroups.slice();for(const q of g){Y.push(q.clone(q.name,S));for(const h of q.animatables)h.stop()}for(const q of V){const V=S(q.target);V&&(h.beginAnimation(V,q.fromFrame,q.toFrame,q.loopAnimation,q.speedRatio,q.onAnimationEnd?q.onAnimationEnd:void 0,void 0,!0,void 0,q.onAnimationLoop?q.onAnimationLoop:void 0),h.stopAnimation(q.target))}return Y}populateRootNodes(){this.rootNodes.length=0;for(const h of this.meshes)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h);for(const h of this.transformNodes)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h);for(const h of this.lights)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h);for(const h of this.cameras)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h)}addAllAssetsToContainer(h){if(!h)return;const V=[],i=new Set;for(V.push(h);V.length>0;){const h=V.pop();if(h instanceof g.e?(h.bg&&-1===this.geometries.indexOf(h.bg)&&this.geometries.push(h.bg),this.meshes.push(h)):h instanceof v.e?this.meshes.push(h):h instanceof q.e?this.transformNodes.push(h):h instanceof s.b?this.lights.push(h):h instanceof t.b&&this.cameras.push(h),h instanceof B.c){if(h.material&&-1===this.materials.indexOf(h.material)){this.materials.push(h.material);for(const V of h.material.getActiveTextures())-1===this.textures.indexOf(V)&&this.textures.push(V)}h.skeleton&&-1===this.skeletons.indexOf(h.skeleton)&&this.skeletons.push(h.skeleton),h.morphTargetManager&&-1===this.morphTargetManagers.indexOf(h.morphTargetManager)&&this.morphTargetManagers.push(h.morphTargetManager)}for(const S of h.getChildren())i.has(S)||V.push(S);i.add(h)}this.populateRootNodes()}_getByTags(h,V,i){if(void 0===V)return h;const S=[];for(const l in h){const Y=h[l];T.b&&T.b.MatchesQuery(Y,V)&&(!i||i(Y))&&S.push(Y)}return S}getMeshesByTags(h,V){return this._getByTags(this.meshes,h,V)}getCamerasByTags(h,V){return this._getByTags(this.cameras,h,V)}getLightsByTags(h,V){return this._getByTags(this.lights,h,V)}getMaterialsByTags(h,V){return this._getByTags(this.materials,h,V).concat(this._getByTags(this.multiMaterials,h,V))}getTransformNodesByTags(h,V){return this._getByTags(this.transformNodes,h,V)}}var P=i(11009);class L{constructor(h){this.byteOffset=0,this.buffer=h}async loadAsync(h){const V=await this.buffer.readAsync(this.byteOffset,h);this._dataView=new DataView(V.buffer,V.byteOffset,V.byteLength),this._dataByteOffset=0}readUint32(){const h=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,h}readUint8Array(h){const V=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,h);return this._dataByteOffset+=h,this.byteOffset+=h,V}readString(h){return(0,P.e)(this.readUint8Array(h))}skipBytes(h){this._dataByteOffset+=h,this.byteOffset+=h}}var U=i(12735);const X="Z2xURg",D={name:"fg",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:h=>-1!==h.indexOf("asset")&&-1!==h.indexOf("version")||h.startsWith("data:base64,"+X)||h.startsWith("data:;base64,"+X)||h.startsWith("data:application/octet-stream;base64,"+X)||h.startsWith("data:model/gltf-binary;base64,"+X)};var O,o,M,F=i(10993),E=i(11002);function H(h,V,i){try{return Promise.resolve(new Uint8Array(h,V,i))}catch(S){return Promise.reject(S)}}!function(h){h[h.AUTO=0]="AUTO",h[h.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(O||(O={})),function(h){h[h.NONE=0]="NONE",h[h.FIRST=1]="FIRST",h[h.ALL=2]="ALL"}(o||(o={})),function(h){h[h.LOADING=0]="LOADING",h[h.READY=1]="READY",h[h.COMPLETE=2]="COMPLETE"}(M||(M={}));class j{constructor(){this.coordinateSystemMode=O.AUTO,this.animationStartMode=o.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=h=>Promise.resolve(h),this.extensionOptions={}}l(h){h&&(this.onParsed=h.onParsed,this.coordinateSystemMode=h.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=h.animationStartMode??this.animationStartMode,this.loadNodeAnimations=h.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=h.loadSkins??this.loadSkins,this.loadMorphTargets=h.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=h.compileMaterials??this.compileMaterials,this.useClipPlane=h.useClipPlane??this.useClipPlane,this.compileShadowGenerators=h.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=h.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=h.useRangeRequests??this.useRangeRequests,this.createInstances=h.createInstances??this.createInstances,this.alwaysComputeBoundingBox=h.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=h.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=h.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=h.skipMaterials??this.skipMaterials,this.useSRGBBuffers=h.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=h.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=h.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=h.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=h.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=h.customRootNode,this.onMeshLoaded=h.onMeshLoaded,this.onSkinLoaded=h.onSkinLoaded,this.onTextureLoaded=h.onTextureLoaded,this.onMaterialLoaded=h.onMaterialLoaded,this.onCameraLoaded=h.onCameraLoaded,this.extensionOptions=h.extensionOptions??this.extensionOptions)}}class m extends j{constructor(h){super(),this.onParsedObservable=new S.d,this.onMeshLoadedObservable=new S.d,this.onSkinLoadedObservable=new S.d,this.onTextureLoadedObservable=new S.d,this.onMaterialLoadedObservable=new S.d,this.onCameraLoadedObservable=new S.d,this.onCompleteObservable=new S.d,this.onErrorObservable=new S.d,this.Ig=new S.d,this.onExtensionLoadedObservable=new S.d,this.validate=!1,this.onValidatedObservable=new S.d,this._loader=null,this._state=null,this._requests=new Array,this.name=D.name,this.extensions=D.extensions,this.onLoaderStateChangedObservable=new S.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.l(h)}set onParsed(h){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),h&&(this._onParsedObserver=this.onParsedObservable.add(h))}set onMeshLoaded(h){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),h&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(h))}set onSkinLoaded(h){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),h&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((V=>h(V.node,V.skinnedNode))))}set onTextureLoaded(h){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),h&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(h))}set onMaterialLoaded(h){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),h&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(h))}set onCameraLoaded(h){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),h&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(h))}set onComplete(h){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(h)}set onError(h){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(h)}set onDispose(h){this._onDisposeObserver&&this.Ig.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ig.add(h)}set onExtensionLoaded(h){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(h)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(h){this._loggingEnabled!==h&&(this._loggingEnabled=h,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(h){this._capturePerformanceCounters!==h&&(this._capturePerformanceCounters=h,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(h){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(h)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const h of this._requests)h.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=h=>Promise.resolve(h),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Ig.notifyObservers(void 0),this.Ig.clear()}loadFile(h,V,i,Y,g,q,B,I){if(ArrayBuffer.isView(V))return this._loadBinary(h,V,i,Y,B,I),null;this._progressCallback=g;const v=V.name||l.Tools.GetFilename(V);if(q){if(this.useRangeRequests){this.validate&&J.d.Warn("glTF validation is not supported when range requests are enabled");const i={abort:()=>{},onCompleteObservable:new S.d},l={readAsync:(i,S)=>new Promise(((l,Y)=>{this._loadFile(h,V,(h=>{l(new Uint8Array(h))}),!0,(h=>{Y(h)}),(h=>{h.setRequestHeader("Range",`bytes=${i}-${i+S-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new L(l)).then((h=>{i.onCompleteObservable.notifyObservers(i),Y(h)}),B?h=>B(void 0,h):void 0),i}return this._loadFile(h,V,(V=>{this._validate(h,new Uint8Array(V,0,V.byteLength),i,v),this._unpackBinaryAsync(new L({readAsync:(h,i)=>H(V,h,i),byteLength:V.byteLength})).then((h=>{Y(h)}),B?h=>B(void 0,h):void 0)}),!0,B)}return this._loadFile(h,V,(V=>{try{this._validate(h,V,i,v),Y({json:this._parseJson(V)})}catch{B&&B()}}),!1,B)}_loadBinary(h,V,i,S,l,Y){this._validate(h,new Uint8Array(V.buffer,V.byteOffset,V.byteLength),i,Y),this._unpackBinaryAsync(new L({readAsync:(h,i)=>function(h,V,i){try{if(V<0||V>=h.byteLength)throw new RangeError("Offset is out of range.");if(V+i>h.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(h.buffer,h.byteOffset+V,i))}catch(S){return Promise.reject(S)}}(V,h,i),byteLength:V.byteLength})).then((h=>{S(h)}),l?h=>l(void 0,h):void 0)}importMeshAsync(h,V,i,S,l,Y){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(i),this.onParsedObservable.clear(),this._log(`Loading ${Y||""}`),this._loader=this._getLoader(i),this._loader.importMeshAsync(h,V,null,i,S,l,Y))))}loadAsync(h,V,i,S,l){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(V),this.onParsedObservable.clear(),this._log(`Loading ${l||""}`),this._loader=this._getLoader(V),this._loader.loadAsync(h,V,i,S,l))))}loadAssetContainerAsync(h,V,i,S,l){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(V),this.onParsedObservable.clear(),this._log(`Loading ${l||""}`),this._loader=this._getLoader(V);const Y=new f(h),g=[];this.onMaterialLoadedObservable.add((h=>{g.push(h)}));const q=[];this.onTextureLoadedObservable.add((h=>{q.push(h)}));const B=[];this.onCameraLoadedObservable.add((h=>{B.push(h)}));const J=[];return this.onMeshLoadedObservable.add((h=>{h.morphTargetManager&&J.push(h.morphTargetManager)})),this._loader.importMeshAsync(null,h,Y,V,i,S,l).then((h=>(Array.prototype.push.apply(Y.geometries,h.geometries),Array.prototype.push.apply(Y.meshes,h.meshes),Array.prototype.push.apply(Y.Fv,h.Fv),Array.prototype.push.apply(Y.skeletons,h.skeletons),Array.prototype.push.apply(Y.animationGroups,h.animationGroups),Array.prototype.push.apply(Y.materials,g),Array.prototype.push.apply(Y.textures,q),Array.prototype.push.apply(Y.lights,h.lights),Array.prototype.push.apply(Y.transformNodes,h.transformNodes),Array.prototype.push.apply(Y.cameras,B),Array.prototype.push.apply(Y.morphTargetManagers,J),Y)))}))}canDirectLoad(h){return D.canDirectLoad(h)}directLoad(h,V){if(V.startsWith("base64,"+X)||V.startsWith(";base64,"+X)||V.startsWith("application/octet-stream;base64,"+X)||V.startsWith("model/gltf-binary;base64,"+X)){const i=(0,F.c)(V);return this._validate(h,new Uint8Array(i,0,i.byteLength)),this._unpackBinaryAsync(new L({readAsync:(h,V)=>H(i,h,V),byteLength:i.byteLength}))}return this._validate(h,V),Promise.resolve({json:this._parseJson(V)})}createPlugin(h){return new m(h[D.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((h,V)=>{this.onCompleteObservable.addOnce((()=>{h()})),this.onErrorObservable.addOnce((h=>{V(h)}))}))}_setState(h){this._state!==h&&(this._state=h,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(M[this._state]))}_loadFile(h,V,i,S,l,Y){const g=h._loadFile(V,i,(h=>{this._onProgress(h,g)}),!0,S,l,Y);return g.onCompleteObservable.add((()=>{g._lengthComputable=!0,g._total=g._loaded})),this._requests.push(g),g}_onProgress(h,V){if(!this._progressCallback)return;V._lengthComputable=h.lengthComputable,V._loaded=h.loaded,V._total=h.total;let i=!0,S=0,l=0;for(const Y of this._requests){if(void 0===Y._lengthComputable||void 0===Y._loaded||void 0===Y._total)return;i=i&&Y._lengthComputable,S+=Y._loaded,l+=Y._total}this._progressCallback({lengthComputable:i,loaded:S,total:i?l:0})}_validate(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),U.c.ValidateAsync(V,i,S,(V=>this.preprocessUrlAsync(i+V).then((V=>h._loadFileAsync(V,void 0,!0,!0).then((h=>new Uint8Array(h,0,h.byteLength))))))).then((h=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(h),this.onValidatedObservable.clear()}),(h=>{this._endPerformanceCounter("Validate JSON"),l.Tools.Warn(`Failed to validate: ${h.message}`),this.onValidatedObservable.clear()})))}_getLoader(h){const V=h.json.asset||{};this._log(`Asset version: ${V.version}`),V.minVersion&&this._log(`Asset minimum version: ${V.minVersion}`),V.generator&&this._log(`Asset generator: ${V.generator}`);const i=m._parseVersion(V.version);if(!i)throw new Error("Invalid version: "+V.version);if(void 0!==V.minVersion){const h=m._parseVersion(V.minVersion);if(!h)throw new Error("Invalid minimum version: "+V.minVersion);if(m._compareVersion(h,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+V.minVersion)}const S={1:m._CreateGLTF1Loader,2:m._CreateGLTF2Loader}[i.major];if(!S)throw new Error("Unsupported version: "+V.version);return S(this)}_parseJson(h){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${h.length}`);const V=JSON.parse(h);return this._endPerformanceCounter("Parse JSON"),V}_unpackBinaryAsync(h){return this._startPerformanceCounter("Unpack Binary"),h.loadAsync(20).then((()=>{const V=h.readUint32();if(1179937895!==V)throw new E.l("Unexpected magic: "+V,E.i.GLTFLoaderUnexpectedMagicError);const i=h.readUint32();this.loggingEnabled&&this._log(`Binary version: ${i}`);const S=h.readUint32();let l;switch(this.useRangeRequests||S===h.buffer.byteLength||J.d.Warn(`Length in header does not match actual data length: ${S} != ${h.buffer.byteLength}`),i){case 1:l=this._unpackBinaryV1Async(h,S);break;case 2:l=this._unpackBinaryV2Async(h,S);break;default:throw new Error("Unsupported version: "+i)}return this._endPerformanceCounter("Unpack Binary"),l}))}_unpackBinaryV1Async(h,V){const i=h.readUint32(),S=h.readUint32();if(0!==S)throw new Error(`Unexpected content format: ${S}`);const l=V-h.byteOffset,Y={json:this._parseJson(h.readString(i)),bin:null};if(0!==l){const V=h.byteOffset;Y.bin={readAsync:(i,S)=>h.buffer.readAsync(V+i,S),byteLength:l}}return Promise.resolve(Y)}_unpackBinaryV2Async(h,V){const i=1313821514,S=5130562,l=h.readUint32();if(h.readUint32()!==i)throw new Error("First chunk format is not JSON");return h.byteOffset+l===V?h.loadAsync(l).then((()=>({json:this._parseJson(h.readString(l)),bin:null}))):h.loadAsync(l+8).then((()=>{const Y={json:this._parseJson(h.readString(l)),bin:null},g=()=>{const l=h.readUint32();switch(h.readUint32()){case i:throw new Error("Unexpected JSON chunk");case S:{const V=h.byteOffset;Y.bin={readAsync:(i,S)=>h.buffer.readAsync(V+i,S),byteLength:l},h.skipBytes(l);break}default:h.skipBytes(l)}return h.byteOffset!==V?h.loadAsync(8).then(g):Promise.resolve(Y)};return g()}))}static _parseVersion(h){if("1.0"===h||"1.0.1"===h)return{major:1,minor:0};const V=(h+"").match(/^(\d+)\.(\d+)/);return V?{major:parseInt(V[1]),minor:parseInt(V[2])}:null}static _compareVersion(h,V){return h.major>V.major?1:h.major<V.major?-1:h.minor>V.minor?1:h.minor<V.minor?-1:0}_logOpen(h){this._log(h),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(h){const V=m._logSpaces.substring(0,2*this._logIndentLevel);J.d.Log(`${V}${h}`)}_logDisabled(h){}_startPerformanceCounterEnabled(h){l.Tools.StartPerformanceCounter(h)}_startPerformanceCounterDisabled(h){}_endPerformanceCounterEnabled(h){l.Tools.EndPerformanceCounter(h)}_endPerformanceCounterDisabled(h){}}m.IncrementalLoading=!0,m.HomogeneousCoordinates=!1,m._logSpaces="                                ",(0,Y.d)(new m)},12735:(h,V,i)=>{"use strict";i.d(V,{c:()=>g});var S=i(10952);function l(h,V,i,S){const l={externalResourceFunction:S};return i&&(l.uri="file:"===V?i:V+i),ArrayBuffer.isView(h)?GLTFValidator.validateBytes(h,l):GLTFValidator.validateString(h,l)}function Y(){const h=[];onmessage=V=>{const i=V.data;switch(i.id){case"init":importScripts(i.url);break;case"validate":l(i.data,i.rootUrl,i.fileName,(V=>new Promise(((i,S)=>{const l=h.length;h.push({resolve:i,reject:S}),postMessage({id:"getExternalResource",index:l,uri:V})})))).then((h=>{postMessage({id:"validate.resolve",value:h})}),(h=>{postMessage({id:"validate.reject",reason:h})}));break;case"getExternalResource.resolve":h[i.index].resolve(i.value);break;case"getExternalResource.reject":h[i.index].reject(i.reason)}}}class g{static ValidateAsync(h,V,i,g){return"function"===typeof Worker?new Promise(((q,B)=>{const J=`${l}(${Y})()`,I=URL.createObjectURL(new Blob([J],{type:"application/javascript"})),v=new Worker(I),s=h=>{v.removeEventListener("error",s),v.removeEventListener("message",t),B(h)},t=h=>{const V=h.data;switch(V.id){case"getExternalResource":g(V.uri).then((h=>{v.postMessage({id:"getExternalResource.resolve",index:V.index,value:h},[h.buffer])}),(h=>{v.postMessage({id:"getExternalResource.reject",index:V.index,reason:h})}));break;case"validate.resolve":v.removeEventListener("error",s),v.removeEventListener("message",t),q(V.value),v.terminate();break;case"validate.reject":v.removeEventListener("error",s),v.removeEventListener("message",t),B(V.reason),v.terminate()}};if(v.addEventListener("error",s),v.addEventListener("message",t),v.postMessage({id:"init",url:S.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(h)){const S=h.slice();v.postMessage({id:"validate",data:S,rootUrl:V,fileName:i},[S.buffer])}else v.postMessage({id:"validate",data:h,rootUrl:V,fileName:i})})):(this._LoadScriptPromise||(this._LoadScriptPromise=S.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>l(h,V,i,g))))}}g.Configuration={url:`${S.Tools._DefaultCdnUrl}/gltf_validator.js`}},13285:(h,V,i)=>{"use strict";i.d(V,{d:()=>D});var S=i(11123),l=i(11127),Y=i(11179),g=i(11138),q=i(11520),B=i(11453),J=i(11220),I=i(11382),v=i(11091),s=i(11042);i(12503),i(12417),i(12431),i(12425),i(12434),i(12440),i(12442);const t="imageProcessingCompatibility",T="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";s.d.IncludesShadersStore[t]||(s.d.IncludesShadersStore[t]=T);const e="skyPixelShader",n="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";s.d.ShadersStore[e]||(s.d.ShadersStore[e]=n);i(12512),i(12446),i(12452),i(12461),i(12455);const c="skyVertexShader",f="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";s.d.ShadersStore[c]||(s.d.ShadersStore[c]=f);var P=i(11450),L=i(11504),U=i(11501);class X extends q.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class D extends B.d{constructor(h,V){super(h,V),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new g.nV(0,100,0),this.useSunPosition=!1,this.cameraOffset=g.nV.Zero(),this.up=g.nV.Up(),this.dithering=!1,this._cameraPosition=g.nV.Zero(),this._skyOrientation=new g.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(h,V){const i=V._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;V.materialDefines||(V.materialDefines=new X);const S=V.materialDefines,l=this.Mh();if(this._isReadyForSubMesh(V))return!0;if((0,U.P)(h,l,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,S),(0,U.E)(h,S,!0,!1),S.IMAGEPROCESSINGPOSTPROCESS!==l.imageProcessingConfiguration.applyByPostProcess&&S.markAsMiscDirty(),S.DITHER!==this.dithering&&S.markAsMiscDirty(),S.isDirty){S.markAsProcessed(),l.resetCachedMaterial();const h=new P.d;S.FOG&&h.addFallback(1,"FOG"),S.IMAGEPROCESSINGPOSTPROCESS=l.imageProcessingConfiguration.applyByPostProcess,S.DITHER=this.dithering;const i=[J.h.PositionKind];S.VERTEXCOLOR&&i.push(J.h.ColorKind);const Y="sky",g=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,L.d)(g);const q=S.toString();V.setEffect(l.getEngine().createEffect(Y,i,g,[],q,h,this.onCompiled,this.onError),S,this._materialContext)}return!(!V.effect||!V.effect.isReady())&&(S._renderId=l.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(h,V,i){const S=this.Mh(),l=i.materialDefines;if(!l)return;const Y=i.effect;if(!Y)return;this._activeEffect=Y,this.bindOnlyWorldMatrix(h),this._activeEffect.setMatrix("viewProjection",S.getTransformMatrix()),this._mustRebind(S,Y,i)&&((0,L.g)(Y,this,S),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,U.j)(l,Y,S)),S.fogEnabled&&V.applyFog&&S.fogMode!==I.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",S.getViewMatrix()),(0,U.e)(S,V,this._activeEffect);const q=S.activeCamera;if(q){const h=q.getWorldMatrix();this._cameraPosition.x=h.m[12],this._cameraPosition.y=h.m[13],this._cameraPosition.z=h.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const h=Math.PI*(this.inclination-.5),V=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(V)*Math.cos(h),this.sunPosition.y=this.distance*Math.sin(-h),this.sunPosition.z=this.distance*Math.sin(V)*Math.cos(h),g.Quaternion.FromUnitVectorsToRef(g.nV.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(V,this._activeEffect,i)}getAnimatables(){return[]}dispose(h){super.dispose(h)}clone(h){return Y.d.Clone((()=>new D(h,this.Mh())),this)}serialize(){const h=super.serialize();return h.customType="BABYLON.SkyMaterial",h}getClassName(){return"SkyMaterial"}static Parse(h,V,i){return Y.d.Parse((()=>new D(h.name,V)),h,V,i)}}(0,S.b)([(0,l.E)()],D.prototype,"luminance",void 0),(0,S.b)([(0,l.E)()],D.prototype,"turbidity",void 0),(0,S.b)([(0,l.E)()],D.prototype,"rayleigh",void 0),(0,S.b)([(0,l.E)()],D.prototype,"mieCoefficient",void 0),(0,S.b)([(0,l.E)()],D.prototype,"mieDirectionalG",void 0),(0,S.b)([(0,l.E)()],D.prototype,"distance",void 0),(0,S.b)([(0,l.E)()],D.prototype,"inclination",void 0),(0,S.b)([(0,l.E)()],D.prototype,"azimuth",void 0),(0,S.b)([(0,l.A)()],D.prototype,"sunPosition",void 0),(0,S.b)([(0,l.E)()],D.prototype,"useSunPosition",void 0),(0,S.b)([(0,l.A)()],D.prototype,"cameraOffset",void 0),(0,S.b)([(0,l.A)()],D.prototype,"up",void 0),(0,S.b)([(0,l.E)()],D.prototype,"dithering",void 0),(0,v.f)("BABYLON.SkyMaterial",D)},11764:(h,V,i)=>{"use strict";function S(h,V){V.headers=h.headers||{},V.statusMessage=h.statusText,V.statusCode=h.status,V.data=h.response}function l(h,V,i){return new Promise((function(l,Y){i=i||{};var g,q,B,J=new XMLHttpRequest,I=i.body,v=i.headers||{};for(g in i.timeout&&(J.timeout=i.timeout),J.ontimeout=J.onerror=function(h){h.timeout="timeout"==h.type,Y(h)},J.open(h,V.href||V),J.onload=function(){for(B=J.getAllResponseHeaders().trim().split(/[\r\n]+/),S(J,J);q=B.shift();)q=q.split(": "),J.headers[q.shift().toLowerCase()]=q.join(": ");if((q=J.headers["content-type"])&&~q.indexOf("application/json"))try{J.data=JSON.parse(J.data,i.reviver)}catch(h){return S(J,h),Y(h)}(J.status>=400?Y:l)(J)},typeof FormData<"u"&&I instanceof FormData||I&&"object"==typeof I&&(v["content-type"]="application/json",I=JSON.stringify(I)),J.withCredentials=!!i.withCredentials,v)J.setRequestHeader(g,v[g]);J.send(I)}))}i.r(V),i.d(V,{del:()=>B,get:()=>Y,patch:()=>q,post:()=>g,put:()=>J,send:()=>l});var Y=l.bind(l,"GET"),g=l.bind(l,"POST"),q=l.bind(l,"PATCH"),B=l.bind(l,"DELETE"),J=l.bind(l,"PUT")},13391:(h,V,i)=>{"use strict";i.d(V,{e:()=>v});const S=.5*(Math.sqrt(3)-1),l=(3-Math.sqrt(3))/6,Y=1/3,g=1/6,q=(Math.sqrt(5)-1)/4,B=(5-Math.sqrt(5))/20,J=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),I=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const v=class{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const V="function"==typeof h?h:function(h){let V=0,i=0,S=0,l=1;const Y=function(){let h=4022871197;return function(V){V=V.toString();for(let i=0;i<V.length;i++){h+=V.charCodeAt(i);let S=.02519603282416938*h;h=S>>>0,S-=h,S*=h,h=S>>>0,S-=h,h+=4294967296*S}return 2.3283064365386963e-10*(h>>>0)}}();V=Y(" "),i=Y(" "),S=Y(" "),V-=Y(h),V<0&&(V+=1);i-=Y(h),i<0&&(i+=1);S-=Y(h),S<0&&(S+=1);return function(){const h=2091639*V+2.3283064365386963e-10*l;return V=i,i=S,S=h-(l=0|h)}}(h);this.p=function(h){const V=new Uint8Array(256);for(let i=0;i<256;i++)V[i]=i;for(let i=0;i<255;i++){const S=i+~~(h()*(256-i)),l=V[i];V[i]=V[S],V[S]=l}return V}(V),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let i=0;i<512;i++)this.perm[i]=this.p[255&i],this.permMod12[i]=this.perm[i]%12}noise2D(h,V){const i=this.permMod12,Y=this.perm;let g=0,q=0,B=0;const I=(h+V)*S,v=Math.floor(h+I),s=Math.floor(V+I),t=(v+s)*l,T=h-(v-t),e=V-(s-t);let n,c;T>e?(n=1,c=0):(n=0,c=1);const f=T-n+l,P=e-c+l,L=T-1+2*l,U=e-1+2*l,X=255&v,D=255&s;let O=.5-T*T-e*e;if(O>=0){const h=3*i[X+Y[D]];O*=O,g=O*O*(J[h]*T+J[h+1]*e)}let o=.5-f*f-P*P;if(o>=0){const h=3*i[X+n+Y[D+c]];o*=o,q=o*o*(J[h]*f+J[h+1]*P)}let M=.5-L*L-U*U;if(M>=0){const h=3*i[X+1+Y[D+1]];M*=M,B=M*M*(J[h]*L+J[h+1]*U)}return 70*(g+q+B)}noise3D(h,V,i){const S=this.permMod12,l=this.perm;let q,B,I,v;const s=(h+V+i)*Y,t=Math.floor(h+s),T=Math.floor(V+s),e=Math.floor(i+s),n=(t+T+e)*g,c=h-(t-n),f=V-(T-n),P=i-(e-n);let L,U,X,D,O,o;c>=f?f>=P?(L=1,U=0,X=0,D=1,O=1,o=0):c>=P?(L=1,U=0,X=0,D=1,O=0,o=1):(L=0,U=0,X=1,D=1,O=0,o=1):f<P?(L=0,U=0,X=1,D=0,O=1,o=1):c<P?(L=0,U=1,X=0,D=0,O=1,o=1):(L=0,U=1,X=0,D=1,O=1,o=0);const M=c-L+g,F=f-U+g,E=P-X+g,H=c-D+2*g,j=f-O+2*g,m=P-o+2*g,G=c-1+.5,w=f-1+.5,N=P-1+.5,r=255&t,k=255&T,R=255&e;let Z=.6-c*c-f*f-P*P;if(Z<0)q=0;else{const h=3*S[r+l[k+l[R]]];Z*=Z,q=Z*Z*(J[h]*c+J[h+1]*f+J[h+2]*P)}let z=.6-M*M-F*F-E*E;if(z<0)B=0;else{const h=3*S[r+L+l[k+U+l[R+X]]];z*=z,B=z*z*(J[h]*M+J[h+1]*F+J[h+2]*E)}let d=.6-H*H-j*j-m*m;if(d<0)I=0;else{const h=3*S[r+D+l[k+O+l[R+o]]];d*=d,I=d*d*(J[h]*H+J[h+1]*j+J[h+2]*m)}let x=.6-G*G-w*w-N*N;if(x<0)v=0;else{const h=3*S[r+1+l[k+1+l[R+1]]];x*=x,v=x*x*(J[h]*G+J[h+1]*w+J[h+2]*N)}return 32*(q+B+I+v)}noise4D(h,V,i,S){const l=this.perm;let Y,g,J,v,s;const t=(h+V+i+S)*q,T=Math.floor(h+t),e=Math.floor(V+t),n=Math.floor(i+t),c=Math.floor(S+t),f=(T+e+n+c)*B,P=h-(T-f),L=V-(e-f),U=i-(n-f),X=S-(c-f);let D=0,O=0,o=0,M=0;P>L?D++:O++,P>U?D++:o++,P>X?D++:M++,L>U?O++:o++,L>X?O++:M++,U>X?o++:M++;const F=D>=3?1:0,E=O>=3?1:0,H=o>=3?1:0,j=M>=3?1:0,m=D>=2?1:0,G=O>=2?1:0,w=o>=2?1:0,N=M>=2?1:0,r=D>=1?1:0,k=O>=1?1:0,R=o>=1?1:0,Z=M>=1?1:0,z=P-F+B,d=L-E+B,x=U-H+B,y=X-j+B,Q=P-m+2*B,A=L-G+2*B,b=U-w+2*B,C=X-N+2*B,u=P-r+3*B,p=L-k+3*B,W=U-R+3*B,a=X-Z+3*B,K=P-1+4*B,hh=L-1+4*B,Vh=U-1+4*B,ih=X-1+4*B,Sh=255&T,lh=255&e,Yh=255&n,gh=255&c;let qh=.6-P*P-L*L-U*U-X*X;if(qh<0)Y=0;else{const h=l[Sh+l[lh+l[Yh+l[gh]]]]%32*4;qh*=qh,Y=qh*qh*(I[h]*P+I[h+1]*L+I[h+2]*U+I[h+3]*X)}let Bh=.6-z*z-d*d-x*x-y*y;if(Bh<0)g=0;else{const h=l[Sh+F+l[lh+E+l[Yh+H+l[gh+j]]]]%32*4;Bh*=Bh,g=Bh*Bh*(I[h]*z+I[h+1]*d+I[h+2]*x+I[h+3]*y)}let Jh=.6-Q*Q-A*A-b*b-C*C;if(Jh<0)J=0;else{const h=l[Sh+m+l[lh+G+l[Yh+w+l[gh+N]]]]%32*4;Jh*=Jh,J=Jh*Jh*(I[h]*Q+I[h+1]*A+I[h+2]*b+I[h+3]*C)}let Ih=.6-u*u-p*p-W*W-a*a;if(Ih<0)v=0;else{const h=l[Sh+r+l[lh+k+l[Yh+R+l[gh+Z]]]]%32*4;Ih*=Ih,v=Ih*Ih*(I[h]*u+I[h+1]*p+I[h+2]*W+I[h+3]*a)}let vh=.6-K*K-hh*hh-Vh*Vh-ih*ih;if(vh<0)s=0;else{const h=l[Sh+1+l[lh+1+l[Yh+1+l[gh+1]]]]%32*4;vh*=vh,s=vh*vh*(I[h]*K+I[h+1]*hh+I[h+2]*Vh+I[h+3]*ih)}return 27*(Y+g+J+v+s)}}}}]);