/*! For license information please see jpdc5.32.3a3e08ce.chunk.js.LICENSE.txt */
(self.xeuzlpp225k=self.xeuzlpp225k||[]).push([[32],{13335:(k,Q,i)=>{"use strict";var Z=i(13344),U=i(13352),C=i(13361);i.g.__TYPEDARRAY_POOL||(i.g.__TYPEDARRAY_POOL={UINT8:U([32,0]),UINT16:U([32,0]),UINT32:U([32,0]),INT8:U([32,0]),INT16:U([32,0]),INT32:U([32,0]),FLOAT:U([32,0]),DOUBLE:U([32,0]),DATA:U([32,0]),UINT8C:U([32,0]),BUFFER:U([32,0])});var B="undefined"!==typeof Uint8ClampedArray,o=i.g.__TYPEDARRAY_POOL;o.UINT8C||(o.UINT8C=U([32,0])),o.BUFFER||(o.BUFFER=U([32,0]));var m=o.DATA,O=o.BUFFER;function J(k){if(k){var Q=k.length||k.byteLength,i=Z.log2(Q);m[i].push(k)}}function G(k){k=Z.nextPow2(k);var Q=Z.log2(k),i=m[Q];return i.length>0?i.pop():new ArrayBuffer(k)}function H(k){return new Uint8Array(G(k),0,k)}function e(k){return new Uint16Array(G(2*k),0,k)}function F(k){return new Uint32Array(G(4*k),0,k)}function z(k){return new Int8Array(G(k),0,k)}function E(k){return new Int16Array(G(2*k),0,k)}function l(k){return new Int32Array(G(4*k),0,k)}function h(k){return new Float32Array(G(4*k),0,k)}function c(k){return new Float64Array(G(8*k),0,k)}function f(k){return B?new Uint8ClampedArray(G(k),0,k):H(k)}function Y(k){return new DataView(G(k),0,k)}Q.free=function(k){if(C(k))O[Z.log2(k.length)].push(k);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(k)&&(k=k.buffer),!k)return;var Q=k.length||k.byteLength,i=0|Z.log2(Q);m[i].push(k)}},Q.freeUint8=Q.freeUint16=Q.freeUint32=Q.freeInt8=Q.freeInt16=Q.freeInt32=Q.freeFloat32=Q.freeFloat=Q.freeFloat64=Q.freeDouble=Q.freeUint8Clamped=Q.freeDataView=function(k){J(k.buffer)},Q.freeArrayBuffer=J,Q.freeBuffer=function(k){O[Z.log2(k.length)].push(k)},Q.malloc=function(k,Q){if(void 0===Q||"arraybuffer"===Q)return G(k);switch(Q){case"uint8":return H(k);case"uint16":return e(k);case"uint32":return F(k);case"int8":return z(k);case"int16":return E(k);case"int32":return l(k);case"float":case"float32":return h(k);case"double":case"float64":return c(k);case"uint8_clamped":return f(k);case"buffer":throw"Buffer not supported";case"data":case"dataview":return Y(k);default:return null}return null},Q.mallocArrayBuffer=G,Q.mallocUint8=H,Q.mallocUint16=e,Q.mallocUint32=F,Q.mallocInt8=z,Q.mallocInt16=E,Q.mallocInt32=l,Q.mallocFloat32=Q.mallocFloat=h,Q.mallocFloat64=Q.mallocDouble=c,Q.mallocUint8Clamped=f,Q.mallocDataView=Y,Q.clearCache=function(){for(var k=0;k<32;++k)o.UINT8[k].length=0,o.UINT16[k].length=0,o.UINT32[k].length=0,o.INT8[k].length=0,o.INT16[k].length=0,o.INT32[k].length=0,o.FLOAT[k].length=0,o.DOUBLE[k].length=0,o.UINT8C[k].length=0,m[k].length=0,O[k].length=0}},13429:(k,Q,i)=>{k.exports=U;var Z=i(12134);function U(k,Q){if(!(this instanceof U))return new U(k,Q);var i=Z.create();Z.add(i,k,Q),this.base=Z.min(Z.create(),k,i),this.qO=Z.clone(Q),this.max=Z.max(Z.create(),k,i),this.mag=Z.length(this.qO)}var C=U.prototype;C.width=function(){return this.qO[0]},C.height=function(){return this.qO[1]},C.depth=function(){return this.qO[2]},C.x0=function(){return this.base[0]},C.y0=function(){return this.base[1]},C.z0=function(){return this.base[2]},C.x1=function(){return this.max[0]},C.y1=function(){return this.max[1]},C.z1=function(){return this.max[2]},C.translate=function(k){return Z.add(this.max,this.max,k),Z.add(this.base,this.base,k),this},C.setPosition=function(k){return Z.add(this.max,k,this.qO),Z.j(this.base,k),this},C.expand=function(k){var Q=Z.create(),i=Z.create();return Z.max(Q,k.max,this.max),Z.min(i,k.base,this.base),Z.EQ(Q,Q,i),new U(i,Q)},C.intersects=function(k){return!(k.base[0]>this.max[0])&&(!(k.base[1]>this.max[1])&&(!(k.base[2]>this.max[2])&&(!(k.max[0]<this.base[0])&&(!(k.max[1]<this.base[1])&&!(k.max[2]<this.base[2])))))},C.touches=function(k){var Q=this.union(k);return null!==Q&&(0==Q.width()||0==Q.height()||0==Q.depth())},C.union=function(k){if(!this.intersects(k))return null;var Q=Math.max(k.base[0],this.base[0]),i=Math.max(k.base[1],this.base[1]),Z=Math.max(k.base[2],this.base[2]);return new U([Q,i,Z],[Math.min(k.max[0],this.max[0])-Q,Math.min(k.max[1],this.max[1])-i,Math.min(k.max[2],this.max[2])-Z])}},13344:(k,Q)=>{"use strict";function i(k){var Q=32;return(k&=-k)&&Q--,65535&k&&(Q-=16),16711935&k&&(Q-=8),252645135&k&&(Q-=4),858993459&k&&(Q-=2),1431655765&k&&(Q-=1),Q}Q.INT_BITS=32,Q.INT_MAX=2147483647,Q.INT_MIN=-1<<31,Q.sign=function(k){return(k>0)-(k<0)},Q.abs=function(k){var Q=k>>31;return(k^Q)-Q},Q.min=function(k,Q){return Q^(k^Q)&-(k<Q)},Q.max=function(k,Q){return k^(k^Q)&-(k<Q)},Q.isPow2=function(k){return!(k&k-1)&&!!k},Q.log2=function(k){var Q,i;return Q=(k>65535)<<4,Q|=i=((k>>>=Q)>255)<<3,Q|=i=((k>>>=i)>15)<<2,(Q|=i=((k>>>=i)>3)<<1)|(k>>>=i)>>1},Q.log10=function(k){return k>=1e9?9:k>=1e8?8:k>=1e7?7:k>=1e6?6:k>=1e5?5:k>=1e4?4:k>=1e3?3:k>=100?2:k>=10?1:0},Q.popCount=function(k){return 16843009*((k=(858993459&(k-=k>>>1&1431655765))+(k>>>2&858993459))+(k>>>4)&252645135)>>>24},Q.countTrailingZeros=i,Q.nextPow2=function(k){return k+=0===k,--k,k|=k>>>1,k|=k>>>2,k|=k>>>4,k|=k>>>8,(k|=k>>>16)+1},Q.prevPow2=function(k){return k|=k>>>1,k|=k>>>2,k|=k>>>4,k|=k>>>8,(k|=k>>>16)-(k>>>1)},Q.parity=function(k){return k^=k>>>16,k^=k>>>8,k^=k>>>4,27030>>>(k&=15)&1};var Z=new Array(256);!function(k){for(var Q=0;Q<256;++Q){var i=Q,Z=Q,U=7;for(i>>>=1;i;i>>>=1)Z<<=1,Z|=1&i,--U;k[Q]=Z<<U&255}}(Z),Q.reverse=function(k){return Z[255&k]<<24|Z[k>>>8&255]<<16|Z[k>>>16&255]<<8|Z[k>>>24&255]},Q.interleave2=function(k,Q){return(k=1431655765&((k=858993459&((k=252645135&((k=16711935&((k&=65535)|k<<8))|k<<4))|k<<2))|k<<1))|(Q=1431655765&((Q=858993459&((Q=252645135&((Q=16711935&((Q&=65535)|Q<<8))|Q<<4))|Q<<2))|Q<<1))<<1},Q.deinterleave2=function(k,Q){return(k=65535&((k=16711935&((k=252645135&((k=858993459&((k=k>>>Q&1431655765)|k>>>1))|k>>>2))|k>>>4))|k>>>16))<<16>>16},Q.interleave3=function(k,Q,i){return k=1227133513&((k=3272356035&((k=251719695&((k=4278190335&((k&=1023)|k<<16))|k<<8))|k<<4))|k<<2),(k|=(Q=1227133513&((Q=3272356035&((Q=251719695&((Q=4278190335&((Q&=1023)|Q<<16))|Q<<8))|Q<<4))|Q<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},Q.deinterleave3=function(k,Q){return(k=1023&((k=4278190335&((k=251719695&((k=3272356035&((k=k>>>Q&1227133513)|k>>>2))|k>>>4))|k>>>8))|k>>>16))<<22>>22},Q.nextCombination=function(k){var Q=k|k-1;return Q+1|(~Q&-~Q)-1>>>i(k)+1}},13333:(k,Q,i)=>{"use strict";k.exports=function(k,Q,i){switch(arguments.length){case 1:return Z=[],O(U=k,U,J,!0),Z;case 2:return"function"===typeof Q?O(k,k,Q,!0):function(k,Q){return Z=[],O(k,Q,J,!1),Z}(k,Q);case 3:return O(k,Q,i,!1);default:throw new Error("box-intersect: Invalid arguments")}var U};var Z,U=i(13335),C=i(13370),B=i(13376);function o(k,Q){for(var i=0;i<k;++i)if(!(Q[i]<=Q[i+k]))return!0;return!1}function m(k,Q,i,Z){for(var U=0,C=0,B=0,m=k.length;B<m;++B){var O=k[B];if(!o(Q,O)){for(var J=0;J<2*Q;++J)i[U++]=O[J];Z[C++]=B}}return C}function O(k,Q,i,Z){var o=k.length,O=Q.length;if(!(o<=0||O<=0)){var J=k[0].length>>>1;if(!(J<=0)){var G,H=U.mallocDouble(2*J*o),e=U.mallocInt32(o);if((o=m(k,J,H,e))>0){if(1===J&&Z)C.init(o),G=C.sweepComplete(J,i,0,o,H,e,0,o,H,e);else{var F=U.mallocDouble(2*J*O),z=U.mallocInt32(O);(O=m(Q,J,F,z))>0&&(C.init(o+O),G=1===J?C.sweepBipartite(J,i,0,o,H,e,0,O,F,z):B(J,i,Z,o,H,e,O,F,z),U.free(F),U.free(z))}U.free(H),U.free(e)}return G}}}function J(k,Q){Z.push([k,Q])}},13379:(k,Q)=>{"use strict";var i="d",Z="ax",U="fp",C="es",B="rs",o="re",m="rb",O="bs",J="be",G="bb",H=[i,Z,"vv",B,o,m,"ri",O,J,G,"bi"];function e(k){var Q="bruteForce"+(k?"Full":"Partial"),Z=[],B=H.slice();k||B.splice(3,0,U);var o=["function "+Q+"("+B.join()+"){"];function m(Q,U){var B=function(k,Q,Z){var U="bruteForce"+(k?"Red":"Blue")+(Q?"Flip":"")+(Z?"Full":""),B=["function ",U,"(",H.join(),"){","var ",C,"=2*",i,";"],o="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",m="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(Z?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return k?B.push(o,"Q",":",m):B.push(m,"Q",":",o),Z?B.push("if(y1<x0||x1<y0)continue;"):Q?B.push("if(y0<=x0||x1<y0)continue;"):B.push("if(y0<x0||x1<y0)continue;"),B.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),Q?B.push("yi,xi"):B.push("xi,yi"),B.push(");if(rv!==void 0)return rv;}}}"),{name:U,code:B.join("")}}(Q,U,k);Z.push(B.code),o.push("return "+B.name+"("+H.join()+");")}o.push("if(re-rs>be-bs){"),k?(m(!0,!1),o.push("}else{"),m(!1,!1)):(o.push("if(fp){"),m(!0,!0),o.push("}else{"),m(!0,!1),o.push("}}else{if(fp){"),m(!1,!0),o.push("}else{"),m(!1,!1),o.push("}")),o.push("}}return "+Q);var O=Z.join("")+o.join("");return new Function(O)()}Q.partial=e(!1),Q.full=e(!0)},13376:(k,Q,i)=>{"use strict";k.exports=function(k,Q,i,C,J,j,T,K,v){!function(k,Q){var i=8*U.log2(Q+1)*(k+1)|0,C=U.nextPow2(f*i);y.length<C&&(Z.free(y),y=Z.mallocInt32(C));var B=U.nextPow2(Y*i);L.length<B&&(Z.free(L),L=Z.mallocDouble(B))}(k,C+T);var N,X=0,p=2*k;s(X++,0,0,C,0,T,i?16:0,-1/0,1/0),i||s(X++,0,0,T,0,C,1,-1/0,1/0);for(;X>0;){var d=(X-=1)*f,b=y[d],D=y[d+1],M=y[d+2],W=y[d+3],A=y[d+4],g=y[d+5],R=X*Y,w=L[R],S=L[R+1],q=1&g,P=!!(16&g),t=J,I=j,r=K,n=v;if(q&&(t=K,I=v,r=J,n=j),!(2&g&&D>=(M=E(k,b,D,M,t,I,S)))&&!(4&g&&(D=l(k,b,D,M,t,I,w))>=M)){var x=M-D,V=A-W;if(P){if(k*x*(x+V)<e){if(void 0!==(N=m.scanComplete(k,b,Q,D,M,t,I,W,A,r,n)))return N;continue}}else{if(k*Math.min(x,V)<G){if(void 0!==(N=B(k,b,Q,q,D,M,t,I,W,A,r,n)))return N;continue}if(k*x*V<H){if(void 0!==(N=m.scanBipartite(k,b,Q,q,D,M,t,I,W,A,r,n)))return N;continue}}var kk=F(k,b,D,M,t,I,w,S);if(D<kk)if(k*(kk-D)<G){if(void 0!==(N=o(k,b+1,Q,D,kk,t,I,W,A,r,n)))return N}else if(b===k-2){if(void 0!==(N=q?m.sweepBipartite(k,Q,W,A,r,n,D,kk,t,I):m.sweepBipartite(k,Q,D,kk,t,I,W,A,r,n)))return N}else s(X++,b+1,D,kk,W,A,q,-1/0,1/0),s(X++,b+1,W,A,D,kk,1^q,-1/0,1/0);if(kk<M){var Qk=O(k,b,W,A,r,n),ik=r[p*Qk+b],Zk=z(k,b,Qk,A,r,n,ik);if(Zk<A&&s(X++,b,kk,M,Zk,A,(4|q)+(P?16:0),ik,S),W<Qk&&s(X++,b,kk,M,W,Qk,(2|q)+(P?16:0),w,ik),Qk+1===Zk){if(void 0!==(N=P?a(k,b,Q,kk,M,t,I,Qk,r,n[Qk]):u(k,b,Q,q,kk,M,t,I,Qk,r,n[Qk])))return N}else if(Qk<Zk){var Uk;if(P){if(kk<(Uk=h(k,b,kk,M,t,I,ik))){var Ck=z(k,b,kk,Uk,t,I,ik);if(b===k-2){if(kk<Ck&&void 0!==(N=m.sweepComplete(k,Q,kk,Ck,t,I,Qk,Zk,r,n)))return N;if(Ck<Uk&&void 0!==(N=m.sweepBipartite(k,Q,Ck,Uk,t,I,Qk,Zk,r,n)))return N}else kk<Ck&&s(X++,b+1,kk,Ck,Qk,Zk,16,-1/0,1/0),Ck<Uk&&(s(X++,b+1,Ck,Uk,Qk,Zk,0,-1/0,1/0),s(X++,b+1,Qk,Zk,Ck,Uk,1,-1/0,1/0))}}else kk<(Uk=q?c(k,b,kk,M,t,I,ik):h(k,b,kk,M,t,I,ik))&&(b===k-2?N=q?m.sweepBipartite(k,Q,Qk,Zk,r,n,kk,Uk,t,I):m.sweepBipartite(k,Q,kk,Uk,t,I,Qk,Zk,r,n):(s(X++,b+1,kk,Uk,Qk,Zk,q,-1/0,1/0),s(X++,b+1,Qk,Zk,kk,Uk,1^q,-1/0,1/0)))}}}}};var Z=i(13335),U=i(13344),C=i(13379),B=C.partial,o=C.full,m=i(13370),O=i(13386),J=i(13388),G=128,H=1<<22,e=1<<22,F=J("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),z=J("lo===p0",["p0"]),E=J("lo<p0",["p0"]),l=J("hi<=p0",["p0"]),h=J("lo<=p0&&p0<=hi",["p0"]),c=J("lo<p0&&p0<=hi",["p0"]),f=6,Y=2,y=Z.mallocInt32(1024),L=Z.mallocDouble(1024);function s(k,Q,i,Z,U,C,B,o,m){var O=f*k;y[O]=Q,y[O+1]=i,y[O+2]=Z,y[O+3]=U,y[O+4]=C,y[O+5]=B;var J=Y*k;L[J]=o,L[J+1]=m}function u(k,Q,i,Z,U,C,B,o,m,O,J){var G=2*k,H=m*G,e=O[H+Q];k:for(var F=U,z=U*G;F<C;++F,z+=G){var E=B[z+Q],l=B[z+Q+k];if(!(e<E||l<e)&&(!Z||e!==E)){for(var h,c=o[F],f=Q+1;f<k;++f){E=B[z+f],l=B[z+f+k];var Y=O[H+f],y=O[H+f+k];if(l<Y||y<E)continue k}if(void 0!==(h=Z?i(J,c):i(c,J)))return h}}}function a(k,Q,i,Z,U,C,B,o,m,O){var J=2*k,G=o*J,H=m[G+Q];k:for(var e=Z,F=Z*J;e<U;++e,F+=J){var z=B[e];if(z!==O){var E=C[F+Q],l=C[F+Q+k];if(!(H<E||l<H)){for(var h=Q+1;h<k;++h){E=C[F+h],l=C[F+h+k];var c=m[G+h],f=m[G+h+k];if(l<c||f<E)continue k}var Y=i(z,O);if(void 0!==Y)return Y}}}}},13386:(k,Q,i)=>{"use strict";k.exports=function(k,Q,i,B,o,m){if(B<=i+1)return i;var O=i,J=B,G=B+i>>>1,H=2*k,e=G,F=o[H*G+Q];for(;O<J;){if(J-O<U){C(k,Q,O,J,o,m),F=o[H*G+Q];break}var z=J-O,E=Math.random()*z+O|0,l=o[H*E+Q],h=Math.random()*z+O|0,c=o[H*h+Q],f=Math.random()*z+O|0,Y=o[H*f+Q];l<=c?Y>=c?(e=h,F=c):l>=Y?(e=E,F=l):(e=f,F=Y):c>=Y?(e=h,F=c):Y>=l?(e=E,F=l):(e=f,F=Y);for(var y=H*(J-1),L=H*e,s=0;s<H;++s,++y,++L){var u=o[y];o[y]=o[L],o[L]=u}var a=m[J-1];m[J-1]=m[e],m[e]=a;for(y=H*(J-1),L=H*(e=Z(k,Q,O,J-1,o,m,F)),s=0;s<H;++s,++y,++L){u=o[y];o[y]=o[L],o[L]=u}a=m[J-1];if(m[J-1]=m[e],m[e]=a,G<e){for(J=e-1;O<J&&o[H*(J-1)+Q]===F;)J-=1;J+=1}else{if(!(e<G))break;for(O=e+1;O<J&&o[H*O+Q]===F;)O+=1}}return Z(k,Q,i,G,o,m,o[H*G+Q])};var Z=i(13388)("lo<p0",["p0"]),U=8;function C(k,Q,i,Z,U,C){for(var B=2*k,o=B*(i+1)+Q,m=i+1;m<Z;++m,o+=B)for(var O=U[o],J=m,G=B*(m-1);J>i&&U[G+Q]>O;--J,G-=B){for(var H=G,e=G+B,F=0;F<B;++F,++H,++e){var z=U[H];U[H]=U[e],U[e]=z}var E=C[J];C[J]=C[J-1],C[J-1]=E}}},13388:k=>{"use strict";k.exports=function(k,i){var Z="abcdef".split("").concat(i),U=[];k.indexOf("lo")>=0&&U.push("lo=e[k+n]");k.indexOf("hi")>=0&&U.push("hi=e[k+o]");return Z.push(Q.replace("_",U.join()).replace("$",k)),Function.apply(void 0,Z)};var Q="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13374:k=>{"use strict";k.exports=function(k,Z){Z<=4*Q?i(0,Z-1,k):O(0,Z-1,k)};var Q=32;function i(k,Q,i){for(var Z=2*(k+1),U=k+1;U<=Q;++U){for(var C=i[Z++],B=i[Z++],o=U,m=Z-2;o-- >k;){var O=i[m-2],J=i[m-1];if(O<C)break;if(O===C&&J<B)break;i[m]=O,i[m+1]=J,m-=2}i[m]=C,i[m+1]=B}}function Z(k,Q,i){Q*=2;var Z=i[k*=2],U=i[k+1];i[k]=i[Q],i[k+1]=i[Q+1],i[Q]=Z,i[Q+1]=U}function U(k,Q,i){Q*=2,i[k*=2]=i[Q],i[k+1]=i[Q+1]}function C(k,Q,i,Z){Q*=2,i*=2;var U=Z[k*=2],C=Z[k+1];Z[k]=Z[Q],Z[k+1]=Z[Q+1],Z[Q]=Z[i],Z[Q+1]=Z[i+1],Z[i]=U,Z[i+1]=C}function B(k,Q,i,Z,U){Q*=2,U[k*=2]=U[Q],U[Q]=i,U[k+1]=U[Q+1],U[Q+1]=Z}function o(k,Q,i){Q*=2;var Z=i[k*=2],U=i[Q];return!(Z<U)&&(Z!==U||i[k+1]>i[Q+1])}function m(k,Q,i,Z){var U=Z[k*=2];return U<Q||U===Q&&Z[k+1]<i}function O(k,J,G){var H=(J-k+1)/6|0,e=k+H,F=J-H,z=k+J>>1,E=z-H,l=z+H,h=e,c=E,f=z,Y=l,y=F,L=k+1,s=J-1,u=0;o(h,c,G)&&(u=h,h=c,c=u),o(Y,y,G)&&(u=Y,Y=y,y=u),o(h,f,G)&&(u=h,h=f,f=u),o(c,f,G)&&(u=c,c=f,f=u),o(h,Y,G)&&(u=h,h=Y,Y=u),o(f,Y,G)&&(u=f,f=Y,Y=u),o(c,y,G)&&(u=c,c=y,y=u),o(c,f,G)&&(u=c,c=f,f=u),o(Y,y,G)&&(u=Y,Y=y,y=u);for(var a=G[2*c],j=G[2*c+1],T=G[2*Y],K=G[2*Y+1],v=2*h,N=2*f,X=2*y,p=2*e,d=2*z,b=2*F,D=0;D<2;++D){var M=G[v+D],W=G[N+D],A=G[X+D];G[p+D]=M,G[d+D]=W,G[b+D]=A}U(E,k,G),U(l,J,G);for(var g=L;g<=s;++g)if(m(g,a,j,G))g!==L&&Z(g,L,G),++L;else if(!m(g,T,K,G))for(;;){if(m(s,T,K,G)){m(s,a,j,G)?(C(g,L,s,G),++L,--s):(Z(g,s,G),--s);break}if(--s<g)break}B(k,L-1,a,j,G),B(J,s+1,T,K,G),L-2-k<=Q?i(k,L-2,G):O(k,L-2,G),J-(s+2)<=Q?i(s+2,J,G):O(s+2,J,G),s-L<=Q?i(L,s,G):O(L,s,G)}},13370:(k,Q,i)=>{"use strict";k.exports={init:function(k){var Q=U.nextPow2(k);m.length<Q&&(Z.free(m),m=Z.mallocInt32(Q));O.length<Q&&(Z.free(O),O=Z.mallocInt32(Q));J.length<Q&&(Z.free(J),J=Z.mallocInt32(Q));G.length<Q&&(Z.free(G),G=Z.mallocInt32(Q));H.length<Q&&(Z.free(H),H=Z.mallocInt32(Q));e.length<Q&&(Z.free(e),e=Z.mallocInt32(Q));var i=8*Q;F.length<i&&(Z.free(F),F=Z.mallocDouble(i))},sweepBipartite:function(k,Q,i,Z,U,o,H,e,l,h){for(var c=0,f=2*k,Y=k-1,y=f-1,L=i;L<Z;++L){var s=o[L],u=f*L;F[c++]=U[u+Y],F[c++]=-(s+1),F[c++]=U[u+y],F[c++]=s}for(L=H;L<e;++L){s=h[L]+B;var a=f*L;F[c++]=l[a+Y],F[c++]=-s,F[c++]=l[a+y],F[c++]=s}var j=c>>>1;C(F,j);var T=0,K=0;for(L=0;L<j;++L){var v=0|F[2*L+1];if(v>=B)z(J,G,K--,v=v-B|0);else if(v>=0)z(m,O,T--,v);else if(v<=-B){v=-v-B|0;for(var N=0;N<T;++N){if(void 0!==(X=Q(m[N],v)))return X}E(J,G,K++,v)}else{v=-v-1|0;for(N=0;N<K;++N){var X;if(void 0!==(X=Q(v,J[N])))return X}E(m,O,T++,v)}}},sweepComplete:function(k,Q,i,Z,U,B,o,l,h,c){for(var f=0,Y=2*k,y=k-1,L=Y-1,s=i;s<Z;++s){var u=B[s]+1<<1,a=Y*s;F[f++]=U[a+y],F[f++]=-u,F[f++]=U[a+L],F[f++]=u}for(s=o;s<l;++s){u=c[s]+1<<1;var j=Y*s;F[f++]=h[j+y],F[f++]=1|-u,F[f++]=h[j+L],F[f++]=1|u}var T=f>>>1;C(F,T);var K=0,v=0,N=0;for(s=0;s<T;++s){var X=0|F[2*s+1],p=1&X;if(s<T-1&&X>>1===F[2*s+3]>>1&&(p=2,s+=1),X<0){for(var d=-(X>>1)-1,b=0;b<N;++b){if(void 0!==(D=Q(H[b],d)))return D}if(0!==p)for(b=0;b<K;++b){if(void 0!==(D=Q(m[b],d)))return D}if(1!==p)for(b=0;b<v;++b){var D;if(void 0!==(D=Q(J[b],d)))return D}0===p?E(m,O,K++,d):1===p?E(J,G,v++,d):2===p&&E(H,e,N++,d)}else{d=(X>>1)-1;0===p?z(m,O,K--,d):1===p?z(J,G,v--,d):2===p&&z(H,e,N--,d)}}},scanBipartite:function(k,Q,i,Z,U,o,J,G,H,e,l,h){var c=0,f=2*k,Y=Q,y=Q+k,L=1,s=1;Z?s=B:L=B;for(var u=U;u<o;++u){var a=u+L,j=f*u;F[c++]=J[j+Y],F[c++]=-a,F[c++]=J[j+y],F[c++]=a}for(u=H;u<e;++u){a=u+s;var T=f*u;F[c++]=l[T+Y],F[c++]=-a}var K=c>>>1;C(F,K);var v=0;for(u=0;u<K;++u){var N=0|F[2*u+1];if(N<0){var X=!1;if((a=-N)>=B?(X=!Z,a-=B):(X=!!Z,a-=1),X)E(m,O,v++,a);else{var p=h[a],d=f*a,b=l[d+Q+1],D=l[d+Q+1+k];k:for(var M=0;M<v;++M){var W=m[M],A=f*W;if(!(D<J[A+Q+1]||J[A+Q+1+k]<b)){for(var g=Q+2;g<k;++g)if(l[d+g+k]<J[A+g]||J[A+g+k]<l[d+g])continue k;var R,w=G[W];if(void 0!==(R=Z?i(p,w):i(w,p)))return R}}}}else z(m,O,v--,N-L)}},scanComplete:function(k,Q,i,Z,U,o,O,J,G,H,e){for(var z=0,E=2*k,l=Q,h=Q+k,c=Z;c<U;++c){var f=c+B,Y=E*c;F[z++]=o[Y+l],F[z++]=-f,F[z++]=o[Y+h],F[z++]=f}for(c=J;c<G;++c){f=c+1;var y=E*c;F[z++]=H[y+l],F[z++]=-f}var L=z>>>1;C(F,L);var s=0;for(c=0;c<L;++c){var u=0|F[2*c+1];if(u<0){if((f=-u)>=B)m[s++]=f-B;else{var a=e[f-=1],j=E*f,T=H[j+Q+1],K=H[j+Q+1+k];k:for(var v=0;v<s;++v){var N=m[v],X=O[N];if(X===a)break;var p=E*N;if(!(K<o[p+Q+1]||o[p+Q+1+k]<T)){for(var d=Q+2;d<k;++d)if(H[j+d+k]<o[p+d]||o[p+d+k]<H[j+d])continue k;var b=i(X,a);if(void 0!==b)return b}}}}else{for(f=u-B,v=s-1;v>=0;--v)if(m[v]===f){for(d=v+1;d<s;++d)m[d-1]=m[d];break}--s}}}};var Z=i(13335),U=i(13344),C=i(13374),B=1<<28,o=1024,m=Z.mallocInt32(o),O=Z.mallocInt32(o),J=Z.mallocInt32(o),G=Z.mallocInt32(o),H=Z.mallocInt32(o),e=Z.mallocInt32(o),F=Z.mallocDouble(8192);function z(k,Q,i,Z){var U=Q[Z],C=k[i-1];k[U]=C,Q[C]=U}function E(k,Q,i,Z){k[i]=Z,Q[Z]=i}},13352:k=>{"use strict";function Q(k,i,Z){var U=0|k[Z];if(U<=0)return[];var C,B=new Array(U);if(Z===k.length-1)for(C=0;C<U;++C)B[C]=i;else for(C=0;C<U;++C)B[C]=Q(k,i,Z+1);return B}k.exports=function(k,i){switch("undefined"===typeof i&&(i=0),typeof k){case"number":if(k>0)return function(k,Q){var i,Z;for(i=new Array(k),Z=0;Z<k;++Z)i[Z]=Q;return i}(0|k,i);break;case"object":if("number"===typeof k.length)return Q(k,i,0)}return[]}},13308:(k,Q,i)=>{k.exports=function(){var k=this;this.components={},this.comps=this.components;var Q=this.components,i=1,U={},C=[],B=[],o={timeout:!1,removals:[],multiComps:[]};function m(k,i){var Z=Q[i],C=U[i],B=C.hash[k];B&&(C.remove(k),Z.ki&&(Z.multi?(B.forEach((Q=>{Q&&Z.ki(k,Q)})),B.length=0):Z.ki(k,B)),o.removals.push(C),O())}function O(){o.timeout||(o.timeout=!0,setTimeout(J,1))}function J(){o.timeout=!1,G()}function G(){o.multiComps.length&&function(k){for(var Q=0;Q<k.length;Q++){var{entID:i,data:Z}=k[Q],U=Z.hash[i];if(U){for(var C=0;C<U.length;C++)U[C]||(U.splice(C,1),C--);0===U.length&&(Z.remove(i),o.removals.push(Z))}}k.length=0}(o.multiComps),o.removals.length&&function(k){for(var Q=0;Q<k.length;Q++){k[Q].flush()}k.length=0}(o.removals)}this.BG=U,this._systems=C,this._renderSystems=B,this.IO=function(Q){var Z=i++;return Array.isArray(Q)&&Q.forEach((Q=>k.Nm(Z,Q))),Z},this.deleteEntity=function(Q){return Object.keys(U).forEach((k=>{U[k].hash[Q]&&m(Q,k)})),k},this.JJ=function(k){if(!k)throw new Error("Missing component definition");var i=k.name;if(!i)throw new Error("Component definition must have a name property.");if("string"!==typeof i)throw new Error("Component name must be a string.");if(""===i)throw new Error("Component name must be a non-empty string.");if(U[i])throw new Error(`Component ${i} already exists.`);var o={};return o.name=i,o.multi=!!k.multi,o.order=isNaN(k.order)?99:k.order,o.stateConstructor=k.stateConstructor||null,o.state=k.state||{},o.so=k.so||null,o.ki=k.ki||null,o.system=k.system||null,o.vo=k.vo||null,Q[i]=o,U[i]=new Z,U[i]._pendingMultiCleanup=!1,U[i]._multiCleanupIDs=o.multi?[]:null,o.system&&(C.push(i),C.sort(((k,i)=>Q[k].order-Q[i].order))),o.vo&&(B.push(i),B.sort(((k,i)=>Q[k].order-Q[i].order))),i},this.overwriteComponent=function(k,i){var Z=Q[k];if(!Z)throw new Error(`Unknown component: ${k}`);if(!i)throw new Error("Missing component definition");if(Z.name!==i.name)throw new Error("Overwriting component must use the same name property.");var o={};o.name=k,o.multi=!!i.multi,o.order=isNaN(i.order)?99:i.order,o.state=i.state||{},o.so=i.so||null,o.ki=i.ki||null,o.system=i.system||null,o.vo=i.vo||null,Q[k]=o,U[k]._pendingMultiCleanup=!1,U[k]._multiCleanupIDs=o.multi?[]:null;var m=C.indexOf(k);o.system&&m<0&&C.push(k),!o.system&&m>=0&&C.splice(m,1),C.sort(((k,i)=>Q[k].order-Q[i].order));var O=B.indexOf(k);o.vo&&O<0&&B.push(k),!o.vo&&O>=0&&B.splice(O,1),B.sort(((k,i)=>Q[k].order-Q[i].order));var J=o.state;return this.KO(k).forEach((k=>{for(var Q in J)Q in k||(k[Q]=J[Q]);o.so&&o.so(k.To,k)})),k},this.deleteComponent=function(i){var Z=U[i];if(!Z)throw new Error(`Unknown component: ${i}`);Z.flush(),Z.list.forEach((k=>{k&&m(k.To||k[0].To,i)}));var o=C.indexOf(i),O=B.indexOf(i);return o>-1&&C.splice(o,1),O>-1&&B.splice(O,1),U[i].dispose(),delete U[i],delete Q[i],k},this.Nm=function(k,i,Z){var C,B=Q[i],o=U[i];if(!o)throw new Error(`Unknown component: ${i}.`);if(o.hash[k]&&!B.multi)throw new Error(`Entity ${k} already has component: ${i}.`);if(B.stateConstructor){if(!(C=new B.stateConstructor).hasOwnProperty("To"))throw new Error(`Component ${B.name} stateConstructor type does not have property __id`)}else C=Object.assign({},{To:k},B.state,Z);if(C.To=k,B.multi){var m=o.hash[k];m||(m=[],o.add(k,m)),m.push(C)}else o.add(k,C);return B.so&&B.so(k,C),this},this.Rm=function(k,Q){var i=U[Q];if(!i)throw new Error(`Unknown component: ${Q}.`);return!!i.hash[k]},this.bm=function(Q,i){if(!U[i])throw new Error(`Unknown component: ${i}.`);return m(Q,i),k},this.getState=function(k,Q){var i=U[Q];if(!i)throw new Error(`Unknown component: ${Q}.`);return i.hash[k]},this.KO=function(k){var Q=U[k];if(!Q)throw new Error(`Unknown component: ${k}.`);return G(),Q.list},this.IH=function(k){if(!U[k])throw new Error(`Unknown component: ${k}.`);var Q=U[k].hash;return k=>Q[k]},this.xH=function(k){if(!U[k])throw new Error(`Unknown component: ${k}.`);var Q=U[k].hash;return k=>!!Q[k]},this.VB=function(i){G();for(var Z=0;Z<C.length;Z++){var B=C[Z],o=Q[B],m=U[B];o.system(i,m.list),G()}return k},this.render=function(i){G();for(var Z=0;Z<B.length;Z++){var C=B[Z],o=Q[C],m=U[C];o.vo(i,m.list),G()}return k},this.removeMultiComponent=function(i,Z,C){var B=Q[Z],m=U[Z];if(!m)throw new Error(`Unknown component: ${Z}.`);if(!B.multi)throw new Error("removeMultiComponent called on non-multi component");return function(k,Q,i,Z){var U=i.hash[k];if(U){var C=U[Z];C&&(U[Z]=null,Q.ki&&Q.ki(k,C),o.multiComps.push({entID:k,data:i}),O())}}(i,B,m,C),k}};var Z=i(13311)},13311:k=>{function Q(k,Q){var i=k._map[Q];if(delete k.hash[Q],delete k._map[Q],i===k.list.length-1)k.list.pop();else{var Z=k.list.pop();if(k.list[i]=Z,null===Z||null===Z[0]){var U=k.list.length;for(var C in k._map)if(k._map[C]===U)return void(k._map[C]=i)}else{var B=Z.To||Z[0].To;k._map[B]=i}}}k.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(k,Q){if("number"===typeof this._map[k]){var i=this._map[k];this.hash[k]=Q,this.list[i]=Q}else this._map[k]=this.list.length,this.hash[k]=Q,this.list.push(Q)}remove(k){var Q=this._map[k];this.hash[k]=null,this.list[Q]=null,this._pendingRemovals.push(k)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var k=0;k<this._pendingRemovals.length;k++){var i=this._pendingRemovals[k];null===this.hash[i]&&Q(this,i)}this._pendingRemovals.length=0}}},13271:k=>{"use strict";var Q,i="object"===typeof Reflect?Reflect:null,Z=function(k,Q,i){return Function.prototype.apply.call(k,Q,i)};Q=i&&"function"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:function(k){return Object.getOwnPropertyNames(k)};var U=Number.isNaN||function(k){return k!==k};function C(){C.init.call(this)}k.exports=C,k.exports.once=function(k,Q){return new Promise((function(i,Z){function U(i){k.removeListener(Q,C),Z(i)}function C(){"function"===typeof k.removeListener&&k.removeListener("error",U),i([].slice.call(arguments))}z(k,Q,C,{once:!0}),"error"!==Q&&function(k,Q,i){"function"===typeof k.on&&z(k,"error",Q,i)}(k,U,{once:!0})}))},C.EventEmitter=C,C.prototype._events=void 0,C.prototype._eventsCount=0,C.prototype._maxListeners=void 0;var B=10;function o(k){if("function"!==typeof k)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}function m(k){return void 0===k._maxListeners?C.defaultMaxListeners:k._maxListeners}function O(k,Q,i,Z){var U,C,B,O;if(o(i),void 0===(C=k._events)?(C=k._events=Object.create(null),k._eventsCount=0):(void 0!==C.newListener&&(k.emit("newListener",Q,i.listener?i.listener:i),C=k._events),B=C[Q]),void 0===B)B=C[Q]=i,++k._eventsCount;else if("function"===typeof B?B=C[Q]=Z?[i,B]:[B,i]:Z?B.unshift(i):B.push(i),(U=m(k))>0&&B.length>U&&!B.warned){B.warned=!0;var J=new Error("Possible EventEmitter memory leak detected. "+B.length+" "+String(Q)+" listeners added. Use emitter.setMaxListeners() to increase limit");J.name="MaxListenersExceededWarning",J.UQ=k,J.type=Q,J.count=B.length,O=J,console&&console.warn&&console.warn(O)}return k}function J(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function G(k,Q,i){var Z={fired:!1,wrapFn:void 0,target:k,type:Q,listener:i},U=J.bind(Z);return U.listener=i,Z.wrapFn=U,U}function H(k,Q,i){var Z=k._events;if(void 0===Z)return[];var U=Z[Q];return void 0===U?[]:"function"===typeof U?i?[U.listener||U]:[U]:i?function(k){for(var Q=new Array(k.length),i=0;i<Q.length;++i)Q[i]=k[i].listener||k[i];return Q}(U):F(U,U.length)}function e(k){var Q=this._events;if(void 0!==Q){var i=Q[k];if("function"===typeof i)return 1;if(void 0!==i)return i.length}return 0}function F(k,Q){for(var i=new Array(Q),Z=0;Z<Q;++Z)i[Z]=k[Z];return i}function z(k,Q,i,Z){if("function"===typeof k.on)Z.once?k.once(Q,i):k.on(Q,i);else{if("function"!==typeof k.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k);k.addEventListener(Q,(function U(C){Z.once&&k.removeEventListener(Q,U),i(C)}))}}Object.defineProperty(C,"defaultMaxListeners",{enumerable:!0,get:function(){return B},set:function(k){if("number"!==typeof k||k<0||U(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");B=k}}),C.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},C.prototype.setMaxListeners=function(k){if("number"!==typeof k||k<0||U(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this},C.prototype.getMaxListeners=function(){return m(this)},C.prototype.emit=function(k){for(var Q=[],i=1;i<arguments.length;i++)Q.push(arguments[i]);var U="error"===k,C=this._events;if(void 0!==C)U=U&&void 0===C.error;else if(!U)return!1;if(U){var B;if(Q.length>0&&(B=Q[0]),B instanceof Error)throw B;var o=new Error("Unhandled error."+(B?" ("+B.message+")":""));throw o.context=B,o}var m=C[k];if(void 0===m)return!1;if("function"===typeof m)Z(m,this,Q);else{var O=m.length,J=F(m,O);for(i=0;i<O;++i)Z(J[i],this,Q)}return!0},C.prototype.addListener=function(k,Q){return O(this,k,Q,!1)},C.prototype.on=C.prototype.addListener,C.prototype.prependListener=function(k,Q){return O(this,k,Q,!0)},C.prototype.once=function(k,Q){return o(Q),this.on(k,G(this,k,Q)),this},C.prototype.prependOnceListener=function(k,Q){return o(Q),this.prependListener(k,G(this,k,Q)),this},C.prototype.removeListener=function(k,Q){var i,Z,U,C,B;if(o(Q),void 0===(Z=this._events))return this;if(void 0===(i=Z[k]))return this;if(i===Q||i.listener===Q)0===--this._eventsCount?this._events=Object.create(null):(delete Z[k],Z.removeListener&&this.emit("removeListener",k,i.listener||Q));else if("function"!==typeof i){for(U=-1,C=i.length-1;C>=0;C--)if(i[C]===Q||i[C].listener===Q){B=i[C].listener,U=C;break}if(U<0)return this;0===U?i.shift():function(k,Q){for(;Q+1<k.length;Q++)k[Q]=k[Q+1];k.pop()}(i,U),1===i.length&&(Z[k]=i[0]),void 0!==Z.removeListener&&this.emit("removeListener",k,B||Q)}return this},C.prototype.off=C.prototype.removeListener,C.prototype.CQ=function(k){var Q,i,Z;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[k]&&(0===--this._eventsCount?this._events=Object.create(null):delete i[k]),this;if(0===arguments.length){var U,C=Object.keys(i);for(Z=0;Z<C.length;++Z)"removeListener"!==(U=C[Z])&&this.CQ(U);return this.CQ("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(Q=i[k]))this.removeListener(k,Q);else if(void 0!==Q)for(Z=Q.length-1;Z>=0;Z--)this.removeListener(k,Q[Z]);return this},C.prototype.listeners=function(k){return H(this,k,!0)},C.prototype.rawListeners=function(k){return H(this,k,!1)},C.listenerCount=function(k,Q){return"function"===typeof k.listenerCount?k.listenerCount(Q):e.call(k,Q)},C.prototype.listenerCount=e,C.prototype.eventNames=function(){return this._eventsCount>0?Q(this._events):[]}},13565:k=>{"use strict";k.exports=function(k,Q,i,Z,U,C){var B=+Q[0],o=+Q[1],m=+Q[2],O=+i[0],J=+i[1],G=+i[2],H=Math.sqrt(O*O+J*J+G*G);if(0===H)throw new Error("Can't raycast along a zero vector");return function(k,Q,i,Z,U,C,B,o,m,O){for(var J=0,G=Math.floor,H=0|G(Q),e=0|G(i),F=0|G(Z),z=U>0?1:-1,E=C>0?1:-1,l=B>0?1:-1,h=Math.abs(1/U),c=Math.abs(1/C),f=Math.abs(1/B),Y=h<1/0?h*(z>0?H+1-Q:Q-H):1/0,y=c<1/0?c*(E>0?e+1-i:i-e):1/0,L=f<1/0?f*(l>0?F+1-Z:Z-F):1/0,s=-1;J<=o;){var u=k(H,e,F);if(u)return m&&(m[0]=Q+J*U,m[1]=i+J*C,m[2]=Z+J*B),O&&(O[0]=O[1]=O[2]=0,0===s&&(O[0]=-z),1===s&&(O[1]=-E),2===s&&(O[2]=-l)),u;Y<y?Y<L?(H+=z,J=Y,Y+=h,s=0):(F+=l,J=L,L+=f,s=2):y<L?(e+=E,J=y,y+=c,s=1):(F+=l,J=L,L+=f,s=2)}return m&&(m[0]=Q+J*U,m[1]=i+J*C,m[2]=Z+J*B),O&&(O[0]=O[1]=O[2]=0),0}(k,B,o,m,O/=H,J/=H,G/=H,Z="undefined"===typeof Z?64:+Z,U,C)}},13594:(k,Q,i)=>{"use strict";i.d(Q,{c:()=>C});var Z=i(13271);function U(){this.rG=!1,this.stopPropagation=!1,this.nG=!1,this.disabled=!1}class C{constructor(k,Q){this.version="0.7.0";var i=Object.assign({},new U,Q||{});this.element=k||document,this.rG=!!i.rG,this.stopPropagation=!!i.stopPropagation,this.nG=!!i.nG,this.disabled=!!i.disabled,this.filterEvents=(k,Q)=>!0,this.down=new Z.EventEmitter,this.up=new Z.EventEmitter,this.state={},this.LO={dx:0,dy:0,WH:0,yO:0,AH:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?o(this):document.addEventListener("DOMContentLoaded",(k=>{o(this)}),{once:!0})}bind(k){for(var Q=arguments.length,i=new Array(Q>1?Q-1:0),Z=1;Z<Q;Z++)i[Z-1]=arguments[Z];i.forEach((Q=>{var i=this._keyBindmap[Q]||[];i.includes(k)||(i.push(k),this._keyBindmap[Q]=i)})),this.state[k]=!!this.state[k],this.pressCount[k]=this.pressCount[k]||0,this.releaseCount[k]=this.releaseCount[k]||0}unbind(k){for(var Q in this._keyBindmap){var i=this._keyBindmap[Q],Z=i.indexOf(k);Z>-1&&i.splice(Z,1)}}getBindings(){var k={};for(var Q in this._keyBindmap){this._keyBindmap[Q].forEach((i=>{k[i]=k[i]||[],k[i].push(Q)}))}return k}VB(){B(this.LO),B(this.pressCount),B(this.releaseCount)}}function B(k){for(var Q in k)k[Q]=0}function o(k){window.addEventListener("keydown",F.bind(null,k,!0),!1),window.addEventListener("keyup",F.bind(null,k,!1),!1);var Q={passive:!0};k.element.addEventListener("touchstart",G.bind(void 0,k),{passive:!1}),k.element.addEventListener("touchend",e.bind(void 0,k),Q),k.element.addEventListener("mousedown",z.bind(null,k,!0),Q),window.document.addEventListener("mouseup",z.bind(null,k,!1),Q),k.element.addEventListener("touchmove",E.bind(null,k),Q),k.element.addEventListener("mousemove",E.bind(null,k),Q),window.PointerEvent,k.element.addEventListener("wheel",l.bind(null,k),Q),k.element.addEventListener("contextmenu",h.bind(null,k),!1),window.addEventListener("blur",c.bind(null,k),!1)}var m=0,O=0,J=null;function G(k,Q){Q.preventDefault(),H(Q)}function H(k){let Q=!1;for(let i=0;i<k.touches.length;++i)if(k.touches[i].identifier===J){Q=!0;break}if(!Q){const Q=k.changedTouches[0];m=Q.clientX,O=Q.clientY,J=Q.identifier}}function e(k,Q){for(var i=Q.changedTouches,Z=0;Z<i.length;++Z)i[Z].identifier===J&&(J=null)}function F(k,Q,i){f(i.code,Q,k,i)}function z(k,Q,i){if("pointerId"in i)if(Q){if(null!==k._touches.currID)return;k._touches.currID=i.pointerId}else{if(k._touches.currID!==i.pointerId)return;k._touches.currID=null}return f("Mouse"+("button"in i?i.button+1:1),Q,k,i),!1}function E(k,Q){var i=Q.movementX||Q.mozMovementX||0,Z=Q.movementY||Q.mozMovementY||0;if(Q.touches&&0===(i|Z)){var U=function(k){H(k);for(let Q=0;Q<k.changedTouches.length;++Q)if(k.changedTouches[Q].identifier==J){const i=k.changedTouches[Q],Z=[i.clientX-m,i.clientY-O];return m=i.clientX,O=i.clientY,Z}return console.error(`Did not find touch id ${J}`),[0,0]}(Q);i=U[0],Z=U[1]}k.LO.dx+=i,k.LO.dy+=Z}function l(k,Q){var i=1;switch(Q.deltaMode){case 0:i=1;break;case 1:i=12;break;case 2:i=k.element.clientHeight||window.innerHeight}k.LO.WH+=(Q.deltaX||0)*i,k.LO.yO+=(Q.deltaY||0)*i,k.LO.AH+=(Q.deltaZ||0)*i}function h(k,Q){if(!k.nG)return Q.preventDefault(),!1}function c(k){for(var Q in k._keyStates)k._keyStates[Q]&&(/^Mouse\d/.test(Q)||f(Q,!1,k,{code:Q,note:"hhwve95iost",preventDefault:()=>{},stopPropagation:()=>{}}))}function f(k,Q,i,Z){var U=i._keyBindmap[k];U&&(Y(i._keyStates[k],Q)&&(i._keyStates[k]=Q,U.forEach((k=>{(!i.filterEvents||i.filterEvents(Z,k))&&function(k,Q,i,Z){var U=Q?i.pressCount:i.releaseCount;U[k]=(U[k]||0)+1;var C=i._bindPressCount[k]||0;(C+=Q?1:-1)<0&&(C=0);i._bindPressCount[k]=C;var B=i.state[k];if(Y(B,C)){i.state[k]=C>0;var o=Q?i.down:i.up;i.disabled||o.emit(k,Z)}}(k,Q,i,Z)}))),"button"in Z||(i.rG&&!Z.defaultPrevented&&Z.preventDefault(),i.stopPropagation&&Z.stopPropagation()))}function Y(k,Q){return k?!Q:Q}},12197:k=>{k.exports=function(k,Q,i){return k[0]=Q[0]+i[0],k[1]=Q[1]+i[1],k[2]=Q[2]+i[2],k}},12152:(k,Q,i)=>{k.exports=function(k,Q){var i=Z(k[0],k[1],k[2]),B=Z(Q[0],Q[1],Q[2]);U(i,i),U(B,B);var o=C(i,B);return o>1?0:Math.acos(o)};var Z=i(12159),U=i(12166),C=i(12169)},12249:k=>{k.exports=function(k,Q){return k[0]=Math.ceil(Q[0]),k[1]=Math.ceil(Q[1]),k[2]=Math.ceil(Q[2]),k}},12150:k=>{k.exports=function(k){var Q=new Float32Array(3);return Q[0]=k[0],Q[1]=k[1],Q[2]=k[2],Q}},12174:k=>{k.exports=function(k,Q){return k[0]=Q[0],k[1]=Q[1],k[2]=Q[2],k}},12141:k=>{k.exports=function(){var k=new Float32Array(3);return k[0]=0,k[1]=0,k[2]=0,k}},12333:k=>{k.exports=function(k,Q,i){var Z=Q[0],U=Q[1],C=Q[2],B=i[0],o=i[1],m=i[2];return k[0]=U*m-C*o,k[1]=C*B-Z*m,k[2]=Z*o-U*B,k}},12283:(k,Q,i)=>{k.exports=i(12274)},12274:k=>{k.exports=function(k,Q){var i=Q[0]-k[0],Z=Q[1]-k[1],U=Q[2]-k[2];return Math.sqrt(i*i+Z*Z+U*U)}},12228:(k,Q,i)=>{k.exports=i(12223)},12223:k=>{k.exports=function(k,Q,i){return k[0]=Q[0]/i[0],k[1]=Q[1]/i[1],k[2]=Q[2]/i[2],k}},12169:k=>{k.exports=function(k,Q){return k[0]*Q[0]+k[1]*Q[1]+k[2]*Q[2]}},12138:k=>{k.exports=1e-6},12187:(k,Q,i)=>{k.exports=function(k,Q){var i=k[0],U=k[1],C=k[2],B=Q[0],o=Q[1],m=Q[2];return Math.abs(i-B)<=Z*Math.max(1,Math.abs(i),Math.abs(B))&&Math.abs(U-o)<=Z*Math.max(1,Math.abs(U),Math.abs(o))&&Math.abs(C-m)<=Z*Math.max(1,Math.abs(C),Math.abs(m))};var Z=i(12138)},12189:k=>{k.exports=function(k,Q){return k[0]===Q[0]&&k[1]===Q[1]&&k[2]===Q[2]}},12247:k=>{k.exports=function(k,Q){return k[0]=Math.floor(Q[0]),k[1]=Math.floor(Q[1]),k[2]=Math.floor(Q[2]),k}},12379:(k,Q,i)=>{k.exports=function(k,Q,i,U,C,B){var o,m;Q||(Q=3);i||(i=0);m=U?Math.min(U*Q+i,k.length):k.length;for(o=i;o<m;o+=Q)Z[0]=k[o],Z[1]=k[o+1],Z[2]=k[o+2],C(Z,Z,B),k[o]=Z[0],k[o+1]=Z[1],k[o+2]=Z[2];return k};var Z=i(12141)()},12159:k=>{k.exports=function(k,Q,i){var Z=new Float32Array(3);return Z[0]=k,Z[1]=Q,Z[2]=i,Z}},12134:(k,Q,i)=>{k.exports={EPSILON:i(12138),create:i(12141),clone:i(12150),angle:i(12152),wB:i(12159),j:i(12174),set:i(12180),equals:i(12187),exactEquals:i(12189),add:i(12197),EQ:i(12199),sub:i(12204),multiply:i(12208),mul:i(12216),divide:i(12223),div:i(12228),min:i(12232),max:i(12238),floor:i(12247),ceil:i(12249),round:i(12253),scale:i(12262),SB:i(12270),distance:i(12274),k:i(12283),squaredDistance:i(12289),sqrDist:i(12295),length:i(12299),len:i(12303),squaredLength:i(12309),qB:i(12318),negate:i(12321),inverse:i(12328),normalize:i(12166),dot:i(12169),cross:i(12333),AB:i(12342),random:i(12345),transformMat4:i(12347),transformMat3:i(12349),transformQuat:i(12354),PB:i(12362),tB:i(12365),IB:i(12372),forEach:i(12379)}},12328:k=>{k.exports=function(k,Q){return k[0]=1/Q[0],k[1]=1/Q[1],k[2]=1/Q[2],k}},12303:(k,Q,i)=>{k.exports=i(12299)},12299:k=>{k.exports=function(k){var Q=k[0],i=k[1],Z=k[2];return Math.sqrt(Q*Q+i*i+Z*Z)}},12342:k=>{k.exports=function(k,Q,i,Z){var U=Q[0],C=Q[1],B=Q[2];return k[0]=U+Z*(i[0]-U),k[1]=C+Z*(i[1]-C),k[2]=B+Z*(i[2]-B),k}},12238:k=>{k.exports=function(k,Q,i){return k[0]=Math.max(Q[0],i[0]),k[1]=Math.max(Q[1],i[1]),k[2]=Math.max(Q[2],i[2]),k}},12232:k=>{k.exports=function(k,Q,i){return k[0]=Math.min(Q[0],i[0]),k[1]=Math.min(Q[1],i[1]),k[2]=Math.min(Q[2],i[2]),k}},12216:(k,Q,i)=>{k.exports=i(12208)},12208:k=>{k.exports=function(k,Q,i){return k[0]=Q[0]*i[0],k[1]=Q[1]*i[1],k[2]=Q[2]*i[2],k}},12321:k=>{k.exports=function(k,Q){return k[0]=-Q[0],k[1]=-Q[1],k[2]=-Q[2],k}},12166:k=>{k.exports=function(k,Q){var i=Q[0],Z=Q[1],U=Q[2],C=i*i+Z*Z+U*U;C>0&&(C=1/Math.sqrt(C),k[0]=Q[0]*C,k[1]=Q[1]*C,k[2]=Q[2]*C);return k}},12345:k=>{k.exports=function(k,Q){Q=Q||1;var i=2*Math.random()*Math.PI,Z=2*Math.random()-1,U=Math.sqrt(1-Z*Z)*Q;return k[0]=Math.cos(i)*U,k[1]=Math.sin(i)*U,k[2]=Z*Q,k}},12362:k=>{k.exports=function(k,Q,i,Z){var U=i[1],C=i[2],B=Q[1]-U,o=Q[2]-C,m=Math.sin(Z),O=Math.cos(Z);return k[0]=Q[0],k[1]=U+B*O-o*m,k[2]=C+B*m+o*O,k}},12365:k=>{k.exports=function(k,Q,i,Z){var U=i[0],C=i[2],B=Q[0]-U,o=Q[2]-C,m=Math.sin(Z),O=Math.cos(Z);return k[0]=U+o*m+B*O,k[1]=Q[1],k[2]=C+o*O-B*m,k}},12372:k=>{k.exports=function(k,Q,i,Z){var U=i[0],C=i[1],B=Q[0]-U,o=Q[1]-C,m=Math.sin(Z),O=Math.cos(Z);return k[0]=U+B*O-o*m,k[1]=C+B*m+o*O,k[2]=Q[2],k}},12253:k=>{k.exports=function(k,Q){return k[0]=Math.round(Q[0]),k[1]=Math.round(Q[1]),k[2]=Math.round(Q[2]),k}},12262:k=>{k.exports=function(k,Q,i){return k[0]=Q[0]*i,k[1]=Q[1]*i,k[2]=Q[2]*i,k}},12270:k=>{k.exports=function(k,Q,i,Z){return k[0]=Q[0]+i[0]*Z,k[1]=Q[1]+i[1]*Z,k[2]=Q[2]+i[2]*Z,k}},12180:k=>{k.exports=function(k,Q,i,Z){return k[0]=Q,k[1]=i,k[2]=Z,k}},12295:(k,Q,i)=>{k.exports=i(12289)},12318:(k,Q,i)=>{k.exports=i(12309)},12289:k=>{k.exports=function(k,Q){var i=Q[0]-k[0],Z=Q[1]-k[1],U=Q[2]-k[2];return i*i+Z*Z+U*U}},12309:k=>{k.exports=function(k){var Q=k[0],i=k[1],Z=k[2];return Q*Q+i*i+Z*Z}},12204:(k,Q,i)=>{k.exports=i(12199)},12199:k=>{k.exports=function(k,Q,i){return k[0]=Q[0]-i[0],k[1]=Q[1]-i[1],k[2]=Q[2]-i[2],k}},12349:k=>{k.exports=function(k,Q,i){var Z=Q[0],U=Q[1],C=Q[2];return k[0]=Z*i[0]+U*i[3]+C*i[6],k[1]=Z*i[1]+U*i[4]+C*i[7],k[2]=Z*i[2]+U*i[5]+C*i[8],k}},12347:k=>{k.exports=function(k,Q,i){var Z=Q[0],U=Q[1],C=Q[2],B=i[3]*Z+i[7]*U+i[11]*C+i[15];return B=B||1,k[0]=(i[0]*Z+i[4]*U+i[8]*C+i[12])/B,k[1]=(i[1]*Z+i[5]*U+i[9]*C+i[13])/B,k[2]=(i[2]*Z+i[6]*U+i[10]*C+i[14])/B,k}},12354:k=>{k.exports=function(k,Q,i){var Z=Q[0],U=Q[1],C=Q[2],B=i[0],o=i[1],m=i[2],O=i[3],J=O*Z+o*C-m*U,G=O*U+m*Z-B*C,H=O*C+B*U-o*Z,e=-B*Z-o*U-m*C;return k[0]=J*O+e*-B+G*-m-H*-o,k[1]=G*O+e*-o+H*-B-J*-m,k[2]=H*O+e*-m+J*-o-G*-B,k}},13293:k=>{"use strict";k.exports=function(k){for(var Q=new Array(k),i=0;i<k;++i)Q[i]=i;return Q}},13361:k=>{k.exports=function(k){return null!=k&&null!=k.constructor&&"function"===typeof k.constructor.isBuffer&&k.constructor.isBuffer(k)}},13574:(k,Q,i)=>{"use strict";i.d(Q,{b:()=>Z});class Z{constructor(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.vJ=!1,this.NJ=!1,this.TJ=30,this.KJ=0,this.AJ=!1,this.fullscreen=!1,this.pJ=function(k){},this.dJ=function(){},this.MJ=function(){},this.ii=function(){},this.bJ=function(k){},this.onFullscreenChanged=function(k){},O((()=>{!function(k,Q){k._nowObject=performance||Date,k._lastTick=0,k._renderAccum=0,k._rt=0,k._frameCB=o.bind(null,k),requestAnimationFrame(k._frameCB),Q>0&&(k._intervalCB=B.bind(null,k),k._interval=setInterval(k._intervalCB,Math.max(Q,1e3/k.TJ/2)))}(this,Q),function(k,Q){if(!Q)return;var i=!1,Z=!1;document.addEventListener("pointerlockchange",(Z=>{i=document.pointerLockElement===Q,k.bJ(i)})),document.addEventListener("fullscreenchange",(i=>{Z=document.fullscreenElement===Q,k.onFullscreenChanged(Z)})),Object.defineProperty(k,"AJ",{get:()=>i,set:k=>{k&&!i?m(Q):i&&!k&&function(k){k.exitPointerLock&&k.exitPointerLock()}(document)}}),Object.defineProperty(k,"fullscreen",{get:()=>Z,set:k=>{k&&!Z?Q.requestFullscreen():Z&&!k&&document.exitFullscreen()}}),Q.addEventListener("click",(U=>{k.vJ&&!i&&m(Q),k.NJ&&!Z&&Q.requestFullscreen()}));var U=()=>k.ii();if(window.ResizeObserver){new ResizeObserver(U).observe(Q)}else window.addEventListener("resize",U)}(this,k),this.MJ()}))}}var U=3,C=20;function B(k){for(var Q=1e3/k.TJ,i=k._nowObject.now()+C,Z=0;k._nowObject.now()>=k._lastTick+Q&&k._nowObject.now()<i&&++Z<=U;)k.pJ(Q),k._lastTick+=Q;var B=5*(Q+5),o=k._nowObject.now();if(o-k._lastTick>B)for(;o>=k._lastTick+Q;)k._lastTick+=Q}function o(k){requestAnimationFrame(k._frameCB),B(k);var Q=k._nowObject.now(),i=Q-k._rt;if(k._rt=Q,k.KJ>0){k._renderAccum+=i;var Z=1e3/k.KJ;if(k._renderAccum<Z)return;k._renderAccum=Math.min(k._renderAccum-Z,Z)}var U=1e3/k.TJ,C=(Q-k._lastTick)/U;k.dJ(i,C,U)}function m(k){k.requestPointerLock&&k.requestPointerLock()}var O=k=>{if("loading"===document.readyState){var Q=()=>{document.removeEventListener("readystatechange",Q),k()};document.addEventListener("readystatechange",Q)}else setTimeout(k,1)}},13288:(k,Q,i)=>{var Z=i(13293),U=i(13295),C="undefined"!==typeof Float64Array;function B(k,Q){return k[0]-Q[0]}function o(){var k,Q=this.stride,i=new Array(Q.length);for(k=0;k<i.length;++k)i[k]=[Math.abs(Q[k]),k];i.sort(B);var Z=new Array(i.length);for(k=0;k<Z.length;++k)Z[k]=i[k][1];return Z}function m(k,Q){var i=["View",Q,"d",k].join("");Q<0&&(i="View_Nil"+k);var U="generic"===k;if(-1===Q){var C="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+k+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(C)()}if(0===Q){C="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+k+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(U?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(U?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}";return new Function("TrivialArray",C)(O[k][0])}C=["'use strict'"];var B=Z(Q),m=B.map((function(k){return"i"+k})),J="this.offset+"+B.map((function(k){return"this.stride["+k+"]*i"+k})).join("+"),G=B.map((function(k){return"b"+k})).join(","),H=B.map((function(k){return"c"+k})).join(",");C.push("function "+i+"(a,"+G+","+H+",d){this.data=a","this.shape=["+G+"]","this.stride=["+H+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+k+"'","proto.dimension="+Q),C.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+B.map((function(k){return"this.shape["+k+"]"})).join("*"),"}})"),1===Q?C.push("proto.order=[0]"):(C.push("Object.defineProperty(proto,'order',{get:"),Q<4?(C.push("function "+i+"_order(){"),2===Q?C.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===Q&&C.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):C.push("ORDER})")),C.push("proto.set=function "+i+"_set("+m.join(",")+",v){"),U?C.push("return this.data.set("+J+",v)}"):C.push("return this.data["+J+"]=v}"),C.push("proto.get=function "+i+"_get("+m.join(",")+"){"),U?C.push("return this.data.get("+J+")}"):C.push("return this.data["+J+"]}"),C.push("proto.index=function "+i+"_index(",m.join(),"){return "+J+"}"),C.push("proto.hi=function "+i+"_hi("+m.join(",")+"){return new "+i+"(this.data,"+B.map((function(k){return["(typeof i",k,"!=='number'||i",k,"<0)?this.shape[",k,"]:i",k,"|0"].join("")})).join(",")+","+B.map((function(k){return"this.stride["+k+"]"})).join(",")+",this.offset)}");var e=B.map((function(k){return"a"+k+"=this.shape["+k+"]"})),F=B.map((function(k){return"c"+k+"=this.stride["+k+"]"}));C.push("proto.lo=function "+i+"_lo("+m.join(",")+"){var b=this.offset,d=0,"+e.join(",")+","+F.join(","));for(var z=0;z<Q;++z)C.push("if(typeof i"+z+"==='number'&&i"+z+">=0){d=i"+z+"|0;b+=c"+z+"*d;a"+z+"-=d}");C.push("return new "+i+"(this.data,"+B.map((function(k){return"a"+k})).join(",")+","+B.map((function(k){return"c"+k})).join(",")+",b)}"),C.push("proto.step=function "+i+"_step("+m.join(",")+"){var "+B.map((function(k){return"a"+k+"=this.shape["+k+"]"})).join(",")+","+B.map((function(k){return"b"+k+"=this.stride["+k+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(z=0;z<Q;++z)C.push("if(typeof i"+z+"==='number'){d=i"+z+"|0;if(d<0){c+=b"+z+"*(a"+z+"-1);a"+z+"=ceil(-a"+z+"/d)}else{a"+z+"=ceil(a"+z+"/d)}b"+z+"*=d}");C.push("return new "+i+"(this.data,"+B.map((function(k){return"a"+k})).join(",")+","+B.map((function(k){return"b"+k})).join(",")+",c)}");var E=new Array(Q),l=new Array(Q);for(z=0;z<Q;++z)E[z]="a[i"+z+"]",l[z]="b[i"+z+"]";C.push("proto.transpose=function "+i+"_transpose("+m+"){"+m.map((function(k,Q){return k+"=("+k+"===undefined?"+Q+":"+k+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+E.join(",")+","+l.join(",")+",this.offset)}"),C.push("proto.pick=function "+i+"_pick("+m+"){var a=[],b=[],c=this.offset");for(z=0;z<Q;++z)C.push("if(typeof i"+z+"==='number'&&i"+z+">=0){c=(c+this.stride["+z+"]*i"+z+")|0}else{a.push(this.shape["+z+"]);b.push(this.stride["+z+"])}");return C.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),C.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+B.map((function(k){return"shape["+k+"]"})).join(",")+","+B.map((function(k){return"stride["+k+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",C.join("\n"))(O[k],o)}var O={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};k.exports=function(k,Q,i,Z){if(void 0===k)return(0,O.array[0])([]);"number"===typeof k&&(k=[k]),void 0===Q&&(Q=[k.length]);var B=Q.length;if(void 0===i){i=new Array(B);for(var o=B-1,J=1;o>=0;--o)i[o]=J,J*=Q[o]}if(void 0===Z){Z=0;for(o=0;o<B;++o)i[o]<0&&(Z-=(Q[o]-1)*i[o])}for(var G=function(k){if(U(k))return"buffer";if(C)switch(Object.prototype.toString.call(k)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(k)?"array":"generic"}(k),H=O[G];H.length<=B+1;)H.push(m(G,H.length-1));return(0,H[B+1])(k,Q,i,Z)}},13295:k=>{function Q(k){return!!k.constructor&&"function"===typeof k.constructor.isBuffer&&k.constructor.isBuffer(k)}k.exports=function(k){return null!=k&&(Q(k)||function(k){return"function"===typeof k.readFloatLE&&"function"===typeof k.slice&&Q(k.slice(0,0))}(k)||!!k._isBuffer)}},13438:k=>{"use strict";var Q=[],i=[],Z=[],U=[],C=[],B=[],o=[],m=[],O=[],J=[],G=[],H=[];k.exports=function(k,e,F,z,E,l){for(var h=o,c=O,f=J,Y=H,y=0;y<3;y++)h[y]=+F[y],f[y]=+e.max[y],c[y]=+e.base[y];l||(l=1e-10);var L=function(k,o,O,J,H,e){var F=Q,z=i,E=Z,l=U,h=C,c=B,f=m,Y=Math.floor,y=0,L=0,s=0,u=0,a=0;if(j(),0===s)return 0;for(u=v();L<=s;){if(T(u)&&K())return y;u=v()}for(y+=s,a=0;a<3;a++)J[a]+=O[a],H[a]+=O[a];return y;function j(){if(L=0,0!==(s=Math.sqrt(O[0]*O[0]+O[1]*O[1]+O[2]*O[2])))for(var k=0;k<3;k++){var Q=O[k]>=0;l[k]=Q?1:-1;var i=Q?H[k]:J[k];F[k]=Q?J[k]:H[k],z[k]=N(i,l[k]),E[k]=X(F[k],l[k]),f[k]=O[k]/s,h[k]=Math.abs(1/f[k]);var Z=Q?z[k]+1-i:i-z[k];c[k]=h[k]<1/0?h[k]*Z:1/0}}function T(Q){for(var i=l[0],Z=0===Q?z[0]:E[0],U=z[0]+i,C=l[1],B=1===Q?z[1]:E[1],o=z[1]+C,m=l[2],O=2===Q?z[2]:E[2],J=z[2]+m,G=Z;G!=U;G+=i)for(var H=B;H!=o;H+=C)for(var e=O;e!=J;e+=m)if(k(G,H,e))return!0;return!1}function K(){y+=L;var k=l[u],Q=L/s,i=G;for(a=0;a<3;a++){var Z=O[a]*Q;J[a]+=Z,H[a]+=Z,i[a]=O[a]-Z}if(k>0?H[u]=Math.round(H[u]):J[u]=Math.round(J[u]),o(y,u,k,i))return!0;for(a=0;a<3;a++)O[a]=i[a];return j(),0===s}function v(){var k=c[0]<c[1]?c[0]<c[2]?0:2:c[1]<c[2]?1:2,Q=c[k]-L;for(L=c[k],z[k]+=l[k],c[k]+=h[k],a=0;a<3;a++)F[a]+=Q*f[a],E[a]=X(F[a],l[a]);return k}function N(k,Q){return Y(k-Q*e)}function X(k,Q){return Y(k+Q*e)}}(k,z,h,c,f,l);if(!E){for(y=0;y<3;y++)Y[y]=F[y]>0?f[y]-e.max[y]:c[y]-e.base[y];e.translate(Y)}return L}},13601:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>G});var Z=i(13429),U=i(12134);class C{constructor(k,Q,i,C,B,o,m){this.TO=new Z(k.base,k.qO),this.YU=Q,this.friction=i,this.restitution=C,this.XB=B,this.Oe=o,this.pB=!!m,this.SO=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.JF=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.UO=U.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=U.create(),this._impulses=U.create(),this._sleepFrameCount=10}loadFromCopy(k){U.j(this.TO.base,k.TO.base),U.j(this.TO.qO,k.TO.qO),U.j(this.TO.max,k.TO.max),this.TO.mag=k.TO.mag,this.YU=k.YU,this.friction=k.friction,this.restitution=k.restitution,this.XB=k.XB,this.Oe=k.Oe,this.pB=k.pB,this.SO=k.SO,this.fluidDrag=k.fluidDrag,this.JF=k.JF,this.preventFallOffEdge=k.preventFallOffEdge,this.rolledBackLastTick=k.rolledBackLastTick,U.j(this.UO,k.UO),U.j(this.resting,k.resting),this.inFluid=k.inFluid,this._ratioInFluid=k._ratioInFluid,U.j(this._forces,k._forces),U.j(this._impulses,k._impulses),this._sleepFrameCount=k._sleepFrameCount}setPosition(k){B(k),U.EQ(k,k,this.TO.base),this.TO.translate(k),this.oO()}ci(){return U.clone(this.TO.base)}applyForce(k){B(k),U.add(this._forces,this._forces,k),this.oO()}applyImpulse(k){B(k),U.add(this._impulses,this._impulses,k),this.oO()}oO(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var B=k=>{};var o=i(13429),m=i(12134),O=i(13438);function J(){this.SO=.1,this.fluidDrag=.4,this.WB=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function G(k,Q,i){k=Object.assign(new J,k),this.gravity=k.gravity||[0,-10,0],this.SO=k.SO||.1,this.WB=k.WB||2,this.fluidDrag=k.fluidDrag||.4,this.minBounceImpulse=k.minBounceImpulse,this.bodies=[],this.TH=k.TH,this.testSolid=Q,this.testFluid=i}G.prototype.he=function(k,Q,i,Z,U,B){k=k||new o([0,0,0],[1,1,1]),"undefined"==typeof Q&&(Q=1),"undefined"==typeof i&&(i=1),"undefined"==typeof Z&&(Z=0),"undefined"==typeof U&&(U=1);var m=new C(k,Q,i,Z,U,B);return this.bodies.push(m),m},G.prototype.ce=function(k){var Q=this.bodies.indexOf(k);Q<0||(this.bodies.splice(Q,1),k.TO=k.Oe=null)};var H=m.create(),e=m.create(),F=m.create(),z=m.create(),E=m.create(),l=m.create(),h=m.create(),c=new o([0,0,0],[1,1,1]),f=new C(c,1,1,0,1,(()=>{}),!1);function Y(k,Q,i){return Q=i,Q*=1-(1-k.ratioInFluid)**2}G.prototype.VB=function(k){k/=1e3;var Q=M(0,m.squaredLength(this.gravity));this.bodies.forEach((i=>function(k,Q,i,Z){m.j(E,Q.resting),k.TH&&f.loadFromCopy(Q);if(Q.YU<=0)return m.set(Q.UO,0,0,0),m.set(Q._forces,0,0,0),void m.set(Q._impulses,0,0,0);var U=Z||0===Q.XB;if(function(k,Q,i,Z){if(Q._sleepFrameCount>0)return!1;if(Z)return!0;var U=!1,C=.5*i*i*Q.XB;return m.scale(D,k.gravity,C),O(k.testSolid,Q.TO,D,(function(){return U=!0,!0}),!0),U}(k,Q,i,U))return;Q._sleepFrameCount--,function(k,Q){var i=Q.TO,Z=Math.floor(i.base[0]),U=Math.floor(i.base[2]),C=Math.floor(i.base[1]),B=Math.floor(i.max[1]);if(!k.testFluid(Z,C,U))return Q.inFluid=!1,void(Q.ratioInFluid=0);var o=1,O=C+1;for(;O<=B&&k.testFluid(Z,O,U);)o++,O++;var J=(C+o-i.base[1])/i.qO[1];J>1&&(J=1);var G=i.qO[0]*i.qO[1]*i.qO[2]*J,H=L;m.scale(H,k.gravity,-k.WB*G*Q.XB),Q.applyForce(H),Q.inFluid=!0,Q.ratioInFluid=J}(k,Q),A(Q._forces),A(Q._impulses),A(Q.UO),A(Q.resting),m.scale(H,Q._forces,1/Q.YU),m.SB(H,H,k.gravity,Q.XB),m.scale(e,Q._impulses,1/Q.YU),m.SB(e,e,H,i),m.add(Q.UO,Q.UO,e),Q.friction&&(s(k,0,Q,e,i),s(k,1,Q,e,i),s(k,2,Q,e,i));var C=Q.fluidDrag>=0?Q.fluidDrag:k.fluidDrag,B=Q.SO>=0?Q.SO:k.SO,o=B,J=B;Q.inFluid&&(o=Y(Q,o,Q.fluidDragHoriz>=0?Q.fluidDragHoriz:C),J=Y(Q,J,Q.fluidDragVert>=0?Q.fluidDragVert:C));o=Math.max(1-o*i/Q.YU,0),J=Math.max(1-J*i/Q.YU,0),m.set(y,o,J,o),m.multiply(Q.UO,Q.UO,y),m.scale(F,Q.UO,i),m.set(Q._forces,0,0,0),m.set(Q._impulses,0,0,0),Q.pB&&W(j,Q.TO);m.j(l,F),m.set(h,0,0,0),Q.preventFallOffEdge&&function(k,Q,i,Z){if(!Q.resting[1]||i[1]>0)return;var U=p;W(U,Q.TO);for(var C=0;C<3;C+=2){m.set(X,0,0,0),X[C]=i[C];var B=!0;(B=(B=(B=(B=B&&!b(k,U.base[0]+X[0]+1e-5,U.base[1],U.base[2]+X[2]+1e-5))&&!b(k,U.max[0]+X[0]-1e-5,U.base[1],U.base[2]+X[2]+1e-5))&&!b(k,U.base[0]+X[0]+1e-5,U.base[1],U.max[2]+X[2]-1e-5))&&!b(k,U.max[0]+X[0]-1e-5,U.base[1],U.max[2]+X[2]-1e-5))?(Z[C]=i[C]>0?1:-1,i[C]=0):0===C&&(m.set(d,i[0],0,0),a(k,U,d,Z,Q.slideOnCollision))}}(k,Q,F,h);a(k,Q.TO,F,Q.resting,Q.slideOnCollision),Q.pB&&function(k,Q,i,Z){if(Q.resting[1]>=0&&!Q.inFluid)return;var U=0!==Q.resting[0],C=0!==Q.resting[2];if(!U&&!C)return;var B=Math.abs(Z[0]/Z[2]),o=4;if(!U&&B>o)return;if(!C&&B<1/o)return;m.add(K,i.base,Z);var J=k.testSolid;O(J,i,Z,(function(k,Q,i,Z){if(1!==Q)return!0;Z[Q]=0}));var G=i.base[1],H=Q.inFluid?1.951:1.001,e=Math.floor(G+H)-G;m.set(v,0,e,0);var F=!1;if(O(J,i,v,(function(k,Q,i,Z){return F=!0,!0})),F)return;m.EQ(N,K,i.base),N[1]=0,a(k,i,N,T,!0);var z=M(i.base[0],K[0]),E=M(i.base[2],K[2]);if(U&&!z&&(!E||!C))return;if(C&&(!z||!U)&&!E)return;var l=!0;if(l=l&&!b(k,i.base[0]+1e-5,i.base[1],i.base[2]+1e-5),l=l&&!b(k,i.max[0]-1e-5,i.base[1],i.base[2]+1e-5),l=l&&!b(k,i.base[0]+1e-5,i.base[1],i.max[2]-1e-5),l=l&&!b(k,i.max[0]-1e-5,i.base[1],i.max[2]-1e-5),l)return;W(Q.TO,i),Q.resting[0]=T[0],Q.resting[2]=T[2],Q.JF&&Q.JF()}(k,Q,j,l);for(var G=0;G<3;++G)Q.resting[G]=Q.resting[G]||h[G],z[G]=0,Q.resting[G]&&(E[G]||(z[G]=-Q.UO[G]),Q.UO[G]=0);var c=m.length(z);c>.001&&(m.scale(z,z,Q.YU),Q.Oe&&Q.Oe(z),Q.restitution>0&&c>k.minBounceImpulse&&(m.scale(z,z,Q.restitution),Q.applyImpulse(z)));var u=m.squaredLength(Q.UO);u>1e-5&&Q.oO();k.TH&&k.TH(Q)?(Q.loadFromCopy(f),Q.rolledBackLastTick=!0):Q.rolledBackLastTick=!1}(this,i,k,Q)))};var y=m.create([0,0,0]);var L=m.create();function s(k,Q,i,Z,U){var C=i.resting[Q],B=Z[Q];if(!i.alwaysApplyHorizFriction||1!==Q){if(0===C)return;if(C*B<=0)return}m.j(u,i.UO),u[Q]=0;var o=m.length(u);if(!M(o,0)){var O=Math.abs(i.friction*k.gravity[Q]*U),J=o>O?(o-O)/o:0;i.UO[(Q+1)%3]*=J,i.UO[(Q+2)%3]*=J}}var u=m.create();function a(k,Q,i,Z,U){return m.set(Z,0,0,0),O(k.testSolid,Q,i,(function(k,Q,i,C){Z[Q]=i,C[Q]=0,U||(C[0]=0,C[1]=0,C[2]=0)}))}var j=new o([],[]),T=m.create(),K=m.create(),v=m.create(),N=m.create();var X=m.create(),p=new o([],[]),d=m.create();function b(k,Q,i,Z){return k.testSolid(Math.floor(Q),Math.floor(i-1),Math.floor(Z))}var D=m.create();function M(k,Q){return Math.abs(k-Q)<1e-5}function W(k,Q){for(var i=0;i<3;i++)k.base[i]=Q.base[i],k.max[i]=Q.max[i],k.qO[i]=Q.qO[i]}var A=function(k){}},11979:function(k,Q){!function(k){"use strict";var Q=function(k,i){return Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,Q){k.__proto__=Q}||function(k,Q){for(var i in Q)Object.prototype.hasOwnProperty.call(Q,i)&&(k[i]=Q[i])},Q(k,i)};function i(k,i){if("function"!==typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function Z(){this.constructor=k}Q(k,i),k.prototype=null===i?Object.create(i):(Z.prototype=i.prototype,new Z)}function Z(k,Q,i,Z){var U,C=arguments.length,B=C<3?Q:null===Z?Z=Object.getOwnPropertyDescriptor(Q,i):Z;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)B=Reflect.decorate(k,Q,i,Z);else for(var o=k.length-1;o>=0;o--)(U=k[o])&&(B=(C<3?U(B):C>3?U(Q,i,B):U(Q,i))||B);return C>3&&B&&Object.defineProperty(Q,i,B),B}function U(k,Q,i){if(i||2===arguments.length)for(var Z,U=0,C=Q.length;U<C;U++)!Z&&U in Q||(Z||(Z=Array.prototype.slice.call(Q,0,U)),Z[U]=Q[U]);return k.concat(Z||Array.prototype.slice.call(Q))}var C,B=255,o=213;k.OPERATION=void 0,(C=k.OPERATION||(k.OPERATION={}))[C.ADD=128]="ADD",C[C.REPLACE=0]="REPLACE",C[C.DELETE=64]="DELETE",C[C.DELETE_AND_ADD=192]="DELETE_AND_ADD",C[C.TOUCH=1]="TOUCH",C[C.CLEAR=10]="CLEAR";var m=function(){function Q(k,Q,i){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=k,this.setParent(Q,i)}return Q.prototype.setParent=function(k,Q,i){var Z=this;if(this.indexes||(this.indexes=this.ref instanceof Nk?this.ref._definition.indexes:{}),this.parent=k,this.parentIndex=i,Q)if(this.root=Q,this.ref instanceof Nk){var U=this.ref._definition;for(var C in U.schema){var B=this.ref[C];if(B&&B.$changes){var o=U.indexes[C];B.$changes.setParent(this.ref,Q,o)}}}else"object"===typeof this.ref&&this.ref.forEach((function(k,Q){if(k instanceof Nk){var i=k.$changes,U=Z.ref.$changes.indexes[Q];i.setParent(Z.ref,Z.root,U)}}))},Q.prototype.operation=function(k){this.changes.set(--this.currentCustomOperation,k)},Q.prototype.change=function(Q,i){void 0===i&&(i=k.OPERATION.ADD);var Z="number"===typeof Q?Q:this.indexes[Q];this.assertValidIndex(Z,Q);var U=this.changes.get(Z);U&&U.op!==k.OPERATION.DELETE&&U.op!==k.OPERATION.TOUCH||this.changes.set(Z,{op:U&&U.op===k.OPERATION.DELETE?k.OPERATION.DELETE_AND_ADD:i,index:Z}),this.allChanges.add(Z),this.changed=!0,this.touchParents()},Q.prototype.touch=function(Q){var i="number"===typeof Q?Q:this.indexes[Q];this.assertValidIndex(i,Q),this.changes.has(i)||this.changes.set(i,{op:k.OPERATION.TOUCH,index:i}),this.allChanges.add(i),this.touchParents()},Q.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},Q.prototype.getType=function(k){if(this.ref._definition)return(Q=this.ref._definition).schema[Q.fieldsByIndex[k]];var Q,i=(Q=this.parent._definition).schema[Q.fieldsByIndex[this.parentIndex]];return Object.values(i)[0]},Q.prototype.getChildrenFilter=function(){var k=this.parent._definition.childFilters;return k&&k[this.parentIndex]},Q.prototype.getValue=function(k){return this.ref.getByIndex(k)},Q.prototype.delete=function(Q){var i="number"===typeof Q?Q:this.indexes[Q];if(void 0!==i){var Z=this.getValue(i);this.changes.set(i,{op:k.OPERATION.DELETE,index:i}),this.allChanges.delete(i),delete this.caches[i],Z&&Z.$changes&&(Z.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(Q," (").concat(i,")"))},Q.prototype.discard=function(Q,i){var Z=this;void 0===Q&&(Q=!1),void 0===i&&(i=!1),this.ref instanceof Nk||this.changes.forEach((function(Q){if(Q.op===k.OPERATION.DELETE){var i=Z.ref.getIndex(Q.index);delete Z.indexes[i]}})),this.changes.clear(),this.changed=Q,i&&this.allChanges.clear(),this.currentCustomOperation=0},Q.prototype.discardAll=function(){var k=this;this.changes.forEach((function(Q){var i=k.getValue(Q.index);i&&i.$changes&&i.$changes.discardAll()})),this.discard()},Q.prototype.cache=function(k,Q){this.caches[k]=Q},Q.prototype.clone=function(){return new Q(this.ref,this.parent,this.root)},Q.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},Q.prototype.assertValidIndex=function(k,Q){if(void 0===k)throw new Error('ChangeTree: missing index for field "'.concat(Q,'"'))},Q}();function O(k,Q,i,Z){return k[Q]||(k[Q]=[]),k[Q].push(i),null===Z||void 0===Z||Z.forEach((function(k,Q){return i(k,Q)})),function(){return G(k[Q],k[Q].indexOf(i))}}function J(Q){var i=this,Z="string"!==typeof this.$changes.getType();this.$items.forEach((function(U,C){Q.push({refId:i.$changes.refId,op:k.OPERATION.DELETE,field:C,value:void 0,previousValue:U}),Z&&i.$changes.root.removeRef(U.$changes.refId)}))}function G(k,Q){if(-1===Q||Q>=k.length)return!1;for(var i=k.length-1,Z=Q;Z<i;Z++)k[Z]=k[Z+1];return k.length=i,!0}var H=function(k,Q){var i=k.toString(),Z=Q.toString();return i<Z?-1:i>Z?1:0};function e(k){return k.$proxy=!0,k=new Proxy(k,{get:function(k,Q){return"symbol"===typeof Q||isNaN(Q)?k[Q]:k.at(Q)},set:function(k,Q,i){if("symbol"===typeof Q||isNaN(Q))k[Q]=i;else{var Z=Array.from(k.$items.keys()),U=parseInt(Z[Q]||Q);void 0===i||null===i?k.deleteAt(U):k.setAt(U,i)}return!0},deleteProperty:function(k,Q){return"number"===typeof Q?k.deleteAt(Q):delete k[Q],!0}})}var F=function(){function Q(){for(var k=[],Q=0;Q<arguments.length;Q++)k[Q]=arguments[Q];this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,k)}return Q.prototype.so=function(Q,i){return void 0===i&&(i=!0),O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.ADD,Q,i?this.$items:void 0)},Q.prototype.ki=function(Q){return O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.DELETE,Q)},Q.prototype.onChange=function(Q){return O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.REPLACE,Q)},Q.is=function(k){return Array.isArray(k)||void 0!==k.array},Object.defineProperty(Q.prototype,"length",{get:function(){return this.$items.size},set:function(k){0===k?this.clear():this.splice(k,this.length-k)},enumerable:!1,configurable:!0}),Q.prototype.push=function(){for(var k,Q=this,i=[],Z=0;Z<arguments.length;Z++)i[Z]=arguments[Z];return i.forEach((function(i){k=Q.$refId++,Q.setAt(k,i)})),k},Q.prototype.pop=function(){var k=Array.from(this.$indexes.values()).pop();if(void 0!==k){this.$changes.delete(k),this.$indexes.delete(k);var Q=this.$items.get(k);return this.$items.delete(k),Q}},Q.prototype.at=function(k){var Q=Array.from(this.$items.keys())[k];return this.$items.get(Q)},Q.prototype.setAt=function(Q,i){var Z,U;if(void 0!==i&&null!==i){if(this.$items.get(Q)!==i){void 0!==i.$changes&&i.$changes.setParent(this,this.$changes.root,Q);var C=null!==(U=null===(Z=this.$changes.indexes[Q])||void 0===Z?void 0:Z.op)&&void 0!==U?U:k.OPERATION.ADD;this.$changes.indexes[Q]=Q,this.$indexes.set(Q,Q),this.$items.set(Q,i),this.$changes.change(Q,C)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},Q.prototype.deleteAt=function(k){var Q=Array.from(this.$items.keys())[k];return void 0!==Q&&this.$deleteAt(Q)},Q.prototype.$deleteAt=function(k){return this.$changes.delete(k),this.$indexes.delete(k),this.$items.delete(k)},Q.prototype.clear=function(Q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Q&&J.call(this,Q),this.$items.clear(),this.$changes.operation({index:0,op:k.OPERATION.CLEAR}),this.$changes.touchParents()},Q.prototype.concat=function(){for(var k,i=[],Z=0;Z<arguments.length;Z++)i[Z]=arguments[Z];return new(Q.bind.apply(Q,U([void 0],(k=Array.from(this.$items.values())).concat.apply(k,i),!1)))},Q.prototype.join=function(k){return Array.from(this.$items.values()).join(k)},Q.prototype.reverse=function(){var k=this,Q=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(i,Z){k.setAt(Q[Z],i)})),this},Q.prototype.shift=function(){var k=Array.from(this.$items.keys()).shift();if(void 0!==k){var Q=this.$items.get(k);return this.$deleteAt(k),Q}},Q.prototype.slice=function(k,i){var Z=new Q;return Z.push.apply(Z,Array.from(this.$items.values()).slice(k,i)),Z},Q.prototype.sort=function(k){var Q=this;void 0===k&&(k=H);var i=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(k).forEach((function(k,Z){Q.setAt(i[Z],k)})),this},Q.prototype.splice=function(k,Q){void 0===Q&&(Q=this.length-k);for(var i=Array.from(this.$items.keys()),Z=[],U=k;U<k+Q;U++)Z.push(this.$items.get(i[U])),this.$deleteAt(i[U]);return Z},Q.prototype.unshift=function(){for(var k=this,Q=[],i=0;i<arguments.length;i++)Q[i]=arguments[i];var Z=this.length,U=Q.length,C=Array.from(this.$items.values());return Q.forEach((function(Q,i){k.setAt(i,Q)})),C.forEach((function(Q,i){k.setAt(U+i,Q)})),Z+U},Q.prototype.indexOf=function(k,Q){return Array.from(this.$items.values()).indexOf(k,Q)},Q.prototype.lastIndexOf=function(k,Q){return void 0===Q&&(Q=this.length-1),Array.from(this.$items.values()).lastIndexOf(k,Q)},Q.prototype.every=function(k,Q){return Array.from(this.$items.values()).every(k,Q)},Q.prototype.some=function(k,Q){return Array.from(this.$items.values()).some(k,Q)},Q.prototype.forEach=function(k,Q){Array.from(this.$items.values()).forEach(k,Q)},Q.prototype.map=function(k,Q){return Array.from(this.$items.values()).map(k,Q)},Q.prototype.filter=function(k,Q){return Array.from(this.$items.values()).filter(k,Q)},Q.prototype.reduce=function(k,Q){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},Q.prototype.reduceRight=function(k,Q){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},Q.prototype.find=function(k,Q){return Array.from(this.$items.values()).find(k,Q)},Q.prototype.findIndex=function(k,Q){return Array.from(this.$items.values()).findIndex(k,Q)},Q.prototype.fill=function(k,Q,i){throw new Error("ArraySchema#fill() not implemented")},Q.prototype.copyWithin=function(k,Q,i){throw new Error("ArraySchema#copyWithin() not implemented")},Q.prototype.toString=function(){return this.$items.toString()},Q.prototype.toLocaleString=function(){return this.$items.toLocaleString()},Q.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(Q,Symbol.species,{get:function(){return Q},enumerable:!1,configurable:!0}),Q.prototype.entries=function(){return this.$items.entries()},Q.prototype.keys=function(){return this.$items.keys()},Q.prototype.values=function(){return this.$items.values()},Q.prototype.includes=function(k,Q){return Array.from(this.$items.values()).includes(k,Q)},Q.prototype.flatMap=function(k,Q){throw new Error("ArraySchema#flatMap() is not supported.")},Q.prototype.flat=function(k){throw new Error("ArraySchema#flat() is not supported.")},Q.prototype.findLast=function(){var k=Array.from(this.$items.values());return k.findLast.apply(k,arguments)},Q.prototype.findLastIndex=function(){var k=Array.from(this.$items.values());return k.findLastIndex.apply(k,arguments)},Q.prototype.setIndex=function(k,Q){this.$indexes.set(k,Q)},Q.prototype.getIndex=function(k){return this.$indexes.get(k)},Q.prototype.getByIndex=function(k){return this.$items.get(this.$indexes.get(k))},Q.prototype.deleteByIndex=function(k){var Q=this.$indexes.get(k);this.$items.delete(Q),this.$indexes.delete(k)},Q.prototype.toArray=function(){return Array.from(this.$items.values())},Q.prototype.toJSON=function(){return this.toArray().map((function(k){return"function"===typeof k.toJSON?k.toJSON():k}))},Q.prototype.clone=function(k){return k?new(Q.bind.apply(Q,U([void 0],Array.from(this.$items.values()),!1))):new(Q.bind.apply(Q,U([void 0],this.map((function(k){return k.$changes?k.clone():k})),!1)))},Q}();function z(k){return k.$proxy=!0,k=new Proxy(k,{get:function(k,Q){return"symbol"!==typeof Q&&"undefined"===typeof k[Q]?k.get(Q):k[Q]},set:function(k,Q,i){return"symbol"!==typeof Q&&-1===Q.indexOf("$")&&"so"!==Q&&"ki"!==Q&&"onChange"!==Q?k.set(Q,i):k[Q]=i,!0},deleteProperty:function(k,Q){return k.delete(Q),!0}})}var E=function(){function Q(k){var i=this;if(this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,k)if(k instanceof Map||k instanceof Q)k.forEach((function(k,Q){return i.set(Q,k)}));else for(var Z in k)this.set(Z,k[Z])}return Q.prototype.so=function(Q,i){return void 0===i&&(i=!0),O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.ADD,Q,i?this.$items:void 0)},Q.prototype.ki=function(Q){return O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.DELETE,Q)},Q.prototype.onChange=function(Q){return O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.REPLACE,Q)},Q.is=function(k){return void 0!==k.map},Q.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(Q.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(Q,Symbol.species,{get:function(){return Q},enumerable:!1,configurable:!0}),Q.prototype.set=function(Q,i){if(void 0===i||null===i)throw new Error("MapSchema#set('".concat(Q,"', ").concat(i,"): trying to set ").concat(i," value on '").concat(Q,"'."));Q=Q.toString();var Z="undefined"!==typeof this.$changes.indexes[Q],U=Z?this.$changes.indexes[Q]:this.$refId++,C=Z?k.OPERATION.REPLACE:k.OPERATION.ADD,B=void 0!==i.$changes;if(B&&i.$changes.setParent(this,this.$changes.root,U),Z){if(!B&&this.$items.get(Q)===i)return;B&&this.$items.get(Q)!==i&&(C=k.OPERATION.ADD)}else this.$changes.indexes[Q]=U,this.$indexes.set(U,Q);return this.$items.set(Q,i),this.$changes.change(Q,C),this},Q.prototype.get=function(k){return this.$items.get(k)},Q.prototype.delete=function(k){return this.$changes.delete(k),this.$items.delete(k)},Q.prototype.clear=function(Q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Q&&J.call(this,Q),this.$items.clear(),this.$changes.operation({index:0,op:k.OPERATION.CLEAR}),this.$changes.touchParents()},Q.prototype.has=function(k){return this.$items.has(k)},Q.prototype.forEach=function(k){this.$items.forEach(k)},Q.prototype.entries=function(){return this.$items.entries()},Q.prototype.keys=function(){return this.$items.keys()},Q.prototype.values=function(){return this.$items.values()},Object.defineProperty(Q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Q.prototype.setIndex=function(k,Q){this.$indexes.set(k,Q)},Q.prototype.getIndex=function(k){return this.$indexes.get(k)},Q.prototype.getByIndex=function(k){return this.$items.get(this.$indexes.get(k))},Q.prototype.deleteByIndex=function(k){var Q=this.$indexes.get(k);this.$items.delete(Q),this.$indexes.delete(k)},Q.prototype.toJSON=function(){var k={};return this.forEach((function(Q,i){k[i]="function"===typeof Q.toJSON?Q.toJSON():Q})),k},Q.prototype.clone=function(k){var i;return k?i=Object.assign(new Q,this):(i=new Q,this.forEach((function(k,Q){k.$changes?i.set(Q,k.clone()):i.set(Q,k)}))),i},Q}(),l={};function h(k,Q){l[k]=Q}function c(k){return l[k]}var f=function(){function k(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return k.create=function(Q){var i=new k;return i.schema=Object.assign({},Q&&Q.schema||{}),i.indexes=Object.assign({},Q&&Q.indexes||{}),i.fieldsByIndex=Object.assign({},Q&&Q.fieldsByIndex||{}),i.descriptors=Object.assign({},Q&&Q.descriptors||{}),i.deprecated=Object.assign({},Q&&Q.deprecated||{}),i},k.prototype.addField=function(k,Q){var i=this.getNextFieldIndex();this.fieldsByIndex[i]=k,this.indexes[k]=i,this.schema[k]=Array.isArray(Q)?{array:Q[0]}:Q},k.prototype.hasField=function(k){return void 0!==this.indexes[k]},k.prototype.addFilter=function(k,Q){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[k]]=Q,this.indexesWithFilters.push(this.indexes[k]),!0},k.prototype.addChildrenFilter=function(k,Q){var i=this.indexes[k],Z=this.schema[k];if(c(Object.keys(Z)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[i]=Q,!0;console.warn("@filterChildren: field '".concat(k,"' can't have children. Ignoring filter."))},k.prototype.getChildrenFilter=function(k){return this.childFilters&&this.childFilters[this.indexes[k]]},k.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},k}();function Y(k){return k._context&&k._context.useFilters}var y=function(){function k(){this.types={},this.schemas=new Map,this.useFilters=!1}return k.prototype.has=function(k){return this.schemas.has(k)},k.prototype.get=function(k){return this.types[k]},k.prototype.add=function(k,Q){void 0===Q&&(Q=this.schemas.size),k._definition=f.create(k._definition),k._typeid=Q,this.types[Q]=k,this.schemas.set(k,Q)},k.create=function(Q){return void 0===Q&&(Q={}),function(i){return Q.context||(Q.context=new k),s(i,Q)}},k}(),L=new y;function s(k,Q){return void 0===Q&&(Q={}),function(i,Z){var C=Q.context||L,B=i.constructor;if(B._context=C,!k)throw new Error("".concat(B.name,': @type() reference provided for "').concat(Z,"\" is undefined. Make sure you don't have any circular dependencies."));C.has(B)||C.add(B);var o=B._definition;if(o.addField(Z,k),o.descriptors[Z]){if(o.deprecated[Z])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(Z,"' definition on '").concat(B.name,"'.\nCheck @type() annotation"))}catch(l){var m=l.stack.split("\n")[4].trim();throw new Error("".concat(l.message," ").concat(m))}}var O=F.is(k),J=!O&&E.is(k);if("string"!==typeof k&&!Nk.is(k)){var G=Object.values(k)[0];"string"===typeof G||C.has(G)||C.add(G)}if(Q.manual)o.descriptors[Z]={enumerable:!0,configurable:!0,writable:!0};else{var H="_".concat(Z);o.descriptors[H]={enumerable:!1,configurable:!1,writable:!0},o.descriptors[Z]={get:function(){return this[H]},set:function(k){k!==this[H]&&(void 0!==k&&null!==k?(!O||k instanceof F||(k=new(F.bind.apply(F,U([void 0],k,!1)))),!J||k instanceof E||(k=new E(k)),void 0===k.$proxy&&(J?k=z(k):O&&(k=e(k))),this.$changes.change(Z),k.$changes&&k.$changes.setParent(this,this.$changes.root,this._definition.indexes[Z])):this[H]&&this.$changes.delete(Z),this[H]=k)},enumerable:!0,configurable:!0}}}}function u(k){return function(Q,i){var Z=Q.constructor;Z._definition.addFilter(i,k)&&(Z._context.useFilters=!0)}}function a(k){return function(Q,i){var Z=Q.constructor;Z._definition.addChildrenFilter(i,k)&&(Z._context.useFilters=!0)}}function j(k){return void 0===k&&(k=!0),function(Q,i){var Z=Q.constructor._definition;Z.deprecated[i]=!0,k&&(Z.descriptors[i]={get:function(){throw new Error("".concat(i," is deprecated."))},set:function(k){},enumerable:!1,configurable:!0})}}function T(k,Q,i){for(var Z in void 0===i&&(i={}),i.context||(i.context=k._context||i.context||L),Q)s(Q[Z],i)(k.prototype,Z);return k}function K(k){for(var Q=0,i=0,Z=0,U=k.length;Z<U;Z++)(Q=k.charCodeAt(Z))<128?i+=1:Q<2048?i+=2:Q<55296||Q>=57344?i+=3:(Z++,i+=4);return i}function v(k,Q,i){for(var Z=0,U=0,C=i.length;U<C;U++)(Z=i.charCodeAt(U))<128?k[Q++]=Z:Z<2048?(k[Q++]=192|Z>>6,k[Q++]=128|63&Z):Z<55296||Z>=57344?(k[Q++]=224|Z>>12,k[Q++]=128|Z>>6&63,k[Q++]=128|63&Z):(U++,Z=65536+((1023&Z)<<10|1023&i.charCodeAt(U)),k[Q++]=240|Z>>18,k[Q++]=128|Z>>12&63,k[Q++]=128|Z>>6&63,k[Q++]=128|63&Z)}function N(k,Q){k.push(255&Q)}function X(k,Q){k.push(255&Q)}function p(k,Q){k.push(255&Q),k.push(Q>>8&255)}function d(k,Q){k.push(255&Q),k.push(Q>>8&255)}function b(k,Q){k.push(255&Q),k.push(Q>>8&255),k.push(Q>>16&255),k.push(Q>>24&255)}function D(k,Q){var i=Q>>24,Z=Q>>16,U=Q>>8,C=Q;k.push(255&C),k.push(255&U),k.push(255&Z),k.push(255&i)}function M(k,Q){var i=Math.floor(Q/Math.pow(2,32));D(k,Q>>>0),D(k,i)}function W(k,Q){var i=Q/Math.pow(2,32)|0;D(k,Q>>>0),D(k,i)}function A(k,Q){q(k,Q)}function g(k,Q){P(k,Q)}var R=new Int32Array(2),w=new Float32Array(R.buffer),S=new Float64Array(R.buffer);function q(k,Q){w[0]=Q,b(k,R[0])}function P(k,Q){S[0]=Q,b(k,R[0]),b(k,R[1])}function t(k,Q){return X(k,Q?1:0)}function I(k,Q){Q||(Q="");var i=K(Q),Z=0;if(i<32)k.push(160|i),Z=1;else if(i<256)k.push(217),X(k,i),Z=2;else if(i<65536)k.push(218),d(k,i),Z=3;else{if(!(i<4294967296))throw new Error("String too long");k.push(219),D(k,i),Z=5}return v(k,k.length,Q),Z+i}function r(k,Q){return isNaN(Q)?r(k,0):isFinite(Q)?Q!==(0|Q)?(k.push(203),P(k,Q),9):Q>=0?Q<128?(X(k,Q),1):Q<256?(k.push(204),X(k,Q),2):Q<65536?(k.push(205),d(k,Q),3):Q<4294967296?(k.push(206),D(k,Q),5):(k.push(207),W(k,Q),9):Q>=-32?(k.push(224|Q+32),1):Q>=-128?(k.push(208),N(k,Q),2):Q>=-32768?(k.push(209),p(k,Q),3):Q>=-2147483648?(k.push(210),b(k,Q),5):(k.push(211),M(k,Q),9):r(k,Q>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var n=Object.freeze({__proto__:null,utf8Write:v,int8:N,uint8:X,int16:p,uint16:d,int32:b,uint32:D,int64:M,uint64:W,float32:A,float64:g,writeFloat32:q,writeFloat64:P,boolean:t,string:I,number:r});function x(k,Q,i){for(var Z="",U=0,C=Q,B=Q+i;C<B;C++){var o=k[C];0!==(128&o)?192!==(224&o)?224!==(240&o)?240!==(248&o)?console.error("Invalid byte "+o.toString(16)):(U=(7&o)<<18|(63&k[++C])<<12|(63&k[++C])<<6|63&k[++C])>=65536?(U-=65536,Z+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):Z+=String.fromCharCode(U):Z+=String.fromCharCode((15&o)<<12|(63&k[++C])<<6|63&k[++C]):Z+=String.fromCharCode((31&o)<<6|63&k[++C]):Z+=String.fromCharCode(o)}return Z}function V(k,Q){return kk(k,Q)<<24>>24}function kk(k,Q){return k[Q.offset++]}function Qk(k,Q){return ik(k,Q)<<16>>16}function ik(k,Q){return k[Q.offset++]|k[Q.offset++]<<8}function Zk(k,Q){return k[Q.offset++]|k[Q.offset++]<<8|k[Q.offset++]<<16|k[Q.offset++]<<24}function Uk(k,Q){return Zk(k,Q)>>>0}function Ck(k,Q){return Hk(k,Q)}function Bk(k,Q){return ek(k,Q)}function ok(k,Q){var i=Uk(k,Q);return Zk(k,Q)*Math.pow(2,32)+i}function mk(k,Q){var i=Uk(k,Q);return Uk(k,Q)*Math.pow(2,32)+i}var Ok=new Int32Array(2),Jk=new Float32Array(Ok.buffer),Gk=new Float64Array(Ok.buffer);function Hk(k,Q){return Ok[0]=Zk(k,Q),Jk[0]}function ek(k,Q){return Ok[0]=Zk(k,Q),Ok[1]=Zk(k,Q),Gk[0]}function Fk(k,Q){return kk(k,Q)>0}function zk(k,Q){var i,Z=k[Q.offset++];Z<192?i=31&Z:217===Z?i=kk(k,Q):218===Z?i=ik(k,Q):219===Z&&(i=Uk(k,Q));var U=x(k,Q.offset,i);return Q.offset+=i,U}function Ek(k,Q){var i=k[Q.offset];return i<192&&i>160||217===i||218===i||219===i}function lk(k,Q){var i=k[Q.offset++];return i<128?i:202===i?Hk(k,Q):203===i?ek(k,Q):204===i?kk(k,Q):205===i?ik(k,Q):206===i?Uk(k,Q):207===i?mk(k,Q):208===i?V(k,Q):209===i?Qk(k,Q):210===i?Zk(k,Q):211===i?ok(k,Q):i>223?-1*(255-i+1):void 0}function hk(k,Q){var i=k[Q.offset];return i<128||i>=202&&i<=211}function ck(k,Q){return k[Q.offset]<160}function fk(k,Q){return k[Q.offset-1]===B&&(k[Q.offset]<128||k[Q.offset]>=202&&k[Q.offset]<=211)}var Yk=Object.freeze({__proto__:null,int8:V,uint8:kk,int16:Qk,uint16:ik,int32:Zk,uint32:Uk,float32:Ck,float64:Bk,int64:ok,uint64:mk,readFloat32:Hk,readFloat64:ek,boolean:Fk,string:zk,stringCheck:Ek,number:lk,numberCheck:hk,arrayCheck:ck,switchStructureCheck:fk}),yk=function(){function Q(k){var Q=this;this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,k&&k.forEach((function(k){return Q.add(k)}))}return Q.prototype.so=function(Q,i){return void 0===i&&(i=!0),O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.ADD,Q,i?this.$items:void 0)},Q.prototype.ki=function(Q){return O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.DELETE,Q)},Q.prototype.onChange=function(Q){return O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.REPLACE,Q)},Q.is=function(k){return void 0!==k.collection},Q.prototype.add=function(k){var Q=this.$refId++;return void 0!==k.$changes&&k.$changes.setParent(this,this.$changes.root,Q),this.$changes.indexes[Q]=Q,this.$indexes.set(Q,Q),this.$items.set(Q,k),this.$changes.change(Q),Q},Q.prototype.at=function(k){var Q=Array.from(this.$items.keys())[k];return this.$items.get(Q)},Q.prototype.entries=function(){return this.$items.entries()},Q.prototype.delete=function(k){for(var Q,i,Z=this.$items.entries();(i=Z.next())&&!i.done;)if(k===i.value[1]){Q=i.value[0];break}return void 0!==Q&&(this.$changes.delete(Q),this.$indexes.delete(Q),this.$items.delete(Q))},Q.prototype.clear=function(Q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Q&&J.call(this,Q),this.$items.clear(),this.$changes.operation({index:0,op:k.OPERATION.CLEAR}),this.$changes.touchParents()},Q.prototype.has=function(k){return Array.from(this.$items.values()).some((function(Q){return Q===k}))},Q.prototype.forEach=function(k){var Q=this;this.$items.forEach((function(i,Z,U){return k(i,Z,Q)}))},Q.prototype.values=function(){return this.$items.values()},Object.defineProperty(Q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Q.prototype.setIndex=function(k,Q){this.$indexes.set(k,Q)},Q.prototype.getIndex=function(k){return this.$indexes.get(k)},Q.prototype.getByIndex=function(k){return this.$items.get(this.$indexes.get(k))},Q.prototype.deleteByIndex=function(k){var Q=this.$indexes.get(k);this.$items.delete(Q),this.$indexes.delete(k)},Q.prototype.toArray=function(){return Array.from(this.$items.values())},Q.prototype.toJSON=function(){var k=[];return this.forEach((function(Q,i){k.push("function"===typeof Q.toJSON?Q.toJSON():Q)})),k},Q.prototype.clone=function(k){var i;return k?i=Object.assign(new Q,this):(i=new Q,this.forEach((function(k){k.$changes?i.add(k.clone()):i.add(k)}))),i},Q}(),Lk=function(){function Q(k){var Q=this;this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,k&&k.forEach((function(k){return Q.add(k)}))}return Q.prototype.so=function(Q,i){return void 0===i&&(i=!0),O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.ADD,Q,i?this.$items:void 0)},Q.prototype.ki=function(Q){return O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.DELETE,Q)},Q.prototype.onChange=function(Q){return O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.REPLACE,Q)},Q.is=function(k){return void 0!==k.set},Q.prototype.add=function(Q){var i,Z;if(this.has(Q))return!1;var U=this.$refId++;void 0!==Q.$changes&&Q.$changes.setParent(this,this.$changes.root,U);var C=null!==(Z=null===(i=this.$changes.indexes[U])||void 0===i?void 0:i.op)&&void 0!==Z?Z:k.OPERATION.ADD;return this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,Q),this.$changes.change(U,C),U},Q.prototype.entries=function(){return this.$items.entries()},Q.prototype.delete=function(k){for(var Q,i,Z=this.$items.entries();(i=Z.next())&&!i.done;)if(k===i.value[1]){Q=i.value[0];break}return void 0!==Q&&(this.$changes.delete(Q),this.$indexes.delete(Q),this.$items.delete(Q))},Q.prototype.clear=function(Q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Q&&J.call(this,Q),this.$items.clear(),this.$changes.operation({index:0,op:k.OPERATION.CLEAR}),this.$changes.touchParents()},Q.prototype.has=function(k){for(var Q,i=this.$items.values(),Z=!1;(Q=i.next())&&!Q.done;)if(k===Q.value){Z=!0;break}return Z},Q.prototype.forEach=function(k){var Q=this;this.$items.forEach((function(i,Z,U){return k(i,Z,Q)}))},Q.prototype.values=function(){return this.$items.values()},Object.defineProperty(Q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Q.prototype.setIndex=function(k,Q){this.$indexes.set(k,Q)},Q.prototype.getIndex=function(k){return this.$indexes.get(k)},Q.prototype.getByIndex=function(k){return this.$items.get(this.$indexes.get(k))},Q.prototype.deleteByIndex=function(k){var Q=this.$indexes.get(k);this.$items.delete(Q),this.$indexes.delete(k)},Q.prototype.toArray=function(){return Array.from(this.$items.values())},Q.prototype.toJSON=function(){var k=[];return this.forEach((function(Q,i){k.push("function"===typeof Q.toJSON?Q.toJSON():Q)})),k},Q.prototype.clone=function(k){var i;return k?i=Object.assign(new Q,this):(i=new Q,this.forEach((function(k){k.$changes?i.add(k.clone()):i.add(k)}))),i},Q}(),sk=function(){function k(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return k.prototype.addRefId=function(k){this.refIds.has(k)||(this.refIds.add(k),this.containerIndexes.set(k,new Set))},k.get=function(Q){return void 0===Q.$filterState&&(Q.$filterState=new k),Q.$filterState},k}(),uk=function(){function k(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return k.prototype.getNextUniqueId=function(){return this.nextUniqueId++},k.prototype.addRef=function(k,Q,i){void 0===i&&(i=!0),this.refs.set(k,Q),i&&(this.refCounts[k]=(this.refCounts[k]||0)+1)},k.prototype.removeRef=function(k){this.refCounts[k]=this.refCounts[k]-1,this.deletedRefs.add(k)},k.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},k.prototype.garbageCollectDeletedRefs=function(){var k=this;this.deletedRefs.forEach((function(Q){if(!(k.refCounts[Q]>0)){var i=k.refs.get(Q);if(i instanceof Nk)for(var Z in i._definition.schema)"string"!==typeof i._definition.schema[Z]&&i[Z]&&i[Z].$changes&&k.removeRef(i[Z].$changes.refId);else{var U=i.$changes.parent._definition,C=U.schema[U.fieldsByIndex[i.$changes.parentIndex]];"function"===typeof Object.values(C)[0]&&Array.from(i.values()).forEach((function(Q){return k.removeRef(Q.$changes.refId)}))}k.refs.delete(Q),delete k.refCounts[Q]}})),this.deletedRefs.clear()},k}(),ak=function(k){function Q(){return null!==k&&k.apply(this,arguments)||this}return i(Q,k),Q}(Error);function jk(k,Q,i,Z){var U,C=!1;switch(Q){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":U="number",isNaN(k)&&console.log('trying to encode "NaN" in '.concat(i.constructor.name,"#").concat(Z));break;case"string":U="string",C=!0;break;case"boolean":return}if(typeof k!==U&&(!C||C&&null!==k)){var B="'".concat(JSON.stringify(k),"'").concat(k&&k.constructor&&" (".concat(k.constructor.name,")")||"");throw new ak("a '".concat(U,"' was expected, but ").concat(B," was provided in ").concat(i.constructor.name,"#").concat(Z))}}function Tk(k,Q,i,Z){if(!(k instanceof Q))throw new ak("a '".concat(Q.name,"' was expected, but '").concat(k.constructor.name,"' was provided in ").concat(i.constructor.name,"#").concat(Z))}function Kk(k,Q,i,Z,U){jk(i,k,Z,U);var C=n[k];if(!C)throw new ak("a '".concat(k,"' was expected, but ").concat(i," was provided in ").concat(Z.constructor.name,"#").concat(U));C(Q,i)}function vk(k,Q,i){return Yk[k](Q,i)}var Nk=function(){function Q(){for(var k=[],Q=0;Q<arguments.length;Q++)k[Q]=arguments[Q];Object.defineProperties(this,{$changes:{value:new m(this,void 0,new uk),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var i=this._definition.descriptors;i&&Object.defineProperties(this,i),k[0]&&this.assign(k[0])}return Q.onError=function(k){console.error(k)},Q.is=function(k){return k._definition&&void 0!==k._definition.schema},Q.prototype.onChange=function(Q){return O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.REPLACE,Q)},Q.prototype.ki=function(Q){return O(this.$callbacks||(this.$callbacks=[]),k.OPERATION.DELETE,Q)},Q.prototype.assign=function(k){return Object.assign(this,k),this},Object.defineProperty(Q.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),Q.prototype.setDirty=function(k,Q){this.$changes.change(k,Q)},Q.prototype.listen=function(k,Q,i){var Z=this;return void 0===i&&(i=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[k]||(this.$callbacks[k]=[]),this.$callbacks[k].push(Q),i&&void 0!==this[k]&&Q(this[k],void 0),function(){return G(Z.$callbacks[k],Z.$callbacks[k].indexOf(Q))}},Q.prototype.decode=function(i,Z,U){var C;void 0===Z&&(Z={offset:0}),void 0===U&&(U=this);var o=[],m=this.$changes.root,O=i.length,J=0;for(m.refs.set(J,this);Z.offset<O;){var G=i[Z.offset++];if(G!=B){var H=U.$changes,e=void 0!==U._definition,z=e?G>>6<<6:G;if(z!==k.OPERATION.CLEAR){var l=e?G%(z||255):lk(i,Z),h=e?U._definition.fieldsByIndex[l]:"",f=H.getType(l),Y=void 0,y=void 0,L=void 0;if(e?y=U["_".concat(h)]:(y=U.getByIndex(l),(z&k.OPERATION.ADD)===k.OPERATION.ADD?(L=U instanceof E?zk(i,Z):l,U.setIndex(l,L)):L=U.getIndex(l)),(z&k.OPERATION.DELETE)===k.OPERATION.DELETE&&(z!==k.OPERATION.DELETE_AND_ADD&&U.deleteByIndex(l),y&&y.$changes&&m.removeRef(y.$changes.refId),Y=null),void 0!==h){if(z===k.OPERATION.DELETE);else if(Q.is(f)){var s=lk(i,Z);if(Y=m.refs.get(s),z!==k.OPERATION.REPLACE){var u=this.getSchemaType(i,Z,f);Y||((Y=this.createTypeInstance(u)).$changes.refId=s,y&&(Y.$callbacks=y.$callbacks,y.$changes.refId&&s!==y.$changes.refId&&m.removeRef(y.$changes.refId))),m.addRef(s,Y,Y!==y)}}else if("string"===typeof f)Y=vk(f,i,Z);else{var a=c(Object.keys(f)[0]),j=lk(i,Z),T=m.refs.has(j)?y||m.refs.get(j):new a.constructor;if((Y=T.clone(!0)).$changes.refId=j,y&&(Y.$callbacks=y.$callbacks,y.$changes.refId&&j!==y.$changes.refId)){m.removeRef(y.$changes.refId);for(var K=y.entries(),v=void 0;(v=K.next())&&!v.done;){var N=(C=v.value)[0],X=C[1];o.push({refId:j,op:k.OPERATION.DELETE,field:N,value:void 0,previousValue:X})}}m.addRef(j,Y,T!==y)}if(null!==Y&&void 0!==Y)if(Y.$changes&&Y.$changes.setParent(H.ref,H.root,l),U instanceof Q)U[h]=Y;else if(U instanceof E)N=L,U.$items.set(N,Y),U.$changes.allChanges.add(l);else if(U instanceof F)U.setAt(l,Y);else if(U instanceof yk){var p=U.add(Y);U.setIndex(l,p)}else U instanceof Lk&&!1!==(p=U.add(Y))&&U.setIndex(l,p);y!==Y&&o.push({refId:J,op:z,field:h,dynamicIndex:L,value:Y,previousValue:y})}else{console.warn("@colyseus/schema: definition mismatch");for(var d={offset:Z.offset};Z.offset<O&&(!fk(i,Z)||(d.offset=Z.offset+1,!m.refs.has(lk(i,d))));)Z.offset++}}else U.clear(o)}else{J=lk(i,Z);var b=m.refs.get(J);if(!b)throw new Error('"refId" not found: '.concat(J));U=b}}return this._triggerChanges(o),m.garbageCollectDeletedRefs(),o},Q.prototype.encode=function(i,Z,U){void 0===i&&(i=!1),void 0===Z&&(Z=[]),void 0===U&&(U=!1);for(var C=this.$changes,o=new WeakSet,m=[C],O=1,J=0;J<O;J++){var G=m[J],H=G.ref,e=H instanceof Q;G.ensureRefId(),o.add(G),G!==C&&(G.changed||i)&&(X(Z,B),r(Z,G.refId));for(var F=i?Array.from(G.allChanges):Array.from(G.changes.values()),z=0,l=F.length;z<l;z++){var h=i?{op:k.OPERATION.ADD,index:F[z]}:F[z],f=h.index,Y=e?H._definition.fieldsByIndex&&H._definition.fieldsByIndex[f]:f,y=Z.length;if(h.op!==k.OPERATION.TOUCH)if(e)X(Z,f|h.op);else{if(X(Z,h.op),h.op===k.OPERATION.CLEAR)continue;r(Z,f)}if(e||(h.op&k.OPERATION.ADD)!=k.OPERATION.ADD||H instanceof E&&I(Z,G.ref.$indexes.get(f)),h.op!==k.OPERATION.DELETE){var L=G.getType(f),s=G.getValue(f);if(s&&s.$changes&&!o.has(s.$changes)&&(m.push(s.$changes),s.$changes.ensureRefId(),O++),h.op!==k.OPERATION.TOUCH){if(Q.is(L))Tk(s,L,H,Y),r(Z,s.$changes.refId),(h.op&k.OPERATION.ADD)===k.OPERATION.ADD&&this.tryEncodeTypeId(Z,L,s.constructor);else if("string"===typeof L)Kk(L,Z,s,H,Y);else{var u=c(Object.keys(L)[0]);Tk(H["_".concat(Y)],u.constructor,H,Y),r(Z,s.$changes.refId)}U&&G.cache(f,Z.slice(y))}}}i||U||G.discard()}return Z},Q.prototype.encodeAll=function(k){return this.encode(!0,[],k)},Q.prototype.applyFilters=function(i,Z){var U,C;void 0===Z&&(Z=!1);for(var o=this,m=new Set,O=sk.get(i),J=[this.$changes],G=1,H=[],e=function(e){var F=J[e];if(m.has(F.refId))return"continue";var z=F.ref,l=z instanceof Q;X(H,B),r(H,F.refId);var h=O.refIds.has(F),c=Z||!h;O.addRefId(F);var f=O.containerIndexes.get(F),Y=c?Array.from(F.allChanges):Array.from(F.changes.values());!Z&&l&&z._definition.indexesWithFilters&&z._definition.indexesWithFilters.forEach((function(Q){!f.has(Q)&&F.allChanges.has(Q)&&(c?Y.push(Q):Y.push({op:k.OPERATION.ADD,index:Q}))}));for(var y=0,L=Y.length;y<L;y++){var s=c?{op:k.OPERATION.ADD,index:Y[y]}:Y[y];if(s.op!==k.OPERATION.CLEAR){var u=s.index;if(s.op!==k.OPERATION.DELETE){var a=F.getValue(u),j=F.getType(u);if(l){if((T=z._definition.filters&&z._definition.filters[u])&&!T.call(z,i,a,o)){a&&a.$changes&&m.add(a.$changes.refId);continue}}else{var T,K=F.parent;if((T=F.getChildrenFilter())&&!T.call(K,i,z.$indexes.get(u),a,o)){a&&a.$changes&&m.add(a.$changes.refId);continue}}if(a.$changes&&(J.push(a.$changes),G++),s.op!==k.OPERATION.TOUCH)if(s.op===k.OPERATION.ADD||l)H.push.apply(H,null!==(U=F.caches[u])&&void 0!==U?U:[]),f.add(u);else if(f.has(u))H.push.apply(H,null!==(C=F.caches[u])&&void 0!==C?C:[]);else{if(f.add(u),X(H,k.OPERATION.ADD),r(H,u),z instanceof E){var v=F.ref.$indexes.get(u);I(H,v)}a.$changes?r(H,a.$changes.refId):n[j](H,a)}else a.$changes&&!l&&(X(H,k.OPERATION.ADD),r(H,u),z instanceof E&&(v=F.ref.$indexes.get(u),I(H,v)),r(H,a.$changes.refId))}else l?X(H,s.op|u):(X(H,s.op),r(H,u))}else X(H,s.op)}},F=0;F<G;F++)e(F);return H},Q.prototype.clone=function(){var k,Q=new this.constructor,i=this._definition.schema;for(var Z in i)"object"===typeof this[Z]&&"function"===typeof(null===(k=this[Z])||void 0===k?void 0:k.clone)?Q[Z]=this[Z].clone():Q[Z]=this[Z];return Q},Q.prototype.toJSON=function(){var k=this._definition.schema,Q=this._definition.deprecated,i={};for(var Z in k)Q[Z]||null===this[Z]||"undefined"===typeof this[Z]||(i[Z]="function"===typeof this[Z].toJSON?this[Z].toJSON():this["_".concat(Z)]);return i},Q.prototype.discardAllChanges=function(){this.$changes.discardAll()},Q.prototype.getByIndex=function(k){return this[this._definition.fieldsByIndex[k]]},Q.prototype.deleteByIndex=function(k){this[this._definition.fieldsByIndex[k]]=void 0},Q.prototype.tryEncodeTypeId=function(k,Q,i){Q._typeid!==i._typeid&&(X(k,o),r(k,i._typeid))},Q.prototype.getSchemaType=function(k,Q,i){var Z;return k[Q.offset]===o&&(Q.offset++,Z=this.constructor._context.get(lk(k,Q))),Z||i},Q.prototype.createTypeInstance=function(k){var Q=new k;return Q.$changes.root=this.$changes.root,Q},Q.prototype._triggerChanges=function(i){for(var Z,U,C,B,o,m,O,J,G,H=new Set,e=this.$changes.root.refs,F=function(F){var z=i[F],E=z.refId,l=e.get(E),h=l.$callbacks;if((z.op&k.OPERATION.DELETE)===k.OPERATION.DELETE&&z.previousValue instanceof Q&&(null===(U=null===(Z=z.previousValue.$callbacks)||void 0===Z?void 0:Z[k.OPERATION.DELETE])||void 0===U||U.forEach((function(k){return k()}))),!h)return"continue";if(l instanceof Q){if(!H.has(E))try{null===(C=null===h||void 0===h?void 0:h[k.OPERATION.REPLACE])||void 0===C||C.forEach((function(k){return k()}))}catch(c){Q.onError(c)}try{h.hasOwnProperty(z.field)&&(null===(B=h[z.field])||void 0===B||B.forEach((function(k){return k(z.value,z.previousValue)})))}catch(c){Q.onError(c)}}else z.op===k.OPERATION.ADD&&void 0===z.previousValue?null===(o=h[k.OPERATION.ADD])||void 0===o||o.forEach((function(k){var Q;return k(z.value,null!==(Q=z.dynamicIndex)&&void 0!==Q?Q:z.field)})):z.op===k.OPERATION.DELETE?void 0!==z.previousValue&&(null===(m=h[k.OPERATION.DELETE])||void 0===m||m.forEach((function(k){var Q;return k(z.previousValue,null!==(Q=z.dynamicIndex)&&void 0!==Q?Q:z.field)}))):z.op===k.OPERATION.DELETE_AND_ADD&&(void 0!==z.previousValue&&(null===(O=h[k.OPERATION.DELETE])||void 0===O||O.forEach((function(k){var Q;return k(z.previousValue,null!==(Q=z.dynamicIndex)&&void 0!==Q?Q:z.field)}))),null===(J=h[k.OPERATION.ADD])||void 0===J||J.forEach((function(k){var Q;return k(z.value,null!==(Q=z.dynamicIndex)&&void 0!==Q?Q:z.field)}))),z.value!==z.previousValue&&(null===(G=h[k.OPERATION.REPLACE])||void 0===G||G.forEach((function(k){var Q;return k(z.value,null!==(Q=z.dynamicIndex)&&void 0!==Q?Q:z.field)})));H.add(E)},z=0;z<i.length;z++)F(z)},Q._definition=f.create(),Q}();function Xk(k){for(var Q=[k.$changes],i=1,Z={},U=Z,C=function(k){var i=Q[k];i.changes.forEach((function(k){var Q=i.ref,Z=k.index,C=Q._definition?Q._definition.fieldsByIndex[Z]:Q.$indexes.get(Z);U[C]=i.getValue(Z)}))},B=0;B<i;B++)C(B);return Z}var pk={context:new y},dk=function(k){function Q(){return null!==k&&k.apply(this,arguments)||this}return i(Q,k),Z([s("string",pk)],Q.prototype,"name",void 0),Z([s("string",pk)],Q.prototype,"type",void 0),Z([s("number",pk)],Q.prototype,"referencedType",void 0),Q}(Nk),bk=function(k){function Q(){var Q=null!==k&&k.apply(this,arguments)||this;return Q.fields=new F,Q}return i(Q,k),Z([s("number",pk)],Q.prototype,"id",void 0),Z([s([dk],pk)],Q.prototype,"fields",void 0),Q}(Nk),Dk=function(k){function Q(){var Q=null!==k&&k.apply(this,arguments)||this;return Q.types=new F,Q}return i(Q,k),Q.encode=function(k){var i=k.constructor,Z=new Q;Z.rootType=i._typeid;var U=function(k,Q){for(var i in Q){var U=new dk;U.name=i;var C=void 0;if("string"===typeof Q[i])C=Q[i];else{var B=Q[i],o=void 0;Nk.is(B)?(C="ref",o=Q[i]):"string"===typeof B[C=Object.keys(B)[0]]?C+=":"+B[C]:o=B[C],U.referencedType=o?o._typeid:-1}U.type=C,k.fields.push(U)}Z.types.push(k)},C=i._context.types;for(var B in C){var o=new bk;o.id=Number(B),U(o,C[B]._definition.schema)}return Z.encodeAll()},Q.decode=function(k,Z){var U=new y,C=new Q;C.decode(k,Z);var B=C.types.reduce((function(k,Q){var Z=function(k){function Q(){return null!==k&&k.apply(this,arguments)||this}return i(Q,k),Q}(Nk),C=Q.id;return k[C]=Z,U.add(Z,C),k}),{});C.types.forEach((function(k){var Q=B[k.id];k.fields.forEach((function(k){var i;if(void 0!==k.referencedType){var Z=k.type,C=B[k.referencedType];if(!C){var o=k.type.split(":");Z=o[0],C=o[1]}"ref"===Z?s(C,{context:U})(Q.prototype,k.name):s(((i={})[Z]=C,i),{context:U})(Q.prototype,k.name)}else s(k.type,{context:U})(Q.prototype,k.name)}))}));var o=B[C.rootType],m=new o;for(var O in o._definition.schema){var J=o._definition.schema[O];"string"!==typeof J&&(m[O]="function"===typeof J?new J:new(c(Object.keys(J)[0]).constructor))}return m},Z([s([bk],pk)],Q.prototype,"types",void 0),Z([s("number",pk)],Q.prototype,"rootType",void 0),Q}(Nk);h("map",{constructor:E}),h("array",{constructor:F}),h("set",{constructor:Lk}),h("collection",{constructor:yk}),k.ArraySchema=F,k.CollectionSchema=yk,k.Context=y,k.MapSchema=E,k.Reflection=Dk,k.ReflectionField=dk,k.ReflectionType=bk,k.Schema=Nk,k.SchemaDefinition=f,k.SetSchema=Lk,k.decode=Yk,k.defineTypes=T,k.deprecated=j,k.dumpChanges=Xk,k.encode=n,k.filter=u,k.filterChildren=a,k.hasFilter=Y,k.registerType=h,k.type=s,Object.defineProperty(k,"__esModule",{value:!0})}(Q)},13485:k=>{"use strict";k.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13477:(k,Q,i)=>{var Z=i(13485),U=i(13489),C=Object.hasOwnProperty,B=Object.create(null);for(var o in Z)C.call(Z,o)&&(B[Z[o]]=o);var m=k.exports={to:{},get:{}};function O(k,Q,i){return Math.min(Math.max(Q,k),i)}function J(k){var Q=Math.round(k).toString(16).toUpperCase();return Q.length<2?"0"+Q:Q}m.get=function(k){var Q,i;switch(k.substring(0,3).toLowerCase()){case"hsl":Q=m.get.hsl(k),i="hsl";break;case"hwb":Q=m.get.hwb(k),i="hwb";break;default:Q=m.get.rgb(k),i="rgb"}return Q?{model:i,value:Q}:null},m.get.rgb=function(k){if(!k)return null;var Q,i,U,B=[0,0,0,1];if(Q=k.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(U=Q[2],Q=Q[1],i=0;i<3;i++){var o=2*i;B[i]=parseInt(Q.slice(o,o+2),16)}U&&(B[3]=parseInt(U,16)/255)}else if(Q=k.match(/^#([a-f0-9]{3,4})$/i)){for(U=(Q=Q[1])[3],i=0;i<3;i++)B[i]=parseInt(Q[i]+Q[i],16);U&&(B[3]=parseInt(U+U,16)/255)}else if(Q=k.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(i=0;i<3;i++)B[i]=parseInt(Q[i+1],0);Q[4]&&(Q[5]?B[3]=.01*parseFloat(Q[4]):B[3]=parseFloat(Q[4]))}else{if(!(Q=k.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(Q=k.match(/^(\w+)$/))?"transparent"===Q[1]?[0,0,0,0]:C.call(Z,Q[1])?((B=Z[Q[1]])[3]=1,B):null:null;for(i=0;i<3;i++)B[i]=Math.round(2.55*parseFloat(Q[i+1]));Q[4]&&(Q[5]?B[3]=.01*parseFloat(Q[4]):B[3]=parseFloat(Q[4]))}for(i=0;i<3;i++)B[i]=O(B[i],0,255);return B[3]=O(B[3],0,1),B},m.get.hsl=function(k){if(!k)return null;var Q=k.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(Q){var i=parseFloat(Q[4]);return[(parseFloat(Q[1])%360+360)%360,O(parseFloat(Q[2]),0,100),O(parseFloat(Q[3]),0,100),O(isNaN(i)?1:i,0,1)]}return null},m.get.hwb=function(k){if(!k)return null;var Q=k.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(Q){var i=parseFloat(Q[4]);return[(parseFloat(Q[1])%360+360)%360,O(parseFloat(Q[2]),0,100),O(parseFloat(Q[3]),0,100),O(isNaN(i)?1:i,0,1)]}return null},m.to.hex=function(){var k=U(arguments);return"#"+J(k[0])+J(k[1])+J(k[2])+(k[3]<1?J(Math.round(255*k[3])):"")},m.to.rgb=function(){var k=U(arguments);return k.length<4||1===k[3]?"rgb("+Math.round(k[0])+", "+Math.round(k[1])+", "+Math.round(k[2])+")":"rgba("+Math.round(k[0])+", "+Math.round(k[1])+", "+Math.round(k[2])+", "+k[3]+")"},m.to.rgb.percent=function(){var k=U(arguments),Q=Math.round(k[0]/255*100),i=Math.round(k[1]/255*100),Z=Math.round(k[2]/255*100);return k.length<4||1===k[3]?"rgb("+Q+"%, "+i+"%, "+Z+"%)":"rgba("+Q+"%, "+i+"%, "+Z+"%, "+k[3]+")"},m.to.hsl=function(){var k=U(arguments);return k.length<4||1===k[3]?"hsl("+k[0]+", "+k[1]+"%, "+k[2]+"%)":"hsla("+k[0]+", "+k[1]+"%, "+k[2]+"%, "+k[3]+")"},m.to.hwb=function(){var k=U(arguments),Q="";return k.length>=4&&1!==k[3]&&(Q=", "+k[3]),"hwb("+k[0]+", "+k[1]+"%, "+k[2]+"%"+Q+")"},m.to.keyword=function(k){return B[k.slice(0,3)]}},13472:(k,Q,i)=>{const Z=i(13477),U=i(13493),C=["keyword","gray","hex"],B={};for(const e of Object.keys(U))B[[...U[e].labels].sort().join("")]=e;const o={};function m(k,Q){if(!(this instanceof m))return new m(k,Q);if(Q&&Q in C&&(Q=null),Q&&!(Q in U))throw new Error("Unknown model: "+Q);let i,O;if(null==k)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(k instanceof m)this.model=k.model,this.color=[...k.color],this.valpha=k.valpha;else if("string"===typeof k){const Q=Z.get(k);if(null===Q)throw new Error("Unable to parse color from string: "+k);this.model=Q.model,O=U[this.model].channels,this.color=Q.value.slice(0,O),this.valpha="number"===typeof Q.value[O]?Q.value[O]:1}else if(k.length>0){this.model=Q||"rgb",O=U[this.model].channels;const i=Array.prototype.slice.call(k,0,O);this.color=H(i,O),this.valpha="number"===typeof k[O]?k[O]:1}else if("number"===typeof k)this.model="rgb",this.color=[k>>16&255,k>>8&255,255&k],this.valpha=1;else{this.valpha=1;const Q=Object.keys(k);"alpha"in k&&(Q.splice(Q.indexOf("alpha"),1),this.valpha="number"===typeof k.alpha?k.alpha:0);const Z=Q.sort().join("");if(!(Z in B))throw new Error("Unable to parse color from object: "+JSON.stringify(k));this.model=B[Z];const{labels:C}=U[this.model],o=[];for(i=0;i<C.length;i++)o.push(k[C[i]]);this.color=H(o)}if(o[this.model])for(O=U[this.model].channels,i=0;i<O;i++){const k=o[this.model][i];k&&(this.color[i]=k(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}m.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(k){let Q=this.model in Z.to?this:this.rgb();Q=Q.round("number"===typeof k?k:1);const i=1===Q.valpha?Q.color:[...Q.color,this.valpha];return Z.to[Q.model](i)},percentString(k){const Q=this.rgb().round("number"===typeof k?k:1),i=1===Q.valpha?Q.color:[...Q.color,this.valpha];return Z.to.rgb.percent(i)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const k={},{channels:Q}=U[this.model],{labels:i}=U[this.model];for(let Z=0;Z<Q;Z++)k[i[Z]]=this.color[Z];return 1!==this.valpha&&(k.alpha=this.valpha),k},unitArray(){const k=this.rgb().color;return k[0]/=255,k[1]/=255,k[2]/=255,1!==this.valpha&&k.push(this.valpha),k},unitObject(){const k=this.rgb().object();return k.r/=255,k.g/=255,k.b/=255,1!==this.valpha&&(k.alpha=this.valpha),k},round(k){return k=Math.max(k||0,0),new m([...this.color.map(O(k)),this.valpha],this.model)},alpha(k){return void 0!==k?new m([...this.color,Math.max(0,Math.min(1,k))],this.model):this.valpha},red:J("rgb",0,G(255)),green:J("rgb",1,G(255)),blue:J("rgb",2,G(255)),hue:J(["hsl","hsv","hsl","hwb","hcg"],0,(k=>(k%360+360)%360)),saturationl:J("hsl",1,G(100)),lightness:J("hsl",2,G(100)),saturationv:J("hsv",1,G(100)),value:J("hsv",2,G(100)),chroma:J("hcg",1,G(100)),gray:J("hcg",2,G(100)),white:J("hwb",1,G(100)),wblack:J("hwb",2,G(100)),cyan:J("cmyk",0,G(100)),magenta:J("cmyk",1,G(100)),yellow:J("cmyk",2,G(100)),black:J("cmyk",3,G(100)),x:J("xyz",0,G(95.047)),y:J("xyz",1,G(100)),z:J("xyz",2,G(108.833)),l:J("lab",0,G(100)),a:J("lab",1),b:J("lab",2),keyword(k){return void 0!==k?new m(k):U[this.model].keyword(this.color)},hex(k){return void 0!==k?new m(k):Z.to.hex(this.rgb().round().color)},hexa(k){if(void 0!==k)return new m(k);const Q=this.rgb().round().color;let i=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===i.length&&(i="0"+i),Z.to.hex(Q)+i},rgbNumber(){const k=this.rgb().color;return(255&k[0])<<16|(255&k[1])<<8|255&k[2]},luminosity(){const k=this.rgb().color,Q=[];for(const[i,Z]of k.entries()){const k=Z/255;Q[i]=k<=.04045?k/12.92:((k+.055)/1.055)**2.4}return.2126*Q[0]+.7152*Q[1]+.0722*Q[2]},contrast(k){const Q=this.luminosity(),i=k.luminosity();return Q>i?(Q+.05)/(i+.05):(i+.05)/(Q+.05)},level(k){const Q=this.contrast(k);return Q>=7?"AAA":Q>=4.5?"AA":""},isDark(){const k=this.rgb().color;return(2126*k[0]+7152*k[1]+722*k[2])/1e4<128},isLight(){return!this.isDark()},negate(){const k=this.rgb();for(let Q=0;Q<3;Q++)k.color[Q]=255-k.color[Q];return k},lighten(k){const Q=this.hsl();return Q.color[2]+=Q.color[2]*k,Q},darken(k){const Q=this.hsl();return Q.color[2]-=Q.color[2]*k,Q},saturate(k){const Q=this.hsl();return Q.color[1]+=Q.color[1]*k,Q},desaturate(k){const Q=this.hsl();return Q.color[1]-=Q.color[1]*k,Q},whiten(k){const Q=this.hwb();return Q.color[1]+=Q.color[1]*k,Q},blacken(k){const Q=this.hwb();return Q.color[2]+=Q.color[2]*k,Q},grayscale(){const k=this.rgb().color,Q=.3*k[0]+.59*k[1]+.11*k[2];return m.rgb(Q,Q,Q)},fade(k){return this.alpha(this.valpha-this.valpha*k)},opaquer(k){return this.alpha(this.valpha+this.valpha*k)},rotate(k){const Q=this.hsl();let i=Q.color[0];return i=(i+k)%360,i=i<0?360+i:i,Q.color[0]=i,Q},mix(k,Q){if(!k||!k.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof k);const i=k.rgb(),Z=this.rgb(),U=void 0===Q?.5:Q,C=2*U-1,B=i.alpha()-Z.alpha(),o=((C*B===-1?C:(C+B)/(1+C*B))+1)/2,O=1-o;return m.rgb(o*i.red()+O*Z.red(),o*i.green()+O*Z.green(),o*i.blue()+O*Z.blue(),i.alpha()*U+Z.alpha()*(1-U))}};for(const e of Object.keys(U)){if(C.includes(e))continue;const{channels:k}=U[e];m.prototype[e]=function(){if(this.model===e)return new m(this);for(var k=arguments.length,Q=new Array(k),i=0;i<k;i++)Q[i]=arguments[i];return Q.length>0?new m(Q,e):new m([...(Z=U[this.model][e].raw(this.color),Array.isArray(Z)?Z:[Z]),this.valpha],e);var Z},m[e]=function(){for(var Q=arguments.length,i=new Array(Q),Z=0;Z<Q;Z++)i[Z]=arguments[Z];let U=i[0];return"number"===typeof U&&(U=H(i,k)),new m(U,e)}}function O(k){return function(Q){return function(k,Q){return Number(k.toFixed(Q))}(Q,k)}}function J(k,Q,i){k=Array.isArray(k)?k:[k];for(const Z of k)(o[Z]||(o[Z]=[]))[Q]=i;return k=k[0],function(Z){let U;return void 0!==Z?(i&&(Z=i(Z)),U=this[k](),U.color[Q]=Z,U):(U=this[k]().color[Q],i&&(U=i(U)),U)}}function G(k){return function(Q){return Math.max(0,Math.min(k,Q))}}function H(k,Q){for(let i=0;i<Q;i++)"number"!==typeof k[i]&&(k[i]=0);return k}k.exports=m},13498:(k,Q,i)=>{const Z=i(13505),U={};for(const B of Object.keys(Z))U[Z[B]]=B;const C={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};k.exports=C;for(const B of Object.keys(C)){if(!("channels"in C[B]))throw new Error("missing channels property: "+B);if(!("labels"in C[B]))throw new Error("missing channel labels property: "+B);if(C[B].labels.length!==C[B].channels)throw new Error("channel and label counts mismatch: "+B);const{channels:k,labels:Q}=C[B];delete C[B].channels,delete C[B].labels,Object.defineProperty(C[B],"channels",{value:k}),Object.defineProperty(C[B],"labels",{value:Q})}C.rgb.hsl=function(k){const Q=k[0]/255,i=k[1]/255,Z=k[2]/255,U=Math.min(Q,i,Z),C=Math.max(Q,i,Z),B=C-U;let o,m;C===U?o=0:Q===C?o=(i-Z)/B:i===C?o=2+(Z-Q)/B:Z===C&&(o=4+(Q-i)/B),o=Math.min(60*o,360),o<0&&(o+=360);const O=(U+C)/2;return m=C===U?0:O<=.5?B/(C+U):B/(2-C-U),[o,100*m,100*O]},C.rgb.hsv=function(k){let Q,i,Z,U,C;const B=k[0]/255,o=k[1]/255,m=k[2]/255,O=Math.max(B,o,m),J=O-Math.min(B,o,m),G=function(k){return(O-k)/6/J+.5};return 0===J?(U=0,C=0):(C=J/O,Q=G(B),i=G(o),Z=G(m),B===O?U=Z-i:o===O?U=1/3+Q-Z:m===O&&(U=2/3+i-Q),U<0?U+=1:U>1&&(U-=1)),[360*U,100*C,100*O]},C.rgb.hwb=function(k){const Q=k[0],i=k[1];let Z=k[2];const U=C.rgb.hsl(k)[0],B=1/255*Math.min(Q,Math.min(i,Z));return Z=1-1/255*Math.max(Q,Math.max(i,Z)),[U,100*B,100*Z]},C.rgb.cmyk=function(k){const Q=k[0]/255,i=k[1]/255,Z=k[2]/255,U=Math.min(1-Q,1-i,1-Z);return[100*((1-Q-U)/(1-U)||0),100*((1-i-U)/(1-U)||0),100*((1-Z-U)/(1-U)||0),100*U]},C.rgb.keyword=function(k){const Q=U[k];if(Q)return Q;let i,C=1/0;for(const U of Object.keys(Z)){const Q=Z[U],m=(o=Q,((B=k)[0]-o[0])**2+(B[1]-o[1])**2+(B[2]-o[2])**2);m<C&&(C=m,i=U)}var B,o;return i},C.keyword.rgb=function(k){return Z[k]},C.rgb.xyz=function(k){let Q=k[0]/255,i=k[1]/255,Z=k[2]/255;Q=Q>.04045?((Q+.055)/1.055)**2.4:Q/12.92,i=i>.04045?((i+.055)/1.055)**2.4:i/12.92,Z=Z>.04045?((Z+.055)/1.055)**2.4:Z/12.92;return[100*(.4124*Q+.3576*i+.1805*Z),100*(.2126*Q+.7152*i+.0722*Z),100*(.0193*Q+.1192*i+.9505*Z)]},C.rgb.lab=function(k){const Q=C.rgb.xyz(k);let i=Q[0],Z=Q[1],U=Q[2];i/=95.047,Z/=100,U/=108.883,i=i>.008856?i**(1/3):7.787*i+16/116,Z=Z>.008856?Z**(1/3):7.787*Z+16/116,U=U>.008856?U**(1/3):7.787*U+16/116;return[116*Z-16,500*(i-Z),200*(Z-U)]},C.hsl.rgb=function(k){const Q=k[0]/360,i=k[1]/100,Z=k[2]/100;let U,C,B;if(0===i)return B=255*Z,[B,B,B];U=Z<.5?Z*(1+i):Z+i-Z*i;const o=2*Z-U,m=[0,0,0];for(let O=0;O<3;O++)C=Q+1/3*-(O-1),C<0&&C++,C>1&&C--,B=6*C<1?o+6*(U-o)*C:2*C<1?U:3*C<2?o+(U-o)*(2/3-C)*6:o,m[O]=255*B;return m},C.hsl.hsv=function(k){const Q=k[0];let i=k[1]/100,Z=k[2]/100,U=i;const C=Math.max(Z,.01);Z*=2,i*=Z<=1?Z:2-Z,U*=C<=1?C:2-C;return[Q,100*(0===Z?2*U/(C+U):2*i/(Z+i)),100*((Z+i)/2)]},C.hsv.rgb=function(k){const Q=k[0]/60,i=k[1]/100;let Z=k[2]/100;const U=Math.floor(Q)%6,C=Q-Math.floor(Q),B=255*Z*(1-i),o=255*Z*(1-i*C),m=255*Z*(1-i*(1-C));switch(Z*=255,U){case 0:return[Z,m,B];case 1:return[o,Z,B];case 2:return[B,Z,m];case 3:return[B,o,Z];case 4:return[m,B,Z];case 5:return[Z,B,o]}},C.hsv.hsl=function(k){const Q=k[0],i=k[1]/100,Z=k[2]/100,U=Math.max(Z,.01);let C,B;B=(2-i)*Z;const o=(2-i)*U;return C=i*U,C/=o<=1?o:2-o,C=C||0,B/=2,[Q,100*C,100*B]},C.hwb.rgb=function(k){const Q=k[0]/360;let i=k[1]/100,Z=k[2]/100;const U=i+Z;let C;U>1&&(i/=U,Z/=U);const B=Math.floor(6*Q),o=1-Z;C=6*Q-B,0!==(1&B)&&(C=1-C);const m=i+C*(o-i);let O,J,G;switch(B){default:case 6:case 0:O=o,J=m,G=i;break;case 1:O=m,J=o,G=i;break;case 2:O=i,J=o,G=m;break;case 3:O=i,J=m,G=o;break;case 4:O=m,J=i,G=o;break;case 5:O=o,J=i,G=m}return[255*O,255*J,255*G]},C.cmyk.rgb=function(k){const Q=k[0]/100,i=k[1]/100,Z=k[2]/100,U=k[3]/100;return[255*(1-Math.min(1,Q*(1-U)+U)),255*(1-Math.min(1,i*(1-U)+U)),255*(1-Math.min(1,Z*(1-U)+U))]},C.xyz.rgb=function(k){const Q=k[0]/100,i=k[1]/100,Z=k[2]/100;let U,C,B;return U=3.2406*Q+-1.5372*i+-.4986*Z,C=-.9689*Q+1.8758*i+.0415*Z,B=.0557*Q+-.204*i+1.057*Z,U=U>.0031308?1.055*U**(1/2.4)-.055:12.92*U,C=C>.0031308?1.055*C**(1/2.4)-.055:12.92*C,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,U=Math.min(Math.max(0,U),1),C=Math.min(Math.max(0,C),1),B=Math.min(Math.max(0,B),1),[255*U,255*C,255*B]},C.xyz.lab=function(k){let Q=k[0],i=k[1],Z=k[2];Q/=95.047,i/=100,Z/=108.883,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,i=i>.008856?i**(1/3):7.787*i+16/116,Z=Z>.008856?Z**(1/3):7.787*Z+16/116;return[116*i-16,500*(Q-i),200*(i-Z)]},C.lab.xyz=function(k){let Q,i,Z;i=(k[0]+16)/116,Q=k[1]/500+i,Z=i-k[2]/200;const U=i**3,C=Q**3,B=Z**3;return i=U>.008856?U:(i-16/116)/7.787,Q=C>.008856?C:(Q-16/116)/7.787,Z=B>.008856?B:(Z-16/116)/7.787,Q*=95.047,i*=100,Z*=108.883,[Q,i,Z]},C.lab.lch=function(k){const Q=k[0],i=k[1],Z=k[2];let U;U=360*Math.atan2(Z,i)/2/Math.PI,U<0&&(U+=360);return[Q,Math.sqrt(i*i+Z*Z),U]},C.lch.lab=function(k){const Q=k[0],i=k[1],Z=k[2]/360*2*Math.PI;return[Q,i*Math.cos(Z),i*Math.sin(Z)]},C.rgb.ansi16=function(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[i,Z,U]=k;let B=null===Q?C.rgb.hsv(k)[2]:Q;if(B=Math.round(B/50),0===B)return 30;let o=30+(Math.round(U/255)<<2|Math.round(Z/255)<<1|Math.round(i/255));return 2===B&&(o+=60),o},C.hsv.ansi16=function(k){return C.rgb.ansi16(C.hsv.rgb(k),k[2])},C.rgb.ansi256=function(k){const Q=k[0],i=k[1],Z=k[2];if(Q===i&&i===Z)return Q<8?16:Q>248?231:Math.round((Q-8)/247*24)+232;return 16+36*Math.round(Q/255*5)+6*Math.round(i/255*5)+Math.round(Z/255*5)},C.ansi16.rgb=function(k){let Q=k%10;if(0===Q||7===Q)return k>50&&(Q+=3.5),Q=Q/10.5*255,[Q,Q,Q];const i=.5*(1+~~(k>50));return[(1&Q)*i*255,(Q>>1&1)*i*255,(Q>>2&1)*i*255]},C.ansi256.rgb=function(k){if(k>=232){const Q=10*(k-232)+8;return[Q,Q,Q]}let Q;k-=16;return[Math.floor(k/36)/5*255,Math.floor((Q=k%36)/6)/5*255,Q%6/5*255]},C.rgb.hex=function(k){const Q=(((255&Math.round(k[0]))<<16)+((255&Math.round(k[1]))<<8)+(255&Math.round(k[2]))).toString(16).toUpperCase();return"000000".substring(Q.length)+Q},C.hex.rgb=function(k){const Q=k.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!Q)return[0,0,0];let i=Q[0];3===Q[0].length&&(i=i.split("").map((k=>k+k)).join(""));const Z=parseInt(i,16);return[Z>>16&255,Z>>8&255,255&Z]},C.rgb.hcg=function(k){const Q=k[0]/255,i=k[1]/255,Z=k[2]/255,U=Math.max(Math.max(Q,i),Z),C=Math.min(Math.min(Q,i),Z),B=U-C;let o,m;return o=B<1?C/(1-B):0,m=B<=0?0:U===Q?(i-Z)/B%6:U===i?2+(Z-Q)/B:4+(Q-i)/B,m/=6,m%=1,[360*m,100*B,100*o]},C.hsl.hcg=function(k){const Q=k[1]/100,i=k[2]/100,Z=i<.5?2*Q*i:2*Q*(1-i);let U=0;return Z<1&&(U=(i-.5*Z)/(1-Z)),[k[0],100*Z,100*U]},C.hsv.hcg=function(k){const Q=k[1]/100,i=k[2]/100,Z=Q*i;let U=0;return Z<1&&(U=(i-Z)/(1-Z)),[k[0],100*Z,100*U]},C.hcg.rgb=function(k){const Q=k[0]/360,i=k[1]/100,Z=k[2]/100;if(0===i)return[255*Z,255*Z,255*Z];const U=[0,0,0],C=Q%1*6,B=C%1,o=1-B;let m=0;switch(Math.floor(C)){case 0:U[0]=1,U[1]=B,U[2]=0;break;case 1:U[0]=o,U[1]=1,U[2]=0;break;case 2:U[0]=0,U[1]=1,U[2]=B;break;case 3:U[0]=0,U[1]=o,U[2]=1;break;case 4:U[0]=B,U[1]=0,U[2]=1;break;default:U[0]=1,U[1]=0,U[2]=o}return m=(1-i)*Z,[255*(i*U[0]+m),255*(i*U[1]+m),255*(i*U[2]+m)]},C.hcg.hsv=function(k){const Q=k[1]/100,i=Q+k[2]/100*(1-Q);let Z=0;return i>0&&(Z=Q/i),[k[0],100*Z,100*i]},C.hcg.hsl=function(k){const Q=k[1]/100,i=k[2]/100*(1-Q)+.5*Q;let Z=0;return i>0&&i<.5?Z=Q/(2*i):i>=.5&&i<1&&(Z=Q/(2*(1-i))),[k[0],100*Z,100*i]},C.hcg.hwb=function(k){const Q=k[1]/100,i=Q+k[2]/100*(1-Q);return[k[0],100*(i-Q),100*(1-i)]},C.hwb.hcg=function(k){const Q=k[1]/100,i=1-k[2]/100,Z=i-Q;let U=0;return Z<1&&(U=(i-Z)/(1-Z)),[k[0],100*Z,100*U]},C.apple.rgb=function(k){return[k[0]/65535*255,k[1]/65535*255,k[2]/65535*255]},C.rgb.apple=function(k){return[k[0]/255*65535,k[1]/255*65535,k[2]/255*65535]},C.gray.rgb=function(k){return[k[0]/100*255,k[0]/100*255,k[0]/100*255]},C.gray.hsl=function(k){return[0,0,k[0]]},C.gray.hsv=C.gray.hsl,C.gray.hwb=function(k){return[0,100,k[0]]},C.gray.cmyk=function(k){return[0,0,0,k[0]]},C.gray.lab=function(k){return[k[0],0,0]},C.gray.hex=function(k){const Q=255&Math.round(k[0]/100*255),i=((Q<<16)+(Q<<8)+Q).toString(16).toUpperCase();return"000000".substring(i.length)+i},C.rgb.gray=function(k){return[(k[0]+k[1]+k[2])/3/255*100]}},13493:(k,Q,i)=>{const Z=i(13498),U=i(13507),C={};Object.keys(Z).forEach((k=>{C[k]={},Object.defineProperty(C[k],"channels",{value:Z[k].channels}),Object.defineProperty(C[k],"labels",{value:Z[k].labels});const Q=U(k);Object.keys(Q).forEach((i=>{const Z=Q[i];C[k][i]=function(k){const Q=function(){for(var Q=arguments.length,i=new Array(Q),Z=0;Z<Q;Z++)i[Z]=arguments[Z];const U=i[0];if(void 0===U||null===U)return U;U.length>1&&(i=U);const C=k(i);if("object"===typeof C)for(let k=C.length,B=0;B<k;B++)C[B]=Math.round(C[B]);return C};return"conversion"in k&&(Q.conversion=k.conversion),Q}(Z),C[k][i].raw=function(k){const Q=function(){for(var Q=arguments.length,i=new Array(Q),Z=0;Z<Q;Z++)i[Z]=arguments[Z];const U=i[0];return void 0===U||null===U?U:(U.length>1&&(i=U),k(i))};return"conversion"in k&&(Q.conversion=k.conversion),Q}(Z)}))})),k.exports=C},13507:(k,Q,i)=>{const Z=i(13498);function U(k){const Q=function(){const k={},Q=Object.keys(Z);for(let i=Q.length,Z=0;Z<i;Z++)k[Q[Z]]={distance:-1,parent:null};return k}(),i=[k];for(Q[k].distance=0;i.length;){const k=i.pop(),U=Object.keys(Z[k]);for(let Z=U.length,C=0;C<Z;C++){const Z=U[C],B=Q[Z];-1===B.distance&&(B.distance=Q[k].distance+1,B.parent=k,i.unshift(Z))}}return Q}function C(k,Q){return function(i){return Q(k(i))}}function B(k,Q){const i=[Q[k].parent,k];let U=Z[Q[k].parent][k],B=Q[k].parent;for(;Q[B].parent;)i.unshift(Q[B].parent),U=C(Z[Q[B].parent][B],U),B=Q[B].parent;return U.conversion=i,U}k.exports=function(k){const Q=U(k),i={},Z=Object.keys(Q);for(let U=Z.length,C=0;C<U;C++){const k=Z[C];null!==Q[k].parent&&(i[k]=B(k,Q))}return i}},13505:k=>{"use strict";k.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12015:(k,Q)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.discordURLBuilder=void 0,Q.discordURLBuilder=function(k){var Q;const i=(null===(Q=null===window||void 0===window?void 0:window.location)||void 0===Q?void 0:Q.hostname)||"localhost",Z=k.hostname.split("."),U=!k.hostname.includes("trycloudflare.com")&&!k.hostname.includes("discordsays.com")&&Z.length>2?`/${Z[0]}`:"";return k.pathname.startsWith("/.proxy")?`${k.protocol}//${i}${U}${k.pathname}${k.search}`:`${k.protocol}//${i}/.proxy/colyseus${U}${k.pathname}${k.search}`}},12001:function(k,Q,i){"use strict";var Z,U,C,B,o=this&&this.__awaiter||function(k,Q,i,Z){return new(i||(i=Promise))((function(U,C){function B(k){try{m(Z.next(k))}catch(Q){C(Q)}}function o(k){try{m(Z.throw(k))}catch(Q){C(Q)}}function m(k){var Q;k.done?U(k.value):(Q=k.value,Q instanceof i?Q:new i((function(k){k(Q)}))).then(B,o)}m((Z=Z.apply(k,Q||[])).next())}))},m=this&&this.__classPrivateFieldGet||function(k,Q,i,Z){if("a"===i&&!Z)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof Q?k!==Q||!Z:!Q.has(k))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?Z:"a"===i?Z.call(k):Z?Z.value:Q.get(k)},O=this&&this.__classPrivateFieldSet||function(k,Q,i,Z,U){if("m"===Z)throw new TypeError("Private method is not writable");if("a"===Z&&!U)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof Q?k!==Q||!U:!Q.has(k))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===Z?U.call(k,i):U?U.value=i:Q.set(k,i),i};Object.defineProperty(Q,"__esModule",{value:!0}),Q.Auth=void 0;const J=i(12008),G=i(11965);Q.Auth=class{constructor(k){this.http=k,this.settings={path:"/auth",key:"colyseus-auth-token"},Z.set(this,!1),U.set(this,void 0),C.set(this,void 0),B.set(this,(0,G.createNanoEvents)()),(0,J.getItem)(this.settings.key,(k=>this.token=k))}set token(k){this.http.authToken=k}get token(){return this.http.authToken}onChange(k){const Q=m(this,B,"f").on("change",k);return m(this,Z,"f")||O(this,U,new Promise(((k,Q)=>{this.getUserData().then((k=>{this.emitChange(Object.assign(Object.assign({},k),{token:this.token}))})).catch((k=>{this.emitChange({user:null,token:void 0})})).finally((()=>{k()}))})),"f"),O(this,Z,!0,"f"),Q}getUserData(){return o(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(k,Q,i){return o(this,void 0,void 0,(function*(){const Z=(yield this.http.post(`${this.settings.path}/register`,{body:{email:k,password:Q,options:i}})).data;return this.emitChange(Z),Z}))}signInWithEmailAndPassword(k,Q){return o(this,void 0,void 0,(function*(){const i=(yield this.http.post(`${this.settings.path}/login`,{body:{email:k,password:Q}})).data;return this.emitChange(i),i}))}signInAnonymously(k){return o(this,void 0,void 0,(function*(){const Q=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:k}})).data;return this.emitChange(Q),Q}))}sendPasswordResetEmail(k){return o(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:k}})).data}))}signInWithProvider(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o(this,void 0,void 0,(function*(){return new Promise(((i,Z)=>{const U=Q.width||480,B=Q.height||768,o=this.token?`?token=${this.token}`:"",J=`Login with ${k[0].toUpperCase()+k.substring(1)}`,G=this.http.client.getHttpEndpoint(`${Q.prefix||`${this.settings.path}/provider`}/${k}${o}`),H=screen.width/2-U/2,e=screen.height/2-B/2;O(this,C,window.open(G,J,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+U+", height="+B+", top="+e+", left="+H),"f");const F=k=>{void 0===k.data.user&&void 0===k.data.token||(clearInterval(z),m(this,C,"f").close(),O(this,C,void 0,"f"),window.removeEventListener("message",F),void 0!==k.data.error?Z(k.data.error):(i(k.data),this.emitChange(k.data)))},z=setInterval((()=>{m(this,C,"f")&&!m(this,C,"f").closed||(O(this,C,void 0,"f"),Z("uB"),window.removeEventListener("message",F))}),200);window.addEventListener("message",F)}))}))}signOut(){return o(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(k){void 0!==k.token&&(this.token=k.token,null===k.token?(0,J.removeItem)(this.settings.key):(0,J.setItem)(this.settings.key,k.token)),m(this,B,"f").emit("change",k)}},Z=new WeakMap,U=new WeakMap,C=new WeakMap,B=new WeakMap},11910:function(k,Q,i){"use strict";var Z,U=this&&this.__awaiter||function(k,Q,i,Z){return new(i||(i=Promise))((function(U,C){function B(k){try{m(Z.next(k))}catch(Q){C(Q)}}function o(k){try{m(Z.throw(k))}catch(Q){C(Q)}}function m(k){var Q;k.done?U(k.value):(Q=k.value,Q instanceof i?Q:new i((function(k){k(Q)}))).then(B,o)}m((Z=Z.apply(k,Q||[])).next())}))};Object.defineProperty(Q,"__esModule",{value:!0}),Q.Client=Q.MatchMakeError=void 0;const C=i(11913),B=i(11921),o=i(11987),m=i(12001),O=i(12015);class J extends Error{constructor(k,Q){super(k),this.code=Q,Object.setPrototypeOf(this,J.prototype)}}Q.MatchMakeError=J;const G="undefined"!==typeof window&&"undefined"!==typeof(null===(Z=null===window||void 0===window?void 0:window.location)||void 0===Z?void 0:Z.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";Q.Client=class{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G,Q=arguments.length>1?arguments[1]:void 0;var i,Z;if("string"===typeof k){const Q=k.startsWith("/")?new URL(k,G):new URL(k),i="https:"===Q.protocol||"wss:"===Q.protocol,Z=Number(Q.port||(i?443:80));this.settings={hostname:Q.hostname,pathname:Q.pathname,port:Z,secure:i}}else void 0===k.port&&(k.port=k.secure?443:80),void 0===k.pathname&&(k.pathname=""),this.settings=k;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new o.HTTP(this,(null===Q||void 0===Q?void 0:Q.headers)||{}),this.auth=new m.Auth(this.http),this.urlBuilder=null===Q||void 0===Q?void 0:Q.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(Z=null===(i=null===window||void 0===window?void 0:window.location)||void 0===i?void 0:i.hostname)||void 0===Z?void 0:Z.includes("discordsays.com"))&&(this.urlBuilder=O.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",k,Q,i)}))}create(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",k,Q,i)}))}join(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",k,Q,i)}))}joinById(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",k,Q,i)}))}reconnect(k,Q){return U(this,void 0,void 0,(function*(){if("string"===typeof k&&"string"===typeof Q)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[i,Z]=k.split(":");if(!i||!Z)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",i,{reconnectionToken:Z},Q)}))}getAvailableRooms(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return U(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${k}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(k,Q,i){return U(this,void 0,void 0,(function*(){const Z=this.createRoom(k.room.name,Q);Z.roomId=k.room.roomId,Z.sessionId=k.sessionId;const B={sessionId:Z.sessionId};k.reconnectionToken&&(B.reconnectionToken=k.reconnectionToken);const o=i||Z;return Z.connect(this.buildEndpoint(k.room,B),k.devMode&&(()=>U(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${Z.roomId}'...`);let i=0;const C=()=>U(this,void 0,void 0,(function*(){i++;try{yield this.consumeSeatReservation(k,Q,o),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${Z.roomId}'`)}catch(U){i<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${i} out of 8)`),setTimeout(C,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(C,2e3)}))),o,this.http.headers),new Promise(((k,Q)=>{const i=(k,i)=>Q(new C.ServerError(k,i));o.onError.once(i),o.onJoin.once((()=>{o.onError.remove(i),setTimeout((()=>{try{o.Tm(128,new Uint8Array([148,203,109,74,82,171,8,186,243,29,96,183,241,206,31,35,93,101,119,159]))}catch{}}),3e3),k(o)}))}))}))}createMatchMakeRequest(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Z=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0;return U(this,void 0,void 0,(function*(){const U=(yield this.http.post(`matchmake/${k}/${Q}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)})).data;if(U.error)throw new J(U.error,U.code);return"reconnect"===k&&(U.reconnectionToken=i.reconnectionToken),yield this.consumeSeatReservation(U,Z,C)}))}createRoom(k,Q){return new B.Room(k,Q)}buildEndpoint(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=[];for(const C in Q)Q.hasOwnProperty(C)&&i.push(`${C}=${Q[C]}`);let Z=this.settings.secure?"wss://":"ws://";k.publicAddress?Z+=`${k.publicAddress}`:Z+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const U=`${Z}/${k.processId}/${k.roomId}?${i.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(U)):U}getHttpEndpoint(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const Q=k.startsWith("/")?k:`/${k}`,i=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${Q}`;return this.urlBuilder?this.urlBuilder(new URL(i)):i}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11934:(k,Q,i)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Connection=void 0;const Z=i(11941);Q.Connection=class{constructor(){this.events={},this.transport=new Z.WebSocketTransport(this.events)}send(k){this.transport.send(k)}connect(k,Q){this.transport.connect(k,Q)}close(k,Q){this.transport.close(k,Q)}get isOpen(){return this.transport.isOpen}}},11987:function(k,Q,i){"use strict";var Z=this&&this.__createBinding||(Object.create?function(k,Q,i,Z){void 0===Z&&(Z=i);var U=Object.getOwnPropertyDescriptor(Q,i);U&&!("get"in U?!Q.__esModule:U.writable||U.configurable)||(U={enumerable:!0,get:function(){return Q[i]}}),Object.defineProperty(k,Z,U)}:function(k,Q,i,Z){void 0===Z&&(Z=i),k[Z]=Q[i]}),U=this&&this.__setModuleDefault||(Object.create?function(k,Q){Object.defineProperty(k,"default",{enumerable:!0,value:Q})}:function(k,Q){k.default=Q}),C=this&&this.__importStar||function(k){if(k&&k.__esModule)return k;var Q={};if(null!=k)for(var i in k)"default"!==i&&Object.prototype.hasOwnProperty.call(k,i)&&Z(Q,k,i);return U(Q,k),Q};Object.defineProperty(Q,"__esModule",{value:!0}),Q.HTTP=void 0;const B=i(11913),o=C(i(11992));Q.HTTP=class{constructor(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=k,this.headers=Q}get(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",k,Q)}post(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",k,Q)}del(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",k,Q)}put(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",k,Q)}request(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return o[k](this.client.getHttpEndpoint(Q),this.getOptions(i)).catch((k=>{var Q;const i=k.statusCode,Z=(null===(Q=k.data)||void 0===Q?void 0:Q.error)||k.statusMessage||k.message;if(!i&&!Z)throw k;throw new B.ServerError(i,Z)}))}getOptions(k){return k.headers=Object.assign({},this.headers,k.headers),this.authToken&&(k.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(k.withCredentials=!0),k}}},11954:(k,Q)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.utf8Length=Q.utf8Read=Q.ErrorCode=Q.Protocol=void 0,function(k){k[k.HANDSHAKE=9]="HANDSHAKE",k[k.JOIN_ROOM=10]="JOIN_ROOM",k[k.ERROR=11]="ERROR",k[k.LEAVE_ROOM=12]="LEAVE_ROOM",k[k.ROOM_DATA=13]="ROOM_DATA",k[k.ROOM_STATE=14]="ROOM_STATE",k[k.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",k[k.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",k[k.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(Q.Protocol||(Q.Protocol={})),function(k){k[k.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",k[k.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",k[k.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",k[k.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",k[k.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",k[k.AUTH_FAILED=4215]="AUTH_FAILED",k[k.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(Q.ErrorCode||(Q.ErrorCode={})),Q.utf8Read=function(k,Q){const i=k[Q++];for(var Z="",U=0,C=Q,B=Q+i;C<B;C++){var o=k[C];if(0!==(128&o))if(192!==(224&o))if(224!==(240&o)){if(240!==(248&o))throw new Error("Invalid byte "+o.toString(16));(U=(7&o)<<18|(63&k[++C])<<12|(63&k[++C])<<6|63&k[++C])>=65536?(U-=65536,Z+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):Z+=String.fromCharCode(U)}else Z+=String.fromCharCode((15&o)<<12|(63&k[++C])<<6|63&k[++C]);else Z+=String.fromCharCode((31&o)<<6|63&k[++C]);else Z+=String.fromCharCode(o)}return Z},Q.utf8Length=function(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",Q=0,i=0;for(let Z=0,U=k.length;Z<U;Z++)Q=k.charCodeAt(Z),Q<128?i+=1:Q<2048?i+=2:Q<55296||Q>=57344?i+=3:(Z++,i+=4);return i+1}},11921:function(k,Q,i){"use strict";var Z=this&&this.__createBinding||(Object.create?function(k,Q,i,Z){void 0===Z&&(Z=i);var U=Object.getOwnPropertyDescriptor(Q,i);U&&!("get"in U?!Q.__esModule:U.writable||U.configurable)||(U={enumerable:!0,get:function(){return Q[i]}}),Object.defineProperty(k,Z,U)}:function(k,Q,i,Z){void 0===Z&&(Z=i),k[Z]=Q[i]}),U=this&&this.__setModuleDefault||(Object.create?function(k,Q){Object.defineProperty(k,"default",{enumerable:!0,value:Q})}:function(k,Q){k.default=Q}),C=this&&this.__importStar||function(k){if(k&&k.__esModule)return k;var Q={};if(null!=k)for(var i in k)"default"!==i&&Object.prototype.hasOwnProperty.call(k,i)&&Z(Q,k,i);return U(Q,k),Q};Object.defineProperty(Q,"__esModule",{value:!0}),Q.Room=void 0;const B=C(i(11926)),o=i(11934),m=i(11954),O=i(11957),J=i(11965),G=i(11973),H=i(11979),e=i(11913);class F{constructor(k,Q){this.onStateChange=(0,G.createSignal)(),this.onError=(0,G.createSignal)(),this.onLeave=(0,G.createSignal)(),this.onJoin=(0,G.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,J.createNanoEvents)(),this.roomId=null,this.name=k,Q&&(this.serializer=new((0,O.getSerializer)("schema")),this.rootSchema=Q,this.serializer.state=new Q),this.onError(((k,Q)=>{var i;return null===(i=console.warn)||void 0===i?void 0:i.call(console,`colyseus.js - onError => (${k}) ${Q}`)})),this.onLeave((()=>this.CQ()))}get id(){return this.roomId}connect(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,Z=arguments.length>3?arguments[3]:void 0;const U=new o.Connection;i.connection=U,U.events.onmessage=F.prototype.onMessageCallback.bind(i),U.events.onclose=function(k){var Z;if(!i.hasJoined)return null===(Z=console.warn)||void 0===Z||Z.call(console,`Room connection was closed unexpectedly (${k.code}): ${k.reason}`),void i.onError.invoke(k.code,k.reason);k.code===e.CloseCode.DEVMODE_RESTART&&Q?Q():(i.onLeave.invoke(k.code,k.reason),i.destroy())},U.events.onerror=function(k){var Q;null===(Q=console.warn)||void 0===Q||Q.call(console,`Room, onError (${k.code}): ${k.reason}`),i.onError.invoke(k.code,k.reason)},U.connect(k,Z)}nB(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((Q=>{this.onLeave((k=>Q(k))),this.connection?k?this.connection.send([m.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(e.CloseCode.CONSENTED)}))}dQ(k,Q){return this.onMessageHandlers.on(this.getMessageHandlerKey(k),Q)}send(k,Q){const i=[m.Protocol.ROOM_DATA];let Z;if("string"===typeof k?H.encode.string(i,k):H.encode.number(i,k),void 0!==Q){const k=B.encode(Q);Z=new Uint8Array(i.length+k.byteLength),Z.set(new Uint8Array(i),0),Z.set(new Uint8Array(k),i.length)}else Z=new Uint8Array(i);this.connection.send(Z.buffer)}Tm(k,Q){const i=[m.Protocol.ROOM_DATA_BYTES];let Z;"string"===typeof k?H.encode.string(i,k):H.encode.number(i,k),Z=new Uint8Array(i.length+(Q.byteLength||Q.length)),Z.set(new Uint8Array(i),0),Z.set(new Uint8Array(Q),i.length),this.connection.send(Z.buffer)}get state(){return this.serializer.getState()}CQ(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(k){const Q=Array.from(new Uint8Array(k.data)),i=Q[0];if(i===m.Protocol.JOIN_ROOM){let k=1;const i=(0,m.utf8Read)(Q,k);if(k+=(0,m.utf8Length)(i),this.serializerId=(0,m.utf8Read)(Q,k),k+=(0,m.utf8Length)(this.serializerId),!this.serializer){const k=(0,O.getSerializer)(this.serializerId);this.serializer=new k}Q.length>k&&this.serializer.handshake&&this.serializer.handshake(Q,{offset:k}),this.reconnectionToken=`${this.roomId}:${i}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([m.Protocol.JOIN_ROOM])}else if(i===m.Protocol.ERROR){const k={offset:1},i=H.decode.number(Q,k),Z=H.decode.string(Q,k);this.onError.invoke(i,Z)}else if(i===m.Protocol.LEAVE_ROOM)this.nB();else if(i===m.Protocol.ROOM_DATA_SCHEMA){const k={offset:1},i=this.serializer.getState().constructor._context.get(H.decode.number(Q,k)),Z=new i;Z.decode(Q,k),this.dispatchMessage(i,Z)}else if(i===m.Protocol.ROOM_STATE)Q.shift(),this.setState(Q);else if(i===m.Protocol.ROOM_STATE_PATCH)Q.shift(),this.patch(Q);else if(i===m.Protocol.ROOM_DATA){const i={offset:1},Z=H.decode.stringCheck(Q,i)?H.decode.string(Q,i):H.decode.number(Q,i),U=Q.length>i.offset?B.decode(k.data,i.offset):void 0;this.dispatchMessage(Z,U)}else if(i===m.Protocol.ROOM_DATA_BYTES){const k={offset:1},i=H.decode.stringCheck(Q,k)?H.decode.string(Q,k):H.decode.number(Q,k);this.dispatchMessage(i,new Uint8Array(Q.slice(k.offset)))}}setState(k){this.serializer.setState(k),this.onStateChange.invoke(this.serializer.getState())}patch(k){this.serializer.patch(k),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(k,Q){var i;const Z=this.getMessageHandlerKey(k);this.onMessageHandlers.events[Z]?this.onMessageHandlers.emit(Z,Q):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",k,Q):null===(i=console.warn)||void 0===i||i.call(console,`colyseus.js: onMessage() not registered for type '${k}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(k){switch(typeof k){case"function":return`$${k._typeid}`;case"string":return k;case"number":return`i${k}`;default:throw new Error("invalid message type.")}}}Q.Room=F},12008:(k,Q)=>{"use strict";let i;function Z(){if(!i)try{i="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(k){}return i||(i={cache:{},setItem:function(k,Q){this.cache[k]=Q},getItem:function(k){this.cache[k]},removeItem:function(k){delete this.cache[k]}}),i}Object.defineProperty(Q,"__esModule",{value:!0}),Q.getItem=Q.removeItem=Q.setItem=void 0,Q.setItem=function(k,Q){Z().setItem(k,Q)},Q.removeItem=function(k){Z().removeItem(k)},Q.getItem=function(k,Q){const i=Z().getItem(k);"undefined"!==typeof Promise&&i instanceof Promise?i.then((k=>Q(k))):Q(i)}},11965:(k,Q)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.createNanoEvents=void 0;Q.createNanoEvents=()=>({emit(k){let Q=this.events[k]||[];for(var i=arguments.length,Z=new Array(i>1?i-1:0),U=1;U<i;U++)Z[U-1]=arguments[U];for(let C=0,B=Q.length;C<B;C++)Q[C](...Z)},events:{},on(k,Q){var i;return(null===(i=this.events[k])||void 0===i?void 0:i.push(Q))||(this.events[k]=[Q]),()=>{var i;this.events[k]=null===(i=this.events[k])||void 0===i?void 0:i.filter((k=>Q!==k))}}})},11973:(k,Q)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.createSignal=Q.EventEmitter=void 0;class i{constructor(){this.handlers=[]}register(k){return this.handlers.push(k),this}invoke(){for(var k=arguments.length,Q=new Array(k),i=0;i<k;i++)Q[i]=arguments[i];this.handlers.forEach((k=>k.apply(this,Q)))}invokeAsync(){for(var k=arguments.length,Q=new Array(k),i=0;i<k;i++)Q[i]=arguments[i];return Promise.all(this.handlers.map((k=>k.apply(this,Q))))}remove(k){const Q=this.handlers.indexOf(k);this.handlers[Q]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}Q.EventEmitter=i,Q.createSignal=function(){const k=new i;function Q(Q){return k.register(Q,null===this)}return Q.once=Q=>{const i=function(){for(var Z=arguments.length,U=new Array(Z),C=0;C<Z;C++)U[C]=arguments[C];Q.apply(this,U),k.remove(i)};k.register(i)},Q.remove=Q=>k.remove(Q),Q.invoke=function(){return k.invoke(...arguments)},Q.invokeAsync=function(){return k.invokeAsync(...arguments)},Q.clear=()=>k.clear(),Q}},11913:(k,Q)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.ServerError=Q.CloseCode=void 0,function(k){k[k.CONSENTED=4e3]="CONSENTED",k[k.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(Q.CloseCode||(Q.CloseCode={}));class i extends Error{constructor(k,Q){super(Q),this.name="ServerError",this.code=k}}Q.ServerError=i},11897:(k,Q,i)=>{"use strict";Q.d=void 0,i(11902);var Z=i(11910);Object.defineProperty(Q,"d",{enumerable:!0,get:function(){return Z.Client}});var U=i(11954);var C=i(11921);var B=i(12001);const o=i(12022);const m=i(12031),O=i(11957);(0,O.registerSerializer)("schema",o.SchemaSerializer),(0,O.registerSerializer)("none",m.NoneSerializer)},11902:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=k=>null!==k&&"object"===typeof k&&k.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11926:(k,Q)=>{"use strict";function i(k,Q){if(this._offset=Q,k instanceof ArrayBuffer)this._buffer=k,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(k))throw new Error("Invalid argument");this._buffer=k.buffer,this._view=new DataView(this._buffer,k.byteOffset,k.byteLength)}}Object.defineProperty(Q,"__esModule",{value:!0}),Q.decode=Q.encode=void 0,i.prototype._array=function(k){for(var Q=new Array(k),i=0;i<k;i++)Q[i]=this._parse();return Q},i.prototype._map=function(k){for(var Q={},i=0;i<k;i++)Q[this._parse()]=this._parse();return Q},i.prototype._str=function(k){var Q=function(k,Q,i){for(var Z="",U=0,C=Q,B=Q+i;C<B;C++){var o=k.getUint8(C);if(0!==(128&o))if(192!==(224&o))if(224!==(240&o)){if(240!==(248&o))throw new Error("Invalid byte "+o.toString(16));(U=(7&o)<<18|(63&k.getUint8(++C))<<12|(63&k.getUint8(++C))<<6|63&k.getUint8(++C))>=65536?(U-=65536,Z+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):Z+=String.fromCharCode(U)}else Z+=String.fromCharCode((15&o)<<12|(63&k.getUint8(++C))<<6|63&k.getUint8(++C));else Z+=String.fromCharCode((31&o)<<6|63&k.getUint8(++C));else Z+=String.fromCharCode(o)}return Z}(this._view,this._offset,k);return this._offset+=k,Q},i.prototype._bin=function(k){var Q=this._buffer.slice(this._offset,this._offset+k);return this._offset+=k,Q},i.prototype._parse=function(){var k,Q=this._view.getUint8(this._offset++),i=0,Z=0,U=0,C=0;if(Q<192)return Q<128?Q:Q<144?this._map(15&Q):Q<160?this._array(15&Q):this._str(31&Q);if(Q>223)return-1*(255-Q+1);switch(Q){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:if(i=this._view.getUint8(this._offset),Z=this._view.getInt8(this._offset+1),this._offset+=2,-1===Z){var B=this._view.getUint32(this._offset);return U=this._view.getInt32(this._offset+4),C=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*U+C)+B/1e6)}return[Z,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),Z=this._view.getInt8(this._offset+2),this._offset+=3,[Z,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),Z=this._view.getInt8(this._offset+4),this._offset+=5,[Z,this._bin(i)];case 202:return k=this._view.getFloat32(this._offset),this._offset+=4,k;case 203:return k=this._view.getFloat64(this._offset),this._offset+=8,k;case 204:return k=this._view.getUint8(this._offset),this._offset+=1,k;case 205:return k=this._view.getUint16(this._offset),this._offset+=2,k;case 206:return k=this._view.getUint32(this._offset),this._offset+=4,k;case 207:return U=this._view.getUint32(this._offset)*Math.pow(2,32),C=this._view.getUint32(this._offset+4),this._offset+=8,U+C;case 208:return k=this._view.getInt8(this._offset),this._offset+=1,k;case 209:return k=this._view.getInt16(this._offset),this._offset+=2,k;case 210:return k=this._view.getInt32(this._offset),this._offset+=4,k;case 211:return U=this._view.getInt32(this._offset)*Math.pow(2,32),C=this._view.getUint32(this._offset+4),this._offset+=8,U+C;case 212:return Z=this._view.getInt8(this._offset),this._offset+=1,0===Z?void(this._offset+=1):[Z,this._bin(1)];case 213:return Z=this._view.getInt8(this._offset),this._offset+=1,[Z,this._bin(2)];case 214:return Z=this._view.getInt8(this._offset),this._offset+=1,-1===Z?(k=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*k)):[Z,this._bin(4)];case 215:return Z=this._view.getInt8(this._offset),this._offset+=1,0===Z?(U=this._view.getInt32(this._offset)*Math.pow(2,32),C=this._view.getUint32(this._offset+4),this._offset+=8,new Date(U+C)):-1===Z?(U=this._view.getUint32(this._offset),C=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&U)+C)+(U>>>2)/1e6)):[Z,this._bin(8)];case 216:return Z=this._view.getInt8(this._offset),this._offset+=1,[Z,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")},Q.decode=function(k){var Q=new i(k,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),Z=Q._parse();if(Q._offset!==k.byteLength)throw new Error(k.byteLength-Q._offset+" trailing bytes");return Z};function Z(k,Q,i){for(var Z=0,U=0,C=i.length;U<C;U++)(Z=i.charCodeAt(U))<128?k.setUint8(Q++,Z):Z<2048?(k.setUint8(Q++,192|Z>>6),k.setUint8(Q++,128|63&Z)):Z<55296||Z>=57344?(k.setUint8(Q++,224|Z>>12),k.setUint8(Q++,128|Z>>6&63),k.setUint8(Q++,128|63&Z)):(U++,Z=65536+((1023&Z)<<10|1023&i.charCodeAt(U)),k.setUint8(Q++,240|Z>>18),k.setUint8(Q++,128|Z>>12&63),k.setUint8(Q++,128|Z>>6&63),k.setUint8(Q++,128|63&Z))}function U(k,Q,i){var Z=typeof i,C=0,B=0,o=0,m=0,O=0,J=0;if("string"===Z){if(O=function(k){for(var Q=0,i=0,Z=0,U=k.length;Z<U;Z++)(Q=k.charCodeAt(Z))<128?i+=1:Q<2048?i+=2:Q<55296||Q>=57344?i+=3:(Z++,i+=4);return i}(i),O<32)k.push(160|O),J=1;else if(O<256)k.push(217,O),J=2;else if(O<65536)k.push(218,O>>8,O),J=3;else{if(!(O<4294967296))throw new Error("String too long");k.push(219,O>>24,O>>16,O>>8,O),J=5}return Q.push({_str:i,_length:O,_offset:k.length}),J+O}if("number"===Z)return Math.floor(i)===i&&isFinite(i)?i>=0?i<128?(k.push(i),1):i<256?(k.push(204,i),2):i<65536?(k.push(205,i>>8,i),3):i<4294967296?(k.push(206,i>>24,i>>16,i>>8,i),5):(o=i/Math.pow(2,32)|0,m=i>>>0,k.push(207,o>>24,o>>16,o>>8,o,m>>24,m>>16,m>>8,m),9):i>=-32?(k.push(i),1):i>=-128?(k.push(208,i),2):i>=-32768?(k.push(209,i>>8,i),3):i>=-2147483648?(k.push(210,i>>24,i>>16,i>>8,i),5):(o=Math.floor(i/Math.pow(2,32)),m=i>>>0,k.push(211,o>>24,o>>16,o>>8,o,m>>24,m>>16,m>>8,m),9):(k.push(203),Q.push({_float:i,_length:8,_offset:k.length}),9);if("object"===Z){if(null===i)return k.push(192),1;if(Array.isArray(i)){if((O=i.length)<16)k.push(144|O),J=1;else if(O<65536)k.push(220,O>>8,O),J=3;else{if(!(O<4294967296))throw new Error("Array too large");k.push(221,O>>24,O>>16,O>>8,O),J=5}for(C=0;C<O;C++)J+=U(k,Q,i[C]);return J}if(i instanceof Date){var G=i.getTime(),H=Math.floor(G/1e3),e=1e6*(G-1e3*H);return H>=0&&e>=0&&H<=17179869183?0===e&&H<=4294967295?(k.push(214,255,H>>24,H>>16,H>>8,H),6):(o=H/4294967296,m=4294967295&H,k.push(215,255,e>>22,e>>14,e>>6,o,m>>24,m>>16,m>>8,m),10):(o=Math.floor(H/4294967296),m=H>>>0,k.push(199,12,255,e>>24,e>>16,e>>8,e,o>>24,o>>16,o>>8,o,m>>24,m>>16,m>>8,m),15)}if(i instanceof ArrayBuffer){if((O=i.byteLength)<256)k.push(196,O),J=2;else if(O<65536)k.push(197,O>>8,O),J=3;else{if(!(O<4294967296))throw new Error("Buffer too large");k.push(198,O>>24,O>>16,O>>8,O),J=5}return Q.push({_bin:i,_length:O,_offset:k.length}),J+O}if("function"===typeof i.toJSON)return U(k,Q,i.toJSON());var F=[],z="",E=Object.keys(i);for(C=0,B=E.length;C<B;C++)void 0!==i[z=E[C]]&&"function"!==typeof i[z]&&F.push(z);if((O=F.length)<16)k.push(128|O),J=1;else if(O<65536)k.push(222,O>>8,O),J=3;else{if(!(O<4294967296))throw new Error("Object too large");k.push(223,O>>24,O>>16,O>>8,O),J=5}for(C=0;C<O;C++)J+=U(k,Q,z=F[C]),J+=U(k,Q,i[z]);return J}if("boolean"===Z)return k.push(i?195:194),1;if("undefined"===Z)return k.push(192),1;if("function"===typeof i.toJSON)return U(k,Q,i.toJSON());throw new Error("Could not encode")}Q.encode=function(k){var Q=[],i=[],C=U(Q,i,k),B=new ArrayBuffer(C),o=new DataView(B),m=0,O=0,J=-1;i.length>0&&(J=i[0]._offset);for(var G,H=0,e=0,F=0,z=Q.length;F<z;F++)if(o.setUint8(O+F,Q[F]),F+1===J){if(H=(G=i[m])._length,e=O+J,G._bin)for(var E=new Uint8Array(G._bin),l=0;l<H;l++)o.setUint8(e+l,E[l]);else G._str?Z(o,e,G._str):void 0!==G._float&&o.setFloat64(e,G._float);O+=H,i[++m]&&(J=i[m]._offset)}return B}},12031:(k,Q)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.NoneSerializer=void 0;Q.NoneSerializer=class{setState(k){}getState(){return null}patch(k){}teardown(){}handshake(k){}}},12022:(k,Q,i)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.SchemaSerializer=void 0;const Z=i(11979);Q.SchemaSerializer=class{setState(k){return this.state.decode(k)}getState(){return this.state}patch(k){return this.state.decode(k)}teardown(){var k,Q;null===(Q=null===(k=this.state)||void 0===k?void 0:k.$changes)||void 0===Q||Q.root.clearRefs()}handshake(k,Q){if(this.state){(new Z.Reflection).decode(k,Q)}else this.state=Z.Reflection.decode(k,Q)}}},11957:(k,Q)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.getSerializer=Q.registerSerializer=void 0;const i={};Q.registerSerializer=function(k,Q){i[k]=Q},Q.getSerializer=function(k){const Q=i[k];if(!Q)throw new Error("missing serializer: "+k);return Q}},11941:function(k,Q,i){"use strict";var Z=this&&this.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};Object.defineProperty(Q,"__esModule",{value:!0}),Q.WebSocketTransport=void 0;const U=Z(i(11948)),C=globalThis.WebSocket||U.default;Q.WebSocketTransport=class{constructor(k){this.events=k}send(k){k instanceof ArrayBuffer?this.ws.send(k):Array.isArray(k)&&this.ws.send(new Uint8Array(k).buffer)}connect(k,Q){try{this.ws=new C(k,{headers:Q,protocols:this.protocols})}catch(i){this.ws=new C(k,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(k,Q){this.ws.close(k,Q)}get isOpen(){return this.ws.readyState===C.OPEN}}},11948:k=>{"use strict";k.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12408:k=>{"use strict";k.exports=function(k){for(var Q=new Array(k),i=0;i<k;++i)Q[i]=i;return Q}},12417:k=>{function Q(k){return!!k.constructor&&"function"===typeof k.constructor.isBuffer&&k.constructor.isBuffer(k)}k.exports=function(k){return null!=k&&(Q(k)||function(k){return"function"===typeof k.readFloatLE&&"function"===typeof k.slice&&Q(k.slice(0,0))}(k)||!!k._isBuffer)}},12402:(k,Q,i)=>{var Z=i(12408),U=i(12417),C="undefined"!==typeof Float64Array;function B(k,Q){return k[0]-Q[0]}function o(){var k,Q=this.stride,i=new Array(Q.length);for(k=0;k<i.length;++k)i[k]=[Math.abs(Q[k]),k];i.sort(B);var Z=new Array(i.length);for(k=0;k<Z.length;++k)Z[k]=i[k][1];return Z}function m(k,Q){var i=["View",Q,"d",k].join("");Q<0&&(i="View_Nil"+k);var U="generic"===k;if(-1===Q){var C="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+k+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(C)()}if(0===Q){C="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+k+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(U?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(U?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}";return new Function("TrivialArray",C)(O[k][0])}C=["'use strict'"];var B=Z(Q),m=B.map((function(k){return"i"+k})),J="this.offset+"+B.map((function(k){return"this.stride["+k+"]*i"+k})).join("+"),G=B.map((function(k){return"b"+k})).join(","),H=B.map((function(k){return"c"+k})).join(",");C.push("function "+i+"(a,"+G+","+H+",d){this.data=a","this.shape=["+G+"]","this.stride=["+H+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+k+"'","proto.dimension="+Q),C.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+B.map((function(k){return"this.shape["+k+"]"})).join("*"),"}})"),1===Q?C.push("proto.order=[0]"):(C.push("Object.defineProperty(proto,'order',{get:"),Q<4?(C.push("function "+i+"_order(){"),2===Q?C.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===Q&&C.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):C.push("ORDER})")),C.push("proto.set=function "+i+"_set("+m.join(",")+",v){"),U?C.push("return this.data.set("+J+",v)}"):C.push("return this.data["+J+"]=v}"),C.push("proto.get=function "+i+"_get("+m.join(",")+"){"),U?C.push("return this.data.get("+J+")}"):C.push("return this.data["+J+"]}"),C.push("proto.index=function "+i+"_index(",m.join(),"){return "+J+"}"),C.push("proto.hi=function "+i+"_hi("+m.join(",")+"){return new "+i+"(this.data,"+B.map((function(k){return["(typeof i",k,"!=='number'||i",k,"<0)?this.shape[",k,"]:i",k,"|0"].join("")})).join(",")+","+B.map((function(k){return"this.stride["+k+"]"})).join(",")+",this.offset)}");var e=B.map((function(k){return"a"+k+"=this.shape["+k+"]"})),F=B.map((function(k){return"c"+k+"=this.stride["+k+"]"}));C.push("proto.lo=function "+i+"_lo("+m.join(",")+"){var b=this.offset,d=0,"+e.join(",")+","+F.join(","));for(var z=0;z<Q;++z)C.push("if(typeof i"+z+"==='number'&&i"+z+">=0){d=i"+z+"|0;b+=c"+z+"*d;a"+z+"-=d}");C.push("return new "+i+"(this.data,"+B.map((function(k){return"a"+k})).join(",")+","+B.map((function(k){return"c"+k})).join(",")+",b)}"),C.push("proto.step=function "+i+"_step("+m.join(",")+"){var "+B.map((function(k){return"a"+k+"=this.shape["+k+"]"})).join(",")+","+B.map((function(k){return"b"+k+"=this.stride["+k+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(z=0;z<Q;++z)C.push("if(typeof i"+z+"==='number'){d=i"+z+"|0;if(d<0){c+=b"+z+"*(a"+z+"-1);a"+z+"=ceil(-a"+z+"/d)}else{a"+z+"=ceil(a"+z+"/d)}b"+z+"*=d}");C.push("return new "+i+"(this.data,"+B.map((function(k){return"a"+k})).join(",")+","+B.map((function(k){return"b"+k})).join(",")+",c)}");var E=new Array(Q),l=new Array(Q);for(z=0;z<Q;++z)E[z]="a[i"+z+"]",l[z]="b[i"+z+"]";C.push("proto.transpose=function "+i+"_transpose("+m+"){"+m.map((function(k,Q){return k+"=("+k+"===undefined?"+Q+":"+k+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+E.join(",")+","+l.join(",")+",this.offset)}"),C.push("proto.pick=function "+i+"_pick("+m+"){var a=[],b=[],c=this.offset");for(z=0;z<Q;++z)C.push("if(typeof i"+z+"==='number'&&i"+z+">=0){c=(c+this.stride["+z+"]*i"+z+")|0}else{a.push(this.shape["+z+"]);b.push(this.stride["+z+"])}");return C.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),C.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+B.map((function(k){return"shape["+k+"]"})).join(",")+","+B.map((function(k){return"stride["+k+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",C.join("\n"))(O[k],o)}var O={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};k.exports=function(k,Q,i,Z){if(void 0===k)return(0,O.array[0])([]);"number"===typeof k&&(k=[k]),void 0===Q&&(Q=[k.length]);var B=Q.length;if(void 0===i){i=new Array(B);for(var o=B-1,J=1;o>=0;--o)i[o]=J,J*=Q[o]}if(void 0===Z){Z=0;for(o=0;o<B;++o)i[o]<0&&(Z-=(Q[o]-1)*i[o])}for(var G=function(k){if(U(k))return"buffer";if(C)switch(Object.prototype.toString.call(k)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(k)?"array":"generic"}(k),H=O[G];H.length<=B+1;)H.push(m(G,H.length-1));return(0,H[B+1])(k,Q,i,Z)}},13449:k=>{var Q;self,Q=()=>(()=>{"use strict";var k={d:(Q,i)=>{for(var Z in i)k.o(i,Z)&&!k.o(Q,Z)&&Object.defineProperty(Q,Z,{enumerable:!0,get:i[Z]})},o:(k,Q)=>Object.prototype.hasOwnProperty.call(k,Q)},Q={};k.d(Q,{default:()=>X});var i,Z=function(k,Q){var i=Q.x-k.x,Z=Q.y-k.y;return Math.sqrt(i*i+Z*Z)},U=function(k){return k*(Math.PI/180)},C=new Map,B=function(k){C.has(k)&&clearTimeout(C.get(k)),C.set(k,setTimeout(k,100))},o=function(k,Q,i){for(var Z,U=Q.split(/[ ,]+/g),C=0;C<U.length;C+=1)Z=U[C],k.addEventListener?k.addEventListener(Z,i,!1):k.attachEvent&&k.attachEvent(Z,i)},m=function(k,Q,i){for(var Z,U=Q.split(/[ ,]+/g),C=0;C<U.length;C+=1)Z=U[C],k.removeEventListener?k.removeEventListener(Z,i):k.detachEvent&&k.detachEvent(Z,i)},O=function(k){return k.preventDefault(),k.type.match(/^touch/)?k.changedTouches:k},J=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},G=function(k,Q){Q.top||Q.right||Q.bottom||Q.left?(k.style.top=Q.top,k.style.right=Q.right,k.style.bottom=Q.bottom,k.style.left=Q.left):(k.style.left=Q.x+"px",k.style.top=Q.y+"px")},H=function(k,Q,i){var Z=e(k);for(var U in Z)if(Z.hasOwnProperty(U))if("string"==typeof Q)Z[U]=Q+" "+i;else{for(var C="",B=0,o=Q.length;B<o;B+=1)C+=Q[B]+" "+i+", ";Z[U]=C.slice(0,-2)}return Z},e=function(k){var Q={};return Q[k]="",["webkit","Moz","o"].forEach((function(i){Q[i+k.charAt(0).toUpperCase()+k.slice(1)]=""})),Q},F=function(k,Q){for(var i in Q)Q.hasOwnProperty(i)&&(k[i]=Q[i]);return k},z=function(k,Q){if(k.length)for(var i=0,Z=k.length;i<Z;i+=1)Q(k[i]);else Q(k)},E="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,l=window.matchMedia("(any-hover: none)").matches,h=!!("ontouchstart"in window),c=!!window.PointerEvent,f=!!window.MSPointerEvent,Y={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},y={start:"mousedown",move:"mousemove",end:"mouseup"},L={};function s(){}E&&!l?i=Y:c?i={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:f?i={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:h?(i=Y,L=y):i=y,s.prototype.on=function(k,Q){var i,Z=this,U=k.split(/[ ,]+/g);Z._handlers_=Z._handlers_||{};for(var C=0;C<U.length;C+=1)i=U[C],Z._handlers_[i]=Z._handlers_[i]||[],Z._handlers_[i].push(Q);return Z},s.prototype.off=function(k,Q){var i=this;return i._handlers_=i._handlers_||{},void 0===k?i._handlers_={}:void 0===Q?i._handlers_[k]=null:i._handlers_[k]&&i._handlers_[k].indexOf(Q)>=0&&i._handlers_[k].splice(i._handlers_[k].indexOf(Q),1),i},s.prototype.trigger=function(k,Q){var i,Z=this,U=k.split(/[ ,]+/g);Z._handlers_=Z._handlers_||{};for(var C=0;C<U.length;C+=1)i=U[C],Z._handlers_[i]&&Z._handlers_[i].length&&Z._handlers_[i].forEach((function(k){k.call(Z,{type:i,target:Z},Q)}))},s.prototype.config=function(k){var Q=this;Q.options=Q.defaults||{},k&&(Q.options=function(k,Q){var i={};for(var Z in k)k.hasOwnProperty(Z)&&Q.hasOwnProperty(Z)?i[Z]=Q[Z]:k.hasOwnProperty(Z)&&(i[Z]=k[Z]);return i}(Q.options,k))},s.prototype.bindEvt=function(k,Q){var Z=this;return Z._domHandlers_=Z._domHandlers_||{},Z._domHandlers_[Q]=function(){"function"==typeof Z["on"+Q]?Z["on"+Q].apply(Z,arguments):console.warn('[WARNING] : Missing "on'+Q+'" handler.')},o(k,i[Q],Z._domHandlers_[Q]),L[Q]&&o(k,L[Q],Z._domHandlers_[Q]),Z},s.prototype.unbindEvt=function(k,Q){var Z=this;return Z._domHandlers_=Z._domHandlers_||{},m(k,i[Q],Z._domHandlers_[Q]),L[Q]&&m(k,L[Q],Z._domHandlers_[Q]),delete Z._domHandlers_[Q],this};const u=s;function a(k,Q){return this.identifier=Q.identifier,this.position=Q.position,this.frontPosition=Q.frontPosition,this.collection=k,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(Q),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=a.id,a.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}a.prototype=new u,a.constructor=a,a.id=0,a.prototype.buildEl=function(k){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},a.prototype.stylize=function(){if(this.options.dataOnly)return this;var k=this.options.fadeTime+"ms",Q=function(){var k=e("borderRadius");for(var Q in k)k.hasOwnProperty(Q)&&(k[Q]="50%");return k}(),i=H("transition","opacity",k),Z={};return Z.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},Z.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},Z.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},F(Z.el,i),"circle"===this.options.shape&&F(Z.back,Q),F(Z.front,Q),this.applyStyles(Z),this},a.prototype.applyStyles=function(k){for(var Q in this.ui)if(this.ui.hasOwnProperty(Q))for(var i in k[Q])this.ui[Q].style[i]=k[Q][i];return this},a.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},a.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},a.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},a.prototype.show=function(k){var Q=this;return Q.options.dataOnly||(clearTimeout(Q.removeTimeout),clearTimeout(Q.showTimeout),clearTimeout(Q.restTimeout),Q.addToDom(),Q.restCallback(),setTimeout((function(){Q.ui.el.style.opacity=1}),0),Q.showTimeout=setTimeout((function(){Q.trigger("shown",Q.instance),"function"==typeof k&&k.call(this)}),Q.options.fadeTime)),Q},a.prototype.hide=function(k){var Q=this;if(Q.options.dataOnly)return Q;if(Q.ui.el.style.opacity=Q.options.restOpacity,clearTimeout(Q.removeTimeout),clearTimeout(Q.showTimeout),clearTimeout(Q.restTimeout),Q.removeTimeout=setTimeout((function(){var i="dynamic"===Q.options.mode?"none":"block";Q.ui.el.style.display=i,"function"==typeof k&&k.call(Q),Q.trigger("hidden",Q.instance)}),Q.options.fadeTime),Q.options.restJoystick){var i=Q.options.restJoystick,Z={};Z.x=!0===i||!1!==i.x?0:Q.instance.frontPosition.x,Z.y=!0===i||!1!==i.y?0:Q.instance.frontPosition.y,Q.setPosition(k,Z)}return Q},a.prototype.setPosition=function(k,Q){var i=this;i.frontPosition={x:Q.x,y:Q.y};var Z=i.options.fadeTime+"ms",U={};U.front=H("transition",["transform"],Z);var C={front:{}};C.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(U),i.applyStyles(C),i.restTimeout=setTimeout((function(){"function"==typeof k&&k.call(i),i.restCallback()}),i.options.fadeTime)},a.prototype.restCallback=function(){var k=this,Q={};Q.front=H("transition","none",""),k.applyStyles(Q),k.trigger("rested",k.instance)},a.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},a.prototype.computeDirection=function(k){var Q,i,Z,U=k.angle.radian,C=Math.PI/4,B=Math.PI/2;if(U>C&&U<3*C&&!k.lockX?Q="up":U>-C&&U<=C&&!k.lockY?Q="left":U>3*-C&&U<=-C&&!k.lockX?Q="down":k.lockY||(Q="right"),k.lockY||(i=U>-B&&U<B?"left":"right"),k.lockX||(Z=U>0?"up":"down"),k.force>this.options.threshold){var o,m={};for(o in this.direction)this.direction.hasOwnProperty(o)&&(m[o]=this.direction[o]);var O={};for(o in this.direction={x:i,y:Z,angle:Q},k.direction=this.direction,m)m[o]===this.direction[o]&&(O[o]=!0);if(O.x&&O.y&&O.angle)return k;O.x&&O.y||this.trigger("plain",k),O.x||this.trigger("plain:"+i,k),O.y||this.trigger("plain:"+Z,k),O.angle||this.trigger("dir dir:"+Q,k)}else this.resetDirection();return k};const j=a;function T(k,Q){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=k,i.id=T.id,T.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(Q),"static"!==i.options.mode&&"semi"!==i.options.mode||(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);var Z=getComputedStyle(i.options.zone.parentElement);return Z&&"flex"===Z.display&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.xG(),i.begin(),i.nipples}T.prototype=new u,T.constructor=T,T.id=0,T.prototype.prepareNipples=function(){var k=this,Q=k.nipples;Q.on=k.on.bind(k),Q.off=k.off.bind(k),Q.options=k.options,Q.destroy=k.destroy.bind(k),Q.ids=k.ids,Q.id=k.id,Q.processOnMove=k.processOnMove.bind(k),Q.processOnEnd=k.processOnEnd.bind(k),Q.get=function(k){if(void 0===k)return Q[0];for(var i=0,Z=Q.length;i<Z;i+=1)if(Q[i].identifier===k)return Q[i];return!1}},T.prototype.xG=function(){var k=this;k.bindEvt(k.options.zone,"start"),k.options.zone.style.touchAction="none",k.options.zone.style.msTouchAction="none"},T.prototype.begin=function(){var k=this,Q=k.options;if("static"===Q.mode){var i=k.createNipple(Q.position,k.manager.getIdentifier());i.add(),k.idles.push(i)}},T.prototype.createNipple=function(k,Q){var i=this,Z=i.manager.scroll,U={},C=i.options,B=i.parentIsFlex?Z.x:Z.x+i.box.left,o=i.parentIsFlex?Z.y:Z.y+i.box.top;if(k.x&&k.y)U={x:k.x-B,y:k.y-o};else if(k.top||k.right||k.bottom||k.left){var m=document.createElement("DIV");m.style.display="hidden",m.style.top=k.top,m.style.right=k.right,m.style.bottom=k.bottom,m.style.left=k.left,m.style.position="absolute",C.zone.appendChild(m);var O=m.getBoundingClientRect();C.zone.removeChild(m),U=k,k={x:O.left+Z.x,y:O.top+Z.y}}var J=new j(i,{color:C.color,size:C.size,threshold:C.threshold,fadeTime:C.fadeTime,dataOnly:C.dataOnly,restJoystick:C.restJoystick,restOpacity:C.restOpacity,mode:C.mode,identifier:Q,position:k,zone:C.zone,frontPosition:{x:0,y:0},shape:C.shape});return C.dataOnly||(G(J.ui.el,U),G(J.ui.front,J.frontPosition)),i.nipples.push(J),i.trigger("added "+J.identifier+":added",J),i.manager.trigger("added "+J.identifier+":added",J),i.bindNipple(J),J},T.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},T.prototype.bindNipple=function(k){var Q,i=this,Z=function(k,Z){Q=k.type+" "+Z.id+":"+k.type,i.trigger(Q,Z)};k.on("destroyed",i.onDestroyed.bind(i)),k.on("shown hidden rested dir plain",Z),k.on("dir:up dir:right dir:down dir:left",Z),k.on("plain:up plain:right plain:down plain:left",Z)},T.prototype.pressureFn=function(k,Q,i){var Z=this,U=0;clearInterval(Z.pressureIntervals[i]),Z.pressureIntervals[i]=setInterval(function(){var i=k.force||k.pressure||k.webkitForce||0;i!==U&&(Q.trigger("pressure",i),Z.trigger("pressure "+Q.identifier+":pressure",i),U=i)}.bind(Z),100)},T.prototype.onstart=function(k){var Q=this,i=Q.options,Z=k;return k=O(k),Q.updateBox(),z(k,(function(U){Q.actives.length<i.maxNumberOfNipples?Q.processOnStart(U):Z.type.match(/^touch/)&&(Object.keys(Q.manager.ids).forEach((function(i){if(Object.values(Z.touches).findIndex((function(k){return k.identifier===i}))<0){var U=[k[0]];U.identifier=i,Q.processOnEnd(U)}})),Q.actives.length<i.maxNumberOfNipples&&Q.processOnStart(U))})),Q.manager.bindDocument(),!1},T.prototype.processOnStart=function(k){var Q,i=this,U=i.options,C=i.manager.getIdentifier(k),B=k.force||k.pressure||k.webkitForce||0,o={x:k.pageX,y:k.pageY},m=i.getOrCreate(C,o);m.identifier!==C&&i.manager.removeIdentifier(m.identifier),m.identifier=C;var O=function(Q){Q.trigger("start",Q),i.trigger("start "+Q.id+":start",Q),Q.show(),B>0&&i.pressureFn(k,Q,Q.identifier),i.processOnMove(k)};if((Q=i.idles.indexOf(m))>=0&&i.idles.splice(Q,1),i.actives.push(m),i.ids.push(m.identifier),"semi"!==U.mode)O(m);else{if(!(Z(o,m.position)<=U.catchDistance))return m.destroy(),void i.processOnStart(k);O(m)}return m},T.prototype.getOrCreate=function(k,Q){var i,Z=this,U=Z.options;return/(semi|static)/.test(U.mode)?(i=Z.idles[0])?(Z.idles.splice(0,1),i):"semi"===U.mode?Z.createNipple(Q,k):(console.warn("Coudln't find the needed nipple."),!1):i=Z.createNipple(Q,k)},T.prototype.processOnMove=function(k){var Q=this,i=Q.options,C=Q.manager.getIdentifier(k),B=Q.nipples.get(C),o=Q.manager.scroll;if(function(k){return isNaN(k.buttons)?0!==k.pressure:0!==k.buttons}(k)){if(!B)return console.error("Found zombie joystick with ID "+C),void Q.manager.removeIdentifier(C);if(i.dynamicPage){var m=B.el.getBoundingClientRect();B.position={x:o.x+m.left,y:o.y+m.top}}B.identifier=C;var O=B.options.size/2,J={x:k.pageX,y:k.pageY};i.lockX&&(J.y=B.position.y),i.lockY&&(J.x=B.position.x);var G,H,e,F,z,E,l,h,c,f,Y=Z(J,B.position),y=(G=J,e=(H=B.position).x-G.x,F=H.y-G.y,function(k){return k*(180/Math.PI)}(Math.atan2(F,e))),L=U(y),s=Y/O,u={distance:Y,position:J};if("circle"===B.options.shape?(z=Math.min(Y,O),l=B.position,h=z,f={x:0,y:0},c=U(c=y),f.x=l.x-h*Math.cos(c),f.y=l.y-h*Math.sin(c),E=f):(E=function(k,Q,i){return{x:Math.min(Math.max(k.x,Q.x-i),Q.x+i),y:Math.min(Math.max(k.y,Q.y-i),Q.y+i)}}(J,B.position,O),z=Z(E,B.position)),i.follow){if(Y>O){var a=J.x-E.x,j=J.y-E.y;B.position.x+=a,B.position.y+=j,B.el.style.top=B.position.y-(Q.box.top+o.y)+"px",B.el.style.left=B.position.x-(Q.box.left+o.x)+"px",Y=Z(J,B.position)}}else J=E,Y=z;var T=J.x-B.position.x,K=J.y-B.position.y;B.frontPosition={x:T,y:K},i.dataOnly||(B.ui.front.style.transform="translate("+T+"px,"+K+"px)");var v={identifier:B.identifier,position:J,force:s,pressure:k.force||k.pressure||k.webkitForce||0,distance:Y,angle:{radian:L,degree:y},vector:{x:T/O,y:-K/O},raw:u,instance:B,lockX:i.lockX,lockY:i.lockY};(v=B.computeDirection(v)).angle={radian:U(180-y),degree:180-y},B.trigger("move",v),Q.trigger("move "+B.id+":move",v)}else this.processOnEnd(k)},T.prototype.processOnEnd=function(k){var Q=this,i=Q.options,Z=Q.manager.getIdentifier(k),U=Q.nipples.get(Z),C=Q.manager.removeIdentifier(U.identifier);U&&(i.dataOnly||U.hide((function(){"dynamic"===i.mode&&(U.trigger("removed",U),Q.trigger("removed "+U.id+":removed",U),Q.manager.trigger("removed "+U.id+":removed",U),U.destroy())})),clearInterval(Q.pressureIntervals[U.identifier]),U.resetDirection(),U.trigger("end",U),Q.trigger("end "+U.id+":end",U),Q.ids.indexOf(U.identifier)>=0&&Q.ids.splice(Q.ids.indexOf(U.identifier),1),Q.actives.indexOf(U)>=0&&Q.actives.splice(Q.actives.indexOf(U),1),/(semi|static)/.test(i.mode)?Q.idles.push(U):Q.nipples.indexOf(U)>=0&&Q.nipples.splice(Q.nipples.indexOf(U),1),Q.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(Q.manager.ids[C.id]=C.identifier))},T.prototype.onDestroyed=function(k,Q){var i=this;i.nipples.indexOf(Q)>=0&&i.nipples.splice(i.nipples.indexOf(Q),1),i.actives.indexOf(Q)>=0&&i.actives.splice(i.actives.indexOf(Q),1),i.idles.indexOf(Q)>=0&&i.idles.splice(i.idles.indexOf(Q),1),i.ids.indexOf(Q.identifier)>=0&&i.ids.splice(i.ids.indexOf(Q.identifier),1),i.manager.removeIdentifier(Q.identifier),i.manager.unbindDocument()},T.prototype.destroy=function(){var k=this;for(var Q in k.unbindEvt(k.options.zone,"start"),k.nipples.forEach((function(k){k.destroy()})),k.pressureIntervals)k.pressureIntervals.hasOwnProperty(Q)&&clearInterval(k.pressureIntervals[Q]);k.trigger("destroyed",k.nipples),k.manager.unbindDocument(),k.off()};const K=T;function v(k){var Q=this;Q.ids={},Q.index=0,Q.collections=[],Q.scroll=J(),Q.config(k),Q.prepareCollections();var i=function(){var k;Q.collections.forEach((function(i){i.forEach((function(i){k=i.el.getBoundingClientRect(),i.position={x:Q.scroll.x+k.left,y:Q.scroll.y+k.top}}))}))};o(window,"resize",(function(){B(i)}));var Z=function(){Q.scroll=J()};return o(window,"scroll",(function(){B(Z)})),Q.collections}v.prototype=new u,v.constructor=v,v.prototype.prepareCollections=function(){var k=this;k.collections.create=k.create.bind(k),k.collections.on=k.on.bind(k),k.collections.off=k.off.bind(k),k.collections.destroy=k.destroy.bind(k),k.collections.get=function(Q){var i;return k.collections.every((function(k){return!(i=k.get(Q))})),i}},v.prototype.create=function(k){return this.createCollection(k)},v.prototype.createCollection=function(k){var Q=this,i=new K(Q,k);return Q.bindCollection(i),Q.collections.push(i),i},v.prototype.bindCollection=function(k){var Q,i=this,Z=function(k,Z){Q=k.type+" "+Z.id+":"+k.type,i.trigger(Q,Z)};k.on("destroyed",i.onDestroyed.bind(i)),k.on("shown hidden rested dir plain",Z),k.on("dir:up dir:right dir:down dir:left",Z),k.on("plain:up plain:right plain:down plain:left",Z)},v.prototype.bindDocument=function(){var k=this;k.binded||(k.bindEvt(document,"move").bindEvt(document,"end"),k.binded=!0)},v.prototype.unbindDocument=function(k){var Q=this;Object.keys(Q.ids).length&&!0!==k||(Q.unbindEvt(document,"move").unbindEvt(document,"end"),Q.binded=!1)},v.prototype.getIdentifier=function(k){var Q;return k?void 0===(Q=void 0===k.identifier?k.pointerId:k.identifier)&&(Q=this.latest||0):Q=this.index,void 0===this.ids[Q]&&(this.ids[Q]=this.index,this.index+=1),this.latest=Q,this.ids[Q]},v.prototype.removeIdentifier=function(k){var Q={};for(var i in this.ids)if(this.ids[i]===k){Q.id=i,Q.identifier=this.ids[i],delete this.ids[i];break}return Q},v.prototype.onmove=function(k){return this.onAny("move",k),!1},v.prototype.onend=function(k){return this.onAny("end",k),!1},v.prototype.oncancel=function(k){return this.onAny("end",k),!1},v.prototype.onAny=function(k,Q){var i,Z=this,U="processOn"+k.charAt(0).toUpperCase()+k.slice(1);Q=O(Q);var C=function(k,Q,i){i.ids.indexOf(Q)>=0&&(i[U](k),k._found_=!0)};return z(Q,(function(k){i=Z.getIdentifier(k),z(Z.collections,C.bind(null,k,i)),k._found_||Z.removeIdentifier(i)})),!1},v.prototype.destroy=function(){var k=this;k.unbindDocument(!0),k.ids={},k.index=0,k.collections.forEach((function(k){k.destroy()})),k.off()},v.prototype.onDestroyed=function(k,Q){var i=this;if(i.collections.indexOf(Q)<0)return!1;i.collections.splice(i.collections.indexOf(Q),1)};var N=new v;const X={create:function(k){return N.create(k)},factory:N};return Q.default})(),k.exports=Q()},12429:(k,Q,i)=>{"use strict";const{Deflate:Z,deflate:U,deflateRaw:C,gzip:B}=i(12432),{Inflate:o,inflate:m,inflateRaw:O,ungzip:J}=i(12494),G=i(12469);k.exports.Deflate=Z,k.exports.deflate=U,k.exports.deflateRaw=C,k.exports.gzip=B,k.exports.Inflate=o,k.exports.inflate=m,k.exports.inflateRaw=O,k.exports.ungzip=J,k.exports.constants=G},12432:(k,Q,i)=>{"use strict";const Z=i(12435),U=i(12472),C=i(12478),B=i(12461),o=i(12487),m=Object.prototype.toString,{Z_NO_FLUSH:O,Z_SYNC_FLUSH:J,Z_FULL_FLUSH:G,Z_FINISH:H,Z_OK:e,Z_STREAM_END:F,Z_DEFAULT_COMPRESSION:z,Z_DEFAULT_STRATEGY:E,Z_DEFLATED:l}=i(12469);function h(k){this.options=U.assign({level:z,method:l,Wk:16384,windowBits:15,memLevel:8,strategy:E},k||{});let Q=this.options;Q.raw&&Q.windowBits>0?Q.windowBits=-Q.windowBits:Q.gzip&&Q.windowBits>0&&Q.windowBits<16&&(Q.windowBits+=16),this.err=0,this.JQ="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;let i=Z.deflateInit2(this.strm,Q.level,Q.method,Q.windowBits,Q.memLevel,Q.strategy);if(i!==e)throw new Error(B[i]);if(Q.header&&Z.deflateSetHeader(this.strm,Q.header),Q.dictionary){let k;if(k="string"===typeof Q.dictionary?C.string2buf(Q.dictionary):"[object ArrayBuffer]"===m.call(Q.dictionary)?new Uint8Array(Q.dictionary):Q.dictionary,i=Z.deflateSetDictionary(this.strm,k),i!==e)throw new Error(B[i]);this._dict_set=!0}}function c(k,Q){const i=new h(Q);if(i.push(k,!0),i.err)throw i.JQ||B[i.err];return i.result}h.prototype.push=function(k,Q){const i=this.strm,U=this.options.Wk;let B,o;if(this.ended)return!1;for(o=Q===~~Q?Q:!0===Q?H:O,"string"===typeof k?i.input=C.string2buf(k):"[object ArrayBuffer]"===m.call(k)?i.input=new Uint8Array(k):i.input=k,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(U),i.next_out=0,i.avail_out=U),(o===J||o===G)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(B=Z.deflate(i,o),B===F)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),B=Z.deflateEnd(this.strm),this.onEnd(B),this.ended=!0,B===e;if(0!==i.avail_out){if(o>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},h.prototype.onData=function(k){this.chunks.push(k)},h.prototype.onEnd=function(k){k===e&&(this.result=U.flattenChunks(this.chunks)),this.chunks=[],this.err=k,this.JQ=this.strm.JQ},k.exports.Deflate=h,k.exports.deflate=c,k.exports.deflateRaw=function(k,Q){return(Q=Q||{}).raw=!0,c(k,Q)},k.exports.gzip=function(k,Q){return(Q=Q||{}).gzip=!0,c(k,Q)},k.exports.constants=i(12469)},12494:(k,Q,i)=>{"use strict";const Z=i(12497),U=i(12472),C=i(12478),B=i(12461),o=i(12487),m=i(12515),O=Object.prototype.toString,{Z_NO_FLUSH:J,Z_FINISH:G,Z_OK:H,Z_STREAM_END:e,Z_NEED_DICT:F,Z_STREAM_ERROR:z,Z_DATA_ERROR:E,Z_MEM_ERROR:l}=i(12469);function h(k){this.options=U.assign({Wk:65536,windowBits:15,to:""},k||{});const Q=this.options;Q.raw&&Q.windowBits>=0&&Q.windowBits<16&&(Q.windowBits=-Q.windowBits,0===Q.windowBits&&(Q.windowBits=-15)),!(Q.windowBits>=0&&Q.windowBits<16)||k&&k.windowBits||(Q.windowBits+=32),Q.windowBits>15&&Q.windowBits<48&&0===(15&Q.windowBits)&&(Q.windowBits|=15),this.err=0,this.JQ="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;let i=Z.inflateInit2(this.strm,Q.windowBits);if(i!==H)throw new Error(B[i]);if(this.header=new m,Z.inflateGetHeader(this.strm,this.header),Q.dictionary&&("string"===typeof Q.dictionary?Q.dictionary=C.string2buf(Q.dictionary):"[object ArrayBuffer]"===O.call(Q.dictionary)&&(Q.dictionary=new Uint8Array(Q.dictionary)),Q.raw&&(i=Z.inflateSetDictionary(this.strm,Q.dictionary),i!==H)))throw new Error(B[i])}function c(k,Q){const i=new h(Q);if(i.push(k),i.err)throw i.JQ||B[i.err];return i.result}h.prototype.push=function(k,Q){const i=this.strm,U=this.options.Wk,B=this.options.dictionary;let o,m,h;if(this.ended)return!1;for(m=Q===~~Q?Q:!0===Q?G:J,"[object ArrayBuffer]"===O.call(k)?i.input=new Uint8Array(k):i.input=k,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(U),i.next_out=0,i.avail_out=U),o=Z.inflate(i,m),o===F&&B&&(o=Z.inflateSetDictionary(i,B),o===H?o=Z.inflate(i,m):o===E&&(o=F));i.avail_in>0&&o===e&&i.state.wrap>0&&0!==k[i.next_in];)Z.inflateReset(i),o=Z.inflate(i,m);switch(o){case z:case E:case F:case l:return this.onEnd(o),this.ended=!0,!1}if(h=i.avail_out,i.next_out&&(0===i.avail_out||o===e))if("string"===this.options.to){let k=C.utf8border(i.output,i.next_out),Q=i.next_out-k,Z=C.buf2string(i.output,k);i.next_out=Q,i.avail_out=U-Q,Q&&i.output.set(i.output.subarray(k,k+Q),0),this.onData(Z)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(o!==H||0!==h){if(o===e)return o=Z.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},h.prototype.onData=function(k){this.chunks.push(k)},h.prototype.onEnd=function(k){k===H&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=U.flattenChunks(this.chunks)),this.chunks=[],this.err=k,this.JQ=this.strm.JQ},k.exports.Inflate=h,k.exports.inflate=c,k.exports.inflateRaw=function(k,Q){return(Q=Q||{}).raw=!0,c(k,Q)},k.exports.ungzip=c,k.exports.constants=i(12469)},12472:k=>{"use strict";const Q=(k,Q)=>Object.prototype.hasOwnProperty.call(k,Q);k.exports.assign=function(k){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const Z=i.shift();if(Z){if("object"!==typeof Z)throw new TypeError(Z+"must be non-object");for(const i in Z)Q(Z,i)&&(k[i]=Z[i])}}return k},k.exports.flattenChunks=k=>{let Q=0;for(let Z=0,U=k.length;Z<U;Z++)Q+=k[Z].length;const i=new Uint8Array(Q);for(let Z=0,U=0,C=k.length;Z<C;Z++){let Q=k[Z];i.set(Q,U),U+=Q.length}return i}},12478:k=>{"use strict";let Q=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Z){Q=!1}const i=new Uint8Array(256);for(let U=0;U<256;U++)i[U]=U>=252?6:U>=248?5:U>=240?4:U>=224?3:U>=192?2:1;i[254]=i[254]=1,k.exports.string2buf=k=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(k);let Q,i,Z,U,C,B=k.length,o=0;for(U=0;U<B;U++)i=k.charCodeAt(U),55296===(64512&i)&&U+1<B&&(Z=k.charCodeAt(U+1),56320===(64512&Z)&&(i=65536+(i-55296<<10)+(Z-56320),U++)),o+=i<128?1:i<2048?2:i<65536?3:4;for(Q=new Uint8Array(o),C=0,U=0;C<o;U++)i=k.charCodeAt(U),55296===(64512&i)&&U+1<B&&(Z=k.charCodeAt(U+1),56320===(64512&Z)&&(i=65536+(i-55296<<10)+(Z-56320),U++)),i<128?Q[C++]=i:i<2048?(Q[C++]=192|i>>>6,Q[C++]=128|63&i):i<65536?(Q[C++]=224|i>>>12,Q[C++]=128|i>>>6&63,Q[C++]=128|63&i):(Q[C++]=240|i>>>18,Q[C++]=128|i>>>12&63,Q[C++]=128|i>>>6&63,Q[C++]=128|63&i);return Q};k.exports.buf2string=(k,Z)=>{const U=Z||k.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(k.subarray(0,Z));let C,B;const o=new Array(2*U);for(B=0,C=0;C<U;){let Q=k[C++];if(Q<128){o[B++]=Q;continue}let Z=i[Q];if(Z>4)o[B++]=65533,C+=Z-1;else{for(Q&=2===Z?31:3===Z?15:7;Z>1&&C<U;)Q=Q<<6|63&k[C++],Z--;Z>1?o[B++]=65533:Q<65536?o[B++]=Q:(Q-=65536,o[B++]=55296|Q>>10&1023,o[B++]=56320|1023&Q)}}return((k,i)=>{if(i<65534&&k.subarray&&Q)return String.fromCharCode.apply(null,k.length===i?k:k.subarray(0,i));let Z="";for(let Q=0;Q<i;Q++)Z+=String.fromCharCode(k[Q]);return Z})(o,B)},k.exports.utf8border=(k,Q)=>{(Q=Q||k.length)>k.length&&(Q=k.length);let Z=Q-1;for(;Z>=0&&128===(192&k[Z]);)Z--;return Z<0||0===Z?Q:Z+i[k[Z]]>Q?Z:Q}},12451:k=>{"use strict";k.exports=(k,Q,i,Z)=>{let U=65535&k,C=k>>>16&65535,B=0;for(;0!==i;){B=i>2e3?2e3:i,i-=B;do{U=U+Q[Z++]|0,C=C+U|0}while(--B);U%=65521,C%=65521}return U|C<<16}},12469:k=>{"use strict";k.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12453:k=>{"use strict";const Q=new Uint32Array((()=>{let k,Q=[];for(var i=0;i<256;i++){k=i;for(var Z=0;Z<8;Z++)k=1&k?3988292384^k>>>1:k>>>1;Q[i]=k}return Q})());k.exports=(k,i,Z,U)=>{const C=Q,B=U+Z;k^=-1;for(let Q=U;Q<B;Q++)k=k>>>8^C[255&(k^i[Q])];return~k}},12435:(k,Q,i)=>{"use strict";const{_tr_init:Z,_tr_stored_block:U,_tr_flush_block:C,_tr_tally:B,_tr_align:o}=i(12443),m=i(12451),O=i(12453),J=i(12461),{Z_NO_FLUSH:G,Z_PARTIAL_FLUSH:H,Z_FULL_FLUSH:e,Z_FINISH:F,Z_BLOCK:z,Z_OK:E,Z_STREAM_END:l,Z_STREAM_ERROR:h,Z_DATA_ERROR:c,Z_BUF_ERROR:f,Z_DEFAULT_COMPRESSION:Y,Z_FILTERED:y,Z_HUFFMAN_ONLY:L,Z_RLE:s,Z_FIXED:u,Z_DEFAULT_STRATEGY:a,Z_UNKNOWN:j,Z_DEFLATED:T}=i(12469),K=258,v=262,N=103,X=113,p=666,d=(k,Q)=>(k.JQ=J[Q],Q),b=k=>(k<<1)-(k>4?9:0),D=k=>{let Q=k.length;for(;--Q>=0;)k[Q]=0};let M=(k,Q,i)=>(Q<<k.hash_shift^i)&k.hash_mask;const W=k=>{const Q=k.state;let i=Q.pending;i>k.avail_out&&(i=k.avail_out),0!==i&&(k.output.set(Q.pending_buf.subarray(Q.pending_out,Q.pending_out+i),k.next_out),k.next_out+=i,Q.pending_out+=i,k.total_out+=i,k.avail_out-=i,Q.pending-=i,0===Q.pending&&(Q.pending_out=0))},A=(k,Q)=>{C(k,k.block_start>=0?k.block_start:-1,k.strstart-k.block_start,Q),k.block_start=k.strstart,W(k.strm)},g=(k,Q)=>{k.pending_buf[k.pending++]=Q},R=(k,Q)=>{k.pending_buf[k.pending++]=Q>>>8&255,k.pending_buf[k.pending++]=255&Q},w=(k,Q,i,Z)=>{let U=k.avail_in;return U>Z&&(U=Z),0===U?0:(k.avail_in-=U,Q.set(k.input.subarray(k.next_in,k.next_in+U),i),1===k.state.wrap?k.adler=m(k.adler,Q,U,i):2===k.state.wrap&&(k.adler=O(k.adler,Q,U,i)),k.next_in+=U,k.total_in+=U,U)},S=(k,Q)=>{let i,Z,U=k.max_chain_length,C=k.strstart,B=k.prev_length,o=k.nice_match;const m=k.strstart>k.w_size-v?k.strstart-(k.w_size-v):0,O=k.window,J=k.w_mask,G=k.prev,H=k.strstart+K;let e=O[C+B-1],F=O[C+B];k.prev_length>=k.good_match&&(U>>=2),o>k.lookahead&&(o=k.lookahead);do{if(i=Q,O[i+B]===F&&O[i+B-1]===e&&O[i]===O[C]&&O[++i]===O[C+1]){C+=2,i++;do{}while(O[++C]===O[++i]&&O[++C]===O[++i]&&O[++C]===O[++i]&&O[++C]===O[++i]&&O[++C]===O[++i]&&O[++C]===O[++i]&&O[++C]===O[++i]&&O[++C]===O[++i]&&C<H);if(Z=K-(H-C),C=H-K,Z>B){if(k.match_start=Q,B=Z,Z>=o)break;e=O[C+B-1],F=O[C+B]}}}while((Q=G[Q&J])>m&&0!==--U);return B<=k.lookahead?B:k.lookahead},q=k=>{const Q=k.w_size;let i,Z,U,C,B;do{if(C=k.window_size-k.lookahead-k.strstart,k.strstart>=Q+(Q-v)){k.window.set(k.window.subarray(Q,Q+Q),0),k.match_start-=Q,k.strstart-=Q,k.block_start-=Q,Z=k.hash_size,i=Z;do{U=k.head[--i],k.head[i]=U>=Q?U-Q:0}while(--Z);Z=Q,i=Z;do{U=k.prev[--i],k.prev[i]=U>=Q?U-Q:0}while(--Z);C+=Q}if(0===k.strm.avail_in)break;if(Z=w(k.strm,k.window,k.strstart+k.lookahead,C),k.lookahead+=Z,k.lookahead+k.insert>=3)for(B=k.strstart-k.insert,k.ins_h=k.window[B],k.ins_h=M(k,k.ins_h,k.window[B+1]);k.insert&&(k.ins_h=M(k,k.ins_h,k.window[B+3-1]),k.prev[B&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=B,B++,k.insert--,!(k.lookahead+k.insert<3)););}while(k.lookahead<v&&0!==k.strm.avail_in)},P=(k,Q)=>{let i,Z;for(;;){if(k.lookahead<v){if(q(k),k.lookahead<v&&Q===G)return 1;if(0===k.lookahead)break}if(i=0,k.lookahead>=3&&(k.ins_h=M(k,k.ins_h,k.window[k.strstart+3-1]),i=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),0!==i&&k.strstart-i<=k.w_size-v&&(k.match_length=S(k,i)),k.match_length>=3)if(Z=B(k,k.strstart-k.match_start,k.match_length-3),k.lookahead-=k.match_length,k.match_length<=k.max_lazy_match&&k.lookahead>=3){k.match_length--;do{k.strstart++,k.ins_h=M(k,k.ins_h,k.window[k.strstart+3-1]),i=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart}while(0!==--k.match_length);k.strstart++}else k.strstart+=k.match_length,k.match_length=0,k.ins_h=k.window[k.strstart],k.ins_h=M(k,k.ins_h,k.window[k.strstart+1]);else Z=B(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++;if(Z&&(A(k,!1),0===k.strm.avail_out))return 1}return k.insert=k.strstart<2?k.strstart:2,Q===F?(A(k,!0),0===k.strm.avail_out?3:4):k.last_lit&&(A(k,!1),0===k.strm.avail_out)?1:2},t=(k,Q)=>{let i,Z,U;for(;;){if(k.lookahead<v){if(q(k),k.lookahead<v&&Q===G)return 1;if(0===k.lookahead)break}if(i=0,k.lookahead>=3&&(k.ins_h=M(k,k.ins_h,k.window[k.strstart+3-1]),i=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),k.prev_length=k.match_length,k.prev_match=k.match_start,k.match_length=2,0!==i&&k.prev_length<k.max_lazy_match&&k.strstart-i<=k.w_size-v&&(k.match_length=S(k,i),k.match_length<=5&&(k.strategy===y||3===k.match_length&&k.strstart-k.match_start>4096)&&(k.match_length=2)),k.prev_length>=3&&k.match_length<=k.prev_length){U=k.strstart+k.lookahead-3,Z=B(k,k.strstart-1-k.prev_match,k.prev_length-3),k.lookahead-=k.prev_length-1,k.prev_length-=2;do{++k.strstart<=U&&(k.ins_h=M(k,k.ins_h,k.window[k.strstart+3-1]),i=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart)}while(0!==--k.prev_length);if(k.match_available=0,k.match_length=2,k.strstart++,Z&&(A(k,!1),0===k.strm.avail_out))return 1}else if(k.match_available){if(Z=B(k,0,k.window[k.strstart-1]),Z&&A(k,!1),k.strstart++,k.lookahead--,0===k.strm.avail_out)return 1}else k.match_available=1,k.strstart++,k.lookahead--}return k.match_available&&(Z=B(k,0,k.window[k.strstart-1]),k.match_available=0),k.insert=k.strstart<2?k.strstart:2,Q===F?(A(k,!0),0===k.strm.avail_out?3:4):k.last_lit&&(A(k,!1),0===k.strm.avail_out)?1:2};function I(k,Q,i,Z,U){this.good_length=k,this.max_lazy=Q,this.nice_length=i,this.max_chain=Z,this.func=U}const r=[new I(0,0,0,0,((k,Q)=>{let i=65535;for(i>k.pending_buf_size-5&&(i=k.pending_buf_size-5);;){if(k.lookahead<=1){if(q(k),0===k.lookahead&&Q===G)return 1;if(0===k.lookahead)break}k.strstart+=k.lookahead,k.lookahead=0;const Z=k.block_start+i;if((0===k.strstart||k.strstart>=Z)&&(k.lookahead=k.strstart-Z,k.strstart=Z,A(k,!1),0===k.strm.avail_out))return 1;if(k.strstart-k.block_start>=k.w_size-v&&(A(k,!1),0===k.strm.avail_out))return 1}return k.insert=0,Q===F?(A(k,!0),0===k.strm.avail_out?3:4):(k.strstart>k.block_start&&(A(k,!1),k.strm.avail_out),1)})),new I(4,4,8,4,P),new I(4,5,16,8,P),new I(4,6,32,32,P),new I(4,4,16,16,t),new I(8,16,32,32,t),new I(8,16,128,128,t),new I(8,32,128,256,t),new I(32,128,258,1024,t),new I(32,258,258,4096,t)];function n(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),D(this.dyn_ltree),D(this.dyn_dtree),D(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),D(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),D(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const x=k=>{if(!k||!k.state)return d(k,h);k.total_in=k.total_out=0,k.data_type=j;const Q=k.state;return Q.pending=0,Q.pending_out=0,Q.wrap<0&&(Q.wrap=-Q.wrap),Q.status=Q.wrap?42:X,k.adler=2===Q.wrap?0:1,Q.last_flush=G,Z(Q),E},V=k=>{const Q=x(k);var i;return Q===E&&((i=k.state).window_size=2*i.w_size,D(i.head),i.max_lazy_match=r[i.level].max_lazy,i.good_match=r[i.level].good_length,i.nice_match=r[i.level].nice_length,i.max_chain_length=r[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),Q},kk=(k,Q,i,Z,U,C)=>{if(!k)return h;let B=1;if(Q===Y&&(Q=6),Z<0?(B=0,Z=-Z):Z>15&&(B=2,Z-=16),U<1||U>9||i!==T||Z<8||Z>15||Q<0||Q>9||C<0||C>u)return d(k,h);8===Z&&(Z=9);const o=new n;return k.state=o,o.strm=k,o.wrap=B,o.gzhead=null,o.w_bits=Z,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=U+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<U+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=Q,o.strategy=C,o.method=i,V(k)};k.exports.deflateInit=(k,Q)=>kk(k,Q,T,15,8,a),k.exports.deflateInit2=kk,k.exports.deflateReset=V,k.exports.deflateResetKeep=x,k.exports.deflateSetHeader=(k,Q)=>k&&k.state?2!==k.state.wrap?h:(k.state.gzhead=Q,E):h,k.exports.deflate=(k,Q)=>{let i,Z;if(!k||!k.state||Q>z||Q<0)return k?d(k,h):h;const C=k.state;if(!k.output||!k.input&&0!==k.avail_in||C.status===p&&Q!==F)return d(k,0===k.avail_out?f:h);C.strm=k;const m=C.last_flush;if(C.last_flush=Q,42===C.status)if(2===C.wrap)k.adler=0,g(C,31),g(C,139),g(C,8),C.gzhead?(g(C,(C.gzhead.text?1:0)+(C.gzhead.hcrc?2:0)+(C.gzhead.extra?4:0)+(C.gzhead.name?8:0)+(C.gzhead.comment?16:0)),g(C,255&C.gzhead.time),g(C,C.gzhead.time>>8&255),g(C,C.gzhead.time>>16&255),g(C,C.gzhead.time>>24&255),g(C,9===C.level?2:C.strategy>=L||C.level<2?4:0),g(C,255&C.gzhead.os),C.gzhead.extra&&C.gzhead.extra.length&&(g(C,255&C.gzhead.extra.length),g(C,C.gzhead.extra.length>>8&255)),C.gzhead.hcrc&&(k.adler=O(k.adler,C.pending_buf,C.pending,0)),C.gzindex=0,C.status=69):(g(C,0),g(C,0),g(C,0),g(C,0),g(C,0),g(C,9===C.level?2:C.strategy>=L||C.level<2?4:0),g(C,3),C.status=X);else{let Q=T+(C.w_bits-8<<4)<<8,i=-1;i=C.strategy>=L||C.level<2?0:C.level<6?1:6===C.level?2:3,Q|=i<<6,0!==C.strstart&&(Q|=32),Q+=31-Q%31,C.status=X,R(C,Q),0!==C.strstart&&(R(C,k.adler>>>16),R(C,65535&k.adler)),k.adler=1}if(69===C.status)if(C.gzhead.extra){for(i=C.pending;C.gzindex<(65535&C.gzhead.extra.length)&&(C.pending!==C.pending_buf_size||(C.gzhead.hcrc&&C.pending>i&&(k.adler=O(k.adler,C.pending_buf,C.pending-i,i)),W(k),i=C.pending,C.pending!==C.pending_buf_size));)g(C,255&C.gzhead.extra[C.gzindex]),C.gzindex++;C.gzhead.hcrc&&C.pending>i&&(k.adler=O(k.adler,C.pending_buf,C.pending-i,i)),C.gzindex===C.gzhead.extra.length&&(C.gzindex=0,C.status=73)}else C.status=73;if(73===C.status)if(C.gzhead.name){i=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>i&&(k.adler=O(k.adler,C.pending_buf,C.pending-i,i)),W(k),i=C.pending,C.pending===C.pending_buf_size)){Z=1;break}Z=C.gzindex<C.gzhead.name.length?255&C.gzhead.name.charCodeAt(C.gzindex++):0,g(C,Z)}while(0!==Z);C.gzhead.hcrc&&C.pending>i&&(k.adler=O(k.adler,C.pending_buf,C.pending-i,i)),0===Z&&(C.gzindex=0,C.status=91)}else C.status=91;if(91===C.status)if(C.gzhead.comment){i=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>i&&(k.adler=O(k.adler,C.pending_buf,C.pending-i,i)),W(k),i=C.pending,C.pending===C.pending_buf_size)){Z=1;break}Z=C.gzindex<C.gzhead.comment.length?255&C.gzhead.comment.charCodeAt(C.gzindex++):0,g(C,Z)}while(0!==Z);C.gzhead.hcrc&&C.pending>i&&(k.adler=O(k.adler,C.pending_buf,C.pending-i,i)),0===Z&&(C.status=N)}else C.status=N;if(C.status===N&&(C.gzhead.hcrc?(C.pending+2>C.pending_buf_size&&W(k),C.pending+2<=C.pending_buf_size&&(g(C,255&k.adler),g(C,k.adler>>8&255),k.adler=0,C.status=X)):C.status=X),0!==C.pending){if(W(k),0===k.avail_out)return C.last_flush=-1,E}else if(0===k.avail_in&&b(Q)<=b(m)&&Q!==F)return d(k,f);if(C.status===p&&0!==k.avail_in)return d(k,f);if(0!==k.avail_in||0!==C.lookahead||Q!==G&&C.status!==p){let i=C.strategy===L?((k,Q)=>{let i;for(;;){if(0===k.lookahead&&(q(k),0===k.lookahead)){if(Q===G)return 1;break}if(k.match_length=0,i=B(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++,i&&(A(k,!1),0===k.strm.avail_out))return 1}return k.insert=0,Q===F?(A(k,!0),0===k.strm.avail_out?3:4):k.last_lit&&(A(k,!1),0===k.strm.avail_out)?1:2})(C,Q):C.strategy===s?((k,Q)=>{let i,Z,U,C;const o=k.window;for(;;){if(k.lookahead<=K){if(q(k),k.lookahead<=K&&Q===G)return 1;if(0===k.lookahead)break}if(k.match_length=0,k.lookahead>=3&&k.strstart>0&&(U=k.strstart-1,Z=o[U],Z===o[++U]&&Z===o[++U]&&Z===o[++U])){C=k.strstart+K;do{}while(Z===o[++U]&&Z===o[++U]&&Z===o[++U]&&Z===o[++U]&&Z===o[++U]&&Z===o[++U]&&Z===o[++U]&&Z===o[++U]&&U<C);k.match_length=K-(C-U),k.match_length>k.lookahead&&(k.match_length=k.lookahead)}if(k.match_length>=3?(i=B(k,1,k.match_length-3),k.lookahead-=k.match_length,k.strstart+=k.match_length,k.match_length=0):(i=B(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++),i&&(A(k,!1),0===k.strm.avail_out))return 1}return k.insert=0,Q===F?(A(k,!0),0===k.strm.avail_out?3:4):k.last_lit&&(A(k,!1),0===k.strm.avail_out)?1:2})(C,Q):r[C.level].func(C,Q);if(3!==i&&4!==i||(C.status=p),1===i||3===i)return 0===k.avail_out&&(C.last_flush=-1),E;if(2===i&&(Q===H?o(C):Q!==z&&(U(C,0,0,!1),Q===e&&(D(C.head),0===C.lookahead&&(C.strstart=0,C.block_start=0,C.insert=0))),W(k),0===k.avail_out))return C.last_flush=-1,E}return Q!==F?E:C.wrap<=0?l:(2===C.wrap?(g(C,255&k.adler),g(C,k.adler>>8&255),g(C,k.adler>>16&255),g(C,k.adler>>24&255),g(C,255&k.total_in),g(C,k.total_in>>8&255),g(C,k.total_in>>16&255),g(C,k.total_in>>24&255)):(R(C,k.adler>>>16),R(C,65535&k.adler)),W(k),C.wrap>0&&(C.wrap=-C.wrap),0!==C.pending?E:l)},k.exports.deflateEnd=k=>{if(!k||!k.state)return h;const Q=k.state.status;return 42!==Q&&69!==Q&&73!==Q&&91!==Q&&Q!==N&&Q!==X&&Q!==p?d(k,h):(k.state=null,Q===X?d(k,c):E)},k.exports.deflateSetDictionary=(k,Q)=>{let i=Q.length;if(!k||!k.state)return h;const Z=k.state,U=Z.wrap;if(2===U||1===U&&42!==Z.status||Z.lookahead)return h;if(1===U&&(k.adler=m(k.adler,Q,i,0)),Z.wrap=0,i>=Z.w_size){0===U&&(D(Z.head),Z.strstart=0,Z.block_start=0,Z.insert=0);let k=new Uint8Array(Z.w_size);k.set(Q.subarray(i-Z.w_size,i),0),Q=k,i=Z.w_size}const C=k.avail_in,B=k.next_in,o=k.input;for(k.avail_in=i,k.next_in=0,k.input=Q,q(Z);Z.lookahead>=3;){let k=Z.strstart,Q=Z.lookahead-2;do{Z.ins_h=M(Z,Z.ins_h,Z.window[k+3-1]),Z.prev[k&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=k,k++}while(--Q);Z.strstart=k,Z.lookahead=2,q(Z)}return Z.strstart+=Z.lookahead,Z.block_start=Z.strstart,Z.insert=Z.lookahead,Z.lookahead=0,Z.match_length=Z.prev_length=2,Z.match_available=0,k.next_in=B,k.input=o,k.avail_in=C,Z.wrap=U,E},k.exports.deflateInfo="pako deflate (from Nodeca project)"},12515:k=>{"use strict";k.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12499:k=>{"use strict";k.exports=function(k,Q){let i,Z,U,C,B,o,m,O,J,G,H,e,F,z,E,l,h,c,f,Y,y,L,s,u;const a=k.state;i=k.next_in,s=k.input,Z=i+(k.avail_in-5),U=k.next_out,u=k.output,C=U-(Q-k.avail_out),B=U+(k.avail_out-257),o=a.dmax,m=a.wsize,O=a.whave,J=a.wnext,G=a.window,H=a.hold,e=a.bits,F=a.lencode,z=a.distcode,E=(1<<a.lenbits)-1,l=(1<<a.distbits)-1;k:do{e<15&&(H+=s[i++]<<e,e+=8,H+=s[i++]<<e,e+=8),h=F[H&E];Q:for(;;){if(c=h>>>24,H>>>=c,e-=c,c=h>>>16&255,0===c)u[U++]=65535&h;else{if(!(16&c)){if(0===(64&c)){h=F[(65535&h)+(H&(1<<c)-1)];continue Q}if(32&c){a.mode=12;break k}k.JQ="invalid literal/length code",a.mode=30;break k}f=65535&h,c&=15,c&&(e<c&&(H+=s[i++]<<e,e+=8),f+=H&(1<<c)-1,H>>>=c,e-=c),e<15&&(H+=s[i++]<<e,e+=8,H+=s[i++]<<e,e+=8),h=z[H&l];i:for(;;){if(c=h>>>24,H>>>=c,e-=c,c=h>>>16&255,!(16&c)){if(0===(64&c)){h=z[(65535&h)+(H&(1<<c)-1)];continue i}k.JQ="invalid distance code",a.mode=30;break k}if(Y=65535&h,c&=15,e<c&&(H+=s[i++]<<e,e+=8,e<c&&(H+=s[i++]<<e,e+=8)),Y+=H&(1<<c)-1,Y>o){k.JQ="invalid distance too far back",a.mode=30;break k}if(H>>>=c,e-=c,c=U-C,Y>c){if(c=Y-c,c>O&&a.sane){k.JQ="invalid distance too far back",a.mode=30;break k}if(y=0,L=G,0===J){if(y+=m-c,c<f){f-=c;do{u[U++]=G[y++]}while(--c);y=U-Y,L=u}}else if(J<c){if(y+=m+J-c,c-=J,c<f){f-=c;do{u[U++]=G[y++]}while(--c);if(y=0,J<f){c=J,f-=c;do{u[U++]=G[y++]}while(--c);y=U-Y,L=u}}}else if(y+=J-c,c<f){f-=c;do{u[U++]=G[y++]}while(--c);y=U-Y,L=u}for(;f>2;)u[U++]=L[y++],u[U++]=L[y++],u[U++]=L[y++],f-=3;f&&(u[U++]=L[y++],f>1&&(u[U++]=L[y++]))}else{y=U-Y;do{u[U++]=u[y++],u[U++]=u[y++],u[U++]=u[y++],f-=3}while(f>2);f&&(u[U++]=u[y++],f>1&&(u[U++]=u[y++]))}break}}break}}while(i<Z&&U<B);f=e>>3,i-=f,e-=f<<3,H&=(1<<e)-1,k.next_in=i,k.next_out=U,k.avail_in=i<Z?Z-i+5:5-(i-Z),k.avail_out=U<B?B-U+257:257-(U-B),a.hold=H,a.bits=e}},12497:(k,Q,i)=>{"use strict";const Z=i(12451),U=i(12453),C=i(12499),B=i(12507),{Z_FINISH:o,Z_BLOCK:m,Z_TREES:O,Z_OK:J,Z_STREAM_END:G,Z_NEED_DICT:H,Z_STREAM_ERROR:e,Z_DATA_ERROR:F,Z_MEM_ERROR:z,Z_BUF_ERROR:E,Z_DEFLATED:l}=i(12469),h=12,c=30,f=k=>(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24);function Y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const y=k=>{if(!k||!k.state)return e;const Q=k.state;return k.total_in=k.total_out=Q.total=0,k.JQ="",Q.wrap&&(k.adler=1&Q.wrap),Q.mode=1,Q.last=0,Q.havedict=0,Q.dmax=32768,Q.head=null,Q.hold=0,Q.bits=0,Q.lencode=Q.lendyn=new Int32Array(852),Q.distcode=Q.distdyn=new Int32Array(592),Q.sane=1,Q.back=-1,J},L=k=>{if(!k||!k.state)return e;const Q=k.state;return Q.wsize=0,Q.whave=0,Q.wnext=0,y(k)},s=(k,Q)=>{let i;if(!k||!k.state)return e;const Z=k.state;return Q<0?(i=0,Q=-Q):(i=1+(Q>>4),Q<48&&(Q&=15)),Q&&(Q<8||Q>15)?e:(null!==Z.window&&Z.wbits!==Q&&(Z.window=null),Z.wrap=i,Z.wbits=Q,L(k))},u=(k,Q)=>{if(!k)return e;const i=new Y;k.state=i,i.window=null;const Z=s(k,Q);return Z!==J&&(k.state=null),Z};let a,j,T=!0;const K=k=>{if(T){a=new Int32Array(512),j=new Int32Array(32);let Q=0;for(;Q<144;)k.lens[Q++]=8;for(;Q<256;)k.lens[Q++]=9;for(;Q<280;)k.lens[Q++]=7;for(;Q<288;)k.lens[Q++]=8;for(B(1,k.lens,0,288,a,0,k.work,{bits:9}),Q=0;Q<32;)k.lens[Q++]=5;B(2,k.lens,0,32,j,0,k.work,{bits:5}),T=!1}k.lencode=a,k.lenbits=9,k.distcode=j,k.distbits=5},v=(k,Q,i,Z)=>{let U;const C=k.state;return null===C.window&&(C.wsize=1<<C.wbits,C.wnext=0,C.whave=0,C.window=new Uint8Array(C.wsize)),Z>=C.wsize?(C.window.set(Q.subarray(i-C.wsize,i),0),C.wnext=0,C.whave=C.wsize):(U=C.wsize-C.wnext,U>Z&&(U=Z),C.window.set(Q.subarray(i-Z,i-Z+U),C.wnext),(Z-=U)?(C.window.set(Q.subarray(i-Z,i),0),C.wnext=Z,C.whave=C.wsize):(C.wnext+=U,C.wnext===C.wsize&&(C.wnext=0),C.whave<C.wsize&&(C.whave+=U))),0};k.exports.inflateReset=L,k.exports.inflateReset2=s,k.exports.inflateResetKeep=y,k.exports.inflateInit=k=>u(k,15),k.exports.inflateInit2=u,k.exports.inflate=(k,Q)=>{let i,Y,y,L,s,u,a,j,T,N,X,p,d,b,D,M,W,A,g,R,w,S,q=0;const P=new Uint8Array(4);let t,I;const r=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!k||!k.state||!k.output||!k.input&&0!==k.avail_in)return e;i=k.state,i.mode===h&&(i.mode=13),s=k.next_out,y=k.output,a=k.avail_out,L=k.next_in,Y=k.input,u=k.avail_in,j=i.hold,T=i.bits,N=u,X=a,S=J;k:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;T<16;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}if(2&i.wrap&&35615===j){i.check=0,P[0]=255&j,P[1]=j>>>8&255,i.check=U(i.check,P,2,0),j=0,T=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&j)<<8)+(j>>8))%31){k.JQ="incorrect header check",i.mode=c;break}if((15&j)!==l){k.JQ="unknown compression method",i.mode=c;break}if(j>>>=4,T-=4,w=8+(15&j),0===i.wbits)i.wbits=w;else if(w>i.wbits){k.JQ="invalid window size",i.mode=c;break}i.dmax=1<<i.wbits,k.adler=i.check=1,i.mode=512&j?10:h,j=0,T=0;break;case 2:for(;T<16;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}if(i.flags=j,(255&i.flags)!==l){k.JQ="unknown compression method",i.mode=c;break}if(57344&i.flags){k.JQ="unknown header flags set",i.mode=c;break}i.head&&(i.head.text=j>>8&1),512&i.flags&&(P[0]=255&j,P[1]=j>>>8&255,i.check=U(i.check,P,2,0)),j=0,T=0,i.mode=3;case 3:for(;T<32;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}i.head&&(i.head.time=j),512&i.flags&&(P[0]=255&j,P[1]=j>>>8&255,P[2]=j>>>16&255,P[3]=j>>>24&255,i.check=U(i.check,P,4,0)),j=0,T=0,i.mode=4;case 4:for(;T<16;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}i.head&&(i.head.xflags=255&j,i.head.os=j>>8),512&i.flags&&(P[0]=255&j,P[1]=j>>>8&255,i.check=U(i.check,P,2,0)),j=0,T=0,i.mode=5;case 5:if(1024&i.flags){for(;T<16;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}i.length=j,i.head&&(i.head.extra_len=j),512&i.flags&&(P[0]=255&j,P[1]=j>>>8&255,i.check=U(i.check,P,2,0)),j=0,T=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(p=i.length,p>u&&(p=u),p&&(i.head&&(w=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(Y.subarray(L,L+p),w)),512&i.flags&&(i.check=U(i.check,Y,p,L)),u-=p,L+=p,i.length-=p),i.length))break k;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===u)break k;p=0;do{w=Y[L+p++],i.head&&w&&i.length<65536&&(i.head.name+=String.fromCharCode(w))}while(w&&p<u);if(512&i.flags&&(i.check=U(i.check,Y,p,L)),u-=p,L+=p,w)break k}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===u)break k;p=0;do{w=Y[L+p++],i.head&&w&&i.length<65536&&(i.head.comment+=String.fromCharCode(w))}while(w&&p<u);if(512&i.flags&&(i.check=U(i.check,Y,p,L)),u-=p,L+=p,w)break k}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;T<16;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}if(j!==(65535&i.check)){k.JQ="header crc mismatch",i.mode=c;break}j=0,T=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),k.adler=i.check=0,i.mode=h;break;case 10:for(;T<32;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}k.adler=i.check=f(j),j=0,T=0,i.mode=11;case 11:if(0===i.havedict)return k.next_out=s,k.avail_out=a,k.next_in=L,k.avail_in=u,i.hold=j,i.bits=T,H;k.adler=i.check=1,i.mode=h;case h:if(Q===m||Q===O)break k;case 13:if(i.last){j>>>=7&T,T-=7&T,i.mode=27;break}for(;T<3;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}switch(i.last=1&j,j>>>=1,T-=1,3&j){case 0:i.mode=14;break;case 1:if(K(i),i.mode=20,Q===O){j>>>=2,T-=2;break k}break;case 2:i.mode=17;break;case 3:k.JQ="invalid block type",i.mode=c}j>>>=2,T-=2;break;case 14:for(j>>>=7&T,T-=7&T;T<32;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}if((65535&j)!==(j>>>16^65535)){k.JQ="invalid stored block lengths",i.mode=c;break}if(i.length=65535&j,j=0,T=0,i.mode=15,Q===O)break k;case 15:i.mode=16;case 16:if(p=i.length,p){if(p>u&&(p=u),p>a&&(p=a),0===p)break k;y.set(Y.subarray(L,L+p),s),u-=p,L+=p,a-=p,s+=p,i.length-=p;break}i.mode=h;break;case 17:for(;T<14;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}if(i.nlen=257+(31&j),j>>>=5,T-=5,i.ndist=1+(31&j),j>>>=5,T-=5,i.ncode=4+(15&j),j>>>=4,T-=4,i.nlen>286||i.ndist>30){k.JQ="too many length or distance symbols",i.mode=c;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;T<3;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}i.lens[r[i.have++]]=7&j,j>>>=3,T-=3}for(;i.have<19;)i.lens[r[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,t={bits:i.lenbits},S=B(0,i.lens,0,19,i.lencode,0,i.work,t),i.lenbits=t.bits,S){k.JQ="invalid code lengths set",i.mode=c;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;q=i.lencode[j&(1<<i.lenbits)-1],D=q>>>24,M=q>>>16&255,W=65535&q,!(D<=T);){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}if(W<16)j>>>=D,T-=D,i.lens[i.have++]=W;else{if(16===W){for(I=D+2;T<I;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}if(j>>>=D,T-=D,0===i.have){k.JQ="invalid bit length repeat",i.mode=c;break}w=i.lens[i.have-1],p=3+(3&j),j>>>=2,T-=2}else if(17===W){for(I=D+3;T<I;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}j>>>=D,T-=D,w=0,p=3+(7&j),j>>>=3,T-=3}else{for(I=D+7;T<I;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}j>>>=D,T-=D,w=0,p=11+(127&j),j>>>=7,T-=7}if(i.have+p>i.nlen+i.ndist){k.JQ="invalid bit length repeat",i.mode=c;break}for(;p--;)i.lens[i.have++]=w}}if(i.mode===c)break;if(0===i.lens[256]){k.JQ="invalid code -- missing end-of-block",i.mode=c;break}if(i.lenbits=9,t={bits:i.lenbits},S=B(1,i.lens,0,i.nlen,i.lencode,0,i.work,t),i.lenbits=t.bits,S){k.JQ="invalid literal/lengths set",i.mode=c;break}if(i.distbits=6,i.distcode=i.distdyn,t={bits:i.distbits},S=B(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,t),i.distbits=t.bits,S){k.JQ="invalid distances set",i.mode=c;break}if(i.mode=20,Q===O)break k;case 20:i.mode=21;case 21:if(u>=6&&a>=258){k.next_out=s,k.avail_out=a,k.next_in=L,k.avail_in=u,i.hold=j,i.bits=T,C(k,X),s=k.next_out,y=k.output,a=k.avail_out,L=k.next_in,Y=k.input,u=k.avail_in,j=i.hold,T=i.bits,i.mode===h&&(i.back=-1);break}for(i.back=0;q=i.lencode[j&(1<<i.lenbits)-1],D=q>>>24,M=q>>>16&255,W=65535&q,!(D<=T);){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}if(M&&0===(240&M)){for(A=D,g=M,R=W;q=i.lencode[R+((j&(1<<A+g)-1)>>A)],D=q>>>24,M=q>>>16&255,W=65535&q,!(A+D<=T);){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}j>>>=A,T-=A,i.back+=A}if(j>>>=D,T-=D,i.back+=D,i.length=W,0===M){i.mode=26;break}if(32&M){i.back=-1,i.mode=h;break}if(64&M){k.JQ="invalid literal/length code",i.mode=c;break}i.extra=15&M,i.mode=22;case 22:if(i.extra){for(I=i.extra;T<I;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}i.length+=j&(1<<i.extra)-1,j>>>=i.extra,T-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;q=i.distcode[j&(1<<i.distbits)-1],D=q>>>24,M=q>>>16&255,W=65535&q,!(D<=T);){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}if(0===(240&M)){for(A=D,g=M,R=W;q=i.distcode[R+((j&(1<<A+g)-1)>>A)],D=q>>>24,M=q>>>16&255,W=65535&q,!(A+D<=T);){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}j>>>=A,T-=A,i.back+=A}if(j>>>=D,T-=D,i.back+=D,64&M){k.JQ="invalid distance code",i.mode=c;break}i.offset=W,i.extra=15&M,i.mode=24;case 24:if(i.extra){for(I=i.extra;T<I;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}i.offset+=j&(1<<i.extra)-1,j>>>=i.extra,T-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){k.JQ="invalid distance too far back",i.mode=c;break}i.mode=25;case 25:if(0===a)break k;if(p=X-a,i.offset>p){if(p=i.offset-p,p>i.whave&&i.sane){k.JQ="invalid distance too far back",i.mode=c;break}p>i.wnext?(p-=i.wnext,d=i.wsize-p):d=i.wnext-p,p>i.length&&(p=i.length),b=i.window}else b=y,d=s-i.offset,p=i.length;p>a&&(p=a),a-=p,i.length-=p;do{y[s++]=b[d++]}while(--p);0===i.length&&(i.mode=21);break;case 26:if(0===a)break k;y[s++]=i.length,a--,i.mode=21;break;case 27:if(i.wrap){for(;T<32;){if(0===u)break k;u--,j|=Y[L++]<<T,T+=8}if(X-=a,k.total_out+=X,i.total+=X,X&&(k.adler=i.check=i.flags?U(i.check,y,X,s-X):Z(i.check,y,X,s-X)),X=a,(i.flags?j:f(j))!==i.check){k.JQ="incorrect data check",i.mode=c;break}j=0,T=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;T<32;){if(0===u)break k;u--,j+=Y[L++]<<T,T+=8}if(j!==(4294967295&i.total)){k.JQ="incorrect length check",i.mode=c;break}j=0,T=0}i.mode=29;case 29:S=G;break k;case c:S=F;break k;case 31:return z;default:return e}return k.next_out=s,k.avail_out=a,k.next_in=L,k.avail_in=u,i.hold=j,i.bits=T,(i.wsize||X!==k.avail_out&&i.mode<c&&(i.mode<27||Q!==o))&&v(k,k.output,k.next_out,X-k.avail_out)?(i.mode=31,z):(N-=k.avail_in,X-=k.avail_out,k.total_in+=N,k.total_out+=X,i.total+=X,i.wrap&&X&&(k.adler=i.check=i.flags?U(i.check,y,X,k.next_out-X):Z(i.check,y,X,k.next_out-X)),k.data_type=i.bits+(i.last?64:0)+(i.mode===h?128:0)+(20===i.mode||15===i.mode?256:0),(0===N&&0===X||Q===o)&&S===J&&(S=E),S)},k.exports.inflateEnd=k=>{if(!k||!k.state)return e;let Q=k.state;return Q.window&&(Q.window=null),k.state=null,J},k.exports.inflateGetHeader=(k,Q)=>{if(!k||!k.state)return e;const i=k.state;return 0===(2&i.wrap)?e:(i.head=Q,Q.done=!1,J)},k.exports.inflateSetDictionary=(k,Q)=>{const i=Q.length;let U,C,B;return k&&k.state?(U=k.state,0!==U.wrap&&11!==U.mode?e:11===U.mode&&(C=1,C=Z(C,Q,i,0),C!==U.check)?F:(B=v(k,Q,i,i),B?(U.mode=31,z):(U.havedict=1,J))):e},k.exports.inflateInfo="pako inflate (from Nodeca project)"},12507:k=>{"use strict";const Q=15,i=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Z=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),U=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),C=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);k.exports=(k,B,o,m,O,J,G,H)=>{const e=H.bits;let F,z,E,l,h,c,f=0,Y=0,y=0,L=0,s=0,u=0,a=0,j=0,T=0,K=0,v=null,N=0;const X=new Uint16Array(16),p=new Uint16Array(16);let d,b,D,M=null,W=0;for(f=0;f<=Q;f++)X[f]=0;for(Y=0;Y<m;Y++)X[B[o+Y]]++;for(s=e,L=Q;L>=1&&0===X[L];L--);if(s>L&&(s=L),0===L)return O[J++]=20971520,O[J++]=20971520,H.bits=1,0;for(y=1;y<L&&0===X[y];y++);for(s<y&&(s=y),j=1,f=1;f<=Q;f++)if(j<<=1,j-=X[f],j<0)return-1;if(j>0&&(0===k||1!==L))return-1;for(p[1]=0,f=1;f<Q;f++)p[f+1]=p[f]+X[f];for(Y=0;Y<m;Y++)0!==B[o+Y]&&(G[p[B[o+Y]]++]=Y);if(0===k?(v=M=G,c=19):1===k?(v=i,N-=257,M=Z,W-=257,c=256):(v=U,M=C,c=-1),K=0,Y=0,f=y,h=J,u=s,a=0,E=-1,T=1<<s,l=T-1,1===k&&T>852||2===k&&T>592)return 1;for(;;){d=f-a,G[Y]<c?(b=0,D=G[Y]):G[Y]>c?(b=M[W+G[Y]],D=v[N+G[Y]]):(b=96,D=0),F=1<<f-a,z=1<<u,y=z;do{z-=F,O[h+(K>>a)+z]=d<<24|b<<16|D}while(0!==z);for(F=1<<f-1;K&F;)F>>=1;if(0!==F?(K&=F-1,K+=F):K=0,Y++,0===--X[f]){if(f===L)break;f=B[o+G[Y]]}if(f>s&&(K&l)!==E){for(0===a&&(a=s),h+=y,u=f-a,j=1<<u;u+a<L&&(j-=X[u+a],!(j<=0));)u++,j<<=1;if(T+=1<<u,1===k&&T>852||2===k&&T>592)return 1;E=K&l,O[E]=s<<24|u<<16|h-J}}return 0!==K&&(O[h+K]=f-a<<24|64<<16),H.bits=s,0}},12461:k=>{"use strict";k.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12443:k=>{"use strict";function Q(k){let Q=k.length;for(;--Q>=0;)k[Q]=0}const i=256,Z=286,U=30,C=15,B=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),o=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),m=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),J=new Array(576);Q(J);const G=new Array(60);Q(G);const H=new Array(512);Q(H);const e=new Array(256);Q(e);const F=new Array(29);Q(F);const z=new Array(U);function E(k,Q,i,Z,U){this.static_tree=k,this.extra_bits=Q,this.extra_base=i,this.elems=Z,this.max_length=U,this.has_stree=k&&k.length}let l,h,c;function f(k,Q){this.dyn_tree=k,this.max_code=0,this.stat_desc=Q}Q(z);const Y=k=>k<256?H[k]:H[256+(k>>>7)],y=(k,Q)=>{k.pending_buf[k.pending++]=255&Q,k.pending_buf[k.pending++]=Q>>>8&255},L=(k,Q,i)=>{k.bi_valid>16-i?(k.bi_buf|=Q<<k.bi_valid&65535,y(k,k.bi_buf),k.bi_buf=Q>>16-k.bi_valid,k.bi_valid+=i-16):(k.bi_buf|=Q<<k.bi_valid&65535,k.bi_valid+=i)},s=(k,Q,i)=>{L(k,i[2*Q],i[2*Q+1])},u=(k,Q)=>{let i=0;do{i|=1&k,k>>>=1,i<<=1}while(--Q>0);return i>>>1},a=(k,Q,i)=>{const Z=new Array(16);let U,B,o=0;for(U=1;U<=C;U++)Z[U]=o=o+i[U-1]<<1;for(B=0;B<=Q;B++){let Q=k[2*B+1];0!==Q&&(k[2*B]=u(Z[Q]++,Q))}},j=k=>{let Q;for(Q=0;Q<Z;Q++)k.dyn_ltree[2*Q]=0;for(Q=0;Q<U;Q++)k.dyn_dtree[2*Q]=0;for(Q=0;Q<19;Q++)k.bl_tree[2*Q]=0;k.dyn_ltree[512]=1,k.opt_len=k.static_len=0,k.last_lit=k.matches=0},T=k=>{k.bi_valid>8?y(k,k.bi_buf):k.bi_valid>0&&(k.pending_buf[k.pending++]=k.bi_buf),k.bi_buf=0,k.bi_valid=0},K=(k,Q,i,Z)=>{const U=2*Q,C=2*i;return k[U]<k[C]||k[U]===k[C]&&Z[Q]<=Z[i]},v=(k,Q,i)=>{const Z=k.heap[i];let U=i<<1;for(;U<=k.heap_len&&(U<k.heap_len&&K(Q,k.heap[U+1],k.heap[U],k.depth)&&U++,!K(Q,Z,k.heap[U],k.depth));)k.heap[i]=k.heap[U],i=U,U<<=1;k.heap[i]=Z},N=(k,Q,Z)=>{let U,C,m,O,J=0;if(0!==k.last_lit)do{U=k.pending_buf[k.d_buf+2*J]<<8|k.pending_buf[k.d_buf+2*J+1],C=k.pending_buf[k.l_buf+J],J++,0===U?s(k,C,Q):(m=e[C],s(k,m+i+1,Q),O=B[m],0!==O&&(C-=F[m],L(k,C,O)),U--,m=Y(U),s(k,m,Z),O=o[m],0!==O&&(U-=z[m],L(k,U,O)))}while(J<k.last_lit);s(k,256,Q)},X=(k,Q)=>{const i=Q.dyn_tree,Z=Q.stat_desc.static_tree,U=Q.stat_desc.has_stree,B=Q.stat_desc.elems;let o,m,O,J=-1;for(k.heap_len=0,k.heap_max=573,o=0;o<B;o++)0!==i[2*o]?(k.heap[++k.heap_len]=J=o,k.depth[o]=0):i[2*o+1]=0;for(;k.heap_len<2;)O=k.heap[++k.heap_len]=J<2?++J:0,i[2*O]=1,k.depth[O]=0,k.opt_len--,U&&(k.static_len-=Z[2*O+1]);for(Q.max_code=J,o=k.heap_len>>1;o>=1;o--)v(k,i,o);O=B;do{o=k.heap[1],k.heap[1]=k.heap[k.heap_len--],v(k,i,1),m=k.heap[1],k.heap[--k.heap_max]=o,k.heap[--k.heap_max]=m,i[2*O]=i[2*o]+i[2*m],k.depth[O]=(k.depth[o]>=k.depth[m]?k.depth[o]:k.depth[m])+1,i[2*o+1]=i[2*m+1]=O,k.heap[1]=O++,v(k,i,1)}while(k.heap_len>=2);k.heap[--k.heap_max]=k.heap[1],((k,Q)=>{const i=Q.dyn_tree,Z=Q.max_code,U=Q.stat_desc.static_tree,B=Q.stat_desc.has_stree,o=Q.stat_desc.extra_bits,m=Q.stat_desc.extra_base,O=Q.stat_desc.max_length;let J,G,H,e,F,z,E=0;for(e=0;e<=C;e++)k.bl_count[e]=0;for(i[2*k.heap[k.heap_max]+1]=0,J=k.heap_max+1;J<573;J++)G=k.heap[J],e=i[2*i[2*G+1]+1]+1,e>O&&(e=O,E++),i[2*G+1]=e,G>Z||(k.bl_count[e]++,F=0,G>=m&&(F=o[G-m]),z=i[2*G],k.opt_len+=z*(e+F),B&&(k.static_len+=z*(U[2*G+1]+F)));if(0!==E){do{for(e=O-1;0===k.bl_count[e];)e--;k.bl_count[e]--,k.bl_count[e+1]+=2,k.bl_count[O]--,E-=2}while(E>0);for(e=O;0!==e;e--)for(G=k.bl_count[e];0!==G;)H=k.heap[--J],H>Z||(i[2*H+1]!==e&&(k.opt_len+=(e-i[2*H+1])*i[2*H],i[2*H+1]=e),G--)}})(k,Q),a(i,J,k.bl_count)},p=(k,Q,i)=>{let Z,U,C=-1,B=Q[1],o=0,m=7,O=4;for(0===B&&(m=138,O=3),Q[2*(i+1)+1]=65535,Z=0;Z<=i;Z++)U=B,B=Q[2*(Z+1)+1],++o<m&&U===B||(o<O?k.bl_tree[2*U]+=o:0!==U?(U!==C&&k.bl_tree[2*U]++,k.bl_tree[32]++):o<=10?k.bl_tree[34]++:k.bl_tree[36]++,o=0,C=U,0===B?(m=138,O=3):U===B?(m=6,O=3):(m=7,O=4))},d=(k,Q,i)=>{let Z,U,C=-1,B=Q[1],o=0,m=7,O=4;for(0===B&&(m=138,O=3),Z=0;Z<=i;Z++)if(U=B,B=Q[2*(Z+1)+1],!(++o<m&&U===B)){if(o<O)do{s(k,U,k.bl_tree)}while(0!==--o);else 0!==U?(U!==C&&(s(k,U,k.bl_tree),o--),s(k,16,k.bl_tree),L(k,o-3,2)):o<=10?(s(k,17,k.bl_tree),L(k,o-3,3)):(s(k,18,k.bl_tree),L(k,o-11,7));o=0,C=U,0===B?(m=138,O=3):U===B?(m=6,O=3):(m=7,O=4)}};let b=!1;const D=(k,Q,i,Z)=>{L(k,0+(Z?1:0),3),((k,Q,i,Z)=>{T(k),Z&&(y(k,i),y(k,~i)),k.pending_buf.set(k.window.subarray(Q,Q+i),k.pending),k.pending+=i})(k,Q,i,!0)};k.exports._tr_init=k=>{b||((()=>{let k,Q,i,O,f;const Y=new Array(16);for(i=0,O=0;O<28;O++)for(F[O]=i,k=0;k<1<<B[O];k++)e[i++]=O;for(e[i-1]=O,f=0,O=0;O<16;O++)for(z[O]=f,k=0;k<1<<o[O];k++)H[f++]=O;for(f>>=7;O<U;O++)for(z[O]=f<<7,k=0;k<1<<o[O]-7;k++)H[256+f++]=O;for(Q=0;Q<=C;Q++)Y[Q]=0;for(k=0;k<=143;)J[2*k+1]=8,k++,Y[8]++;for(;k<=255;)J[2*k+1]=9,k++,Y[9]++;for(;k<=279;)J[2*k+1]=7,k++,Y[7]++;for(;k<=287;)J[2*k+1]=8,k++,Y[8]++;for(a(J,287,Y),k=0;k<U;k++)G[2*k+1]=5,G[2*k]=u(k,5);l=new E(J,B,257,Z,C),h=new E(G,o,0,U,C),c=new E(new Array(0),m,0,19,7)})(),b=!0),k.l_desc=new f(k.dyn_ltree,l),k.d_desc=new f(k.dyn_dtree,h),k.bl_desc=new f(k.bl_tree,c),k.bi_buf=0,k.bi_valid=0,j(k)},k.exports._tr_stored_block=D,k.exports._tr_flush_block=(k,Q,Z,U)=>{let C,B,o=0;k.level>0?(2===k.strm.data_type&&(k.strm.data_type=(k=>{let Q,Z=4093624447;for(Q=0;Q<=31;Q++,Z>>>=1)if(1&Z&&0!==k.dyn_ltree[2*Q])return 0;if(0!==k.dyn_ltree[18]||0!==k.dyn_ltree[20]||0!==k.dyn_ltree[26])return 1;for(Q=32;Q<i;Q++)if(0!==k.dyn_ltree[2*Q])return 1;return 0})(k)),X(k,k.l_desc),X(k,k.d_desc),o=(k=>{let Q;for(p(k,k.dyn_ltree,k.l_desc.max_code),p(k,k.dyn_dtree,k.d_desc.max_code),X(k,k.bl_desc),Q=18;Q>=3&&0===k.bl_tree[2*O[Q]+1];Q--);return k.opt_len+=3*(Q+1)+5+5+4,Q})(k),C=k.opt_len+3+7>>>3,B=k.static_len+3+7>>>3,B<=C&&(C=B)):C=B=Z+5,Z+4<=C&&-1!==Q?D(k,Q,Z,U):4===k.strategy||B===C?(L(k,2+(U?1:0),3),N(k,J,G)):(L(k,4+(U?1:0),3),((k,Q,i,Z)=>{let U;for(L(k,Q-257,5),L(k,i-1,5),L(k,Z-4,4),U=0;U<Z;U++)L(k,k.bl_tree[2*O[U]+1],3);d(k,k.dyn_ltree,Q-1),d(k,k.dyn_dtree,i-1)})(k,k.l_desc.max_code+1,k.d_desc.max_code+1,o+1),N(k,k.dyn_ltree,k.dyn_dtree)),j(k),U&&T(k)},k.exports._tr_tally=(k,Q,Z)=>(k.pending_buf[k.d_buf+2*k.last_lit]=Q>>>8&255,k.pending_buf[k.d_buf+2*k.last_lit+1]=255&Q,k.pending_buf[k.l_buf+k.last_lit]=255&Z,k.last_lit++,0===Q?k.dyn_ltree[2*Z]++:(k.matches++,Q--,k.dyn_ltree[2*(e[Z]+i+1)]++,k.dyn_dtree[2*Y(Q)]++),k.last_lit===k.lit_bufsize-1),k.exports._tr_align=k=>{L(k,2,3),s(k,256,J),(k=>{16===k.bi_valid?(y(k,k.bi_buf),k.bi_buf=0,k.bi_valid=0):k.bi_valid>=8&&(k.pending_buf[k.pending++]=255&k.bi_buf,k.bi_buf>>=8,k.bi_valid-=8)})(k)}},12487:k=>{"use strict";k.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.JQ="",this.state=null,this.data_type=2,this.adler=0}},12123:k=>{function Q(k,Q,i){for(var Z=k.length,U=-1/0,C=1/0,B=0;B<Z;B++){var o=(i[0][B]-k[B])/Q[B],m=(i[1][B]-k[B])/Q[B];if(o>m){var O=o;o=m,m=O}if(m<U||o>C)return 1/0;o>U&&(U=o),m<C&&(C=m)}return U>C?1/0:U}k.exports=function(k,i,Z,U){var C=Q(i,Z,U);if(C===1/0)k=null;else{k=k||[];for(var B=0;B<i.length;B++)k[B]=i[B]+Z[B]*C}return k},k.exports.distance=Q},13536:(k,Q,i)=>{"use strict";i.d(Q,{b:()=>B});var Z=i(35);const U=Z.useLayoutEffect;const C=function(k){var Q=(0,Z.useRef)(k);return U((function(){Q.current=k})),Q};var B=function(k){var Q=C(k);(0,Z.oQ)((function(){var k=function(k){var i;if(null!=Q.current&&(i=Q.current(k)),k.defaultPrevented&&(k.returnValue=""),"string"===typeof i)return k.returnValue=i,i};return window.addEventListener("beforeunload",k),function(){window.removeEventListener("beforeunload",k)}}),[])}},13489:(k,Q,i)=>{"use strict";var Z=i(13491),U=Array.prototype.concat,C=Array.prototype.slice,B=k.exports=function(k){for(var Q=[],i=0,B=k.length;i<B;i++){var o=k[i];Z(o)?Q=U.call(Q,C.call(o)):Q.push(o)}return Q};B.wrap=function(k){return function(){return k(B(arguments))}}},13491:k=>{k.exports=function(k){return!(!k||"string"===typeof k)&&(k instanceof Array||Array.isArray(k)||k.length>=0&&(k.splice instanceof Function||Object.getOwnPropertyDescriptor(k,k.length-1)&&"String"!==k.constructor.name))}},12390:(k,Q,i)=>{var Z=i(12396);function U(k){for(var Q,i,U=0,C=k.length,B=0;B<k.length;){for(Q=k[B],i=0;B<C&&k[B]===Q;)++B,++i;U+=Z.log2(i)/7|0,U+=Z.log2(Q>>>0)/7|0,U+=2}return U}Q.size=U,Q.encode=function(k,Q){Q||(Q=new Uint8Array(U(k)));for(var i,Z,C=0,B=Q.length,o=0;o<k.length;){for(i=k[o],Z=0;o<k.length&&k[o]===i;)++o,++Z;for(;C<B&&Z>=128;)Q[C++]=128+(127&Z),Z>>>=7;if(C>=B)throw new Error("RLE buffer overflow");for(Q[C++]=Z,i>>>=0;C<B&&i>=128;)Q[C++]=128+(127&i),i>>>=7;if(C>=B)throw new Error("RLE buffer overflow");Q[C++]=i}return Q},Q.decode=function(k,Q){for(var i,Z,U,C,B=Q.length,o=k.length,m=0,O=0;O<o;){for(i=0,Z=0;O<o&&k[O]>=128;)i+=(127&k[O++])<<Z,Z+=7;if(i+=k[O++]<<Z,O>=o)throw new Error("RLE buffer underrun");if(m+i>B)throw new Error("Chunk buffer overflow");for(U=0,Z=0;O<o&&k[O]>=128;)U+=(127&k[O++])<<Z,Z+=7;if(O>=o)throw new Error("RLE buffer underrun");for(U+=k[O++]<<Z,C=0;C<i;++C)Q[m++]=U}return Q}},12396:(k,Q)=>{"use strict";function i(k){var Q=32;return(k&=-k)&&Q--,65535&k&&(Q-=16),16711935&k&&(Q-=8),252645135&k&&(Q-=4),858993459&k&&(Q-=2),1431655765&k&&(Q-=1),Q}Q.INT_BITS=32,Q.INT_MAX=2147483647,Q.INT_MIN=-1<<31,Q.sign=function(k){return(k>0)-(k<0)},Q.abs=function(k){var Q=k>>31;return(k^Q)-Q},Q.min=function(k,Q){return Q^(k^Q)&-(k<Q)},Q.max=function(k,Q){return k^(k^Q)&-(k<Q)},Q.isPow2=function(k){return!(k&k-1)&&!!k},Q.log2=function(k){var Q,i;return Q=(k>65535)<<4,Q|=i=((k>>>=Q)>255)<<3,Q|=i=((k>>>=i)>15)<<2,(Q|=i=((k>>>=i)>3)<<1)|(k>>>=i)>>1},Q.log10=function(k){return k>=1e9?9:k>=1e8?8:k>=1e7?7:k>=1e6?6:k>=1e5?5:k>=1e4?4:k>=1e3?3:k>=100?2:k>=10?1:0},Q.popCount=function(k){return 16843009*((k=(858993459&(k-=k>>>1&1431655765))+(k>>>2&858993459))+(k>>>4)&252645135)>>>24},Q.countTrailingZeros=i,Q.nextPow2=function(k){return k+=0===k,--k,k|=k>>>1,k|=k>>>2,k|=k>>>4,k|=k>>>8,(k|=k>>>16)+1},Q.prevPow2=function(k){return k|=k>>>1,k|=k>>>2,k|=k>>>4,k|=k>>>8,(k|=k>>>16)-(k>>>1)},Q.parity=function(k){return k^=k>>>16,k^=k>>>8,k^=k>>>4,27030>>>(k&=15)&1};var Z=new Array(256);!function(k){for(var Q=0;Q<256;++Q){var i=Q,Z=Q,U=7;for(i>>>=1;i;i>>>=1)Z<<=1,Z|=1&i,--U;k[Q]=Z<<U&255}}(Z),Q.reverse=function(k){return Z[255&k]<<24|Z[k>>>8&255]<<16|Z[k>>>16&255]<<8|Z[k>>>24&255]},Q.interleave2=function(k,Q){return(k=1431655765&((k=858993459&((k=252645135&((k=16711935&((k&=65535)|k<<8))|k<<4))|k<<2))|k<<1))|(Q=1431655765&((Q=858993459&((Q=252645135&((Q=16711935&((Q&=65535)|Q<<8))|Q<<4))|Q<<2))|Q<<1))<<1},Q.deinterleave2=function(k,Q){return(k=65535&((k=16711935&((k=252645135&((k=858993459&((k=k>>>Q&1431655765)|k>>>1))|k>>>2))|k>>>4))|k>>>16))<<16>>16},Q.interleave3=function(k,Q,i){return k=1227133513&((k=3272356035&((k=251719695&((k=4278190335&((k&=1023)|k<<16))|k<<8))|k<<4))|k<<2),(k|=(Q=1227133513&((Q=3272356035&((Q=251719695&((Q=4278190335&((Q&=1023)|Q<<16))|Q<<8))|Q<<4))|Q<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},Q.deinterleave3=function(k,Q){return(k=1023&((k=4278190335&((k=251719695&((k=3272356035&((k=k>>>Q&1227133513)|k>>>2))|k>>>4))|k>>>8))|k>>>16))<<22>>22},Q.nextCombination=function(k){var Q=k|k-1;return Q+1|(~Q&-~Q)-1>>>i(k)+1}},12425:k=>{"use strict";k.exports=function(k,Q,i,Z){var U=self||window;try{try{var C;try{C=new U.Blob([k])}catch(O){(C=new(U.BlobBuilder||U.WebKitBlobBuilder||U.MozBlobBuilder||U.MSBlobBuilder)).append(k),C=C.getBlob()}var B=U.URL||U.webkitURL,o=B.createObjectURL(C),m=new U[Q](o,i);return B.revokeObjectURL(o),m}catch(O){return new U[Q]("data:application/javascript,".concat(encodeURIComponent(k)),i)}}catch(O){if(!Z)throw Error("Inline worker is not supported");return new U[Q](Z,i)}}},12113:(k,Q,i)=>{"use strict";function Z(k,Q,i,Z,U){var C={};return Object.keys(Z).forEach((function(k){C[k]=Z[k]})),C.enumerable=!!C.enumerable,C.configurable=!!C.configurable,("value"in C||C.initializer)&&(C.writable=!0),C=i.slice().reverse().reduce((function(i,Z){return Z(k,Q,i)||i}),C),U&&void 0!==C.initializer&&(C.value=C.initializer?C.initializer.call(U):void 0,C.initializer=void 0),void 0===C.initializer&&(Object.defineProperty(k,Q,C),C=null),C}i.d(Q,{e:()=>Z})},12108:(k,Q,i)=>{"use strict";function Z(k,Q,i,Z){i&&Object.defineProperty(k,Q,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(Z):void 0})}i.d(Q,{c:()=>Z})},13520:(k,Q,i)=>{"use strict";i.d(Q,{d:()=>B,e:()=>G,f:()=>o,j:()=>C,k:()=>m,o:()=>U,s:()=>O,t:()=>J});var Z=i(11505);class U{constructor(){this._easingMode=U.EASINGMODE_EASEIN}setEasingMode(k){const Q=Math.min(Math.max(k,0),2);this._easingMode=Q}getEasingMode(){return this._easingMode}easeInCore(k){throw new Error("You must implement this method")}ease(k){switch(this._easingMode){case U.EASINGMODE_EASEIN:return this.easeInCore(k);case U.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-k)}return k>=.5?.5*(1-this.easeInCore(2*(1-k)))+.5:.5*this.easeInCore(2*k)}}U.EASINGMODE_EASEIN=0,U.EASINGMODE_EASEOUT=1,U.EASINGMODE_EASEINOUT=2;class C extends U{easeInCore(k){return k=Math.max(0,Math.min(1,k)),1-Math.sqrt(1-k*k)}}class B extends U{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=k}easeInCore(k){const Q=Math.max(0,this.amplitude);return Math.pow(k,3)-k*Q*Math.sin(3.141592653589793*k)}}class o extends U{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=k,this.bounciness=Q}easeInCore(k){const Q=Math.max(0,this.bounces);let i=this.bounciness;i<=1&&(i=1.001);const Z=Math.pow(i,Q),U=1-i,C=(1-Z)/U+.5*Z,B=k*C,o=Math.log(-B*(1-i)+1)/Math.log(i),m=Math.floor(o),O=m+1,J=(1-Math.pow(i,m))/(U*C),G=.5*(J+(1-Math.pow(i,O))/(U*C)),H=k-G,e=G-J;return-Math.pow(1/i,Q-m)/(e*e)*(H-e)*(H+e)}}class m extends U{easeInCore(k){return k*k*k}}class O extends U{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=k,this.springiness=Q}easeInCore(k){let Q;const i=Math.max(0,this.oscillations),Z=Math.max(0,this.springiness);return Q=0==Z?k:(Math.exp(Z*k)-1)/(Math.exp(Z)-1),Q*Math.sin((6.283185307179586*i+1.5707963267948966)*k)}}class J extends U{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=k}easeInCore(k){return this.exponent<=0?k:(Math.exp(this.exponent*k)-1)/(Math.exp(this.exponent)-1)}}class G extends U{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=k,this.y1=Q,this.x2=i,this.y2=Z}easeInCore(k){return Z.e.Interpolate(k,this.x1,this.y1,this.x2,this.y2)}}},12984:(k,Q,i)=>{"use strict";i.d(Q,{c:()=>B});var Z=i(11298),U=i(11307),C=i(11706);class B extends C.c{get _matrix(){return this._compose(),this.eH}set _matrix(k){(k.updateFlag!==this.eH.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.eH.B(k),this._markAsDirtyAndDecompose())}constructor(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(k,Q.sk(),!1),this.name=k,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=Q,this.eH=(null===U||void 0===U?void 0:U.clone())??Z.Matrix.Identity(),this._restMatrix=C??this.eH.clone(),this._bindMatrix=B??this.eH.clone(),this._index=o,this._absoluteMatrix=new Z.Matrix,this._absoluteBindMatrix=new Z.Matrix,this._absoluteInverseBindMatrix=new Z.Matrix,this._finalMatrix=new Z.Matrix,Q.bones.push(this),this.setParent(i,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(k){this.setParent(k)}setParent(k){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==k){if(this.parent){const k=this.parent.children.indexOf(this);-1!==k&&this.parent.children.splice(k,1)}this._parentNode=k,this.parent&&this.parent.children.push(this),Q&&this._updateAbsoluteBindMatrices(),this.DO()}}getLocalMatrix(){return this._compose(),this.eH}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(k){this._restMatrix.B(k)}setRestPose(k){this.setRestMatrix(k)}getBindPose(){return this.getBindMatrix()}setBindMatrix(k){this.Bo(k)}setBindPose(k){this.setBindMatrix(k)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const k=Z.TmpVectors.zQ[0],Q=Z.TmpVectors.Quaternion[0],i=Z.TmpVectors.zQ[1];this.getRestMatrix().decompose(k,Q,i),this._linkedTransformNode.position.B(i),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??Z.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.B(Q),this._linkedTransformNode.Ho.B(k)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(k){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=k,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Do}set position(k){this._decompose(),this.Do.B(k),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(k){this.setRotation(k)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(k){this.setRotationQuaternion(k)}get Ho(){return this.getScale()}set Ho(k){this.setScale(k)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=Z.zQ.Zero(),this._localRotation=Z.Quaternion.Zero(),this.Do=Z.zQ.Zero()),this.eH.decompose(this._localScaling,this._localRotation,this.Do))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,Z.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Do,this.eH)):this._needToCompose=!1)}Bo(k){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.B(k),Q&&this._updateAbsoluteBindMatrices(),i?this._matrix=k:this.DO()}_updateAbsoluteBindMatrices(k){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(k||(k=this._bindMatrix),this.parent?k.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.B(k),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),Q)for(let i=0;i<this.children.length;i++)this.children[i]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}DO(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.DO(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.DO(),this._needToDecompose=!0}_updatePosition(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,U=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const C=this.getLocalMatrix();if(0==Q)U?(C.addAtIndex(12,k.x),C.addAtIndex(13,k.y),C.addAtIndex(14,k.z)):C.setTranslationFromFloats(k.x,k.y,k.z);else{let Q=null;i&&(Q=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const o=B._TmpMats[0],m=B._TmpVecs[0];this.parent?i&&Q?(o.B(this.parent.getAbsoluteMatrix()),o.multiplyToRef(Q,o)):o.B(this.parent.getAbsoluteMatrix()):Z.Matrix.IdentityToRef(o),U&&o.setTranslationFromFloats(0,0,0),o.invert(),Z.zQ.TransformCoordinatesToRef(k,o,m),U?(C.addAtIndex(12,m.x),C.addAtIndex(13,m.y),C.addAtIndex(14,m.z)):C.setTranslationFromFloats(m.x,m.y,m.z)}this._markAsDirtyAndDecompose()}translate(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this._updatePosition(k,Q,i,!0)}setPosition(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this._updatePosition(k,Q,i,!1)}setAbsolutePosition(k,Q){this.setPosition(k,1,Q)}scale(k,Q,i){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const C=this.getLocalMatrix(),o=B._TmpMats[0];Z.Matrix.ScalingToRef(k,Q,i,o),o.multiplyToRef(C,C),o.invert();for(const Z of this.children){const U=Z.getLocalMatrix();U.multiplyToRef(o,U),U.multiplyAtIndex(12,k),U.multiplyAtIndex(13,Q),U.multiplyAtIndex(14,i),Z._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),U)for(const Z of this.children)Z.scale(k,Q,i,U)}setScale(k){this._decompose(),this._localScaling.B(k),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(k){this._decompose(),k.B(this._localScaling)}setYawPitchRoll(k,Q,i){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4?arguments[4]:void 0;if(0===U){const o=B._TmpQuat;return Z.Quaternion.RotationYawPitchRollToRef(k,Q,i,o),void this.setRotationQuaternion(o,U,C)}const o=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(o,C))return;const m=B._TmpMats[1];Z.Matrix.RotationYawPitchRollToRef(k,Q,i,m),o.multiplyToRef(m,m),this._rotateWithMatrix(m,U,C)}rotate(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,U=arguments.length>3?arguments[3]:void 0;const C=B._TmpMats[0];C.setTranslationFromFloats(0,0,0),Z.Matrix.RotationAxisToRef(k,Q,C),this._rotateWithMatrix(C,i,U)}setAxisAngle(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,U=arguments.length>3?arguments[3]:void 0;if(0===i){const C=B._TmpQuat;return Z.Quaternion.RotationAxisToRef(k,Q,C),void this.setRotationQuaternion(C,i,U)}const C=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(C,U))return;const o=B._TmpMats[1];Z.Matrix.RotationAxisToRef(k,Q,o),C.multiplyToRef(o,o),this._rotateWithMatrix(o,i,U)}setRotation(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(k.y,k.x,k.z,Q,i)}setRotationQuaternion(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(0===Q)return this._decompose(),this._localRotation.B(k),void this._markAsDirtyAndCompose();const U=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(U,i))return;const C=B._TmpMats[1];Z.Matrix.FromQuaternionToRef(k,C),U.multiplyToRef(C,C),this._rotateWithMatrix(C,Q,i)}setRotationMatrix(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(0===Q){const U=B._TmpQuat;return Z.Quaternion.FromRotationMatrixToRef(k,U),void this.setRotationQuaternion(U,Q,i)}const U=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(U,i))return;const C=B._TmpMats[1];C.B(k),U.multiplyToRef(k,C),this._rotateWithMatrix(C,Q,i)}_rotateWithMatrix(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;const Z=this.getLocalMatrix(),U=Z.m[12],C=Z.m[13],o=Z.m[14],m=this.getParent(),O=B._TmpMats[3],J=B._TmpMats[4];m&&1==Q?(i?(O.B(i.getWorldMatrix()),m.getAbsoluteMatrix().multiplyToRef(O,O)):O.B(m.getAbsoluteMatrix()),J.B(O),J.invert(),Z.multiplyToRef(O,Z),Z.multiplyToRef(k,Z),Z.multiplyToRef(J,Z)):1==Q&&i?(O.B(i.getWorldMatrix()),J.B(O),J.invert(),Z.multiplyToRef(O,Z),Z.multiplyToRef(k,Z),Z.multiplyToRef(J,Z)):Z.multiplyToRef(k,Z),Z.setTranslationFromFloats(U,C,o),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(k,Q){const i=B._TmpMats[2];return k.B(this.getAbsoluteMatrix()),Q?(k.multiplyToRef(Q.getWorldMatrix(),k),Z.Matrix.ScalingToRef(Q.Ho.x,Q.Ho.y,Q.Ho.z,i)):Z.Matrix.IdentityToRef(i),k.invert(),!isNaN(k.m[0])&&(i.multiplyAtIndex(0,this._scalingDeterminant),k.multiplyToRef(i,k),!0)}ci(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=Z.zQ.Zero();return this.getPositionToRef(k,Q,i),i}getPositionToRef(){let k=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const k=this.getLocalMatrix();Q.x=k.m[12],Q.y=k.m[13],Q.z=k.m[14]}else{let i=null;k&&(i=k.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let Z=B._TmpMats[0];k&&i?(Z.B(this.getAbsoluteMatrix()),Z.multiplyToRef(i,Z)):Z=this.getAbsoluteMatrix(),Q.x=Z.m[12],Q.y=Z.m[13],Q.z=Z.m[14]}}getAbsolutePosition(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const Q=Z.zQ.Zero();return this.getPositionToRef(1,k,Q),Q}getAbsolutePositionToRef(k,Q){this.getPositionToRef(1,k,Q)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.eH.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.B(this.eH);const k=this._skeleton.getPoseMatrix();k&&this._absoluteMatrix.multiplyToRef(k,this._absoluteMatrix)}const k=this.children,Q=k.length;for(let i=0;i<Q;i++)k[i].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}zm(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=Z.zQ.Zero();return this.getDirectionToRef(k,Q,i),i}getDirectionToRef(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,U=null;Q&&(U=Q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=B._TmpMats[0];C.B(this.getAbsoluteMatrix()),Q&&U&&C.multiplyToRef(U,C),Z.zQ.TransformNormalToRef(k,C,i),i.normalize()}getRotation(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=Z.zQ.Zero();return this.getRotationToRef(k,Q,i),i}getRotationToRef(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;const Z=B._TmpQuat;this.getRotationQuaternionToRef(k,Q,Z),Z.toEulerAnglesToRef(i)}getRotationQuaternion(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=Z.Quaternion.Identity();return this.getRotationQuaternionToRef(k,Q,i),i}getRotationQuaternionToRef(){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),Q.B(this._localRotation);else{const i=B._TmpMats[0],Z=this.getAbsoluteMatrix();k?Z.multiplyToRef(k.getWorldMatrix(),i):i.B(Z),i.multiplyAtIndex(0,this._scalingDeterminant),i.multiplyAtIndex(1,this._scalingDeterminant),i.multiplyAtIndex(2,this._scalingDeterminant),i.decompose(void 0,Q,void 0)}}getRotationMatrix(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1?arguments[1]:void 0;const i=Z.Matrix.Identity();return this.getRotationMatrixToRef(k,Q,i),i}getRotationMatrixToRef(){let k=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(Q);else{const i=B._TmpMats[0],Z=this.getAbsoluteMatrix();k?Z.multiplyToRef(k.getWorldMatrix(),i):i.B(Z),i.multiplyAtIndex(0,this._scalingDeterminant),i.multiplyAtIndex(1,this._scalingDeterminant),i.multiplyAtIndex(2,this._scalingDeterminant),i.getRotationMatrixToRef(Q)}}getAbsolutePositionFromLocal(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=Z.zQ.Zero();return this.getAbsolutePositionFromLocalToRef(k,Q,i),i}getAbsolutePositionFromLocalToRef(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,U=null;Q&&(U=Q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=B._TmpMats[0];C.B(this.getAbsoluteMatrix()),Q&&U&&C.multiplyToRef(U,C),Z.zQ.TransformCoordinatesToRef(k,C,i)}getLocalPositionFromAbsolute(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=Z.zQ.Zero();return this.getLocalPositionFromAbsoluteToRef(k,Q,i),i}getLocalPositionFromAbsoluteToRef(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,U=null;Q&&(U=Q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=B._TmpMats[0];C.B(this.getAbsoluteMatrix()),Q&&U&&C.multiplyToRef(U,C),C.invert(),Z.zQ.TransformCoordinatesToRef(k,C,i)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const k=this._skeleton.bones.indexOf(this);if(-1!==k&&this._skeleton.bones.splice(k,1),this._parentNode&&this._parentNode.children){const k=this._parentNode.children,Q=k.indexOf(this);-1!==Q&&k.splice(Q,1)}super.dispose()}}B._TmpVecs=(0,U.c)(2,Z.zQ.Zero),B._TmpQuat=Z.Quaternion.Identity(),B._TmpMats=(0,U.c)(5,Z.Matrix.Identity)},13511:(k,Q,i)=>{"use strict";i.d(Q,{c:()=>X});var Z=i(11280),U=i(11289),C=i(11122),B=i(11298),o=i(11311),m=i(11706),O=i(11734),J=i(11572),G=i(11144),H=i(11304);class e{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(k){this._zoomStopsAnimation=k}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(k){this._idleRotationSpeed=k}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(k){this._idleRotationWaitTime=k}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(k){this._idleRotationSpinupTime=k}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(k){this._attachedCamera=k;const Q=this._attachedCamera.sk();this._onPrePointerObservableObserver=Q.onPrePointerObservable.add((k=>{k.type!==J.e.POINTERDOWN?k.type===J.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=k.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const k=G.c.Now;let Q=0;null!=this._lastFrameTime&&(Q=k-this._lastFrameTime),this._lastFrameTime=k,this._applyUserInteraction();const i=k-this._lastInteractionTime-this._idleRotationWaitTime,Z=Math.max(Math.min(i/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*Z,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(Q/1e3))}))}detach(){if(!this._attachedCamera)return;const k=this._attachedCamera.sk();this._onPrePointerObservableObserver&&k.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(k){this._lastInteractionTime=k??G.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<H.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let k=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(k=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?k:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=G.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var F=i(13520),z=i(11805);class E{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(k){if(this._autoTransitionRange===k)return;this._autoTransitionRange=k;const Q=this._attachedCamera;Q&&(k?this._onMeshTargetChangedObserver=Q.onMeshTargetChangedObservable.add((k=>{if(k&&(k.oo(!0),k.getBoundingInfo)){const Q=k.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*Q,this.upperRadiusTransitionRange=.05*Q}})):this._onMeshTargetChangedObserver&&Q.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(k){this._attachedCamera=k,this._onAfterCheckInputsObserver=k.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(k){return!!this._attachedCamera&&(this._attachedCamera.radius===k&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(k){if(!this._attachedCamera)return;this._radiusBounceTransition||(E.EasingFunction.setEasingMode(E.EasingMode),this._radiusBounceTransition=z.c.CreateAnimation("radius",z.c.ANIMATIONTYPE_FLOAT,60,E.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const Q=z.c.TransitionTo("radius",this._attachedCamera.radius+k,this._attachedCamera,this._attachedCamera.sk(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));Q&&this._animatables.push(Q)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}E.EasingFunction=new F.d(.3),E.EasingMode=F.o.EASINGMODE_EASEOUT;class l{constructor(){this.onTargetFramingAnimationEndObservable=new C.c,this._mode=l.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(k){this._mode=k}get mode(){return this._mode}set radiusScale(k){this._radiusScale=k}get radiusScale(){return this._radiusScale}set positionScale(k){this._positionScale=k}get positionScale(){return this._positionScale}set defaultElevation(k){this._defaultElevation=k}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(k){this._elevationReturnTime=k}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(k){this._elevationReturnWaitTime=k}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(k){this._zoomStopsAnimation=k}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(k){this._framingTime=k}get framingTime(){return this._framingTime}init(){}attach(k){this._attachedCamera=k;const Q=this._attachedCamera.sk();l.EasingFunction.setEasingMode(l.EasingMode),this._onPrePointerObservableObserver=Q.onPrePointerObservable.add((k=>{k.type!==J.e.POINTERDOWN?k.type===J.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=k.onMeshTargetChangedObservable.add((k=>{k&&k.getBoundingInfo&&this.zoomOnMesh(k,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=k.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const k=this._attachedCamera.sk();this._onPrePointerObservableObserver&&k.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;k.oo(!0);const Z=k.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(Z.minimumWorld,Z.maximumWorld,Q,i)}zoomOnMeshHierarchy(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;k.oo(!0);const Z=k.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(Z.min,Z.max,Q,i)}zoomOnMeshesHierarchy(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new B.zQ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new B.zQ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let C=0;C<k.length;C++){const Q=k[C].getHierarchyBoundingVectors(!0);B.zQ.CheckExtends(Q.min,Z,U),B.zQ.CheckExtends(Q.max,Z,U)}this.zoomOnBoundingInfo(Z,U,Q,i)}zoomOnBoundingInfo(k,Q){let i,Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const C=k.y,o=C+(Q.y-C)*this._positionScale,m=Q.EQ(k).scale(.5);if(!isFinite(o))return!1;if(Z)i=new B.zQ(0,o,0);else{const Q=k.add(m);i=new B.zQ(Q.x,o,Q.z)}this._vectorTransition||(this._vectorTransition=z.c.CreateAnimation("target",z.c.ANIMATIONTYPE_VECTOR3,60,l.EasingFunction)),this._betaIsAnimating=!0;let O=z.c.TransitionTo("target",i,this._attachedCamera,this._attachedCamera.sk(),60,this._vectorTransition,this._framingTime);O&&this._animatables.push(O);let J=0;if(this._mode===l.FitFrustumSidesMode){const i=this._calculateLowerRadiusFromModelBoundingSphere(k,Q);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=m.length()+this._attachedCamera.Co),J=i}else this._mode===l.IgnoreBoundsSizeMode&&(J=this._calculateLowerRadiusFromModelBoundingSphere(k,Q),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Co));if(this.autoCorrectCameraLimitsAndSensibility){const i=Q.EQ(k).length();this._attachedCamera.panningSensibility=5e3/i,this._attachedCamera.wheelPrecision=100/J}return this._radiusTransition||(this._radiusTransition=z.c.CreateAnimation("radius",z.c.ANIMATIONTYPE_FLOAT,60,l.EasingFunction)),O=z.c.TransitionTo("radius",J,this._attachedCamera,this._attachedCamera.sk(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),U&&U(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),O&&this._animatables.push(O),!0}_calculateLowerRadiusFromModelBoundingSphere(k,Q){const i=this._attachedCamera;if(!i)return 0;let Z=i._calculateLowerRadiusFromModelBoundingSphere(k,Q,this._radiusScale);return i.lowerRadiusLimit&&this._mode===l.IgnoreBoundsSizeMode&&(Z=Z<i.lowerRadiusLimit?i.lowerRadiusLimit:Z),i.upperRadiusLimit&&(Z=Z>i.upperRadiusLimit?i.upperRadiusLimit:Z),Z}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const k=G.c.Now-this._lastInteractionTime,Q=.5*Math.PI-this._defaultElevation,i=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>i&&k>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=z.c.CreateAnimation("beta",z.c.ANIMATIONTYPE_FLOAT,60,l.EasingFunction));const k=z.c.TransitionTo("beta",Q,this._attachedCamera,this._attachedCamera.sk(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));k&&this._animatables.push(k)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=G.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}l.EasingFunction=new F.t,l.EasingMode=F.o.EASINGMODE_EASEINOUT,l.IgnoreBoundsSizeMode=0,l.FitFrustumSidesMode=1;var h=i(11740),c=i(11766),f=i(12980),Y=i(11119);class y{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(k){k=Y.Tools.BackCompatCameraNoPreventDefault(arguments);const Q=this.camera.getEngine(),i=Q.getInputElement();let Z=0,U=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=C=>{var B,o;const m=C.event,O="touch"===m.pointerType;if(C.type!==J.e.POINTERMOVE&&-1===this.buttons.indexOf(m.button))return;const G=m.target;if(this._altKey=m.altKey,this._ctrlKey=m.ctrlKey,this._metaKey=m.metaKey,this._shiftKey=m.shiftKey,this._buttonsPressed=m.buttons,Q.isPointerLock){const k=m.movementX,Q=m.movementY;this.onTouch(null,k,Q),this._pointA=null,this._pointB=null}else{if(C.type!==J.e.POINTERDOWN&&C.type!==J.e.POINTERDOUBLETAP&&O&&(null===(B=this._pointA)||void 0===B?void 0:B.pointerId)!==m.pointerId&&(null===(o=this._pointB)||void 0===o?void 0:o.pointerId)!==m.pointerId)return;if(C.type!==J.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!O)if(C.type===J.e.POINTERDOUBLETAP)this.onDoubleTap(m.pointerType);else if(C.type!==J.e.POINTERUP||this._currentMousePointerIdDown!==m.pointerId&&!O){if(C.type===J.e.POINTERMOVE)if(k||m.preventDefault(),this._pointA&&null===this._pointB){const k=m.clientX-this._pointA.x,Q=m.clientY-this._pointA.y;this._pointA.x=m.clientX,this._pointA.y=m.clientY,this.onTouch(this._pointA,k,Q)}else if(this._pointA&&this._pointB){const k=this._pointA.pointerId===m.pointerId?this._pointA:this._pointB;k.x=m.clientX,k.y=m.clientY;const Q=this._pointA.x-this._pointB.x,i=this._pointA.y-this._pointB.y,B=Q*Q+i*i,o={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:m.pointerId,type:C.type};this.onMultiTouch(this._pointA,this._pointB,Z,B,U,o),U=o,Z=B}}else{try{null===G||void 0===G||G.releasePointerCapture(m.pointerId)}catch(H){}O||(this._pointB=null),Q._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==m.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==m.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==Z||U)&&(this.onMultiTouch(this._pointA,this._pointB,Z,0,U,null),Z=0,U=null),this._currentMousePointerIdDown=-1,this.onButtonUp(m),k||m.preventDefault()}else{try{null===G||void 0===G||G.setPointerCapture(m.pointerId)}catch(H){}if(null===this._pointA)this._pointA={x:m.clientX,y:m.clientY,pointerId:m.pointerId,type:m.pointerType};else{if(null!==this._pointB)return;this._pointB={x:m.clientX,y:m.clientY,pointerId:m.pointerId,type:m.pointerType}}-1!==this._currentMousePointerIdDown||O||(this._currentMousePointerIdDown=m.pointerId),this.onButtonDown(m),k||(m.preventDefault(),i&&i.focus())}}},this._observer=this.camera.sk()._inputManager._addCameraPointerObserver(this._pointerInput,J.e.POINTERDOWN|J.e.POINTERUP|J.e.POINTERMOVE|J.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,Z=0,U=null,this.onLostFocus()},this._contextMenuBind=k=>this.onContextMenu(k),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);const C=this.camera.sk().getEngine().getHostWindow();C&&Y.Tools.RegisterTopRootEvents(C,[{name:"blur",handler:this._onLostFocus}])}LG(){if(this._onLostFocus){const k=this.camera.sk().getEngine().getHostWindow();k&&Y.Tools.UnregisterTopRootEvents(k,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.sk()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const k=this.camera.sk().getEngine().getInputElement();k&&k.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(k){}onTouch(k,Q,i){}onMultiTouch(k,Q,i,Z,U,C){}onContextMenu(k){k.preventDefault()}onButtonDown(k){}onButtonUp(k){}onLostFocus(){}}(0,Z.c)([(0,U.L)()],y.prototype,"buttons",void 0);class L extends y{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(k,Q){if(0!==this.panningSensibility&&k&&Q){const i=Q.x-k.x,Z=Q.y-k.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=Z/this.panningSensibility}}_computePinchZoom(k,Q){const i=this.camera.radius||L.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(k)/Math.sqrt(Q):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(Q-k)*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(Q-k)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(k,Q,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-Q/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=Q/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(k,Q,i,Z,U,C){0===i&&null===U||0===Z&&null===C||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,Z),this._computeMultiTouchPanning(U,C)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(Z)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,Z),this._isPinching=!0):this._computeMultiTouchPanning(U,C)):this.multiTouchPanning?this._computeMultiTouchPanning(U,C):this.pinchZoom&&this._computePinchZoom(i,Z))}onButtonDown(k){this._isPanClick=k.button===this.camera._panningMouseButton}onButtonUp(k){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}L.MinimumRadiusForPinch=.001,(0,Z.c)([(0,U.L)()],L.prototype,"buttons",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"angularSensibilityX",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"angularSensibilityY",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"pinchPrecision",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"pinchDeltaPercentage",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"useNaturalPinchZoom",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"pinchZoom",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"panningSensibility",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"multiTouchPanning",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"multiTouchPanAndZoom",void 0),f.c.ArcRotateCameraPointersInput=L;var s=i(11575);class u{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(k){k=Y.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.sk(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((Q=>{const i=Q.event;if(!i.metaKey)if(Q.type===s.e.KEYDOWN){if(this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&(k||i.preventDefault())}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){const Q=this._keys.indexOf(i.keyCode);Q>=0&&this._keys.splice(Q,1),i.preventDefault&&(k||i.preventDefault())}})))}LG(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const k=this.camera;for(let Q=0;Q<this._keys.length;Q++){const i=this._keys[Q];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?k.inertialPanningX-=1/this.panningSensibility:k.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?k.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?k.inertialRadiusOffset+=1/this.zoomingSensibility:k.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?k.inertialPanningX+=1/this.panningSensibility:k.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?k.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?k.inertialRadiusOffset-=1/this.zoomingSensibility:k.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&k.useInputToRestoreState&&k.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,Z.c)([(0,U.L)()],u.prototype,"keysUp",void 0),(0,Z.c)([(0,U.L)()],u.prototype,"keysDown",void 0),(0,Z.c)([(0,U.L)()],u.prototype,"keysLeft",void 0),(0,Z.c)([(0,U.L)()],u.prototype,"keysRight",void 0),(0,Z.c)([(0,U.L)()],u.prototype,"keysReset",void 0),(0,Z.c)([(0,U.L)()],u.prototype,"panningSensibility",void 0),(0,Z.c)([(0,U.L)()],u.prototype,"zoomingSensibility",void 0),(0,Z.c)([(0,U.L)()],u.prototype,"useAltToZoom",void 0),(0,Z.c)([(0,U.L)()],u.prototype,"angularSpeed",void 0),f.c.ArcRotateCameraKeyboardMoveInput=u;var a=i(11355),j=i(11581);class T{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new B.zQ(0,0,0),this._globalOffset=new B.zQ(0,0,0),this._inertialPanning=B.zQ.Zero()}_computeDeltaFromMouseWheelLegacyEvent(k,Q){let i=0;const Z=.01*k*this.wheelDeltaPercentage*Q;return i=k>0?Z/(1+this.wheelDeltaPercentage):Z*(1+this.wheelDeltaPercentage),i}attachControl(k){k=Y.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=Q=>{if(Q.type!==J.e.POINTERWHEEL)return;const i=Q.event;let Z=0;const U=i.deltaMode===j.c.DOM_DELTA_LINE?40:1,C=-i.deltaY*U;if(this.customComputeDeltaFromMouseWheel)Z=this.customComputeDeltaFromMouseWheel(C,this,i);else if(this.wheelDeltaPercentage){if(Z=this._computeDeltaFromMouseWheelLegacyEvent(C,this.camera.radius),Z>0){let k=this.camera.radius,Q=this.camera.inertialRadiusOffset+Z;for(let i=0;i<20&&!(k<=Q)&&!(Math.abs(Q*this.camera.inertia)<.001);i++)k-=Q,Q*=this.camera.inertia;k=(0,o.Clamp)(k,0,Number.MAX_VALUE),Z=this._computeDeltaFromMouseWheelLegacyEvent(C,k)}}else Z=C/(40*this.wheelPrecision);Z&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(Z)):this.camera.inertialRadiusOffset+=Z),i.preventDefault&&(k||i.preventDefault())},this._observer=this.camera.sk()._inputManager._addCameraPointerObserver(this._wheel,J.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.eo(0)}LG(){this._observer&&(this.camera.sk()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const k=this.camera;0+k.inertialAlphaOffset+k.inertialBetaOffset+k.inertialRadiusOffset&&(this._updateHitPlane(),k.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(k.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const k=this.camera,Q=k.target.EQ(k.position);this._hitPlane=a.b.FromPositionAndNormal(k.target,Q)}_getPosition(){const k=this.camera,Q=k.sk(),i=Q.createPickingRay(Q.pointerX,Q.pointerY,B.Matrix.Identity(),k,!1);0===k.targetScreenOffset.x&&0===k.targetScreenOffset.y||(this._viewOffset.set(k.targetScreenOffset.x,k.targetScreenOffset.y,0),k.getViewMatrix().invertToRef(k._cameraTransformMatrix),this._globalOffset=B.zQ.TransformNormal(this._viewOffset,k._cameraTransformMatrix),i.origin.addInPlace(this._globalOffset));let Z=0;return this._hitPlane&&(Z=i.intersectsPlane(this._hitPlane)??0),i.origin.addInPlace(i.direction.scaleInPlace(Z))}_zoomToMouse(k){const Q=this.camera,i=1-Q.inertia;if(Q.lowerRadiusLimit){const Z=Q.lowerRadiusLimit??0;Q.radius-(Q.inertialRadiusOffset+k)/i<Z&&(k=(Q.radius-Z)*i-Q.inertialRadiusOffset)}if(Q.upperRadiusLimit){const Z=Q.upperRadiusLimit??0;Q.radius-(Q.inertialRadiusOffset+k)/i>Z&&(k=(Q.radius-Z)*i-Q.inertialRadiusOffset)}const Z=k/i/Q.radius,U=this._getPosition(),C=B.TmpVectors.zQ[6];U.subtractToRef(Q.target,C),C.scaleInPlace(Z),C.scaleInPlace(i),this._inertialPanning.addInPlace(C),Q.inertialRadiusOffset+=k}_zeroIfClose(k){Math.abs(k.x)<H.e&&(k.x=0),Math.abs(k.y)<H.e&&(k.y=0),Math.abs(k.z)<H.e&&(k.z=0)}}(0,Z.c)([(0,U.L)()],T.prototype,"wheelPrecision",void 0),(0,Z.c)([(0,U.L)()],T.prototype,"zoomToMouseLocation",void 0),(0,Z.c)([(0,U.L)()],T.prototype,"wheelDeltaPercentage",void 0),f.c.ArcRotateCameraMouseWheelInput=T;class K extends f.g{constructor(k){super(k)}addMouseWheel(){return this.add(new T),this}addPointers(){return this.add(new L),this}addKeyboard(){return this.add(new u),this}}var v=i(11253);function N(k,Q){return isNaN(k)?Q:k}m.c.AddNodeConstructor("ArcRotateCamera",((k,Q)=>()=>new X(k,0,0,1,B.zQ.Zero(),Q)));class X extends c.c{get target(){return this._target}set target(k){this.setTarget(k)}get targetHost(){return this._targetHost}set targetHost(k){k&&this.setTarget(k)}getTarget(){return this.target}get position(){return this._position}set position(k){this.setPosition(k)}set upVector(k){this._upToYMatrix||(this._yToUpMatrix=new B.Matrix,this._upToYMatrix=new B.Matrix,this._upVector=B.zQ.Zero()),k.normalize(),this._upVector.B(k),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){B.Matrix.RotationAlignToRef(B.zQ.UpReadOnly,this._upVector,this._yToUpMatrix),B.Matrix.RotationAlignToRef(this._upVector,B.zQ.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const k=this.inputs.attached.pointers;return k?k.angularSensibilityX:0}set angularSensibilityX(k){const Q=this.inputs.attached.pointers;Q&&(Q.angularSensibilityX=k)}get angularSensibilityY(){const k=this.inputs.attached.pointers;return k?k.angularSensibilityY:0}set angularSensibilityY(k){const Q=this.inputs.attached.pointers;Q&&(Q.angularSensibilityY=k)}get pinchPrecision(){const k=this.inputs.attached.pointers;return k?k.pinchPrecision:0}set pinchPrecision(k){const Q=this.inputs.attached.pointers;Q&&(Q.pinchPrecision=k)}get pinchDeltaPercentage(){const k=this.inputs.attached.pointers;return k?k.pinchDeltaPercentage:0}set pinchDeltaPercentage(k){const Q=this.inputs.attached.pointers;Q&&(Q.pinchDeltaPercentage=k)}get useNaturalPinchZoom(){const k=this.inputs.attached.pointers;return!!k&&k.useNaturalPinchZoom}set useNaturalPinchZoom(k){const Q=this.inputs.attached.pointers;Q&&(Q.useNaturalPinchZoom=k)}get panningSensibility(){const k=this.inputs.attached.pointers;return k?k.panningSensibility:0}set panningSensibility(k){const Q=this.inputs.attached.pointers;Q&&(Q.panningSensibility=k)}get keysUp(){const k=this.inputs.attached.keyboard;return k?k.keysUp:[]}set keysUp(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysUp=k)}get keysDown(){const k=this.inputs.attached.keyboard;return k?k.keysDown:[]}set keysDown(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysDown=k)}get keysLeft(){const k=this.inputs.attached.keyboard;return k?k.keysLeft:[]}set keysLeft(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysLeft=k)}get keysRight(){const k=this.inputs.attached.keyboard;return k?k.keysRight:[]}set keysRight(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysRight=k)}get wheelPrecision(){const k=this.inputs.attached.mousewheel;return k?k.wheelPrecision:0}set wheelPrecision(k){const Q=this.inputs.attached.mousewheel;Q&&(Q.wheelPrecision=k)}get zoomToMouseLocation(){const k=this.inputs.attached.mousewheel;return!!k&&k.zoomToMouseLocation}set zoomToMouseLocation(k){const Q=this.inputs.attached.mousewheel;Q&&(Q.zoomToMouseLocation=k)}get wheelDeltaPercentage(){const k=this.inputs.attached.mousewheel;return k?k.wheelDeltaPercentage:0}set wheelDeltaPercentage(k){const Q=this.inputs.attached.mousewheel;Q&&(Q.wheelDeltaPercentage=k)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(k){k!==this.useBouncingBehavior&&(k?(this._bouncingBehavior=new E,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(k){k!==this.useFramingBehavior&&(k?(this._framingBehavior=new l,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(k){k!==this.useAutoRotationBehavior&&(k?(this._autoRotationBehavior=new e,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(k,Q,i,Z,U,o){var m;let O=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(k,B.zQ.Zero(),o,O),m=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=B.zQ.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=B.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new B.Matrix,this.panningAxis=new B.zQ(1,1,0),this._transformedDirection=new B.zQ,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new C.c,this.checkCollisions=!1,this.collisionRadius=new B.zQ(.5,.5,.5),this._previousPosition=B.zQ.Zero(),this._collisionVelocity=B.zQ.Zero(),this._newPosition=B.zQ.Zero(),this._computationVector=B.zQ.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new B.zQ(NaN,NaN,NaN),this._goalTargetScreenOffset=new B.Vector2(NaN,NaN),this._onCollisionPositionChange=function(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i?(m.setPosition(Q),m.Oe&&m.Oe(i)):m._previousPosition.B(m._position);const Z=Math.cos(m.alpha),U=Math.sin(m.alpha),C=Math.cos(m.beta);let B=Math.sin(m.beta);0===B&&(B=1e-4);const o=m._getTargetPosition();m._computationVector.Go(m.radius*Z*B,m.radius*C,m.radius*U*B),o.addToRef(m._computationVector,m._newPosition),m._position.B(m._newPosition);let O=m.upVector;m.allowUpsideDown&&m.beta<0&&(O=O.clone(),O=O.negate()),m._computeViewMatrix(m._position,o,O),m._viewMatrix.addAtIndex(12,m.targetScreenOffset.x),m._viewMatrix.addAtIndex(13,m.targetScreenOffset.y),m._collisionTriggered=!1},this._target=B.zQ.Zero(),U&&this.setTarget(U),this.alpha=Q,this.beta=i,this.radius=Z,this.getViewMatrix(),this.inputs=new K(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new B.zQ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=B.Vector2.Zero()}_updateCache(k){k||super._updateCache(),this._cache._target.B(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.B(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const k=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?k.addToRef(this._targetBoundingCenter,this._target):this._target.B(k)}const k=this._getLockedTargetPosition();return k||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>H.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,C=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=C?this._currentInterpolationFactor=C:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=N(k,this._goalAlpha),this._goalBeta=N(Q,this._goalBeta),this._goalRadius=N(i,this._goalRadius),this._goalTarget.set(N(Z.x,this._goalTarget.x),N(Z.y,this._goalTarget.y),N(Z.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(N(U.x,this._goalTargetScreenOffset.x),N(U.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,o.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,o.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,o.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,o.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(k,Q){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const U=arguments;Q=Y.Tools.BackCompatCameraNoPreventDefault(U),this._useCtrlForPanning=i,this._panningMouseButton=Z,"boolean"===typeof U[0]&&(U.length>1&&(this._useCtrlForPanning=U[1]),U.length>2&&(this._panningMouseButton=U[2])),this.inputs.attachElement(Q),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}LG(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let k=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){k=!0;const Q=this.invertRotation?-1:1,i=this._calculateHandednessMultiplier();let Z=this.inertialAlphaOffset*i;this.beta<0&&(Z*=-1),this.alpha+=Z*Q,this.beta+=this.inertialBetaOffset*Q,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<H.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<H.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*H.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){k=!0;const Q=new B.zQ(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),Q.multiplyInPlace(this.panningAxis),B.zQ.TransformNormalToRef(Q,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const k=this.upVector,Q=B.zQ.CrossToRef(this._transformedDirection,k,this._transformedDirection);B.zQ.CrossToRef(k,Q,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);B.zQ.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.B(this._transformedDirection)}else{if(this.parent){const k=B.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(k),k.transposeToRef(k),B.zQ.TransformCoordinatesToRef(this._transformedDirection,k,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*H.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*H.e&&(this.inertialPanningY=0)}if(k)this.stopInterpolation();else if(this._isInterpolating){let k=!1;const Q=this._scene.getEngine().getDeltaTime()/1e3,i=1-Math.pow(2,-Q/this._currentInterpolationFactor),Z=N(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const Q=B.TmpVectors.zQ[0].set(N(this._goalTarget.x,this._target.x),N(this._goalTarget.y,this._target.y),N(this._goalTarget.z,this._target.z));B.zQ.LerpToRef(this.target,Q,i,this._target),10*B.zQ.Distance(this.target,Q)/Z<H.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.B(Q),this.setTarget(this.target,!1,!0,!0)):k=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const Q=B.Quaternion.RotationAlphaBetaGammaToRef(N(this._goalAlpha,this.alpha),N(this._goalBeta,this.beta),0,B.TmpVectors.Quaternion[0]),Z=B.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,B.TmpVectors.Quaternion[1]),U=B.Quaternion.SlerpToRef(Z,Q,i,B.TmpVectors.Quaternion[2]);U.normalize();const C=U.toAlphaBetaGammaToRef(B.TmpVectors.zQ[0]);if(this.alpha=C.x,this.beta=C.y,U.isApprox(Q,H.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const k=Q.toAlphaBetaGammaToRef(B.TmpVectors.zQ[0]);this.alpha=k.x,this.beta=k.y}else k=!0}if(isNaN(this._goalRadius)||(this.radius+=(Z-this.radius)*i,Math.abs(Z/this.radius-1)<H.e?(this._goalRadius=NaN,this.radius=Z):k=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const Q=B.TmpVectors.Vector2[0].set(N(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),N(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));B.Vector2.LerpToRef(this.targetScreenOffset,Q,i,this.targetScreenOffset),B.Vector2.Distance(this.targetScreenOffset,Q)<H.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.B(Q)):k=!0}this._isInterpolating=k}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||B.zQ.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const k=this.alpha;var Q,i;this.alpha=function(k){let Q=Math.PI/2;return 0===k.x&&0===k.z||(Q=Math.acos(k.x/Math.sqrt(Math.pow(k.x,2)+Math.pow(k.z,2)))),k.z<0&&(Q=2*Math.PI-Q),Q}(this._computationVector),this.beta=(Q=this._computationVector.y,i=this.radius,Math.acos(Q/i));const Z=Math.round((k-this.alpha)/(2*Math.PI));this.alpha+=2*Z*Math.PI,this._checkLimits()}setPosition(k){this._position.equals(k)||(this._position.B(k),this.rebuildAnglesAndRadius())}setTarget(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Z=this.overrideCloneAlphaBetaRadius??Z,k.oo)Q&&k.getBoundingInfo?this._targetBoundingCenter=k.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,k.oo(),this._targetHost=k,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const Q=k,Z=this._getTargetPosition();if(Z&&!i&&Z.equals(Q))return;this._targetHost=null,this._target=Q,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}Z||this.rebuildAnglesAndRadius()}_getViewMatrix(){const k=Math.cos(this.alpha),Q=Math.sin(this.alpha),i=Math.cos(this.beta);let Z=Math.sin(this.beta);0===Z&&(Z=1e-4),0===this.radius&&(this.radius=1e-4);const U=this._getTargetPosition();if(this._computationVector.Go(this.radius*k*Z,this.radius*i,this.radius*Q*Z),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||B.zQ.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),U.addToRef(this._computationVector,this._newPosition),this.sk().collisionsEnabled&&this.checkCollisions){const k=this.sk().collisionCoordinator;this._collider||(this._collider=k.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,k.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.B(this._newPosition);let k=this.upVector;this.allowUpsideDown&&Z<0&&(k=k.negate()),this._computeViewMatrix(this._position,U,k),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.B(U),this._viewMatrix}zoomOn(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];k=k||this.sk().meshes;const i=O.d.MinMax(k);let Z=this._calculateLowerRadiusFromModelBoundingSphere(i.min,i.max);if(Z=Math.max(Math.min(Z,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=Z*this.zoomOnFactor,this.mode===h.e.ORTHOGRAPHIC_CAMERA){const k=this.sk().getEngine().getAspectRatio(this),Q=Z*this.zoomOnFactor/2;this.orthoLeft=-Q*k,this.orthoRight=Q*k,this.orthoBottom=-Q,this.orthoTop=Q}this.focusOn({min:i.min,max:i.max,distance:Z},Q)}focusOn(k){let Q,i,Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===k.min){const Z=k||this.sk().meshes;Q=O.d.MinMax(Z),i=B.zQ.Distance(Q.min,Q.max)}else{Q=k,i=k.distance}this._target=O.d.Center(Q),Z||(this.maxZ=2*i)}createRigCamera(k,Q){let i=0;switch(this.cameraRigMode){case h.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case h.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case h.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case h.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case h.e.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===Q?1:-1);break;case h.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===Q?-1:1)}const Z=new X(k,this.alpha+i,this.beta,this.radius,this._target,this.sk());return Z._cameraRigParams={},Z.isRigCamera=!0,Z.rigParent=this,Z.upVector=this.upVector,Z.mode=this.mode,Z.orthoLeft=this.orthoLeft,Z.orthoRight=this.orthoRight,Z.orthoBottom=this.orthoBottom,Z.orthoTop=this.orthoTop,Z}_updateRigCameras(){const k=this._rigCameras[0],Q=this._rigCameras[1];switch(k.beta=Q.beta=this.beta,this.cameraRigMode){case h.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case h.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case h.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case h.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case h.e.RIG_MODE_VR:k.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,Q.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case h.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:k.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,Q.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const Z=B.zQ.Distance(k,Q),U=this.sk().getEngine().getAspectRatio(this),C=Math.tan(this.fov/2),o=C*U,m=.5*Z*i,O=m*Math.sqrt(1+1/(o*o)),J=m*Math.sqrt(1+1/(C*C));return Math.max(O,J)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,Z.c)([(0,U.L)()],X.prototype,"alpha",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"beta",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"radius",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,Z.c)([(0,U.K)("target")],X.prototype,"_target",void 0),(0,Z.c)([(0,U.w)("targetHost")],X.prototype,"_targetHost",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"inertialAlphaOffset",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"inertialBetaOffset",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"inertialRadiusOffset",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"lowerAlphaLimit",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"upperAlphaLimit",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"lowerBetaLimit",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"upperBetaLimit",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"lowerRadiusLimit",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"upperRadiusLimit",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"lowerTargetYLimit",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"inertialPanningX",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"inertialPanningY",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"pinchToPanMaxDistance",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"panningDistanceLimit",void 0),(0,Z.c)([(0,U.K)()],X.prototype,"panningOriginTarget",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"panningInertia",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"zoomToMouseLocation",null),(0,Z.c)([(0,U.L)()],X.prototype,"zoomOnFactor",void 0),(0,Z.c)([(0,U.H)()],X.prototype,"targetScreenOffset",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"allowUpsideDown",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"useInputToRestoreState",void 0),(0,Z.c)([(0,U.L)()],X.prototype,"restoreStateInterpolationFactor",void 0),(0,v.e)("BABYLON.ArcRotateCamera",X)},12980:(k,Q,i)=>{"use strict";i.d(Q,{c:()=>B,g:()=>o});var Z=i(11134),U=i(11334),C=i(11740),B={};class o{constructor(k){this.attachedToElement=!1,this.attached={},this.camera=k,this.checkInputs=()=>{}}add(k){const Q=k.getSimpleName();this.attached[Q]?Z.c.Warn("camera input of type "+Q+" already exists on camera"):(this.attached[Q]=k,k.camera=this.camera,k.checkInputs&&(this.checkInputs=this._addCheckInputs(k.checkInputs.bind(k))),this.attachedToElement&&k.attachControl(this.noPreventDefault))}remove(k){for(const Q in this.attached){const i=this.attached[Q];if(i===k)return i.LG(),i.camera=null,delete this.attached[Q],void this.rebuildInputCheck()}}removeByType(k){for(const Q in this.attached){const i=this.attached[Q];i.getClassName()===k&&(i.LG(),i.camera=null,delete this.attached[Q],this.rebuildInputCheck())}}_addCheckInputs(k){const Q=this.checkInputs;return()=>{Q(),k()}}attachInput(k){this.attachedToElement&&k.attachControl(this.noPreventDefault)}attachElement(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){k=!C.e.ForceAttachControlToAlwaysPreventDefault&&k,this.attachedToElement=!0,this.noPreventDefault=k;for(const Q in this.attached)this.attached[Q].attachControl(k)}}detachElement(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const Q in this.attached)this.attached[Q].LG(),k&&(this.attached[Q].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const k in this.attached){const Q=this.attached[k];Q.checkInputs&&(this.checkInputs=this._addCheckInputs(Q.checkInputs.bind(Q)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(k){const Q={};for(const i in this.attached){const k=this.attached[i],Z=U.d.Serialize(k);Q[k.getClassName()]=Z}k.inputsmgr=Q}parse(k){const Q=k.inputsmgr;if(Q){this.clear();for(const k in Q){const i=B[k];if(i){const Z=Q[k],C=U.d.Parse((()=>new i),Z,null);this.add(C)}}}else for(const i in this.attached){const Q=B[this.attached[i].getClassName()];if(Q){const Z=U.d.Parse((()=>new Q),k,null);this.remove(this.attached[i]),this.add(Z)}}}}},12975:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>y});var Z=i(11280),U=i(11289),C=i(11298),B=i(11766),o=i(12980),m=i(11575),O=i(11119);class J{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(k){k=O.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.sk(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((Q=>{const i=Q.event;if(!i.metaKey)if(Q.type===m.e.KEYDOWN){if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),k||i.preventDefault()}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){const Q=this._keys.indexOf(i.keyCode);Q>=0&&this._keys.splice(Q,1),k||i.preventDefault()}})))}LG(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const k=this.camera;for(let Q=0;Q<this._keys.length;Q++){const i=this._keys[Q],Z=k._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?k._localDirection.Go(-Z,0,0):-1!==this.keysUp.indexOf(i)?k._localDirection.Go(0,0,Z):-1!==this.keysRight.indexOf(i)?k._localDirection.Go(Z,0,0):-1!==this.keysDown.indexOf(i)?k._localDirection.Go(0,0,-Z):-1!==this.keysUpward.indexOf(i)?k._localDirection.Go(0,Z,0):-1!==this.keysDownward.indexOf(i)?k._localDirection.Go(0,-Z,0):-1!==this.keysRotateLeft.indexOf(i)?(k._localDirection.Go(0,0,0),k.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(i)?(k._localDirection.Go(0,0,0),k.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(i)?(k._localDirection.Go(0,0,0),k.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(i)&&(k._localDirection.Go(0,0,0),k.cameraRotation.x+=this._getLocalRotation()),k.sk().useRightHandedSystem&&(k._localDirection.z*=-1),k.getViewMatrix().invertToRef(k._cameraTransformMatrix),C.zQ.TransformNormalToRef(k._localDirection,k._cameraTransformMatrix,k._transformedDirection),k.cameraDirection.addInPlace(k._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const k=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*k}}(0,Z.c)([(0,U.L)()],J.prototype,"keysUp",void 0),(0,Z.c)([(0,U.L)()],J.prototype,"keysUpward",void 0),(0,Z.c)([(0,U.L)()],J.prototype,"keysDown",void 0),(0,Z.c)([(0,U.L)()],J.prototype,"keysDownward",void 0),(0,Z.c)([(0,U.L)()],J.prototype,"keysLeft",void 0),(0,Z.c)([(0,U.L)()],J.prototype,"keysRight",void 0),(0,Z.c)([(0,U.L)()],J.prototype,"rotationSpeed",void 0),(0,Z.c)([(0,U.L)()],J.prototype,"keysRotateLeft",void 0),(0,Z.c)([(0,U.L)()],J.prototype,"keysRotateRight",void 0),(0,Z.c)([(0,U.L)()],J.prototype,"keysRotateUp",void 0),(0,Z.c)([(0,U.L)()],J.prototype,"keysRotateDown",void 0),o.c.FreeCameraKeyboardMoveInput=J;var G=i(11122),H=i(11572);class e{constructor(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=k,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new G.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(k){k=O.Tools.BackCompatCameraNoPreventDefault(arguments);const Q=this.camera.getEngine(),i=Q.getInputElement();this._pointerInput||(this._pointerInput=Z=>{const U=Z.event,C="touch"===U.pointerType;if(!this.touchEnabled&&C)return;if(Z.type!==H.e.POINTERMOVE&&-1===this.buttons.indexOf(U.button))return;const B=U.target;if(Z.type===H.e.POINTERDOWN){if(C&&-1!==this._activePointerId||!C&&-1!==this._currentActiveButton)return;this._activePointerId=U.pointerId;try{null===B||void 0===B||B.setPointerCapture(U.pointerId)}catch(o){}-1===this._currentActiveButton&&(this._currentActiveButton=U.button),this._previousPosition={x:U.clientX,y:U.clientY},k||(U.preventDefault(),i&&i.focus()),Q.isPointerLock&&this._onMouseMove&&this._onMouseMove(Z.event)}else if(Z.type===H.e.POINTERUP){if(C&&this._activePointerId!==U.pointerId||!C&&this._currentActiveButton!==U.button)return;try{null===B||void 0===B||B.releasePointerCapture(U.pointerId)}catch(o){}this._currentActiveButton=-1,this._previousPosition=null,k||U.preventDefault(),this._activePointerId=-1}else if(Z.type===H.e.POINTERMOVE&&(this._activePointerId===U.pointerId||!C))if(Q.isPointerLock&&this._onMouseMove)this._onMouseMove(Z.event);else if(this._previousPosition){const Q=this.camera._calculateHandednessMultiplier(),i=(U.clientX-this._previousPosition.x)*Q,Z=U.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=i/this.angularSensibility,this.camera.cameraRotation.x+=Z/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:i,offsetY:Z}),this._previousPosition={x:U.clientX,y:U.clientY},k||U.preventDefault()}}),this._onMouseMove=i=>{if(!Q.isPointerLock)return;const Z=this.camera._calculateHandednessMultiplier(),U=i.movementX*Z;this.camera.cameraRotation.y+=U/this.angularSensibility;const C=i.movementY;this.camera.cameraRotation.x+=C/this.angularSensibility,this._previousPosition=null,k||i.preventDefault()},this._observer=this.camera.sk()._inputManager._addCameraPointerObserver(this._pointerInput,H.e.POINTERDOWN|H.e.POINTERUP|H.e.POINTERMOVE),i&&(this._contextMenuBind=k=>this.onContextMenu(k),i.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(k){k.preventDefault()}LG(){if(this._observer){if(this.camera.sk()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const k=this.camera.getEngine().getInputElement();k&&k.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,Z.c)([(0,U.L)()],e.prototype,"buttons",void 0),(0,Z.c)([(0,U.L)()],e.prototype,"angularSensibility",void 0),o.c.FreeCameraMouseInput=e;var F,z=i(11581);class E{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new G.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(k){k=O.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=Q=>{if(Q.type!==H.e.POINTERWHEEL)return;const i=Q.event,Z=i.deltaMode===z.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*Z*i.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*Z*i.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*Z*i.deltaZ/this._normalize,i.preventDefault&&(k||i.preventDefault())},this._observer=this.camera.sk()._inputManager._addCameraPointerObserver(this._wheel,H.e.POINTERWHEEL)}LG(){this._observer&&(this.camera.sk()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,Z.c)([(0,U.L)()],E.prototype,"wheelPrecisionX",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"wheelPrecisionY",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"wheelPrecisionZ",void 0),function(k){k[k.MoveRelative=0]="MoveRelative",k[k.RotateRelative=1]="RotateRelative",k[k.MoveScene=2]="MoveScene"}(F||(F={}));class l extends E{constructor(){super(...arguments),this._moveRelative=C.zQ.Zero(),this._rotateRelative=C.zQ.Zero(),this._moveScene=C.zQ.Zero(),this._wheelXAction=F.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=F.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(k){null===k&&this._wheelXAction!==F.MoveRelative||(this._wheelXAction=F.MoveRelative,this._wheelXActionCoordinate=k)}get wheelXMoveRelative(){return this._wheelXAction!==F.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(k){null===k&&this._wheelYAction!==F.MoveRelative||(this._wheelYAction=F.MoveRelative,this._wheelYActionCoordinate=k)}get wheelYMoveRelative(){return this._wheelYAction!==F.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(k){null===k&&this._wheelZAction!==F.MoveRelative||(this._wheelZAction=F.MoveRelative,this._wheelZActionCoordinate=k)}get wheelZMoveRelative(){return this._wheelZAction!==F.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(k){null===k&&this._wheelXAction!==F.RotateRelative||(this._wheelXAction=F.RotateRelative,this._wheelXActionCoordinate=k)}get wheelXRotateRelative(){return this._wheelXAction!==F.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(k){null===k&&this._wheelYAction!==F.RotateRelative||(this._wheelYAction=F.RotateRelative,this._wheelYActionCoordinate=k)}get wheelYRotateRelative(){return this._wheelYAction!==F.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(k){null===k&&this._wheelZAction!==F.RotateRelative||(this._wheelZAction=F.RotateRelative,this._wheelZActionCoordinate=k)}get wheelZRotateRelative(){return this._wheelZAction!==F.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(k){null===k&&this._wheelXAction!==F.MoveScene||(this._wheelXAction=F.MoveScene,this._wheelXActionCoordinate=k)}get wheelXMoveScene(){return this._wheelXAction!==F.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(k){null===k&&this._wheelYAction!==F.MoveScene||(this._wheelYAction=F.MoveScene,this._wheelYActionCoordinate=k)}get wheelYMoveScene(){return this._wheelYAction!==F.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(k){null===k&&this._wheelZAction!==F.MoveScene||(this._wheelZAction=F.MoveScene,this._wheelZActionCoordinate=k)}get wheelZMoveScene(){return this._wheelZAction!==F.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.eo(0),this._rotateRelative.eo(0),this._moveScene.eo(0),this._updateCamera(),this.camera.sk().useRightHandedSystem&&(this._moveRelative.z*=-1);const k=C.Matrix.Zero();this.camera.getViewMatrix().invertToRef(k);const Q=C.zQ.Zero();C.zQ.TransformNormalToRef(this._moveRelative,k,Q),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(Q),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(k,Q,i){if(0===k)return;if(null===Q||null===i)return;let Z=null;switch(Q){case F.MoveRelative:Z=this._moveRelative;break;case F.RotateRelative:Z=this._rotateRelative;break;case F.MoveScene:Z=this._moveScene}switch(i){case 0:Z.set(k,0,0);break;case 1:Z.set(0,k,0);break;case 2:Z.set(0,0,k)}}}(0,Z.c)([(0,U.L)()],l.prototype,"wheelXMoveRelative",null),(0,Z.c)([(0,U.L)()],l.prototype,"wheelYMoveRelative",null),(0,Z.c)([(0,U.L)()],l.prototype,"wheelZMoveRelative",null),(0,Z.c)([(0,U.L)()],l.prototype,"wheelXRotateRelative",null),(0,Z.c)([(0,U.L)()],l.prototype,"wheelYRotateRelative",null),(0,Z.c)([(0,U.L)()],l.prototype,"wheelZRotateRelative",null),(0,Z.c)([(0,U.L)()],l.prototype,"wheelXMoveScene",null),(0,Z.c)([(0,U.L)()],l.prototype,"wheelYMoveScene",null),(0,Z.c)([(0,U.L)()],l.prototype,"wheelZMoveScene",null),o.c.FreeCameraMouseWheelInput=l;class h{constructor(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=k,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=O.Tools.IsSafari()}attachControl(k){k=O.Tools.BackCompatCameraNoPreventDefault(arguments);let Q=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=i=>{const Z=i.event,U="mouse"===Z.pointerType||this._isSafari&&"undefined"===typeof Z.pointerType;if(this.allowMouse||!U)if(i.type===H.e.POINTERDOWN){if(k||Z.preventDefault(),this._pointerPressed.push(Z.pointerId),1!==this._pointerPressed.length)return;Q={x:Z.clientX,y:Z.clientY}}else if(i.type===H.e.POINTERUP){k||Z.preventDefault();const i=this._pointerPressed.indexOf(Z.pointerId);if(-1===i)return;if(this._pointerPressed.splice(i,1),0!=i)return;Q=null,this._offsetX=null,this._offsetY=null}else if(i.type===H.e.POINTERMOVE){if(k||Z.preventDefault(),!Q)return;if(0!=this._pointerPressed.indexOf(Z.pointerId))return;this._offsetX=Z.clientX-Q.x,this._offsetY=-(Z.clientY-Q.y)}}),this._observer=this.camera.sk()._inputManager._addCameraPointerObserver(this._pointerInput,H.e.POINTERDOWN|H.e.POINTERUP|H.e.POINTERMOVE),this._onLostFocus){const k=this.camera.getEngine().getInputElement();k&&k.addEventListener("blur",this._onLostFocus)}}LG(){if(this._pointerInput){if(this._observer&&(this.camera.sk()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const k=this.camera.getEngine().getInputElement();k&&k.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const k=this.camera,Q=k._calculateHandednessMultiplier();k.cameraRotation.y=Q*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)k.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const Q=k._computeLocalCameraSpeed(),i=new C.zQ(0,0,0!==this.touchMoveSensibility?Q*this._offsetY/this.touchMoveSensibility:0);C.Matrix.RotationYawPitchRollToRef(k.rotation.y,k.rotation.x,0,k._cameraRotationMatrix),k.cameraDirection.addInPlace(C.zQ.TransformCoordinates(i,k._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,Z.c)([(0,U.L)()],h.prototype,"touchAngularSensibility",void 0),(0,Z.c)([(0,U.L)()],h.prototype,"touchMoveSensibility",void 0),o.c.FreeCameraTouchInput=h;class c extends o.g{constructor(k){super(k),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new J),this}addMouse(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new e(k),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new l,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new h),this}clear(){super.clear(),this._mouseInput=null}}var f=i(11253),Y=i(11195);class y extends B.c{get angularSensibility(){const k=this.inputs.attached.mouse;return k?k.angularSensibility:0}set angularSensibility(k){const Q=this.inputs.attached.mouse;Q&&(Q.angularSensibility=k)}get keysUp(){const k=this.inputs.attached.keyboard;return k?k.keysUp:[]}set keysUp(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysUp=k)}get keysUpward(){const k=this.inputs.attached.keyboard;return k?k.keysUpward:[]}set keysUpward(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysUpward=k)}get keysDown(){const k=this.inputs.attached.keyboard;return k?k.keysDown:[]}set keysDown(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysDown=k)}get keysDownward(){const k=this.inputs.attached.keyboard;return k?k.keysDownward:[]}set keysDownward(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysDownward=k)}get keysLeft(){const k=this.inputs.attached.keyboard;return k?k.keysLeft:[]}set keysLeft(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysLeft=k)}get keysRight(){const k=this.inputs.attached.keyboard;return k?k.keysRight:[]}set keysRight(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysRight=k)}get keysRotateLeft(){const k=this.inputs.attached.keyboard;return k?k.keysRotateLeft:[]}set keysRotateLeft(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysRotateLeft=k)}get keysRotateRight(){const k=this.inputs.attached.keyboard;return k?k.keysRotateRight:[]}set keysRotateRight(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysRotateRight=k)}get keysRotateUp(){const k=this.inputs.attached.keyboard;return k?k.keysRotateUp:[]}set keysRotateUp(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysRotateUp=k)}get keysRotateDown(){const k=this.inputs.attached.keyboard;return k?k.keysRotateDown:[]}set keysRotateDown(k){const Q=this.inputs.attached.keyboard;Q&&(Q.keysRotateDown=k)}constructor(k,Q,i){var Z;super(k,Q,i,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),Z=this,this.ellipsoid=new C.zQ(.5,1,.5),this.ellipsoidOffset=new C.zQ(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=C.zQ.Zero(),this._diffPosition=C.zQ.Zero(),this._newPosition=C.zQ.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z._newPosition.B(Q),Z._newPosition.subtractToRef(Z._oldPosition,Z._diffPosition),Z._diffPosition.length()>Y.b.CollisionsEpsilon&&(Z.position.addToRef(Z._diffPosition,Z._deferredPositionUpdate),Z._deferOnly?Z._deferredUpdated=!0:Z.position.B(Z._deferredPositionUpdate),Z.Oe&&i&&Z.Oe(i))},this.inputs=new c(this),this.inputs.addKeyboard().addMouse()}attachControl(k,Q){Q=O.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(Q)}LG(){this.inputs.detachElement(),this.cameraDirection=new C.zQ(0,0,0),this.cameraRotation=new C.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(k){this._collisionMask=isNaN(k)?-1:k}_collideWithWorld(k){let Q;Q=this.parent?C.zQ.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,Q.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const i=this.sk().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let Z=k;this.applyGravity&&(Z=k.add(this.sk().gravity)),i.getNewPosition(this._oldPosition,Z,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=C.zQ.Zero(),this._transformedDirection=C.zQ.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(k){this._needMoveForGravity=k}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.sk().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ee"}}(0,Z.c)([(0,U.K)()],y.prototype,"ellipsoid",void 0),(0,Z.c)([(0,U.K)()],y.prototype,"ellipsoidOffset",void 0),(0,Z.c)([(0,U.L)()],y.prototype,"checkCollisions",void 0),(0,Z.c)([(0,U.L)()],y.prototype,"applyGravity",void 0),(0,f.e)("BABYLON.FreeCamera",y)},13579:(k,Q,i)=>{"use strict";i.d(Q,{b:()=>C});var Z=i(11396),U=i(13582);class C{constructor(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=i,this.wJ=[],this._maxBlockCapacity=Q||64,this._selectionContent=new Z.d(1024),this._creationFunc=k}update(k,Q,i){U.e._CreateBlocks(k,Q,i,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}nO(k){for(let Q=0;Q<this.OJ.length;Q++){this.OJ[Q].addEntry(k)}}rO(k){for(let Q=0;Q<this.OJ.length;Q++){this.OJ[Q].removeEntry(k)}}select(k,Q){this._selectionContent.reset();for(let i=0;i<this.OJ.length;i++){this.OJ[i].select(k,this._selectionContent,Q)}return Q?this._selectionContent.concat(this.wJ):this._selectionContent.concatWithNoDuplicate(this.wJ),this._selectionContent}intersects(k,Q,i){this._selectionContent.reset();for(let Z=0;Z<this.OJ.length;Z++){this.OJ[Z].intersects(k,Q,this._selectionContent,i)}return i?this._selectionContent.concat(this.wJ):this._selectionContent.concatWithNoDuplicate(this.wJ),this._selectionContent}intersectsRay(k){this._selectionContent.reset();for(let Q=0;Q<this.OJ.length;Q++){this.OJ[Q].intersectsRay(k,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.wJ),this._selectionContent}}C.CreationFuncForMeshes=(k,Q)=>{const i=k.getBoundingInfo();!k.isBlocked&&i.boundingBox.intersectsMinMax(Q.IJ,Q.rJ)&&Q.entries.push(k)},C.CreationFuncForSubMeshes=(k,Q)=>{k.getBoundingInfo().boundingBox.intersectsMinMax(Q.IJ,Q.rJ)&&Q.entries.push(k)}},13582:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>C});var Z=i(11298),U=i(11633);class C{constructor(k,Q,i,Z,U,C){this.entries=[],this.nJ=new Array,this._capacity=i,this._depth=Z,this._maxDepth=U,this._creationFunc=C,this._minPoint=k,this._maxPoint=Q,this.nJ.push(k.clone()),this.nJ.push(Q.clone()),this.nJ.push(k.clone()),this.nJ[2].x=Q.x,this.nJ.push(k.clone()),this.nJ[3].y=Q.y,this.nJ.push(k.clone()),this.nJ[4].z=Q.z,this.nJ.push(Q.clone()),this.nJ[5].z=k.z,this.nJ.push(Q.clone()),this.nJ[6].x=k.x,this.nJ.push(Q.clone()),this.nJ[7].y=k.y}get yQ(){return this._capacity}get IJ(){return this._minPoint}get rJ(){return this._maxPoint}addEntry(k){if(this.OJ)for(let Q=0;Q<this.OJ.length;Q++){this.OJ[Q].addEntry(k)}else this._creationFunc(k,this),this.entries.length>this.yQ&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(k){if(this.OJ){for(let Q=0;Q<this.OJ.length;Q++){this.OJ[Q].removeEntry(k)}return}const Q=this.entries.indexOf(k);Q>-1&&this.entries.splice(Q,1)}addEntries(k){for(let Q=0;Q<k.length;Q++){const i=k[Q];this.addEntry(i)}}select(k,Q,i){if(U.c.IsInFrustum(this.nJ,k)){if(this.OJ){for(let Z=0;Z<this.OJ.length;Z++){this.OJ[Z].select(k,Q,i)}return}i?Q.concat(this.entries):Q.concatWithNoDuplicate(this.entries)}}intersects(k,Q,i,Z){if(U.c.IntersectsSphere(this._minPoint,this._maxPoint,k,Q)){if(this.OJ){for(let U=0;U<this.OJ.length;U++){this.OJ[U].intersects(k,Q,i,Z)}return}Z?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}}intersectsRay(k,Q){if(k.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.OJ){for(let i=0;i<this.OJ.length;i++){this.OJ[i].intersectsRay(k,Q)}return}Q.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){C._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(k,Q,i,U,B,o,m,O){m.OJ=new Array;const J=new Z.zQ((Q.x-k.x)/2,(Q.y-k.y)/2,(Q.z-k.z)/2);for(let Z=0;Z<2;Z++)for(let Q=0;Q<2;Q++)for(let G=0;G<2;G++){const H=k.add(J.multiplyByFloats(Z,Q,G)),e=k.add(J.multiplyByFloats(Z+1,Q+1,G+1)),F=new C(H,e,U,B+1,o,O);F.addEntries(i),m.OJ.push(F)}}}},13586:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>J});var Z=i(11538),U=i(11298),C=i(11712),B=i(12733),o=i(11567),m=i(13579),O=i(11157);Z.b.prototype.createOrUpdateSelectionOctree=function(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=this._getComponent(o.d.NAME_OCTREE);i||(i=new J(this),this.o(i)),this.gJ||(this.gJ=new m.b(m.b.CreationFuncForMeshes,k,Q));const Z=this.getWorldExtends();return this.gJ.update(Z.min,Z.max,this.meshes),this.gJ},Object.defineProperty(Z.b.prototype,"selectionOctree",{get:function(){return this.gJ},enumerable:!0,configurable:!0}),C.d.prototype.createOrUpdateSubmeshesOctree=function(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const i=this.sk();let Z=i._getComponent(o.d.NAME_OCTREE);Z||(Z=new J(i),i.o(Z)),this._submeshesOctree||(this._submeshesOctree=new m.b(m.b.CreationFuncForSubMeshes,k,Q)),this.oo(!0);const U=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(U.minimumWorld,U.maximumWorld,this.io),this._submeshesOctree};class J{constructor(k){this.name=o.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new B.e(U.zQ.Zero(),new U.zQ(1,1,1)),(k=k||O.b.LastCreatedScene)&&(this.lQ=k,this.lQ.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.lQ.getActiveSubMeshCandidates=k=>this.getActiveSubMeshCandidates(k),this.lQ.getCollidingSubMeshCandidates=(k,Q)=>this.getCollidingSubMeshCandidates(k,Q),this.lQ.getIntersectingSubMeshCandidates=(k,Q)=>this.getIntersectingSubMeshCandidates(k,Q))}register(){this.lQ.onMeshRemovedObservable.add((k=>{const Q=this.lQ.selectionOctree;if(void 0!==Q&&null!==Q){const i=Q.wJ.indexOf(k);-1!==i&&Q.wJ.splice(i,1)}})),this.lQ.onMeshImportedObservable.add((k=>{const Q=this.lQ.selectionOctree;void 0!==Q&&null!==Q&&Q.nO(k)}))}getActiveMeshCandidates(){var k;return(null===(k=this.lQ.gJ)||void 0===k?void 0:k.select(this.lQ.frustumPlanes))||this.lQ._getDefaultMeshCandidates()}getActiveSubMeshCandidates(k){if(k._submeshesOctree&&k.useOctreeForRenderingSelection){return k._submeshesOctree.select(this.lQ.frustumPlanes)}return this.lQ._getDefaultSubMeshCandidates(k)}getIntersectingSubMeshCandidates(k,Q){if(k._submeshesOctree&&k.useOctreeForPicking){B.e.TransformToRef(Q,k.getWorldMatrix(),this._tempRay);return k._submeshesOctree.intersectsRay(this._tempRay)}return this.lQ._getDefaultSubMeshCandidates(k)}getCollidingSubMeshCandidates(k,Q){if(k._submeshesOctree&&k.useOctreeForCollisions){const i=Q._velocityWorldLength+Math.max(Q._radius.x,Q._radius.y,Q._radius.z);return k._submeshesOctree.intersects(Q._basePointWorld,i)}return this.lQ._getDefaultSubMeshCandidates(k)}rebuild(){}dispose(){}}},12733:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>e});var Z=i(11538),U=i(11740),C=i(11304),B=i(11298),o=i(11307),m=i(11625),O=i(11562),J=i(11157),G=i(11584);const H={internalPickerForMesh:void 0};class e{constructor(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.e;this.origin=k,this.direction=Q,this.length=i,this.epsilon=Z}clone(){return new e(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const Z=e._TmpVector3[0].Go(k.x-i,k.y-i,k.z-i),U=e._TmpVector3[1].Go(Q.x+i,Q.y+i,Q.z+i);let C,B,o,m,O=0,J=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<Z.x||this.origin.x>U.x)return!1}else if(C=1/this.direction.x,B=(Z.x-this.origin.x)*C,o=(U.x-this.origin.x)*C,o===-1/0&&(o=1/0),B>o&&(m=B,B=o,o=m),O=Math.max(B,O),J=Math.min(o,J),O>J)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<Z.y||this.origin.y>U.y)return!1}else if(C=1/this.direction.y,B=(Z.y-this.origin.y)*C,o=(U.y-this.origin.y)*C,o===-1/0&&(o=1/0),B>o&&(m=B,B=o,o=m),O=Math.max(B,O),J=Math.min(o,J),O>J)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<Z.z||this.origin.z>U.z)return!1}else if(C=1/this.direction.z,B=(Z.z-this.origin.z)*C,o=(U.z-this.origin.z)*C,o===-1/0&&(o=1/0),B>o&&(m=B,B=o,o=m),O=Math.max(B,O),J=Math.min(o,J),O>J)return!1;return!0}intersectsBox(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(k.minimum,k.maximum,Q)}intersectsSphere(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=k.center.x-this.origin.x,Z=k.center.y-this.origin.y,U=k.center.z-this.origin.z,C=i*i+Z*Z+U*U,B=k.radius+Q,o=B*B;if(C<=o)return!0;const m=i*this.direction.x+Z*this.direction.y+U*this.direction.z;if(m<0)return!1;return C-m*m<=o}intersectsTriangle(k,Q,i){const Z=e._TmpVector3[0],U=e._TmpVector3[1],C=e._TmpVector3[2],o=e._TmpVector3[3],O=e._TmpVector3[4];Q.subtractToRef(k,Z),i.subtractToRef(k,U),B.zQ.CrossToRef(this.direction,U,C);const J=B.zQ.Dot(Z,C);if(0===J)return null;const G=1/J;this.origin.subtractToRef(k,o);const H=B.zQ.Dot(o,C)*G;if(H<-this.epsilon||H>1+this.epsilon)return null;B.zQ.CrossToRef(o,Z,O);const F=B.zQ.Dot(this.direction,O)*G;if(F<-this.epsilon||H+F>1+this.epsilon)return null;const z=B.zQ.Dot(U,O)*G;return z>this.length?null:new m.e(1-H-F,H,z)}intersectsPlane(k){let Q;const i=B.zQ.Dot(k.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;{const Z=B.zQ.Dot(k.normal,this.origin);return Q=(-k.d-Z)/i,Q<0?Q<-9.99999997475243e-7?null:0:Q}}intersectsAxis(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(k){case"y":{const k=(this.origin.y-Q)/this.direction.y;return k>0?null:new B.zQ(this.origin.x+this.direction.x*-k,Q,this.origin.z+this.direction.z*-k)}case"x":{const k=(this.origin.x-Q)/this.direction.x;return k>0?null:new B.zQ(Q,this.origin.y+this.direction.y*-k,this.origin.z+this.direction.z*-k)}case"z":{const k=(this.origin.z-Q)/this.direction.z;return k>0?null:new B.zQ(this.origin.x+this.direction.x*-k,this.origin.y+this.direction.y*-k,Q)}default:return null}}intersectsMesh(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=B.TmpVectors.Matrix[0];return k.getWorldMatrix().invertToRef(o),this._tmpRay?e.TransformToRef(this,o,this._tmpRay):this._tmpRay=e.Transform(this,o),k.intersects(this._tmpRay,Q,i,Z,U,C)}intersectsMeshes(k,Q,i){i?i.length=0:i=[];for(let Z=0;Z<k.length;Z++){const U=this.intersectsMesh(k[Z],Q);U.hit&&i.push(U)}return i.sort(this._comparePickingInfo),i}_comparePickingInfo(k,Q){return k.distance<Q.distance?-1:k.distance>Q.distance?1:0}intersectionSegment(k,Q,i){const Z=this.origin,U=B.TmpVectors.zQ[0],C=B.TmpVectors.zQ[1],o=B.TmpVectors.zQ[2],m=B.TmpVectors.zQ[3];Q.subtractToRef(k,U),this.direction.scaleToRef(e._Rayl,o),Z.addToRef(o,C),k.subtractToRef(Z,m);const O=B.zQ.Dot(U,U),J=B.zQ.Dot(U,o),G=B.zQ.Dot(o,o),H=B.zQ.Dot(U,m),F=B.zQ.Dot(o,m),z=O*G-J*J;let E,l,h=z,c=z;z<e._Smallnum?(E=0,h=1,l=F,c=G):(E=J*F-G*H,l=O*F-J*H,E<0?(E=0,l=F,c=G):E>h&&(E=h,l=F+J,c=G)),l<0?(l=0,-H<0?E=0:-H>O?E=h:(E=-H,h=O)):l>c&&(l=c,-H+J<0?E=0:-H+J>O?E=h:(E=-H+J,h=O));const f=Math.abs(E)<e._Smallnum?0:E/h,Y=Math.abs(l)<e._Smallnum?0:l/c,y=B.TmpVectors.zQ[4];o.scaleToRef(Y,y);const L=B.TmpVectors.zQ[5];U.scaleToRef(f,L),L.addInPlace(m);const s=B.TmpVectors.zQ[6];L.subtractToRef(y,s);return Y>0&&Y<=this.length&&s.lengthSquared()<i*i?L.length():-1}update(k,Q,i,Z,U,C,o){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){e._RayDistant||(e._RayDistant=e.Zero()),e._RayDistant.unprojectRayToRef(k,Q,i,Z,B.Matrix.IdentityReadOnly,C,o);const m=B.TmpVectors.Matrix[0];U.invertToRef(m),e.TransformToRef(e._RayDistant,m,this)}else this.unprojectRayToRef(k,Q,i,Z,U,C,o);return this}static Zero(){return new e(B.zQ.Zero(),B.zQ.Zero())}static CreateNew(k,Q,i,Z,U,C,B){return e.Zero().update(k,Q,i,Z,U,C,B)}static CreateNewFromTo(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.Matrix.IdentityReadOnly;const Z=new e(new B.zQ(0,0,0),new B.zQ(0,0,0));return e.CreateFromToToRef(k,Q,Z,i)}static CreateFromToToRef(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.Matrix.IdentityReadOnly;i.origin.B(k);const U=Q.subtractToRef(k,i.direction),C=Math.sqrt(U.x*U.x+U.y*U.y+U.z*U.z);return i.length=C,i.direction.normalize(),e.TransformToRef(i,Z,i)}static Transform(k,Q){const i=new e(new B.zQ(0,0,0),new B.zQ(0,0,0));return e.TransformToRef(k,Q,i),i}static TransformToRef(k,Q,i){B.zQ.TransformCoordinatesToRef(k.origin,Q,i.origin),B.zQ.TransformNormalToRef(k.direction,Q,i.direction),i.length=k.length,i.epsilon=k.epsilon;const Z=i.direction,U=Z.length();if(0!==U&&1!==U){const k=1/U;Z.x*=k,Z.y*=k,Z.z*=k,i.length*=U}return i}unprojectRayToRef(k,Q,i,Z,U,C,o){const m=B.TmpVectors.Matrix[0];U.multiplyToRef(C,m),m.multiplyToRef(o,m),m.invert();const O=J.b.LastCreatedEngine,G=B.TmpVectors.zQ[0];G.x=k/i*2-1,G.y=-(Q/Z*2-1),G.z=null!==O&&void 0!==O&&O.useReverseDepthBuffer?1:null!==O&&void 0!==O&&O.isNDCHalfZRange?0:-1;const H=B.TmpVectors.zQ[1].Go(G.x,G.y,1-1e-8),e=B.TmpVectors.zQ[2],F=B.TmpVectors.zQ[3];B.zQ._UnprojectFromInvertedMatrixToRef(G,m,e),B.zQ._UnprojectFromInvertedMatrixToRef(H,m,F),this.origin.B(e),F.subtractToRef(e,this.direction),this.direction.normalize()}}function F(k,Q,i,Z,U){let C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const B=e.Zero();return z(k,Q,i,Z,B,U,C),B}function z(k,Q,i,Z,U,C){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const O=k.getEngine();if(!C&&!(C=k.activeCamera))return k;const J=C.viewport,G=O.getRenderHeight(),{x:H,y:e,width:F,height:z}=J.toGlobal(O.getRenderWidth(),G),E=1/O.getHardwareScalingLevel();return Q=Q*E-H,i=i*E-(G-e-z),U.update(Q,i,F,z,Z||B.Matrix.IdentityReadOnly,o?B.Matrix.IdentityReadOnly:C.getViewMatrix(),C.getProjectionMatrix(),m),k}function E(k,Q,i,Z,U){if(!O.e)return k;const C=k.getEngine();if(!U&&!(U=k.activeCamera))throw new Error("Active camera not set");const o=U.viewport,m=C.getRenderHeight(),{x:J,y:G,width:H,height:e}=o.toGlobal(C.getRenderWidth(),m),F=B.Matrix.Identity(),z=1/C.getHardwareScalingLevel();return Q=Q*z-J,i=i*z-(m-G-e),Z.update(Q,i,H,e,F,F,U.getProjectionMatrix()),k}function l(k,Q,i,Z,U,C,B,o){const m=Q(Z,i.enableDistantPicking),O=i.intersects(m,U,B,C,Z,o);return O&&O.hit?!U&&null!=k&&O.distance>=k.distance?null:O:null}function h(k,Q,i,Z,U,C){let o=null;const m=!!(k.activeCameras&&k.activeCameras.length>1&&k.cameraToUseForPointers!==k.activeCamera),J=k.cameraToUseForPointers||k.activeCamera,G=H.internalPickerForMesh||l;for(let O=0;O<k.meshes.length;O++){const H=k.meshes[O];if(i){if(!i(H,-1))continue}else if(!H.isEnabled()||!H.isVisible||!H.pm)continue;const e=m&&H.isWorldMatrixCameraDependent(),F=H.oo(e,J);if(H.hasThinInstances&&H.eO){const k=G(o,Q,H,F,!0,!0,C);if(k){if(U)return k;const m=B.TmpVectors.Matrix[1],O=H.thinInstanceGetWorldMatrices();for(let k=0;k<O.length;k++){if(i&&!i(H,k))continue;O[k].multiplyToRef(F,m);const B=G(o,Q,H,m,Z,U,C,!0);if(B&&(o=B,o.thinInstanceIndex=k,Z))return o}}}else{const k=G(o,Q,H,F,Z,U,C);if(k&&(o=k,Z))return o}}return o||new O.e}function c(k,Q,i,Z){if(!O.e)return null;const U=[],C=!!(k.activeCameras&&k.activeCameras.length>1&&k.cameraToUseForPointers!==k.activeCamera),o=k.cameraToUseForPointers||k.activeCamera,m=H.internalPickerForMesh||l;for(let O=0;O<k.meshes.length;O++){const J=k.meshes[O];if(i){if(!i(J,-1))continue}else if(!J.isEnabled()||!J.isVisible||!J.pm)continue;const G=C&&J.isWorldMatrixCameraDependent(),H=J.oo(G,o);if(J.hasThinInstances&&J.eO){if(m(null,Q,J,H,!0,!0,Z)){const k=B.TmpVectors.Matrix[1],C=J.thinInstanceGetWorldMatrices();for(let B=0;B<C.length;B++){if(i&&!i(J,B))continue;C[B].multiplyToRef(H,k);const o=m(null,Q,J,k,!1,!1,Z,!0);o&&(o.thinInstanceIndex=B,U.push(o))}}}else{const k=m(null,Q,J,H,!1,!1,Z);k&&U.push(k)}}return U}function f(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,Z=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0;Z||(Z=k.getWorldMatrix()),Q.length=i,U?Q.origin.B(U):Q.origin.B(k.position);const C=B.TmpVectors.zQ[2];C.set(0,0,k._scene.useRightHandedSystem?-1:1);const o=B.TmpVectors.zQ[3];return B.zQ.TransformNormalToRef(C,Z,o),B.zQ.NormalizeToRef(o,Q.direction),Q}var Y,y;e._TmpVector3=(0,o.c)(6,B.zQ.Zero),e._RayDistant=e.Zero(),e._Smallnum=1e-8,e._Rayl=1e9,Y=Z.b,(y=U.e)&&(y.prototype.getForwardRay=function(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,Q=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return f(this,new e(B.zQ.Zero(),B.zQ.Zero(),k),k,Q,i)},y.prototype.getForwardRayToRef=function(k){return f(this,k,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),Y&&(G.b._IsPickingAvailable=!0,Y.prototype.createPickingRay=function(k,Q,i,Z){return F(this,k,Q,i,Z,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),Z.b.prototype.createPickingRayToRef=function(k,Q,i,Z,U){return z(this,k,Q,i,Z,U,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},Z.b.prototype.createPickingRayInCameraSpace=function(k,Q,i){return function(k,Q,i,Z){const U=e.Zero();return E(k,Q,i,U,Z),U}(this,k,Q,i)},Z.b.prototype.createPickingRayInCameraSpaceToRef=function(k,Q,i,Z){return E(this,k,Q,i,Z)},Z.b.prototype.pickWithBoundingInfo=function(k,Q,i,Z,U){return function(k,Q,i,Z,U,C){if(!O.e)return null;const o=h(k,(Z=>(k._tempPickingRay||(k._tempPickingRay=e.Zero()),z(k,Q,i,Z,k._tempPickingRay,C||null),k._tempPickingRay)),Z,U,!0);return o&&(o.ray=F(k,Q,i,B.Matrix.Identity(),C||null)),o}(this,k,Q,i,Z,U)},Z.b.prototype.zi=function(k,Q,i,Z,U,C){return function(k,Q,i,Z,U,C,o){const m=h(k,((Z,U)=>(k._tempPickingRay||(k._tempPickingRay=e.Zero()),z(k,Q,i,Z,k._tempPickingRay,C||null,!1,U),k._tempPickingRay)),Z,U,!1,o);return m&&(m.ray=F(k,Q,i,B.Matrix.Identity(),C||null)),m}(this,k,Q,i,Z,U,C)},Z.b.prototype.pickWithRay=function(k,Q,i,Z){return function(k,Q,i,Z,U){const C=h(k,(i=>(k._pickWithRayInverseMatrix||(k._pickWithRayInverseMatrix=B.Matrix.Identity()),i.invertToRef(k._pickWithRayInverseMatrix),k._cachedRayForTransform||(k._cachedRayForTransform=e.Zero()),e.TransformToRef(Q,k._pickWithRayInverseMatrix,k._cachedRayForTransform),k._cachedRayForTransform)),i,Z,!1,U);return C&&(C.ray=Q),C}(this,k,Q,i,Z)},Z.b.prototype.multiPick=function(k,Q,i,Z,U){return function(k,Q,i,Z,U,C){return c(k,(Z=>F(k,Q,i,Z,U||null)),Z,C)}(this,k,Q,i,Z,U)},Z.b.prototype.multiPickWithRay=function(k,Q,i){return function(k,Q,i,Z){return c(k,(i=>(k._pickWithRayInverseMatrix||(k._pickWithRayInverseMatrix=B.Matrix.Identity()),i.invertToRef(k._pickWithRayInverseMatrix),k._cachedRayForTransform||(k._cachedRayForTransform=e.Zero()),e.TransformToRef(Q,k._pickWithRayInverseMatrix,k._cachedRayForTransform),k._cachedRayForTransform)),i,Z)}(this,k,Q,i)}},13030:(k,Q,i)=>{"use strict";var Z=i(11235),U=i(11134),C=i(11163),B=i(11255),o=i(11195),m=i(11245);o.b.prototype._partialLoadFile=function(k,Q,i,Z){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(k,(k=>{i[Q]=k,i._internalCount++,6===i._internalCount&&Z(i)}),void 0,void 0,!0,((k,Q)=>{U&&k&&U(k.status+" "+k.statusText,Q)}))},o.b.prototype._cascadeLoadFiles=function(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const U=[];U._internalCount=0;for(let C=0;C<6;C++)this._partialLoadFile(i[C],C,U,Q,Z)},o.b.prototype._cascadeLoadImgs=function(k,Q,i,Z){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5?arguments[5]:void 0;const B=[];B._internalCount=0;for(let o=0;o<6;o++)this._partialLoadImg(Z[o],o,B,k,Q,i,U,C)},o.b.prototype._partialLoadImg=function(k,Q,i,Z,U,o){let m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7?arguments[7]:void 0;const J=(0,B.b)();(0,C.r)(k,(k=>{i[Q]=k,i._internalCount++,Z&&Z.removePendingData(J),6===i._internalCount&&o&&o(U,i)}),((k,Q)=>{Z&&Z.removePendingData(J),m&&m(k,Q)}),Z?Z.offlineProvider:null,O),Z&&Z.addPendingData(J)},o.b.prototype.createCubeTextureBase=function(k,Q,i,C){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6?arguments[6]:void 0,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]&&arguments[8],H=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,E=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,l=arguments.length>14&&void 0!==arguments[14]&&arguments[14],h=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const c=F||new Z.c(this,7);c.isCube=!0,c.url=k,c.generateMipMaps=!C,c._lodGenerationScale=H,c._lodGenerationOffset=e,c._useSRGBBuffer=!!l&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!C),c!==F&&(c.label=k.substring(0,60)),this._doNotHandleContextLost||(c._extension=J,c._files=i,c._buffer=h);const f=k;this._transformTextureUrl&&!F&&(k=this._transformTextureUrl(k));const Y=J??function(k){const Q=k.split("?")[0],i=Q.lastIndexOf(".");return i>-1?Q.substring(i).toLowerCase():""}(k),y=(0,m.b)(Y),L=(k,Q)=>{c.dispose(),o?o(k,Q):k&&U.c.Warn(k)},s=(Z,o)=>{k===f?Z&&L(Z.status+" "+Z.statusText,o):(U.c.Warn(`Failed to load ${k}, falling back to the ${f}`),this.createCubeTextureBase(f,Q,i,!!C,B,L,O,J,G,H,e,c,z,E,l,h))};if(y)y.then((Z=>{const U=k=>{z&&z(c,k),Z.loadCubeData(k,c,G,B,((k,Q)=>{L(k,Q)}))};h?U(h):i&&6===i.length?Z.supportCascades?this._cascadeLoadFiles(Q,(k=>U(k.map((k=>new Uint8Array(k))))),i,L):L("Textures type does not support cascades."):this._loadFile(k,(k=>U(new Uint8Array(k))),void 0,void 0,!0,s)}));else{if(!i||0===i.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(Q,c,((k,Q)=>{E&&E(k,Q)}),i,L)}return this._internalTexturesCache.push(c),c}},13592:(k,Q,i)=>{"use strict";i(11134);var Z=i(11428);i(11235),i(11381),i(11230),i(11473),i(11438);Z.b},13060:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>U});var Z=i(11253);class U{constructor(k){this.value=this._toInt(k)}_toInt(k){return 0|k}add(k){return new U(this.value+k.value)}EQ(k){return new U(this.value-k.value)}multiply(k){return new U(Math.imul(this.value,k.value))}divide(k){return new U(this.value/k.value)}getClassName(){return U.ClassName}equals(k){return this.value===k.value}static FromValue(k){return new U(k)}toString(){return this.value.toString()}}U.ClassName="FlowGraphInteger",(0,Z.e)("FlowGraphInteger",U)},13066:(k,Q,i)=>{"use strict";i.d(Q,{b:()=>U,e:()=>C});var Z=i(11298);class U{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.ri=k}get m(){return this.ri}transformVector(k){return this.transformVectorToRef(k,new Z.Vector2)}transformVectorToRef(k,Q){return Q.x=k.x*this.ri[0]+k.y*this.ri[1],Q.y=k.x*this.ri[2]+k.y*this.ri[3],Q}Zo(){return this.toArray()}toArray(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let Q=0;Q<4;Q++)k[Q]=this.ri[Q];return k}Ei(k){for(let Q=0;Q<4;Q++)this.ri[Q]=k[Q];return this}multiplyToRef(k,Q){const i=k.ri,Z=this.ri,U=Q.ri;return U[0]=i[0]*Z[0]+i[1]*Z[2],U[1]=i[0]*Z[1]+i[1]*Z[3],U[2]=i[2]*Z[0]+i[3]*Z[2],U[3]=i[2]*Z[1]+i[3]*Z[3],Q}multiply(k){return this.multiplyToRef(k,new U)}divideToRef(k,Q){const i=this.ri,Z=k.ri,U=Q.ri;return U[0]=i[0]/Z[0],U[1]=i[1]/Z[1],U[2]=i[2]/Z[2],U[3]=i[3]/Z[3],Q}divide(k){return this.divideToRef(k,new U)}addToRef(k,Q){const i=this.ri,Z=k.m,U=Q.m;return U[0]=i[0]+Z[0],U[1]=i[1]+Z[1],U[2]=i[2]+Z[2],U[3]=i[3]+Z[3],Q}add(k){return this.addToRef(k,new U)}subtractToRef(k,Q){const i=this.ri,Z=k.m,U=Q.m;return U[0]=i[0]-Z[0],U[1]=i[1]-Z[1],U[2]=i[2]-Z[2],U[3]=i[3]-Z[3],Q}EQ(k){return this.subtractToRef(k,new U)}transpose(){const k=this.ri;return new U([k[0],k[2],k[1],k[3]])}determinant(){const k=this.ri;return k[0]*k[3]-k[1]*k[2]}inverse(){const k=this.determinant();if(0===k)throw new Error("Matrix is not invertible");const Q=this.ri,i=1/k;return new U([Q[3]*i,-Q[1]*i,-Q[2]*i,Q[0]*i])}equals(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.ri,Z=k.m;return 0===Q?i[0]===Z[0]&&i[1]===Z[1]&&i[2]===Z[2]&&i[3]===Z[3]:Math.abs(i[0]-Z[0])<Q&&Math.abs(i[1]-Z[1])<Q&&Math.abs(i[2]-Z[2])<Q&&Math.abs(i[3]-Z[3])<Q}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.ri.join(", ")})`}}class C{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.ri=k}get m(){return this.ri}transformVector(k){return this.transformVectorToRef(k,new Z.zQ)}transformVectorToRef(k,Q){const i=this.ri;return Q.x=k.x*i[0]+k.y*i[1]+k.z*i[2],Q.y=k.x*i[3]+k.y*i[4]+k.z*i[5],Q.z=k.x*i[6]+k.y*i[7]+k.z*i[8],Q}multiplyToRef(k,Q){const i=k.ri,Z=this.ri,U=Q.m;return U[0]=i[0]*Z[0]+i[1]*Z[3]+i[2]*Z[6],U[1]=i[0]*Z[1]+i[1]*Z[4]+i[2]*Z[7],U[2]=i[0]*Z[2]+i[1]*Z[5]+i[2]*Z[8],U[3]=i[3]*Z[0]+i[4]*Z[3]+i[5]*Z[6],U[4]=i[3]*Z[1]+i[4]*Z[4]+i[5]*Z[7],U[5]=i[3]*Z[2]+i[4]*Z[5]+i[5]*Z[8],U[6]=i[6]*Z[0]+i[7]*Z[3]+i[8]*Z[6],U[7]=i[6]*Z[1]+i[7]*Z[4]+i[8]*Z[7],U[8]=i[6]*Z[2]+i[7]*Z[5]+i[8]*Z[8],Q}multiply(k){return this.multiplyToRef(k,new C)}divideToRef(k,Q){const i=this.ri,Z=k.m,U=Q.m;return U[0]=i[0]/Z[0],U[1]=i[1]/Z[1],U[2]=i[2]/Z[2],U[3]=i[3]/Z[3],U[4]=i[4]/Z[4],U[5]=i[5]/Z[5],U[6]=i[6]/Z[6],U[7]=i[7]/Z[7],U[8]=i[8]/Z[8],Q}divide(k){return this.divideToRef(k,new C)}addToRef(k,Q){const i=this.ri,Z=k.m,U=Q.m;return U[0]=i[0]+Z[0],U[1]=i[1]+Z[1],U[2]=i[2]+Z[2],U[3]=i[3]+Z[3],U[4]=i[4]+Z[4],U[5]=i[5]+Z[5],U[6]=i[6]+Z[6],U[7]=i[7]+Z[7],U[8]=i[8]+Z[8],Q}add(k){return this.addToRef(k,new C)}subtractToRef(k,Q){const i=this.ri,Z=k.m,U=Q.m;return U[0]=i[0]-Z[0],U[1]=i[1]-Z[1],U[2]=i[2]-Z[2],U[3]=i[3]-Z[3],U[4]=i[4]-Z[4],U[5]=i[5]-Z[5],U[6]=i[6]-Z[6],U[7]=i[7]-Z[7],U[8]=i[8]-Z[8],Q}EQ(k){return this.subtractToRef(k,new C)}toArray(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let Q=0;Q<9;Q++)k[Q]=this.ri[Q];return k}Zo(){return this.toArray()}Ei(k){for(let Q=0;Q<9;Q++)this.ri[Q]=k[Q];return this}transpose(){const k=this.ri;return new C([k[0],k[3],k[6],k[1],k[4],k[7],k[2],k[5],k[8]])}determinant(){const k=this.ri;return k[0]*(k[4]*k[8]-k[5]*k[7])-k[1]*(k[3]*k[8]-k[5]*k[6])+k[2]*(k[3]*k[7]-k[4]*k[6])}inverse(){const k=this.determinant();if(0===k)throw new Error("Matrix is not invertible");const Q=this.ri,i=1/k;return new C([(Q[4]*Q[8]-Q[5]*Q[7])*i,(Q[2]*Q[7]-Q[1]*Q[8])*i,(Q[1]*Q[5]-Q[2]*Q[4])*i,(Q[5]*Q[6]-Q[3]*Q[8])*i,(Q[0]*Q[8]-Q[2]*Q[6])*i,(Q[2]*Q[3]-Q[0]*Q[5])*i,(Q[3]*Q[7]-Q[4]*Q[6])*i,(Q[1]*Q[6]-Q[0]*Q[7])*i,(Q[0]*Q[4]-Q[1]*Q[3])*i])}equals(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.ri,Z=k.m;return 0===Q?i[0]===Z[0]&&i[1]===Z[1]&&i[2]===Z[2]&&i[3]===Z[3]&&i[4]===Z[4]&&i[5]===Z[5]&&i[6]===Z[6]&&i[7]===Z[7]&&i[8]===Z[8]:Math.abs(i[0]-Z[0])<Q&&Math.abs(i[1]-Z[1])<Q&&Math.abs(i[2]-Z[2])<Q&&Math.abs(i[3]-Z[3])<Q&&Math.abs(i[4]-Z[4])<Q&&Math.abs(i[5]-Z[5])<Q&&Math.abs(i[6]-Z[6])<Q&&Math.abs(i[7]-Z[7])<Q&&Math.abs(i[8]-Z[8])<Q}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.ri.join(", ")})`}}},13069:(k,Q,i)=>{"use strict";var Z;function U(k,Q,i,Z){switch(Q){case"Animation":return Z?k.animations.find((k=>k.uniqueId===i))??null:k.animations[i]??null;case"AnimationGroup":return Z?k.animationGroups.find((k=>k.uniqueId===i))??null:k.animationGroups[i]??null;case"Mesh":return Z?k.meshes.find((k=>k.uniqueId===i))??null:k.meshes[i]??null;case"Material":return Z?k.materials.find((k=>k.uniqueId===i))??null:k.materials[i]??null;case"CJ":return Z?k.cameras.find((k=>k.uniqueId===i))??null:k.cameras[i]??null;case"Light":return Z?k.lights.find((k=>k.uniqueId===i))??null:k.lights[i]??null;default:return null}}i.d(Q,{d:()=>U}),function(k){k.Animation="Animation",k.AnimationGroup="AnimationGroup",k.Mesh="Mesh",k.Material="Material",k.CJ="CJ",k.Light="Light"}(Z||(Z={}))},13105:(k,Q,i)=>{"use strict";i.d(Q,{d:()=>U});var Z=i(13114);class U extends Z.c{constructor(k,Q){if(super(k),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),Q)for(const i of Q)this._eventsSignalOutputs[i]=this._registerSignalOutput(i+"Event")}_executeOnTick(k){}_startPendingTasks(k){k._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(k),this._resetAfterCanceled(k)),this._preparePendingTasks(k),k._addPendingBlock(this),this.out._activateSignal(k),k._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(k){k._deleteExecutionVariable(this,"_initialized"),k._removePendingBlock(this)}}},13084:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>O});var Z=i(11255),U=i(11253),C=i(13089),B=i(11122),o=i(13053);class m extends C.e{constructor(k,Q,i,Z){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Z.defaultValue,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(k,Q,i),this.richType=Z,this._defaultValue=U,this._optional=C,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new B.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(k){this._isDisabled!==k&&(this._isDisabled=k,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(k,Q){Q._getConnectionValue(this)!==k&&(Q._setConnectionValue(this,k),this.onValueChangedObservable.notifyObservers(k))}resetToDefaultValue(k){k._setConnectionValue(this,this._defaultValue)}connectTo(k){this._isDisabled||super.connectTo(k)}_getValueOrDefault(k){const Q=k._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(Q):Q}getValue(k){if(1===this.connectionType){k._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(k);const Q=this._getValueOrDefault(k);return this._lastValue=Q,this.richType.typeTransformer?this.richType.typeTransformer(Q):Q}const Q=this.isConnected()?this._connectedPoint[0].getValue(k):this._getValueOrDefault(k);return this._lastValue=Q,this.richType.typeTransformer?this.richType.typeTransformer(Q):Q}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(k),k.richType={},this.richType.serialize(k.richType),k.optional=this._optional,(0,o.f)("defaultValue",this._defaultValue,k)}}(0,U.e)("FlowGraphDataConnection",m);class O{constructor(k){var Q;this.config=k,this.uniqueId=(0,Z.b)(),this.name=(null===(Q=this.config)||void 0===Q?void 0:Q.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(k){}registerDataInput(k,Q,i){const Z=new m(k,0,this,Q,i);return this.dataInputs.push(Z),Z}registerDataOutput(k,Q,i){const Z=new m(k,1,this,Q,i);return this.dataOutputs.push(Z),Z}getDataInput(k){return this.dataInputs.find((Q=>Q.name===k))}getDataOutput(k){return this.dataOutputs.find((Q=>Q.name===k))}serialize(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.f;if(k.uniqueId=this.uniqueId,k.config={},this.config){const i=this.config,Z=Object.keys(i);for(const U of Z)Q(U,i[U],k.config)}k.dataInputs=[],k.dataOutputs=[],k.className=this.getClassName();for(const i of this.dataInputs){const Q={};i.serialize(Q),k.dataInputs.push(Q)}for(const i of this.dataOutputs){const Q={};i.serialize(Q),k.dataOutputs.push(Q)}}deserialize(k){}_log(k,Q,i){var Z;null===(Z=k.logger)||void 0===Z||Z.addLogItem({action:Q,li:i,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13089:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>C});var Z,U=i(11255);!function(k){k[k.Input=0]="Input",k[k.Output=1]="Output"}(Z||(Z={}));class C{constructor(k,Q,i){this._ownerBlock=i,this._connectedPoint=[],this.uniqueId=(0,U.b)(),this.connectedPointIds=[],this.name=k,this._connectionType=Q}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(k){if(this._connectionType===k._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||k._isSingularConnection()&&k._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(k),k._connectedPoint.push(this)}disconnectFrom(k){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this._connectedPoint.indexOf(k),Z=k._connectedPoint.indexOf(this);-1!==i&&-1!==Z&&(Q&&this._connectedPoint.splice(i,1),k._connectedPoint.splice(Z,1))}disconnectFromAll(){for(const k of this._connectedPoint)this.disconnectFrom(k,!1);this._connectedPoint.length=0}dispose(){for(const k of this._connectedPoint)this.disconnectFrom(k)}serialize(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};k.uniqueId=this.uniqueId,k.name=this.name,k._connectionType=this._connectionType,k.connectedPointIds=[],k.className=this.getClassName();for(const Q of this._connectedPoint)k.connectedPointIds.push(Q.uniqueId)}getClassName(){return"FGConnection"}deserialize(k){this.uniqueId=k.uniqueId,this.name=k.name,this._connectionType=k._connectionType,this.connectedPointIds=k.connectedPointIds}}},13048:(k,Q,i)=>{"use strict";i.d(Q,{c:()=>c});var Z,U=i(11122),C=i(11280),B=i(11289),o=i(11255),m=i(13053),O=i(13069),J=i(11134);!function(k){k.ExecuteBlock="ExecuteBlock",k.ExecuteEvent="ExecuteEvent",k.TriggerConnection="TriggerConnection",k.ContextVariableSet="ContextVariableSet",k.GlobalVariableSet="GlobalVariableSet",k.GlobalVariableDelete="GlobalVariableDelete",k.GlobalVariableGet="GlobalVariableGet",k.AddConnection="AddConnection",k.GetConnectionValue="GetConnectionValue",k.SetConnectionValue="SetConnectionValue",k.ActivateSignal="ActivateSignal",k.ContextVariableGet="ContextVariableGet"}(Z||(Z={}));class G{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(k){if(k.time||(k.time=Date.now()),this.log.push(k),this.logToConsole){var Q;const i=null===(Q=k.li)||void 0===Q?void 0:Q.value;"object"===typeof i&&i.getClassName?J.c.Log(`[FGLog] ${k.className}:${k.uniqueId.split("-")[0]} ${k.action} - ${JSON.stringify(i.getClassName())}: ${i.toString()}`):J.c.Log(`[FGLog] ${k.className}:${k.uniqueId.split("-")[0]} ${k.action} - ${JSON.stringify(k.li)}`)}}getItemsOfType(k){return this.log.filter((Q=>Q.action===k))}}class H{get enableLogging(){return this._enableLogging}set enableLogging(k){this._enableLogging!==k&&(this._enableLogging=k,this._enableLogging?(this.logger=new G,this.logger.logToConsole=!0):this.logger=null)}constructor(k){this.uniqueId=(0,o.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new U.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=k,this.assetsContext=k.assetsContext??k.lQ}hasVariable(k){return k in this._userVariables}setVariable(k,Q){var i;this._userVariables[k]=Q,null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",li:{name:k,value:Q}})}getAsset(k,Q){return(0,O.d)(this.assetsContext,k,Q)}getVariable(k){var Q;return null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",li:{name:k,value:this._userVariables[k]}}),this._userVariables[k]}get userVariables(){return this._userVariables}sk(){return this._configuration.lQ}_getUniqueIdPrefixedName(k,Q){return`${k.uniqueId}_${Q}`}_getGlobalContextVariable(k,Q){var i;return null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",li:{name:k,defaultValue:Q,possibleValue:this._globalContextVariables[k]}}),this._hasGlobalContextVariable(k)?this._globalContextVariables[k]:Q}_setGlobalContextVariable(k,Q){var i;null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",li:{name:k,value:Q}}),this._globalContextVariables[k]=Q}_deleteGlobalContextVariable(k){var Q;null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",li:{name:k}}),delete this._globalContextVariables[k]}_hasGlobalContextVariable(k){return k in this._globalContextVariables}_setExecutionVariable(k,Q,i){this._executionVariables[this._getUniqueIdPrefixedName(k,Q)]=i}_getExecutionVariable(k,Q,i){return this._hasExecutionVariable(k,Q)?this._executionVariables[this._getUniqueIdPrefixedName(k,Q)]:i}_deleteExecutionVariable(k,Q){delete this._executionVariables[this._getUniqueIdPrefixedName(k,Q)]}_hasExecutionVariable(k,Q){return this._getUniqueIdPrefixedName(k,Q)in this._executionVariables}_hasConnectionValue(k){return k.uniqueId in this._connectionValues}_setConnectionValue(k,Q){var i;this._connectionValues[k.uniqueId]=Q,null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",li:{connectionPointId:k.uniqueId,value:Q}})}_setConnectionValueByKey(k,Q){this._connectionValues[k]=Q}_getConnectionValue(k){var Q;return null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",li:{connectionPointId:k.uniqueId,value:this._connectionValues[k.uniqueId]}}),this._connectionValues[k.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(k){this._pendingBlocks.includes(k)||(this._pendingBlocks.push(k),this._pendingBlocks.sort(((k,Q)=>k.priority-Q.priority)))}_removePendingBlock(k){const Q=this._pendingBlocks.indexOf(k);-1!==Q&&this._pendingBlocks.splice(Q,1)}_clearPendingBlocks(){for(const k of this._pendingBlocks)k._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(k){var Q;this.onNodeExecutedObservable.notifyObservers(k),null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:k.getClassName(),uniqueId:k.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(k){this._setGlobalContextVariable("timeSinceStart",k.timeSinceStart),this._setGlobalContextVariable("deltaTime",k.deltaTime);for(const i of this._pendingBlocks){var Q;null===(Q=i._executeOnTick)||void 0===Q||Q.call(i,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.f;k.uniqueId=this.uniqueId,k._userVariables={};for(const Z in this._userVariables)Q(Z,this._userVariables[Z],k._userVariables);k._connectionValues={};for(const Z in this._connectionValues)Q(Z,this._connectionValues[Z],k._connectionValues);var i;this.assetsContext!==this.sk()&&(k._assetsContext={meshes:this.assetsContext.meshes.map((k=>k.id)),materials:this.assetsContext.materials.map((k=>k.id)),textures:this.assetsContext.textures.map((k=>k.name)),animations:this.assetsContext.animations.map((k=>k.name)),lights:this.assetsContext.lights.map((k=>k.id)),cameras:this.assetsContext.cameras.map((k=>k.id)),sH:null===(i=this.assetsContext.sH)||void 0===i?void 0:i.map((k=>k.name)),skeletons:this.assetsContext.skeletons.map((k=>k.id)),SG:this.assetsContext.SG.map((k=>k.name)),geometries:this.assetsContext.geometries.map((k=>k.id)),multiMaterials:this.assetsContext.multiMaterials.map((k=>k.id)),transformNodes:this.assetsContext.transformNodes.map((k=>k.id))})}getClassName(){return"FlowGraphContext"}}(0,C.c)([(0,B.L)()],H.prototype,"uniqueId",void 0);var e=i(13078),F=i(11572);class z{constructor(k){this.onEventTriggeredObservable=new U.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=k,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.gi.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const k=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",li:{timeSinceStart:this._startingTime,deltaTime:k}}),this._startingTime+=k})),this._meshPickedObserver=this._scene.onPointerObservable.add((k=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",li:k})}),F.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((k=>{const Q=k.pointerId,i=k.mesh,Z=this._pointerUnderMeshState[Q];!Z&&i?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",li:{pointerId:Q,mesh:i}}):Z&&!i?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",li:{pointerId:Q,mesh:Z}}):Z&&i&&Z!==i&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",li:{pointerId:Q,mesh:Z,over:i}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",li:{pointerId:Q,mesh:i,out:Z}})),this._pointerUnderMeshState[Q]=i}),F.e.POINTERMOVE)}dispose(){var k,Q,i,Z,U;null===(k=this._sceneDisposeObserver)||void 0===k||k.remove(),null===(Q=this._sceneReadyObserver)||void 0===Q||Q.remove(),null===(i=this._sceneOnBeforeRenderObserver)||void 0===i||i.remove(),null===(Z=this._meshPickedObserver)||void 0===Z||Z.remove(),null===(U=this._meshUnderPointerObserver)||void 0===U||U.remove(),this.onEventTriggeredObservable.clear()}}var E,l=i(13096);!function(k){k[k.Stopped=0]="Stopped",k[k.Started=1]="Started"}(E||(E={}));class h{get state(){return this._state}set state(k){this._state=k,this.onStateChangedObservable.notifyObservers(k)}constructor(k){this.onStateChangedObservable=new U.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=k.lQ,this._sceneEventCoordinator=new z(this._scene),this._coordinator=k.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((k=>{for(const Q of this._executionContexts){const i=this._getContextualOrder(k.type,Q);for(const Z of i)if(!Z._executeEvent(Q,k.li))break}switch(k.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const Q of this._executionContexts)Q._notifyOnTick(k.li);break;case"SceneDispose":this.dispose()}}))}createContext(){const k=new H({lQ:this._scene,coordinator:this._coordinator});return this._executionContexts.push(k),k}getContext(k){return this._executionContexts[k]}addEventBlock(k){if("PointerOver"!==k.type&&"PointerOut"!==k.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==k.type&&this._eventBlocks[k.type].push(k),1===this.state)for(const Q of this._executionContexts)k._startPendingTasks(Q);else this.onStateChangedObservable.addOnce((Q=>{if(1===Q)for(const i of this._executionContexts)k._startPendingTasks(i)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((k=>{1===k&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const k of this._executionContexts)for(const Q in this._eventBlocks){const i=this._getContextualOrder(Q,k);for(const Q of i)Q._startPendingTasks(k)}}_getContextualOrder(k,Q){const i=this._eventBlocks[k].sort(((k,Q)=>Q.initPriority-k.initPriority));if("MeshPick"===k){const k=[];for(const Z of i){const U=Z.asset.getValue(Q);let C=0;for(;C<i.length;C++){const k=i[C].asset.getValue(Q);if(U&&k&&(0,l.r)(U,k))break}k.splice(C,0,Z)}return k}return i}dispose(){var k;if(0!==this.state){this.state=0;for(const k of this._executionContexts)k._clearPendingBlocks();this._executionContexts.length=0;for(const k in this._eventBlocks)this._eventBlocks[k].length=0;null===(k=this._eventObserver)||void 0===k||k.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(k){const Q=[],i=new Set;for(const Z in this._eventBlocks)for(const k of this._eventBlocks[Z])Q.push(k),i.add(k.uniqueId);for(;Q.length>0;){const Z=Q.pop();k(Z);for(const k of Z.dataInputs)for(const Z of k._connectedPoint)i.has(Z._ownerBlock.uniqueId)||(Q.push(Z._ownerBlock),i.add(Z._ownerBlock.uniqueId));if(Z instanceof e.d)for(const k of Z.signalOutputs)for(const Z of k._connectedPoint)i.has(Z._ownerBlock.uniqueId)||(Q.push(Z._ownerBlock),i.add(Z._ownerBlock.uniqueId))}}serialize(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Q=arguments.length>1?arguments[1]:void 0;k.allBlocks=[],this.visitAllBlocks((Q=>{const i={};Q.serialize(i),k.allBlocks.push(i)})),k.executionContexts=[];for(const i of this._executionContexts){const Z={};i.serialize(Z,Q),k.executionContexts.push(Z)}}}class c{constructor(k){this.config=k,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.lQ.gi.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.lQ.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const k=this._executeOnNextFrame.slice(0);if(k.length)for(const Q of k){this.notifyCustomEvent(Q.id,Q.data,!1);const k=this._executeOnNextFrame.findIndex((k=>k.uniqueId===Q.uniqueId));-1!==k&&this._executeOnNextFrame.splice(k,1)}}));(c.SceneCoordinators.get(this.config.lQ)??[]).push(this)}createGraph(){const k=new h({lQ:this.config.lQ,coordinator:this});return this._flowGraphs.push(k),k}removeGraph(k){const Q=this._flowGraphs.indexOf(k);-1!==Q&&(k.dispose(),this._flowGraphs.splice(Q,1))}start(){for(const k of this._flowGraphs)k.start()}dispose(){var k,Q;for(const U of this._flowGraphs)U.dispose();this._flowGraphs.length=0,null===(k=this._disposeObserver)||void 0===k||k.remove(),null===(Q=this._onBeforeRenderObserver)||void 0===Q||Q.remove();const i=c.SceneCoordinators.get(this.config.lQ)??[],Z=i.indexOf(this);-1!==Z&&i.splice(Z,1)}serialize(k,Q){k._flowGraphs=[];for(const i of this._flowGraphs){const Z={};i.serialize(Z,Q),k._flowGraphs.push(Z)}k.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(k){let Q=this._customEventsMap.get(k);return Q||(Q=new U.c,this._customEventsMap.set(k,Q)),Q}notifyCustomEvent(k,Q){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:k,data:Q,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(k)){const Q=this._eventExecutionCounter.get(k);if(this._eventExecutionCounter.set(k,Q+1),Q>=c.MaxEventTypeExecutionPerFrame)return void(Q===c.MaxEventTypeExecutionPerFrame&&J.c.Warn(`FlowGraphCoordinator: Too many executions of event "${k}".`))}else this._eventExecutionCounter.set(k,1);const i=this._customEventsMap.get(k);i&&i.notifyObservers(Q)}}c.MaxEventsPerType=30,c.MaxEventTypeExecutionPerFrame=30,c.SceneCoordinators=new Map},13100:(k,Q,i)=>{"use strict";i.d(Q,{d:()=>U});var Z=i(13105);class U extends Z.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(k){k._notifyExecuteNode(this),this.done._activateSignal(k)}}},13078:(k,Q,i)=>{"use strict";i.d(Q,{d:()=>o});var Z=i(13084),U=i(13089),C=i(11253);class B extends U.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(k){super.connectTo(k),this._connectedPoint.sort(((k,Q)=>Q.priority-k.priority))}_activateSignal(k){var Q;if(null===(Q=k.logger)||void 0===Q||Q.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,li:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)k._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(k,this),k._increaseExecutionId();else for(const i of this._connectedPoint)i._activateSignal(k)}}(0,C.e)("FlowGraphSignalConnection",B);class o extends Z.e{constructor(k){super(k),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(k){const Q=new B(k,0,this);return this.signalInputs.push(Q),Q}_registerSignalOutput(k){const Q=new B(k,1,this);return this.signalOutputs.push(Q),Q}_unregisterSignalInput(k){const Q=this.signalInputs.findIndex((Q=>Q.name===k));-1!==Q&&(this.signalInputs[Q].dispose(),this.signalInputs.splice(Q,1))}_unregisterSignalOutput(k){const Q=this.signalOutputs.findIndex((Q=>Q.name===k));-1!==Q&&(this.signalOutputs[Q].dispose(),this.signalOutputs.splice(Q,1))}_reportError(k,Q){this.error.li="string"===typeof Q?new Error(Q):Q,this.error._activateSignal(k)}getSignalInput(k){return this.signalInputs.find((Q=>Q.name===k))}getSignalOutput(k){return this.signalOutputs.find((Q=>Q.name===k))}serialize(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(k),k.signalInputs=[],k.signalOutputs=[];for(const Q of this.signalInputs){const i={};Q.serialize(i),k.signalInputs.push(i)}for(const Q of this.signalOutputs){const i={};Q.serialize(i),k.signalOutputs.push(i)}}deserialize(k){for(let Q=0;Q<k.signalInputs.length;Q++){const i=this.getSignalInput(k.signalInputs[Q].name);if(!i)throw new Error("Could not find signal input with name "+k.signalInputs[Q].name+" in block "+k.className);i.deserialize(k.signalInputs[Q])}for(let Q=0;Q<k.signalOutputs.length;Q++){const i=this.getSignalOutput(k.signalOutputs[Q].name);if(!i)throw new Error("Could not find signal output with name "+k.signalOutputs[Q].name+" in block "+k.className);i.deserialize(k.signalOutputs[Q])}}getClassName(){return"FlowGraphExecutionBlock"}}},13114:(k,Q,i)=>{"use strict";i.d(Q,{c:()=>U});var Z=i(13078);class U extends Z.d{constructor(k){super(k),this.out=this._registerSignalOutput("out")}}},13064:(k,Q,i)=>{"use strict";i.d(Q,{C:()=>F,E:()=>z,G:()=>u,K:()=>a,N:()=>s,O:()=>L,b:()=>O,f:()=>H,h:()=>y,j:()=>E,k:()=>l,n:()=>h,o:()=>G,s:()=>Y,v:()=>J,y:()=>e});var Z,U=i(11298),C=i(11348),B=i(13060),o=i(13066);!function(k){k.Any="any",k.String="string",k.Number="number",k.Boolean="boolean",k.Object="object",k.Integer="FlowGraphInteger",k.Vector2="Vector2",k.zQ="zQ",k.Vector4="Vector4",k.Quaternion="Quaternion",k.Matrix="Matrix",k.Matrix2D="Matrix2D",k.Matrix3D="Matrix3D",k.cQ="cQ",k.Fo="Fo"}(Z||(Z={}));class m{constructor(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=k,this.defaultValue=Q,this.animationType=i}serialize(k){k.typeName=this.typeName,k.defaultValue=this.defaultValue}}const O=new m("any",void 0),J=new m("string",""),G=new m("number",0,0),H=new m("boolean",!1),e=new m("Vector2",U.Vector2.Zero(),5),F=new m("zQ",U.zQ.Zero(),1),z=new m("Vector4",U.Vector4.Zero()),E=new m("Matrix",U.Matrix.Identity(),3),l=new m("Matrix2D",new o.b),h=new m("Matrix3D",new o.e),c=new m("cQ",C.cQ.Black(),4),f=new m("Fo",new C.Fo(0,0,0,0),7),Y=new m("Quaternion",U.Quaternion.Identity(),2);Y.typeTransformer=k=>{if(k.getClassName){if("Vector4"===k.getClassName())return U.Quaternion.fQ(k.Zo());if("zQ"===k.getClassName())return U.Quaternion.FromEulerVector(k);if("Matrix"===k.getClassName())return U.Quaternion.FromRotationMatrix(k)}return k};const y=new m("FlowGraphInteger",new B.e(0),0);function L(k){const Q=k;switch(typeof k){case"string":return J;case"number":return G;case"boolean":return H;case"object":if(Q.getClassName)switch(Q.getClassName()){case"Vector2":return e;case"zQ":return F;case"Vector4":return z;case"Matrix":return E;case"cQ":return c;case"Fo":return f;case"Quaternion":return Y;case"FlowGraphInteger":return y;case"Matrix2D":return l;case"Matrix3D":return h}return O;default:return O}}function s(k){switch(k){case"string":return J;case"number":return G;case"boolean":return H;case"Vector2":return e;case"zQ":return F;case"Vector4":return z;case"Matrix":return E;case"cQ":return c;case"Fo":return f;case"Quaternion":return Y;case"FlowGraphInteger":return y;case"Matrix2D":return l;case"Matrix3D":return h;default:return O}}function u(k){switch(k){case"number":default:return 0;case"Vector2":return 5;case"zQ":return 1;case"Matrix":return 3;case"cQ":return 4;case"Fo":return 7;case"Quaternion":return 2}}function a(k){switch(k){case 0:return G;case 5:return e;case 1:return F;case 3:return E;case 4:return c;case 7:return f;case 2:return Y;default:return O}}},13053:(k,Q,i)=>{"use strict";i.d(Q,{d:()=>J,f:()=>O,h:()=>G});var Z=i(11348),U=i(11298),C=i(13060),B=i(13064),o=i(13066);function m(k){return"Vector2"===k||"zQ"===k||"Vector4"===k||"Quaternion"===k||"cQ"===k||"Fo"===k}function O(k,Q,i){var Z;const U=(null===Q||void 0===Q||null===(Z=Q.getClassName)||void 0===Z?void 0:Z.call(Q))??"";if(m(U)||function(k){return"Matrix"===k||"Matrix2D"===k||"Matrix3D"===k}(U))i[k]={value:Q.Zo(),className:U};else if("FlowGraphInteger"===U)i[k]={value:Q.value,className:U};else if(U&&(Q.id||Q.name))i[k]={id:Q.id,name:Q.name,className:U};else{if("object"===typeof Q)throw new Error(`Could not serialize value ${Q}`);i[k]=Q}}function J(k,Q,i,O){const G=Q[k];let H;const e=(null===G||void 0===G?void 0:G.type)??(null===G||void 0===G?void 0:G.className);if(function(k){return"Mesh"===k||"AbstractMesh"===k||"GroundMesh"===k||"InstanceMesh"===k||"LinesMesh"===k||"GoldbergMesh"===k||"GreasedLineMesh"===k||"TrailMesh"===k}(e)){let k=O.meshes.filter((k=>G.id?k.id===G.id:k.name===G.name));0===k.length&&(k=O.transformNodes.filter((k=>G.id?k.id===G.id:k.name===G.name))),H=G.uniqueId?k.find((k=>k.uniqueId===G.uniqueId)):k[0]}else if(m(e))H=function(k,Q){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===k)return U.Vector2.fQ(Q);if("zQ"===k)return i&&(Q[2]*=-1),U.zQ.fQ(Q);if("Vector4"===k)return U.Vector4.fQ(Q);if("Quaternion"===k)return i&&(Q[2]*=-1,Q[3]*=-1),U.Quaternion.fQ(Q);if("cQ"===k)return new Z.cQ(Q[0],Q[1],Q[2]);if("Fo"===k)return new Z.Fo(Q[0],Q[1],Q[2],Q[3]);throw new Error(`Unknown vector class name ${k}`)}(e,G.value);else if(function(k){return"AnimationGroup"===k}(e)){const k=O.animationGroups.filter((k=>k.name===G.name));H=1===k.length?k[0]:k.find((k=>k.uniqueId===G.uniqueId))}else H="Matrix"===e?U.Matrix.fQ(G.value):"Matrix2D"===e?new o.b(G.value):"Matrix3D"===e?new o.e(G.value):"FlowGraphInteger"===e?C.e.FromValue(G.value):"number"===e||"string"===e||"boolean"===e?G.value[0]:G&&void 0!==G.value?G.value:Array.isArray(G)?G.reduce(((k,Q)=>Q.eventData?(k[Q.id]={type:(0,B.N)(Q.type)},"undefined"!==typeof Q.value&&(k[Q.id].value=J("value",Q,i,O)),k):k),{}):G;return H}function G(k){return"FlowGraphJsonPointerParserBlock"===k}},13096:(k,Q,i)=>{"use strict";function Z(k,Q){return!(!k.parent||k.parent!==Q&&!Z(k.parent,Q))}function U(k){if(k.getClassName)return k.getClassName()}function C(k,Q){return k===Q&&("Vector2"===k||"zQ"===k||"Vector4"===k||"Quaternion"===k)}function B(k,Q){return k===Q&&("Matrix"===k||"Matrix2D"===k||"Matrix3D"===k)}function o(k,Q){return"FlowGraphInteger"===k&&"FlowGraphInteger"===Q}function m(k,Q){const i="number"===typeof k||"number"===typeof(null===k||void 0===k?void 0:k.value);return i&&!Q?!isNaN(O(k)):i}function O(k){return"number"===typeof k?k:k.value}i.d(Q,{e:()=>o,h:()=>B,l:()=>C,n:()=>U,r:()=>Z,u:()=>O,y:()=>m})},12421:(k,Q,i)=>{"use strict";i.r(Q),i.d(Q,{SceneInstrumentation:()=>C});var Z=i(11119),U=i(11513);class C{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(k){k!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=k,k?(this._onBeforeActiveMeshesEvaluationObserver=this.lQ.onBeforeActiveMeshesEvaluationObservable.add((()=>{Z.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.lQ.onAfterActiveMeshesEvaluationObservable.add((()=>{Z.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.lQ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.lQ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(k){k!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=k,k?(this._onBeforeRenderTargetsRenderObserver=this.lQ.onBeforeRenderTargetsRenderObservable.add((()=>{Z.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.lQ.onAfterRenderTargetsRenderObservable.add((()=>{Z.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.lQ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.lQ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(k){k!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=k,k?(this._onBeforeParticlesRenderingObserver=this.lQ.onBeforeParticlesRenderingObservable.add((()=>{Z.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.lQ.onAfterParticlesRenderingObservable.add((()=>{Z.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.lQ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.lQ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(k){k!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=k,this.lQ.spriteManagers&&(k?(this._onBeforeSpritesRenderingObserver=this.lQ.onBeforeSpritesRenderingObservable.add((()=>{Z.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.lQ.onAfterSpritesRenderingObservable.add((()=>{Z.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.lQ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.lQ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(k){k!==this._capturePhysicsTime&&this.lQ.onBeforePhysicsObservable&&(this._capturePhysicsTime=k,k?(this._onBeforePhysicsObserver=this.lQ.onBeforePhysicsObservable.add((()=>{Z.Tools.StartPerformanceCounter("Ee"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.lQ.onAfterPhysicsObservable.add((()=>{Z.Tools.EndPerformanceCounter("Ee"),this._physicsTime.endMonitoring()}))):(this.lQ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.lQ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(k){k!==this._captureAnimationsTime&&(this._captureAnimationsTime=k,k?this._onAfterAnimationsObserver=this.lQ.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.lQ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(k){this._captureFrameTime=k}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(k){this._captureInterFrameTime=k}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(k){k!==this._captureRenderTime&&(this._captureRenderTime=k,k?(this._onBeforeDrawPhaseObserver=this.lQ.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),Z.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.lQ.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),Z.Tools.EndPerformanceCounter("Main render")}))):(this.lQ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.lQ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(k){k!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=k,k?(this._onBeforeCameraRenderObserver=this.lQ.onBeforeCameraRenderObservable.add((k=>{this._cameraRenderTime.beginMonitoring(),Z.Tools.StartPerformanceCounter(`Rendering camera ${k.name}`)})),this._onAfterCameraRenderObserver=this.lQ.onAfterCameraRenderObservable.add((k=>{this._cameraRenderTime.endMonitoring(!1),Z.Tools.EndPerformanceCounter(`Rendering camera ${k.name}`)}))):(this.lQ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.lQ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.lQ.getEngine()._drawCalls}constructor(k){this.lQ=k,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new U.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new U.b,this._captureFrameTime=!1,this._frameTime=new U.b,this._captureRenderTime=!1,this._renderTime=new U.b,this._captureInterFrameTime=!1,this._interFrameTime=new U.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new U.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new U.b,this._capturePhysicsTime=!1,this._physicsTime=new U.b,this._captureAnimationsTime=!1,this._animationsTime=new U.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new U.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=k.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(Z.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.lQ.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=k.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(Z.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.pi(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.pi(),this._captureParticlesRenderTime&&this._particlesRenderTime.pi(),this._captureSpritesRenderTime&&this._spritesRenderTime.pi(),this._captureRenderTime&&this._renderTime.pi(),this._captureCameraRenderTime&&this._cameraRenderTime.pi()}))}dispose(){this._disposed||(this.lQ.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.lQ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.lQ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.lQ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.lQ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.lQ.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.lQ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.lQ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.lQ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.lQ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.lQ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.lQ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.lQ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.lQ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.lQ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.lQ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.lQ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.lQ=null,this._disposed=!0)}}},13043:(k,Q,i)=>{"use strict";i.d(Q,{d:()=>J});var Z=i(11280),U=i(11289),C=i(11298),B=i(11706),o=i(11826),m=i(11884),O=i(11253);B.c.AddNodeConstructor("Light_Type_1",((k,Q)=>()=>new J(k,C.zQ.Zero(),Q)));class J extends m.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(k){this._shadowFrustumSize=k,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(k){this._shadowOrthoScale=k,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(k){this._orthoLeft=k}get orthoRight(){return this._orthoRight}set orthoRight(k){this._orthoRight=k}get orthoTop(){return this._orthoTop}set orthoTop(k){this._orthoTop=k}get orthoBottom(){return this._orthoBottom}set orthoBottom(k){this._orthoBottom=k}constructor(k,Q,i){super(k,i),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=Q.scale(-1),this.direction=Q}getClassName(){return"se"}getTypeID(){return o.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(k,Q,i){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(k):this._setDefaultAutoExtendShadowProjectionMatrix(k,Q,i)}_setDefaultFixedFrustumShadowProjectionMatrix(k){const Q=this.sk().activeCamera;Q&&C.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:Q.Co,void 0!==this.shadowMaxZ?this.shadowMaxZ:Q.maxZ,k,this.sk().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(k,Q,i){const Z=this.sk().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const k=C.zQ.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let Z=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(let B=0;B<i.length;B++){const o=i[B];if(!o)continue;const m=o.getBoundingInfo().boundingBox;for(let i=0;i<m.vectorsWorld.length;i++)C.zQ.TransformCoordinatesToRef(m.vectorsWorld[i],Q,k),k.x<this._orthoLeft&&(this._orthoLeft=k.x),k.y<this._orthoBottom&&(this._orthoBottom=k.y),k.x>this._orthoRight&&(this._orthoRight=k.x),k.y>this._orthoTop&&(this._orthoTop=k.y),this.autoCalcShadowZBounds&&(k.z<Z&&(Z=k.z),k.z>U&&(U=k.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=Z,this._shadowMaxZ=U)}const U=this._orthoRight-this._orthoLeft,B=this._orthoTop-this._orthoBottom,o=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Z||void 0===Z?void 0:Z.Co)||0,m=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Z||void 0===Z?void 0:Z.maxZ)||1e4,O=this.sk().getEngine().useReverseDepthBuffer;C.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-U*this.shadowOrthoScale,this._orthoRight+U*this.shadowOrthoScale,this._orthoBottom-B*this.shadowOrthoScale,this._orthoTop+B*this.shadowOrthoScale,O?m:o,O?o:m,k,this.sk().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(k,Q){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,Q),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,Q),this)}transferToNodeMaterialEffect(k,Q){return this.computeTransformedInformation()?(k.setFloat3(Q,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(k.setFloat3(Q,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(k){const Q=this._scene.getEngine();return!Q.useReverseDepthBuffer&&Q.isNDCHalfZRange?0:1}getDepthMaxZ(k){const Q=this._scene.getEngine();return Q.useReverseDepthBuffer&&Q.isNDCHalfZRange?0:1}prepareLightSpecificDefines(k,Q){k["DIRLIGHT"+Q]=!0}}(0,Z.c)([(0,U.L)()],J.prototype,"shadowFrustumSize",null),(0,Z.c)([(0,U.L)()],J.prototype,"shadowOrthoScale",null),(0,Z.c)([(0,U.L)()],J.prototype,"autoUpdateExtends",void 0),(0,Z.c)([(0,U.L)()],J.prototype,"autoCalcShadowZBounds",void 0),(0,Z.c)([(0,U.L)("orthoLeft")],J.prototype,"_orthoLeft",void 0),(0,Z.c)([(0,U.L)("orthoRight")],J.prototype,"_orthoRight",void 0),(0,Z.c)([(0,U.L)("orthoTop")],J.prototype,"_orthoTop",void 0),(0,Z.c)([(0,U.L)("orthoBottom")],J.prototype,"_orthoBottom",void 0),(0,O.e)("BABYLON.DirectionalLight",J)},13527:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>J});var Z=i(11280),U=i(11289),C=i(11298),B=i(11348),o=i(11706),m=i(11826),O=i(11253);o.c.AddNodeConstructor("Light_Type_3",((k,Q)=>()=>new J(k,C.zQ.Zero(),Q)));class J extends m.e{constructor(k,Q,i){super(k,i),this.groundColor=new B.cQ(0,0,0),this.direction=Q||C.zQ.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Te"}setDirectionToTarget(k){return this.direction=C.zQ.Normalize(k.EQ(C.zQ.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(k,Q){const i=C.zQ.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,Q),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.lo),Q),this}transferToNodeMaterialEffect(k,Q){const i=C.zQ.Normalize(this.direction);return k.setFloat3(Q,i.x,i.y,i.z),this}oo(){return this._worldMatrix||(this._worldMatrix=C.Matrix.Identity()),this._worldMatrix}getTypeID(){return m.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(k,Q){k["HEMILIGHT"+Q]=!0}}(0,Z.c)([(0,U.k)()],J.prototype,"groundColor",void 0),(0,Z.c)([(0,U.K)()],J.prototype,"direction",void 0),(0,O.e)("BABYLON.HemisphericLight",J)},13011:(k,Q,i)=>{"use strict";i.d(Q,{c:()=>G});var Z=i(11280),U=i(11289),C=i(11298),B=i(11706),o=i(11826),m=i(11884),O=i(11273),J=i(11253);B.c.AddNodeConstructor("Light_Type_2",((k,Q)=>()=>new G(k,C.zQ.Zero(),C.zQ.Zero(),0,0,Q)));class G extends m.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(k){this._iesProfileTexture!==k&&(this._iesProfileTexture=k,this._iesProfileTexture&&G._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(k){this._angle=k,this._cosHalfAngle=Math.cos(.5*k),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(k){this._innerAngle=k,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(k){this._shadowAngleScale=k,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(k){this._projectionTextureLightNear=k,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(k){this._projectionTextureLightFar=k,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(k){this._projectionTextureUpDirection=k,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(k){this._projectionTexture!==k&&(this._projectionTexture=k,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(G._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):G._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(k){return void 0!==k.onGeneratedObservable}static _IsTexture(k){return void 0!==k.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(k){this._projectionTextureProjectionLightMatrix=k,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(k,Q,i,Z,U,B){super(k,B),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=C.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=C.zQ.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=C.zQ.Zero(),this._projectionTextureViewLightMatrix=C.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=C.Matrix.Zero(),this._projectionTextureScalingMatrix=C.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=Q,this.direction=i,this.angle=Z,this.exponent=U}getClassName(){return"SpotLight"}getTypeID(){return o.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(k){super._setDirection(k),this._projectionTextureViewLightDirty=!0}_setPosition(k){super._setPosition(k),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(k,Q,i){const Z=this.sk().activeCamera;if(!Z)return;this._shadowAngleScale=this._shadowAngleScale||1;const U=this._shadowAngleScale*this._angle,B=void 0!==this.shadowMinZ?this.shadowMinZ:Z.Co,o=void 0!==this.shadowMaxZ?this.shadowMaxZ:Z.maxZ,m=this.sk().getEngine().useReverseDepthBuffer;C.Matrix.PerspectiveFovLHToRef(U,1,m?o:B,m?B:o,k,!0,this._scene.getEngine().isNDCHalfZRange,void 0,m)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),C.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const k=this.projectionTextureLightFar,Q=this.projectionTextureLightNear,i=k/(k-Q),Z=-i*Q,U=1/Math.tan(this._angle/2);C.Matrix.FromValuesToRef(U/1,0,0,0,0,U,0,0,0,0,i,1,0,0,Z,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof O.c){const k=this._projectionTexture.uScale/2,Q=this._projectionTexture.vScale/2;C.Matrix.FromValuesToRef(k,0,0,0,0,Q,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(k,Q){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),k.setMatrix("textureProjectionMatrix"+Q,this._projectionTextureMatrix),k.setTexture("projectionLightTexture"+Q,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&k.setTexture("iesLightTexture"+Q,this._iesProfileTexture),this}transferToEffect(k,Q){let i;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,Q),i=C.zQ.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,Q),i=C.zQ.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",i.x,i.y,i.z,this._cosHalfAngle,Q),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,Q),this}transferToNodeMaterialEffect(k,Q){let i;return i=this.computeTransformedInformation()?C.zQ.Normalize(this.transformedDirection):C.zQ.Normalize(this.direction),this.sk().useRightHandedSystem?k.setFloat3(Q,-i.x,-i.y,-i.z):k.setFloat3(Q,i.x,i.y,i.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(k){const Q=this._scene.getEngine(),i=void 0!==this.shadowMinZ?this.shadowMinZ:(null===k||void 0===k?void 0:k.Co)??0;return Q.useReverseDepthBuffer&&Q.isNDCHalfZRange?i:this._scene.getEngine().isNDCHalfZRange?0:i}getDepthMaxZ(k){const Q=this._scene.getEngine(),i=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===k||void 0===k?void 0:k.maxZ)??1e4;return Q.useReverseDepthBuffer&&Q.isNDCHalfZRange?0:i}prepareLightSpecificDefines(k,Q){k["SPOTLIGHT"+Q]=!0,k["PROJECTEDLIGHTTEXTURE"+Q]=!(!this.projectionTexture||!this.projectionTexture.isReady()),k["IESLIGHTTEXTURE"+Q]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,Z.c)([(0,U.L)()],G.prototype,"angle",null),(0,Z.c)([(0,U.L)()],G.prototype,"innerAngle",null),(0,Z.c)([(0,U.L)()],G.prototype,"shadowAngleScale",null),(0,Z.c)([(0,U.L)()],G.prototype,"exponent",void 0),(0,Z.c)([(0,U.L)()],G.prototype,"projectionTextureLightNear",null),(0,Z.c)([(0,U.L)()],G.prototype,"projectionTextureLightFar",null),(0,Z.c)([(0,U.L)()],G.prototype,"projectionTextureUpDirection",null),(0,Z.c)([(0,U.E)("projectedLightTexture")],G.prototype,"_projectionTexture",void 0),(0,J.e)("BABYLON.SpotLight",G)},12718:(k,Q,i)=>{"use strict";i.d(Q,{d:()=>B,h:()=>C,i:()=>o});const Z={},U={};function C(k,Q){Z[k]=Q}function B(k,Q){U[k]=Q}function o(k){return U[k]?U[k]:null}},12601:(k,Q,i)=>{"use strict";i.d(Q,{b:()=>L,f:()=>d});var Z,U=i(11119),C=i(11122),B=i(11538),o=i(11157),m=i(11134),O=i(11751),J=i(11163),G=i(11172),H=i(11255),e=i(11195),F=i(11150);!function(k){k[k.Clean=0]="Clean",k[k.Stop=1]="Stop",k[k.Sync=2]="Sync",k[k.NoSync=3]="NoSync"}(Z||(Z={}));const z=new C.c,E={};let l=!1;function h(){return E[".babylon"]}function c(k,Q){const i=E[k];return i||(m.c.Warn("Unable to find a plugin to load "+k+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),Q?h():void 0)}function f(k,Q,i){let Z="Unable to load from "+(k.rawData?"binary data":k.url);return Q?Z+=`: ${Q}`:i&&(Z+=`: ${i}`),Z}async function Y(k,Q,i,Z,U,C,B,o,m){var O;const G="data:"===(H=k.url).substring(0,5)?H.substring(5):null;var H;if(k.rawData&&!B)throw"When using ArrayBufferView to load data the file extension must be provided.";const l=G||B?"":function(k){const Q=k.indexOf("?");-1!==Q&&(k=k.substring(0,Q));const i=k.lastIndexOf(".");return k.substring(i,k.length).toLowerCase()}(k.url);let f=B?c(B,!0):G?function(k){for(const Q in E){const i=E[Q].plugin;if(i.canDirectLoad&&i.canDirectLoad(k))return E[Q]}return h()}(k.url):c(l,!1);if(!f&&l){if(k.url&&!k.url.startsWith("blob:")){const Q=await async function(k,Q){const i=Q.method||"GET";return await new Promise(((Z,U)=>{const C=new F.d;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const k={};if(Q.responseHeaders)for(const i of Q.responseHeaders)k[i]=C.getResponseHeader(i)||"";Z({response:C.response,headerValues:k})}else U(`Unable to fetch data from ${k}. Error code: ${C.status}`)})),C.open(i,k),C.send()}))}(k.url,{method:"HEAD",responseHeaders:["Content-Type"]}),i=Q.headerValues?Q.headerValues["Content-Type"]:"";i&&(f=function(k){for(const Q in E){const i=E[Q];if(i.mimeType===k)return i}}(i))}f||(f=h())}if(!f)throw new Error(`No plugin or fallback for ${B??k.url}`);if(!1===(null===m||void 0===m||null===(O=m[f.plugin.name])||void 0===O?void 0:O.enabled))throw new Error(`The '${f.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(k.rawData&&!f.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(k=>{if(f.plugin.createPlugin){const Q=f.plugin.createPlugin(m??{});return Q instanceof Promise?(Q.then(k).catch((k=>{U("Error instantiating plugin.",k)})),null):(k(Q),Q)}return k(f.plugin),f.plugin})((m=>{var O;if(!m)throw`The loader plugin corresponding to the '${B}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(z.notifyObservers(m),G&&(m.canDirectLoad&&m.canDirectLoad(k.url)||!(0,J.l)(k.url))){if(m.directLoad){const k=m.directLoad(Q,G);k instanceof Promise?k.then((k=>{i(m,k)})).catch((k=>{U("Error in directLoad of _loadData: "+k,k)})):i(m,k)}else i(m,G);return}const H=f.isBinary,F=(k,Z)=>{Q.J?U("Scene has been disposed"):i(m,k,Z)};let E=null,l=!1;null===(O=m.gi)||void 0===O||O.add((()=>{l=!0,E&&(E.abort(),E=null),C()}));const h=()=>{if(l)return;const i=(k,Q)=>{U(null===k||void 0===k?void 0:k.statusText,Q)};if(!m.loadFile&&k.rawData)throw"Plugin does not support loading ArrayBufferView.";E=m.loadFile?m.loadFile(Q,k.rawData||k.file||k.url,k.rootUrl,F,Z,H,i,o):Q._loadFile(k.file||k.url,F,Z,!0,H,i)},c=Q.getEngine();let Y=c.enableOfflineSupport;if(Y){let i=!1;for(const Z of Q.disableOfflineSupportExceptionRules)if(Z.test(k.url)){i=!0;break}Y=!i}Y&&e.b.OfflineProviderFactory?Q.offlineProvider=e.b.OfflineProviderFactory(k.url,h,c.disableManifestCheck):h()}))}function y(k,Q){let i,Z,C=null,B=null;if(Q)if(Q.name)i=`file:${Q.name}`,Z=Q.name,C=Q;else if(ArrayBuffer.isView(Q))i="",Z=(0,H.b)(),B=Q;else if(Q.startsWith("data:"))i=Q,Z="";else if(k){const C=Q;if("/"===C.substring(0,1))return U.Tools.Error("Wrong sceneFilename parameter"),null;i=k+C,Z=C}else i=Q,Z=U.Tools.GetFilename(Q),k=U.Tools.GetFolderPath(Q);else i=k,Z=U.Tools.GetFilename(k),k=U.Tools.GetFolderPath(k);return{url:i,rootUrl:k,name:Z,file:C,rawData:B}}function L(k){if("string"===typeof k.extensions){const Q=k.extensions;E[Q.toLowerCase()]={plugin:k,isBinary:!1}}else{const Q=k.extensions,i=Object.keys(Q);for(const Z of i)E[Z.toLowerCase()]={plugin:k,isBinary:Q[Z].isBinary,mimeType:Q[Z].mimeType}}}async function s(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.b.LastCreatedScene,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",H=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!Z)return m.c.Error("No scene available to import mesh to"),null;const e=y(Q,i);if(!e)return null;const F={};Z.addPendingData(F);const z=()=>{Z.removePendingData(F)},E=(k,Q)=>{const i=f(e,k,Q);B?B(Z,i,new G.f(i,G.e.SceneLoaderError,Q)):m.c.Error(i),z()},l=C?k=>{try{C(k)}catch(Q){E("Error in onProgress callback: "+Q,Q)}}:void 0,h=(k,Q,i,C,B,o,m,O)=>{if(Z.importedMeshesFiles.push(e.url),U)try{U(k,Q,i,C,B,o,m,O)}catch(J){E("Error in onSuccess callback: "+J,J)}Z.removePendingData(F)};return await Y(e,Z,((Q,i,U)=>{if(Q.rewriteRootURL&&(e.rootUrl=Q.rewriteRootURL(e.rootUrl,U)),Q.importMesh){const U=[],C=[],B=[];if(!Q.importMesh(k,Z,i,e.rootUrl,U,C,B,E))return;Z.loadingPluginName=Q.name,h(U,C,B,[],[],[],[],[])}else{Q.importMeshAsync(k,Z,i,e.rootUrl,l,e.name).then((k=>{Z.loadingPluginName=Q.name,h(k.meshes,k.SG,k.skeletons,k.animationGroups,k.transformNodes,k.geometries,k.lights,k.spriteManagers)})).catch((k=>{E(k.message,k)}))}}),l,E,z,O,J,H)}async function u(k,Q,i,Z,U,C,B,o){return await new Promise(((m,O)=>{try{s(k,Q,i,Z,((k,Q,i,Z,U,C,B,o)=>{m({meshes:k,SG:Q,skeletons:i,animationGroups:Z,transformNodes:U,geometries:C,lights:B,spriteManagers:o})}),U,((k,Q,i)=>{O(i||new Error(Q))}),C,B,o).catch(O)}catch(G){O(G)}}))}async function a(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.b.LastCreatedEngine,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};i?await T(k,Q,new B.b(i),Z,C,m,O,J,G):U.Tools.Error("No engine available")}async function j(k,Q,i,Z,U,C,B){return await new Promise(((o,m)=>{a(k,Q,i,(k=>{o(k)}),Z,((k,Q,i)=>{m(i||new Error(Q))}),U,C,B)}))}async function T(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.b.LastCreatedScene,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!i)return m.c.Error("No scene available to append to"),null;const e=y(k,Q);if(!e)return null;const F={};i.addPendingData(F);const z=()=>{i.removePendingData(F)};O.d.ShowLoadingScreen&&!l&&(l=!0,i.getEngine().displayLoadingUI(),i.executeWhenReady((()=>{i.getEngine().hideLoadingUI(),l=!1})));const E=(k,Q)=>{const Z=f(e,k,Q);C?C(i,Z,new G.f(Z,G.e.SceneLoaderError,Q)):m.c.Error(Z),z()},h=U?k=>{try{U(k)}catch(Q){E("Error in onProgress callback",Q)}}:void 0,c=()=>{if(Z)try{Z(i)}catch(k){E("Error in onSuccess callback",k)}i.removePendingData(F)};return await Y(e,i,((k,Q)=>{if(k.load){if(!k.load(i,Q,e.rootUrl,E))return;i.loadingPluginName=k.name,c()}else{k.loadAsync(i,Q,e.rootUrl,h,e.name).then((()=>{i.loadingPluginName=k.name,c()})).catch((k=>{E(k.message,k)}))}}),h,E,z,B,J,H)}async function K(k,Q,i,Z,U,C,B){return await new Promise(((o,m)=>{try{T(k,Q,i,(k=>{o(k)}),Z,((k,Q,i)=>{m(i||new Error(Q))}),U,C,B).catch(m)}catch(G){m(G)}}))}async function v(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.b.LastCreatedScene,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!i)return m.c.Error("No scene available to load asset container to"),null;const H=y(k,Q);if(!H)return null;const e={};i.addPendingData(e);const F=()=>{i.removePendingData(e)},z=(k,Q)=>{const Z=f(H,k,Q);C?C(i,Z,new G.f(Z,G.e.SceneLoaderError,Q)):m.c.Error(Z),F()},E=U?k=>{try{U(k)}catch(Q){z("Error in onProgress callback",Q)}}:void 0,l=k=>{if(Z)try{Z(k)}catch(Q){z("Error in onSuccess callback",Q)}i.removePendingData(e)};return await Y(H,i,((k,Q)=>{if(k.loadAssetContainer){const Z=k.loadAssetContainer(i,Q,H.rootUrl,z);if(!Z)return;Z.populateRootNodes(),i.loadingPluginName=k.name,l(Z)}else if(k.loadAssetContainerAsync){k.loadAssetContainerAsync(i,Q,H.rootUrl,E,H.name).then((Q=>{Q.populateRootNodes(),i.loadingPluginName=k.name,l(Q)})).catch((k=>{z(k.message,k)}))}else z("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),E,z,F,B,O,J)}async function N(k,Q,i,Z,U,C,B){return await new Promise(((o,m)=>{try{v(k,Q,i,(k=>{o(k)}),Z,((k,Q,i)=>{m(i||new Error(Q))}),U,C,B).catch(m)}catch(G){m(G)}}))}async function X(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.b.LastCreatedScene,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,H=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",e=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!i)return void m.c.Error("No scene available to load animations to");if(Z){for(const Z of i.animatables)Z.reset();i.stopAllAnimations();const k=i.animationGroups.slice();for(const i of k)i.dispose();const Q=i.getNodes();for(const i of Q)i.animations&&(i.animations=[])}else switch(U){case 0:const k=i.animationGroups.slice();for(const Q of k)Q.dispose();break;case 1:for(const Q of i.animationGroups)Q.stop();break;case 2:for(const Q of i.animationGroups)Q.reset(),Q.restart();break;case 3:break;default:return void m.c.Error("Unknown animation group loading mode value '"+U+"'")}const F=i.animatables.length;await v(k,Q,i,(k=>{k.mergeAnimationsTo(i,i.animatables.slice(F),C),k.dispose(),i.onAnimationFileImportedObservable.notifyObservers(i),B&&B(i)}),O,J,G,H,e)}async function p(k,Q,i,Z,U,C,B,o,m,O){return await new Promise(((J,H)=>{try{X(k,Q,i,Z,U,C,(k=>{J(k)}),B,((k,Q,i)=>{H(i||new Error(Q))}),o,m,O).catch(H)}catch(G){H(G)}}))}class d{static get ForceFullSceneLoadingForIncremental(){return O.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(k){O.d.ForceFullSceneLoadingForIncremental=k}static get ShowLoadingScreen(){return O.d.ShowLoadingScreen}static set ShowLoadingScreen(k){O.d.ShowLoadingScreen=k}static get loggingLevel(){return O.d.loggingLevel}static set loggingLevel(k){O.d.loggingLevel=k}static get CleanBoneMatrixWeights(){return O.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(k){O.d.CleanBoneMatrixWeights=k}static GetDefaultPlugin(){return h()}static GetPluginForExtension(k){var Q;return null===(Q=c(k,!0))||void 0===Q?void 0:Q.plugin}static IsPluginForExtensionAvailable(k){return function(k){return!!E[k]}(k)}static RegisterPlugin(k){L(k)}static ImportMesh(k,Q,i,Z,U,C,B,m,O){s(k,Q,i,Z,U,C,B,m,O).catch((k=>null===B||void 0===B?void 0:B(o.b.LastCreatedScene,null===k||void 0===k?void 0:k.message,k)))}static async ImportMeshAsync(k,Q,i,Z,U,C,B){return await u(k,Q,i,Z,U,C,B)}static Load(k,Q,i,Z,U,C,B,m){a(k,Q,i,Z,U,C,B,m).catch((k=>null===C||void 0===C?void 0:C(o.b.LastCreatedScene,null===k||void 0===k?void 0:k.message,k)))}static async LoadAsync(k,Q,i,Z,U,C){return await j(k,Q,i,Z,U,C)}static Append(k,Q,i,Z,U,C,B,m){T(k,Q,i,Z,U,C,B,m).catch((k=>null===C||void 0===C?void 0:C(i??o.b.LastCreatedScene,null===k||void 0===k?void 0:k.message,k)))}static async AppendAsync(k,Q,i,Z,U,C){return await K(k,Q,i,Z,U,C)}static LoadAssetContainer(k,Q,i,Z,U,C,B,m){v(k,Q,i,Z,U,C,B,m).catch((k=>null===C||void 0===C?void 0:C(i??o.b.LastCreatedScene,null===k||void 0===k?void 0:k.message,k)))}static async LoadAssetContainerAsync(k,Q,i,Z,U,C){return await N(k,Q,i,Z,U,C)}static ImportAnimations(k,Q,i,Z,U,C,B,m,O,J,G){X(k,Q,i,Z,U,C,B,m,O,J,G).catch((k=>null===O||void 0===O?void 0:O(i??o.b.LastCreatedScene,null===k||void 0===k?void 0:k.message,k)))}static async ImportAnimationsAsync(k,Q,i,Z,U,C,B,o,m,O,J){return await p(k,Q,i,Z,U,C,o,O,J)}}d.NO_LOGGING=0,d.MINIMAL_LOGGING=1,d.SUMMARY_LOGGING=2,d.DETAILED_LOGGING=3,d.OnPluginActivatedObservable=z},13022:(k,Q,i)=>{"use strict";i.d(Q,{c:()=>H});var Z=i(11280),U=i(11289),C=i(11119),B=i(11298),o=i(11320),m=i(11273),O=i(11253),J=i(11122),G=i(11334);i(13030);class H extends o.c{set boundingBoxSize(k){if(this._boundingBoxSize&&this._boundingBoxSize.equals(k))return;this._boundingBoxSize=k;const Q=this.sk();Q&&Q.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(k){this._rotationY=k,this.setReflectionTextureMatrix(B.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(k,Q,i){let Z="";for(const U of k)Z+=U;return new H(Z,Q,null,i,k)}static CreateFromPrefilteredData(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const U=Q.useDelayedTextureLoading;Q.useDelayedTextureLoading=!1;const C=new H(k,Q,null,!1,null,null,null,void 0,!0,i,Z);return Q.useDelayedTextureLoading=U,C}constructor(k,Q){var i;let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,H=arguments.length>8&&void 0!==arguments[8]&&arguments[8],e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,F=arguments.length>10&&void 0!==arguments[10]&&arguments[10],z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,l=arguments.length>13?arguments[13]:void 0,h=arguments.length>14?arguments[14]:void 0;super(Q),this.onLoadObservable=new J.c,this.boundingBoxPosition=B.zQ.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new B.Matrix,this._buffer=null,this.name=k,this.url=k,this._noMipmap=U,this.Uo=!1,this.isCube=!0,this._textureMatrix=B.Matrix.Identity(),this.coordinatesMode=m.c.CUBIC_MODE;let c=null,f=null;null===Z||Array.isArray(Z)?(this._noMipmap=U,this._format=G,this._createPolynomials=F,c=Z,this._loaderOptions=l,this._useSRGBBuffer=h,this._lodScale=z,this._lodOffset=E):(c=Z.extensions??null,this._noMipmap=Z.noMipmap??!1,C=Z.files??null,f=Z.buffer??null,this._format=Z.format??5,H=Z.prefiltered??!1,e=Z.forcedExtension??null,this._createPolynomials=Z.createPolynomials??!1,this._lodScale=Z.lodScale??.8,this._lodOffset=Z.lodOffset??0,this._loaderOptions=Z.loaderOptions,this._useSRGBBuffer=Z.useSRGBBuffer,o=Z.t??null,O=Z.onError??null),(k||C)&&this.updateURL(k,e,o,H,O,c,null===(i=this.sk())||void 0===i?void 0:i.useDelayedTextureLoading,C,f)}getClassName(){return"CubeTexture"}updateURL(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=k),this.url=k,Q&&(this._forcedExtension=Q);const O=k.lastIndexOf("."),J=Q||(O>-1?k.substring(O).toLowerCase():""),G=0===J.indexOf(".dds"),H=0===J.indexOf(".env"),e=0===J.indexOf(".basis");if(H?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=Z,Z&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),o)this._files=o;else if(e||H||G||C||(C=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,C){for(let Q=0;Q<C.length;Q++)this._files.push(k+C[Q]);this._extensions=C}this._buffer=m,B?(this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=U):this._loadTexture(i,U)}delayLoad(k){4===this.delayLoadState&&(k&&(this._forcedExtension=k),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(k){var Q,i;if(k.updateFlag===this._textureMatrix.updateFlag)return;k.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(i=this.sk())||void 0===i||i.markAllMaterialsAsDirty(1,(k=>-1!==k.getActiveTextures().indexOf(this))));if(this._textureMatrix=k,null===(Q=this.sk())||void 0===Q||!Q.useRightHandedSystem)return;const Z=B.TmpVectors.zQ[0],U=B.TmpVectors.Quaternion[0],C=B.TmpVectors.zQ[1];this._textureMatrix.decompose(Z,U,C),U.z*=-1,U.w*=-1,B.Matrix.ComposeToRef(Z,U,C,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var k;return null!==(k=this.sk())&&void 0!==k&&k.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this.sk(),Z=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const U=()=>{var Q;(this.onLoadObservable.notifyObservers(this),Z)&&(Z.dispose(),null===(Q=this.sk())||void 0===Q||Q.markAllMaterialsAsDirty(1));k&&k()},B=(k,i)=>{this._loadingError=!0,this._errorObject={message:k,exception:i},Q&&Q(k,i),m.c.OnTextureLoadErrorObservable.notifyObservers(this)};var o;this._texture?this._texture.isReady?C.Tools.SetImmediate((()=>U())):this._texture.onLoadedObservable.add((()=>U())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,i,this._lodScale,this._lodOffset,k,B,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,i,this._files,this._noMipmap,k,B,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(o=this._texture)||void 0===o||o.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(k,Q,i){const Z=G.d.Parse((()=>{let Z=!1;return k.prefiltered&&(Z=k.prefiltered),new H(i+(k.url??k.name),Q,k.extensions,!1,k.files||null,null,null,void 0,Z,k.forcedExtension)}),k,Q);if(k.boundingBoxPosition&&(Z.boundingBoxPosition=B.zQ.fQ(k.boundingBoxPosition)),k.boundingBoxSize&&(Z.boundingBoxSize=B.zQ.fQ(k.boundingBoxSize)),k.animations)for(let U=0;U<k.animations.length;U++){const Q=k.animations[U],i=(0,O.b)("BABYLON.Animation");i&&Z.animations.push(i.Parse(Q))}return Z}clone(){let k=0;const Q=G.d.Clone((()=>{const Q=new H(this.url,this.sk()||this._getEngine(),this._extensions,this._noMipmap,this._files);return k=Q.uniqueId,Q}),this);return Q.uniqueId=k,Q}}(0,Z.c)([(0,U.L)()],H.prototype,"url",void 0),(0,Z.c)([(0,U.K)()],H.prototype,"boundingBoxPosition",void 0),(0,Z.c)([(0,U.K)()],H.prototype,"boundingBoxSize",null),(0,Z.c)([(0,U.L)("rotationY")],H.prototype,"rotationY",null),(0,Z.c)([(0,U.L)("files")],H.prototype,"_files",void 0),(0,Z.c)([(0,U.L)("forcedExtension")],H.prototype,"_forcedExtension",void 0),(0,Z.c)([(0,U.L)("extensions")],H.prototype,"_extensions",void 0),(0,Z.c)([(0,U.t)("textureMatrix")],H.prototype,"_textureMatrix",void 0),(0,Z.c)([(0,U.t)("textureMatrixRefraction")],H.prototype,"_textureMatrixRefraction",void 0),m.c._CubeTextureParser=H.Parse,(0,O.e)("BABYLON.CubeTexture",H)},13541:(k,Q,i)=>{"use strict";i.d(Q,{c:()=>m});var Z=i(11134),U=i(11273),C=i(11259),B=i(11434),o=i(11235);B.ThinEngine.prototype.createDynamicTexture=function(k,Q,i,Z){const U=new o.c(this,4);return U.baseWidth=k,U.baseHeight=Q,i&&(k=this.needPOTTextures?(0,C.g)(k,this._caps.maxTextureSize):k,Q=this.needPOTTextures?(0,C.g)(Q,this._caps.maxTextureSize):Q),U.width=k,U.height=Q,U.isReady=!1,U.generateMipMaps=i,U.samplingMode=Z,this.updateTextureSamplingMode(Z,U),this._internalTexturesCache.push(U),U},B.ThinEngine.prototype.updateDynamicTexture=function(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!k)return;const B=this._gl,o=B.TEXTURE_2D,m=this._bindTextureDirectly(o,k,!0,C);this._unpackFlipY(void 0===i?k.invertY:i),Z&&B.pixelStorei(B.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const O=this._getWebGLTextureType(k.type),J=this._getInternalFormat(U||k.format),G=this._getRGBABufferInternalSizedFormat(k.type,J);B.texImage2D(o,0,G,J,O,Q),k.generateMipMaps&&B.generateMipmap(o),m||this._bindTextureDirectly(o,null),Z&&B.pixelStorei(B.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),U&&(k.format=U),k._dynamicTextureSource=Q,k._premulAlpha=Z,k.invertY=i||!1,k.isReady=!0};class m extends U.c{constructor(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,o=arguments.length>6?arguments[6]:void 0;const m=!i||i._isScene;super(null,m?i:null===i||void 0===i?void 0:i.lQ,m?!Z:i,o,C,void 0,void 0,void 0,void 0,B),this.name=k,this.wrapU=U.c.CLAMP_ADDRESSMODE,this.wrapV=U.c.CLAMP_ADDRESSMODE,this._generateMipMaps=Z;const O=this._getEngine();if(!O)return;if(Q.getContext)this._canvas=Q,this._ownCanvas=!1,this._texture=O.createDynamicTexture(this._canvas.width,this._canvas.height,Z,C);else{this._canvas=O.createCanvas(1,1),this._ownCanvas=!0;const k=Q;k.width||0===k.width?this._texture=O.createDynamicTexture(k.width,k.height,Z,C):this._texture=O.createDynamicTexture(Q,Q,Z,C)}const J=this.getSize();this._canvas.width!==J.width&&(this._canvas.width=J.width),this._canvas.height!==J.height&&(this._canvas.height=J.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(k){this._canvas.width=k.width,this._canvas.height=k.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(k.width,k.height,this._generateMipMaps,this.samplingMode)}scale(k){const Q=this.getSize();Q.width*=k,Q.height*=k,this._recreate(Q)}scaleTo(k,Q){const i=this.getSize();i.width=k,i.height=Q,this._recreate(i)}getContext(){return this._context}clear(k){const Q=this.getSize();k&&(this._context.fillStyle=k),this._context.clearRect(0,0,Q.width,Q.height)}update(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===k||k,Q,this._format||void 0,void 0,i)}drawText(k,Q,i,Z,U,C,B){let o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const m=this.getSize();if(C&&(this._context.fillStyle=C,this._context.fillRect(0,0,m.width,m.height)),this._context.font=Z,null===Q||void 0===Q){const i=this._context.measureText(k);Q=(m.width-i.width)/2}if(null===i||void 0===i){const k=parseInt(Z.replace(/\D/g,""));i=m.height/2+k/3.65}this._context.fillStyle=U||"",this._context.fillText(k,Q,i),o&&this.update(B)}dispose(){var k,Q;(super.dispose(),this._ownCanvas)&&(null===(k=this._canvas)||void 0===k||null===(Q=k.remove)||void 0===Q||Q.call(k));this._canvas=null,this._context=null}clone(){const k=this.sk();if(!k)return this;const Q=this.getSize(),i=new m(this.name,Q,k,this._generateMipMaps);return i.Uo=this.Uo,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i}serialize(){const k=this.sk();k&&!k.isReady()&&Z.c.Warn("The scene must be ready before serializing the dynamic texture");const Q=super.serialize();return m._IsCanvasElement(this._canvas)&&(Q.base64String=this._canvas.toDataURL()),Q.invertY=this._invertY,Q.samplingMode=this.samplingMode,Q}static _IsCanvasElement(k){return void 0!==k.toDataURL}_rebuild(){this.update()}}},12926:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>U});var Z=i(11273);class U extends Z.c{get depth(){return this._depth}constructor(k,Q,i,U,C,B){let o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],m=arguments.length>7&&void 0!==arguments[7]&&arguments[7],O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Z.c.TRILINEAR_SAMPLINGMODE,J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,G=arguments.length>10?arguments[10]:void 0;super(null,B,!o,m),this.format=C,this._texture=B.getEngine().createRawTexture2DArray(k,Q,i,U,C,o,m,O,null,J,G),this._depth=U,this.is2DArray=!0}update(k){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,k,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(k,Q,i,Z,C){return new U(k,Q,i,Z,5,C,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12741:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>o,f:()=>m,h:()=>C,k:()=>B});var Z=i(11311),U=i(11298);function C(k,Q){return`{X: ${k.x.toFixed(Q)} Y: ${k.y.toFixed(Q)}}`}function B(k,Q){return`{X: ${k._x.toFixed(Q)} Y: ${k._y.toFixed(Q)} Z: ${k._z.toFixed(Q)}}`}function o(k,Q){return 2*Math.acos((0,Z.Clamp)(U.Quaternion.Dot(k,Q)))}function m(k,Q){const i=new U.Quaternion;return function(k,Q,i){const C=U.zQ.Cross(k,Q),B=Math.acos((0,Z.Clamp)(U.zQ.Dot(k,Q),-1,1));U.Quaternion.RotationAxisToRef(C,B,i)}(k,Q,i),i}},12543:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>O});var Z=i(11298),U=i(11348),C=i(11734),B=i(11715),o=i(11363);i(12552);function m(k){let Q=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],C=[];let m=[];const O=k.width||k.size||1,J=k.height||k.size||1,G=k.depth||k.size||1,H=k.wrap||!1;let e=void 0===k.topBaseAt?1:k.topBaseAt,F=void 0===k.bottomBaseAt?0:k.bottomBaseAt;e=(e+4)%4,F=(F+4)%4;let z=[2,0,3,1][e],E=[2,0,1,3][F],l=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(H){Q=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],l=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let k=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],i=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const Z=[17,18,19,16],U=[22,23,20,21];for(;z>0;)k.unshift(k.pop()),Z.unshift(Z.pop()),z--;for(;E>0;)i.unshift(i.pop()),U.unshift(U.pop()),E--;k=k.flat(),i=i.flat(),l=l.concat(k).concat(i),Q.push(Z[0],Z[2],Z[3],Z[0],Z[1],Z[2]),Q.push(U[0],U[2],U[3],U[0],U[1],U[2])}const h=[O/2,J/2,G/2];m=l.reduce(((k,Q,i)=>k.concat(Q*h[i%3])),[]);const c=0===k.sideOrientation?0:k.sideOrientation||B.d.DEFAULTSIDE,f=k.faceUV||new Array(6),Y=k.faceColors,y=[];for(let B=0;B<6;B++)void 0===f[B]&&(f[B]=new Z.Vector4(0,0,1,1)),Y&&void 0===Y[B]&&(Y[B]=new U.Fo(1,1,1,1));for(let Z=0;Z<6;Z++)if(C.push(f[Z].z,o.d?1-f[Z].w:f[Z].w),C.push(f[Z].x,o.d?1-f[Z].w:f[Z].w),C.push(f[Z].x,o.d?1-f[Z].y:f[Z].y),C.push(f[Z].z,o.d?1-f[Z].y:f[Z].y),Y)for(let k=0;k<4;k++)y.push(Y[Z].r,Y[Z].g,Y[Z].b,Y[Z].a);B.d._ComputeSides(c,m,Q,i,C,k.frontUVs,k.backUVs);const L=new B.d;if(L.indices=Q,L.ak=m,L.jk=i,L.Kk=C,Y){const k=c===B.d.DOUBLESIDE?y.concat(y):y;L.Tk=k}return L}function O(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new C.d(k,i);Q.sideOrientation=C.d._GetDefaultSideOrientation(Q.sideOrientation),Z._originalBuilderSideOrientation=Q.sideOrientation;return m(Q).Nk(Z,Q.updatable),Z}B.d.CreateBox=m,C.d.CreateBox=function(k,Q){return O(k,{size:Q,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12727:(k,Q,i)=>{"use strict";i.d(Q,{b:()=>o});var Z=i(11734),U=i(11715),C=i(11363);function B(k){const Q=[],i=[],Z=[],B=[],o=k.radius||.5,m=k.tessellation||64,O=k.arc&&(k.arc<=0||k.arc>1)?1:k.arc||1,J=0===k.sideOrientation?0:k.sideOrientation||U.d.DEFAULTSIDE;Q.push(0,0,0),B.push(.5,.5);const G=2*Math.PI*O,H=1===O?G/m:G/(m-1);let e=0;for(let U=0;U<m;U++){const k=Math.cos(e),i=Math.sin(e),Z=(k+1)/2,U=(1-i)/2;Q.push(o*k,o*i,0),B.push(Z,C.d?1-U:U),e+=H}1===O&&(Q.push(Q[3],Q[4],Q[5]),B.push(B[2],C.d?1-B[3]:B[3]));const F=Q.length/3;for(let U=1;U<F-1;U++)i.push(U+1,0,U);U.d.ComputeNormals(Q,i,Z),U.d._ComputeSides(J,Q,i,Z,B,k.frontUVs,k.backUVs);const z=new U.d;return z.indices=i,z.ak=Q,z.jk=Z,z.Kk=B,z}function o(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new Z.d(k,i);Q.sideOrientation=Z.d._GetDefaultSideOrientation(Q.sideOrientation),U._originalBuilderSideOrientation=Q.sideOrientation;return B(Q).Nk(U,Q.updatable),U}U.d.CreateDisc=B,Z.d.CreateDisc=function(k,Q,i){return o(k,{radius:Q,tessellation:i,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12552:(k,Q,i)=>{"use strict";i.d(Q,{f:()=>E,e:()=>h,h:()=>l});var Z=i(11298),U=i(11348),C=i(11734),B=i(11715),o=i(11378);C.d._GroundMeshParser=(k,Q)=>m.Parse(k,Q);class m extends C.d{constructor(k,Q){super(k,Q),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=k,this._subdivisionsY=k,this.subdivide(k);const i=this;i.createOrUpdateSubmeshesOctree&&i.createOrUpdateSubmeshesOctree(Q)}getHeightAtCoordinates(k,Q){const i=this.getWorldMatrix(),U=Z.TmpVectors.Matrix[5];i.invertToRef(U);const C=Z.TmpVectors.zQ[8];if(Z.zQ.TransformCoordinatesFromFloatsToRef(k,0,Q,U,C),k=C.x,Q=C.z,k<this._minX||k>=this._maxX||Q<=this._minZ||Q>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const B=this._getFacetAt(k,Q),o=-(B.x*k+B.z*Q+B.w)/B.y;return Z.zQ.TransformCoordinatesFromFloatsToRef(0,o,0,i,C),C.y}getNormalAtCoordinates(k,Q){const i=new Z.zQ(0,1,0);return this.getNormalAtCoordinatesToRef(k,Q,i),i}getNormalAtCoordinatesToRef(k,Q,i){const U=this.getWorldMatrix(),C=Z.TmpVectors.Matrix[5];U.invertToRef(C);const B=Z.TmpVectors.zQ[8];if(Z.zQ.TransformCoordinatesFromFloatsToRef(k,0,Q,C,B),k=B.x,Q=B.z,k<this._minX||k>this._maxX||Q<this._minZ||Q>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const o=this._getFacetAt(k,Q);return Z.zQ.TransformNormalFromFloatsToRef(o.x,o.y,o.z,U,i),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(k,Q){const i=Math.floor((k+this._maxX)*this._subdivisionsX/this._width),Z=Math.floor(-(Q+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),U=this._heightQuads[Z*this._subdivisionsX+i];let C;return C=Q<U.slope.x*k+U.slope.y?U.facet1:U.facet2,C}_initHeightQuads(){const k=this._subdivisionsX,Q=this._subdivisionsY;this._heightQuads=[];for(let i=0;i<Q;i++)for(let Q=0;Q<k;Q++){const U={slope:Z.Vector2.Zero(),facet1:new Z.Vector4(0,0,0,0),facet2:new Z.Vector4(0,0,0,0)};this._heightQuads[i*k+Q]=U}return this}_computeHeightQuads(){const k=this.getVerticesData(o.h.PositionKind);if(!k)return this;const Q=Z.TmpVectors.zQ[3],i=Z.TmpVectors.zQ[2],U=Z.TmpVectors.zQ[1],C=Z.TmpVectors.zQ[0],B=Z.TmpVectors.zQ[4],m=Z.TmpVectors.zQ[5],O=Z.TmpVectors.zQ[6],J=Z.TmpVectors.zQ[7],G=Z.TmpVectors.zQ[8];let H=0,e=0,F=0,z=0,E=0,l=0,h=0;const c=this._subdivisionsX,f=this._subdivisionsY;for(let o=0;o<f;o++)for(let f=0;f<c;f++){H=3*f,e=o*(c+1)*3,F=(o+1)*(c+1)*3,Q.x=k[e+H],Q.y=k[e+H+1],Q.z=k[e+H+2],i.x=k[e+H+3],i.y=k[e+H+4],i.z=k[e+H+5],U.x=k[F+H],U.y=k[F+H+1],U.z=k[F+H+2],C.x=k[F+H+3],C.y=k[F+H+4],C.z=k[F+H+5],z=(C.z-Q.z)/(C.x-Q.x),E=Q.z-z*Q.x,i.subtractToRef(Q,B),U.subtractToRef(Q,m),C.subtractToRef(Q,O),Z.zQ.CrossToRef(O,m,J),Z.zQ.CrossToRef(B,O,G),J.normalize(),G.normalize(),l=-(J.x*Q.x+J.y*Q.y+J.z*Q.z),h=-(G.x*i.x+G.y*i.y+G.z*i.z);const Y=this._heightQuads[o*c+f];Y.slope.Go(z,E),Y.facet1.Go(J.x,J.y,J.z,l),Y.facet2.Go(G.x,G.y,G.z,h)}return this}serialize(k){super.serialize(k),k.subdivisionsX=this._subdivisionsX,k.subdivisionsY=this._subdivisionsY,k.minX=this._minX,k.maxX=this._maxX,k.Co=this._minZ,k.maxZ=this._maxZ,k.width=this._width,k.height=this._height}static Parse(k,Q){const i=new m(k.name,Q);return i._subdivisionsX=k.subdivisionsX||1,i._subdivisionsY=k.subdivisionsY||1,i._minX=k.minX,i._maxX=k.maxX,i._minZ=k.Co,i._maxZ=k.maxZ,i._width=k.width,i._height=k.height,i}}var O=i(11119),J=i(11157),G=i(11304),H=i(11363);function e(k){const Q=[],i=[],U=[],C=[];let o,m;const O=k.width||k.size||1,J=k.height||k.size||1,G=0|(k.subdivisionsX||k.subdivisions||1),e=0|(k.subdivisionsY||k.subdivisions||1);for(o=0;o<=e;o++)for(m=0;m<=G;m++){const k=new Z.zQ(m*O/G-O/2,0,(e-o)*J/e-J/2),Q=new Z.zQ(0,1,0);i.push(k.x,k.y,k.z),U.push(Q.x,Q.y,Q.z),C.push(m/G,H.d?o/e:1-o/e)}for(o=0;o<e;o++)for(m=0;m<G;m++)Q.push(m+1+(o+1)*(G+1)),Q.push(m+1+o*(G+1)),Q.push(m+o*(G+1)),Q.push(m+(o+1)*(G+1)),Q.push(m+1+(o+1)*(G+1)),Q.push(m+o*(G+1));const F=new B.d;return F.indices=Q,F.ak=i,F.jk=U,F.Kk=C,F}function F(k){const Q=void 0!==k.xmin&&null!==k.xmin?k.xmin:-1,i=void 0!==k.zmin&&null!==k.zmin?k.zmin:-1,U=void 0!==k.xmax&&null!==k.xmax?k.xmax:1,C=void 0!==k.zmax&&null!==k.zmax?k.zmax:1,o=k.subdivisions||{w:1,h:1},m=k.precision||{w:1,h:1},O=[],J=[],G=[],H=[];let e,F,z,E;o.h=o.h<1?1:o.h,o.w=o.w<1?1:o.w,m.w=m.w<1?1:m.w,m.h=m.h<1?1:m.h;const l=(U-Q)/o.w,h=(C-i)/o.h;function c(k,Q,i,U){const C=J.length/3,B=m.w+1;for(e=0;e<m.h;e++)for(F=0;F<m.w;F++){const k=[C+F+e*B,C+(F+1)+e*B,C+(F+1)+(e+1)*B,C+F+(e+1)*B];O.push(k[1]),O.push(k[2]),O.push(k[3]),O.push(k[0]),O.push(k[1]),O.push(k[3])}const o=Z.zQ.Zero(),z=new Z.zQ(0,1,0);for(e=0;e<=m.h;e++)for(o.z=e*(U-Q)/m.h+Q,F=0;F<=m.w;F++)o.x=F*(i-k)/m.w+k,o.y=0,J.push(o.x,o.y,o.z),G.push(z.x,z.y,z.z),H.push(F/m.w,e/m.h)}for(z=0;z<o.h;z++)for(E=0;E<o.w;E++)c(Q+E*l,i+z*h,Q+(E+1)*l,i+(z+1)*h);const f=new B.d;return f.indices=O,f.ak=J,f.jk=G,f.Kk=H,f}function z(k){const Q=[],i=[],C=[],o=[];let m,O;const J=k.colorFilter||new U.cQ(.3,.59,.11),H=k.alphaFilter||0;let e=!1;if(k.minHeight>k.maxHeight){e=!0;const Q=k.maxHeight;k.maxHeight=k.minHeight,k.minHeight=Q}for(m=0;m<=k.subdivisions;m++)for(O=0;O<=k.subdivisions;O++){const Q=new Z.zQ(O*k.width/k.subdivisions-k.width/2,0,(k.subdivisions-m)*k.height/k.subdivisions-k.height/2),U=4*(((Q.x+k.width/2)/k.width*(k.bufferWidth-1)|0)+((1-(Q.z+k.height/2)/k.height)*(k.bufferHeight-1)|0)*k.bufferWidth);let B=k.buffer[U]/255,F=k.buffer[U+1]/255,z=k.buffer[U+2]/255;const E=k.buffer[U+3]/255;e&&(B=1-B,F=1-F,z=1-z);const l=B*J.r+F*J.g+z*J.b;Q.y=E>=H?k.minHeight+(k.maxHeight-k.minHeight)*l:k.minHeight-G.e,k.heightBuffer&&(k.heightBuffer[m*(k.subdivisions+1)+O]=Q.y),i.push(Q.x,Q.y,Q.z),C.push(0,0,0),o.push(O/k.subdivisions,1-m/k.subdivisions)}for(m=0;m<k.subdivisions;m++)for(O=0;O<k.subdivisions;O++){const Z=O+1+(m+1)*(k.subdivisions+1),U=O+1+m*(k.subdivisions+1),C=O+m*(k.subdivisions+1),B=O+(m+1)*(k.subdivisions+1),o=i[3*Z+1]>=k.minHeight,J=i[3*U+1]>=k.minHeight,G=i[3*C+1]>=k.minHeight;o&&J&&G&&(Q.push(Z),Q.push(U),Q.push(C));i[3*B+1]>=k.minHeight&&o&&G&&(Q.push(B),Q.push(Z),Q.push(C))}B.d.ComputeNormals(i,Q,C);const F=new B.d;return F.indices=Q,F.ak=i,F.jk=C,F.Kk=o,F}function E(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new m(k,arguments.length>2?arguments[2]:void 0);i._setReady(!1),i._subdivisionsX=Q.subdivisionsX||Q.subdivisions||1,i._subdivisionsY=Q.subdivisionsY||Q.subdivisions||1,i._width=Q.width||1,i._height=Q.height||1,i._maxX=i._width/2,i._maxZ=i._height/2,i._minX=-i._maxX,i._minZ=-i._maxZ;return e(Q).Nk(i,Q.updatable),i._setReady(!0),i}function l(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new C.d(k,i);return F(Q).Nk(Z,Q.updatable),Z}function h(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const C=i.width||10,B=i.height||10,o=i.subdivisions||1,G=i.minHeight||0,H=i.maxHeight||1,e=i.colorFilter||new U.cQ(.3,.59,.11),F=i.alphaFilter||0,E=i.updatable,l=i.onReady;Z=Z||J.b.LastCreatedScene;const h=new m(k,Z);let c;h._subdivisionsX=o,h._subdivisionsY=o,h._width=C,h._height=B,h._maxX=h._width/2,h._maxZ=h._height/2,h._minX=-h._maxX,h._minZ=-h._maxZ,h._setReady(!1),i.passHeightBufferInCallback&&(c=new Float32Array((o+1)*(o+1)));const f=(k,Q,i)=>{z({width:C,height:B,subdivisions:o,minHeight:G,maxHeight:H,colorFilter:e,buffer:k,bufferWidth:Q,bufferHeight:i,alphaFilter:F,heightBuffer:c}).Nk(h,E),l&&l(h,c),h._setReady(!0)};if("string"===typeof Q){const k=k=>{var Q;const i=k.width,U=k.height;if(Z.J)return;const C=null===(Q=Z)||void 0===Q?void 0:Q.getEngine().resizeImageBitmap(k,i,U);f(C,i,U)};O.Tools.LoadImage(Q,k,i.onError?i.onError:()=>{},Z.offlineProvider)}else f(Q.data,Q.width,Q.height);return h}B.d.CreateGround=e,B.d.CreateTiledGround=F,B.d.CreateGroundFromHeightMap=z,C.d.CreateGround=(k,Q,i,Z,U,C)=>E(k,{width:Q,height:i,subdivisions:Z,updatable:C},U),C.d.CreateTiledGround=(k,Q,i,Z,U,C,B,o,m)=>l(k,{xmin:Q,zmin:i,xmax:Z,zmax:U,subdivisions:C,precision:B,updatable:m},o),C.d.CreateGroundFromHeightMap=(k,Q,i,Z,U,C,B,o,m,O,J)=>h(k,Q,{width:i,height:Z,subdivisions:U,minHeight:C,maxHeight:B,updatable:m,onReady:O,alphaFilter:J},o)},13247:(k,Q,i)=>{"use strict";i.d(Q,{c:()=>e,g:()=>G,h:()=>H});var Z=i(11298),U=i(11734),C=i(11715),B=i(11833),o=i(11378),m=i(11134);function O(k){const Q=[],i=[],Z=k.lines,U=k.Tk,B=[];let o=0;for(let C=0;C<Z.length;C++){const k=Z[C];for(let Z=0;Z<k.length;Z++){const{x:m,y:O,z:J}=k[Z];if(i.push(m,O,J),U){const k=U[C],{r:Q,g:i,b:o,a:m}=k[Z];B.push(Q,i,o,m)}Z>0&&(Q.push(o-1),Q.push(o)),o++}}const m=new C.d;return m.indices=Q,m.ak=i,U&&(m.Tk=B),m}function J(k){const Q=k.dashSize||3,i=k.gapSize||1,U=k.dashNb||200,B=k.points,o=[],m=[],O=Z.zQ.Zero();let J=0,G=0,H=0,e=0,F=0,z=0,E=0;for(E=0;E<B.length-1;E++)B[E+1].subtractToRef(B[E],O),J+=O.length();for(H=J/U,e=Q*H/(Q+i),E=0;E<B.length-1;E++){B[E+1].subtractToRef(B[E],O),G=Math.floor(O.length()/H),O.normalize();for(let k=0;k<G;k++)F=H*k,o.push(B[E].x+F*O.x,B[E].y+F*O.y,B[E].z+F*O.z),o.push(B[E].x+(F+e)*O.x,B[E].y+(F+e)*O.y,B[E].z+(F+e)*O.z),m.push(z,z+1),z+=2}const l=new C.d;return l.ak=o,l.indices=m,l}function G(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=Q.instance,U=Q.lines,C=Q.Tk;if(Z){const k=Z.getVerticesData(o.h.PositionKind);let Q,i;C&&(Q=Z.getVerticesData(o.h.ColorKind));let B=0,m=0;for(let Z=0;Z<U.length;Z++){const o=U[Z];for(let U=0;U<o.length;U++)k[B]=o[U].x,k[B+1]=o[U].y,k[B+2]=o[U].z,C&&Q&&(i=C[Z],Q[m]=i[U].r,Q[m+1]=i[U].g,Q[m+2]=i[U].b,Q[m+3]=i[U].a,m+=4),B+=3}return Z.updateVerticesData(o.h.PositionKind,k,!1,!1),C&&Q&&Z.updateVerticesData(o.h.ColorKind,Q,!1,!1),Z.refreshBoundingInfo(),Z}const m=!!C,J=new B.d(k,i,null,void 0,void 0,m,Q.useVertexAlpha,Q.material);return O(Q).Nk(J,Q.updatable),J}function H(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=Q.Tk?[Q.Tk]:null;return G(k,{lines:[Q.points],updatable:Q.updatable,instance:Q.instance,Tk:Z,useVertexAlpha:Q.useVertexAlpha,material:Q.material},i)}function e(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=Q.points,o=Q.instance,O=Q.gapSize||1,G=Q.dashSize||3;if(o){const k=k=>{const Q=Z.zQ.Zero(),i=k.length/6;let U=0,B=0,m=0,O=0,J=0,G=0,H=0,e=0;for(H=0;H<C.length-1;H++)C[H+1].subtractToRef(C[H],Q),U+=Q.length();m=U/i;const F=o._creationDataStorage.dashSize;for(O=F*m/(F+o._creationDataStorage.gapSize),H=0;H<C.length-1;H++)for(C[H+1].subtractToRef(C[H],Q),B=Math.floor(Q.length()/m),Q.normalize(),e=0;e<B&&G<k.length;)J=m*e,k[G]=C[H].x+J*Q.x,k[G+1]=C[H].y+J*Q.y,k[G+2]=C[H].z+J*Q.z,k[G+3]=C[H].x+(J+O)*Q.x,k[G+4]=C[H].y+(J+O)*Q.y,k[G+5]=C[H].z+(J+O)*Q.z,G+=6,e++;for(;G<k.length;)k[G]=C[H].x,k[G+1]=C[H].y,k[G+2]=C[H].z,G+=3};return(Q.dashNb||Q.dashSize||Q.gapSize||Q.useVertexAlpha||Q.material)&&m.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),o.updateMeshPositions(k,!1),o}const H=new B.d(k,i,null,void 0,void 0,void 0,Q.useVertexAlpha,Q.material);return J(Q).Nk(H,Q.updatable),H._creationDataStorage=new U.f,H._creationDataStorage.dashSize=G,H._creationDataStorage.gapSize=O,H}C.d.CreateLineSystem=O,C.d.CreateDashedLines=J,U.d.HO=function(k,Q){return H(k,{points:Q,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},U.d.CreateDashedLines=function(k,Q,i,Z,U){return e(k,{points:Q,dashSize:i,gapSize:Z,dashNb:U,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12609:(k,Q,i)=>{"use strict";i.d(Q,{b:()=>o,f:()=>m});var Z=i(11734),U=i(11715),C=i(11363);function B(k){const Q=[],i=[],Z=[],B=[],o=void 0!==k.width?k.width:void 0!==k.size?k.size:1,m=void 0!==k.height?k.height:void 0!==k.size?k.size:1,O=0===k.sideOrientation?0:k.sideOrientation||U.d.DEFAULTSIDE,J=o/2,G=m/2;i.push(-J,-G,0),Z.push(0,0,-1),B.push(0,C.d?1:0),i.push(J,-G,0),Z.push(0,0,-1),B.push(1,C.d?1:0),i.push(J,G,0),Z.push(0,0,-1),B.push(1,C.d?0:1),i.push(-J,G,0),Z.push(0,0,-1),B.push(0,C.d?0:1),Q.push(0),Q.push(1),Q.push(2),Q.push(0),Q.push(2),Q.push(3),U.d._ComputeSides(O,i,Q,Z,B,k.frontUVs,k.backUVs);const H=new U.d;return H.indices=Q,H.ak=i,H.jk=Z,H.Kk=B,H}function o(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new Z.d(k,i);Q.sideOrientation=Z.d._GetDefaultSideOrientation(Q.sideOrientation),U._originalBuilderSideOrientation=Q.sideOrientation;return B(Q).Nk(U,Q.updatable),Q.sourcePlane&&(U.translate(Q.sourcePlane.normal,-Q.sourcePlane.d),U.setDirection(Q.sourcePlane.normal.scale(-1))),U}const m={zO:o};U.d.zO=B,Z.d.zO=(k,Q,i,Z,U)=>o(k,{size:Q,width:Q,height:Q,sideOrientation:U,updatable:Z},i)},12712:(k,Q,i)=>{"use strict";i.d(Q,{c:()=>m});var Z=i(11298),U=i(11734),C=i(11715),B=i(11363);function o(k){const Q=0|(k.segments||32),i=k.diameterX||k.diameter||1,U=k.diameterY||k.diameter||1,o=k.diameterZ||k.diameter||1,m=k.arc&&(k.arc<=0||k.arc>1)?1:k.arc||1,O=k.slice&&k.slice<=0?1:k.slice||1,J=0===k.sideOrientation?0:k.sideOrientation||C.d.DEFAULTSIDE,G=!!k.dedupTopBottomIndices,H=new Z.zQ(i/2,U/2,o/2),e=2+Q,F=2*e,z=[],E=[],l=[],h=[];for(let C=0;C<=e;C++){const k=C/e,Q=k*Math.PI*O;for(let i=0;i<=F;i++){const U=i/F,C=U*Math.PI*2*m,o=Z.Matrix.RotationZ(-Q),O=Z.Matrix.RotationY(C),J=Z.zQ.TransformCoordinates(Z.zQ.Up(),o),G=Z.zQ.TransformCoordinates(J,O),e=G.multiply(H),z=G.divide(H).normalize();E.push(e.x,e.y,e.z),l.push(z.x,z.y,z.z),h.push(U,B.d?1-k:k)}if(C>0){const k=E.length/3;for(let Q=k-2*(F+1);Q+F+2<k;Q++)G?(C>1&&(z.push(Q),z.push(Q+1),z.push(Q+F+1)),(C<e||O<1)&&(z.push(Q+F+1),z.push(Q+1),z.push(Q+F+2))):(z.push(Q),z.push(Q+1),z.push(Q+F+1),z.push(Q+F+1),z.push(Q+1),z.push(Q+F+2))}}C.d._ComputeSides(J,E,z,l,h,k.frontUVs,k.backUVs);const c=new C.d;return c.indices=z,c.ak=E,c.jk=l,c.Kk=h,c}function m(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new U.d(k,i);Q.sideOrientation=U.d._GetDefaultSideOrientation(Q.sideOrientation),Z._originalBuilderSideOrientation=Q.sideOrientation;return o(Q).Nk(Z,Q.updatable),Z}C.d.CreateSphere=o,U.d.CreateSphere=(k,Q,i,Z,U,C)=>m(k,{segments:Q,diameterX:i,diameterY:i,diameterZ:i,sideOrientation:C,updatable:U},Z)},13552:(k,Q,i)=>{"use strict";i.d(Q,{b:()=>o});var Z=i(11854),U=i(13038),C=i(11867),B=i(11715);class o{static get Configuration(){return{get decoder(){return U.b.DefaultConfiguration},set decoder(k){U.b.DefaultConfiguration=k}}}static set Configuration(k){U.b.DefaultConfiguration=k.decoder}static get DecoderAvailable(){return(0,Z.l)(U.b.DefaultConfiguration)}static get Default(){return o._Default??(o._Default=new o),o._Default}static ResetDefault(k){o._Default&&(k||o._Default.dispose(),o._Default=null)}constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.DefaultNumWorkers;const Q="number"===typeof k?{...U.b.DefaultConfiguration,numWorkers:k}:{...U.b.DefaultConfiguration,...k};this._decoder=new U.b(Q)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(k,Q,i){return this._decoder.decodeMeshToMeshDataAsync(k,Q,i)}async decodeMeshToGeometryAsync(k,Q,i,Z){return await this._decoder.decodeMeshToGeometryAsync(k,Q,i,Z)}async _decodeMeshToGeometryForGltfAsync(k,Q,i,Z,U,C){return await this._decoder._decodeMeshToGeometryForGltfAsync(k,Q,i,Z,U,C)}async decodeMeshAsync(k,Q){const i=await this._decoder.decodeMeshToMeshDataAsync(k,Q),Z=new B.d;i.indices&&(Z.indices=i.indices);for(const U of i.attributes){const k=C.e.GetFloatData(U.data,U.size,C.e.GetDataType(U.data),U.byteOffset,U.byteStride,U.normalized,i.totalVertices);Z.set(k,U.kind)}return Z}}o.DefaultNumWorkers=(0,Z.i)(),o._Default=null},13038:(k,Q,i)=>{"use strict";i.d(Q,{b:()=>O});var Z=i(11854),U=i(11119),C=i(11745),B=i(11867),o=i(11134),m=i(11860);class O extends Z.e{static get DefaultAvailable(){return(0,Z.l)(O.DefaultConfiguration)}static get Default(){return O._Default??(O._Default=new O),O._Default}static ResetDefault(k){O._Default&&(k||O._Default.dispose(),O._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(k,Q){return{module:await(Q||DracoDecoderModule)({wasmBinary:k})}}_getWorkerContent(){return`${m.e}(${m.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.DefaultConfiguration)}decodeMeshToMeshDataAsync(k,Q,i){const Z=k instanceof ArrayBuffer?new Int8Array(k):new Int8Array(k.buffer,k.byteOffset,k.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async k=>await new Promise(((U,C)=>{k.push(((k,B)=>{let m=null;const O=[],J=Q=>{k.removeEventListener("error",J),k.removeEventListener("message",G),C(Q),B()},G=Q=>{const Z=Q.data;switch(Z.id){case"indices":m=Z.data;break;case"attribute":O.push({kind:Z.kind,data:Z.data,size:Z.size,byteOffset:Z.byteOffset,byteStride:Z.byteStride,normalized:(C=Z.kind,H=Z.normalized,i&&void 0!==i[C]?(H!==i[C]&&o.c.Warn(`Normalized flag from Draco data (${H}) does not match normalized flag from glTF accessor (${i[C]}). Using flag from glTF accessor.`),i[C]):H)});break;case"decodeMeshDone":k.removeEventListener("error",J),k.removeEventListener("message",G),U({indices:m,attributes:O,totalVertices:Z.totalVertices}),B()}var C,H};k.addEventListener("error",J),k.addEventListener("message",G);const H=Z.slice();k.postMessage({id:"decodeMesh",dataView:H,attributes:Q},[H.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((k=>{let i=null;const U=[],C=(0,m.e)(k.module,Z,Q,(k=>{i=k}),((k,Q,i,Z,C,B)=>{U.push({kind:k,data:Q,size:i,byteOffset:Z,byteStride:C,normalized:B})}));return{indices:i,attributes:U,totalVertices:C}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(k,Q,i,Z){const U=await this.decodeMeshToMeshDataAsync(i,Z),o=new C.e(k,Q);U.indices&&o.setIndices(U.indices);for(const C of U.attributes)o.setVerticesBuffer(new B.e(Q.getEngine(),C.data,C.kind,!1,void 0,C.byteStride,void 0,C.byteOffset,C.size,void 0,C.normalized,!0),U.totalVertices);return o}async _decodeMeshToGeometryForGltfAsync(k,Q,i,Z,U,o){const m=await this.decodeMeshToMeshDataAsync(i,Z,U),O=new C.e(k,Q);o&&(O._boundingInfo=o,O.useBoundingInfoFromGeometry=!0),m.indices&&O.setIndices(m.indices);for(const C of m.attributes)O.setVerticesBuffer(new B.e(Q.getEngine(),C.data,C.kind,!1,void 0,C.byteStride,void 0,C.byteOffset,C.size,void 0,C.normalized,!0),m.totalVertices);return O}}O.DefaultConfiguration={wasmUrl:`${U.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${U.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${U.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},O._Default=null},13242:(k,Q,i)=>{"use strict";i.d(Q,{b:()=>ok});var Z=i(11298),U=i(11734),C=i(11378),B=i(11715),o=i(11363);function m(k){let Q=k.pathArray;const i=k.closeArray||!1,Z=k.closePath||!1,U=k.invertUV||!1,m=Math.floor(Q[0].length/2);let O=k.offset||m;O=O>m?m:Math.floor(O);const J=0===k.sideOrientation?0:k.sideOrientation||B.d.DEFAULTSIDE,G=k.Kk,H=k.Tk,e=[],F=[],z=[],E=[],l=[],h=[],c=[],f=[];let Y;const y=[],L=[];let s,u,a;if(Q.length<2){const k=[],i=[];for(u=0;u<Q[0].length-O;u++)k.push(Q[0][u]),i.push(Q[0][u+O]);Q=[k,i]}let j=0;const T=Z?1:0,K=i?1:0;let v,N,X,p,d,b;for(Y=Q[0].length,s=0;s<Q.length+K;s++){for(c[s]=0,l[s]=[0],v=s===Q.length?Q[0]:Q[s],N=v.length,Y=Y<N?Y:N,a=0;a<N;)e.push(v[a].x,v[a].y,v[a].z),a>0&&(X=v[a].EQ(v[a-1]).length(),p=X+c[s],l[s].push(p),c[s]=p),a++;Z&&(a--,e.push(v[0].x,v[0].y,v[0].z),X=v[a].EQ(v[0]).length(),p=X+c[s],l[s].push(p),c[s]=p),y[s]=N+T,L[s]=j,j+=N+T}let D,M,W=null,A=null;for(u=0;u<Y+T;u++)for(f[u]=0,h[u]=[0],s=0;s<Q.length-1+K;s++)d=Q[s],b=s===Q.length-1?Q[0]:Q[s+1],u===Y?(W=d[0],A=b[0]):(W=d[u],A=b[u]),X=A.EQ(W).length(),p=X+f[u],h[u].push(p),f[u]=p;if(G)for(s=0;s<G.length;s++)E.push(G[s].x,o.d?1-G[s].y:G[s].y);else for(s=0;s<Q.length+K;s++)for(u=0;u<Y+T;u++)D=0!=c[s]?l[s][u]/c[s]:0,M=0!=f[u]?h[u][s]/f[u]:0,U?E.push(M,D):E.push(D,o.d?1-M:M);s=0;let g=0,R=y[s]-1,w=y[s+1]-1,S=R<w?R:w,q=L[1]-L[0];const P=y.length-1;for(;g<=S&&s<P;)F.push(g,g+q,g+1),F.push(g+q+1,g+1,g+q),g+=1,g===S&&(s++,q=L[s+1]-L[s],R=y[s]-1,w=y[s+1]-1,g=L[s],S=R<w?R+g:w+g);if(B.d.ComputeNormals(e,F,z),Z){let k=0,i=0;for(s=0;s<Q.length;s++){k=3*L[s],i=s+1<Q.length?3*(L[s+1]-1):z.length-3,z[k]=.5*(z[k]+z[i]),z[k+1]=.5*(z[k+1]+z[i+1]),z[k+2]=.5*(z[k+2]+z[i+2]);const Z=Math.sqrt(z[k]*z[k]+z[k+1]*z[k+1]+z[k+2]*z[k+2]);z[k]/=Z,z[k+1]/=Z,z[k+2]/=Z,z[i]=z[k],z[i+1]=z[k+1],z[i+2]=z[k+2]}}if(i){let k=3*L[0],i=3*L[Q.length];for(u=0;u<Y+T;u++){z[k]=.5*(z[k]+z[i]),z[k+1]=.5*(z[k+1]+z[i+1]),z[k+2]=.5*(z[k+2]+z[i+2]);const Q=Math.sqrt(z[k]*z[k]+z[k+1]*z[k+1]+z[k+2]*z[k+2]);z[k]/=Q,z[k+1]/=Q,z[k+2]/=Q,z[i]=z[k],z[i+1]=z[k+1],z[i+2]=z[k+2],k+=3,i+=3}}B.d._ComputeSides(J,e,F,z,E,k.frontUVs,k.backUVs);let t=null;if(H){t=new Float32Array(4*H.length);for(let k=0;k<H.length;k++)t[4*k]=H[k].r,t[4*k+1]=H[k].g,t[4*k+2]=H[k].b,t[4*k+3]=H[k].a}const I=new B.d,r=new Float32Array(e),n=new Float32Array(z),x=new Float32Array(E);return I.indices=F,I.ak=r,I.jk=n,I.Kk=x,t&&I.set(t,C.h.ColorKind),Z&&(I._idx=L),I}function O(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=Q.pathArray,J=Q.closeArray,G=Q.closePath,H=U.d._GetDefaultSideOrientation(Q.sideOrientation),e=Q.instance,F=Q.updatable;if(e){const k=Z.TmpVectors.zQ[0].eo(Number.MAX_VALUE),i=Z.TmpVectors.zQ[1].eo(-Number.MAX_VALUE),m=Q=>{let Z=O[0].length;const C=e;let B=0;const o=C._originalBuilderSideOrientation===U.d.DOUBLESIDE?2:1;for(let U=1;U<=o;++U)for(let o=0;o<O.length;++o){const U=O[o],m=U.length;Z=Z<m?Z:m;for(let C=0;C<Z;++C){const Z=U[C];Q[B]=Z.x,Q[B+1]=Z.y,Q[B+2]=Z.z,k.minimizeInPlaceFromFloats(Z.x,Z.y,Z.z),i.maximizeInPlaceFromFloats(Z.x,Z.y,Z.z),B+=3}if(C._creationDataStorage&&C._creationDataStorage.closePath){const k=U[0];Q[B]=k.x,Q[B+1]=k.y,Q[B+2]=k.z,B+=3}}},J=e.getVerticesData(C.h.PositionKind);if(m(J),e.hasBoundingInfo?e.getBoundingInfo().reConstruct(k,i,e._worldMatrix):e.buildBoundingInfo(k,i,e._worldMatrix),e.updateVerticesData(C.h.PositionKind,J,!1,!1),Q.Tk){const k=e.getVerticesData(C.h.ColorKind);for(let i=0,Z=0;i<Q.Tk.length;i++,Z+=4){const U=Q.Tk[i];k[Z]=U.r,k[Z+1]=U.g,k[Z+2]=U.b,k[Z+3]=U.a}e.updateVerticesData(C.h.ColorKind,k,!1,!1)}if(Q.Kk){const k=e.getVerticesData(C.h.UVKind);for(let i=0;i<Q.Kk.length;i++)k[2*i]=Q.Kk[i].x,k[2*i+1]=o.d?1-Q.Kk[i].y:Q.Kk[i].y;e.updateVerticesData(C.h.UVKind,k,!1,!1)}if(!e.areNormalsFrozen||e.isFacetDataEnabled){const k=e.Oo(),Q=e.getVerticesData(C.h.NormalKind),i=e.isFacetDataEnabled?e.getFacetDataParameters():null;if(B.d.ComputeNormals(J,k,Q,i),e._creationDataStorage&&e._creationDataStorage.closePath){let k=0,i=0;for(let Z=0;Z<O.length;Z++)k=3*e._creationDataStorage.idx[Z],i=Z+1<O.length?3*(e._creationDataStorage.idx[Z+1]-1):Q.length-3,Q[k]=.5*(Q[k]+Q[i]),Q[k+1]=.5*(Q[k+1]+Q[i+1]),Q[k+2]=.5*(Q[k+2]+Q[i+2]),Q[i]=Q[k],Q[i+1]=Q[k+1],Q[i+2]=Q[k+2]}e.areNormalsFrozen||e.updateVerticesData(C.h.NormalKind,Q,!1,!1)}return e}{const Z=new U.d(k,i);Z._originalBuilderSideOrientation=H,Z._creationDataStorage=new U.f;const C=m(Q);return G&&(Z._creationDataStorage.idx=C._idx),Z._creationDataStorage.closePath=G,Z._creationDataStorage.closeArray=J,C.Nk(Z,F),Z}}B.d.CreateRibbon=m,U.d.CreateRibbon=function(k,Q){return O(k,{pathArray:Q,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var J=i(12727),G=i(12543),H=i(11348);function e(k){const Q=k.pattern||U.d.NO_FLIP,i=k.tileWidth||k.tileSize||1,Z=k.tileHeight||k.tileSize||1,C=k.alignHorizontal||0,o=k.alignVertical||0,m=k.width||k.size||1,O=Math.floor(m/i);let J=m-O*i;const G=k.height||k.size||1,H=Math.floor(G/Z);let e=G-H*Z;const F=i*O/2,z=Z*H/2;let E=0,l=0,h=0,c=0,f=0,Y=0;if(J>0||e>0){switch(h=-F,c=-z,f=F,Y=z,C){case U.d.CENTER:J/=2,h-=J,f+=J;break;case U.d.LEFT:f+=J,E=-J/2;break;case U.d.RIGHT:h-=J,E=J/2}switch(o){case U.d.CENTER:e/=2,c-=e,Y+=e;break;case U.d.BOTTOM:Y+=e,l=-e/2;break;case U.d.TOP:c-=e,l=e/2}}const y=[],L=[],s=[];s[0]=[0,0,1,0,1,1,0,1],s[1]=[0,0,1,0,1,1,0,1],Q!==U.d.ROTATE_TILE&&Q!==U.d.ROTATE_ROW||(s[1]=[1,1,0,1,0,0,1,0]),Q!==U.d.FLIP_TILE&&Q!==U.d.FLIP_ROW||(s[1]=[1,0,0,0,0,1,1,1]),Q!==U.d.FLIP_N_ROTATE_TILE&&Q!==U.d.FLIP_N_ROTATE_ROW||(s[1]=[0,1,1,1,1,0,0,0]);let u=[];const a=[],j=[];let T=0;for(let B=0;B<H;B++)for(let k=0;k<O;k++)y.push(k*i-F+E,B*Z-z+l,0),y.push((k+1)*i-F+E,B*Z-z+l,0),y.push((k+1)*i-F+E,(B+1)*Z-z+l,0),y.push(k*i-F+E,(B+1)*Z-z+l,0),j.push(T,T+1,T+3,T+1,T+2,T+3),u=Q===U.d.FLIP_TILE||Q===U.d.ROTATE_TILE||Q===U.d.FLIP_N_ROTATE_TILE?u.concat(s[(k%2+B%2)%2]):Q===U.d.FLIP_ROW||Q===U.d.ROTATE_ROW||Q===U.d.FLIP_N_ROTATE_ROW?u.concat(s[B%2]):u.concat(s[0]),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),L.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),T+=4;if(J>0||e>0){const k=e>0&&(o===U.d.CENTER||o===U.d.TOP),B=e>0&&(o===U.d.CENTER||o===U.d.BOTTOM),m=J>0&&(C===U.d.CENTER||C===U.d.RIGHT),G=J>0&&(C===U.d.CENTER||C===U.d.LEFT);let s,K,v,N,X=[];if(k&&m&&(y.push(h+E,c+l,0),y.push(-F+E,c+l,0),y.push(-F+E,c+e+l,0),y.push(h+E,c+e+l,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,s=1-J/i,K=1-e/Z,v=1,N=1,X=[s,K,v,K,v,N,s,N],Q===U.d.ROTATE_ROW&&(X=[1-s,1-K,1-v,1-K,1-v,1-N,1-s,1-N]),Q===U.d.FLIP_ROW&&(X=[1-s,K,1-v,K,1-v,N,1-s,N]),Q===U.d.FLIP_N_ROTATE_ROW&&(X=[s,1-K,v,1-K,v,1-N,s,1-N]),u=u.concat(X),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),L.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),k&&G&&(y.push(F+E,c+l,0),y.push(f+E,c+l,0),y.push(f+E,c+e+l,0),y.push(F+E,c+e+l,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,s=0,K=1-e/Z,v=J/i,N=1,X=[s,K,v,K,v,N,s,N],(Q===U.d.ROTATE_ROW||Q===U.d.ROTATE_TILE&&O%2===0)&&(X=[1-s,1-K,1-v,1-K,1-v,1-N,1-s,1-N]),(Q===U.d.FLIP_ROW||Q===U.d.FLIP_TILE&&O%2===0)&&(X=[1-s,K,1-v,K,1-v,N,1-s,N]),(Q===U.d.FLIP_N_ROTATE_ROW||Q===U.d.FLIP_N_ROTATE_TILE&&O%2===0)&&(X=[s,1-K,v,1-K,v,1-N,s,1-N]),u=u.concat(X),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),L.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&m&&(y.push(h+E,z+l,0),y.push(-F+E,z+l,0),y.push(-F+E,Y+l,0),y.push(h+E,Y+l,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,s=1-J/i,K=0,v=1,N=e/Z,X=[s,K,v,K,v,N,s,N],(Q===U.d.ROTATE_ROW&&H%2===1||Q===U.d.ROTATE_TILE&&H%1===0)&&(X=[1-s,1-K,1-v,1-K,1-v,1-N,1-s,1-N]),(Q===U.d.FLIP_ROW&&H%2===1||Q===U.d.FLIP_TILE&&H%2===0)&&(X=[1-s,K,1-v,K,1-v,N,1-s,N]),(Q===U.d.FLIP_N_ROTATE_ROW&&H%2===1||Q===U.d.FLIP_N_ROTATE_TILE&&H%2===0)&&(X=[s,1-K,v,1-K,v,1-N,s,1-N]),u=u.concat(X),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),L.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&G&&(y.push(F+E,z+l,0),y.push(f+E,z+l,0),y.push(f+E,Y+l,0),y.push(F+E,Y+l,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,s=0,K=0,v=J/i,N=e/Z,X=[s,K,v,K,v,N,s,N],(Q===U.d.ROTATE_ROW&&H%2===1||Q===U.d.ROTATE_TILE&&(H+O)%2===1)&&(X=[1-s,1-K,1-v,1-K,1-v,1-N,1-s,1-N]),(Q===U.d.FLIP_ROW&&H%2===1||Q===U.d.FLIP_TILE&&(H+O)%2===1)&&(X=[1-s,K,1-v,K,1-v,N,1-s,N]),(Q===U.d.FLIP_N_ROTATE_ROW&&H%2===1||Q===U.d.FLIP_N_ROTATE_TILE&&(H+O)%2===1)&&(X=[s,1-K,v,1-K,v,1-N,s,1-N]),u=u.concat(X),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),L.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),k){const k=[];s=0,K=1-e/Z,v=1,N=1,k[0]=[s,K,v,K,v,N,s,N],k[1]=[s,K,v,K,v,N,s,N],Q!==U.d.ROTATE_TILE&&Q!==U.d.ROTATE_ROW||(k[1]=[1-s,1-K,1-v,1-K,1-v,1-N,1-s,1-N]),Q!==U.d.FLIP_TILE&&Q!==U.d.FLIP_ROW||(k[1]=[1-s,K,1-v,K,1-v,N,1-s,N]),Q!==U.d.FLIP_N_ROTATE_TILE&&Q!==U.d.FLIP_N_ROTATE_ROW||(k[1]=[s,1-K,v,1-K,v,1-N,s,1-N]);for(let Z=0;Z<O;Z++)y.push(Z*i-F+E,c+l,0),y.push((Z+1)*i-F+E,c+l,0),y.push((Z+1)*i-F+E,c+e+l,0),y.push(Z*i-F+E,c+e+l,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,u=Q===U.d.FLIP_TILE||Q===U.d.ROTATE_TILE||Q===U.d.FLIP_N_ROTATE_TILE?u.concat(k[(Z+1)%2]):Q===U.d.FLIP_ROW||Q===U.d.ROTATE_ROW||Q===U.d.FLIP_N_ROTATE_ROW?u.concat(k[1]):u.concat(k[0]),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),L.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(B){const k=[];s=0,K=0,v=1,N=e/Z,k[0]=[s,K,v,K,v,N,s,N],k[1]=[s,K,v,K,v,N,s,N],Q!==U.d.ROTATE_TILE&&Q!==U.d.ROTATE_ROW||(k[1]=[1-s,1-K,1-v,1-K,1-v,1-N,1-s,1-N]),Q!==U.d.FLIP_TILE&&Q!==U.d.FLIP_ROW||(k[1]=[1-s,K,1-v,K,1-v,N,1-s,N]),Q!==U.d.FLIP_N_ROTATE_TILE&&Q!==U.d.FLIP_N_ROTATE_ROW||(k[1]=[s,1-K,v,1-K,v,1-N,s,1-N]);for(let Z=0;Z<O;Z++)y.push(Z*i-F+E,Y-e+l,0),y.push((Z+1)*i-F+E,Y-e+l,0),y.push((Z+1)*i-F+E,Y+l,0),y.push(Z*i-F+E,Y+l,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,u=Q===U.d.FLIP_TILE||Q===U.d.ROTATE_TILE||Q===U.d.FLIP_N_ROTATE_TILE?u.concat(k[(Z+H)%2]):Q===U.d.FLIP_ROW||Q===U.d.ROTATE_ROW||Q===U.d.FLIP_N_ROTATE_ROW?u.concat(k[H%2]):u.concat(k[0]),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),L.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(m){const k=[];s=1-J/i,K=0,v=1,N=1,k[0]=[s,K,v,K,v,N,s,N],k[1]=[s,K,v,K,v,N,s,N],Q!==U.d.ROTATE_TILE&&Q!==U.d.ROTATE_ROW||(k[1]=[1-s,1-K,1-v,1-K,1-v,1-N,1-s,1-N]),Q!==U.d.FLIP_TILE&&Q!==U.d.FLIP_ROW||(k[1]=[1-s,K,1-v,K,1-v,N,1-s,N]),Q!==U.d.FLIP_N_ROTATE_TILE&&Q!==U.d.FLIP_N_ROTATE_ROW||(k[1]=[s,1-K,v,1-K,v,1-N,s,1-N]);for(let i=0;i<H;i++)y.push(h+E,i*Z-z+l,0),y.push(h+J+E,i*Z-z+l,0),y.push(h+J+E,(i+1)*Z-z+l,0),y.push(h+E,(i+1)*Z-z+l,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,u=Q===U.d.FLIP_TILE||Q===U.d.ROTATE_TILE||Q===U.d.FLIP_N_ROTATE_TILE?u.concat(k[(i+1)%2]):Q===U.d.FLIP_ROW||Q===U.d.ROTATE_ROW||Q===U.d.FLIP_N_ROTATE_ROW?u.concat(k[i%2]):u.concat(k[0]),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),L.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(G){const k=[];s=0,K=0,v=J/Z,N=1,k[0]=[s,K,v,K,v,N,s,N],k[1]=[s,K,v,K,v,N,s,N],Q!==U.d.ROTATE_TILE&&Q!==U.d.ROTATE_ROW||(k[1]=[1-s,1-K,1-v,1-K,1-v,1-N,1-s,1-N]),Q!==U.d.FLIP_TILE&&Q!==U.d.FLIP_ROW||(k[1]=[1-s,K,1-v,K,1-v,N,1-s,N]),Q!==U.d.FLIP_N_ROTATE_TILE&&Q!==U.d.FLIP_N_ROTATE_ROW||(k[1]=[s,1-K,v,1-K,v,1-N,s,1-N]);for(let i=0;i<H;i++)y.push(f-J+E,i*Z-z+l,0),y.push(f+E,i*Z-z+l,0),y.push(f+E,(i+1)*Z-z+l,0),y.push(f-J+E,(i+1)*Z-z+l,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,u=Q===U.d.FLIP_TILE||Q===U.d.ROTATE_TILE||Q===U.d.FLIP_N_ROTATE_TILE?u.concat(k[(i+O)%2]):Q===U.d.FLIP_ROW||Q===U.d.ROTATE_ROW||Q===U.d.FLIP_N_ROTATE_ROW?u.concat(k[i%2]):u.concat(k[0]),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),L.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const K=0===k.sideOrientation?0:k.sideOrientation||B.d.DEFAULTSIDE;B.d._ComputeSides(K,y,j,L,u,k.frontUVs,k.backUVs);const v=new B.d;v.indices=j,v.ak=y,v.jk=L,v.Kk=u;const N=K===B.d.DOUBLESIDE?a.concat(a):a;return v.Tk=N,v}function F(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new U.d(k,i);Q.sideOrientation=U.d._GetDefaultSideOrientation(Q.sideOrientation),Z._originalBuilderSideOrientation=Q.sideOrientation;return e(Q).Nk(Z,Q.updatable),Z}function z(k){const Q=k.faceUV||new Array(6),i=k.faceColors,C=k.pattern||U.d.NO_FLIP,m=k.width||k.size||1,O=k.height||k.size||1,J=k.depth||k.size||1,G=k.tileWidth||k.tileSize||1,F=k.tileHeight||k.tileSize||1,z=k.alignHorizontal||0,E=k.alignVertical||0,l=0===k.sideOrientation?0:k.sideOrientation||B.d.DEFAULTSIDE;for(let U=0;U<6;U++)void 0===Q[U]&&(Q[U]=new Z.Vector4(0,0,1,1)),i&&void 0===i[U]&&(i[U]=new H.Fo(1,1,1,1));const h=m/2,c=O/2,f=J/2,Y=[];for(let Z=0;Z<2;Z++)Y[Z]=e({pattern:C,tileWidth:G,tileHeight:F,width:m,height:O,alignVertical:E,alignHorizontal:z,sideOrientation:l});for(let Z=2;Z<4;Z++)Y[Z]=e({pattern:C,tileWidth:G,tileHeight:F,width:J,height:O,alignVertical:E,alignHorizontal:z,sideOrientation:l});let y=E;E===U.d.BOTTOM?y=U.d.TOP:E===U.d.TOP&&(y=U.d.BOTTOM);for(let Z=4;Z<6;Z++)Y[Z]=e({pattern:C,tileWidth:G,tileHeight:F,width:m,height:J,alignVertical:y,alignHorizontal:z,sideOrientation:l});let L=[],s=[],u=[],a=[];const j=[],T=[],K=[],v=[];let N=0,X=0;for(let U=0;U<6;U++){const k=Y[U].ak.length;T[U]=[],K[U]=[];for(let Q=0;Q<k/3;Q++)T[U].push(new Z.zQ(Y[U].ak[3*Q],Y[U].ak[3*Q+1],Y[U].ak[3*Q+2])),K[U].push(new Z.zQ(Y[U].jk[3*Q],Y[U].jk[3*Q+1],Y[U].jk[3*Q+2]));N=Y[U].Kk.length,v[U]=[];for(let i=0;i<N;i+=2)v[U][i]=Q[U].x+(Q[U].z-Q[U].x)*Y[U].Kk[i],v[U][i+1]=Q[U].y+(Q[U].w-Q[U].y)*Y[U].Kk[i+1],o.d&&(v[U][i+1]=1-v[U][i+1]);if(u=u.concat(v[U]),a=a.concat(Y[U].indices.map((k=>k+X))),X+=T[U].length,i)for(let Q=0;Q<4;Q++)j.push(i[U].r,i[U].g,i[U].b,i[U].a)}const p=new Z.zQ(0,0,f),d=Z.Matrix.RotationY(Math.PI);L=T[0].map((k=>Z.zQ.TransformNormal(k,d).add(p))).map((k=>[k.x,k.y,k.z])).reduce(((k,Q)=>k.concat(Q)),[]),s=K[0].map((k=>Z.zQ.TransformNormal(k,d))).map((k=>[k.x,k.y,k.z])).reduce(((k,Q)=>k.concat(Q)),[]),L=L.concat(T[1].map((k=>k.EQ(p))).map((k=>[k.x,k.y,k.z])).reduce(((k,Q)=>k.concat(Q)),[])),s=s.concat(K[1].map((k=>[k.x,k.y,k.z])).reduce(((k,Q)=>k.concat(Q)),[]));const b=new Z.zQ(h,0,0),D=Z.Matrix.RotationY(-Math.PI/2);L=L.concat(T[2].map((k=>Z.zQ.TransformNormal(k,D).add(b))).map((k=>[k.x,k.y,k.z])).reduce(((k,Q)=>k.concat(Q)),[])),s=s.concat(K[2].map((k=>Z.zQ.TransformNormal(k,D))).map((k=>[k.x,k.y,k.z])).reduce(((k,Q)=>k.concat(Q)),[]));const M=Z.Matrix.RotationY(Math.PI/2);L=L.concat(T[3].map((k=>Z.zQ.TransformNormal(k,M).EQ(b))).map((k=>[k.x,k.y,k.z])).reduce(((k,Q)=>k.concat(Q)),[])),s=s.concat(K[3].map((k=>Z.zQ.TransformNormal(k,M))).map((k=>[k.x,k.y,k.z])).reduce(((k,Q)=>k.concat(Q)),[]));const W=new Z.zQ(0,c,0),A=Z.Matrix.RotationX(Math.PI/2);L=L.concat(T[4].map((k=>Z.zQ.TransformNormal(k,A).add(W))).map((k=>[k.x,k.y,k.z])).reduce(((k,Q)=>k.concat(Q)),[])),s=s.concat(K[4].map((k=>Z.zQ.TransformNormal(k,A))).map((k=>[k.x,k.y,k.z])).reduce(((k,Q)=>k.concat(Q)),[]));const g=Z.Matrix.RotationX(-Math.PI/2);L=L.concat(T[5].map((k=>Z.zQ.TransformNormal(k,g).EQ(W))).map((k=>[k.x,k.y,k.z])).reduce(((k,Q)=>k.concat(Q)),[])),s=s.concat(K[5].map((k=>Z.zQ.TransformNormal(k,g))).map((k=>[k.x,k.y,k.z])).reduce(((k,Q)=>k.concat(Q)),[])),B.d._ComputeSides(l,L,a,s,u);const R=new B.d;if(R.indices=a,R.ak=L,R.jk=s,R.Kk=u,i){const k=l===B.d.DOUBLESIDE?j.concat(j):j;R.Tk=k}return R}function E(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new U.d(k,i);Q.sideOrientation=U.d._GetDefaultSideOrientation(Q.sideOrientation),Z._originalBuilderSideOrientation=Q.sideOrientation;return z(Q).Nk(Z,Q.updatable),Z}B.d.CreateTiledPlane=e;B.d.CreateTiledBox=z;var l=i(12712),h=i(11538),c=i(11493);function f(k){const Q=k.height||2;let i=0===k.diameterTop?0:k.diameterTop||k.diameter||1,C=0===k.diameterBottom?0:k.diameterBottom||k.diameter||1;i=i||1e-5,C=C||1e-5;const m=0|(k.tessellation||24),O=0|(k.subdivisions||1),J=!!k.hasRings,G=!!k.enclose,e=0===k.cap?0:k.cap||U.d.CAP_ALL,F=k.arc&&(k.arc<=0||k.arc>1)?1:k.arc||1,z=0===k.sideOrientation?0:k.sideOrientation||B.d.DEFAULTSIDE,E=k.faceUV||new Array(3),l=k.faceColors,h=2+(1+(1!==F&&G?2:0))*(J?O:1);let f;for(f=0;f<h;f++)l&&void 0===l[f]&&(l[f]=new H.Fo(1,1,1,1));for(f=0;f<h;f++)E&&void 0===E[f]&&(E[f]=new Z.Vector4(0,0,1,1));const Y=[],y=[],L=[],s=[],u=[],a=2*Math.PI*F/m;let j,T,K;const v=(C-i)/2/Q,N=Z.zQ.Zero(),X=Z.zQ.Zero(),p=Z.zQ.Zero(),d=Z.zQ.Zero(),b=Z.zQ.Zero(),D=c.c.Y;let M,W,A,g=1,R=1,w=0,S=0;for(M=0;M<=O;M++)for(T=M/O,K=(T*(i-C)+C)/2,g=J&&0!==M&&M!==O?2:1,A=0;A<g;A++){for(J&&(R+=A),G&&(R+=2*A),W=0;W<=m;W++)j=W*a,N.x=Math.cos(-j)*K,N.y=-Q/2+T*Q,N.z=Math.sin(-j)*K,0===i&&M===O?(X.x=L[L.length-3*(m+1)],X.y=L[L.length-3*(m+1)+1],X.z=L[L.length-3*(m+1)+2]):(X.x=N.x,X.z=N.z,X.y=Math.sqrt(X.x*X.x+X.z*X.z)*v,X.normalize()),0===W&&(p.B(N),d.B(X)),y.push(N.x,N.y,N.z),L.push(X.x,X.y,X.z),S=J?w!==R?E[R].y:E[R].w:E[R].y+(E[R].w-E[R].y)*T,s.push(E[R].x+(E[R].z-E[R].x)*W/m,o.d?1-S:S),l&&u.push(l[R].r,l[R].g,l[R].b,l[R].a);1!==F&&G&&(y.push(N.x,N.y,N.z),y.push(0,N.y,0),y.push(0,N.y,0),y.push(p.x,p.y,p.z),Z.zQ.CrossToRef(D,X,b),b.normalize(),L.push(b.x,b.y,b.z,b.x,b.y,b.z),Z.zQ.CrossToRef(d,D,b),b.normalize(),L.push(b.x,b.y,b.z,b.x,b.y,b.z),S=J?w!==R?E[R+1].y:E[R+1].w:E[R+1].y+(E[R+1].w-E[R+1].y)*T,s.push(E[R+1].x,o.d?1-S:S),s.push(E[R+1].z,o.d?1-S:S),S=J?w!==R?E[R+2].y:E[R+2].w:E[R+2].y+(E[R+2].w-E[R+2].y)*T,s.push(E[R+2].x,o.d?1-S:S),s.push(E[R+2].z,o.d?1-S:S),l&&(u.push(l[R+1].r,l[R+1].g,l[R+1].b,l[R+1].a),u.push(l[R+1].r,l[R+1].g,l[R+1].b,l[R+1].a),u.push(l[R+2].r,l[R+2].g,l[R+2].b,l[R+2].a),u.push(l[R+2].r,l[R+2].g,l[R+2].b,l[R+2].a))),w!==R&&(w=R)}const q=1!==F&&G?m+4:m;for(M=0,R=0;R<O;R++){let k=0,Q=0,i=0,Z=0;for(W=0;W<m;W++)k=M*(q+1)+W,Q=(M+1)*(q+1)+W,i=M*(q+1)+(W+1),Z=(M+1)*(q+1)+(W+1),Y.push(k,Q,i),Y.push(Z,i,Q);1!==F&&G&&(Y.push(k+2,Q+2,i+2),Y.push(Z+2,i+2,Q+2),Y.push(k+4,Q+4,i+4),Y.push(Z+4,i+4,Q+4)),M=J?M+2:M+1}const P=k=>{const U=k?i/2:C/2;if(0===U)return;let B,O,J;const G=k?E[h-1]:E[0];let H=null;l&&(H=k?l[h-1]:l[0]);const e=y.length/3,z=k?Q/2:-Q/2,c=new Z.zQ(0,z,0);y.push(c.x,c.y,c.z),L.push(0,k?1:-1,0);const f=G.y+.5*(G.w-G.y);s.push(G.x+.5*(G.z-G.x),o.d?1-f:f),H&&u.push(H.r,H.g,H.b,H.a);const a=new Z.Vector2(.5,.5);for(J=0;J<=m;J++){B=2*Math.PI*J*F/m;const Q=Math.cos(-B),i=Math.sin(-B);O=new Z.zQ(Q*U,z,i*U);const C=new Z.Vector2(Q*a.x+.5,i*a.y+.5);y.push(O.x,O.y,O.z),L.push(0,k?1:-1,0);const e=G.y+(G.w-G.y)*C.y;s.push(G.x+(G.z-G.x)*C.x,o.d?1-e:e),H&&u.push(H.r,H.g,H.b,H.a)}for(J=0;J<m;J++)k?(Y.push(e),Y.push(e+(J+2)),Y.push(e+(J+1))):(Y.push(e),Y.push(e+(J+1)),Y.push(e+(J+2)))};e!==U.d.CAP_START&&e!==U.d.CAP_ALL||P(!1),e!==U.d.CAP_END&&e!==U.d.CAP_ALL||P(!0),B.d._ComputeSides(z,y,Y,L,s,k.frontUVs,k.backUVs);const t=new B.d;return t.indices=Y,t.ak=y,t.jk=L,t.Kk=s,l&&(t.Tk=u),t}function Y(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const Z=new U.d(k,i);Q.sideOrientation=U.d._GetDefaultSideOrientation(Q.sideOrientation),Z._originalBuilderSideOrientation=Q.sideOrientation;return f(Q).Nk(Z,Q.updatable),Z}function y(k){const Q=[],i=[],U=[],C=[],m=k.diameter||1,O=k.thickness||.5,J=0|(k.tessellation||16),G=0===k.sideOrientation?0:k.sideOrientation||B.d.DEFAULTSIDE,H=J+1;for(let B=0;B<=J;B++){const k=B/J,G=B*Math.PI*2/J-Math.PI/2,e=Z.Matrix.Translation(m/2,0,0).multiply(Z.Matrix.RotationY(G));for(let m=0;m<=J;m++){const G=1-m/J,F=m*Math.PI*2/J+Math.PI,z=Math.cos(F),E=Math.sin(F);let l=new Z.zQ(z,E,0),h=l.scale(O/2);const c=new Z.Vector2(k,G);h=Z.zQ.TransformCoordinates(h,e),l=Z.zQ.TransformNormal(l,e),i.push(h.x,h.y,h.z),U.push(l.x,l.y,l.z),C.push(c.x,o.d?1-c.y:c.y);const f=(B+1)%H,Y=(m+1)%H;Q.push(B*H+m),Q.push(B*H+Y),Q.push(f*H+m),Q.push(B*H+Y),Q.push(f*H+Y),Q.push(f*H+m)}}B.d._ComputeSides(G,i,Q,U,C,k.frontUVs,k.backUVs);const e=new B.d;return e.indices=Q,e.ak=i,e.jk=U,e.Kk=C,e}function L(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const Z=new U.d(k,i);Q.sideOrientation=U.d._GetDefaultSideOrientation(Q.sideOrientation),Z._originalBuilderSideOrientation=Q.sideOrientation;return y(Q).Nk(Z,Q.updatable),Z}B.d.CreateCylinder=f,U.d.CreateCylinder=(k,Q,i,Z,C,B,o,m,O)=>{void 0!==o&&o instanceof h.b||(void 0!==o&&(O=m||U.d.DEFAULTSIDE,m=o),o=B,B=1);return Y(k,{height:Q,diameterTop:i,diameterBottom:Z,tessellation:C,subdivisions:B,sideOrientation:O,updatable:m},o)};function s(k){const Q=[],i=[],U=[],C=[],m=k.radius||2,O=k.tube||.5,J=k.radialSegments||32,G=k.tubularSegments||32,H=k.p||2,e=k.q||3,F=0===k.sideOrientation?0:k.sideOrientation||B.d.DEFAULTSIDE,z=k=>{const Q=Math.cos(k),i=Math.sin(k),U=e/H*k,C=Math.cos(U),B=m*(2+C)*.5*Q,o=m*(2+C)*i*.5,O=m*Math.sin(U)*.5;return new Z.zQ(B,o,O)};let E,l;for(E=0;E<=J;E++){const k=E%J/J*2*H*Math.PI,Q=z(k),U=z(k+.01),B=U.EQ(Q);let m=U.add(Q);const e=Z.zQ.Cross(B,m);for(m=Z.zQ.Cross(e,B),e.normalize(),m.normalize(),l=0;l<G;l++){const k=l%G/G*2*Math.PI,Z=-O*Math.cos(k),U=O*Math.sin(k);i.push(Q.x+Z*m.x+U*e.x),i.push(Q.y+Z*m.y+U*e.y),i.push(Q.z+Z*m.z+U*e.z),C.push(E/J),C.push(o.d?1-l/G:l/G)}}for(E=0;E<J;E++)for(l=0;l<G;l++){const k=(l+1)%G,i=E*G+l,Z=(E+1)*G+l,U=(E+1)*G+k,C=E*G+k;Q.push(C),Q.push(Z),Q.push(i),Q.push(C),Q.push(U),Q.push(Z)}B.d.ComputeNormals(i,Q,U),B.d._ComputeSides(F,i,Q,U,C,k.frontUVs,k.backUVs);const h=new B.d;return h.indices=Q,h.ak=i,h.jk=U,h.Kk=C,h}function u(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const Z=new U.d(k,i);Q.sideOrientation=U.d._GetDefaultSideOrientation(Q.sideOrientation),Z._originalBuilderSideOrientation=Q.sideOrientation;return s(Q).Nk(Z,Q.updatable),Z}B.d.CreateTorus=y,U.d.CreateTorus=(k,Q,i,Z,U,C,B)=>L(k,{diameter:Q,thickness:i,tessellation:Z,sideOrientation:B,updatable:C},U);B.d.CreateTorusKnot=s,U.d.CreateTorusKnot=(k,Q,i,Z,U,C,B,o,m,O)=>u(k,{radius:Q,tube:i,radialSegments:Z,tubularSegments:U,p:C,q:B,sideOrientation:O,updatable:m},o);var a=i(13247),j=i(11844),T=i(11505);function K(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=Q.path,C=Q.shape,B=Q.scale||1,o=Q.rotation||0,m=0===Q.cap?0:Q.cap||U.d.NO_CAP,O=Q.updatable,J=U.d._GetDefaultSideOrientation(Q.sideOrientation),G=Q.instance||null,H=Q.invertUV||!1,e=Q.closeShape||!1,F=Q.closePath||!1,z=Q.capFunction||null;return N(k,C,Z,B,o,null,null,F,e,m,!1,i,!!O,J,G,H,Q.frontUVs||null,Q.backUVs||null,Q.firstNormal||null,!!Q.adjustFrame,z)}function v(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=Q.path,C=Q.shape,B=Q.scaleFunction||(()=>1),o=Q.rotationFunction||(()=>0),m=Q.closePath||Q.ribbonCloseArray||!1,O=Q.closeShape||Q.ribbonClosePath||!1,J=0===Q.cap?0:Q.cap||U.d.NO_CAP,G=Q.updatable,H=Q.firstNormal||null,e=Q.adjustFrame||!1,F=U.d._GetDefaultSideOrientation(Q.sideOrientation),z=Q.instance,E=Q.invertUV||!1,l=Q.capFunction||null;return N(k,C,Z,null,null,B,o,m,O,J,!0,i,!!G,F,z||null,E,Q.frontUVs||null,Q.backUVs||null,H,e,l||null)}function N(k,Q,i,C,B,o,m,J,G,H,e,F,z,E,l,h,c,f,Y,y,L){const s=(k,Q,i,C,B,o,m,O,J,G,H)=>{const e=i.getTangents(),F=i.getNormals(),z=i.getBinormals(),E=i.getDistances();if(H)for(let U=0;U<e.length;U++)if(0==e[U].x&&0==e[U].y&&0==e[U].z&&e[U].B(e[U-1]),0==F[U].x&&0==F[U].y&&0==F[U].z&&F[U].B(F[U-1]),0==z[U].x&&0==z[U].y&&0==z[U].z&&z[U].B(z[U-1]),U>0){let k=e[U-1];Z.zQ.Dot(k,e[U])<0&&e[U].scaleInPlace(-1),k=F[U-1],Z.zQ.Dot(k,F[U])<0&&F[U].scaleInPlace(-1),k=z[U-1],Z.zQ.Dot(k,z[U])<0&&z[U].scaleInPlace(-1)}let l=0;const h=G&&O?O:()=>null!==o?o:0,c=G&&m?m:()=>null!==B?B:1;let f=J===U.d.NO_CAP||J===U.d.CAP_END?0:2;const Y=Z.TmpVectors.Matrix[0];for(let U=0;U<Q.length;U++){const i=[],B=h(U,E[U]),o=c(U,E[U]);Z.Matrix.RotationAxisToRef(e[U],l,Y);for(let C=0;C<k.length;C++){const B=e[U].scale(k[C].z).add(F[U].scale(k[C].x)).add(z[U].scale(k[C].y)),m=Z.zQ.Zero();Z.zQ.TransformCoordinatesToRef(B,Y,m),m.scaleInPlace(o).addInPlace(Q[U]),i[C]=m}C[f]=i,l+=B,f++}const y=L||(k=>{const Q=Array(),i=Z.zQ.Zero();let U;for(U=0;U<k.length;U++)i.addInPlace(k[U]);for(i.scaleInPlace(1/k.length),U=0;U<k.length;U++)Q.push(i);return Q});switch(J){case U.d.NO_CAP:break;case U.d.CAP_START:C[0]=y(C[2]),C[1]=C[2];break;case U.d.CAP_END:C[f]=C[f-1],C[f+1]=y(C[f-1]);break;case U.d.CAP_ALL:C[0]=y(C[2]),C[1]=C[2],C[f]=C[f-1],C[f+1]=y(C[f-1])}return C};let u,a;if(l){const k=l._creationDataStorage;return u=Y?k.path3D.update(i,Y):k.path3D.update(i),a=s(Q,i,k.path3D,k.pathArray,C,B,o,m,k.cap,e,y),l=O("",{pathArray:a,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:l},F||void 0)}u=Y?new T.h(i,Y):new T.h(i);a=s(Q,i,u,new Array,C,B,o,m,H=H<0||H>3?0:H,e,y);const j=O(k,{pathArray:a,closeArray:J,closePath:G,updatable:z,sideOrientation:E,invertUV:h,frontUVs:c||void 0,backUVs:f||void 0},F);return j._creationDataStorage.pathArray=a,j._creationDataStorage.path3D=u,j._creationDataStorage.cap=H,j}function X(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=Q.arc?Q.arc<=0||Q.arc>1?1:Q.arc:1,B=void 0===Q.closed||Q.closed,o=Q.shape,m=Q.radius||1,J=Q.tessellation||64,G=Q.clip||0,H=Q.updatable,e=U.d._GetDefaultSideOrientation(Q.sideOrientation),F=Q.cap||U.d.NO_CAP,z=2*Math.PI,E=[],l=Q.invertUV||!1;let h=0,c=0;const f=z/J*C;let Y,y;for(h=0;h<=J-G;h++){for(y=[],F!=U.d.CAP_START&&F!=U.d.CAP_ALL||(y.push(new Z.zQ(0,o[0].y,0)),y.push(new Z.zQ(Math.cos(h*f)*o[0].x*m,o[0].y,Math.sin(h*f)*o[0].x*m))),c=0;c<o.length;c++)Y=new Z.zQ(Math.cos(h*f)*o[c].x*m,o[c].y,Math.sin(h*f)*o[c].x*m),y.push(Y);F!=U.d.CAP_END&&F!=U.d.CAP_ALL||(y.push(new Z.zQ(Math.cos(h*f)*o[o.length-1].x*m,o[o.length-1].y,Math.sin(h*f)*o[o.length-1].x*m)),y.push(new Z.zQ(0,o[o.length-1].y,0))),E.push(y)}return O(k,{pathArray:E,closeArray:B,sideOrientation:e,updatable:H,invertUV:l,frontUVs:Q.frontUVs,backUVs:Q.backUVs},i)}U.d.ExtrudeShape=function(k,Q,i,Z,C,B){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7?arguments[7]:void 0,O=arguments.length>8?arguments[8]:void 0,J=arguments.length>9?arguments[9]:void 0;return K(k,{shape:Q,path:i,scale:Z,rotation:C,cap:0===B?0:B||U.d.NO_CAP,sideOrientation:O,instance:J,updatable:m},o)},U.d.ExtrudeShapeCustom=(k,Q,i,Z,C,B,o,m,O,J,G,H)=>v(k,{shape:Q,path:i,scaleFunction:Z,rotationFunction:C,ribbonCloseArray:B,ribbonClosePath:o,cap:0===m?0:m||U.d.NO_CAP,sideOrientation:G,instance:H,updatable:J},O);U.d.CreateLathe=(k,Q,i,Z,U,C,B)=>X(k,{shape:Q,radius:i,tessellation:Z,sideOrientation:B,updatable:C},U);var p=i(12609),d=i(12552);function b(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=Q.path;let B=Q.instance,o=1;void 0!==Q.radius?o=Q.radius:B&&(o=B._creationDataStorage.radius);const m=Q.tessellation||64,J=Q.radiusFunction||null;let G=Q.cap||U.d.NO_CAP;const H=Q.invertUV||!1,e=Q.updatable,F=U.d._GetDefaultSideOrientation(Q.sideOrientation);Q.arc=Q.arc&&(Q.arc<=0||Q.arc>1)?1:Q.arc||1;const z=(k,Q,i,C,B,o,m,O)=>{const J=Q.getTangents(),G=Q.getNormals(),H=Q.getDistances(),e=2*Math.PI/B*O,F=o||(()=>C);let z,E,l,h;const c=Z.TmpVectors.Matrix[0];let f=m===U.d.NO_CAP||m===U.d.CAP_END?0:2;for(let U=0;U<k.length;U++){E=F(U,H[U]),z=Array(),l=G[U];for(let Q=0;Q<B;Q++)Z.Matrix.RotationAxisToRef(J[U],e*Q,c),h=z[Q]?z[Q]:Z.zQ.Zero(),Z.zQ.TransformCoordinatesToRef(l,c,h),h.scaleInPlace(E).addInPlace(k[U]),z[Q]=h;i[f]=z,f++}const Y=(Q,i)=>{const Z=Array();for(let U=0;U<Q;U++)Z.push(k[i]);return Z};switch(m){case U.d.NO_CAP:break;case U.d.CAP_START:i[0]=Y(B,0),i[1]=i[2].slice(0);break;case U.d.CAP_END:i[f]=i[f-1].slice(0),i[f+1]=Y(B,k.length-1);break;case U.d.CAP_ALL:i[0]=Y(B,0),i[1]=i[2].slice(0),i[f]=i[f-1].slice(0),i[f+1]=Y(B,k.length-1)}return i};let E,l;if(B){const k=B._creationDataStorage,i=Q.arc||k.arc;return E=k.path3D.update(C),l=z(C,E,k.pathArray,o,k.tessellation,J,k.cap,i),B=O("",{pathArray:l,instance:B}),k.path3D=E,k.pathArray=l,k.arc=i,k.radius=o,B}E=new T.h(C);G=G<0||G>3?0:G,l=z(C,E,new Array,o,m,J,G,Q.arc);const h=O(k,{pathArray:l,closePath:!0,closeArray:!1,updatable:e,sideOrientation:F,invertUV:H,frontUVs:Q.frontUVs,backUVs:Q.backUVs},i);return h._creationDataStorage.pathArray=l,h._creationDataStorage.path3D=E,h._creationDataStorage.tessellation=m,h._creationDataStorage.cap=G,h._creationDataStorage.arc=Q.arc,h._creationDataStorage.radius=o,h}function D(k){const Q=[];Q[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},Q[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},Q[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},Q[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},Q[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},Q[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},Q[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},Q[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},Q[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},Q[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},Q[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},Q[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},Q[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},Q[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},Q[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const i=k.type&&(k.type<0||k.type>=Q.length)?0:k.type||0,U=k.size,C=k.sizeX||U||1,m=k.sizeY||U||1,O=k.sizeZ||U||1,J=k.custom||Q[i],G=J.face.length,e=k.faceUV||new Array(G),F=k.faceColors,z=void 0===k.flat||k.flat,E=0===k.sideOrientation?0:k.sideOrientation||B.d.DEFAULTSIDE,l=[],h=[],c=[],f=[],Y=[];let y=0,L=0;const s=[];let u,a,j,T,K,v,N=0,X=0;if(z)for(X=0;X<G;X++)F&&void 0===F[X]&&(F[X]=new H.Fo(1,1,1,1)),e&&void 0===e[X]&&(e[X]=new Z.Vector4(0,0,1,1));if(z)for(X=0;X<G;X++){const k=J.face[X].length;for(j=2*Math.PI/k,T=.5*Math.tan(j/2),K=.5,N=0;N<k;N++)l.push(J.vertex[J.face[X][N]][0]*C,J.vertex[J.face[X][N]][1]*m,J.vertex[J.face[X][N]][2]*O),s.push(y),y++,u=e[X].x+(e[X].z-e[X].x)*(.5+T),a=e[X].y+(e[X].w-e[X].y)*(K-.5),f.push(u,o.d?1-a:a),v=T*Math.cos(j)-K*Math.sin(j),K=T*Math.sin(j)+K*Math.cos(j),T=v,F&&Y.push(F[X].r,F[X].g,F[X].b,F[X].a);for(N=0;N<k-2;N++)h.push(s[0+L],s[N+2+L],s[N+1+L]);L+=k}else{for(N=0;N<J.vertex.length;N++)l.push(J.vertex[N][0]*C,J.vertex[N][1]*m,J.vertex[N][2]*O),f.push(0,o.d?1:0);for(X=0;X<G;X++)for(N=0;N<J.face[X].length-2;N++)h.push(J.face[X][0],J.face[X][N+2],J.face[X][N+1])}B.d.ComputeNormals(l,h,c),B.d._ComputeSides(E,l,h,c,f,k.frontUVs,k.backUVs);const p=new B.d;return p.ak=l,p.indices=h,p.jk=c,p.Kk=f,F&&z&&(p.Tk=Y),p}function M(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new U.d(k,i);Q.sideOrientation=U.d._GetDefaultSideOrientation(Q.sideOrientation),Z._originalBuilderSideOrientation=Q.sideOrientation;return D(Q).Nk(Z,Q.updatable),Z}U.d.CreateTube=(k,Q,i,Z,U,C,B,o,m,O)=>b(k,{path:Q,radius:i,tessellation:Z,radiusFunction:U,arc:1,cap:C,updatable:o,sideOrientation:m,instance:O},B);function W(k){const Q=k.sideOrientation||B.d.DEFAULTSIDE,i=k.radius||1,U=void 0===k.flat||k.flat,C=0|(k.subdivisions||4),m=k.radiusX||i,O=k.radiusY||i,J=k.radiusZ||i,G=(1+Math.sqrt(5))/2,H=[-1,G,-0,1,G,0,-1,-G,0,1,-G,0,0,-1,-G,0,1,-G,0,-1,G,0,1,G,G,0,1,G,0,-1,-G,0,1,-G,0,-1],e=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],F=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],z=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],E=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],l=[],h=[],c=[],f=[];let Y=0;const y=new Array(3),L=new Array(3);let s;for(s=0;s<3;s++)y[s]=Z.zQ.Zero(),L[s]=Z.Vector2.Zero();for(let B=0;B<20;B++){for(s=0;s<3;s++){const k=e[3*B+s];y[s].Go(H[3*F[k]],H[3*F[k]+1],H[3*F[k]+2]),y[s].normalize(),L[s].Go(.134765625*z[2*k]+.05859375+-.0390625*E[B],.2333984375*z[2*k+1]+.025390625+.01953125*E[B])}const k=(k,Q,i,B)=>{const G=Z.zQ.Lerp(y[0],y[2],Q/C),H=Z.zQ.Lerp(y[1],y[2],Q/C),e=C===Q?y[2]:Z.zQ.Lerp(G,H,k/(C-Q));let F;if(e.normalize(),U){const k=Z.zQ.Lerp(y[0],y[2],B/C),Q=Z.zQ.Lerp(y[1],y[2],B/C);F=Z.zQ.Lerp(k,Q,i/(C-B))}else F=new Z.zQ(e.x,e.y,e.z);F.x/=m,F.y/=O,F.z/=J,F.normalize();const z=Z.Vector2.Lerp(L[0],L[2],Q/C),E=Z.Vector2.Lerp(L[1],L[2],Q/C),s=C===Q?L[2]:Z.Vector2.Lerp(z,E,k/(C-Q));h.push(e.x*m,e.y*O,e.z*J),c.push(F.x,F.y,F.z),f.push(s.x,o.d?1-s.y:s.y),l.push(Y),Y++};for(let Q=0;Q<C;Q++)for(let i=0;i+Q<C;i++)k(i,Q,i+1/3,Q+1/3),k(i+1,Q,i+1/3,Q+1/3),k(i,Q+1,i+1/3,Q+1/3),i+Q+1<C&&(k(i+1,Q,i+2/3,Q+2/3),k(i+1,Q+1,i+2/3,Q+2/3),k(i,Q+1,i+2/3,Q+2/3))}B.d._ComputeSides(Q,h,l,c,f,k.frontUVs,k.backUVs);const u=new B.d;return u.indices=l,u.ak=h,u.jk=c,u.Kk=f,u}function A(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new U.d(k,i);Q.sideOrientation=U.d._GetDefaultSideOrientation(Q.sideOrientation),Z._originalBuilderSideOrientation=Q.sideOrientation;return W(Q).Nk(Z,Q.updatable),Z}B.d.CreatePolyhedron=D,U.d.CreatePolyhedron=(k,Q,i)=>M(k,Q,i);B.d.CreateIcoSphere=W,U.d.CreateIcoSphere=(k,Q,i)=>A(k,Q,i);var g=i(11311);const R=new Z.zQ(1,0,0),w=new Z.zQ(-1,0,0),S=new Z.zQ(0,1,0),q=new Z.zQ(0,-1,0),P=new Z.zQ(0,0,1),t=new Z.zQ(0,0,-1);class I{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z.zQ.Zero(),Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z.zQ.Up(),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Z.Vector2.Zero(),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=k,this.normal=Q,this.uv=i,this.vertexIdx=U,this.vertexIdxForBones=C,this.localPositionOverride=B,this.localNormalOverride=o,this.matrixIndicesOverride=m,this.matrixWeightsOverride=O}clone(){var k,Q,i,Z;return new I(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(k=this.localPositionOverride)||void 0===k?void 0:k.slice(),null===(Q=this.localNormalOverride)||void 0===Q?void 0:Q.slice(),null===(i=this.matrixIndicesOverride)||void 0===i?void 0:i.slice(),null===(Z=this.matrixWeightsOverride)||void 0===Z?void 0:Z.slice())}}function r(k,Q,i){var m,O,J,G,H;const e=!!Q.skeleton,F=!(null===(m=Q.morphTargetManager)||void 0===m||!m.numTargets),z=i.localMode||e,E=Q.Oo(),l=e||F?Q.ao(!0,!0):Q.getVerticesData(C.h.PositionKind),h=e||F?Q.getNormalsData(!0,!0):Q.getVerticesData(C.h.NormalKind),c=z?e?Q.getVerticesData(C.h.PositionKind):l:null,f=z?e?Q.getVerticesData(C.h.NormalKind):h:null,Y=Q.getVerticesData(C.h.UVKind),y=e?Q.getVerticesData(C.h.MatricesIndicesKind):null,L=e?Q.getVerticesData(C.h.MatricesWeightsKind):null,s=e?Q.getVerticesData(C.h.MatricesIndicesExtraKind):null,u=e?Q.getVerticesData(C.h.MatricesWeightsExtraKind):null,a=i.position||Z.zQ.Zero();let j=i.normal||Z.zQ.Up();const T=i.size||Z.zQ.One(),K=i.angle||0;if(!j){const k=new Z.zQ(0,0,1),i=Q.sk().activeCamera,U=Z.zQ.TransformCoordinates(k,i.getWorldMatrix());j=i.globalPosition.EQ(U)}const v=-Math.atan2(j.z,j.x)-Math.PI/2,N=Math.sqrt(j.x*j.x+j.z*j.z),X=Math.atan2(j.y,N),p=new B.d;p.indices=[],p.ak=[],p.jk=[],p.Kk=[],p.matricesIndices=e?[]:null,p.matricesWeights=e?[]:null,p.matricesIndicesExtra=s?[]:null,p.matricesWeightsExtra=u?[]:null;let d=0;const b=(k,Q)=>{const U=new I;if(!E||!l||!h)return U;const C=E[k];if(U.vertexIdx=3*C,U.vertexIdxForBones=4*C,U.position=new Z.zQ(l[3*C],l[3*C+1],l[3*C+2]),Z.zQ.TransformCoordinatesToRef(U.position,Q,U.position),U.normal=new Z.zQ(h[3*C],h[3*C+1],h[3*C+2]),Z.zQ.TransformNormalToRef(U.normal,Q,U.normal),i.captureUVS&&Y){const k=Y[2*C+1];U.uv=new Z.Vector2(Y[2*C],o.d?1-k:k)}return U},D=[0,0,0,0],M=(k,Q)=>{if(0===k.length)return k;const i=.5*Math.abs(Z.zQ.Dot(T,Q)),U=(k,Q,i,Z)=>{for(let U=0;U<Z;++U)if(k[i+U]===Q)return i+U;return-1},C=(k,C)=>{const B=Z.zQ.GetClipFactor(k.position,C.position,Q,i);let o=D,m=D;if(y&&L){const Q=k.matrixIndicesOverride?0:k.vertexIdxForBones,i=k.matrixIndicesOverride??y,Z=k.matrixWeightsOverride??L,O=C.matrixIndicesOverride?0:C.vertexIdxForBones,J=C.matrixIndicesOverride??y,G=C.matrixWeightsOverride??L;o=[0,0,0,0],m=[0,0,0,0];let H=0;for(let k=0;k<4;++k)if(Z[Q+k]>0){const C=U(J,i[Q+k],O,4);o[H]=i[Q+k],m[H]=(0,g.Lerp)(Z[Q+k],C>=0?G[C]:0,B),H++}for(let k=0;k<4&&H<4;++k){const Z=J[O+k];-1===U(i,Z,Q,4)&&(o[H]=Z,m[H]=(0,g.Lerp)(0,G[O+k],B),H++)}const e=m[0]+m[1]+m[2]+m[3];m[0]/=e,m[1]/=e,m[2]/=e,m[3]/=e}const O=k.localPositionOverride?k.localPositionOverride[0]:(null===c||void 0===c?void 0:c[k.vertexIdx])??0,J=k.localPositionOverride?k.localPositionOverride[1]:(null===c||void 0===c?void 0:c[k.vertexIdx+1])??0,G=k.localPositionOverride?k.localPositionOverride[2]:(null===c||void 0===c?void 0:c[k.vertexIdx+2])??0,H=C.localPositionOverride?C.localPositionOverride[0]:(null===c||void 0===c?void 0:c[C.vertexIdx])??0,e=C.localPositionOverride?C.localPositionOverride[1]:(null===c||void 0===c?void 0:c[C.vertexIdx+1])??0,F=C.localPositionOverride?C.localPositionOverride[2]:(null===c||void 0===c?void 0:c[C.vertexIdx+2])??0,z=k.localNormalOverride?k.localNormalOverride[0]:(null===f||void 0===f?void 0:f[k.vertexIdx])??0,E=k.localNormalOverride?k.localNormalOverride[1]:(null===f||void 0===f?void 0:f[k.vertexIdx+1])??0,l=k.localNormalOverride?k.localNormalOverride[2]:(null===f||void 0===f?void 0:f[k.vertexIdx+2])??0,h=z+((C.localNormalOverride?C.localNormalOverride[0]:(null===f||void 0===f?void 0:f[C.vertexIdx])??0)-z)*B,Y=E+((C.localNormalOverride?C.localNormalOverride[1]:(null===f||void 0===f?void 0:f[C.vertexIdx+1])??0)-E)*B,s=l+((C.localNormalOverride?C.localNormalOverride[2]:(null===f||void 0===f?void 0:f[C.vertexIdx+2])??0)-l)*B,u=Math.sqrt(h*h+Y*Y+s*s);return new I(Z.zQ.Lerp(k.position,C.position,B),Z.zQ.Lerp(k.normal,C.normal,B).normalize(),Z.Vector2.Lerp(k.uv,C.uv,B),-1,-1,c?[O+(H-O)*B,J+(e-J)*B,G+(F-G)*B]:null,f?[h/u,Y/u,s/u]:null,o,m)};let B=null;k.length>3&&(B=[]);for(let o=0;o<k.length;o+=3){let U=0,m=null,O=null,J=null,G=null;const H=Z.zQ.Dot(k[o].position,Q)-i>0,e=Z.zQ.Dot(k[o+1].position,Q)-i>0,F=Z.zQ.Dot(k[o+2].position,Q)-i>0;switch(U=(H?1:0)+(e?1:0)+(F?1:0),U){case 0:k.length>3?(B.push(k[o]),B.push(k[o+1]),B.push(k[o+2])):B=k;break;case 1:if(B=B??new Array,H&&(m=k[o+1],O=k[o+2],J=C(k[o],m),G=C(k[o],O)),e){m=k[o],O=k[o+2],J=C(k[o+1],m),G=C(k[o+1],O),B.push(J),B.push(O.clone()),B.push(m.clone()),B.push(O.clone()),B.push(J.clone()),B.push(G);break}F&&(m=k[o],O=k[o+1],J=C(k[o+2],m),G=C(k[o+2],O)),m&&O&&J&&G&&(B.push(m.clone()),B.push(O.clone()),B.push(J),B.push(G),B.push(J.clone()),B.push(O.clone()));break;case 2:B=B??new Array,H||(m=k[o].clone(),O=C(m,k[o+1]),J=C(m,k[o+2]),B.push(m),B.push(O),B.push(J)),e||(m=k[o+1].clone(),O=C(m,k[o+2]),J=C(m,k[o]),B.push(m),B.push(O),B.push(J)),F||(m=k[o+2].clone(),O=C(m,k[o]),J=C(m,k[o+1]),B.push(m),B.push(O),B.push(J))}}return B},W=Q instanceof U.d?Q:null,A=null===W||void 0===W?void 0:W._thinInstanceDataStorage.matrixData,r=(null===W||void 0===W?void 0:W.Eo)||1,n=Z.TmpVectors.Matrix[0];n.B(Z.Matrix.IdentityReadOnly);for(let U=0;U<r;++U){if(null!==W&&void 0!==W&&W.hasThinInstances&&A){const k=16*U;n.setRowFromFloats(0,A[k+0],A[k+1],A[k+2],A[k+3]),n.setRowFromFloats(1,A[k+4],A[k+5],A[k+6],A[k+7]),n.setRowFromFloats(2,A[k+8],A[k+9],A[k+10],A[k+11]),n.setRowFromFloats(3,A[k+12],A[k+13],A[k+14],A[k+15])}const k=Z.Matrix.RotationYawPitchRoll(v,X,K).multiply(Z.Matrix.Translation(a.x,a.y,a.z)),C=Z.Matrix.Invert(k),B=Q.getWorldMatrix(),m=n.multiply(B).multiply(C),O=new Array(3);for(let Q=0;Q<E.length;Q+=3){let k=O;if(k[0]=b(Q,m),k[1]=b(Q+1,m),k[2]=b(Q+2,m),!(i.cullBackFaces&&-k[0].normal.z<=0&&-k[1].normal.z<=0&&-k[2].normal.z<=0)&&(k=M(k,R),k&&(k=M(k,w),k&&(k=M(k,S),k&&(k=M(k,q),k&&(k=M(k,P),k&&(k=M(k,t),k)))))))for(let Q=0;Q<k.length;Q++){const Z=k[Q];if(p.indices.push(d),z?(Z.localPositionOverride?(p.ak[3*d]=Z.localPositionOverride[0],p.ak[3*d+1]=Z.localPositionOverride[1],p.ak[3*d+2]=Z.localPositionOverride[2]):c&&(p.ak[3*d]=c[Z.vertexIdx],p.ak[3*d+1]=c[Z.vertexIdx+1],p.ak[3*d+2]=c[Z.vertexIdx+2]),Z.localNormalOverride?(p.jk[3*d]=Z.localNormalOverride[0],p.jk[3*d+1]=Z.localNormalOverride[1],p.jk[3*d+2]=Z.localNormalOverride[2]):f&&(p.jk[3*d]=f[Z.vertexIdx],p.jk[3*d+1]=f[Z.vertexIdx+1],p.jk[3*d+2]=f[Z.vertexIdx+2])):(Z.position.toArray(p.ak,3*d),Z.normal.toArray(p.jk,3*d)),p.matricesIndices&&p.matricesWeights&&(Z.matrixIndicesOverride?(p.matricesIndices[4*d]=Z.matrixIndicesOverride[0],p.matricesIndices[4*d+1]=Z.matrixIndicesOverride[1],p.matricesIndices[4*d+2]=Z.matrixIndicesOverride[2],p.matricesIndices[4*d+3]=Z.matrixIndicesOverride[3]):(y&&(p.matricesIndices[4*d]=y[Z.vertexIdxForBones],p.matricesIndices[4*d+1]=y[Z.vertexIdxForBones+1],p.matricesIndices[4*d+2]=y[Z.vertexIdxForBones+2],p.matricesIndices[4*d+3]=y[Z.vertexIdxForBones+3]),s&&p.matricesIndicesExtra&&(p.matricesIndicesExtra[4*d]=s[Z.vertexIdxForBones],p.matricesIndicesExtra[4*d+1]=s[Z.vertexIdxForBones+1],p.matricesIndicesExtra[4*d+2]=s[Z.vertexIdxForBones+2],p.matricesIndicesExtra[4*d+3]=s[Z.vertexIdxForBones+3])),Z.matrixWeightsOverride?(p.matricesWeights[4*d]=Z.matrixWeightsOverride[0],p.matricesWeights[4*d+1]=Z.matrixWeightsOverride[1],p.matricesWeights[4*d+2]=Z.matrixWeightsOverride[2],p.matricesWeights[4*d+3]=Z.matrixWeightsOverride[3]):(L&&(p.matricesWeights[4*d]=L[Z.vertexIdxForBones],p.matricesWeights[4*d+1]=L[Z.vertexIdxForBones+1],p.matricesWeights[4*d+2]=L[Z.vertexIdxForBones+2],p.matricesWeights[4*d+3]=L[Z.vertexIdxForBones+3]),u&&p.matricesWeightsExtra&&(p.matricesWeightsExtra[4*d]=u[Z.vertexIdxForBones],p.matricesWeightsExtra[4*d+1]=u[Z.vertexIdxForBones+1],p.matricesWeightsExtra[4*d+2]=u[Z.vertexIdxForBones+2],p.matricesWeightsExtra[4*d+3]=u[Z.vertexIdxForBones+3]))),i.captureUVS)Z.uv.toArray(p.Kk,2*d);else{p.Kk.push(.5+Z.position.x/T.x);const k=.5+Z.position.y/T.y;p.Kk.push(o.d?1-k:k)}d++}}}0===p.indices.length&&(p.indices=null),0===p.ak.length&&(p.ak=null),0===p.jk.length&&(p.jk=null),0===p.Kk.length&&(p.Kk=null),0===(null===(O=p.matricesIndices)||void 0===O?void 0:O.length)&&(p.matricesIndices=null),0===(null===(J=p.matricesWeights)||void 0===J?void 0:J.length)&&(p.matricesWeights=null),0===(null===(G=p.matricesIndicesExtra)||void 0===G?void 0:G.length)&&(p.matricesIndicesExtra=null),0===(null===(H=p.matricesWeightsExtra)||void 0===H?void 0:H.length)&&(p.matricesWeightsExtra=null);const x=new U.d(k,Q.sk());return p.Nk(x),z?(x.skeleton=Q.skeleton,x.parent=Q):(x.position=a.clone(),x.rotation=new Z.zQ(X,v,K)),x.oo(!0),x.refreshBoundingInfo(!0,!0),x}function n(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const Q=0|Math.max(k.subdivisions?k.subdivisions:2,1),i=0|Math.max(k.tessellation?k.tessellation:16,3),U=Math.max(k.height?k.height:1,0),C=Math.max(k.radius?k.radius:.25,0),m=0|Math.max(k.capSubdivisions?k.capSubdivisions:6,1),O=i,J=Q,G=Math.max(k.radiusTop?k.radiusTop:C,0),H=Math.max(k.radiusBottom?k.radiusBottom:C,0),e=U-(G+H),F=2*Math.PI,z=Math.max(k.topCapSubdivisions?k.topCapSubdivisions:m,1),E=Math.max(k.bottomCapSubdivisions?k.bottomCapSubdivisions:m,1),l=Math.acos((H-G)/U);let h=[];const c=[],f=[],Y=[];let y=0;const L=[],s=.5*e,u=.5*Math.PI;let a,j;const T=Z.zQ.Zero(),K=Z.zQ.Zero(),v=Math.cos(l),N=Math.sin(l),X=new Z.Vector2(G*N,s+G*v).EQ(new Z.Vector2(H*N,H*v-s)).length(),p=G*l+X+H*(u-l);let d=0;for(j=0;j<=z;j++){const k=[],Q=u-l*(j/z);d+=G*l/z;const i=Math.cos(Q),Z=Math.sin(Q),U=i*G;for(a=0;a<=O;a++){const Q=a/O,C=Q*F+0,B=Math.sin(C),m=Math.cos(C);K.x=U*B,K.y=s+Z*G,K.z=U*m,c.push(K.x,K.y,K.z),T.set(i*B,Z,i*m),f.push(T.x,T.y,T.z),Y.push(Q,o.d?d/p:1-d/p),k.push(y),y++}L.push(k)}const b=U-G-H+v*G-v*H,D=N*(H-G)/b;for(j=1;j<=J;j++){const k=[];d+=X/J;const Q=N*(j*(H-G)/J+G);for(a=0;a<=O;a++){const i=a/O,Z=i*F+0,U=Math.sin(Z),C=Math.cos(Z);K.x=Q*U,K.y=s+v*G-j*b/J,K.z=Q*C,c.push(K.x,K.y,K.z),T.set(U,D,C).normalize(),f.push(T.x,T.y,T.z),Y.push(i,o.d?d/p:1-d/p),k.push(y),y++}L.push(k)}for(j=1;j<=E;j++){const k=[],Q=u-l-(Math.PI-l)*(j/E);d+=H*l/E;const i=Math.cos(Q),Z=Math.sin(Q),U=i*H;for(a=0;a<=O;a++){const Q=a/O,C=Q*F+0,B=Math.sin(C),m=Math.cos(C);K.x=U*B,K.y=Z*H-s,K.z=U*m,c.push(K.x,K.y,K.z),T.set(i*B,Z,i*m),f.push(T.x,T.y,T.z),Y.push(Q,o.d?d/p:1-d/p),k.push(y),y++}L.push(k)}for(a=0;a<O;a++)for(j=0;j<z+J+E;j++){const k=L[j][a],Q=L[j+1][a],i=L[j+1][a+1],Z=L[j][a+1];h.push(k),h.push(Q),h.push(Z),h.push(Q),h.push(i),h.push(Z)}if(h=h.reverse(),k.orientation&&!k.orientation.equals(Z.zQ.Up())){const Q=new Z.Matrix;k.orientation.clone().scale(.5*Math.PI).cross(Z.zQ.Up()).toQuaternion().toRotationMatrix(Q);const i=Z.zQ.Zero();for(let k=0;k<c.length;k+=3)i.set(c[k],c[k+1],c[k+2]),Z.zQ.TransformCoordinatesToRef(i.clone(),Q,i),c[k]=i.x,c[k+1]=i.y,c[k+2]=i.z}const M=new B.d;return M.ak=c,M.jk=f,M.Kk=Y,M.indices=h,M}function x(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:Z.zQ.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new U.d(k,i);return n(Q).Nk(C,Q.updatable),C}U.d.CreateDecal=(k,Q,i,Z,U,C)=>r(k,Q,{position:i,normal:Z,size:U,angle:C});U.d.CreateCapsule=(k,Q,i)=>x(k,Q,i),B.d.CreateCapsule=n;var V=i(11134),kk=i(11304);class Qk{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=k,this.y=Q,k!==Math.floor(k)&&(k=Math.floor(k),V.c.Warn("x is not an integer, floor(x) used")),Q!==Math.floor(Q)&&(Q=Math.floor(Q),V.c.Warn("y is not an integer, floor(y) used"))}clone(){return new Qk(this.x,this.y)}rotate60About(k){const Q=this.x;return this.x=k.x+k.y-this.y,this.y=Q+this.y-k.x,this}rotateNeg60About(k){const Q=this.x;return this.x=Q+this.y-k.y,this.y=k.x+k.y-Q,this}rotate120(k,Q){k!==Math.floor(k)&&(k=Math.floor(k),V.c.Warn("m not an integer only floor(m) used")),Q!==Math.floor(Q)&&(Q=Math.floor(Q),V.c.Warn("n not an integer only floor(n) used"));const i=this.x;return this.x=k-i-this.y,this.y=Q+i,this}rotateNeg120(k,Q){k!==Math.floor(k)&&(k=Math.floor(k),V.c.Warn("m is not an integer, floor(m) used")),Q!==Math.floor(Q)&&(Q=Math.floor(Q),V.c.Warn("n is not an integer,   floor(n) used"));const i=this.x;return this.x=this.y-Q,this.y=k+Q-i-this.y,this}toCartesianOrigin(k,Q){const i=Z.zQ.Zero();return i.x=k.x+2*this.x*Q+this.y*Q,i.y=k.y+Math.sqrt(3)*this.y*Q,i}static Zero(){return new Qk(0,0)}}class ik{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Zk("icosahedron","Regular",[[0,kk.g,-1],[-kk.g,1,0],[-1,0,-kk.g],[1,0,-kk.g],[kk.g,1,0],[0,kk.g,1],[-1,0,kk.g],[-kk.g,-1,0],[0,-kk.g,-1],[kk.g,-1,0],[1,0,kk.g],[0,-kk.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let k=12;const Q={},i=this.m,Z=this.n;let U,C,B,o,m,O=i,J=1,G=0;0!==Z&&(O=(0,g.HighestCommonFactor)(i,Z)),J=i/O,G=Z/O;const H=Qk.Zero(),e=new Qk(i,Z),F=new Qk(-Z,i+Z),z=Qk.Zero(),E=Qk.Zero(),l=Qk.Zero();let h,c,f,Y,y=[];const L=[],s=this.vertByDist,u=(i,Z,U,C)=>{h=i+"|"+U,c=Z+"|"+C,h in Q||c in Q?h in Q&&!(c in Q)?Q[c]=Q[h]:c in Q&&!(h in Q)&&(Q[h]=Q[c]):(Q[h]=k,Q[c]=k,k++),s[U][0]>2?L[Q[h]]=[-s[U][0],s[U][1],Q[h]]:L[Q[h]]=[y[s[U][0]],s[U][1],Q[h]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let a=0;a<20;a++){if(y=this.IDATA.face[a],B=y[2],o=y[1],m=y[0],f=H.x+"|"+H.y,h=a+"|"+f,h in Q||(Q[h]=B,L[B]=[y[s[f][0]],s[f][1]]),f=e.x+"|"+e.y,h=a+"|"+f,h in Q||(Q[h]=o,L[o]=[y[s[f][0]],s[f][1]]),f=F.x+"|"+F.y,h=a+"|"+f,h in Q||(Q[h]=m,L[m]=[y[s[f][0]],s[f][1]]),U=this.IDATA.edgematch[a][0],C=this.IDATA.edgematch[a][1],"B"===C)for(let k=1;k<O;k++)E.x=i-k*(J+G),E.y=Z+k*J,l.x=-k*G,l.y=k*(J+G),f=E.x+"|"+E.y,Y=l.x+"|"+l.y,u(a,U,f,Y);if("O"===C)for(let k=1;k<O;k++)l.x=-k*G,l.y=k*(J+G),z.x=k*J,z.y=k*G,f=l.x+"|"+l.y,Y=z.x+"|"+z.y,u(a,U,f,Y);if(U=this.IDATA.edgematch[a][2],C=this.IDATA.edgematch[a][3],C&&"A"===C)for(let k=1;k<O;k++)z.x=k*J,z.y=k*G,E.x=i-(O-k)*(J+G),E.y=Z+(O-k)*J,f=z.x+"|"+z.y,Y=E.x+"|"+E.y,u(a,U,f,Y);for(let i=0;i<this.vertices.length;i++)f=this.vertices[i].x+"|"+this.vertices[i].y,h=a+"|"+f,h in Q||(Q[h]=k++,s[f][0]>2?L[Q[h]]=[-s[f][0],s[f][1],Q[h]]:L[Q[h]]=[y[s[f][0]],s[f][1],Q[h]])}this.closestTo=L,this.vecToidx=Q}calcCoeffs(){const k=this.m,Q=this.n,i=Math.sqrt(3)/3,Z=k*k+Q*Q+k*Q;this.coau=(k+Q)/Z,this.cobu=-Q/Z,this.coav=-i*(k-Q)/Z,this.cobv=i*(2*k+Q)/Z}createInnerFacets(){const k=this.m,Q=this.n;for(let i=0;i<Q+k+1;i++)for(let k=this.min[i];k<this.max[i]+1;k++)k<this.max[i]&&k<this.max[i+1]+1&&this.innerFacets.push(["|"+k+"|"+i,"|"+k+"|"+(i+1),"|"+(k+1)+"|"+i]),i>0&&k<this.max[i-1]&&k+1<this.max[i]+1&&this.innerFacets.push(["|"+k+"|"+i,"|"+(k+1)+"|"+i,"|"+(k+1)+"|"+(i-1)])}edgeVecsABOB(){const k=this.m,Q=this.n,i=new Qk(-Q,k+Q);for(let Z=1;Z<k+Q;Z++){const k=new Qk(this.min[Z],Z),Q=new Qk(this.min[Z-1],Z-1),U=new Qk(this.min[Z+1],Z+1),C=k.clone(),B=Q.clone(),o=U.clone();C.rotate60About(i),B.rotate60About(i),o.rotate60About(i);const m=new Qk(this.max[C.y],C.y),O=new Qk(this.max[C.y-1],C.y-1),J=new Qk(this.max[C.y-1]-1,C.y-1);C.x===m.x&&C.y===m.y||(C.x!==O.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([k,O,J]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([k,J,m])):C.y===o.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([k,Q,O]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([k,O,U])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([k,Q,O]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([k,O,m])))}}mapABOBtoOBOA(){const k=new Qk(0,0);for(let Q=0;Q<this.isoVecsABOB.length;Q++){const i=[];for(let Z=0;Z<3;Z++)k.x=this.isoVecsABOB[Q][Z].x,k.y=this.isoVecsABOB[Q][Z].y,0===this.vertexTypes[Q][Z]&&k.rotateNeg120(this.m,this.n),i.push(k.clone());this.isoVecsOBOA.push(i)}}mapABOBtoBAOA(){const k=new Qk(0,0);for(let Q=0;Q<this.isoVecsABOB.length;Q++){const i=[];for(let Z=0;Z<3;Z++)k.x=this.isoVecsABOB[Q][Z].x,k.y=this.isoVecsABOB[Q][Z].y,1===this.vertexTypes[Q][Z]&&k.rotate120(this.m,this.n),i.push(k.clone());this.isoVecsBAOA.push(i)}}MapToFace(k,Q){const i=this.IDATA.face[k],U=i[2],C=i[1],B=i[0],o=Z.zQ.fQ(this.IDATA.vertex[U]),m=Z.zQ.fQ(this.IDATA.vertex[C]),O=Z.zQ.fQ(this.IDATA.vertex[B]),J=m.EQ(o),G=O.EQ(o),H=J.scale(this.coau).add(G.scale(this.cobu)),e=J.scale(this.coav).add(G.scale(this.cobv)),F=[];let z,E=Z.TmpVectors.zQ[0];for(let Z=0;Z<this.cartesian.length;Z++)E=H.scale(this.cartesian[Z].x).add(e.scale(this.cartesian[Z].y)).add(o),F[Z]=[E.x,E.y,E.z],z=k+"|"+this.vertices[Z].x+"|"+this.vertices[Z].y,Q.vertex[this.vecToidx[z]]=[E.x,E.y,E.z]}build(k,Q){const i=[],Z=Qk.Zero(),U=new Qk(k,Q),C=new Qk(-Q,k+Q);i.push(Z,U,C);for(let f=Q;f<k+1;f++)for(let Q=0;Q<k+1-f;Q++)i.push(new Qk(Q,f));if(Q>0){const Z=(0,g.HighestCommonFactor)(k,Q),U=k/Z,C=Q/Z;for(let o=1;o<Z;o++)i.push(new Qk(o*U,o*C)),i.push(new Qk(-o*C,o*(U+C))),i.push(new Qk(k-o*(U+C),Q+o*U));const B=k/Q;for(let o=1;o<Q;o++)for(let Z=0;Z<o*B;Z++)i.push(new Qk(Z,o)),i.push(new Qk(Z,o).rotate120(k,Q)),i.push(new Qk(Z,o).rotateNeg120(k,Q))}i.sort(((k,Q)=>k.x-Q.x)),i.sort(((k,Q)=>k.y-Q.y));const B=new Array(k+Q+1),o=new Array(k+Q+1);for(let f=0;f<B.length;f++)B[f]=1/0,o[f]=-1/0;let m=0,O=0;const J=i.length;for(let f=0;f<J;f++)O=i[f].x,m=i[f].y,B[m]=Math.min(O,B[m]),o[m]=Math.max(O,o[m]);const G=(i,Z)=>{const U=i.clone();return"A"===Z&&U.rotateNeg120(k,Q),"B"===Z&&U.rotate120(k,Q),U.x<0?U.y:U.x+U.y},H=[],e=[],F=[],z=[],E={},l=[];let h=-1,c=-1;for(let f=0;f<J;f++)H[f]=i[f].toCartesianOrigin(new Qk(0,0),.5),e[f]=G(i[f],"O"),F[f]=G(i[f],"A"),z[f]=G(i[f],"B"),e[f]===F[f]&&F[f]===z[f]?(h=3,c=e[f]):e[f]===F[f]?(h=4,c=e[f]):F[f]===z[f]?(h=5,c=F[f]):z[f]===e[f]&&(h=6,c=e[f]),e[f]<F[f]&&e[f]<z[f]&&(h=2,c=e[f]),F[f]<e[f]&&F[f]<z[f]&&(h=1,c=F[f]),z[f]<F[f]&&z[f]<e[f]&&(h=0,c=z[f]),l.push([h,c,i[f].x,i[f].y]);l.sort(((k,Q)=>k[2]-Q[2])),l.sort(((k,Q)=>k[3]-Q[3])),l.sort(((k,Q)=>k[1]-Q[1])),l.sort(((k,Q)=>k[0]-Q[0]));for(let f=0;f<l.length;f++)E[l[f][2]+"|"+l[f][3]]=[l[f][0],l[f][1],f];return this.m=k,this.n=Q,this.vertices=i,this.vertByDist=E,this.cartesian=H,this.min=B,this.max=o,this}}class Zk{constructor(k,Q,i,Z){this.name=k,this.category=Q,this.vertex=i,this.face=Z}}class Uk extends Zk{innerToData(k,Q){for(let i=0;i<Q.innerFacets.length;i++)this.face.push(Q.innerFacets[i].map((i=>Q.vecToidx[k+i])))}mapABOBtoDATA(k,Q){const i=Q.IDATA.edgematch[k][0];for(let Z=0;Z<Q.isoVecsABOB.length;Z++){const U=[];for(let C=0;C<3;C++)0===Q.vertexTypes[Z][C]?U.push(k+"|"+Q.isoVecsABOB[Z][C].x+"|"+Q.isoVecsABOB[Z][C].y):U.push(i+"|"+Q.isoVecsABOB[Z][C].x+"|"+Q.isoVecsABOB[Z][C].y);this.face.push([Q.vecToidx[U[0]],Q.vecToidx[U[1]],Q.vecToidx[U[2]]])}}mapOBOAtoDATA(k,Q){const i=Q.IDATA.edgematch[k][0];for(let Z=0;Z<Q.isoVecsOBOA.length;Z++){const U=[];for(let C=0;C<3;C++)1===Q.vertexTypes[Z][C]?U.push(k+"|"+Q.isoVecsOBOA[Z][C].x+"|"+Q.isoVecsOBOA[Z][C].y):U.push(i+"|"+Q.isoVecsOBOA[Z][C].x+"|"+Q.isoVecsOBOA[Z][C].y);this.face.push([Q.vecToidx[U[0]],Q.vecToidx[U[1]],Q.vecToidx[U[2]]])}}mapBAOAtoDATA(k,Q){const i=Q.IDATA.edgematch[k][2];for(let Z=0;Z<Q.isoVecsBAOA.length;Z++){const U=[];for(let C=0;C<3;C++)1===Q.vertexTypes[Z][C]?U.push(k+"|"+Q.isoVecsBAOA[Z][C].x+"|"+Q.isoVecsBAOA[Z][C].y):U.push(i+"|"+Q.isoVecsBAOA[Z][C].x+"|"+Q.isoVecsBAOA[Z][C].y);this.face.push([Q.vecToidx[U[0]],Q.vecToidx[U[1]],Q.vecToidx[U[2]]])}}orderData(k){const Q=[];for(let C=0;C<13;C++)Q[C]=[];const i=k.closestTo;for(let C=0;C<i.length;C++)i[C][0]>-1?i[C][1]>0&&Q[i[C][0]].push([C,i[C][1]]):Q[12].push([C,i[C][0]]);const Z=[];for(let C=0;C<12;C++)Z[C]=C;let U=12;for(let C=0;C<12;C++){Q[C].sort(((k,Q)=>k[1]-Q[1]));for(let k=0;k<Q[C].length;k++)Z[Q[C][k][0]]=U++}for(let C=0;C<Q[12].length;C++)Z[Q[12][C][0]]=U++;for(let C=0;C<this.vertex.length;C++)this.vertex[C].push(Z[C]);this.vertex.sort(((k,Q)=>k[3]-Q[3]));for(let C=0;C<this.vertex.length;C++)this.vertex[C].pop();for(let C=0;C<this.face.length;C++)for(let k=0;k<this.face[C].length;k++)this.face[C][k]=Z[this.face[C][k]];this.sharedNodes=Q[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(k,Q){const i=[],Z=[];let U=Q.pop();Z.push(U);let C=this.face[U].indexOf(k);C=(C+2)%3;let B=this.face[U][C];i.push(B);let o=0;for(;Q.length>0;)U=Q[o],this.face[U].indexOf(B)>-1?(C=(this.face[U].indexOf(B)+1)%3,B=this.face[U][C],i.push(B),Z.push(U),Q.splice(o,1),o=0):o++;return this.adjacentFaces.push(i),Z}toGoldbergPolyhedronData(){const k=new Zk("GeoDual","Goldberg",[],[]);k.name="GD dual";const Q=this.vertex.length,i=new Array(Q);for(let m=0;m<Q;m++)i[m]=[];for(let m=0;m<this.face.length;m++)for(let k=0;k<3;k++)i[this.face[m][k]].push(m);let Z=0,U=0,C=0,B=[],o=[];this.adjacentFaces=[];for(let m=0;m<i.length;m++){k.face[m]=this.setOrder(m,i[m].concat([]));for(const Q of i[m]){Z=0,U=0,C=0,B=this.face[Q];for(let k=0;k<3;k++)o=this.vertex[B[k]],Z+=o[0],U+=o[1],C+=o[2];k.vertex[Q]=[Z/3,U/3,C/3]}}return k}static BuildGeodesicData(k){const Q=new Uk("Geodesic-m-n","Geodesic",[[0,kk.g,-1],[-kk.g,1,0],[-1,0,-kk.g],[1,0,-kk.g],[kk.g,1,0],[0,kk.g,1],[-1,0,kk.g],[-kk.g,-1,0],[0,-kk.g,-1],[kk.g,-1,0],[1,0,kk.g],[0,-kk.g,1]],[]);k.setIndices(),k.calcCoeffs(),k.createInnerFacets(),k.edgeVecsABOB(),k.mapABOBtoOBOA(),k.mapABOBtoBAOA();for(let i=0;i<k.IDATA.face.length;i++)k.MapToFace(i,Q),Q.innerToData(i,k),"B"===k.IDATA.edgematch[i][1]&&Q.mapABOBtoDATA(i,k),"O"===k.IDATA.edgematch[i][1]&&Q.mapOBOAtoDATA(i,k),"A"===k.IDATA.edgematch[i][3]&&Q.mapBAOAtoDATA(i,k);Q.orderData(k);return Q.vertex=Q.vertex.map((function(k){const Q=k[0],i=k[1],Z=k[2],U=Math.sqrt(Q*Q+i*i+Z*Z);return k[0]*=1/U,k[1]*=1/U,k[2]*=1/U,k})),Q}}U.d._GoldbergMeshParser=(k,Q)=>Ck.Parse(k,Q);class Ck extends U.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(k,Q){return void 0===Q?(k>this.goldbergData.nbUnsharedFaces-1&&(V.c.Warn("Maximum number of unshared faces used"),k=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+k):(k>11&&(V.c.Warn("Last pole used"),k=11),Q>this.goldbergData.nbFacesAtPole-1&&(V.c.Warn("Maximum number of faces at a pole used"),Q=this.goldbergData.nbFacesAtPole-1),12+k*this.goldbergData.nbFacesAtPole+Q)}_changeGoldbergFaceColors(k){for(let i=0;i<k.length;i++){const Q=k[i][0],Z=k[i][1],U=k[i][2];for(let k=Q;k<Z+1;k++)this.goldbergData.faceColors[k]=U}const Q=[];for(let i=0;i<12;i++)for(let k=0;k<5;k++)Q.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);for(let i=12;i<this.goldbergData.faceColors.length;i++)for(let k=0;k<6;k++)Q.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);return Q}setGoldbergFaceColors(k){const Q=this._changeGoldbergFaceColors(k);this.bk(C.h.ColorKind,Q)}updateGoldbergFaceColors(k){const Q=this._changeGoldbergFaceColors(k);this.updateVerticesData(C.h.ColorKind,Q)}_changeGoldbergFaceUVs(k){const Q=this.getVerticesData(C.h.UVKind);for(let i=0;i<k.length;i++){const Z=k[i][0],U=k[i][1],C=k[i][2],B=k[i][3],o=k[i][4],m=[],O=[];let J,G;for(let k=0;k<5;k++)J=C.x+B*Math.cos(o+k*Math.PI/2.5),G=C.y+B*Math.sin(o+k*Math.PI/2.5),J<0&&(J=0),J>1&&(J=1),m.push(J,G);for(let k=0;k<6;k++)J=C.x+B*Math.cos(o+k*Math.PI/3),G=C.y+B*Math.sin(o+k*Math.PI/3),J<0&&(J=0),J>1&&(J=1),O.push(J,G);for(let k=Z;k<Math.min(12,U+1);k++)for(let i=0;i<5;i++)Q[10*k+2*i]=m[2*i],Q[10*k+2*i+1]=m[2*i+1];for(let k=Math.max(12,Z);k<U+1;k++)for(let i=0;i<6;i++)Q[12*k-24+2*i]=O[2*i],Q[12*k-23+2*i]=O[2*i+1]}return Q}setGoldbergFaceUVs(k){const Q=this._changeGoldbergFaceUVs(k);this.bk(C.h.UVKind,Q)}updateGoldbergFaceUVs(k){const Q=this._changeGoldbergFaceUVs(k);this.updateVerticesData(C.h.UVKind,Q)}placeOnGoldbergFaceAt(k,Q,i){const U=Z.zQ.RotationFromAxis(this.goldbergData.faceXaxis[Q],this.goldbergData.faceYaxis[Q],this.goldbergData.faceZaxis[Q]);k.rotation=U,k.position=this.goldbergData.faceCenters[Q].add(this.goldbergData.faceXaxis[Q].scale(i.x)).add(this.goldbergData.faceYaxis[Q].scale(i.y)).add(this.goldbergData.faceZaxis[Q].scale(i.z))}serialize(k){super.serialize(k),k.type="GoldbergMesh";const Q={};if(Q.adjacentFaces=this.goldbergData.adjacentFaces,Q.nbSharedFaces=this.goldbergData.nbSharedFaces,Q.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,Q.nbFaces=this.goldbergData.nbFaces,Q.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){Q.faceColors=[];for(const k of this.goldbergData.faceColors)Q.faceColors.push(k.Zo())}if(this.goldbergData.faceCenters){Q.faceCenters=[];for(const k of this.goldbergData.faceCenters)Q.faceCenters.push(k.Zo())}if(this.goldbergData.faceZaxis){Q.faceZaxis=[];for(const k of this.goldbergData.faceZaxis)Q.faceZaxis.push(k.Zo())}if(this.goldbergData.faceYaxis){Q.faceYaxis=[];for(const k of this.goldbergData.faceYaxis)Q.faceYaxis.push(k.Zo())}if(this.goldbergData.faceXaxis){Q.faceXaxis=[];for(const k of this.goldbergData.faceXaxis)Q.faceXaxis.push(k.Zo())}k.goldbergData=Q}static Parse(k,Q){const i=k.goldbergData;i.faceColors=i.faceColors.map((k=>H.Fo.fQ(k))),i.faceCenters=i.faceCenters.map((k=>Z.zQ.fQ(k))),i.faceZaxis=i.faceZaxis.map((k=>Z.zQ.fQ(k))),i.faceXaxis=i.faceXaxis.map((k=>Z.zQ.fQ(k))),i.faceYaxis=i.faceYaxis.map((k=>Z.zQ.fQ(k)));const U=new Ck(k.name,Q);return U.goldbergData=i,U}}var Bk=i(11836);const ok={CreateBox:G.e,CreateTiledBox:E,CreateSphere:l.c,CreateDisc:J.b,CreateIcoSphere:A,CreateRibbon:O,CreateCylinder:Y,CreateTorus:L,CreateTorusKnot:u,CreateLineSystem:a.g,HO:a.h,CreateDashedLines:a.c,ExtrudeShape:K,ExtrudeShapeCustom:v,CreateLathe:X,CreateTiledPlane:F,zO:p.b,CreateGround:d.f,CreateTiledGround:d.h,CreateGroundFromHeightMap:d.e,CreatePolygon:j.d,ExtrudePolygon:j.h,CreateTube:b,CreatePolyhedron:M,CreateGeodesic:function(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=Q.m||1;Z!==Math.floor(Z)&&(Z=Math.floor(Z),V.c.Warn("m not an integer only floor(m) used"));let U=Q.n||0;if(U!==Math.floor(U)&&(U=Math.floor(U),V.c.Warn("n not an integer only floor(n) used")),U>Z){const k=U;U=Z,Z=k,V.c.Warn("n > m therefore m and n swapped")}const C=new ik;return C.build(Z,U),M(k,{custom:Uk.BuildGeodesicData(C),size:Q.size,sizeX:Q.sizeX,sizeY:Q.sizeY,sizeZ:Q.sizeZ,faceUV:Q.faceUV,faceColors:Q.faceColors,flat:Q.flat,updatable:Q.updatable,sideOrientation:Q.sideOrientation,frontUVs:Q.frontUVs,backUVs:Q.backUVs},i)},CreateGoldberg:function(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=Q.size,m=Q.sizeX||C||1,O=Q.sizeY||C||1,J=Q.sizeZ||C||1;let G=Q.m||1;G!==Math.floor(G)&&(G=Math.floor(G),V.c.Warn("m not an integer only floor(m) used"));let e=Q.n||0;if(e!==Math.floor(e)&&(e=Math.floor(e),V.c.Warn("n not an integer only floor(n) used")),e>G){const k=e;e=G,G=k,V.c.Warn("n > m therefore m and n swapped")}const F=new ik;F.build(G,e);const z=Uk.BuildGeodesicData(F),E=z.toGoldbergPolyhedronData(),l=new Ck(k,i);Q.sideOrientation=U.d._GetDefaultSideOrientation(Q.sideOrientation),l._originalBuilderSideOrientation=Q.sideOrientation;(function(k,Q){const i=k.size,U=k.sizeX||i||1,C=k.sizeY||i||1,m=k.sizeZ||i||1,O=0===k.sideOrientation?0:k.sideOrientation||B.d.DEFAULTSIDE,J=[],G=[],H=[],e=[];let F=1/0,z=-1/0,E=1/0,l=-1/0;for(let Z=0;Z<Q.vertex.length;Z++)F=Math.min(F,Q.vertex[Z][0]*U),z=Math.max(z,Q.vertex[Z][0]*U),E=Math.min(E,Q.vertex[Z][1]*C),l=Math.max(l,Q.vertex[Z][1]*C);let h=0;for(let B=0;B<Q.face.length;B++){const k=Q.face[B],i=Z.zQ.fQ(Q.vertex[k[0]]),O=Z.zQ.fQ(Q.vertex[k[2]]),c=Z.zQ.fQ(Q.vertex[k[1]]),f=O.EQ(i),Y=c.EQ(i),y=Z.zQ.Cross(Y,f).normalize();for(let Z=0;Z<k.length;Z++){H.push(y.x,y.y,y.z);const i=Q.vertex[k[Z]];J.push(i[0]*U,i[1]*C,i[2]*m);const B=(i[1]*C-E)/(l-E);e.push((i[0]*U-F)/(z-F),o.d?1-B:B)}for(let Q=0;Q<k.length-2;Q++)G.push(h,h+Q+2,h+Q+1);h+=k.length}B.d._ComputeSides(O,J,G,H,e);const c=new B.d;return c.ak=J,c.indices=G,c.jk=H,c.Kk=e,c})(Q,E).Nk(l,Q.updatable),l.goldbergData.nbSharedFaces=z.sharedNodes,l.goldbergData.nbUnsharedFaces=z.poleNodes,l.goldbergData.adjacentFaces=z.adjacentFaces,l.goldbergData.nbFaces=l.goldbergData.nbSharedFaces+l.goldbergData.nbUnsharedFaces,l.goldbergData.nbFacesAtPole=(l.goldbergData.nbUnsharedFaces-12)/12;for(let U=0;U<z.vertex.length;U++)l.goldbergData.faceCenters.push(Z.zQ.fQ(z.vertex[U])),l.goldbergData.faceCenters[U].x*=m,l.goldbergData.faceCenters[U].y*=O,l.goldbergData.faceCenters[U].z*=J,l.goldbergData.faceColors.push(new H.Fo(1,1,1,1));for(let U=0;U<E.face.length;U++){const k=E.face[U],Q=Z.zQ.fQ(E.vertex[k[0]]),i=Z.zQ.fQ(E.vertex[k[2]]),C=Z.zQ.fQ(E.vertex[k[1]]),B=i.EQ(Q),o=C.EQ(Q),m=Z.zQ.Cross(o,B).normalize(),O=Z.zQ.Cross(o,m).normalize();l.goldbergData.faceXaxis.push(o.normalize()),l.goldbergData.faceYaxis.push(m),l.goldbergData.faceZaxis.push(O)}return l},CreateDecal:r,CreateCapsule:x,CreateText:Bk.g}},12627:(k,Q,i)=>{"use strict";i.d(Q,{d:()=>oQ});var Z=i(11298),U=i(11666);class C extends U.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var B=i(11348),o=(i(11462),i(11253));class m{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(k){this._targetStopDuration!==k&&(this._targetStopDuration=k)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(k){this._noiseTexture!==k&&(this._noiseTexture=k,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(k){this._animationSheetEnabled!==k&&(this._animationSheetEnabled=k)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(k){this._isAnimationSheetEnabled!=k&&(this._isAnimationSheetEnabled=k,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(k){this._useLogarithmicDepth=k&&this.sk().getEngine().getCaps().fragmentDepthSupported}sk(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(k){switch(k){case m.BLENDMODE_MULTIPLYADD:return;case m.BLENDMODE_ADD:k=1;break;case m.BLENDMODE_ONEONE:k=6;break;case m.BLENDMODE_STANDARD:k=2;break;case m.BLENDMODE_MULTIPLY:k=4;break;case m.BLENDMODE_SUBTRACT:k=3}this._engine.setAlphaMode(k)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:Z.zQ.Zero()}set direction1(k){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=k)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:Z.zQ.Zero()}set direction2(k){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=k)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:Z.zQ.Zero()}set minEmitBox(k){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=k)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:Z.zQ.Zero()}set maxEmitBox(k){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=k)}get billboardMode(){return this._billboardMode}set billboardMode(k){this._billboardMode!==k&&(this._billboardMode=k,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(k){this._isBillboardBased!==k&&(this._isBillboardBased=k,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(k){this._attachImageProcessingConfiguration(k)}_attachImageProcessingConfiguration(k){k!==this._imageProcessingConfiguration&&(!k&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=k)}_reset(){}_removeGradientAndTexture(k,Q,i){if(!Q)return this;let Z=0;for(const U of Q){if(U.gradient===k){Q.splice(Z,1);break}Z++}return i&&i.dispose(),this}constructor(k){this.animations=[],this.renderingGroupId=0,this.UQ=Z.zQ.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new Z.zQ(10,10,10),this.onAnimationEnd=null,this.blendMode=m.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new Z.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.OO=new Z.zQ(0,0,0),this._useLogarithmicDepth=!1,this.gravity=Z.zQ.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new B.Fo(1,1,1,1),this.color2=new B.Fo(1,1,1,1),this.colorDead=new B.Fo(0,0,0,1),this.textureMask=new B.Fo(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new C,this.id=k,this.name=k}createPointEmitter(k,Q){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new Z.zQ(0,1,0),arguments.length>2&&void 0!==arguments[2]||new Z.zQ(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new Z.zQ(0,1,0),arguments.length>4&&void 0!==arguments[4]||new Z.zQ(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new Z.zQ(0,1,0),arguments.length>3&&void 0!==arguments[3]||new Z.zQ(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(k,Q,i,Z){throw new Error("Method not implemented.")}}m.BLENDMODE_ONEONE=0,m.BLENDMODE_STANDARD=1,m.BLENDMODE_ADD=2,m.BLENDMODE_MULTIPLY=3,m.BLENDMODE_MULTIPLYADD=4,m.BLENDMODE_SUBTRACT=-1,(0,o.e)("BABYLON.BaseParticleSystem",m);var O=i(11311),J=i(11142);class G{constructor(){this.direction1=new Z.zQ(0,1,0),this.direction2=new Z.zQ(0,1,0),this.minEmitBox=new Z.zQ(-.5,-.5,-.5),this.maxEmitBox=new Z.zQ(.5,.5,.5)}startDirectionFunction(k,Q,i,U){const C=(0,O.RandomRange)(this.direction1.x,this.direction2.x),B=(0,O.RandomRange)(this.direction1.y,this.direction2.y),o=(0,O.RandomRange)(this.direction1.z,this.direction2.z);if(U)return Q.x=C,Q.y=B,void(Q.z=o);Z.zQ.TransformNormalFromFloatsToRef(C,B,o,k,Q)}startPositionFunction(k,Q,i,U){const C=(0,O.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),B=(0,O.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),o=(0,O.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(U)return Q.x=C,Q.y=B,void(Q.z=o);Z.zQ.TransformCoordinatesFromFloatsToRef(C,B,o,k,Q)}clone(){const k=new G;return J.b.DeepCopy(this,k),k}applyToShader(k){k.setVector3("direction1",this.direction1),k.setVector3("direction2",this.direction2),k.setVector3("minEmitBox",this.minEmitBox),k.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(k){k.addUniform("direction1",3),k.addUniform("direction2",3),k.addUniform("minEmitBox",3),k.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.direction1=this.direction1.Zo(),k.direction2=this.direction2.Zo(),k.minEmitBox=this.minEmitBox.Zo(),k.maxEmitBox=this.maxEmitBox.Zo(),k}parse(k){Z.zQ.FromArrayToRef(k.direction1,0,this.direction1),Z.zQ.FromArrayToRef(k.direction2,0,this.direction2),Z.zQ.FromArrayToRef(k.minEmitBox,0,this.minEmitBox),Z.zQ.FromArrayToRef(k.maxEmitBox,0,this.maxEmitBox)}}class H{get radius(){return this._radius}set radius(k){this._radius=k,this._buildHeight()}get angle(){return this._angle}set angle(k){this._angle=k,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=i,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=Q,this.radius=k}startDirectionFunction(k,Q,i,U){U?Z.TmpVectors.zQ[0].B(i.Do).normalize():i.position.subtractToRef(k.getTranslation(),Z.TmpVectors.zQ[0]).normalize();const C=(0,O.RandomRange)(0,this.directionRandomizer),B=(0,O.RandomRange)(0,this.directionRandomizer),o=(0,O.RandomRange)(0,this.directionRandomizer);Q.x=Z.TmpVectors.zQ[0].x+C,Q.y=Z.TmpVectors.zQ[0].y+B,Q.z=Z.TmpVectors.zQ[0].z+o,Q.normalize()}startPositionFunction(k,Q,i,U){const C=(0,O.RandomRange)(0,2*Math.PI);let B;this.emitFromSpawnPointOnly?B=1e-4:(B=(0,O.RandomRange)(0,this.heightRange),B=1-B*B);let o=this._radius-(0,O.RandomRange)(0,this._radius*this.radiusRange);o*=B;const m=o*Math.sin(C),J=o*Math.cos(C),G=B*this._height;if(U)return Q.x=m,Q.y=G,void(Q.z=J);Z.zQ.TransformCoordinatesFromFloatsToRef(m,G,J,k,Q)}clone(){const k=new H(this._radius,this._angle,this.directionRandomizer);return J.b.DeepCopy(this,k),k}applyToShader(k){k.setFloat2("radius",this._radius,this.radiusRange),k.setFloat("coneAngle",this._angle),k.setFloat2("height",this._height,this.heightRange),k.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(k){k.addUniform("radius",2),k.addUniform("coneAngle",1),k.addUniform("height",2),k.addUniform("directionRandomizer",1)}getEffectDefines(){let k="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(k+="\n#define CONEEMITTERSPAWNPOINT"),k}getClassName(){return"ConeParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.radius=this._radius,k.angle=this._angle,k.directionRandomizer=this.directionRandomizer,k.radiusRange=this.radiusRange,k.heightRange=this.heightRange,k.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,k}parse(k){this.radius=k.radius,this.angle=k.angle,this.directionRandomizer=k.directionRandomizer,this.radiusRange=void 0!==k.radiusRange?k.radiusRange:1,this.heightRange=void 0!==k.radiusRange?k.heightRange:1,this.emitFromSpawnPointOnly=void 0!==k.emitFromSpawnPointOnly&&k.emitFromSpawnPointOnly}}class e extends H{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.zQ(0,1,0),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.zQ(0,1,0);super(k,Q),this.direction1=i,this.direction2=U}startDirectionFunction(k,Q){const i=(0,O.RandomRange)(this.direction1.x,this.direction2.x),U=(0,O.RandomRange)(this.direction1.y,this.direction2.y),C=(0,O.RandomRange)(this.direction1.z,this.direction2.z);Z.zQ.TransformNormalFromFloatsToRef(i,U,C,k,Q)}clone(){const k=new e(this.radius,this.angle,this.direction1,this.direction2);return J.b.DeepCopy(this,k),k}applyToShader(k){k.setFloat("radius",this.radius),k.setFloat("radiusRange",this.radiusRange),k.setVector3("direction1",this.direction1),k.setVector3("direction2",this.direction2)}buildUniformLayout(k){k.addUniform("radius",1),k.addUniform("radiusRange",1),k.addUniform("direction1",3),k.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const k=super.serialize();return k.direction1=this.direction1.Zo(),k.direction2=this.direction2.Zo(),k}parse(k){super.parse(k),this.direction1.B(k.direction1),this.direction2.B(k.direction2)}}class F{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=k,this.height=Q,this.radiusRange=i,this.directionRandomizer=U,this._tempVector=Z.zQ.Zero()}startDirectionFunction(k,Q,i,U,C){i.position.subtractToRef(k.getTranslation(),this._tempVector),this._tempVector.normalize(),Z.zQ.TransformNormalToRef(this._tempVector,C,this._tempVector);const B=(0,O.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let o=Math.atan2(this._tempVector.x,this._tempVector.z);o+=(0,O.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=B,this._tempVector.x=Math.sin(o),this._tempVector.z=Math.cos(o),this._tempVector.normalize(),U?Q.B(this._tempVector):Z.zQ.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,k,Q)}startPositionFunction(k,Q,i,U){const C=(0,O.RandomRange)(-this.height/2,this.height/2),B=(0,O.RandomRange)(0,2*Math.PI),o=(0,O.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),m=Math.sqrt(o)*this.radius,J=m*Math.cos(B),G=m*Math.sin(B);U?Q.Go(J,C,G):Z.zQ.TransformCoordinatesFromFloatsToRef(J,C,G,k,Q)}clone(){const k=new F(this.radius,this.directionRandomizer);return J.b.DeepCopy(this,k),k}applyToShader(k){k.setFloat("radius",this.radius),k.setFloat("height",this.height),k.setFloat("radiusRange",this.radiusRange),k.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(k){k.addUniform("radius",1),k.addUniform("height",1),k.addUniform("radiusRange",1),k.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.radius=this.radius,k.height=this.height,k.radiusRange=this.radiusRange,k.directionRandomizer=this.directionRandomizer,k}parse(k){this.radius=k.radius,this.height=k.height,this.radiusRange=k.radiusRange,this.directionRandomizer=k.directionRandomizer}}class z extends F{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.zQ(0,1,0),C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Z.zQ(0,1,0);super(k,Q,i),this.direction1=U,this.direction2=C}startDirectionFunction(k,Q,i,U){const C=(0,O.RandomRange)(this.direction1.x,this.direction2.x),B=(0,O.RandomRange)(this.direction1.y,this.direction2.y),o=(0,O.RandomRange)(this.direction1.z,this.direction2.z);U?Q.Go(C,B,o):Z.zQ.TransformNormalFromFloatsToRef(C,B,o,k,Q)}clone(){const k=new z(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return J.b.DeepCopy(this,k),k}applyToShader(k){k.setFloat("radius",this.radius),k.setFloat("height",this.height),k.setFloat("radiusRange",this.radiusRange),k.setVector3("direction1",this.direction1),k.setVector3("direction2",this.direction2)}buildUniformLayout(k){k.addUniform("radius",1),k.addUniform("height",1),k.addUniform("radiusRange",1),k.addUniform("direction1",3),k.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const k=super.serialize();return k.direction1=this.direction1.Zo(),k.direction2=this.direction2.Zo(),k}parse(k){super.parse(k),Z.zQ.FromArrayToRef(k.direction1,0,this.direction1),Z.zQ.FromArrayToRef(k.direction2,0,this.direction2)}}class E{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=k,this.radiusRange=Q,this.directionRandomizer=i}startDirectionFunction(k,Q,i,U){const C=i.position.EQ(k.getTranslation()).normalize(),B=(0,O.RandomRange)(0,this.directionRandomizer),o=(0,O.RandomRange)(0,this.directionRandomizer),m=(0,O.RandomRange)(0,this.directionRandomizer);C.x+=B,C.y+=o,C.z+=m,C.normalize(),U?Q.B(C):Z.zQ.TransformNormalFromFloatsToRef(C.x,C.y,C.z,k,Q)}startPositionFunction(k,Q,i,U){const C=this.radius-(0,O.RandomRange)(0,this.radius*this.radiusRange),B=(0,O.RandomRange)(0,1),o=(0,O.RandomRange)(0,2*Math.PI),m=Math.acos(2*B-1),J=C*Math.cos(o)*Math.sin(m),G=C*Math.cos(m),H=C*Math.sin(o)*Math.sin(m);U?Q.Go(J,Math.abs(G),H):Z.zQ.TransformCoordinatesFromFloatsToRef(J,Math.abs(G),H,k,Q)}clone(){const k=new E(this.radius,this.directionRandomizer);return J.b.DeepCopy(this,k),k}applyToShader(k){k.setFloat("radius",this.radius),k.setFloat("radiusRange",this.radiusRange),k.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(k){k.addUniform("radius",1),k.addUniform("radiusRange",1),k.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.radius=this.radius,k.radiusRange=this.radiusRange,k.directionRandomizer=this.directionRandomizer,k}parse(k){this.radius=k.radius,this.radiusRange=k.radiusRange,this.directionRandomizer=k.directionRandomizer}}class l{constructor(){this.direction1=new Z.zQ(0,1,0),this.direction2=new Z.zQ(0,1,0)}startDirectionFunction(k,Q,i,U){const C=(0,O.RandomRange)(this.direction1.x,this.direction2.x),B=(0,O.RandomRange)(this.direction1.y,this.direction2.y),o=(0,O.RandomRange)(this.direction1.z,this.direction2.z);U?Q.Go(C,B,o):Z.zQ.TransformNormalFromFloatsToRef(C,B,o,k,Q)}startPositionFunction(k,Q,i,U){U?Q.Go(0,0,0):Z.zQ.TransformCoordinatesFromFloatsToRef(0,0,0,k,Q)}clone(){const k=new l;return J.b.DeepCopy(this,k),k}applyToShader(k){k.setVector3("direction1",this.direction1),k.setVector3("direction2",this.direction2)}buildUniformLayout(k){k.addUniform("direction1",3),k.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.direction1=this.direction1.Zo(),k.direction2=this.direction2.Zo(),k}parse(k){Z.zQ.FromArrayToRef(k.direction1,0,this.direction1),Z.zQ.FromArrayToRef(k.direction2,0,this.direction2)}}class h{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=k,this.radiusRange=Q,this.directionRandomizer=i}startDirectionFunction(k,Q,i,U){const C=i.position.EQ(k.getTranslation()).normalize(),B=(0,O.RandomRange)(0,this.directionRandomizer),o=(0,O.RandomRange)(0,this.directionRandomizer),m=(0,O.RandomRange)(0,this.directionRandomizer);C.x+=B,C.y+=o,C.z+=m,C.normalize(),U?Q.B(C):Z.zQ.TransformNormalFromFloatsToRef(C.x,C.y,C.z,k,Q)}startPositionFunction(k,Q,i,U){const C=this.radius-(0,O.RandomRange)(0,this.radius*this.radiusRange),B=(0,O.RandomRange)(0,1),o=(0,O.RandomRange)(0,2*Math.PI),m=Math.acos(2*B-1),J=C*Math.cos(o)*Math.sin(m),G=C*Math.cos(m),H=C*Math.sin(o)*Math.sin(m);U?Q.Go(J,G,H):Z.zQ.TransformCoordinatesFromFloatsToRef(J,G,H,k,Q)}clone(){const k=new h(this.radius,this.directionRandomizer);return J.b.DeepCopy(this,k),k}applyToShader(k){k.setFloat("radius",this.radius),k.setFloat("radiusRange",this.radiusRange),k.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(k){k.addUniform("radius",1),k.addUniform("radiusRange",1),k.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.radius=this.radius,k.radiusRange=this.radiusRange,k.directionRandomizer=this.directionRandomizer,k}parse(k){this.radius=k.radius,this.radiusRange=k.radiusRange,this.directionRandomizer=k.directionRandomizer}}class c extends h{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Z.zQ(0,1,0),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.zQ(0,1,0);super(k),this.direction1=Q,this.direction2=i}startDirectionFunction(k,Q){const i=(0,O.RandomRange)(this.direction1.x,this.direction2.x),U=(0,O.RandomRange)(this.direction1.y,this.direction2.y),C=(0,O.RandomRange)(this.direction1.z,this.direction2.z);Z.zQ.TransformNormalFromFloatsToRef(i,U,C,k,Q)}clone(){const k=new c(this.radius,this.direction1,this.direction2);return J.b.DeepCopy(this,k),k}applyToShader(k){k.setFloat("radius",this.radius),k.setFloat("radiusRange",this.radiusRange),k.setVector3("direction1",this.direction1),k.setVector3("direction2",this.direction2)}buildUniformLayout(k){k.addUniform("radius",1),k.addUniform("radiusRange",1),k.addUniform("direction1",3),k.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const k=super.serialize();return k.direction1=this.direction1.Zo(),k.direction2=this.direction2.Zo(),k}parse(k){super.parse(k),this.direction1.B(k.direction1),this.direction2.B(k.direction2)}}class f{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(k,Q,i,U){const C=Z.TmpVectors.zQ[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,i,C);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,i,C);const k=Z.TmpVectors.zQ[1];C.subtractToRef(i.position,k),k.scaleToRef(1/i.lifeTime,C)}else C.set(0,0,0);U?Q.B(C):Z.zQ.TransformNormalToRef(C,k,Q)}startPositionFunction(k,Q,i,U){const C=Z.TmpVectors.zQ[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,i,C):C.set(0,0,0),U?Q.B(C):Z.zQ.TransformCoordinatesToRef(C,k,Q)}clone(){const k=new f;return J.b.DeepCopy(this,k),k}applyToShader(k){}buildUniformLayout(k){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.particlePositionGenerator=this.particlePositionGenerator,k.particleDestinationGenerator=this.particleDestinationGenerator,k}parse(k){k.particlePositionGenerator&&(this.particlePositionGenerator=k.particlePositionGenerator),k.particleDestinationGenerator&&(this.particleDestinationGenerator=k.particleDestinationGenerator)}}var Y=i(11378);class y{get mesh(){return this._mesh}set mesh(k){this._mesh!==k&&(this._mesh=k,k?(this._indices=k.Oo(),this._positions=k.getVerticesData(Y.h.PositionKind),this._normals=k.getVerticesData(Y.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=Z.zQ.Zero(),this._mesh=null,this.direction1=new Z.zQ(0,1,0),this.direction2=new Z.zQ(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=k}startDirectionFunction(k,Q,i,U){if(this.useMeshNormalsForDirection&&this._normals)return void Z.zQ.TransformNormalToRef(this._storedNormal,k,Q);const C=(0,O.RandomRange)(this.direction1.x,this.direction2.x),B=(0,O.RandomRange)(this.direction1.y,this.direction2.y),o=(0,O.RandomRange)(this.direction1.z,this.direction2.z);U?Q.Go(C,B,o):Z.zQ.TransformNormalFromFloatsToRef(C,B,o,k,Q)}startPositionFunction(k,Q,i,U){if(!this._indices||!this._positions)return;const C=3*(Math.random()*(this._indices.length/3)|0),B=Math.random(),o=Math.random()*(1-B),m=1-B-o,O=this._indices[C],J=this._indices[C+1],G=this._indices[C+2],H=Z.TmpVectors.zQ[0],e=Z.TmpVectors.zQ[1],F=Z.TmpVectors.zQ[2],z=Z.TmpVectors.zQ[3];Z.zQ.FromArrayToRef(this._positions,3*O,H),Z.zQ.FromArrayToRef(this._positions,3*J,e),Z.zQ.FromArrayToRef(this._positions,3*G,F),z.x=B*H.x+o*e.x+m*F.x,z.y=B*H.y+o*e.y+m*F.y,z.z=B*H.z+o*e.z+m*F.z,U?Q.Go(z.x,z.y,z.z):Z.zQ.TransformCoordinatesFromFloatsToRef(z.x,z.y,z.z,k,Q),this.useMeshNormalsForDirection&&this._normals&&(Z.zQ.FromArrayToRef(this._normals,3*O,H),Z.zQ.FromArrayToRef(this._normals,3*J,e),Z.zQ.FromArrayToRef(this._normals,3*G,F),this._storedNormal.x=B*H.x+o*e.x+m*F.x,this._storedNormal.y=B*H.y+o*e.y+m*F.y,this._storedNormal.z=B*H.z+o*e.z+m*F.z)}clone(){const k=new y(this.mesh);return J.b.DeepCopy(this,k),k}applyToShader(k){k.setVector3("direction1",this.direction1),k.setVector3("direction2",this.direction2)}buildUniformLayout(k){k.addUniform("direction1",3),k.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var k;const Q={};return Q.type=this.getClassName(),Q.direction1=this.direction1.Zo(),Q.direction2=this.direction2.Zo(),Q.meshId=null===(k=this.mesh)||void 0===k?void 0:k.id,Q.useMeshNormalsForDirection=this.useMeshNormalsForDirection,Q}parse(k,Q){Z.zQ.FromArrayToRef(k.direction1,0,this.direction1),Z.zQ.FromArrayToRef(k.direction2,0,this.direction2),k.meshId&&Q&&(this.mesh=Q.getLastMeshById(k.meshId)),this.useMeshNormalsForDirection=k.useMeshNormalsForDirection}}class L{_isUbo(k){return void 0!==k.addUniform}constructor(k){this._isUbo(k)?(this.setMatrix3x3=k.updateMatrix3x3.bind(k),this.setMatrix2x2=k.updateMatrix2x2.bind(k),this.setFloat=k.updateFloat.bind(k),this.setFloat2=k.updateFloat2.bind(k),this.setFloat3=k.updateFloat3.bind(k),this.setFloat4=k.updateFloat4.bind(k),this.setFloatArray=k.updateFloatArray.bind(k),this.setArray=k.updateArray.bind(k),this.setIntArray=k.updateIntArray.bind(k),this.setMatrix=k.Bo.bind(k),this.setMatrices=k.updateMatrices.bind(k),this.setVector3=k.updateVector3.bind(k),this.setVector4=k.updateVector4.bind(k),this.setColor3=k.updateColor3.bind(k),this.setColor4=k.updateColor4.bind(k),this.setDirectColor4=k.updateDirectColor4.bind(k),this.setInt=k.updateInt.bind(k),this.setInt2=k.updateInt2.bind(k),this.setInt3=k.updateInt3.bind(k),this.setInt4=k.updateInt4.bind(k)):(this.setMatrix3x3=k.setMatrix3x3.bind(k),this.setMatrix2x2=k.setMatrix2x2.bind(k),this.setFloat=k.setFloat.bind(k),this.setFloat2=k.setFloat2.bind(k),this.setFloat3=k.setFloat3.bind(k),this.setFloat4=k.setFloat4.bind(k),this.setFloatArray=k.setFloatArray.bind(k),this.setArray=k.setArray.bind(k),this.setIntArray=k.setIntArray.bind(k),this.setMatrix=k.setMatrix.bind(k),this.setMatrices=k.setMatrices.bind(k),this.setVector3=k.setVector3.bind(k),this.setVector4=k.setVector4.bind(k),this.setColor3=k.setColor3.bind(k),this.setColor4=k.setColor4.bind(k),this.setDirectColor4=k.setDirectColor4.bind(k),this.setInt=k.setInt.bind(k),this.setInt2=k.setInt2.bind(k),this.setInt3=k.setInt3.bind(k),this.setInt4=k.setInt4.bind(k))}}var s=i(11210);const u="gpuUpdateParticlesPixelShader",a="#version 300 es\nvoid main() {discard;}\n";s.d.ShadersStore[u]||(s.d.ShadersStore[u]=a);const j="gpuUpdateParticlesVertexShader",T="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";s.d.ShadersStore[j]||(s.d.ShadersStore[j]=T);(0,o.e)("BABYLON.WebGL2ParticleSystem",class{constructor(k,Q){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=k,this._engine=Q,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var k;return(null===(k=this._updateEffect)||void 0===k?void 0:k.isReady())??!1}createUpdateBuffer(k){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof f&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=k,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new L(this._updateEffect)}createVertexBuffers(k,Q){this._updateVAO.push(this._createUpdateVAO(k)),this._renderVAO.push(this._engine.recordVertexArrayObject(Q,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=Q}createParticleBuffer(k){return k}bindDrawBuffers(k,Q,i){i?this._engine.bindBuffers(this._renderVertexBuffers,i,Q):this._engine.bindVertexArrayObject(this._renderVAO[k],null)}preUpdateParticleBuffer(){const k=this._engine;if(this._engine.enableEffect(this._updateEffect),!k.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(k,Q,i){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[k],null);const Z=this._engine;Z.bindTransformFeedbackBuffer(Q.getBuffer()),Z.setRasterizerState(!1),Z.beginTransformFeedback(!0),Z.drawArraysType(3,0,i),Z.endTransformFeedback(),Z.setRasterizerState(!0),Z.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let k=0;k<this._updateVAO.length;k++)this._engine.releaseVertexArrayObject(this._updateVAO[k]);this._updateVAO.length=0;for(let k=0;k<this._renderVAO.length;k++)this._engine.releaseVertexArrayObject(this._renderVAO[k]);this._renderVAO.length=0}_createUpdateVAO(k){const Q={};Q.position=k.createVertexBuffer("position",0,3);let i=3;Q.age=k.createVertexBuffer("age",i,1),i+=1,Q.size=k.createVertexBuffer("size",i,3),i+=3,Q.life=k.createVertexBuffer("life",i,1),i+=1,Q.seed=k.createVertexBuffer("seed",i,4),i+=4,Q.direction=k.createVertexBuffer("direction",i,3),i+=3,this._parent.particleEmitterType instanceof f&&(Q.initialPosition=k.createVertexBuffer("initialPosition",i,3),i+=3),this._parent._colorGradientsTexture||(Q.color=k.createVertexBuffer("color",i,4),i+=4),this._parent._isBillboardBased||(Q.initialDirection=k.createVertexBuffer("initialDirection",i,3),i+=3),this._parent.noiseTexture&&(Q.noiseCoordinates1=k.createVertexBuffer("noiseCoordinates1",i,3),i+=3,Q.noiseCoordinates2=k.createVertexBuffer("noiseCoordinates2",i,3),i+=3),this._parent._angularSpeedGradientsTexture?(Q.angle=k.createVertexBuffer("angle",i,1),i+=1):(Q.angle=k.createVertexBuffer("angle",i,2),i+=2),this._parent._isAnimationSheetEnabled&&(Q.cellIndex=k.createVertexBuffer("cellIndex",i,1),i+=1,this._parent.spriteRandomStartCell&&(Q.cellStartOffset=k.createVertexBuffer("cellStartOffset",i,1),i+=1));const Z=this._engine.recordVertexArrayObject(Q,null,this._updateEffect);return this._engine.bindArrayBuffer(null),Z}});class K{constructor(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,Z=arguments.length>3?arguments[3]:void 0;this._engine=k,this._label=Z,this._engine._storageBuffers.push(this),this._create(Q,i)}_create(k,Q){this._bufferSize=k,this._creationFlags=Q,this._buffer=this._engine.createStorageBuffer(k,Q,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(k,Q,i){this._buffer&&this._engine.updateStorageBuffer(this._buffer,k,Q,i)}async read(k,Q,i,Z){return await this._engine.readFromStorageBuffer(this._buffer,k,Q,i,Z)}dispose(){const k=this._engine._storageBuffers,Q=k.indexOf(this);-1!==Q&&(k[Q]=k[k.length-1],k.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var v=i(11280),N=i(11289),X=i(11334),p=i(11273),d=i(11591),b=i(11134),D=i(11242),M=i(11513);class W{constructor(){this._gpuTimeInFrameId=-1,this.counter=new M.b}_addDuration(k,Q){k<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==k?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(Q,!1),this._gpuTimeInFrameId=k):this.counter.addCount(Q,!1))}}var A=i(11189);class g{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=k,this._engine=Q,this.uniqueId=d.e.UniqueId,Q.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new W),this._engine.getCaps().supportComputeShaders?Z.bindingsMapping?(this._context=Q.createComputeContext(),this._shaderPath=i,this._options={bindingsMapping:{},defines:[],...Z}):b.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):b.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(k,Q){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const Z=this._bindings[k];this._bindings[k]={type:i?0:4,object:Q,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==Q||Z.type!==this._bindings[k].type)}setStorageTexture(k,Q){const i=this._bindings[k];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==Q),this._bindings[k]={type:1,object:Q,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setExternalTexture(k,Q){const i=this._bindings[k];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==Q),this._bindings[k]={type:6,object:Q,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setVideoTexture(k,Q){return!!Q.externalTexture&&(this.setExternalTexture(k,Q.externalTexture),!0)}setUniformBuffer(k,Q){const i=this._bindings[k];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==Q),this._bindings[k]={type:g._BufferIsDataBuffer(Q)?7:2,object:Q,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setStorageBuffer(k,Q){const i=this._bindings[k];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==Q),this._bindings[k]={type:g._BufferIsDataBuffer(Q)?7:3,object:Q,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setTextureSampler(k,Q){const i=this._bindings[k];this._contextIsDirty||(this._contextIsDirty=!i||!Q.compareSampler(i.object)),this._bindings[k]={type:5,object:Q,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}isReady(){let k=this._effect;for(const U in this._bindings){const k=this._bindings[U],Q=k.type,i=k.object;switch(Q){case 0:case 4:case 1:if(!i.isReady())return!1;break;case 6:if(!i.isReady())return!1;break}}const Q=[],i=this._shaderPath;if(this._options.defines)for(let U=0;U<this._options.defines.length;U++)Q.push(this._options.defines[U]);const Z=Q.join("\n");return this._cachedDefines!==Z&&(this._cachedDefines=Z,k=this._engine.createComputeEffect(i,{defines:Z,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=k),!!k.isReady()}dispatch(k,Q,i){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,k,Q,i,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const i=g._BufferIsDataBuffer(k)?k:k.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,i,Q,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const Q in this._bindings){const i=this._bindings[Q];if(!this._options.bindingsMapping[Q])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+Q+"'");switch(i.type){case 0:{const Z=this._samplers[Q],U=i.object;var k;if(!Z||!U._texture||!Z.compareSampler(U._texture))this._samplers[Q]=(new D.d).setParameters(U.wrapU,U.wrapV,U.wrapR,U.anisotropicFilteringLevel,U._texture.samplingMode,null===(k=U._texture)||void 0===k?void 0:k._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const k=i.object;k.getBuffer()!==i.buffer&&(i.buffer=k.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((U=>{(0,A.f)((()=>this.dispatch(k,Q,i)),U,void 0,Z)}))}serialize(){const k=X.d.Serialize(this);k.options=this._options,k.shaderPath=this._shaderPath,k.xG={},k.textures={};for(const Q in this._bindings){const i=this._bindings[Q],Z=i.object;switch(i.type){case 0:case 4:case 1:{const U=Z.serialize();U&&(k.textures[Q]=U,k.xG[Q]={type:i.type});break}}}return k}static Parse(k,Q,i){const Z=X.d.Parse((()=>new g(k.name,Q.getEngine(),k.shaderPath,k.options)),k,Q,i);for(const U in k.textures){const C=k.xG[U],B=p.c.Parse(k.textures[U],Q,i);0===C.type?Z.setTexture(U,B):4===C.type?Z.setTexture(U,B,!1):Z.setStorageTexture(U,B)}return Z}static _BufferIsDataBuffer(k){return void 0!==k.underlyingResource}}(0,v.c)([(0,N.L)()],g.prototype,"name",void 0),(0,v.c)([(0,N.L)()],g.prototype,"fastMode",void 0),(0,o.e)("BABYLON.ComputeShader",g);var R=i(11555);const w="gpuUpdateParticlesComputeShader",S="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";s.d.ShadersStoreWGSL[w]||(s.d.ShadersStoreWGSL[w]=S);(0,o.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(k,Q){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=k,this._engine=Q}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var k;return(null===(k=this._updateComputeShader)||void 0===k?void 0:k.isReady())??!1}createUpdateBuffer(k){var Q;const i={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(i.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(i.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(i.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(i.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(i.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(i.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(i.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new g("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:i,defines:k.split("\n")}),null===(Q=this._simParamsComputeShader)||void 0===Q||Q.dispose(),this._simParamsComputeShader=new R.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new L(this._simParamsComputeShader)}createVertexBuffers(k,Q){this._renderVertexBuffers.push(Q)}createParticleBuffer(k){const Q=new K(this._engine,4*k.length,11,"ComputeShaderParticleSystemBuffer");return Q.update(k),this._bufferComputeShader.push(Q),Q.getBuffer()}bindDrawBuffers(k,Q,i){this._engine.bindBuffers(this._renderVertexBuffers[k],i,Q)}preUpdateParticleBuffer(){}updateParticleBuffer(k,Q,i){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[k]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^k]),this._updateComputeShader.dispatch(Math.ceil(i/64))}releaseBuffers(){var k;for(let Q=0;Q<this._bufferComputeShader.length;++Q)this._bufferComputeShader[Q].dispose();this._bufferComputeShader.length=0,null===(k=this._simParamsComputeShader)||void 0===k||k.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class q{constructor(k,Q,i){this.gradient=k,this.color1=Q,this.color2=i}getColorToRef(k){this.color2?B.Fo.LerpToRef(this.color1,this.color2,Math.random(),k):k.B(this.color1)}}class P{constructor(k,Q){this.gradient=k,this.color=Q}}class t{constructor(k,Q,i){this.gradient=k,this.factor1=Q,this.factor2=i}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class I{static GetCurrentGradient(k,Q,i){if(Q[0].gradient>k)return void i(Q[0],Q[0],1);for(let U=0;U<Q.length-1;U++){const Z=Q[U],C=Q[U+1];if(k>=Z.gradient&&k<=C.gradient){return void i(Z,C,(k-Z.gradient)/(C.gradient-Z.gradient))}}const Z=Q.length-1;i(Q[Z],Q[Z],1)}}var r=i(11122),n=i(11759),x=i(11157);class V{constructor(k){this.particleSystem=k,this.position=Z.zQ.Zero(),this.direction=Z.zQ.Zero(),this.color=new B.Fo(0,0,0,0),this.colorStep=new B.Fo(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new Z.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new B.Fo(0,0,0,0),this._currentColor2=new B.Fo(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=V._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let k=this.age,Q=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===Q?(Q=1,k=this._randomCellOffset):k+=this._randomCellOffset);const i=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let Z;Z=this._initialSpriteCellLoop?(0,O.Clamp)(k*Q%this.lifeTime/this.lifeTime):(0,O.Clamp)(k*Q/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+Z*i|0}_inheritParticleInfoToSubEmitter(k){if(k.particleSystem.UQ.position){const Q=k.particleSystem.UQ;if(Q.position.B(this.position),k.inheritDirection){const k=Z.TmpVectors.zQ[0];this.direction.normalizeToRef(k),Q.setDirection(k,0,Math.PI/2)}}else{k.particleSystem.UQ.B(this.position)}this.direction.scaleToRef(k.inheritedVelocityAmount/2,Z.TmpVectors.zQ[0]),k.particleSystem._inheritedVelocityOffset.B(Z.TmpVectors.zQ[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const k of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(k)}_reset(){this.age=0,this.id=V._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(k){k.position.B(this.position),this._initialDirection?k._initialDirection?k._initialDirection.B(this._initialDirection):k._initialDirection=this._initialDirection.clone():k._initialDirection=null,k.direction.B(this.direction),this.Do&&(k.Do?k.Do.B(this.Do):k.Do=this.Do.clone()),k.color.B(this.color),k.colorStep.B(this.colorStep),k.lifeTime=this.lifeTime,k.age=this.age,k._randomCellOffset=this._randomCellOffset,k.size=this.size,k.scale.B(this.scale),k.angle=this.angle,k.angularSpeed=this.angularSpeed,k.particleSystem=this.particleSystem,k.cellIndex=this.cellIndex,k.id=this.id,k._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(k._currentColorGradient=this._currentColorGradient,k._currentColor1.B(this._currentColor1),k._currentColor2.B(this._currentColor2)),this._currentSizeGradient&&(k._currentSizeGradient=this._currentSizeGradient,k._currentSize1=this._currentSize1,k._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(k._currentAngularSpeedGradient=this._currentAngularSpeedGradient,k._currentAngularSpeed1=this._currentAngularSpeed1,k._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(k._currentVelocityGradient=this._currentVelocityGradient,k._currentVelocity1=this._currentVelocity1,k._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(k._currentLimitVelocityGradient=this._currentLimitVelocityGradient,k._currentLimitVelocity1=this._currentLimitVelocity1,k._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(k._currentDragGradient=this._currentDragGradient,k._currentDrag1=this._currentDrag1,k._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(k._initialStartSpriteCellId=this._initialStartSpriteCellId,k._initialEndSpriteCellId=this._initialEndSpriteCellId,k._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(k.remapData&&this.remapData?k.remapData.B(this.remapData):k.remapData=new Z.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(k._randomNoiseCoordinates1?(k._randomNoiseCoordinates1.B(this._randomNoiseCoordinates1),k._randomNoiseCoordinates2.B(this._randomNoiseCoordinates2)):(k._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),k._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}V._Count=0;var kk=i(11414),Qk=(i(11460),i(11657)),ik=i(11652),Zk=i(11551);function Uk(k,Q){const i=(0,O.RandomRange)(0,1);B.Fo.LerpToRef(Q.color1,Q.color2,i,k.color),Q.colorDead.subtractToRef(k.color,Q._colorDiff),Q._colorDiff.scaleToRef(1/k.lifeTime,k.colorStep)}function Ck(k,Q){k._currentColorGradient=Q._colorGradients[0],k._currentColorGradient.getColorToRef(k.color),k._currentColor1.B(k.color),Q._colorGradients.length>1?Q._colorGradients[1].getColorToRef(k._currentColor2):k._currentColor2.B(k.color)}function Bk(k,Q){const i=Q._colorGradients;I.GetCurrentGradient(Q._ratio,i,((Q,i,Z)=>{Q!==k._currentColorGradient&&(k._currentColor1.B(k._currentColor2),i.getColorToRef(k._currentColor2),k._currentColorGradient=Q),B.Fo.LerpToRef(k._currentColor1,k._currentColor2,Z,k.color)}))}function ok(k,Q){k.colorStep.scaleToRef(Q._scaledUpdateSpeed,Q._scaledColorStep),k.color.addInPlace(Q._scaledColorStep),k.color.a<0&&(k.color.a=0)}function mk(k,Q){I.GetCurrentGradient(Q._ratio,Q._angularSpeedGradients,((Q,i,Z)=>{Q!==k._currentAngularSpeedGradient&&(k._currentAngularSpeed1=k._currentAngularSpeed2,k._currentAngularSpeed2=i.getFactor(),k._currentAngularSpeedGradient=Q),k.angularSpeed=(0,O.Lerp)(k._currentAngularSpeed1,k._currentAngularSpeed2,Z)}))}function Ok(k,Q){k.angle+=k.angularSpeed*Q._scaledUpdateSpeed}function Jk(k,Q){Q.particleEmitterType.startDirectionFunction(Q._emitterWorldMatrix,k.direction,k,Q.isLocal,Q._emitterInverseWorldMatrix)}function Gk(k,Q){Q.startDirectionFunction(Q._emitterWorldMatrix,k.direction,k,Q.isLocal)}function Hk(k,Q){k._currentVelocityGradient=Q._velocityGradients[0],k._currentVelocity1=k._currentVelocityGradient.getFactor(),Q._velocityGradients.length>1?k._currentVelocity2=Q._velocityGradients[1].getFactor():k._currentVelocity2=k._currentVelocity1}function ek(k,Q){k._currentLimitVelocityGradient=Q._limitVelocityGradients[0],k._currentLimitVelocity1=k._currentLimitVelocityGradient.getFactor(),Q._limitVelocityGradients.length>1?k._currentLimitVelocity2=Q._limitVelocityGradients[1].getFactor():k._currentLimitVelocity2=k._currentLimitVelocity1}function Fk(k,Q){I.GetCurrentGradient(Q._ratio,Q._velocityGradients,((i,Z,U)=>{i!==k._currentVelocityGradient&&(k._currentVelocity1=k._currentVelocity2,k._currentVelocity2=Z.getFactor(),k._currentVelocityGradient=i),Q._directionScale*=(0,O.Lerp)(k._currentVelocity1,k._currentVelocity2,U)}))}function zk(k,Q){I.GetCurrentGradient(Q._ratio,Q._limitVelocityGradients,((i,Z,U)=>{i!==k._currentLimitVelocityGradient&&(k._currentLimitVelocity1=k._currentLimitVelocity2,k._currentLimitVelocity2=Z.getFactor(),k._currentLimitVelocityGradient=i);const C=(0,O.Lerp)(k._currentLimitVelocity1,k._currentLimitVelocity2,U);k.direction.length()>C&&k.direction.scaleInPlace(Q.limitVelocityDamping)}))}function Ek(k,Q){k.direction.scaleToRef(Q._directionScale,Q._scaledDirection)}function lk(k,Q){Q.particleEmitterType.startPositionFunction(Q._emitterWorldMatrix,k.position,k,Q.isLocal)}function hk(k,Q){Q.startPositionFunction(Q._emitterWorldMatrix,k.position,k,Q.isLocal)}function ck(k,Q){k.Do?k.Do.B(k.position):k.Do=k.position.clone(),Z.zQ.TransformCoordinatesToRef(k.Do,Q._emitterWorldMatrix,k.position)}function fk(k,Q){Q.isLocal&&k.Do?(k.Do.addInPlace(Q._scaledDirection),Z.zQ.TransformCoordinatesToRef(k.Do,Q._emitterWorldMatrix,k.position)):k.position.addInPlace(Q._scaledDirection)}function Yk(k,Q){k._currentDragGradient=Q._dragGradients[0],k._currentDrag1=k._currentDragGradient.getFactor(),Q._dragGradients.length>1?k._currentDrag2=Q._dragGradients[1].getFactor():k._currentDrag2=k._currentDrag1}function yk(k,Q){I.GetCurrentGradient(Q._ratio,Q._dragGradients,((i,Z,U)=>{i!==k._currentDragGradient&&(k._currentDrag1=k._currentDrag2,k._currentDrag2=Z.getFactor(),k._currentDragGradient=i);const C=(0,O.Lerp)(k._currentDrag1,k._currentDrag2,U);Q._scaledDirection.scaleInPlace(1-C)}))}function Lk(k,Q){k._randomNoiseCoordinates1?(k._randomNoiseCoordinates1.Go(Math.random(),Math.random(),Math.random()),k._randomNoiseCoordinates2.Go(Math.random(),Math.random(),Math.random())):(k._randomNoiseCoordinates1=new Z.zQ(Math.random(),Math.random(),Math.random()),k._randomNoiseCoordinates2=new Z.zQ(Math.random(),Math.random(),Math.random()))}function sk(k,Q){const i=Q._noiseTextureData,U=Q._noiseTextureSize;if(i&&U&&k._randomNoiseCoordinates1){const C=Q._fetchR(k._randomNoiseCoordinates1.x,k._randomNoiseCoordinates1.y,U.width,U.height,i),B=Q._fetchR(k._randomNoiseCoordinates1.z,k._randomNoiseCoordinates2.x,U.width,U.height,i),o=Q._fetchR(k._randomNoiseCoordinates2.y,k._randomNoiseCoordinates2.z,U.width,U.height,i),m=Z.TmpVectors.zQ[0],O=Z.TmpVectors.zQ[1];m.Go((2*C-1)*Q.noiseStrength.x,(2*B-1)*Q.noiseStrength.y,(2*o-1)*Q.noiseStrength.z),m.scaleToRef(Q._tempScaledUpdateSpeed,O),k.direction.addInPlace(O)}}function uk(k,Q){Q.gravity.scaleToRef(Q._tempScaledUpdateSpeed,Q._scaledGravity),k.direction.addInPlace(Q._scaledGravity)}function ak(k,Q){k.size=(0,O.RandomRange)(Q.minSize,Q.maxSize),k.scale.Go((0,O.RandomRange)(Q.minScaleX,Q.maxScaleX),(0,O.RandomRange)(Q.minScaleY,Q.maxScaleY))}function jk(k,Q){k._currentSizeGradient=Q._sizeGradients[0],k._currentSize1=k._currentSizeGradient.getFactor(),k.size=k._currentSize1,Q._sizeGradients.length>1?k._currentSize2=Q._sizeGradients[1].getFactor():k._currentSize2=k._currentSize1,k.scale.Go((0,O.RandomRange)(Q.minScaleX,Q.maxScaleX),(0,O.RandomRange)(Q.minScaleY,Q.maxScaleY))}function Tk(k,Q){const i=Q._actualFrame/Q.targetStopDuration;I.GetCurrentGradient(i,Q._startSizeGradients,((i,Z,U)=>{i!==Q._currentStartSizeGradient&&(Q._currentStartSize1=Q._currentStartSize2,Q._currentStartSize2=Z.getFactor(),Q._currentStartSizeGradient=i);const C=(0,O.Lerp)(Q._currentStartSize1,Q._currentStartSize2,U);k.scale.scaleInPlace(C)}))}function Kk(k,Q){I.GetCurrentGradient(Q._ratio,Q._sizeGradients,((Q,i,Z)=>{Q!==k._currentSizeGradient&&(k._currentSize1=k._currentSize2,k._currentSize2=i.getFactor(),k._currentSizeGradient=Q),k.size=(0,O.Lerp)(k._currentSize1,k._currentSize2,Z)}))}function vk(k,Q){k.remapData=new Z.Vector4(0,1,0,1)}function Nk(k,Q){Q._colorRemapGradients&&Q._colorRemapGradients.length>0&&I.GetCurrentGradient(Q._ratio,Q._colorRemapGradients,((Q,i,Z)=>{const U=(0,O.Lerp)(Q.factor1,i.factor1,Z),C=(0,O.Lerp)(Q.factor2,i.factor2,Z);k.remapData.x=U,k.remapData.y=C-U})),Q._alphaRemapGradients&&Q._alphaRemapGradients.length>0&&I.GetCurrentGradient(Q._ratio,Q._alphaRemapGradients,((Q,i,Z)=>{const U=(0,O.Lerp)(Q.factor1,i.factor1,Z),C=(0,O.Lerp)(Q.factor2,i.factor2,Z);k.remapData.z=U,k.remapData.w=C-U}))}function Xk(k,Q){const i=(0,O.Clamp)(Q._actualFrame/Q.targetStopDuration);I.GetCurrentGradient(i,Q._lifeTimeGradients,((Q,Z)=>{const U=Q,C=Z,B=U.getFactor(),o=C.getFactor(),m=(i-U.gradient)/(C.gradient-U.gradient);k.lifeTime=(0,O.Lerp)(B,o,m)})),Q._emitPower=(0,O.RandomRange)(Q.minEmitPower,Q.maxEmitPower)}function pk(k,Q){k.lifeTime=(0,O.RandomRange)(Q.minLifeTime,Q.maxLifeTime),Q._emitPower=(0,O.RandomRange)(Q.minEmitPower,Q.maxEmitPower)}function dk(k,Q){0===Q._emitPower?(k._initialDirection?k._initialDirection.B(k.direction):k._initialDirection=k.direction.clone(),k.direction.set(0,0,0)):(k._initialDirection=null,k.direction.scaleInPlace(Q._emitPower)),k.direction.addInPlace(Q._inheritedVelocityOffset)}function bk(k,Q){k.angularSpeed=(0,O.RandomRange)(Q.minAngularSpeed,Q.maxAngularSpeed),k.angle=(0,O.RandomRange)(Q.minInitialRotation,Q.maxInitialRotation)}function Dk(k,Q){k._currentAngularSpeedGradient=Q._angularSpeedGradients[0],k.angularSpeed=k._currentAngularSpeedGradient.getFactor(),k._currentAngularSpeed1=k.angularSpeed,Q._angularSpeedGradients.length>1?k._currentAngularSpeed2=Q._angularSpeedGradients[1].getFactor():k._currentAngularSpeed2=k._currentAngularSpeed1,k.angle=(0,O.RandomRange)(Q.minInitialRotation,Q.maxInitialRotation)}function Mk(k,Q){k._initialStartSpriteCellId=Q.startSpriteCellID,k._initialEndSpriteCellId=Q.endSpriteCellID,k._initialSpriteCellLoop=Q.spriteCellLoop}function Wk(k,Q){k.previousItem=Q.previousItem,k.nextItem=Q,Q.previousItem&&(Q.previousItem.nextItem=k),Q.previousItem=k}function Ak(k,Q){k.previousItem=Q,k.nextItem=Q.nextItem,Q.nextItem&&(Q.nextItem.previousItem=k),Q.nextItem=k}function gk(k,Q){let i=Q;for(;i.nextItem;)i=i.nextItem;k.previousItem=i,k.nextItem=i.nextItem,i.nextItem=k}function Rk(k){k.previousItem&&(k.previousItem.nextItem=k.nextItem),k.nextItem&&(k.nextItem.previousItem=k.previousItem)}class wk extends m{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(k){this._startDirectionFunction!==k&&(this._startDirectionFunction=k,this._directionProcessing.process=k?Gk:Jk)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(k){this._startPositionFunction!==k&&(this._startPositionFunction=k,this._positionCreation.process=k?hk:lk)}set onDispose(k){this._onDisposeObserver&&this.gi.remove(this._onDisposeObserver),this._onDisposeObserver=this.gi.add(k)}get J(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(k){this._useRampGradients!==k&&(this._useRampGradients=k,this._resetEffect(),k?(this._rampCreation={process:vk,previousItem:null,nextItem:null},Ak(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Nk,previousItem:null,nextItem:null},Ak(this._remapGradientProcessing,this._gravityProcessing)):(Rk(this._rampCreation),Rk(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(k){this._isLocal!==k&&(this._isLocal=k,k?(this._isLocalCreation={process:ck,previousItem:null,nextItem:null},Ak(this._isLocalCreation,this._positionCreation)):Rk(this._isLocalCreation))}get particles(){return this.PG}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(k){this._animationSheetEnabled!==k&&(this._animationSheetEnabled=k,k?(this._sheetCreation={process:Mk,previousItem:null,nextItem:null},Ak(this._sheetCreation,this._colorCreation)):Rk(this._sheetCreation),this._reset())}getActiveCount(){return this.PG.length}getClassName(){return"ie"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var k;let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(k=this._customWrappers[Q])||void 0===k?void 0:k.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[k]??this._customWrappers[0]}setCustomEffect(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[Q]=new kk.b(this._engine),this._customWrappers[Q].effect=k,this._customWrappers[Q].drawContext&&(this._customWrappers[Q].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new r.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(k){if(this.noiseTexture!==k){if(this._noiseTexture=k,!k)return Rk(this._noiseCreation),void Rk(this._noiseProcessing);this._noiseCreation={process:Lk,previousItem:null,nextItem:null},Ak(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:sk,previousItem:null,nextItem:null},Ak(this._noiseProcessing,this._positionProcessing)}}constructor(k,Q,i){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,m=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(k),this._emitterInverseWorldMatrix=Z.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new Z.zQ,this.gi=new r.c,this.onStoppedObservable=new r.c,this.onStartedObservable=new r.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.PG=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new B.Fo(0,0,0,0),this._colorDiff=new B.Fo(0,0,0,0),this._scaledDirection=Z.zQ.Zero(),this._scaledGravity=Z.zQ.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=k=>{},this.recycleParticle=k=>{const Q=this.PG.pop();Q!==k&&Q.copyTo(k),this._stockParticles.push(Q)},this._createParticle=()=>{let k;return 0!==this._stockParticles.length?(k=this._stockParticles.pop(),k._reset()):k=new V(this),this._prepareParticle(k),k},this.paused=!1,this._shadersLoaded=!1,this._capacity=Q,this._epsilon=o,i&&"Scene"!==i.getClassName()?(this._engine=i,this.defaultProjectionMatrix=Z.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=i||x.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.SG.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:pk,previousItem:null,nextItem:null},this._positionCreation={process:lk,previousItem:null,nextItem:null},Ak(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Jk,previousItem:null,nextItem:null},Ak(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:dk,previousItem:null,nextItem:null},Ak(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:ak,previousItem:null,nextItem:null},Ak(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:bk,previousItem:null,nextItem:null},Ak(this._angleCreation,this._sizeCreation),this._colorCreation={process:Uk,previousItem:null,nextItem:null},Ak(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,m||(this._colorProcessing={process:ok,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Ok,previousItem:null,nextItem:null},Ak(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Ek,previousItem:null,nextItem:null},Ak(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:fk,previousItem:null,nextItem:null},Ak(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:uk,previousItem:null,nextItem:null},Ak(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=C,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new kk.b(this._engine)},this._customWrappers[0].effect=U,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new G,this.updateFunction=k=>{var Q;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(Q=this.noiseTexture.getContent())||void 0===Q||Q.then((k=>{this._noiseTextureData=k})));const i=k===this.PG;for(let Z=0;Z<k.length;Z++){const Q=k[Z];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const U=Q.age;if(Q.age+=this._tempScaledUpdateSpeed,Q.age>Q.lifeTime){const k=Q.age-U,i=Q.lifeTime-U;this._tempScaledUpdateSpeed=i*this._tempScaledUpdateSpeed/k,Q.age=Q.lifeTime}this._ratio=Q.age/Q.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let C=this._updateQueueStart;for(;C;)C.process(Q,this),C=C.nextItem;if(this._isAnimationSheetEnabled&&!m&&Q.updateCellIndex(),Q._inheritParticleInfoToSubEmitters(),Q.age>=Q.lifeTime){if(this._emitFromParticle(Q),Q._attachedSubEmitters){for(const k of Q._attachedSubEmitters)k.particleSystem.disposeOnStop=!0,k.particleSystem.stop();Q._attachedSubEmitters=null}this.recycleParticle(Q),i&&Z--}else;}}}serialize(k){throw new Error("Method not implemented.")}clone(k,Q){throw new Error("Method not implemented.")}_addFactorGradient(k,Q,i,Z){const U=new t(Q,i,Z);k.push(U),k.sort(((k,Q)=>k.gradient<Q.gradient?-1:k.gradient>Q.gradient?1:0))}_removeFactorGradient(k,Q){if(!k)return;let i=0;for(const Z of k){if(Z.gradient===Q){k.splice(i,1);break}i++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Xk:this._lifeTimeCreation.process=pk}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Tk,previousItem:null,nextItem:null},Ak(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Rk(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(k){this.targetStopDuration!==k&&(this._targetStopDuration=k,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(k,Q,i){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,k,Q,i),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(k){return this._removeFactorGradient(this._lifeTimeGradients,k),this._syncLifeTimeCreation(),this}addSizeGradient(k,Q,i){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=jk,this._sizeGradientProcessing={process:Kk,previousItem:null,nextItem:null},Wk(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,k,Q,i),this}removeSizeGradient(k){var Q;return this._removeFactorGradient(this._sizeGradients,k),0===(null===(Q=this._sizeGradients)||void 0===Q?void 0:Q.length)&&(Rk(this._sizeGradientProcessing),this._sizeCreation.process=ak),this}addColorRemapGradient(k,Q,i){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,k,Q,i),this}removeColorRemapGradient(k){return this._removeFactorGradient(this._colorRemapGradients,k),this}addAlphaRemapGradient(k,Q,i){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,k,Q,i),this}removeAlphaRemapGradient(k){return this._removeFactorGradient(this._alphaRemapGradients,k),this}addAngularSpeedGradient(k,Q,i){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Dk,this._angularSpeedGradientProcessing={process:mk,previousItem:null,nextItem:null},Wk(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,k,Q,i),this}removeAngularSpeedGradient(k){var Q;return this._removeFactorGradient(this._angularSpeedGradients,k),0===(null===(Q=this._angularSpeedGradients)||void 0===Q?void 0:Q.length)&&(this._angleCreation.process=bk,Rk(this._angularSpeedGradientProcessing)),this}addVelocityGradient(k,Q,i){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Hk,previousItem:null,nextItem:null},Ak(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Fk,previousItem:null,nextItem:null},Wk(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,k,Q,i),this}removeVelocityGradient(k){var Q;return this._removeFactorGradient(this._velocityGradients,k),0===(null===(Q=this._velocityGradients)||void 0===Q?void 0:Q.length)&&(Rk(this._velocityCreation),Rk(this._velocityGradientProcessing)),this}addLimitVelocityGradient(k,Q,i){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:ek,previousItem:null,nextItem:null},Ak(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:zk,previousItem:null,nextItem:null},Ak(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,k,Q,i),this}removeLimitVelocityGradient(k){var Q;return this._removeFactorGradient(this._limitVelocityGradients,k),0===(null===(Q=this._limitVelocityGradients)||void 0===Q?void 0:Q.length)&&(Rk(this._limitVelocityCreation),Rk(this._limitVelocityGradientProcessing)),this}addDragGradient(k,Q,i){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Yk,previousItem:null,nextItem:null},Wk(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:yk,previousItem:null,nextItem:null},Wk(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,k,Q,i),this}removeDragGradient(k){var Q;return this._removeFactorGradient(this._dragGradients,k),0===(null===(Q=this._dragGradients)||void 0===Q?void 0:Q.length)&&(Rk(this._dragCreation),Rk(this._dragGradientProcessing)),this}addEmitRateGradient(k,Q,i){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,k,Q,i),this}removeEmitRateGradient(k){return this._removeFactorGradient(this._emitRateGradients,k),this}addStartSizeGradient(k,Q,i){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,k,Q,i),this._syncStartSizeCreation(),this}removeStartSizeGradient(k){return this._removeFactorGradient(this._startSizeGradients,k),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const k=new Uint8Array(4*this._rawTextureWidth),Q=B.TmpColors.cQ[0];for(let i=0;i<this._rawTextureWidth;i++){const Z=i/this._rawTextureWidth;I.GetCurrentGradient(Z,this._rampGradients,((Z,U,C)=>{B.cQ.LerpToRef(Z.color,U.color,C,Q),k[4*i]=255*Q.r,k[4*i+1]=255*Q.g,k[4*i+2]=255*Q.b,k[4*i+3]=255}))}this._rampGradientsTexture=n.c.CreateRGBATexture(k,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((k,Q)=>k.gradient<Q.gradient?-1:k.gradient>Q.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(k,Q){this._rampGradients||(this._rampGradients=[]);const i=new P(k,Q);return this._rampGradients.push(i),this._syncRampGradientTexture(),this}removeRampGradient(k){return this._removeGradientAndTexture(k,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(k,Q,i){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Ck,this._colorProcessing.process=Bk);const Z=new q(k,Q,i);return this._colorGradients.push(Z),this._colorGradients.sort(((k,Q)=>k.gradient<Q.gradient?-1:k.gradient>Q.gradient?1:0)),this}removeColorGradient(k){if(!this._colorGradients)return this;let Q=0;for(const i of this._colorGradients){if(i.gradient===k){this._colorGradients.splice(Q,1);break}Q++}return 0===this._colorGradients.length&&(this._colorCreation.process=Uk,this._colorProcessing.process=ok),this}resetDrawCache(){if(this._drawWrappers){for(const k of this._drawWrappers)if(k)for(const Q of k)null===Q||void 0===Q||Q.dispose();this._drawWrappers=[]}}_fetchR(k,Q,i,Z,U){return U[4*(((k=.5*Math.abs(k)+.5)*i%i|0)+((Q=.5*Math.abs(Q)+.5)*Z%Z|0)*i)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const k=this._engine,Q=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*Q),this._vertexBuffer=new Y.d(k,this._vertexData,!0,Q);let i=0;const Z=this._vertexBuffer.createVertexBuffer(Y.h.PositionKind,i,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Y.h.PositionKind]=Z,i+=3;const U=this._vertexBuffer.createVertexBuffer(Y.h.ColorKind,i,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Y.h.ColorKind]=U,i+=4;const C=this._vertexBuffer.createVertexBuffer("angle",i,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=C,i+=1;const B=this._vertexBuffer.createVertexBuffer("size",i,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=B,i+=2,this._isAnimationSheetEnabled){const k=this._vertexBuffer.createVertexBuffer("cellIndex",i,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=k,i+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const k=this._vertexBuffer.createVertexBuffer("direction",i,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=k,i+=3}if(this._useRampGradients){const k=this._vertexBuffer.createVertexBuffer("remapData",i,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=k,i+=4}let o;if(this._useInstancing){const Q=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new Y.d(k,Q,!1,2),o=this._spriteBuffer.createVertexBuffer("offset",0,2)}else o=this._vertexBuffer.createVertexBuffer("offset",i,2,this._vertexBufferSize,this._useInstancing),i+=2;this._vertexBuffers.offset=o,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const k=[],Q=[];let i=0;for(let Z=0;Z<this._capacity;Z++)k.push(i),k.push(i+1),k.push(i+2),k.push(i),k.push(i+2),k.push(i+3),Q.push(i,i+1,i+1,i+2,i+2,i+3,i+3,i,i,i+3),i+=4;this._indexBuffer=this._engine.createIndexBuffer(k),this._linesIndexBuffer=this._engine.createIndexBuffer(Q)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(k)setTimeout((()=>{this.start(0)}),k);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var Q;-1!==(null===(Q=this.UQ)||void 0===Q?void 0:Q.getClassName().indexOf("Mesh"))&&this.UQ.oo(!0);const k=this.noiseTexture;if(k&&k.onGeneratedObservable)k.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let Q=0;Q<this.preWarmCycles;Q++)this.animate(!0),k.render()}))}));else for(let Q=0;Q<this.preWarmCycles;Q++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(k))}_postStop(k){}reset(){this._stockParticles.length=0,this.PG.length=0}_appendParticleVertex(k,Q,i,U){let C=k*this._vertexBufferSize;if(this._vertexData[C++]=Q.position.x+this.OO.x,this._vertexData[C++]=Q.position.y+this.OO.y,this._vertexData[C++]=Q.position.z+this.OO.z,this._vertexData[C++]=Q.color.r,this._vertexData[C++]=Q.color.g,this._vertexData[C++]=Q.color.b,this._vertexData[C++]=Q.color.a,this._vertexData[C++]=Q.angle,this._vertexData[C++]=Q.scale.x*Q.size,this._vertexData[C++]=Q.scale.y*Q.size,this._isAnimationSheetEnabled&&(this._vertexData[C++]=Q.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[C++]=Q.direction.x,this._vertexData[C++]=Q.direction.y,this._vertexData[C++]=Q.direction.z);else if(Q._initialDirection){let k=Q._initialDirection;this.isLocal&&(Z.zQ.TransformNormalToRef(k,this._emitterWorldMatrix,Z.TmpVectors.zQ[0]),k=Z.TmpVectors.zQ[0]),0===k.x&&0===k.z&&(k.x=.001),this._vertexData[C++]=k.x,this._vertexData[C++]=k.y,this._vertexData[C++]=k.z}else{let k=Q.direction;this.isLocal&&(Z.zQ.TransformNormalToRef(k,this._emitterWorldMatrix,Z.TmpVectors.zQ[0]),k=Z.TmpVectors.zQ[0]),0===k.x&&0===k.z&&(k.x=.001),this._vertexData[C++]=k.x,this._vertexData[C++]=k.y,this._vertexData[C++]=k.z}this._useRampGradients&&Q.remapData&&(this._vertexData[C++]=Q.remapData.x,this._vertexData[C++]=Q.remapData.y,this._vertexData[C++]=Q.remapData.z,this._vertexData[C++]=Q.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),0===U?U=this._epsilon:1===U&&(U=1-this._epsilon)),this._vertexData[C++]=i,this._vertexData[C++]=U)}_prepareParticle(k){}_createNewOnes(k){let Q;for(let i=0;i<k&&this.PG.length!==this._capacity;i++){Q=this._createParticle(),this.PG.push(Q);let k=this._createQueueStart;for(;k;)k.process(Q,this),k=k.nextItem;Q._inheritParticleInfoToSubEmitters()}}_update(k){if(this._alive=this.PG.length>0,this.UQ.position){const k=this.UQ;this._emitterWorldMatrix=k.getWorldMatrix()}else{const k=this.UQ;this._emitterWorldMatrix=Z.Matrix.Translation(k.x,k.y,k.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.PG),this._createNewOnes(k)}static _GetAttributeNamesOrOptions(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=[Y.h.PositionKind,Y.h.ColorKind,"angle","offset","size"];return k&&Z.push("cellIndex"),Q||Z.push("direction"),i&&Z.push("remapData"),Z}static _GetEffectCreationOptions(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Qk.c)(Z),k&&Z.push("particlesInfos"),Q&&Z.push("logarithmicDepthConstant"),i&&(Z.push("vFogInfos"),Z.push("vFogColor")),Z}fillDefines(k,Q){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Qk.i)(this,this._scene,k),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&k.push("#define FOG")),this._isAnimationSheetEnabled&&k.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&k.push("#define LOGARITHMICDEPTH"),Q===m.BLENDMODE_MULTIPLY&&k.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&k.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(k.push("#define BILLBOARD"),this.billboardMode){case 2:k.push("#define BILLBOARDY");break;case 8:case 9:k.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&k.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:k.push("#define BILLBOARDMODE_ALL")}i&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),k.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(k,Q,i){Q.push(...wk._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),k.push(...wk._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),i.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Zk.e)(k,this._imageProcessingConfigurationDefines),(0,Zk.d)(i,this._imageProcessingConfigurationDefines))}_getWrapper(k){const Q=this._getCustomDrawWrapper(k);if(null!==Q&&void 0!==Q&&Q.effect)return Q;const i=[];this.fillDefines(i,k);const Z=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let U=this._drawWrappers[Z];U||(U=this._drawWrappers[Z]=[]);let C=U[k];C||(C=new kk.b(this._engine),C.drawContext&&(C.drawContext.useInstancing=this._useInstancing),U[k]=C);const B=i.join("\n");if(C.defines!==B){const k=[],Q=[],i=[];this.fillUniformsAttributesAndSamplerNames(Q,k,i),C.setEffect(this._engine.createEffect("particles",k,Q,i,B,void 0,void 0,void 0,void 0,this._shaderLanguage),B)}return C}animate(){var k;let Q,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!i&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(i?this.preWarmStepOffset:(null===(k=this._scene)||void 0===k?void 0:k.getAnimationRatio())||1),this.manualEmitCount>-1)Q=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let k=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const Q=this._actualFrame/this.targetStopDuration;I.GetCurrentGradient(Q,this._emitRateGradients,((Q,i,Z)=>{Q!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=i.getFactor(),this._currentEmitRateGradient=Q),k=(0,O.Lerp)(this._currentEmitRate1,this._currentEmitRate2,Z)}))}Q=k*this._scaledUpdateSpeed|0,this._newPartsExcess+=k*this._scaledUpdateSpeed-Q}if(this._newPartsExcess>1&&(Q+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?Q=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(Q),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!i){let k=0;for(let Q=0;Q<this.PG.length;Q++){const i=this.PG[Q];this._appendParticleVertices(k,i),k+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.PG.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(k,Q){this._appendParticleVertex(k++,Q,0,0),this._useInstancing||(this._appendParticleVertex(k++,Q,1,0),this._appendParticleVertex(k++,Q,1,1),this._appendParticleVertex(k++,Q,0,1))}rebuild(){var k;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(k=this._spriteBuffer)||void 0===k||k._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!wk.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(i.bind(i,12828)),Promise.resolve().then(i.bind(i,12771))])):await Promise.all([Promise.resolve().then(i.bind(i,12754)),Promise.resolve().then(i.bind(i,12744))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.UQ||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==m.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(m.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(m.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(k){const Q=this._getWrapper(k),i=Q.effect,U=this._engine;U.enableEffect(Q);const C=this.defaultViewMatrix??this._scene.getViewMatrix();if(i.setTexture("diffuseSampler",this.particleTexture),i.setMatrix("view",C),i.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const k=this.particleTexture.getBaseSize();i.setFloat3("particlesInfos",this.spriteCellWidth/k.width,this.spriteCellHeight/k.height,this.spriteCellWidth/k.width)}if(i.setVector2("translationPivot",this.translationPivot),i.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const k=this._scene.activeCamera;i.setVector3("eyePosition",k.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),i.setTexture("rampSampler",this._rampGradientsTexture));const B=i.defines;var o,m,O,J,G,H;(this._scene&&((0,Qk.g)(i,this,this._scene),this.applyFog&&(0,ik.e)(this._scene,void 0,i)),B.indexOf("#define BILLBOARDMODE_ALL")>=0&&(C.invertToRef(Z.TmpVectors.Matrix[0]),i.setMatrix("invView",Z.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?U.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,i):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,i)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(m=this._scene)&&void 0!==m&&m.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?U.bindBuffers(this._vertexBuffers,null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._linesIndexBuffer:this._indexBuffer,i):U.bindBuffers(this._vertexBuffers,null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._linesIndexBufferUseInstancing:null,i);(this.useLogarithmicDepth&&this._scene&&(0,ik.j)(B,i,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(i),this._setEngineBasedOnBlendMode(k),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(i),this._useInstancing)?null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?U.drawElementsType(6,0,10,this.PG.length):U.drawArraysType(7,0,4,this.PG.length):null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?U.drawElementsType(1,0,10*this.PG.length):U.drawElementsType(0,0,6*this.PG.length);return this.PG.length}render(){if(!this.isReady()||!this.PG.length)return 0;const k=this._engine;k.setState&&(k.setState(!1),this.forceDepthWrite&&k.setDepthWrite(!0));let Q=0;return Q=this.blendMode===m.BLENDMODE_MULTIPLYADD?this._render(m.BLENDMODE_MULTIPLY)+this._render(m.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),Q}_onDispose(){}dispose(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),k&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),k&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(Q,i),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const k=this._scene.SG.indexOf(this);k>-1&&this._scene.SG.splice(k,1),this._scene._activeParticleSystems.dispose()}this.gi.notifyObservers(this),this.gi.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}wk.ForceGLSL=!1;var Sk,qk=i(11146);!function(k){k[k.ATTACHED=0]="ATTACHED",k[k.END=1]="END"}(Sk||(Sk={}));class Pk{constructor(k){if(this.particleSystem=k,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!k.UQ||!k.UQ.dispose){const Q=(0,o.b)("BABYLON.AbstractMesh");k.UQ=new Q("SubemitterSystemEmitter",k.sk()),k._disposeEmitterOnDispose=!0}}clone(){let k=this.particleSystem.UQ;if(k){if(k instanceof Z.zQ)k=k.clone();else if(-1!==k.getClassName().indexOf("Mesh")){k=new((0,o.b)("BABYLON.Mesh"))("",k.sk()),k.isVisible=!1}}else k=new Z.zQ;const Q=new Pk(this.particleSystem.clone(this.particleSystem.name,k));return Q.particleSystem.name+="Clone",Q.type=this.type,Q.inheritDirection=this.inheritDirection,Q.inheritedVelocityAmount=this.inheritedVelocityAmount,Q.particleSystem._disposeEmitterOnDispose=!0,Q.particleSystem.disposeOnStop=!0,Q}serialize(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Q={};return Q.type=this.type,Q.inheritDirection=this.inheritDirection,Q.inheritedVelocityAmount=this.inheritedVelocityAmount,Q.particleSystem=this.particleSystem.serialize(k),Q}static _ParseParticleSystem(k,Q,i){throw(0,qk.d)("ParseParticle")}static Parse(k,Q,i){const Z=k.particleSystem,U=new Pk(Pk._ParseParticleSystem(Z,Q,i,!0));return U.type=k.type,U.inheritDirection=k.inheritDirection,U.inheritedVelocityAmount=k.inheritedVelocityAmount,U.particleSystem._isSubEmitter=!0,U}dispose(){this.particleSystem.dispose()}}var tk=i(11195);function Ik(k,Q){const i=new l;return i.direction1=k,i.direction2=Q,i}function rk(){return new E(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function nk(){return new h(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function xk(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Z.zQ(0,1,0),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.zQ(0,1,0);return new c(k,Q,i)}function Vk(){return new F(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function kQ(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.zQ(0,1,0),C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Z.zQ(0,1,0);return new z(k,Q,i,U,C)}function QQ(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new H(k,Q)}function iQ(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.zQ(0,1,0),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.zQ(0,1,0);return new e(k,Q,i,U)}const ZQ=Z.zQ.Zero(),UQ=Z.zQ.Zero(),CQ=Z.zQ.Zero();class BQ{constructor(){this.strength=0,this.position=Z.zQ.Zero()}_processParticle(k,Q){this.position.subtractToRef(k.position,ZQ);const i=ZQ.lengthSquared()+1;ZQ.normalize().scaleToRef(this.strength/i,UQ),UQ.scaleToRef(Q._tempScaledUpdateSpeed,CQ),k.direction.addInPlace(CQ)}serialize(){return{position:this.position.Zo(),strength:this.strength}}}class oQ extends wk{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=k=>{if(!this._subEmitters||0===this._subEmitters.length)return;const Q=Math.floor(Math.random()*this._subEmitters.length);for(const i of this._subEmitters[Q])if(1===i.type){const Q=i.clone();k._inheritParticleInfoToSubEmitter(Q),Q.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(Q.particleSystem),Q.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(k,Q){const i=Ik(k,Q);return this.particleEmitterType=i,i}get flowMap(){return this._flowMap}set flowMap(k){this._flowMap!==k&&(this._flowMap=k,this._flowMapUpdate&&(Rk(this._flowMapUpdate),this._flowMapUpdate=null),k&&(this._flowMapUpdate={process:k=>{var Q;const i=null===(Q=this.sk())||void 0===Q?void 0:Q.getTransformMatrix();this._flowMap._processParticle(k,this.flowMapStrength*this._tempScaledUpdateSpeed,i)},previousItem:null,nextItem:null},Ak(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(k){this._attractors.push(k),1===this._attractors.length&&(this._attractorUpdate={process:k=>{for(const Q of this._attractors)Q._processParticle(k,this)},previousItem:null,nextItem:null},Ak(this._attractorUpdate,this._directionProcessing))}removeAttractor(k){const Q=this._attractors.indexOf(k);-1!==Q&&this._attractors.splice(Q,1),0===this._attractors.length&&Rk(this._attractorUpdate)}start(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(k)}createHemisphericEmitter(){const k=rk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=k,k}createSphereEmitter(){const k=nk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=k,k}createDirectedSphereEmitter(){const k=xk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Z.zQ(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.zQ(0,1,0));return this.particleEmitterType=k,k}createCylinderEmitter(){const k=Vk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=k,k}createDirectedCylinderEmitter(){const k=kQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.zQ(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Z.zQ(0,1,0));return this.particleEmitterType=k,k}createConeEmitter(){const k=QQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=k,k}createDirectedConeEmitter(){const k=iQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.zQ(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.zQ(0,1,0));return this.particleEmitterType=k,k}createBoxEmitter(k,Q,i,Z){const U=new G;return this.particleEmitterType=U,this.direction1=k,this.direction2=Q,this.minEmitBox=i,this.maxEmitBox=Z,U}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const k of this.subEmitters)k instanceof oQ?this._subEmitters.push([new Pk(k)]):k instanceof Pk?this._subEmitters.push([k]):k instanceof Array&&this._subEmitters.push(k)}_stopSubEmitters(){if(this.activeSubSystems){for(const k of this.activeSubSystems)k.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const k=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==k&&this._rootParticleSystem.activeSubSystems.splice(k,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(k){k&&this._stopSubEmitters()}_prepareParticle(k){if(this._subEmitters&&this._subEmitters.length>0){const Q=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];k._attachedSubEmitters=[];for(const i of Q)if(0===i.type){const Q=i.clone();k._attachedSubEmitters.push(Q),Q.particleSystem.start()}}}_onDispose(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),k&&this.particles)for(const i of this.particles)if(i._attachedSubEmitters)for(let k=i._attachedSubEmitters.length-1;k>=0;k-=1)i._attachedSubEmitters[k].dispose();if(Q&&this.activeSubSystems)for(let i=this.activeSubSystems.length-1;i>=0;i-=1)this.activeSubSystems[i].dispose();if(this._subEmitters&&this._subEmitters.length){for(let k=0;k<this._subEmitters.length;k++)for(const Q of this._subEmitters[k])Q.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.UQ&&this.UQ.dispose&&this.UQ.dispose(!0)}static _Parse(k,Q,i,U){let C;C=i instanceof tk.b?null:i;const m=(0,o.b)("BABYLON.Texture");if(m&&C&&(k.texture?Q.particleTexture=m.Parse(k.texture,C,U):k.textureName&&(Q.particleTexture=new m(U+k.textureName,C,!1,void 0===k.invertY||k.invertY),Q.particleTexture.name=k.textureName)),k.emitterId||0===k.emitterId||void 0!==k.UQ?k.emitterId&&C?Q.UQ=C.getLastMeshById(k.emitterId):Q.UQ=Z.zQ.fQ(k.UQ):Q.UQ=Z.zQ.Zero(),Q.isLocal=!!k.isLocal,void 0!==k.renderingGroupId&&(Q.renderingGroupId=k.renderingGroupId),void 0!==k.isBillboardBased&&(Q.isBillboardBased=k.isBillboardBased),void 0!==k.billboardMode&&(Q.billboardMode=k.billboardMode),void 0!==k.useLogarithmicDepth&&(Q.useLogarithmicDepth=k.useLogarithmicDepth),k.animations){for(let i=0;i<k.animations.length;i++){const Z=k.animations[i],U=(0,o.b)("BABYLON.Animation");U&&Q.animations.push(U.Parse(Z))}Q.beginAnimationOnStart=k.beginAnimationOnStart,Q.beginAnimationFrom=k.beginAnimationFrom,Q.beginAnimationTo=k.beginAnimationTo,Q.beginAnimationLoop=k.beginAnimationLoop}if(k.autoAnimate&&C&&C.beginAnimation(Q,k.autoAnimateFrom,k.autoAnimateTo,k.autoAnimateLoop,k.autoAnimateSpeed||1),Q.startDelay=0|k.startDelay,Q.minAngularSpeed=k.minAngularSpeed,Q.maxAngularSpeed=k.maxAngularSpeed,Q.minSize=k.minSize,Q.maxSize=k.maxSize,k.minScaleX&&(Q.minScaleX=k.minScaleX,Q.maxScaleX=k.maxScaleX,Q.minScaleY=k.minScaleY,Q.maxScaleY=k.maxScaleY),void 0!==k.preWarmCycles&&(Q.preWarmCycles=k.preWarmCycles,Q.preWarmStepOffset=k.preWarmStepOffset),void 0!==k.minInitialRotation&&(Q.minInitialRotation=k.minInitialRotation,Q.maxInitialRotation=k.maxInitialRotation),Q.minLifeTime=k.minLifeTime,Q.maxLifeTime=k.maxLifeTime,Q.minEmitPower=k.minEmitPower,Q.maxEmitPower=k.maxEmitPower,Q.emitRate=k.emitRate,Q.gravity=Z.zQ.fQ(k.gravity),k.noiseStrength&&(Q.noiseStrength=Z.zQ.fQ(k.noiseStrength)),Q.color1=B.Fo.fQ(k.color1),Q.color2=B.Fo.fQ(k.color2),Q.colorDead=B.Fo.fQ(k.colorDead),Q.updateSpeed=k.updateSpeed,Q.targetStopDuration=k.targetStopDuration,Q.blendMode=k.blendMode,k.colorGradients)for(const Z of k.colorGradients)Q.addColorGradient(Z.gradient,B.Fo.fQ(Z.color1),Z.color2?B.Fo.fQ(Z.color2):void 0);if(k.rampGradients){for(const i of k.rampGradients)Q.addRampGradient(i.gradient,B.cQ.fQ(i.color));Q.useRampGradients=k.useRampGradients}if(k.colorRemapGradients)for(const Z of k.colorRemapGradients)Q.addColorRemapGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(k.alphaRemapGradients)for(const Z of k.alphaRemapGradients)Q.addAlphaRemapGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(k.sizeGradients)for(const Z of k.sizeGradients)Q.addSizeGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(k.angularSpeedGradients)for(const Z of k.angularSpeedGradients)Q.addAngularSpeedGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(k.velocityGradients)for(const Z of k.velocityGradients)Q.addVelocityGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(k.dragGradients)for(const Z of k.dragGradients)Q.addDragGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(k.emitRateGradients)for(const Z of k.emitRateGradients)Q.addEmitRateGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(k.startSizeGradients)for(const Z of k.startSizeGradients)Q.addStartSizeGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(k.lifeTimeGradients)for(const Z of k.lifeTimeGradients)Q.addLifeTimeGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(k.limitVelocityGradients){for(const i of k.limitVelocityGradients)Q.addLimitVelocityGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);Q.limitVelocityDamping=k.limitVelocityDamping}if(k.noiseTexture&&C){const i=(0,o.b)("BABYLON.ProceduralTexture");Q.noiseTexture=i.Parse(k.noiseTexture,C,U)}let O;if(k.particleEmitterType){switch(k.particleEmitterType.type){case"SphereParticleEmitter":O=new h;break;case"SphereDirectedParticleEmitter":O=new c;break;case"ConeEmitter":case"ConeParticleEmitter":O=new H;break;case"ConeDirectedParticleEmitter":O=new e;break;case"CylinderParticleEmitter":O=new F;break;case"CylinderDirectedParticleEmitter":O=new z;break;case"HemisphericParticleEmitter":O=new E;break;case"PointParticleEmitter":O=new l;break;case"MeshParticleEmitter":O=new y;break;case"CustomParticleEmitter":O=new f;break;default:O=new G}O.parse(k.particleEmitterType,C)}else O=new G,O.parse(k,C);Q.particleEmitterType=O,Q.startSpriteCellID=k.startSpriteCellID,Q.endSpriteCellID=k.endSpriteCellID,Q.spriteCellLoop=k.spriteCellLoop??!0,Q.spriteCellWidth=k.spriteCellWidth,Q.spriteCellHeight=k.spriteCellHeight,Q.spriteCellChangeSpeed=k.spriteCellChangeSpeed,Q.spriteRandomStartCell=k.spriteRandomStartCell,Q.disposeOnStop=k.disposeOnStop??!1,Q.manualEmitCount=k.manualEmitCount??-1}static Parse(k,Q,i){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0;const o=k.name;let m,O,J=null,G=null;if(Q instanceof tk.b?m=Q:(O=Q,m=O.getEngine()),k.customShader&&m.createEffectForParticles){G=k.customShader;const Q=G.shaderOptions.defines.length>0?G.shaderOptions.defines.join("\n"):"";J=m.createEffectForParticles(G.shaderPath.fragmentElement,G.shaderOptions.uniforms,G.shaderOptions.samplers,Q)}const H=new oQ(o,C||k.yQ,Q,J,k.isAnimationSheetEnabled);if(H.customShader=G,H._rootUrl=i,k.id&&(H.id=k.id),k.subEmitters){H.subEmitters=[];for(const Z of k.subEmitters){const k=[];for(const U of Z)k.push(Pk.Parse(U,Q,i));H.subEmitters.push(k)}}if(k.attractors)for(const B of k.attractors){const k=new BQ;k.position=Z.zQ.fQ(B.position),k.strength=B.strength,H.addAttractor(k)}return oQ._Parse(k,H,Q,i),k.textureMask&&(H.textureMask=B.Fo.fQ(k.textureMask)),k.OO&&(H.OO=Z.zQ.fQ(k.OO)),k.preventAutoStart&&(H.preventAutoStart=k.preventAutoStart),U||H.preventAutoStart||H.start(),H}serialize(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Q={};if(oQ._Serialize(Q,this,k),Q.textureMask=this.textureMask.Zo(),Q.customShader=this.customShader,Q.preventAutoStart=this.preventAutoStart,Q.OO=this.OO.Zo(),this.subEmitters){Q.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const i of this._subEmitters){const Z=[];for(const Q of i)Z.push(Q.serialize(k));Q.subEmitters.push(Z)}}if(this._attractors&&this._attractors.length){Q.attractors=[];for(const k of this._attractors)Q.attractors.push(k.serialize())}return Q}static _Serialize(k,Q,i){if(k.name=Q.name,k.id=Q.id,k.yQ=Q.getCapacity(),k.disposeOnStop=Q.disposeOnStop,k.manualEmitCount=Q.manualEmitCount,Q.UQ.position){const i=Q.UQ;k.emitterId=i.id}else{const i=Q.UQ;k.UQ=i.Zo()}Q.particleEmitterType&&(k.particleEmitterType=Q.particleEmitterType.serialize()),Q.particleTexture&&(i?k.texture=Q.particleTexture.serialize():(k.textureName=Q.particleTexture.name,k.invertY=!!Q.particleTexture._invertY)),k.isLocal=Q.isLocal,X.d.AppendSerializedAnimations(Q,k),k.beginAnimationOnStart=Q.beginAnimationOnStart,k.beginAnimationFrom=Q.beginAnimationFrom,k.beginAnimationTo=Q.beginAnimationTo,k.beginAnimationLoop=Q.beginAnimationLoop,k.startDelay=Q.startDelay,k.renderingGroupId=Q.renderingGroupId,k.isBillboardBased=Q.isBillboardBased,k.billboardMode=Q.billboardMode,k.minAngularSpeed=Q.minAngularSpeed,k.maxAngularSpeed=Q.maxAngularSpeed,k.minSize=Q.minSize,k.maxSize=Q.maxSize,k.minScaleX=Q.minScaleX,k.maxScaleX=Q.maxScaleX,k.minScaleY=Q.minScaleY,k.maxScaleY=Q.maxScaleY,k.minEmitPower=Q.minEmitPower,k.maxEmitPower=Q.maxEmitPower,k.minLifeTime=Q.minLifeTime,k.maxLifeTime=Q.maxLifeTime,k.emitRate=Q.emitRate,k.gravity=Q.gravity.Zo(),k.noiseStrength=Q.noiseStrength.Zo(),k.color1=Q.color1.Zo(),k.color2=Q.color2.Zo(),k.colorDead=Q.colorDead.Zo(),k.updateSpeed=Q.updateSpeed,k.targetStopDuration=Q.targetStopDuration,k.blendMode=Q.blendMode,k.preWarmCycles=Q.preWarmCycles,k.preWarmStepOffset=Q.preWarmStepOffset,k.minInitialRotation=Q.minInitialRotation,k.maxInitialRotation=Q.maxInitialRotation,k.startSpriteCellID=Q.startSpriteCellID,k.spriteCellLoop=Q.spriteCellLoop,k.endSpriteCellID=Q.endSpriteCellID,k.spriteCellChangeSpeed=Q.spriteCellChangeSpeed,k.spriteCellWidth=Q.spriteCellWidth,k.spriteCellHeight=Q.spriteCellHeight,k.spriteRandomStartCell=Q.spriteRandomStartCell,k.isAnimationSheetEnabled=Q.isAnimationSheetEnabled,k.useLogarithmicDepth=Q.useLogarithmicDepth;const Z=Q.getColorGradients();if(Z){k.colorGradients=[];for(const Q of Z){const i={gradient:Q.gradient,color1:Q.color1.Zo()};Q.color2?i.color2=Q.color2.Zo():i.color2=Q.color1.Zo(),k.colorGradients.push(i)}}const U=Q.getRampGradients();if(U){k.rampGradients=[];for(const Q of U){const i={gradient:Q.gradient,color:Q.color.Zo()};k.rampGradients.push(i)}k.useRampGradients=Q.useRampGradients}const C=Q.getColorRemapGradients();if(C){k.colorRemapGradients=[];for(const Q of C){const i={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?i.factor2=Q.factor2:i.factor2=Q.factor1,k.colorRemapGradients.push(i)}}const B=Q.getAlphaRemapGradients();if(B){k.alphaRemapGradients=[];for(const Q of B){const i={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?i.factor2=Q.factor2:i.factor2=Q.factor1,k.alphaRemapGradients.push(i)}}const o=Q.getSizeGradients();if(o){k.sizeGradients=[];for(const Q of o){const i={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?i.factor2=Q.factor2:i.factor2=Q.factor1,k.sizeGradients.push(i)}}const m=Q.getAngularSpeedGradients();if(m){k.angularSpeedGradients=[];for(const Q of m){const i={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?i.factor2=Q.factor2:i.factor2=Q.factor1,k.angularSpeedGradients.push(i)}}const O=Q.getVelocityGradients();if(O){k.velocityGradients=[];for(const Q of O){const i={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?i.factor2=Q.factor2:i.factor2=Q.factor1,k.velocityGradients.push(i)}}const J=Q.getDragGradients();if(J){k.dragGradients=[];for(const Q of J){const i={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?i.factor2=Q.factor2:i.factor2=Q.factor1,k.dragGradients.push(i)}}const G=Q.getEmitRateGradients();if(G){k.emitRateGradients=[];for(const Q of G){const i={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?i.factor2=Q.factor2:i.factor2=Q.factor1,k.emitRateGradients.push(i)}}const H=Q.getStartSizeGradients();if(H){k.startSizeGradients=[];for(const Q of H){const i={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?i.factor2=Q.factor2:i.factor2=Q.factor1,k.startSizeGradients.push(i)}}const e=Q.getLifeTimeGradients();if(e){k.lifeTimeGradients=[];for(const Q of e){const i={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?i.factor2=Q.factor2:i.factor2=Q.factor1,k.lifeTimeGradients.push(i)}}const F=Q.getLimitVelocityGradients();if(F){k.limitVelocityGradients=[];for(const Q of F){const i={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?i.factor2=Q.factor2:i.factor2=Q.factor1,k.limitVelocityGradients.push(i)}k.limitVelocityDamping=Q.limitVelocityDamping}Q.noiseTexture&&(k.noiseTexture=Q.noiseTexture.serialize())}clone(k,Q){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z={...this._customWrappers};let U=null;const C=this._engine;if(C.createEffectForParticles&&null!=this.customShader){U=this.customShader;const k=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"",Q=C.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,k);Z[0]?Z[0].effect=Q:this.setCustomEffect(Q,0)}const B=this.serialize(i),o=oQ.Parse(B,this._scene||this._engine,this._rootUrl);return o.name=k,o.customShader=U,o._customWrappers=Z,void 0===Q&&(Q=this.UQ),this.noiseTexture&&(o.noiseTexture=this.noiseTexture.clone()),o.UQ=Q,this.preventAutoStart||o.start(),o}}oQ.BILLBOARDMODE_Y=2,oQ.BILLBOARDMODE_ALL=7,oQ.BILLBOARDMODE_STRETCHED=8,oQ.BILLBOARDMODE_STRETCHED_LOCAL=9,Pk._ParseParticleSystem=oQ.Parse;var mQ=i(11541),OQ=i(11538),JQ=i(11428);JQ.b.prototype.createTransformFeedback=function(){const k=this._gl.createTransformFeedback();if(!k)throw new Error("Unable to create Transform Feedback");return k},JQ.b.prototype.deleteTransformFeedback=function(k){this._gl.deleteTransformFeedback(k)},JQ.b.prototype.bindTransformFeedback=function(k){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,k)},JQ.b.prototype.beginTransformFeedback=function(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(k?this._gl.POINTS:this._gl.TRIANGLES)},JQ.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},JQ.b.prototype.setTranformFeedbackVaryings=function(k,Q){this._gl.transformFeedbackVaryings(k,Q,this._gl.INTERLEAVED_ATTRIBS)},JQ.b.prototype.bindTransformFeedbackBuffer=function(k){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,k?k.underlyingResource:null)},JQ.b.prototype.readTransformFeedbackBuffer=function(k){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,k)};const GQ="clipPlaneFragmentDeclaration2",HQ="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";s.d.IncludesShadersStore[GQ]||(s.d.IncludesShadersStore[GQ]=HQ);i(12633),i(12642),i(12651),i(12656),i(12664),i(12673),i(12682),i(12688);const eQ="gpuRenderParticlesPixelShader",FQ="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";s.d.ShadersStore[eQ]||(s.d.ShadersStore[eQ]=FQ);const zQ="clipPlaneVertexDeclaration2",EQ="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";s.d.IncludesShadersStore[zQ]||(s.d.IncludesShadersStore[zQ]=EQ);i(12690),i(12699),i(12702),i(12709);const lQ="gpuRenderParticlesVertexShader",hQ="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";s.d.ShadersStore[lQ]||(s.d.ShadersStore[lQ]=hQ);class cQ extends m{static get IsSupported(){if(!x.b.LastCreatedEngine)return!1;const k=x.b.LastCreatedEngine.getCaps();return k.supportTransformFeedbacks||k.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(k){this._maxActiveParticleCount=Math.min(k,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(k){this.maxActiveParticleCount=k}createPointEmitter(k,Q){const i=Ik(k,Q);return this.particleEmitterType=i,i}createHemisphericEmitter(){const k=rk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=k,k}createSphereEmitter(){const k=nk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=k,k}createDirectedSphereEmitter(){const k=xk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Z.zQ(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.zQ(0,1,0));return this.particleEmitterType=k,k}createCylinderEmitter(){const k=Vk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=k,k}createDirectedCylinderEmitter(){const k=kQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.zQ(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Z.zQ(0,1,0));return this.particleEmitterType=k,k}createConeEmitter(){const k=QQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=k,k}createDirectedConeEmitter(){const k=iQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.zQ(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.zQ(0,1,0));return this.particleEmitterType=k,k}createBoxEmitter(k,Q,i,Z){const U=new G;return this.particleEmitterType=U,this.direction1=k,this.direction2=Q,this.minEmitBox=i,this.maxEmitBox=Z,U}get flowMap(){return this._flowMap}set flowMap(k){this._flowMap!==k&&(this._flowMap=k)}isReady(){if(!this.UQ||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==oQ.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(oQ.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(oQ.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";k?setTimeout((()=>{this.start(0)}),k):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var k;let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(k=this._customWrappers[Q])||void 0===k?void 0:k.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[k]??this._customWrappers[0]}setCustomEffect(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[Q]=new kk.b(this._engine),this._customWrappers[Q].effect=k}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new r.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(k,Q,i){return super._removeGradientAndTexture(k,Q,i),this._releaseBuffers(),this}addColorGradient(k,Q){this._colorGradients||(this._colorGradients=[]);const i=new q(k,Q);return this._colorGradients.push(i),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(k&&this._colorGradients.sort(((k,Q)=>k.gradient<Q.gradient?-1:k.gradient>Q.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(k){return this._removeGradientAndTexture(k,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const Q in this._drawWrappers){var k;null===(k=this._drawWrappers[Q].drawContext)||void 0===k||k.reset()}}_addFactorGradient(k,Q,i){const Z=new t(Q,i);k.push(Z),this._releaseBuffers()}addSizeGradient(k,Q){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,k,Q),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(k){return this._removeGradientAndTexture(k,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(k,Q){if(!k)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&k.sort(((k,Q)=>k.gradient<Q.gradient?-1:k.gradient>Q.gradient?1:0));const i=this;i[Q]&&(i[Q].dispose(),i[Q]=null)}addAngularSpeedGradient(k,Q){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,k,Q),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(k){return this._removeGradientAndTexture(k,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(k,Q){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,k,Q),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(k){return this._removeGradientAndTexture(k,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(k,Q){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,k,Q),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(k){return this._removeGradientAndTexture(k,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(k,Q){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,k,Q),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(k){return this._removeGradientAndTexture(k,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(k){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(k,Q,i){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(k),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.gi=new r.c,this.onStoppedObservable=new r.c,this.onStartedObservable=new r.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,i&&"Scene"!==i.getClassName()?(this._engine=i,this.defaultProjectionMatrix=Z.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=i||x.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.SG.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,o.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,o.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,o.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,o.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new kk.b(this._engine)},this._customWrappers[0].effect=U,this._drawWrappers={0:new kk.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(Q=Q??{}).randomTextureSize||delete Q.randomTextureSize;const B={yQ:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...Q},m=Q;isFinite(m)&&(B.yQ=m),this._capacity=B.yQ,this._maxActiveParticleCount=B.yQ,this._currentActiveCount=0,this._isAnimationSheetEnabled=C,this.particleEmitterType=new G;const O=Math.min(this._engine.getCaps().maxTextureSize,B.randomTextureSize);let J=[];for(let Z=0;Z<O;++Z)J.push(Math.random()),J.push(Math.random()),J.push(Math.random()),J.push(Math.random());this._randomTexture=new n.c(new Float32Array(J),O,1,5,i,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,J=[];for(let Z=0;Z<O;++Z)J.push(Math.random()),J.push(Math.random()),J.push(Math.random()),J.push(Math.random());this._randomTexture2=new n.c(new Float32Array(J),O,1,5,i,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=O}_reset(){this._releaseBuffers()}_createVertexBuffers(k,Q,i){const Z={};Z.position=Q.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let U=3;Z.age=Q.createVertexBuffer("age",U,1,this._attributesStrideSize,!0),U+=1,Z.size=Q.createVertexBuffer("size",U,3,this._attributesStrideSize,!0),U+=3,Z.life=Q.createVertexBuffer("life",U,1,this._attributesStrideSize,!0),U+=1,U+=4,this.billboardMode===oQ.BILLBOARDMODE_STRETCHED&&(Z.direction=Q.createVertexBuffer("direction",U,3,this._attributesStrideSize,!0)),U+=3,this._platform.alignDataInBuffer&&(U+=1),this.particleEmitterType instanceof f&&(U+=3,this._platform.alignDataInBuffer&&(U+=1)),this._colorGradientsTexture||(Z.color=Q.createVertexBuffer("color",U,4,this._attributesStrideSize,!0),U+=4),this._isBillboardBased||(Z.initialDirection=Q.createVertexBuffer("initialDirection",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1)),this.noiseTexture&&(Z.noiseCoordinates1=Q.createVertexBuffer("noiseCoordinates1",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1),Z.noiseCoordinates2=Q.createVertexBuffer("noiseCoordinates2",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1)),Z.angle=Q.createVertexBuffer("angle",U,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?U++:U+=2,this._isAnimationSheetEnabled&&(Z.cellIndex=Q.createVertexBuffer("cellIndex",U,1,this._attributesStrideSize,!0),U+=1,this.spriteRandomStartCell&&(Z.cellStartOffset=Q.createVertexBuffer("cellStartOffset",U,1,this._attributesStrideSize,!0),U+=1)),Z.offset=i.createVertexBuffer("offset",0,2),Z.uv=i.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(Z),this._platform.createVertexBuffers(k,Z),this.resetDrawCache()}_initialize(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!k)return;const Q=this._engine,i=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof f&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const U=this.particleEmitterType instanceof f,C=Z.TmpVectors.zQ[0];let B=0;for(let Z=0;Z<this._capacity;Z++)if(i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),U?(this.particleEmitterType.particleDestinationGenerator(Z,null,C),i.push(C.x),i.push(C.y),i.push(C.z)):(i.push(0),i.push(0),i.push(0)),this._platform.alignDataInBuffer&&i.push(0),B+=16,U&&(this.particleEmitterType.particlePositionGenerator(Z,null,C),i.push(C.x),i.push(C.y),i.push(C.z),this._platform.alignDataInBuffer&&i.push(0),B+=4),this._colorGradientsTexture||(i.push(0),i.push(0),i.push(0),i.push(0),B+=4),this.isBillboardBased||(i.push(0),i.push(0),i.push(0),this._platform.alignDataInBuffer&&i.push(0),B+=4),this.noiseTexture&&(i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),this._platform.alignDataInBuffer&&i.push(0),i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),this._platform.alignDataInBuffer&&i.push(0),B+=8),i.push(0),B+=1,this._angularSpeedGradientsTexture||(i.push(0),B+=1),this._isAnimationSheetEnabled&&(i.push(0),B+=1,this.spriteRandomStartCell&&(i.push(0),B+=1)),this._platform.alignDataInBuffer){let k=3-(B+3&3);for(B+=k;k-- >0;)i.push(0)}const o=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),m=this._platform.createParticleBuffer(i),O=this._platform.createParticleBuffer(i);this._buffer0=new Y.d(Q,m,!1,this._attributesStrideSize),this._buffer1=new Y.d(Q,O,!1,this._attributesStrideSize),this._spriteBuffer=new Y.d(Q,o,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let k=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(k+="\n#define BILLBOARD"),this._colorGradientsTexture&&(k+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(k+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(k+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(k+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(k+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(k+="\n#define DRAGGRADIENTS"),this._flowMap&&(k+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(k+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(k+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(k+="\n#define NOISE"),this.isLocal&&(k+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===k||(this._cachedUpdateDefines=k,this._updateBuffer=this._platform.createUpdateBuffer(k)),this._platform.isUpdateBufferReady()}_getWrapper(k){const Q=this._getCustomDrawWrapper(k);if(null!==Q&&void 0!==Q&&Q.effect)return Q;const i=[];this.fillDefines(i,k);let Z=this._drawWrappers[k];Z||(Z=new kk.b(this._engine),Z.drawContext&&(Z.drawContext.useInstancing=!0),this._drawWrappers[k]=Z);const U=i.join("\n");if(Z.defines!==U){const k=[],Q=[],i=[];this.fillUniformsAttributesAndSamplerNames(Q,k,i),Z.setEffect(this._engine.createEffect("gpuRenderParticles",k,Q,i,U),U)}return Z}static _GetAttributeNamesOrOptions(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const U=[Y.h.PositionKind,"age","life","size","angle"];return k||U.push(Y.h.ColorKind),Q&&U.push("cellIndex"),i||U.push("initialDirection"),Z&&U.push("direction"),U.push("offset",Y.h.UVKind),U}static _GetEffectCreationOptions(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=["emitterWM","OO","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Qk.c)(Z),k&&Z.push("sheetInfos"),Q&&Z.push("logarithmicDepthConstant"),i&&(Z.push("vFogInfos"),Z.push("vFogColor")),Z}fillDefines(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Qk.i)(this,this._scene,k),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==OQ.b.FOGMODE_NONE&&k.push("#define FOG")),Q===oQ.BLENDMODE_MULTIPLY&&k.push("#define BLENDMULTIPLYMODE"),this.isLocal&&k.push("#define LOCAL"),this.useLogarithmicDepth&&k.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(k.push("#define BILLBOARD"),this.billboardMode){case oQ.BILLBOARDMODE_Y:k.push("#define BILLBOARDY");break;case oQ.BILLBOARDMODE_STRETCHED:k.push("#define BILLBOARDSTRETCHED");break;case oQ.BILLBOARDMODE_ALL:k.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&k.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&k.push("#define ANIMATESHEET"),i&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),k.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(k,Q,i){Q.push(...cQ._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===oQ.BILLBOARDMODE_STRETCHED)),k.push(...cQ._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),i.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(mQ.b.PrepareUniforms(k,this._imageProcessingConfigurationDefines),mQ.b.PrepareSamplers(i,this._imageProcessingConfigurationDefines))}animate(){var k;let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(Q?this.preWarmStepOffset:(null===(k=this._scene)||void 0===k?void 0:k.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(k,Q){const i=this[Q];if(!k||!k.length||i)return;const Z=new Float32Array(this._rawTextureWidth);for(let U=0;U<this._rawTextureWidth;U++){const Q=U/this._rawTextureWidth;I.GetCurrentGradient(Q,k,((k,Q,i)=>{Z[U]=(0,O.Lerp)(k.factor1,Q.factor1,i)}))}this[Q]=n.c.CreateRTexture(Z,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[Q].name=Q.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const k=new Uint8Array(4*this._rawTextureWidth),Q=B.TmpColors.Fo[0];for(let i=0;i<this._rawTextureWidth;i++){const Z=i/this._rawTextureWidth;I.GetCurrentGradient(Z,this._colorGradients,((Z,U,C)=>{B.Fo.LerpToRef(Z.color1,U.color1,C,Q),k[4*i]=255*Q.r,k[4*i+1]=255*Q.g,k[4*i+2]=255*Q.b,k[4*i+3]=255*Q.a}))}this._colorGradientsTexture=n.c.CreateRGBATexture(k,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(k,Q){var i,U,C,B;const o=this._getWrapper(k),m=o.effect;this._engine.enableEffect(o);const O=(null===(i=this._scene)||void 0===i?void 0:i.getViewMatrix())||Z.Matrix.IdentityReadOnly;if(m.setMatrix("view",O),m.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),m.setTexture("diffuseSampler",this.particleTexture),m.setVector2("translationPivot",this.translationPivot),m.setVector3("OO",this.OO),this.isLocal&&m.setMatrix("emitterWM",Q),this._colorGradientsTexture?m.setTexture("colorGradientSampler",this._colorGradientsTexture):m.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const k=this.particleTexture.getBaseSize();m.setFloat3("sheetInfos",this.spriteCellWidth/k.width,this.spriteCellHeight/k.height,k.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const k=this._scene.activeCamera;m.setVector3("eyePosition",k.globalPosition)}const J=m.defines;if(this._scene&&((0,Qk.g)(m,this,this._scene),this.applyFog&&(0,ik.e)(this._scene,void 0,m)),J.indexOf("#define BILLBOARDMODE_ALL")>=0){const k=O.clone();k.invert(),m.setMatrix("invView",k)}return this.useLogarithmicDepth&&this._scene&&(0,ik.j)(J,m,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(m),this._setEngineBasedOnBlendMode(k),this._platform.bindDrawBuffers(this._targetIndex,m,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(m),null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(B=this._scene)&&void 0!==B&&B.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(k){if(!this.UQ||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!k)if(this.UQ.position){k=this.UQ.getWorldMatrix()}else{const Q=this.UQ;k=Z.TmpVectors.Matrix[0],Z.Matrix.TranslationToRef(Q.x,Q.y,Q.z,k)}const Q=this._engine,i=Q.getDepthWrite();if(Q.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const k=this.sk();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",k.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",k),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const U=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=U,Q.setDepthWrite(i)}render(){let k,Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!Q&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let k=0;k<this.preWarmCycles;k++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const k=0|this._accumulatedCount;this._accumulatedCount-=k,this._currentActiveCount+=k}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.UQ.position){k=this.UQ.getWorldMatrix()}else{const Q=this.UQ;k=Z.TmpVectors.Matrix[0],Z.Matrix.TranslationToRef(Q.x,Q.y,Q.z,k)}const U=this._engine;this.updateInAnimate||this._update(k);let C=0;return Q||i||(U.setState(!1),this.forceDepthWrite&&U.setDepthWrite(!0),C=this.blendMode===oQ.BLENDMODE_MULTIPLYADD?this._render(oQ.BLENDMODE_MULTIPLY,k)+this._render(oQ.BLENDMODE_ADD,k):this._render(this.blendMode,k),this._engine.setAlphaMode(0)),C}rebuild(){const k=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(k,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,k()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const Q in this._drawWrappers){this._drawWrappers[Q].dispose()}if(this._drawWrappers={},this._scene){const k=this._scene.SG.indexOf(this);k>-1&&this._scene.SG.splice(k,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let Q=0;Q<this._renderVertexBuffers.length;++Q){const k=this._renderVertexBuffers[Q];for(const Q in k)k[Q].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),k&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),k&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.gi.notifyObservers(this),this.gi.clear()}clone(k,Q){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z={...this._customWrappers};let U=null;const C=this._engine;if(C.createEffectForParticles&&null!=this.customShader){U=this.customShader;const k=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"";Z[0]=C.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,k,void 0,void 0,void 0,this)}const B=this.serialize(i),o=cQ.Parse(B,this._scene||this._engine,this._rootUrl);return o.name=k,o.customShader=U,o._customWrappers=Z,void 0===Q&&(Q=this.UQ),this.noiseTexture&&(o.noiseTexture=this.noiseTexture.clone()),o.UQ=Q,o}serialize(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Q={};return oQ._Serialize(Q,this,k),Q.activeParticleCount=this.activeParticleCount,Q.randomTextureSize=this._randomTextureSize,Q.customShader=this.customShader,Q}static Parse(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0;const C=k.name;let B,o;Q instanceof tk.b?B=Q:(o=Q,B=o.getEngine());const m=new cQ(C,{yQ:U||k.yQ,randomTextureSize:k.randomTextureSize},Q,null,k.isAnimationSheetEnabled);if(m._rootUrl=i,k.customShader&&B.createEffectForParticles){const Q=k.customShader,i=Q.shaderOptions.defines.length>0?Q.shaderOptions.defines.join("\n"):"",Z=B.createEffectForParticles(Q.shaderPath.fragmentElement,Q.shaderOptions.uniforms,Q.shaderOptions.samplers,i,void 0,void 0,void 0,m);m.setCustomEffect(Z,0),m.customShader=Q}return k.id&&(m.id=k.id),k.activeParticleCount&&(m.activeParticleCount=k.activeParticleCount),oQ._Parse(k,m,Q,i),k.preventAutoStart&&(m.preventAutoStart=k.preventAutoStart),Z||m.preventAutoStart||m.start(),m}}var fQ=i(11119),YQ=i(12712),yQ=i(11659);class LQ{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(k){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const Q of this.systems)Q.UQ=k;this._emitterNode=k}setEmitterAsSphere(k,Q,i){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:k,renderingGroupId:Q};const Z=(0,YQ.c)("emitterSphere",{diameter:k.diameter,segments:k.segments},i);Z.renderingGroupId=Q;const U=new yQ.hQ("emitterSphereMaterial",i);U.emissiveColor=k.color,Z.material=U;for(const C of this.systems)C.UQ=Z;this._emitterNode=Z}start(k){for(const Q of this.systems)k&&(Q.UQ=k),Q.start()}dispose(){for(const k of this.systems)k.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Q={systems:[]};for(const i of this.systems)Q.systems.push(i.serialize(k));return this._emitterNode&&(Q.UQ=this._emitterCreationOptions),Q}static Parse(k,Q){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0;const U=new LQ,C=this.BaseAssetsUrl+"/textures/";Q=Q||x.b.LastCreatedScene;for(const B of k.systems)U.systems.push(i?cQ.Parse(B,Q,C,!0,Z):oQ.Parse(B,Q,C,!0,Z));if(k.UQ){const i=k.UQ.options;if("Sphere"===k.UQ.kind)U.setEmitterAsSphere({diameter:i.diameter,segments:i.segments,color:B.cQ.fQ(i.color)},k.UQ.renderingGroupId,Q)}return U}}LQ.BaseAssetsUrl="https://assets.babylonjs.com/particles";var sQ=i(11150);class uQ{static CreateDefault(k){let Q,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,Z=arguments.length>2?arguments[2]:void 0;Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new cQ("default system",{yQ:i},Z):new oQ("default system",i,Z),Q.UQ=k;const U=fQ.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return Q.particleTexture=new p.c(U,Q.sk()),Q.createConeEmitter(.1,Math.PI/4),Q.color1=new B.Fo(1,1,1,1),Q.color2=new B.Fo(1,1,1,1),Q.colorDead=new B.Fo(1,1,1,0),Q.minSize=.1,Q.maxSize=.1,Q.minEmitPower=2,Q.maxEmitPower=2,Q.updateSpeed=1/60,Q.emitRate=30,Q}static CreateAsync(k,Q){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0;Q||(Q=x.b.LastCreatedScene);const U={};return Q.addPendingData(U),new Promise(((C,B)=>{if(i&&!cQ.IsSupported)return Q.removePendingData(U),B("Particle system with GPU is not supported.");fQ.Tools.LoadFile(`${uQ.BaseAssetsUrl}/systems/${k}.json`,(k=>{Q.removePendingData(U);const B=JSON.parse(k.toString());return C(LQ.Parse(B,Q,i,Z))}),void 0,void 0,void 0,(()=>(Q.removePendingData(U),B(`An error occurred with the creation of your particle system. Check if your type '${k}' exists.`))))}))}static ExportSet(k){const Q=new LQ;for(const i of k)Q.systems.push(i);return Q}static ParseFromFileAsync(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",C=arguments.length>5?arguments[5]:void 0;return new Promise(((B,o)=>{const m=new sQ.d;m.addEventListener("readystatechange",(()=>{if(4==m.readyState)if(200==m.status){const Q=JSON.parse(m.responseText);let o;o=Z?cQ.Parse(Q,i,U,!1,C):oQ.Parse(Q,i,U,!1,C),k&&(o.name=k),B(o)}else o("Unable to load the particle system")})),m.open("GET",Q),m.send()}))}static ParseFromSnippetAsync(k,Q){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",U=arguments.length>4?arguments[4]:void 0;if("_BLANK"===k){const k=this.CreateDefault(null);return k.start(),Promise.resolve(k)}return new Promise(((C,B)=>{const o=new sQ.d;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){const B=JSON.parse(JSON.parse(o.responseText).jsonPayload),m=JSON.parse(B.particleSystem);let O;O=i?cQ.Parse(m,Q,Z,!1,U):oQ.Parse(m,Q,Z,!1,U),O.snippetId=k,C(O)}else B("Unable to load the snippet "+k)})),o.open("GET",this.SnippetUrl+"/"+k.replace(/#/g,"/")),o.send()}))}}uQ.BaseAssetsUrl=LQ.BaseAssetsUrl,uQ.SnippetUrl="https://snippet.babylonjs.com",uQ.CreateFromSnippetAsync=uQ.ParseFromSnippetAsync;var aQ=i(11734),jQ=i(11567),TQ=i(12718);(0,TQ.h)(jQ.d.NAME_PARTICLESYSTEM,((k,Q,i,Z)=>{const U=(0,TQ.i)(jQ.d.NAME_PARTICLESYSTEM);if(U&&void 0!==k.SG&&null!==k.SG)for(let C=0,B=k.SG.length;C<B;C++){const B=k.SG[C];i.SG.push(U(B,Q,Z))}})),(0,TQ.d)(jQ.d.NAME_PARTICLESYSTEM,((k,Q,i)=>{if(k.activeParticleCount){return cQ.Parse(k,Q,i)}return oQ.Parse(k,Q,i)})),tk.b.prototype.createEffectForParticles=function(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",C=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,m=arguments.length>7?arguments[7]:void 0,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,J=arguments.length>9?arguments[9]:void 0,G=[],H=[];const e=[];return m?m.fillUniformsAttributesAndSamplerNames(H,G,e):(G=oQ._GetAttributeNamesOrOptions(),H=oQ._GetEffectCreationOptions()),-1===U.indexOf(" BILLBOARD")&&(U+="\n#define BILLBOARD\n"),null!==m&&void 0!==m&&m.isAnimationSheetEnabled&&-1===U.indexOf(" ANIMATESHEET")&&(U+="\n#define ANIMATESHEET\n"),-1===Z.indexOf("diffuseSampler")&&Z.push("diffuseSampler"),this.createEffect({vertex:J??(null===m||void 0===m?void 0:m.vertexShaderName)??"particles",fragmentElement:k},G,H.concat(Q),e.concat(Z),U,C,B,o,void 0,O,(async()=>{0===O?await Promise.resolve().then(i.bind(i,12754)):await Promise.resolve().then(i.bind(i,12828))}))},aQ.d.prototype.getEmittedParticleSystems=function(){const k=[];for(let Q=0;Q<this.sk().SG.length;Q++){const i=this.sk().SG[Q];i.UQ===this&&k.push(i)}return k},aQ.d.prototype.getHierarchyEmittedParticleSystems=function(){const k=[],Q=this.getDescendants();Q.push(this);for(let i=0;i<this.sk().SG.length;i++){const Z=this.sk().SG[i],U=Z.UQ;U.position&&-1!==Q.indexOf(U)&&k.push(Z)}return k};i(11631),i(11641),i(11712);i(11715),i(12727),i(11493),i(11621),i(11754);i(11484);var KQ;i(12733),i(11320);!function(k){k[k.Color=2]="Color",k[k.UV=1]="UV",k[k.Random=0]="Random",k[k.Stated=3]="Stated"}(KQ||(KQ={}));var vQ=i(11529);const NQ=new Z.zQ(0,0,0),XQ=new Z.zQ(0,0,0),pQ=new Z.zQ(0,0,0);class dQ{constructor(k,Q,i){this.width=k,this.height=Q,this.data=i}processFlowable(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0;if(!i)return;i instanceof Z.Matrix?Z.zQ.TransformCoordinatesToRef(k.position,i,pQ):(pQ.x=i.x,pQ.y=i.y,pQ.z=i.z);const U=.5*pQ.x+.5,C=1-(.5*pQ.y+.5),B=Math.floor(U*this.width),o=Math.floor(C*this.height);if(B<0||B>=this.width||o<0||o>=this.height)return;const m=4*(o*this.width+B),O=this.data[m]/255*2-1,J=this.data[m+1]/255*2-1,G=this.data[m+2]/255*2-1,H=this.data[m+3]/255;NQ.set(O,J,G),NQ.scaleToRef(Q*H,XQ),k.direction.addInPlace(XQ)}_processParticle(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0;this.processFlowable(k,Q,i)}static async FromUrlAsync(k){return await new Promise(((Q,i)=>{const Z=document.createElement("canvas"),U=Z.getContext("2d");let C=null;const B=new Image;B.crossOrigin="anonymous",B.src=k,B.onerror=Q=>{i(new Error(`Failed to load image: ${k} : ${Q}`))},B.onload=()=>{Z.width=B.width,Z.height=B.height,U.drawImage(B,0,0),C=U.getImageData(0,0,Z.width,Z.height),Q(new dQ(Z.width,Z.height,C.data))}}))}static async ExtractFromTextureAsync(k){return await new Promise(((Q,i)=>{if(!k.isReady())return void k.onLoadObservable.addOnce((async()=>{try{const i=await this.ExtractFromTextureAsync(k);Q(i)}catch(Z){i(Z)}}));const Z=k.getSize();vQ.m.GetTextureDataAsync(k,Z.width,Z.height).then((k=>{Q(new dQ(Z.width,Z.height,new Uint8ClampedArray(k)))})).catch(i)}))}}var bQ,DQ,MQ,WQ,AQ,gQ,RQ,wQ,SQ;!function(k){k[k.Int=1]="Int",k[k.Float=2]="Float",k[k.Vector2=4]="Vector2",k[k.zQ=8]="zQ",k[k.Matrix=16]="Matrix",k[k.Particle=32]="Particle",k[k.Texture=64]="Texture",k[k.Fo=128]="Fo",k[k.FloatGradient=256]="FloatGradient",k[k.Vector2Gradient=512]="Vector2Gradient",k[k.Vector3Gradient=1024]="Vector3Gradient",k[k.Color4Gradient=2048]="Color4Gradient",k[k.System=4096]="System",k[k.AutoDetect=8192]="AutoDetect",k[k.BasedOnInput=16384]="BasedOnInput",k[k.Undefined=32768]="Undefined",k[k.All=65535]="All"}(bQ||(bQ={})),function(k){k[k.Compatible=0]="Compatible",k[k.TypeIncompatible=1]="TypeIncompatible",k[k.HierarchyIssue=2]="HierarchyIssue"}(DQ||(DQ={})),function(k){k[k.Input=0]="Input",k[k.Output=1]="Output"}(MQ||(MQ={}));class qQ{get direction(){return this._direction}get type(){if(this._type===bQ.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===bQ.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(k){this._type=k}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((k=>k.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(k,Q,i){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=bQ.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new r.c,this.onDisconnectionObservable=new r.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=Q,this.name=k,this._direction=i}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(k){var Q;return this.isConnected?null!==(Q=this._connectedPoint)&&void 0!==Q&&Q._storedFunction?this._connectedPoint._storedFunction(k):this._connectedPoint._storedValue:this.value}canConnectTo(k){return 0===this.checkCompatibilityState(k)}checkCompatibilityState(k){const Q=this._ownerBlock,i=k.ownerBlock;if(this.type!==k.type&&k.innerType!==bQ.AutoDetect)return k.acceptedConnectionPointTypes&&-1!==k.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(k.excludedConnectionPointTypes&&-1!==k.excludedConnectionPointTypes.indexOf(this.type))return 1;let Z=i,U=Q;return 0===this.direction&&(Z=Q,U=i),Z.isAnAncestorOf(U)?2:0}connectTo(k){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(k))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${k.ownerBlock.name}".${k.name}`;return this._endpoints.push(k),k._connectedPoint=this,this.onConnectionObservable.notifyObservers(k),k.onConnectionObservable.notifyObservers(this),this}disconnectFrom(k){const Q=this._endpoints.indexOf(k);return-1===Q||(this._endpoints.splice(Q,1),k._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(k),k.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(k){let Q=1;for(;Q<bQ.All;)k&Q||this.excludedConnectionPointTypes.push(Q),Q<<=1}serialize(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const Q={};return Q.name=this.name,Q.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Zo?(Q.valueType="BABYLON."+this.value.getClassName(),Q.value=this.value.Zo()):(Q.valueType="number",Q.value=this.value)),k&&this.connectedPoint&&(Q.inputName=this.name,Q.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,Q.targetConnectionName=this.connectedPoint.name,Q.isExposedOnFrame=!0,Q.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(Q.isExposedOnFrame=!0,Q.exposedPortPosition=this.exposedPortPosition),Q}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class PQ{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(k){this._name=k}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(k){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new r.c,this.gi=new r.c,this.onInputChangedObservable=new r.c,this.visibleOnFrame=!1,this._name=k,this.uniqueId=d.e.UniqueId}_inputRename(k){return k}_outputRename(k){return k}isAnAncestorOf(k){for(const Q of this._outputs)if(Q.hasEndpoints)for(const i of Q.endpoints){if(i.ownerBlock===k)return!0;if(i.ownerBlock.isAnAncestorOf(k))return!0}return!1}isAnAncestorOfType(k){if(this.getClassName()===k)return!0;for(const Q of this._outputs)if(Q.hasEndpoints)for(const i of Q.endpoints)if(i.ownerBlock.isAnAncestorOfType(k))return!0;return!1}getInputByName(k){const Q=this._inputs.filter((Q=>Q.name===k));return Q.length?Q[0]:null}_linkConnectionTypes(k,Q){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[Q]._acceptedConnectionPointType=this._inputs[k]:(this._inputs[k]._linkedConnectionSource=this._inputs[Q],this._inputs[k]._isMainLinkSource=!0),this._inputs[Q]._linkedConnectionSource=this._inputs[k]}registerInput(k,Q){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0,C=arguments.length>5?arguments[5]:void 0;const B=new qQ(k,this,0);return B.type=Q,B.isOptional=i,B.defaultValue=Z,B.value=Z,B.valueMin=U,B.valueMax=C,this._inputs.push(B),this.onInputChangedObservable.notifyObservers(B),this}registerOutput(k,Q,i){return(i=i??new qQ(k,this,1)).type=Q,this._outputs.push(i),this}_build(k){}_customBuildStep(k){}build(k){if(this._buildId===k.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((k=>k.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=k.buildId;for(const Q of this._inputs){if(!Q.connectedPoint){Q.isOptional||k.notConnectedNonOptionalInputs.push(Q);continue}const i=Q.connectedPoint.ownerBlock;i&&i!==this&&!i.isSystem&&i.build(k)}return this._customBuildStep(k),k.verbose&&b.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(k),this.onBuildObservable.notifyObservers(this),!1}serialize(){const k={};k.customType="BABYLON."+this.getClassName(),k.id=this.uniqueId,k.name=this.name,k.visibleOnFrame=this.visibleOnFrame,k.inputs=[],k.outputs=[];for(const Q of this.inputs)k.inputs.push(Q.serialize());for(const Q of this.outputs)k.outputs.push(Q.serialize(!1));return k}_deserialize(k){this._name=k.name,this.comments=k.comments,this.visibleOnFrame=!!k.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(k)}_deserializePortDisplayNamesAndExposedOnFrame(k){const Q=k.inputs,i=k.outputs;if(Q)for(const Z of Q){const k=this.inputs.find((k=>k.name===Z.name));if(!k)return;if(Z.displayName&&(k.displayName=Z.displayName),Z.isExposedOnFrame&&(k.isExposedOnFrame=Z.isExposedOnFrame,k.exposedPortPosition=Z.exposedPortPosition),void 0!==Z.value&&null!==Z.value)if("number"===Z.valueType)k.value=Z.value;else{const Q=(0,o.b)(Z.valueType);Q&&(k.value=Q.fQ(Z.value))}}if(i)for(let Z=0;Z<i.length;Z++){const k=i[Z];k.displayName&&(this.outputs[Z].displayName=k.displayName),k.isExposedOnFrame&&(this.outputs[Z].isExposedOnFrame=k.isExposedOnFrame,this.outputs[Z].exposedPortPosition=k.exposedPortPosition)}}clone(){const k=this.serialize(),Q=(0,o.b)(k.customType);if(Q){const i=new Q;return i._deserialize(k),i}return null}dispose(){this.gi.notifyObservers(this),this.gi.clear();for(const k of this.inputs)k.dispose();for(const k of this.outputs)k.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function tQ(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",Z=arguments.length>3?arguments[3]:void 0;return(U,C)=>{let B=U._propStore;B||(B=[],U._propStore=B),B.push({propertyName:C,displayName:k,type:Q,groupName:i,options:Z??{},className:U.getClassName()})}}(0,v.c)([(0,N.L)("comment")],PQ.prototype,"comments",void 0),function(k){k[k.Boolean=0]="Boolean",k[k.Float=1]="Float",k[k.Int=2]="Int",k[k.Vector2=3]="Vector2",k[k.List=4]="List",k[k.Fo=5]="Fo",k[k.SamplingMode=6]="SamplingMode",k[k.TextureFormat=7]="TextureFormat",k[k.TextureType=8]="TextureType"}(WQ||(WQ={})),function(k){k[k.None=0]="None",k[k.Position=1]="Position",k[k.Direction=2]="Direction",k[k.Age=3]="Age",k[k.Lifetime=4]="Lifetime",k[k.Color=5]="Color",k[k.ScaledDirection=6]="ScaledDirection",k[k.Scale=7]="Scale",k[k.AgeGradient=8]="AgeGradient",k[k.Angle=9]="Angle",k[k.SpriteCellIndex=16]="SpriteCellIndex",k[k.SpriteCellStart=17]="SpriteCellStart",k[k.SpriteCellEnd=18]="SpriteCellEnd"}(AQ||(AQ={})),function(k){k[k.None=0]="None",k[k.Time=1]="Time",k[k.Delta=2]="Delta",k[k.Emitter=3]="Emitter"}(gQ||(gQ={}));class IQ{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let k="";for(const Q of this.notConnectedNonOptionalInputs)k+=`input ${Q.name} from block ${Q.ownerBlock.name}[${Q.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(k)throw"Build of Node Particle System Set failed:\n"+k}adapt(k,Q){const i=k.getConnectedValue(this)||0;if(k.type===Q)return i;switch(Q){case bQ.Vector2:return new Z.Vector2(i,i);case bQ.zQ:return new Z.zQ(i,i,i);case bQ.Fo:return new B.Fo(i,i,i,i)}return null}getContextualValue(k){if(!this.particleContext||!this.systemContext)return null;switch(k){case AQ.Position:return this.particleContext.position;case AQ.Direction:return this.particleContext.direction;case AQ.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case AQ.Color:return this.particleContext.color;case AQ.Age:return this.particleContext.age;case AQ.Lifetime:return this.particleContext.lifeTime;case AQ.Angle:return this.particleContext.angle;case AQ.Scale:return this.particleContext.scale;case AQ.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case AQ.SpriteCellEnd:return this.systemContext.endSpriteCellID;case AQ.SpriteCellIndex:return this.particleContext.cellIndex;case AQ.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.UQ.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.UQ.absolutePosition:this.systemContext.UQ:null}getSystemValue(k){if(!this.particleContext||!this.systemContext)return null;switch(k){case gQ.Time:return this.systemContext._actualFrame;case gQ.Delta:return this.systemContext._scaledUpdateSpeed;case gQ.Emitter:if(this.isEmitterTransformNode){return this.systemContext.UQ.absolutePosition}return this.systemContext.UQ}return null}}function rQ(k,Q,i){const Z=new IQ;Z.lQ=Q;const U=k.createSystem(Z);return U.canStart=()=>!0,U.UQ=i.clone(),U.disposeOnStop=!0,U.start(),U}class nQ extends PQ{constructor(k){super(k),this.blendMode=m.BLENDMODE_ONEONE,this.yQ=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",bQ.Particle),this.registerInput("texture",bQ.Texture),this.registerInput("onStart",bQ.System,!0),this.registerInput("onEnd",bQ.System,!0),this.registerOutput("system",bQ.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(k){k.yQ=this.yQ,k.buildId=this._buildId++,this.build(k);const Q=this.particle.getConnectedValue(k);return Q.particleTexture=this.texture.getConnectedValue(k),Q.emitRate=this.emitRate,Q.blendMode=this.blendMode,Q.name=this.name,Q._nodeGenerated=!0,Q._targetStopDuration=this.targetStopDuration,Q.startDelay=this.startDelay,this.system._storedValue=this,Q.canStart=()=>!this.doNoStart,Q.onStartedObservable.add((i=>{const Z=this.onStart.getConnectedValue(k);Z&&i.onStartedObservable.addOnce((()=>{k.systemContext=Q;const i=rQ(Z,k.lQ,k.emitterPosition);this.gi.addOnce((()=>{i.dispose()}))}));const U=this.onEnd.getConnectedValue(k);U&&i.onStoppedObservable.addOnce((()=>{k.systemContext=Q;const i=rQ(U,k.lQ,k.emitterPosition);this.gi.addOnce((()=>{i.dispose()}))}))})),this.gi.addOnce((()=>{Q.dispose()})),Q}serialize(){const k=super.serialize();return k.yQ=this.yQ,k.emitRate=this.emitRate,k.blendMode=this.blendMode,k.doNoStart=this.doNoStart,k.targetStopDuration=this.targetStopDuration,k.startDelay=this.startDelay,k}_deserialize(k){super._deserialize(k),this.yQ=k.yQ,this.emitRate=k.emitRate,this.doNoStart=!!k.doNoStart,void 0!==k.blendMode&&(this.blendMode=k.blendMode),void 0!==k.targetStopDuration&&(this.targetStopDuration=k.targetStopDuration),void 0!==k.startDelay&&(this.startDelay=k.startDelay)}}(0,v.c)([tQ("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:m.BLENDMODE_ONEONE},{label:"Standard",value:m.BLENDMODE_STANDARD},{label:"Add",value:m.BLENDMODE_ADD},{label:"Multiply",value:m.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:m.BLENDMODE_MULTIPLYADD}]})],nQ.prototype,"blendMode",void 0),(0,v.c)([tQ("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],nQ.prototype,"yQ",void 0),(0,v.c)([tQ("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nQ.prototype,"emitRate",void 0),(0,v.c)([tQ("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nQ.prototype,"targetStopDuration",void 0),(0,v.c)([tQ("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nQ.prototype,"startDelay",void 0),(0,v.c)([tQ("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],nQ.prototype,"doNoStart",void 0),(0,o.e)("BABYLON.SystemBlock",nQ);class xQ extends PQ{get type(){if(this._type===bQ.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=bQ.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=bQ.Vector2,this._type;case"zQ":return this._type=bQ.zQ,this._type;case"Fo":return this._type=bQ.Fo,this._type;case"Matrix":return this._type=bQ.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===AQ.None&&this._systemSource!==gQ.None}get systemSource(){return this._systemSource}set systemSource(k){if(this._systemSource=k,k!==gQ.None){switch(this._contextualSource=AQ.None,this._type=bQ.Float,k){case gQ.Time:case gQ.Delta:this._type=bQ.Float;break;case gQ.Emitter:this._type=bQ.zQ}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==AQ.None}get contextualValue(){return this._contextualSource}set contextualValue(k){if(this._contextualSource=k,k!==AQ.None){switch(this._systemSource=gQ.None,k){case AQ.Scale:this._type=bQ.Vector2;break;case AQ.Position:case AQ.Direction:case AQ.ScaledDirection:this._type=bQ.zQ;break;case AQ.Color:this._type=bQ.Fo;break;case AQ.Age:case AQ.Lifetime:case AQ.Angle:case AQ.AgeGradient:this._type=bQ.Float;break;case AQ.SpriteCellEnd:case AQ.SpriteCellStart:case AQ.SpriteCellIndex:this._type=bQ.Int}this.output&&(this.output.type=this._type)}}constructor(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bQ.AutoDetect;super(k),this._type=bQ.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new r.c,this._systemSource=gQ.None,this._contextualSource=AQ.None,this._type=Q,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",Q)}get value(){return this._storedValue}set value(k){this.type===bQ.Float&&this.min!==this.max&&(k=Math.max(this.min,k),k=Math.min(this.max,k)),this._storedValue=k,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(k){this._valueCallback=k}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case bQ.Int:case bQ.Float:this.value=0;break;case bQ.Vector2:this.value=Z.Vector2.Zero();break;case bQ.zQ:this.value=Z.zQ.Zero();break;case bQ.Fo:this.value=new B.Fo(1,1,1,1);break;case bQ.Matrix:this.value=Z.Matrix.Identity()}}_build(k){super._build(k),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=k=>k.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=k=>k.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const k=super.serialize();return k.type=this.type,k.contextualValue=this.contextualValue,k.systemSource=this.systemSource,k.min=this.min,k.max=this.max,k.groupInInspector=this.groupInInspector,k.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Zo?(k.valueType="BABYLON."+this._storedValue.getClassName(),k.value=this._storedValue.Zo()):(k.valueType="number",k.value=this._storedValue)),k}_deserialize(k){if(super._deserialize(k),this._type=k.type,this.contextualValue=k.contextualValue,this.systemSource=k.systemSource||gQ.None,this.min=k.min||0,this.max=k.max||0,this.groupInInspector=k.groupInInspector||"",void 0!==k.displayInInspector&&(this.displayInInspector=k.displayInInspector),k.valueType)if("number"===k.valueType)this._storedValue=k.value;else{const Q=(0,o.b)(k.valueType);Q&&(this._storedValue=Q.fQ(k.value))}}}(0,o.e)("BABYLON.ParticleInputBlock",xQ);class VQ extends PQ{get url(){return this._url}set url(k){this._url!==k&&(this._cachedData=null,this._url=k,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(k){this._textureDataUrl!==k&&(this._cachedData=null,this._textureDataUrl=k,this._url="",this._sourceTexture=null)}set sourceTexture(k){this._sourceTexture!==k&&(this._cachedData=null,this._sourceTexture=k,this._url="",this._textureDataUrl="")}constructor(k){super(k),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",bQ.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const k=this.texture._storedValue;return await new Promise(((Q,i)=>{if(!k.isReady())return void k.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),Q(this._cachedData)}catch(k){i(k)}}));const Z=k.getSize();vQ.m.GetTextureDataAsync(k,Z.width,Z.height).then((i=>{this._cachedData={width:Z.width,height:Z.height,data:new Uint8ClampedArray(i)},k.dispose(),Q(this._cachedData)})).catch(i)}))}_build(k){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new p.c(this._textureDataUrl,k.lQ):this.texture._storedValue=new p.c(this._url,k.lQ):this.texture._storedValue=null}serialize(){const k=super.serialize();return k.url=this.url,k.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(k.textureDataUrl=this.textureDataUrl),k}_deserialize(k){super._deserialize(k),this.url=k.url,this.serializedCachedData=!!k.serializedCachedData,k.textureDataUrl&&(this.textureDataUrl=k.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,o.e)("BABYLON.ParticleTextureSourceBlock",VQ);class ki extends PQ{constructor(k){super(k),this.registerInput("particle",bQ.Particle),this.registerInput("position",bQ.zQ),this.registerOutput("output",bQ.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(k){const Q=this.particle.getConnectedValue(k);if(this.output._storedValue=Q,!this.position.isConnected)return;const i={process:i=>{k.particleContext=i,k.systemContext=Q,i.position.B(this.position.getConnectedValue(k))},previousItem:null,nextItem:null};Q._updateQueueStart?gk(i,Q._updateQueueStart):Q._updateQueueStart=i}}(0,o.e)("BABYLON.UpdatePositionBlock",ki),function(k){k[k.Add=0]="Add",k[k.Subtract=1]="Subtract",k[k.Multiply=2]="Multiply",k[k.Divide=3]="Divide",k[k.Max=4]="Max",k[k.Min=5]="Min"}(RQ||(RQ={}));class Qi extends PQ{constructor(k){super(k),this.operation=RQ.Add,this.registerInput("left",bQ.AutoDetect),this.registerInput("right",bQ.AutoDetect),this.registerOutput("output",bQ.BasedOnInput),this.output._typeConnectionSource=this.left;const Q=[bQ.Matrix,bQ.Particle,bQ.Texture,bQ.System,bQ.FloatGradient,bQ.Color4Gradient,bQ.Vector2Gradient,bQ.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...Q),this.right.excludedConnectionPointTypes.push(...Q),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(k){let Q;const i=this.left,U=this.right;if(!i.isConnected||!U.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const C=i.type===bQ.Float||i.type===bQ.Int,o=U.type===bQ.Float||U.type===bQ.Int,m=C&&o;switch(this.operation){case RQ.Add:Q=m?k=>i.getConnectedValue(k)+U.getConnectedValue(k):C?k=>k.adapt(i,U.type).add(U.getConnectedValue(k)):k=>i.getConnectedValue(k).add(k.adapt(U,i.type));break;case RQ.Subtract:Q=m?k=>i.getConnectedValue(k)-U.getConnectedValue(k):C?k=>k.adapt(i,U.type).EQ(U.getConnectedValue(k)):k=>i.getConnectedValue(k).EQ(k.adapt(U,i.type));break;case RQ.Multiply:Q=m?k=>i.getConnectedValue(k)*U.getConnectedValue(k):C?k=>k.adapt(i,U.type).multiply(U.getConnectedValue(k)):k=>i.getConnectedValue(k).multiply(k.adapt(U,i.type));break;case RQ.Divide:Q=m?k=>i.getConnectedValue(k)/U.getConnectedValue(k):C?k=>k.adapt(i,U.type).divide(U.getConnectedValue(k)):k=>i.getConnectedValue(k).divide(k.adapt(U,i.type));break;case RQ.Min:if(m)Q=k=>Math.min(i.getConnectedValue(k),U.getConnectedValue(k));else{const[k,o]=C?[U,i]:[i,U];switch(k.type){case bQ.Vector2:Q=Q=>Z.Vector2.Minimize(k.getConnectedValue(Q),Q.adapt(o,k.type));break;case bQ.zQ:Q=Q=>Z.zQ.Minimize(k.getConnectedValue(Q),Q.adapt(o,k.type));break;case bQ.Fo:Q=Q=>{const i=k.getConnectedValue(Q),{r:Z,g:U,b:C,a:m}=Q.adapt(o,k.type);return new B.Fo(Math.min(i.r,Z),Math.min(i.g,U),Math.min(i.b,C),Math.min(i.a,m))}}}break;case RQ.Max:if(!m){const[k,o]=C?[U,i]:[i,U];switch(k.type){case bQ.Vector2:Q=Q=>Z.Vector2.Maximize(k.getConnectedValue(Q),Q.adapt(o,k.type));break;case bQ.zQ:Q=Q=>Z.zQ.Maximize(k.getConnectedValue(Q),Q.adapt(o,k.type));break;case bQ.Fo:Q=Q=>{const i=k.getConnectedValue(Q),{r:Z,g:U,b:C,a:m}=Q.adapt(o,k.type);return new B.Fo(Math.max(i.r,Z),Math.min(i.g,U),Math.min(i.b,C),Math.min(i.a,m))}}break}Q=k=>Math.max(i.getConnectedValue(k),U.getConnectedValue(k))}this.output._storedFunction=k=>i.type===bQ.Int?0|Q(k):Q(k)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===bQ.Int||this.left.type===bQ.Float&&this.right.type!==bQ.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[k,Q]of[[this.left,this.right],[this.right,this.left]])k.acceptedConnectionPointTypes=[bQ.Int,bQ.Float],Q.isConnected&&(k.acceptedConnectionPointTypes.push(Q.type),Q.type!==bQ.Int&&Q.type!==bQ.Float||k.acceptedConnectionPointTypes.push(bQ.Vector2,bQ.zQ,bQ.Fo))}dispose(){super.dispose();for(const k of this._connectionObservers)k.remove();this._connectionObservers.length=0}serialize(){const k=super.serialize();return k.operation=this.operation,k}_deserialize(k){super._deserialize(k),this.operation=k.operation}}(0,v.c)([tQ("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:RQ.Add},{label:"Subtract",value:RQ.Subtract},{label:"Multiply",value:RQ.Multiply},{label:"Divide",value:RQ.Divide},{label:"Max",value:RQ.Max},{label:"Min",value:RQ.Min}]})],Qi.prototype,"operation",void 0),(0,o.e)("BABYLON.ParticleMathBlock",Qi);class ii extends PQ{constructor(k){super(k),this.registerInput("particle",bQ.Particle),this.registerInput("direction1",bQ.zQ,!0,new Z.zQ(0,1,0)),this.registerInput("direction2",bQ.zQ,!0,new Z.zQ(0,1,0)),this.registerInput("minEmitBox",bQ.zQ,!0,new Z.zQ(-.5,-.5,-.5)),this.registerInput("maxEmitBox",bQ.zQ,!0,new Z.zQ(.5,.5,.5)),this.registerOutput("output",bQ.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(k){const Q=this.particle.getConnectedValue(k);Q._directionCreation.process=i=>{k.particleContext=i,k.systemContext=Q;const U=this.direction1.getConnectedValue(k),C=this.direction2.getConnectedValue(k),B=(0,O.RandomRange)(U.x,C.x),o=(0,O.RandomRange)(U.y,C.y),m=(0,O.RandomRange)(U.z,C.z);k.isEmitterTransformNode?Z.zQ.TransformNormalFromFloatsToRef(B,o,m,k.emitterWorldMatrix,i.direction):i.direction.Go(B,o,m)},Q._positionCreation.process=i=>{k.particleContext=i,k.systemContext=Q;const U=this.minEmitBox.getConnectedValue(k),C=this.maxEmitBox.getConnectedValue(k),B=(0,O.RandomRange)(U.x,C.x),o=(0,O.RandomRange)(U.y,C.y),m=(0,O.RandomRange)(U.z,C.z);k.isEmitterTransformNode?Z.zQ.TransformCoordinatesFromFloatsToRef(B,o,m,k.emitterWorldMatrix,i.position):(i.position.Go(B,o,m),i.position.addInPlace(k.emitterPosition))},this.output._storedValue=Q}}(0,o.e)("BABYLON.BoxShapeBlock",ii);class Zi extends PQ{constructor(k){super(k),this.registerInput("emitPower",bQ.Float,!0,1),this.registerInput("lifeTime",bQ.Float,!0,1),this.registerInput("color",bQ.Fo,!0,new B.Fo(1,1,1,1)),this.registerInput("scale",bQ.Vector2,!0,new Z.Vector2(1,1)),this.registerInput("angle",bQ.Float,!0,0),this.registerOutput("particle",bQ.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(k){const Q=new oQ(this.name,k.yQ,k.lQ,null,!1,void 0,!0);Q.particleEmitterType=new l,Q._lifeTimeCreation.process=(Q,i)=>{k.particleContext=Q,Q.lifeTime=this.lifeTime.getConnectedValue(k),i._emitPower=this.emitPower.getConnectedValue(k)},Q._colorCreation.process=Q=>{k.particleContext=Q,Q.color.B(this.color.getConnectedValue(k))},Q._sizeCreation.process=Q=>{k.particleContext=Q,Q.size=1,Q.scale.B(this.scale.getConnectedValue(k))},Q._angleCreation.process=Q=>{k.particleContext=Q,Q.angle=this.angle.getConnectedValue(k)},this.particle._storedValue=Q}}(0,o.e)("BABYLON.CreateParticleBlock",Zi);class Ui{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const k=[];for(const Q of this.attachedBlocks)Q.isInput&&k.push(Q);return k}constructor(k){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new r.c,this.name=k}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(k){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(k)&&this.attachedBlocks.push(k);for(const i of k.inputs){const Z=i.connectedPoint;if(Z){const i=Z.ownerBlock;i!==k&&this._initializeBlock(i,Q)}}}async buildAsync(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((i=>{const Z=new LQ;for(const k of this._systemBlocks)this._initializeBlock(k);for(const U of this.systemBlocks){const i=new IQ;i.buildId=this._buildId++,i.lQ=k,i.verbose=Q;const C=U.createSystem(i);i.emitErrors(),Z.systems.push(C)}this.onBuildObservable.notifyObservers(this),i(Z)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const k=new nQ("Particle system"),Q=new ki("Update position");Q.output.connectTo(k.particle);const i=new xQ("Position");i.contextualValue=AQ.Position;const Z=new xQ("Scaled direction");Z.contextualValue=AQ.ScaledDirection;const U=new Qi("Add");U.operation=RQ.Add,i.output.connectTo(U.left),Z.output.connectTo(U.right),U.output.connectTo(Q.position);const C=new Zi("Create particle"),B=new ii("Box shape");C.particle.connectTo(B.particle),B.output.connectTo(Q.particle);const o=new VQ("Texture");o.texture.connectTo(k.texture),o.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(k)}removeBlock(k){const Q=this.attachedBlocks.indexOf(k);if(Q>-1&&this.attachedBlocks.splice(Q,1),k.isSystem){const Q=this._systemBlocks.indexOf(k);Q>-1&&this._systemBlocks.splice(Q,1)}}parseSerializedObject(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Q||this.clear();const i={};for(const Z of k.OJ){const k=(0,o.b)(Z.customType);if(k){const Q=new k;Q._deserialize(Z),i[Z.id]=Q,this.attachedBlocks.push(Q),Q.isSystem&&this._systemBlocks.push(Q)}}for(const Z of this.attachedBlocks)if(Z.isTeleportOut){const k=Z,Q=k._tempEntryPointUniqueId;if(Q){const Z=i[Q];Z&&Z.attachToEndpoint(k)}}for(let Z=0;Z<k.OJ.length;Z++){const U=k.OJ[Z],C=i[U.id];C&&(C.inputs.length&&U.inputs.some((k=>k.targetConnectionName))&&!Q||this._restoreConnections(C,k,i))}if(k.locations||k.editorData&&k.editorData.locations){const Z=k.locations||k.editorData.locations;for(const k of Z)i[k.TZ]&&(k.TZ=i[k.TZ].uniqueId);Q&&this.editorData&&this.editorData.locations&&Z.concat(this.editorData.locations),k.locations?this.editorData={locations:Z}:(this.editorData=k.editorData,this.editorData.locations=Z);const U=[];for(const k in i)U[k]=i[k].uniqueId;this.editorData.map=U}this.comment=k.comment}_restoreConnections(k,Q,i){for(const Z of k.outputs)for(const U of Q.OJ){const C=i[U.id];if(C)for(const B of U.inputs)if(i[B.targetBlockId]!==k||B.targetConnectionName!==Z.name);else{const k=C.getInputByName(B.inputName);if(!k||k.isConnected)continue;Z.connectTo(k,!0),this._restoreConnections(C,Q,i)}}}serialize(k){const Q=k?{}:X.d.Serialize(this);Q.editorData=JSON.parse(JSON.stringify(this.editorData));let i=[];k?i=k:Q.customType="BABYLON.NodeParticleSystemSet",Q.OJ=[];for(const Z of i)Q.OJ.push(Z.serialize());if(!k)for(const Z of this.attachedBlocks)-1===i.indexOf(Z)&&Q.OJ.push(Z.serialize());return Q}dispose(){for(const k of this.attachedBlocks)k.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(k){const Q=new Ui(k);return Q.setToDefault(),Q}static Parse(k){const Q=X.d.Parse((()=>new Ui(k.name)),k,null);return Q.parseSerializedObject(k),Q}static ParseFromSnippetAsync(k,Q){return"_BLANK"===k?Promise.resolve(Ui.CreateDefault("blank")):new Promise(((i,Z)=>{const U=new sQ.d;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const B=JSON.parse(JSON.parse(U.responseText).jsonPayload),o=JSON.parse(B.nodeParticle);Q||(Q=X.d.Parse((()=>new Ui(k)),o,null)),Q.parseSerializedObject(o),Q.snippetId=k;try{i(Q)}catch(C){Z(C)}}else Z("Unable to load the snippet "+k)})),U.open("GET",this.SnippetUrl+"/"+k.replace(/#/g,"/")),U.send()}))}}Ui.EditorURL=`${fQ.Tools._DefaultCdnUrl}/v${tk.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Ui.SnippetUrl="https://snippet.babylonjs.com",(0,v.c)([(0,N.L)()],Ui.prototype,"name",void 0),(0,v.c)([(0,N.L)("comment")],Ui.prototype,"comment",void 0),function(k){k[k.None=0]="None",k[k.PerParticle=1]="PerParticle",k[k.PerSystem=2]="PerSystem"}(wQ||(wQ={}));class Ci extends PQ{constructor(k){super(k),this._currentLockId=-2,this.lockMode=wQ.PerParticle,this.registerInput("min",bQ.AutoDetect,!0,0),this.registerInput("max",bQ.AutoDetect,!0,1),this.registerOutput("output",bQ.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bQ.Float|bQ.Int|bQ.Vector2|bQ.zQ|bQ.Fo),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(bQ.Float|bQ.Int|bQ.Vector2|bQ.zQ|bQ.Fo),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=bQ.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let k=null;switch(this._currentLockId=-2,this.min.type){case bQ.AutoDetect:case bQ.Int:case bQ.Float:k=k=>{const Q=this.min.getConnectedValue(k)||0,i=this.max.getConnectedValue(k)||1;return Q+Math.random()*(i-Q)};break;case bQ.Vector2:k=k=>{const Q=this.min.getConnectedValue(k)||Z.Vector2.Zero(),i=this.max.getConnectedValue(k)||Z.Vector2.One();return new Z.Vector2(Q.x+Math.random()*(i.x-Q.x),Q.y+Math.random()*(i.y-Q.y))};break;case bQ.zQ:k=k=>{const Q=this.min.getConnectedValue(k)||Z.zQ.Zero(),i=this.max.getConnectedValue(k)||Z.zQ.One();return new Z.zQ(Q.x+Math.random()*(i.x-Q.x),Q.y+Math.random()*(i.y-Q.y),Q.z+Math.random()*(i.z-Q.z))};break;case bQ.Fo:k=k=>{const Q=this.min.getConnectedValue(k)||new B.Fo(0,0,0,0),i=this.max.getConnectedValue(k)||new B.Fo(1,1,1,1);return new B.Fo(Q.x+Math.random()*(i.x-Q.x),Q.y+Math.random()*(i.y-Q.y),Q.z+Math.random()*(i.z-Q.z),Q.w+Math.random()*(i.w-Q.w))}}this.output._storedFunction=Q=>{var i;let Z=0;switch(this.lockMode){case wQ.PerParticle:Z=(null===(i=Q.particleContext)||void 0===i?void 0:i.id)||-1;break;case wQ.PerSystem:Z=Q.buildId||0}return this._currentLockId!==Z&&(this.lockMode!==wQ.None&&(this._currentLockId=Z),this.output._storedValue=k(Q)),this.output._storedValue}}serialize(){const k=super.serialize();return k.lockMode=this.lockMode,k}_deserialize(k){super._deserialize(k),this.lockMode=k.lockMode}}(0,v.c)([tQ("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:wQ.None},{label:"Per particle",value:wQ.PerParticle},{label:"Per system",value:wQ.PerSystem}]})],Ci.prototype,"lockMode",void 0),(0,o.e)("BABYLON.ParticleRandomBlock",Ci);class Bi extends PQ{constructor(k){super(k),this._currentLockId=-2,this.lockMode=wQ.PerParticle,this.registerInput("min",bQ.AutoDetect),this.registerInput("max",bQ.AutoDetect),this.registerOutput("output",bQ.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const Q=[bQ.Matrix,bQ.Particle,bQ.Texture,bQ.System,bQ.FloatGradient,bQ.Color4Gradient,bQ.Vector2Gradient,bQ.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...Q),this.max.excludedConnectionPointTypes.push(...Q)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let k=null;switch(this._currentLockId=-2,this.min.type){case bQ.Float:case bQ.Int:k=k=>{const Q=this.min.getConnectedValue(k),i=this.max.getConnectedValue(k);return Math.random()*(i-Q)+Q};break;case bQ.Vector2:k=k=>{const Q=this.min.getConnectedValue(k),i=this.max.getConnectedValue(k);return new Z.Vector2(Math.random()*(i.x-Q.x)+Q.x,Math.random()*(i.y-Q.y)+Q.y)};break;case bQ.zQ:k=k=>{const Q=this.min.getConnectedValue(k),i=this.max.getConnectedValue(k);return new Z.zQ(Math.random()*(i.x-Q.x)+Q.x,Math.random()*(i.y-Q.y)+Q.y,Math.random()*(i.z-Q.z)+Q.z)};break;case bQ.Fo:k=k=>{const Q=this.min.getConnectedValue(k),i=this.max.getConnectedValue(k);return new B.Fo(Math.random()*(i.r-Q.r)+Q.r,Math.random()*(i.g-Q.g)+Q.g,Math.random()*(i.b-Q.b)+Q.b,Math.random()*(i.a-Q.a)+Q.a)}}this.output._storedFunction=Q=>{var i;let Z=0;switch(this.lockMode){case wQ.PerParticle:Z=(null===(i=Q.particleContext)||void 0===i?void 0:i.id)||-1;break;case wQ.PerSystem:Z=Q.buildId||0}return this._currentLockId!==Z&&(this.lockMode!==wQ.None&&(this._currentLockId=Z),this.output._storedValue=k(Q)),this.output._storedValue}}serialize(){const k=super.serialize();return k.lockMode=this.lockMode,k}_deserialize(k){super._deserialize(k),void 0!==k.lockMode&&(this.lockMode=k.lockMode)}}(0,v.c)([tQ("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:wQ.None},{label:"Per particle",value:wQ.PerParticle},{label:"Per system",value:wQ.PerSystem}]})],Bi.prototype,"lockMode",void 0),(0,o.e)("BABYLON.RandomRangeBlock",Bi);(0,o.e)("BABYLON.ParticleLerpBlock",class extends PQ{constructor(k){super(k),this.registerInput("left",bQ.AutoDetect),this.registerInput("right",bQ.AutoDetect),this.registerInput("gradient",bQ.Float,!0,0,0,1),this.registerOutput("output",bQ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bQ.Float|bQ.Int|bQ.Vector2|bQ.zQ|bQ.Fo)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const k=(k,Q,i)=>(1-k)*Q+k*i;this.output._storedFunction=Q=>{const i=this.left.getConnectedValue(Q),U=this.right.getConnectedValue(Q),C=this.gradient.getConnectedValue(Q);switch(this.left.type){case bQ.Int:case bQ.Float:return k(C,i,U);case bQ.Vector2:return new Z.Vector2(k(C,i.x,U.x),k(C,i.y,U.y));case bQ.zQ:return new Z.zQ(k(C,i.x,U.x),k(C,i.y,U.y),k(C,i.z,U.z));case bQ.Fo:return new B.Fo(k(C,i.r,U.r),k(C,i.g,U.g),k(C,i.b,U.b),k(C,i.a,U.a))}return 0}}});(0,o.e)("BABYLON.UpdateDirectionBlock",class extends PQ{constructor(k){super(k),this.registerInput("particle",bQ.Particle),this.registerInput("direction",bQ.zQ),this.registerOutput("output",bQ.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(k){const Q=this.particle.getConnectedValue(k);if(this.output._storedValue=Q,!this.direction.isConnected)return;const i={process:i=>{k.particleContext=i,k.systemContext=Q,i.direction.B(this.direction.getConnectedValue(k))},previousItem:null,nextItem:null};Q._updateQueueStart?gk(i,Q._updateQueueStart):Q._updateQueueStart=i}});(0,o.e)("BABYLON.UpdateColorBlock",class extends PQ{constructor(k){super(k),this.registerInput("particle",bQ.Particle),this.registerInput("color",bQ.Fo),this.registerOutput("output",bQ.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(k){const Q=this.particle.getConnectedValue(k);if(this.output._storedValue=Q,!this.color.isConnected)return;const i={process:i=>{k.particleContext=i,k.systemContext=Q,i.color.B(this.color.getConnectedValue(k))},previousItem:null,nextItem:null};Q._updateQueueStart?gk(i,Q._updateQueueStart):Q._updateQueueStart=i}});(0,o.e)("BABYLON.UpdateScaleBlock",class extends PQ{constructor(k){super(k),this.registerInput("particle",bQ.Particle),this.registerInput("scale",bQ.Vector2),this.registerOutput("output",bQ.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(k){const Q=this.particle.getConnectedValue(k);if(this.output._storedValue=Q,!this.scale.isConnected)return;const i={process:i=>{k.particleContext=i,k.systemContext=Q,i.scale.B(this.scale.getConnectedValue(k))},previousItem:null,nextItem:null};Q._updateQueueStart?gk(i,Q._updateQueueStart):Q._updateQueueStart=i}});(0,o.e)("BABYLON.UpdateAngleBlock",class extends PQ{constructor(k){super(k),this.registerInput("particle",bQ.Particle),this.registerInput("angle",bQ.Float),this.registerOutput("output",bQ.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(k){const Q=this.particle.getConnectedValue(k);if(this.output._storedValue=Q,!this.angle.isConnected)return;const i={process:i=>{k.particleContext=i,k.systemContext=Q,i.angle=this.angle.getConnectedValue(k)},previousItem:null,nextItem:null};Q._updateQueueStart?gk(i,Q._updateQueueStart):Q._updateQueueStart=i}});(0,o.e)("BABYLON.BasicPositionUpdateBlock",class extends PQ{constructor(k){super(k),this.registerInput("particle",bQ.Particle),this.registerOutput("output",bQ.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(k){const Q=this.particle.getConnectedValue(k),i={process:i=>{k.particleContext=i,k.systemContext=Q,i.direction.scaleToRef(Q._directionScale,Q._scaledDirection),i.position.addInPlace(Q._scaledDirection)},previousItem:null,nextItem:null};Q._updateQueueStart?gk(i,Q._updateQueueStart):Q._updateQueueStart=i,this.output._storedValue=Q}});(0,o.e)("BABYLON.BasicSpriteUpdateBlock",class extends PQ{constructor(k){super(k),this.registerInput("particle",bQ.Particle),this.registerOutput("output",bQ.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(k){const Q=this.particle.getConnectedValue(k),i={process:i=>{k.particleContext=i,k.systemContext=Q,i.updateCellIndex()},previousItem:null,nextItem:null};Q._updateQueueStart?gk(i,Q._updateQueueStart):Q._updateQueueStart=i,this.output._storedValue=Q}});(0,o.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends PQ{constructor(k){super(k),this.registerInput("particle",bQ.Particle),this.registerInput("cellIndex",bQ.Int),this.registerOutput("output",bQ.Particle),this.cellIndex.acceptedConnectionPointTypes=[bQ.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(k){const Q=this.particle.getConnectedValue(k);if(this.output._storedValue=Q,!this.cellIndex.isConnected)return;const i={process:i=>{k.particleContext=i,k.systemContext=Q,i.cellIndex=Math.floor(this.cellIndex.getConnectedValue(k))},previousItem:null,nextItem:null};Q._updateQueueStart?gk(i,Q._updateQueueStart):Q._updateQueueStart=i}});class oi extends PQ{constructor(k){super(k),this.strength=1,this.registerInput("particle",bQ.Particle),this.registerInput("flowMap",bQ.Texture),this.registerOutput("output",bQ.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(k){var Q;const i=this.particle.getConnectedValue(k),Z=k.lQ;let U;(null===(Q=this.flowMap.connectedPoint)||void 0===Q?void 0:Q.ownerBlock).extractTextureContentAsync().then((k=>{k&&(U=new dQ(k.width,k.height,k.data))}));const C={process:k=>{const Q=Z.getTransformMatrix();U&&U._processParticle(k,this.strength*i._tempScaledUpdateSpeed,Q)},previousItem:null,nextItem:null};i._updateQueueStart?gk(C,i._updateQueueStart):i._updateQueueStart=C,this.output._storedValue=i}serialize(){const k=super.serialize();return k.strength=this.strength,k}_deserialize(k){super._deserialize(k),this.strength=k.strength}}(0,v.c)([tQ("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],oi.prototype,"strength",void 0),(0,o.e)("BABYLON.UpdateFlowMapBlock",oi);(0,o.e)("BABYLON.SphereShapeBlock",class extends PQ{constructor(k){super(k),this.registerInput("input",bQ.Particle),this.registerInput("radius",bQ.Float,!0,1),this.registerInput("radiusRange",bQ.Float,!0,1,0,1),this.registerInput("directionRandomizer",bQ.Float,!0,0,0,1),this.registerOutput("output",bQ.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(k){const Q=this.input.getConnectedValue(k);Q._directionCreation.process=i=>{k.particleContext=i,k.systemContext=Q;const U=this.directionRandomizer.getConnectedValue(k),C=i.position.EQ(k.emitterPosition).normalize(),B=(0,O.RandomRange)(0,U),o=(0,O.RandomRange)(0,U),m=(0,O.RandomRange)(0,U);C.x+=B,C.y+=o,C.z+=m,C.normalize(),k.isEmitterTransformNode?Z.zQ.TransformNormalFromFloatsToRef(B,o,m,k.emitterWorldMatrix,i.direction):i.direction.Go(B,o,m)},Q._positionCreation.process=i=>{k.particleContext=i,k.systemContext=Q;const U=this.radius.getConnectedValue(k),C=this.radiusRange.getConnectedValue(k),B=U-(0,O.RandomRange)(0,U*C),o=(0,O.RandomRange)(0,1),m=(0,O.RandomRange)(0,2*Math.PI),J=Math.acos(2*o-1),G=B*Math.cos(m)*Math.sin(J),H=B*Math.cos(J),e=B*Math.sin(m)*Math.sin(J);k.isEmitterTransformNode?Z.zQ.TransformCoordinatesFromFloatsToRef(G,H,e,k.emitterWorldMatrix,i.position):(i.position.Go(G,H,e),i.position.addInPlace(k.emitterPosition))},this.output._storedValue=Q}});(0,o.e)("BABYLON.PointShapeBlock",class extends PQ{constructor(k){super(k),this.registerInput("particle",bQ.Particle),this.registerInput("direction1",bQ.zQ,!0,new Z.zQ(0,1,0)),this.registerInput("direction2",bQ.zQ,!0,new Z.zQ(0,1,0)),this.registerOutput("output",bQ.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(k){const Q=this.particle.getConnectedValue(k);Q._directionCreation.process=i=>{k.particleContext=i,k.systemContext=Q;const U=this.direction1.getConnectedValue(k),C=this.direction2.getConnectedValue(k),B=(0,O.RandomRange)(U.x,C.x),o=(0,O.RandomRange)(U.y,C.y),m=(0,O.RandomRange)(U.z,C.z);k.isEmitterTransformNode?Z.zQ.TransformNormalFromFloatsToRef(B,o,m,k.emitterWorldMatrix,i.direction):i.direction.Go(B,o,m)},Q._positionCreation.process=i=>{k.systemContext=Q,k.isEmitterTransformNode?Z.zQ.TransformCoordinatesFromFloatsToRef(0,0,0,k.emitterWorldMatrix,i.position):i.position.B(k.emitterPosition)},this.output._storedValue=Q}});(0,o.e)("BABYLON.CustomShapeBlock",class extends PQ{constructor(k){super(k),this.registerInput("particle",bQ.Particle),this.registerInput("position",bQ.zQ,!0,new Z.zQ(0,0,0)),this.registerInput("direction",bQ.zQ,!0,new Z.zQ(0,1,0)),this.registerOutput("output",bQ.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(k){const Q=this.particle.getConnectedValue(k);Q._directionCreation.process=i=>{k.particleContext=i,k.systemContext=Q;const U=this.direction.getConnectedValue(k);k.isEmitterTransformNode?Z.zQ.TransformNormalToRef(U,k.emitterWorldMatrix,i.direction):i.direction.B(U)},Q._positionCreation.process=i=>{k.particleContext=i,k.systemContext=Q;const U=this.position.getConnectedValue(k);k.isEmitterTransformNode?Z.zQ.TransformCoordinatesToRef(U,k.emitterWorldMatrix,i.position):(i.position.B(U),i.position.addInPlace(k.emitterPosition))},this.output._storedValue=Q}});(0,o.e)("BABYLON.CylinderShapeBlock",class extends PQ{constructor(k){super(k),this._tempVector=Z.zQ.Zero(),this.registerInput("particle",bQ.Particle),this.registerInput("radius",bQ.Float,!0,1),this.registerInput("height",bQ.Float,!0,1,0),this.registerInput("radiusRange",bQ.Float,!0,1,0,1),this.registerInput("directionRandomizer",bQ.Float,!0,0,0,1),this.registerOutput("output",bQ.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(k){const Q=this.particle.getConnectedValue(k);Q._directionCreation.process=i=>{k.particleContext=i,k.systemContext=Q;const U=this.directionRandomizer.getConnectedValue(k);i.position.subtractToRef(k.emitterPosition,this._tempVector),this._tempVector.normalize(),k.isEmitterTransformNode&&Z.zQ.TransformNormalToRef(this._tempVector,k.emitterInverseWorldMatrix,this._tempVector);const C=(0,O.RandomRange)(-U/2,U/2);let B=Math.atan2(this._tempVector.x,this._tempVector.z);B+=(0,O.RandomRange)(-Math.PI/2,Math.PI/2)*U,this._tempVector.y=C,this._tempVector.x=Math.sin(B),this._tempVector.z=Math.cos(B),this._tempVector.normalize(),k.isEmitterTransformNode?Z.zQ.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,k.emitterWorldMatrix,i.direction):i.direction.B(this._tempVector)},Q._positionCreation.process=i=>{k.particleContext=i,k.systemContext=Q;const U=this.height.getConnectedValue(k),C=this.radiusRange.getConnectedValue(k),B=this.radius.getConnectedValue(k),o=(0,O.RandomRange)(-U/2,U/2),m=(0,O.RandomRange)(0,2*Math.PI),J=(0,O.RandomRange)((1-C)*(1-C),1),G=Math.sqrt(J)*B,H=G*Math.cos(m),e=G*Math.sin(m);k.isEmitterTransformNode?Z.zQ.TransformCoordinatesFromFloatsToRef(H,o,e,k.emitterWorldMatrix,i.position):(i.position.Go(H,o,e),i.position.addInPlace(k.emitterPosition))},this.output._storedValue=Q}});class mi extends PQ{constructor(k){super(k),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",bQ.Particle),this.registerOutput("output",bQ.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(k){super._build(k);const Q=this.particle.getConnectedValue(k);Q._isAnimationSheetEnabled=!0,Q.spriteCellWidth=this.width,Q.spriteCellHeight=this.height,Q.startSpriteCellID=this.start,Q.endSpriteCellID=this.end,Q.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=Q}serialize(){const k=super.serialize();return k.width=this.width,k.height=this.height,k.start=this.start,k.end=this.end,k.randomStartCell=this.randomStartCell,k}_deserialize(k){super._deserialize(k),this.width=k.width,this.height=k.height,this.start=k.start,this.end=k.end,this.randomStartCell=k.randomStartCell}}(0,v.c)([tQ("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mi.prototype,"start",void 0),(0,v.c)([tQ("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mi.prototype,"end",void 0),(0,v.c)([tQ("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mi.prototype,"width",void 0),(0,v.c)([tQ("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mi.prototype,"height",void 0),(0,v.c)([tQ("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],mi.prototype,"loop",void 0),(0,v.c)([tQ("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],mi.prototype,"randomStartCell",void 0),(0,o.e)("BABYLON.SetupSpriteSheetBlock",mi);class Oi extends PQ{constructor(k){super(k),this.reference=0,this.registerInput("value",bQ.AutoDetect),this.registerOutput("output",bQ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=k=>{switch(k){case bQ.Float:return bQ.FloatGradient;case bQ.Vector2:return bQ.Vector2Gradient;case bQ.zQ:return bQ.Vector3Gradient;case bQ.Fo:return bQ.Color4Gradient}return k},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bQ.Float|bQ.Vector2|bQ.zQ|bQ.Fo)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=k=>null}serialize(){const k=super.serialize();return k.reference=this.reference,k}_deserialize(k){super._deserialize(k),this.reference=k.reference}}(0,v.c)([tQ("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Oi.prototype,"reference",void 0),(0,o.e)("BABYLON.ParticleGradientValueBlock",Oi);(0,o.e)("BABYLON.ParticleGradientBlock",class extends PQ{constructor(k){super(k),this._entryCount=1,this.registerInput("gradient",bQ.Float,!0,1,0,1),this.registerInput("value0",bQ.AutoDetect),this.registerOutput("output",bQ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=k=>{switch(k){case bQ.FloatGradient:return bQ.Float;case bQ.Vector2Gradient:return bQ.Vector2;case bQ.Vector3Gradient:return bQ.zQ;case bQ.Color4Gradient:return bQ.Fo}return k},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(bQ.FloatGradient|bQ.Vector2Gradient|bQ.Vector3Gradient|bQ.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(k){this._inputs[k].onConnectionObservable.add((()=>{this._entryCount>k||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),bQ.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const k=[];for(let i=1;i<this._inputs.length;i++){var Q;if(this._inputs[i].isConnected)k.push(null===(Q=this._inputs[i].connectedPoint)||void 0===Q?void 0:Q.ownerBlock)}k.sort(((k,Q)=>k.reference-Q.reference)),this.output._storedFunction=Q=>{const i=this.gradient.getConnectedValue(Q);if(1===k.length)return k[0].value.getConnectedValue(Q);let U=null;for(let C=k.length-1;C>=0;C--){const o=k[C];if(o.reference<=i){const k=o.value.getConnectedValue(Q);if(U){const C=U.value.getConnectedValue(Q),m=U.reference,J=o.reference,G=Math.max(0,Math.min(1,(i-J)/(m-J)));switch(this.output.type){case bQ.Float:return(0,O.Lerp)(k,C,G);case bQ.Vector2:return Z.Vector2.Lerp(k,C,G);case bQ.zQ:return Z.zQ.Lerp(k,C,G);case bQ.Fo:return B.Fo.Lerp(k,C,G)}}return k}U=o}return 0}}});(0,o.e)("BABYLON.ParticleConverterBlock",class extends PQ{constructor(k){super(k),this.registerInput("color ",bQ.Fo,!0),this.registerInput("xyz ",bQ.zQ,!0),this.registerInput("xy ",bQ.Vector2,!0),this.registerInput("zw ",bQ.Vector2,!0),this.registerInput("x ",bQ.Float,!0),this.registerInput("y ",bQ.Float,!0),this.registerInput("z ",bQ.Float,!0),this.registerInput("w ",bQ.Float,!0),this.registerOutput("color",bQ.Fo),this.registerOutput("xyz",bQ.zQ),this.registerOutput("xy",bQ.Vector2),this.registerOutput("zw",bQ.Vector2),this.registerOutput("x",bQ.Float),this.registerOutput("y",bQ.Float),this.registerOutput("z",bQ.Float),this.registerOutput("w",bQ.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(k){return"color "===k?"colorIn":"xyz "===k?"xyzIn":"xy "===k?"xyIn":"zw "===k?"zwIn":"x "===k?"xIn":"y "===k?"yIn":"z "===k?"zIn":"w "===k?"wIn":k}_outputRename(k){switch(k){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return k}}_build(k){super._build(k);const Q=this.xIn,i=this.yIn,U=this.zIn,C=this.wIn,o=this.xyIn,m=this.zwIn,O=this.xyzIn,J=this.colorIn,G=this.colorOut,H=this.xyzOut,e=this.xyOut,F=this.zwOut,z=this.xOut,E=this.yOut,l=this.zOut,h=this.wOut,c=k=>{if(J.isConnected)return J.getConnectedValue(k);let Z=0,G=0,H=0,e=0;if(Q.isConnected&&(Z=Q.getConnectedValue(k)),i.isConnected&&(G=i.getConnectedValue(k)),U.isConnected&&(H=U.getConnectedValue(k)),C.isConnected&&(e=C.getConnectedValue(k)),o.isConnected){const Q=o.getConnectedValue(k);Q&&(Z=Q.x,G=Q.y)}if(m.isConnected){const Q=m.getConnectedValue(k);Q&&(H=Q.x,e=Q.y)}if(O.isConnected){const Q=O.getConnectedValue(k);Q&&(Z=Q.x,G=Q.y,H=Q.z)}return new B.Fo(Z,G,H,e)};G._storedFunction=k=>c(k),H._storedFunction=k=>{const Q=c(k);return new Z.zQ(Q.r,Q.g,Q.b)},e._storedFunction=k=>{const Q=c(k);return new Z.Vector2(Q.r,Q.g)},F._storedFunction=k=>{const Q=c(k);return new Z.Vector2(Q.b,Q.a)},z._storedFunction=k=>c(k).r,E._storedFunction=k=>c(k).g,l._storedFunction=k=>c(k).b,h._storedFunction=k=>c(k).a}}),function(k){k[k.Cos=0]="Cos",k[k.Sin=1]="Sin",k[k.Abs=2]="Abs",k[k.Exp=3]="Exp",k[k.Exp2=4]="Exp2",k[k.Round=5]="Round",k[k.Floor=6]="Floor",k[k.Ceiling=7]="Ceiling",k[k.Sqrt=8]="Sqrt",k[k.Log=9]="Log",k[k.Tan=10]="Tan",k[k.ArcTan=11]="ArcTan",k[k.ArcCos=12]="ArcCos",k[k.ArcSin=13]="ArcSin",k[k.Sign=14]="Sign",k[k.Negate=15]="Negate",k[k.OneMinus=16]="OneMinus",k[k.Reciprocal=17]="Reciprocal",k[k.ToDegrees=18]="ToDegrees",k[k.ToRadians=19]="ToRadians",k[k.Fract=20]="Fract"}(SQ||(SQ={}));class Ji extends PQ{constructor(k){super(k),this.operation=SQ.Cos,this.registerInput("input",bQ.AutoDetect),this.registerOutput("output",bQ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bQ.Float|bQ.Int|bQ.Vector2|bQ.zQ|bQ.Fo)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(k){super._build(k);let Q=null;switch(this.operation){case SQ.Cos:Q=k=>Math.cos(k);break;case SQ.Sin:Q=k=>Math.sin(k);break;case SQ.Abs:Q=k=>Math.abs(k);break;case SQ.Exp:Q=k=>Math.exp(k);break;case SQ.Exp2:Q=k=>Math.pow(2,k);break;case SQ.Round:Q=k=>Math.round(k);break;case SQ.Floor:Q=k=>Math.floor(k);break;case SQ.Ceiling:Q=k=>Math.ceil(k);break;case SQ.Sqrt:Q=k=>Math.sqrt(k);break;case SQ.Log:Q=k=>Math.log(k);break;case SQ.Tan:Q=k=>Math.tan(k);break;case SQ.ArcTan:Q=k=>Math.atan(k);break;case SQ.ArcCos:Q=k=>Math.acos(k);break;case SQ.ArcSin:Q=k=>Math.asin(k);break;case SQ.Sign:Q=k=>Math.sign(k);break;case SQ.Negate:Q=k=>-k;break;case SQ.OneMinus:Q=k=>1-k;break;case SQ.Reciprocal:Q=k=>1/k;break;case SQ.ToRadians:Q=k=>k*Math.PI/180;break;case SQ.ToDegrees:Q=k=>180*k/Math.PI;break;case SQ.Fract:Q=k=>k>=0?k-Math.floor(k):k-Math.ceil(k)}if(!Q)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case bQ.Int:case bQ.Float:this.output._storedFunction=k=>{const i=this.input.getConnectedValue(k);return Q(i)};break;case bQ.Vector2:this.output._storedFunction=k=>{const i=this.input.getConnectedValue(k);return new Z.Vector2(Q(i.x),Q(i.y))};break;case bQ.zQ:this.output._storedFunction=k=>{const i=this.input.getConnectedValue(k);return new Z.zQ(Q(i.x),Q(i.y),Q(i.z))};break;case bQ.Fo:this.output._storedFunction=k=>{const i=this.input.getConnectedValue(k);return new B.Fo(Q(i.r),Q(i.g),Q(i.b),Q(i.a))}}return this}serialize(){const k=super.serialize();return k.operation=this.operation,k}_deserialize(k){super._deserialize(k),this.operation=k.operation}}(0,v.c)([tQ("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:SQ.Cos},{label:"Sin",value:SQ.Sin},{label:"Abs",value:SQ.Abs},{label:"Exp",value:SQ.Exp},{label:"Exp2",value:SQ.Exp2},{label:"Round",value:SQ.Round},{label:"Floor",value:SQ.Floor},{label:"Ceiling",value:SQ.Ceiling},{label:"Sqrt",value:SQ.Sqrt},{label:"Log",value:SQ.Log},{label:"Tan",value:SQ.Tan},{label:"ArcTan",value:SQ.ArcTan},{label:"ArcCos",value:SQ.ArcCos},{label:"ArcSin",value:SQ.ArcSin},{label:"Sign",value:SQ.Sign},{label:"Negate",value:SQ.Negate},{label:"OneMinus",value:SQ.OneMinus},{label:"Reciprocal",value:SQ.Reciprocal},{label:"ToDegrees",value:SQ.ToDegrees},{label:"ToRadians",value:SQ.ToRadians},{label:"Fract",value:SQ.Fract}]})],Ji.prototype,"operation",void 0),(0,o.e)("BABYLON.ParticleTrigonometryBlock",Ji);var Gi,Hi=i(12741);class ei extends PQ{constructor(k){super(k),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",bQ.AutoDetect),this.registerOutput("output",bQ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(bQ.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(bQ.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(bQ.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(bQ.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(bQ.System),this._inputs[0].excludedConnectionPointTypes.push(bQ.Particle),this._inputs[0].excludedConnectionPointTypes.push(bQ.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(k){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const Q=k=>{const Q=this.input.getConnectedValue(k);if(this.log.length>=this.stackSize)return Q;if(null===Q||void 0===Q)return this.log.push(["null",""]),Q;switch(this.input.type){case bQ.Vector2:this.log.push([(0,Hi.h)(Q,4),Q.toString()]);break;case bQ.zQ:this.log.push([(0,Hi.k)(Q,4),Q.toString()]);break;case bQ.Fo:this.log.push([`{R: ${Q.r.toFixed(4)} G: ${Q.g.toFixed(4)} B: ${Q.b.toFixed(4)} A: ${Q.a.toFixed(4)}}`,Q.toString()]);break;default:this.log.push([Q.toString(),Q.toString()])}return Q};this.output.isConnected?this.output._storedFunction=Q:this.output._storedValue=Q(k)}serialize(){const k=super.serialize();return k.stackSize=this.stackSize,k}_deserialize(k){super._deserialize(k),this.stackSize=k.stackSize}}(0,v.c)([tQ("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],ei.prototype,"stackSize",void 0),(0,o.e)("BABYLON.ParticleDebugBlock",ei);(0,o.e)("BABYLON.ParticleElbowBlock",class extends PQ{constructor(k){super(k),this.registerInput("input",bQ.AutoDetect),this.registerOutput("output",bQ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(k){super._build(k);const Q=this._outputs[0],i=this._inputs[0];Q._storedFunction=k=>i.getConnectedValue(k)}});(0,o.e)("BABYLON.ParticleTeleportInBlock",class extends PQ{get endpoints(){return this._endpoints}constructor(k){super(k),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",bQ.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(k){if(this.getClassName()===k)return!0;for(const Q of this.endpoints)if(Q.isAnAncestorOfType(k))return!0;return!1}isAnAncestorOf(k){for(const Q of this.endpoints){if(Q===k)return!0;if(Q.isAnAncestorOf(k))return!0}return!1}attachToEndpoint(k){k.detach(),this._endpoints.push(k),k._entryPoint=this,k._outputs[0]._typeConnectionSource=this._inputs[0],k._tempEntryPointUniqueId=null,k.name="> "+this.name}detachFromEndpoint(k){const Q=this._endpoints.indexOf(k);-1!==Q&&(this._endpoints.splice(Q,1),k._outputs[0]._typeConnectionSource=null,k._entryPoint=null)}_build(){for(const k of this._endpoints)k.output._storedFunction=k=>this.input.getConnectedValue(k)}});(0,o.e)("BABYLON.ParticleTeleportOutBlock",class extends PQ{constructor(k){super(k),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",bQ.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(k){this.entryPoint&&this.entryPoint.build(k)}clone(){const k=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(k),k}serialize(){var k;const Q=super.serialize();return Q.entryPoint=(null===(k=this.entryPoint)||void 0===k?void 0:k.uniqueId)??"",Q}_deserialize(k){super._deserialize(k),this._tempEntryPointUniqueId=k.entryPoint}}),function(k){k[k.Equal=0]="Equal",k[k.NotEqual=1]="NotEqual",k[k.LessThan=2]="LessThan",k[k.GreaterThan=3]="GreaterThan",k[k.LessOrEqual=4]="LessOrEqual",k[k.GreaterOrEqual=5]="GreaterOrEqual",k[k.Xor=6]="Xor",k[k.Or=7]="Or",k[k.And=8]="And"}(Gi||(Gi={}));class Fi extends PQ{constructor(k){super(k),this.test=Gi.Equal,this.epsilon=0,this.registerInput("left",bQ.Float),this.registerInput("right",bQ.Float,!0,0),this.registerInput("ifTrue",bQ.AutoDetect,!0,1),this.registerInput("ifFalse",bQ.AutoDetect,!0,0),this.registerOutput("output",bQ.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=bQ.Float,this._inputs[0].acceptedConnectionPointTypes.push(bQ.Int),this._inputs[1].acceptedConnectionPointTypes.push(bQ.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const k=k=>{const Q=this.left.getConnectedValue(k),i=this.right.getConnectedValue(k);let Z=!1;switch(this.test){case Gi.Equal:Z=(0,O.WithinEpsilon)(Q,i,this.epsilon);break;case Gi.NotEqual:Z=!(0,O.WithinEpsilon)(Q,i,this.epsilon);break;case Gi.LessThan:Z=Q<i+this.epsilon;break;case Gi.GreaterThan:Z=Q>i-this.epsilon;break;case Gi.LessOrEqual:Z=Q<=i+this.epsilon;break;case Gi.GreaterOrEqual:Z=Q>=i-this.epsilon;break;case Gi.Xor:Z=!!Q&&!i||!Q&&!!i;break;case Gi.Or:Z=!!Q||!!i;break;case Gi.And:Z=!!Q&&!!i}return Z};this.output._storedFunction=Q=>k(Q)?this.ifTrue.getConnectedValue(Q):this.ifFalse.getConnectedValue(Q)}serialize(){const k=super.serialize();return k.test=this.test,k.epsilon=this.epsilon,k}_deserialize(k){super._deserialize(k),this.test=k.test,void 0!==k.epsilon&&(this.epsilon=k.epsilon)}}(0,v.c)([tQ("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Gi.Equal},{label:"NotEqual",value:Gi.NotEqual},{label:"LessThan",value:Gi.LessThan},{label:"GreaterThan",value:Gi.GreaterThan},{label:"LessOrEqual",value:Gi.LessOrEqual},{label:"GreaterOrEqual",value:Gi.GreaterOrEqual},{label:"Xor",value:Gi.Xor},{label:"Or",value:Gi.Or},{label:"And",value:Gi.And}]})],Fi.prototype,"test",void 0),(0,v.c)([tQ("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Fi.prototype,"epsilon",void 0),(0,o.e)("BABYLON.ParticleConditionBlock",Fi);class zi extends PQ{constructor(k){super(k),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",bQ.Particle),this.registerInput("condition",bQ.Float,!0,0),this.registerInput("system",bQ.System),this.registerOutput("output",bQ.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(k){this._triggerCount=0;const Q=this.input.getConnectedValue(k),i={process:i=>{if(k.particleContext=i,k.systemContext=Q,0!==this.condition.getConnectedValue(k)&&(0===this.limit||this._triggerCount<this.limit)){const Z=(new Date).getTime();if(this._previousOne&&Z-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=Z;const U=this.system.getConnectedValue(k);if(U){const Z=rQ(U,k.lQ,i.position);Z.gi.addOnce((()=>{this._triggerCount--})),Q.gi.addOnce((()=>{Z.dispose()}))}}},previousItem:null,nextItem:null};Q._updateQueueStart?gk(i,Q._updateQueueStart):Q._updateQueueStart=i,this.output._storedValue=Q}serialize(){const k=super.serialize();return k.limit=this.limit,k.delay=this.delay,k}_deserialize(k){super._deserialize(k),void 0!==k.limit&&(this.limit=k.limit),void 0!==k.delay&&(this.delay=k.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,v.c)([tQ("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zi.prototype,"limit",void 0),(0,v.c)([tQ("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zi.prototype,"delay",void 0),(0,o.e)("BABYLON.ParticleTriggerBlock",zi);i(12744),i(12754),i(12771),i(12828)},12819:(k,Q,i)=>{"use strict";var Z=i(11210);const U="clipPlaneFragment",C="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12780:(k,Q,i)=>{"use strict";var Z=i(11210);const U="clipPlaneFragmentDeclaration",C="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12847:(k,Q,i)=>{"use strict";var Z=i(11210);const U="clipPlaneVertex",C="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12834:(k,Q,i)=>{"use strict";var Z=i(11210);const U="clipPlaneVertexDeclaration",C="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12825:(k,Q,i)=>{"use strict";var Z=i(11210);const U="fogFragment",C="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12810:(k,Q,i)=>{"use strict";var Z=i(11210);const U="fogFragmentDeclaration",C="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12853:(k,Q,i)=>{"use strict";var Z=i(11210);const U="fogVertex",C="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12838:(k,Q,i)=>{"use strict";var Z=i(11210);const U="fogVertexDeclaration",C="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12802:(k,Q,i)=>{"use strict";var Z=i(11210);const U="helperFunctions",C="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12785:(k,Q,i)=>{"use strict";var Z=i(11210);const U="imageProcessingDeclaration",C="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12805:(k,Q,i)=>{"use strict";var Z=i(11210);const U="imageProcessingFunctions",C="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12794:(k,Q,i)=>{"use strict";var Z=i(11210);const U="logDepthDeclaration",C="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12821:(k,Q,i)=>{"use strict";var Z=i(11210);const U="logDepthFragment",C="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12862:(k,Q,i)=>{"use strict";var Z=i(11210);const U="logDepthVertex",C="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";Z.d.IncludesShadersStoreWGSL[U]||(Z.d.IncludesShadersStoreWGSL[U]=C)},12771:(k,Q,i)=>{"use strict";i.r(Q),i.d(Q,{particlesPixelShaderWGSL:()=>B});var Z=i(11210);i(12780),i(12785),i(12794),i(12802),i(12805),i(12810),i(12819),i(12821),i(12825);const U="particlesPixelShader",C="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Z.d.ShadersStoreWGSL[U]||(Z.d.ShadersStoreWGSL[U]=C);const B={name:U,shader:C}},12828:(k,Q,i)=>{"use strict";i.r(Q),i.d(Q,{particlesVertexShaderWGSL:()=>B});var Z=i(11210);i(12834),i(12838),i(12794),i(12847),i(12853),i(12862);const U="particlesVertexShader",C="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Z.d.ShadersStoreWGSL[U]||(Z.d.ShadersStoreWGSL[U]=C);const B={name:U,shader:C}},12673:(k,Q,i)=>{"use strict";var Z=i(11210);const U="clipPlaneFragment",C="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12751:(k,Q,i)=>{"use strict";var Z=i(11210);const U="clipPlaneFragmentDeclaration",C="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12699:(k,Q,i)=>{"use strict";var Z=i(11210);const U="clipPlaneVertex",C="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12762:(k,Q,i)=>{"use strict";var Z=i(11210);const U="clipPlaneVertexDeclaration",C="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12688:(k,Q,i)=>{"use strict";var Z=i(11210);const U="fogFragment",C="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12664:(k,Q,i)=>{"use strict";var Z=i(11210);const U="fogFragmentDeclaration",C="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12702:(k,Q,i)=>{"use strict";var Z=i(11210);const U="fogVertex",C="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12690:(k,Q,i)=>{"use strict";var Z=i(11210);const U="fogVertexDeclaration",C="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12651:(k,Q,i)=>{"use strict";var Z=i(11210);const U="helperFunctions",C="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12633:(k,Q,i)=>{"use strict";var Z=i(11210);const U="imageProcessingDeclaration",C="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12656:(k,Q,i)=>{"use strict";var Z=i(11210);const U="imageProcessingFunctions",C="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12642:(k,Q,i)=>{"use strict";var Z=i(11210);const U="logDepthDeclaration",C="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12682:(k,Q,i)=>{"use strict";var Z=i(11210);const U="logDepthFragment",C="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12709:(k,Q,i)=>{"use strict";var Z=i(11210);const U="logDepthVertex",C="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";Z.d.IncludesShadersStore[U]||(Z.d.IncludesShadersStore[U]=C)},12744:(k,Q,i)=>{"use strict";i.r(Q),i.d(Q,{particlesPixelShader:()=>B});var Z=i(11210);i(12751),i(12633),i(12642),i(12651),i(12656),i(12664),i(12673),i(12682),i(12688);const U="particlesPixelShader",C="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Z.d.ShadersStore[U]||(Z.d.ShadersStore[U]=C);const B={name:U,shader:C}},12754:(k,Q,i)=>{"use strict";i.r(Q),i.d(Q,{particlesVertexShader:()=>B});var Z=i(11210);i(12762),i(12690),i(12642),i(12699),i(12702),i(12709);const U="particlesVertexShader",C="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Z.d.ShadersStore[U]||(Z.d.ShadersStore[U]=C);const B={name:U,shader:C}},13120:(k,Q,i)=>{"use strict";i.r(Q),i.d(Q,{FlowGraphGLTFDataProvider:()=>C});var Z=i(13084),U=i(13064);class C extends Z.e{constructor(k){var Q,i;super();const Z=k.glTF,C=(null===(Q=Z.animations)||void 0===Q?void 0:Q.map((k=>k._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",U.b,C);const B=(null===(i=Z.nodes)||void 0===i?void 0:i.map((k=>k._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",U.b,B)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13002:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>E,i:()=>F,l:()=>e,m:()=>z});var Z=i(11298),U=i(11761),C=i(11348),B=i(13011);const o=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class m{constructor(k,Q){this._gltf=k,this._infoTree=Q}convert(k){let Q,i=this._gltf,Z=this._infoTree;if(!k.startsWith("/"))throw new Error("Path must start with a /");const U=k.split("/");if(U.shift(),U[U.length-1].includes(".length")){const k=U[U.length-1].split(".");U.pop(),U.push(...k)}let C=!1;for(const m of U){const U="length"===m;if(U&&!Z.__array__)throw new Error(`Path ${k} is invalid`);if(Z.__ignoreObjectTree__&&(C=!0),Z.__array__&&!U)Z=Z.__array__;else if(Z=Z[m],!Z)throw new Error(`Path ${k} is invalid`);if(!C)if(void 0===i){if(!o.find((Q=>Q.regex.test(k))))throw new Error(`Path ${k} is invalid`)}else if(!U){var B;i=null===(B=i)||void 0===B?void 0:B[m]}(Z.__target__||U)&&(Q=i)}return{object:Q,info:Z}}}function O(k,Q,i,Z){const U=J(k,Q);return Z?U[i][Z]:U[i]}function J(k,Q,i){var Z,C;return null===(Z=k._data)||void 0===Z||null===(C=Z[(null===i||void 0===i?void 0:i.fillMode)??U.c.MATERIAL_TriangleFillMode])||void 0===C?void 0:C.babylonMaterial}function G(k,Q){return{offset:{componentsCount:2,type:"Vector2",get:(i,U,C)=>{const B=O(i,C,k,Q);return new Z.Vector2(null===B||void 0===B?void 0:B.uOffset,null===B||void 0===B?void 0:B.vOffset)},getTarget:J,set:(i,Z,U,C)=>{const B=O(Z,C,k,Q);B.uOffset=i.x,B.vOffset=i.y},getPropertyName:[()=>`${k}${Q?"."+Q:""}.uOffset`,()=>`${k}${Q?"."+Q:""}.vOffset`]},rotation:{type:"number",get:(i,Z,U)=>{var C;return null===(C=O(i,U,k,Q))||void 0===C?void 0:C.wAng},getTarget:J,set:(i,Z,U,C)=>O(Z,C,k,Q).wAng=i,getPropertyName:[()=>`${k}${Q?"."+Q:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(i,U,C)=>{const B=O(i,C,k,Q);return new Z.Vector2(null===B||void 0===B?void 0:B.uScale,null===B||void 0===B?void 0:B.vScale)},getTarget:J,set:(i,Z,U,C)=>{const B=O(Z,C,k,Q);B.uScale=i.x,B.vScale=i.y},getPropertyName:[()=>`${k}${Q?"."+Q:""}.uScale`,()=>`${k}${Q?"."+Q:""}.vScale`]}}}const H={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:k=>{var Q,i;return new Z.Vector2((null===(Q=k._babylonCamera)||void 0===Q?void 0:Q.orthoLeft)??0,(null===(i=k._babylonCamera)||void 0===i?void 0:i.orthoRight)??0)},set:(k,Q)=>{Q._babylonCamera&&(Q._babylonCamera.orthoLeft=k.x,Q._babylonCamera.orthoRight=k.y)},getTarget:k=>k,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:k=>{var Q,i;return new Z.Vector2((null===(Q=k._babylonCamera)||void 0===Q?void 0:Q.orthoBottom)??0,(null===(i=k._babylonCamera)||void 0===i?void 0:i.orthoTop)??0)},set:(k,Q)=>{Q._babylonCamera&&(Q._babylonCamera.orthoBottom=k.x,Q._babylonCamera.orthoTop=k.y)},getTarget:k=>k,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:k=>{var Q;return null===(Q=k._babylonCamera)||void 0===Q?void 0:Q.maxZ},set:(k,Q)=>{Q._babylonCamera&&(Q._babylonCamera.maxZ=k)},getTarget:k=>k,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:k=>{var Q;return null===(Q=k._babylonCamera)||void 0===Q?void 0:Q.Co},set:(k,Q)=>{Q._babylonCamera&&(Q._babylonCamera.Co=k)},getTarget:k=>k,getPropertyName:[()=>"Co"]}},perspective:{aspectRatio:{type:"number",get:k=>{var Q;return null===(Q=k._babylonCamera)||void 0===Q?void 0:Q.getEngine().getAspectRatio(k._babylonCamera)},getTarget:k=>k,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:k=>{var Q;return null===(Q=k._babylonCamera)||void 0===Q?void 0:Q.fov},set:(k,Q)=>{Q._babylonCamera&&(Q._babylonCamera.fov=k)},getTarget:k=>k,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:k=>{var Q;return null===(Q=k._babylonCamera)||void 0===Q?void 0:Q.maxZ},set:(k,Q)=>{Q._babylonCamera&&(Q._babylonCamera.maxZ=k)},getTarget:k=>k,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:k=>{var Q;return null===(Q=k._babylonCamera)||void 0===Q?void 0:Q.Co},set:(k,Q)=>{Q._babylonCamera&&(Q._babylonCamera.Co=k)},getTarget:k=>k,getPropertyName:[()=>"Co"]}}}},nodes:{length:{type:"number",get:k=>k.length,getTarget:k=>k.map((k=>k._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"zQ",get:k=>{var Q;return null===(Q=k._babylonTransformNode)||void 0===Q?void 0:Q.position},set:(k,Q)=>{var i;return null===(i=Q._babylonTransformNode)||void 0===i?void 0:i.position.B(k)},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:k=>{var Q;return null===(Q=k._babylonTransformNode)||void 0===Q?void 0:Q.rotationQuaternion},set:(k,Q)=>{var i,Z;return null===(i=Q._babylonTransformNode)||void 0===i||null===(Z=i.rotationQuaternion)||void 0===Z?void 0:Z.B(k)},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"zQ",get:k=>{var Q;return null===(Q=k._babylonTransformNode)||void 0===Q?void 0:Q.Ho},set:(k,Q)=>{var i;return null===(i=Q._babylonTransformNode)||void 0===i?void 0:i.Ho.B(k)},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"Ho"]},weights:{length:{type:"number",get:k=>k._numMorphTargets,getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(k,Q)=>{var i,Z;return void 0!==Q?null===(i=k._primitiveBabylonMeshes)||void 0===i||null===(Z=i[0].morphTargetManager)||void 0===Z?void 0:Z.getTarget(Q).influence:void 0},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(k,Q)=>[0],getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:k=>{var Q,i,U;return Z.Matrix.Compose(null===(Q=k._babylonTransformNode)||void 0===Q?void 0:Q.Ho,null===(i=k._babylonTransformNode)||void 0===i?void 0:i.rotationQuaternion,null===(U=k._babylonTransformNode)||void 0===U?void 0:U.position)},getTarget:k=>k._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:k=>{var Q,i,U,C;const B=Z.Matrix.Identity();let o=k.parent;for(;o&&o.parent;)o=o.parent;const m=(null===(Q=k._babylonTransformNode)||void 0===Q?void 0:Q.position._isDirty)||(null===(i=k._babylonTransformNode)||void 0===i||null===(U=i.rotationQuaternion)||void 0===U?void 0:U._isDirty)||(null===(C=k._babylonTransformNode)||void 0===C?void 0:C.Ho._isDirty);if(o){var O;const Q=null===(O=o._babylonTransformNode)||void 0===O?void 0:O.oo(!0).invert();var J,G;if(Q)null===(J=k._babylonTransformNode)||void 0===J||null===(G=J.oo(m))||void 0===G||G.multiplyToRef(Q,B)}else k._babylonTransformNode&&B.B(k._babylonTransformNode.oo(m));return B},getTarget:k=>k._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:k=>{var Q,i;return null===(Q=k._babylonTransformNode)||void 0===Q||null===(i=Q.getChildren((k=>k instanceof B.c),!0)[0])||void 0===i?void 0:i.lo},getTarget:k=>{var Q;return null===(Q=k._babylonTransformNode)||void 0===Q?void 0:Q.getChildren((k=>k instanceof B.c),!0)[0]},set:(k,Q)=>{if(Q._babylonTransformNode){const i=Q._babylonTransformNode.getChildren((k=>k instanceof B.c),!0)[0];i&&(i.lo=k)}}},color:{type:"cQ",get:k=>{var Q,i;return null===(Q=k._babylonTransformNode)||void 0===Q||null===(i=Q.getChildren((k=>k instanceof B.c),!0)[0])||void 0===i?void 0:i.ho},getTarget:k=>{var Q;return null===(Q=k._babylonTransformNode)||void 0===Q?void 0:Q.getChildren((k=>k instanceof B.c),!0)[0]},set:(k,Q)=>{if(Q._babylonTransformNode){const i=Q._babylonTransformNode.getChildren((k=>k instanceof B.c),!0)[0];i&&(i.ho=k)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"cQ",get:(k,Q,i)=>J(k,Q,i).emissiveColor,set:(k,Q,i,Z)=>J(Q,i,Z).emissiveColor.B(k),getTarget:(k,Q,i)=>J(k,Q,i),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:G("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(k,Q,i)=>{var Z;return null===(Z=O(k,i,"bumpTexture"))||void 0===Z?void 0:Z.level},set:(k,Q,i,Z)=>{const U=O(Q,Z,"bumpTexture");U&&(U.level=k)},getTarget:(k,Q,i)=>J(k,Q,i),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:G("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(k,Q,i)=>J(k,Q,i).ambientTextureStrength,set:(k,Q,i,Z)=>{const U=J(Q,i,Z);U&&(U.ambientTextureStrength=k)},getTarget:(k,Q,i)=>J(k,Q,i),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:G("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Fo",get:(k,Q,i)=>{const Z=J(k,Q,i);return C.Fo.FromColor3(Z.albedoColor,Z.alpha)},set:(k,Q,i,Z)=>{const U=J(Q,i,Z);U.albedoColor.set(k.r,k.g,k.b),U.alpha=k.a},getTarget:(k,Q,i)=>J(k,Q,i),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:G("albedoTexture")}},metallicFactor:{type:"number",get:(k,Q,i)=>J(k,Q,i).metallic,set:(k,Q,i,Z)=>{const U=J(Q,i,Z);U&&(U.metallic=k)},getTarget:(k,Q,i)=>J(k,Q,i),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(k,Q,i)=>J(k,Q,i).roughness,set:(k,Q,i,Z)=>{const U=J(Q,i,Z);U&&(U.roughness=k)},getTarget:(k,Q,i)=>J(k,Q,i),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:G("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(k,Q,i)=>J(k,Q,i).anisotropy.lo,set:(k,Q,i,Z)=>{J(Q,i,Z).anisotropy.lo=k},getTarget:(k,Q,i)=>J(k,Q,i),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(k,Q,i)=>J(k,Q,i).anisotropy.angle,set:(k,Q,i,Z)=>{J(Q,i,Z).anisotropy.angle=k},getTarget:(k,Q,i)=>J(k,Q,i),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:G("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(k,Q,i)=>J(k,Q,i).clearCoat.lo,set:(k,Q,i,Z)=>{J(Q,i,Z).clearCoat.lo=k},getTarget:(k,Q,i)=>J(k,Q,i),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(k,Q,i)=>J(k,Q,i).clearCoat.roughness,set:(k,Q,i,Z)=>{J(Q,i,Z).clearCoat.roughness=k},getTarget:(k,Q,i)=>J(k,Q,i),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:G("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(k,Q,i)=>{var Z;return null===(Z=J(k,Q,i).clearCoat.bumpTexture)||void 0===Z?void 0:Z.level},getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).clearCoat.bumpTexture.level=k},extensions:{KHR_texture_transform:G("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:G("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(k,Q,i)=>J(k,Q,i).subSurface.dispersion,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).subSurface.dispersion=k}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(k,Q,i)=>J(k,Q,i).emissiveIntensity,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).emissiveIntensity=k}},KHR_materials_ior:{ior:{type:"number",get:(k,Q,i)=>J(k,Q,i).indexOfRefraction,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).indexOfRefraction=k}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(k,Q,i)=>J(k,Q,i).iridescence.lo,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).iridescence.lo=k},iridescenceIor:{type:"number",get:(k,Q,i)=>J(k,Q,i).iridescence.indexOfRefraction,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).iridescence.indexOfRefraction=k},iridescenceTexture:{extensions:{KHR_texture_transform:G("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(k,Q,i)=>J(k,Q,i).iridescence.maximumThickness,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).iridescence.maximumThickness=k},iridescenceThicknessMinimum:{type:"number",get:(k,Q,i)=>J(k,Q,i).iridescence.minimumThickness,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).iridescence.minimumThickness=k},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:G("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"cQ",get:(k,Q,i)=>J(k,Q,i).sheen.color,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).sheen.color.B(k)},sheenColorTexture:{extensions:{KHR_texture_transform:G("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(k,Q,i)=>J(k,Q,i).sheen.lo,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).sheen.lo=k},sheenRoughnessTexture:{extensions:{KHR_texture_transform:G("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(k,Q,i)=>J(k,Q,i).metallicF0Factor,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).metallicF0Factor=k,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"cQ",get:(k,Q,i)=>J(k,Q,i).metallicReflectanceColor,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).metallicReflectanceColor.B(k),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:G("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:G("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(k,Q,i)=>J(k,Q,i).subSurface.refractionIntensity,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).subSurface.refractionIntensity=k,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:G("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(k,Q,i)=>J(k,Q,i).subSurface.translucencyIntensity,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).subSurface.translucencyIntensity=k},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:G("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"cQ",get:(k,Q,i)=>J(k,Q,i).subSurface.translucencyColor,getTarget:J,set:(k,Q,i,Z)=>{var U;return k&&(null===(U=J(Q,i,Z).subSurface.translucencyColor)||void 0===U?void 0:U.B(k))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:G("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"cQ",get:(k,Q,i)=>J(k,Q,i).subSurface.tintColor,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).subSurface.tintColor.B(k)},attenuationDistance:{type:"number",get:(k,Q,i)=>J(k,Q,i).subSurface.tintColorAtDistance,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).subSurface.tintColorAtDistance=k},thicknessFactor:{type:"number",get:(k,Q,i)=>J(k,Q,i).subSurface.maximumThickness,getTarget:J,set:(k,Q,i,Z)=>J(Q,i,Z).subSurface.maximumThickness=k},thicknessTexture:{extensions:{KHR_texture_transform:G("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:k=>k.length,getTarget:k=>k.map((k=>k._babylonLight)),getPropertyName:[k=>"length"]},__array__:{__target__:!0,color:{type:"cQ",get:k=>{var Q;return null===(Q=k._babylonLight)||void 0===Q?void 0:Q.ho},set:(k,Q)=>{var i;return null===(i=Q._babylonLight)||void 0===i?void 0:i.ho.B(k)},getTarget:k=>k._babylonLight,getPropertyName:[k=>"diffuse"]},lo:{type:"number",get:k=>{var Q;return null===(Q=k._babylonLight)||void 0===Q?void 0:Q.lo},set:(k,Q)=>Q._babylonLight?Q._babylonLight.lo=k:void 0,getTarget:k=>k._babylonLight,getPropertyName:[k=>"intensity"]},range:{type:"number",get:k=>{var Q;return null===(Q=k._babylonLight)||void 0===Q?void 0:Q.range},set:(k,Q)=>Q._babylonLight?Q._babylonLight.range=k:void 0,getTarget:k=>k._babylonLight,getPropertyName:[k=>"range"]},spot:{innerConeAngle:{type:"number",get:k=>{var Q;return null===(Q=k._babylonLight)||void 0===Q?void 0:Q.innerAngle},set:(k,Q)=>Q._babylonLight?Q._babylonLight.innerAngle=k:void 0,getTarget:k=>k._babylonLight,getPropertyName:[k=>"innerConeAngle"]},outerConeAngle:{type:"number",get:k=>{var Q;return null===(Q=k._babylonLight)||void 0===Q?void 0:Q.angle},set:(k,Q)=>Q._babylonLight?Q._babylonLight.angle=k:void 0,getTarget:k=>k._babylonLight,getPropertyName:[k=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:k=>k.length,getTarget:k=>k.map((k=>k._babylonLight)),getPropertyName:[k=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:k=>k.length,getTarget:k=>k.map((k=>k._babylonTexture)),getPropertyName:[k=>"length"]},__array__:{__target__:!0,lo:{type:"number",get:k=>{var Q;return null===(Q=k._babylonTexture)||void 0===Q?void 0:Q.level},set:(k,Q)=>{Q._babylonTexture&&(Q._babylonTexture.level=k)},getTarget:k=>k._babylonTexture},rotation:{type:"Quaternion",get:k=>{var Q;return k._babylonTexture&&Z.Quaternion.FromRotationMatrix(null===(Q=k._babylonTexture)||void 0===Q?void 0:Q.getReflectionTextureMatrix())},set:(k,Q)=>{var i;Q._babylonTexture&&(null!==(i=Q._babylonTexture.sk())&&void 0!==i&&i.useRightHandedSystem||(k=Z.Quaternion.Inverse(k)),Z.Matrix.FromQuaternionToRef(k,Q._babylonTexture.getReflectionTextureMatrix()))},getTarget:k=>k._babylonTexture}}}}},animations:{length:{type:"number",get:k=>k.length,getTarget:k=>k.map((k=>k._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:k=>k.length,getTarget:k=>k.map((k=>{var Q;return null===(Q=k.primitives[0]._instanceData)||void 0===Q?void 0:Q.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function e(k){return new m(k,H)}function F(k){const Q=k.split("/").map((k=>k.replace(/{}/g,"__array__")));let i=H;for(const Z of Q)Z&&(i=i[Z]);if(i&&i.type&&i.get)return i}function z(k,Q){const i=k.split("/").map((k=>k.replace(/{}/g,"__array__")));let Z=H;for(const U of i)U&&(Z=Z[U]);Z&&Z.type&&Z.get&&(Z.interpolation=Q)}function E(k,Q){const i=k.split("/").map((k=>k.replace(/{}/g,"__array__")));let Z=H;for(const U of i)if(U){if(!Z[U]){if("?"===U){Z.__ignoreObjectTree__=!0;continue}Z[U]={},"__array__"===U&&(Z[U].__target__=!0)}Z=Z[U]}Object.assign(Z,Q)}},13014:(k,Q,i)=>{"use strict";i.r(Q),i.d(Q,{AnimationPropertyInfo:()=>O,TransformNodeAnimationPropertyInfo:()=>J,WeightAnimationPropertyInfo:()=>G,getQuaternion:()=>o,getVector3:()=>B,getWeights:()=>m});var Z=i(11805),U=i(11298),C=i(13002);function B(k,Q,i,Z){return U.zQ.fQ(Q,i).scaleInPlace(Z)}function o(k,Q,i,Z){return U.Quaternion.fQ(Q,i).scaleInPlace(Z)}function m(k,Q,i,Z){const U=new Array(k._numMorphTargets);for(let C=0;C<U.length;C++)U[C]=Q[i++]*Z;return U}class O{constructor(k,Q,i,Z){this.type=k,this.name=Q,this.getValue=i,this.getStride=Z}_buildAnimation(k,Q,i){const U=new Z.c(k,this.name,Q,this.type);return U.setKeys(i),U}}class J extends O{buildAnimations(k,Q,i,Z){const U=[];return U.push({babylonAnimatable:k._babylonTransformNode,babylonAnimation:this._buildAnimation(Q,i,Z)}),U}}class G extends O{buildAnimations(k,Q,i,U){const C=[];if(k._numMorphTargets)for(let B=0;B<k._numMorphTargets;B++){const o=new Z.c(`${Q}_${B}`,this.name,i,this.type);if(o.setKeys(U.map((k=>({frame:k.frame,inTangent:k.inTangent?k.inTangent[B]:void 0,value:k.value[B],outTangent:k.outTangent?k.outTangent[B]:void 0,interpolation:k.interpolation})))),k._primitiveBabylonMeshes)for(const Q of k._primitiveBabylonMeshes)if(Q.morphTargetManager){const k=Q.morphTargetManager.getTarget(B),i=o.clone();k.animations.push(i),C.push({babylonAnimatable:k,babylonAnimation:i})}}return C}}(0,C.m)("/nodes/{}/translation",[new J(Z.c.ANIMATIONTYPE_VECTOR3,"position",B,(()=>3))]),(0,C.m)("/nodes/{}/rotation",[new J(Z.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",o,(()=>4))]),(0,C.m)("/nodes/{}/scale",[new J(Z.c.ANIMATIONTYPE_VECTOR3,"Ho",B,(()=>3))]),(0,C.m)("/nodes/{}/weights",[new G(Z.c.ANIMATIONTYPE_FLOAT,"influence",m,(k=>k._numMorphTargets))])},12969:(k,Q,i)=>{"use strict";class Z{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((k,Q)=>{this._resolve=k,this._reject=Q}))}}var U=i(11298),C=i(11348),B=i(11119),o=i(11740),m=i(12975),O=i(12984),J=i(11122),G=i(11759),H=i(11805),e=i(11813),F=i(11157),z=i(11134),E=i(11142);class l{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(k){this._useTextureToStoreBoneMatrices=k,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(k){this._animationPropertiesOverride=k}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(k,Q,i){this.name=k,this.id=Q,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=U.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new J.c,this.bones=[],this._scene=i||F.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const Z=this._scene.getEngine().getCaps();this._canUseTextureForBones=Z.textureFloat&&Z.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((k=>!k.getParent()))}getTransformMatrices(k){if(this.needInitialSkinMatrix){if(!k)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return k._bonesTransformMatrices||this.prepare(!0),k._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(k){return this.needInitialSkinMatrix&&k._transformMatrixTexture?k._transformMatrixTexture:this._transformMatrixTexture}sk(){return this._scene}toString(k){let Q=`Name: ${this.name}, nBones: ${this.bones.length}`;if(Q+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,k){Q+=", Ranges: {";let k=!0;for(const i in this._ranges)k&&(Q+=", ",k=!1),Q+=i;Q+="}"}return Q}getBoneIndexByName(k){for(let Q=0,i=this.bones.length;Q<i;Q++)if(this.bones[Q].name===k)return Q;return-1}createAnimationRange(k,Q,i){if(!this._ranges[k]){this._ranges[k]=new e.c(k,Q,i);for(let Z=0,U=this.bones.length;Z<U;Z++)this.bones[Z].animations[0]&&this.bones[Z].animations[0].createRange(k,Q,i)}}deleteAnimationRange(k){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let i=0,Z=this.bones.length;i<Z;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].deleteRange(k,Q);this._ranges[k]=null}getAnimationRange(k){return this._ranges[k]||null}getAnimationRanges(){const k=[];let Q;for(Q in this._ranges)k.push(this._ranges[Q]);return k}copyAnimationRange(k,Q){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[Q]||!k.getAnimationRange(Q))return!1;let Z=!0;const U=this._getHighestAnimationFrame()+1,C={},B=k.bones;let o,m;for(m=0,o=B.length;m<o;m++)C[B[m].name]=B[m];this.bones.length!==B.length&&(z.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${B.length}`),Z=!1);const O=i&&this.dimensionsAtRest&&k.dimensionsAtRest?this.dimensionsAtRest.divide(k.dimensionsAtRest):null;for(m=0,o=this.bones.length;m<o;m++){const k=this.bones[m].name,B=C[k];B?Z=Z&&this.bones[m].copyAnimationRange(B,Q,U,i,O):(z.c.Warn("copyAnimationRange: not same rig, missing source bone "+k),Z=!1)}const J=k.getAnimationRange(Q);return J&&(this._ranges[Q]=new e.c(Q,J.from+U,J.to+U)),Z}returnToRest(){for(const k of this.bones)-1!==k._index&&k.returnToRest()}_getHighestAnimationFrame(){let k=0;for(let Q=0,i=this.bones.length;Q<i;Q++)if(this.bones[Q].animations[0]){const i=this.bones[Q].animations[0].getHighestFrame();k<i&&(k=i)}return k}beginAnimation(k,Q,i,Z){const U=this.getAnimationRange(k);return U?this._scene.beginAnimation(this,U.from,U.to,Q,i,Z):null}static MakeAnimationAdditive(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;const Z=k.getAnimationRange(i);if(!Z)return null;const U=k._scene.getAllAnimatablesByTarget(k);let C=null;for(let o=0;o<U.length;o++){const k=U[o];if(k.fromFrame===(null===Z||void 0===Z?void 0:Z.from)&&k.toFrame===(null===Z||void 0===Z?void 0:Z.to)){C=k;break}}const B=k.getAnimatables();for(let o=0;o<B.length;o++){const k=B[o].animations;if(k)for(let Z=0;Z<k.length;Z++)H.c.MakeAnimationAdditive(k[Z],Q,i)}return C&&(C.isAdditive=!0),k}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(k){this._meshesWithPoseMatrix.push(k)}_unregisterMeshWithPoseMatrix(k){const Q=this._meshesWithPoseMatrix.indexOf(k);Q>-1&&this._meshesWithPoseMatrix.splice(Q,1)}_computeTransformMatrices(k,Q){this.onBeforeComputeObservable.notifyObservers(this);for(let i=0;i<this.bones.length;i++){const Z=this.bones[i];Z._childUpdateId++;const U=Z.getParent();if(U?Z.getLocalMatrix().multiplyToRef(U.getFinalMatrix(),Z.getFinalMatrix()):Q?Z.getLocalMatrix().multiplyToRef(Q,Z.getFinalMatrix()):Z.getFinalMatrix().B(Z.getLocalMatrix()),-1!==Z._index){const Q=null===Z._index?i:Z._index;Z.getAbsoluteInverseBindMatrix().multiplyToArray(Z.getFinalMatrix(),k,16*Q)}}this._identity.copyToArray(k,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const k=this.sk().getRenderId();if(this._currentRenderId===k)return;this._currentRenderId=k}if(this._numBonesWithLinkedTransformNode>0)for(const k of this.bones)if(k._linkedTransformNode){const Q=k._linkedTransformNode;k.position=Q.position,Q.rotationQuaternion?k.rotationQuaternion=Q.rotationQuaternion:k.rotation=Q.rotation,k.Ho=Q.Ho}if(this.needInitialSkinMatrix)for(const k of this._meshesWithPoseMatrix){const Q=k.getPoseMatrix();let i=this._isDirty;if(k._bonesTransformMatrices&&k._bonesTransformMatrices.length===16*(this.bones.length+1)||(k._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),i=!0),i){if(this._synchronizedWithMesh!==k){this._synchronizedWithMesh=k;for(const k of this.bones)if(!k.getParent()){k.getBindMatrix().multiplyToRef(Q,U.TmpVectors.Matrix[1]),k._updateAbsoluteBindMatrices(U.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const Q=4*(this.bones.length+1);k._transformMatrixTexture&&k._transformMatrixTexture.getSize().width===Q||(k._transformMatrixTexture&&k._transformMatrixTexture.dispose(),k._transformMatrixTexture=G.c.CreateRGBATexture(k._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(k._bonesTransformMatrices,Q),this.isUsingTextureForMatrices&&k._transformMatrixTexture&&k._transformMatrixTexture.update(k._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=G.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let k=0;k<this.bones.length;k++)this._animatables.push(this.bones[k])}return this._animatables}clone(k,Q){const i=new l(k,Q||k,this._scene);i.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Z=0;Z<this.bones.length;Z++){const k=this.bones[Z];let Q=null;const U=k.getParent();if(U){const k=this.bones.indexOf(U);Q=i.bones[k]}const C=new O.c(k.name,i,Q,k.getBindMatrix().clone(),k.getRestMatrix().clone());C._index=k._index,k._linkedTransformNode&&C.linkTransformNode(k._linkedTransformNode),E.b.DeepCopy(k.animations,C.animations)}if(this._ranges){i._ranges={};for(const k in this._ranges){const Q=this._ranges[k];Q&&(i._ranges[k]=Q.clone())}}return this._isDirty=!0,i.prepare(!0),i}enableBlending(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const Q of this.bones)for(const i of Q.animations)i.enableBlending=!0,i.blendingSpeed=k}dispose(){if(this._meshesWithPoseMatrix.length=0,this.sk().stopAnimation(this),this.sk().removeSkeleton(this),this._parentContainer){const k=this._parentContainer.skeletons.indexOf(this);k>-1&&this._parentContainer.skeletons.splice(k,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const k={};k.name=this.name,k.id=this.id,this.dimensionsAtRest&&(k.dimensionsAtRest=this.dimensionsAtRest.Zo()),k.bones=[],k.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let i=0;i<this.bones.length;i++){var Q;const Z=this.bones[i],U=Z.getParent(),C={parentBoneIndex:U?this.bones.indexOf(U):-1,index:Z.getIndex(),name:Z.name,id:Z.id,matrix:Z.getBindMatrix().Zo(),rest:Z.getRestMatrix().Zo(),linkedTransformNodeId:null===(Q=Z.getTransformNode())||void 0===Q?void 0:Q.id};k.bones.push(C),Z.length&&(C.length=Z.length),Z.metadata&&(C.metadata=Z.metadata),Z.animations&&Z.animations.length>0&&(C.animation=Z.animations[0].serialize()),k.ranges=[];for(const Q in this._ranges){const i=this._ranges[Q];if(!i)continue;const Z={};Z.name=Q,Z.from=i.from,Z.to=i.to,k.ranges.push(Z)}}return k}static Parse(k,Q){const i=new l(k.name,k.id,Q);let Z;for(k.dimensionsAtRest&&(i.dimensionsAtRest=U.zQ.fQ(k.dimensionsAtRest)),i.needInitialSkinMatrix=k.needInitialSkinMatrix,Z=0;Z<k.bones.length;Z++){const Q=k.bones[Z],C=k.bones[Z].index;let B=null;Q.parentBoneIndex>-1&&(B=i.bones[Q.parentBoneIndex]);const o=Q.rest?U.Matrix.fQ(Q.rest):null,m=new O.c(Q.name,i,B,U.Matrix.fQ(Q.matrix),o,null,C);void 0!==Q.id&&null!==Q.id&&(m.id=Q.id),Q.length&&(m.length=Q.length),Q.metadata&&(m.metadata=Q.metadata),Q.animation&&m.animations.push(H.c.Parse(Q.animation)),void 0!==Q.linkedTransformNodeId&&null!==Q.linkedTransformNodeId&&(i._hasWaitingData=!0,m._waitingTransformNodeId=Q.linkedTransformNodeId)}if(k.ranges)for(Z=0;Z<k.ranges.length;Z++){const Q=k.ranges[Z];i.createAnimationRange(Q.name,Q.from,Q.to)}return i}computeAbsoluteMatrices(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||k)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(k)}getPoseMatrix(){let k=null;return this._meshesWithPoseMatrix.length>0&&(k=this._meshesWithPoseMatrix[0].getPoseMatrix()),k}sortBones(){const k=[],Q=new Array(this.bones.length);for(let i=0;i<this.bones.length;i++)this._sortBones(i,k,Q);this.bones=k}_sortBones(k,Q,i){if(i[k])return;i[k]=!0;const Z=this.bones[k];if(!Z)return;void 0===Z._index&&(Z._index=k);const U=Z.getParent();U&&this._sortBones(this.bones.indexOf(U),Q,i),Q.push(Z)}setCurrentPoseAsRest(){for(const k of this.bones)k.setCurrentPoseAsRest()}}var h=i(11615),c=i(11774),f=i(11273),Y=i(11702),y=i(11378),L=i(11745),s=i(11712),u=i(11734),a=i(11820),j=i(11396),T=i(12926);class K{set areUpdatesFrozen(k){k?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new j.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,k||(k=F.b.LastCreatedScene),this._scene=k,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const k=this._scene.getEngine().getCaps();this._canUseTextureForTargets=k.canUseGLVertexID&&k.textureFloat&&k.maxVertexTextureImageUnits>0&&k.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return K.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?K.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(k){this._numMaxInfluencers!==k&&(this._numMaxInfluencers=k,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(k){this._useTextureToStoreTargets!==k&&(this._useTextureToStoreTargets=k,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var k;return K.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(k=this._scene)&&void 0!==k&&k.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(k){return this._activeTargets.data[k]}getTarget(k){return this._targets[k]}getTargetByName(k){for(const Q of this._targets)if(Q.name===k)return Q;return null}addTarget(k){this._targets.push(k),this._targetInfluenceChangedObservers.push(k.onInfluenceChanged.add((k=>{this.areUpdatesFrozen&&k&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(k)}))),this._targetDataLayoutChangedObservers.push(k._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(k){const Q=this._targets.indexOf(k);Q>=0&&(this._targets.splice(Q,1),k.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(Q,1)[0]),k._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(Q,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(k)}_bind(k){k.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),k.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),k.setTexture("morphTargets",this._targetStoreTexture),k.setInt("morphTargetCount",this.numInfluencers)}clone(){const k=new K(this._scene);for(const Q of this._targets)k.addTarget(Q.clone());return k.enablePositionMorphing=this.enablePositionMorphing,k.enableNormalMorphing=this.enableNormalMorphing,k.enableTangentMorphing=this.enableTangentMorphing,k.enableUVMorphing=this.enableUVMorphing,k.enableUV2Morphing=this.enableUV2Morphing,k.enableColorMorphing=this.enableColorMorphing,k}serialize(){const k={};k.id=this.uniqueId,k.targets=[];for(const Q of this._targets)k.targets.push(Q.serialize());return k}_syncActiveTargets(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const Q=!!this._targetStoreTexture,i=this.isUsingTextureForTargets;(this._mustSynchronize||Q!==i)&&(this._mustSynchronize=!1,this.synchronize());let Z=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let U=-1;for(const C of this._targets)if(U++,0!==C.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=K.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(C),this._morphTargetTextureIndices[Z]=U,this._tempInfluences[Z++]=C.influence}this._morphTargetTextureIndices.length!==Z&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,Z)),this._influences&&this._influences.length===Z||(this._influences=new Float32Array(Z));for(let C=0;C<Z;C++)this._influences[C]=this._tempInfluences[C];if(k&&this._scene)for(const C of this._scene.meshes)C.morphTargetManager===this&&(i?C._markSubMeshesAsAttributesDirty():C._syncGeometryWithMorphTargetManager())}synchronize(){var k;if(!this._scene||this.areUpdatesFrozen)return;const Q=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(k=this._targetStoreTexture)||void 0===k||k.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>Q.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const i of this._targets){this._supportsPositions=this._supportsPositions&&i.hasPositions,this._supportsNormals=this._supportsNormals&&i.hasNormals,this._supportsTangents=this._supportsTangents&&i.hasTangents,this._supportsUVs=this._supportsUVs&&i.hasUVs,this._supportsUV2s=this._supportsUV2s&&i.hasUV2s,this._supportsColors=this._supportsColors&&i.hasColors;const k=i.vertexCount;if(0===this._vertexCount)this._vertexCount=k;else if(this._vertexCount!==k)return void z.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${i.name}": ${k}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const k=Q.getCaps().maxTextureSize;this._textureWidth>k&&(this._textureHeight=Math.ceil(this._textureWidth/k),this._textureWidth=k);const i=this._targets.length,Z=new Float32Array(i*this._textureWidth*this._textureHeight*4);let U=0;for(let Q=0;Q<i;Q++){const k=this._targets[Q],i=k.getPositions(),C=k.getNormals(),B=k.getUVs(),o=k.getTangents(),m=k.getUV2s(),O=k.getColors();U=Q*this._textureWidth*this._textureHeight*4;for(let Q=0;Q<this._vertexCount;Q++)this._supportsPositions&&i&&(Z[U]=i[3*Q],Z[U+1]=i[3*Q+1],Z[U+2]=i[3*Q+2],U+=4),this._supportsNormals&&C&&(Z[U]=C[3*Q],Z[U+1]=C[3*Q+1],Z[U+2]=C[3*Q+2],U+=4),this._supportsUVs&&B&&(Z[U]=B[2*Q],Z[U+1]=B[2*Q+1],U+=4),this._supportsTangents&&o&&(Z[U]=o[3*Q],Z[U+1]=o[3*Q+1],Z[U+2]=o[3*Q+2],U+=4),this._supportsUV2s&&m&&(Z[U]=m[2*Q],Z[U+1]=m[2*Q+1],U+=4),this._supportsColors&&O&&(Z[U]=O[4*Q],Z[U+1]=O[4*Q+1],Z[U+2]=O[4*Q+2],Z[U+3]=O[4*Q+3],U+=4)}this._targetStoreTexture=T.e.CreateRGBATexture(Z,this._textureWidth,this._textureHeight,i,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const i of this._scene.meshes)i.morphTargetManager===this&&i._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const k=this._parentContainer.morphTargetManagers.indexOf(this);k>-1&&this._parentContainer.morphTargetManagers.splice(k,1),this._parentContainer=null}for(const k of this._targets)this._scene.stopAnimation(k)}}static Parse(k,Q){const i=new K(Q);for(const Z of k.targets)i.addTarget(a.e.Parse(Z,Q));return i}}K.EnableTextureStorage=!0,K.MaxActiveMorphTargetsInVertexAttributeMode=8,K.ConstantTargetCountForTextureMode=0;var v=i(12991),N=i(11163),X=i(11631);const p=new Map,d=p;function b(k,Q,i){D(k)&&z.c.Warn(`Extension with the name '${k}' already exists`),p.set(k,{isGLTFExtension:Q,factory:i})}function D(k){return p.delete(k)}var M=i(13002),W=i(11876),A=i(11387);class g{static Get(k,Q,i){if(!Q||void 0==i||!Q[i])throw new Error(`${k}: Failed to find index (${i})`);return Q[i]}static TryGet(k,Q){return k&&void 0!=Q&&k[Q]?k[Q]:null}static Assign(k){if(k)for(let Q=0;Q<k.length;Q++)k[Q].index=Q}}function R(k){if(k.min&&k.max){const Q=k.min,i=k.max,Z=U.TmpVectors.zQ[0].Go(Q[0],Q[1],Q[2]),C=U.TmpVectors.zQ[1].Go(i[0],i[1],i[2]);if(k.normalized&&5126!==k.componentType){let Q=1;switch(k.componentType){case 5120:Q=127;break;case 5121:Q=255;break;case 5122:Q=32767;break;case 5123:Q=65535}const i=1/Q;Z.scaleInPlace(i),C.scaleInPlace(i)}return new X.c(Z,C)}return null}class w{static RegisterExtension(k,Q){b(k,!1,Q)}static UnregisterExtension(k){return D(k)}get XC(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(k){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=k}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((k=>k.dispose&&k.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(k,Q,i,Z,U,C){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=Q,this._assetContainer=i,this._loadData(Z);let C=null;if(k){const Q={};if(this._gltf.nodes)for(const k of this._gltf.nodes)k.name&&(Q[k.name]=k.index);C=(k instanceof Array?k:[k]).map((k=>{const i=Q[k];if(void 0===i)throw new Error(`Failed to find node '${k}'`);return i}))}return await this._loadAsync(U,B,C,(()=>({meshes:this._getMeshes(),SG:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(k,Q,i,Z){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=k,this._loadData(Q),await this._loadAsync(i,U,null,(()=>{}))}async _loadAsync(k,Q,i,Z){return await Promise.resolve().then((async()=>{this._rootUrl=k,this._uniqueRootUrl=!k.startsWith("file:")&&Q?k:`${k}${Date.now()}/`,this._fileName=Q,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const U=`${v.o[v.o.LOADING]} => ${v.o[v.o.READY]}`,C=`${v.o[v.o.LOADING]} => ${v.o[v.o.COMPLETE]}`;this._parent._startPerformanceCounter(U),this._parent._startPerformanceCounter(C),this._parent._setState(v.o.LOADING),this._extensionsOnLoading();const o=new Array;if(!this.parent.loadOnlyMaterials)if(i)o.push(this.loadSceneAsync("/nodes",{nodes:i,index:-1}));else if(void 0!=this._gltf.lQ||this._gltf.scenes&&this._gltf.scenes[0]){const k=g.Get("/scene",this._gltf.scenes,this._gltf.lQ||0);o.push(this.loadSceneAsync(`/scenes/${k.index}`,k))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let k=0;k<this._gltf.materials.length;++k){const Q=this._gltf.materials[k],i="/materials/"+k,Z=h.c.TriangleFillMode;o.push(this._loadMaterialAsync(i,Q,null,Z,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&o.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&o.push(this._compileShadowGeneratorsAsync());const m=Promise.all(o).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.do(!0);for(const k of this._babylonScene.materials){const Q=k;void 0!==Q.maxSimultaneousLights&&(Q.maxSimultaneousLights=Math.max(Q.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(v.o.READY),this._skipStartAnimationStep||this._startAnimations(),Z()}));return await m.then((k=>(this._parent._endPerformanceCounter(U),B.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(C),this._parent._setState(v.o.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(k=>{this._parent.onErrorObservable.notifyObservers(k),this._parent.onErrorObservable.clear(),this.dispose()}))})),k)))})).catch((k=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(k),this._parent.onErrorObservable.clear(),this.dispose()),k}))}_loadData(k){if(this._gltf=k.json,this._setupData(),k.bin){const Q=this._gltf.buffers;if(Q&&Q[0]&&!Q[0].uri){const i=Q[0];(i.byteLength<k.bin.byteLength-3||i.byteLength>k.bin.byteLength)&&z.c.Warn(`Binary buffer length (${i.byteLength}) from JSON does not match chunk length (${k.bin.byteLength})`),this._bin=k.bin}else z.c.Warn("Unexpected BIN chunk")}}_setupData(){if(g.Assign(this._gltf.accessors),g.Assign(this._gltf.animations),g.Assign(this._gltf.buffers),g.Assign(this._gltf.bufferViews),g.Assign(this._gltf.cameras),g.Assign(this._gltf.images),g.Assign(this._gltf.materials),g.Assign(this._gltf.meshes),g.Assign(this._gltf.nodes),g.Assign(this._gltf.samplers),g.Assign(this._gltf.scenes),g.Assign(this._gltf.skins),g.Assign(this._gltf.textures),this._gltf.nodes){const k={};for(const i of this._gltf.nodes)if(i.children)for(const Q of i.children)k[Q]=i.index;const Q=this._createRootNode();for(const i of this._gltf.nodes){const Z=k[i.index];i.parent=void 0===Z?Q:this._gltf.nodes[Z]}}}async _loadExtensionsAsync(){const k=[];if(d.forEach(((Q,i)=>{var Z;!1===(null===(Z=this.parent.extensionOptions[i])||void 0===Z?void 0:Z.enabled)?Q.isGLTFExtension&&this.isExtensionUsed(i)&&z.c.Warn(`Extension ${i} is used but has been explicitly disabled.`):Q.isGLTFExtension&&!this.isExtensionUsed(i)||k.push((async()=>{const k=await Q.factory(this);return k.name!==i&&z.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${k.name} !== ${i}`),this._parent.onExtensionLoadedObservable.notifyObservers(k),k})())})),this._extensions.push(...await Promise.all(k)),this._extensions.sort(((k,Q)=>(k.order||Number.MAX_VALUE)-(Q.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const i of this._gltf.extensionsRequired){if(!this._extensions.some((k=>k.name===i&&k.enabled))){var Q;if(!1===(null===(Q=this.parent.extensionOptions[i])||void 0===Q?void 0:Q.enabled))throw new Error(`Required extension ${i} is disabled`);throw new Error(`Required extension ${i} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new u.d("__root__",this._babylonScene);this._rootBabylonMesh=k,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.do(!1);const Q={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case v.k.AUTO:this._babylonScene.useRightHandedSystem||(Q.rotation=[0,1,0,0],Q.scale=[1,1,-1],w._LoadTransform(Q,this._rootBabylonMesh));break;case v.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(k),Q}loadSceneAsync(k,Q){const i=this._extensionsLoadSceneAsync(k,Q);if(i)return i;const Z=new Array;if(this.logOpen(`${k} ${Q.name||""}`),Q.nodes)for(const U of Q.nodes){const Q=g.Get(`${k}/nodes/${U}`,this._gltf.nodes,U);Z.push(this.loadNodeAsync(`/nodes/${Q.index}`,Q,(k=>{k.parent=this._rootBabylonMesh})))}for(const U of this._postSceneLoadActions)U();return Z.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(Z).then((()=>{}))}_forEachPrimitive(k,Q){if(k._primitiveBabylonMeshes)for(const i of k._primitiveBabylonMeshes)Q(i)}_getGeometries(){const k=[],Q=this._gltf.nodes;if(Q)for(const i of Q)this._forEachPrimitive(i,(Q=>{const i=Q.mo;i&&-1===k.indexOf(i)&&k.push(i)}));return k}_getMeshes(){const k=[];this._rootBabylonMesh instanceof s.d&&k.push(this._rootBabylonMesh);const Q=this._gltf.nodes;if(Q)for(const i of Q)this._forEachPrimitive(i,(Q=>{k.push(Q)}));return k}_getTransformNodes(){const k=[],Q=this._gltf.nodes;if(Q)for(const i of Q)i._babylonTransformNode&&"me"===i._babylonTransformNode.getClassName()&&k.push(i._babylonTransformNode),i._babylonTransformNodeForSkin&&k.push(i._babylonTransformNodeForSkin);return k}_getSkeletons(){const k=[],Q=this._gltf.skins;if(Q)for(const i of Q)i._data&&k.push(i._data.babylonSkeleton);return k}_getAnimationGroups(){const k=[],Q=this._gltf.animations;if(Q)for(const i of Q)i._babylonAnimationGroup&&k.push(i._babylonAnimationGroup);return k}_startAnimations(){switch(this._parent.animationStartMode){case v.h.NONE:break;case v.h.FIRST:{const k=this._getAnimationGroups();0!==k.length&&k[0].start(!0);break}case v.h.ALL:{const k=this._getAnimationGroups();for(const Q of k)Q.start(!0);break}default:return void z.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Z=this._extensionsLoadNodeAsync(k,Q,i);if(Z)return Z;if(Q._babylonTransformNode)throw new Error(`${k}: Invalid recursive node hierarchy`);const U=new Array;this.logOpen(`${k} ${Q.name||""}`);const C=Z=>{if(w.AddPointerMetadata(Z,k),w._LoadTransform(Q,Z),void 0!=Q.camera){const i=g.Get(`${k}/camera`,this._gltf.cameras,Q.camera);U.push(this.loadCameraAsync(`/cameras/${i.index}`,i,(k=>{k.parent=Z,this._babylonScene.useRightHandedSystem||(Z.Ho.x=-1)})))}if(Q.children)for(const i of Q.children){const Q=g.Get(`${k}/children/${i}`,this._gltf.nodes,i);U.push(this.loadNodeAsync(`/nodes/${Q.index}`,Q,(k=>{k.parent=Z})))}i(Z)},B=void 0!=Q.mesh,o=this._parent.loadSkins&&void 0!=Q.skin;if(!B||o){const k=Q.name||`node${Q.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new Y.d(k,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==Q.mesh?Q._babylonTransformNode=i:Q._babylonTransformNodeForSkin=i,C(i)}if(B)if(o){const i=g.Get(`${k}/mesh`,this._gltf.meshes,Q.mesh);U.push(this._loadMeshAsync(`/meshes/${i.index}`,Q,i,(i=>{const Z=Q._babylonTransformNodeForSkin;i.metadata=(0,W.b)(Z.metadata,i.metadata||{});const C=g.Get(`${k}/skin`,this._gltf.skins,Q.skin);U.push(this._loadSkinAsync(`/skins/${C.index}`,Q,C,(k=>{this._forEachPrimitive(Q,(Q=>{Q.skeleton=k})),this._postSceneLoadActions.push((()=>{if(void 0!=C.skeleton){const k=g.Get(`/skins/${C.index}/skeleton`,this._gltf.nodes,C.skeleton).parent;Q.index===k.index?i.parent=Z.parent:i.parent=k._babylonTransformNode}else i.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:Z,skinnedNode:i})}))})))})))}else{const i=g.Get(`${k}/mesh`,this._gltf.meshes,Q.mesh);U.push(this._loadMeshAsync(`/meshes/${i.index}`,Q,i,C))}return this.logClose(),Promise.all(U).then((()=>(this._forEachPrimitive(Q,(k=>{const Q=k;!Q.isAnInstance&&Q.mo&&Q.mo.useBoundingInfoFromGeometry?k.pk():k.refreshBoundingInfo(!0,!0)})),Q._babylonTransformNode)))}_loadMeshAsync(k,Q,i,Z){const U=i.primitives;if(!U||!U.length)throw new Error(`${k}: Primitives are missing`);void 0==U[0].index&&g.Assign(U);const C=new Array;this.logOpen(`${k} ${i.name||""}`);const B=Q.name||`node${Q.index}`;if(1===U.length){const Z=i.primitives[0];C.push(this._loadMeshPrimitiveAsync(`${k}/primitives/${Z.index}`,B,Q,i,Z,(k=>{Q._babylonTransformNode=k,Q._primitiveBabylonMeshes=[k]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,Q._babylonTransformNode=new Y.d(B,this._babylonScene),Q._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q._primitiveBabylonMeshes=[];for(const Z of U)C.push(this._loadMeshPrimitiveAsync(`${k}/primitives/${Z.index}`,`${B}_primitive${Z.index}`,Q,i,Z,(k=>{k.parent=Q._babylonTransformNode,Q._primitiveBabylonMeshes.push(k)})))}return Z(Q._babylonTransformNode),this.logClose(),Promise.all(C).then((()=>Q._babylonTransformNode))}_loadMeshPrimitiveAsync(k,Q,i,Z,U,C){const B=this._extensionsLoadMeshPrimitiveAsync(k,Q,i,Z,U,C);if(B)return B;this.logOpen(`${k}`);const o=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==i.skin&&!Z.primitives[0].targets;let m,O;if(o&&U._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,m=U._instanceData.babylonSourceMesh.createInstance(Q),m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O=U._instanceData.promise;else{const C=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new u.d(Q,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.sideOrientation=this._babylonScene.useRightHandedSystem?h.c.CounterClockWiseSideOrientation:h.c.ClockWiseSideOrientation,this._createMorphTargets(k,i,Z,U,B),C.push(this._loadVertexDataAsync(k,U,B).then((async Q=>await this._loadMorphTargetsAsync(k,U,B,Q).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,Q.Nk(B),Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const J=w._GetDrawMode(k,U.mode);if(void 0==U.material){let k=this._defaultBabylonMaterialData[J];k||(k=this._createDefaultMaterial("__GLTFLoader._default",J),this._parent.onMaterialLoadedObservable.notifyObservers(k),this._defaultBabylonMaterialData[J]=k),B.material=k}else if(!this.parent.skipMaterials){const Q=g.Get(`${k}/material`,this._gltf.materials,U.material);C.push(this._loadMaterialAsync(`/materials/${Q.index}`,Q,B,J,(k=>{B.material=k})))}O=Promise.all(C),o&&(U._instanceData={babylonSourceMesh:B,promise:O}),m=B}return w.AddPointerMetadata(m,k),this._parent.onMeshLoadedObservable.notifyObservers(m),C(m),this.logClose(),O.then((()=>m))}_loadVertexDataAsync(k,Q,i){const Z=this._extensionsLoadVertexDataAsync(k,Q,i);if(Z)return Z;const U=Q.attributes;if(!U)throw new Error(`${k}: Attributes are missing`);const C=new Array,B=new L.e(i.name,this._babylonScene);if(void 0==Q.indices)i.isUnIndexed=!0;else{const i=g.Get(`${k}/indices`,this._gltf.accessors,Q.indices);C.push(this._loadIndicesAccessorAsync(`/accessors/${i.index}`,i).then((k=>{B.setIndices(k)})))}const o=(Q,Z,o)=>{if(void 0==U[Q])return;i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(Z)&&i._delayInfo.push(Z);const m=g.Get(`${k}/attributes/${Q}`,this._gltf.accessors,U[Q]);C.push(this._loadVertexAccessorAsync(`/accessors/${m.index}`,m,Z).then((k=>{if(k.getKind()===y.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!i.skeleton){const k=R(m);k&&(B._boundingInfo=k,B.useBoundingInfoFromGeometry=!0)}B.setVerticesBuffer(k,m.count)}))),Z==y.h.MatricesIndicesExtraKind&&(i.numBoneInfluencers=8),o&&o(m)};return o("POSITION",y.h.PositionKind),o("NORMAL",y.h.NormalKind),o("TANGENT",y.h.TangentKind),o("TEXCOORD_0",y.h.UVKind),o("TEXCOORD_1",y.h.UV2Kind),o("TEXCOORD_2",y.h.UV3Kind),o("TEXCOORD_3",y.h.UV4Kind),o("TEXCOORD_4",y.h.UV5Kind),o("TEXCOORD_5",y.h.UV6Kind),o("JOINTS_0",y.h.MatricesIndicesKind),o("WEIGHTS_0",y.h.MatricesWeightsKind),o("JOINTS_1",y.h.MatricesIndicesExtraKind),o("WEIGHTS_1",y.h.MatricesWeightsExtraKind),o("COLOR_0",y.h.ColorKind,(k=>{"VEC4"===k.type&&(i.hasVertexAlpha=!0)})),Promise.all(C).then((()=>B))}_createMorphTargets(k,Q,i,Z,U){if(!Z.targets||!this._parent.loadMorphTargets)return;if(void 0==Q._numMorphTargets)Q._numMorphTargets=Z.targets.length;else if(Z.targets.length!==Q._numMorphTargets)throw new Error(`${k}: Primitives do not have the same number of targets`);const C=i.extras?i.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,U.morphTargetManager=new K(this._babylonScene),U.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.morphTargetManager.areUpdatesFrozen=!0;for(let B=0;B<Z.targets.length;B++){const k=Q.weights?Q.weights[B]:i.weights?i.weights[B]:0,Z=C?C[B]:`morphTarget${B}`;U.morphTargetManager.addTarget(new a.e(Z,k,U.sk()))}}_loadMorphTargetsAsync(k,Q,i,Z){if(!Q.targets||!this._parent.loadMorphTargets)return Promise.resolve();const U=new Array,C=i.morphTargetManager;for(let B=0;B<C.numTargets;B++){const i=C.getTarget(B);U.push(this._loadMorphTargetVertexDataAsync(`${k}/targets/${B}`,Z,Q.targets[B],i))}return Promise.all(U).then((()=>{C.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(k,Q,i,Z){const U=new Array,C=(Z,C,B)=>{if(void 0==i[Z])return;const o=Q.getVertexBuffer(C);if(!o)return;const m=g.Get(`${k}/${Z}`,this._gltf.accessors,i[Z]);U.push(this._loadFloatAccessorAsync(`/accessors/${m.index}`,m).then((k=>{B(o,k)})))};return C("POSITION",y.h.PositionKind,((k,Q)=>{const i=new Float32Array(Q.length);k.forEach(Q.length,((k,Z)=>{i[Z]=Q[Z]+k})),Z.setPositions(i)})),C("NORMAL",y.h.NormalKind,((k,Q)=>{const i=new Float32Array(Q.length);k.forEach(i.length,((k,Z)=>{i[Z]=Q[Z]+k})),Z.setNormals(i)})),C("TANGENT",y.h.TangentKind,((k,Q)=>{const i=new Float32Array(Q.length/3*4);let U=0;k.forEach(Q.length/3*4,((k,Z)=>{(Z+1)%4!==0&&(i[U]=Q[U]+k,U++)})),Z.setTangents(i)})),C("TEXCOORD_0",y.h.UVKind,((k,Q)=>{const i=new Float32Array(Q.length);k.forEach(Q.length,((k,Z)=>{i[Z]=Q[Z]+k})),Z.setUVs(i)})),C("TEXCOORD_1",y.h.UV2Kind,((k,Q)=>{const i=new Float32Array(Q.length);k.forEach(Q.length,((k,Z)=>{i[Z]=Q[Z]+k})),Z.setUV2s(i)})),C("COLOR_0",y.h.ColorKind,((Q,i)=>{let U=null;const C=Q.getSize();if(3===C){U=new Float32Array(i.length/3*4),Q.forEach(i.length,((k,Q)=>{const Z=Math.floor(Q/3),C=Q%3;U[4*Z+C]=i[3*Z+C]+k}));for(let k=0;k<i.length/3;++k)U[4*k+3]=1}else{if(4!==C)throw new Error(`${k}: Invalid number of components (${C}) for COLOR_0 attribute`);U=new Float32Array(i.length),Q.forEach(i.length,((k,Q)=>{U[Q]=i[Q]+k}))}Z.setColors(U)})),await Promise.all(U).then((()=>{}))}static _LoadTransform(k,Q){if(void 0!=k.skin)return;let i=U.zQ.Zero(),Z=U.Quaternion.Identity(),C=U.zQ.One();if(k.matrix){U.Matrix.fQ(k.matrix).decompose(C,Z,i)}else k.translation&&(i=U.zQ.fQ(k.translation)),k.rotation&&(Z=U.Quaternion.fQ(k.rotation)),k.scale&&(C=U.zQ.fQ(k.scale));Q.position=i,Q.rotationQuaternion=Z,Q.Ho=C}_loadSkinAsync(k,Q,i,Z){if(!this._parent.loadSkins)return Promise.resolve();const U=this._extensionsLoadSkinAsync(k,Q,i);if(U)return U;if(i._data)return Z(i._data.babylonSkeleton),i._data.promise;const C=`skeleton${i.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new l(i.name||C,C,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(k,i,B);const o=this._loadSkinInverseBindMatricesDataAsync(k,i).then((k=>{this._updateBoneMatrices(B,k)}));return i._data={babylonSkeleton:B,promise:o},Z(B),o}_loadBones(k,Q,i){if(void 0==Q.skeleton||this._parent.alwaysComputeSkeletonRootNode){const i=this._findSkeletonRootNode(`${k}/joints`,Q.joints);if(i)if(void 0===Q.skeleton)Q.skeleton=i.index;else{const Z=(k,Q)=>{for(;Q.parent;Q=Q.parent)if(Q.parent===k)return!0;return!1},U=g.Get(`${k}/skeleton`,this._gltf.nodes,Q.skeleton);U===i||Z(U,i)||(z.c.Warn(`${k}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),Q.skeleton=i.index)}else z.c.Warn(`${k}: Failed to find common root`)}const Z={};for(const U of Q.joints){const C=g.Get(`${k}/joints/${U}`,this._gltf.nodes,U);this._loadBone(C,Q,i,Z)}}_findSkeletonRootNode(k,Q){if(0===Q.length)return null;const i={};for(const U of Q){const Q=[];let Z=g.Get(`${k}/${U}`,this._gltf.nodes,U);for(;-1!==Z.index;)Q.unshift(Z),Z=Z.parent;i[U]=Q}let Z=null;for(let U=0;;++U){let k=i[Q[0]];if(U>=k.length)return Z;const C=k[U];for(let B=1;B<Q.length;++B)if(k=i[Q[B]],U>=k.length||C!==k[U])return Z;Z=C}}_loadBone(k,Q,i,Z){k._isJoint=!0;let U=Z[k.index];if(U)return U;let C=null;k.index!==Q.skeleton&&(k.parent&&-1!==k.parent.index?C=this._loadBone(k.parent,Q,i,Z):void 0!==Q.skeleton&&z.c.Warn(`/skins/${Q.index}/skeleton: Skeleton node is not a common root`));const B=Q.joints.indexOf(k.index);return U=new O.c(k.name||`joint${k.index}`,i,C,this._getNodeMatrix(k),null,null,B),Z[k.index]=U,this._postSceneLoadActions.push((()=>{U.linkTransformNode(k._babylonTransformNode)})),U}_loadSkinInverseBindMatricesDataAsync(k,Q){if(void 0==Q.inverseBindMatrices)return Promise.resolve(null);const i=g.Get(`${k}/inverseBindMatrices`,this._gltf.accessors,Q.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${i.index}`,i)}_updateBoneMatrices(k,Q){for(const i of k.bones){const k=U.Matrix.Identity(),Z=i._index;Q&&-1!==Z&&(U.Matrix.FromArrayToRef(Q,16*Z,k),k.invertToRef(k));const C=i.getParent();C&&k.multiplyToRef(C.getAbsoluteInverseBindMatrix(),k),i.Bo(k,!1,!1),i._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(k){return k.matrix?U.Matrix.fQ(k.matrix):U.Matrix.Compose(k.scale?U.zQ.fQ(k.scale):U.zQ.One(),k.rotation?U.Quaternion.fQ(k.rotation):U.Quaternion.Identity(),k.translation?U.zQ.fQ(k.translation):U.zQ.Zero())}loadCameraAsync(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Z=this._extensionsLoadCameraAsync(k,Q,i);if(Z)return Z;const C=new Array;this.logOpen(`${k} ${Q.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new m.e(Q.name||`camera${Q.index}`,U.zQ.Zero(),this._babylonScene,!1);switch(B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q._babylonCamera=B,B.setTarget(new U.zQ(0,0,-1)),Q.type){case"perspective":{const i=Q.perspective;if(!i)throw new Error(`${k}: Camera perspective properties are missing`);B.fov=i.yfov,B.Co=i.znear,B.maxZ=i.zfar||0;break}case"orthographic":if(!Q.orthographic)throw new Error(`${k}: Camera orthographic properties are missing`);B.mode=o.e.ORTHOGRAPHIC_CAMERA,B.orthoLeft=-Q.orthographic.xmag,B.orthoRight=Q.orthographic.xmag,B.orthoBottom=-Q.orthographic.ymag,B.orthoTop=Q.orthographic.ymag,B.Co=Q.orthographic.znear,B.maxZ=Q.orthographic.zfar;break;default:throw new Error(`${k}: Invalid camera type (${Q.type})`)}return w.AddPointerMetadata(B,k),this._parent.onCameraLoadedObservable.notifyObservers(B),i(B),this.logClose(),Promise.all(C).then((()=>B))}_loadAnimationsAsync(){const k=this._gltf.animations;if(!k)return Promise.resolve();const Q=new Array;for(let i=0;i<k.length;i++){const Z=k[i];Q.push(this.loadAnimationAsync(`/animations/${Z.index}`,Z).then((k=>{0===k.targetedAnimations.length&&k.dispose()})))}return Promise.all(Q).then((()=>{}))}loadAnimationAsync(k,Q){const Z=this._extensionsLoadAnimationAsync(k,Q);return Z||i.e(78).then(i.bind(i,14479)).then((i=>{let{AnimationGroup:Z}=i;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new Z(Q.name||`animation${Q.index}`,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q._babylonAnimationGroup=U;const C=new Array;g.Assign(Q.channels),g.Assign(Q.samplers);for(const B of Q.channels)C.push(this._loadAnimationChannelAsync(`${k}/channels/${B.index}`,k,Q,B,((k,Q)=>{k.animations=k.animations||[],k.animations.push(Q),U.addTargetedAnimation(Q,k)})));return Promise.all(C).then((()=>(U.normalize(0),U)))}))}async _loadAnimationChannelAsync(k,Q,Z,U,C){const B=this._extensionsLoadAnimationChannelAsync(k,Q,Z,U,C);if(B)return await B;if(void 0==U.target.node)return await Promise.resolve();const o=g.Get(`${k}/target/node`,this._gltf.nodes,U.target.node),m=U.target.path,O="weights"===m;if(O&&!o._numMorphTargets||!O&&!o._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!O&&!o._isJoint)return await Promise.resolve();let J;switch(await Promise.resolve().then(i.bind(i,13014)),m){case"translation":var G;J=null===(G=(0,M.i)("/nodes/{}/translation"))||void 0===G?void 0:G.interpolation;break;case"rotation":var H;J=null===(H=(0,M.i)("/nodes/{}/rotation"))||void 0===H?void 0:H.interpolation;break;case"scale":var e;J=null===(e=(0,M.i)("/nodes/{}/scale"))||void 0===e?void 0:e.interpolation;break;case"weights":var F;J=null===(F=(0,M.i)("/nodes/{}/weights"))||void 0===F?void 0:F.interpolation;break;default:throw new Error(`${k}/target/path: Invalid value (${U.target.path})`)}if(!J)throw new Error(`${k}/target/path: Could not find interpolation properties for target path (${U.target.path})`);const z={object:o,info:J};return await this._loadAnimationChannelFromTargetInfoAsync(k,Q,Z,U,z,C)}_loadAnimationChannelFromTargetInfoAsync(k,Q,i,Z,U,C){const B=this.parent.targetFps,o=1/B,m=g.Get(`${k}/sampler`,i.samplers,Z.sampler);return this._loadAnimationSamplerAsync(`${Q}/samplers/${Z.sampler}`,m).then((k=>{let Q=0;const m=U.object,O=U.info;for(const U of O){const O=U.getStride(m),J=k.input,G=k.output,H=new Array(J.length);let e=0;switch(k.interpolation){case"STEP":for(let k=0;k<J.length;k++){const Q=U.getValue(m,G,e,1);e+=O,H[k]={frame:J[k]*B,value:Q,interpolation:1}}break;case"CUBICSPLINE":for(let k=0;k<J.length;k++){const Q=U.getValue(m,G,e,o);e+=O;const i=U.getValue(m,G,e,1);e+=O;const Z=U.getValue(m,G,e,o);e+=O,H[k]={frame:J[k]*B,inTangent:Q,value:i,outTangent:Z}}break;case"LINEAR":for(let k=0;k<J.length;k++){const Q=U.getValue(m,G,e,1);e+=O,H[k]={frame:J[k]*B,value:Q}}}if(e>0){const k=`${i.name||`animation${i.index}`}_channel${Z.index}_${Q}`,o=U.buildAnimations(m,k,B,H);for(const i of o)Q++,C(i.babylonAnimatable,i.babylonAnimation)}}}))}_loadAnimationSamplerAsync(k,Q){if(Q._data)return Q._data;const i=Q.interpolation||"LINEAR";switch(i){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${k}/interpolation: Invalid value (${Q.interpolation})`)}const Z=g.Get(`${k}/input`,this._gltf.accessors,Q.input),U=g.Get(`${k}/output`,this._gltf.accessors,Q.output);return Q._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${Z.index}`,Z),this._loadFloatAccessorAsync(`/accessors/${U.index}`,U)]).then((k=>{let[Q,Z]=k;return{input:Q,interpolation:i,output:Z}})),Q._data}loadBufferAsync(k,Q,i,Z){const U=this._extensionsLoadBufferAsync(k,Q,i,Z);if(U)return U;if(!Q._data)if(Q.uri)Q._data=this.loadUriAsync(`${k}/uri`,Q,Q.uri);else{if(!this._bin)throw new Error(`${k}: Uri is missing or the binary glTF is missing its binary chunk`);Q._data=this._bin.readAsync(0,Q.byteLength)}return Q._data.then((Q=>{try{return new Uint8Array(Q.buffer,Q.byteOffset+i,Z)}catch(U){throw new Error(`${k}: ${U.message}`)}}))}loadBufferViewAsync(k,Q){const i=this._extensionsLoadBufferViewAsync(k,Q);if(i)return i;if(Q._data)return Q._data;const Z=g.Get(`${k}/buffer`,this._gltf.buffers,Q.buffer);return Q._data=this.loadBufferAsync(`/buffers/${Z.index}`,Z,Q.byteOffset||0,Q.byteLength),Q._data}_loadAccessorAsync(k,Q,i){if(Q._data)return Q._data;const Z=w._GetNumComponents(k,Q.type),U=Z*y.h.GetTypeByteLength(Q.componentType),C=Z*Q.count;if(void 0==Q.bufferView)Q._data=Promise.resolve(new i(C));else{const B=g.Get(`${k}/bufferView`,this._gltf.bufferViews,Q.bufferView);Q._data=this.loadBufferViewAsync(`/bufferViews/${B.index}`,B).then((o=>{if(5126!==Q.componentType||Q.normalized||B.byteStride&&B.byteStride!==U){const k=new i(C);return y.h.ForEach(o,Q.byteOffset||0,B.byteStride||U,Z,Q.componentType,k.length,Q.normalized||!1,((Q,i)=>{k[i]=Q})),k}return w._GetTypedArray(k,Q.componentType,o,Q.byteOffset,C)}))}if(Q.sparse){const C=Q.sparse;Q._data=Q._data.then((B=>{const o=B,m=g.Get(`${k}/sparse/indices/bufferView`,this._gltf.bufferViews,C.indices.bufferView),O=g.Get(`${k}/sparse/values/bufferView`,this._gltf.bufferViews,C.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${m.index}`,m),this.loadBufferViewAsync(`/bufferViews/${O.index}`,O)]).then((B=>{let[m,O]=B;const J=w._GetTypedArray(`${k}/sparse/indices`,C.indices.componentType,m,C.indices.byteOffset,C.count),G=Z*C.count;let H;if(5126!==Q.componentType||Q.normalized){const B=w._GetTypedArray(`${k}/sparse/values`,Q.componentType,O,C.values.byteOffset,G);H=new i(G),y.h.ForEach(B,0,U,Z,Q.componentType,H.length,Q.normalized||!1,((k,Q)=>{H[Q]=k}))}else H=w._GetTypedArray(`${k}/sparse/values`,Q.componentType,O,C.values.byteOffset,G);let e=0;for(let k=0;k<J.length;k++){let Q=J[k]*Z;for(let k=0;k<Z;k++)o[Q++]=H[e++]}return o}))}))}return Q._data}_loadFloatAccessorAsync(k,Q){return this._loadAccessorAsync(k,Q,Float32Array)}_loadIndicesAccessorAsync(k,Q){if("SCALAR"!==Q.type)throw new Error(`${k}/type: Invalid value ${Q.type}`);if(5121!==Q.componentType&&5123!==Q.componentType&&5125!==Q.componentType)throw new Error(`${k}/componentType: Invalid value ${Q.componentType}`);if(Q._data)return Q._data;if(Q.sparse){const i=w._GetTypedArrayConstructor(`${k}/componentType`,Q.componentType);Q._data=this._loadAccessorAsync(k,Q,i)}else{const i=g.Get(`${k}/bufferView`,this._gltf.bufferViews,Q.bufferView);Q._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i).then((i=>w._GetTypedArray(k,Q.componentType,i,Q.byteOffset,Q.count)))}return Q._data}_loadVertexBufferViewAsync(k){if(k._babylonBuffer)return k._babylonBuffer;const Q=this._babylonScene.getEngine();return k._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${k.index}`,k).then((k=>new y.d(Q,k,!1))),k._babylonBuffer}_loadVertexAccessorAsync(k,Q,i){var Z;if(null!==(Z=Q._babylonVertexBuffer)&&void 0!==Z&&Z[i])return Q._babylonVertexBuffer[i];Q._babylonVertexBuffer||(Q._babylonVertexBuffer={});const U=this._babylonScene.getEngine();if(Q.sparse||void 0==Q.bufferView)Q._babylonVertexBuffer[i]=this._loadFloatAccessorAsync(k,Q).then((k=>new y.h(U,k,i,!1)));else{const Z=g.Get(`${k}/bufferView`,this._gltf.bufferViews,Q.bufferView);Q._babylonVertexBuffer[i]=this._loadVertexBufferViewAsync(Z).then((C=>{const B=w._GetNumComponents(k,Q.type);return new y.h(U,C,i,!1,void 0,Z.byteStride,void 0,Q.byteOffset,B,Q.componentType,Q.normalized,!0,void 0,!0)}))}return Q._babylonVertexBuffer[i]}_loadMaterialMetallicRoughnessPropertiesAsync(k,Q,i){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);const Z=new Array;return Q&&(Q.baseColorFactor?(i.albedoColor=C.cQ.fQ(Q.baseColorFactor),i.alpha=Q.baseColorFactor[3]):i.albedoColor=C.cQ.White(),i.metallic=void 0==Q.metallicFactor?1:Q.metallicFactor,i.roughness=void 0==Q.roughnessFactor?1:Q.roughnessFactor,Q.baseColorTexture&&Z.push(this.loadTextureInfoAsync(`${k}/baseColorTexture`,Q.baseColorTexture,(k=>{k.name=`${i.name} (Base Color)`,i.albedoTexture=k}))),Q.metallicRoughnessTexture&&(Q.metallicRoughnessTexture.nonColorData=!0,Z.push(this.loadTextureInfoAsync(`${k}/metallicRoughnessTexture`,Q.metallicRoughnessTexture,(k=>{k.name=`${i.name} (Metallic Roughness)`,i.metallicTexture=k}))),i.useMetallnessFromMetallicTextureBlue=!0,i.useRoughnessFromMetallicTextureGreen=!0,i.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(Z).then((()=>{}))}_loadMaterialAsync(k,Q,i,Z){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const C=this._extensionsLoadMaterialAsync(k,Q,i,Z,U);if(C)return C;Q._data=Q._data||{};let B=Q._data[Z];if(!B){this.logOpen(`${k} ${Q.name||""}`);const i=this.createMaterial(k,Q,Z);B={babylonMaterial:i,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(k,Q,i)},Q._data[Z]=B,w.AddPointerMetadata(i,k),this._parent.onMaterialLoadedObservable.notifyObservers(i),this.logClose()}return i&&(B.babylonMeshes.push(i),i.gi.addOnce((()=>{const k=B.babylonMeshes.indexOf(i);-1!==k&&B.babylonMeshes.splice(k,1)}))),U(B.babylonMaterial),B.promise.then((()=>B.babylonMaterial))}_createDefaultMaterial(k,Q){this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new c.c(k,this._babylonScene);return i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.fillMode=Q,i.enableSpecularAntiAliasing=!0,i.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,i.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,i.transparencyMode=c.c.PBRMATERIAL_OPAQUE,i.metallic=1,i.roughness=1,i}createMaterial(k,Q,i){const Z=this._extensionsCreateMaterial(k,Q,i);if(Z)return Z;const U=Q.name||`material${Q.index}`;return this._createDefaultMaterial(U,i)}loadMaterialPropertiesAsync(k,Q,i){const Z=this._extensionsLoadMaterialPropertiesAsync(k,Q,i);if(Z)return Z;const U=new Array;return U.push(this.loadMaterialBasePropertiesAsync(k,Q,i)),Q.pbrMetallicRoughness&&U.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${k}/pbrMetallicRoughness`,Q.pbrMetallicRoughness,i)),this.loadMaterialAlphaProperties(k,Q,i),Promise.all(U).then((()=>{}))}loadMaterialBasePropertiesAsync(k,Q,i){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);const Z=new Array;return i.emissiveColor=Q.emissiveFactor?C.cQ.fQ(Q.emissiveFactor):new C.cQ(0,0,0),Q.doubleSided&&(i.Jo=!1,i.twoSidedLighting=!0),Q.normalTexture&&(Q.normalTexture.nonColorData=!0,Z.push(this.loadTextureInfoAsync(`${k}/normalTexture`,Q.normalTexture,(k=>{k.name=`${i.name} (Normal)`,i.bumpTexture=k}))),i.invertNormalMapX=!this._babylonScene.useRightHandedSystem,i.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=Q.normalTexture.scale&&i.bumpTexture&&(i.bumpTexture.level=Q.normalTexture.scale),i.forceIrradianceInFragment=!0),Q.occlusionTexture&&(Q.occlusionTexture.nonColorData=!0,Z.push(this.loadTextureInfoAsync(`${k}/occlusionTexture`,Q.occlusionTexture,(k=>{k.name=`${i.name} (Occlusion)`,i.ambientTexture=k}))),i.useAmbientInGrayScale=!0,void 0!=Q.occlusionTexture.strength&&(i.ambientTextureStrength=Q.occlusionTexture.strength)),Q.emissiveTexture&&Z.push(this.loadTextureInfoAsync(`${k}/emissiveTexture`,Q.emissiveTexture,(k=>{k.name=`${i.name} (Emissive)`,i.emissiveTexture=k}))),Promise.all(Z).then((()=>{}))}loadMaterialAlphaProperties(k,Q,i){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);switch(Q.alphaMode||"OPAQUE"){case"OPAQUE":i.transparencyMode=c.c.PBRMATERIAL_OPAQUE,i.alpha=1;break;case"MASK":i.transparencyMode=c.c.PBRMATERIAL_ALPHATEST,i.alphaCutOff=void 0==Q.alphaCutoff?.5:Q.alphaCutoff,i.albedoTexture&&(i.albedoTexture.Uo=!0);break;case"BLEND":i.transparencyMode=c.c.PBRMATERIAL_ALPHABLEND,i.albedoTexture&&(i.albedoTexture.Uo=!0,i.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${k}/alphaMode: Invalid value (${Q.alphaMode})`)}}loadTextureInfoAsync(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Z=this._extensionsLoadTextureInfoAsync(k,Q,i);if(Z)return Z;if(this.logOpen(`${k}`),Q.texCoord>=6)throw new Error(`${k}/texCoord: Invalid value (${Q.texCoord})`);const U=g.Get(`${k}/index`,this._gltf.textures,Q.index);U._textureInfo=Q;const C=this._loadTextureAsync(`/textures/${Q.index}`,U,(Z=>{Z.coordinatesIndex=Q.texCoord||0,w.AddPointerMetadata(Z,k),this._parent.onTextureLoadedObservable.notifyObservers(Z),i(Z)}));return this.logClose(),C}_loadTextureAsync(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Z=this._extensionsLoadTextureAsync(k,Q,i);if(Z)return Z;this.logOpen(`${k} ${Q.name||""}`);const U=void 0==Q.sampler?w.DefaultSampler:g.Get(`${k}/sampler`,this._gltf.samplers,Q.sampler),C=g.Get(`${k}/source`,this._gltf.images,Q.source),B=this._createTextureAsync(k,U,C,i,void 0,!Q._textureInfo.nonColorData);return this.logClose(),B}_createTextureAsync(k,Q,i){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},C=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0;const o=this._loadSampler(`/samplers/${Q.index}`,Q),m=new Array,O=new Z;this._babylonScene._blockEntityCollection=!!this._assetContainer;const J={noMipmap:o.noMipMaps,invertY:!1,samplingMode:o.samplingMode,t:()=>{this._disposed||O.resolve()},onError:(Q,i)=>{this._disposed||O.reject(new Error(`${k}: ${i&&i.message?i.message:Q||"Failed to load texture"}`))},mimeType:i.mimeType??(0,N.j)(i.uri??""),loaderOptions:C,useSRGBBuffer:!!B&&this._parent.useSRGBBuffers},G=new f.c(null,this._babylonScene,J);return G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,m.push(O.promise),m.push(this.loadImageAsync(`/images/${i.index}`,i).then((k=>{const Q=i.uri||`${this._fileName}#image${i.index}`,Z=`data:${this._uniqueRootUrl}${Q}`;G.updateURL(Z,k);const U=G.getInternalTexture();U&&(U.label=i.name)}))),G.wrapU=o.wrapU,G.wrapV=o.wrapV,U(G),this._parent.useGltfTextureNames&&(G.name=i.name||i.uri||`image${i.index}`),Promise.all(m).then((()=>G))}_loadSampler(k,Q){return Q._data||(Q._data={noMipMaps:9728===Q.minFilter||9729===Q.minFilter,samplingMode:w._GetTextureSamplingMode(k,Q),wrapU:w._GetTextureWrapMode(`${k}/wrapS`,Q.wrapS),wrapV:w._GetTextureWrapMode(`${k}/wrapT`,Q.wrapT)}),Q._data}loadImageAsync(k,Q){if(!Q._data){if(this.logOpen(`${k} ${Q.name||""}`),Q.uri)Q._data=this.loadUriAsync(`${k}/uri`,Q,Q.uri);else{const i=g.Get(`${k}/bufferView`,this._gltf.bufferViews,Q.bufferView);Q._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i)}this.logClose()}return Q._data}loadUriAsync(k,Q,i){const Z=this._extensionsLoadUriAsync(k,Q,i);if(Z)return Z;if(!w._ValidateUri(i))throw new Error(`${k}: '${i}' is invalid`);if((0,N.l)(i)){const Q=new Uint8Array((0,N.c)(i));return this.log(`${k}: Decoded ${i.substring(0,64)}... (${Q.length} bytes)`),Promise.resolve(Q)}return this.log(`${k}: Loading ${i}`),this._parent.preprocessUrlAsync(this._rootUrl+i).then((Q=>new Promise(((Z,U)=>{this._parent._loadFile(this._babylonScene,Q,(Q=>{this._disposed||(this.log(`${k}: Loaded ${i} (${Q.byteLength} bytes)`),Z(new Uint8Array(Q)))}),!0,(Q=>{U(new N.n(`${k}: Failed to load '${i}'${Q?": "+Q.status+" "+Q.statusText:""}`,Q))}))}))))}static AddPointerMetadata(k,Q){k.metadata=k.metadata||{};const i=k._internalMetadata=k._internalMetadata||{},Z=i.XC=i.XC||{};(Z.pointers=Z.pointers||[]).push(Q)}static _GetTextureWrapMode(k,Q){switch(Q=void 0==Q?10497:Q){case 33071:return f.c.CLAMP_ADDRESSMODE;case 33648:return f.c.MIRROR_ADDRESSMODE;case 10497:return f.c.WRAP_ADDRESSMODE;default:return z.c.Warn(`${k}: Invalid value (${Q})`),f.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(k,Q){const i=void 0==Q.magFilter?9729:Q.magFilter,Z=void 0==Q.minFilter?9987:Q.minFilter;if(9729===i)switch(Z){case 9728:return f.c.LINEAR_NEAREST;case 9729:return f.c.LINEAR_LINEAR;case 9984:return f.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return f.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return f.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return f.c.LINEAR_LINEAR_MIPLINEAR;default:return z.c.Warn(`${k}/minFilter: Invalid value (${Z})`),f.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==i&&z.c.Warn(`${k}/magFilter: Invalid value (${i})`),Z){case 9728:return f.c.NEAREST_NEAREST;case 9729:return f.c.NEAREST_LINEAR;case 9984:return f.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return f.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return f.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return f.c.NEAREST_LINEAR_MIPLINEAR;default:return z.c.Warn(`${k}/minFilter: Invalid value (${Z})`),f.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(k,Q){try{return(0,A.t)(Q)}catch(i){throw new Error(`${k}: ${i.message}`)}}static _GetTypedArray(k,Q,i,Z,U){const C=i.buffer;Z=i.byteOffset+(Z||0);const B=w._GetTypedArrayConstructor(`${k}/componentType`,Q),o=y.h.GetTypeByteLength(Q);return Z%o!==0?(z.c.Warn(`${k}: Copying buffer as byte offset (${Z}) is not a multiple of component type byte length (${o})`),new B(C.slice(Z,Z+U*o),0)):new B(C,Z,U)}static _GetNumComponents(k,Q){switch(Q){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${k}: Invalid type (${Q})`)}static _ValidateUri(k){return B.Tools.IsBase64(k)||-1===k.indexOf("..")}static _GetDrawMode(k,Q){switch(void 0==Q&&(Q=4),Q){case 0:return h.c.PointListDrawMode;case 1:return h.c.LineListDrawMode;case 2:return h.c.LineLoopDrawMode;case 3:return h.c.LineStripDrawMode;case 4:return h.c.TriangleFillMode;case 5:return h.c.TriangleStripDrawMode;case 6:return h.c.TriangleFanDrawMode}throw new Error(`${k}: Invalid mesh primitive mode (${Q})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const k=new Array;if(this._gltf.materials)for(const Q of this._gltf.materials)if(Q._data)for(const i in Q._data){const Z=Q._data[i];for(const Q of Z.babylonMeshes){Q.oo(!0);const i=Z.babylonMaterial;k.push(i.forceCompilationAsync(Q)),k.push(i.forceCompilationAsync(Q,{useInstances:!0})),this._parent.useClipPlane&&(k.push(i.forceCompilationAsync(Q,{clipPlane:!0})),k.push(i.forceCompilationAsync(Q,{clipPlane:!0,useInstances:!0})))}}return Promise.all(k).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const k=new Array,Q=this._babylonScene.lights;for(const i of Q){const Q=i.getShadowGenerator();Q&&k.push(Q.forceCompilationAsync())}return Promise.all(k).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(k){for(const Q of this._extensions)Q.enabled&&k(Q)}_applyExtensions(k,Q,i){for(const Z of this._extensions)if(Z.enabled){const U=`${Z.name}.${Q}`,C=k;C._activeLoaderExtensionFunctions=C._activeLoaderExtensionFunctions||{};const B=C._activeLoaderExtensionFunctions;if(!B[U]){B[U]=!0;try{const k=i(Z);if(k)return k}finally{delete B[U]}}}return null}_extensionsOnLoading(){this._forEachExtensions((k=>k.onLoading&&k.onLoading()))}_extensionsOnReady(){this._forEachExtensions((k=>k.onReady&&k.onReady()))}_extensionsLoadSceneAsync(k,Q){return this._applyExtensions(Q,"loadScene",(i=>i.loadSceneAsync&&i.loadSceneAsync(k,Q)))}_extensionsLoadNodeAsync(k,Q,i){return this._applyExtensions(Q,"loadNode",(Z=>Z.loadNodeAsync&&Z.loadNodeAsync(k,Q,i)))}_extensionsLoadCameraAsync(k,Q,i){return this._applyExtensions(Q,"loadCamera",(Z=>Z.loadCameraAsync&&Z.loadCameraAsync(k,Q,i)))}_extensionsLoadVertexDataAsync(k,Q,i){return this._applyExtensions(Q,"loadVertexData",(Z=>Z._loadVertexDataAsync&&Z._loadVertexDataAsync(k,Q,i)))}_extensionsLoadMeshPrimitiveAsync(k,Q,i,Z,U,C){return this._applyExtensions(U,"loadMeshPrimitive",(B=>B._loadMeshPrimitiveAsync&&B._loadMeshPrimitiveAsync(k,Q,i,Z,U,C)))}_extensionsLoadMaterialAsync(k,Q,i,Z,U){return this._applyExtensions(Q,"loadMaterial",(C=>C._loadMaterialAsync&&C._loadMaterialAsync(k,Q,i,Z,U)))}_extensionsCreateMaterial(k,Q,i){return this._applyExtensions(Q,"createMaterial",(Z=>Z.createMaterial&&Z.createMaterial(k,Q,i)))}_extensionsLoadMaterialPropertiesAsync(k,Q,i){return this._applyExtensions(Q,"loadMaterialProperties",(Z=>Z.loadMaterialPropertiesAsync&&Z.loadMaterialPropertiesAsync(k,Q,i)))}_extensionsLoadTextureInfoAsync(k,Q,i){return this._applyExtensions(Q,"loadTextureInfo",(Z=>Z.loadTextureInfoAsync&&Z.loadTextureInfoAsync(k,Q,i)))}_extensionsLoadTextureAsync(k,Q,i){return this._applyExtensions(Q,"loadTexture",(Z=>Z._loadTextureAsync&&Z._loadTextureAsync(k,Q,i)))}_extensionsLoadAnimationAsync(k,Q){return this._applyExtensions(Q,"loadAnimation",(i=>i.loadAnimationAsync&&i.loadAnimationAsync(k,Q)))}_extensionsLoadAnimationChannelAsync(k,Q,i,Z,U){return this._applyExtensions(i,"loadAnimationChannel",(C=>C._loadAnimationChannelAsync&&C._loadAnimationChannelAsync(k,Q,i,Z,U)))}_extensionsLoadSkinAsync(k,Q,i){return this._applyExtensions(i,"loadSkin",(Z=>Z._loadSkinAsync&&Z._loadSkinAsync(k,Q,i)))}_extensionsLoadUriAsync(k,Q,i){return this._applyExtensions(Q,"loadUri",(Z=>Z._loadUriAsync&&Z._loadUriAsync(k,Q,i)))}_extensionsLoadBufferViewAsync(k,Q){return this._applyExtensions(Q,"loadBufferView",(i=>i.loadBufferViewAsync&&i.loadBufferViewAsync(k,Q)))}_extensionsLoadBufferAsync(k,Q,i,Z){return this._applyExtensions(Q,"loadBuffer",(U=>U.loadBufferAsync&&U.loadBufferAsync(k,Q,i,Z)))}static LoadExtensionAsync(k,Q,i,Z){if(!Q.extensions)return null;const U=Q.extensions[i];return U?Z(`${k}/extensions/${i}`,U):null}static LoadExtraAsync(k,Q,i,Z){if(!Q.extras)return null;const U=Q.extras[i];return U?Z(`${k}/extras/${i}`,U):null}isExtensionUsed(k){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(k)}logOpen(k){this._parent._logOpen(k)}logClose(){this._parent._logClose()}log(k){this._parent._log(k)}startPerformanceCounter(k){this._parent._startPerformanceCounter(k)}endPerformanceCounter(k){this._parent._endPerformanceCounter(k)}}w.DefaultSampler={index:-1},v.e._CreateGLTF2Loader=k=>new w(k);var S=i(13014),q=i(11481),P=i(11334),t=i(13016),I=i(13022);class r extends I.c{constructor(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",k),this._texture=k.getEngine().createRawCubeTexture(Q,i,Z,U,C,B,o,m)}update(k,Q,i,Z){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,k,Q,i,Z,U)}updateRGBDAsync(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,t.k)(this._texture,k,Q,i,Z).then((()=>{}))}clone(){return P.d.Clone((()=>{const k=this.sk(),Q=this._texture,i=new r(k,Q._bufferViewArray,Q.width,Q.format,Q.type,Q.generateMipMaps,Q.invertY,Q.samplingMode,Q._compression);return 13===Q.source&&i.updateRGBDAsync(Q._bufferViewArrayArray,Q._sphericalPolynomial,Q._lodGenerationScale,Q._lodGenerationOffset),i}),this)}}const n="EXT_lights_image_based";class x{constructor(k){this.name=n,this._loader=k,this.enabled=this._loader.isExtensionUsed(n)}dispose(){this._loader=null,delete this._lights}onLoading(){const k=this._loader.XC.extensions;if(k&&k[this.name]){const Q=k[this.name];this._lights=Q.lights}}loadSceneAsync(k,Q){return w.LoadExtensionAsync(k,Q,this.name,(async(i,Z)=>{this._loader._allMaterialsDirtyRequired=!0;const U=new Array;U.push(this._loader.loadSceneAsync(k,Q)),this._loader.logOpen(`${i}`);const C=g.Get(`${i}/light`,this._lights,Z.ui);return U.push(this._loadLightAsync(`/extensions/${this.name}/lights/${Z.ui}`,C).then((k=>{this._loader.babylonScene.environmentTexture=k}))),this._loader.logClose(),await Promise.all(U).then((()=>{}))}))}_loadLightAsync(k,Q){if(!Q._loaded){const i=new Array;this._loader.logOpen(`${k}`);const Z=new Array(Q.specularImages.length);for(let U=0;U<Q.specularImages.length;U++){const C=Q.specularImages[U];Z[U]=new Array(C.length);for(let Q=0;Q<C.length;Q++){const B=`${k}/specularImages/${U}/${Q}`;this._loader.logOpen(`${B}`);const o=C[Q],m=g.Get(B,this._loader.XC.images,o);i.push(this._loader.loadImageAsync(`/images/${o}`,m).then((k=>{Z[U][Q]=k}))),this._loader.logClose()}}this._loader.logClose(),Q._loaded=Promise.all(i).then((async()=>{const i=new r(this._loader.babylonScene,null,Q.specularImageSize);if(i.name=Q.name||"environment",Q._babylonTexture=i,void 0!=Q.lo&&(i.level=Q.lo),Q.rotation){let k=U.Quaternion.fQ(Q.rotation);this._loader.babylonScene.useRightHandedSystem||(k=U.Quaternion.Inverse(k)),U.Matrix.FromQuaternionToRef(k,i.getReflectionTextureMatrix())}if(!Q.irradianceCoefficients)throw new Error(`${k}: Irradiance coefficients are missing`);const C=q.d.fQ(Q.irradianceCoefficients);C.scaleInPlace(Q.lo),C.convertIrradianceToLambertianRadiance();const B=q.h.FromHarmonics(C),o=(Z.length-1)/Math.log2(Q.specularImageSize);return await i.updateRGBDAsync(Z,B,o)}))}return Q._loaded.then((()=>Q._babylonTexture))}}D(n),b(n,!0,(k=>new x(k)));i(11852);const V="EXT_mesh_gpu_instancing";class kk{constructor(k){this.name=V,this._loader=k,this.enabled=this._loader.isExtensionUsed(V)}dispose(){this._loader=null}loadNodeAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(k,Z)=>{this._loader._disableInstancedMesh++;const C=this._loader.loadNodeAsync(`/nodes/${Q.index}`,Q,i);if(this._loader._disableInstancedMesh--,!Q._primitiveBabylonMeshes)return await C;const B=new Array;let o=0;const m=Q=>{if(void 0==Z.attributes[Q])return void B.push(Promise.resolve(null));const i=g.Get(`${k}/attributes/${Q}`,this._loader.XC.accessors,Z.attributes[Q]);if(B.push(this._loader._loadFloatAccessorAsync(`/accessors/${i.bufferView}`,i)),0===o)o=i.count;else if(o!==i.count)throw new Error(`${k}/attributes: Instance buffer accessors do not have the same count.`)};return m("TRANSLATION"),m("ROTATION"),m("SCALE"),await C.then((async k=>{const[i,Z,C]=await Promise.all(B),m=new Float32Array(16*o);U.TmpVectors.zQ[0].Go(0,0,0),U.TmpVectors.Quaternion[0].Go(0,0,0,1),U.TmpVectors.zQ[1].Go(1,1,1);for(let Q=0;Q<o;++Q)i&&U.zQ.FromArrayToRef(i,3*Q,U.TmpVectors.zQ[0]),Z&&U.Quaternion.FromArrayToRef(Z,4*Q,U.TmpVectors.Quaternion[0]),C&&U.zQ.FromArrayToRef(C,3*Q,U.TmpVectors.zQ[1]),U.Matrix.ComposeToRef(U.TmpVectors.zQ[1],U.TmpVectors.Quaternion[0],U.TmpVectors.zQ[0],U.TmpVectors.Matrix[0]),U.TmpVectors.Matrix[0].copyToArray(m,16*Q);for(const U of Q._primitiveBabylonMeshes)U.JG("matrix",m,16,!0);return k}))}))}}D(V),b(V,!0,(k=>new kk(k)));let Qk=0,ik=null;class Zk{static get Default(){return Zk._Default||(Zk._Default=new Zk),Zk._Default}constructor(){const k=Zk.Configuration.decoder;this._decoderModulePromise=B.Tools.LoadBabylonScriptAsync(k.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(k,Q,i,Z,U){await this._decoderModulePromise,0===Qk&&(MeshoptDecoder.useWorkers(1),Qk=1);const C=await MeshoptDecoder.decodeGltfBufferAsync(Q,i,k,Z,U);return null!==ik&&clearTimeout(ik),ik=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Qk=0,ik=null}),1e3),C}}Zk.Configuration={decoder:{url:`${B.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Zk._Default=null;const Uk="EXT_meshopt_compression";class Ck{constructor(k){this.name=Uk,this.enabled=k.isExtensionUsed(Uk),this._loader=k}dispose(){this._loader=null}loadBufferViewAsync(k,Q){return w.LoadExtensionAsync(k,Q,this.name,(async(i,Z)=>{const U=Q;if(U._meshOptData)return await U._meshOptData;const C=g.Get(`${k}/buffer`,this._loader.XC.buffers,Z.buffer);return U._meshOptData=this._loader.loadBufferAsync(`/buffers/${C.index}`,C,Z.byteOffset||0,Z.byteLength).then((async k=>await Zk.Default.decodeGltfBufferAsync(k,Z.count,Z.byteStride,Z.mode,Z.filter))),await U._meshOptData}))}}D(Uk),b(Uk,!0,(k=>new Ck(k)));const Bk="EXT_texture_webp";class ok{constructor(k){this.name=Bk,this._loader=k,this.enabled=k.isExtensionUsed(Bk)}dispose(){this._loader=null}_loadTextureAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=void 0==Q.sampler?w.DefaultSampler:g.Get(`${k}/sampler`,this._loader.XC.samplers,Q.sampler),B=g.Get(`${Z}/source`,this._loader.XC.images,U.source);return await this._loader._createTextureAsync(k,C,B,(k=>{i(k)}),void 0,!Q._textureInfo.nonColorData)}))}}D(Bk),b(Bk,!0,(k=>new ok(k)));const mk="EXT_texture_avif";class Ok{constructor(k){this.name=mk,this._loader=k,this.enabled=k.isExtensionUsed(mk)}dispose(){this._loader=null}_loadTextureAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=void 0==Q.sampler?w.DefaultSampler:g.Get(`${k}/sampler`,this._loader.XC.samplers,Q.sampler),B=g.Get(`${Z}/source`,this._loader.XC.images,U.source);return await this._loader._createTextureAsync(k,C,B,(k=>{i(k)}),void 0,!Q._textureInfo.nonColorData)}))}}D(mk),b(mk,!0,(k=>new Ok(k)));var Jk=i(13011),Gk=i(11826);const Hk="EXT_lights_ies";class ek{constructor(k){this.name=Hk,this._loader=k,this.enabled=this._loader.isExtensionUsed(Hk)}dispose(){this._loader=null,delete this._lights}onLoading(){const k=this._loader.XC.extensions;if(k&&k[this.name]){const Q=k[this.name];this._lights=Q.lights,g.Assign(this._lights)}}loadNodeAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,B)=>{let o,m;this._loader._allMaterialsDirtyRequired=!0;const O=await this._loader.loadNodeAsync(k,Q,(k=>{m=g.Get(Z,this._lights,B.ui);const Q=m.name||k.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,o=new Jk.c(Q,U.zQ.Zero(),U.zQ.Backward(),0,1,this._loader.babylonScene),o.angle=Math.PI/2,o.innerAngle=0,o._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,m._babylonLight=o,o.falloffType=Gk.e.FALLOFF_GLTF,o.ho=B.color?C.cQ.fQ(B.color):C.cQ.White(),o.lo=B.multiplier||1,o.range=Number.MAX_VALUE,o.parent=k,this._loader._babylonLights.push(o),w.AddPointerMetadata(o,Z),i(k)}));let J;if(m.uri)J=await this._loader.loadUriAsync(k,m,m.uri);else{const Q=g.Get(`${k}/bufferView`,this._loader.XC.bufferViews,m.bufferView);J=await this._loader.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q)}return o.iesProfileTexture=new f.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,J,!0,void 0,void 0,void 0,void 0,".ies"),O}))}}D(Hk),b(Hk,!0,(k=>new ek(k)));var Fk=i(13038);const zk="KHR_draco_mesh_compression";class Ek{constructor(k){this.name=zk,this.useNormalizedFlagFromAccessor=!0,this._loader=k,this.enabled=Fk.b.DefaultAvailable&&this._loader.isExtensionUsed(zk)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{if(void 0!=Q.mode&&4!==Q.mode&&5!==Q.mode)throw new Error(`${k}: Unsupported mode ${Q.mode}`);const C={},B={},o=(k,Z)=>{const o=U.attributes[k];if(void 0!=o&&(i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(Z)&&i._delayInfo.push(Z),C[Z]=o,this.useNormalizedFlagFromAccessor)){const i=g.TryGet(this._loader.XC.accessors,Q.attributes[k]);i&&(B[Z]=i.normalized||!1)}};o("POSITION",y.h.PositionKind),o("NORMAL",y.h.NormalKind),o("TANGENT",y.h.TangentKind),o("TEXCOORD_0",y.h.UVKind),o("TEXCOORD_1",y.h.UV2Kind),o("TEXCOORD_2",y.h.UV3Kind),o("TEXCOORD_3",y.h.UV4Kind),o("TEXCOORD_4",y.h.UV5Kind),o("TEXCOORD_5",y.h.UV6Kind),o("JOINTS_0",y.h.MatricesIndicesKind),o("WEIGHTS_0",y.h.MatricesWeightsKind),o("COLOR_0",y.h.ColorKind);const m=g.Get(Z,this._loader.XC.bufferViews,U.bufferView);return m._dracoBabylonGeometry||(m._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${m.index}`,m).then((async Z=>{const U=this.dracoDecoder||Fk.b.Default,o=g.TryGet(this._loader.XC.accessors,Q.attributes.POSITION),m=this._loader.parent.alwaysComputeBoundingBox||i.skeleton||!o?null:R(o);return await U._decodeMeshToGeometryForGltfAsync(i.name,this._loader.babylonScene,Z,C,B,m).catch((Q=>{throw new Error(`${k}: ${Q.message}`)}))}))),await m._dracoBabylonGeometry}))}}D(zk),b(zk,!0,(k=>new Ek(k)));var lk=i(13043),hk=i(11280),ck=i(11289),fk=i(11706),Yk=i(11884),yk=i(11253);fk.c.AddNodeConstructor("Light_Type_0",((k,Q)=>()=>new Lk(k,U.zQ.Zero(),Q)));class Lk extends Yk.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(k){this._shadowAngle=k,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(k){const Q=this.needCube();if(this._direction=k,this.needCube()!==Q&&this._shadowGenerators){const k=this._shadowGenerators.values();for(let Q=k.next();!0!==Q.done;Q=k.next()){Q.value.recreateShadowMap()}}}constructor(k,Q,i){super(k,i),this._shadowAngle=Math.PI/2,this.position=Q}getClassName(){return"PointLight"}getTypeID(){return Gk.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(k){if(this.direction)return super.getShadowDirection(k);switch(k){case 0:return new U.zQ(1,0,0);case 1:return new U.zQ(-1,0,0);case 2:return new U.zQ(0,-1,0);case 3:return new U.zQ(0,1,0);case 4:return new U.zQ(0,0,1);case 5:return new U.zQ(0,0,-1)}return U.zQ.Zero()}_setDefaultShadowProjectionMatrix(k,Q,i){const Z=this.sk().activeCamera;if(!Z)return;const C=void 0!==this.shadowMinZ?this.shadowMinZ:Z.Co,B=void 0!==this.shadowMaxZ?this.shadowMaxZ:Z.maxZ,o=this.sk().getEngine().useReverseDepthBuffer;U.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,o?B:C,o?C:B,k,!0,this._scene.getEngine().isNDCHalfZRange,void 0,o)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(k,Q){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,Q):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,Q),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,Q),this}transferToNodeMaterialEffect(k,Q){return this.computeTransformedInformation()?k.setFloat3(Q,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):k.setFloat3(Q,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(k,Q){k["POINTLIGHT"+Q]=!0}}(0,hk.c)([(0,ck.L)()],Lk.prototype,"shadowAngle",null),(0,yk.e)("BABYLON.PointLight",Lk);const sk="KHR_lights_punctual";class uk{constructor(k){this.name=sk,this._loader=k,this.enabled=this._loader.isExtensionUsed(sk)}dispose(){this._loader=null,delete this._lights}onLoading(){const k=this._loader.XC.extensions;if(k&&k[this.name]){const Q=k[this.name];this._lights=Q.lights,g.Assign(this._lights)}}loadNodeAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,B)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(k,Q,(k=>{let Q;const o=g.Get(Z,this._lights,B.ui),m=o.name||k.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,o.type){case"directional":{const k=new lk.d(m,U.zQ.Backward(),this._loader.babylonScene);k.position.eo(0),Q=k;break}case"point":Q=new Lk(m,U.zQ.Zero(),this._loader.babylonScene);break;case"spot":{const k=new Jk.c(m,U.zQ.Zero(),U.zQ.Backward(),0,1,this._loader.babylonScene);k.angle=2*(o.spot&&o.spot.outerConeAngle||Math.PI/4),k.innerAngle=2*(o.spot&&o.spot.innerConeAngle||0),Q=k;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${Z}: Invalid light type (${o.type})`)}Q._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,o._babylonLight=Q,Q.falloffType=Gk.e.FALLOFF_GLTF,Q.ho=o.color?C.cQ.fQ(o.color):C.cQ.White(),Q.lo=void 0==o.lo?1:o.lo,Q.range=void 0==o.range?Number.MAX_VALUE:o.range,Q.parent=k,this._loader._babylonLights.push(Q),w.AddPointerMetadata(Q,Z),i(k)})))))}}D(sk),b(sk,!0,(k=>new uk(k)));const ak="KHR_materials_pbrSpecularGlossiness";class jk{constructor(k){this.name=ak,this.order=200,this._loader=k,this.enabled=this._loader.isExtensionUsed(ak)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=new Array;return C.push(this._loader.loadMaterialBasePropertiesAsync(k,Q,i)),C.push(this._loadSpecularGlossinessPropertiesAsync(Z,U,i)),this._loader.loadMaterialAlphaProperties(k,Q,i),await Promise.all(C).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(k,Q,i){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);const Z=new Array;return i.metallic=null,i.roughness=null,Q.diffuseFactor?(i.albedoColor=C.cQ.fQ(Q.diffuseFactor),i.alpha=Q.diffuseFactor[3]):i.albedoColor=C.cQ.White(),i.reflectivityColor=Q.specularFactor?C.cQ.fQ(Q.specularFactor):C.cQ.White(),i.microSurface=void 0==Q.glossinessFactor?1:Q.glossinessFactor,Q.diffuseTexture&&Z.push(this._loader.loadTextureInfoAsync(`${k}/diffuseTexture`,Q.diffuseTexture,(k=>{k.name=`${i.name} (Diffuse)`,i.albedoTexture=k}))),Q.specularGlossinessTexture&&(Z.push(this._loader.loadTextureInfoAsync(`${k}/specularGlossinessTexture`,Q.specularGlossinessTexture,(k=>{k.name=`${i.name} (Specular Glossiness)`,i.reflectivityTexture=k,i.reflectivityTexture.Uo=!0}))),i.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(Z).then((()=>{}))}}D(ak),b(ak,!0,(k=>new jk(k)));const Tk="KHR_materials_unlit";class Kk{constructor(k){this.name=Tk,this.order=210,this._loader=k,this.enabled=this._loader.isExtensionUsed(Tk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async()=>await this._loadUnlitPropertiesAsync(k,Q,i)))}_loadUnlitPropertiesAsync(k,Q,i){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);const Z=new Array;i.unlit=!0;const U=Q.pbrMetallicRoughness;return U&&(U.baseColorFactor?(i.albedoColor=C.cQ.fQ(U.baseColorFactor),i.alpha=U.baseColorFactor[3]):i.albedoColor=C.cQ.White(),U.baseColorTexture&&Z.push(this._loader.loadTextureInfoAsync(`${k}/baseColorTexture`,U.baseColorTexture,(k=>{k.name=`${i.name} (Base Color)`,i.albedoTexture=k})))),Q.doubleSided&&(i.Jo=!1,i.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(k,Q,i),Promise.all(Z).then((()=>{}))}}D(Tk),b(Tk,!0,(k=>new Kk(k)));const vk="KHR_materials_clearcoat";class Nk{constructor(k){this.name=vk,this.order=190,this._loader=k,this.enabled=this._loader.isExtensionUsed(vk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=new Array;C.push(this._loader.loadMaterialPropertiesAsync(k,Q,i)),C.push(this._loadClearCoatPropertiesAsync(Z,U,i)),await Promise.all(C)}))}_loadClearCoatPropertiesAsync(k,Q,i){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);const Z=new Array;return i.clearCoat.isEnabled=!0,i.clearCoat.useRoughnessFromMainTexture=!1,i.clearCoat.remapF0OnInterfaceChange=!1,void 0!=Q.clearcoatFactor?i.clearCoat.lo=Q.clearcoatFactor:i.clearCoat.lo=0,Q.clearcoatTexture&&Z.push(this._loader.loadTextureInfoAsync(`${k}/clearcoatTexture`,Q.clearcoatTexture,(k=>{k.name=`${i.name} (ClearCoat)`,i.clearCoat.texture=k}))),void 0!=Q.clearcoatRoughnessFactor?i.clearCoat.roughness=Q.clearcoatRoughnessFactor:i.clearCoat.roughness=0,Q.clearcoatRoughnessTexture&&(Q.clearcoatRoughnessTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${k}/clearcoatRoughnessTexture`,Q.clearcoatRoughnessTexture,(k=>{k.name=`${i.name} (ClearCoat Roughness)`,i.clearCoat.textureRoughness=k})))),Q.clearcoatNormalTexture&&(Q.clearcoatNormalTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${k}/clearcoatNormalTexture`,Q.clearcoatNormalTexture,(k=>{k.name=`${i.name} (ClearCoat Normal)`,i.clearCoat.bumpTexture=k}))),i.invertNormalMapX=!i.sk().useRightHandedSystem,i.invertNormalMapY=i.sk().useRightHandedSystem,void 0!=Q.clearcoatNormalTexture.scale&&(i.clearCoat.bumpTexture.level=Q.clearcoatNormalTexture.scale)),Promise.all(Z).then((()=>{}))}}D(vk),b(vk,!0,(k=>new Nk(k)));const Xk="KHR_materials_iridescence";class pk{constructor(k){this.name=Xk,this.order=195,this._loader=k,this.enabled=this._loader.isExtensionUsed(Xk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(k,Q,i)),C.push(this._loadIridescencePropertiesAsync(Z,U,i)),await Promise.all(C).then((()=>{}))}))}_loadIridescencePropertiesAsync(k,Q,i){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);const Z=new Array;return i.iridescence.isEnabled=!0,i.iridescence.lo=Q.iridescenceFactor??0,i.iridescence.indexOfRefraction=Q.iridescenceIor??Q.iridescenceIOR??1.3,i.iridescence.minimumThickness=Q.iridescenceThicknessMinimum??100,i.iridescence.maximumThickness=Q.iridescenceThicknessMaximum??400,Q.iridescenceTexture&&Z.push(this._loader.loadTextureInfoAsync(`${k}/iridescenceTexture`,Q.iridescenceTexture,(k=>{k.name=`${i.name} (Iridescence)`,i.iridescence.texture=k}))),Q.iridescenceThicknessTexture&&Z.push(this._loader.loadTextureInfoAsync(`${k}/iridescenceThicknessTexture`,Q.iridescenceThicknessTexture,(k=>{k.name=`${i.name} (Iridescence Thickness)`,i.iridescence.thicknessTexture=k}))),Promise.all(Z).then((()=>{}))}}D(Xk),b(Xk,!0,(k=>new pk(k)));const dk="KHR_materials_anisotropy";class bk{constructor(k){this.name=dk,this.order=195,this._loader=k,this.enabled=this._loader.isExtensionUsed(dk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=new Array;C.push(this._loader.loadMaterialPropertiesAsync(k,Q,i)),C.push(this._loadIridescencePropertiesAsync(Z,U,i)),await Promise.all(C)}))}async _loadIridescencePropertiesAsync(k,Q,i){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);const Z=new Array;i.anisotropy.isEnabled=!0,i.anisotropy.lo=Q.anisotropyStrength??0,i.anisotropy.angle=Q.anisotropyRotation??0,Q.anisotropyTexture&&(Q.anisotropyTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${k}/anisotropyTexture`,Q.anisotropyTexture,(k=>{k.name=`${i.name} (Anisotropy Intensity)`,i.anisotropy.texture=k})))),await Promise.all(Z)}}D(dk),b(dk,!0,(k=>new bk(k)));const Dk="KHR_materials_emissive_strength";class Mk{constructor(k){this.name=Dk,this.order=170,this._loader=k,this.enabled=this._loader.isExtensionUsed(Dk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>await this._loader.loadMaterialPropertiesAsync(k,Q,i).then((()=>{this._loadEmissiveProperties(Z,U,i)}))))}_loadEmissiveProperties(k,Q,i){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);void 0!==Q.emissiveStrength&&(i.emissiveIntensity=Q.emissiveStrength)}}D(Dk),b(Dk,!0,(k=>new Mk(k)));const Wk="KHR_materials_sheen";class Ak{constructor(k){this.name=Wk,this.order=190,this._loader=k,this.enabled=this._loader.isExtensionUsed(Wk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(k,Q,i)),C.push(this._loadSheenPropertiesAsync(Z,U,i)),await Promise.all(C).then((()=>{}))}))}_loadSheenPropertiesAsync(k,Q,i){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);const Z=new Array;return i.sheen.isEnabled=!0,i.sheen.lo=1,void 0!=Q.sheenColorFactor?i.sheen.color=C.cQ.fQ(Q.sheenColorFactor):i.sheen.color=C.cQ.Black(),Q.sheenColorTexture&&Z.push(this._loader.loadTextureInfoAsync(`${k}/sheenColorTexture`,Q.sheenColorTexture,(k=>{k.name=`${i.name} (Sheen Color)`,i.sheen.texture=k}))),void 0!==Q.sheenRoughnessFactor?i.sheen.roughness=Q.sheenRoughnessFactor:i.sheen.roughness=0,Q.sheenRoughnessTexture&&(Q.sheenRoughnessTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${k}/sheenRoughnessTexture`,Q.sheenRoughnessTexture,(k=>{k.name=`${i.name} (Sheen Roughness)`,i.sheen.textureRoughness=k})))),i.sheen.albedoScaling=!0,i.sheen.useRoughnessFromMainTexture=!1,Promise.all(Z).then((()=>{}))}}D(Wk),b(Wk,!0,(k=>new Ak(k)));var gk=i(11761);const Rk="KHR_materials_specular";class wk{constructor(k){this.name=Rk,this.order=190,this._loader=k,this.enabled=this._loader.isExtensionUsed(Rk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=new Array;if(C.push(this._loader.loadMaterialPropertiesAsync(k,Q,i)),C.push(this._loadSpecularPropertiesAsync(Z,U,i)),U.extensions&&U.extensions.EXT_materials_specular_edge_color&&i instanceof c.c){U.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(i.brdf.dielectricSpecularModel=gk.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,i.brdf.conductorSpecularModel=gk.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(C).then((()=>{}))}))}_loadSpecularPropertiesAsync(k,Q,i){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);const Z=new Array;return void 0!==Q.specularFactor&&(i.metallicF0Factor=Q.specularFactor),void 0!==Q.specularColorFactor&&(i.metallicReflectanceColor=C.cQ.fQ(Q.specularColorFactor)),Q.specularTexture&&(Q.specularTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${k}/specularTexture`,Q.specularTexture,(k=>{k.name=`${i.name} (Specular)`,i.metallicReflectanceTexture=k,i.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),Q.specularColorTexture&&Z.push(this._loader.loadTextureInfoAsync(`${k}/specularColorTexture`,Q.specularColorTexture,(k=>{k.name=`${i.name} (Specular Color)`,i.reflectanceTexture=k}))),Promise.all(Z).then((()=>{}))}}D(Rk),b(Rk,!0,(k=>new wk(k)));const Sk="KHR_materials_ior";class qk{constructor(k){this.name=Sk,this.order=180,this._loader=k,this.enabled=this._loader.isExtensionUsed(Sk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(k,Q,i)),C.push(this._loadIorPropertiesAsync(Z,U,i)),await Promise.all(C).then((()=>{}))}))}_loadIorPropertiesAsync(k,Q,i){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);return void 0!==Q.ior?i.indexOfRefraction=Q.ior:i.indexOfRefraction=qk._DEFAULT_IOR,Promise.resolve()}}qk._DEFAULT_IOR=1.5,D(Sk),b(Sk,!0,(k=>new qk(k)));const Pk="KHR_materials_variants";class tk{constructor(k){this.name=Pk,this._loader=k,this.enabled=this._loader.isExtensionUsed(Pk)}dispose(){this._loader=null}static GetAvailableVariants(k){const Q=this._GetExtensionMetadata(k);return Q?Object.keys(Q.variants):[]}getAvailableVariants(k){return tk.GetAvailableVariants(k)}static SelectVariant(k,Q){const i=this._GetExtensionMetadata(k);if(!i)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Pk} extension`);const Z=k=>{const Q=i.variants[k];if(Q)for(const i of Q)i.mesh.material=i.material};if(Q instanceof Array)for(const U of Q)Z(U);else Z(Q);i.lastSelected=Q}selectVariant(k,Q){tk.SelectVariant(k,Q)}static Reset(k){const Q=this._GetExtensionMetadata(k);if(!Q)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Pk} extension`);for(const i of Q.original)i.mesh.material=i.material;Q.lastSelected=null}reset(k){tk.Reset(k)}static GetLastSelectedVariant(k){const Q=this._GetExtensionMetadata(k);if(!Q)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Pk} extension`);return Q.lastSelected}getLastSelectedVariant(k){return tk.GetLastSelectedVariant(k)}static _GetExtensionMetadata(k){var Q,i;return(null===k||void 0===k||null===(Q=k._internalMetadata)||void 0===Q||null===(i=Q.XC)||void 0===i?void 0:i[Pk])||null}onLoading(){const k=this._loader.XC.extensions;if(k&&k[this.name]){const Q=k[this.name];this._variants=Q.variants}}onReady(){const k=this._loader.rootBabylonMesh;if(k){var Q;const i=this._loader.parent.extensionOptions[Pk];null!==i&&void 0!==i&&i.defaultVariant&&tk.SelectVariant(k,i.defaultVariant),null===i||void 0===i||null===(Q=i.onLoaded)||void 0===Q||Q.call(i,{get variants(){return tk.GetAvailableVariants(k)},get selectedVariant(){const Q=tk.GetLastSelectedVariant(k);return Q?Array.isArray(Q)?Q[0]:Q:tk.GetAvailableVariants(k)[0]},set selectedVariant(Q){tk.SelectVariant(k,Q)}})}}_loadMeshPrimitiveAsync(k,Q,i,Z,U,C){return w.LoadExtensionAsync(k,U,this.name,(async(B,o)=>{const m=new Array;return m.push(this._loader._loadMeshPrimitiveAsync(k,Q,i,Z,U,(Q=>{if(C(Q),Q instanceof u.d){const i=w._GetDrawMode(k,U.mode),Z=this._loader.rootBabylonMesh,C=Z?Z._internalMetadata=Z._internalMetadata||{}:{},O=C.XC=C.XC||{},J=O[Pk]=O[Pk]||{lastSelected:null,original:[],variants:{}};J.original.push({mesh:Q,material:Q.material});for(let k=0;k<o.mappings.length;++k){const U=o.mappings[k],C=g.Get(`${B}/mappings/${k}/material`,this._loader.XC.materials,U.material);m.push(this._loader._loadMaterialAsync(`#/materials/${U.material}`,C,Q,i,(k=>{for(let i=0;i<U.variants.length;++i){const C=U.variants[i],B=g.Get(`/extensions/${Pk}/variants/${C}`,this._variants,C);J.variants[B.name]=J.variants[B.name]||[],J.variants[B.name].push({mesh:Q,material:k}),Q.onClonedObservable.add((k=>{const i=k;let U=null,C=i;do{if(C=C.parent,!C)return;U=tk._GetExtensionMetadata(C)}while(null===U);if(Z&&U===tk._GetExtensionMetadata(Z)){C._internalMetadata={};for(const k in Z._internalMetadata)C._internalMetadata[k]=Z._internalMetadata[k];C._internalMetadata.XC=[];for(const k in Z._internalMetadata.XC)C._internalMetadata.XC[k]=Z._internalMetadata.XC[k];C._internalMetadata.XC[Pk]={lastSelected:null,original:[],variants:{}};for(const k of U.original)C._internalMetadata.XC[Pk].original.push({mesh:k.mesh,material:k.material});for(const k in U.variants)if(Object.prototype.hasOwnProperty.call(U.variants,k)){C._internalMetadata.XC[Pk].variants[k]=[];for(const Q of U.variants[k])C._internalMetadata.XC[Pk].variants[k].push({mesh:Q.mesh,material:Q.material})}U=C._internalMetadata.XC[Pk]}for(const Z of U.original)Z.mesh===Q&&(Z.mesh=i);for(const Z of U.variants[B.name])Z.mesh===Q&&(Z.mesh=i)}))}})))}}}))),await Promise.all(m).then((k=>{let[Q]=k;return Q}))}))}}D(Pk),b(Pk,!0,(k=>new tk(k)));var Ik=i(11370);class rk{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:gk.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(k,Q){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...rk._GetDefaultOptions(),...k},this._scene=Q,this._scene._transmissionHelper=this,this.onErrorObservable=new J.c,this._scene.gi.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(k){if(!Object.keys(k).filter((Q=>this._options[Q]!==k[Q])).length)return;const Q={...this._options,...k},i=this._options;this._options=Q,Q.renderSize===i.renderSize&&Q.renderTargetTextureType===i.renderTargetTextureType&&Q.generateMipmaps===i.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=Q.samples,this._opaqueRenderTarget.lodGenerationScale=Q.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=Q.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(k){return!!k&&!!(k instanceof c.c&&k.subSurface.isRefractionEnabled)}_addMesh(k){this._materialObservers[k.uniqueId]=k.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),B.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(k.material)?(k.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(k)&&this._transparentMeshesCache.push(k)):-1===this._opaqueMeshesCache.indexOf(k)&&this._opaqueMeshesCache.push(k)}))}_removeMesh(k){k.onMaterialChangedObservable.remove(this._materialObservers[k.uniqueId]),delete this._materialObservers[k.uniqueId];let Q=this._transparentMeshesCache.indexOf(k);-1!==Q&&this._transparentMeshesCache.splice(Q,1),Q=this._opaqueMeshesCache.indexOf(k),-1!==Q&&this._opaqueMeshesCache.splice(Q,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(k){const Q=this._transparentMeshesCache.indexOf(k),i=this._opaqueMeshesCache.indexOf(k);this._shouldRenderAsTransmission(k.material)?(k.material instanceof c.c&&(k.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==i?(this._opaqueMeshesCache.splice(i,1),this._transparentMeshesCache.push(k)):-1===Q&&this._transparentMeshesCache.push(k)):-1!==Q?(this._transparentMeshesCache.splice(Q,1),this._opaqueMeshesCache.push(k)):-1===i&&this._opaqueMeshesCache.push(k)}_isRenderTargetValid(){var k;return null!==(null===(k=this._opaqueRenderTarget)||void 0===k?void 0:k.getInternalTexture())}_setupRenderTargets(){var k;let Q;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Ik.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(k=this._options.clearColor)||void 0===k?void 0:k.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((k=>{Q=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?k.clearColor.B(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(k.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=Q}));for(const i of this._transparentMeshesCache)this._shouldRenderAsTransmission(i.material)&&(i.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const nk="KHR_materials_transmission";class xk{constructor(k){this.name=nk,this.order=175,this._loader=k,this.enabled=this._loader.isExtensionUsed(nk),this.enabled&&(k.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(k,Q,i)),C.push(this._loadTransparentPropertiesAsync(Z,Q,i,U)),await Promise.all(C).then((()=>{}))}))}_loadTransparentPropertiesAsync(k,Q,i,Z){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);const U=i;if(U.subSurface.isRefractionEnabled=!0,U.subSurface.volumeIndexOfRefraction=1,U.subSurface.useAlbedoToTintRefraction=!0,void 0===Z.transmissionFactor)return U.subSurface.refractionIntensity=0,U.subSurface.isRefractionEnabled=!1,Promise.resolve();{var C;U.subSurface.refractionIntensity=Z.transmissionFactor;const k=U.sk();if(U.subSurface.refractionIntensity&&!k._transmissionHelper)new rk({},U.sk());else if(U.subSurface.refractionIntensity&&(null===(C=k._transmissionHelper)||void 0===C||!C._isRenderTargetValid())){var B;null===(B=k._transmissionHelper)||void 0===B||B._setupRenderTargets()}}return U.subSurface.minimumThickness=0,U.subSurface.maximumThickness=0,Z.transmissionTexture?(Z.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${k}/transmissionTexture`,Z.transmissionTexture,void 0).then((k=>{k.name=`${i.name} (Transmission)`,U.subSurface.refractionIntensityTexture=k,U.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}D(nk),b(nk,!0,(k=>new xk(k)));const Vk="KHR_materials_diffuse_transmission";class kQ{constructor(k){this.name=Vk,this.order=174,this._loader=k,this.enabled=this._loader.isExtensionUsed(Vk),this.enabled&&(k.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(k,Q,i)),C.push(this._loadTranslucentPropertiesAsync(Z,Q,i,U)),await Promise.all(C).then((()=>{}))}))}_loadTranslucentPropertiesAsync(k,Q,i,Z){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);const U=i;if(U.subSurface.isTranslucencyEnabled=!0,U.subSurface.volumeIndexOfRefraction=1,U.subSurface.minimumThickness=0,U.subSurface.maximumThickness=0,U.subSurface.useAlbedoToTintTranslucency=!1,void 0===Z.diffuseTransmissionFactor)return U.subSurface.translucencyIntensity=0,U.subSurface.isTranslucencyEnabled=!1,Promise.resolve();U.subSurface.translucencyIntensity=Z.diffuseTransmissionFactor;const B=new Array;return U.subSurface.useGltfStyleTextures=!0,Z.diffuseTransmissionTexture&&(Z.diffuseTransmissionTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${k}/diffuseTransmissionTexture`,Z.diffuseTransmissionTexture).then((k=>{k.name=`${i.name} (Diffuse Transmission)`,U.subSurface.translucencyIntensityTexture=k})))),void 0!==Z.diffuseTransmissionColorFactor?U.subSurface.translucencyColor=C.cQ.fQ(Z.diffuseTransmissionColorFactor):U.subSurface.translucencyColor=C.cQ.White(),Z.diffuseTransmissionColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${k}/diffuseTransmissionColorTexture`,Z.diffuseTransmissionColorTexture).then((k=>{k.name=`${i.name} (Diffuse Transmission Color)`,U.subSurface.translucencyColorTexture=k}))),Promise.all(B).then((()=>{}))}}D(Vk),b(Vk,!0,(k=>new kQ(k)));const QQ="KHR_materials_volume";class iQ{constructor(k){this.name=QQ,this.order=173,this._loader=k,this.enabled=this._loader.isExtensionUsed(QQ),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(k,Q,i)),C.push(this._loadVolumePropertiesAsync(Z,Q,i,U)),await Promise.all(C).then((()=>{}))}))}_loadVolumePropertiesAsync(k,Q,i,Z){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);if(!i.subSurface.isRefractionEnabled&&!i.subSurface.isTranslucencyEnabled||!Z.thicknessFactor)return Promise.resolve();i.subSurface.volumeIndexOfRefraction=i.indexOfRefraction;const U=void 0!==Z.attenuationDistance?Z.attenuationDistance:Number.MAX_VALUE;return i.subSurface.tintColorAtDistance=U,void 0!==Z.attenuationColor&&3==Z.attenuationColor.length&&i.subSurface.tintColor.Go(Z.attenuationColor[0],Z.attenuationColor[1],Z.attenuationColor[2]),i.subSurface.minimumThickness=0,i.subSurface.maximumThickness=Z.thicknessFactor,i.subSurface.useThicknessAsDepth=!0,Z.thicknessTexture?(Z.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${k}/thicknessTexture`,Z.thicknessTexture).then((k=>{k.name=`${i.name} (Thickness)`,i.subSurface.thicknessTexture=k,i.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}D(QQ),b(QQ,!0,(k=>new iQ(k)));const ZQ="KHR_materials_dispersion";class UQ{constructor(k){this.name=ZQ,this.order=174,this._loader=k,this.enabled=this._loader.isExtensionUsed(ZQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(k,Q,i)),C.push(this._loadDispersionPropertiesAsync(Z,Q,i,U)),await Promise.all(C).then((()=>{}))}))}_loadDispersionPropertiesAsync(k,Q,i,Z){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);return i.subSurface.isRefractionEnabled&&Z.dispersion?(i.subSurface.isDispersionEnabled=!0,i.subSurface.dispersion=Z.dispersion,Promise.resolve()):Promise.resolve()}}D(ZQ),b(ZQ,!0,(k=>new UQ(k)));const CQ="EXT_materials_diffuse_roughness";class BQ{constructor(k){this.name=CQ,this.order=190,this._loader=k,this.enabled=this._loader.isExtensionUsed(CQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(k,Q,i)),C.push(this._loadDiffuseRoughnessPropertiesAsync(Z,U,i)),await Promise.all(C).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(k,Q,i){if(!(i instanceof c.c))throw new Error(`${k}: Material type not supported`);const Z=new Array;return i.brdf.baseDiffuseModel=gk.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=Q.diffuseRoughnessFactor?i.baseDiffuseRoughness=Q.diffuseRoughnessFactor:i.baseDiffuseRoughness=0,Q.diffuseRoughnessTexture&&Z.push(this._loader.loadTextureInfoAsync(`${k}/diffuseRoughnessTexture`,Q.diffuseRoughnessTexture,(k=>{k.name=`${i.name} (Diffuse Roughness)`,i.baseDiffuseRoughnessTexture=k}))),Promise.all(Z).then((()=>{}))}}D(CQ),b(CQ,!0,(k=>new BQ(k)));const oQ="KHR_mesh_quantization";class mQ{constructor(k){this.name=oQ,this.enabled=k.isExtensionUsed(oQ)}dispose(){}}D(oQ),b(oQ,!0,(k=>new mQ(k)));const OQ="KHR_texture_basisu";class JQ{constructor(k){this.name=OQ,this._loader=k,this.enabled=k.isExtensionUsed(OQ)}dispose(){this._loader=null}_loadTextureAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>{const C=void 0==Q.sampler?w.DefaultSampler:g.Get(`${k}/sampler`,this._loader.XC.samplers,Q.sampler),B=g.Get(`${Z}/source`,this._loader.XC.images,U.source);return await this._loader._createTextureAsync(k,C,B,(k=>{i(k)}),Q._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!Q._textureInfo.nonColorData)}))}}D(OQ),b(OQ,!0,(k=>new JQ(k)));const GQ="KHR_texture_transform";class HQ{constructor(k){this.name=GQ,this._loader=k,this.enabled=this._loader.isExtensionUsed(GQ)}dispose(){this._loader=null}loadTextureInfoAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(Z,U)=>await this._loader.loadTextureInfoAsync(k,Q,(k=>{if(!(k instanceof f.c))throw new Error(`${Z}: Texture type not supported`);U.offset&&(k.uOffset=U.offset[0],k.vOffset=U.offset[1]),k.uRotationCenter=0,k.vRotationCenter=0,U.rotation&&(k.wAng=-U.rotation),U.scale&&(k.uScale=U.scale[0],k.vScale=U.scale[1]),void 0!=U.texCoord&&(k.coordinatesIndex=U.texCoord),i(k)}))))}}D(GQ),b(GQ,!0,(k=>new HQ(k)));const eQ="KHR_xmp_json_ld";class FQ{constructor(k){this.name=eQ,this.order=100,this._loader=k,this.enabled=this._loader.isExtensionUsed(eQ)}dispose(){this._loader=null}onLoading(){var k,Q,i;if(null===this._loader.rootBabylonMesh)return;const Z=null===(k=this._loader.XC.extensions)||void 0===k?void 0:k.KHR_xmp_json_ld,U=null===(Q=this._loader.XC.asset)||void 0===Q||null===(i=Q.extensions)||void 0===i?void 0:i.KHR_xmp_json_ld;if(Z&&U){const k=+U.packet;Z.packets&&k<Z.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=Z.packets[k])}}}function zQ(k,Q,i,Z){return C.cQ.fQ(Q,i).scale(Z)}function EQ(k,Q,i,Z){return Q[i]*Z}function lQ(k,Q,i,Z){return-Q[i]*Z}function hQ(k,Q,i,Z){return Q[i+1]*Z}function cQ(k,Q,i,Z){return Q[i]*Z*2}function fQ(k){return{scale:[new yQ(H.c.ANIMATIONTYPE_FLOAT,`${k}.uScale`,EQ,(()=>2)),new yQ(H.c.ANIMATIONTYPE_FLOAT,`${k}.vScale`,hQ,(()=>2))],offset:[new yQ(H.c.ANIMATIONTYPE_FLOAT,`${k}.uOffset`,EQ,(()=>2)),new yQ(H.c.ANIMATIONTYPE_FLOAT,`${k}.vOffset`,hQ,(()=>2))],rotation:[new yQ(H.c.ANIMATIONTYPE_FLOAT,`${k}.wAng`,lQ,(()=>1))]}}D(eQ),b(eQ,!0,(k=>new FQ(k)));class YQ extends S.AnimationPropertyInfo{buildAnimations(k,Q,i,Z){return[{babylonAnimatable:k._babylonCamera,babylonAnimation:this._buildAnimation(Q,i,Z)}]}}class yQ extends S.AnimationPropertyInfo{buildAnimations(k,Q,i,Z){const U=[];for(const C in k._data)U.push({babylonAnimatable:k._data[C].babylonMaterial,babylonAnimation:this._buildAnimation(Q,i,Z)});return U}}class LQ extends S.AnimationPropertyInfo{buildAnimations(k,Q,i,Z){return[{babylonAnimatable:k._babylonLight,babylonAnimation:this._buildAnimation(Q,i,Z)}]}}(0,M.m)("/cameras/{}/orthographic/xmag",[new YQ(H.c.ANIMATIONTYPE_FLOAT,"orthoLeft",lQ,(()=>1)),new YQ(H.c.ANIMATIONTYPE_FLOAT,"orthoRight",hQ,(()=>1))]),(0,M.m)("/cameras/{}/orthographic/ymag",[new YQ(H.c.ANIMATIONTYPE_FLOAT,"orthoBottom",lQ,(()=>1)),new YQ(H.c.ANIMATIONTYPE_FLOAT,"orthoTop",hQ,(()=>1))]),(0,M.m)("/cameras/{}/orthographic/zfar",[new YQ(H.c.ANIMATIONTYPE_FLOAT,"maxZ",EQ,(()=>1))]),(0,M.m)("/cameras/{}/orthographic/znear",[new YQ(H.c.ANIMATIONTYPE_FLOAT,"Co",EQ,(()=>1))]),(0,M.m)("/cameras/{}/perspective/yfov",[new YQ(H.c.ANIMATIONTYPE_FLOAT,"fov",EQ,(()=>1))]),(0,M.m)("/cameras/{}/perspective/zfar",[new YQ(H.c.ANIMATIONTYPE_FLOAT,"maxZ",EQ,(()=>1))]),(0,M.m)("/cameras/{}/perspective/znear",[new YQ(H.c.ANIMATIONTYPE_FLOAT,"Co",EQ,(()=>1))]),(0,M.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new yQ(H.c.ANIMATIONTYPE_COLOR3,"albedoColor",zQ,(()=>4)),new yQ(H.c.ANIMATIONTYPE_FLOAT,"alpha",(function(k,Q,i,Z){return Q[i+3]*Z}),(()=>4))]),(0,M.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"metallic",EQ,(()=>1))]),(0,M.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"roughness",EQ,(()=>1))]);const sQ=fQ("albedoTexture");(0,M.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",sQ.scale),(0,M.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",sQ.offset),(0,M.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",sQ.rotation);const uQ=fQ("metallicTexture");(0,M.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",uQ.scale),(0,M.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",uQ.offset),(0,M.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",uQ.rotation),(0,M.m)("/materials/{}/emissiveFactor",[new yQ(H.c.ANIMATIONTYPE_COLOR3,"emissiveColor",zQ,(()=>3))]);const aQ=fQ("bumpTexture");(0,M.m)("/materials/{}/normalTexture/scale",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",EQ,(()=>1))]),(0,M.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",aQ.scale),(0,M.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",aQ.offset),(0,M.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",aQ.rotation),(0,M.m)("/materials/{}/occlusionTexture/strength",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",EQ,(()=>1))]);const jQ=fQ("ambientTexture");(0,M.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",jQ.scale),(0,M.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",jQ.offset),(0,M.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",jQ.rotation);const TQ=fQ("emissiveTexture");(0,M.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",TQ.scale),(0,M.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",TQ.offset),(0,M.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",TQ.rotation),(0,M.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",EQ,(()=>1))]),(0,M.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",EQ,(()=>1))]);const KQ=fQ("anisotropy.texture");(0,M.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",KQ.scale),(0,M.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",KQ.offset),(0,M.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",KQ.rotation),(0,M.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",EQ,(()=>1))]),(0,M.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",EQ,(()=>1))]);const vQ=fQ("clearCoat.texture");(0,M.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",vQ.scale),(0,M.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",vQ.offset),(0,M.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",vQ.rotation);const NQ=fQ("clearCoat.bumpTexture");(0,M.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",EQ,(()=>1))]),(0,M.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",NQ.scale),(0,M.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",NQ.offset),(0,M.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",NQ.rotation);const XQ=fQ("clearCoat.textureRoughness");(0,M.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",XQ.scale),(0,M.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",XQ.offset),(0,M.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",XQ.rotation),(0,M.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",EQ,(()=>1))]),(0,M.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",EQ,(()=>1))]),(0,M.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",EQ,(()=>1))]),(0,M.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",EQ,(()=>1))]),(0,M.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",EQ,(()=>1))]),(0,M.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",EQ,(()=>1))]),(0,M.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",EQ,(()=>1))]);const pQ=fQ("iridescence.texture");(0,M.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",pQ.scale),(0,M.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",pQ.offset),(0,M.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",pQ.rotation);const dQ=fQ("iridescence.thicknessTexture");(0,M.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",dQ.scale),(0,M.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",dQ.offset),(0,M.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",dQ.rotation),(0,M.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new yQ(H.c.ANIMATIONTYPE_COLOR3,"sheen.color",zQ,(()=>3))]),(0,M.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",EQ,(()=>1))]);const bQ=fQ("sheen.texture");(0,M.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",bQ.scale),(0,M.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",bQ.offset),(0,M.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",bQ.rotation);const DQ=fQ("sheen.textureRoughness");(0,M.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",DQ.scale),(0,M.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",DQ.offset),(0,M.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",DQ.rotation),(0,M.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",EQ,(()=>1))]),(0,M.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new yQ(H.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",zQ,(()=>3))]);const MQ=fQ("metallicReflectanceTexture");(0,M.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",MQ.scale),(0,M.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",MQ.offset),(0,M.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",MQ.rotation);const WQ=fQ("reflectanceTexture");(0,M.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",WQ.scale),(0,M.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",WQ.offset),(0,M.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",WQ.rotation),(0,M.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",EQ,(()=>1))]);const AQ=fQ("subSurface.refractionIntensityTexture");(0,M.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",AQ.scale),(0,M.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",AQ.offset),(0,M.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",AQ.rotation),(0,M.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new yQ(H.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",zQ,(()=>3))]),(0,M.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",EQ,(()=>1))]),(0,M.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",EQ,(()=>1))]);const gQ=fQ("subSurface.thicknessTexture");(0,M.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",gQ.scale),(0,M.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",gQ.offset),(0,M.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",gQ.rotation),(0,M.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new yQ(H.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",EQ,(()=>1))]);const RQ=fQ("subSurface.translucencyIntensityTexture");(0,M.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",RQ.scale),(0,M.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",RQ.offset),(0,M.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",RQ.rotation),(0,M.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new yQ(H.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",zQ,(()=>3))]);const wQ=fQ("subSurface.translucencyColorTexture");(0,M.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",wQ.scale),(0,M.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",wQ.offset),(0,M.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",wQ.rotation),(0,M.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new LQ(H.c.ANIMATIONTYPE_COLOR3,"diffuse",zQ,(()=>3))]),(0,M.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new LQ(H.c.ANIMATIONTYPE_FLOAT,"intensity",EQ,(()=>1))]),(0,M.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new LQ(H.c.ANIMATIONTYPE_FLOAT,"range",EQ,(()=>1))]),(0,M.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new LQ(H.c.ANIMATIONTYPE_FLOAT,"innerAngle",cQ,(()=>1))]),(0,M.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new LQ(H.c.ANIMATIONTYPE_FLOAT,"angle",cQ,(()=>1))]),(0,M.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new LQ(H.c.ANIMATIONTYPE_COLOR3,"diffuse",zQ,(()=>3))]),(0,M.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new LQ(H.c.ANIMATIONTYPE_FLOAT,"intensity",EQ,(()=>1))]);const SQ="KHR_animation_pointer";class qQ{constructor(k){this.name=SQ,this._loader=k,this._pathToObjectConverter=(0,M.l)(this._loader.XC)}get enabled(){return this._loader.isExtensionUsed(SQ)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(k,Q,i,Z,U){var C;const B=null===(C=Z.target.extensions)||void 0===C?void 0:C.KHR_animation_pointer;if(!B||!this._pathToObjectConverter)return null;"pointer"!==Z.target.path&&z.c.Warn(`${k}/target/path: Value (${Z.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=Z.target.node&&z.c.Warn(`${k}/target/node: Value (${Z.target.node}) must not be present when using the ${this.name} extension`);const o=`${k}/extensions/${this.name}`,m=B.pointer;if(!m)throw new Error(`${o}: Pointer is missing`);try{const C=this._pathToObjectConverter.convert(m);if(!C.info.interpolation)throw new Error(`${o}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(k,Q,i,Z,{object:C.object,info:C.info.interpolation},U)}catch(O){return z.c.Warn(`${o}/pointer: Invalid pointer (${m}) skipped`),null}}}D(SQ),b(SQ,!0,(k=>new qQ(k)));class PQ{constructor(k,Q,i){this.frame=k,this.action=Q,this.onlyOnce=i,this.isDone=!1}_clone(){return new PQ(this.frame,this.action,this.onlyOnce)}}var tQ=i(11146),IQ=i(11195),rQ=i(11189);class nQ{get loop(){return this._loop}set loop(k){k!==this._loop&&(this._loop=k,this.updateOptions({loop:k}))}get currentTime(){var k;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(k=IQ.b.audioEngine)&&void 0!==k&&k.audioContext&&(this.isPlaying||this.isPaused)){const k=this.isPaused?0:IQ.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+k}return 0}get spatialSound(){return this._spatialSound}set spatialSound(k){if(k==this._spatialSound)return;const Q=this.isPlaying;this.pause(),k?(this._spatialSound=k,this._updateSpatialParameters()):this._disableSpatialSound(),Q&&this.play()}constructor(k,Q,i){var Z;let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new J.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=U.zQ.Zero(),this._localDirection=new U.zQ(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=k,i=i||F.b.LastCreatedScene)if(this._scene=i,nQ._SceneComponentInitialization(i),this._readyToPlayCallback=C,this._customAttenuationFunction=(k,Q,i,Z,U)=>Q<i?k*(1-Q/i):0,o&&(this.autoplay=o.autoplay||!1,this._loop=o.loop||!1,void 0!==o.volume&&(this._volume=o.volume),this._spatialSound=o.spatialSound??!1,this.maxDistance=o.maxDistance??100,this.useCustomAttenuation=o.useCustomAttenuation??!1,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||"linear",this._playbackRate=o.playbackRate||1,this._streaming=o.streaming??!1,this._length=o.length,this._offset=o.offset),null!==(Z=IQ.b.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&IQ.b.audioEngine.audioContext){this._soundGain=IQ.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let k=!0;if(Q)try{"string"===typeof Q?(this._urlType="String",this._url=Q):Q instanceof ArrayBuffer?this._urlType="ArrayBuffer":Q instanceof HTMLMediaElement?this._urlType="MediaElement":Q instanceof MediaStream?this._urlType="MediaStream":Q instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(Q)&&(this._urlType="Array");let i=[],Z=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=IQ.b.audioEngine.audioContext.createMediaElementSource(Q),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=IQ.b.audioEngine.audioContext.createMediaStreamSource(Q),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":Q.byteLength>0&&(Z=!0,this._soundLoaded(Q));break;case"AudioBuffer":this._audioBufferLoaded(Q);break;case"String":i.push(Q);case"Array":0===i.length&&(i=Q);for(let k=0;k<i.length;k++){const Q=i[k];if(Z=o&&o.skipCodecCheck||-1!==Q.indexOf(".mp3",Q.length-4)&&IQ.b.audioEngine.isMP3supported||-1!==Q.indexOf(".ogg",Q.length-4)&&IQ.b.audioEngine.isOGGsupported||-1!==Q.indexOf(".wav",Q.length-4)||-1!==Q.indexOf(".m4a",Q.length-4)||-1!==Q.indexOf(".mp4",Q.length-4)||-1!==Q.indexOf("blob:"),Z){this._streaming?(this._htmlAudioElement=new Audio(Q),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,B.Tools.SetCorsBehavior(Q,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(Q,(k=>{this._soundLoaded(k)}),void 0,!0,!0,(k=>{k&&z.c.Error("XHR "+k.status+" error on: "+Q+"."),z.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:k=!1}k?Z||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):z.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(m){z.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),IQ.b.audioEngine&&!IQ.b.audioEngine.WarnedWebAudioUnsupported&&(z.c.Error("Web Audio is not supported by your browser."),IQ.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var k;null!==(k=IQ.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(k){var Q;null!==(Q=IQ.b.audioEngine)&&void 0!==Q&&Q.audioContext&&(this._audioBuffer=k,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(k){var Q;null!==(Q=IQ.b.audioEngine)&&void 0!==Q&&Q.audioContext&&IQ.b.audioEngine.audioContext.decodeAudioData(k,(k=>{this._audioBufferLoaded(k)}),(k=>{z.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+k)}))}setAudioBuffer(k){var Q;null!==(Q=IQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&(this._audioBuffer=k,this._isReadyToPlay=!0)}updateOptions(k){k&&(this.loop=k.loop??this.loop,this.maxDistance=k.maxDistance??this.maxDistance,this.useCustomAttenuation=k.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=k.rolloffFactor??this.rolloffFactor,this.refDistance=k.refDistance??this.refDistance,this.distanceModel=k.distanceModel??this.distanceModel,this._playbackRate=k.playbackRate??this._playbackRate,this._length=k.length??void 0,this.spatialSound=k.spatialSound??this._spatialSound,this._setOffset(k.offset??void 0),this.setVolume(k.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var k;null!==(k=IQ.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&IQ.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??IQ.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var k;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(k=this._soundPanner)||void 0===k||k.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var k;null!==(k=IQ.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(k){var Q;null!==(Q=IQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(k),this._isOutputConnected=!0)}setDirectionalCone(k,Q,i){Q<k?z.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=k,this._coneOuterAngle=Q,this._coneOuterGain=i,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(k){if(k!=this._coneInnerAngle){var Q;if(this._coneOuterAngle<k)return void z.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=k,null!==(Q=IQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(k){if(k!=this._coneOuterAngle){var Q;if(k<this._coneInnerAngle)return void z.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=k,null!==(Q=IQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(k){var Q;k.equals(this._position)||(this._position.B(k),null!==(Q=IQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(k){var Q;this._localDirection=k,null!==(Q=IQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const k=this._connectedTransformNode.getWorldMatrix(),Q=U.zQ.TransformNormal(this._localDirection,k);Q.normalize(),this._soundPanner.orientationX.value=Q.x,this._soundPanner.orientationY.value=Q.y,this._soundPanner.orientationZ.value=Q.z}updateDistanceFromListener(){var k;if(null!==(k=IQ.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const k=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.EQ(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,k,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(k){this._customAttenuationFunction=k}play(k,Q,i){var Z;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(Z=IQ.b.audioEngine)&&void 0!==Z&&Z.audioContext)try{var U,C;this._clearTimeoutsAndObservers();let Z=k?(null===(U=IQ.b.audioEngine)||void 0===U?void 0:U.audioContext.currentTime)+k:null===(C=IQ.b.audioEngine)||void 0===C?void 0:C.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=IQ.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const k=()=>{var i;if(null!==(i=IQ.b.audioEngine)&&void 0!==i&&i.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=Q??0;const i=this._htmlAudioElement.play();void 0!==i&&i.catch((()=>{var Q,i;(null===(Q=IQ.b.audioEngine)||void 0===Q||Q.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(i=IQ.b.audioEngine)||void 0===i?void 0:i.onAudioUnlockedObservable.addOnce((()=>{k()})))}))}else{var Z;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(Z=IQ.b.audioEngine)||void 0===Z?void 0:Z.onAudioUnlockedObservable.addOnce((()=>{k()}))}};k()}}else{var B;const U=()=>{var U;if(null!==(U=IQ.b.audioEngine)&&void 0!==U&&U.audioContext){var C;if(i=i||this._length,void 0!==Q&&this._setOffset(Q),this._soundSource){const k=this._soundSource;k.onended=()=>{k.disconnect()}}if(this._soundSource=null===(C=IQ.b.audioEngine)||void 0===C?void 0:C.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var B;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==Q&&(this._soundSource.loopStart=Q),void 0!==i&&(this._soundSource.loopEnd=(0|Q)+i),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},Z=k?(null===(B=IQ.b.audioEngine)||void 0===B?void 0:B.audioContext.currentTime)+k:IQ.b.audioEngine.audioContext.currentTime;const U=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(Z,U,this.loop?void 0:i)}}};"suspended"===(null===(B=IQ.b.audioEngine)||void 0===B?void 0:B.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var k;"suspended"===(null===(k=IQ.b.audioEngine)||void 0===k?void 0:k.audioContext.state)?(IQ.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=IQ.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{U()})))):U()}),500):U()}this._startTime=Z,this.isPlaying=!0,this.isPaused=!1}catch(o){z.c.Error("Error while trying to play audio: "+this.name+", "+o.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(k){var Q;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var i;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(i=this._streamingSource)||void 0===i||i.disconnect();this.isPlaying=!1}else if(null!==(Q=IQ.b.audioEngine)&&void 0!==Q&&Q.audioContext&&this._soundSource){const Q=k?IQ.b.audioEngine.audioContext.currentTime+k:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(Q)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var k;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Q;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(Q=this._streamingSource)||void 0===Q||Q.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(k=IQ.b.audioEngine)&&void 0!==k&&k.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=IQ.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(k,Q){var i;null!==(i=IQ.b.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._soundGain&&(Q&&IQ.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(IQ.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,IQ.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(k,IQ.b.audioEngine.audioContext.currentTime+Q)):this._soundGain.gain.value=k),this._volume=k}setPlaybackRate(k){this._playbackRate=k,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(k){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=k,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=k=>this._onRegisterAfterWorldMatrixUpdate(k),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(k){var Q;if(k.getBoundingInfo){const Q=k.getBoundingInfo();this.setPosition(Q.boundingSphere.centerWorld)}else this.setPosition(k.absolutePosition);null!==(Q=IQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const k=()=>{(0,rQ.f)((()=>this._isReadyToPlay),(()=>{i._audioBuffer=this.getAudioBuffer(),i._isReadyToPlay=!0,i.autoplay&&i.play(0,this._offset,this._length)}),void 0,300)},Q={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},i=new nQ(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,Q);return this.useCustomAttenuation&&i.setAttenuationFunction(this._customAttenuationFunction),i.setPosition(this._position),i.setPlaybackRate(this._playbackRate),k(),i}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const k={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(k.connectedMeshId=this._connectedTransformNode.id),k.position=this._position.Zo(),k.refDistance=this.refDistance,k.distanceModel=this.distanceModel,k.isDirectional=this._isDirectional,k.localDirectionToMesh=this._localDirection.Zo(),k.coneInnerAngle=this._coneInnerAngle,k.coneOuterAngle=this._coneOuterAngle,k.coneOuterGain=this._coneOuterGain),k}static Parse(k,Q,i,Z){const C=k.name;let B;B=k.url?i+k.url:i+C;const o={autoplay:k.autoplay,loop:k.loop,volume:k.volume,spatialSound:k.spatialSound,maxDistance:k.maxDistance,rolloffFactor:k.rolloffFactor,refDistance:k.refDistance,distanceModel:k.distanceModel,playbackRate:k.playbackRate};let m;if(Z){const k=()=>{(0,rQ.f)((()=>Z._isReadyToPlay),(()=>{m._audioBuffer=Z.getAudioBuffer(),m._isReadyToPlay=!0,m.autoplay&&m.play(0,m._offset,m._length)}),void 0,300)};m=new nQ(C,new ArrayBuffer(0),Q,null,o),k()}else m=new nQ(C,B,Q,(()=>{Q.removePendingData(m)}),o),Q.addPendingData(m);if(k.position){const Q=U.zQ.fQ(k.position);m.setPosition(Q)}if(k.isDirectional&&(m.setDirectionalCone(k.coneInnerAngle||360,k.coneOuterAngle||360,k.coneOuterGain||0),k.localDirectionToMesh)){const Q=U.zQ.fQ(k.localDirectionToMesh);m.setLocalDirectionToMesh(Q)}if(k.connectedMeshId){const i=Q.getMeshById(k.connectedMeshId);i&&m.attachToMesh(i)}return k.metadata&&(m.metadata=k.metadata),m}_setOffset(k){this._offset!==k&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=k)}_clearTimeoutsAndObservers(){var k;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(k=IQ.b.audioEngine)||void 0===k||k.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}nQ._SceneComponentInitialization=k=>{throw(0,tQ.d)("AudioSceneComponent")},(0,yk.e)("BABYLON.Sound",nQ);class xQ{constructor(k,Q,i){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],Q.length!==i.length)throw new Error("Sounds length does not equal weights length");this.loop=k,this._weights=i;let Z=0;for(const C of i)Z+=C;const U=Z>0?1/Z:0;for(let C=0;C<this._weights.length;C++)this._weights[C]*=U;this._sounds=Q;for(const C of this._sounds)C.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(k){if(k!==this._coneInnerAngle){if(this._coneOuterAngle<k)return void z.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=k;for(const Q of this._sounds)Q.directionalConeInnerAngle=k}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(k){if(k!==this._coneOuterAngle){if(k<this._coneInnerAngle)return void z.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=k;for(const Q of this._sounds)Q.directionalConeOuterAngle=k}}get volume(){return this._volume}set volume(k){if(k!==this._volume)for(const Q of this._sounds)Q.setVolume(k)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(k){if(!this.isPaused){this.stop();const k=Math.random();let Q=0;for(let i=0;i<this._weights.length;i++)if(Q+=this._weights[i],k<=Q){this._currentIndex=i;break}}const Q=this._sounds[this._currentIndex??0];Q.isReady()?Q.play(0,this.isPaused?void 0:k):Q.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class VQ{constructor(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(k=k||F.b.LastCreatedScene)&&(this._scene=k,this.soundCollection=[],this._options=Q,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var k;null!==(k=IQ.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&IQ.b.audioEngine.audioContext&&(this._outputAudioNode=IQ.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(IQ.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(IQ.b.audioEngine&&IQ.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(k){var Q;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(Q=IQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._outputAudioNode&&k.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==k.soundTrackId&&(-1===k.soundTrackId?this._scene.mainSoundTrack.removeSound(k):this._scene.soundTracks&&this._scene.soundTracks[k.soundTrackId].removeSound(k)),this.soundCollection.push(k),k.soundTrackId=this.id}removeSound(k){const Q=this.soundCollection.indexOf(k);-1!==Q&&this.soundCollection.splice(Q,1)}setVolume(k){var Q;null!==(Q=IQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=k)}switchPanningModelToHRTF(){var k;if(null!==(k=IQ.b.audioEngine)&&void 0!==k&&k.canUseWebAudio)for(let Q=0;Q<this.soundCollection.length;Q++)this.soundCollection[Q].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var k;if(null!==(k=IQ.b.audioEngine)&&void 0!==k&&k.canUseWebAudio)for(let Q=0;Q<this.soundCollection.length;Q++)this.soundCollection[Q].switchPanningModelToEqualPower()}connectToAnalyser(k){var Q;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=k,null!==(Q=IQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,IQ.b.audioEngine.masterGain))}}var ki=i(11567),Qi=i(11538),ii=i(11131);IQ.b.AudioEngineFactory=(k,Q,i)=>new Zi(k,Q,i);class Zi{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new J.c,this.onAudioLockedObservable=new J.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,ii.j)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const Z=document.createElement("audio");this._hostElement=k,this._audioContext=Q,this._audioDestination=i;try{Z&&Z.canPlayType&&(Z.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||Z.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(U){}try{Z&&Z.canPlayType&&Z.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(U){}}lock(){this._triggerSuspendedState()}unlock(){var k,Q;if("running"===(null===(k=this._audioContext)||void 0===k?void 0:k.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(Q=this._audioContext)||void 0===Q||Q.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{z.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var k;null===(k=this._audioContext)||void 0===k||k.addEventListener("statechange",(()=>{var k;this.unlocked&&"running"!==(null===(k=this._audioContext)||void 0===k?void 0:k.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var k;return null!==(k=this._audioContext)&&void 0!==k&&k.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(k){this.canUseWebAudio=!1,z.c.Error("Web Audio: "+k.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(k){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const k=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",Q=document.createElement("style");Q.appendChild(document.createTextNode(k)),document.getElementsByTagName("head")[0].appendChild(Q),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var k;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(k=this._audioContext)||void 0===k||k.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(k){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=k)}connectToAnalyser(k){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=k,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Ui=i(11144);(0,i(12718).h)(ki.d.NAME_AUDIO,((k,Q,i,Z)=>{let U,C=[];if(i.sH=i.sH||[],void 0!==k.sH&&null!==k.sH)for(let o=0,m=k.sH.length;o<m;o++){var B;const m=k.sH[o];null!==(B=IQ.b.audioEngine)&&void 0!==B&&B.canUseWebAudio?(m.url||(m.url=m.name),C[m.url]?i.sH.push(nQ.Parse(m,Q,Z,C[m.url])):(U=nQ.Parse(m,Q,Z),C[m.url]=U,i.sH.push(U))):i.sH.push(new nQ(m.name,null,Q))}C=[]})),Object.defineProperty(Qi.b.prototype,"mainSoundTrack",{get:function(){let k=this._getComponent(ki.d.NAME_AUDIO);return k||(k=new Ci(this),this.o(k)),this._mainSoundTrack||(this._mainSoundTrack=new VQ(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Qi.b.prototype.getSoundByName=function(k){let Q;for(Q=0;Q<this.mainSoundTrack.soundCollection.length;Q++)if(this.mainSoundTrack.soundCollection[Q].name===k)return this.mainSoundTrack.soundCollection[Q];if(this.soundTracks)for(let i=0;i<this.soundTracks.length;i++)for(Q=0;Q<this.soundTracks[i].soundCollection.length;Q++)if(this.soundTracks[i].soundCollection[Q].name===k)return this.soundTracks[i].soundCollection[Q];return null},Object.defineProperty(Qi.b.prototype,"audioEnabled",{get:function(){let k=this._getComponent(ki.d.NAME_AUDIO);return k||(k=new Ci(this),this.o(k)),k.audioEnabled},set:function(k){let Q=this._getComponent(ki.d.NAME_AUDIO);Q||(Q=new Ci(this),this.o(Q)),k?Q.enableAudio():Q.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.b.prototype,"headphone",{get:function(){let k=this._getComponent(ki.d.NAME_AUDIO);return k||(k=new Ci(this),this.o(k)),k.headphone},set:function(k){let Q=this._getComponent(ki.d.NAME_AUDIO);Q||(Q=new Ci(this),this.o(Q)),k?Q.switchAudioModeForHeadphones():Q.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.b.prototype,"audioListenerPositionProvider",{get:function(){let k=this._getComponent(ki.d.NAME_AUDIO);return k||(k=new Ci(this),this.o(k)),k.audioListenerPositionProvider},set:function(k){let Q=this._getComponent(ki.d.NAME_AUDIO);if(Q||(Q=new Ci(this),this.o(Q)),k&&"function"!==typeof k)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");Q.audioListenerPositionProvider=k},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.b.prototype,"audioListenerRotationProvider",{get:function(){let k=this._getComponent(ki.d.NAME_AUDIO);return k||(k=new Ci(this),this.o(k)),k.audioListenerRotationProvider},set:function(k){let Q=this._getComponent(ki.d.NAME_AUDIO);if(Q||(Q=new Ci(this),this.o(Q)),k&&"function"!==typeof k)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");Q.audioListenerRotationProvider=k},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.b.prototype,"audioPositioningRefreshRate",{get:function(){let k=this._getComponent(ki.d.NAME_AUDIO);return k||(k=new Ci(this),this.o(k)),k.audioPositioningRefreshRate},set:function(k){let Q=this._getComponent(ki.d.NAME_AUDIO);Q||(Q=new Ci(this),this.o(Q)),Q.audioPositioningRefreshRate=k},enumerable:!0,configurable:!0});class Ci{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(k){this.name=ki.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new U.zQ,this._cachedCameraPosition=new U.zQ,this._lastCheck=0,this._invertMatrixTemp=new U.Matrix,this._cameraDirectionTemp=new U.zQ,(k=k||F.b.LastCreatedScene)&&(this.lQ=k,k.soundTracks=[],k.sH=[])}register(){this.lQ._afterRenderStage.registerStep(ki.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(k){if(k.sH=[],this.lQ.soundTracks)for(let Q=0;Q<this.lQ.soundTracks.length;Q++){const i=this.lQ.soundTracks[Q];for(let Q=0;Q<i.soundCollection.length;Q++)k.sH.push(i.soundCollection[Q].serialize())}}addFromContainer(k){if(k.sH)for(const Q of k.sH)Q.play(),Q.autoplay=!0,this.lQ.mainSoundTrack.addSound(Q)}removeFromContainer(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(k.sH)for(const i of k.sH)i.stop(),i.autoplay=!1,this.lQ.mainSoundTrack.removeSound(i),Q&&i.dispose()}dispose(){const k=this.lQ;if(k._mainSoundTrack&&k.mainSoundTrack.dispose(),k.soundTracks)for(let Q=0;Q<k.soundTracks.length;Q++)k.soundTracks[Q].dispose()}disableAudio(){const k=this.lQ;let Q;for(this._audioEnabled=!1,IQ.b.audioEngine&&IQ.b.audioEngine.audioContext&&IQ.b.audioEngine.audioContext.suspend(),Q=0;Q<k.mainSoundTrack.soundCollection.length;Q++)k.mainSoundTrack.soundCollection[Q].pause();if(k.soundTracks)for(Q=0;Q<k.soundTracks.length;Q++)for(let i=0;i<k.soundTracks[Q].soundCollection.length;i++)k.soundTracks[Q].soundCollection[i].pause()}enableAudio(){const k=this.lQ;let Q;for(this._audioEnabled=!0,IQ.b.audioEngine&&IQ.b.audioEngine.audioContext&&IQ.b.audioEngine.audioContext.resume(),Q=0;Q<k.mainSoundTrack.soundCollection.length;Q++)k.mainSoundTrack.soundCollection[Q].isPaused&&k.mainSoundTrack.soundCollection[Q].play();if(k.soundTracks)for(Q=0;Q<k.soundTracks.length;Q++)for(let i=0;i<k.soundTracks[Q].soundCollection.length;i++)k.soundTracks[Q].soundCollection[i].isPaused&&k.soundTracks[Q].soundCollection[i].play()}switchAudioModeForHeadphones(){const k=this.lQ;if(this._headphone=!0,k.mainSoundTrack.switchPanningModelToHRTF(),k.soundTracks)for(let Q=0;Q<k.soundTracks.length;Q++)k.soundTracks[Q].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const k=this.lQ;if(this._headphone=!1,k.mainSoundTrack.switchPanningModelToEqualPower(),k.soundTracks)for(let Q=0;Q<k.soundTracks.length;Q++)k.soundTracks[Q].switchPanningModelToEqualPower()}_afterRender(){const k=Ui.c.Now;if(this._lastCheck&&k-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=k;const Q=this.lQ;if(!this._audioEnabled||!Q._mainSoundTrack||!Q.soundTracks||0===Q._mainSoundTrack.soundCollection.length&&1===Q.soundTracks.length)return;const i=IQ.b.audioEngine;if(i&&i.audioContext){let k,Z=Q.activeCamera;if(Q.activeCameras&&Q.activeCameras.length>0&&(Z=Q.activeCameras[0]),this.audioListenerPositionProvider){const k=this.audioListenerPositionProvider();i.audioContext.listener.setPosition(k.x||0,k.y||0,k.z||0)}else Z?this._cachedCameraPosition.equals(Z.globalPosition)||(this._cachedCameraPosition.B(Z.globalPosition),i.audioContext.listener.setPosition(Z.globalPosition.x,Z.globalPosition.y,Z.globalPosition.z)):i.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const k=this.audioListenerRotationProvider();i.audioContext.listener.setOrientation(k.x||0,k.y||0,k.z||0,0,1,0)}else Z?(Z.rigCameras&&Z.rigCameras.length>0&&(Z=Z.rigCameras[0]),Z.getViewMatrix().invertToRef(this._invertMatrixTemp),U.zQ.TransformNormalToRef(Ci._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.B(this._cameraDirectionTemp),i.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):i.audioContext.listener.setOrientation(0,0,0,0,1,0);for(k=0;k<Q.mainSoundTrack.soundCollection.length;k++){const i=Q.mainSoundTrack.soundCollection[k];i.useCustomAttenuation&&i.updateDistanceFromListener()}if(Q.soundTracks)for(k=0;k<Q.soundTracks.length;k++)for(let i=0;i<Q.soundTracks[k].soundCollection.length;i++){const Z=Q.soundTracks[k].soundCollection[i];Z.useCustomAttenuation&&Z.updateDistanceFromListener()}}}}Ci._CameraDirection=new U.zQ(0,0,-1),nQ._SceneComponentInitialization=k=>{let Q=k._getComponent(ki.d.NAME_AUDIO);Q||(Q=new Ci(k),k.o(Q))};const Bi="MSFT_audio_emitter";class oi{constructor(k){this.name=Bi,this._loader=k,this.enabled=this._loader.isExtensionUsed(Bi)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const k=this._loader.XC.extensions;if(k&&k[this.name]){const Q=k[this.name];this._clips=Q.clips,this._emitters=Q.emitters,g.Assign(this._clips),g.Assign(this._emitters)}}loadSceneAsync(k,Q){return w.LoadExtensionAsync(k,Q,this.name,(async(i,Z)=>{const U=new Array;U.push(this._loader.loadSceneAsync(k,Q));for(const k of Z.emitters){const Q=g.Get(`${i}/emitters`,this._emitters,k);if(void 0!=Q.refDistance||void 0!=Q.maxDistance||void 0!=Q.rolloffFactor||void 0!=Q.distanceModel||void 0!=Q.innerAngle||void 0!=Q.outerAngle)throw new Error(`${i}: Direction or Distance properties are not allowed on emitters attached to a scene`);U.push(this._loadEmitterAsync(`${i}/emitters/${Q.index}`,Q))}await Promise.all(U)}))}loadNodeAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(k,Z)=>{const C=new Array,o=await this._loader.loadNodeAsync(k,Q,(Q=>{for(const i of Z.emitters){const Z=g.Get(`${k}/emitters`,this._emitters,i);C.push(this._loadEmitterAsync(`${k}/emitters/${Z.index}`,Z).then((()=>{for(const k of Z._babylonSounds)k.attachToMesh(Q),void 0==Z.innerAngle&&void 0==Z.outerAngle||(k.setLocalDirectionToMesh(U.zQ.Forward()),k.setDirectionalCone(2*B.Tools.ToDegrees(void 0==Z.innerAngle?Math.PI:Z.innerAngle),2*B.Tools.ToDegrees(void 0==Z.outerAngle?Math.PI:Z.outerAngle),0))})))}i(Q)}));return await Promise.all(C),o}))}loadAnimationAsync(k,Q){return w.LoadExtensionAsync(k,Q,this.name,(async(i,Z)=>{const U=await this._loader.loadAnimationAsync(k,Q),C=new Array;g.Assign(Z.events);for(const B of Z.events)C.push(this._loadAnimationEventAsync(`${i}/events/${B.index}`,k,Q,B,U));return await Promise.all(C),U}))}_loadClipAsync(k,Q){if(Q._objectURL)return Q._objectURL;let i;if(Q.uri)i=this._loader.loadUriAsync(k,Q,Q.uri);else{const Z=g.Get(`${k}/bufferView`,this._loader.XC.bufferViews,Q.bufferView);i=this._loader.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z)}return Q._objectURL=i.then((k=>URL.createObjectURL(new Blob([k],{type:Q.mimeType})))),Q._objectURL}_loadEmitterAsync(k,Q){if(Q._babylonSounds=Q._babylonSounds||[],!Q._babylonData){const k=new Array,i=Q.name||`emitter${Q.index}`,Z={loop:!1,autoplay:!1,volume:void 0==Q.volume?1:Q.volume};for(let C=0;C<Q.clips.length;C++){const U=`/extensions/${this.name}/clips`,B=g.Get(U,this._clips,Q.clips[C].clip);k.push(this._loadClipAsync(`${U}/${Q.clips[C].clip}`,B).then((k=>{const U=Q._babylonSounds[C]=new nQ(i,k,this._loader.babylonScene,null,Z);U.refDistance=Q.refDistance||1,U.maxDistance=Q.maxDistance||256,U.rolloffFactor=Q.rolloffFactor||1,U.distanceModel=Q.distanceModel||"exponential"})))}const U=Promise.all(k).then((()=>{const k=Q.clips.map((k=>k.weight||1)),i=new xQ(Q.loop||!1,Q._babylonSounds,k);Q.innerAngle&&(i.directionalConeInnerAngle=2*B.Tools.ToDegrees(Q.innerAngle)),Q.outerAngle&&(i.directionalConeOuterAngle=2*B.Tools.ToDegrees(Q.outerAngle)),Q.volume&&(i.volume=Q.volume),Q._babylonData.sound=i}));Q._babylonData={loaded:U}}return Q._babylonData.loaded}_getEventAction(k,Q,i,Z,U){switch(i){case"play":return k=>{const i=(U||0)+(k-Z);Q.play(i)};case"stop":return()=>{Q.stop()};case"pause":return()=>{Q.pause()};default:throw new Error(`${k}: Unsupported action ${i}`)}}_loadAnimationEventAsync(k,Q,i,Z,U){if(0==U.targetedAnimations.length)return Promise.resolve();const C=U.targetedAnimations[0],B=Z.UQ,o=g.Get(`/extensions/${this.name}/emitters`,this._emitters,B);return this._loadEmitterAsync(k,o).then((()=>{const Q=o._babylonData.sound;if(Q){const i=new PQ(Z.time,this._getEventAction(k,Q,Z.action,Z.time,Z.startOffset));C.animation.addEvent(i),U.onAnimationGroupEndObservable.add((()=>{Q.stop()})),U.onAnimationGroupPauseObservable.add((()=>{Q.pause()}))}}))}}D(Bi),b(Bi,!0,(k=>new oi(k)));const mi="MSFT_lod";class Oi{constructor(k){var Q;this.name=mi,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new J.c,this.onMaterialLODsLoadedObservable=new J.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=k,this.maxLODsToLoad=(null===(Q=this._loader.parent.extensionOptions[mi])||void 0===Q?void 0:Q.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(mi)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let k=0;k<this._nodePromiseLODs.length;k++){const Q=Promise.all(this._nodePromiseLODs[k]).then((()=>{0!==k&&(this._loader.endPerformanceCounter(`Node LOD ${k}`),this._loader.log(`Loaded node LOD ${k}`)),this.onNodeLODsLoadedObservable.notifyObservers(k),k!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${k+1}`),this._loadBufferLOD(this._nodeBufferLODs,k+1),this._nodeSignalLODs[k]&&this._nodeSignalLODs[k].resolve())}));this._loader._completePromises.push(Q)}for(let k=0;k<this._materialPromiseLODs.length;k++){const Q=Promise.all(this._materialPromiseLODs[k]).then((()=>{0!==k&&(this._loader.endPerformanceCounter(`Material LOD ${k}`),this._loader.log(`Loaded material LOD ${k}`)),this.onMaterialLODsLoadedObservable.notifyObservers(k),k!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${k+1}`),this._loadBufferLOD(this._materialBufferLODs,k+1),this._materialSignalLODs[k]&&this._materialSignalLODs[k].resolve())}));this._loader._completePromises.push(Q)}}loadSceneAsync(k,Q){const i=this._loader.loadSceneAsync(k,Q);return this._loadBufferLOD(this._bufferLODs,0),i}loadNodeAsync(k,Q,i){return w.LoadExtensionAsync(k,Q,this.name,(async(k,U)=>{let C;const B=this._getLODs(k,Q,this._loader.XC.nodes,U.ids);this._loader.logOpen(`${k}`);for(let Q=0;Q<B.length;Q++){const k=B[Q];0!==Q&&(this._nodeIndexLOD=Q,this._nodeSignalLODs[Q]=this._nodeSignalLODs[Q]||new Z);const U=k=>{i(k),k.do(!1)},o=this._loader.loadNodeAsync(`/nodes/${k.index}`,k,U).then((k=>{if(0!==Q){const k=B[Q-1];k._babylonTransformNode&&(this._disposeTransformNode(k._babylonTransformNode),delete k._babylonTransformNode)}return k.do(!0),k}));this._nodePromiseLODs[Q]=this._nodePromiseLODs[Q]||[],0===Q?C=o:(this._nodeIndexLOD=null,this._nodePromiseLODs[Q].push(o))}return this._loader.logClose(),await C}))}_loadMaterialAsync(k,Q,i,Z,U){return this._nodeIndexLOD?null:w.LoadExtensionAsync(k,Q,this.name,(async(k,C)=>{let B;const o=this._getLODs(k,Q,this._loader.XC.materials,C.ids);this._loader.logOpen(`${k}`);for(let Q=0;Q<o.length;Q++){const k=o[Q];0!==Q&&(this._materialIndexLOD=Q);const C=this._loader._loadMaterialAsync(`/materials/${k.index}`,k,i,Z,(k=>{0===Q&&U(k)})).then((k=>{if(0!==Q){U(k);const i=o[Q-1]._data;i[Z]&&(this._disposeMaterials([i[Z].babylonMaterial]),delete i[Z])}return k}));this._materialPromiseLODs[Q]=this._materialPromiseLODs[Q]||[],0===Q?B=C:(this._materialIndexLOD=null,this._materialPromiseLODs[Q].push(C))}return this._loader.logClose(),await B}))}_loadUriAsync(k,Q,i){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const U=this._nodeIndexLOD-1;return this._nodeSignalLODs[U]=this._nodeSignalLODs[U]||new Z,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(k,Q,i)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const U=this._materialIndexLOD-1;return this._materialSignalLODs[U]=this._materialSignalLODs[U]||new Z,this._materialSignalLODs[U].promise.then((async()=>await this._loader.loadUriAsync(k,Q,i)))}return null}loadBufferAsync(k,Q,i,U){if(this._loader.parent.useRangeRequests&&!Q.uri){if(!this._loader.bin)throw new Error(`${k}: Uri is missing or the binary glTF is missing its binary chunk`);const Q=async(k,Q)=>{const C=i,B=C+U-1;let o=k[Q];return o?(o.start=Math.min(o.start,C),o.end=Math.max(o.end,B)):(o={start:C,end:B,loaded:new Z},k[Q]=o),await o.loaded.promise.then((k=>new Uint8Array(k.buffer,k.byteOffset+i-o.start,U)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?Q(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?Q(this._materialBufferLODs,this._materialIndexLOD):Q(this._bufferLODs,0)}return null}_loadBufferLOD(k,Q){const i=k[Q];i&&(this._loader.log(`Loading buffer range [${i.start}-${i.end}]`),this._loader.bin.readAsync(i.start,i.end-i.start+1).then((k=>{i.loaded.resolve(k)}),(k=>{i.loaded.reject(k)})))}_getLODs(k,Q,i,Z){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const U=[];for(let C=Z.length-1;C>=0;C--)if(U.push(g.Get(`${k}/ids/${Z[C]}`,i,Z[C])),U.length===this.maxLODsToLoad)return U;return U.push(Q),U}_disposeTransformNode(k){const Q=[],i=k.material;i&&Q.push(i);for(const U of k.getChildMeshes())U.material&&Q.push(U.material);k.dispose();const Z=Q.filter((k=>this._loader.babylonScene.meshes.every((Q=>Q.material!=k))));this._disposeMaterials(Z)}_disposeMaterials(k){const Q={};for(const i of k){for(const k of i.getActiveTextures())Q[k.uniqueId]=k;i.dispose()}for(const i in Q)for(const k of this._loader.babylonScene.materials)k.hasTexture(Q[i])&&delete Q[i];for(const i in Q)Q[i].dispose()}}D(mi),b(mi,!0,(k=>new Oi(k)));const Ji="MSFT_minecraftMesh";class Gi{constructor(k){this.name=Ji,this._loader=k,this.enabled=this._loader.isExtensionUsed(Ji)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtraAsync(k,Q,this.name,(async(Z,U)=>{if(U){if(!(i instanceof c.c))throw new Error(`${Z}: Material type not supported`);const U=this._loader.loadMaterialPropertiesAsync(k,Q,i);return i.needAlphaBlending()&&(i.forceDepthWrite=!0,i.separateCullingPass=!0),i.Jo=i.forceDepthWrite,i.twoSidedLighting=!0,await U}}))}}D(Ji),b(Ji,!0,(k=>new Gi(k)));const Hi="MSFT_sRGBFactors";class ei{constructor(k){this.name=Hi,this._loader=k,this.enabled=this._loader.isExtensionUsed(Hi)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,Q,i){return w.LoadExtraAsync(k,Q,this.name,(async(Z,U)=>{if(U){if(!(i instanceof c.c))throw new Error(`${Z}: Material type not supported`);const U=this._loader.loadMaterialPropertiesAsync(k,Q,i),C=i.sk().getEngine().useExactSrgbConversions;return i.albedoTexture||i.albedoColor.toLinearSpaceToRef(i.albedoColor,C),i.reflectivityTexture||i.reflectivityColor.toLinearSpaceToRef(i.reflectivityColor,C),await U}}))}}D(Hi),b(Hi,!0,(k=>new ei(k)));var Fi=i(13048);const zi={};var Ei=i(13100),li=i(13078),hi=i(13053),ci=i(13064);function fi(k,Q){for(const i of k)for(const k of i.dataOutputs)if(k.uniqueId===Q)return k;throw new Error("Could not find data out connection with unique id "+Q)}function Yi(k,Q){for(const i of k)if(i instanceof li.d)for(const k of i.signalInputs)if(k.uniqueId===Q)return k;throw new Error("Could not find signal in connection with unique id "+Q)}async function yi(k,Q){const Z=await Promise.all(k.allBlocks.map((async k=>{const Q=function(k){switch(k){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([i.e(78),i.e(79)]).then(i.bind(i,14482))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await i.e(80).then(i.bind(i,14488))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await i.e(81).then(i.bind(i,14493))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await i.e(82).then(i.bind(i,14500))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await i.e(83).then(i.bind(i,14504))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await i.e(84).then(i.bind(i,14507))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await i.e(85).then(i.bind(i,14514))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await i.e(86).then(i.bind(i,14517))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await i.e(87).then(i.bind(i,14523))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await i.e(89).then(i.bind(i,14549))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await i.e(89).then(i.bind(i,14549))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await i.e(89).then(i.bind(i,14549))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await i.e(89).then(i.bind(i,14549))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await i.e(89).then(i.bind(i,14549))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await i.e(89).then(i.bind(i,14549))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await i.e(90).then(i.bind(i,14553))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await i.e(90).then(i.bind(i,14553))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await i.e(90).then(i.bind(i,14553))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await i.e(90).then(i.bind(i,14553))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await i.e(95).then(i.bind(i,14555))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await i.e(96).then(i.bind(i,14564))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await i.e(97).then(i.bind(i,14570))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await i.e(98).then(i.bind(i,14577))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await i.e(99).then(i.bind(i,14585))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await i.e(100).then(i.bind(i,14589))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await i.e(101).then(i.bind(i,14592))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await i.e(102).then(i.bind(i,14594))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await i.e(103).then(i.bind(i,14600))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await i.e(104).then(i.bind(i,14607))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await i.e(105).then(i.bind(i,14612))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await i.e(106).then(i.bind(i,14617))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await i.e(107).then(i.bind(i,14620))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await i.e(108).then(i.bind(i,14625))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await i.e(109).then(i.bind(i,14630))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await i.e(110).then(i.bind(i,14638))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await i.e(111).then(i.bind(i,14642))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await i.e(112).then(i.bind(i,14645))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await i.e(113).then(i.bind(i,14647))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await i.e(92).then(i.bind(i,14656))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await i.e(114).then(i.bind(i,14662))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await i.e(115).then(i.bind(i,14671))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await i.e(116).then(i.bind(i,14675))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await i.e(93).then(i.bind(i,14680))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await i.e(88).then(i.bind(i,14531))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await i.e(94).then(i.bind(i,14686))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await i.e(94).then(i.bind(i,14686))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await i.e(94).then(i.bind(i,14686))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await i.e(94).then(i.bind(i,14686))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await i.e(94).then(i.bind(i,14686))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await i.e(94).then(i.bind(i,14686))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await i.e(94).then(i.bind(i,14686))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await i.e(94).then(i.bind(i,14686))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await i.e(89).then(i.bind(i,14549))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await i.e(89).then(i.bind(i,14549))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await i.e(89).then(i.bind(i,14549))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await i.e(89).then(i.bind(i,14549))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await i.e(89).then(i.bind(i,14549))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await i.e(89).then(i.bind(i,14549))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await i.e(89).then(i.bind(i,14549))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await i.e(90).then(i.bind(i,14553))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await i.e(90).then(i.bind(i,14553))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await i.e(91).then(i.bind(i,14695))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await i.e(91).then(i.bind(i,14695))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await i.e(91).then(i.bind(i,14695))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await i.e(91).then(i.bind(i,14695))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await i.e(91).then(i.bind(i,14695))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await i.e(91).then(i.bind(i,14695))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await i.e(117).then(i.bind(i,14699))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await i.e(118).then(i.bind(i,14701))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await i.e(119).then(i.bind(i,14709))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await i.e(120).then(i.bind(i,14718))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await i.e(121).then(i.bind(i,14720))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await i.e(122).then(i.bind(i,14724))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await i.e(123).then(i.bind(i,14728))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await i.e(124).then(i.bind(i,14736))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await i.e(125).then(i.bind(i,14739))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await i.e(126).then(i.bind(i,14742))).FlowGraphDataSwitchBlock;default:if(zi[k])return zi[k];throw new Error(`Unknown block name ${k}`)}}(k.className);return await Q()})));return function(k,Q,i){const Z=Q.coordinator.createGraph(),U=[],C=Q.valueParseFunction??hi.d;for(let B=0;B<k.allBlocks.length;B++){const o=si(k.allBlocks[B],{lQ:Q.coordinator.config.lQ,pathConverter:Q.pathConverter,assetsContainer:Q.coordinator.config.lQ,valueParseFunction:C},i[B]);U.push(o),o instanceof Ei.d&&Z.addEventBlock(o)}for(const B of U){for(const k of B.dataInputs)for(const Q of k.connectedPointIds){const i=fi(U,Q);k.connectTo(i)}if(B instanceof li.d)for(const k of B.signalOutputs)for(const Q of k.connectedPointIds){const i=Yi(U,Q);k.connectTo(i)}}for(const B of k.executionContexts)Li(B,{graph:Z,valueParseFunction:C},k.rightHanded);return Z}(k,Q,Z)}function Li(k,Q,i){const Z=Q.graph.createContext();k.enableLogging&&(Z.enableLogging=!0),Z.treatDataAsRightHanded=i||!1;const U=Q.valueParseFunction??hi.d;Z.uniqueId=k.uniqueId;const C=Z.sk();if(k._assetsContext){var B,o,m,O,J,G,H,e,F,z;const Q=k._assetsContext,i={meshes:null===(B=Q.meshes)||void 0===B?void 0:B.map((k=>C.getMeshById(k))),lights:null===(o=Q.lights)||void 0===o?void 0:o.map((k=>C.getLightByName(k))),cameras:null===(m=Q.cameras)||void 0===m?void 0:m.map((k=>C.getCameraByName(k))),materials:null===(O=Q.materials)||void 0===O?void 0:O.map((k=>C.getMaterialById(k))),textures:null===(J=Q.textures)||void 0===J?void 0:J.map((k=>C.getTextureByName(k))),animations:null===(G=Q.animations)||void 0===G?void 0:G.map((k=>C.animations.find((Q=>Q.name===k)))),skeletons:null===(H=Q.skeletons)||void 0===H?void 0:H.map((k=>C.getSkeletonByName(k))),SG:null===(e=Q.SG)||void 0===e?void 0:e.map((k=>C.getParticleSystemById(k))),animationGroups:null===(F=Q.animationGroups)||void 0===F?void 0:F.map((k=>C.getAnimationGroupByName(k))),transformNodes:null===(z=Q.transformNodes)||void 0===z?void 0:z.map((k=>C.getTransformNodeById(k))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],sH:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};Z.assetsContext=i}for(const E in k._userVariables){const Q=U(E,k._userVariables,Z.assetsContext,C);Z.userVariables[E]=Q}for(const E in k._connectionValues){const Q=U(E,k._connectionValues,Z.assetsContext,C);Z._setConnectionValueByKey(E,Q)}return Z}function si(k,Q,i){const Z={},U=Q.valueParseFunction??hi.d;if(k.config)for(const B in k.config)Z[B]=U(B,k.config,Q.assetsContainer||Q.lQ,Q.lQ);if((0,hi.h)(k.className)){if(!Q.pathConverter)throw new Error("Path converter is required for this block");Z.pathConverter=Q.pathConverter}const C=new i(Z);C.uniqueId=k.uniqueId;for(let B=0;B<k.dataInputs.length;B++){const Q=C.getDataInput(k.dataInputs[B].name);if(!Q)throw new Error("Could not find data input with name "+k.dataInputs[B].name+" in block "+k.className);Q.deserialize(k.dataInputs[B])}for(let B=0;B<k.dataOutputs.length;B++){const Q=C.getDataOutput(k.dataOutputs[B].name);if(!Q)throw new Error("Could not find data output with name "+k.dataOutputs[B].name+" in block "+k.className);Q.deserialize(k.dataOutputs[B])}return C.metadata=k.metadata,C.deserialize&&C.deserialize(k),C}function ui(k){const[Q,i]=k.split(":");return ai({op:Q,extension:i})}function ai(k){var Q;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Z=k.extension?null===(Q=Ti[k.extension])||void 0===Q?void 0:Q[k.op]:Ki[k.op];if(!Z&&(z.c.Warn(`No mapping found for operation ${k.op} and extension ${k.extension||"KHR_interactivity"}`),i)){const Q={},i={flows:{}};if(k.inputValueSockets){Q.values={};for(const i in k.inputValueSockets)Q.values[i]={name:i}}return k.outputValueSockets&&(i.values={},Object.keys(k.outputValueSockets).forEach((k=>{i.values[k]={name:k}}))),{OJ:[],inputs:Q,outputs:i}}return Z}function ji(k,Q,i){Ti[Q]||(Ti[Q]={}),Ti[Q][k]=i}const Ti={BABYLON:{"flow/log":{OJ:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Ki={"event/onStart":{OJ:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{OJ:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{OJ:["FlowGraphSendCustomEventBlock"],extraProcessor(k,Q,i,Z,U){if("event/send"!==Q.op||!k.configuration||1!==Object.keys(k.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const C=k.configuration.event.value[0];if("number"!==typeof C)throw new Error("Event id should be a number");const B=Z.arrays.events[C],o=U[0];return o.config||(o.config={}),o.config.eventId=B.eventId,o.config.eventData=B.eventData,U}},"event/receive":{OJ:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(k,Q){var i;if(!k.configuration)return z.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const Z=k.configuration.event;if(!Z)return z.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const U=Z.value[0];if("number"!==typeof U)return z.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(i=Q.events)||void 0===i?void 0:i[U])?{valid:!0}:(z.c.Error(`Event with id ${U} not found`),{valid:!1,error:`Event with id ${U} not found`})},extraProcessor(k,Q,i,Z,U){if("event/receive"!==Q.op||!k.configuration||1!==Object.keys(k.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const C=k.configuration.event.value[0];if("number"!==typeof C)throw new Error("Event id should be a number");const B=Z.arrays.events[C],o=U[0];return o.config||(o.config={}),o.config.eventId=B.eventId,o.config.eventData=B.eventData,U}},"math/e":vi("FlowGraphEBlock"),"math/pi":vi("FlowGraphPIBlock"),"math/inf":vi("FlowGraphInfBlock"),"math/nan":vi("FlowGraphNaNBlock"),"math/abs":vi("FlowGraphAbsBlock"),"math/sign":vi("FlowGraphSignBlock"),"math/trunc":vi("FlowGraphTruncBlock"),"math/floor":vi("FlowGraphFloorBlock"),"math/ceil":vi("FlowGraphCeilBlock"),"math/round":{OJ:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,Q,i,Z,U){var C;return(C=U[0]).config||(C.config={}),U[0].config.roundHalfAwayFromZero=!0,U}},"math/fract":vi("FlowGraphFractBlock"),"math/neg":vi("FlowGraphNegationBlock"),"math/add":vi("FlowGraphAddBlock",["a","b"],!0),"math/sub":vi("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{OJ:["FlowGraphMultiplyBlock"],extraProcessor(k,Q,i,Z,U){var C;(C=U[0]).config||(C.config={}),U[0].config.useMatrixPerComponent=!0,U[0].config.preventIntegerFloatArithmetic=!0;let B=-1;return Object.keys(k.values||{}).find((Q=>{var i;return void 0!==(null===(i=k.values)||void 0===i?void 0:i[Q].type)&&(B=k.values[Q].type,!0)})),-1!==B&&(U[0].config.type=Z.arrays.types[B].flowGraphType),U},validation:k=>k.values?Ni(k):{valid:!0}},"math/div":vi("FlowGraphDivideBlock",["a","b"],!0),"math/rem":vi("FlowGraphModuloBlock",["a","b"]),"math/min":vi("FlowGraphMinBlock",["a","b"]),"math/max":vi("FlowGraphMaxBlock",["a","b"]),"math/clamp":vi("FlowGraphClampBlock",["a","b","c"]),"math/saturate":vi("FlowGraphSaturateBlock"),"math/mix":vi("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":vi("FlowGraphEqualityBlock",["a","b"]),"math/lt":vi("FlowGraphLessThanBlock",["a","b"]),"math/le":vi("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":vi("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":vi("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":vi("FlowGraphIsNaNBlock"),"math/isinf":vi("FlowGraphIsInfBlock"),"math/select":{OJ:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{OJ:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":vi("FlowGraphSinBlock"),"math/cos":vi("FlowGraphCosBlock"),"math/tan":vi("FlowGraphTanBlock"),"math/asin":vi("FlowGraphASinBlock"),"math/acos":vi("FlowGraphACosBlock"),"math/atan":vi("FlowGraphATanBlock"),"math/atan2":vi("FlowGraphATan2Block",["a","b"]),"math/sinh":vi("FlowGraphSinhBlock"),"math/cosh":vi("FlowGraphCoshBlock"),"math/tanh":vi("FlowGraphTanhBlock"),"math/asinh":vi("FlowGraphASinhBlock"),"math/acosh":vi("FlowGraphACoshBlock"),"math/atanh":vi("FlowGraphATanhBlock"),"math/exp":vi("FlowGraphExponentialBlock"),"math/log":vi("FlowGraphLogBlock"),"math/log2":vi("FlowGraphLog2Block"),"math/log10":vi("FlowGraphLog10Block"),"math/sqrt":vi("FlowGraphSquareRootBlock"),"math/cbrt":vi("FlowGraphCubeRootBlock"),"math/pow":vi("FlowGraphPowerBlock",["a","b"]),"math/length":vi("FlowGraphLengthBlock"),"math/normalize":vi("FlowGraphNormalizeBlock"),"math/dot":vi("FlowGraphDotBlock",["a","b"]),"math/cross":vi("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":vi("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":vi("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{OJ:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{OJ:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{OJ:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{OJ:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{OJ:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{OJ:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{OJ:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":vi("FlowGraphTransposeBlock"),"math/determinant":vi("FlowGraphDeterminantBlock"),"math/inverse":vi("FlowGraphInvertMatrixBlock"),"math/matmul":vi("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{OJ:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Ho",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,Q,i,Z,U,C){const B=U[0].dataInputs.find((k=>"rotationQuaternion"===k.name));if(!B)throw new Error("Rotation quaternion input not found");return C._connectionValues[B.uniqueId]&&(C._connectionValues[B.uniqueId].type="Quaternion"),U}},"math/matDecompose":{OJ:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Ho"}}}},"math/quatConjugate":vi("FlowGraphConjugateBlock",["a"]),"math/quatMul":{OJ:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,Q,i,Z,U){var C;return(C=U[0]).config||(C.config={}),U[0].config.type="Quaternion",U}},"math/quatAngleBetween":vi("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{OJ:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":vi("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":vi("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{OJ:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,Q,i,Z,U){var C;return(C=U[0]).config||(C.config={}),U[0].config.inputIsColumnMajor=!0,U}},"math/extract2x2":{OJ:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{OJ:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,Q,i,Z,U){var C;return(C=U[0]).config||(C.config={}),U[0].config.inputIsColumnMajor=!0,U}},"math/extract3x3":{OJ:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{OJ:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,Q,i,Z,U){var C;return(C=U[0]).config||(C.config={}),U[0].config.inputIsColumnMajor=!0,U}},"math/extract4x4":{OJ:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{OJ:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,Q,i,Z,U,C){var B,o;(o=U[0]).config||(o.config={});const m=U[0].dataInputs[0];return U[0].config.valueType=(null===(B=C._connectionValues[m.uniqueId])||void 0===B?void 0:B.type)??"FlowGraphInteger",U}},"math/and":{OJ:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,Q,i,Z,U,C){var B,o,m;(m=U[0]).config||(m.config={});const O=U[0].dataInputs[0],J=U[0].dataInputs[1];return U[0].config.valueType=(null===(B=C._connectionValues[O.uniqueId])||void 0===B?void 0:B.type)??(null===(o=C._connectionValues[J.uniqueId])||void 0===o?void 0:o.type)??"FlowGraphInteger",U}},"math/or":{OJ:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,Q,i,Z,U,C){var B,o,m;(m=U[0]).config||(m.config={});const O=U[0].dataInputs[0],J=U[0].dataInputs[1];return U[0].config.valueType=(null===(B=C._connectionValues[O.uniqueId])||void 0===B?void 0:B.type)??(null===(o=C._connectionValues[J.uniqueId])||void 0===o?void 0:o.type)??"FlowGraphInteger",U}},"math/xor":{OJ:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,Q,i,Z,U,C){var B,o,m;(m=U[0]).config||(m.config={});const O=U[0].dataInputs[0],J=U[0].dataInputs[1];return U[0].config.valueType=(null===(B=C._connectionValues[O.uniqueId])||void 0===B?void 0:B.type)??(null===(o=C._connectionValues[J.uniqueId])||void 0===o?void 0:o.type)??"FlowGraphInteger",U}},"math/asr":vi("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":vi("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":vi("FlowGraphLeadingZerosBlock"),"math/ctz":vi("FlowGraphTrailingZerosBlock"),"math/popcnt":vi("FlowGraphOneBitsCounterBlock"),"math/rad":vi("FlowGraphDegToRadBlock"),"math/deg":vi("FlowGraphRadToDegBlock"),"type/boolToInt":vi("FlowGraphBooleanToInt"),"type/boolToFloat":vi("FlowGraphBooleanToFloat"),"type/intToBool":vi("FlowGraphIntToBoolean"),"type/intToFloat":vi("FlowGraphIntToFloat"),"type/floatToInt":vi("FlowGraphFloatToInt"),"type/floatToBool":vi("FlowGraphFloatToBoolean"),"flow/sequence":{OJ:["FlowGraphSequenceBlock"],extraProcessor(k,Q,i,Z,U){const C=U[0];return C.config||(C.config={}),C.config.outputSignalCount=Object.keys(k.flows||[]).length,C.signalOutputs.forEach(((k,Q)=>{k.name="out_"+Q})),U}},"flow/branch":{OJ:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{OJ:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(k){if(k.configuration&&k.configuration.cases){const Q=k.configuration.cases.value;if(!Q.every((k=>"number"===typeof k&&/^-?\d+$/.test(k.toString()))))return z.c.Warn("Switch cases should be integers. Using empty array instead."),k.configuration.cases.value=[],{valid:!0};const i=new Set(Q);k.configuration.cases.value=Array.from(i)}return{valid:!0}},extraProcessor(k,Q,i,Z,U){if("flow/switch"!==Q.op||!k.flows||0===Object.keys(k.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return U[0].signalOutputs.forEach((k=>{"default"!==k.name&&(k.name="out_"+k.name)})),U}},"flow/while":{OJ:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{OJ:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(k,Q,i,Z,U){const C=U[0];return C.config||(C.config={}),C.config.incrementIndexWhenLoopDone=!0,U}},"flow/doN":{OJ:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{OJ:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(k,Q,i,Z,U){if("flow/multiGate"!==Q.op||!k.flows||0===Object.keys(k.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const C=U[0];return C.config||(C.config={}),C.config.outputSignalCount=Object.keys(k.flows).length,C.signalOutputs.forEach(((k,Q)=>{k.name="out_"+Q})),U}},"flow/waitAll":{OJ:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(k){var Q,i;return"number"!==typeof(null===(Q=k.configuration)||void 0===Q||null===(i=Q.inputFlows)||void 0===i?void 0:i.value[0])&&(k.configuration=k.configuration||{inputFlows:{value:[0]}},k.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{OJ:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{OJ:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{OJ:["FlowGraphCancelDelayBlock"]},"variable/get":{OJ:["FlowGraphGetVariableBlock"],validation(k){var Q,i;return null!==(Q=k.configuration)&&void 0!==Q&&null!==(i=Q.variable)&&void 0!==i&&i.value?{valid:!0}:(z.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(k,Q)=>[Q.getVariableName(k[0])]}}},"variable/set":{OJ:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(k,Q)=>[Q.getVariableName(k[0])]}}},"variable/setMultiple":{OJ:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(k,Q)=>[k[0].map((k=>Q.getVariableName(k)))]}},extraProcessor:(k,Q,i,Z,U)=>(U[0].dataInputs.forEach((k=>{k.name=Z.getVariableName(+k.name)})),U)},"variable/interpolate":{OJ:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(k,Q)=>[Q.getVariableName(k[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:k=>!0===k[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Ti:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Ti:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Ti:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Ti:"FlowGraphPlayAnimationBlock"},out:{name:"out",Ti:"FlowGraphPlayAnimationBlock"},done:{name:"done",Ti:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(k,Q,i,Z,U){var C,B,o;const m=U[0],O=null===(C=k.configuration)||void 0===C?void 0:C.variable.value[0];if("number"!==typeof O)throw z.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const J=Z.arrays.staticVariables[O];"undefined"===typeof m.config.animationType.value&&(Z.arrays.staticVariables,m.config.animationType.value=(0,ci.G)(J.type));const G=U[4];return G.config||(G.config={}),(B=G.config).variable||(B.variable={}),G.config.variable.value=Z.getVariableName(O),(o=U[3]).config||(o.config={}),U}},"pointer/get":{OJ:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Ti:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Ti:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(k,Q,i,Z,U)=>(U.forEach((k=>{"FlowGraphJsonPointerParserBlock"===k.className&&(k.config||(k.config={}),k.config.outputValue=!0)})),U)},"pointer/set":{OJ:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Ti:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Ti:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(k,Q,i,Z,U)=>(U.forEach((k=>{"FlowGraphJsonPointerParserBlock"===k.className&&(k.config||(k.config={}),k.config.outputValue=!0)})),U)},"pointer/interpolate":{OJ:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Ti:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Ti:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Ti:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Ti:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Ti:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Ti:"FlowGraphPlayAnimationBlock"},out:{name:"out",Ti:"FlowGraphPlayAnimationBlock"},done:{name:"done",Ti:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(k,Q,i,Z,U)=>(U.forEach((Q=>{"FlowGraphJsonPointerParserBlock"===Q.className?(Q.config||(Q.config={}),Q.config.outputValue=!0):"FlowGraphInterpolationBlock"===Q.className&&(Q.config||(Q.config={}),Object.keys(k.values||[]).forEach((i=>{var U;const C=null===(U=k.values)||void 0===U?void 0:U[i];if("value"===i&&C){const k=C.type;void 0!==k&&(Q.config.animationType=Z.arrays.types[k].flowGraphType)}})))})),U)},"animation/start":{OJ:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Ti:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(k,Q)=>[k[0]*Q._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(k,Q)=>[k[0]*Q._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(k,Q,i,Z,U,C,B){const o=U[U.length-1];return o.config||(o.config={}),o.config.glTF=B,U}},"animation/stop":{OJ:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Ti:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(k,Q,i,Z,U,C,B){const o=U[U.length-1];return o.config||(o.config={}),o.config.glTF=B,U}},"animation/stopAt":{OJ:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Ti:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(k,Q)=>[k[0]*Q._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(k,Q,i,Z,U,C,B){const o=U[U.length-1];return o.config||(o.config={}),o.config.glTF=B,U}},"math/switch":{OJ:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(k){if(k.configuration&&k.configuration.cases){const Q=k.configuration.cases.value;if(!Q.every((k=>"number"===typeof k&&/^-?\d+$/.test(k.toString()))))return z.c.Warn("Switch cases should be integers. Using empty array instead."),k.configuration.cases.value=[],{valid:!0};const i=new Set(Q);k.configuration.cases.value=Array.from(i)}return{valid:!0}},extraProcessor(k,Q,i,Z,U){const C=U[0];return C.dataInputs.forEach((k=>{"default"!==k.name&&"case"!==k.name&&(k.name="in_"+k.name)})),C.config||(C.config={}),C.config.treatCasesAsIntegers=!0,U}},"debug/log":{OJ:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function vi(k){let Q=arguments.length>2?arguments[2]:void 0;return{OJ:[k],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((k,Q)=>(k[Q]={name:Q},k)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(k,i,Z,U,C){var B;if(Q){(B=C[0]).config||(B.config={}),C[0].config.preventIntegerFloatArithmetic=!0;let Q=-1;Object.keys(k.values||{}).find((i=>{var Z;return void 0!==(null===(Z=k.values)||void 0===Z?void 0:Z[i].type)&&(Q=k.values[i].type,!0)})),-1!==Q&&(C[0].config.type=U.arrays.types[Q].flowGraphType)}return C},validation:k=>Q?Ni(k):{valid:!0}}}function Ni(k){if(k.values){const Q=Object.keys(k.values).map((Q=>k.values[Q].type)).filter((k=>void 0!==k));if(!Q.every((k=>k===Q[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Ki["math/compose"]=Ki["math/matCompose"],Ki["math/decompose"]=Ki["math/matDecompose"];var Xi=i(11255);const pi={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"zQ",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class di{constructor(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=k,this._gltf=Q,this._animationTargetFps=i,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const k of this._interactivityGraph.types)this._types.push(pi[k.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const k of this._interactivityGraph.declarations){const Q=ai(k);if(!Q)throw z.c.Error(["No mapping found for declaration",k]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:Q,fullOperationName:k.extension?k.op+":"+k.extension:k.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const k of this._interactivityGraph.variables){const Q=this._parseVariable(k);this._staticVariables.push(Q)}}_parseVariable(k,Q){const i=this._types[k.type];if(!i)throw z.c.Error(["No type found for variable",k]),new Error("Error parsing variables");if(k.value&&k.value.length!==i.length)throw z.c.Error(["Invalid value length for variable",k,i]),new Error("Error parsing variables");const Z=k.value||[];if(!Z.length)switch(i.flowGraphType){case"boolean":Z.push(!1);break;case"FlowGraphInteger":Z.push(0);break;case"number":Z.push(NaN);break;case"Vector2":Z.push(NaN,NaN);break;case"zQ":Z.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":Z.fill(NaN,0,4);break;case"Matrix":Z.fill(NaN,0,16);break;case"Matrix3D":Z.fill(NaN,0,9)}return"number"===i.elementType&&"string"===typeof Z[0]&&(Z[0]=parseFloat(Z[0])),{type:i.flowGraphType,value:Q?Q(Z,this):Z}}_parseEvents(){if(this._interactivityGraph.events)for(const k of this._interactivityGraph.events){const Q={eventId:k.id||"internalEvent_"+this._internalEventsCounter++};k.values&&(Q.eventData=Object.keys(k.values).map((Q=>{var i;const Z=null===(i=k.values)||void 0===i?void 0:i[Q];if(!Z)throw z.c.Error(["No value found for event key",Q]),new Error("Error parsing events");const U=this._types[Z.type];if(!U)throw z.c.Error(["No type found for event value",Z]),new Error("Error parsing events");const C="undefined"!==typeof Z.value?this._parseVariable(Z):void 0;return{id:Q,type:U.flowGraphType,eventData:!0,value:C}}))),this._events.push(Q)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const Q of this._interactivityGraph.nodes){if("number"!==typeof Q.declaration)throw z.c.Error(["No declaration found for node",Q]),new Error("Error parsing nodes");const i=this._mappings[Q.declaration];if(!i)throw z.c.Error(["No mapping found for node",Q]),new Error("Error parsing nodes");if(i.flowGraphMapping.validation){const Z=i.flowGraphMapping.validation(Q,this._interactivityGraph,this._gltf);var k;if(!Z.valid)throw new Error(`Error validating interactivity node ${null===(k=this._interactivityGraph.declarations)||void 0===k?void 0:k[Q.declaration].op} - ${Z.error}`)}const Z=[];for(const k of i.flowGraphMapping.OJ){const U=this._getEmptyBlock(k,i.fullOperationName);this._parseNodeConfiguration(Q,U,i.flowGraphMapping,k),Z.push(U)}this._nodes.push({OJ:Z,fullOperationName:i.fullOperationName})}}_getEmptyBlock(k,Q){return{uniqueId:(0,Xi.b)(),className:k,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:Q,metadata:{}}}_parseNodeConfiguration(k,Q,i,Z){const U=Q.config;if(k.configuration){const Q=Object.keys(k.configuration);for(const o of Q){var C,B;const Q=null===(C=k.configuration)||void 0===C?void 0:C[o];if(!Q)throw z.c.Error(["No value found for node configuration",o]),new Error("Error parsing node configuration");const m=null===(B=i.configuration)||void 0===B?void 0:B[o];if(m&&m.Ti?m.Ti===Z:0===i.OJ.indexOf(Z)){const k=(null===m||void 0===m?void 0:m.name)||o;Q&&"undefined"!==typeof Q.value||"undefined"===typeof(null===m||void 0===m?void 0:m.defaultValue)?Q.value.length>=0?U[k]={value:1===Q.value.length?Q.value[0]:Q.value}:z.c.Warn(["Invalid value for node configuration",Q]):U[k]={value:m.defaultValue},m&&m.dataTransformer&&(U[k].value=m.dataTransformer([U[k].value],this)[0])}}}}_parseNodeConnections(k){for(let y=0;y<this._nodes.length;y++){var Q;const L=null===(Q=this._interactivityGraph.nodes)||void 0===Q?void 0:Q[y];if(!L)throw z.c.Error(["No node found for interactivity node",this._nodes[y]]),new Error("Error parsing node connections");const s=this._nodes[y],u=this._mappings[L.declaration];if(!u)throw z.c.Error(["No mapping found for node",L]),new Error("Error parsing node connections");const a=L.flows||{},j=Object.keys(a).sort();for(const k of j){var i,Z,U,C;const Q=a[k],O=null===(i=u.flowGraphMapping.outputs)||void 0===i||null===(Z=i.flows)||void 0===Z?void 0:Z[k],J=(null===O||void 0===O?void 0:O.name)||k,G=this._createNewSocketConnection(J,!0);(O&&O.Ti&&s.OJ.find((k=>k.className===O.Ti))||s.OJ[0]).signalOutputs.push(G);const H=Q.node,e=this._nodes[H];if(!e)throw z.c.Error(["No node found for input node id",H]),new Error("Error parsing node connections");const F=ui(e.fullOperationName);if(!F)throw z.c.Error(["No mapping found for input node",e]),new Error("Error parsing node connections");let E=null===(U=F.inputs)||void 0===U||null===(C=U.flows)||void 0===C?void 0:C[Q.socket||"in"],l=!1;if(!E)for(const k in null===(B=F.inputs)||void 0===B?void 0:B.flows){var B,o,m;if(k.startsWith("[")&&k.endsWith("]"))l=!0,E=null===(o=F.inputs)||void 0===o||null===(m=o.flows)||void 0===m?void 0:m[k]}const h=E?l?E.name.replace("$1",Q.socket||""):E.name:Q.socket||"in",c=E&&E.Ti&&e.OJ.find((k=>k.className===E.Ti))||e.OJ[0];let f=c.signalInputs.find((k=>k.name===h));f||(f=this._createNewSocketConnection(h),c.signalInputs.push(f)),f.connectedPointIds.push(G.uniqueId),G.connectedPointIds.push(f.uniqueId)}const T=L.values||{},K=Object.keys(T);for(const Q of K){var O,J;const i=T[Q];let Z=null===(O=u.flowGraphMapping.inputs)||void 0===O||null===(J=O.values)||void 0===J?void 0:J[Q],U=!1;if(!Z)for(const k in null===(G=u.flowGraphMapping.inputs)||void 0===G?void 0:G.values){var G,H,e;if(k.startsWith("[")&&k.endsWith("]"))U=!0,Z=null===(H=u.flowGraphMapping.inputs)||void 0===H||null===(e=H.values)||void 0===e?void 0:e[k]}const C=Z?U?Z.name.replace("$1",Q):Z.name:Q,B=this._createNewSocketConnection(C);if((Z&&Z.Ti&&s.OJ.find((k=>k.className===Z.Ti))||s.OJ[0]).dataInputs.push(B),void 0!==i.value){const Q=this._parseVariable(i,Z&&Z.dataTransformer);k._connectionValues[B.uniqueId]=Q}else{if("undefined"===typeof i.node)throw z.c.Error(["Invalid value for value connection",i]),new Error("Error parsing node connections");{var F,E,l;const k=i.node,Q=i.socket||"value",Z=this._nodes[k];if(!Z)throw z.c.Error(["No node found for output socket reference",i]),new Error("Error parsing node connections");const U=ui(Z.fullOperationName);if(!U)throw z.c.Error(["No mapping found for output socket reference",i]),new Error("Error parsing node connections");let C=null===(F=U.outputs)||void 0===F||null===(E=F.values)||void 0===E?void 0:E[Q],o=!1;if(!C)for(const i in null===(h=U.outputs)||void 0===h?void 0:h.values){var h,c,f;if(i.startsWith("[")&&i.endsWith("]"))o=!0,C=null===(c=U.outputs)||void 0===c||null===(f=c.values)||void 0===f?void 0:f[i]}const m=C?o?C.name.replace("$1",Q):null===(l=C)||void 0===l?void 0:l.name:Q,O=C&&C.Ti&&Z.OJ.find((k=>k.className===C.Ti))||Z.OJ[0];let J=O.dataOutputs.find((k=>k.name===m));J||(J=this._createNewSocketConnection(m,!0),O.dataOutputs.push(J)),B.connectedPointIds.push(J.uniqueId),J.connectedPointIds.push(B.uniqueId)}}}if(u.flowGraphMapping.interBlockConnectors)for(const k of u.flowGraphMapping.interBlockConnectors){const Q=k.input,i=k.output,Z=k.isVariable;this._connectFlowGraphNodes(Q,i,s.OJ[k.inputBlockIndex],s.OJ[k.outputBlockIndex],Z)}if(u.flowGraphMapping.extraProcessor){var Y;const Q=null===(Y=this._interactivityGraph.declarations)||void 0===Y?void 0:Y[L.declaration];if(!Q)throw z.c.Error(["No declaration found for extra processor",L]),new Error("Error parsing node connections");s.OJ=u.flowGraphMapping.extraProcessor(L,Q,u.flowGraphMapping,this,s.OJ,k,this._gltf)}}}_createNewSocketConnection(k,Q){return{uniqueId:(0,Xi.b)(),name:k,_connectionType:Q?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(k,Q,i,Z,U){const C=U?i.dataInputs:i.signalInputs,B=U?Z.dataOutputs:Z.signalOutputs,o=C.find((Q=>Q.name===k))||this._createNewSocketConnection(k),m=B.find((k=>k.name===Q))||this._createNewSocketConnection(Q,!0);C.find((Q=>Q.name===k))||C.push(o),B.find((k=>k.name===Q))||B.push(m),o.connectedPointIds.push(m.uniqueId),m.connectedPointIds.push(o.uniqueId)}getVariableName(k){return"staticVariable_"+k}serializeToFlowGraph(){const k={uniqueId:(0,Xi.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(k);for(let Q=0;Q<this._staticVariables.length;Q++){const i=this._staticVariables[Q];k._userVariables[this.getVariableName(Q)]=i}return{rightHanded:!0,allBlocks:this._nodes.reduce(((k,Q)=>k.concat(Q.OJ)),[]),executionContexts:[k]}}}const bi="KHR_interactivity";class Di{constructor(k){this._loader=k,this.name=bi,this.enabled=this._loader.isExtensionUsed(bi),this._pathConverter=(0,M.l)(this._loader.XC),k._skipStartAnimationStep=!0;const Q=k.babylonScene;Q&&function(k){(0,M.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!k.activeCamera)return new U.Quaternion(NaN,NaN,NaN,NaN);const Q=U.Quaternion.FromRotationMatrix(k.activeCamera.getWorldMatrix()).normalize();return k.useRightHandedSystem||(Q.w*=-1,Q.x*=-1),Q},type:"Quaternion",getTarget:()=>k.activeCamera}),(0,M.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!k.activeCamera)return new U.zQ(NaN,NaN,NaN);const Q=k.activeCamera.getWorldMatrix().getTranslation();return k.useRightHandedSystem||(Q.x*=-1),Q},type:"zQ",getTarget:()=>k.activeCamera}),(0,M.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:k=>{var Q;return(null===(Q=k._babylonAnimationGroup)||void 0===Q?void 0:Q.isPlaying)??!1},type:"boolean",getTarget:k=>k._babylonAnimationGroup}),(0,M.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:k=>{var Q;return((null===(Q=k._babylonAnimationGroup)||void 0===Q?void 0:Q.from)??0)/60},type:"number",getTarget:k=>k._babylonAnimationGroup}),(0,M.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:k=>{var Q;return((null===(Q=k._babylonAnimationGroup)||void 0===Q?void 0:Q.to)??0)/60},type:"number",getTarget:k=>k._babylonAnimationGroup}),(0,M.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:k=>{var Q;return((null===(Q=k._babylonAnimationGroup)||void 0===Q?void 0:Q.getCurrentFrame())??0)/60},type:"number",getTarget:k=>k._babylonAnimationGroup}),(0,M.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:k=>{var Q;return((null===(Q=k._babylonAnimationGroup)||void 0===Q?void 0:Q.getCurrentFrame())??0)/60},type:"number",getTarget:k=>k._babylonAnimationGroup})}(Q)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var k;if(!this._loader.babylonScene||!this._pathConverter)return;const Q=this._loader.babylonScene,i=null===(k=this._loader.XC.extensions)||void 0===k?void 0:k.KHR_interactivity;if(!i)return;const Z=new Fi.c({lQ:Q});Z.dispatchEventsSynchronously=!1;const U=i.graphs.map((k=>new di(k,this._loader.XC,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(U.map((async k=>await yi(k,{coordinator:Z,pathConverter:this._pathConverter})))),Z.start()}}var Mi;Mi=async()=>(await Promise.resolve().then(i.bind(i,13120))).FlowGraphGLTFDataProvider,zi[`${bi}/${"FlowGraphGLTFDataProvider"}`]=Mi,D(bi),b(bi,!0,(k=>new Di(k)));const Wi="KHR_node_visibility";(0,M.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:k=>{const Q=k._babylonTransformNode;return!Q||void 0===Q.isVisible||Q.isVisible},set:(k,Q)=>{var i,Z;null===(i=Q._primitiveBabylonMeshes)||void 0===i||i.forEach((k=>{k.inheritVisibility=!0})),Q._babylonTransformNode&&(Q._babylonTransformNode.isVisible=k),null===(Z=Q._primitiveBabylonMeshes)||void 0===Z||Z.forEach((Q=>{Q.isVisible=k}))},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Ai{constructor(k){this.name=Wi,this._loader=k,this.enabled=k.isExtensionUsed(Wi)}async onReady(){var k;null===(k=this._loader.XC.nodes)||void 0===k||k.forEach((k=>{var Q,i,Z,U;(null===(Q=k._primitiveBabylonMeshes)||void 0===Q||Q.forEach((k=>{k.inheritVisibility=!0})),null!==(i=k.extensions)&&void 0!==i&&i.KHR_node_visibility)&&(!1===(null===(Z=k.extensions)||void 0===Z?void 0:Z.KHR_node_visibility.visible)&&(k._babylonTransformNode&&(k._babylonTransformNode.isVisible=!1),null===(U=k._primitiveBabylonMeshes)||void 0===U||U.forEach((k=>{k.isVisible=!1}))))}))}dispose(){this._loader=null}}D(Wi),b(Wi,!0,(k=>new Ai(k)));const gi="KHR_node_selectability";ji("event/onSelect",gi,{OJ:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ti:"FlowGraphGetVariableBlock",dataTransformer:k=>["pickedMesh_"+k[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Ti:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(k,Q,i,Z,U,C,B){var o,m,O,J,G,H;const e=U[U.length-1];e.config=e.config||{},e.config.glTF=B;const F=null===(o=k.configuration)||void 0===o||null===(m=o.nodeIndex)||void 0===m?void 0:m.value[0];if(void 0===F||"number"!==typeof F)throw new Error("nodeIndex not found in configuration");const z="pickedMesh_"+F;return U[1].config.variable=z,C._userVariables[z]={className:"Mesh",id:null===B||void 0===B||null===(O=B.nodes)||void 0===O||null===(J=O[F]._babylonTransformNode)||void 0===J?void 0:J.id,uniqueId:null===B||void 0===B||null===(G=B.nodes)||void 0===G||null===(H=G[F]._babylonTransformNode)||void 0===H?void 0:H.uniqueId},U}}),(0,M.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:k=>{const Q=k._babylonTransformNode;return!Q||void 0===Q.pm||Q.pm},set:(k,Q)=>{var i;null===(i=Q._primitiveBabylonMeshes)||void 0===i||i.forEach((Q=>{Q.pm=k}))},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"pm"],type:"boolean"});class Ri{constructor(k){this.name=gi,this._loader=k,this.enabled=k.isExtensionUsed(gi)}async onReady(){var k;null===(k=this._loader.XC.nodes)||void 0===k||k.forEach((k=>{var Q,i,Z;null!==(Q=k.extensions)&&void 0!==Q&&Q.KHR_node_selectability&&!1===(null===(i=k.extensions)||void 0===i?void 0:i.KHR_node_selectability.selectable)&&(null===(Z=k._babylonTransformNode)||void 0===Z||Z.getChildMeshes().forEach((k=>{k.pm=!1})))}))}dispose(){this._loader=null}}D(gi),b(gi,!0,(k=>new Ri(k)));const wi="KHR_node_hoverability",Si="targetMeshPointerOver_";ji("event/onHoverIn",wi,{OJ:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ti:"FlowGraphGetVariableBlock",dataTransformer:k=>[Si+k[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Ti:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(k,Q,i,Z,U,C,B){var o,m,O,J,G,H;const e=U[U.length-1];e.config=e.config||{},e.config.glTF=B;const F=null===(o=k.configuration)||void 0===o||null===(m=o.nodeIndex)||void 0===m?void 0:m.value[0];if(void 0===F||"number"!==typeof F)throw new Error("nodeIndex not found in configuration");const z=Si+F;return U[1].config.variable=z,C._userVariables[z]={className:"Mesh",id:null===B||void 0===B||null===(O=B.nodes)||void 0===O||null===(J=O[F]._babylonTransformNode)||void 0===J?void 0:J.id,uniqueId:null===B||void 0===B||null===(G=B.nodes)||void 0===G||null===(H=G[F]._babylonTransformNode)||void 0===H?void 0:H.uniqueId},U}});const qi="targetMeshPointerOut_";ji("event/onHoverOut",wi,{OJ:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ti:"FlowGraphGetVariableBlock",dataTransformer:k=>[qi+k[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Ti:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(k,Q,i,Z,U,C,B){var o,m,O,J,G,H;const e=U[U.length-1];e.config=e.config||{},e.config.glTF=B;const F=null===(o=k.configuration)||void 0===o||null===(m=o.nodeIndex)||void 0===m?void 0:m.value[0];if(void 0===F||"number"!==typeof F)throw new Error("nodeIndex not found in configuration");const z=qi+F;return U[1].config.variable=z,C._userVariables[z]={className:"Mesh",id:null===B||void 0===B||null===(O=B.nodes)||void 0===O||null===(J=O[F]._babylonTransformNode)||void 0===J?void 0:J.id,uniqueId:null===B||void 0===B||null===(G=B.nodes)||void 0===G||null===(H=G[F]._babylonTransformNode)||void 0===H?void 0:H.uniqueId},U}}),(0,M.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:k=>{const Q=k._babylonTransformNode;return!Q||void 0===Q.pointerOverDisableMeshTesting||Q.pointerOverDisableMeshTesting},set:(k,Q)=>{var i;null===(i=Q._primitiveBabylonMeshes)||void 0===i||i.forEach((Q=>{Q.pointerOverDisableMeshTesting=!k}))},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Pi{constructor(k){this.name=wi,this._loader=k,this.enabled=k.isExtensionUsed(wi)}async onReady(){var k;null===(k=this._loader.XC.nodes)||void 0===k||k.forEach((k=>{var Q,i,Z;null!==(Q=k.extensions)&&void 0!==Q&&Q.KHR_node_hoverability&&!1===(null===(i=k.extensions)||void 0===i?void 0:i.KHR_node_hoverability.hoverable)&&(null===(Z=k._babylonTransformNode)||void 0===Z||Z.getChildMeshes().forEach((k=>{k.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}D(wi),b(wi,!0,(k=>new Pi(k)));const ti="ExtrasAsMetadata";class Ii{_assignExtras(k,Q){if(Q.extras&&Object.keys(Q.extras).length>0){const i=k.metadata=k.metadata||{};(i.XC=i.XC||{}).extras=Q.extras}}constructor(k){this.name=ti,this.enabled=!0,this._loader=k}dispose(){this._loader=null}loadNodeAsync(k,Q,i){return this._loader.loadNodeAsync(k,Q,(k=>{this._assignExtras(k,Q),i(k)}))}loadCameraAsync(k,Q,i){return this._loader.loadCameraAsync(k,Q,(k=>{this._assignExtras(k,Q),i(k)}))}createMaterial(k,Q,i){const Z=this._loader.createMaterial(k,Q,i);return this._assignExtras(Z,Q),Z}}D(ti),b(ti,!1,(k=>new Ii(k)));i(13120)},12991:(k,Q,i)=>{"use strict";i.d(Q,{e:()=>N,h:()=>u,k:()=>s,o:()=>a});var Z=i(11122),U=i(11119),C=i(12601),B=i(11734),o=i(11702),m=i(11712),O=i(11134),J=i(11157),G=i(11732),H=i(11826),e=i(11740),F=i(11341);class z{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.SG=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.sH=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(k){this._environmentTexture=k}getNodes(){let k=[];k=k.concat(this.meshes),k=k.concat(this.lights),k=k.concat(this.cameras),k=k.concat(this.transformNodes);for(const Q of this.skeletons)k=k.concat(Q.bones);return k}}class E extends z{}class l{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const k=this.rootNodes;for(const Z of k)Z.dispose();k.length=0;const Q=this.skeletons;for(const Z of Q)Z.dispose();Q.length=0;const i=this.animationGroups;for(const Z of i)Z.dispose();i.length=0}}class h extends z{constructor(k){super(),this._wasAddedToScene=!1,(k=k||J.b.LastCreatedScene)&&(this.lQ=k,this.proceduralTextures=[],k.gi.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=k.getEngine().onContextRestoredObservable.add((()=>{for(const k of this.geometries)k._rebuild();for(const k of this.meshes)k._rebuild();for(const k of this.SG)k.rebuild();for(const k of this.textures)k._rebuild()})))}_topologicalSort(k){const Q=new Map;for(const B of k)Q.set(B.uniqueId,B);const i={dependsOn:new Map,dependedBy:new Map};for(const B of k){const k=B.uniqueId;i.dependsOn.set(k,new Set),i.dependedBy.set(k,new Set)}for(const B of k){const k=B.uniqueId,Z=i.dependsOn.get(k);if(B instanceof G.d){const U=B.sourceMesh;Q.has(U.uniqueId)&&(Z.add(U.uniqueId),i.dependedBy.get(U.uniqueId).add(k))}const U=i.dependedBy.get(k);for(const C of B.getDescendants()){const Z=C.uniqueId;if(Q.has(Z)){U.add(Z);i.dependsOn.get(Z).add(k)}}}const Z=[],U=[];for(const B of k){const k=B.uniqueId;0===i.dependsOn.get(k).size&&(U.push(B),Q.delete(k))}const C=U;for(;C.length>0;){const k=C.shift();Z.push(k);const U=i.dependedBy.get(k.uniqueId);for(const Z of Array.from(U.values())){const U=i.dependsOn.get(Z);U.delete(k.uniqueId),0===U.size&&Q.get(Z)&&(C.push(Q.get(Z)),Q.delete(Z))}}return Q.size>0&&(O.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),Q.forEach((k=>{O.c.Error(k.name)}))),Z}_addNodeAndDescendantsToList(k,Q,i,Z){if(i&&(!Z||Z(i))&&!Q.has(i.uniqueId)){k.push(i),Q.add(i.uniqueId);for(const U of i.getDescendants(!0))this._addNodeAndDescendantsToList(k,Q,U,Z)}}_isNodeInContainer(k){return k instanceof m.d&&-1!==this.meshes.indexOf(k)||(k instanceof o.d&&-1!==this.transformNodes.indexOf(k)||(k instanceof H.e&&-1!==this.lights.indexOf(k)||k instanceof e.e&&-1!==this.cameras.indexOf(k)))}_isValidHierarchy(){for(const k of this.meshes)if(k.parent&&!this._isNodeInContainer(k.parent))return O.c.Warn(`Node ${k.name} has a parent that is not in the container.`),!1;for(const k of this.transformNodes)if(k.parent&&!this._isNodeInContainer(k.parent))return O.c.Warn(`Node ${k.name} has a parent that is not in the container.`),!1;for(const k of this.lights)if(k.parent&&!this._isNodeInContainer(k.parent))return O.c.Warn(`Node ${k.name} has a parent that is not in the container.`),!1;for(const k of this.cameras)if(k.parent&&!this._isNodeInContainer(k.parent))return O.c.Warn(`Node ${k.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||U.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const Z={},C={},o=new l,m=[],O=[],J={doNotInstantiate:!0,...i},G=[],H=new Set;for(const U of this.transformNodes)null===U.parent&&this._addNodeAndDescendantsToList(G,H,U,J.predicate);for(const U of this.meshes)null===U.parent&&this._addNodeAndDescendantsToList(G,H,U,J.predicate);const e=this._topologicalSort(G),F=(i,U)=>{if(((Q,i)=>{if(Z[Q.uniqueId]=i.uniqueId,C[i.uniqueId]=i,k&&(i.name=k(Q.name)),i instanceof B.d){const k=i;if(k.morphTargetManager){const i=Q.morphTargetManager;k.morphTargetManager=i.clone();for(let Q=0;Q<i.numTargets;Q++){const U=i.getTarget(Q),B=k.morphTargetManager.getTarget(Q);Z[U.uniqueId]=B.uniqueId,C[B.uniqueId]=B}}}})(i,U),i.parent){const k=Z[i.parent.uniqueId],Q=C[k];U.parent=Q||i.parent}if(U.position&&i.position&&U.position.B(i.position),U.rotationQuaternion&&i.rotationQuaternion&&U.rotationQuaternion.B(i.rotationQuaternion),U.rotation&&i.rotation&&U.rotation.B(i.rotation),U.Ho&&i.Ho&&U.Ho.B(i.Ho),U.material){const B=U;if(B.material)if(Q){const Q=i.material;if(-1===O.indexOf(Q)){let i=Q.clone(k?k(Q.name):"Clone of "+Q.name);if(O.push(Q),Z[Q.uniqueId]=i.uniqueId,C[i.uniqueId]=i,"MultiMaterial"===Q.getClassName()){const U=Q;for(const Q of U.zo)Q&&(i=Q.clone(k?k(Q.name):"Clone of "+Q.name),O.push(Q),Z[Q.uniqueId]=i.uniqueId,C[i.uniqueId]=i);U.zo=U.zo.map((k=>k&&C[Z[k.uniqueId]]))}}"InstancedMesh"!==B.getClassName()&&(B.material=C[Z[Q.uniqueId]])}else"MultiMaterial"===B.material.getClassName()?-1===this.lQ.multiMaterials.indexOf(B.material)&&this.lQ.addMultiMaterial(B.material):-1===this.lQ.materials.indexOf(B.material)&&this.lQ.addMaterial(B.material)}null===U.parent&&o.rootNodes.push(U)};for(const U of e)if("InstancedMesh"===U.getClassName()){const k=U,Q=k.sourceMesh,i=Z[Q.uniqueId];F(k,("number"===typeof i?C[i]:Q).createInstance(k.name))}else{let k=!0;"me"===U.getClassName()||"Node"===U.getClassName()||U.skeleton||!U.getTotalVertices||0===U.getTotalVertices()?k=!1:J.doNotInstantiate&&(k="function"===typeof J.doNotInstantiate?!J.doNotInstantiate(U):!J.doNotInstantiate);const Q=k?U.createInstance(`instance of ${U.name}`):U.clone(`Clone of ${U.name}`,null,!0);if(!Q)throw new Error(`Could not clone or instantiate node on Asset Container ${U.name}`);F(U,Q)}for(const U of this.skeletons){if(J.predicate&&!J.predicate(U))continue;const Q=U.clone(k?k(U.name):"Clone of "+U.name);for(const k of this.meshes)if(k.skeleton===U&&!k.isAnInstance){const i=C[Z[k.uniqueId]];if(!i||i.isAnInstance)continue;if(i.skeleton=Q,-1!==m.indexOf(Q))continue;m.push(Q);for(const k of Q.bones)k._linkedTransformNode&&(k._linkedTransformNode=C[Z[k._linkedTransformNode.uniqueId]])}o.skeletons.push(Q)}for(const U of this.animationGroups){if(J.predicate&&!J.predicate(U))continue;const Q=U.clone(k?k(U.name):"Clone of "+U.name,(k=>C[Z[k.uniqueId]]||k));o.animationGroups.push(Q)}return o}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||U.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.lQ.environmentTexture=this.environmentTexture);for(const k of this.lQ._serializableComponents)k.addFromContainer(this);this.lQ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const Q=[];for(const i of this.cameras)k&&!k(i)||(this.lQ.addCamera(i),Q.push(i));for(const i of this.lights)k&&!k(i)||(this.lQ.addLight(i),Q.push(i));for(const i of this.meshes)k&&!k(i)||(this.lQ.nO(i),Q.push(i));for(const i of this.skeletons)k&&!k(i)||this.lQ.addSkeleton(i);for(const i of this.animations)k&&!k(i)||this.lQ.addAnimation(i);for(const i of this.animationGroups)k&&!k(i)||this.lQ.addAnimationGroup(i);for(const i of this.multiMaterials)k&&!k(i)||this.lQ.addMultiMaterial(i);for(const i of this.materials)k&&!k(i)||this.lQ.addMaterial(i);for(const i of this.morphTargetManagers)k&&!k(i)||this.lQ.addMorphTargetManager(i);for(const i of this.geometries)k&&!k(i)||this.lQ.addGeometry(i);for(const i of this.transformNodes)k&&!k(i)||(this.lQ.addTransformNode(i),Q.push(i));for(const i of this.actionManagers)k&&!k(i)||this.lQ.addActionManager(i);for(const i of this.textures)k&&!k(i)||this.lQ.addTexture(i);for(const i of this.reflectionProbes)k&&!k(i)||this.lQ.addReflectionProbe(i);for(const i of Q)i.parent&&-1===this.lQ.getNodes().indexOf(i.parent)&&(i.setParent?i.setParent(null):i.parent=null)}removeAllFromScene(){this._isValidHierarchy()||U.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.lQ.environmentTexture&&(this.lQ.environmentTexture=null);for(const k of this.lQ._serializableComponents)k.removeFromContainer(this)}removeFromScene(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const Q of this.cameras)k&&!k(Q)||this.lQ.removeCamera(Q);for(const Q of this.lights)k&&!k(Q)||this.lQ.removeLight(Q);for(const Q of this.meshes)k&&!k(Q)||this.lQ.rO(Q,!0);for(const Q of this.skeletons)k&&!k(Q)||this.lQ.removeSkeleton(Q);for(const Q of this.animations)k&&!k(Q)||this.lQ.removeAnimation(Q);for(const Q of this.animationGroups)k&&!k(Q)||this.lQ.removeAnimationGroup(Q);for(const Q of this.multiMaterials)k&&!k(Q)||this.lQ.removeMultiMaterial(Q);for(const Q of this.materials)k&&!k(Q)||this.lQ.removeMaterial(Q);for(const Q of this.morphTargetManagers)k&&!k(Q)||this.lQ.removeMorphTargetManager(Q);for(const Q of this.geometries)k&&!k(Q)||this.lQ.removeGeometry(Q);for(const Q of this.transformNodes)k&&!k(Q)||this.lQ.removeTransformNode(Q);for(const Q of this.actionManagers)k&&!k(Q)||this.lQ.removeActionManager(Q);for(const Q of this.textures)k&&!k(Q)||this.lQ.removeTexture(Q);for(const Q of this.reflectionProbes)k&&!k(Q)||this.lQ.removeReflectionProbe(Q)}dispose(){const k=this.cameras.slice(0);for(const e of k)e.dispose();this.cameras.length=0;const Q=this.lights.slice(0);for(const e of Q)e.dispose();this.lights.length=0;const i=this.meshes.slice(0);for(const e of i)e.dispose();this.meshes.length=0;const Z=this.skeletons.slice(0);for(const e of Z)e.dispose();this.skeletons.length=0;const U=this.animationGroups.slice(0);for(const e of U)e.dispose();this.animationGroups.length=0;const C=this.multiMaterials.slice(0);for(const e of C)e.dispose();this.multiMaterials.length=0;const B=this.materials.slice(0);for(const e of B)e.dispose();this.materials.length=0;const o=this.geometries.slice(0);for(const e of o)e.dispose();this.geometries.length=0;const m=this.transformNodes.slice(0);for(const e of m)e.dispose();this.transformNodes.length=0;const O=this.actionManagers.slice(0);for(const e of O)e.dispose();this.actionManagers.length=0;const J=this.textures.slice(0);for(const e of J)e.dispose();this.textures.length=0;const G=this.reflectionProbes.slice(0);for(const e of G)e.dispose();this.reflectionProbes.length=0;const H=this.morphTargetManagers.slice(0);for(const e of H)e.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const e of this.lQ._serializableComponents)e.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.lQ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(k,Q,i){if(k&&Q)for(const Z of k){let k=!0;if(i)for(const Q of i)if(Z===Q){k=!1;break}k&&(Q.push(Z),Z._parentContainer=this)}}moveAllFromScene(k){this._wasAddedToScene=!1,void 0===k&&(k=new E);for(const Q in this)Object.prototype.hasOwnProperty.call(this,Q)&&(this[Q]=this[Q]||("_environmentTexture"===Q?null:[]),this._moveAssets(this.lQ[Q],this[Q],k[Q]));this.environmentTexture=this.lQ.environmentTexture,this.removeAllFromScene()}createRootMesh(){const k=new B.d("assetContainerRootMesh",this.lQ);for(const Q of this.meshes)Q.parent||k.addChild(Q);return this.meshes.unshift(k),k}mergeAnimationsTo(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.b.LastCreatedScene,Q=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!k)return O.c.Error("No scene available to merge animations to"),[];const Z=i||(Q=>{let i=null;const Z=Q.animations.length?Q.animations[0].targetProperty:"",U=Q.name.split(".").join("").split("_primitive")[0];switch(Z){case"position":case"rotationQuaternion":i=k.getTransformNodeByName(Q.name)||k.getTransformNodeByName(U);break;case"influence":i=k.getMorphTargetByName(Q.name)||k.getMorphTargetByName(U);break;default:i=k.getNodeByName(Q.name)||k.getNodeByName(U)}return i}),U=this.getNodes();for(const o of U){const k=Z(o);if(null!==k){for(const Q of o.animations){const i=k.animations.filter((k=>k.targetProperty===Q.targetProperty));for(const Q of i){const i=k.animations.indexOf(Q,0);i>-1&&k.animations.splice(i,1)}}k.animations=k.animations.concat(o.animations)}}const C=[],B=this.animationGroups.slice();for(const o of B){C.push(o.clone(o.name,Z));for(const k of o.animatables)k.stop()}for(const o of Q){const Q=Z(o.target);Q&&(k.beginAnimation(Q,o.fromFrame,o.toFrame,o.loopAnimation,o.speedRatio,o.onAnimationEnd?o.onAnimationEnd:void 0,void 0,!0,void 0,o.onAnimationLoop?o.onAnimationLoop:void 0),k.stopAnimation(o.target))}return C}populateRootNodes(){this.rootNodes.length=0;for(const k of this.meshes)k.parent||-1!==this.rootNodes.indexOf(k)||this.rootNodes.push(k);for(const k of this.transformNodes)k.parent||-1!==this.rootNodes.indexOf(k)||this.rootNodes.push(k);for(const k of this.lights)k.parent||-1!==this.rootNodes.indexOf(k)||this.rootNodes.push(k);for(const k of this.cameras)k.parent||-1!==this.rootNodes.indexOf(k)||this.rootNodes.push(k)}addAllAssetsToContainer(k){if(!k)return;const Q=[],i=new Set;for(Q.push(k);Q.length>0;){const k=Q.pop();if(k instanceof B.d?(k.mo&&-1===this.geometries.indexOf(k.mo)&&this.geometries.push(k.mo),this.meshes.push(k)):k instanceof G.d?this.meshes.push(k):k instanceof o.d?this.transformNodes.push(k):k instanceof H.e?this.lights.push(k):k instanceof e.e&&this.cameras.push(k),k instanceof m.d){if(k.material&&-1===this.materials.indexOf(k.material)){this.materials.push(k.material);for(const Q of k.material.getActiveTextures())-1===this.textures.indexOf(Q)&&this.textures.push(Q)}k.skeleton&&-1===this.skeletons.indexOf(k.skeleton)&&this.skeletons.push(k.skeleton),k.morphTargetManager&&-1===this.morphTargetManagers.indexOf(k.morphTargetManager)&&this.morphTargetManagers.push(k.morphTargetManager)}for(const Z of k.getChildren())i.has(Z)||Q.push(Z);i.add(k)}this.populateRootNodes()}_getByTags(k,Q,i){if(void 0===Q)return k;const Z=[];for(const U in k){const C=k[U];F.e&&F.e.MatchesQuery(C,Q)&&(!i||i(C))&&Z.push(C)}return Z}getMeshesByTags(k,Q){return this._getByTags(this.meshes,k,Q)}getCamerasByTags(k,Q){return this._getByTags(this.cameras,k,Q)}getLightsByTags(k,Q){return this._getByTags(this.lights,k,Q)}getMaterialsByTags(k,Q){return this._getByTags(this.materials,k,Q).concat(this._getByTags(this.multiMaterials,k,Q))}getTransformNodesByTags(k,Q){return this._getByTags(this.transformNodes,k,Q)}}var c=i(11178);class f{constructor(k){this.byteOffset=0,this.buffer=k}async loadAsync(k){const Q=await this.buffer.readAsync(this.byteOffset,k);this._dataView=new DataView(Q.buffer,Q.byteOffset,Q.byteLength),this._dataByteOffset=0}readUint32(){const k=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,k}readUint8Array(k){const Q=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,k);return this._dataByteOffset+=k,this.byteOffset+=k,Q}readString(k){return(0,c.g)(this.readUint8Array(k))}skipBytes(k){this._dataByteOffset+=k,this.byteOffset+=k}}var Y=i(13e3);const y="Z2xURg",L={name:"XC",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:k=>-1!==k.indexOf("asset")&&-1!==k.indexOf("version")||k.startsWith("data:base64,"+y)||k.startsWith("data:;base64,"+y)||k.startsWith("data:application/octet-stream;base64,"+y)||k.startsWith("data:model/gltf-binary;base64,"+y)};var s,u,a,j=i(11163),T=i(11172);function K(k,Q,i){try{return Promise.resolve(new Uint8Array(k,Q,i))}catch(Z){return Promise.reject(Z)}}!function(k){k[k.AUTO=0]="AUTO",k[k.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(s||(s={})),function(k){k[k.NONE=0]="NONE",k[k.FIRST=1]="FIRST",k[k.ALL=2]="ALL"}(u||(u={})),function(k){k[k.LOADING=0]="LOADING",k[k.READY=1]="READY",k[k.COMPLETE=2]="COMPLETE"}(a||(a={}));class v{constructor(){this.coordinateSystemMode=s.AUTO,this.animationStartMode=u.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=k=>Promise.resolve(k),this.extensionOptions={}}B(k){k&&(this.onParsed=k.onParsed,this.coordinateSystemMode=k.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=k.animationStartMode??this.animationStartMode,this.loadNodeAnimations=k.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=k.loadSkins??this.loadSkins,this.loadMorphTargets=k.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=k.compileMaterials??this.compileMaterials,this.useClipPlane=k.useClipPlane??this.useClipPlane,this.compileShadowGenerators=k.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=k.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=k.useRangeRequests??this.useRangeRequests,this.createInstances=k.createInstances??this.createInstances,this.alwaysComputeBoundingBox=k.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=k.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=k.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=k.skipMaterials??this.skipMaterials,this.useSRGBBuffers=k.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=k.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=k.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=k.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=k.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=k.customRootNode,this.onMeshLoaded=k.onMeshLoaded,this.onSkinLoaded=k.onSkinLoaded,this.onTextureLoaded=k.onTextureLoaded,this.onMaterialLoaded=k.onMaterialLoaded,this.onCameraLoaded=k.onCameraLoaded,this.extensionOptions=k.extensionOptions??this.extensionOptions)}}class N extends v{constructor(k){super(),this.onParsedObservable=new Z.c,this.onMeshLoadedObservable=new Z.c,this.onSkinLoadedObservable=new Z.c,this.onTextureLoadedObservable=new Z.c,this.onMaterialLoadedObservable=new Z.c,this.onCameraLoadedObservable=new Z.c,this.onCompleteObservable=new Z.c,this.onErrorObservable=new Z.c,this.gi=new Z.c,this.onExtensionLoadedObservable=new Z.c,this.validate=!1,this.onValidatedObservable=new Z.c,this._loader=null,this._state=null,this._requests=new Array,this.name=L.name,this.extensions=L.extensions,this.onLoaderStateChangedObservable=new Z.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.B(k)}set onParsed(k){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),k&&(this._onParsedObserver=this.onParsedObservable.add(k))}set onMeshLoaded(k){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),k&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(k))}set onSkinLoaded(k){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),k&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((Q=>k(Q.node,Q.skinnedNode))))}set onTextureLoaded(k){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),k&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(k))}set onMaterialLoaded(k){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),k&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(k))}set onCameraLoaded(k){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),k&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(k))}set onComplete(k){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(k)}set onError(k){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(k)}set onDispose(k){this._onDisposeObserver&&this.gi.remove(this._onDisposeObserver),this._onDisposeObserver=this.gi.add(k)}set onExtensionLoaded(k){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(k)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(k){this._loggingEnabled!==k&&(this._loggingEnabled=k,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(k){this._capturePerformanceCounters!==k&&(this._capturePerformanceCounters=k,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(k){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(k)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const k of this._requests)k.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=k=>Promise.resolve(k),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.gi.notifyObservers(void 0),this.gi.clear()}loadFile(k,Q,i,C,B,o,m,J){if(ArrayBuffer.isView(Q))return this._loadBinary(k,Q,i,C,m,J),null;this._progressCallback=B;const G=Q.name||U.Tools.GetFilename(Q);if(o){if(this.useRangeRequests){this.validate&&O.c.Warn("glTF validation is not supported when range requests are enabled");const i={abort:()=>{},onCompleteObservable:new Z.c},U={readAsync:(i,Z)=>new Promise(((U,C)=>{this._loadFile(k,Q,(k=>{U(new Uint8Array(k))}),!0,(k=>{C(k)}),(k=>{k.setRequestHeader("Range",`bytes=${i}-${i+Z-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new f(U)).then((k=>{i.onCompleteObservable.notifyObservers(i),C(k)}),m?k=>m(void 0,k):void 0),i}return this._loadFile(k,Q,(Q=>{this._validate(k,new Uint8Array(Q,0,Q.byteLength),i,G),this._unpackBinaryAsync(new f({readAsync:(k,i)=>K(Q,k,i),byteLength:Q.byteLength})).then((k=>{C(k)}),m?k=>m(void 0,k):void 0)}),!0,m)}return this._loadFile(k,Q,(Q=>{try{this._validate(k,Q,i,G),C({json:this._parseJson(Q)})}catch{m&&m()}}),!1,m)}_loadBinary(k,Q,i,Z,U,C){this._validate(k,new Uint8Array(Q.buffer,Q.byteOffset,Q.byteLength),i,C),this._unpackBinaryAsync(new f({readAsync:(k,i)=>function(k,Q,i){try{if(Q<0||Q>=k.byteLength)throw new RangeError("Offset is out of range.");if(Q+i>k.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(k.buffer,k.byteOffset+Q,i))}catch(Z){return Promise.reject(Z)}}(Q,k,i),byteLength:Q.byteLength})).then((k=>{Z(k)}),U?k=>U(void 0,k):void 0)}importMeshAsync(k,Q,i,Z,U,C){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(i),this.onParsedObservable.clear(),this._log(`Loading ${C||""}`),this._loader=this._getLoader(i),this._loader.importMeshAsync(k,Q,null,i,Z,U,C))))}loadAsync(k,Q,i,Z,U){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Q),this.onParsedObservable.clear(),this._log(`Loading ${U||""}`),this._loader=this._getLoader(Q),this._loader.loadAsync(k,Q,i,Z,U))))}loadAssetContainerAsync(k,Q,i,Z,U){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(Q),this.onParsedObservable.clear(),this._log(`Loading ${U||""}`),this._loader=this._getLoader(Q);const C=new h(k),B=[];this.onMaterialLoadedObservable.add((k=>{B.push(k)}));const o=[];this.onTextureLoadedObservable.add((k=>{o.push(k)}));const m=[];this.onCameraLoadedObservable.add((k=>{m.push(k)}));const O=[];return this.onMeshLoadedObservable.add((k=>{k.morphTargetManager&&O.push(k.morphTargetManager)})),this._loader.importMeshAsync(null,k,C,Q,i,Z,U).then((k=>(Array.prototype.push.apply(C.geometries,k.geometries),Array.prototype.push.apply(C.meshes,k.meshes),Array.prototype.push.apply(C.SG,k.SG),Array.prototype.push.apply(C.skeletons,k.skeletons),Array.prototype.push.apply(C.animationGroups,k.animationGroups),Array.prototype.push.apply(C.materials,B),Array.prototype.push.apply(C.textures,o),Array.prototype.push.apply(C.lights,k.lights),Array.prototype.push.apply(C.transformNodes,k.transformNodes),Array.prototype.push.apply(C.cameras,m),Array.prototype.push.apply(C.morphTargetManagers,O),C)))}))}canDirectLoad(k){return L.canDirectLoad(k)}directLoad(k,Q){if(Q.startsWith("base64,"+y)||Q.startsWith(";base64,"+y)||Q.startsWith("application/octet-stream;base64,"+y)||Q.startsWith("model/gltf-binary;base64,"+y)){const i=(0,j.c)(Q);return this._validate(k,new Uint8Array(i,0,i.byteLength)),this._unpackBinaryAsync(new f({readAsync:(k,Q)=>K(i,k,Q),byteLength:i.byteLength}))}return this._validate(k,Q),Promise.resolve({json:this._parseJson(Q)})}createPlugin(k){return new N(k[L.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((k,Q)=>{this.onCompleteObservable.addOnce((()=>{k()})),this.onErrorObservable.addOnce((k=>{Q(k)}))}))}_setState(k){this._state!==k&&(this._state=k,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(a[this._state]))}_loadFile(k,Q,i,Z,U,C){const B=k._loadFile(Q,i,(k=>{this._onProgress(k,B)}),!0,Z,U,C);return B.onCompleteObservable.add((()=>{B._lengthComputable=!0,B._total=B._loaded})),this._requests.push(B),B}_onProgress(k,Q){if(!this._progressCallback)return;Q._lengthComputable=k.lengthComputable,Q._loaded=k.loaded,Q._total=k.total;let i=!0,Z=0,U=0;for(const C of this._requests){if(void 0===C._lengthComputable||void 0===C._loaded||void 0===C._total)return;i=i&&C._lengthComputable,Z+=C._loaded,U+=C._total}this._progressCallback({lengthComputable:i,loaded:Z,total:i?U:0})}_validate(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),Y.d.ValidateAsync(Q,i,Z,(Q=>this.preprocessUrlAsync(i+Q).then((Q=>k._loadFileAsync(Q,void 0,!0,!0).then((k=>new Uint8Array(k,0,k.byteLength))))))).then((k=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(k),this.onValidatedObservable.clear()}),(k=>{this._endPerformanceCounter("Validate JSON"),U.Tools.Warn(`Failed to validate: ${k.message}`),this.onValidatedObservable.clear()})))}_getLoader(k){const Q=k.json.asset||{};this._log(`Asset version: ${Q.version}`),Q.minVersion&&this._log(`Asset minimum version: ${Q.minVersion}`),Q.generator&&this._log(`Asset generator: ${Q.generator}`);const i=N._parseVersion(Q.version);if(!i)throw new Error("Invalid version: "+Q.version);if(void 0!==Q.minVersion){const k=N._parseVersion(Q.minVersion);if(!k)throw new Error("Invalid minimum version: "+Q.minVersion);if(N._compareVersion(k,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+Q.minVersion)}const Z={1:N._CreateGLTF1Loader,2:N._CreateGLTF2Loader}[i.major];if(!Z)throw new Error("Unsupported version: "+Q.version);return Z(this)}_parseJson(k){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${k.length}`);const Q=JSON.parse(k);return this._endPerformanceCounter("Parse JSON"),Q}_unpackBinaryAsync(k){return this._startPerformanceCounter("Unpack Binary"),k.loadAsync(20).then((()=>{const Q=k.readUint32();if(1179937895!==Q)throw new T.f("Unexpected magic: "+Q,T.e.GLTFLoaderUnexpectedMagicError);const i=k.readUint32();this.loggingEnabled&&this._log(`Binary version: ${i}`);const Z=k.readUint32();let U;switch(this.useRangeRequests||Z===k.buffer.byteLength||O.c.Warn(`Length in header does not match actual data length: ${Z} != ${k.buffer.byteLength}`),i){case 1:U=this._unpackBinaryV1Async(k,Z);break;case 2:U=this._unpackBinaryV2Async(k,Z);break;default:throw new Error("Unsupported version: "+i)}return this._endPerformanceCounter("Unpack Binary"),U}))}_unpackBinaryV1Async(k,Q){const i=k.readUint32(),Z=k.readUint32();if(0!==Z)throw new Error(`Unexpected content format: ${Z}`);const U=Q-k.byteOffset,C={json:this._parseJson(k.readString(i)),bin:null};if(0!==U){const Q=k.byteOffset;C.bin={readAsync:(i,Z)=>k.buffer.readAsync(Q+i,Z),byteLength:U}}return Promise.resolve(C)}_unpackBinaryV2Async(k,Q){const i=1313821514,Z=5130562,U=k.readUint32();if(k.readUint32()!==i)throw new Error("First chunk format is not JSON");return k.byteOffset+U===Q?k.loadAsync(U).then((()=>({json:this._parseJson(k.readString(U)),bin:null}))):k.loadAsync(U+8).then((()=>{const C={json:this._parseJson(k.readString(U)),bin:null},B=()=>{const U=k.readUint32();switch(k.readUint32()){case i:throw new Error("Unexpected JSON chunk");case Z:{const Q=k.byteOffset;C.bin={readAsync:(i,Z)=>k.buffer.readAsync(Q+i,Z),byteLength:U},k.skipBytes(U);break}default:k.skipBytes(U)}return k.byteOffset!==Q?k.loadAsync(8).then(B):Promise.resolve(C)};return B()}))}static _parseVersion(k){if("1.0"===k||"1.0.1"===k)return{major:1,minor:0};const Q=(k+"").match(/^(\d+)\.(\d+)/);return Q?{major:parseInt(Q[1]),minor:parseInt(Q[2])}:null}static _compareVersion(k,Q){return k.major>Q.major?1:k.major<Q.major?-1:k.minor>Q.minor?1:k.minor<Q.minor?-1:0}_logOpen(k){this._log(k),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(k){const Q=N._logSpaces.substring(0,2*this._logIndentLevel);O.c.Log(`${Q}${k}`)}_logDisabled(k){}_startPerformanceCounterEnabled(k){U.Tools.StartPerformanceCounter(k)}_startPerformanceCounterDisabled(k){}_endPerformanceCounterEnabled(k){U.Tools.EndPerformanceCounter(k)}_endPerformanceCounterDisabled(k){}}N.IncrementalLoading=!0,N.HomogeneousCoordinates=!1,N._logSpaces="                                ",(0,C.b)(new N)},13e3:(k,Q,i)=>{"use strict";i.d(Q,{d:()=>B});var Z=i(11119);function U(k,Q,i,Z){const U={externalResourceFunction:Z};return i&&(U.uri="file:"===Q?i:Q+i),ArrayBuffer.isView(k)?GLTFValidator.validateBytes(k,U):GLTFValidator.validateString(k,U)}function C(){const k=[];onmessage=Q=>{const i=Q.data;switch(i.id){case"init":importScripts(i.url);break;case"validate":U(i.data,i.rootUrl,i.fileName,(Q=>new Promise(((i,Z)=>{const U=k.length;k.push({resolve:i,reject:Z}),postMessage({id:"getExternalResource",index:U,uri:Q})})))).then((k=>{postMessage({id:"validate.resolve",value:k})}),(k=>{postMessage({id:"validate.reject",reason:k})}));break;case"getExternalResource.resolve":k[i.index].resolve(i.value);break;case"getExternalResource.reject":k[i.index].reject(i.reason)}}}class B{static ValidateAsync(k,Q,i,B){return"function"===typeof Worker?new Promise(((o,m)=>{const O=`${U}(${C})()`,J=URL.createObjectURL(new Blob([O],{type:"application/javascript"})),G=new Worker(J),H=k=>{G.removeEventListener("error",H),G.removeEventListener("message",e),m(k)},e=k=>{const Q=k.data;switch(Q.id){case"getExternalResource":B(Q.uri).then((k=>{G.postMessage({id:"getExternalResource.resolve",index:Q.index,value:k},[k.buffer])}),(k=>{G.postMessage({id:"getExternalResource.reject",index:Q.index,reason:k})}));break;case"validate.resolve":G.removeEventListener("error",H),G.removeEventListener("message",e),o(Q.value),G.terminate();break;case"validate.reject":G.removeEventListener("error",H),G.removeEventListener("message",e),m(Q.reason),G.terminate()}};if(G.addEventListener("error",H),G.addEventListener("message",e),G.postMessage({id:"init",url:Z.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(k)){const Z=k.slice();G.postMessage({id:"validate",data:Z,rootUrl:Q,fileName:i},[Z.buffer])}else G.postMessage({id:"validate",data:k,rootUrl:Q,fileName:i})})):(this._LoadScriptPromise||(this._LoadScriptPromise=Z.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>U(k,Q,i,B))))}}B.Configuration={url:`${Z.Tools._DefaultCdnUrl}/gltf_validator.js`}},13543:(k,Q,i)=>{"use strict";i.d(Q,{c:()=>L});var Z=i(11280),U=i(11289),C=i(11334),B=i(11298),o=i(11666),m=i(11607),O=i(11378),J=i(11538),G=i(11253),H=i(11210);i(12751),i(12642),i(12664),i(12651),i(12673),i(12682),i(12688);const e="imageProcessingCompatibility",F="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";H.d.IncludesShadersStore[e]||(H.d.IncludesShadersStore[e]=F);const z="skyPixelShader",E="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";H.d.ShadersStore[z]||(H.d.ShadersStore[z]=E);i(12762),i(12690),i(12699),i(12709),i(12702);const l="skyVertexShader",h="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";H.d.ShadersStore[l]||(H.d.ShadersStore[l]=h);var c=i(11603),f=i(11657),Y=i(11652);class y extends o.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class L extends m.c{constructor(k,Q){super(k,Q),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new B.zQ(0,100,0),this.useSunPosition=!1,this.cameraOffset=B.zQ.Zero(),this.up=B.zQ.Up(),this.dithering=!1,this._cameraPosition=B.zQ.Zero(),this._skyOrientation=new B.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(k,Q){const i=Q._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;Q.materialDefines||(Q.materialDefines=new y);const Z=Q.materialDefines,U=this.sk();if(this._isReadyForSubMesh(Q))return!0;if((0,Y.S)(k,U,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,Z),(0,Y.H)(k,Z,!0,!1),Z.IMAGEPROCESSINGPOSTPROCESS!==U.imageProcessingConfiguration.applyByPostProcess&&Z.markAsMiscDirty(),Z.DITHER!==this.dithering&&Z.markAsMiscDirty(),Z.isDirty){Z.markAsProcessed(),U.resetCachedMaterial();const k=new c.e;Z.FOG&&k.addFallback(1,"FOG"),Z.IMAGEPROCESSINGPOSTPROCESS=U.imageProcessingConfiguration.applyByPostProcess,Z.DITHER=this.dithering;const i=[O.h.PositionKind];Z.VERTEXCOLOR&&i.push(O.h.ColorKind);const C="sky",B=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,f.c)(B);const o=Z.toString();Q.setEffect(U.getEngine().createEffect(C,i,B,[],o,k,this.onCompiled,this.onError),Z,this._materialContext)}return!(!Q.effect||!Q.effect.isReady())&&(Z._renderId=U.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(k,Q,i){const Z=this.sk(),U=i.materialDefines;if(!U)return;const C=i.effect;if(!C)return;this._activeEffect=C,this.bindOnlyWorldMatrix(k),this._activeEffect.setMatrix("viewProjection",Z.getTransformMatrix()),this._mustRebind(Z,C,i)&&((0,f.g)(C,this,Z),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,Y.j)(U,C,Z)),Z.fogEnabled&&Q.applyFog&&Z.fogMode!==J.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",Z.getViewMatrix()),(0,Y.e)(Z,Q,this._activeEffect);const o=Z.activeCamera;if(o){const k=o.getWorldMatrix();this._cameraPosition.x=k.m[12],this._cameraPosition.y=k.m[13],this._cameraPosition.z=k.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const k=Math.PI*(this.inclination-.5),Q=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(Q)*Math.cos(k),this.sunPosition.y=this.distance*Math.sin(-k),this.sunPosition.z=this.distance*Math.sin(Q)*Math.cos(k),B.Quaternion.FromUnitVectorsToRef(B.zQ.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(Q,this._activeEffect,i)}getAnimatables(){return[]}dispose(k){super.dispose(k)}clone(k){return C.d.Clone((()=>new L(k,this.sk())),this)}serialize(){const k=super.serialize();return k.customType="BABYLON.SkyMaterial",k}getClassName(){return"SkyMaterial"}static Parse(k,Q,i){return C.d.Parse((()=>new L(k.name,Q)),k,Q,i)}}(0,Z.c)([(0,U.L)()],L.prototype,"luminance",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"turbidity",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"rayleigh",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"mieCoefficient",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"mieDirectionalG",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"distance",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"inclination",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"azimuth",void 0),(0,Z.c)([(0,U.K)()],L.prototype,"sunPosition",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"useSunPosition",void 0),(0,Z.c)([(0,U.K)()],L.prototype,"cameraOffset",void 0),(0,Z.c)([(0,U.K)()],L.prototype,"up",void 0),(0,Z.c)([(0,U.L)()],L.prototype,"dithering",void 0),(0,G.e)("BABYLON.SkyMaterial",L)},11992:(k,Q,i)=>{"use strict";function Z(k,Q){Q.headers=k.headers||{},Q.statusMessage=k.statusText,Q.statusCode=k.status,Q.data=k.response}function U(k,Q,i){return new Promise((function(U,C){i=i||{};var B,o,m,O=new XMLHttpRequest,J=i.body,G=i.headers||{};for(B in i.timeout&&(O.timeout=i.timeout),O.ontimeout=O.onerror=function(k){k.timeout="timeout"==k.type,C(k)},O.open(k,Q.href||Q),O.onload=function(){for(m=O.getAllResponseHeaders().trim().split(/[\r\n]+/),Z(O,O);o=m.shift();)o=o.split(": "),O.headers[o.shift().toLowerCase()]=o.join(": ");if((o=O.headers["content-type"])&&~o.indexOf("application/json"))try{O.data=JSON.parse(O.data,i.reviver)}catch(k){return Z(O,k),C(k)}(O.status>=400?C:U)(O)},typeof FormData<"u"&&J instanceof FormData||J&&"object"==typeof J&&(G["content-type"]="application/json",J=JSON.stringify(J)),O.withCredentials=!!i.withCredentials,G)O.setRequestHeader(B,G[B]);O.send(J)}))}i.r(Q),i.d(Q,{del:()=>m,get:()=>C,patch:()=>o,post:()=>B,put:()=>O,send:()=>U});var C=U.bind(U,"GET"),B=U.bind(U,"POST"),o=U.bind(U,"PATCH"),m=U.bind(U,"DELETE"),O=U.bind(U,"PUT")},13659:(k,Q,i)=>{"use strict";i.d(Q,{c:()=>G});const Z=.5*(Math.sqrt(3)-1),U=(3-Math.sqrt(3))/6,C=1/3,B=1/6,o=(Math.sqrt(5)-1)/4,m=(5-Math.sqrt(5))/20,O=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),J=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const G=class{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const Q="function"==typeof k?k:function(k){let Q=0,i=0,Z=0,U=1;const C=function(){let k=4022871197;return function(Q){Q=Q.toString();for(let i=0;i<Q.length;i++){k+=Q.charCodeAt(i);let Z=.02519603282416938*k;k=Z>>>0,Z-=k,Z*=k,k=Z>>>0,Z-=k,k+=4294967296*Z}return 2.3283064365386963e-10*(k>>>0)}}();Q=C(" "),i=C(" "),Z=C(" "),Q-=C(k),Q<0&&(Q+=1);i-=C(k),i<0&&(i+=1);Z-=C(k),Z<0&&(Z+=1);return function(){const k=2091639*Q+2.3283064365386963e-10*U;return Q=i,i=Z,Z=k-(U=0|k)}}(k);this.p=function(k){const Q=new Uint8Array(256);for(let i=0;i<256;i++)Q[i]=i;for(let i=0;i<255;i++){const Z=i+~~(k()*(256-i)),U=Q[i];Q[i]=Q[Z],Q[Z]=U}return Q}(Q),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let i=0;i<512;i++)this.perm[i]=this.p[255&i],this.permMod12[i]=this.perm[i]%12}noise2D(k,Q){const i=this.permMod12,C=this.perm;let B=0,o=0,m=0;const J=(k+Q)*Z,G=Math.floor(k+J),H=Math.floor(Q+J),e=(G+H)*U,F=k-(G-e),z=Q-(H-e);let E,l;F>z?(E=1,l=0):(E=0,l=1);const h=F-E+U,c=z-l+U,f=F-1+2*U,Y=z-1+2*U,y=255&G,L=255&H;let s=.5-F*F-z*z;if(s>=0){const k=3*i[y+C[L]];s*=s,B=s*s*(O[k]*F+O[k+1]*z)}let u=.5-h*h-c*c;if(u>=0){const k=3*i[y+E+C[L+l]];u*=u,o=u*u*(O[k]*h+O[k+1]*c)}let a=.5-f*f-Y*Y;if(a>=0){const k=3*i[y+1+C[L+1]];a*=a,m=a*a*(O[k]*f+O[k+1]*Y)}return 70*(B+o+m)}noise3D(k,Q,i){const Z=this.permMod12,U=this.perm;let o,m,J,G;const H=(k+Q+i)*C,e=Math.floor(k+H),F=Math.floor(Q+H),z=Math.floor(i+H),E=(e+F+z)*B,l=k-(e-E),h=Q-(F-E),c=i-(z-E);let f,Y,y,L,s,u;l>=h?h>=c?(f=1,Y=0,y=0,L=1,s=1,u=0):l>=c?(f=1,Y=0,y=0,L=1,s=0,u=1):(f=0,Y=0,y=1,L=1,s=0,u=1):h<c?(f=0,Y=0,y=1,L=0,s=1,u=1):l<c?(f=0,Y=1,y=0,L=0,s=1,u=1):(f=0,Y=1,y=0,L=1,s=1,u=0);const a=l-f+B,j=h-Y+B,T=c-y+B,K=l-L+2*B,v=h-s+2*B,N=c-u+2*B,X=l-1+.5,p=h-1+.5,d=c-1+.5,b=255&e,D=255&F,M=255&z;let W=.6-l*l-h*h-c*c;if(W<0)o=0;else{const k=3*Z[b+U[D+U[M]]];W*=W,o=W*W*(O[k]*l+O[k+1]*h+O[k+2]*c)}let A=.6-a*a-j*j-T*T;if(A<0)m=0;else{const k=3*Z[b+f+U[D+Y+U[M+y]]];A*=A,m=A*A*(O[k]*a+O[k+1]*j+O[k+2]*T)}let g=.6-K*K-v*v-N*N;if(g<0)J=0;else{const k=3*Z[b+L+U[D+s+U[M+u]]];g*=g,J=g*g*(O[k]*K+O[k+1]*v+O[k+2]*N)}let R=.6-X*X-p*p-d*d;if(R<0)G=0;else{const k=3*Z[b+1+U[D+1+U[M+1]]];R*=R,G=R*R*(O[k]*X+O[k+1]*p+O[k+2]*d)}return 32*(o+m+J+G)}noise4D(k,Q,i,Z){const U=this.perm;let C,B,O,G,H;const e=(k+Q+i+Z)*o,F=Math.floor(k+e),z=Math.floor(Q+e),E=Math.floor(i+e),l=Math.floor(Z+e),h=(F+z+E+l)*m,c=k-(F-h),f=Q-(z-h),Y=i-(E-h),y=Z-(l-h);let L=0,s=0,u=0,a=0;c>f?L++:s++,c>Y?L++:u++,c>y?L++:a++,f>Y?s++:u++,f>y?s++:a++,Y>y?u++:a++;const j=L>=3?1:0,T=s>=3?1:0,K=u>=3?1:0,v=a>=3?1:0,N=L>=2?1:0,X=s>=2?1:0,p=u>=2?1:0,d=a>=2?1:0,b=L>=1?1:0,D=s>=1?1:0,M=u>=1?1:0,W=a>=1?1:0,A=c-j+m,g=f-T+m,R=Y-K+m,w=y-v+m,S=c-N+2*m,q=f-X+2*m,P=Y-p+2*m,t=y-d+2*m,I=c-b+3*m,r=f-D+3*m,n=Y-M+3*m,x=y-W+3*m,V=c-1+4*m,kk=f-1+4*m,Qk=Y-1+4*m,ik=y-1+4*m,Zk=255&F,Uk=255&z,Ck=255&E,Bk=255&l;let ok=.6-c*c-f*f-Y*Y-y*y;if(ok<0)C=0;else{const k=U[Zk+U[Uk+U[Ck+U[Bk]]]]%32*4;ok*=ok,C=ok*ok*(J[k]*c+J[k+1]*f+J[k+2]*Y+J[k+3]*y)}let mk=.6-A*A-g*g-R*R-w*w;if(mk<0)B=0;else{const k=U[Zk+j+U[Uk+T+U[Ck+K+U[Bk+v]]]]%32*4;mk*=mk,B=mk*mk*(J[k]*A+J[k+1]*g+J[k+2]*R+J[k+3]*w)}let Ok=.6-S*S-q*q-P*P-t*t;if(Ok<0)O=0;else{const k=U[Zk+N+U[Uk+X+U[Ck+p+U[Bk+d]]]]%32*4;Ok*=Ok,O=Ok*Ok*(J[k]*S+J[k+1]*q+J[k+2]*P+J[k+3]*t)}let Jk=.6-I*I-r*r-n*n-x*x;if(Jk<0)G=0;else{const k=U[Zk+b+U[Uk+D+U[Ck+M+U[Bk+W]]]]%32*4;Jk*=Jk,G=Jk*Jk*(J[k]*I+J[k+1]*r+J[k+2]*n+J[k+3]*x)}let Gk=.6-V*V-kk*kk-Qk*Qk-ik*ik;if(Gk<0)H=0;else{const k=U[Zk+1+U[Uk+1+U[Ck+1+U[Bk+1]]]]%32*4;Gk*=Gk,H=Gk*Gk*(J[k]*V+J[k+1]*kk+J[k+2]*Qk+J[k+3]*ik)}return 27*(C+B+O+G+H)}}}}]);