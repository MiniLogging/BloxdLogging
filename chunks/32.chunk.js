/*! For license information please see x4ubj.32.d81559e3.chunk.js.LICENSE.txt */
(self["7c63p8lin4r"]=self["7c63p8lin4r"]||[]).push([[32],{13550:function(z,u){!function(z){"use strict";var u=function(z,U){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(z,u){z.__proto__=u}||function(z,u){for(var U in u)Object.prototype.hasOwnProperty.call(u,U)&&(z[U]=u[U])},u(z,U)};function U(z,U){if("function"!==typeof U&&null!==U)throw new TypeError("Class extends value "+String(U)+" is not a constructor or null");function J(){this.constructor=z}u(z,U),z.prototype=null===U?Object.create(U):(J.prototype=U.prototype,new J)}function J(z,u,U,J){var v,f=arguments.length,g=f<3?u:null===J?J=Object.getOwnPropertyDescriptor(u,U):J;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=Reflect.decorate(z,u,U,J);else for(var w=z.length-1;w>=0;w--)(v=z[w])&&(g=(f<3?v(g):f>3?v(u,U,g):v(u,U))||g);return f>3&&g&&Object.defineProperty(u,U,g),g}function v(z,u,U){if(U||2===arguments.length)for(var J,v=0,f=u.length;v<f;v++)!J&&v in u||(J||(J=Array.prototype.slice.call(u,0,v)),J[v]=u[v]);return z.concat(J||Array.prototype.slice.call(u))}var f,g=255,w=213;z.OPERATION=void 0,(f=z.OPERATION||(z.OPERATION={}))[f.ADD=128]="ADD",f[f.REPLACE=0]="REPLACE",f[f.DELETE=64]="DELETE",f[f.DELETE_AND_ADD=192]="DELETE_AND_ADD",f[f.TOUCH=1]="TOUCH",f[f.CLEAR=10]="CLEAR";var P=function(){function u(z,u,U){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=z,this.setParent(u,U)}return u.prototype.setParent=function(z,u,U){var J=this;if(this.indexes||(this.indexes=this.ref instanceof Nz?this.ref._definition.indexes:{}),this.parent=z,this.parentIndex=U,u)if(this.root=u,this.ref instanceof Nz){var v=this.ref._definition;for(var f in v.schema){var g=this.ref[f];if(g&&g.$changes){var w=v.indexes[f];g.$changes.setParent(this.ref,u,w)}}}else"object"===typeof this.ref&&this.ref.forEach((function(z,u){if(z instanceof Nz){var U=z.$changes,v=J.ref.$changes.indexes[u];U.setParent(J.ref,J.root,v)}}))},u.prototype.operation=function(z){this.changes.set(--this.currentCustomOperation,z)},u.prototype.change=function(u,U){void 0===U&&(U=z.OPERATION.ADD);var J="number"===typeof u?u:this.indexes[u];this.assertValidIndex(J,u);var v=this.changes.get(J);v&&v.op!==z.OPERATION.DELETE&&v.op!==z.OPERATION.TOUCH||this.changes.set(J,{op:v&&v.op===z.OPERATION.DELETE?z.OPERATION.DELETE_AND_ADD:U,index:J}),this.allChanges.add(J),this.changed=!0,this.touchParents()},u.prototype.touch=function(u){var U="number"===typeof u?u:this.indexes[u];this.assertValidIndex(U,u),this.changes.has(U)||this.changes.set(U,{op:z.OPERATION.TOUCH,index:U}),this.allChanges.add(U),this.touchParents()},u.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},u.prototype.getType=function(z){if(this.ref._definition)return(u=this.ref._definition).schema[u.fieldsByIndex[z]];var u,U=(u=this.parent._definition).schema[u.fieldsByIndex[this.parentIndex]];return Object.values(U)[0]},u.prototype.getChildrenFilter=function(){var z=this.parent._definition.childFilters;return z&&z[this.parentIndex]},u.prototype.getValue=function(z){return this.ref.getByIndex(z)},u.prototype.delete=function(u){var U="number"===typeof u?u:this.indexes[u];if(void 0!==U){var J=this.getValue(U);this.changes.set(U,{op:z.OPERATION.DELETE,index:U}),this.allChanges.delete(U),delete this.caches[U],J&&J.$changes&&(J.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(u," (").concat(U,")"))},u.prototype.discard=function(u,U){var J=this;void 0===u&&(u=!1),void 0===U&&(U=!1),this.ref instanceof Nz||this.changes.forEach((function(u){if(u.op===z.OPERATION.DELETE){var U=J.ref.getIndex(u.index);delete J.indexes[U]}})),this.changes.clear(),this.changed=u,U&&this.allChanges.clear(),this.currentCustomOperation=0},u.prototype.discardAll=function(){var z=this;this.changes.forEach((function(u){var U=z.getValue(u.index);U&&U.$changes&&U.$changes.discardAll()})),this.discard()},u.prototype.cache=function(z,u){this.caches[z]=u},u.prototype.clone=function(){return new u(this.ref,this.parent,this.root)},u.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},u.prototype.assertValidIndex=function(z,u){if(void 0===z)throw new Error('ChangeTree: missing index for field "'.concat(u,'"'))},u}();function R(z,u,U,J){return z[u]||(z[u]=[]),z[u].push(U),null===J||void 0===J||J.forEach((function(z,u){return U(z,u)})),function(){return d(z[u],z[u].indexOf(U))}}function S(u){var U=this,J="string"!==typeof this.$changes.getType();this.$items.forEach((function(v,f){u.push({refId:U.$changes.refId,op:z.OPERATION.DELETE,field:f,value:void 0,previousValue:v}),J&&U.$changes.root.removeRef(v.$changes.refId)}))}function d(z,u){if(-1===u||u>=z.length)return!1;for(var U=z.length-1,J=u;J<U;J++)z[J]=z[J+1];return z.length=U,!0}var mz=function(z,u){var U=z.toString(),J=u.toString();return U<J?-1:U>J?1:0};function Z(z){return z.$proxy=!0,z=new Proxy(z,{get:function(z,u){return"symbol"===typeof u||isNaN(u)?z[u]:z.at(u)},set:function(z,u,U){if("symbol"===typeof u||isNaN(u))z[u]=U;else{var J=Array.from(z.$items.keys()),v=parseInt(J[u]||u);void 0===U||null===U?z.deleteAt(v):z.setAt(v,U)}return!0},deleteProperty:function(z,u){return"number"===typeof u?z.deleteAt(u):delete z[u],!0}})}var A=function(){function u(){for(var z=[],u=0;u<arguments.length;u++)z[u]=arguments[u];this.$changes=new P(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,z)}return u.prototype.rP=function(u,U){return void 0===U&&(U=!0),R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.ADD,u,U?this.$items:void 0)},u.prototype.tv=function(u){return R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,u)},u.is=function(z){return Array.isArray(z)||void 0!==z.array},Object.defineProperty(u.prototype,"length",{get:function(){return this.$items.size},set:function(z){0===z?this.clear():this.splice(z,this.length-z)},enumerable:!1,configurable:!0}),u.prototype.push=function(){for(var z,u=this,U=[],J=0;J<arguments.length;J++)U[J]=arguments[J];return U.forEach((function(U){z=u.$refId++,u.setAt(z,U)})),z},u.prototype.pop=function(){var z=Array.from(this.$indexes.values()).pop();if(void 0!==z){this.$changes.delete(z),this.$indexes.delete(z);var u=this.$items.get(z);return this.$items.delete(z),u}},u.prototype.at=function(z){var u=Array.from(this.$items.keys())[z];return this.$items.get(u)},u.prototype.setAt=function(u,U){var J,v;if(void 0!==U&&null!==U){if(this.$items.get(u)!==U){void 0!==U.$changes&&U.$changes.setParent(this,this.$changes.root,u);var f=null!==(v=null===(J=this.$changes.indexes[u])||void 0===J?void 0:J.op)&&void 0!==v?v:z.OPERATION.ADD;this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,U),this.$changes.change(u,f)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},u.prototype.deleteAt=function(z){var u=Array.from(this.$items.keys())[z];return void 0!==u&&this.$deleteAt(u)},u.prototype.$deleteAt=function(z){return this.$changes.delete(z),this.$indexes.delete(z),this.$items.delete(z)},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&S.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:z.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.concat=function(){for(var z,U=[],J=0;J<arguments.length;J++)U[J]=arguments[J];return new(u.bind.apply(u,v([void 0],(z=Array.from(this.$items.values())).concat.apply(z,U),!1)))},u.prototype.join=function(z){return Array.from(this.$items.values()).join(z)},u.prototype.reverse=function(){var z=this,u=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(U,J){z.setAt(u[J],U)})),this},u.prototype.shift=function(){var z=Array.from(this.$items.keys()).shift();if(void 0!==z){var u=this.$items.get(z);return this.$deleteAt(z),u}},u.prototype.slice=function(z,U){var J=new u;return J.push.apply(J,Array.from(this.$items.values()).slice(z,U)),J},u.prototype.sort=function(z){var u=this;void 0===z&&(z=mz);var U=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(z).forEach((function(z,J){u.setAt(U[J],z)})),this},u.prototype.splice=function(z,u){void 0===u&&(u=this.length-z);for(var U=Array.from(this.$items.keys()),J=[],v=z;v<z+u;v++)J.push(this.$items.get(U[v])),this.$deleteAt(U[v]);return J},u.prototype.unshift=function(){for(var z=this,u=[],U=0;U<arguments.length;U++)u[U]=arguments[U];var J=this.length,v=u.length,f=Array.from(this.$items.values());return u.forEach((function(u,U){z.setAt(U,u)})),f.forEach((function(u,U){z.setAt(v+U,u)})),J+v},u.prototype.indexOf=function(z,u){return Array.from(this.$items.values()).indexOf(z,u)},u.prototype.lastIndexOf=function(z,u){return void 0===u&&(u=this.length-1),Array.from(this.$items.values()).lastIndexOf(z,u)},u.prototype.every=function(z,u){return Array.from(this.$items.values()).every(z,u)},u.prototype.some=function(z,u){return Array.from(this.$items.values()).some(z,u)},u.prototype.forEach=function(z,u){Array.from(this.$items.values()).forEach(z,u)},u.prototype.map=function(z,u){return Array.from(this.$items.values()).map(z,u)},u.prototype.filter=function(z,u){return Array.from(this.$items.values()).filter(z,u)},u.prototype.reduce=function(z,u){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},u.prototype.reduceRight=function(z,u){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},u.prototype.find=function(z,u){return Array.from(this.$items.values()).find(z,u)},u.prototype.findIndex=function(z,u){return Array.from(this.$items.values()).findIndex(z,u)},u.prototype.fill=function(z,u,U){throw new Error("ArraySchema#fill() not implemented")},u.prototype.copyWithin=function(z,u,U){throw new Error("ArraySchema#copyWithin() not implemented")},u.prototype.toString=function(){return this.$items.toString()},u.prototype.toLocaleString=function(){return this.$items.toLocaleString()},u.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(u,Symbol.species,{get:function(){return u},enumerable:!1,configurable:!0}),u.prototype.entries=function(){return this.$items.entries()},u.prototype.keys=function(){return this.$items.keys()},u.prototype.values=function(){return this.$items.values()},u.prototype.includes=function(z,u){return Array.from(this.$items.values()).includes(z,u)},u.prototype.flatMap=function(z,u){throw new Error("ArraySchema#flatMap() is not supported.")},u.prototype.flat=function(z){throw new Error("ArraySchema#flat() is not supported.")},u.prototype.findLast=function(){var z=Array.from(this.$items.values());return z.findLast.apply(z,arguments)},u.prototype.findLastIndex=function(){var z=Array.from(this.$items.values());return z.findLastIndex.apply(z,arguments)},u.prototype.setIndex=function(z,u){this.$indexes.set(z,u)},u.prototype.getIndex=function(z){return this.$indexes.get(z)},u.prototype.getByIndex=function(z){return this.$items.get(this.$indexes.get(z))},u.prototype.deleteByIndex=function(z){var u=this.$indexes.get(z);this.$items.delete(u),this.$indexes.delete(z)},u.prototype.toArray=function(){return Array.from(this.$items.values())},u.prototype.toJSON=function(){return this.toArray().map((function(z){return"function"===typeof z.toJSON?z.toJSON():z}))},u.prototype.clone=function(z){return z?new(u.bind.apply(u,v([void 0],Array.from(this.$items.values()),!1))):new(u.bind.apply(u,v([void 0],this.map((function(z){return z.$changes?z.clone():z})),!1)))},u}();function E(z){return z.$proxy=!0,z=new Proxy(z,{get:function(z,u){return"symbol"!==typeof u&&"undefined"===typeof z[u]?z.get(u):z[u]},set:function(z,u,U){return"symbol"!==typeof u&&-1===u.indexOf("$")&&"rP"!==u&&"tv"!==u&&"onChange"!==u?z.set(u,U):z[u]=U,!0},deleteProperty:function(z,u){return z.delete(u),!0}})}var C=function(){function u(z){var U=this;if(this.$changes=new P(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,z)if(z instanceof Map||z instanceof u)z.forEach((function(z,u){return U.set(u,z)}));else for(var J in z)this.set(J,z[J])}return u.prototype.rP=function(u,U){return void 0===U&&(U=!0),R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.ADD,u,U?this.$items:void 0)},u.prototype.tv=function(u){return R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,u)},u.is=function(z){return void 0!==z.map},u.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(u.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(u,Symbol.species,{get:function(){return u},enumerable:!1,configurable:!0}),u.prototype.set=function(u,U){if(void 0===U||null===U)throw new Error("MapSchema#set('".concat(u,"', ").concat(U,"): trying to set ").concat(U," value on '").concat(u,"'."));u=u.toString();var J="undefined"!==typeof this.$changes.indexes[u],v=J?this.$changes.indexes[u]:this.$refId++,f=J?z.OPERATION.REPLACE:z.OPERATION.ADD,g=void 0!==U.$changes;if(g&&U.$changes.setParent(this,this.$changes.root,v),J){if(!g&&this.$items.get(u)===U)return;g&&this.$items.get(u)!==U&&(f=z.OPERATION.ADD)}else this.$changes.indexes[u]=v,this.$indexes.set(v,u);return this.$items.set(u,U),this.$changes.change(u,f),this},u.prototype.get=function(z){return this.$items.get(z)},u.prototype.delete=function(z){return this.$changes.delete(z),this.$items.delete(z)},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&S.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:z.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.has=function(z){return this.$items.has(z)},u.prototype.forEach=function(z){this.$items.forEach(z)},u.prototype.entries=function(){return this.$items.entries()},u.prototype.keys=function(){return this.$items.keys()},u.prototype.values=function(){return this.$items.values()},Object.defineProperty(u.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),u.prototype.setIndex=function(z,u){this.$indexes.set(z,u)},u.prototype.getIndex=function(z){return this.$indexes.get(z)},u.prototype.getByIndex=function(z){return this.$items.get(this.$indexes.get(z))},u.prototype.deleteByIndex=function(z){var u=this.$indexes.get(z);this.$items.delete(u),this.$indexes.delete(z)},u.prototype.toJSON=function(){var z={};return this.forEach((function(u,U){z[U]="function"===typeof u.toJSON?u.toJSON():u})),z},u.prototype.clone=function(z){var U;return z?U=Object.assign(new u,this):(U=new u,this.forEach((function(z,u){z.$changes?U.set(u,z.clone()):U.set(u,z)}))),U},u}(),r={};function M(z,u){r[z]=u}function T(z){return r[z]}var X=function(){function z(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return z.create=function(u){var U=new z;return U.schema=Object.assign({},u&&u.schema||{}),U.indexes=Object.assign({},u&&u.indexes||{}),U.fieldsByIndex=Object.assign({},u&&u.fieldsByIndex||{}),U.descriptors=Object.assign({},u&&u.descriptors||{}),U.deprecated=Object.assign({},u&&u.deprecated||{}),U},z.prototype.addField=function(z,u){var U=this.getNextFieldIndex();this.fieldsByIndex[U]=z,this.indexes[z]=U,this.schema[z]=Array.isArray(u)?{array:u[0]}:u},z.prototype.hasField=function(z){return void 0!==this.indexes[z]},z.prototype.addFilter=function(z,u){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[z]]=u,this.indexesWithFilters.push(this.indexes[z]),!0},z.prototype.addChildrenFilter=function(z,u){var U=this.indexes[z],J=this.schema[z];if(T(Object.keys(J)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[U]=u,!0;console.warn("@filterChildren: field '".concat(z,"' can't have children. Ignoring filter."))},z.prototype.getChildrenFilter=function(z){return this.childFilters&&this.childFilters[this.indexes[z]]},z.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},z}();function h(z){return z._context&&z._context.useFilters}var t=function(){function z(){this.types={},this.schemas=new Map,this.useFilters=!1}return z.prototype.has=function(z){return this.schemas.has(z)},z.prototype.get=function(z){return this.types[z]},z.prototype.add=function(z,u){void 0===u&&(u=this.schemas.size),z._definition=X.create(z._definition),z._typeid=u,this.types[u]=z,this.schemas.set(z,u)},z.create=function(u){return void 0===u&&(u={}),function(U){return u.context||(u.context=new z),L(U,u)}},z}(),V=new t;function L(z,u){return void 0===u&&(u={}),function(U,J){var f=u.context||V,g=U.constructor;if(g._context=f,!z)throw new Error("".concat(g.name,': @type() reference provided for "').concat(J,"\" is undefined. Make sure you don't have any circular dependencies."));f.has(g)||f.add(g);var w=g._definition;if(w.addField(J,z),w.descriptors[J]){if(w.deprecated[J])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(J,"' definition on '").concat(g.name,"'.\nCheck @type() annotation"))}catch(r){var P=r.stack.split("\n")[4].trim();throw new Error("".concat(r.message," ").concat(P))}}var R=A.is(z),S=!R&&C.is(z);if("string"!==typeof z&&!Nz.is(z)){var d=Object.values(z)[0];"string"===typeof d||f.has(d)||f.add(d)}if(u.manual)w.descriptors[J]={enumerable:!0,configurable:!0,writable:!0};else{var mz="_".concat(J);w.descriptors[mz]={enumerable:!1,configurable:!1,writable:!0},w.descriptors[J]={get:function(){return this[mz]},set:function(z){z!==this[mz]&&(void 0!==z&&null!==z?(!R||z instanceof A||(z=new(A.bind.apply(A,v([void 0],z,!1)))),!S||z instanceof C||(z=new C(z)),void 0===z.$proxy&&(S?z=E(z):R&&(z=Z(z))),this.$changes.change(J),z.$changes&&z.$changes.setParent(this,this.$changes.root,this._definition.indexes[J])):this[mz]&&this.$changes.delete(J),this[mz]=z)},enumerable:!0,configurable:!0}}}}function O(z){return function(u,U){var J=u.constructor;J._definition.addFilter(U,z)&&(J._context.useFilters=!0)}}function x(z){return function(u,U){var J=u.constructor;J._definition.addChildrenFilter(U,z)&&(J._context.useFilters=!0)}}function Q(z){return void 0===z&&(z=!0),function(u,U){var J=u.constructor._definition;J.deprecated[U]=!0,z&&(J.descriptors[U]={get:function(){throw new Error("".concat(U," is deprecated."))},set:function(z){},enumerable:!1,configurable:!0})}}function K(z,u,U){for(var J in void 0===U&&(U={}),U.context||(U.context=z._context||U.context||V),u)L(u[J],U)(z.prototype,J);return z}function Y(z){for(var u=0,U=0,J=0,v=z.length;J<v;J++)(u=z.charCodeAt(J))<128?U+=1:u<2048?U+=2:u<55296||u>=57344?U+=3:(J++,U+=4);return U}function p(z,u,U){for(var J=0,v=0,f=U.length;v<f;v++)(J=U.charCodeAt(v))<128?z[u++]=J:J<2048?(z[u++]=192|J>>6,z[u++]=128|63&J):J<55296||J>=57344?(z[u++]=224|J>>12,z[u++]=128|J>>6&63,z[u++]=128|63&J):(v++,J=65536+((1023&J)<<10|1023&U.charCodeAt(v)),z[u++]=240|J>>18,z[u++]=128|J>>12&63,z[u++]=128|J>>6&63,z[u++]=128|63&J)}function N(z,u){z.push(255&u)}function D(z,u){z.push(255&u)}function c(z,u){z.push(255&u),z.push(u>>8&255)}function W(z,u){z.push(255&u),z.push(u>>8&255)}function j(z,u){z.push(255&u),z.push(u>>8&255),z.push(u>>16&255),z.push(u>>24&255)}function I(z,u){var U=u>>24,J=u>>16,v=u>>8,f=u;z.push(255&f),z.push(255&v),z.push(255&J),z.push(255&U)}function F(z,u){var U=Math.floor(u/Math.pow(2,32));I(z,u>>>0),I(z,U)}function b(z,u){var U=u/Math.pow(2,32)|0;I(z,u>>>0),I(z,U)}function k(z,u){a(z,u)}function B(z,u){i(z,u)}var y=new Int32Array(2),H=new Float32Array(y.buffer),G=new Float64Array(y.buffer);function a(z,u){H[0]=u,j(z,y[0])}function i(z,u){G[0]=u,j(z,y[0]),j(z,y[1])}function n(z,u){return D(z,u?1:0)}function q(z,u){u||(u="");var U=Y(u),J=0;if(U<32)z.push(160|U),J=1;else if(U<256)z.push(217),D(z,U),J=2;else if(U<65536)z.push(218),W(z,U),J=3;else{if(!(U<4294967296))throw new Error("String too long");z.push(219),I(z,U),J=5}return p(z,z.length,u),J+U}function o(z,u){return isNaN(u)?o(z,0):isFinite(u)?u!==(0|u)?(z.push(203),i(z,u),9):u>=0?u<128?(D(z,u),1):u<256?(z.push(204),D(z,u),2):u<65536?(z.push(205),W(z,u),3):u<4294967296?(z.push(206),I(z,u),5):(z.push(207),b(z,u),9):u>=-32?(z.push(224|u+32),1):u>=-128?(z.push(208),N(z,u),2):u>=-32768?(z.push(209),c(z,u),3):u>=-2147483648?(z.push(210),j(z,u),5):(z.push(211),F(z,u),9):o(z,u>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var s=Object.freeze({__proto__:null,utf8Write:p,int8:N,uint8:D,int16:c,uint16:W,int32:j,uint32:I,int64:F,uint64:b,float32:k,float64:B,writeFloat32:a,writeFloat64:i,boolean:n,string:q,number:o});function l(z,u,U){for(var J="",v=0,f=u,g=u+U;f<g;f++){var w=z[f];0!==(128&w)?192!==(224&w)?224!==(240&w)?240!==(248&w)?console.error("Invalid byte "+w.toString(16)):(v=(7&w)<<18|(63&z[++f])<<12|(63&z[++f])<<6|63&z[++f])>=65536?(v-=65536,J+=String.fromCharCode(55296+(v>>>10),56320+(1023&v))):J+=String.fromCharCode(v):J+=String.fromCharCode((15&w)<<12|(63&z[++f])<<6|63&z[++f]):J+=String.fromCharCode((31&w)<<6|63&z[++f]):J+=String.fromCharCode(w)}return J}function e(z,u){return zz(z,u)<<24>>24}function zz(z,u){return z[u.offset++]}function uz(z,u){return Uz(z,u)<<16>>16}function Uz(z,u){return z[u.offset++]|z[u.offset++]<<8}function Jz(z,u){return z[u.offset++]|z[u.offset++]<<8|z[u.offset++]<<16|z[u.offset++]<<24}function vz(z,u){return Jz(z,u)>>>0}function fz(z,u){return mu(z,u)}function gz(z,u){return Zz(z,u)}function wz(z,u){var U=vz(z,u);return Jz(z,u)*Math.pow(2,32)+U}function Pz(z,u){var U=vz(z,u);return vz(z,u)*Math.pow(2,32)+U}var Rz=new Int32Array(2),Sz=new Float32Array(Rz.buffer),dz=new Float64Array(Rz.buffer);function mu(z,u){return Rz[0]=Jz(z,u),Sz[0]}function Zz(z,u){return Rz[0]=Jz(z,u),Rz[1]=Jz(z,u),dz[0]}function Az(z,u){return zz(z,u)>0}function Ez(z,u){var U,J=z[u.offset++];J<192?U=31&J:217===J?U=zz(z,u):218===J?U=Uz(z,u):219===J&&(U=vz(z,u));var v=l(z,u.offset,U);return u.offset+=U,v}function Cz(z,u){var U=z[u.offset];return U<192&&U>160||217===U||218===U||219===U}function rz(z,u){var U=z[u.offset++];return U<128?U:202===U?mu(z,u):203===U?Zz(z,u):204===U?zz(z,u):205===U?Uz(z,u):206===U?vz(z,u):207===U?Pz(z,u):208===U?e(z,u):209===U?uz(z,u):210===U?Jz(z,u):211===U?wz(z,u):U>223?-1*(255-U+1):void 0}function Mz(z,u){var U=z[u.offset];return U<128||U>=202&&U<=211}function Tz(z,u){return z[u.offset]<160}function Xz(z,u){return z[u.offset-1]===g&&(z[u.offset]<128||z[u.offset]>=202&&z[u.offset]<=211)}var hz=Object.freeze({__proto__:null,int8:e,uint8:zz,int16:uz,uint16:Uz,int32:Jz,uint32:vz,float32:fz,float64:gz,int64:wz,uint64:Pz,readFloat32:mu,readFloat64:Zz,boolean:Az,string:Ez,stringCheck:Cz,number:rz,numberCheck:Mz,arrayCheck:Tz,switchStructureCheck:Xz}),tz=function(){function u(z){var u=this;this.$changes=new P(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,z&&z.forEach((function(z){return u.add(z)}))}return u.prototype.rP=function(u,U){return void 0===U&&(U=!0),R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.ADD,u,U?this.$items:void 0)},u.prototype.tv=function(u){return R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,u)},u.is=function(z){return void 0!==z.collection},u.prototype.add=function(z){var u=this.$refId++;return void 0!==z.$changes&&z.$changes.setParent(this,this.$changes.root,u),this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,z),this.$changes.change(u),u},u.prototype.at=function(z){var u=Array.from(this.$items.keys())[z];return this.$items.get(u)},u.prototype.entries=function(){return this.$items.entries()},u.prototype.delete=function(z){for(var u,U,J=this.$items.entries();(U=J.next())&&!U.done;)if(z===U.value[1]){u=U.value[0];break}return void 0!==u&&(this.$changes.delete(u),this.$indexes.delete(u),this.$items.delete(u))},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&S.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:z.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.has=function(z){return Array.from(this.$items.values()).some((function(u){return u===z}))},u.prototype.forEach=function(z){var u=this;this.$items.forEach((function(U,J,v){return z(U,J,u)}))},u.prototype.values=function(){return this.$items.values()},Object.defineProperty(u.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),u.prototype.setIndex=function(z,u){this.$indexes.set(z,u)},u.prototype.getIndex=function(z){return this.$indexes.get(z)},u.prototype.getByIndex=function(z){return this.$items.get(this.$indexes.get(z))},u.prototype.deleteByIndex=function(z){var u=this.$indexes.get(z);this.$items.delete(u),this.$indexes.delete(z)},u.prototype.toArray=function(){return Array.from(this.$items.values())},u.prototype.toJSON=function(){var z=[];return this.forEach((function(u,U){z.push("function"===typeof u.toJSON?u.toJSON():u)})),z},u.prototype.clone=function(z){var U;return z?U=Object.assign(new u,this):(U=new u,this.forEach((function(z){z.$changes?U.add(z.clone()):U.add(z)}))),U},u}(),Vz=function(){function u(z){var u=this;this.$changes=new P(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,z&&z.forEach((function(z){return u.add(z)}))}return u.prototype.rP=function(u,U){return void 0===U&&(U=!0),R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.ADD,u,U?this.$items:void 0)},u.prototype.tv=function(u){return R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,u)},u.is=function(z){return void 0!==z.set},u.prototype.add=function(u){var U,J;if(this.has(u))return!1;var v=this.$refId++;void 0!==u.$changes&&u.$changes.setParent(this,this.$changes.root,v);var f=null!==(J=null===(U=this.$changes.indexes[v])||void 0===U?void 0:U.op)&&void 0!==J?J:z.OPERATION.ADD;return this.$changes.indexes[v]=v,this.$indexes.set(v,v),this.$items.set(v,u),this.$changes.change(v,f),v},u.prototype.entries=function(){return this.$items.entries()},u.prototype.delete=function(z){for(var u,U,J=this.$items.entries();(U=J.next())&&!U.done;)if(z===U.value[1]){u=U.value[0];break}return void 0!==u&&(this.$changes.delete(u),this.$indexes.delete(u),this.$items.delete(u))},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&S.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:z.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.has=function(z){for(var u,U=this.$items.values(),J=!1;(u=U.next())&&!u.done;)if(z===u.value){J=!0;break}return J},u.prototype.forEach=function(z){var u=this;this.$items.forEach((function(U,J,v){return z(U,J,u)}))},u.prototype.values=function(){return this.$items.values()},Object.defineProperty(u.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),u.prototype.setIndex=function(z,u){this.$indexes.set(z,u)},u.prototype.getIndex=function(z){return this.$indexes.get(z)},u.prototype.getByIndex=function(z){return this.$items.get(this.$indexes.get(z))},u.prototype.deleteByIndex=function(z){var u=this.$indexes.get(z);this.$items.delete(u),this.$indexes.delete(z)},u.prototype.toArray=function(){return Array.from(this.$items.values())},u.prototype.toJSON=function(){var z=[];return this.forEach((function(u,U){z.push("function"===typeof u.toJSON?u.toJSON():u)})),z},u.prototype.clone=function(z){var U;return z?U=Object.assign(new u,this):(U=new u,this.forEach((function(z){z.$changes?U.add(z.clone()):U.add(z)}))),U},u}(),Lz=function(){function z(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return z.prototype.addRefId=function(z){this.refIds.has(z)||(this.refIds.add(z),this.containerIndexes.set(z,new Set))},z.get=function(u){return void 0===u.$filterState&&(u.$filterState=new z),u.$filterState},z}(),Oz=function(){function z(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return z.prototype.getNextUniqueId=function(){return this.nextUniqueId++},z.prototype.addRef=function(z,u,U){void 0===U&&(U=!0),this.refs.set(z,u),U&&(this.refCounts[z]=(this.refCounts[z]||0)+1)},z.prototype.removeRef=function(z){this.refCounts[z]=this.refCounts[z]-1,this.deletedRefs.add(z)},z.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},z.prototype.garbageCollectDeletedRefs=function(){var z=this;this.deletedRefs.forEach((function(u){if(!(z.refCounts[u]>0)){var U=z.refs.get(u);if(U instanceof Nz)for(var J in U._definition.schema)"string"!==typeof U._definition.schema[J]&&U[J]&&U[J].$changes&&z.removeRef(U[J].$changes.refId);else{var v=U.$changes.parent._definition,f=v.schema[v.fieldsByIndex[U.$changes.parentIndex]];"function"===typeof Object.values(f)[0]&&Array.from(U.values()).forEach((function(u){return z.removeRef(u.$changes.refId)}))}z.refs.delete(u),delete z.refCounts[u]}})),this.deletedRefs.clear()},z}(),xz=function(z){function u(){return null!==z&&z.apply(this,arguments)||this}return U(u,z),u}(Error);function Qz(z,u,U,J){var v,f=!1;switch(u){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":v="number",isNaN(z)&&console.log('trying to encode "NaN" in '.concat(U.constructor.name,"#").concat(J));break;case"string":v="string",f=!0;break;case"boolean":return}if(typeof z!==v&&(!f||f&&null!==z)){var g="'".concat(JSON.stringify(z),"'").concat(z&&z.constructor&&" (".concat(z.constructor.name,")")||"");throw new xz("a '".concat(v,"' was expected, but ").concat(g," was provided in ").concat(U.constructor.name,"#").concat(J))}}function Kz(z,u,U,J){if(!(z instanceof u))throw new xz("a '".concat(u.name,"' was expected, but '").concat(z.constructor.name,"' was provided in ").concat(U.constructor.name,"#").concat(J))}function Yz(z,u,U,J,v){Qz(U,z,J,v);var f=s[z];if(!f)throw new xz("a '".concat(z,"' was expected, but ").concat(U," was provided in ").concat(J.constructor.name,"#").concat(v));f(u,U)}function pz(z,u,U){return hz[z](u,U)}var Nz=function(){function u(){for(var z=[],u=0;u<arguments.length;u++)z[u]=arguments[u];Object.defineProperties(this,{$changes:{value:new P(this,void 0,new Oz),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var U=this._definition.descriptors;U&&Object.defineProperties(this,U),z[0]&&this.assign(z[0])}return u.onError=function(z){console.error(z)},u.is=function(z){return z._definition&&void 0!==z._definition.schema},u.prototype.onChange=function(u){return R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,u)},u.prototype.tv=function(u){return R(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,u)},u.prototype.assign=function(z){return Object.assign(this,z),this},Object.defineProperty(u.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),u.prototype.setDirty=function(z,u){this.$changes.change(z,u)},u.prototype.listen=function(z,u,U){var J=this;return void 0===U&&(U=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[z]||(this.$callbacks[z]=[]),this.$callbacks[z].push(u),U&&void 0!==this[z]&&u(this[z],void 0),function(){return d(J.$callbacks[z],J.$callbacks[z].indexOf(u))}},u.prototype.decode=function(U,J,v){var f;void 0===J&&(J={offset:0}),void 0===v&&(v=this);var w=[],P=this.$changes.root,R=U.length,S=0;for(P.refs.set(S,this);J.offset<R;){var d=U[J.offset++];if(d!=g){var mz=v.$changes,Z=void 0!==v._definition,E=Z?d>>6<<6:d;if(E!==z.OPERATION.CLEAR){var r=Z?d%(E||255):rz(U,J),M=Z?v._definition.fieldsByIndex[r]:"",X=mz.getType(r),h=void 0,t=void 0,V=void 0;if(Z?t=v["_".concat(M)]:(t=v.getByIndex(r),(E&z.OPERATION.ADD)===z.OPERATION.ADD?(V=v instanceof C?Ez(U,J):r,v.setIndex(r,V)):V=v.getIndex(r)),(E&z.OPERATION.DELETE)===z.OPERATION.DELETE&&(E!==z.OPERATION.DELETE_AND_ADD&&v.deleteByIndex(r),t&&t.$changes&&P.removeRef(t.$changes.refId),h=null),void 0!==M){if(E===z.OPERATION.DELETE);else if(u.is(X)){var L=rz(U,J);if(h=P.refs.get(L),E!==z.OPERATION.REPLACE){var O=this.getSchemaType(U,J,X);h||((h=this.createTypeInstance(O)).$changes.refId=L,t&&(h.$callbacks=t.$callbacks,t.$changes.refId&&L!==t.$changes.refId&&P.removeRef(t.$changes.refId))),P.addRef(L,h,h!==t)}}else if("string"===typeof X)h=pz(X,U,J);else{var x=T(Object.keys(X)[0]),Q=rz(U,J),K=P.refs.has(Q)?t||P.refs.get(Q):new x.constructor;if((h=K.clone(!0)).$changes.refId=Q,t&&(h.$callbacks=t.$callbacks,t.$changes.refId&&Q!==t.$changes.refId)){P.removeRef(t.$changes.refId);for(var Y=t.entries(),p=void 0;(p=Y.next())&&!p.done;){var N=(f=p.value)[0],D=f[1];w.push({refId:Q,op:z.OPERATION.DELETE,field:N,value:void 0,previousValue:D})}}P.addRef(Q,h,K!==t)}if(null!==h&&void 0!==h)if(h.$changes&&h.$changes.setParent(mz.ref,mz.root,r),v instanceof u)v[M]=h;else if(v instanceof C)N=V,v.$items.set(N,h),v.$changes.allChanges.add(r);else if(v instanceof A)v.setAt(r,h);else if(v instanceof tz){var c=v.add(h);v.setIndex(r,c)}else v instanceof Vz&&!1!==(c=v.add(h))&&v.setIndex(r,c);t!==h&&w.push({refId:S,op:E,field:M,dynamicIndex:V,value:h,previousValue:t})}else{console.warn("@colyseus/schema: definition mismatch");for(var W={offset:J.offset};J.offset<R&&(!Xz(U,J)||(W.offset=J.offset+1,!P.refs.has(rz(U,W))));)J.offset++}}else v.clear(w)}else{S=rz(U,J);var j=P.refs.get(S);if(!j)throw new Error('"refId" not found: '.concat(S));v=j}}return this._triggerChanges(w),P.garbageCollectDeletedRefs(),w},u.prototype.encode=function(U,J,v){void 0===U&&(U=!1),void 0===J&&(J=[]),void 0===v&&(v=!1);for(var f=this.$changes,w=new WeakSet,P=[f],R=1,S=0;S<R;S++){var d=P[S],mz=d.ref,Z=mz instanceof u;d.ensureRefId(),w.add(d),d!==f&&(d.changed||U)&&(D(J,g),o(J,d.refId));for(var A=U?Array.from(d.allChanges):Array.from(d.changes.values()),E=0,r=A.length;E<r;E++){var M=U?{op:z.OPERATION.ADD,index:A[E]}:A[E],X=M.index,h=Z?mz._definition.fieldsByIndex&&mz._definition.fieldsByIndex[X]:X,t=J.length;if(M.op!==z.OPERATION.TOUCH)if(Z)D(J,X|M.op);else{if(D(J,M.op),M.op===z.OPERATION.CLEAR)continue;o(J,X)}if(Z||(M.op&z.OPERATION.ADD)!=z.OPERATION.ADD||mz instanceof C&&q(J,d.ref.$indexes.get(X)),M.op!==z.OPERATION.DELETE){var V=d.getType(X),L=d.getValue(X);if(L&&L.$changes&&!w.has(L.$changes)&&(P.push(L.$changes),L.$changes.ensureRefId(),R++),M.op!==z.OPERATION.TOUCH){if(u.is(V))Kz(L,V,mz,h),o(J,L.$changes.refId),(M.op&z.OPERATION.ADD)===z.OPERATION.ADD&&this.tryEncodeTypeId(J,V,L.constructor);else if("string"===typeof V)Yz(V,J,L,mz,h);else{var O=T(Object.keys(V)[0]);Kz(mz["_".concat(h)],O.constructor,mz,h),o(J,L.$changes.refId)}v&&d.cache(X,J.slice(t))}}}U||v||d.discard()}return J},u.prototype.encodeAll=function(z){return this.encode(!0,[],z)},u.prototype.applyFilters=function(U,J){var v,f;void 0===J&&(J=!1);for(var w=this,P=new Set,R=Lz.get(U),S=[this.$changes],d=1,mz=[],Z=function(Z){var A=S[Z];if(P.has(A.refId))return"continue";var E=A.ref,r=E instanceof u;D(mz,g),o(mz,A.refId);var M=R.refIds.has(A),T=J||!M;R.addRefId(A);var X=R.containerIndexes.get(A),h=T?Array.from(A.allChanges):Array.from(A.changes.values());!J&&r&&E._definition.indexesWithFilters&&E._definition.indexesWithFilters.forEach((function(u){!X.has(u)&&A.allChanges.has(u)&&(T?h.push(u):h.push({op:z.OPERATION.ADD,index:u}))}));for(var t=0,V=h.length;t<V;t++){var L=T?{op:z.OPERATION.ADD,index:h[t]}:h[t];if(L.op!==z.OPERATION.CLEAR){var O=L.index;if(L.op!==z.OPERATION.DELETE){var x=A.getValue(O),Q=A.getType(O);if(r){if((K=E._definition.filters&&E._definition.filters[O])&&!K.call(E,U,x,w)){x&&x.$changes&&P.add(x.$changes.refId);continue}}else{var K,Y=A.parent;if((K=A.getChildrenFilter())&&!K.call(Y,U,E.$indexes.get(O),x,w)){x&&x.$changes&&P.add(x.$changes.refId);continue}}if(x.$changes&&(S.push(x.$changes),d++),L.op!==z.OPERATION.TOUCH)if(L.op===z.OPERATION.ADD||r)mz.push.apply(mz,null!==(v=A.caches[O])&&void 0!==v?v:[]),X.add(O);else if(X.has(O))mz.push.apply(mz,null!==(f=A.caches[O])&&void 0!==f?f:[]);else{if(X.add(O),D(mz,z.OPERATION.ADD),o(mz,O),E instanceof C){var p=A.ref.$indexes.get(O);q(mz,p)}x.$changes?o(mz,x.$changes.refId):s[Q](mz,x)}else x.$changes&&!r&&(D(mz,z.OPERATION.ADD),o(mz,O),E instanceof C&&(p=A.ref.$indexes.get(O),q(mz,p)),o(mz,x.$changes.refId))}else r?D(mz,L.op|O):(D(mz,L.op),o(mz,O))}else D(mz,L.op)}},A=0;A<d;A++)Z(A);return mz},u.prototype.clone=function(){var z,u=new this.constructor,U=this._definition.schema;for(var J in U)"object"===typeof this[J]&&"function"===typeof(null===(z=this[J])||void 0===z?void 0:z.clone)?u[J]=this[J].clone():u[J]=this[J];return u},u.prototype.toJSON=function(){var z=this._definition.schema,u=this._definition.deprecated,U={};for(var J in z)u[J]||null===this[J]||"undefined"===typeof this[J]||(U[J]="function"===typeof this[J].toJSON?this[J].toJSON():this["_".concat(J)]);return U},u.prototype.discardAllChanges=function(){this.$changes.discardAll()},u.prototype.getByIndex=function(z){return this[this._definition.fieldsByIndex[z]]},u.prototype.deleteByIndex=function(z){this[this._definition.fieldsByIndex[z]]=void 0},u.prototype.tryEncodeTypeId=function(z,u,U){u._typeid!==U._typeid&&(D(z,w),o(z,U._typeid))},u.prototype.getSchemaType=function(z,u,U){var J;return z[u.offset]===w&&(u.offset++,J=this.constructor._context.get(rz(z,u))),J||U},u.prototype.createTypeInstance=function(z){var u=new z;return u.$changes.root=this.$changes.root,u},u.prototype._triggerChanges=function(U){for(var J,v,f,g,w,P,R,S,d,mz=new Set,Z=this.$changes.root.refs,A=function(A){var E=U[A],C=E.refId,r=Z.get(C),M=r.$callbacks;if((E.op&z.OPERATION.DELETE)===z.OPERATION.DELETE&&E.previousValue instanceof u&&(null===(v=null===(J=E.previousValue.$callbacks)||void 0===J?void 0:J[z.OPERATION.DELETE])||void 0===v||v.forEach((function(z){return z()}))),!M)return"continue";if(r instanceof u){if(!mz.has(C))try{null===(f=null===M||void 0===M?void 0:M[z.OPERATION.REPLACE])||void 0===f||f.forEach((function(z){return z()}))}catch(T){u.onError(T)}try{M.hasOwnProperty(E.field)&&(null===(g=M[E.field])||void 0===g||g.forEach((function(z){return z(E.value,E.previousValue)})))}catch(T){u.onError(T)}}else E.op===z.OPERATION.ADD&&void 0===E.previousValue?null===(w=M[z.OPERATION.ADD])||void 0===w||w.forEach((function(z){var u;return z(E.value,null!==(u=E.dynamicIndex)&&void 0!==u?u:E.field)})):E.op===z.OPERATION.DELETE?void 0!==E.previousValue&&(null===(P=M[z.OPERATION.DELETE])||void 0===P||P.forEach((function(z){var u;return z(E.previousValue,null!==(u=E.dynamicIndex)&&void 0!==u?u:E.field)}))):E.op===z.OPERATION.DELETE_AND_ADD&&(void 0!==E.previousValue&&(null===(R=M[z.OPERATION.DELETE])||void 0===R||R.forEach((function(z){var u;return z(E.previousValue,null!==(u=E.dynamicIndex)&&void 0!==u?u:E.field)}))),null===(S=M[z.OPERATION.ADD])||void 0===S||S.forEach((function(z){var u;return z(E.value,null!==(u=E.dynamicIndex)&&void 0!==u?u:E.field)}))),E.value!==E.previousValue&&(null===(d=M[z.OPERATION.REPLACE])||void 0===d||d.forEach((function(z){var u;return z(E.value,null!==(u=E.dynamicIndex)&&void 0!==u?u:E.field)})));mz.add(C)},E=0;E<U.length;E++)A(E)},u._definition=X.create(),u}();function Dz(z){for(var u=[z.$changes],U=1,J={},v=J,f=function(z){var U=u[z];U.changes.forEach((function(z){var u=U.ref,J=z.index,f=u._definition?u._definition.fieldsByIndex[J]:u.$indexes.get(J);v[f]=U.getValue(J)}))},g=0;g<U;g++)f(g);return J}var cz={context:new t},Wz=function(z){function u(){return null!==z&&z.apply(this,arguments)||this}return U(u,z),J([L("string",cz)],u.prototype,"name",void 0),J([L("string",cz)],u.prototype,"type",void 0),J([L("number",cz)],u.prototype,"referencedType",void 0),u}(Nz),jz=function(z){function u(){var u=null!==z&&z.apply(this,arguments)||this;return u.fields=new A,u}return U(u,z),J([L("number",cz)],u.prototype,"id",void 0),J([L([Wz],cz)],u.prototype,"fields",void 0),u}(Nz),Iz=function(z){function u(){var u=null!==z&&z.apply(this,arguments)||this;return u.types=new A,u}return U(u,z),u.encode=function(z){var U=z.constructor,J=new u;J.rootType=U._typeid;var v=function(z,u){for(var U in u){var v=new Wz;v.name=U;var f=void 0;if("string"===typeof u[U])f=u[U];else{var g=u[U],w=void 0;Nz.is(g)?(f="ref",w=u[U]):"string"===typeof g[f=Object.keys(g)[0]]?f+=":"+g[f]:w=g[f],v.referencedType=w?w._typeid:-1}v.type=f,z.fields.push(v)}J.types.push(z)},f=U._context.types;for(var g in f){var w=new jz;w.id=Number(g),v(w,f[g]._definition.schema)}return J.encodeAll()},u.decode=function(z,J){var v=new t,f=new u;f.decode(z,J);var g=f.types.reduce((function(z,u){var J=function(z){function u(){return null!==z&&z.apply(this,arguments)||this}return U(u,z),u}(Nz),f=u.id;return z[f]=J,v.add(J,f),z}),{});f.types.forEach((function(z){var u=g[z.id];z.fields.forEach((function(z){var U;if(void 0!==z.referencedType){var J=z.type,f=g[z.referencedType];if(!f){var w=z.type.split(":");J=w[0],f=w[1]}"ref"===J?L(f,{context:v})(u.prototype,z.name):L(((U={})[J]=f,U),{context:v})(u.prototype,z.name)}else L(z.type,{context:v})(u.prototype,z.name)}))}));var w=g[f.rootType],P=new w;for(var R in w._definition.schema){var S=w._definition.schema[R];"string"!==typeof S&&(P[R]="function"===typeof S?new S:new(T(Object.keys(S)[0]).constructor))}return P},J([L([jz],cz)],u.prototype,"types",void 0),J([L("number",cz)],u.prototype,"rootType",void 0),u}(Nz);M("map",{constructor:C}),M("array",{constructor:A}),M("set",{constructor:Vz}),M("collection",{constructor:tz}),z.ArraySchema=A,z.CollectionSchema=tz,z.Context=t,z.MapSchema=C,z.Reflection=Iz,z.ReflectionField=Wz,z.ReflectionType=jz,z.Schema=Nz,z.SchemaDefinition=X,z.SetSchema=Vz,z.decode=hz,z.defineTypes=K,z.deprecated=Q,z.dumpChanges=Dz,z.encode=s,z.filter=O,z.filterChildren=x,z.hasFilter=h,z.registerType=M,z.type=L,Object.defineProperty(z,"__esModule",{value:!0})}(u)},14438:z=>{z.exports=function(z){return null!=z&&null!=z.constructor&&"function"===typeof z.constructor.isBuffer&&z.constructor.isBuffer(z)}},14427:(z,u,U)=>{"use strict";var J=U(14429),v=U(14431),f=U(14438);U.g.__TYPEDARRAY_POOL||(U.g.__TYPEDARRAY_POOL={UINT8:v([32,0]),UINT16:v([32,0]),UINT32:v([32,0]),INT8:v([32,0]),INT16:v([32,0]),INT32:v([32,0]),FLOAT:v([32,0]),DOUBLE:v([32,0]),DATA:v([32,0]),UINT8C:v([32,0]),BUFFER:v([32,0])});var g="undefined"!==typeof Uint8ClampedArray,w=U.g.__TYPEDARRAY_POOL;w.UINT8C||(w.UINT8C=v([32,0])),w.BUFFER||(w.BUFFER=v([32,0]));var P=w.DATA,R=w.BUFFER;function S(z){if(z){var u=z.length||z.byteLength,U=J.log2(u);P[U].push(z)}}function d(z){z=J.nextPow2(z);var u=J.log2(z),U=P[u];return U.length>0?U.pop():new ArrayBuffer(z)}function mz(z){return new Uint8Array(d(z),0,z)}function Z(z){return new Uint16Array(d(2*z),0,z)}function A(z){return new Uint32Array(d(4*z),0,z)}function E(z){return new Int8Array(d(z),0,z)}function C(z){return new Int16Array(d(2*z),0,z)}function r(z){return new Int32Array(d(4*z),0,z)}function M(z){return new Float32Array(d(4*z),0,z)}function T(z){return new Float64Array(d(8*z),0,z)}function X(z){return g?new Uint8ClampedArray(d(z),0,z):mz(z)}function h(z){return new DataView(d(z),0,z)}u.free=function(z){if(f(z))R[J.log2(z.length)].push(z);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(z)&&(z=z.buffer),!z)return;var u=z.length||z.byteLength,U=0|J.log2(u);P[U].push(z)}},u.freeUint8=u.freeUint16=u.freeUint32=u.freeInt8=u.freeInt16=u.freeInt32=u.freeFloat32=u.freeFloat=u.freeFloat64=u.freeDouble=u.freeUint8Clamped=u.freeDataView=function(z){S(z.buffer)},u.freeArrayBuffer=S,u.freeBuffer=function(z){R[J.log2(z.length)].push(z)},u.malloc=function(z,u){if(void 0===u||"arraybuffer"===u)return d(z);switch(u){case"uint8":return mz(z);case"uint16":return Z(z);case"uint32":return A(z);case"int8":return E(z);case"int16":return C(z);case"int32":return r(z);case"float":case"float32":return M(z);case"double":case"float64":return T(z);case"uint8_clamped":return X(z);case"buffer":throw"Buffer not supported";case"data":case"dataview":return h(z);default:return null}return null},u.mallocArrayBuffer=d,u.mallocUint8=mz,u.mallocUint16=Z,u.mallocUint32=A,u.mallocInt8=E,u.mallocInt16=C,u.mallocInt32=r,u.mallocFloat32=u.mallocFloat=M,u.mallocFloat64=u.mallocDouble=T,u.mallocUint8Clamped=X,u.mallocDataView=h,u.clearCache=function(){for(var z=0;z<32;++z)w.UINT8[z].length=0,w.UINT16[z].length=0,w.UINT32[z].length=0,w.INT8[z].length=0,w.INT16[z].length=0,w.INT32[z].length=0,w.FLOAT[z].length=0,w.DOUBLE[z].length=0,w.UINT8C[z].length=0,P[z].length=0,R[z].length=0}},14503:(z,u,U)=>{z.exports=v;var J=U(152);function v(z,u){if(!(this instanceof v))return new v(z,u);var U=J.create();J.add(U,z,u),this.base=J.min(J.create(),z,U),this.DS=J.clone(u),this.max=J.max(J.create(),z,U),this.mag=J.length(this.DS)}var f=v.prototype;f.width=function(){return this.DS[0]},f.height=function(){return this.DS[1]},f.depth=function(){return this.DS[2]},f.x0=function(){return this.base[0]},f.y0=function(){return this.base[1]},f.z0=function(){return this.base[2]},f.x1=function(){return this.max[0]},f.y1=function(){return this.max[1]},f.z1=function(){return this.max[2]},f.translate=function(z){return J.add(this.max,this.max,z),J.add(this.base,this.base,z),this},f.setPosition=function(z){return J.add(this.max,z,this.DS),J.i(this.base,z),this},f.expand=function(z){var u=J.create(),U=J.create();return J.max(u,z.max,this.max),J.min(U,z.base,this.base),J.Cu(u,u,U),new v(U,u)},f.intersects=function(z){return!(z.base[0]>this.max[0])&&(!(z.base[1]>this.max[1])&&(!(z.base[2]>this.max[2])&&(!(z.max[0]<this.base[0])&&(!(z.max[1]<this.base[1])&&!(z.max[2]<this.base[2])))))},f.touches=function(z){var u=this.union(z);return null!==u&&(0==u.width()||0==u.height()||0==u.depth())},f.union=function(z){if(!this.intersects(z))return null;var u=Math.max(z.base[0],this.base[0]),U=Math.max(z.base[1],this.base[1]),J=Math.max(z.base[2],this.base[2]);return new v([u,U,J],[Math.min(z.max[0],this.max[0])-u,Math.min(z.max[1],this.max[1])-U,Math.min(z.max[2],this.max[2])-J])}},14429:(z,u)=>{"use strict";function U(z){var u=32;return(z&=-z)&&u--,65535&z&&(u-=16),16711935&z&&(u-=8),252645135&z&&(u-=4),858993459&z&&(u-=2),1431655765&z&&(u-=1),u}u.INT_BITS=32,u.INT_MAX=2147483647,u.INT_MIN=-1<<31,u.sign=function(z){return(z>0)-(z<0)},u.abs=function(z){var u=z>>31;return(z^u)-u},u.min=function(z,u){return u^(z^u)&-(z<u)},u.max=function(z,u){return z^(z^u)&-(z<u)},u.isPow2=function(z){return!(z&z-1)&&!!z},u.log2=function(z){var u,U;return u=(z>65535)<<4,u|=U=((z>>>=u)>255)<<3,u|=U=((z>>>=U)>15)<<2,(u|=U=((z>>>=U)>3)<<1)|(z>>>=U)>>1},u.log10=function(z){return z>=1e9?9:z>=1e8?8:z>=1e7?7:z>=1e6?6:z>=1e5?5:z>=1e4?4:z>=1e3?3:z>=100?2:z>=10?1:0},u.popCount=function(z){return 16843009*((z=(858993459&(z-=z>>>1&1431655765))+(z>>>2&858993459))+(z>>>4)&252645135)>>>24},u.countTrailingZeros=U,u.nextPow2=function(z){return z+=0===z,--z,z|=z>>>1,z|=z>>>2,z|=z>>>4,z|=z>>>8,(z|=z>>>16)+1},u.prevPow2=function(z){return z|=z>>>1,z|=z>>>2,z|=z>>>4,z|=z>>>8,(z|=z>>>16)-(z>>>1)},u.parity=function(z){return z^=z>>>16,z^=z>>>8,z^=z>>>4,27030>>>(z&=15)&1};var J=new Array(256);!function(z){for(var u=0;u<256;++u){var U=u,J=u,v=7;for(U>>>=1;U;U>>>=1)J<<=1,J|=1&U,--v;z[u]=J<<v&255}}(J),u.reverse=function(z){return J[255&z]<<24|J[z>>>8&255]<<16|J[z>>>16&255]<<8|J[z>>>24&255]},u.interleave2=function(z,u){return(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z&=65535)|z<<8))|z<<4))|z<<2))|z<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u&=65535)|u<<8))|u<<4))|u<<2))|u<<1))<<1},u.deinterleave2=function(z,u){return(z=65535&((z=16711935&((z=252645135&((z=858993459&((z=z>>>u&1431655765)|z>>>1))|z>>>2))|z>>>4))|z>>>16))<<16>>16},u.interleave3=function(z,u,U){return z=1227133513&((z=3272356035&((z=251719695&((z=4278190335&((z&=1023)|z<<16))|z<<8))|z<<4))|z<<2),(z|=(u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2))<<1)|(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<2},u.deinterleave3=function(z,u){return(z=1023&((z=4278190335&((z=251719695&((z=3272356035&((z=z>>>u&1227133513)|z>>>2))|z>>>4))|z>>>8))|z>>>16))<<22>>22},u.nextCombination=function(z){var u=z|z-1;return u+1|(~u&-~u)-1>>>U(z)+1}},14418:(z,u,U)=>{"use strict";z.exports=function(z,u,U){switch(arguments.length){case 1:return J=[],R(v=z,v,S,!0),J;case 2:return"function"===typeof u?R(z,z,u,!0):function(z,u){return J=[],R(z,u,S,!1),J}(z,u);case 3:return R(z,u,U,!1);default:throw new Error("box-intersect: Invalid arguments")}var v};var J,v=U(14427),f=U(14440),g=U(14451);function w(z,u){for(var U=0;U<z;++U)if(!(u[U]<=u[U+z]))return!0;return!1}function P(z,u,U,J){for(var v=0,f=0,g=0,P=z.length;g<P;++g){var R=z[g];if(!w(u,R)){for(var S=0;S<2*u;++S)U[v++]=R[S];J[f++]=g}}return f}function R(z,u,U,J){var w=z.length,R=u.length;if(!(w<=0||R<=0)){var S=z[0].length>>>1;if(!(S<=0)){var d,mz=v.mallocDouble(2*S*w),Z=v.mallocInt32(w);if((w=P(z,S,mz,Z))>0){if(1===S&&J)f.init(w),d=f.sweepComplete(S,U,0,w,mz,Z,0,w,mz,Z);else{var A=v.mallocDouble(2*S*R),E=v.mallocInt32(R);(R=P(u,S,A,E))>0&&(f.init(w+R),d=1===S?f.sweepBipartite(S,U,0,w,mz,Z,0,R,A,E):g(S,U,J,w,mz,Z,R,A,E),v.free(A),v.free(E))}v.free(mz),v.free(Z)}return d}}}function S(z,u){J.push([z,u])}},14459:(z,u)=>{"use strict";var U="d",J="ax",v="fp",f="es",g="rs",w="re",P="rb",R="bs",S="be",d="bb",mz=[U,J,"vv",g,w,P,"ri",R,S,d,"bi"];function Z(z){var u="bruteForce"+(z?"Full":"Partial"),J=[],g=mz.slice();z||g.splice(3,0,v);var w=["function "+u+"("+g.join()+"){"];function P(u,v){var g=function(z,u,J){var v="bruteForce"+(z?"Red":"Blue")+(u?"Flip":"")+(J?"Full":""),g=["function ",v,"(",mz.join(),"){","var ",f,"=2*",U,";"],w="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",P="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(J?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return z?g.push(w,"Q",":",P):g.push(P,"Q",":",w),J?g.push("if(y1<x0||x1<y0)continue;"):u?g.push("if(y0<=x0||x1<y0)continue;"):g.push("if(y0<x0||x1<y0)continue;"),g.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),u?g.push("yi,xi"):g.push("xi,yi"),g.push(");if(rv!==void 0)return rv;}}}"),{name:v,code:g.join("")}}(u,v,z);J.push(g.code),w.push("return "+g.name+"("+mz.join()+");")}w.push("if(re-rs>be-bs){"),z?(P(!0,!1),w.push("}else{"),P(!1,!1)):(w.push("if(fp){"),P(!0,!0),w.push("}else{"),P(!0,!1),w.push("}}else{if(fp){"),P(!1,!0),w.push("}else{"),P(!1,!1),w.push("}")),w.push("}}return "+u);var R=J.join("")+w.join("");return new Function(R)()}u.partial=Z(!1),u.full=Z(!0)},14451:(z,u,U)=>{"use strict";z.exports=function(z,u,U,f,S,Q,K,Y,p){!function(z,u){var U=8*v.log2(u+1)*(z+1)|0,f=v.nextPow2(X*U);t.length<f&&(J.free(t),t=J.mallocInt32(f));var g=v.nextPow2(h*U);V.length<g&&(J.free(V),V=J.mallocDouble(g))}(z,f+K);var N,D=0,c=2*z;L(D++,0,0,f,0,K,U?16:0,-1/0,1/0),U||L(D++,0,0,K,0,f,1,-1/0,1/0);for(;D>0;){var W=(D-=1)*X,j=t[W],I=t[W+1],F=t[W+2],b=t[W+3],k=t[W+4],B=t[W+5],y=D*h,H=V[y],G=V[y+1],a=1&B,i=!!(16&B),n=S,q=Q,o=Y,s=p;if(a&&(n=Y,q=p,o=S,s=Q),!(2&B&&I>=(F=C(z,j,I,F,n,q,G)))&&!(4&B&&(I=r(z,j,I,F,n,q,H))>=F)){var l=F-I,e=k-b;if(i){if(z*l*(l+e)<Z){if(void 0!==(N=P.scanComplete(z,j,u,I,F,n,q,b,k,o,s)))return N;continue}}else{if(z*Math.min(l,e)<d){if(void 0!==(N=g(z,j,u,a,I,F,n,q,b,k,o,s)))return N;continue}if(z*l*e<mz){if(void 0!==(N=P.scanBipartite(z,j,u,a,I,F,n,q,b,k,o,s)))return N;continue}}var zz=A(z,j,I,F,n,q,H,G);if(I<zz)if(z*(zz-I)<d){if(void 0!==(N=w(z,j+1,u,I,zz,n,q,b,k,o,s)))return N}else if(j===z-2){if(void 0!==(N=a?P.sweepBipartite(z,u,b,k,o,s,I,zz,n,q):P.sweepBipartite(z,u,I,zz,n,q,b,k,o,s)))return N}else L(D++,j+1,I,zz,b,k,a,-1/0,1/0),L(D++,j+1,b,k,I,zz,1^a,-1/0,1/0);if(zz<F){var uz=R(z,j,b,k,o,s),Uz=o[c*uz+j],Jz=E(z,j,uz,k,o,s,Uz);if(Jz<k&&L(D++,j,zz,F,Jz,k,(4|a)+(i?16:0),Uz,G),b<uz&&L(D++,j,zz,F,b,uz,(2|a)+(i?16:0),H,Uz),uz+1===Jz){if(void 0!==(N=i?x(z,j,u,zz,F,n,q,uz,o,s[uz]):O(z,j,u,a,zz,F,n,q,uz,o,s[uz])))return N}else if(uz<Jz){var vz;if(i){if(zz<(vz=M(z,j,zz,F,n,q,Uz))){var fz=E(z,j,zz,vz,n,q,Uz);if(j===z-2){if(zz<fz&&void 0!==(N=P.sweepComplete(z,u,zz,fz,n,q,uz,Jz,o,s)))return N;if(fz<vz&&void 0!==(N=P.sweepBipartite(z,u,fz,vz,n,q,uz,Jz,o,s)))return N}else zz<fz&&L(D++,j+1,zz,fz,uz,Jz,16,-1/0,1/0),fz<vz&&(L(D++,j+1,fz,vz,uz,Jz,0,-1/0,1/0),L(D++,j+1,uz,Jz,fz,vz,1,-1/0,1/0))}}else zz<(vz=a?T(z,j,zz,F,n,q,Uz):M(z,j,zz,F,n,q,Uz))&&(j===z-2?N=a?P.sweepBipartite(z,u,uz,Jz,o,s,zz,vz,n,q):P.sweepBipartite(z,u,zz,vz,n,q,uz,Jz,o,s):(L(D++,j+1,zz,vz,uz,Jz,a,-1/0,1/0),L(D++,j+1,uz,Jz,zz,vz,1^a,-1/0,1/0)))}}}}};var J=U(14427),v=U(14429),f=U(14459),g=f.partial,w=f.full,P=U(14440),R=U(14465),S=U(14474),d=128,mz=1<<22,Z=1<<22,A=S("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),E=S("lo===p0",["p0"]),C=S("lo<p0",["p0"]),r=S("hi<=p0",["p0"]),M=S("lo<=p0&&p0<=hi",["p0"]),T=S("lo<p0&&p0<=hi",["p0"]),X=6,h=2,t=J.mallocInt32(1024),V=J.mallocDouble(1024);function L(z,u,U,J,v,f,g,w,P){var R=X*z;t[R]=u,t[R+1]=U,t[R+2]=J,t[R+3]=v,t[R+4]=f,t[R+5]=g;var S=h*z;V[S]=w,V[S+1]=P}function O(z,u,U,J,v,f,g,w,P,R,S){var d=2*z,mz=P*d,Z=R[mz+u];z:for(var A=v,E=v*d;A<f;++A,E+=d){var C=g[E+u],r=g[E+u+z];if(!(Z<C||r<Z)&&(!J||Z!==C)){for(var M,T=w[A],X=u+1;X<z;++X){C=g[E+X],r=g[E+X+z];var h=R[mz+X],t=R[mz+X+z];if(r<h||t<C)continue z}if(void 0!==(M=J?U(S,T):U(T,S)))return M}}}function x(z,u,U,J,v,f,g,w,P,R){var S=2*z,d=w*S,mz=P[d+u];z:for(var Z=J,A=J*S;Z<v;++Z,A+=S){var E=g[Z];if(E!==R){var C=f[A+u],r=f[A+u+z];if(!(mz<C||r<mz)){for(var M=u+1;M<z;++M){C=f[A+M],r=f[A+M+z];var T=P[d+M],X=P[d+M+z];if(r<T||X<C)continue z}var h=U(E,R);if(void 0!==h)return h}}}}},14465:(z,u,U)=>{"use strict";z.exports=function(z,u,U,g,w,P){if(g<=U+1)return U;var R=U,S=g,d=g+U>>>1,mz=2*z,Z=d,A=w[mz*d+u];for(;R<S;){if(S-R<v){f(z,u,R,S,w,P),A=w[mz*d+u];break}var E=S-R,C=Math.random()*E+R|0,r=w[mz*C+u],M=Math.random()*E+R|0,T=w[mz*M+u],X=Math.random()*E+R|0,h=w[mz*X+u];r<=T?h>=T?(Z=M,A=T):r>=h?(Z=C,A=r):(Z=X,A=h):T>=h?(Z=M,A=T):h>=r?(Z=C,A=r):(Z=X,A=h);for(var t=mz*(S-1),V=mz*Z,L=0;L<mz;++L,++t,++V){var O=w[t];w[t]=w[V],w[V]=O}var x=P[S-1];P[S-1]=P[Z],P[Z]=x;for(t=mz*(S-1),V=mz*(Z=J(z,u,R,S-1,w,P,A)),L=0;L<mz;++L,++t,++V){O=w[t];w[t]=w[V],w[V]=O}x=P[S-1];if(P[S-1]=P[Z],P[Z]=x,d<Z){for(S=Z-1;R<S&&w[mz*(S-1)+u]===A;)S-=1;S+=1}else{if(!(Z<d))break;for(R=Z+1;R<S&&w[mz*R+u]===A;)R+=1}}return J(z,u,U,d,w,P,w[mz*d+u])};var J=U(14474)("lo<p0",["p0"]),v=8;function f(z,u,U,J,v,f){for(var g=2*z,w=g*(U+1)+u,P=U+1;P<J;++P,w+=g)for(var R=v[w],S=P,d=g*(P-1);S>U&&v[d+u]>R;--S,d-=g){for(var mz=d,Z=d+g,A=0;A<g;++A,++mz,++Z){var E=v[mz];v[mz]=v[Z],v[Z]=E}var C=f[S];f[S]=f[S-1],f[S-1]=C}}},14474:z=>{"use strict";z.exports=function(z,U){var J="abcdef".split("").concat(U),v=[];z.indexOf("lo")>=0&&v.push("lo=e[k+n]");z.indexOf("hi")>=0&&v.push("hi=e[k+o]");return J.push(u.replace("_",v.join()).replace("$",z)),Function.apply(void 0,J)};var u="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14449:z=>{"use strict";z.exports=function(z,J){J<=4*u?U(0,J-1,z):R(0,J-1,z)};var u=32;function U(z,u,U){for(var J=2*(z+1),v=z+1;v<=u;++v){for(var f=U[J++],g=U[J++],w=v,P=J-2;w-- >z;){var R=U[P-2],S=U[P-1];if(R<f)break;if(R===f&&S<g)break;U[P]=R,U[P+1]=S,P-=2}U[P]=f,U[P+1]=g}}function J(z,u,U){u*=2;var J=U[z*=2],v=U[z+1];U[z]=U[u],U[z+1]=U[u+1],U[u]=J,U[u+1]=v}function v(z,u,U){u*=2,U[z*=2]=U[u],U[z+1]=U[u+1]}function f(z,u,U,J){u*=2,U*=2;var v=J[z*=2],f=J[z+1];J[z]=J[u],J[z+1]=J[u+1],J[u]=J[U],J[u+1]=J[U+1],J[U]=v,J[U+1]=f}function g(z,u,U,J,v){u*=2,v[z*=2]=v[u],v[u]=U,v[z+1]=v[u+1],v[u+1]=J}function w(z,u,U){u*=2;var J=U[z*=2],v=U[u];return!(J<v)&&(J!==v||U[z+1]>U[u+1])}function P(z,u,U,J){var v=J[z*=2];return v<u||v===u&&J[z+1]<U}function R(z,S,d){var mz=(S-z+1)/6|0,Z=z+mz,A=S-mz,E=z+S>>1,C=E-mz,r=E+mz,M=Z,T=C,X=E,h=r,t=A,V=z+1,L=S-1,O=0;w(M,T,d)&&(O=M,M=T,T=O),w(h,t,d)&&(O=h,h=t,t=O),w(M,X,d)&&(O=M,M=X,X=O),w(T,X,d)&&(O=T,T=X,X=O),w(M,h,d)&&(O=M,M=h,h=O),w(X,h,d)&&(O=X,X=h,h=O),w(T,t,d)&&(O=T,T=t,t=O),w(T,X,d)&&(O=T,T=X,X=O),w(h,t,d)&&(O=h,h=t,t=O);for(var x=d[2*T],Q=d[2*T+1],K=d[2*h],Y=d[2*h+1],p=2*M,N=2*X,D=2*t,c=2*Z,W=2*E,j=2*A,I=0;I<2;++I){var F=d[p+I],b=d[N+I],k=d[D+I];d[c+I]=F,d[W+I]=b,d[j+I]=k}v(C,z,d),v(r,S,d);for(var B=V;B<=L;++B)if(P(B,x,Q,d))B!==V&&J(B,V,d),++V;else if(!P(B,K,Y,d))for(;;){if(P(L,K,Y,d)){P(L,x,Q,d)?(f(B,V,L,d),++V,--L):(J(B,L,d),--L);break}if(--L<B)break}g(z,V-1,x,Q,d),g(S,L+1,K,Y,d),V-2-z<=u?U(z,V-2,d):R(z,V-2,d),S-(L+2)<=u?U(L+2,S,d):R(L+2,S,d),L-V<=u?U(V,L,d):R(V,L,d)}},14440:(z,u,U)=>{"use strict";z.exports={init:function(z){var u=v.nextPow2(z);P.length<u&&(J.free(P),P=J.mallocInt32(u));R.length<u&&(J.free(R),R=J.mallocInt32(u));S.length<u&&(J.free(S),S=J.mallocInt32(u));d.length<u&&(J.free(d),d=J.mallocInt32(u));mz.length<u&&(J.free(mz),mz=J.mallocInt32(u));Z.length<u&&(J.free(Z),Z=J.mallocInt32(u));var U=8*u;A.length<U&&(J.free(A),A=J.mallocDouble(U))},sweepBipartite:function(z,u,U,J,v,w,mz,Z,r,M){for(var T=0,X=2*z,h=z-1,t=X-1,V=U;V<J;++V){var L=w[V],O=X*V;A[T++]=v[O+h],A[T++]=-(L+1),A[T++]=v[O+t],A[T++]=L}for(V=mz;V<Z;++V){L=M[V]+g;var x=X*V;A[T++]=r[x+h],A[T++]=-L,A[T++]=r[x+t],A[T++]=L}var Q=T>>>1;f(A,Q);var K=0,Y=0;for(V=0;V<Q;++V){var p=0|A[2*V+1];if(p>=g)E(S,d,Y--,p=p-g|0);else if(p>=0)E(P,R,K--,p);else if(p<=-g){p=-p-g|0;for(var N=0;N<K;++N){if(void 0!==(D=u(P[N],p)))return D}C(S,d,Y++,p)}else{p=-p-1|0;for(N=0;N<Y;++N){var D;if(void 0!==(D=u(p,S[N])))return D}C(P,R,K++,p)}}},sweepComplete:function(z,u,U,J,v,g,w,r,M,T){for(var X=0,h=2*z,t=z-1,V=h-1,L=U;L<J;++L){var O=g[L]+1<<1,x=h*L;A[X++]=v[x+t],A[X++]=-O,A[X++]=v[x+V],A[X++]=O}for(L=w;L<r;++L){O=T[L]+1<<1;var Q=h*L;A[X++]=M[Q+t],A[X++]=1|-O,A[X++]=M[Q+V],A[X++]=1|O}var K=X>>>1;f(A,K);var Y=0,p=0,N=0;for(L=0;L<K;++L){var D=0|A[2*L+1],c=1&D;if(L<K-1&&D>>1===A[2*L+3]>>1&&(c=2,L+=1),D<0){for(var W=-(D>>1)-1,j=0;j<N;++j){if(void 0!==(I=u(mz[j],W)))return I}if(0!==c)for(j=0;j<Y;++j){if(void 0!==(I=u(P[j],W)))return I}if(1!==c)for(j=0;j<p;++j){var I;if(void 0!==(I=u(S[j],W)))return I}0===c?C(P,R,Y++,W):1===c?C(S,d,p++,W):2===c&&C(mz,Z,N++,W)}else{W=(D>>1)-1;0===c?E(P,R,Y--,W):1===c?E(S,d,p--,W):2===c&&E(mz,Z,N--,W)}}},scanBipartite:function(z,u,U,J,v,w,S,d,mz,Z,r,M){var T=0,X=2*z,h=u,t=u+z,V=1,L=1;J?L=g:V=g;for(var O=v;O<w;++O){var x=O+V,Q=X*O;A[T++]=S[Q+h],A[T++]=-x,A[T++]=S[Q+t],A[T++]=x}for(O=mz;O<Z;++O){x=O+L;var K=X*O;A[T++]=r[K+h],A[T++]=-x}var Y=T>>>1;f(A,Y);var p=0;for(O=0;O<Y;++O){var N=0|A[2*O+1];if(N<0){var D=!1;if((x=-N)>=g?(D=!J,x-=g):(D=!!J,x-=1),D)C(P,R,p++,x);else{var c=M[x],W=X*x,j=r[W+u+1],I=r[W+u+1+z];z:for(var F=0;F<p;++F){var b=P[F],k=X*b;if(!(I<S[k+u+1]||S[k+u+1+z]<j)){for(var B=u+2;B<z;++B)if(r[W+B+z]<S[k+B]||S[k+B+z]<r[W+B])continue z;var y,H=d[b];if(void 0!==(y=J?U(c,H):U(H,c)))return y}}}}else E(P,R,p--,N-V)}},scanComplete:function(z,u,U,J,v,w,R,S,d,mz,Z){for(var E=0,C=2*z,r=u,M=u+z,T=J;T<v;++T){var X=T+g,h=C*T;A[E++]=w[h+r],A[E++]=-X,A[E++]=w[h+M],A[E++]=X}for(T=S;T<d;++T){X=T+1;var t=C*T;A[E++]=mz[t+r],A[E++]=-X}var V=E>>>1;f(A,V);var L=0;for(T=0;T<V;++T){var O=0|A[2*T+1];if(O<0){if((X=-O)>=g)P[L++]=X-g;else{var x=Z[X-=1],Q=C*X,K=mz[Q+u+1],Y=mz[Q+u+1+z];z:for(var p=0;p<L;++p){var N=P[p],D=R[N];if(D===x)break;var c=C*N;if(!(Y<w[c+u+1]||w[c+u+1+z]<K)){for(var W=u+2;W<z;++W)if(mz[Q+W+z]<w[c+W]||w[c+W+z]<mz[Q+W])continue z;var j=U(D,x);if(void 0!==j)return j}}}}else{for(X=O-g,p=L-1;p>=0;--p)if(P[p]===X){for(W=p+1;W<L;++W)P[W-1]=P[W];break}--L}}}};var J=U(14427),v=U(14429),f=U(14449),g=1<<28,w=1024,P=J.mallocInt32(w),R=J.mallocInt32(w),S=J.mallocInt32(w),d=J.mallocInt32(w),mz=J.mallocInt32(w),Z=J.mallocInt32(w),A=J.mallocDouble(8192);function E(z,u,U,J){var v=u[J],f=z[U-1];z[v]=f,u[f]=v}function C(z,u,U,J){z[U]=J,u[J]=U}},14683:z=>{"use strict";z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14680:(z,u,U)=>{var J=U(14683),v=U(14690),f=Object.hasOwnProperty,g=Object.create(null);for(var w in J)f.call(J,w)&&(g[J[w]]=w);var P=z.exports={to:{},get:{}};function R(z,u,U){return Math.min(Math.max(u,z),U)}function S(z){var u=Math.round(z).toString(16).toUpperCase();return u.length<2?"0"+u:u}P.get=function(z){var u,U;switch(z.substring(0,3).toLowerCase()){case"hsl":u=P.get.hsl(z),U="hsl";break;case"hwb":u=P.get.hwb(z),U="hwb";break;default:u=P.get.rgb(z),U="rgb"}return u?{model:U,value:u}:null},P.get.rgb=function(z){if(!z)return null;var u,U,v,g=[0,0,0,1];if(u=z.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(v=u[2],u=u[1],U=0;U<3;U++){var w=2*U;g[U]=parseInt(u.slice(w,w+2),16)}v&&(g[3]=parseInt(v,16)/255)}else if(u=z.match(/^#([a-f0-9]{3,4})$/i)){for(v=(u=u[1])[3],U=0;U<3;U++)g[U]=parseInt(u[U]+u[U],16);v&&(g[3]=parseInt(v+v,16)/255)}else if(u=z.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(U=0;U<3;U++)g[U]=parseInt(u[U+1],0);u[4]&&(u[5]?g[3]=.01*parseFloat(u[4]):g[3]=parseFloat(u[4]))}else{if(!(u=z.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(u=z.match(/^(\w+)$/))?"transparent"===u[1]?[0,0,0,0]:f.call(J,u[1])?((g=J[u[1]])[3]=1,g):null:null;for(U=0;U<3;U++)g[U]=Math.round(2.55*parseFloat(u[U+1]));u[4]&&(u[5]?g[3]=.01*parseFloat(u[4]):g[3]=parseFloat(u[4]))}for(U=0;U<3;U++)g[U]=R(g[U],0,255);return g[3]=R(g[3],0,1),g},P.get.hsl=function(z){if(!z)return null;var u=z.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(u){var U=parseFloat(u[4]);return[(parseFloat(u[1])%360+360)%360,R(parseFloat(u[2]),0,100),R(parseFloat(u[3]),0,100),R(isNaN(U)?1:U,0,1)]}return null},P.get.hwb=function(z){if(!z)return null;var u=z.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(u){var U=parseFloat(u[4]);return[(parseFloat(u[1])%360+360)%360,R(parseFloat(u[2]),0,100),R(parseFloat(u[3]),0,100),R(isNaN(U)?1:U,0,1)]}return null},P.to.hex=function(){var z=v(arguments);return"#"+S(z[0])+S(z[1])+S(z[2])+(z[3]<1?S(Math.round(255*z[3])):"")},P.to.rgb=function(){var z=v(arguments);return z.length<4||1===z[3]?"rgb("+Math.round(z[0])+", "+Math.round(z[1])+", "+Math.round(z[2])+")":"rgba("+Math.round(z[0])+", "+Math.round(z[1])+", "+Math.round(z[2])+", "+z[3]+")"},P.to.rgb.percent=function(){var z=v(arguments),u=Math.round(z[0]/255*100),U=Math.round(z[1]/255*100),J=Math.round(z[2]/255*100);return z.length<4||1===z[3]?"rgb("+u+"%, "+U+"%, "+J+"%)":"rgba("+u+"%, "+U+"%, "+J+"%, "+z[3]+")"},P.to.hsl=function(){var z=v(arguments);return z.length<4||1===z[3]?"hsl("+z[0]+", "+z[1]+"%, "+z[2]+"%)":"hsla("+z[0]+", "+z[1]+"%, "+z[2]+"%, "+z[3]+")"},P.to.hwb=function(){var z=v(arguments),u="";return z.length>=4&&1!==z[3]&&(u=", "+z[3]),"hwb("+z[0]+", "+z[1]+"%, "+z[2]+"%"+u+")"},P.to.keyword=function(z){return g[z.slice(0,3)]}},14671:(z,u,U)=>{const J=U(14680),v=U(14704),f=["keyword","gray","hex"],g={};for(const Z of Object.keys(v))g[[...v[Z].labels].sort().join("")]=Z;const w={};function P(z,u){if(!(this instanceof P))return new P(z,u);if(u&&u in f&&(u=null),u&&!(u in v))throw new Error("Unknown model: "+u);let U,R;if(null==z)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(z instanceof P)this.model=z.model,this.color=[...z.color],this.valpha=z.valpha;else if("string"===typeof z){const u=J.get(z);if(null===u)throw new Error("Unable to parse color from string: "+z);this.model=u.model,R=v[this.model].channels,this.color=u.value.slice(0,R),this.valpha="number"===typeof u.value[R]?u.value[R]:1}else if(z.length>0){this.model=u||"rgb",R=v[this.model].channels;const U=Array.prototype.slice.call(z,0,R);this.color=mz(U,R),this.valpha="number"===typeof z[R]?z[R]:1}else if("number"===typeof z)this.model="rgb",this.color=[z>>16&255,z>>8&255,255&z],this.valpha=1;else{this.valpha=1;const u=Object.keys(z);"alpha"in z&&(u.splice(u.indexOf("alpha"),1),this.valpha="number"===typeof z.alpha?z.alpha:0);const J=u.sort().join("");if(!(J in g))throw new Error("Unable to parse color from object: "+JSON.stringify(z));this.model=g[J];const{labels:f}=v[this.model],w=[];for(U=0;U<f.length;U++)w.push(z[f[U]]);this.color=mz(w)}if(w[this.model])for(R=v[this.model].channels,U=0;U<R;U++){const z=w[this.model][U];z&&(this.color[U]=z(this.color[U]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}P.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(z){let u=this.model in J.to?this:this.rgb();u=u.round("number"===typeof z?z:1);const U=1===u.valpha?u.color:[...u.color,this.valpha];return J.to[u.model](U)},percentString(z){const u=this.rgb().round("number"===typeof z?z:1),U=1===u.valpha?u.color:[...u.color,this.valpha];return J.to.rgb.percent(U)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const z={},{channels:u}=v[this.model],{labels:U}=v[this.model];for(let J=0;J<u;J++)z[U[J]]=this.color[J];return 1!==this.valpha&&(z.alpha=this.valpha),z},unitArray(){const z=this.rgb().color;return z[0]/=255,z[1]/=255,z[2]/=255,1!==this.valpha&&z.push(this.valpha),z},unitObject(){const z=this.rgb().object();return z.r/=255,z.g/=255,z.b/=255,1!==this.valpha&&(z.alpha=this.valpha),z},round(z){return z=Math.max(z||0,0),new P([...this.color.map(R(z)),this.valpha],this.model)},alpha(z){return void 0!==z?new P([...this.color,Math.max(0,Math.min(1,z))],this.model):this.valpha},red:S("rgb",0,d(255)),green:S("rgb",1,d(255)),blue:S("rgb",2,d(255)),hue:S(["hsl","hsv","hsl","hwb","hcg"],0,(z=>(z%360+360)%360)),saturationl:S("hsl",1,d(100)),lightness:S("hsl",2,d(100)),saturationv:S("hsv",1,d(100)),value:S("hsv",2,d(100)),chroma:S("hcg",1,d(100)),gray:S("hcg",2,d(100)),white:S("hwb",1,d(100)),wblack:S("hwb",2,d(100)),cyan:S("cmyk",0,d(100)),magenta:S("cmyk",1,d(100)),yellow:S("cmyk",2,d(100)),black:S("cmyk",3,d(100)),x:S("xyz",0,d(95.047)),y:S("xyz",1,d(100)),z:S("xyz",2,d(108.833)),l:S("lab",0,d(100)),a:S("lab",1),b:S("lab",2),keyword(z){return void 0!==z?new P(z):v[this.model].keyword(this.color)},hex(z){return void 0!==z?new P(z):J.to.hex(this.rgb().round().color)},hexa(z){if(void 0!==z)return new P(z);const u=this.rgb().round().color;let U=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===U.length&&(U="0"+U),J.to.hex(u)+U},rgbNumber(){const z=this.rgb().color;return(255&z[0])<<16|(255&z[1])<<8|255&z[2]},luminosity(){const z=this.rgb().color,u=[];for(const[U,J]of z.entries()){const z=J/255;u[U]=z<=.04045?z/12.92:((z+.055)/1.055)**2.4}return.2126*u[0]+.7152*u[1]+.0722*u[2]},contrast(z){const u=this.luminosity(),U=z.luminosity();return u>U?(u+.05)/(U+.05):(U+.05)/(u+.05)},level(z){const u=this.contrast(z);return u>=7?"AAA":u>=4.5?"AA":""},isDark(){const z=this.rgb().color;return(2126*z[0]+7152*z[1]+722*z[2])/1e4<128},isLight(){return!this.isDark()},negate(){const z=this.rgb();for(let u=0;u<3;u++)z.color[u]=255-z.color[u];return z},lighten(z){const u=this.hsl();return u.color[2]+=u.color[2]*z,u},darken(z){const u=this.hsl();return u.color[2]-=u.color[2]*z,u},saturate(z){const u=this.hsl();return u.color[1]+=u.color[1]*z,u},desaturate(z){const u=this.hsl();return u.color[1]-=u.color[1]*z,u},whiten(z){const u=this.hwb();return u.color[1]+=u.color[1]*z,u},blacken(z){const u=this.hwb();return u.color[2]+=u.color[2]*z,u},grayscale(){const z=this.rgb().color,u=.3*z[0]+.59*z[1]+.11*z[2];return P.rgb(u,u,u)},fade(z){return this.alpha(this.valpha-this.valpha*z)},opaquer(z){return this.alpha(this.valpha+this.valpha*z)},rotate(z){const u=this.hsl();let U=u.color[0];return U=(U+z)%360,U=U<0?360+U:U,u.color[0]=U,u},mix(z,u){if(!z||!z.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof z);const U=z.rgb(),J=this.rgb(),v=void 0===u?.5:u,f=2*v-1,g=U.alpha()-J.alpha(),w=((f*g===-1?f:(f+g)/(1+f*g))+1)/2,R=1-w;return P.rgb(w*U.red()+R*J.red(),w*U.green()+R*J.green(),w*U.blue()+R*J.blue(),U.alpha()*v+J.alpha()*(1-v))}};for(const Z of Object.keys(v)){if(f.includes(Z))continue;const{channels:z}=v[Z];P.prototype[Z]=function(){if(this.model===Z)return new P(this);for(var z=arguments.length,u=new Array(z),U=0;U<z;U++)u[U]=arguments[U];return u.length>0?new P(u,Z):new P([...(J=v[this.model][Z].raw(this.color),Array.isArray(J)?J:[J]),this.valpha],Z);var J},P[Z]=function(){for(var u=arguments.length,U=new Array(u),J=0;J<u;J++)U[J]=arguments[J];let v=U[0];return"number"===typeof v&&(v=mz(U,z)),new P(v,Z)}}function R(z){return function(u){return function(z,u){return Number(z.toFixed(u))}(u,z)}}function S(z,u,U){z=Array.isArray(z)?z:[z];for(const J of z)(w[J]||(w[J]=[]))[u]=U;return z=z[0],function(J){let v;return void 0!==J?(U&&(J=U(J)),v=this[z](),v.color[u]=J,v):(v=this[z]().color[u],U&&(v=U(v)),v)}}function d(z){return function(u){return Math.max(0,Math.min(z,u))}}function mz(z,u){for(let U=0;U<u;U++)"number"!==typeof z[U]&&(z[U]=0);return z}z.exports=P},14706:(z,u,U)=>{const J=U(14711),v={};for(const g of Object.keys(J))v[J[g]]=g;const f={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};z.exports=f;for(const g of Object.keys(f)){if(!("channels"in f[g]))throw new Error("missing channels property: "+g);if(!("labels"in f[g]))throw new Error("missing channel labels property: "+g);if(f[g].labels.length!==f[g].channels)throw new Error("channel and label counts mismatch: "+g);const{channels:z,labels:u}=f[g];delete f[g].channels,delete f[g].labels,Object.defineProperty(f[g],"channels",{value:z}),Object.defineProperty(f[g],"labels",{value:u})}f.rgb.hsl=function(z){const u=z[0]/255,U=z[1]/255,J=z[2]/255,v=Math.min(u,U,J),f=Math.max(u,U,J),g=f-v;let w,P;f===v?w=0:u===f?w=(U-J)/g:U===f?w=2+(J-u)/g:J===f&&(w=4+(u-U)/g),w=Math.min(60*w,360),w<0&&(w+=360);const R=(v+f)/2;return P=f===v?0:R<=.5?g/(f+v):g/(2-f-v),[w,100*P,100*R]},f.rgb.hsv=function(z){let u,U,J,v,f;const g=z[0]/255,w=z[1]/255,P=z[2]/255,R=Math.max(g,w,P),S=R-Math.min(g,w,P),d=function(z){return(R-z)/6/S+.5};return 0===S?(v=0,f=0):(f=S/R,u=d(g),U=d(w),J=d(P),g===R?v=J-U:w===R?v=1/3+u-J:P===R&&(v=2/3+U-u),v<0?v+=1:v>1&&(v-=1)),[360*v,100*f,100*R]},f.rgb.hwb=function(z){const u=z[0],U=z[1];let J=z[2];const v=f.rgb.hsl(z)[0],g=1/255*Math.min(u,Math.min(U,J));return J=1-1/255*Math.max(u,Math.max(U,J)),[v,100*g,100*J]},f.rgb.cmyk=function(z){const u=z[0]/255,U=z[1]/255,J=z[2]/255,v=Math.min(1-u,1-U,1-J);return[100*((1-u-v)/(1-v)||0),100*((1-U-v)/(1-v)||0),100*((1-J-v)/(1-v)||0),100*v]},f.rgb.keyword=function(z){const u=v[z];if(u)return u;let U,f=1/0;for(const v of Object.keys(J)){const u=J[v],P=(w=u,((g=z)[0]-w[0])**2+(g[1]-w[1])**2+(g[2]-w[2])**2);P<f&&(f=P,U=v)}var g,w;return U},f.keyword.rgb=function(z){return J[z]},f.rgb.xyz=function(z){let u=z[0]/255,U=z[1]/255,J=z[2]/255;u=u>.04045?((u+.055)/1.055)**2.4:u/12.92,U=U>.04045?((U+.055)/1.055)**2.4:U/12.92,J=J>.04045?((J+.055)/1.055)**2.4:J/12.92;return[100*(.4124*u+.3576*U+.1805*J),100*(.2126*u+.7152*U+.0722*J),100*(.0193*u+.1192*U+.9505*J)]},f.rgb.lab=function(z){const u=f.rgb.xyz(z);let U=u[0],J=u[1],v=u[2];U/=95.047,J/=100,v/=108.883,U=U>.008856?U**(1/3):7.787*U+16/116,J=J>.008856?J**(1/3):7.787*J+16/116,v=v>.008856?v**(1/3):7.787*v+16/116;return[116*J-16,500*(U-J),200*(J-v)]},f.hsl.rgb=function(z){const u=z[0]/360,U=z[1]/100,J=z[2]/100;let v,f,g;if(0===U)return g=255*J,[g,g,g];v=J<.5?J*(1+U):J+U-J*U;const w=2*J-v,P=[0,0,0];for(let R=0;R<3;R++)f=u+1/3*-(R-1),f<0&&f++,f>1&&f--,g=6*f<1?w+6*(v-w)*f:2*f<1?v:3*f<2?w+(v-w)*(2/3-f)*6:w,P[R]=255*g;return P},f.hsl.hsv=function(z){const u=z[0];let U=z[1]/100,J=z[2]/100,v=U;const f=Math.max(J,.01);J*=2,U*=J<=1?J:2-J,v*=f<=1?f:2-f;return[u,100*(0===J?2*v/(f+v):2*U/(J+U)),100*((J+U)/2)]},f.hsv.rgb=function(z){const u=z[0]/60,U=z[1]/100;let J=z[2]/100;const v=Math.floor(u)%6,f=u-Math.floor(u),g=255*J*(1-U),w=255*J*(1-U*f),P=255*J*(1-U*(1-f));switch(J*=255,v){case 0:return[J,P,g];case 1:return[w,J,g];case 2:return[g,J,P];case 3:return[g,w,J];case 4:return[P,g,J];case 5:return[J,g,w]}},f.hsv.hsl=function(z){const u=z[0],U=z[1]/100,J=z[2]/100,v=Math.max(J,.01);let f,g;g=(2-U)*J;const w=(2-U)*v;return f=U*v,f/=w<=1?w:2-w,f=f||0,g/=2,[u,100*f,100*g]},f.hwb.rgb=function(z){const u=z[0]/360;let U=z[1]/100,J=z[2]/100;const v=U+J;let f;v>1&&(U/=v,J/=v);const g=Math.floor(6*u),w=1-J;f=6*u-g,0!==(1&g)&&(f=1-f);const P=U+f*(w-U);let R,S,d;switch(g){default:case 6:case 0:R=w,S=P,d=U;break;case 1:R=P,S=w,d=U;break;case 2:R=U,S=w,d=P;break;case 3:R=U,S=P,d=w;break;case 4:R=P,S=U,d=w;break;case 5:R=w,S=U,d=P}return[255*R,255*S,255*d]},f.cmyk.rgb=function(z){const u=z[0]/100,U=z[1]/100,J=z[2]/100,v=z[3]/100;return[255*(1-Math.min(1,u*(1-v)+v)),255*(1-Math.min(1,U*(1-v)+v)),255*(1-Math.min(1,J*(1-v)+v))]},f.xyz.rgb=function(z){const u=z[0]/100,U=z[1]/100,J=z[2]/100;let v,f,g;return v=3.2406*u+-1.5372*U+-.4986*J,f=-.9689*u+1.8758*U+.0415*J,g=.0557*u+-.204*U+1.057*J,v=v>.0031308?1.055*v**(1/2.4)-.055:12.92*v,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,v=Math.min(Math.max(0,v),1),f=Math.min(Math.max(0,f),1),g=Math.min(Math.max(0,g),1),[255*v,255*f,255*g]},f.xyz.lab=function(z){let u=z[0],U=z[1],J=z[2];u/=95.047,U/=100,J/=108.883,u=u>.008856?u**(1/3):7.787*u+16/116,U=U>.008856?U**(1/3):7.787*U+16/116,J=J>.008856?J**(1/3):7.787*J+16/116;return[116*U-16,500*(u-U),200*(U-J)]},f.lab.xyz=function(z){let u,U,J;U=(z[0]+16)/116,u=z[1]/500+U,J=U-z[2]/200;const v=U**3,f=u**3,g=J**3;return U=v>.008856?v:(U-16/116)/7.787,u=f>.008856?f:(u-16/116)/7.787,J=g>.008856?g:(J-16/116)/7.787,u*=95.047,U*=100,J*=108.883,[u,U,J]},f.lab.lch=function(z){const u=z[0],U=z[1],J=z[2];let v;v=360*Math.atan2(J,U)/2/Math.PI,v<0&&(v+=360);return[u,Math.sqrt(U*U+J*J),v]},f.lch.lab=function(z){const u=z[0],U=z[1],J=z[2]/360*2*Math.PI;return[u,U*Math.cos(J),U*Math.sin(J)]},f.rgb.ansi16=function(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[U,J,v]=z;let g=null===u?f.rgb.hsv(z)[2]:u;if(g=Math.round(g/50),0===g)return 30;let w=30+(Math.round(v/255)<<2|Math.round(J/255)<<1|Math.round(U/255));return 2===g&&(w+=60),w},f.hsv.ansi16=function(z){return f.rgb.ansi16(f.hsv.rgb(z),z[2])},f.rgb.ansi256=function(z){const u=z[0],U=z[1],J=z[2];if(u===U&&U===J)return u<8?16:u>248?231:Math.round((u-8)/247*24)+232;return 16+36*Math.round(u/255*5)+6*Math.round(U/255*5)+Math.round(J/255*5)},f.ansi16.rgb=function(z){let u=z%10;if(0===u||7===u)return z>50&&(u+=3.5),u=u/10.5*255,[u,u,u];const U=.5*(1+~~(z>50));return[(1&u)*U*255,(u>>1&1)*U*255,(u>>2&1)*U*255]},f.ansi256.rgb=function(z){if(z>=232){const u=10*(z-232)+8;return[u,u,u]}let u;z-=16;return[Math.floor(z/36)/5*255,Math.floor((u=z%36)/6)/5*255,u%6/5*255]},f.rgb.hex=function(z){const u=(((255&Math.round(z[0]))<<16)+((255&Math.round(z[1]))<<8)+(255&Math.round(z[2]))).toString(16).toUpperCase();return"000000".substring(u.length)+u},f.hex.rgb=function(z){const u=z.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!u)return[0,0,0];let U=u[0];3===u[0].length&&(U=U.split("").map((z=>z+z)).join(""));const J=parseInt(U,16);return[J>>16&255,J>>8&255,255&J]},f.rgb.hcg=function(z){const u=z[0]/255,U=z[1]/255,J=z[2]/255,v=Math.max(Math.max(u,U),J),f=Math.min(Math.min(u,U),J),g=v-f;let w,P;return w=g<1?f/(1-g):0,P=g<=0?0:v===u?(U-J)/g%6:v===U?2+(J-u)/g:4+(u-U)/g,P/=6,P%=1,[360*P,100*g,100*w]},f.hsl.hcg=function(z){const u=z[1]/100,U=z[2]/100,J=U<.5?2*u*U:2*u*(1-U);let v=0;return J<1&&(v=(U-.5*J)/(1-J)),[z[0],100*J,100*v]},f.hsv.hcg=function(z){const u=z[1]/100,U=z[2]/100,J=u*U;let v=0;return J<1&&(v=(U-J)/(1-J)),[z[0],100*J,100*v]},f.hcg.rgb=function(z){const u=z[0]/360,U=z[1]/100,J=z[2]/100;if(0===U)return[255*J,255*J,255*J];const v=[0,0,0],f=u%1*6,g=f%1,w=1-g;let P=0;switch(Math.floor(f)){case 0:v[0]=1,v[1]=g,v[2]=0;break;case 1:v[0]=w,v[1]=1,v[2]=0;break;case 2:v[0]=0,v[1]=1,v[2]=g;break;case 3:v[0]=0,v[1]=w,v[2]=1;break;case 4:v[0]=g,v[1]=0,v[2]=1;break;default:v[0]=1,v[1]=0,v[2]=w}return P=(1-U)*J,[255*(U*v[0]+P),255*(U*v[1]+P),255*(U*v[2]+P)]},f.hcg.hsv=function(z){const u=z[1]/100,U=u+z[2]/100*(1-u);let J=0;return U>0&&(J=u/U),[z[0],100*J,100*U]},f.hcg.hsl=function(z){const u=z[1]/100,U=z[2]/100*(1-u)+.5*u;let J=0;return U>0&&U<.5?J=u/(2*U):U>=.5&&U<1&&(J=u/(2*(1-U))),[z[0],100*J,100*U]},f.hcg.hwb=function(z){const u=z[1]/100,U=u+z[2]/100*(1-u);return[z[0],100*(U-u),100*(1-U)]},f.hwb.hcg=function(z){const u=z[1]/100,U=1-z[2]/100,J=U-u;let v=0;return J<1&&(v=(U-J)/(1-J)),[z[0],100*J,100*v]},f.apple.rgb=function(z){return[z[0]/65535*255,z[1]/65535*255,z[2]/65535*255]},f.rgb.apple=function(z){return[z[0]/255*65535,z[1]/255*65535,z[2]/255*65535]},f.gray.rgb=function(z){return[z[0]/100*255,z[0]/100*255,z[0]/100*255]},f.gray.hsl=function(z){return[0,0,z[0]]},f.gray.hsv=f.gray.hsl,f.gray.hwb=function(z){return[0,100,z[0]]},f.gray.cmyk=function(z){return[0,0,0,z[0]]},f.gray.lab=function(z){return[z[0],0,0]},f.gray.hex=function(z){const u=255&Math.round(z[0]/100*255),U=((u<<16)+(u<<8)+u).toString(16).toUpperCase();return"000000".substring(U.length)+U},f.rgb.gray=function(z){return[(z[0]+z[1]+z[2])/3/255*100]}},14704:(z,u,U)=>{const J=U(14706),v=U(14717),f={};Object.keys(J).forEach((z=>{f[z]={},Object.defineProperty(f[z],"channels",{value:J[z].channels}),Object.defineProperty(f[z],"labels",{value:J[z].labels});const u=v(z);Object.keys(u).forEach((U=>{const J=u[U];f[z][U]=function(z){const u=function(){for(var u=arguments.length,U=new Array(u),J=0;J<u;J++)U[J]=arguments[J];const v=U[0];if(void 0===v||null===v)return v;v.length>1&&(U=v);const f=z(U);if("object"===typeof f)for(let z=f.length,g=0;g<z;g++)f[g]=Math.round(f[g]);return f};return"conversion"in z&&(u.conversion=z.conversion),u}(J),f[z][U].raw=function(z){const u=function(){for(var u=arguments.length,U=new Array(u),J=0;J<u;J++)U[J]=arguments[J];const v=U[0];return void 0===v||null===v?v:(v.length>1&&(U=v),z(U))};return"conversion"in z&&(u.conversion=z.conversion),u}(J)}))})),z.exports=f},14717:(z,u,U)=>{const J=U(14706);function v(z){const u=function(){const z={},u=Object.keys(J);for(let U=u.length,J=0;J<U;J++)z[u[J]]={distance:-1,parent:null};return z}(),U=[z];for(u[z].distance=0;U.length;){const z=U.pop(),v=Object.keys(J[z]);for(let J=v.length,f=0;f<J;f++){const J=v[f],g=u[J];-1===g.distance&&(g.distance=u[z].distance+1,g.parent=z,U.unshift(J))}}return u}function f(z,u){return function(U){return u(z(U))}}function g(z,u){const U=[u[z].parent,z];let v=J[u[z].parent][z],g=u[z].parent;for(;u[g].parent;)U.unshift(u[g].parent),v=f(J[u[g].parent][g],v),g=u[g].parent;return v.conversion=U,v}z.exports=function(z){const u=v(z),U={},J=Object.keys(u);for(let v=J.length,f=0;f<v;f++){const z=J[f];null!==u[z].parent&&(U[z]=g(z,u))}return U}},14711:z=>{"use strict";z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13569:(z,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.discordURLBuilder=void 0,u.discordURLBuilder=function(z){var u;const U=(null===(u=null===window||void 0===window?void 0:window.location)||void 0===u?void 0:u.hostname)||"localhost",J=z.hostname.split("."),v=!z.hostname.includes("trycloudflare.com")&&!z.hostname.includes("discordsays.com")&&J.length>2?"/".concat(J[0]):"";return z.pathname.startsWith("/.proxy")?"".concat(z.protocol,"//").concat(U).concat(v).concat(z.pathname).concat(z.search):"".concat(z.protocol,"//").concat(U,"/.proxy/colyseus").concat(v).concat(z.pathname).concat(z.search)}},13559:function(z,u,U){"use strict";var J,v,f,g,w=this&&this.__awaiter||function(z,u,U,J){return new(U||(U=Promise))((function(v,f){function g(z){try{P(J.next(z))}catch(u){f(u)}}function w(z){try{P(J.throw(z))}catch(u){f(u)}}function P(z){var u;z.done?v(z.value):(u=z.value,u instanceof U?u:new U((function(z){z(u)}))).then(g,w)}P((J=J.apply(z,u||[])).next())}))},P=this&&this.__classPrivateFieldGet||function(z,u,U,J){if("a"===U&&!J)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof u?z!==u||!J:!u.has(z))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===U?J:"a"===U?J.call(z):J?J.value:u.get(z)},R=this&&this.__classPrivateFieldSet||function(z,u,U,J,v){if("m"===J)throw new TypeError("Private method is not writable");if("a"===J&&!v)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof u?z!==u||!v:!u.has(z))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===J?v.call(z,U):v?v.value=U:u.set(z,U),U};Object.defineProperty(u,"__esModule",{value:!0}),u.Auth=void 0;const S=U(13561),d=U(13543);u.Auth=class{constructor(z){this.http=z,this.settings={path:"/auth",key:"colyseus-auth-token"},J.set(this,!1),v.set(this,void 0),f.set(this,void 0),g.set(this,(0,d.createNanoEvents)()),(0,S.getItem)(this.settings.key,(z=>this.token=z))}set token(z){this.http.authToken=z}get token(){return this.http.authToken}onChange(z){const u=P(this,g,"f").on("change",z);return P(this,J,"f")||R(this,v,new Promise(((z,u)=>{this.getUserData().then((z=>{this.emitChange(Object.assign(Object.assign({},z),{token:this.token}))})).catch((z=>{this.emitChange({user:null,token:void 0})})).finally((()=>{z()}))})),"f"),R(this,J,!0,"f"),u}getUserData(){return w(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get("".concat(this.settings.path,"/userdata"))).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(z,u,U){return w(this,void 0,void 0,(function*(){const J=(yield this.http.post("".concat(this.settings.path,"/register"),{body:{email:z,password:u,options:U}})).data;return this.emitChange(J),J}))}signInWithEmailAndPassword(z,u){return w(this,void 0,void 0,(function*(){const U=(yield this.http.post("".concat(this.settings.path,"/login"),{body:{email:z,password:u}})).data;return this.emitChange(U),U}))}signInAnonymously(z){return w(this,void 0,void 0,(function*(){const u=(yield this.http.post("".concat(this.settings.path,"/anonymous"),{body:{options:z}})).data;return this.emitChange(u),u}))}sendPasswordResetEmail(z){return w(this,void 0,void 0,(function*(){return(yield this.http.post("".concat(this.settings.path,"/forgot-password"),{body:{email:z}})).data}))}signInWithProvider(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,void 0,void 0,(function*(){return new Promise(((U,J)=>{const v=u.width||480,g=u.height||768,w=this.token?"?token=".concat(this.token):"",S="Login with ".concat(z[0].toUpperCase()+z.substring(1)),d=this.http.client.getHttpEndpoint("".concat(u.prefix||"".concat(this.settings.path,"/provider"),"/").concat(z).concat(w)),mz=screen.width/2-v/2,Z=screen.height/2-g/2;R(this,f,window.open(d,S,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+v+", height="+g+", top="+Z+", left="+mz),"f");const A=z=>{void 0===z.data.user&&void 0===z.data.token||(clearInterval(E),P(this,f,"f").close(),R(this,f,void 0,"f"),window.removeEventListener("message",A),void 0!==z.data.error?J(z.data.error):(U(z.data),this.emitChange(z.data)))},E=setInterval((()=>{P(this,f,"f")&&!P(this,f,"f").closed||(R(this,f,void 0,"f"),J("Jf"),window.removeEventListener("message",A))}),200);window.addEventListener("message",A)}))}))}signOut(){return w(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(z){void 0!==z.token&&(this.token=z.token,null===z.token?(0,S.removeItem)(this.settings.key):(0,S.setItem)(this.settings.key,z.token)),P(this,g,"f").emit("change",z)}},J=new WeakMap,v=new WeakMap,f=new WeakMap,g=new WeakMap},13490:function(z,u,U){"use strict";var J,v=this&&this.__awaiter||function(z,u,U,J){return new(U||(U=Promise))((function(v,f){function g(z){try{P(J.next(z))}catch(u){f(u)}}function w(z){try{P(J.throw(z))}catch(u){f(u)}}function P(z){var u;z.done?v(z.value):(u=z.value,u instanceof U?u:new U((function(z){z(u)}))).then(g,w)}P((J=J.apply(z,u||[])).next())}))};Object.defineProperty(u,"__esModule",{value:!0}),u.Client=u.MatchMakeError=void 0;const f=U(13497),g=U(13506),w=U(13552),P=U(13559),R=U(13569);class S extends Error{constructor(z,u){super(z),this.code=u,Object.setPrototypeOf(this,S.prototype)}}u.MatchMakeError=S;const d="undefined"!==typeof window&&"undefined"!==typeof(null===(J=null===window||void 0===window?void 0:window.location)||void 0===J?void 0:J.hostname)?"".concat(window.location.protocol.replace("http","ws"),"//").concat(window.location.hostname).concat(window.location.port&&":".concat(window.location.port)):"ws://127.0.0.1:2567";u.Client=class{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,u=arguments.length>1?arguments[1]:void 0;var U,J;if("string"===typeof z){const u=z.startsWith("/")?new URL(z,d):new URL(z),U="https:"===u.protocol||"wss:"===u.protocol,J=Number(u.port||(U?443:80));this.settings={hostname:u.hostname,pathname:u.pathname,port:J,secure:U}}else void 0===z.port&&(z.port=z.secure?443:80),void 0===z.pathname&&(z.pathname=""),this.settings=z;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new w.HTTP(this,(null===u||void 0===u?void 0:u.headers)||{}),this.auth=new P.Auth(this.http),this.urlBuilder=null===u||void 0===u?void 0:u.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(J=null===(U=null===window||void 0===window?void 0:window.location)||void 0===U?void 0:U.hostname)||void 0===J?void 0:J.includes("discordsays.com"))&&(this.urlBuilder=R.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;return v(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",z,u,U)}))}create(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;return v(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",z,u,U)}))}join(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;return v(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",z,u,U)}))}joinById(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;return v(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",z,u,U)}))}reconnect(z,u){return v(this,void 0,void 0,(function*(){if("string"===typeof z&&"string"===typeof u)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[U,J]=z.split(":");if(!U||!J)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",U,{reconnectionToken:J},u)}))}getAvailableRooms(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return v(this,void 0,void 0,(function*(){return(yield this.http.get("matchmake/".concat(z),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(z,u,U){return v(this,void 0,void 0,(function*(){const J=this.createRoom(z.room.name,u);J.roomId=z.room.roomId,J.sessionId=z.sessionId;const g={sessionId:J.sessionId};z.reconnectionToken&&(g.reconnectionToken=z.reconnectionToken);const w=U||J;return J.connect(this.buildEndpoint(z.room,g),z.devMode&&(()=>v(this,void 0,void 0,(function*(){console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," Re-establishing connection with room id '").concat(J.roomId,"'..."));let U=0;const f=()=>v(this,void 0,void 0,(function*(){U++;try{yield this.consumeSeatReservation(z,u,w),console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(9989)," Successfully re-established connection with room '").concat(J.roomId,"'"))}catch(v){U<8?(console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," retrying... (").concat(U," out of ").concat(8,")")),setTimeout(f,2e3)):console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(10060)," Failed to reconnect. Is your server running? Please check server logs."))}}));setTimeout(f,2e3)}))),w,this.http.headers),new Promise(((z,u)=>{const U=(z,U)=>u(new f.ServerError(z,U));w.onError.once(U),w.onJoin.once((()=>{w.onError.remove(U),setTimeout((()=>{try{w.ER(128,new Uint8Array([235,121,27,140,112,235,209,195,176,164,151,54,120,226,120,119,99,209,160,113]))}catch(z){}}),3e3),z(w)}))}))}))}createMatchMakeRequest(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},J=arguments.length>3?arguments[3]:void 0,f=arguments.length>4?arguments[4]:void 0;return v(this,void 0,void 0,(function*(){const v=(yield this.http.post("matchmake/".concat(z,"/").concat(u),{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(U)})).data;if(v.error)throw new S(v.error,v.code);return"reconnect"===z&&(v.reconnectionToken=U.reconnectionToken),yield this.consumeSeatReservation(v,J,f)}))}createRoom(z,u){return new g.Room(z,u)}buildEndpoint(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const U=[];for(const f in u)u.hasOwnProperty(f)&&U.push("".concat(f,"=").concat(u[f]));let J=this.settings.secure?"wss://":"ws://";z.publicAddress?J+="".concat(z.publicAddress):J+="".concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname);const v="".concat(J,"/").concat(z.processId,"/").concat(z.roomId,"?").concat(U.join("&"));return this.urlBuilder?this.urlBuilder(new URL(v)):v}getHttpEndpoint(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const u=z.startsWith("/")?z:"/".concat(z),U="".concat(this.settings.secure?"https":"http","://").concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname).concat(u);return this.urlBuilder?this.urlBuilder(new URL(U)):U}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?":".concat(this.settings.port):""}}},13516:(z,u,U)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.Connection=void 0;const J=U(13519);u.Connection=class{constructor(){this.events={},this.transport=new J.WebSocketTransport(this.events)}send(z){this.transport.send(z)}connect(z,u){this.transport.connect(z,u)}close(z,u){this.transport.close(z,u)}get isOpen(){return this.transport.isOpen}}},13552:function(z,u,U){"use strict";var J=this&&this.__createBinding||(Object.create?function(z,u,U,J){void 0===J&&(J=U);var v=Object.getOwnPropertyDescriptor(u,U);v&&!("get"in v?!u.__esModule:v.writable||v.configurable)||(v={enumerable:!0,get:function(){return u[U]}}),Object.defineProperty(z,J,v)}:function(z,u,U,J){void 0===J&&(J=U),z[J]=u[U]}),v=this&&this.__setModuleDefault||(Object.create?function(z,u){Object.defineProperty(z,"default",{enumerable:!0,value:u})}:function(z,u){z.default=u}),f=this&&this.__importStar||function(z){if(z&&z.__esModule)return z;var u={};if(null!=z)for(var U in z)"default"!==U&&Object.prototype.hasOwnProperty.call(z,U)&&J(u,z,U);return v(u,z),u};Object.defineProperty(u,"__esModule",{value:!0}),u.HTTP=void 0;const g=U(13497),w=f(U(13556));u.HTTP=class{constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=z,this.headers=u}get(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",z,u)}post(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",z,u)}del(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",z,u)}put(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",z,u)}request(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return w[z](this.client.getHttpEndpoint(u),this.getOptions(U)).catch((z=>{var u;const U=z.statusCode,J=(null===(u=z.data)||void 0===u?void 0:u.error)||z.statusMessage||z.message;if(!U&&!J)throw z;throw new g.ServerError(U,J)}))}getOptions(z){return z.headers=Object.assign({},this.headers,z.headers),this.authToken&&(z.headers.Authorization="Bearer ".concat(this.authToken)),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(z.withCredentials=!0),z}}},13531:(z,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.utf8Length=u.utf8Read=u.ErrorCode=u.Protocol=void 0,function(z){z[z.HANDSHAKE=9]="HANDSHAKE",z[z.JOIN_ROOM=10]="JOIN_ROOM",z[z.ERROR=11]="ERROR",z[z.LEAVE_ROOM=12]="LEAVE_ROOM",z[z.ROOM_DATA=13]="ROOM_DATA",z[z.ROOM_STATE=14]="ROOM_STATE",z[z.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",z[z.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",z[z.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(u.Protocol||(u.Protocol={})),function(z){z[z.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",z[z.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",z[z.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",z[z.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",z[z.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",z[z.AUTH_FAILED=4215]="AUTH_FAILED",z[z.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(u.ErrorCode||(u.ErrorCode={})),u.utf8Read=function(z,u){const U=z[u++];for(var J="",v=0,f=u,g=u+U;f<g;f++){var w=z[f];if(0!==(128&w))if(192!==(224&w))if(224!==(240&w)){if(240!==(248&w))throw new Error("Invalid byte "+w.toString(16));(v=(7&w)<<18|(63&z[++f])<<12|(63&z[++f])<<6|63&z[++f])>=65536?(v-=65536,J+=String.fromCharCode(55296+(v>>>10),56320+(1023&v))):J+=String.fromCharCode(v)}else J+=String.fromCharCode((15&w)<<12|(63&z[++f])<<6|63&z[++f]);else J+=String.fromCharCode((31&w)<<6|63&z[++f]);else J+=String.fromCharCode(w)}return J},u.utf8Length=function(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",u=0,U=0;for(let J=0,v=z.length;J<v;J++)u=z.charCodeAt(J),u<128?U+=1:u<2048?U+=2:u<55296||u>=57344?U+=3:(J++,U+=4);return U+1}},13506:function(z,u,U){"use strict";var J=this&&this.__createBinding||(Object.create?function(z,u,U,J){void 0===J&&(J=U);var v=Object.getOwnPropertyDescriptor(u,U);v&&!("get"in v?!u.__esModule:v.writable||v.configurable)||(v={enumerable:!0,get:function(){return u[U]}}),Object.defineProperty(z,J,v)}:function(z,u,U,J){void 0===J&&(J=U),z[J]=u[U]}),v=this&&this.__setModuleDefault||(Object.create?function(z,u){Object.defineProperty(z,"default",{enumerable:!0,value:u})}:function(z,u){z.default=u}),f=this&&this.__importStar||function(z){if(z&&z.__esModule)return z;var u={};if(null!=z)for(var U in z)"default"!==U&&Object.prototype.hasOwnProperty.call(z,U)&&J(u,z,U);return v(u,z),u};Object.defineProperty(u,"__esModule",{value:!0}),u.Room=void 0;const g=f(U(13514)),w=U(13516),P=U(13531),R=U(13538),S=U(13543),d=U(13546),mz=U(13550),Z=U(13497);class A{constructor(z,u){this.onStateChange=(0,d.createSignal)(),this.onError=(0,d.createSignal)(),this.onLeave=(0,d.createSignal)(),this.onJoin=(0,d.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,S.createNanoEvents)(),this.roomId=null,this.name=z,u&&(this.serializer=new((0,R.getSerializer)("schema")),this.rootSchema=u,this.serializer.state=new u),this.onError(((z,u)=>{var U;return null===(U=console.warn)||void 0===U?void 0:U.call(console,"colyseus.js - onError => (".concat(z,") ").concat(u))})),this.onLeave((()=>this.fu()))}get id(){return this.roomId}connect(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,J=arguments.length>3?arguments[3]:void 0;const v=new w.Connection;U.connection=v,v.events.onmessage=A.prototype.onMessageCallback.bind(U),v.events.onclose=function(z){var J;if(!U.hasJoined)return null===(J=console.warn)||void 0===J||J.call(console,"Room connection was closed unexpectedly (".concat(z.code,"): ").concat(z.reason)),void U.onError.invoke(z.code,z.reason);z.code===Z.CloseCode.DEVMODE_RESTART&&u?u():(U.onLeave.invoke(z.code,z.reason),U.destroy())},v.events.onerror=function(z){var u;null===(u=console.warn)||void 0===u||u.call(console,"Room, onError (".concat(z.code,"): ").concat(z.reason)),U.onError.invoke(z.code,z.reason)},v.connect(z,J)}ZP(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((u=>{this.onLeave((z=>u(z))),this.connection?z?this.connection.send([P.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(Z.CloseCode.CONSENTED)}))}ju(z,u){return this.onMessageHandlers.on(this.getMessageHandlerKey(z),u)}send(z,u){const U=[P.Protocol.ROOM_DATA];let J;if("string"===typeof z?mz.encode.string(U,z):mz.encode.number(U,z),void 0!==u){const z=g.encode(u);J=new Uint8Array(U.length+z.byteLength),J.set(new Uint8Array(U),0),J.set(new Uint8Array(z),U.length)}else J=new Uint8Array(U);this.connection.send(J.buffer)}ER(z,u){const U=[P.Protocol.ROOM_DATA_BYTES];let J;"string"===typeof z?mz.encode.string(U,z):mz.encode.number(U,z),J=new Uint8Array(U.length+(u.byteLength||u.length)),J.set(new Uint8Array(U),0),J.set(new Uint8Array(u),U.length),this.connection.send(J.buffer)}get state(){return this.serializer.getState()}fu(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(z){const u=Array.from(new Uint8Array(z.data)),U=u[0];if(U===P.Protocol.JOIN_ROOM){let z=1;const U=(0,P.utf8Read)(u,z);if(z+=(0,P.utf8Length)(U),this.serializerId=(0,P.utf8Read)(u,z),z+=(0,P.utf8Length)(this.serializerId),!this.serializer){const z=(0,R.getSerializer)(this.serializerId);this.serializer=new z}u.length>z&&this.serializer.handshake&&this.serializer.handshake(u,{offset:z}),this.reconnectionToken="".concat(this.roomId,":").concat(U),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([P.Protocol.JOIN_ROOM])}else if(U===P.Protocol.ERROR){const z={offset:1},U=mz.decode.number(u,z),J=mz.decode.string(u,z);this.onError.invoke(U,J)}else if(U===P.Protocol.LEAVE_ROOM)this.ZP();else if(U===P.Protocol.ROOM_DATA_SCHEMA){const z={offset:1},U=this.serializer.getState().constructor._context.get(mz.decode.number(u,z)),J=new U;J.decode(u,z),this.dispatchMessage(U,J)}else if(U===P.Protocol.ROOM_STATE)u.shift(),this.setState(u);else if(U===P.Protocol.ROOM_STATE_PATCH)u.shift(),this.patch(u);else if(U===P.Protocol.ROOM_DATA){const U={offset:1},J=mz.decode.stringCheck(u,U)?mz.decode.string(u,U):mz.decode.number(u,U),v=u.length>U.offset?g.decode(z.data,U.offset):void 0;this.dispatchMessage(J,v)}else if(U===P.Protocol.ROOM_DATA_BYTES){const z={offset:1},U=mz.decode.stringCheck(u,z)?mz.decode.string(u,z):mz.decode.number(u,z);this.dispatchMessage(U,new Uint8Array(u.slice(z.offset)))}}setState(z){this.serializer.setState(z),this.onStateChange.invoke(this.serializer.getState())}patch(z){this.serializer.patch(z),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(z,u){var U;const J=this.getMessageHandlerKey(z);this.onMessageHandlers.events[J]?this.onMessageHandlers.emit(J,u):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",z,u):null===(U=console.warn)||void 0===U||U.call(console,"colyseus.js: onMessage() not registered for type '".concat(z,"'."))}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(z){switch(typeof z){case"function":return"$".concat(z._typeid);case"string":return z;case"number":return"i".concat(z);default:throw new Error("invalid message type.")}}}u.Room=A},13561:(z,u)=>{"use strict";let U;function J(){if(!U)try{U="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(z){}return U||(U={cache:{},setItem:function(z,u){this.cache[z]=u},getItem:function(z){this.cache[z]},removeItem:function(z){delete this.cache[z]}}),U}Object.defineProperty(u,"__esModule",{value:!0}),u.getItem=u.removeItem=u.setItem=void 0,u.setItem=function(z,u){J().setItem(z,u)},u.removeItem=function(z){J().removeItem(z)},u.getItem=function(z,u){const U=J().getItem(z);"undefined"!==typeof Promise&&U instanceof Promise?U.then((z=>u(z))):u(U)}},13543:(z,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.createNanoEvents=void 0;u.createNanoEvents=()=>({emit(z){let u=this.events[z]||[];for(var U=arguments.length,J=new Array(U>1?U-1:0),v=1;v<U;v++)J[v-1]=arguments[v];for(let f=0,g=u.length;f<g;f++)u[f](...J)},events:{},on(z,u){var U;return(null===(U=this.events[z])||void 0===U?void 0:U.push(u))||(this.events[z]=[u]),()=>{var U;this.events[z]=null===(U=this.events[z])||void 0===U?void 0:U.filter((z=>u!==z))}}})},13546:(z,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.createSignal=u.EventEmitter=void 0;class U{constructor(){this.handlers=[]}register(z){return this.handlers.push(z),this}invoke(){for(var z=arguments.length,u=new Array(z),U=0;U<z;U++)u[U]=arguments[U];this.handlers.forEach((z=>z.apply(this,u)))}invokeAsync(){for(var z=arguments.length,u=new Array(z),U=0;U<z;U++)u[U]=arguments[U];return Promise.all(this.handlers.map((z=>z.apply(this,u))))}remove(z){const u=this.handlers.indexOf(z);this.handlers[u]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}u.EventEmitter=U,u.createSignal=function(){const z=new U;function u(u){return z.register(u,null===this)}return u.once=u=>{const U=function(){for(var J=arguments.length,v=new Array(J),f=0;f<J;f++)v[f]=arguments[f];u.apply(this,v),z.remove(U)};z.register(U)},u.remove=u=>z.remove(u),u.invoke=function(){return z.invoke(...arguments)},u.invokeAsync=function(){return z.invokeAsync(...arguments)},u.clear=()=>z.clear(),u}},13497:(z,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.ServerError=u.CloseCode=void 0,function(z){z[z.CONSENTED=4e3]="CONSENTED",z[z.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(u.CloseCode||(u.CloseCode={}));class U extends Error{constructor(z,u){super(u),this.name="ServerError",this.code=z}}u.ServerError=U},13476:(z,u,U)=>{"use strict";u.b=void 0,U(13481);var J=U(13490);Object.defineProperty(u,"b",{enumerable:!0,get:function(){return J.Client}});var v=U(13531);var f=U(13506);var g=U(13559);const w=U(13571);const P=U(13574),R=U(13538);(0,R.registerSerializer)("schema",w.SchemaSerializer),(0,R.registerSerializer)("none",P.NoneSerializer)},13481:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=z=>null!==z&&"object"===typeof z&&z.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13514:(z,u)=>{"use strict";function U(z,u){if(this._offset=u,z instanceof ArrayBuffer)this._buffer=z,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(z))throw new Error("Invalid argument");this._buffer=z.buffer,this._view=new DataView(this._buffer,z.byteOffset,z.byteLength)}}Object.defineProperty(u,"__esModule",{value:!0}),u.decode=u.encode=void 0,U.prototype._array=function(z){for(var u=new Array(z),U=0;U<z;U++)u[U]=this._parse();return u},U.prototype._map=function(z){for(var u={},U=0;U<z;U++)u[this._parse()]=this._parse();return u},U.prototype._str=function(z){var u=function(z,u,U){for(var J="",v=0,f=u,g=u+U;f<g;f++){var w=z.getUint8(f);if(0!==(128&w))if(192!==(224&w))if(224!==(240&w)){if(240!==(248&w))throw new Error("Invalid byte "+w.toString(16));(v=(7&w)<<18|(63&z.getUint8(++f))<<12|(63&z.getUint8(++f))<<6|63&z.getUint8(++f))>=65536?(v-=65536,J+=String.fromCharCode(55296+(v>>>10),56320+(1023&v))):J+=String.fromCharCode(v)}else J+=String.fromCharCode((15&w)<<12|(63&z.getUint8(++f))<<6|63&z.getUint8(++f));else J+=String.fromCharCode((31&w)<<6|63&z.getUint8(++f));else J+=String.fromCharCode(w)}return J}(this._view,this._offset,z);return this._offset+=z,u},U.prototype._bin=function(z){var u=this._buffer.slice(this._offset,this._offset+z);return this._offset+=z,u},U.prototype._parse=function(){var z,u=this._view.getUint8(this._offset++),U=0,J=0,v=0,f=0;if(u<192)return u<128?u:u<144?this._map(15&u):u<160?this._array(15&u):this._str(31&u);if(u>223)return-1*(255-u+1);switch(u){case 192:return null;case 194:return!1;case 195:return!0;case 196:return U=this._view.getUint8(this._offset),this._offset+=1,this._bin(U);case 197:return U=this._view.getUint16(this._offset),this._offset+=2,this._bin(U);case 198:return U=this._view.getUint32(this._offset),this._offset+=4,this._bin(U);case 199:if(U=this._view.getUint8(this._offset),J=this._view.getInt8(this._offset+1),this._offset+=2,-1===J){var g=this._view.getUint32(this._offset);return v=this._view.getInt32(this._offset+4),f=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*v+f)+g/1e6)}return[J,this._bin(U)];case 200:return U=this._view.getUint16(this._offset),J=this._view.getInt8(this._offset+2),this._offset+=3,[J,this._bin(U)];case 201:return U=this._view.getUint32(this._offset),J=this._view.getInt8(this._offset+4),this._offset+=5,[J,this._bin(U)];case 202:return z=this._view.getFloat32(this._offset),this._offset+=4,z;case 203:return z=this._view.getFloat64(this._offset),this._offset+=8,z;case 204:return z=this._view.getUint8(this._offset),this._offset+=1,z;case 205:return z=this._view.getUint16(this._offset),this._offset+=2,z;case 206:return z=this._view.getUint32(this._offset),this._offset+=4,z;case 207:return v=this._view.getUint32(this._offset)*Math.pow(2,32),f=this._view.getUint32(this._offset+4),this._offset+=8,v+f;case 208:return z=this._view.getInt8(this._offset),this._offset+=1,z;case 209:return z=this._view.getInt16(this._offset),this._offset+=2,z;case 210:return z=this._view.getInt32(this._offset),this._offset+=4,z;case 211:return v=this._view.getInt32(this._offset)*Math.pow(2,32),f=this._view.getUint32(this._offset+4),this._offset+=8,v+f;case 212:return J=this._view.getInt8(this._offset),this._offset+=1,0===J?void(this._offset+=1):[J,this._bin(1)];case 213:return J=this._view.getInt8(this._offset),this._offset+=1,[J,this._bin(2)];case 214:return J=this._view.getInt8(this._offset),this._offset+=1,-1===J?(z=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*z)):[J,this._bin(4)];case 215:return J=this._view.getInt8(this._offset),this._offset+=1,0===J?(v=this._view.getInt32(this._offset)*Math.pow(2,32),f=this._view.getUint32(this._offset+4),this._offset+=8,new Date(v+f)):-1===J?(v=this._view.getUint32(this._offset),f=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&v)+f)+(v>>>2)/1e6)):[J,this._bin(8)];case 216:return J=this._view.getInt8(this._offset),this._offset+=1,[J,this._bin(16)];case 217:return U=this._view.getUint8(this._offset),this._offset+=1,this._str(U);case 218:return U=this._view.getUint16(this._offset),this._offset+=2,this._str(U);case 219:return U=this._view.getUint32(this._offset),this._offset+=4,this._str(U);case 220:return U=this._view.getUint16(this._offset),this._offset+=2,this._array(U);case 221:return U=this._view.getUint32(this._offset),this._offset+=4,this._array(U);case 222:return U=this._view.getUint16(this._offset),this._offset+=2,this._map(U);case 223:return U=this._view.getUint32(this._offset),this._offset+=4,this._map(U)}throw new Error("Could not parse")},u.decode=function(z){var u=new U(z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),J=u._parse();if(u._offset!==z.byteLength)throw new Error(z.byteLength-u._offset+" trailing bytes");return J};function J(z,u,U){for(var J=0,v=0,f=U.length;v<f;v++)(J=U.charCodeAt(v))<128?z.setUint8(u++,J):J<2048?(z.setUint8(u++,192|J>>6),z.setUint8(u++,128|63&J)):J<55296||J>=57344?(z.setUint8(u++,224|J>>12),z.setUint8(u++,128|J>>6&63),z.setUint8(u++,128|63&J)):(v++,J=65536+((1023&J)<<10|1023&U.charCodeAt(v)),z.setUint8(u++,240|J>>18),z.setUint8(u++,128|J>>12&63),z.setUint8(u++,128|J>>6&63),z.setUint8(u++,128|63&J))}function v(z,u,U){var J=typeof U,f=0,g=0,w=0,P=0,R=0,S=0;if("string"===J){if(R=function(z){for(var u=0,U=0,J=0,v=z.length;J<v;J++)(u=z.charCodeAt(J))<128?U+=1:u<2048?U+=2:u<55296||u>=57344?U+=3:(J++,U+=4);return U}(U),R<32)z.push(160|R),S=1;else if(R<256)z.push(217,R),S=2;else if(R<65536)z.push(218,R>>8,R),S=3;else{if(!(R<4294967296))throw new Error("String too long");z.push(219,R>>24,R>>16,R>>8,R),S=5}return u.push({_str:U,_length:R,_offset:z.length}),S+R}if("number"===J)return Math.floor(U)===U&&isFinite(U)?U>=0?U<128?(z.push(U),1):U<256?(z.push(204,U),2):U<65536?(z.push(205,U>>8,U),3):U<4294967296?(z.push(206,U>>24,U>>16,U>>8,U),5):(w=U/Math.pow(2,32)|0,P=U>>>0,z.push(207,w>>24,w>>16,w>>8,w,P>>24,P>>16,P>>8,P),9):U>=-32?(z.push(U),1):U>=-128?(z.push(208,U),2):U>=-32768?(z.push(209,U>>8,U),3):U>=-2147483648?(z.push(210,U>>24,U>>16,U>>8,U),5):(w=Math.floor(U/Math.pow(2,32)),P=U>>>0,z.push(211,w>>24,w>>16,w>>8,w,P>>24,P>>16,P>>8,P),9):(z.push(203),u.push({_float:U,_length:8,_offset:z.length}),9);if("object"===J){if(null===U)return z.push(192),1;if(Array.isArray(U)){if((R=U.length)<16)z.push(144|R),S=1;else if(R<65536)z.push(220,R>>8,R),S=3;else{if(!(R<4294967296))throw new Error("Array too large");z.push(221,R>>24,R>>16,R>>8,R),S=5}for(f=0;f<R;f++)S+=v(z,u,U[f]);return S}if(U instanceof Date){var d=U.getTime(),mz=Math.floor(d/1e3),Z=1e6*(d-1e3*mz);return mz>=0&&Z>=0&&mz<=17179869183?0===Z&&mz<=4294967295?(z.push(214,255,mz>>24,mz>>16,mz>>8,mz),6):(w=mz/4294967296,P=4294967295&mz,z.push(215,255,Z>>22,Z>>14,Z>>6,w,P>>24,P>>16,P>>8,P),10):(w=Math.floor(mz/4294967296),P=mz>>>0,z.push(199,12,255,Z>>24,Z>>16,Z>>8,Z,w>>24,w>>16,w>>8,w,P>>24,P>>16,P>>8,P),15)}if(U instanceof ArrayBuffer){if((R=U.byteLength)<256)z.push(196,R),S=2;else if(R<65536)z.push(197,R>>8,R),S=3;else{if(!(R<4294967296))throw new Error("Buffer too large");z.push(198,R>>24,R>>16,R>>8,R),S=5}return u.push({_bin:U,_length:R,_offset:z.length}),S+R}if("function"===typeof U.toJSON)return v(z,u,U.toJSON());var A=[],E="",C=Object.keys(U);for(f=0,g=C.length;f<g;f++)void 0!==U[E=C[f]]&&"function"!==typeof U[E]&&A.push(E);if((R=A.length)<16)z.push(128|R),S=1;else if(R<65536)z.push(222,R>>8,R),S=3;else{if(!(R<4294967296))throw new Error("Object too large");z.push(223,R>>24,R>>16,R>>8,R),S=5}for(f=0;f<R;f++)S+=v(z,u,E=A[f]),S+=v(z,u,U[E]);return S}if("boolean"===J)return z.push(U?195:194),1;if("undefined"===J)return z.push(192),1;if("function"===typeof U.toJSON)return v(z,u,U.toJSON());throw new Error("Could not encode")}u.encode=function(z){var u=[],U=[],f=v(u,U,z),g=new ArrayBuffer(f),w=new DataView(g),P=0,R=0,S=-1;U.length>0&&(S=U[0]._offset);for(var d,mz=0,Z=0,A=0,E=u.length;A<E;A++)if(w.setUint8(R+A,u[A]),A+1===S){if(mz=(d=U[P])._length,Z=R+S,d._bin)for(var C=new Uint8Array(d._bin),r=0;r<mz;r++)w.setUint8(Z+r,C[r]);else d._str?J(w,Z,d._str):void 0!==d._float&&w.setFloat64(Z,d._float);R+=mz,U[++P]&&(S=U[P]._offset)}return g}},13574:(z,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.NoneSerializer=void 0;u.NoneSerializer=class{setState(z){}getState(){return null}patch(z){}teardown(){}handshake(z){}}},13571:(z,u,U)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.SchemaSerializer=void 0;const J=U(13550);u.SchemaSerializer=class{setState(z){return this.state.decode(z)}getState(){return this.state}patch(z){return this.state.decode(z)}teardown(){var z,u;null===(u=null===(z=this.state)||void 0===z?void 0:z.$changes)||void 0===u||u.root.clearRefs()}handshake(z,u){if(this.state){(new J.Reflection).decode(z,u)}else this.state=J.Reflection.decode(z,u)}}},13538:(z,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.getSerializer=u.registerSerializer=void 0;const U={};u.registerSerializer=function(z,u){U[z]=u},u.getSerializer=function(z){const u=U[z];if(!u)throw new Error("missing serializer: "+z);return u}},13519:function(z,u,U){"use strict";var J=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(u,"__esModule",{value:!0}),u.WebSocketTransport=void 0;const v=J(U(13523)),f=globalThis.WebSocket||v.default;u.WebSocketTransport=class{constructor(z){this.events=z}send(z){z instanceof ArrayBuffer?this.ws.send(z):Array.isArray(z)&&this.ws.send(new Uint8Array(z).buffer)}connect(z,u){try{this.ws=new f(z,{headers:u,protocols:this.protocols})}catch(U){this.ws=new f(z,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(z,u){this.ws.close(z,u)}get isOpen(){return this.ws.readyState===f.OPEN}}},13523:z=>{"use strict";z.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14431:z=>{"use strict";function u(z,U,J){var v=0|z[J];if(v<=0)return[];var f,g=new Array(v);if(J===z.length-1)for(f=0;f<v;++f)g[f]=U;else for(f=0;f<v;++f)g[f]=u(z,U,J+1);return g}z.exports=function(z,U){switch("undefined"===typeof U&&(U=0),typeof z){case"number":if(z>0)return function(z,u){var U,J;for(U=new Array(z),J=0;J<z;++J)U[J]=u;return U}(0|z,U);break;case"object":if("number"===typeof z.length)return u(z,U,0)}return[]}},14389:(z,u,U)=>{z.exports=function(){var z=this;this.components={},this.comps=this.components;var u=this.components,U=1,v={},f=[],g=[],w={timeout:!1,removals:[],multiComps:[]};function P(z,U){var J=u[U],f=v[U],g=f.hash[z];g&&(f.remove(z),J.tv&&(J.multi?(g.forEach((u=>{u&&J.tv(z,u)})),g.length=0):J.tv(z,g)),w.removals.push(f),R())}function R(){w.timeout||(w.timeout=!0,setTimeout(S,1))}function S(){w.timeout=!1,d()}function d(){w.multiComps.length&&function(z){for(var u=0;u<z.length;u++){var{entID:U,data:J}=z[u],v=J.hash[U];if(v){for(var f=0;f<v.length;f++)v[f]||(v.splice(f,1),f--);0===v.length&&(J.remove(U),w.removals.push(J))}}z.length=0}(w.multiComps),w.removals.length&&function(z){for(var u=0;u<z.length;u++){z[u].flush()}z.length=0}(w.removals)}this.Vm=v,this._systems=f,this._renderSystems=g,this.xR=function(u){var J=U++;return Array.isArray(u)&&u.forEach((u=>z.MR(J,u))),J},this.deleteEntity=function(u){return Object.keys(v).forEach((z=>{v[z].hash[u]&&P(u,z)})),z},this.lS=function(z){if(!z)throw new Error("Missing component definition");var U=z.name;if(!U)throw new Error("Component definition must have a name property.");if("string"!==typeof U)throw new Error("Component name must be a string.");if(""===U)throw new Error("Component name must be a non-empty string.");if(v[U])throw new Error("Component ".concat(U," already exists."));var w={};return w.name=U,w.multi=!!z.multi,w.order=isNaN(z.order)?99:z.order,w.stateConstructor=z.stateConstructor||null,w.state=z.state||{},w.rP=z.rP||null,w.tv=z.tv||null,w.system=z.system||null,w.VP=z.VP||null,u[U]=w,v[U]=new J,v[U]._pendingMultiCleanup=!1,v[U]._multiCleanupIDs=w.multi?[]:null,w.system&&(f.push(U),f.sort(((z,U)=>u[z].order-u[U].order))),w.VP&&(g.push(U),g.sort(((z,U)=>u[z].order-u[U].order))),U},this.overwriteComponent=function(z,U){var J=u[z];if(!J)throw new Error("Unknown component: ".concat(z));if(!U)throw new Error("Missing component definition");if(J.name!==U.name)throw new Error("Overwriting component must use the same name property.");var w={};w.name=z,w.multi=!!U.multi,w.order=isNaN(U.order)?99:U.order,w.state=U.state||{},w.rP=U.rP||null,w.tv=U.tv||null,w.system=U.system||null,w.VP=U.VP||null,u[z]=w,v[z]._pendingMultiCleanup=!1,v[z]._multiCleanupIDs=w.multi?[]:null;var P=f.indexOf(z);w.system&&P<0&&f.push(z),!w.system&&P>=0&&f.splice(P,1),f.sort(((z,U)=>u[z].order-u[U].order));var R=g.indexOf(z);w.VP&&R<0&&g.push(z),!w.VP&&R>=0&&g.splice(R,1),g.sort(((z,U)=>u[z].order-u[U].order));var S=w.state;return this.rS(z).forEach((z=>{for(var u in S)u in z||(z[u]=S[u]);w.rP&&w.rP(z.hP,z)})),z},this.deleteComponent=function(U){var J=v[U];if(!J)throw new Error("Unknown component: ".concat(U));J.flush(),J.list.forEach((z=>{z&&P(z.hP||z[0].hP,U)}));var w=f.indexOf(U),R=g.indexOf(U);return w>-1&&f.splice(w,1),R>-1&&g.splice(R,1),v[U].dispose(),delete v[U],delete u[U],z},this.MR=function(z,U,J){var f,g=u[U],w=v[U];if(!w)throw new Error("Unknown component: ".concat(U,"."));if(w.hash[z]&&!g.multi)throw new Error("Entity ".concat(z," already has component: ").concat(U,"."));if(g.stateConstructor){if(!(f=new g.stateConstructor).hasOwnProperty("hP"))throw new Error("Component ".concat(g.name," stateConstructor type does not have property __id"))}else f=Object.assign({},{hP:z},g.state,J);if(f.hP=z,g.multi){var P=w.hash[z];P||(P=[],w.add(z,P)),P.push(f)}else w.add(z,f);return g.rP&&g.rP(z,f),this},this.YR=function(z,u){var U=v[u];if(!U)throw new Error("Unknown component: ".concat(u,"."));return!!U.hash[z]},this.tR=function(u,U){if(!v[U])throw new Error("Unknown component: ".concat(U,"."));return P(u,U),z},this.getState=function(z,u){var U=v[u];if(!U)throw new Error("Unknown component: ".concat(u,"."));return U.hash[z]},this.rS=function(z){var u=v[z];if(!u)throw new Error("Unknown component: ".concat(z,"."));return d(),u.list},this.EA=function(z){if(!v[z])throw new Error("Unknown component: ".concat(z,"."));var u=v[z].hash;return z=>u[z]},this.MA=function(z){if(!v[z])throw new Error("Unknown component: ".concat(z,"."));var u=v[z].hash;return z=>!!u[z]},this.EP=function(U){d();for(var J=0;J<f.length;J++){var g=f[J],w=u[g],P=v[g];w.system(U,P.list),d()}return z},this.render=function(U){d();for(var J=0;J<g.length;J++){var f=g[J],w=u[f],P=v[f];w.VP(U,P.list),d()}return z},this.removeMultiComponent=function(U,J,f){var g=u[J],P=v[J];if(!P)throw new Error("Unknown component: ".concat(J,"."));if(!g.multi)throw new Error("removeMultiComponent called on non-multi component");return function(z,u,U,J){var v=U.hash[z];if(v){var f=v[J];f&&(v[J]=null,u.tv&&u.tv(z,f),w.multiComps.push({entID:z,data:U}),R())}}(U,g,P,f),z}};var J=U(14398)},14398:z=>{function u(z,u){var U=z._map[u];if(delete z.hash[u],delete z._map[u],U===z.list.length-1)z.list.pop();else{var J=z.list.pop();if(z.list[U]=J,null===J||null===J[0]){var v=z.list.length;for(var f in z._map)if(z._map[f]===v)return void(z._map[f]=U)}else{var g=J.hP||J[0].hP;z._map[g]=U}}}z.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(z,u){if("number"===typeof this._map[z]){var U=this._map[z];this.hash[z]=u,this.list[U]=u}else this._map[z]=this.list.length,this.hash[z]=u,this.list.push(u)}remove(z){var u=this._map[z];this.hash[z]=null,this.list[u]=null,this._pendingRemovals.push(z)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var z=0;z<this._pendingRemovals.length;z++){var U=this._pendingRemovals[z];null===this.hash[U]&&u(this,U)}this._pendingRemovals.length=0}}},14757:z=>{"use strict";z.exports=function(z,u,U,J,v,f){var g=+u[0],w=+u[1],P=+u[2],R=+U[0],S=+U[1],d=+U[2],mz=Math.sqrt(R*R+S*S+d*d);if(0===mz)throw new Error("Can't raycast along a zero vector");return function(z,u,U,J,v,f,g,w,P,R){for(var S=0,d=Math.floor,mz=0|d(u),Z=0|d(U),A=0|d(J),E=v>0?1:-1,C=f>0?1:-1,r=g>0?1:-1,M=Math.abs(1/v),T=Math.abs(1/f),X=Math.abs(1/g),h=M<1/0?M*(E>0?mz+1-u:u-mz):1/0,t=T<1/0?T*(C>0?Z+1-U:U-Z):1/0,V=X<1/0?X*(r>0?A+1-J:J-A):1/0,L=-1;S<=w;){var O=z(mz,Z,A);if(O)return P&&(P[0]=u+S*v,P[1]=U+S*f,P[2]=J+S*g),R&&(R[0]=R[1]=R[2]=0,0===L&&(R[0]=-E),1===L&&(R[1]=-C),2===L&&(R[2]=-r)),O;h<t?h<V?(mz+=E,S=h,h+=M,L=0):(A+=r,S=V,V+=X,L=2):t<V?(Z+=C,S=t,t+=T,L=1):(A+=r,S=V,V+=X,L=2)}return P&&(P[0]=u+S*v,P[1]=U+S*f,P[2]=J+S*g),R&&(R[0]=R[1]=R[2]=0),0}(z,g,w,P,R/=mz,S/=mz,d/=mz,J="undefined"===typeof J?64:+J,v,f)}},14780:(z,u,U)=>{"use strict";U.d(u,{d:()=>f});var J=U(832);function v(){this.rZ=!1,this.stopPropagation=!1,this.MZ=!1,this.disabled=!1}class f{constructor(z,u){this.version="0.7.0";var U=Object.assign({},new v,u||{});this.element=z||document,this.rZ=!!U.rZ,this.stopPropagation=!!U.stopPropagation,this.MZ=!!U.MZ,this.disabled=!!U.disabled,this.filterEvents=(z,u)=>!0,this.down=new J.EventEmitter,this.up=new J.EventEmitter,this.state={},this.dS={dx:0,dy:0,wA:0,SS:0,PA:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?w(this):document.addEventListener("DOMContentLoaded",(z=>{w(this)}),{once:!0})}bind(z){for(var u=arguments.length,U=new Array(u>1?u-1:0),J=1;J<u;J++)U[J-1]=arguments[J];U.forEach((u=>{var U=this._keyBindmap[u]||[];U.includes(z)||(U.push(z),this._keyBindmap[u]=U)})),this.state[z]=!!this.state[z],this.pressCount[z]=this.pressCount[z]||0,this.releaseCount[z]=this.releaseCount[z]||0}unbind(z){for(var u in this._keyBindmap){var U=this._keyBindmap[u],J=U.indexOf(z);J>-1&&U.splice(J,1)}}getBindings(){var z={};for(var u in this._keyBindmap){this._keyBindmap[u].forEach((U=>{z[U]=z[U]||[],z[U].push(u)}))}return z}EP(){g(this.dS),g(this.pressCount),g(this.releaseCount)}}function g(z){for(var u in z)z[u]=0}function w(z){window.addEventListener("keydown",A.bind(null,z,!0),!1),window.addEventListener("keyup",A.bind(null,z,!1),!1);var u={passive:!0};z.element.addEventListener("touchstart",d.bind(void 0,z),{passive:!1}),z.element.addEventListener("touchend",Z.bind(void 0,z),u),z.element.addEventListener("mousedown",E.bind(null,z,!0),u),window.document.addEventListener("mouseup",E.bind(null,z,!1),u),z.element.addEventListener("touchmove",C.bind(null,z),u),z.element.addEventListener("mousemove",C.bind(null,z),u),window.PointerEvent,z.element.addEventListener("wheel",r.bind(null,z),u),z.element.addEventListener("contextmenu",M.bind(null,z),!1),window.addEventListener("blur",T.bind(null,z),!1)}var P=0,R=0,S=null;function d(z,u){u.preventDefault(),mz(u)}function mz(z){let u=!1;for(let U=0;U<z.touches.length;++U)if(z.touches[U].identifier===S){u=!0;break}if(!u){const u=z.changedTouches[0];P=u.clientX,R=u.clientY,S=u.identifier}}function Z(z,u){for(var U=u.changedTouches,J=0;J<U.length;++J)U[J].identifier===S&&(S=null)}function A(z,u,U){X(U.code,u,z,U)}function E(z,u,U){if("pointerId"in U)if(u){if(null!==z._touches.currID)return;z._touches.currID=U.pointerId}else{if(z._touches.currID!==U.pointerId)return;z._touches.currID=null}return X("Mouse"+("button"in U?U.button+1:1),u,z,U),!1}function C(z,u){var U=u.movementX||u.mozMovementX||0,J=u.movementY||u.mozMovementY||0;if(u.touches&&0===(U|J)){var v=function(z){mz(z);for(let u=0;u<z.changedTouches.length;++u)if(z.changedTouches[u].identifier==S){const U=z.changedTouches[u],J=[U.clientX-P,U.clientY-R];return P=U.clientX,R=U.clientY,J}return console.error("Did not find touch id ".concat(S)),[0,0]}(u);U=v[0],J=v[1]}z.dS.dx+=U,z.dS.dy+=J}function r(z,u){var U=1;switch(u.deltaMode){case 0:U=1;break;case 1:U=12;break;case 2:U=z.element.clientHeight||window.innerHeight}z.dS.wA+=(u.deltaX||0)*U,z.dS.SS+=(u.deltaY||0)*U,z.dS.PA+=(u.deltaZ||0)*U}function M(z,u){if(!z.MZ)return u.preventDefault(),!1}function T(z){for(var u in z._keyStates)z._keyStates[u]&&(/^Mouse\d/.test(u)||X(u,!1,z,{code:u,note:"sumuo1l7n1",preventDefault:()=>{},stopPropagation:()=>{}}))}function X(z,u,U,J){var v=U._keyBindmap[z];v&&(h(U._keyStates[z],u)&&(U._keyStates[z]=u,v.forEach((z=>{(!U.filterEvents||U.filterEvents(J,z))&&function(z,u,U,J){var v=u?U.pressCount:U.releaseCount;v[z]=(v[z]||0)+1;var f=U._bindPressCount[z]||0;(f+=u?1:-1)<0&&(f=0);U._bindPressCount[z]=f;var g=U.state[z];if(h(g,f)){U.state[z]=f>0;var w=u?U.down:U.up;U.disabled||w.emit(z,J)}}(z,u,U,J)}))),"button"in J||(U.rZ&&!J.defaultPrevented&&J.preventDefault(),U.stopPropagation&&J.stopPropagation()))}function h(z,u){return z?!u:u}},14368:z=>{"use strict";z.exports=function(z){for(var u=new Array(z),U=0;U<z;++U)u[U]=U;return u}},14372:z=>{function u(z){return!!z.constructor&&"function"===typeof z.constructor.isBuffer&&z.constructor.isBuffer(z)}z.exports=function(z){return null!=z&&(u(z)||function(z){return"function"===typeof z.readFloatLE&&"function"===typeof z.slice&&u(z.slice(0,0))}(z)||!!z._isBuffer)}},14761:(z,u,U)=>{"use strict";U.d(u,{e:()=>J});class J{constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Bd=!1,this.Gd=!1,this.Wd=30,this.Id=0,this.vm=!1,this.fullscreen=!1,this.sd=function(z){},this.ld=function(){},this.Um=function(){},this.ff=function(){},this.zm=function(z){},this.onFullscreenChanged=function(z){},R((()=>{!function(z,u){z._nowObject=performance||Date,z._lastTick=0,z._renderAccum=0,z._rt=0,z._frameCB=w.bind(null,z),requestAnimationFrame(z._frameCB),u>0&&(z._intervalCB=g.bind(null,z),z._interval=setInterval(z._intervalCB,Math.max(u,1e3/z.Wd/2)))}(this,u),function(z,u){if(!u)return;var U=!1,J=!1;document.addEventListener("pointerlockchange",(J=>{U=document.pointerLockElement===u,z.zm(U)})),document.addEventListener("fullscreenchange",(U=>{J=document.fullscreenElement===u,z.onFullscreenChanged(J)})),Object.defineProperty(z,"vm",{get:()=>U,set:z=>{z&&!U?P(u):U&&!z&&function(z){z.exitPointerLock&&z.exitPointerLock()}(document)}}),Object.defineProperty(z,"fullscreen",{get:()=>J,set:z=>{z&&!J?u.requestFullscreen():J&&!z&&document.exitFullscreen()}}),u.addEventListener("click",(v=>{z.Bd&&!U&&P(u),z.Gd&&!J&&u.requestFullscreen()}));var v=()=>z.ff();if(window.ResizeObserver){new ResizeObserver(v).observe(u)}else window.addEventListener("resize",v)}(this,z),this.Um()}))}}var v=3,f=20;function g(z){for(var u=1e3/z.Wd,U=z._nowObject.now()+f,J=0;z._nowObject.now()>=z._lastTick+u&&z._nowObject.now()<U&&++J<=v;)z.sd(u),z._lastTick+=u;var g=5*(u+5),w=z._nowObject.now();if(w-z._lastTick>g)for(;w>=z._lastTick+u;)z._lastTick+=u}function w(z){requestAnimationFrame(z._frameCB),g(z);var u=z._nowObject.now(),U=u-z._rt;if(z._rt=u,z.Id>0){z._renderAccum+=U;var J=1e3/z.Id;if(z._renderAccum<J)return;z._renderAccum=Math.min(z._renderAccum-J,J)}var v=1e3/z.Wd,f=(u-z._lastTick)/v;z.ld(U,f,v)}function P(z){z.requestPointerLock&&z.requestPointerLock()}var R=z=>{if("loading"===document.readyState){var u=()=>{document.removeEventListener("readystatechange",u),z()};document.addEventListener("readystatechange",u)}else setTimeout(z,1)}},14360:(z,u,U)=>{var J=U(14368),v=U(14372),f="undefined"!==typeof Float64Array;function g(z,u){return z[0]-u[0]}function w(){var z,u=this.stride,U=new Array(u.length);for(z=0;z<U.length;++z)U[z]=[Math.abs(u[z]),z];U.sort(g);var J=new Array(U.length);for(z=0;z<J.length;++z)J[z]=U[z][1];return J}function P(z,u){var U=["View",u,"d",z].join("");u<0&&(U="View_Nil"+z);var v="generic"===z;if(-1===u){var f="function "+U+"(a){this.data=a;};var proto="+U+".prototype;proto.dtype='"+z+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+U+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+U+"(a){return new "+U+"(a);}";return new Function(f)()}if(0===u){f="function "+U+"(a,d) {this.data = a;this.offset = d};var proto="+U+".prototype;proto.dtype='"+z+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+U+"_copy() {return new "+U+"(this.data,this.offset)};proto.pick=function "+U+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+U+"_get(){return "+(v?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+U+"_set(v){return "+(v?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+U+"(a,b,c,d){return new "+U+"(a,d)}";return new Function("TrivialArray",f)(R[z][0])}f=["'use strict'"];var g=J(u),P=g.map((function(z){return"i"+z})),S="this.offset+"+g.map((function(z){return"this.stride["+z+"]*i"+z})).join("+"),d=g.map((function(z){return"b"+z})).join(","),mz=g.map((function(z){return"c"+z})).join(",");f.push("function "+U+"(a,"+d+","+mz+",d){this.data=a","this.shape=["+d+"]","this.stride=["+mz+"]","this.offset=d|0}","var proto="+U+".prototype","proto.dtype='"+z+"'","proto.dimension="+u),f.push("Object.defineProperty(proto,'size',{get:function "+U+"_size(){return "+g.map((function(z){return"this.shape["+z+"]"})).join("*"),"}})"),1===u?f.push("proto.order=[0]"):(f.push("Object.defineProperty(proto,'order',{get:"),u<4?(f.push("function "+U+"_order(){"),2===u?f.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===u&&f.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):f.push("ORDER})")),f.push("proto.set=function "+U+"_set("+P.join(",")+",v){"),v?f.push("return this.data.set("+S+",v)}"):f.push("return this.data["+S+"]=v}"),f.push("proto.get=function "+U+"_get("+P.join(",")+"){"),v?f.push("return this.data.get("+S+")}"):f.push("return this.data["+S+"]}"),f.push("proto.index=function "+U+"_index(",P.join(),"){return "+S+"}"),f.push("proto.hi=function "+U+"_hi("+P.join(",")+"){return new "+U+"(this.data,"+g.map((function(z){return["(typeof i",z,"!=='number'||i",z,"<0)?this.shape[",z,"]:i",z,"|0"].join("")})).join(",")+","+g.map((function(z){return"this.stride["+z+"]"})).join(",")+",this.offset)}");var Z=g.map((function(z){return"a"+z+"=this.shape["+z+"]"})),A=g.map((function(z){return"c"+z+"=this.stride["+z+"]"}));f.push("proto.lo=function "+U+"_lo("+P.join(",")+"){var b=this.offset,d=0,"+Z.join(",")+","+A.join(","));for(var E=0;E<u;++E)f.push("if(typeof i"+E+"==='number'&&i"+E+">=0){d=i"+E+"|0;b+=c"+E+"*d;a"+E+"-=d}");f.push("return new "+U+"(this.data,"+g.map((function(z){return"a"+z})).join(",")+","+g.map((function(z){return"c"+z})).join(",")+",b)}"),f.push("proto.step=function "+U+"_step("+P.join(",")+"){var "+g.map((function(z){return"a"+z+"=this.shape["+z+"]"})).join(",")+","+g.map((function(z){return"b"+z+"=this.stride["+z+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(E=0;E<u;++E)f.push("if(typeof i"+E+"==='number'){d=i"+E+"|0;if(d<0){c+=b"+E+"*(a"+E+"-1);a"+E+"=ceil(-a"+E+"/d)}else{a"+E+"=ceil(a"+E+"/d)}b"+E+"*=d}");f.push("return new "+U+"(this.data,"+g.map((function(z){return"a"+z})).join(",")+","+g.map((function(z){return"b"+z})).join(",")+",c)}");var C=new Array(u),r=new Array(u);for(E=0;E<u;++E)C[E]="a[i"+E+"]",r[E]="b[i"+E+"]";f.push("proto.transpose=function "+U+"_transpose("+P+"){"+P.map((function(z,u){return z+"=("+z+"===undefined?"+u+":"+z+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+U+"(this.data,"+C.join(",")+","+r.join(",")+",this.offset)}"),f.push("proto.pick=function "+U+"_pick("+P+"){var a=[],b=[],c=this.offset");for(E=0;E<u;++E)f.push("if(typeof i"+E+"==='number'&&i"+E+">=0){c=(c+this.stride["+E+"]*i"+E+")|0}else{a.push(this.shape["+E+"]);b.push(this.stride["+E+"])}");return f.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),f.push("return function construct_"+U+"(data,shape,stride,offset){return new "+U+"(data,"+g.map((function(z){return"shape["+z+"]"})).join(",")+","+g.map((function(z){return"stride["+z+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",f.join("\n"))(R[z],w)}var R={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};z.exports=function(z,u,U,J){if(void 0===z)return(0,R.array[0])([]);"number"===typeof z&&(z=[z]),void 0===u&&(u=[z.length]);var g=u.length;if(void 0===U){U=new Array(g);for(var w=g-1,S=1;w>=0;--w)U[w]=S,S*=u[w]}if(void 0===J){J=0;for(w=0;w<g;++w)U[w]<0&&(J-=(u[w]-1)*U[w])}for(var d=function(z){if(v(z))return"buffer";if(f)switch(Object.prototype.toString.call(z)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(z)?"array":"generic"}(z),mz=R[d];mz.length<=g+1;)mz.push(P(d,mz.length-1));return(0,mz[g+1])(z,u,U,J)}},14520:z=>{var u;self,u=()=>(()=>{"use strict";var z={d:(u,U)=>{for(var J in U)z.o(U,J)&&!z.o(u,J)&&Object.defineProperty(u,J,{enumerable:!0,get:U[J]})},o:(z,u)=>Object.prototype.hasOwnProperty.call(z,u)},u={};z.d(u,{default:()=>D});var U,J=function(z,u){var U=u.x-z.x,J=u.y-z.y;return Math.sqrt(U*U+J*J)},v=function(z){return z*(Math.PI/180)},f=new Map,g=function(z){f.has(z)&&clearTimeout(f.get(z)),f.set(z,setTimeout(z,100))},w=function(z,u,U){for(var J,v=u.split(/[ ,]+/g),f=0;f<v.length;f+=1)J=v[f],z.addEventListener?z.addEventListener(J,U,!1):z.attachEvent&&z.attachEvent(J,U)},P=function(z,u,U){for(var J,v=u.split(/[ ,]+/g),f=0;f<v.length;f+=1)J=v[f],z.removeEventListener?z.removeEventListener(J,U):z.detachEvent&&z.detachEvent(J,U)},R=function(z){return z.preventDefault(),z.type.match(/^touch/)?z.changedTouches:z},S=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},d=function(z,u){u.top||u.right||u.bottom||u.left?(z.style.top=u.top,z.style.right=u.right,z.style.bottom=u.bottom,z.style.left=u.left):(z.style.left=u.x+"px",z.style.top=u.y+"px")},mz=function(z,u,U){var J=Z(z);for(var v in J)if(J.hasOwnProperty(v))if("string"==typeof u)J[v]=u+" "+U;else{for(var f="",g=0,w=u.length;g<w;g+=1)f+=u[g]+" "+U+", ";J[v]=f.slice(0,-2)}return J},Z=function(z){var u={};return u[z]="",["webkit","Moz","o"].forEach((function(U){u[U+z.charAt(0).toUpperCase()+z.slice(1)]=""})),u},A=function(z,u){for(var U in u)u.hasOwnProperty(U)&&(z[U]=u[U]);return z},E=function(z,u){if(z.length)for(var U=0,J=z.length;U<J;U+=1)u(z[U]);else u(z)},C="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,r=window.matchMedia("(any-hover: none)").matches,M=!!("ontouchstart"in window),T=!!window.PointerEvent,X=!!window.MSPointerEvent,h={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},t={start:"mousedown",move:"mousemove",end:"mouseup"},V={};function L(){}C&&!r?U=h:T?U={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:X?U={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:M?(U=h,V=t):U=t,L.prototype.on=function(z,u){var U,J=this,v=z.split(/[ ,]+/g);J._handlers_=J._handlers_||{};for(var f=0;f<v.length;f+=1)U=v[f],J._handlers_[U]=J._handlers_[U]||[],J._handlers_[U].push(u);return J},L.prototype.off=function(z,u){var U=this;return U._handlers_=U._handlers_||{},void 0===z?U._handlers_={}:void 0===u?U._handlers_[z]=null:U._handlers_[z]&&U._handlers_[z].indexOf(u)>=0&&U._handlers_[z].splice(U._handlers_[z].indexOf(u),1),U},L.prototype.trigger=function(z,u){var U,J=this,v=z.split(/[ ,]+/g);J._handlers_=J._handlers_||{};for(var f=0;f<v.length;f+=1)U=v[f],J._handlers_[U]&&J._handlers_[U].length&&J._handlers_[U].forEach((function(z){z.call(J,{type:U,target:J},u)}))},L.prototype.config=function(z){var u=this;u.options=u.defaults||{},z&&(u.options=function(z,u){var U={};for(var J in z)z.hasOwnProperty(J)&&u.hasOwnProperty(J)?U[J]=u[J]:z.hasOwnProperty(J)&&(U[J]=z[J]);return U}(u.options,z))},L.prototype.bindEvt=function(z,u){var J=this;return J._domHandlers_=J._domHandlers_||{},J._domHandlers_[u]=function(){"function"==typeof J["on"+u]?J["on"+u].apply(J,arguments):console.warn('[WARNING] : Missing "on'+u+'" handler.')},w(z,U[u],J._domHandlers_[u]),V[u]&&w(z,V[u],J._domHandlers_[u]),J},L.prototype.unbindEvt=function(z,u){var J=this;return J._domHandlers_=J._domHandlers_||{},P(z,U[u],J._domHandlers_[u]),V[u]&&P(z,V[u],J._domHandlers_[u]),delete J._domHandlers_[u],this};const O=L;function x(z,u){return this.identifier=u.identifier,this.position=u.position,this.frontPosition=u.frontPosition,this.collection=z,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(u),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=x.id,x.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}x.prototype=new O,x.constructor=x,x.id=0,x.prototype.buildEl=function(z){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},x.prototype.stylize=function(){if(this.options.dataOnly)return this;var z=this.options.fadeTime+"ms",u=function(){var z=Z("borderRadius");for(var u in z)z.hasOwnProperty(u)&&(z[u]="50%");return z}(),U=mz("transition","opacity",z),J={};return J.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},J.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},J.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},A(J.el,U),"circle"===this.options.shape&&A(J.back,u),A(J.front,u),this.applyStyles(J),this},x.prototype.applyStyles=function(z){for(var u in this.ui)if(this.ui.hasOwnProperty(u))for(var U in z[u])this.ui[u].style[U]=z[u][U];return this},x.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},x.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},x.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},x.prototype.show=function(z){var u=this;return u.options.dataOnly||(clearTimeout(u.removeTimeout),clearTimeout(u.showTimeout),clearTimeout(u.restTimeout),u.addToDom(),u.restCallback(),setTimeout((function(){u.ui.el.style.opacity=1}),0),u.showTimeout=setTimeout((function(){u.trigger("shown",u.instance),"function"==typeof z&&z.call(this)}),u.options.fadeTime)),u},x.prototype.hide=function(z){var u=this;if(u.options.dataOnly)return u;if(u.ui.el.style.opacity=u.options.restOpacity,clearTimeout(u.removeTimeout),clearTimeout(u.showTimeout),clearTimeout(u.restTimeout),u.removeTimeout=setTimeout((function(){var U="dynamic"===u.options.mode?"none":"block";u.ui.el.style.display=U,"function"==typeof z&&z.call(u),u.trigger("hidden",u.instance)}),u.options.fadeTime),u.options.restJoystick){var U=u.options.restJoystick,J={};J.x=!0===U||!1!==U.x?0:u.instance.frontPosition.x,J.y=!0===U||!1!==U.y?0:u.instance.frontPosition.y,u.setPosition(z,J)}return u},x.prototype.setPosition=function(z,u){var U=this;U.frontPosition={x:u.x,y:u.y};var J=U.options.fadeTime+"ms",v={};v.front=mz("transition",["transform"],J);var f={front:{}};f.front={transform:"translate("+U.frontPosition.x+"px,"+U.frontPosition.y+"px)"},U.applyStyles(v),U.applyStyles(f),U.restTimeout=setTimeout((function(){"function"==typeof z&&z.call(U),U.restCallback()}),U.options.fadeTime)},x.prototype.restCallback=function(){var z=this,u={};u.front=mz("transition","none",""),z.applyStyles(u),z.trigger("rested",z.instance)},x.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},x.prototype.computeDirection=function(z){var u,U,J,v=z.angle.radian,f=Math.PI/4,g=Math.PI/2;if(v>f&&v<3*f&&!z.lockX?u="up":v>-f&&v<=f&&!z.lockY?u="left":v>3*-f&&v<=-f&&!z.lockX?u="down":z.lockY||(u="right"),z.lockY||(U=v>-g&&v<g?"left":"right"),z.lockX||(J=v>0?"up":"down"),z.force>this.options.threshold){var w,P={};for(w in this.direction)this.direction.hasOwnProperty(w)&&(P[w]=this.direction[w]);var R={};for(w in this.direction={x:U,y:J,angle:u},z.direction=this.direction,P)P[w]===this.direction[w]&&(R[w]=!0);if(R.x&&R.y&&R.angle)return z;R.x&&R.y||this.trigger("plain",z),R.x||this.trigger("plain:"+U,z),R.y||this.trigger("plain:"+J,z),R.angle||this.trigger("dir dir:"+u,z)}else this.resetDirection();return z};const Q=x;function K(z,u){var U=this;U.nipples=[],U.idles=[],U.actives=[],U.ids=[],U.pressureIntervals={},U.manager=z,U.id=K.id,K.id+=1,U.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},U.config(u),"static"!==U.options.mode&&"semi"!==U.options.mode||(U.options.multitouch=!1),U.options.multitouch||(U.options.maxNumberOfNipples=1);var J=getComputedStyle(U.options.zone.parentElement);return J&&"flex"===J.display&&(U.parentIsFlex=!0),U.updateBox(),U.prepareNipples(),U.TZ(),U.begin(),U.nipples}K.prototype=new O,K.constructor=K,K.id=0,K.prototype.prepareNipples=function(){var z=this,u=z.nipples;u.on=z.on.bind(z),u.off=z.off.bind(z),u.options=z.options,u.destroy=z.destroy.bind(z),u.ids=z.ids,u.id=z.id,u.processOnMove=z.processOnMove.bind(z),u.processOnEnd=z.processOnEnd.bind(z),u.get=function(z){if(void 0===z)return u[0];for(var U=0,J=u.length;U<J;U+=1)if(u[U].identifier===z)return u[U];return!1}},K.prototype.TZ=function(){var z=this;z.bindEvt(z.options.zone,"start"),z.options.zone.style.touchAction="none",z.options.zone.style.msTouchAction="none"},K.prototype.begin=function(){var z=this,u=z.options;if("static"===u.mode){var U=z.createNipple(u.position,z.manager.getIdentifier());U.add(),z.idles.push(U)}},K.prototype.createNipple=function(z,u){var U=this,J=U.manager.scroll,v={},f=U.options,g=U.parentIsFlex?J.x:J.x+U.box.left,w=U.parentIsFlex?J.y:J.y+U.box.top;if(z.x&&z.y)v={x:z.x-g,y:z.y-w};else if(z.top||z.right||z.bottom||z.left){var P=document.createElement("DIV");P.style.display="hidden",P.style.top=z.top,P.style.right=z.right,P.style.bottom=z.bottom,P.style.left=z.left,P.style.position="absolute",f.zone.appendChild(P);var R=P.getBoundingClientRect();f.zone.removeChild(P),v=z,z={x:R.left+J.x,y:R.top+J.y}}var S=new Q(U,{color:f.color,size:f.size,threshold:f.threshold,fadeTime:f.fadeTime,dataOnly:f.dataOnly,restJoystick:f.restJoystick,restOpacity:f.restOpacity,mode:f.mode,identifier:u,position:z,zone:f.zone,frontPosition:{x:0,y:0},shape:f.shape});return f.dataOnly||(d(S.ui.el,v),d(S.ui.front,S.frontPosition)),U.nipples.push(S),U.trigger("added "+S.identifier+":added",S),U.manager.trigger("added "+S.identifier+":added",S),U.bindNipple(S),S},K.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},K.prototype.bindNipple=function(z){var u,U=this,J=function(z,J){u=z.type+" "+J.id+":"+z.type,U.trigger(u,J)};z.on("destroyed",U.onDestroyed.bind(U)),z.on("shown hidden rested dir plain",J),z.on("dir:up dir:right dir:down dir:left",J),z.on("plain:up plain:right plain:down plain:left",J)},K.prototype.pressureFn=function(z,u,U){var J=this,v=0;clearInterval(J.pressureIntervals[U]),J.pressureIntervals[U]=setInterval(function(){var U=z.force||z.pressure||z.webkitForce||0;U!==v&&(u.trigger("pressure",U),J.trigger("pressure "+u.identifier+":pressure",U),v=U)}.bind(J),100)},K.prototype.onstart=function(z){var u=this,U=u.options,J=z;return z=R(z),u.updateBox(),E(z,(function(v){u.actives.length<U.maxNumberOfNipples?u.processOnStart(v):J.type.match(/^touch/)&&(Object.keys(u.manager.ids).forEach((function(U){if(Object.values(J.touches).findIndex((function(z){return z.identifier===U}))<0){var v=[z[0]];v.identifier=U,u.processOnEnd(v)}})),u.actives.length<U.maxNumberOfNipples&&u.processOnStart(v))})),u.manager.bindDocument(),!1},K.prototype.processOnStart=function(z){var u,U=this,v=U.options,f=U.manager.getIdentifier(z),g=z.force||z.pressure||z.webkitForce||0,w={x:z.pageX,y:z.pageY},P=U.getOrCreate(f,w);P.identifier!==f&&U.manager.removeIdentifier(P.identifier),P.identifier=f;var R=function(u){u.trigger("start",u),U.trigger("start "+u.id+":start",u),u.show(),g>0&&U.pressureFn(z,u,u.identifier),U.processOnMove(z)};if((u=U.idles.indexOf(P))>=0&&U.idles.splice(u,1),U.actives.push(P),U.ids.push(P.identifier),"semi"!==v.mode)R(P);else{if(!(J(w,P.position)<=v.catchDistance))return P.destroy(),void U.processOnStart(z);R(P)}return P},K.prototype.getOrCreate=function(z,u){var U,J=this,v=J.options;return/(semi|static)/.test(v.mode)?(U=J.idles[0])?(J.idles.splice(0,1),U):"semi"===v.mode?J.createNipple(u,z):(console.warn("Coudln't find the needed nipple."),!1):U=J.createNipple(u,z)},K.prototype.processOnMove=function(z){var u=this,U=u.options,f=u.manager.getIdentifier(z),g=u.nipples.get(f),w=u.manager.scroll;if(function(z){return isNaN(z.buttons)?0!==z.pressure:0!==z.buttons}(z)){if(!g)return console.error("Found zombie joystick with ID "+f),void u.manager.removeIdentifier(f);if(U.dynamicPage){var P=g.el.getBoundingClientRect();g.position={x:w.x+P.left,y:w.y+P.top}}g.identifier=f;var R=g.options.size/2,S={x:z.pageX,y:z.pageY};U.lockX&&(S.y=g.position.y),U.lockY&&(S.x=g.position.x);var d,mz,Z,A,E,C,r,M,T,X,h=J(S,g.position),t=(d=S,Z=(mz=g.position).x-d.x,A=mz.y-d.y,function(z){return z*(180/Math.PI)}(Math.atan2(A,Z))),V=v(t),L=h/R,O={distance:h,position:S};if("circle"===g.options.shape?(E=Math.min(h,R),r=g.position,M=E,X={x:0,y:0},T=v(T=t),X.x=r.x-M*Math.cos(T),X.y=r.y-M*Math.sin(T),C=X):(C=function(z,u,U){return{x:Math.min(Math.max(z.x,u.x-U),u.x+U),y:Math.min(Math.max(z.y,u.y-U),u.y+U)}}(S,g.position,R),E=J(C,g.position)),U.follow){if(h>R){var x=S.x-C.x,Q=S.y-C.y;g.position.x+=x,g.position.y+=Q,g.el.style.top=g.position.y-(u.box.top+w.y)+"px",g.el.style.left=g.position.x-(u.box.left+w.x)+"px",h=J(S,g.position)}}else S=C,h=E;var K=S.x-g.position.x,Y=S.y-g.position.y;g.frontPosition={x:K,y:Y},U.dataOnly||(g.ui.front.style.transform="translate("+K+"px,"+Y+"px)");var p={identifier:g.identifier,position:S,force:L,pressure:z.force||z.pressure||z.webkitForce||0,distance:h,angle:{radian:V,degree:t},vector:{x:K/R,y:-Y/R},raw:O,instance:g,lockX:U.lockX,lockY:U.lockY};(p=g.computeDirection(p)).angle={radian:v(180-t),degree:180-t},g.trigger("move",p),u.trigger("move "+g.id+":move",p)}else this.processOnEnd(z)},K.prototype.processOnEnd=function(z){var u=this,U=u.options,J=u.manager.getIdentifier(z),v=u.nipples.get(J),f=u.manager.removeIdentifier(v.identifier);v&&(U.dataOnly||v.hide((function(){"dynamic"===U.mode&&(v.trigger("removed",v),u.trigger("removed "+v.id+":removed",v),u.manager.trigger("removed "+v.id+":removed",v),v.destroy())})),clearInterval(u.pressureIntervals[v.identifier]),v.resetDirection(),v.trigger("end",v),u.trigger("end "+v.id+":end",v),u.ids.indexOf(v.identifier)>=0&&u.ids.splice(u.ids.indexOf(v.identifier),1),u.actives.indexOf(v)>=0&&u.actives.splice(u.actives.indexOf(v),1),/(semi|static)/.test(U.mode)?u.idles.push(v):u.nipples.indexOf(v)>=0&&u.nipples.splice(u.nipples.indexOf(v),1),u.manager.unbindDocument(),/(semi|static)/.test(U.mode)&&(u.manager.ids[f.id]=f.identifier))},K.prototype.onDestroyed=function(z,u){var U=this;U.nipples.indexOf(u)>=0&&U.nipples.splice(U.nipples.indexOf(u),1),U.actives.indexOf(u)>=0&&U.actives.splice(U.actives.indexOf(u),1),U.idles.indexOf(u)>=0&&U.idles.splice(U.idles.indexOf(u),1),U.ids.indexOf(u.identifier)>=0&&U.ids.splice(U.ids.indexOf(u.identifier),1),U.manager.removeIdentifier(u.identifier),U.manager.unbindDocument()},K.prototype.destroy=function(){var z=this;for(var u in z.unbindEvt(z.options.zone,"start"),z.nipples.forEach((function(z){z.destroy()})),z.pressureIntervals)z.pressureIntervals.hasOwnProperty(u)&&clearInterval(z.pressureIntervals[u]);z.trigger("destroyed",z.nipples),z.manager.unbindDocument(),z.off()};const Y=K;function p(z){var u=this;u.ids={},u.index=0,u.collections=[],u.scroll=S(),u.config(z),u.prepareCollections();var U=function(){var z;u.collections.forEach((function(U){U.forEach((function(U){z=U.el.getBoundingClientRect(),U.position={x:u.scroll.x+z.left,y:u.scroll.y+z.top}}))}))};w(window,"resize",(function(){g(U)}));var J=function(){u.scroll=S()};return w(window,"scroll",(function(){g(J)})),u.collections}p.prototype=new O,p.constructor=p,p.prototype.prepareCollections=function(){var z=this;z.collections.create=z.create.bind(z),z.collections.on=z.on.bind(z),z.collections.off=z.off.bind(z),z.collections.destroy=z.destroy.bind(z),z.collections.get=function(u){var U;return z.collections.every((function(z){return!(U=z.get(u))})),U}},p.prototype.create=function(z){return this.createCollection(z)},p.prototype.createCollection=function(z){var u=this,U=new Y(u,z);return u.bindCollection(U),u.collections.push(U),U},p.prototype.bindCollection=function(z){var u,U=this,J=function(z,J){u=z.type+" "+J.id+":"+z.type,U.trigger(u,J)};z.on("destroyed",U.onDestroyed.bind(U)),z.on("shown hidden rested dir plain",J),z.on("dir:up dir:right dir:down dir:left",J),z.on("plain:up plain:right plain:down plain:left",J)},p.prototype.bindDocument=function(){var z=this;z.binded||(z.bindEvt(document,"move").bindEvt(document,"end"),z.binded=!0)},p.prototype.unbindDocument=function(z){var u=this;Object.keys(u.ids).length&&!0!==z||(u.unbindEvt(document,"move").unbindEvt(document,"end"),u.binded=!1)},p.prototype.getIdentifier=function(z){var u;return z?void 0===(u=void 0===z.identifier?z.pointerId:z.identifier)&&(u=this.latest||0):u=this.index,void 0===this.ids[u]&&(this.ids[u]=this.index,this.index+=1),this.latest=u,this.ids[u]},p.prototype.removeIdentifier=function(z){var u={};for(var U in this.ids)if(this.ids[U]===z){u.id=U,u.identifier=this.ids[U],delete this.ids[U];break}return u},p.prototype.onmove=function(z){return this.onAny("move",z),!1},p.prototype.onend=function(z){return this.onAny("end",z),!1},p.prototype.oncancel=function(z){return this.onAny("end",z),!1},p.prototype.onAny=function(z,u){var U,J=this,v="processOn"+z.charAt(0).toUpperCase()+z.slice(1);u=R(u);var f=function(z,u,U){U.ids.indexOf(u)>=0&&(U[v](z),z._found_=!0)};return E(u,(function(z){U=J.getIdentifier(z),E(J.collections,f.bind(null,z,U)),z._found_||J.removeIdentifier(U)})),!1},p.prototype.destroy=function(){var z=this;z.unbindDocument(!0),z.ids={},z.index=0,z.collections.forEach((function(z){z.destroy()})),z.off()},p.prototype.onDestroyed=function(z,u){var U=this;if(U.collections.indexOf(u)<0)return!1;U.collections.splice(U.collections.indexOf(u),1)};var N=new p;const D={create:function(z){return N.create(z)},factory:N};return u.default})(),z.exports=u()},14576:(z,u,U)=>{"use strict";const{Deflate:J,deflate:v,deflateRaw:f,gzip:g}=U(14583),{Inflate:w,inflate:P,inflateRaw:R,ungzip:S}=U(14645),d=U(14616);z.exports.Deflate=J,z.exports.deflate=v,z.exports.deflateRaw=f,z.exports.gzip=g,z.exports.Inflate=w,z.exports.inflate=P,z.exports.inflateRaw=R,z.exports.ungzip=S,z.exports.constants=d},14583:(z,u,U)=>{"use strict";const J=U(14590),v=U(14623),f=U(14630),g=U(14611),w=U(14636),P=Object.prototype.toString,{Z_NO_FLUSH:R,Z_SYNC_FLUSH:S,Z_FULL_FLUSH:d,Z_FINISH:mz,Z_OK:Z,Z_STREAM_END:A,Z_DEFAULT_COMPRESSION:E,Z_DEFAULT_STRATEGY:C,Z_DEFLATED:r}=U(14616);function M(z){this.options=v.assign({level:E,method:r,Fz:16384,windowBits:15,memLevel:8,strategy:C},z||{});let u=this.options;u.raw&&u.windowBits>0?u.windowBits=-u.windowBits:u.gzip&&u.windowBits>0&&u.windowBits<16&&(u.windowBits+=16),this.err=0,this.Su="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;let U=J.deflateInit2(this.strm,u.level,u.method,u.windowBits,u.memLevel,u.strategy);if(U!==Z)throw new Error(g[U]);if(u.header&&J.deflateSetHeader(this.strm,u.header),u.dictionary){let z;if(z="string"===typeof u.dictionary?f.string2buf(u.dictionary):"[object ArrayBuffer]"===P.call(u.dictionary)?new Uint8Array(u.dictionary):u.dictionary,U=J.deflateSetDictionary(this.strm,z),U!==Z)throw new Error(g[U]);this._dict_set=!0}}function T(z,u){const U=new M(u);if(U.push(z,!0),U.err)throw U.Su||g[U.err];return U.result}M.prototype.push=function(z,u){const U=this.strm,v=this.options.Fz;let g,w;if(this.ended)return!1;for(w=u===~~u?u:!0===u?mz:R,"string"===typeof z?U.input=f.string2buf(z):"[object ArrayBuffer]"===P.call(z)?U.input=new Uint8Array(z):U.input=z,U.next_in=0,U.avail_in=U.input.length;;)if(0===U.avail_out&&(U.output=new Uint8Array(v),U.next_out=0,U.avail_out=v),(w===S||w===d)&&U.avail_out<=6)this.onData(U.output.subarray(0,U.next_out)),U.avail_out=0;else{if(g=J.deflate(U,w),g===A)return U.next_out>0&&this.onData(U.output.subarray(0,U.next_out)),g=J.deflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===Z;if(0!==U.avail_out){if(w>0&&U.next_out>0)this.onData(U.output.subarray(0,U.next_out)),U.avail_out=0;else if(0===U.avail_in)break}else this.onData(U.output)}return!0},M.prototype.onData=function(z){this.chunks.push(z)},M.prototype.onEnd=function(z){z===Z&&(this.result=v.flattenChunks(this.chunks)),this.chunks=[],this.err=z,this.Su=this.strm.Su},z.exports.Deflate=M,z.exports.deflate=T,z.exports.deflateRaw=function(z,u){return(u=u||{}).raw=!0,T(z,u)},z.exports.gzip=function(z,u){return(u=u||{}).gzip=!0,T(z,u)},z.exports.constants=U(14616)},14645:(z,u,U)=>{"use strict";const J=U(14650),v=U(14623),f=U(14630),g=U(14611),w=U(14636),P=U(14665),R=Object.prototype.toString,{Z_NO_FLUSH:S,Z_FINISH:d,Z_OK:mz,Z_STREAM_END:Z,Z_NEED_DICT:A,Z_STREAM_ERROR:E,Z_DATA_ERROR:C,Z_MEM_ERROR:r}=U(14616);function M(z){this.options=v.assign({Fz:65536,windowBits:15,to:""},z||{});const u=this.options;u.raw&&u.windowBits>=0&&u.windowBits<16&&(u.windowBits=-u.windowBits,0===u.windowBits&&(u.windowBits=-15)),!(u.windowBits>=0&&u.windowBits<16)||z&&z.windowBits||(u.windowBits+=32),u.windowBits>15&&u.windowBits<48&&0===(15&u.windowBits)&&(u.windowBits|=15),this.err=0,this.Su="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;let U=J.inflateInit2(this.strm,u.windowBits);if(U!==mz)throw new Error(g[U]);if(this.header=new P,J.inflateGetHeader(this.strm,this.header),u.dictionary&&("string"===typeof u.dictionary?u.dictionary=f.string2buf(u.dictionary):"[object ArrayBuffer]"===R.call(u.dictionary)&&(u.dictionary=new Uint8Array(u.dictionary)),u.raw&&(U=J.inflateSetDictionary(this.strm,u.dictionary),U!==mz)))throw new Error(g[U])}function T(z,u){const U=new M(u);if(U.push(z),U.err)throw U.Su||g[U.err];return U.result}M.prototype.push=function(z,u){const U=this.strm,v=this.options.Fz,g=this.options.dictionary;let w,P,M;if(this.ended)return!1;for(P=u===~~u?u:!0===u?d:S,"[object ArrayBuffer]"===R.call(z)?U.input=new Uint8Array(z):U.input=z,U.next_in=0,U.avail_in=U.input.length;;){for(0===U.avail_out&&(U.output=new Uint8Array(v),U.next_out=0,U.avail_out=v),w=J.inflate(U,P),w===A&&g&&(w=J.inflateSetDictionary(U,g),w===mz?w=J.inflate(U,P):w===C&&(w=A));U.avail_in>0&&w===Z&&U.state.wrap>0&&0!==z[U.next_in];)J.inflateReset(U),w=J.inflate(U,P);switch(w){case E:case C:case A:case r:return this.onEnd(w),this.ended=!0,!1}if(M=U.avail_out,U.next_out&&(0===U.avail_out||w===Z))if("string"===this.options.to){let z=f.utf8border(U.output,U.next_out),u=U.next_out-z,J=f.buf2string(U.output,z);U.next_out=u,U.avail_out=v-u,u&&U.output.set(U.output.subarray(z,z+u),0),this.onData(J)}else this.onData(U.output.length===U.next_out?U.output:U.output.subarray(0,U.next_out));if(w!==mz||0!==M){if(w===Z)return w=J.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,!0;if(0===U.avail_in)break}}return!0},M.prototype.onData=function(z){this.chunks.push(z)},M.prototype.onEnd=function(z){z===mz&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=v.flattenChunks(this.chunks)),this.chunks=[],this.err=z,this.Su=this.strm.Su},z.exports.Inflate=M,z.exports.inflate=T,z.exports.inflateRaw=function(z,u){return(u=u||{}).raw=!0,T(z,u)},z.exports.ungzip=T,z.exports.constants=U(14616)},14623:z=>{"use strict";const u=(z,u)=>Object.prototype.hasOwnProperty.call(z,u);z.exports.assign=function(z){const U=Array.prototype.slice.call(arguments,1);for(;U.length;){const J=U.shift();if(J){if("object"!==typeof J)throw new TypeError(J+"must be non-object");for(const U in J)u(J,U)&&(z[U]=J[U])}}return z},z.exports.flattenChunks=z=>{let u=0;for(let J=0,v=z.length;J<v;J++)u+=z[J].length;const U=new Uint8Array(u);for(let J=0,v=0,f=z.length;J<f;J++){let u=z[J];U.set(u,v),v+=u.length}return U}},14630:z=>{"use strict";let u=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(J){u=!1}const U=new Uint8Array(256);for(let v=0;v<256;v++)U[v]=v>=252?6:v>=248?5:v>=240?4:v>=224?3:v>=192?2:1;U[254]=U[254]=1,z.exports.string2buf=z=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(z);let u,U,J,v,f,g=z.length,w=0;for(v=0;v<g;v++)U=z.charCodeAt(v),55296===(64512&U)&&v+1<g&&(J=z.charCodeAt(v+1),56320===(64512&J)&&(U=65536+(U-55296<<10)+(J-56320),v++)),w+=U<128?1:U<2048?2:U<65536?3:4;for(u=new Uint8Array(w),f=0,v=0;f<w;v++)U=z.charCodeAt(v),55296===(64512&U)&&v+1<g&&(J=z.charCodeAt(v+1),56320===(64512&J)&&(U=65536+(U-55296<<10)+(J-56320),v++)),U<128?u[f++]=U:U<2048?(u[f++]=192|U>>>6,u[f++]=128|63&U):U<65536?(u[f++]=224|U>>>12,u[f++]=128|U>>>6&63,u[f++]=128|63&U):(u[f++]=240|U>>>18,u[f++]=128|U>>>12&63,u[f++]=128|U>>>6&63,u[f++]=128|63&U);return u};z.exports.buf2string=(z,J)=>{const v=J||z.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(z.subarray(0,J));let f,g;const w=new Array(2*v);for(g=0,f=0;f<v;){let u=z[f++];if(u<128){w[g++]=u;continue}let J=U[u];if(J>4)w[g++]=65533,f+=J-1;else{for(u&=2===J?31:3===J?15:7;J>1&&f<v;)u=u<<6|63&z[f++],J--;J>1?w[g++]=65533:u<65536?w[g++]=u:(u-=65536,w[g++]=55296|u>>10&1023,w[g++]=56320|1023&u)}}return((z,U)=>{if(U<65534&&z.subarray&&u)return String.fromCharCode.apply(null,z.length===U?z:z.subarray(0,U));let J="";for(let u=0;u<U;u++)J+=String.fromCharCode(z[u]);return J})(w,g)},z.exports.utf8border=(z,u)=>{(u=u||z.length)>z.length&&(u=z.length);let J=u-1;for(;J>=0&&128===(192&z[J]);)J--;return J<0||0===J?u:J+U[z[J]]>u?J:u}},14600:z=>{"use strict";z.exports=(z,u,U,J)=>{let v=65535&z,f=z>>>16&65535,g=0;for(;0!==U;){g=U>2e3?2e3:U,U-=g;do{v=v+u[J++]|0,f=f+v|0}while(--g);v%=65521,f%=65521}return v|f<<16}},14616:z=>{"use strict";z.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},14603:z=>{"use strict";const u=new Uint32Array((()=>{let z,u=[];for(var U=0;U<256;U++){z=U;for(var J=0;J<8;J++)z=1&z?3988292384^z>>>1:z>>>1;u[U]=z}return u})());z.exports=(z,U,J,v)=>{const f=u,g=v+J;z^=-1;for(let u=v;u<g;u++)z=z>>>8^f[255&(z^U[u])];return~z}},14590:(z,u,U)=>{"use strict";const{_tr_init:J,_tr_stored_block:v,_tr_flush_block:f,_tr_tally:g,_tr_align:w}=U(14595),P=U(14600),R=U(14603),S=U(14611),{Z_NO_FLUSH:d,Z_PARTIAL_FLUSH:mz,Z_FULL_FLUSH:Z,Z_FINISH:A,Z_BLOCK:E,Z_OK:C,Z_STREAM_END:r,Z_STREAM_ERROR:M,Z_DATA_ERROR:T,Z_BUF_ERROR:X,Z_DEFAULT_COMPRESSION:h,Z_FILTERED:t,Z_HUFFMAN_ONLY:V,Z_RLE:L,Z_FIXED:O,Z_DEFAULT_STRATEGY:x,Z_UNKNOWN:Q,Z_DEFLATED:K}=U(14616),Y=258,p=262,N=103,D=113,c=666,W=(z,u)=>(z.Su=S[u],u),j=z=>(z<<1)-(z>4?9:0),I=z=>{let u=z.length;for(;--u>=0;)z[u]=0};let F=(z,u,U)=>(u<<z.hash_shift^U)&z.hash_mask;const b=z=>{const u=z.state;let U=u.pending;U>z.avail_out&&(U=z.avail_out),0!==U&&(z.output.set(u.pending_buf.subarray(u.pending_out,u.pending_out+U),z.next_out),z.next_out+=U,u.pending_out+=U,z.total_out+=U,z.avail_out-=U,u.pending-=U,0===u.pending&&(u.pending_out=0))},k=(z,u)=>{f(z,z.block_start>=0?z.block_start:-1,z.strstart-z.block_start,u),z.block_start=z.strstart,b(z.strm)},B=(z,u)=>{z.pending_buf[z.pending++]=u},y=(z,u)=>{z.pending_buf[z.pending++]=u>>>8&255,z.pending_buf[z.pending++]=255&u},H=(z,u,U,J)=>{let v=z.avail_in;return v>J&&(v=J),0===v?0:(z.avail_in-=v,u.set(z.input.subarray(z.next_in,z.next_in+v),U),1===z.state.wrap?z.adler=P(z.adler,u,v,U):2===z.state.wrap&&(z.adler=R(z.adler,u,v,U)),z.next_in+=v,z.total_in+=v,v)},G=(z,u)=>{let U,J,v=z.max_chain_length,f=z.strstart,g=z.prev_length,w=z.nice_match;const P=z.strstart>z.w_size-p?z.strstart-(z.w_size-p):0,R=z.window,S=z.w_mask,d=z.prev,mz=z.strstart+Y;let Z=R[f+g-1],A=R[f+g];z.prev_length>=z.good_match&&(v>>=2),w>z.lookahead&&(w=z.lookahead);do{if(U=u,R[U+g]===A&&R[U+g-1]===Z&&R[U]===R[f]&&R[++U]===R[f+1]){f+=2,U++;do{}while(R[++f]===R[++U]&&R[++f]===R[++U]&&R[++f]===R[++U]&&R[++f]===R[++U]&&R[++f]===R[++U]&&R[++f]===R[++U]&&R[++f]===R[++U]&&R[++f]===R[++U]&&f<mz);if(J=Y-(mz-f),f=mz-Y,J>g){if(z.match_start=u,g=J,J>=w)break;Z=R[f+g-1],A=R[f+g]}}}while((u=d[u&S])>P&&0!==--v);return g<=z.lookahead?g:z.lookahead},a=z=>{const u=z.w_size;let U,J,v,f,g;do{if(f=z.window_size-z.lookahead-z.strstart,z.strstart>=u+(u-p)){z.window.set(z.window.subarray(u,u+u),0),z.match_start-=u,z.strstart-=u,z.block_start-=u,J=z.hash_size,U=J;do{v=z.head[--U],z.head[U]=v>=u?v-u:0}while(--J);J=u,U=J;do{v=z.prev[--U],z.prev[U]=v>=u?v-u:0}while(--J);f+=u}if(0===z.strm.avail_in)break;if(J=H(z.strm,z.window,z.strstart+z.lookahead,f),z.lookahead+=J,z.lookahead+z.insert>=3)for(g=z.strstart-z.insert,z.ins_h=z.window[g],z.ins_h=F(z,z.ins_h,z.window[g+1]);z.insert&&(z.ins_h=F(z,z.ins_h,z.window[g+3-1]),z.prev[g&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=g,g++,z.insert--,!(z.lookahead+z.insert<3)););}while(z.lookahead<p&&0!==z.strm.avail_in)},i=(z,u)=>{let U,J;for(;;){if(z.lookahead<p){if(a(z),z.lookahead<p&&u===d)return 1;if(0===z.lookahead)break}if(U=0,z.lookahead>=3&&(z.ins_h=F(z,z.ins_h,z.window[z.strstart+3-1]),U=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),0!==U&&z.strstart-U<=z.w_size-p&&(z.match_length=G(z,U)),z.match_length>=3)if(J=g(z,z.strstart-z.match_start,z.match_length-3),z.lookahead-=z.match_length,z.match_length<=z.max_lazy_match&&z.lookahead>=3){z.match_length--;do{z.strstart++,z.ins_h=F(z,z.ins_h,z.window[z.strstart+3-1]),U=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart}while(0!==--z.match_length);z.strstart++}else z.strstart+=z.match_length,z.match_length=0,z.ins_h=z.window[z.strstart],z.ins_h=F(z,z.ins_h,z.window[z.strstart+1]);else J=g(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++;if(J&&(k(z,!1),0===z.strm.avail_out))return 1}return z.insert=z.strstart<2?z.strstart:2,u===A?(k(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(k(z,!1),0===z.strm.avail_out)?1:2},n=(z,u)=>{let U,J,v;for(;;){if(z.lookahead<p){if(a(z),z.lookahead<p&&u===d)return 1;if(0===z.lookahead)break}if(U=0,z.lookahead>=3&&(z.ins_h=F(z,z.ins_h,z.window[z.strstart+3-1]),U=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),z.prev_length=z.match_length,z.prev_match=z.match_start,z.match_length=2,0!==U&&z.prev_length<z.max_lazy_match&&z.strstart-U<=z.w_size-p&&(z.match_length=G(z,U),z.match_length<=5&&(z.strategy===t||3===z.match_length&&z.strstart-z.match_start>4096)&&(z.match_length=2)),z.prev_length>=3&&z.match_length<=z.prev_length){v=z.strstart+z.lookahead-3,J=g(z,z.strstart-1-z.prev_match,z.prev_length-3),z.lookahead-=z.prev_length-1,z.prev_length-=2;do{++z.strstart<=v&&(z.ins_h=F(z,z.ins_h,z.window[z.strstart+3-1]),U=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart)}while(0!==--z.prev_length);if(z.match_available=0,z.match_length=2,z.strstart++,J&&(k(z,!1),0===z.strm.avail_out))return 1}else if(z.match_available){if(J=g(z,0,z.window[z.strstart-1]),J&&k(z,!1),z.strstart++,z.lookahead--,0===z.strm.avail_out)return 1}else z.match_available=1,z.strstart++,z.lookahead--}return z.match_available&&(J=g(z,0,z.window[z.strstart-1]),z.match_available=0),z.insert=z.strstart<2?z.strstart:2,u===A?(k(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(k(z,!1),0===z.strm.avail_out)?1:2};function q(z,u,U,J,v){this.good_length=z,this.max_lazy=u,this.nice_length=U,this.max_chain=J,this.func=v}const o=[new q(0,0,0,0,((z,u)=>{let U=65535;for(U>z.pending_buf_size-5&&(U=z.pending_buf_size-5);;){if(z.lookahead<=1){if(a(z),0===z.lookahead&&u===d)return 1;if(0===z.lookahead)break}z.strstart+=z.lookahead,z.lookahead=0;const J=z.block_start+U;if((0===z.strstart||z.strstart>=J)&&(z.lookahead=z.strstart-J,z.strstart=J,k(z,!1),0===z.strm.avail_out))return 1;if(z.strstart-z.block_start>=z.w_size-p&&(k(z,!1),0===z.strm.avail_out))return 1}return z.insert=0,u===A?(k(z,!0),0===z.strm.avail_out?3:4):(z.strstart>z.block_start&&(k(z,!1),z.strm.avail_out),1)})),new q(4,4,8,4,i),new q(4,5,16,8,i),new q(4,6,32,32,i),new q(4,4,16,16,n),new q(8,16,32,32,n),new q(8,16,128,128,n),new q(8,32,128,256,n),new q(32,128,258,1024,n),new q(32,258,258,4096,n)];function s(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=K,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),I(this.dyn_ltree),I(this.dyn_dtree),I(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),I(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),I(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const l=z=>{if(!z||!z.state)return W(z,M);z.total_in=z.total_out=0,z.data_type=Q;const u=z.state;return u.pending=0,u.pending_out=0,u.wrap<0&&(u.wrap=-u.wrap),u.status=u.wrap?42:D,z.adler=2===u.wrap?0:1,u.last_flush=d,J(u),C},e=z=>{const u=l(z);var U;return u===C&&((U=z.state).window_size=2*U.w_size,I(U.head),U.max_lazy_match=o[U.level].max_lazy,U.good_match=o[U.level].good_length,U.nice_match=o[U.level].nice_length,U.max_chain_length=o[U.level].max_chain,U.strstart=0,U.block_start=0,U.lookahead=0,U.insert=0,U.match_length=U.prev_length=2,U.match_available=0,U.ins_h=0),u},zz=(z,u,U,J,v,f)=>{if(!z)return M;let g=1;if(u===h&&(u=6),J<0?(g=0,J=-J):J>15&&(g=2,J-=16),v<1||v>9||U!==K||J<8||J>15||u<0||u>9||f<0||f>O)return W(z,M);8===J&&(J=9);const w=new s;return z.state=w,w.strm=z,w.wrap=g,w.gzhead=null,w.w_bits=J,w.w_size=1<<w.w_bits,w.w_mask=w.w_size-1,w.hash_bits=v+7,w.hash_size=1<<w.hash_bits,w.hash_mask=w.hash_size-1,w.hash_shift=~~((w.hash_bits+3-1)/3),w.window=new Uint8Array(2*w.w_size),w.head=new Uint16Array(w.hash_size),w.prev=new Uint16Array(w.w_size),w.lit_bufsize=1<<v+6,w.pending_buf_size=4*w.lit_bufsize,w.pending_buf=new Uint8Array(w.pending_buf_size),w.d_buf=1*w.lit_bufsize,w.l_buf=3*w.lit_bufsize,w.level=u,w.strategy=f,w.method=U,e(z)};z.exports.deflateInit=(z,u)=>zz(z,u,K,15,8,x),z.exports.deflateInit2=zz,z.exports.deflateReset=e,z.exports.deflateResetKeep=l,z.exports.deflateSetHeader=(z,u)=>z&&z.state?2!==z.state.wrap?M:(z.state.gzhead=u,C):M,z.exports.deflate=(z,u)=>{let U,J;if(!z||!z.state||u>E||u<0)return z?W(z,M):M;const f=z.state;if(!z.output||!z.input&&0!==z.avail_in||f.status===c&&u!==A)return W(z,0===z.avail_out?X:M);f.strm=z;const P=f.last_flush;if(f.last_flush=u,42===f.status)if(2===f.wrap)z.adler=0,B(f,31),B(f,139),B(f,8),f.gzhead?(B(f,(f.gzhead.text?1:0)+(f.gzhead.hcrc?2:0)+(f.gzhead.extra?4:0)+(f.gzhead.name?8:0)+(f.gzhead.comment?16:0)),B(f,255&f.gzhead.time),B(f,f.gzhead.time>>8&255),B(f,f.gzhead.time>>16&255),B(f,f.gzhead.time>>24&255),B(f,9===f.level?2:f.strategy>=V||f.level<2?4:0),B(f,255&f.gzhead.os),f.gzhead.extra&&f.gzhead.extra.length&&(B(f,255&f.gzhead.extra.length),B(f,f.gzhead.extra.length>>8&255)),f.gzhead.hcrc&&(z.adler=R(z.adler,f.pending_buf,f.pending,0)),f.gzindex=0,f.status=69):(B(f,0),B(f,0),B(f,0),B(f,0),B(f,0),B(f,9===f.level?2:f.strategy>=V||f.level<2?4:0),B(f,3),f.status=D);else{let u=K+(f.w_bits-8<<4)<<8,U=-1;U=f.strategy>=V||f.level<2?0:f.level<6?1:6===f.level?2:3,u|=U<<6,0!==f.strstart&&(u|=32),u+=31-u%31,f.status=D,y(f,u),0!==f.strstart&&(y(f,z.adler>>>16),y(f,65535&z.adler)),z.adler=1}if(69===f.status)if(f.gzhead.extra){for(U=f.pending;f.gzindex<(65535&f.gzhead.extra.length)&&(f.pending!==f.pending_buf_size||(f.gzhead.hcrc&&f.pending>U&&(z.adler=R(z.adler,f.pending_buf,f.pending-U,U)),b(z),U=f.pending,f.pending!==f.pending_buf_size));)B(f,255&f.gzhead.extra[f.gzindex]),f.gzindex++;f.gzhead.hcrc&&f.pending>U&&(z.adler=R(z.adler,f.pending_buf,f.pending-U,U)),f.gzindex===f.gzhead.extra.length&&(f.gzindex=0,f.status=73)}else f.status=73;if(73===f.status)if(f.gzhead.name){U=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>U&&(z.adler=R(z.adler,f.pending_buf,f.pending-U,U)),b(z),U=f.pending,f.pending===f.pending_buf_size)){J=1;break}J=f.gzindex<f.gzhead.name.length?255&f.gzhead.name.charCodeAt(f.gzindex++):0,B(f,J)}while(0!==J);f.gzhead.hcrc&&f.pending>U&&(z.adler=R(z.adler,f.pending_buf,f.pending-U,U)),0===J&&(f.gzindex=0,f.status=91)}else f.status=91;if(91===f.status)if(f.gzhead.comment){U=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>U&&(z.adler=R(z.adler,f.pending_buf,f.pending-U,U)),b(z),U=f.pending,f.pending===f.pending_buf_size)){J=1;break}J=f.gzindex<f.gzhead.comment.length?255&f.gzhead.comment.charCodeAt(f.gzindex++):0,B(f,J)}while(0!==J);f.gzhead.hcrc&&f.pending>U&&(z.adler=R(z.adler,f.pending_buf,f.pending-U,U)),0===J&&(f.status=N)}else f.status=N;if(f.status===N&&(f.gzhead.hcrc?(f.pending+2>f.pending_buf_size&&b(z),f.pending+2<=f.pending_buf_size&&(B(f,255&z.adler),B(f,z.adler>>8&255),z.adler=0,f.status=D)):f.status=D),0!==f.pending){if(b(z),0===z.avail_out)return f.last_flush=-1,C}else if(0===z.avail_in&&j(u)<=j(P)&&u!==A)return W(z,X);if(f.status===c&&0!==z.avail_in)return W(z,X);if(0!==z.avail_in||0!==f.lookahead||u!==d&&f.status!==c){let U=f.strategy===V?((z,u)=>{let U;for(;;){if(0===z.lookahead&&(a(z),0===z.lookahead)){if(u===d)return 1;break}if(z.match_length=0,U=g(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,U&&(k(z,!1),0===z.strm.avail_out))return 1}return z.insert=0,u===A?(k(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(k(z,!1),0===z.strm.avail_out)?1:2})(f,u):f.strategy===L?((z,u)=>{let U,J,v,f;const w=z.window;for(;;){if(z.lookahead<=Y){if(a(z),z.lookahead<=Y&&u===d)return 1;if(0===z.lookahead)break}if(z.match_length=0,z.lookahead>=3&&z.strstart>0&&(v=z.strstart-1,J=w[v],J===w[++v]&&J===w[++v]&&J===w[++v])){f=z.strstart+Y;do{}while(J===w[++v]&&J===w[++v]&&J===w[++v]&&J===w[++v]&&J===w[++v]&&J===w[++v]&&J===w[++v]&&J===w[++v]&&v<f);z.match_length=Y-(f-v),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=3?(U=g(z,1,z.match_length-3),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):(U=g(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),U&&(k(z,!1),0===z.strm.avail_out))return 1}return z.insert=0,u===A?(k(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(k(z,!1),0===z.strm.avail_out)?1:2})(f,u):o[f.level].func(f,u);if(3!==U&&4!==U||(f.status=c),1===U||3===U)return 0===z.avail_out&&(f.last_flush=-1),C;if(2===U&&(u===mz?w(f):u!==E&&(v(f,0,0,!1),u===Z&&(I(f.head),0===f.lookahead&&(f.strstart=0,f.block_start=0,f.insert=0))),b(z),0===z.avail_out))return f.last_flush=-1,C}return u!==A?C:f.wrap<=0?r:(2===f.wrap?(B(f,255&z.adler),B(f,z.adler>>8&255),B(f,z.adler>>16&255),B(f,z.adler>>24&255),B(f,255&z.total_in),B(f,z.total_in>>8&255),B(f,z.total_in>>16&255),B(f,z.total_in>>24&255)):(y(f,z.adler>>>16),y(f,65535&z.adler)),b(z),f.wrap>0&&(f.wrap=-f.wrap),0!==f.pending?C:r)},z.exports.deflateEnd=z=>{if(!z||!z.state)return M;const u=z.state.status;return 42!==u&&69!==u&&73!==u&&91!==u&&u!==N&&u!==D&&u!==c?W(z,M):(z.state=null,u===D?W(z,T):C)},z.exports.deflateSetDictionary=(z,u)=>{let U=u.length;if(!z||!z.state)return M;const J=z.state,v=J.wrap;if(2===v||1===v&&42!==J.status||J.lookahead)return M;if(1===v&&(z.adler=P(z.adler,u,U,0)),J.wrap=0,U>=J.w_size){0===v&&(I(J.head),J.strstart=0,J.block_start=0,J.insert=0);let z=new Uint8Array(J.w_size);z.set(u.subarray(U-J.w_size,U),0),u=z,U=J.w_size}const f=z.avail_in,g=z.next_in,w=z.input;for(z.avail_in=U,z.next_in=0,z.input=u,a(J);J.lookahead>=3;){let z=J.strstart,u=J.lookahead-2;do{J.ins_h=F(J,J.ins_h,J.window[z+3-1]),J.prev[z&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=z,z++}while(--u);J.strstart=z,J.lookahead=2,a(J)}return J.strstart+=J.lookahead,J.block_start=J.strstart,J.insert=J.lookahead,J.lookahead=0,J.match_length=J.prev_length=2,J.match_available=0,z.next_in=g,z.input=w,z.avail_in=f,J.wrap=v,C},z.exports.deflateInfo="pako deflate (from Nodeca project)"},14665:z=>{"use strict";z.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},14656:z=>{"use strict";z.exports=function(z,u){let U,J,v,f,g,w,P,R,S,d,mz,Z,A,E,C,r,M,T,X,h,t,V,L,O;const x=z.state;U=z.next_in,L=z.input,J=U+(z.avail_in-5),v=z.next_out,O=z.output,f=v-(u-z.avail_out),g=v+(z.avail_out-257),w=x.dmax,P=x.wsize,R=x.whave,S=x.wnext,d=x.window,mz=x.hold,Z=x.bits,A=x.lencode,E=x.distcode,C=(1<<x.lenbits)-1,r=(1<<x.distbits)-1;z:do{Z<15&&(mz+=L[U++]<<Z,Z+=8,mz+=L[U++]<<Z,Z+=8),M=A[mz&C];u:for(;;){if(T=M>>>24,mz>>>=T,Z-=T,T=M>>>16&255,0===T)O[v++]=65535&M;else{if(!(16&T)){if(0===(64&T)){M=A[(65535&M)+(mz&(1<<T)-1)];continue u}if(32&T){x.mode=12;break z}z.Su="invalid literal/length code",x.mode=30;break z}X=65535&M,T&=15,T&&(Z<T&&(mz+=L[U++]<<Z,Z+=8),X+=mz&(1<<T)-1,mz>>>=T,Z-=T),Z<15&&(mz+=L[U++]<<Z,Z+=8,mz+=L[U++]<<Z,Z+=8),M=E[mz&r];U:for(;;){if(T=M>>>24,mz>>>=T,Z-=T,T=M>>>16&255,!(16&T)){if(0===(64&T)){M=E[(65535&M)+(mz&(1<<T)-1)];continue U}z.Su="invalid distance code",x.mode=30;break z}if(h=65535&M,T&=15,Z<T&&(mz+=L[U++]<<Z,Z+=8,Z<T&&(mz+=L[U++]<<Z,Z+=8)),h+=mz&(1<<T)-1,h>w){z.Su="invalid distance too far back",x.mode=30;break z}if(mz>>>=T,Z-=T,T=v-f,h>T){if(T=h-T,T>R&&x.sane){z.Su="invalid distance too far back",x.mode=30;break z}if(t=0,V=d,0===S){if(t+=P-T,T<X){X-=T;do{O[v++]=d[t++]}while(--T);t=v-h,V=O}}else if(S<T){if(t+=P+S-T,T-=S,T<X){X-=T;do{O[v++]=d[t++]}while(--T);if(t=0,S<X){T=S,X-=T;do{O[v++]=d[t++]}while(--T);t=v-h,V=O}}}else if(t+=S-T,T<X){X-=T;do{O[v++]=d[t++]}while(--T);t=v-h,V=O}for(;X>2;)O[v++]=V[t++],O[v++]=V[t++],O[v++]=V[t++],X-=3;X&&(O[v++]=V[t++],X>1&&(O[v++]=V[t++]))}else{t=v-h;do{O[v++]=O[t++],O[v++]=O[t++],O[v++]=O[t++],X-=3}while(X>2);X&&(O[v++]=O[t++],X>1&&(O[v++]=O[t++]))}break}}break}}while(U<J&&v<g);X=Z>>3,U-=X,Z-=X<<3,mz&=(1<<Z)-1,z.next_in=U,z.next_out=v,z.avail_in=U<J?J-U+5:5-(U-J),z.avail_out=v<g?g-v+257:257-(v-g),x.hold=mz,x.bits=Z}},14650:(z,u,U)=>{"use strict";const J=U(14600),v=U(14603),f=U(14656),g=U(14659),{Z_FINISH:w,Z_BLOCK:P,Z_TREES:R,Z_OK:S,Z_STREAM_END:d,Z_NEED_DICT:mz,Z_STREAM_ERROR:Z,Z_DATA_ERROR:A,Z_MEM_ERROR:E,Z_BUF_ERROR:C,Z_DEFLATED:r}=U(14616),M=12,T=30,X=z=>(z>>>24&255)+(z>>>8&65280)+((65280&z)<<8)+((255&z)<<24);function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const t=z=>{if(!z||!z.state)return Z;const u=z.state;return z.total_in=z.total_out=u.total=0,z.Su="",u.wrap&&(z.adler=1&u.wrap),u.mode=1,u.last=0,u.havedict=0,u.dmax=32768,u.head=null,u.hold=0,u.bits=0,u.lencode=u.lendyn=new Int32Array(852),u.distcode=u.distdyn=new Int32Array(592),u.sane=1,u.back=-1,S},V=z=>{if(!z||!z.state)return Z;const u=z.state;return u.wsize=0,u.whave=0,u.wnext=0,t(z)},L=(z,u)=>{let U;if(!z||!z.state)return Z;const J=z.state;return u<0?(U=0,u=-u):(U=1+(u>>4),u<48&&(u&=15)),u&&(u<8||u>15)?Z:(null!==J.window&&J.wbits!==u&&(J.window=null),J.wrap=U,J.wbits=u,V(z))},O=(z,u)=>{if(!z)return Z;const U=new h;z.state=U,U.window=null;const J=L(z,u);return J!==S&&(z.state=null),J};let x,Q,K=!0;const Y=z=>{if(K){x=new Int32Array(512),Q=new Int32Array(32);let u=0;for(;u<144;)z.lens[u++]=8;for(;u<256;)z.lens[u++]=9;for(;u<280;)z.lens[u++]=7;for(;u<288;)z.lens[u++]=8;for(g(1,z.lens,0,288,x,0,z.work,{bits:9}),u=0;u<32;)z.lens[u++]=5;g(2,z.lens,0,32,Q,0,z.work,{bits:5}),K=!1}z.lencode=x,z.lenbits=9,z.distcode=Q,z.distbits=5},p=(z,u,U,J)=>{let v;const f=z.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new Uint8Array(f.wsize)),J>=f.wsize?(f.window.set(u.subarray(U-f.wsize,U),0),f.wnext=0,f.whave=f.wsize):(v=f.wsize-f.wnext,v>J&&(v=J),f.window.set(u.subarray(U-J,U-J+v),f.wnext),(J-=v)?(f.window.set(u.subarray(U-J,U),0),f.wnext=J,f.whave=f.wsize):(f.wnext+=v,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=v))),0};z.exports.inflateReset=V,z.exports.inflateReset2=L,z.exports.inflateResetKeep=t,z.exports.inflateInit=z=>O(z,15),z.exports.inflateInit2=O,z.exports.inflate=(z,u)=>{let U,h,t,V,L,O,x,Q,K,N,D,c,W,j,I,F,b,k,B,y,H,G,a=0;const i=new Uint8Array(4);let n,q;const o=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!z||!z.state||!z.output||!z.input&&0!==z.avail_in)return Z;U=z.state,U.mode===M&&(U.mode=13),L=z.next_out,t=z.output,x=z.avail_out,V=z.next_in,h=z.input,O=z.avail_in,Q=U.hold,K=U.bits,N=O,D=x,G=S;z:for(;;)switch(U.mode){case 1:if(0===U.wrap){U.mode=13;break}for(;K<16;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}if(2&U.wrap&&35615===Q){U.check=0,i[0]=255&Q,i[1]=Q>>>8&255,U.check=v(U.check,i,2,0),Q=0,K=0,U.mode=2;break}if(U.flags=0,U.head&&(U.head.done=!1),!(1&U.wrap)||(((255&Q)<<8)+(Q>>8))%31){z.Su="incorrect header check",U.mode=T;break}if((15&Q)!==r){z.Su="unknown compression method",U.mode=T;break}if(Q>>>=4,K-=4,H=8+(15&Q),0===U.wbits)U.wbits=H;else if(H>U.wbits){z.Su="invalid window size",U.mode=T;break}U.dmax=1<<U.wbits,z.adler=U.check=1,U.mode=512&Q?10:M,Q=0,K=0;break;case 2:for(;K<16;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}if(U.flags=Q,(255&U.flags)!==r){z.Su="unknown compression method",U.mode=T;break}if(57344&U.flags){z.Su="unknown header flags set",U.mode=T;break}U.head&&(U.head.text=Q>>8&1),512&U.flags&&(i[0]=255&Q,i[1]=Q>>>8&255,U.check=v(U.check,i,2,0)),Q=0,K=0,U.mode=3;case 3:for(;K<32;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}U.head&&(U.head.time=Q),512&U.flags&&(i[0]=255&Q,i[1]=Q>>>8&255,i[2]=Q>>>16&255,i[3]=Q>>>24&255,U.check=v(U.check,i,4,0)),Q=0,K=0,U.mode=4;case 4:for(;K<16;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}U.head&&(U.head.xflags=255&Q,U.head.os=Q>>8),512&U.flags&&(i[0]=255&Q,i[1]=Q>>>8&255,U.check=v(U.check,i,2,0)),Q=0,K=0,U.mode=5;case 5:if(1024&U.flags){for(;K<16;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}U.length=Q,U.head&&(U.head.extra_len=Q),512&U.flags&&(i[0]=255&Q,i[1]=Q>>>8&255,U.check=v(U.check,i,2,0)),Q=0,K=0}else U.head&&(U.head.extra=null);U.mode=6;case 6:if(1024&U.flags&&(c=U.length,c>O&&(c=O),c&&(U.head&&(H=U.head.extra_len-U.length,U.head.extra||(U.head.extra=new Uint8Array(U.head.extra_len)),U.head.extra.set(h.subarray(V,V+c),H)),512&U.flags&&(U.check=v(U.check,h,c,V)),O-=c,V+=c,U.length-=c),U.length))break z;U.length=0,U.mode=7;case 7:if(2048&U.flags){if(0===O)break z;c=0;do{H=h[V+c++],U.head&&H&&U.length<65536&&(U.head.name+=String.fromCharCode(H))}while(H&&c<O);if(512&U.flags&&(U.check=v(U.check,h,c,V)),O-=c,V+=c,H)break z}else U.head&&(U.head.name=null);U.length=0,U.mode=8;case 8:if(4096&U.flags){if(0===O)break z;c=0;do{H=h[V+c++],U.head&&H&&U.length<65536&&(U.head.comment+=String.fromCharCode(H))}while(H&&c<O);if(512&U.flags&&(U.check=v(U.check,h,c,V)),O-=c,V+=c,H)break z}else U.head&&(U.head.comment=null);U.mode=9;case 9:if(512&U.flags){for(;K<16;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}if(Q!==(65535&U.check)){z.Su="header crc mismatch",U.mode=T;break}Q=0,K=0}U.head&&(U.head.hcrc=U.flags>>9&1,U.head.done=!0),z.adler=U.check=0,U.mode=M;break;case 10:for(;K<32;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}z.adler=U.check=X(Q),Q=0,K=0,U.mode=11;case 11:if(0===U.havedict)return z.next_out=L,z.avail_out=x,z.next_in=V,z.avail_in=O,U.hold=Q,U.bits=K,mz;z.adler=U.check=1,U.mode=M;case M:if(u===P||u===R)break z;case 13:if(U.last){Q>>>=7&K,K-=7&K,U.mode=27;break}for(;K<3;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}switch(U.last=1&Q,Q>>>=1,K-=1,3&Q){case 0:U.mode=14;break;case 1:if(Y(U),U.mode=20,u===R){Q>>>=2,K-=2;break z}break;case 2:U.mode=17;break;case 3:z.Su="invalid block type",U.mode=T}Q>>>=2,K-=2;break;case 14:for(Q>>>=7&K,K-=7&K;K<32;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}if((65535&Q)!==(Q>>>16^65535)){z.Su="invalid stored block lengths",U.mode=T;break}if(U.length=65535&Q,Q=0,K=0,U.mode=15,u===R)break z;case 15:U.mode=16;case 16:if(c=U.length,c){if(c>O&&(c=O),c>x&&(c=x),0===c)break z;t.set(h.subarray(V,V+c),L),O-=c,V+=c,x-=c,L+=c,U.length-=c;break}U.mode=M;break;case 17:for(;K<14;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}if(U.nlen=257+(31&Q),Q>>>=5,K-=5,U.ndist=1+(31&Q),Q>>>=5,K-=5,U.ncode=4+(15&Q),Q>>>=4,K-=4,U.nlen>286||U.ndist>30){z.Su="too many length or distance symbols",U.mode=T;break}U.have=0,U.mode=18;case 18:for(;U.have<U.ncode;){for(;K<3;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}U.lens[o[U.have++]]=7&Q,Q>>>=3,K-=3}for(;U.have<19;)U.lens[o[U.have++]]=0;if(U.lencode=U.lendyn,U.lenbits=7,n={bits:U.lenbits},G=g(0,U.lens,0,19,U.lencode,0,U.work,n),U.lenbits=n.bits,G){z.Su="invalid code lengths set",U.mode=T;break}U.have=0,U.mode=19;case 19:for(;U.have<U.nlen+U.ndist;){for(;a=U.lencode[Q&(1<<U.lenbits)-1],I=a>>>24,F=a>>>16&255,b=65535&a,!(I<=K);){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}if(b<16)Q>>>=I,K-=I,U.lens[U.have++]=b;else{if(16===b){for(q=I+2;K<q;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}if(Q>>>=I,K-=I,0===U.have){z.Su="invalid bit length repeat",U.mode=T;break}H=U.lens[U.have-1],c=3+(3&Q),Q>>>=2,K-=2}else if(17===b){for(q=I+3;K<q;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}Q>>>=I,K-=I,H=0,c=3+(7&Q),Q>>>=3,K-=3}else{for(q=I+7;K<q;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}Q>>>=I,K-=I,H=0,c=11+(127&Q),Q>>>=7,K-=7}if(U.have+c>U.nlen+U.ndist){z.Su="invalid bit length repeat",U.mode=T;break}for(;c--;)U.lens[U.have++]=H}}if(U.mode===T)break;if(0===U.lens[256]){z.Su="invalid code -- missing end-of-block",U.mode=T;break}if(U.lenbits=9,n={bits:U.lenbits},G=g(1,U.lens,0,U.nlen,U.lencode,0,U.work,n),U.lenbits=n.bits,G){z.Su="invalid literal/lengths set",U.mode=T;break}if(U.distbits=6,U.distcode=U.distdyn,n={bits:U.distbits},G=g(2,U.lens,U.nlen,U.ndist,U.distcode,0,U.work,n),U.distbits=n.bits,G){z.Su="invalid distances set",U.mode=T;break}if(U.mode=20,u===R)break z;case 20:U.mode=21;case 21:if(O>=6&&x>=258){z.next_out=L,z.avail_out=x,z.next_in=V,z.avail_in=O,U.hold=Q,U.bits=K,f(z,D),L=z.next_out,t=z.output,x=z.avail_out,V=z.next_in,h=z.input,O=z.avail_in,Q=U.hold,K=U.bits,U.mode===M&&(U.back=-1);break}for(U.back=0;a=U.lencode[Q&(1<<U.lenbits)-1],I=a>>>24,F=a>>>16&255,b=65535&a,!(I<=K);){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}if(F&&0===(240&F)){for(k=I,B=F,y=b;a=U.lencode[y+((Q&(1<<k+B)-1)>>k)],I=a>>>24,F=a>>>16&255,b=65535&a,!(k+I<=K);){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}Q>>>=k,K-=k,U.back+=k}if(Q>>>=I,K-=I,U.back+=I,U.length=b,0===F){U.mode=26;break}if(32&F){U.back=-1,U.mode=M;break}if(64&F){z.Su="invalid literal/length code",U.mode=T;break}U.extra=15&F,U.mode=22;case 22:if(U.extra){for(q=U.extra;K<q;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}U.length+=Q&(1<<U.extra)-1,Q>>>=U.extra,K-=U.extra,U.back+=U.extra}U.was=U.length,U.mode=23;case 23:for(;a=U.distcode[Q&(1<<U.distbits)-1],I=a>>>24,F=a>>>16&255,b=65535&a,!(I<=K);){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}if(0===(240&F)){for(k=I,B=F,y=b;a=U.distcode[y+((Q&(1<<k+B)-1)>>k)],I=a>>>24,F=a>>>16&255,b=65535&a,!(k+I<=K);){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}Q>>>=k,K-=k,U.back+=k}if(Q>>>=I,K-=I,U.back+=I,64&F){z.Su="invalid distance code",U.mode=T;break}U.offset=b,U.extra=15&F,U.mode=24;case 24:if(U.extra){for(q=U.extra;K<q;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}U.offset+=Q&(1<<U.extra)-1,Q>>>=U.extra,K-=U.extra,U.back+=U.extra}if(U.offset>U.dmax){z.Su="invalid distance too far back",U.mode=T;break}U.mode=25;case 25:if(0===x)break z;if(c=D-x,U.offset>c){if(c=U.offset-c,c>U.whave&&U.sane){z.Su="invalid distance too far back",U.mode=T;break}c>U.wnext?(c-=U.wnext,W=U.wsize-c):W=U.wnext-c,c>U.length&&(c=U.length),j=U.window}else j=t,W=L-U.offset,c=U.length;c>x&&(c=x),x-=c,U.length-=c;do{t[L++]=j[W++]}while(--c);0===U.length&&(U.mode=21);break;case 26:if(0===x)break z;t[L++]=U.length,x--,U.mode=21;break;case 27:if(U.wrap){for(;K<32;){if(0===O)break z;O--,Q|=h[V++]<<K,K+=8}if(D-=x,z.total_out+=D,U.total+=D,D&&(z.adler=U.check=U.flags?v(U.check,t,D,L-D):J(U.check,t,D,L-D)),D=x,(U.flags?Q:X(Q))!==U.check){z.Su="incorrect data check",U.mode=T;break}Q=0,K=0}U.mode=28;case 28:if(U.wrap&&U.flags){for(;K<32;){if(0===O)break z;O--,Q+=h[V++]<<K,K+=8}if(Q!==(4294967295&U.total)){z.Su="incorrect length check",U.mode=T;break}Q=0,K=0}U.mode=29;case 29:G=d;break z;case T:G=A;break z;case 31:return E;default:return Z}return z.next_out=L,z.avail_out=x,z.next_in=V,z.avail_in=O,U.hold=Q,U.bits=K,(U.wsize||D!==z.avail_out&&U.mode<T&&(U.mode<27||u!==w))&&p(z,z.output,z.next_out,D-z.avail_out)?(U.mode=31,E):(N-=z.avail_in,D-=z.avail_out,z.total_in+=N,z.total_out+=D,U.total+=D,U.wrap&&D&&(z.adler=U.check=U.flags?v(U.check,t,D,z.next_out-D):J(U.check,t,D,z.next_out-D)),z.data_type=U.bits+(U.last?64:0)+(U.mode===M?128:0)+(20===U.mode||15===U.mode?256:0),(0===N&&0===D||u===w)&&G===S&&(G=C),G)},z.exports.inflateEnd=z=>{if(!z||!z.state)return Z;let u=z.state;return u.window&&(u.window=null),z.state=null,S},z.exports.inflateGetHeader=(z,u)=>{if(!z||!z.state)return Z;const U=z.state;return 0===(2&U.wrap)?Z:(U.head=u,u.done=!1,S)},z.exports.inflateSetDictionary=(z,u)=>{const U=u.length;let v,f,g;return z&&z.state?(v=z.state,0!==v.wrap&&11!==v.mode?Z:11===v.mode&&(f=1,f=J(f,u,U,0),f!==v.check)?A:(g=p(z,u,U,U),g?(v.mode=31,E):(v.havedict=1,S))):Z},z.exports.inflateInfo="pako inflate (from Nodeca project)"},14659:z=>{"use strict";const u=15,U=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),J=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),v=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),f=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);z.exports=(z,g,w,P,R,S,d,mz)=>{const Z=mz.bits;let A,E,C,r,M,T,X=0,h=0,t=0,V=0,L=0,O=0,x=0,Q=0,K=0,Y=0,p=null,N=0;const D=new Uint16Array(16),c=new Uint16Array(16);let W,j,I,F=null,b=0;for(X=0;X<=u;X++)D[X]=0;for(h=0;h<P;h++)D[g[w+h]]++;for(L=Z,V=u;V>=1&&0===D[V];V--);if(L>V&&(L=V),0===V)return R[S++]=20971520,R[S++]=20971520,mz.bits=1,0;for(t=1;t<V&&0===D[t];t++);for(L<t&&(L=t),Q=1,X=1;X<=u;X++)if(Q<<=1,Q-=D[X],Q<0)return-1;if(Q>0&&(0===z||1!==V))return-1;for(c[1]=0,X=1;X<u;X++)c[X+1]=c[X]+D[X];for(h=0;h<P;h++)0!==g[w+h]&&(d[c[g[w+h]]++]=h);if(0===z?(p=F=d,T=19):1===z?(p=U,N-=257,F=J,b-=257,T=256):(p=v,F=f,T=-1),Y=0,h=0,X=t,M=S,O=L,x=0,C=-1,K=1<<L,r=K-1,1===z&&K>852||2===z&&K>592)return 1;for(;;){W=X-x,d[h]<T?(j=0,I=d[h]):d[h]>T?(j=F[b+d[h]],I=p[N+d[h]]):(j=96,I=0),A=1<<X-x,E=1<<O,t=E;do{E-=A,R[M+(Y>>x)+E]=W<<24|j<<16|I}while(0!==E);for(A=1<<X-1;Y&A;)A>>=1;if(0!==A?(Y&=A-1,Y+=A):Y=0,h++,0===--D[X]){if(X===V)break;X=g[w+d[h]]}if(X>L&&(Y&r)!==C){for(0===x&&(x=L),M+=t,O=X-x,Q=1<<O;O+x<V&&(Q-=D[O+x],!(Q<=0));)O++,Q<<=1;if(K+=1<<O,1===z&&K>852||2===z&&K>592)return 1;C=Y&r,R[C]=L<<24|O<<16|M-S}}return 0!==Y&&(R[M+Y]=X-x<<24|64<<16),mz.bits=L,0}},14611:z=>{"use strict";z.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},14595:z=>{"use strict";function u(z){let u=z.length;for(;--u>=0;)z[u]=0}const U=256,J=286,v=30,f=15,g=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),w=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),P=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),S=new Array(576);u(S);const d=new Array(60);u(d);const mz=new Array(512);u(mz);const Z=new Array(256);u(Z);const A=new Array(29);u(A);const E=new Array(v);function C(z,u,U,J,v){this.static_tree=z,this.extra_bits=u,this.extra_base=U,this.elems=J,this.max_length=v,this.has_stree=z&&z.length}let r,M,T;function X(z,u){this.dyn_tree=z,this.max_code=0,this.stat_desc=u}u(E);const h=z=>z<256?mz[z]:mz[256+(z>>>7)],t=(z,u)=>{z.pending_buf[z.pending++]=255&u,z.pending_buf[z.pending++]=u>>>8&255},V=(z,u,U)=>{z.bi_valid>16-U?(z.bi_buf|=u<<z.bi_valid&65535,t(z,z.bi_buf),z.bi_buf=u>>16-z.bi_valid,z.bi_valid+=U-16):(z.bi_buf|=u<<z.bi_valid&65535,z.bi_valid+=U)},L=(z,u,U)=>{V(z,U[2*u],U[2*u+1])},O=(z,u)=>{let U=0;do{U|=1&z,z>>>=1,U<<=1}while(--u>0);return U>>>1},x=(z,u,U)=>{const J=new Array(16);let v,g,w=0;for(v=1;v<=f;v++)J[v]=w=w+U[v-1]<<1;for(g=0;g<=u;g++){let u=z[2*g+1];0!==u&&(z[2*g]=O(J[u]++,u))}},Q=z=>{let u;for(u=0;u<J;u++)z.dyn_ltree[2*u]=0;for(u=0;u<v;u++)z.dyn_dtree[2*u]=0;for(u=0;u<19;u++)z.bl_tree[2*u]=0;z.dyn_ltree[512]=1,z.opt_len=z.static_len=0,z.last_lit=z.matches=0},K=z=>{z.bi_valid>8?t(z,z.bi_buf):z.bi_valid>0&&(z.pending_buf[z.pending++]=z.bi_buf),z.bi_buf=0,z.bi_valid=0},Y=(z,u,U,J)=>{const v=2*u,f=2*U;return z[v]<z[f]||z[v]===z[f]&&J[u]<=J[U]},p=(z,u,U)=>{const J=z.heap[U];let v=U<<1;for(;v<=z.heap_len&&(v<z.heap_len&&Y(u,z.heap[v+1],z.heap[v],z.depth)&&v++,!Y(u,J,z.heap[v],z.depth));)z.heap[U]=z.heap[v],U=v,v<<=1;z.heap[U]=J},N=(z,u,J)=>{let v,f,P,R,S=0;if(0!==z.last_lit)do{v=z.pending_buf[z.d_buf+2*S]<<8|z.pending_buf[z.d_buf+2*S+1],f=z.pending_buf[z.l_buf+S],S++,0===v?L(z,f,u):(P=Z[f],L(z,P+U+1,u),R=g[P],0!==R&&(f-=A[P],V(z,f,R)),v--,P=h(v),L(z,P,J),R=w[P],0!==R&&(v-=E[P],V(z,v,R)))}while(S<z.last_lit);L(z,256,u)},D=(z,u)=>{const U=u.dyn_tree,J=u.stat_desc.static_tree,v=u.stat_desc.has_stree,g=u.stat_desc.elems;let w,P,R,S=-1;for(z.heap_len=0,z.heap_max=573,w=0;w<g;w++)0!==U[2*w]?(z.heap[++z.heap_len]=S=w,z.depth[w]=0):U[2*w+1]=0;for(;z.heap_len<2;)R=z.heap[++z.heap_len]=S<2?++S:0,U[2*R]=1,z.depth[R]=0,z.opt_len--,v&&(z.static_len-=J[2*R+1]);for(u.max_code=S,w=z.heap_len>>1;w>=1;w--)p(z,U,w);R=g;do{w=z.heap[1],z.heap[1]=z.heap[z.heap_len--],p(z,U,1),P=z.heap[1],z.heap[--z.heap_max]=w,z.heap[--z.heap_max]=P,U[2*R]=U[2*w]+U[2*P],z.depth[R]=(z.depth[w]>=z.depth[P]?z.depth[w]:z.depth[P])+1,U[2*w+1]=U[2*P+1]=R,z.heap[1]=R++,p(z,U,1)}while(z.heap_len>=2);z.heap[--z.heap_max]=z.heap[1],((z,u)=>{const U=u.dyn_tree,J=u.max_code,v=u.stat_desc.static_tree,g=u.stat_desc.has_stree,w=u.stat_desc.extra_bits,P=u.stat_desc.extra_base,R=u.stat_desc.max_length;let S,d,mz,Z,A,E,C=0;for(Z=0;Z<=f;Z++)z.bl_count[Z]=0;for(U[2*z.heap[z.heap_max]+1]=0,S=z.heap_max+1;S<573;S++)d=z.heap[S],Z=U[2*U[2*d+1]+1]+1,Z>R&&(Z=R,C++),U[2*d+1]=Z,d>J||(z.bl_count[Z]++,A=0,d>=P&&(A=w[d-P]),E=U[2*d],z.opt_len+=E*(Z+A),g&&(z.static_len+=E*(v[2*d+1]+A)));if(0!==C){do{for(Z=R-1;0===z.bl_count[Z];)Z--;z.bl_count[Z]--,z.bl_count[Z+1]+=2,z.bl_count[R]--,C-=2}while(C>0);for(Z=R;0!==Z;Z--)for(d=z.bl_count[Z];0!==d;)mz=z.heap[--S],mz>J||(U[2*mz+1]!==Z&&(z.opt_len+=(Z-U[2*mz+1])*U[2*mz],U[2*mz+1]=Z),d--)}})(z,u),x(U,S,z.bl_count)},c=(z,u,U)=>{let J,v,f=-1,g=u[1],w=0,P=7,R=4;for(0===g&&(P=138,R=3),u[2*(U+1)+1]=65535,J=0;J<=U;J++)v=g,g=u[2*(J+1)+1],++w<P&&v===g||(w<R?z.bl_tree[2*v]+=w:0!==v?(v!==f&&z.bl_tree[2*v]++,z.bl_tree[32]++):w<=10?z.bl_tree[34]++:z.bl_tree[36]++,w=0,f=v,0===g?(P=138,R=3):v===g?(P=6,R=3):(P=7,R=4))},W=(z,u,U)=>{let J,v,f=-1,g=u[1],w=0,P=7,R=4;for(0===g&&(P=138,R=3),J=0;J<=U;J++)if(v=g,g=u[2*(J+1)+1],!(++w<P&&v===g)){if(w<R)do{L(z,v,z.bl_tree)}while(0!==--w);else 0!==v?(v!==f&&(L(z,v,z.bl_tree),w--),L(z,16,z.bl_tree),V(z,w-3,2)):w<=10?(L(z,17,z.bl_tree),V(z,w-3,3)):(L(z,18,z.bl_tree),V(z,w-11,7));w=0,f=v,0===g?(P=138,R=3):v===g?(P=6,R=3):(P=7,R=4)}};let j=!1;const I=(z,u,U,J)=>{V(z,0+(J?1:0),3),((z,u,U,J)=>{K(z),J&&(t(z,U),t(z,~U)),z.pending_buf.set(z.window.subarray(u,u+U),z.pending),z.pending+=U})(z,u,U,!0)};z.exports._tr_init=z=>{j||((()=>{let z,u,U,R,X;const h=new Array(16);for(U=0,R=0;R<28;R++)for(A[R]=U,z=0;z<1<<g[R];z++)Z[U++]=R;for(Z[U-1]=R,X=0,R=0;R<16;R++)for(E[R]=X,z=0;z<1<<w[R];z++)mz[X++]=R;for(X>>=7;R<v;R++)for(E[R]=X<<7,z=0;z<1<<w[R]-7;z++)mz[256+X++]=R;for(u=0;u<=f;u++)h[u]=0;for(z=0;z<=143;)S[2*z+1]=8,z++,h[8]++;for(;z<=255;)S[2*z+1]=9,z++,h[9]++;for(;z<=279;)S[2*z+1]=7,z++,h[7]++;for(;z<=287;)S[2*z+1]=8,z++,h[8]++;for(x(S,287,h),z=0;z<v;z++)d[2*z+1]=5,d[2*z]=O(z,5);r=new C(S,g,257,J,f),M=new C(d,w,0,v,f),T=new C(new Array(0),P,0,19,7)})(),j=!0),z.l_desc=new X(z.dyn_ltree,r),z.d_desc=new X(z.dyn_dtree,M),z.bl_desc=new X(z.bl_tree,T),z.bi_buf=0,z.bi_valid=0,Q(z)},z.exports._tr_stored_block=I,z.exports._tr_flush_block=(z,u,J,v)=>{let f,g,w=0;z.level>0?(2===z.strm.data_type&&(z.strm.data_type=(z=>{let u,J=4093624447;for(u=0;u<=31;u++,J>>>=1)if(1&J&&0!==z.dyn_ltree[2*u])return 0;if(0!==z.dyn_ltree[18]||0!==z.dyn_ltree[20]||0!==z.dyn_ltree[26])return 1;for(u=32;u<U;u++)if(0!==z.dyn_ltree[2*u])return 1;return 0})(z)),D(z,z.l_desc),D(z,z.d_desc),w=(z=>{let u;for(c(z,z.dyn_ltree,z.l_desc.max_code),c(z,z.dyn_dtree,z.d_desc.max_code),D(z,z.bl_desc),u=18;u>=3&&0===z.bl_tree[2*R[u]+1];u--);return z.opt_len+=3*(u+1)+5+5+4,u})(z),f=z.opt_len+3+7>>>3,g=z.static_len+3+7>>>3,g<=f&&(f=g)):f=g=J+5,J+4<=f&&-1!==u?I(z,u,J,v):4===z.strategy||g===f?(V(z,2+(v?1:0),3),N(z,S,d)):(V(z,4+(v?1:0),3),((z,u,U,J)=>{let v;for(V(z,u-257,5),V(z,U-1,5),V(z,J-4,4),v=0;v<J;v++)V(z,z.bl_tree[2*R[v]+1],3);W(z,z.dyn_ltree,u-1),W(z,z.dyn_dtree,U-1)})(z,z.l_desc.max_code+1,z.d_desc.max_code+1,w+1),N(z,z.dyn_ltree,z.dyn_dtree)),Q(z),v&&K(z)},z.exports._tr_tally=(z,u,J)=>(z.pending_buf[z.d_buf+2*z.last_lit]=u>>>8&255,z.pending_buf[z.d_buf+2*z.last_lit+1]=255&u,z.pending_buf[z.l_buf+z.last_lit]=255&J,z.last_lit++,0===u?z.dyn_ltree[2*J]++:(z.matches++,u--,z.dyn_ltree[2*(Z[J]+U+1)]++,z.dyn_dtree[2*h(u)]++),z.last_lit===z.lit_bufsize-1),z.exports._tr_align=z=>{V(z,2,3),L(z,256,S),(z=>{16===z.bi_valid?(t(z,z.bi_buf),z.bi_buf=0,z.bi_valid=0):z.bi_valid>=8&&(z.pending_buf[z.pending++]=255&z.bi_buf,z.bi_buf>>=8,z.bi_valid-=8)})(z)}},14636:z=>{"use strict";z.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Su="",this.state=null,this.data_type=2,this.adler=0}},13665:z=>{function u(z,u,U){for(var J=z.length,v=-1/0,f=1/0,g=0;g<J;g++){var w=(U[0][g]-z[g])/u[g],P=(U[1][g]-z[g])/u[g];if(w>P){var R=w;w=P,P=R}if(P<v||w>f)return 1/0;w>v&&(v=w),P<f&&(f=P)}return v>f?1/0:v}z.exports=function(z,U,J,v){var f=u(U,J,v);if(f===1/0)z=null;else{z=z||[];for(var g=0;g<U.length;g++)z[g]=U[g]+J[g]*f}return z},z.exports.distance=u},14720:(z,u,U)=>{"use strict";U.d(u,{d:()=>g});var J=U(54);const v=J.useLayoutEffect;const f=function(z){var u=(0,J.useRef)(z);return v((function(){u.current=z})),u};var g=function(z){var u=f(z);(0,J.wu)((function(){var z=function(z){var U;if(null!=u.current&&(U=u.current(z)),z.defaultPrevented&&(z.returnValue=""),"string"===typeof U)return z.returnValue=U,U};return window.addEventListener("beforeunload",z),function(){window.removeEventListener("beforeunload",z)}}),[])}},14690:(z,u,U)=>{"use strict";var J=U(14699),v=Array.prototype.concat,f=Array.prototype.slice,g=z.exports=function(z){for(var u=[],U=0,g=z.length;U<g;U++){var w=z[U];J(w)?u=v.call(u,f.call(w)):u.push(w)}return u};g.wrap=function(z){return function(){return z(g(arguments))}}},14699:z=>{z.exports=function(z){return!(!z||"string"===typeof z)&&(z instanceof Array||Array.isArray(z)||z.length>=0&&(z.splice instanceof Function||Object.getOwnPropertyDescriptor(z,z.length-1)&&"String"!==z.constructor.name))}},14510:z=>{"use strict";var u=[],U=[],J=[],v=[],f=[],g=[],w=[],P=[],R=[],S=[],d=[],mz=[];z.exports=function(z,Z,A,E,C,r){for(var M=w,T=R,X=S,h=mz,t=0;t<3;t++)M[t]=+A[t],X[t]=+Z.max[t],T[t]=+Z.base[t];r||(r=1e-10);var V=function(z,w,R,S,mz,Z){var A=u,E=U,C=J,r=v,M=f,T=g,X=P,h=Math.floor,t=0,V=0,L=0,O=0,x=0;if(Q(),0===L)return 0;for(O=p();V<=L;){if(K(O)&&Y())return t;O=p()}for(t+=L,x=0;x<3;x++)S[x]+=R[x],mz[x]+=R[x];return t;function Q(){if(V=0,0!==(L=Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2])))for(var z=0;z<3;z++){var u=R[z]>=0;r[z]=u?1:-1;var U=u?mz[z]:S[z];A[z]=u?S[z]:mz[z],E[z]=N(U,r[z]),C[z]=D(A[z],r[z]),X[z]=R[z]/L,M[z]=Math.abs(1/X[z]);var J=u?E[z]+1-U:U-E[z];T[z]=M[z]<1/0?M[z]*J:1/0}}function K(u){for(var U=r[0],J=0===u?E[0]:C[0],v=E[0]+U,f=r[1],g=1===u?E[1]:C[1],w=E[1]+f,P=r[2],R=2===u?E[2]:C[2],S=E[2]+P,d=J;d!=v;d+=U)for(var mz=g;mz!=w;mz+=f)for(var Z=R;Z!=S;Z+=P)if(z(d,mz,Z))return!0;return!1}function Y(){t+=V;var z=r[O],u=V/L,U=d;for(x=0;x<3;x++){var J=R[x]*u;S[x]+=J,mz[x]+=J,U[x]=R[x]-J}if(z>0?mz[O]=Math.round(mz[O]):S[O]=Math.round(S[O]),w(t,O,z,U))return!0;for(x=0;x<3;x++)R[x]=U[x];return Q(),0===L}function p(){var z=T[0]<T[1]?T[0]<T[2]?0:2:T[1]<T[2]?1:2,u=T[z]-V;for(V=T[z],E[z]+=r[z],T[z]+=M[z],x=0;x<3;x++)A[x]+=u*X[x],C[x]=D(A[x],r[x]);return z}function N(z,u){return h(z-u*Z)}function D(z,u){return h(z+u*Z)}}(z,E,M,T,X,r);if(!C){for(t=0;t<3;t++)h[t]=A[t]>0?X[t]-Z.max[t]:T[t]-Z.base[t];Z.translate(h)}return V}},14554:(z,u,U)=>{var J=U(14561);function v(z){for(var u,U,v=0,f=z.length,g=0;g<z.length;){for(u=z[g],U=0;g<f&&z[g]===u;)++g,++U;v+=J.log2(U)/7|0,v+=J.log2(u>>>0)/7|0,v+=2}return v}u.size=v,u.encode=function(z,u){u||(u=new Uint8Array(v(z)));for(var U,J,f=0,g=u.length,w=0;w<z.length;){for(U=z[w],J=0;w<z.length&&z[w]===U;)++w,++J;for(;f<g&&J>=128;)u[f++]=128+(127&J),J>>>=7;if(f>=g)throw new Error("RLE buffer overflow");for(u[f++]=J,U>>>=0;f<g&&U>=128;)u[f++]=128+(127&U),U>>>=7;if(f>=g)throw new Error("RLE buffer overflow");u[f++]=U}return u},u.decode=function(z,u){for(var U,J,v,f,g=u.length,w=z.length,P=0,R=0;R<w;){for(U=0,J=0;R<w&&z[R]>=128;)U+=(127&z[R++])<<J,J+=7;if(U+=z[R++]<<J,R>=w)throw new Error("RLE buffer underrun");if(P+U>g)throw new Error("Chunk buffer overflow");for(v=0,J=0;R<w&&z[R]>=128;)v+=(127&z[R++])<<J,J+=7;if(R>=w)throw new Error("RLE buffer underrun");for(v+=z[R++]<<J,f=0;f<U;++f)u[P++]=v}return u}},14561:(z,u)=>{"use strict";function U(z){var u=32;return(z&=-z)&&u--,65535&z&&(u-=16),16711935&z&&(u-=8),252645135&z&&(u-=4),858993459&z&&(u-=2),1431655765&z&&(u-=1),u}u.INT_BITS=32,u.INT_MAX=2147483647,u.INT_MIN=-1<<31,u.sign=function(z){return(z>0)-(z<0)},u.abs=function(z){var u=z>>31;return(z^u)-u},u.min=function(z,u){return u^(z^u)&-(z<u)},u.max=function(z,u){return z^(z^u)&-(z<u)},u.isPow2=function(z){return!(z&z-1)&&!!z},u.log2=function(z){var u,U;return u=(z>65535)<<4,u|=U=((z>>>=u)>255)<<3,u|=U=((z>>>=U)>15)<<2,(u|=U=((z>>>=U)>3)<<1)|(z>>>=U)>>1},u.log10=function(z){return z>=1e9?9:z>=1e8?8:z>=1e7?7:z>=1e6?6:z>=1e5?5:z>=1e4?4:z>=1e3?3:z>=100?2:z>=10?1:0},u.popCount=function(z){return 16843009*((z=(858993459&(z-=z>>>1&1431655765))+(z>>>2&858993459))+(z>>>4)&252645135)>>>24},u.countTrailingZeros=U,u.nextPow2=function(z){return z+=0===z,--z,z|=z>>>1,z|=z>>>2,z|=z>>>4,z|=z>>>8,(z|=z>>>16)+1},u.prevPow2=function(z){return z|=z>>>1,z|=z>>>2,z|=z>>>4,z|=z>>>8,(z|=z>>>16)-(z>>>1)},u.parity=function(z){return z^=z>>>16,z^=z>>>8,z^=z>>>4,27030>>>(z&=15)&1};var J=new Array(256);!function(z){for(var u=0;u<256;++u){var U=u,J=u,v=7;for(U>>>=1;U;U>>>=1)J<<=1,J|=1&U,--v;z[u]=J<<v&255}}(J),u.reverse=function(z){return J[255&z]<<24|J[z>>>8&255]<<16|J[z>>>16&255]<<8|J[z>>>24&255]},u.interleave2=function(z,u){return(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z&=65535)|z<<8))|z<<4))|z<<2))|z<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u&=65535)|u<<8))|u<<4))|u<<2))|u<<1))<<1},u.deinterleave2=function(z,u){return(z=65535&((z=16711935&((z=252645135&((z=858993459&((z=z>>>u&1431655765)|z>>>1))|z>>>2))|z>>>4))|z>>>16))<<16>>16},u.interleave3=function(z,u,U){return z=1227133513&((z=3272356035&((z=251719695&((z=4278190335&((z&=1023)|z<<16))|z<<8))|z<<4))|z<<2),(z|=(u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2))<<1)|(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<2},u.deinterleave3=function(z,u){return(z=1023&((z=4278190335&((z=251719695&((z=3272356035&((z=z>>>u&1227133513)|z>>>2))|z>>>4))|z>>>8))|z>>>16))<<22>>22},u.nextCombination=function(z){var u=z|z-1;return u+1|(~u&-~u)-1>>>U(z)+1}},14789:(z,u,U)=>{"use strict";U.d(u,{b:()=>d});var J=U(14503),v=U(152);class f{constructor(z,u,U,f,g,w,P){this.CS=new J(z.base,z.DS),this.YJ=u,this.friction=U,this.restitution=f,this.bw=g,this.xA=w,this.kw=!!P,this.NS=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.mC=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.cR=v.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=v.create(),this._impulses=v.create(),this._sleepFrameCount=10}loadFromCopy(z){v.i(this.CS.base,z.CS.base),v.i(this.CS.DS,z.CS.DS),v.i(this.CS.max,z.CS.max),this.CS.mag=z.CS.mag,this.YJ=z.YJ,this.friction=z.friction,this.restitution=z.restitution,this.bw=z.bw,this.xA=z.xA,this.kw=z.kw,this.NS=z.NS,this.fluidDrag=z.fluidDrag,this.mC=z.mC,this.preventFallOffEdge=z.preventFallOffEdge,this.rolledBackLastTick=z.rolledBackLastTick,v.i(this.cR,z.cR),v.i(this.resting,z.resting),this.inFluid=z.inFluid,this._ratioInFluid=z._ratioInFluid,v.i(this._forces,z._forces),v.i(this._impulses,z._impulses),this._sleepFrameCount=z._sleepFrameCount}setPosition(z){g(z),v.Cu(z,z,this.CS.base),this.CS.translate(z),this.WR()}wf(){return v.clone(this.CS.base)}applyForce(z){g(z),v.add(this._forces,this._forces,z),this.WR()}applyImpulse(z){g(z),v.add(this._impulses,this._impulses,z),this.WR()}WR(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var g=z=>{};var w=U(14503),P=U(152),R=U(14510);function S(){this.NS=.1,this.fluidDrag=.4,this.aw=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function d(z,u,U){z=Object.assign(new S,z),this.gravity=z.gravity||[0,-10,0],this.NS=z.NS||.1,this.aw=z.aw||2,this.fluidDrag=z.fluidDrag||.4,this.minBounceImpulse=z.minBounceImpulse,this.bodies=[],this.sZ=z.sZ,this.testSolid=u,this.testFluid=U}d.prototype.cA=function(z,u,U,J,v,g){z=z||new w([0,0,0],[1,1,1]),"undefined"==typeof u&&(u=1),"undefined"==typeof U&&(U=1),"undefined"==typeof J&&(J=0),"undefined"==typeof v&&(v=1);var P=new f(z,u,U,J,v,g);return this.bodies.push(P),P},d.prototype.WA=function(z){var u=this.bodies.indexOf(z);u<0||(this.bodies.splice(u,1),z.CS=z.xA=null)};var mz=P.create(),Z=P.create(),A=P.create(),E=P.create(),C=P.create(),r=P.create(),M=P.create(),T=new w([0,0,0],[1,1,1]),X=new f(T,1,1,0,1,(()=>{}),!1);function h(z,u,U){return u=U,u*=1-(1-z.ratioInFluid)**2}d.prototype.EP=function(z){z/=1e3;var u=F(0,P.squaredLength(this.gravity));this.bodies.forEach((U=>function(z,u,U,J){P.i(C,u.resting),z.sZ&&X.loadFromCopy(u);if(u.YJ<=0)return P.set(u.cR,0,0,0),P.set(u._forces,0,0,0),void P.set(u._impulses,0,0,0);var v=J||0===u.bw;if(function(z,u,U,J){if(u._sleepFrameCount>0)return!1;if(J)return!0;var v=!1,f=.5*U*U*u.bw;return P.scale(I,z.gravity,f),R(z.testSolid,u.CS,I,(function(){return v=!0,!0}),!0),v}(z,u,U,v))return;u._sleepFrameCount--,function(z,u){var U=u.CS,J=Math.floor(U.base[0]),v=Math.floor(U.base[2]),f=Math.floor(U.base[1]),g=Math.floor(U.max[1]);if(!z.testFluid(J,f,v))return u.inFluid=!1,void(u.ratioInFluid=0);var w=1,R=f+1;for(;R<=g&&z.testFluid(J,R,v);)w++,R++;var S=(f+w-U.base[1])/U.DS[1];S>1&&(S=1);var d=U.DS[0]*U.DS[1]*U.DS[2]*S,mz=V;P.scale(mz,z.gravity,-z.aw*d*u.bw),u.applyForce(mz),u.inFluid=!0,u.ratioInFluid=S}(z,u),k(u._forces),k(u._impulses),k(u.cR),k(u.resting),P.scale(mz,u._forces,1/u.YJ),P.wP(mz,mz,z.gravity,u.bw),P.scale(Z,u._impulses,1/u.YJ),P.wP(Z,Z,mz,U),P.add(u.cR,u.cR,Z),u.friction&&(L(z,0,u,Z,U),L(z,1,u,Z,U),L(z,2,u,Z,U));var f=u.fluidDrag>=0?u.fluidDrag:z.fluidDrag,g=u.NS>=0?u.NS:z.NS,w=g,S=g;u.inFluid&&(w=h(u,w,u.fluidDragHoriz>=0?u.fluidDragHoriz:f),S=h(u,S,u.fluidDragVert>=0?u.fluidDragVert:f));w=Math.max(1-w*U/u.YJ,0),S=Math.max(1-S*U/u.YJ,0),P.set(t,w,S,w),P.multiply(u.cR,u.cR,t),P.scale(A,u.cR,U),P.set(u._forces,0,0,0),P.set(u._impulses,0,0,0),u.kw&&b(Q,u.CS);P.i(r,A),P.set(M,0,0,0),u.preventFallOffEdge&&function(z,u,U,J){if(!u.resting[1]||U[1]>0)return;var v=c;b(v,u.CS);for(var f=0;f<3;f+=2){P.set(D,0,0,0),D[f]=U[f];var g=!0;(g=(g=(g=(g=g&&!j(z,v.base[0]+D[0]+1e-5,v.base[1],v.base[2]+D[2]+1e-5))&&!j(z,v.max[0]+D[0]-1e-5,v.base[1],v.base[2]+D[2]+1e-5))&&!j(z,v.base[0]+D[0]+1e-5,v.base[1],v.max[2]+D[2]-1e-5))&&!j(z,v.max[0]+D[0]-1e-5,v.base[1],v.max[2]+D[2]-1e-5))?(J[f]=U[f]>0?1:-1,U[f]=0):0===f&&(P.set(W,U[0],0,0),x(z,v,W,J,u.slideOnCollision))}}(z,u,A,M);x(z,u.CS,A,u.resting,u.slideOnCollision),u.kw&&function(z,u,U,J){if(u.resting[1]>=0&&!u.inFluid)return;var v=0!==u.resting[0],f=0!==u.resting[2];if(!v&&!f)return;var g=Math.abs(J[0]/J[2]),w=4;if(!v&&g>w)return;if(!f&&g<1/w)return;P.add(Y,U.base,J);var S=z.testSolid;R(S,U,J,(function(z,u,U,J){if(1!==u)return!0;J[u]=0}));var d=U.base[1],mz=u.inFluid?1.951:1.001,Z=Math.floor(d+mz)-d;P.set(p,0,Z,0);var A=!1;if(R(S,U,p,(function(z,u,U,J){return A=!0,!0})),A)return;P.Cu(N,Y,U.base),N[1]=0,x(z,U,N,K,!0);var E=F(U.base[0],Y[0]),C=F(U.base[2],Y[2]);if(v&&!E&&(!C||!f))return;if(f&&(!E||!v)&&!C)return;var r=!0;if(r=r&&!j(z,U.base[0]+1e-5,U.base[1],U.base[2]+1e-5),r=r&&!j(z,U.max[0]-1e-5,U.base[1],U.base[2]+1e-5),r=r&&!j(z,U.base[0]+1e-5,U.base[1],U.max[2]-1e-5),r=r&&!j(z,U.max[0]-1e-5,U.base[1],U.max[2]-1e-5),r)return;b(u.CS,U),u.resting[0]=K[0],u.resting[2]=K[2],u.mC&&u.mC()}(z,u,Q,r);for(var d=0;d<3;++d)u.resting[d]=u.resting[d]||M[d],E[d]=0,u.resting[d]&&(C[d]||(E[d]=-u.cR[d]),u.cR[d]=0);var T=P.length(E);T>.001&&(P.scale(E,E,u.YJ),u.xA&&u.xA(E),u.restitution>0&&T>z.minBounceImpulse&&(P.scale(E,E,u.restitution),u.applyImpulse(E)));var O=P.squaredLength(u.cR);O>1e-5&&u.WR();z.sZ&&z.sZ(u)?(u.loadFromCopy(X),u.rolledBackLastTick=!0):u.rolledBackLastTick=!1}(this,U,z,u)))};var t=P.create([0,0,0]);var V=P.create();function L(z,u,U,J,v){var f=U.resting[u],g=J[u];if(!U.alwaysApplyHorizFriction||1!==u){if(0===f)return;if(f*g<=0)return}P.i(O,U.cR),O[u]=0;var w=P.length(O);if(!F(w,0)){var R=Math.abs(U.friction*z.gravity[u]*v),S=w>R?(w-R)/w:0;U.cR[(u+1)%3]*=S,U.cR[(u+2)%3]*=S}}var O=P.create();function x(z,u,U,J,v){return P.set(J,0,0,0),R(z.testSolid,u,U,(function(z,u,U,f){J[u]=U,f[u]=0,v||(f[0]=0,f[1]=0,f[2]=0)}))}var Q=new w([],[]),K=P.create(),Y=P.create(),p=P.create(),N=P.create();var D=P.create(),c=new w([],[]),W=P.create();function j(z,u,U,J){return z.testSolid(Math.floor(u),Math.floor(U-1),Math.floor(J))}var I=P.create();function F(z,u){return Math.abs(z-u)<1e-5}function b(z,u){for(var U=0;U<3;U++)z.base[U]=u.base[U],z.max[U]=u.max[U],z.DS[U]=u.DS[U]}var k=function(z){}},14567:z=>{"use strict";z.exports=function(z,u,U,J){var v=self||window;try{try{var f;try{f=new v.Blob([z])}catch(R){(f=new(v.BlobBuilder||v.WebKitBlobBuilder||v.MozBlobBuilder||v.MSBlobBuilder)).append(z),f=f.getBlob()}var g=v.URL||v.webkitURL,w=g.createObjectURL(f),P=new v[u](w,U);return g.revokeObjectURL(w),P}catch(R){return new v[u]("data:application/javascript,".concat(encodeURIComponent(z)),U)}}catch(R){if(!J)throw Error("Inline worker is not supported");return new v[u](J,U)}}},13654:(z,u,U)=>{"use strict";function J(z,u,U,J,v){var f={};return Object.keys(J).forEach((function(z){f[z]=J[z]})),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=U.slice().reverse().reduce((function(U,J){return J(z,u,U)||U}),f),v&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(v):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(z,u,f),f=null),f}U.d(u,{c:()=>J})},13645:(z,u,U)=>{"use strict";function J(z,u,U,J){U&&Object.defineProperty(z,u,{enumerable:U.enumerable,configurable:U.configurable,writable:U.writable,value:U.initializer?U.initializer.call(J):void 0})}U.d(u,{b:()=>J})},14729:(z,u,U)=>{"use strict";U.d(u,{b:()=>g,d:()=>d,h:()=>w,j:()=>f,k:()=>P,n:()=>v,o:()=>R,r:()=>S});var J=U(13132);class v{constructor(){this._easingMode=v.EASINGMODE_EASEIN}setEasingMode(z){const u=Math.min(Math.max(z,0),2);this._easingMode=u}getEasingMode(){return this._easingMode}easeInCore(z){throw new Error("You must implement this method")}ease(z){switch(this._easingMode){case v.EASINGMODE_EASEIN:return this.easeInCore(z);case v.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-z)}return z>=.5?.5*(1-this.easeInCore(2*(1-z)))+.5:.5*this.easeInCore(2*z)}}v.EASINGMODE_EASEIN=0,v.EASINGMODE_EASEOUT=1,v.EASINGMODE_EASEINOUT=2;class f extends v{easeInCore(z){return z=Math.max(0,Math.min(1,z)),1-Math.sqrt(1-z*z)}}class g extends v{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=z}easeInCore(z){const u=Math.max(0,this.amplitude);return Math.pow(z,3)-z*u*Math.sin(3.141592653589793*z)}}class w extends v{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=z,this.bounciness=u}easeInCore(z){const u=Math.max(0,this.bounces);let U=this.bounciness;U<=1&&(U=1.001);const J=Math.pow(U,u),v=1-U,f=(1-J)/v+.5*J,g=z*f,w=Math.log(-g*(1-U)+1)/Math.log(U),P=Math.floor(w),R=P+1,S=(1-Math.pow(U,P))/(v*f),d=.5*(S+(1-Math.pow(U,R))/(v*f)),mz=z-d,Z=d-S;return-Math.pow(1/U,u-P)/(Z*Z)*(mz-Z)*(mz+Z)}}class P extends v{easeInCore(z){return z*z*z}}class R extends v{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=z,this.springiness=u}easeInCore(z){let u;const U=Math.max(0,this.oscillations),J=Math.max(0,this.springiness);return u=0==J?z:(Math.exp(J*z)-1)/(Math.exp(J)-1),u*Math.sin((6.283185307179586*U+1.5707963267948966)*z)}}class S extends v{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=z}easeInCore(z){return this.exponent<=0?z:(Math.exp(this.exponent*z)-1)/(Math.exp(this.exponent)-1)}}class d extends v{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=z,this.y1=u,this.x2=U,this.y2=J}easeInCore(z){return J.c.Interpolate(z,this.x1,this.y1,this.x2,this.y2)}}},14123:(z,u,U)=>{"use strict";U.d(u,{b:()=>g});var J=U(12914),v=U(12926),f=U(13318);class g extends f.d{get _matrix(){return this._compose(),this.WZ}set _matrix(z){(z.updateFlag!==this.WZ.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.WZ.v(z),this._markAsDirtyAndDecompose())}constructor(z,u){var U;let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(z,u.Vz(),!1),this.name=z,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=u,this.WZ=null!==(U=null===f||void 0===f?void 0:f.clone())&&void 0!==U?U:J.Matrix.Identity(),this._restMatrix=null!==g&&void 0!==g?g:this.WZ.clone(),this._bindMatrix=null!==w&&void 0!==w?w:this.WZ.clone(),this._index=P,this._absoluteMatrix=new J.Matrix,this._absoluteBindMatrix=new J.Matrix,this._absoluteInverseBindMatrix=new J.Matrix,this._finalMatrix=new J.Matrix,u.bones.push(this),this.setParent(v,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(z){this.setParent(z)}setParent(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==z){if(this.parent){const z=this.parent.children.indexOf(this);-1!==z&&this.parent.children.splice(z,1)}this._parentNode=z,this.parent&&this.parent.children.push(this),u&&this._updateAbsoluteBindMatrices(),this.LS()}}getLocalMatrix(){return this._compose(),this.WZ}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(z){this._restMatrix.v(z)}setRestPose(z){this.setRestMatrix(z)}getBindPose(){return this.getBindMatrix()}setBindMatrix(z){this.Gf(z)}setBindPose(z){this.setBindMatrix(z)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){var z;const u=J.TmpVectors.Eu[0],U=J.TmpVectors.Quaternion[0],v=J.TmpVectors.Eu[1];this.getRestMatrix().decompose(u,U,v),this._linkedTransformNode.position.v(v),this._linkedTransformNode.rotationQuaternion=null!==(z=this._linkedTransformNode.rotationQuaternion)&&void 0!==z?z:J.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.v(U),this._linkedTransformNode.Ug.v(u)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(z){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=z,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.YP}set position(z){this._decompose(),this.YP.v(z),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(z){this.setRotation(z)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(z){this.setRotationQuaternion(z)}get Ug(){return this.getScale()}set Ug(z){this.setScale(z)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=J.Eu.Zero(),this._localRotation=J.Quaternion.Zero(),this.YP=J.Eu.Zero()),this.WZ.decompose(this._localScaling,this._localRotation,this.YP))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,J.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.YP,this.WZ)):this._needToCompose=!1)}Gf(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.v(z),u&&this._updateAbsoluteBindMatrices(),U?this._matrix=z:this.LS()}_updateAbsoluteBindMatrices(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(z||(z=this._bindMatrix),this.parent?z.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.v(z),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),u)for(let U=0;U<this.children.length;U++)this.children[U]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}LS(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.LS(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.LS(),this._needToDecompose=!0}_updatePosition(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const f=this.getLocalMatrix();if(0==u)v?(f.addAtIndex(12,z.x),f.addAtIndex(13,z.y),f.addAtIndex(14,z.z)):f.setTranslationFromFloats(z.x,z.y,z.z);else{let u=null;U&&(u=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const w=g._TmpMats[0],P=g._TmpVecs[0];this.parent?U&&u?(w.v(this.parent.getAbsoluteMatrix()),w.multiplyToRef(u,w)):w.v(this.parent.getAbsoluteMatrix()):J.Matrix.IdentityToRef(w),v&&w.setTranslationFromFloats(0,0,0),w.invert(),J.Eu.TransformCoordinatesToRef(z,w,P),v?(f.addAtIndex(12,P.x),f.addAtIndex(13,P.y),f.addAtIndex(14,P.z)):f.setTranslationFromFloats(P.x,P.y,P.z)}this._markAsDirtyAndDecompose()}translate(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;this._updatePosition(z,u,U,!0)}setPosition(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;this._updatePosition(z,u,U,!1)}setAbsolutePosition(z,u){this.setPosition(z,1,u)}scale(z,u,U){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const f=this.getLocalMatrix(),w=g._TmpMats[0];J.Matrix.ScalingToRef(z,u,U,w),w.multiplyToRef(f,f),w.invert();for(const J of this.children){const v=J.getLocalMatrix();v.multiplyToRef(w,v),v.multiplyAtIndex(12,z),v.multiplyAtIndex(13,u),v.multiplyAtIndex(14,U),J._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),v)for(const J of this.children)J.scale(z,u,U,v)}setScale(z){this._decompose(),this._localScaling.v(z),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(z){this._decompose(),z.v(this._localScaling)}setYawPitchRoll(z,u,U){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,f=arguments.length>4?arguments[4]:void 0;if(0===v){const w=g._TmpQuat;return J.Quaternion.RotationYawPitchRollToRef(z,u,U,w),void this.setRotationQuaternion(w,v,f)}const w=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(w,f))return;const P=g._TmpMats[1];J.Matrix.RotationYawPitchRollToRef(z,u,U,P),w.multiplyToRef(P,P),this._rotateWithMatrix(P,v,f)}rotate(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3?arguments[3]:void 0;const f=g._TmpMats[0];f.setTranslationFromFloats(0,0,0),J.Matrix.RotationAxisToRef(z,u,f),this._rotateWithMatrix(f,U,v)}setAxisAngle(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3?arguments[3]:void 0;if(0===U){const f=g._TmpQuat;return J.Quaternion.RotationAxisToRef(z,u,f),void this.setRotationQuaternion(f,U,v)}const f=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(f,v))return;const w=g._TmpMats[1];J.Matrix.RotationAxisToRef(z,u,w),f.multiplyToRef(w,w),this._rotateWithMatrix(w,U,v)}setRotation(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(z.y,z.x,z.z,u,U)}setRotationQuaternion(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;if(0===u)return this._decompose(),this._localRotation.v(z),void this._markAsDirtyAndCompose();const v=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(v,U))return;const f=g._TmpMats[1];J.Matrix.FromQuaternionToRef(z,f),v.multiplyToRef(f,f),this._rotateWithMatrix(f,u,U)}setRotationMatrix(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;if(0===u){const v=g._TmpQuat;return J.Quaternion.FromRotationMatrixToRef(z,v),void this.setRotationQuaternion(v,u,U)}const v=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(v,U))return;const f=g._TmpMats[1];f.v(z),v.multiplyToRef(z,f),this._rotateWithMatrix(f,u,U)}_rotateWithMatrix(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;const J=this.getLocalMatrix(),v=J.m[12],f=J.m[13],w=J.m[14],P=this.getParent(),R=g._TmpMats[3],S=g._TmpMats[4];P&&1==u?(U?(R.v(U.getWorldMatrix()),P.getAbsoluteMatrix().multiplyToRef(R,R)):R.v(P.getAbsoluteMatrix()),S.v(R),S.invert(),J.multiplyToRef(R,J),J.multiplyToRef(z,J),J.multiplyToRef(S,J)):1==u&&U?(R.v(U.getWorldMatrix()),S.v(R),S.invert(),J.multiplyToRef(R,J),J.multiplyToRef(z,J),J.multiplyToRef(S,J)):J.multiplyToRef(z,J),J.setTranslationFromFloats(v,f,w),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(z,u){const U=g._TmpMats[2];return z.v(this.getAbsoluteMatrix()),u?(z.multiplyToRef(u.getWorldMatrix(),z),J.Matrix.ScalingToRef(u.Ug.x,u.Ug.y,u.Ug.z,U)):J.Matrix.IdentityToRef(U),z.invert(),!isNaN(z.m[0])&&(U.multiplyAtIndex(0,this._scalingDeterminant),z.multiplyToRef(U,z),!0)}wf(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=J.Eu.Zero();return this.getPositionToRef(z,u,U),U}getPositionToRef(){let z=arguments.length>1?arguments[1]:void 0,u=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const z=this.getLocalMatrix();u.x=z.m[12],u.y=z.m[13],u.z=z.m[14]}else{let U=null;z&&(U=z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let J=g._TmpMats[0];z&&U?(J.v(this.getAbsoluteMatrix()),J.multiplyToRef(U,J)):J=this.getAbsoluteMatrix(),u.x=J.m[12],u.y=J.m[13],u.z=J.m[14]}}getAbsolutePosition(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const u=J.Eu.Zero();return this.getPositionToRef(1,z,u),u}getAbsolutePositionToRef(z,u){this.getPositionToRef(1,z,u)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.WZ.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.v(this.WZ);const z=this._skeleton.getPoseMatrix();z&&this._absoluteMatrix.multiplyToRef(z,this._absoluteMatrix)}const z=this.children,u=z.length;for(let U=0;U<u;U++)z[U].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}JR(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=J.Eu.Zero();return this.getDirectionToRef(z,u,U),U}getDirectionToRef(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0,v=null;u&&(v=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const f=g._TmpMats[0];f.v(this.getAbsoluteMatrix()),u&&v&&f.multiplyToRef(v,f),J.Eu.TransformNormalToRef(z,f,U),U.normalize()}getRotation(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=J.Eu.Zero();return this.getRotationToRef(z,u,U),U}getRotationToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0;const J=g._TmpQuat;this.getRotationQuaternionToRef(z,u,J),J.toEulerAnglesToRef(U)}getRotationQuaternion(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=J.Quaternion.Identity();return this.getRotationQuaternionToRef(z,u,U),U}getRotationQuaternionToRef(){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),u.v(this._localRotation);else{const U=g._TmpMats[0],J=this.getAbsoluteMatrix();z?J.multiplyToRef(z.getWorldMatrix(),U):U.v(J),U.multiplyAtIndex(0,this._scalingDeterminant),U.multiplyAtIndex(1,this._scalingDeterminant),U.multiplyAtIndex(2,this._scalingDeterminant),U.decompose(void 0,u,void 0)}}getRotationMatrix(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1?arguments[1]:void 0;const U=J.Matrix.Identity();return this.getRotationMatrixToRef(z,u,U),U}getRotationMatrixToRef(){let z=arguments.length>1?arguments[1]:void 0,u=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(u);else{const U=g._TmpMats[0],J=this.getAbsoluteMatrix();z?J.multiplyToRef(z.getWorldMatrix(),U):U.v(J),U.multiplyAtIndex(0,this._scalingDeterminant),U.multiplyAtIndex(1,this._scalingDeterminant),U.multiplyAtIndex(2,this._scalingDeterminant),U.getRotationMatrixToRef(u)}}getAbsolutePositionFromLocal(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=J.Eu.Zero();return this.getAbsolutePositionFromLocalToRef(z,u,U),U}getAbsolutePositionFromLocalToRef(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0,v=null;u&&(v=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const f=g._TmpMats[0];f.v(this.getAbsoluteMatrix()),u&&v&&f.multiplyToRef(v,f),J.Eu.TransformCoordinatesToRef(z,f,U)}getLocalPositionFromAbsolute(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=J.Eu.Zero();return this.getLocalPositionFromAbsoluteToRef(z,u,U),U}getLocalPositionFromAbsoluteToRef(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0,v=null;u&&(v=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const f=g._TmpMats[0];f.v(this.getAbsoluteMatrix()),u&&v&&f.multiplyToRef(v,f),f.invert(),J.Eu.TransformCoordinatesToRef(z,f,U)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const z=this._skeleton.bones.indexOf(this);if(-1!==z&&this._skeleton.bones.splice(z,1),this._parentNode&&this._parentNode.children){const z=this._parentNode.children,u=z.indexOf(this);-1!==u&&z.splice(u,1)}super.dispose()}}g._TmpVecs=(0,v.e)(2,J.Eu.Zero),g._TmpQuat=J.Quaternion.Identity(),g._TmpMats=(0,v.e)(5,J.Matrix.Identity)},14725:(z,u,U)=>{"use strict";U.d(u,{b:()=>D});var J=U(12899),v=U(12901),f=U(12756),g=U(12914),w=U(12935),P=U(13318),R=U(13335),S=U(13199),d=U(12777),mz=U(12917);class Z{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(z){this._zoomStopsAnimation=z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(z){this._idleRotationSpeed=z}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(z){this._idleRotationWaitTime=z}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(z){this._idleRotationSpinupTime=z}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(z){this._attachedCamera=z;const u=this._attachedCamera.Vz();this._onPrePointerObservableObserver=u.onPrePointerObservable.add((z=>{z.type!==S.e.POINTERDOWN?z.type===S.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=z.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const z=d.e.Now;let u=0;null!=this._lastFrameTime&&(u=z-this._lastFrameTime),this._lastFrameTime=z,this._applyUserInteraction();const U=z-this._lastInteractionTime-this._idleRotationWaitTime,J=Math.max(Math.min(U/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*J,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(u/1e3))}))}detach(){if(!this._attachedCamera)return;const z=this._attachedCamera.Vz();this._onPrePointerObservableObserver&&z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(z){this._lastInteractionTime=null!==z&&void 0!==z?z:d.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<mz.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let z=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(z=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?z:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=d.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var A=U(14729),E=U(13406);class C{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(z){if(this._autoTransitionRange===z)return;this._autoTransitionRange=z;const u=this._attachedCamera;u&&(z?this._onMeshTargetChangedObserver=u.onMeshTargetChangedObservable.add((z=>{if(z&&(z.af(!0),z.getBoundingInfo)){const u=z.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*u,this.upperRadiusTransitionRange=.05*u}})):this._onMeshTargetChangedObserver&&u.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(z){this._attachedCamera=z,this._onAfterCheckInputsObserver=z.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(z){return!!this._attachedCamera&&(this._attachedCamera.radius===z&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(z){if(!this._attachedCamera)return;this._radiusBounceTransition||(C.EasingFunction.setEasingMode(C.EasingMode),this._radiusBounceTransition=E.b.CreateAnimation("radius",E.b.ANIMATIONTYPE_FLOAT,60,C.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const u=E.b.TransitionTo("radius",this._attachedCamera.radius+z,this._attachedCamera,this._attachedCamera.Vz(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));u&&this._animatables.push(u)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}C.EasingFunction=new A.b(.3),C.EasingMode=A.n.EASINGMODE_EASEOUT;class r{constructor(){this.onTargetFramingAnimationEndObservable=new f.e,this._mode=r.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(z){this._mode=z}get mode(){return this._mode}set radiusScale(z){this._radiusScale=z}get radiusScale(){return this._radiusScale}set positionScale(z){this._positionScale=z}get positionScale(){return this._positionScale}set defaultElevation(z){this._defaultElevation=z}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(z){this._elevationReturnTime=z}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(z){this._elevationReturnWaitTime=z}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(z){this._zoomStopsAnimation=z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(z){this._framingTime=z}get framingTime(){return this._framingTime}init(){}attach(z){this._attachedCamera=z;const u=this._attachedCamera.Vz();r.EasingFunction.setEasingMode(r.EasingMode),this._onPrePointerObservableObserver=u.onPrePointerObservable.add((z=>{z.type!==S.e.POINTERDOWN?z.type===S.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=z.onMeshTargetChangedObservable.add((z=>{z&&z.getBoundingInfo&&this.zoomOnMesh(z,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=z.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const z=this._attachedCamera.Vz();this._onPrePointerObservableObserver&&z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;z.af(!0);const J=z.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(J.minimumWorld,J.maximumWorld,u,U)}zoomOnMeshHierarchy(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;z.af(!0);const J=z.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(J.min,J.max,u,U)}zoomOnMeshesHierarchy(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new g.Eu(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),v=new g.Eu(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let f=0;f<z.length;f++){const u=z[f].getHierarchyBoundingVectors(!0);g.Eu.CheckExtends(u.min,J,v),g.Eu.CheckExtends(u.max,J,v)}this.zoomOnBoundingInfo(J,v,u,U)}zoomOnBoundingInfo(z,u){let U,J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const f=z.y,w=f+(u.y-f)*this._positionScale,P=u.Cu(z).scale(.5);if(!isFinite(w))return!1;if(J)U=new g.Eu(0,w,0);else{const u=z.add(P);U=new g.Eu(u.x,w,u.z)}this._vectorTransition||(this._vectorTransition=E.b.CreateAnimation("target",E.b.ANIMATIONTYPE_VECTOR3,60,r.EasingFunction)),this._betaIsAnimating=!0;let R=E.b.TransitionTo("target",U,this._attachedCamera,this._attachedCamera.Vz(),60,this._vectorTransition,this._framingTime);R&&this._animatables.push(R);let S=0;if(this._mode===r.FitFrustumSidesMode){const U=this._calculateLowerRadiusFromModelBoundingSphere(z,u);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=P.length()+this._attachedCamera.Bf),S=U}else this._mode===r.IgnoreBoundsSizeMode&&(S=this._calculateLowerRadiusFromModelBoundingSphere(z,u),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Bf));if(this.autoCorrectCameraLimitsAndSensibility){const U=u.Cu(z).length();this._attachedCamera.panningSensibility=5e3/U,this._attachedCamera.wheelPrecision=100/S}return this._radiusTransition||(this._radiusTransition=E.b.CreateAnimation("radius",E.b.ANIMATIONTYPE_FLOAT,60,r.EasingFunction)),R=E.b.TransitionTo("radius",S,this._attachedCamera,this._attachedCamera.Vz(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),v&&v(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),R&&this._animatables.push(R),!0}_calculateLowerRadiusFromModelBoundingSphere(z,u){const U=this._attachedCamera;if(!U)return 0;let J=U._calculateLowerRadiusFromModelBoundingSphere(z,u,this._radiusScale);return U.lowerRadiusLimit&&this._mode===r.IgnoreBoundsSizeMode&&(J=J<U.lowerRadiusLimit?U.lowerRadiusLimit:J),U.upperRadiusLimit&&(J=J>U.upperRadiusLimit?U.upperRadiusLimit:J),J}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const z=d.e.Now-this._lastInteractionTime,u=.5*Math.PI-this._defaultElevation,U=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>U&&z>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=E.b.CreateAnimation("beta",E.b.ANIMATIONTYPE_FLOAT,60,r.EasingFunction));const z=E.b.TransitionTo("beta",u,this._attachedCamera,this._attachedCamera.Vz(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));z&&this._animatables.push(z)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=d.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}r.EasingFunction=new A.r,r.EasingMode=A.n.EASINGMODE_EASEINOUT,r.IgnoreBoundsSizeMode=0,r.FitFrustumSidesMode=1;var M=U(13338),T=U(13364),X=U(14119),h=U(12748);class t{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(z){z=h.Tools.BackCompatCameraNoPreventDefault(arguments);const u=this.camera.getEngine(),U=u.getInputElement();let J=0,v=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=f=>{var g,w;const P=f.event,R="touch"===P.pointerType;if(f.type!==S.e.POINTERMOVE&&-1===this.buttons.indexOf(P.button))return;const d=P.target;if(this._altKey=P.altKey,this._ctrlKey=P.ctrlKey,this._metaKey=P.metaKey,this._shiftKey=P.shiftKey,this._buttonsPressed=P.buttons,u.isPointerLock){const z=P.movementX,u=P.movementY;this.onTouch(null,z,u),this._pointA=null,this._pointB=null}else{if(f.type!==S.e.POINTERDOWN&&f.type!==S.e.POINTERDOUBLETAP&&R&&(null===(g=this._pointA)||void 0===g?void 0:g.pointerId)!==P.pointerId&&(null===(w=this._pointB)||void 0===w?void 0:w.pointerId)!==P.pointerId)return;if(f.type!==S.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!R)if(f.type===S.e.POINTERDOUBLETAP)this.onDoubleTap(P.pointerType);else if(f.type!==S.e.POINTERUP||this._currentMousePointerIdDown!==P.pointerId&&!R){if(f.type===S.e.POINTERMOVE)if(z||P.preventDefault(),this._pointA&&null===this._pointB){const z=P.clientX-this._pointA.x,u=P.clientY-this._pointA.y;this._pointA.x=P.clientX,this._pointA.y=P.clientY,this.onTouch(this._pointA,z,u)}else if(this._pointA&&this._pointB){const z=this._pointA.pointerId===P.pointerId?this._pointA:this._pointB;z.x=P.clientX,z.y=P.clientY;const u=this._pointA.x-this._pointB.x,U=this._pointA.y-this._pointB.y,g=u*u+U*U,w={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:P.pointerId,type:f.type};this.onMultiTouch(this._pointA,this._pointB,J,g,v,w),v=w,J=g}}else{try{null===d||void 0===d||d.releasePointerCapture(P.pointerId)}catch(mz){}R||(this._pointB=null),u._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==P.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==P.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==J||v)&&(this.onMultiTouch(this._pointA,this._pointB,J,0,v,null),J=0,v=null),this._currentMousePointerIdDown=-1,this.onButtonUp(P),z||P.preventDefault()}else{try{null===d||void 0===d||d.setPointerCapture(P.pointerId)}catch(mz){}if(null===this._pointA)this._pointA={x:P.clientX,y:P.clientY,pointerId:P.pointerId,type:P.pointerType};else{if(null!==this._pointB)return;this._pointB={x:P.clientX,y:P.clientY,pointerId:P.pointerId,type:P.pointerType}}-1!==this._currentMousePointerIdDown||R||(this._currentMousePointerIdDown=P.pointerId),this.onButtonDown(P),z||(P.preventDefault(),U&&U.focus())}}},this._observer=this.camera.Vz()._inputManager._addCameraPointerObserver(this._pointerInput,S.e.POINTERDOWN|S.e.POINTERUP|S.e.POINTERMOVE|S.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,J=0,v=null,this.onLostFocus()},this._contextMenuBind=z=>this.onContextMenu(z),U&&U.addEventListener("contextmenu",this._contextMenuBind,!1);const f=this.camera.Vz().getEngine().getHostWindow();f&&h.Tools.RegisterTopRootEvents(f,[{name:"blur",handler:this._onLostFocus}])}Hm(){if(this._onLostFocus){const z=this.camera.Vz().getEngine().getHostWindow();z&&h.Tools.UnregisterTopRootEvents(z,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Vz()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const z=this.camera.Vz().getEngine().getInputElement();z&&z.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(z){}onTouch(z,u,U){}onMultiTouch(z,u,U,J,v,f){}onContextMenu(z){z.preventDefault()}onButtonDown(z){}onButtonUp(z){}onLostFocus(){}}(0,J.b)([(0,v.K)()],t.prototype,"buttons",void 0);class V extends t{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(z,u){if(0!==this.panningSensibility&&z&&u){const U=u.x-z.x,J=u.y-z.y;this.camera.inertialPanningX+=-U/this.panningSensibility,this.camera.inertialPanningY+=J/this.panningSensibility}}_computePinchZoom(z,u){const U=this.camera.radius||V.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=U*Math.sqrt(z)/Math.sqrt(u):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(u-z)*U*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(u-z)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(z,u,U){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-u/this.panningSensibility,this.camera.inertialPanningY+=U/this.panningSensibility):(this.camera.inertialAlphaOffset-=u/this.angularSensibilityX,this.camera.inertialBetaOffset-=U/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(z,u,U,J,v,f){0===U&&null===v||0===J&&null===f||(this.multiTouchPanAndZoom?(this._computePinchZoom(U,J),this._computeMultiTouchPanning(v,f)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(J)-Math.sqrt(U))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(U,J),this._isPinching=!0):this._computeMultiTouchPanning(v,f)):this.multiTouchPanning?this._computeMultiTouchPanning(v,f):this.pinchZoom&&this._computePinchZoom(U,J))}onButtonDown(z){this._isPanClick=z.button===this.camera._panningMouseButton}onButtonUp(z){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}V.MinimumRadiusForPinch=.001,(0,J.b)([(0,v.K)()],V.prototype,"buttons",void 0),(0,J.b)([(0,v.K)()],V.prototype,"angularSensibilityX",void 0),(0,J.b)([(0,v.K)()],V.prototype,"angularSensibilityY",void 0),(0,J.b)([(0,v.K)()],V.prototype,"pinchPrecision",void 0),(0,J.b)([(0,v.K)()],V.prototype,"pinchDeltaPercentage",void 0),(0,J.b)([(0,v.K)()],V.prototype,"useNaturalPinchZoom",void 0),(0,J.b)([(0,v.K)()],V.prototype,"pinchZoom",void 0),(0,J.b)([(0,v.K)()],V.prototype,"panningSensibility",void 0),(0,J.b)([(0,v.K)()],V.prototype,"multiTouchPanning",void 0),(0,J.b)([(0,v.K)()],V.prototype,"multiTouchPanAndZoom",void 0),X.d.ArcRotateCameraPointersInput=V;var L=U(13204);class O{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(z){z=h.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Vz(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((u=>{const U=u.event;if(!U.metaKey)if(u.type===L.d.KEYDOWN){if(this._ctrlPressed=U.ctrlKey,this._altPressed=U.altKey,-1!==this.keysUp.indexOf(U.keyCode)||-1!==this.keysDown.indexOf(U.keyCode)||-1!==this.keysLeft.indexOf(U.keyCode)||-1!==this.keysRight.indexOf(U.keyCode)||-1!==this.keysReset.indexOf(U.keyCode)){-1===this._keys.indexOf(U.keyCode)&&this._keys.push(U.keyCode),U.preventDefault&&(z||U.preventDefault())}}else if(-1!==this.keysUp.indexOf(U.keyCode)||-1!==this.keysDown.indexOf(U.keyCode)||-1!==this.keysLeft.indexOf(U.keyCode)||-1!==this.keysRight.indexOf(U.keyCode)||-1!==this.keysReset.indexOf(U.keyCode)){const u=this._keys.indexOf(U.keyCode);u>=0&&this._keys.splice(u,1),U.preventDefault&&(z||U.preventDefault())}})))}Hm(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const z=this.camera;for(let u=0;u<this._keys.length;u++){const U=this._keys[u];-1!==this.keysLeft.indexOf(U)?this._ctrlPressed&&this.camera._useCtrlForPanning?z.inertialPanningX-=1/this.panningSensibility:z.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(U)?this._ctrlPressed&&this.camera._useCtrlForPanning?z.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?z.inertialRadiusOffset+=1/this.zoomingSensibility:z.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(U)?this._ctrlPressed&&this.camera._useCtrlForPanning?z.inertialPanningX+=1/this.panningSensibility:z.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(U)?this._ctrlPressed&&this.camera._useCtrlForPanning?z.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?z.inertialRadiusOffset-=1/this.zoomingSensibility:z.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(U)&&z.useInputToRestoreState&&z.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,J.b)([(0,v.K)()],O.prototype,"keysUp",void 0),(0,J.b)([(0,v.K)()],O.prototype,"keysDown",void 0),(0,J.b)([(0,v.K)()],O.prototype,"keysLeft",void 0),(0,J.b)([(0,v.K)()],O.prototype,"keysRight",void 0),(0,J.b)([(0,v.K)()],O.prototype,"keysReset",void 0),(0,J.b)([(0,v.K)()],O.prototype,"panningSensibility",void 0),(0,J.b)([(0,v.K)()],O.prototype,"zoomingSensibility",void 0),(0,J.b)([(0,v.K)()],O.prototype,"useAltToZoom",void 0),(0,J.b)([(0,v.K)()],O.prototype,"angularSpeed",void 0),X.d.ArcRotateCameraKeyboardMoveInput=O;var x=U(12976),Q=U(13208);class K{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new g.Eu(0,0,0),this._globalOffset=new g.Eu(0,0,0),this._inertialPanning=g.Eu.Zero()}_computeDeltaFromMouseWheelLegacyEvent(z,u){let U=0;const J=.01*z*this.wheelDeltaPercentage*u;return U=z>0?J/(1+this.wheelDeltaPercentage):J*(1+this.wheelDeltaPercentage),U}attachControl(z){z=h.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=u=>{if(u.type!==S.e.POINTERWHEEL)return;const U=u.event;let J=0;const v=U.deltaMode===Q.b.DOM_DELTA_LINE?40:1,f=-U.deltaY*v;if(this.customComputeDeltaFromMouseWheel)J=this.customComputeDeltaFromMouseWheel(f,this,U);else if(this.wheelDeltaPercentage){if(J=this._computeDeltaFromMouseWheelLegacyEvent(f,this.camera.radius),J>0){let z=this.camera.radius,u=this.camera.inertialRadiusOffset+J;for(let U=0;U<20&&!(z<=u)&&!(Math.abs(u*this.camera.inertia)<.001);U++)z-=u,u*=this.camera.inertia;z=(0,w.Clamp)(z,0,Number.MAX_VALUE),J=this._computeDeltaFromMouseWheelLegacyEvent(f,z)}}else J=f/(40*this.wheelPrecision);J&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(J)):this.camera.inertialRadiusOffset+=J),U.preventDefault&&(z||U.preventDefault())},this._observer=this.camera.Vz()._inputManager._addCameraPointerObserver(this._wheel,S.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.fg(0)}Hm(){this._observer&&(this.camera.Vz()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const z=this.camera;0+z.inertialAlphaOffset+z.inertialBetaOffset+z.inertialRadiusOffset&&(this._updateHitPlane(),z.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(z.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const z=this.camera,u=z.target.Cu(z.position);this._hitPlane=x.d.FromPositionAndNormal(z.target,u)}_getPosition(){const z=this.camera,u=z.Vz(),U=u.createPickingRay(u.pointerX,u.pointerY,g.Matrix.Identity(),z,!1);0===z.targetScreenOffset.x&&0===z.targetScreenOffset.y||(this._viewOffset.set(z.targetScreenOffset.x,z.targetScreenOffset.y,0),z.getViewMatrix().invertToRef(z._cameraTransformMatrix),this._globalOffset=g.Eu.TransformNormal(this._viewOffset,z._cameraTransformMatrix),U.origin.addInPlace(this._globalOffset));let J=0;var v;this._hitPlane&&(J=null!==(v=U.intersectsPlane(this._hitPlane))&&void 0!==v?v:0);return U.origin.addInPlace(U.direction.scaleInPlace(J))}_zoomToMouse(z){const u=this.camera,U=1-u.inertia;if(u.lowerRadiusLimit){var J;const v=null!==(J=u.lowerRadiusLimit)&&void 0!==J?J:0;u.radius-(u.inertialRadiusOffset+z)/U<v&&(z=(u.radius-v)*U-u.inertialRadiusOffset)}if(u.upperRadiusLimit){var v;const J=null!==(v=u.upperRadiusLimit)&&void 0!==v?v:0;u.radius-(u.inertialRadiusOffset+z)/U>J&&(z=(u.radius-J)*U-u.inertialRadiusOffset)}const f=z/U/u.radius,w=this._getPosition(),P=g.TmpVectors.Eu[6];w.subtractToRef(u.target,P),P.scaleInPlace(f),P.scaleInPlace(U),this._inertialPanning.addInPlace(P),u.inertialRadiusOffset+=z}_zeroIfClose(z){Math.abs(z.x)<mz.d&&(z.x=0),Math.abs(z.y)<mz.d&&(z.y=0),Math.abs(z.z)<mz.d&&(z.z=0)}}(0,J.b)([(0,v.K)()],K.prototype,"wheelPrecision",void 0),(0,J.b)([(0,v.K)()],K.prototype,"zoomToMouseLocation",void 0),(0,J.b)([(0,v.K)()],K.prototype,"wheelDeltaPercentage",void 0),X.d.ArcRotateCameraMouseWheelInput=K;class Y extends X.e{constructor(z){super(z)}addMouseWheel(){return this.add(new K),this}addPointers(){return this.add(new V),this}addKeyboard(){return this.add(new O),this}}var p=U(12875);function N(z,u){return isNaN(z)?u:z}P.d.AddNodeConstructor("ArcRotateCamera",((z,u)=>()=>new D(z,0,0,1,g.Eu.Zero(),u)));class D extends T.d{get target(){return this._target}set target(z){this.setTarget(z)}get targetHost(){return this._targetHost}set targetHost(z){z&&this.setTarget(z)}getTarget(){return this.target}get position(){return this._position}set position(z){this.setPosition(z)}set upVector(z){this._upToYMatrix||(this._yToUpMatrix=new g.Matrix,this._upToYMatrix=new g.Matrix,this._upVector=g.Eu.Zero()),z.normalize(),this._upVector.v(z),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){g.Matrix.RotationAlignToRef(g.Eu.UpReadOnly,this._upVector,this._yToUpMatrix),g.Matrix.RotationAlignToRef(this._upVector,g.Eu.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const z=this.inputs.attached.pointers;return z?z.angularSensibilityX:0}set angularSensibilityX(z){const u=this.inputs.attached.pointers;u&&(u.angularSensibilityX=z)}get angularSensibilityY(){const z=this.inputs.attached.pointers;return z?z.angularSensibilityY:0}set angularSensibilityY(z){const u=this.inputs.attached.pointers;u&&(u.angularSensibilityY=z)}get pinchPrecision(){const z=this.inputs.attached.pointers;return z?z.pinchPrecision:0}set pinchPrecision(z){const u=this.inputs.attached.pointers;u&&(u.pinchPrecision=z)}get pinchDeltaPercentage(){const z=this.inputs.attached.pointers;return z?z.pinchDeltaPercentage:0}set pinchDeltaPercentage(z){const u=this.inputs.attached.pointers;u&&(u.pinchDeltaPercentage=z)}get useNaturalPinchZoom(){const z=this.inputs.attached.pointers;return!!z&&z.useNaturalPinchZoom}set useNaturalPinchZoom(z){const u=this.inputs.attached.pointers;u&&(u.useNaturalPinchZoom=z)}get panningSensibility(){const z=this.inputs.attached.pointers;return z?z.panningSensibility:0}set panningSensibility(z){const u=this.inputs.attached.pointers;u&&(u.panningSensibility=z)}get keysUp(){const z=this.inputs.attached.keyboard;return z?z.keysUp:[]}set keysUp(z){const u=this.inputs.attached.keyboard;u&&(u.keysUp=z)}get keysDown(){const z=this.inputs.attached.keyboard;return z?z.keysDown:[]}set keysDown(z){const u=this.inputs.attached.keyboard;u&&(u.keysDown=z)}get keysLeft(){const z=this.inputs.attached.keyboard;return z?z.keysLeft:[]}set keysLeft(z){const u=this.inputs.attached.keyboard;u&&(u.keysLeft=z)}get keysRight(){const z=this.inputs.attached.keyboard;return z?z.keysRight:[]}set keysRight(z){const u=this.inputs.attached.keyboard;u&&(u.keysRight=z)}get wheelPrecision(){const z=this.inputs.attached.mousewheel;return z?z.wheelPrecision:0}set wheelPrecision(z){const u=this.inputs.attached.mousewheel;u&&(u.wheelPrecision=z)}get zoomToMouseLocation(){const z=this.inputs.attached.mousewheel;return!!z&&z.zoomToMouseLocation}set zoomToMouseLocation(z){const u=this.inputs.attached.mousewheel;u&&(u.zoomToMouseLocation=z)}get wheelDeltaPercentage(){const z=this.inputs.attached.mousewheel;return z?z.wheelDeltaPercentage:0}set wheelDeltaPercentage(z){const u=this.inputs.attached.mousewheel;u&&(u.wheelDeltaPercentage=z)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(z){z!==this.useBouncingBehavior&&(z?(this._bouncingBehavior=new C,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(z){z!==this.useFramingBehavior&&(z?(this._framingBehavior=new r,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(z){z!==this.useAutoRotationBehavior&&(z?(this._autoRotationBehavior=new Z,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(z,u,U,J,v,w){var P;let R=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(z,g.Eu.Zero(),w,R),P=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=g.Eu.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=g.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new g.Matrix,this.panningAxis=new g.Eu(1,1,0),this._transformedDirection=new g.Eu,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new f.e,this.checkCollisions=!1,this.collisionRadius=new g.Eu(.5,.5,.5),this._previousPosition=g.Eu.Zero(),this._collisionVelocity=g.Eu.Zero(),this._newPosition=g.Eu.Zero(),this._computationVector=g.Eu.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new g.Eu(NaN,NaN,NaN),this._goalTargetScreenOffset=new g.Vector2(NaN,NaN),this._onCollisionPositionChange=function(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;U?(P.setPosition(u),P.xA&&P.xA(U)):P._previousPosition.v(P._position);const J=Math.cos(P.alpha),v=Math.sin(P.alpha),f=Math.cos(P.beta);let g=Math.sin(P.beta);0===g&&(g=1e-4);const w=P._getTargetPosition();P._computationVector.zg(P.radius*J*g,P.radius*f,P.radius*v*g),w.addToRef(P._computationVector,P._newPosition),P._position.v(P._newPosition);let R=P.upVector;P.allowUpsideDown&&P.beta<0&&(R=R.clone(),R=R.negate()),P._computeViewMatrix(P._position,w,R),P._viewMatrix.addAtIndex(12,P.targetScreenOffset.x),P._viewMatrix.addAtIndex(13,P.targetScreenOffset.y),P._collisionTriggered=!1},this._target=g.Eu.Zero(),v&&this.setTarget(v),this.alpha=u,this.beta=U,this.radius=J,this.getViewMatrix(),this.inputs=new Y(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new g.Eu(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=g.Vector2.Zero()}_updateCache(z){z||super._updateCache(),this._cache._target.v(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.v(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const z=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?z.addToRef(this._targetBoundingCenter,this._target):this._target.v(z)}const z=this._getLockedTargetPosition();return z||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>mz.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){var z,u,U,J,v,f,g;let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,mz=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,Z=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=Z?this._currentInterpolationFactor=Z:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=N(P,this._goalAlpha),this._goalBeta=N(R,this._goalBeta),this._goalRadius=N(S,this._goalRadius),this._goalTarget.set(N(d.x,this._goalTarget.x),N(d.y,this._goalTarget.y),N(d.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(N(mz.x,this._goalTargetScreenOffset.x),N(mz.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,w.Clamp)(this._goalAlpha,null!==(z=this.lowerAlphaLimit)&&void 0!==z?z:-1/0,null!==(u=this.upperAlphaLimit)&&void 0!==u?u:1/0),this._goalBeta=(0,w.Clamp)(this._goalBeta,null!==(U=this.lowerBetaLimit)&&void 0!==U?U:-1/0,null!==(J=this.upperBetaLimit)&&void 0!==J?J:1/0),this._goalRadius=(0,w.Clamp)(this._goalRadius,null!==(v=this.lowerRadiusLimit)&&void 0!==v?v:-1/0,null!==(f=this.upperRadiusLimit)&&void 0!==f?f:1/0),this._goalTarget.y=(0,w.Clamp)(this._goalTarget.y,null!==(g=this.lowerTargetYLimit)&&void 0!==g?g:-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(z,u){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const v=arguments;u=h.Tools.BackCompatCameraNoPreventDefault(v),this._useCtrlForPanning=U,this._panningMouseButton=J,"boolean"===typeof v[0]&&(v.length>1&&(this._useCtrlForPanning=v[1]),v.length>2&&(this._panningMouseButton=v[2])),this.inputs.attachElement(u),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Hm(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let z=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){z=!0;const u=this.invertRotation?-1:1,U=this._calculateHandednessMultiplier();let J=this.inertialAlphaOffset*U;this.beta<0&&(J*=-1),this.alpha+=J*u,this.beta+=this.inertialBetaOffset*u,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<mz.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<mz.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*mz.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){z=!0;const u=new g.Eu(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),u.multiplyInPlace(this.panningAxis),g.Eu.TransformNormalToRef(u,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const z=this.upVector,u=g.Eu.CrossToRef(this._transformedDirection,z,this._transformedDirection);g.Eu.CrossToRef(z,u,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);g.Eu.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.v(this._transformedDirection)}else{if(this.parent){const z=g.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(z),z.transposeToRef(z),g.Eu.TransformCoordinatesToRef(this._transformedDirection,z,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*mz.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*mz.d&&(this.inertialPanningY=0)}if(z)this.stopInterpolation();else if(this._isInterpolating){let z=!1;const u=this._scene.getEngine().getDeltaTime()/1e3,U=1-Math.pow(2,-u/this._currentInterpolationFactor),J=N(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const u=g.TmpVectors.Eu[0].set(N(this._goalTarget.x,this._target.x),N(this._goalTarget.y,this._target.y),N(this._goalTarget.z,this._target.z));g.Eu.LerpToRef(this.target,u,U,this._target),10*g.Eu.Distance(this.target,u)/J<mz.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.v(u),this.setTarget(this.target,!1,!0,!0)):z=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const u=g.Quaternion.RotationAlphaBetaGammaToRef(N(this._goalAlpha,this.alpha),N(this._goalBeta,this.beta),0,g.TmpVectors.Quaternion[0]),J=g.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,g.TmpVectors.Quaternion[1]),v=g.Quaternion.SlerpToRef(J,u,U,g.TmpVectors.Quaternion[2]);v.normalize();const f=v.toAlphaBetaGammaToRef(g.TmpVectors.Eu[0]);if(this.alpha=f.x,this.beta=f.y,v.isApprox(u,mz.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const z=u.toAlphaBetaGammaToRef(g.TmpVectors.Eu[0]);this.alpha=z.x,this.beta=z.y}else z=!0}if(isNaN(this._goalRadius)||(this.radius+=(J-this.radius)*U,Math.abs(J/this.radius-1)<mz.d?(this._goalRadius=NaN,this.radius=J):z=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const u=g.TmpVectors.Vector2[0].set(N(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),N(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));g.Vector2.LerpToRef(this.targetScreenOffset,u,U,this.targetScreenOffset),g.Vector2.Distance(this.targetScreenOffset,u)<mz.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.v(u)):z=!0}this._isInterpolating=z}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.Eu.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const z=this.alpha;var u,U;this.alpha=function(z){let u=Math.PI/2;return 0===z.x&&0===z.z||(u=Math.acos(z.x/Math.sqrt(Math.pow(z.x,2)+Math.pow(z.z,2)))),z.z<0&&(u=2*Math.PI-u),u}(this._computationVector),this.beta=(u=this._computationVector.y,U=this.radius,Math.acos(u/U));const J=Math.round((z-this.alpha)/(2*Math.PI));this.alpha+=2*J*Math.PI,this._checkLimits()}setPosition(z){this._position.equals(z)||(this._position.v(z),this.rebuildAnglesAndRadius())}setTarget(z){var u;let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(v=null!==(u=this.overrideCloneAlphaBetaRadius)&&void 0!==u?u:v,z.af)U&&z.getBoundingInfo?this._targetBoundingCenter=z.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,z.af(),this._targetHost=z,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const u=z,U=this._getTargetPosition();if(U&&!J&&U.equals(u))return;this._targetHost=null,this._target=u,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}v||this.rebuildAnglesAndRadius()}_getViewMatrix(){const z=Math.cos(this.alpha),u=Math.sin(this.alpha),U=Math.cos(this.beta);let J=Math.sin(this.beta);0===J&&(J=1e-4),0===this.radius&&(this.radius=1e-4);const v=this._getTargetPosition();if(this._computationVector.zg(this.radius*z*J,this.radius*U,this.radius*u*J),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.Eu.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),v.addToRef(this._computationVector,this._newPosition),this.Vz().collisionsEnabled&&this.checkCollisions){const z=this.Vz().collisionCoordinator;this._collider||(this._collider=z.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,z.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.v(this._newPosition);let z=this.upVector;this.allowUpsideDown&&J<0&&(z=z.negate()),this._computeViewMatrix(this._position,v,z),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.v(v),this._viewMatrix}zoomOn(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];z=z||this.Vz().meshes;const U=R.e.MinMax(z);let J=this._calculateLowerRadiusFromModelBoundingSphere(U.min,U.max);if(J=Math.max(Math.min(J,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=J*this.zoomOnFactor,this.mode===M.b.ORTHOGRAPHIC_CAMERA){const z=this.Vz().getEngine().getAspectRatio(this),u=J*this.zoomOnFactor/2;this.orthoLeft=-u*z,this.orthoRight=u*z,this.orthoBottom=-u,this.orthoTop=u}this.focusOn({min:U.min,max:U.max,distance:J},u)}focusOn(z){let u,U,J=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===z.min){const J=z||this.Vz().meshes;u=R.e.MinMax(J),U=g.Eu.Distance(u.min,u.max)}else{u=z,U=z.distance}this._target=R.e.Center(u),J||(this.maxZ=2*U)}createRigCamera(z,u){let U=0;switch(this.cameraRigMode){case M.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case M.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case M.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case M.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case M.b.RIG_MODE_VR:U=this._cameraRigParams.stereoHalfAngle*(0===u?1:-1);break;case M.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:U=this._cameraRigParams.stereoHalfAngle*(0===u?-1:1)}const J=new D(z,this.alpha+U,this.beta,this.radius,this._target,this.Vz());return J._cameraRigParams={},J.isRigCamera=!0,J.rigParent=this,J.upVector=this.upVector,J.mode=this.mode,J.orthoLeft=this.orthoLeft,J.orthoRight=this.orthoRight,J.orthoBottom=this.orthoBottom,J.orthoTop=this.orthoTop,J}_updateRigCameras(){const z=this._rigCameras[0],u=this._rigCameras[1];switch(z.beta=u.beta=this.beta,this.cameraRigMode){case M.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case M.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case M.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case M.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case M.b.RIG_MODE_VR:z.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,u.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case M.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:z.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,u.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const J=g.Eu.Distance(z,u),v=this.Vz().getEngine().getAspectRatio(this),f=Math.tan(this.fov/2),w=f*v,P=.5*J*U,R=P*Math.sqrt(1+1/(w*w)),S=P*Math.sqrt(1+1/(f*f));return Math.max(R,S)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,J.b)([(0,v.K)()],D.prototype,"alpha",void 0),(0,J.b)([(0,v.K)()],D.prototype,"beta",void 0),(0,J.b)([(0,v.K)()],D.prototype,"radius",void 0),(0,J.b)([(0,v.K)()],D.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,J.b)([(0,v.G)("target")],D.prototype,"_target",void 0),(0,J.b)([(0,v.y)("targetHost")],D.prototype,"_targetHost",void 0),(0,J.b)([(0,v.K)()],D.prototype,"inertialAlphaOffset",void 0),(0,J.b)([(0,v.K)()],D.prototype,"inertialBetaOffset",void 0),(0,J.b)([(0,v.K)()],D.prototype,"inertialRadiusOffset",void 0),(0,J.b)([(0,v.K)()],D.prototype,"lowerAlphaLimit",void 0),(0,J.b)([(0,v.K)()],D.prototype,"upperAlphaLimit",void 0),(0,J.b)([(0,v.K)()],D.prototype,"lowerBetaLimit",void 0),(0,J.b)([(0,v.K)()],D.prototype,"upperBetaLimit",void 0),(0,J.b)([(0,v.K)()],D.prototype,"lowerRadiusLimit",void 0),(0,J.b)([(0,v.K)()],D.prototype,"upperRadiusLimit",void 0),(0,J.b)([(0,v.K)()],D.prototype,"lowerTargetYLimit",void 0),(0,J.b)([(0,v.K)()],D.prototype,"inertialPanningX",void 0),(0,J.b)([(0,v.K)()],D.prototype,"inertialPanningY",void 0),(0,J.b)([(0,v.K)()],D.prototype,"pinchToPanMaxDistance",void 0),(0,J.b)([(0,v.K)()],D.prototype,"panningDistanceLimit",void 0),(0,J.b)([(0,v.G)()],D.prototype,"panningOriginTarget",void 0),(0,J.b)([(0,v.K)()],D.prototype,"panningInertia",void 0),(0,J.b)([(0,v.K)()],D.prototype,"zoomToMouseLocation",null),(0,J.b)([(0,v.K)()],D.prototype,"zoomOnFactor",void 0),(0,J.b)([(0,v.F)()],D.prototype,"targetScreenOffset",void 0),(0,J.b)([(0,v.K)()],D.prototype,"allowUpsideDown",void 0),(0,J.b)([(0,v.K)()],D.prototype,"useInputToRestoreState",void 0),(0,J.b)([(0,v.K)()],D.prototype,"restoreStateInterpolationFactor",void 0),(0,p.f)("BABYLON.ArcRotateCamera",D)},14119:(z,u,U)=>{"use strict";U.d(u,{d:()=>g,e:()=>w});var J=U(12760),v=U(12955),f=U(13338),g={};class w{constructor(z){this.attachedToElement=!1,this.attached={},this.camera=z,this.checkInputs=()=>{}}add(z){const u=z.getSimpleName();this.attached[u]?J.d.Warn("camera input of type "+u+" already exists on camera"):(this.attached[u]=z,z.camera=this.camera,z.checkInputs&&(this.checkInputs=this._addCheckInputs(z.checkInputs.bind(z))),this.attachedToElement&&z.attachControl(this.noPreventDefault))}remove(z){for(const u in this.attached){const U=this.attached[u];if(U===z)return U.Hm(),U.camera=null,delete this.attached[u],void this.rebuildInputCheck()}}removeByType(z){for(const u in this.attached){const U=this.attached[u];U.getClassName()===z&&(U.Hm(),U.camera=null,delete this.attached[u],this.rebuildInputCheck())}}_addCheckInputs(z){const u=this.checkInputs;return()=>{u(),z()}}attachInput(z){this.attachedToElement&&z.attachControl(this.noPreventDefault)}attachElement(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){z=!f.b.ForceAttachControlToAlwaysPreventDefault&&z,this.attachedToElement=!0,this.noPreventDefault=z;for(const u in this.attached)this.attached[u].attachControl(z)}}detachElement(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const u in this.attached)this.attached[u].Hm(),z&&(this.attached[u].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const z in this.attached){const u=this.attached[z];u.checkInputs&&(this.checkInputs=this._addCheckInputs(u.checkInputs.bind(u)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(z){const u={};for(const U in this.attached){const z=this.attached[U],J=v.b.Serialize(z);u[z.getClassName()]=J}z.inputsmgr=u}parse(z){const u=z.inputsmgr;if(u){this.clear();for(const z in u){const U=g[z];if(U){const J=u[z],f=v.b.Parse((()=>new U),J,null);this.add(f)}}}else for(const U in this.attached){const u=g[this.attached[U].getClassName()];if(u){const J=v.b.Parse((()=>new u),z,null);this.remove(this.attached[U]),this.add(J)}}}}},14116:(z,u,U)=>{"use strict";U.d(u,{e:()=>t});var J=U(12899),v=U(12901),f=U(12914),g=U(13364),w=U(14119),P=U(13204),R=U(12748);class S{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(z){z=R.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Vz(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((u=>{const U=u.event;if(!U.metaKey)if(u.type===P.d.KEYDOWN){if(-1!==this.keysUp.indexOf(U.keyCode)||-1!==this.keysDown.indexOf(U.keyCode)||-1!==this.keysLeft.indexOf(U.keyCode)||-1!==this.keysRight.indexOf(U.keyCode)||-1!==this.keysUpward.indexOf(U.keyCode)||-1!==this.keysDownward.indexOf(U.keyCode)||-1!==this.keysRotateLeft.indexOf(U.keyCode)||-1!==this.keysRotateRight.indexOf(U.keyCode)||-1!==this.keysRotateUp.indexOf(U.keyCode)||-1!==this.keysRotateDown.indexOf(U.keyCode)){-1===this._keys.indexOf(U.keyCode)&&this._keys.push(U.keyCode),z||U.preventDefault()}}else if(-1!==this.keysUp.indexOf(U.keyCode)||-1!==this.keysDown.indexOf(U.keyCode)||-1!==this.keysLeft.indexOf(U.keyCode)||-1!==this.keysRight.indexOf(U.keyCode)||-1!==this.keysUpward.indexOf(U.keyCode)||-1!==this.keysDownward.indexOf(U.keyCode)||-1!==this.keysRotateLeft.indexOf(U.keyCode)||-1!==this.keysRotateRight.indexOf(U.keyCode)||-1!==this.keysRotateUp.indexOf(U.keyCode)||-1!==this.keysRotateDown.indexOf(U.keyCode)){const u=this._keys.indexOf(U.keyCode);u>=0&&this._keys.splice(u,1),z||U.preventDefault()}})))}Hm(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const z=this.camera;for(let u=0;u<this._keys.length;u++){const U=this._keys[u],J=z._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(U)?z._localDirection.zg(-J,0,0):-1!==this.keysUp.indexOf(U)?z._localDirection.zg(0,0,J):-1!==this.keysRight.indexOf(U)?z._localDirection.zg(J,0,0):-1!==this.keysDown.indexOf(U)?z._localDirection.zg(0,0,-J):-1!==this.keysUpward.indexOf(U)?z._localDirection.zg(0,J,0):-1!==this.keysDownward.indexOf(U)?z._localDirection.zg(0,-J,0):-1!==this.keysRotateLeft.indexOf(U)?(z._localDirection.zg(0,0,0),z.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(U)?(z._localDirection.zg(0,0,0),z.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(U)?(z._localDirection.zg(0,0,0),z.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(U)&&(z._localDirection.zg(0,0,0),z.cameraRotation.x+=this._getLocalRotation()),z.Vz().useRightHandedSystem&&(z._localDirection.z*=-1),z.getViewMatrix().invertToRef(z._cameraTransformMatrix),f.Eu.TransformNormalToRef(z._localDirection,z._cameraTransformMatrix,z._transformedDirection),z.cameraDirection.addInPlace(z._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const z=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*z}}(0,J.b)([(0,v.K)()],S.prototype,"keysUp",void 0),(0,J.b)([(0,v.K)()],S.prototype,"keysUpward",void 0),(0,J.b)([(0,v.K)()],S.prototype,"keysDown",void 0),(0,J.b)([(0,v.K)()],S.prototype,"keysDownward",void 0),(0,J.b)([(0,v.K)()],S.prototype,"keysLeft",void 0),(0,J.b)([(0,v.K)()],S.prototype,"keysRight",void 0),(0,J.b)([(0,v.K)()],S.prototype,"rotationSpeed",void 0),(0,J.b)([(0,v.K)()],S.prototype,"keysRotateLeft",void 0),(0,J.b)([(0,v.K)()],S.prototype,"keysRotateRight",void 0),(0,J.b)([(0,v.K)()],S.prototype,"keysRotateUp",void 0),(0,J.b)([(0,v.K)()],S.prototype,"keysRotateDown",void 0),w.d.FreeCameraKeyboardMoveInput=S;var d=U(12756),mz=U(13199);class Z{constructor(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=z,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new d.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(z){z=R.Tools.BackCompatCameraNoPreventDefault(arguments);const u=this.camera.getEngine(),U=u.getInputElement();this._pointerInput||(this._pointerInput=J=>{const v=J.event,f="touch"===v.pointerType;if(!this.touchEnabled&&f)return;if(J.type!==mz.e.POINTERMOVE&&-1===this.buttons.indexOf(v.button))return;const g=v.target;if(J.type===mz.e.POINTERDOWN){if(f&&-1!==this._activePointerId||!f&&-1!==this._currentActiveButton)return;this._activePointerId=v.pointerId;try{null===g||void 0===g||g.setPointerCapture(v.pointerId)}catch(w){}-1===this._currentActiveButton&&(this._currentActiveButton=v.button),this._previousPosition={x:v.clientX,y:v.clientY},z||(v.preventDefault(),U&&U.focus()),u.isPointerLock&&this._onMouseMove&&this._onMouseMove(J.event)}else if(J.type===mz.e.POINTERUP){if(f&&this._activePointerId!==v.pointerId||!f&&this._currentActiveButton!==v.button)return;try{null===g||void 0===g||g.releasePointerCapture(v.pointerId)}catch(w){}this._currentActiveButton=-1,this._previousPosition=null,z||v.preventDefault(),this._activePointerId=-1}else if(J.type===mz.e.POINTERMOVE&&(this._activePointerId===v.pointerId||!f))if(u.isPointerLock&&this._onMouseMove)this._onMouseMove(J.event);else if(this._previousPosition){const u=this.camera._calculateHandednessMultiplier(),U=(v.clientX-this._previousPosition.x)*u,J=v.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=U/this.angularSensibility,this.camera.cameraRotation.x+=J/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:U,offsetY:J}),this._previousPosition={x:v.clientX,y:v.clientY},z||v.preventDefault()}}),this._onMouseMove=U=>{if(!u.isPointerLock)return;const J=this.camera._calculateHandednessMultiplier(),v=U.movementX*J;this.camera.cameraRotation.y+=v/this.angularSensibility;const f=U.movementY;this.camera.cameraRotation.x+=f/this.angularSensibility,this._previousPosition=null,z||U.preventDefault()},this._observer=this.camera.Vz()._inputManager._addCameraPointerObserver(this._pointerInput,mz.e.POINTERDOWN|mz.e.POINTERUP|mz.e.POINTERMOVE),U&&(this._contextMenuBind=z=>this.onContextMenu(z),U.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(z){z.preventDefault()}Hm(){if(this._observer){if(this.camera.Vz()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const z=this.camera.getEngine().getInputElement();z&&z.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,J.b)([(0,v.K)()],Z.prototype,"buttons",void 0),(0,J.b)([(0,v.K)()],Z.prototype,"angularSensibility",void 0),w.d.FreeCameraMouseInput=Z;var A,E=U(13208);class C{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new d.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(z){z=R.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=u=>{if(u.type!==mz.e.POINTERWHEEL)return;const U=u.event,J=U.deltaMode===E.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*J*U.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*J*U.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*J*U.deltaZ/this._normalize,U.preventDefault&&(z||U.preventDefault())},this._observer=this.camera.Vz()._inputManager._addCameraPointerObserver(this._wheel,mz.e.POINTERWHEEL)}Hm(){this._observer&&(this.camera.Vz()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,J.b)([(0,v.K)()],C.prototype,"wheelPrecisionX",void 0),(0,J.b)([(0,v.K)()],C.prototype,"wheelPrecisionY",void 0),(0,J.b)([(0,v.K)()],C.prototype,"wheelPrecisionZ",void 0),function(z){z[z.MoveRelative=0]="MoveRelative",z[z.RotateRelative=1]="RotateRelative",z[z.MoveScene=2]="MoveScene"}(A||(A={}));class r extends C{constructor(){super(...arguments),this._moveRelative=f.Eu.Zero(),this._rotateRelative=f.Eu.Zero(),this._moveScene=f.Eu.Zero(),this._wheelXAction=A.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=A.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(z){null===z&&this._wheelXAction!==A.MoveRelative||(this._wheelXAction=A.MoveRelative,this._wheelXActionCoordinate=z)}get wheelXMoveRelative(){return this._wheelXAction!==A.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(z){null===z&&this._wheelYAction!==A.MoveRelative||(this._wheelYAction=A.MoveRelative,this._wheelYActionCoordinate=z)}get wheelYMoveRelative(){return this._wheelYAction!==A.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(z){null===z&&this._wheelZAction!==A.MoveRelative||(this._wheelZAction=A.MoveRelative,this._wheelZActionCoordinate=z)}get wheelZMoveRelative(){return this._wheelZAction!==A.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(z){null===z&&this._wheelXAction!==A.RotateRelative||(this._wheelXAction=A.RotateRelative,this._wheelXActionCoordinate=z)}get wheelXRotateRelative(){return this._wheelXAction!==A.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(z){null===z&&this._wheelYAction!==A.RotateRelative||(this._wheelYAction=A.RotateRelative,this._wheelYActionCoordinate=z)}get wheelYRotateRelative(){return this._wheelYAction!==A.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(z){null===z&&this._wheelZAction!==A.RotateRelative||(this._wheelZAction=A.RotateRelative,this._wheelZActionCoordinate=z)}get wheelZRotateRelative(){return this._wheelZAction!==A.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(z){null===z&&this._wheelXAction!==A.MoveScene||(this._wheelXAction=A.MoveScene,this._wheelXActionCoordinate=z)}get wheelXMoveScene(){return this._wheelXAction!==A.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(z){null===z&&this._wheelYAction!==A.MoveScene||(this._wheelYAction=A.MoveScene,this._wheelYActionCoordinate=z)}get wheelYMoveScene(){return this._wheelYAction!==A.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(z){null===z&&this._wheelZAction!==A.MoveScene||(this._wheelZAction=A.MoveScene,this._wheelZActionCoordinate=z)}get wheelZMoveScene(){return this._wheelZAction!==A.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.fg(0),this._rotateRelative.fg(0),this._moveScene.fg(0),this._updateCamera(),this.camera.Vz().useRightHandedSystem&&(this._moveRelative.z*=-1);const z=f.Matrix.Zero();this.camera.getViewMatrix().invertToRef(z);const u=f.Eu.Zero();f.Eu.TransformNormalToRef(this._moveRelative,z,u),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(u),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(z,u,U){if(0===z)return;if(null===u||null===U)return;let J=null;switch(u){case A.MoveRelative:J=this._moveRelative;break;case A.RotateRelative:J=this._rotateRelative;break;case A.MoveScene:J=this._moveScene}switch(U){case 0:J.set(z,0,0);break;case 1:J.set(0,z,0);break;case 2:J.set(0,0,z)}}}(0,J.b)([(0,v.K)()],r.prototype,"wheelXMoveRelative",null),(0,J.b)([(0,v.K)()],r.prototype,"wheelYMoveRelative",null),(0,J.b)([(0,v.K)()],r.prototype,"wheelZMoveRelative",null),(0,J.b)([(0,v.K)()],r.prototype,"wheelXRotateRelative",null),(0,J.b)([(0,v.K)()],r.prototype,"wheelYRotateRelative",null),(0,J.b)([(0,v.K)()],r.prototype,"wheelZRotateRelative",null),(0,J.b)([(0,v.K)()],r.prototype,"wheelXMoveScene",null),(0,J.b)([(0,v.K)()],r.prototype,"wheelYMoveScene",null),(0,J.b)([(0,v.K)()],r.prototype,"wheelZMoveScene",null),w.d.FreeCameraMouseWheelInput=r;class M{constructor(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=z,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=R.Tools.IsSafari()}attachControl(z){z=R.Tools.BackCompatCameraNoPreventDefault(arguments);let u=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=U=>{const J=U.event,v="mouse"===J.pointerType||this._isSafari&&"undefined"===typeof J.pointerType;if(this.allowMouse||!v)if(U.type===mz.e.POINTERDOWN){if(z||J.preventDefault(),this._pointerPressed.push(J.pointerId),1!==this._pointerPressed.length)return;u={x:J.clientX,y:J.clientY}}else if(U.type===mz.e.POINTERUP){z||J.preventDefault();const U=this._pointerPressed.indexOf(J.pointerId);if(-1===U)return;if(this._pointerPressed.splice(U,1),0!=U)return;u=null,this._offsetX=null,this._offsetY=null}else if(U.type===mz.e.POINTERMOVE){if(z||J.preventDefault(),!u)return;if(0!=this._pointerPressed.indexOf(J.pointerId))return;this._offsetX=J.clientX-u.x,this._offsetY=-(J.clientY-u.y)}}),this._observer=this.camera.Vz()._inputManager._addCameraPointerObserver(this._pointerInput,mz.e.POINTERDOWN|mz.e.POINTERUP|mz.e.POINTERMOVE),this._onLostFocus){const z=this.camera.getEngine().getInputElement();z&&z.addEventListener("blur",this._onLostFocus)}}Hm(){if(this._pointerInput){if(this._observer&&(this.camera.Vz()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const z=this.camera.getEngine().getInputElement();z&&z.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const z=this.camera,u=z._calculateHandednessMultiplier();z.cameraRotation.y=u*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)z.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const u=z._computeLocalCameraSpeed(),U=new f.Eu(0,0,0!==this.touchMoveSensibility?u*this._offsetY/this.touchMoveSensibility:0);f.Matrix.RotationYawPitchRollToRef(z.rotation.y,z.rotation.x,0,z._cameraRotationMatrix),z.cameraDirection.addInPlace(f.Eu.TransformCoordinates(U,z._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,J.b)([(0,v.K)()],M.prototype,"touchAngularSensibility",void 0),(0,J.b)([(0,v.K)()],M.prototype,"touchMoveSensibility",void 0),w.d.FreeCameraTouchInput=M;class T extends w.e{constructor(z){super(z),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new S),this}addMouse(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new Z(z),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new r,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new M),this}clear(){super.clear(),this._mouseInput=null}}var X=U(12875),h=U(12827);class t extends g.d{get angularSensibility(){const z=this.inputs.attached.mouse;return z?z.angularSensibility:0}set angularSensibility(z){const u=this.inputs.attached.mouse;u&&(u.angularSensibility=z)}get keysUp(){const z=this.inputs.attached.keyboard;return z?z.keysUp:[]}set keysUp(z){const u=this.inputs.attached.keyboard;u&&(u.keysUp=z)}get keysUpward(){const z=this.inputs.attached.keyboard;return z?z.keysUpward:[]}set keysUpward(z){const u=this.inputs.attached.keyboard;u&&(u.keysUpward=z)}get keysDown(){const z=this.inputs.attached.keyboard;return z?z.keysDown:[]}set keysDown(z){const u=this.inputs.attached.keyboard;u&&(u.keysDown=z)}get keysDownward(){const z=this.inputs.attached.keyboard;return z?z.keysDownward:[]}set keysDownward(z){const u=this.inputs.attached.keyboard;u&&(u.keysDownward=z)}get keysLeft(){const z=this.inputs.attached.keyboard;return z?z.keysLeft:[]}set keysLeft(z){const u=this.inputs.attached.keyboard;u&&(u.keysLeft=z)}get keysRight(){const z=this.inputs.attached.keyboard;return z?z.keysRight:[]}set keysRight(z){const u=this.inputs.attached.keyboard;u&&(u.keysRight=z)}get keysRotateLeft(){const z=this.inputs.attached.keyboard;return z?z.keysRotateLeft:[]}set keysRotateLeft(z){const u=this.inputs.attached.keyboard;u&&(u.keysRotateLeft=z)}get keysRotateRight(){const z=this.inputs.attached.keyboard;return z?z.keysRotateRight:[]}set keysRotateRight(z){const u=this.inputs.attached.keyboard;u&&(u.keysRotateRight=z)}get keysRotateUp(){const z=this.inputs.attached.keyboard;return z?z.keysRotateUp:[]}set keysRotateUp(z){const u=this.inputs.attached.keyboard;u&&(u.keysRotateUp=z)}get keysRotateDown(){const z=this.inputs.attached.keyboard;return z?z.keysRotateDown:[]}set keysRotateDown(z){const u=this.inputs.attached.keyboard;u&&(u.keysRotateDown=z)}constructor(z,u,U){var J;super(z,u,U,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),J=this,this.ellipsoid=new f.Eu(.5,1,.5),this.ellipsoidOffset=new f.Eu(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=f.Eu.Zero(),this._diffPosition=f.Eu.Zero(),this._newPosition=f.Eu.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;J._newPosition.v(u),J._newPosition.subtractToRef(J._oldPosition,J._diffPosition),J._diffPosition.length()>h.b.CollisionsEpsilon&&(J.position.addToRef(J._diffPosition,J._deferredPositionUpdate),J._deferOnly?J._deferredUpdated=!0:J.position.v(J._deferredPositionUpdate),J.xA&&U&&J.xA(U))},this.inputs=new T(this),this.inputs.addKeyboard().addMouse()}attachControl(z,u){u=R.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(u)}Hm(){this.inputs.detachElement(),this.cameraDirection=new f.Eu(0,0,0),this.cameraRotation=new f.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(z){this._collisionMask=isNaN(z)?-1:z}_collideWithWorld(z){let u;u=this.parent?f.Eu.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,u.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const U=this.Vz().collisionCoordinator;this._collider||(this._collider=U.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let J=z;this.applyGravity&&(J=z.add(this.Vz().gravity)),U.getNewPosition(this._oldPosition,J,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=f.Eu.Zero(),this._transformedDirection=f.Eu.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(z){this._needMoveForGravity=z}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Vz().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"tg"}}(0,J.b)([(0,v.G)()],t.prototype,"ellipsoid",void 0),(0,J.b)([(0,v.G)()],t.prototype,"ellipsoidOffset",void 0),(0,J.b)([(0,v.K)()],t.prototype,"checkCollisions",void 0),(0,J.b)([(0,v.K)()],t.prototype,"applyGravity",void 0),(0,X.f)("BABYLON.FreeCamera",t)},14764:(z,u,U)=>{"use strict";U.d(u,{c:()=>f});var J=U(13014),v=U(14772);class f{constructor(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=U,this.wm=[],this._maxBlockCapacity=u||64,this._selectionContent=new J.c(1024),this._creationFunc=z}update(z,u,U){v.e._CreateBlocks(z,u,U,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}bS(z){for(let u=0;u<this.nS.length;u++){this.nS[u].addEntry(z)}}FS(z){for(let u=0;u<this.nS.length;u++){this.nS[u].removeEntry(z)}}select(z,u){this._selectionContent.reset();for(let U=0;U<this.nS.length;U++){this.nS[U].select(z,this._selectionContent,u)}return u?this._selectionContent.concat(this.wm):this._selectionContent.concatWithNoDuplicate(this.wm),this._selectionContent}intersects(z,u,U){this._selectionContent.reset();for(let J=0;J<this.nS.length;J++){this.nS[J].intersects(z,u,this._selectionContent,U)}return U?this._selectionContent.concat(this.wm):this._selectionContent.concatWithNoDuplicate(this.wm),this._selectionContent}intersectsRay(z){this._selectionContent.reset();for(let u=0;u<this.nS.length;u++){this.nS[u].intersectsRay(z,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.wm),this._selectionContent}}f.CreationFuncForMeshes=(z,u)=>{const U=z.getBoundingInfo();!z.isBlocked&&U.boundingBox.intersectsMinMax(u.mZ,u.Zm)&&u.entries.push(z)},f.CreationFuncForSubMeshes=(z,u)=>{z.getBoundingInfo().boundingBox.intersectsMinMax(u.mZ,u.Zm)&&u.entries.push(z)}},14772:(z,u,U)=>{"use strict";U.d(u,{e:()=>f});var J=U(12914),v=U(13245);class f{constructor(z,u,U,J,v,f){this.entries=[],this.Am=new Array,this._capacity=U,this._depth=J,this._maxDepth=v,this._creationFunc=f,this._minPoint=z,this._maxPoint=u,this.Am.push(z.clone()),this.Am.push(u.clone()),this.Am.push(z.clone()),this.Am[2].x=u.x,this.Am.push(z.clone()),this.Am[3].y=u.y,this.Am.push(z.clone()),this.Am[4].z=u.z,this.Am.push(u.clone()),this.Am[5].z=z.z,this.Am.push(u.clone()),this.Am[6].x=z.x,this.Am.push(u.clone()),this.Am[7].y=z.y}get MU(){return this._capacity}get mZ(){return this._minPoint}get Zm(){return this._maxPoint}addEntry(z){if(this.nS)for(let u=0;u<this.nS.length;u++){this.nS[u].addEntry(z)}else this._creationFunc(z,this),this.entries.length>this.MU&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(z){if(this.nS){for(let u=0;u<this.nS.length;u++){this.nS[u].removeEntry(z)}return}const u=this.entries.indexOf(z);u>-1&&this.entries.splice(u,1)}addEntries(z){for(let u=0;u<z.length;u++){const U=z[u];this.addEntry(U)}}select(z,u,U){if(v.c.IsInFrustum(this.Am,z)){if(this.nS){for(let J=0;J<this.nS.length;J++){this.nS[J].select(z,u,U)}return}U?u.concat(this.entries):u.concatWithNoDuplicate(this.entries)}}intersects(z,u,U,J){if(v.c.IntersectsSphere(this._minPoint,this._maxPoint,z,u)){if(this.nS){for(let v=0;v<this.nS.length;v++){this.nS[v].intersects(z,u,U,J)}return}J?U.concat(this.entries):U.concatWithNoDuplicate(this.entries)}}intersectsRay(z,u){if(z.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.nS){for(let U=0;U<this.nS.length;U++){this.nS[U].intersectsRay(z,u)}return}u.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){f._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(z,u,U,v,g,w,P,R){P.nS=new Array;const S=new J.Eu((u.x-z.x)/2,(u.y-z.y)/2,(u.z-z.z)/2);for(let J=0;J<2;J++)for(let u=0;u<2;u++)for(let d=0;d<2;d++){const mz=z.add(S.multiplyByFloats(J,u,d)),Z=z.add(S.multiplyByFloats(J+1,u+1,d+1)),A=new f(mz,Z,v,g+1,w,R);A.addEntries(U),P.nS.push(A)}}}},14774:(z,u,U)=>{"use strict";U.d(u,{e:()=>S});var J=U(13161),v=U(12914),f=U(13320),g=U(13866),w=U(13193),P=U(14764),R=U(12797);J.d.prototype.createOrUpdateSelectionOctree=function(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,U=this._getComponent(w.c.NAME_OCTREE);U||(U=new S(this),this.o(U)),this.fm||(this.fm=new P.c(P.c.CreationFuncForMeshes,z,u));const J=this.getWorldExtends();return this.fm.update(J.min,J.max,this.meshes),this.fm},Object.defineProperty(J.d.prototype,"selectionOctree",{get:function(){return this.fm},enumerable:!0,configurable:!0}),f.d.prototype.createOrUpdateSubmeshesOctree=function(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const U=this.Vz();let J=U._getComponent(w.c.NAME_OCTREE);J||(J=new S(U),U.o(J)),this._submeshesOctree||(this._submeshesOctree=new P.c(P.c.CreationFuncForSubMeshes,z,u)),this.af(!0);const v=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(v.minimumWorld,v.maximumWorld,this.cf),this._submeshesOctree};class S{constructor(z){this.name=w.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new g.e(v.Eu.Zero(),new v.Eu(1,1,1)),(z=z||R.e.LastCreatedScene)&&(this.ru=z,this.ru.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.ru.getActiveSubMeshCandidates=z=>this.getActiveSubMeshCandidates(z),this.ru.getCollidingSubMeshCandidates=(z,u)=>this.getCollidingSubMeshCandidates(z,u),this.ru.getIntersectingSubMeshCandidates=(z,u)=>this.getIntersectingSubMeshCandidates(z,u))}register(){this.ru.onMeshRemovedObservable.add((z=>{const u=this.ru.selectionOctree;if(void 0!==u&&null!==u){const U=u.wm.indexOf(z);-1!==U&&u.wm.splice(U,1)}})),this.ru.onMeshImportedObservable.add((z=>{const u=this.ru.selectionOctree;void 0!==u&&null!==u&&u.bS(z)}))}getActiveMeshCandidates(){var z;return(null===(z=this.ru.fm)||void 0===z?void 0:z.select(this.ru.frustumPlanes))||this.ru._getDefaultMeshCandidates()}getActiveSubMeshCandidates(z){if(z._submeshesOctree&&z.useOctreeForRenderingSelection){return z._submeshesOctree.select(this.ru.frustumPlanes)}return this.ru._getDefaultSubMeshCandidates(z)}getIntersectingSubMeshCandidates(z,u){if(z._submeshesOctree&&z.useOctreeForPicking){g.e.TransformToRef(u,z.getWorldMatrix(),this._tempRay);return z._submeshesOctree.intersectsRay(this._tempRay)}return this.ru._getDefaultSubMeshCandidates(z)}getCollidingSubMeshCandidates(z,u){if(z._submeshesOctree&&z.useOctreeForCollisions){const U=u._velocityWorldLength+Math.max(u._radius.x,u._radius.y,u._radius.z);return z._submeshesOctree.intersects(u._basePointWorld,U)}return this.ru._getDefaultSubMeshCandidates(z)}rebuild(){}dispose(){}}},13866:(z,u,U)=>{"use strict";U.d(u,{e:()=>Z});var J=U(13161),v=U(13338),f=U(12917),g=U(12914),w=U(12926),P=U(13231),R=U(13189),S=U(12797),d=U(13211);const mz={internalPickerForMesh:void 0};class Z{constructor(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f.d;this.origin=z,this.direction=u,this.length=U,this.epsilon=J}clone(){return new Z(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const J=Z._TmpVector3[0].zg(z.x-U,z.y-U,z.z-U),v=Z._TmpVector3[1].zg(u.x+U,u.y+U,u.z+U);let f,g,w,P,R=0,S=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<J.x||this.origin.x>v.x)return!1}else if(f=1/this.direction.x,g=(J.x-this.origin.x)*f,w=(v.x-this.origin.x)*f,w===-1/0&&(w=1/0),g>w&&(P=g,g=w,w=P),R=Math.max(g,R),S=Math.min(w,S),R>S)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<J.y||this.origin.y>v.y)return!1}else if(f=1/this.direction.y,g=(J.y-this.origin.y)*f,w=(v.y-this.origin.y)*f,w===-1/0&&(w=1/0),g>w&&(P=g,g=w,w=P),R=Math.max(g,R),S=Math.min(w,S),R>S)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<J.z||this.origin.z>v.z)return!1}else if(f=1/this.direction.z,g=(J.z-this.origin.z)*f,w=(v.z-this.origin.z)*f,w===-1/0&&(w=1/0),g>w&&(P=g,g=w,w=P),R=Math.max(g,R),S=Math.min(w,S),R>S)return!1;return!0}intersectsBox(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(z.minimum,z.maximum,u)}intersectsSphere(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const U=z.center.x-this.origin.x,J=z.center.y-this.origin.y,v=z.center.z-this.origin.z,f=U*U+J*J+v*v,g=z.radius+u,w=g*g;if(f<=w)return!0;const P=U*this.direction.x+J*this.direction.y+v*this.direction.z;if(P<0)return!1;return f-P*P<=w}intersectsTriangle(z,u,U){const J=Z._TmpVector3[0],v=Z._TmpVector3[1],f=Z._TmpVector3[2],w=Z._TmpVector3[3],R=Z._TmpVector3[4];u.subtractToRef(z,J),U.subtractToRef(z,v),g.Eu.CrossToRef(this.direction,v,f);const S=g.Eu.Dot(J,f);if(0===S)return null;const d=1/S;this.origin.subtractToRef(z,w);const mz=g.Eu.Dot(w,f)*d;if(mz<-this.epsilon||mz>1+this.epsilon)return null;g.Eu.CrossToRef(w,J,R);const A=g.Eu.Dot(this.direction,R)*d;if(A<-this.epsilon||mz+A>1+this.epsilon)return null;const E=g.Eu.Dot(v,R)*d;return E>this.length?null:new P.b(1-mz-A,mz,E)}intersectsPlane(z){let u;const U=g.Eu.Dot(z.normal,this.direction);if(Math.abs(U)<9.99999997475243e-7)return null;{const J=g.Eu.Dot(z.normal,this.origin);return u=(-z.d-J)/U,u<0?u<-9.99999997475243e-7?null:0:u}}intersectsAxis(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(z){case"y":{const z=(this.origin.y-u)/this.direction.y;return z>0?null:new g.Eu(this.origin.x+this.direction.x*-z,u,this.origin.z+this.direction.z*-z)}case"x":{const z=(this.origin.x-u)/this.direction.x;return z>0?null:new g.Eu(u,this.origin.y+this.direction.y*-z,this.origin.z+this.direction.z*-z)}case"z":{const z=(this.origin.z-u)/this.direction.z;return z>0?null:new g.Eu(this.origin.x+this.direction.x*-z,this.origin.y+this.direction.y*-z,u)}default:return null}}intersectsMesh(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const w=g.TmpVectors.Matrix[0];return z.getWorldMatrix().invertToRef(w),this._tmpRay?Z.TransformToRef(this,w,this._tmpRay):this._tmpRay=Z.Transform(this,w),z.intersects(this._tmpRay,u,U,J,v,f)}intersectsMeshes(z,u,U){U?U.length=0:U=[];for(let J=0;J<z.length;J++){const v=this.intersectsMesh(z[J],u);v.hit&&U.push(v)}return U.sort(this._comparePickingInfo),U}_comparePickingInfo(z,u){return z.distance<u.distance?-1:z.distance>u.distance?1:0}intersectionSegment(z,u,U){const J=this.origin,v=g.TmpVectors.Eu[0],f=g.TmpVectors.Eu[1],w=g.TmpVectors.Eu[2],P=g.TmpVectors.Eu[3];u.subtractToRef(z,v),this.direction.scaleToRef(Z._Rayl,w),J.addToRef(w,f),z.subtractToRef(J,P);const R=g.Eu.Dot(v,v),S=g.Eu.Dot(v,w),d=g.Eu.Dot(w,w),mz=g.Eu.Dot(v,P),A=g.Eu.Dot(w,P),E=R*d-S*S;let C,r,M=E,T=E;E<Z._Smallnum?(C=0,M=1,r=A,T=d):(C=S*A-d*mz,r=R*A-S*mz,C<0?(C=0,r=A,T=d):C>M&&(C=M,r=A+S,T=d)),r<0?(r=0,-mz<0?C=0:-mz>R?C=M:(C=-mz,M=R)):r>T&&(r=T,-mz+S<0?C=0:-mz+S>R?C=M:(C=-mz+S,M=R));const X=Math.abs(C)<Z._Smallnum?0:C/M,h=Math.abs(r)<Z._Smallnum?0:r/T,t=g.TmpVectors.Eu[4];w.scaleToRef(h,t);const V=g.TmpVectors.Eu[5];v.scaleToRef(X,V),V.addInPlace(P);const L=g.TmpVectors.Eu[6];V.subtractToRef(t,L);return h>0&&h<=this.length&&L.lengthSquared()<U*U?V.length():-1}update(z,u,U,J,v,f,w){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){Z._RayDistant||(Z._RayDistant=Z.Zero()),Z._RayDistant.unprojectRayToRef(z,u,U,J,g.Matrix.IdentityReadOnly,f,w);const P=g.TmpVectors.Matrix[0];v.invertToRef(P),Z.TransformToRef(Z._RayDistant,P,this)}else this.unprojectRayToRef(z,u,U,J,v,f,w);return this}static Zero(){return new Z(g.Eu.Zero(),g.Eu.Zero())}static CreateNew(z,u,U,J,v,f,g){return Z.Zero().update(z,u,U,J,v,f,g)}static CreateNewFromTo(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.Matrix.IdentityReadOnly;const J=new Z(new g.Eu(0,0,0),new g.Eu(0,0,0));return Z.CreateFromToToRef(z,u,J,U)}static CreateFromToToRef(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.Matrix.IdentityReadOnly;U.origin.v(z);const v=u.subtractToRef(z,U.direction),f=Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z);return U.length=f,U.direction.normalize(),Z.TransformToRef(U,J,U)}static Transform(z,u){const U=new Z(new g.Eu(0,0,0),new g.Eu(0,0,0));return Z.TransformToRef(z,u,U),U}static TransformToRef(z,u,U){g.Eu.TransformCoordinatesToRef(z.origin,u,U.origin),g.Eu.TransformNormalToRef(z.direction,u,U.direction),U.length=z.length,U.epsilon=z.epsilon;const J=U.direction,v=J.length();if(0!==v&&1!==v){const z=1/v;J.x*=z,J.y*=z,J.z*=z,U.length*=v}return U}unprojectRayToRef(z,u,U,J,v,f,w){const P=g.TmpVectors.Matrix[0];v.multiplyToRef(f,P),P.multiplyToRef(w,P),P.invert();const R=S.e.LastCreatedEngine,d=g.TmpVectors.Eu[0];d.x=z/U*2-1,d.y=-(u/J*2-1),d.z=null!==R&&void 0!==R&&R.df?1:null!==R&&void 0!==R&&R.isNDCHalfZRange?0:-1;const mz=g.TmpVectors.Eu[1].zg(d.x,d.y,1-1e-8),Z=g.TmpVectors.Eu[2],A=g.TmpVectors.Eu[3];g.Eu._UnprojectFromInvertedMatrixToRef(d,P,Z),g.Eu._UnprojectFromInvertedMatrixToRef(mz,P,A),this.origin.v(Z),A.subtractToRef(Z,this.direction),this.direction.normalize()}}function A(z,u,U,J,v){let f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const g=Z.Zero();return E(z,u,U,J,g,v,f),g}function E(z,u,U,J,v,f){let w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const R=z.getEngine();if(!f&&!(f=z.activeCamera))return z;const S=f.viewport,d=R.getRenderHeight(),{x:mz,y:Z,width:A,height:E}=S.toGlobal(R.getRenderWidth(),d),C=1/R.getHardwareScalingLevel();return u=u*C-mz,U=U*C-(d-Z-E),v.update(u,U,A,E,J||g.Matrix.IdentityReadOnly,w?g.Matrix.IdentityReadOnly:f.getViewMatrix(),f.getProjectionMatrix(),P),z}function C(z,u,U,J,v){if(!R.b)return z;const f=z.getEngine();if(!v&&!(v=z.activeCamera))throw new Error("Active camera not set");const w=v.viewport,P=f.getRenderHeight(),{x:S,y:d,width:mz,height:Z}=w.toGlobal(f.getRenderWidth(),P),A=g.Matrix.Identity(),E=1/f.getHardwareScalingLevel();return u=u*E-S,U=U*E-(P-d-Z),J.update(u,U,mz,Z,A,A,v.getProjectionMatrix()),z}function r(z,u,U,J,v,f,g,w){const P=u(J,U.enableDistantPicking),R=U.intersects(P,v,g,f,J,w);return R&&R.hit?!v&&null!=z&&R.distance>=z.distance?null:R:null}function M(z,u,U,J,v,f){let w=null;const P=!!(z.activeCameras&&z.activeCameras.length>1&&z.cameraToUseForPointers!==z.activeCamera),S=z.cameraToUseForPointers||z.activeCamera,d=mz.internalPickerForMesh||r;for(let R=0;R<z.meshes.length;R++){const mz=z.meshes[R];if(U){if(!U(mz,-1))continue}else if(!mz.isEnabled()||!mz.isVisible||!mz.XR)continue;const Z=P&&mz.isWorldMatrixCameraDependent(),A=mz.af(Z,S);if(mz.hasThinInstances&&mz.uS){const z=d(w,u,mz,A,!0,!0,f);if(z){if(v)return z;const P=g.TmpVectors.Matrix[1],R=mz.thinInstanceGetWorldMatrices();for(let z=0;z<R.length;z++){if(U&&!U(mz,z))continue;R[z].multiplyToRef(A,P);const g=d(w,u,mz,P,J,v,f,!0);if(g&&(w=g,w.thinInstanceIndex=z,J))return w}}}else{const z=d(w,u,mz,A,J,v,f);if(z&&(w=z,J))return w}}return w||new R.b}function T(z,u,U,J){if(!R.b)return null;const v=[],f=!!(z.activeCameras&&z.activeCameras.length>1&&z.cameraToUseForPointers!==z.activeCamera),w=z.cameraToUseForPointers||z.activeCamera,P=mz.internalPickerForMesh||r;for(let R=0;R<z.meshes.length;R++){const S=z.meshes[R];if(U){if(!U(S,-1))continue}else if(!S.isEnabled()||!S.isVisible||!S.XR)continue;const d=f&&S.isWorldMatrixCameraDependent(),mz=S.af(d,w);if(S.hasThinInstances&&S.uS){if(P(null,u,S,mz,!0,!0,J)){const z=g.TmpVectors.Matrix[1],f=S.thinInstanceGetWorldMatrices();for(let g=0;g<f.length;g++){if(U&&!U(S,g))continue;f[g].multiplyToRef(mz,z);const w=P(null,u,S,z,!1,!1,J,!0);w&&(w.thinInstanceIndex=g,v.push(w))}}}else{const z=P(null,u,S,mz,!1,!1,J);z&&v.push(z)}}return v}function X(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,J=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0;J||(J=z.getWorldMatrix()),u.length=U,v?u.origin.v(v):u.origin.v(z.position);const f=g.TmpVectors.Eu[2];f.set(0,0,z._scene.useRightHandedSystem?-1:1);const w=g.TmpVectors.Eu[3];return g.Eu.TransformNormalToRef(f,J,w),g.Eu.NormalizeToRef(w,u.direction),u}var h,t;Z._TmpVector3=(0,w.e)(6,g.Eu.Zero),Z._RayDistant=Z.Zero(),Z._Smallnum=1e-8,Z._Rayl=1e9,h=J.d,(t=v.b)&&(t.prototype.getForwardRay=function(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,u=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;return X(this,new Z(g.Eu.Zero(),g.Eu.Zero(),z),z,u,U)},t.prototype.getForwardRayToRef=function(z){return X(this,z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),h&&(d.e._IsPickingAvailable=!0,h.prototype.createPickingRay=function(z,u,U,J){return A(this,z,u,U,J,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),J.d.prototype.createPickingRayToRef=function(z,u,U,J,v){return E(this,z,u,U,J,v,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},J.d.prototype.createPickingRayInCameraSpace=function(z,u,U){return function(z,u,U,J){const v=Z.Zero();return C(z,u,U,v,J),v}(this,z,u,U)},J.d.prototype.createPickingRayInCameraSpaceToRef=function(z,u,U,J){return C(this,z,u,U,J)},J.d.prototype.pickWithBoundingInfo=function(z,u,U,J,v){return function(z,u,U,J,v,f){if(!R.b)return null;const w=M(z,(J=>(z._tempPickingRay||(z._tempPickingRay=Z.Zero()),E(z,u,U,J,z._tempPickingRay,f||null),z._tempPickingRay)),J,v,!0);return w&&(w.ray=A(z,u,U,g.Matrix.Identity(),f||null)),w}(this,z,u,U,J,v)},J.d.prototype.EU=function(z,u,U,J,v,f){return function(z,u,U,J,v,f,w){const P=M(z,((J,v)=>(z._tempPickingRay||(z._tempPickingRay=Z.Zero()),E(z,u,U,J,z._tempPickingRay,f||null,!1,v),z._tempPickingRay)),J,v,!1,w);return P&&(P.ray=A(z,u,U,g.Matrix.Identity(),f||null)),P}(this,z,u,U,J,v,f)},J.d.prototype.pickWithRay=function(z,u,U,J){return function(z,u,U,J,v){const f=M(z,(U=>(z._pickWithRayInverseMatrix||(z._pickWithRayInverseMatrix=g.Matrix.Identity()),U.invertToRef(z._pickWithRayInverseMatrix),z._cachedRayForTransform||(z._cachedRayForTransform=Z.Zero()),Z.TransformToRef(u,z._pickWithRayInverseMatrix,z._cachedRayForTransform),z._cachedRayForTransform)),U,J,!1,v);return f&&(f.ray=u),f}(this,z,u,U,J)},J.d.prototype.multiPick=function(z,u,U,J,v){return function(z,u,U,J,v,f){return T(z,(J=>A(z,u,U,J,v||null)),J,f)}(this,z,u,U,J,v)},J.d.prototype.multiPickWithRay=function(z,u,U){return function(z,u,U,J){return T(z,(U=>(z._pickWithRayInverseMatrix||(z._pickWithRayInverseMatrix=g.Matrix.Identity()),U.invertToRef(z._pickWithRayInverseMatrix),z._cachedRayForTransform||(z._cachedRayForTransform=Z.Zero()),Z.TransformToRef(u,z._pickWithRayInverseMatrix,z._cachedRayForTransform),z._cachedRayForTransform)),U,J)}(this,z,u,U)}},14159:(z,u,U)=>{"use strict";var J=U(12853),v=U(12760),f=U(12800),g=U(12880),w=U(12827),P=U(12865);w.b.prototype._partialLoadFile=function(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(z,(z=>{U[u]=z,U._internalCount++,6===U._internalCount&&J(U)}),void 0,void 0,!0,((z,u)=>{v&&z&&v(z.status+" "+z.statusText,u)}))},w.b.prototype._cascadeLoadFiles=function(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const v=[];v._internalCount=0;for(let f=0;f<6;f++)this._partialLoadFile(U[f],f,v,u,J)},w.b.prototype._cascadeLoadImgs=function(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5?arguments[5]:void 0;const g=[];g._internalCount=0;for(let w=0;w<6;w++)this._partialLoadImg(J[w],w,g,z,u,U,v,f)},w.b.prototype._partialLoadImg=function(z,u,U,J,v,w){let P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7?arguments[7]:void 0;const S=(0,g.d)();(0,f.r)(z,(z=>{U[u]=z,U._internalCount++,J&&J.removePendingData(S),6===U._internalCount&&w&&w(v,U)}),((z,u)=>{J&&J.removePendingData(S),P&&P(z,u)}),J?J.offlineProvider:null,R),J&&J.addPendingData(S)},w.b.prototype.createCubeTextureBase=function(z,u,U,f){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]&&arguments[8],mz=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,A=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,C=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,r=arguments.length>14&&void 0!==arguments[14]&&arguments[14],M=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const T=A||new J.c(this,7);T.isCube=!0,T.url=z,T.generateMipMaps=!f,T._lodGenerationScale=mz,T._lodGenerationOffset=Z,T._useSRGBBuffer=!!r&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!f),T!==A&&(T.label=z.substring(0,60)),this._doNotHandleContextLost||(T._extension=S,T._files=U,T._buffer=M);const X=z;this._transformTextureUrl&&!A&&(z=this._transformTextureUrl(z));const h=null!==S&&void 0!==S?S:function(z){const u=z.split("?")[0],U=u.lastIndexOf(".");return U>-1?u.substring(U).toLowerCase():""}(z),t=(0,P.b)(h),V=(z,u)=>{T.dispose(),w?w(z,u):z&&v.d.Warn(z)},L=(J,w)=>{z===X?J&&V(J.status+" "+J.statusText,w):(v.d.Warn("Failed to load ".concat(z,", falling back to the ").concat(X)),this.createCubeTextureBase(X,u,U,!!f,g,V,R,S,d,mz,Z,T,E,C,r,M))};if(t)t.then((J=>{const v=z=>{E&&E(T,z),J.loadCubeData(z,T,d,g,((z,u)=>{V(z,u)}))};M?v(M):U&&6===U.length?J.supportCascades?this._cascadeLoadFiles(u,(z=>v(z.map((z=>new Uint8Array(z))))),U,V):V("Textures type does not support cascades."):this._loadFile(z,(z=>v(new Uint8Array(z))),void 0,void 0,!0,L)}));else{if(!U||0===U.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(u,T,((z,u)=>{C&&C(z,u)}),U,V)}return this._internalTexturesCache.push(T),T}},14776:(z,u,U)=>{"use strict";U(21),U(12760);var J=U(13050);U(12853),U(13002),U(12850),U(13100),U(13063);J.b},14192:(z,u,U)=>{"use strict";U.d(u,{e:()=>v});var J=U(12875);class v{constructor(z){this.value=this._toInt(z)}_toInt(z){return 0|z}add(z){return new v(this.value+z.value)}Cu(z){return new v(this.value-z.value)}multiply(z){return new v(Math.imul(this.value,z.value))}divide(z){return new v(this.value/z.value)}getClassName(){return v.ClassName}equals(z){return this.value===z.value}static FromValue(z){return new v(z)}toString(){return this.value.toString()}}v.ClassName="FlowGraphInteger",(0,J.f)("FlowGraphInteger",v)},14204:(z,u,U)=>{"use strict";U.d(u,{c:()=>v,e:()=>f});var J=U(12914);class v{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Lf=z}get m(){return this.Lf}transformVector(z){return this.transformVectorToRef(z,new J.Vector2)}transformVectorToRef(z,u){return u.x=z.x*this.Lf[0]+z.y*this.Lf[1],u.y=z.x*this.Lf[2]+z.y*this.Lf[3],u}jf(){return this.toArray()}toArray(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let u=0;u<4;u++)z[u]=this.Lf[u];return z}CU(z){for(let u=0;u<4;u++)this.Lf[u]=z[u];return this}multiplyToRef(z,u){const U=z.Lf,J=this.Lf,v=u.Lf;return v[0]=U[0]*J[0]+U[1]*J[2],v[1]=U[0]*J[1]+U[1]*J[3],v[2]=U[2]*J[0]+U[3]*J[2],v[3]=U[2]*J[1]+U[3]*J[3],u}multiply(z){return this.multiplyToRef(z,new v)}divideToRef(z,u){const U=this.Lf,J=z.Lf,v=u.Lf;return v[0]=U[0]/J[0],v[1]=U[1]/J[1],v[2]=U[2]/J[2],v[3]=U[3]/J[3],u}divide(z){return this.divideToRef(z,new v)}addToRef(z,u){const U=this.Lf,J=z.m,v=u.m;return v[0]=U[0]+J[0],v[1]=U[1]+J[1],v[2]=U[2]+J[2],v[3]=U[3]+J[3],u}add(z){return this.addToRef(z,new v)}subtractToRef(z,u){const U=this.Lf,J=z.m,v=u.m;return v[0]=U[0]-J[0],v[1]=U[1]-J[1],v[2]=U[2]-J[2],v[3]=U[3]-J[3],u}Cu(z){return this.subtractToRef(z,new v)}transpose(){const z=this.Lf;return new v([z[0],z[2],z[1],z[3]])}determinant(){const z=this.Lf;return z[0]*z[3]-z[1]*z[2]}inverse(){const z=this.determinant();if(0===z)throw new Error("Matrix is not invertible");const u=this.Lf,U=1/z;return new v([u[3]*U,-u[1]*U,-u[2]*U,u[0]*U])}equals(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const U=this.Lf,J=z.m;return 0===u?U[0]===J[0]&&U[1]===J[1]&&U[2]===J[2]&&U[3]===J[3]:Math.abs(U[0]-J[0])<u&&Math.abs(U[1]-J[1])<u&&Math.abs(U[2]-J[2])<u&&Math.abs(U[3]-J[3])<u}getClassName(){return"FlowGraphMatrix2D"}toString(){return"FlowGraphMatrix2D(".concat(this.Lf.join(", "),")")}}class f{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Lf=z}get m(){return this.Lf}transformVector(z){return this.transformVectorToRef(z,new J.Eu)}transformVectorToRef(z,u){const U=this.Lf;return u.x=z.x*U[0]+z.y*U[1]+z.z*U[2],u.y=z.x*U[3]+z.y*U[4]+z.z*U[5],u.z=z.x*U[6]+z.y*U[7]+z.z*U[8],u}multiplyToRef(z,u){const U=z.Lf,J=this.Lf,v=u.m;return v[0]=U[0]*J[0]+U[1]*J[3]+U[2]*J[6],v[1]=U[0]*J[1]+U[1]*J[4]+U[2]*J[7],v[2]=U[0]*J[2]+U[1]*J[5]+U[2]*J[8],v[3]=U[3]*J[0]+U[4]*J[3]+U[5]*J[6],v[4]=U[3]*J[1]+U[4]*J[4]+U[5]*J[7],v[5]=U[3]*J[2]+U[4]*J[5]+U[5]*J[8],v[6]=U[6]*J[0]+U[7]*J[3]+U[8]*J[6],v[7]=U[6]*J[1]+U[7]*J[4]+U[8]*J[7],v[8]=U[6]*J[2]+U[7]*J[5]+U[8]*J[8],u}multiply(z){return this.multiplyToRef(z,new f)}divideToRef(z,u){const U=this.Lf,J=z.m,v=u.m;return v[0]=U[0]/J[0],v[1]=U[1]/J[1],v[2]=U[2]/J[2],v[3]=U[3]/J[3],v[4]=U[4]/J[4],v[5]=U[5]/J[5],v[6]=U[6]/J[6],v[7]=U[7]/J[7],v[8]=U[8]/J[8],u}divide(z){return this.divideToRef(z,new f)}addToRef(z,u){const U=this.Lf,J=z.m,v=u.m;return v[0]=U[0]+J[0],v[1]=U[1]+J[1],v[2]=U[2]+J[2],v[3]=U[3]+J[3],v[4]=U[4]+J[4],v[5]=U[5]+J[5],v[6]=U[6]+J[6],v[7]=U[7]+J[7],v[8]=U[8]+J[8],u}add(z){return this.addToRef(z,new f)}subtractToRef(z,u){const U=this.Lf,J=z.m,v=u.m;return v[0]=U[0]-J[0],v[1]=U[1]-J[1],v[2]=U[2]-J[2],v[3]=U[3]-J[3],v[4]=U[4]-J[4],v[5]=U[5]-J[5],v[6]=U[6]-J[6],v[7]=U[7]-J[7],v[8]=U[8]-J[8],u}Cu(z){return this.subtractToRef(z,new f)}toArray(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let u=0;u<9;u++)z[u]=this.Lf[u];return z}jf(){return this.toArray()}CU(z){for(let u=0;u<9;u++)this.Lf[u]=z[u];return this}transpose(){const z=this.Lf;return new f([z[0],z[3],z[6],z[1],z[4],z[7],z[2],z[5],z[8]])}determinant(){const z=this.Lf;return z[0]*(z[4]*z[8]-z[5]*z[7])-z[1]*(z[3]*z[8]-z[5]*z[6])+z[2]*(z[3]*z[7]-z[4]*z[6])}inverse(){const z=this.determinant();if(0===z)throw new Error("Matrix is not invertible");const u=this.Lf,U=1/z;return new f([(u[4]*u[8]-u[5]*u[7])*U,(u[2]*u[7]-u[1]*u[8])*U,(u[1]*u[5]-u[2]*u[4])*U,(u[5]*u[6]-u[3]*u[8])*U,(u[0]*u[8]-u[2]*u[6])*U,(u[2]*u[3]-u[0]*u[5])*U,(u[3]*u[7]-u[4]*u[6])*U,(u[1]*u[6]-u[0]*u[7])*U,(u[0]*u[4]-u[1]*u[3])*U])}equals(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const U=this.Lf,J=z.m;return 0===u?U[0]===J[0]&&U[1]===J[1]&&U[2]===J[2]&&U[3]===J[3]&&U[4]===J[4]&&U[5]===J[5]&&U[6]===J[6]&&U[7]===J[7]&&U[8]===J[8]:Math.abs(U[0]-J[0])<u&&Math.abs(U[1]-J[1])<u&&Math.abs(U[2]-J[2])<u&&Math.abs(U[3]-J[3])<u&&Math.abs(U[4]-J[4])<u&&Math.abs(U[5]-J[5])<u&&Math.abs(U[6]-J[6])<u&&Math.abs(U[7]-J[7])<u&&Math.abs(U[8]-J[8])<u}getClassName(){return"FlowGraphMatrix3D"}toString(){return"FlowGraphMatrix3D(".concat(this.Lf.join(", "),")")}}},14209:(z,u,U)=>{"use strict";var J;function v(z,u,U,J){var v,f,g,w,P,R,S,d,mz,Z,A,E;switch(u){case"Animation":return J?null!==(v=z.animations.find((z=>z.uniqueId===U)))&&void 0!==v?v:null:null!==(f=z.animations[U])&&void 0!==f?f:null;case"AnimationGroup":return J?null!==(g=z.animationGroups.find((z=>z.uniqueId===U)))&&void 0!==g?g:null:null!==(w=z.animationGroups[U])&&void 0!==w?w:null;case"Mesh":return J?null!==(P=z.meshes.find((z=>z.uniqueId===U)))&&void 0!==P?P:null:null!==(R=z.meshes[U])&&void 0!==R?R:null;case"Material":return J?null!==(S=z.materials.find((z=>z.uniqueId===U)))&&void 0!==S?S:null:null!==(d=z.materials[U])&&void 0!==d?d:null;case"oS":return J?null!==(mz=z.cameras.find((z=>z.uniqueId===U)))&&void 0!==mz?mz:null:null!==(Z=z.cameras[U])&&void 0!==Z?Z:null;case"Light":return J?null!==(A=z.lights.find((z=>z.uniqueId===U)))&&void 0!==A?A:null:null!==(E=z.lights[U])&&void 0!==E?E:null;default:return null}}U.d(u,{d:()=>v}),function(z){z.Animation="Animation",z.AnimationGroup="AnimationGroup",z.Mesh="Mesh",z.Material="Material",z.oS="oS",z.Light="Light"}(J||(J={}))},14245:(z,u,U)=>{"use strict";U.d(u,{e:()=>v});var J=U(14248);class v extends J.e{constructor(z,u){if(super(z),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),u)for(const U of u)this._eventsSignalOutputs[U]=this._registerSignalOutput(U+"Event")}_executeOnTick(z){}_startPendingTasks(z){z._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(z),this._resetAfterCanceled(z)),this._preparePendingTasks(z),z._addPendingBlock(this),this.out._activateSignal(z),z._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(z){z._deleteExecutionVariable(this,"_initialized"),z._removePendingBlock(this)}}},14218:(z,u,U)=>{"use strict";U.d(u,{b:()=>R});var J=U(12880),v=U(12875),f=U(14227),g=U(12756),w=U(14184);class P extends f.d{constructor(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:J.defaultValue,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(z,u,U),this.richType=J,this._defaultValue=v,this._optional=f,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new g.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(z){this._isDisabled!==z&&(this._isDisabled=z,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(z,u){u._getConnectionValue(this)!==z&&(u._setConnectionValue(this,z),this.onValueChangedObservable.notifyObservers(z))}resetToDefaultValue(z){z._setConnectionValue(this,this._defaultValue)}connectTo(z){this._isDisabled||super.connectTo(z)}_getValueOrDefault(z){var u;const U=null!==(u=z._getConnectionValue(this))&&void 0!==u?u:this._defaultValue;return this.dataTransformer?this.dataTransformer(U):U}getValue(z){if(1===this.connectionType){z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(z);const u=this._getValueOrDefault(z);return this._lastValue=u,this.richType.typeTransformer?this.richType.typeTransformer(u):u}const u=this.isConnected()?this._connectedPoint[0].getValue(z):this._getValueOrDefault(z);return this._lastValue=u,this.richType.typeTransformer?this.richType.typeTransformer(u):u}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(z),z.richType={},this.richType.serialize(z.richType),z.optional=this._optional,(0,w.h)("defaultValue",this._defaultValue,z)}}(0,v.f)("FlowGraphDataConnection",P);class R{constructor(z){var u,U;this.config=z,this.uniqueId=(0,J.d)(),this.name=null!==(u=null===(U=this.config)||void 0===U?void 0:U.name)&&void 0!==u?u:this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(z){}registerDataInput(z,u,U){const J=new P(z,0,this,u,U);return this.dataInputs.push(J),J}registerDataOutput(z,u,U){const J=new P(z,1,this,u,U);return this.dataOutputs.push(J),J}getDataInput(z){return this.dataInputs.find((u=>u.name===z))}getDataOutput(z){return this.dataOutputs.find((u=>u.name===z))}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.h;if(z.uniqueId=this.uniqueId,z.config={},this.config){const U=this.config,J=Object.keys(U);for(const v of J)u(v,U[v],z.config)}z.dataInputs=[],z.dataOutputs=[],z.className=this.getClassName();for(const U of this.dataInputs){const u={};U.serialize(u),z.dataInputs.push(u)}for(const U of this.dataOutputs){const u={};U.serialize(u),z.dataOutputs.push(u)}}deserialize(z){}_log(z,u,U){var J;null===(J=z.logger)||void 0===J||J.addLogItem({action:u,rU:U,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14227:(z,u,U)=>{"use strict";U.d(u,{d:()=>f});var J,v=U(12880);!function(z){z[z.Input=0]="Input",z[z.Output=1]="Output"}(J||(J={}));class f{constructor(z,u,U){this._ownerBlock=U,this._connectedPoint=[],this.uniqueId=(0,v.d)(),this.connectedPointIds=[],this.name=z,this._connectionType=u}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(z){if(this._connectionType===z._connectionType)throw new Error("Cannot connect two points of type ".concat(this.connectionType));if(this._isSingularConnection()&&this._connectedPoint.length>0||z._isSingularConnection()&&z._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(z),z._connectedPoint.push(this)}disconnectFrom(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const U=this._connectedPoint.indexOf(z),J=z._connectedPoint.indexOf(this);-1!==U&&-1!==J&&(u&&this._connectedPoint.splice(U,1),z._connectedPoint.splice(J,1))}disconnectFromAll(){for(const z of this._connectedPoint)this.disconnectFrom(z,!1);this._connectedPoint.length=0}dispose(){for(const z of this._connectedPoint)this.disconnectFrom(z)}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};z.uniqueId=this.uniqueId,z.name=this.name,z._connectionType=this._connectionType,z.connectedPointIds=[],z.className=this.getClassName();for(const u of this._connectedPoint)z.connectedPointIds.push(u.uniqueId)}getClassName(){return"FGConnection"}deserialize(z){this.uniqueId=z.uniqueId,this.name=z.name,this._connectionType=z._connectionType,this.connectedPointIds=z.connectedPointIds}}},14175:(z,u,U)=>{"use strict";U.d(u,{c:()=>T});var J,v=U(12756),f=U(12899),g=U(12901),w=U(12880),P=U(14184),R=U(14209),S=U(12760);!function(z){z.ExecuteBlock="ExecuteBlock",z.ExecuteEvent="ExecuteEvent",z.TriggerConnection="TriggerConnection",z.ContextVariableSet="ContextVariableSet",z.GlobalVariableSet="GlobalVariableSet",z.GlobalVariableDelete="GlobalVariableDelete",z.GlobalVariableGet="GlobalVariableGet",z.AddConnection="AddConnection",z.GetConnectionValue="GetConnectionValue",z.SetConnectionValue="SetConnectionValue",z.ActivateSignal="ActivateSignal",z.ContextVariableGet="ContextVariableGet"}(J||(J={}));class d{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(z){if(z.time||(z.time=Date.now()),this.log.push(z),this.logToConsole){var u;const U=null===(u=z.rU)||void 0===u?void 0:u.value;"object"===typeof U&&U.getClassName?S.d.Log("[FGLog] ".concat(z.className,":").concat(z.uniqueId.split("-")[0]," ").concat(z.action," - ").concat(JSON.stringify(U.getClassName()),": ").concat(U.toString())):S.d.Log("[FGLog] ".concat(z.className,":").concat(z.uniqueId.split("-")[0]," ").concat(z.action," - ").concat(JSON.stringify(z.rU)))}}getItemsOfType(z){return this.log.filter((u=>u.action===z))}}class mz{get enableLogging(){return this._enableLogging}set enableLogging(z){this._enableLogging!==z&&(this._enableLogging=z,this._enableLogging?(this.logger=new d,this.logger.logToConsole=!0):this.logger=null)}constructor(z){var u;this.uniqueId=(0,w.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new v.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=z,this.assetsContext=null!==(u=z.assetsContext)&&void 0!==u?u:z.ru}hasVariable(z){return z in this._userVariables}setVariable(z,u){var U;this._userVariables[z]=u,null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",rU:{name:z,value:u}})}getAsset(z,u){return(0,R.d)(this.assetsContext,z,u)}getVariable(z){var u;return null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",rU:{name:z,value:this._userVariables[z]}}),this._userVariables[z]}get userVariables(){return this._userVariables}Vz(){return this._configuration.ru}_getUniqueIdPrefixedName(z,u){return"".concat(z.uniqueId,"_").concat(u)}_getGlobalContextVariable(z,u){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",rU:{name:z,defaultValue:u,possibleValue:this._globalContextVariables[z]}}),this._hasGlobalContextVariable(z)?this._globalContextVariables[z]:u}_setGlobalContextVariable(z,u){var U;null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",rU:{name:z,value:u}}),this._globalContextVariables[z]=u}_deleteGlobalContextVariable(z){var u;null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",rU:{name:z}}),delete this._globalContextVariables[z]}_hasGlobalContextVariable(z){return z in this._globalContextVariables}_setExecutionVariable(z,u,U){this._executionVariables[this._getUniqueIdPrefixedName(z,u)]=U}_getExecutionVariable(z,u,U){return this._hasExecutionVariable(z,u)?this._executionVariables[this._getUniqueIdPrefixedName(z,u)]:U}_deleteExecutionVariable(z,u){delete this._executionVariables[this._getUniqueIdPrefixedName(z,u)]}_hasExecutionVariable(z,u){return this._getUniqueIdPrefixedName(z,u)in this._executionVariables}_hasConnectionValue(z){return z.uniqueId in this._connectionValues}_setConnectionValue(z,u){var U;this._connectionValues[z.uniqueId]=u,null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",rU:{connectionPointId:z.uniqueId,value:u}})}_setConnectionValueByKey(z,u){this._connectionValues[z]=u}_getConnectionValue(z){var u;return null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",rU:{connectionPointId:z.uniqueId,value:this._connectionValues[z.uniqueId]}}),this._connectionValues[z.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(z){this._pendingBlocks.includes(z)||(this._pendingBlocks.push(z),this._pendingBlocks.sort(((z,u)=>z.priority-u.priority)))}_removePendingBlock(z){const u=this._pendingBlocks.indexOf(z);-1!==u&&this._pendingBlocks.splice(u,1)}_clearPendingBlocks(){for(const z of this._pendingBlocks)z._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(z){var u;this.onNodeExecutedObservable.notifyObservers(z),null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:z.getClassName(),uniqueId:z.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(z){this._setGlobalContextVariable("timeSinceStart",z.timeSinceStart),this._setGlobalContextVariable("deltaTime",z.deltaTime);for(const U of this._pendingBlocks){var u;null===(u=U._executeOnTick)||void 0===u||u.call(U,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.h;z.uniqueId=this.uniqueId,z._userVariables={};for(const J in this._userVariables)u(J,this._userVariables[J],z._userVariables);z._connectionValues={};for(const J in this._connectionValues)u(J,this._connectionValues[J],z._connectionValues);var U;this.assetsContext!==this.Vz()&&(z._assetsContext={meshes:this.assetsContext.meshes.map((z=>z.id)),materials:this.assetsContext.materials.map((z=>z.id)),textures:this.assetsContext.textures.map((z=>z.name)),animations:this.assetsContext.animations.map((z=>z.name)),lights:this.assetsContext.lights.map((z=>z.id)),cameras:this.assetsContext.cameras.map((z=>z.id)),iZ:null===(U=this.assetsContext.iZ)||void 0===U?void 0:U.map((z=>z.name)),skeletons:this.assetsContext.skeletons.map((z=>z.id)),mA:this.assetsContext.mA.map((z=>z.name)),geometries:this.assetsContext.geometries.map((z=>z.id)),multiMaterials:this.assetsContext.multiMaterials.map((z=>z.id)),transformNodes:this.assetsContext.transformNodes.map((z=>z.id))})}getClassName(){return"FlowGraphContext"}}(0,f.b)([(0,g.K)()],mz.prototype,"uniqueId",void 0);var Z=U(14211),A=U(13199);class E{constructor(z){this.onEventTriggeredObservable=new v.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=z,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Xf.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const z=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",rU:{timeSinceStart:this._startingTime,deltaTime:z}}),this._startingTime+=z})),this._meshPickedObserver=this._scene.onPointerObservable.add((z=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",rU:z})}),A.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((z=>{const u=z.pointerId,U=z.mesh,J=this._pointerUnderMeshState[u];!J&&U?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",rU:{pointerId:u,mesh:U}}):J&&!U?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",rU:{pointerId:u,mesh:J}}):J&&U&&J!==U&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",rU:{pointerId:u,mesh:J,over:U}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",rU:{pointerId:u,mesh:U,out:J}})),this._pointerUnderMeshState[u]=U}),A.e.POINTERMOVE)}dispose(){var z,u,U,J,v;null===(z=this._sceneDisposeObserver)||void 0===z||z.remove(),null===(u=this._sceneReadyObserver)||void 0===u||u.remove(),null===(U=this._sceneOnBeforeRenderObserver)||void 0===U||U.remove(),null===(J=this._meshPickedObserver)||void 0===J||J.remove(),null===(v=this._meshUnderPointerObserver)||void 0===v||v.remove(),this.onEventTriggeredObservable.clear()}}var C,r=U(14233);!function(z){z[z.Stopped=0]="Stopped",z[z.Started=1]="Started"}(C||(C={}));class M{get state(){return this._state}set state(z){this._state=z,this.onStateChangedObservable.notifyObservers(z)}constructor(z){this.onStateChangedObservable=new v.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=z.ru,this._sceneEventCoordinator=new E(this._scene),this._coordinator=z.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((z=>{for(const u of this._executionContexts){const U=this._getContextualOrder(z.type,u);for(const J of U)if(!J._executeEvent(u,z.rU))break}switch(z.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const u of this._executionContexts)u._notifyOnTick(z.rU);break;case"SceneDispose":this.dispose()}}))}createContext(){const z=new mz({ru:this._scene,coordinator:this._coordinator});return this._executionContexts.push(z),z}getContext(z){return this._executionContexts[z]}addEventBlock(z){if("PointerOver"!==z.type&&"PointerOut"!==z.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==z.type&&this._eventBlocks[z.type].push(z),1===this.state)for(const u of this._executionContexts)z._startPendingTasks(u);else this.onStateChangedObservable.addOnce((u=>{if(1===u)for(const U of this._executionContexts)z._startPendingTasks(U)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((z=>{1===z&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const z of this._executionContexts)for(const u in this._eventBlocks){const U=this._getContextualOrder(u,z);for(const u of U)u._startPendingTasks(z)}}_getContextualOrder(z,u){const U=this._eventBlocks[z].sort(((z,u)=>u.initPriority-z.initPriority));if("MeshPick"===z){const z=[];for(const J of U){const v=J.asset.getValue(u);let f=0;for(;f<U.length;f++){const z=U[f].asset.getValue(u);if(v&&z&&(0,r.o)(v,z))break}z.splice(f,0,J)}return z}return U}dispose(){var z;if(0!==this.state){this.state=0;for(const z of this._executionContexts)z._clearPendingBlocks();this._executionContexts.length=0;for(const z in this._eventBlocks)this._eventBlocks[z].length=0;null===(z=this._eventObserver)||void 0===z||z.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(z){const u=[],U=new Set;for(const J in this._eventBlocks)for(const z of this._eventBlocks[J])u.push(z),U.add(z.uniqueId);for(;u.length>0;){const J=u.pop();z(J);for(const z of J.dataInputs)for(const J of z._connectedPoint)U.has(J._ownerBlock.uniqueId)||(u.push(J._ownerBlock),U.add(J._ownerBlock.uniqueId));if(J instanceof Z.d)for(const z of J.signalOutputs)for(const J of z._connectedPoint)U.has(J._ownerBlock.uniqueId)||(u.push(J._ownerBlock),U.add(J._ownerBlock.uniqueId))}}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1?arguments[1]:void 0;z.allBlocks=[],this.visitAllBlocks((u=>{const U={};u.serialize(U),z.allBlocks.push(U)})),z.executionContexts=[];for(const U of this._executionContexts){const J={};U.serialize(J,u),z.executionContexts.push(J)}}}class T{constructor(z){var u;this.config=z,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.ru.Xf.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.ru.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const z=this._executeOnNextFrame.slice(0);if(z.length)for(const u of z){this.notifyCustomEvent(u.id,u.data,!1);const z=this._executeOnNextFrame.findIndex((z=>z.uniqueId===u.uniqueId));-1!==z&&this._executeOnNextFrame.splice(z,1)}}));(null!==(u=T.SceneCoordinators.get(this.config.ru))&&void 0!==u?u:[]).push(this)}createGraph(){const z=new M({ru:this.config.ru,coordinator:this});return this._flowGraphs.push(z),z}removeGraph(z){const u=this._flowGraphs.indexOf(z);-1!==u&&(z.dispose(),this._flowGraphs.splice(u,1))}start(){for(const z of this._flowGraphs)z.start()}dispose(){var z,u,U;for(const f of this._flowGraphs)f.dispose();this._flowGraphs.length=0,null===(z=this._disposeObserver)||void 0===z||z.remove(),null===(u=this._onBeforeRenderObserver)||void 0===u||u.remove();const J=null!==(U=T.SceneCoordinators.get(this.config.ru))&&void 0!==U?U:[],v=J.indexOf(this);-1!==v&&J.splice(v,1)}serialize(z,u){z._flowGraphs=[];for(const U of this._flowGraphs){const J={};U.serialize(J,u),z._flowGraphs.push(J)}z.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(z){let u=this._customEventsMap.get(z);return u||(u=new v.e,this._customEventsMap.set(z,u)),u}notifyCustomEvent(z,u){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:z,data:u,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(z)){const u=this._eventExecutionCounter.get(z);if(this._eventExecutionCounter.set(z,u+1),u>=T.MaxEventTypeExecutionPerFrame)return void(u===T.MaxEventTypeExecutionPerFrame&&S.d.Warn('FlowGraphCoordinator: Too many executions of event "'.concat(z,'".')))}else this._eventExecutionCounter.set(z,1);const U=this._customEventsMap.get(z);U&&U.notifyObservers(u)}}T.MaxEventsPerType=30,T.MaxEventTypeExecutionPerFrame=30,T.SceneCoordinators=new Map},14236:(z,u,U)=>{"use strict";U.d(u,{e:()=>v});var J=U(14245);class v extends J.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(z){z._notifyExecuteNode(this),this.done._activateSignal(z)}}},14211:(z,u,U)=>{"use strict";U.d(u,{d:()=>w});var J=U(14218),v=U(14227),f=U(12875);class g extends v.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(z){super.connectTo(z),this._connectedPoint.sort(((z,u)=>u.priority-z.priority))}_activateSignal(z){var u;if(null===(u=z.logger)||void 0===u||u.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,rU:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(z,this),z._increaseExecutionId();else for(const U of this._connectedPoint)U._activateSignal(z)}}(0,f.f)("FlowGraphSignalConnection",g);class w extends J.b{constructor(z){super(z),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(z){const u=new g(z,0,this);return this.signalInputs.push(u),u}_registerSignalOutput(z){const u=new g(z,1,this);return this.signalOutputs.push(u),u}_unregisterSignalInput(z){const u=this.signalInputs.findIndex((u=>u.name===z));-1!==u&&(this.signalInputs[u].dispose(),this.signalInputs.splice(u,1))}_unregisterSignalOutput(z){const u=this.signalOutputs.findIndex((u=>u.name===z));-1!==u&&(this.signalOutputs[u].dispose(),this.signalOutputs.splice(u,1))}_reportError(z,u){this.error.rU="string"===typeof u?new Error(u):u,this.error._activateSignal(z)}getSignalInput(z){return this.signalInputs.find((u=>u.name===z))}getSignalOutput(z){return this.signalOutputs.find((u=>u.name===z))}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(z),z.signalInputs=[],z.signalOutputs=[];for(const u of this.signalInputs){const U={};u.serialize(U),z.signalInputs.push(U)}for(const u of this.signalOutputs){const U={};u.serialize(U),z.signalOutputs.push(U)}}deserialize(z){for(let u=0;u<z.signalInputs.length;u++){const U=this.getSignalInput(z.signalInputs[u].name);if(!U)throw new Error("Could not find signal input with name "+z.signalInputs[u].name+" in block "+z.className);U.deserialize(z.signalInputs[u])}for(let u=0;u<z.signalOutputs.length;u++){const U=this.getSignalOutput(z.signalOutputs[u].name);if(!U)throw new Error("Could not find signal output with name "+z.signalOutputs[u].name+" in block "+z.className);U.deserialize(z.signalOutputs[u])}}getClassName(){return"FlowGraphExecutionBlock"}}},14248:(z,u,U)=>{"use strict";U.d(u,{e:()=>v});var J=U(14211);class v extends J.d{constructor(z){super(z),this.out=this._registerSignalOutput("out")}}},14196:(z,u,U)=>{"use strict";U.d(u,{A:()=>h,C:()=>S,D:()=>Z,F:()=>A,J:()=>E,M:()=>O,P:()=>x,R:()=>L,T:()=>V,e:()=>R,h:()=>mz,l:()=>t,n:()=>C,r:()=>r,t:()=>M,x:()=>d});var J,v=U(12914),f=U(12967),g=U(14192),w=U(14204);!function(z){z.Any="any",z.String="string",z.Number="number",z.Boolean="boolean",z.Object="object",z.Integer="FlowGraphInteger",z.Vector2="Vector2",z.Eu="Eu",z.Vector4="Vector4",z.Quaternion="Quaternion",z.Matrix="Matrix",z.Matrix2D="Matrix2D",z.Matrix3D="Matrix3D",z.Tu="Tu",z.wg="wg"}(J||(J={}));class P{constructor(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=z,this.defaultValue=u,this.animationType=U}serialize(z){z.typeName=this.typeName,z.defaultValue=this.defaultValue}}const R=new P("any",void 0),S=new P("string",""),d=new P("number",0,0),mz=new P("boolean",!1),Z=new P("Vector2",v.Vector2.Zero(),5),A=new P("Eu",v.Eu.Zero(),1),E=new P("Vector4",v.Vector4.Zero()),C=new P("Matrix",v.Matrix.Identity(),3),r=new P("Matrix2D",new w.c),M=new P("Matrix3D",new w.e),T=new P("Tu",f.Tu.Black(),4),X=new P("wg",new f.wg(0,0,0,0),7),h=new P("Quaternion",v.Quaternion.Identity(),2);h.typeTransformer=z=>{if(z.getClassName){if("Vector4"===z.getClassName())return v.Quaternion.Xu(z.jf());if("Eu"===z.getClassName())return v.Quaternion.FromEulerVector(z);if("Matrix"===z.getClassName())return v.Quaternion.FromRotationMatrix(z)}return z};const t=new P("FlowGraphInteger",new g.e(0),0);function V(z){const u=z;switch(typeof z){case"string":return S;case"number":return d;case"boolean":return mz;case"object":if(u.getClassName)switch(u.getClassName()){case"Vector2":return Z;case"Eu":return A;case"Vector4":return E;case"Matrix":return C;case"Tu":return T;case"wg":return X;case"Quaternion":return h;case"FlowGraphInteger":return t;case"Matrix2D":return r;case"Matrix3D":return M}return R;default:return R}}function L(z){switch(z){case"string":return S;case"number":return d;case"boolean":return mz;case"Vector2":return Z;case"Eu":return A;case"Vector4":return E;case"Matrix":return C;case"Tu":return T;case"wg":return X;case"Quaternion":return h;case"FlowGraphInteger":return t;case"Matrix2D":return r;case"Matrix3D":return M;default:return R}}function O(z){switch(z){case"number":default:return 0;case"Vector2":return 5;case"Eu":return 1;case"Matrix":return 3;case"Tu":return 4;case"wg":return 7;case"Quaternion":return 2}}function x(z){switch(z){case 0:return d;case 5:return Z;case 1:return A;case 3:return C;case 4:return T;case 7:return X;case 2:return h;default:return R}}},14184:(z,u,U)=>{"use strict";U.d(u,{d:()=>S,h:()=>R,j:()=>d});var J=U(12967),v=U(12914),f=U(14192),g=U(14196),w=U(14204);function P(z){return"Vector2"===z||"Eu"===z||"Vector4"===z||"Quaternion"===z||"Tu"===z||"wg"===z}function R(z,u,U){var J,v;const f=null!==(J=null===u||void 0===u||null===(v=u.getClassName)||void 0===v?void 0:v.call(u))&&void 0!==J?J:"";if(P(f)||function(z){return"Matrix"===z||"Matrix2D"===z||"Matrix3D"===z}(f))U[z]={value:u.jf(),className:f};else if("FlowGraphInteger"===f)U[z]={value:u.value,className:f};else if(f&&(u.id||u.name))U[z]={id:u.id,name:u.name,className:f};else{if("object"===typeof u)throw new Error("Could not serialize value ".concat(u));U[z]=u}}function S(z,u,U,R){var d;const mz=u[z];let Z;const A=null!==(d=null===mz||void 0===mz?void 0:mz.type)&&void 0!==d?d:null===mz||void 0===mz?void 0:mz.className;if(function(z){return"Mesh"===z||"AbstractMesh"===z||"GroundMesh"===z||"InstanceMesh"===z||"LinesMesh"===z||"GoldbergMesh"===z||"GreasedLineMesh"===z||"TrailMesh"===z}(A)){let z=R.meshes.filter((z=>mz.id?z.id===mz.id:z.name===mz.name));0===z.length&&(z=R.transformNodes.filter((z=>mz.id?z.id===mz.id:z.name===mz.name))),Z=mz.uniqueId?z.find((z=>z.uniqueId===mz.uniqueId)):z[0]}else if(P(A))Z=function(z,u){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===z)return v.Vector2.Xu(u);if("Eu"===z)return U&&(u[2]*=-1),v.Eu.Xu(u);if("Vector4"===z)return v.Vector4.Xu(u);if("Quaternion"===z)return U&&(u[2]*=-1,u[3]*=-1),v.Quaternion.Xu(u);if("Tu"===z)return new J.Tu(u[0],u[1],u[2]);if("wg"===z)return new J.wg(u[0],u[1],u[2],u[3]);throw new Error("Unknown vector class name ".concat(z))}(A,mz.value);else if(function(z){return"AnimationGroup"===z}(A)){const z=R.animationGroups.filter((z=>z.name===mz.name));Z=1===z.length?z[0]:z.find((z=>z.uniqueId===mz.uniqueId))}else Z="Matrix"===A?v.Matrix.Xu(mz.value):"Matrix2D"===A?new w.c(mz.value):"Matrix3D"===A?new w.e(mz.value):"FlowGraphInteger"===A?f.e.FromValue(mz.value):"number"===A||"string"===A||"boolean"===A?mz.value[0]:mz&&void 0!==mz.value?mz.value:Array.isArray(mz)?mz.reduce(((z,u)=>u.eventData?(z[u.id]={type:(0,g.R)(u.type)},"undefined"!==typeof u.value&&(z[u.id].value=S("value",u,U,R)),z):z),{}):mz;return Z}function d(z){return"FlowGraphJsonPointerParserBlock"===z}},14233:(z,u,U)=>{"use strict";function J(z,u){return!(!z.parent||z.parent!==u&&!J(z.parent,u))}function v(z){if(z.getClassName)return z.getClassName()}function f(z,u){return z===u&&("Vector2"===z||"Eu"===z||"Vector4"===z||"Quaternion"===z)}function g(z,u){return z===u&&("Matrix"===z||"Matrix2D"===z||"Matrix3D"===z)}function w(z,u){return"FlowGraphInteger"===z&&"FlowGraphInteger"===u}function P(z,u){const U="number"===typeof z||"number"===typeof(null===z||void 0===z?void 0:z.value);return U&&!u?!isNaN(R(z)):U}function R(z){return"number"===typeof z?z:z.value}U.d(u,{c:()=>w,d:()=>g,g:()=>f,k:()=>v,o:()=>J,q:()=>R,r:()=>P})},14564:(z,u,U)=>{"use strict";U.r(u),U.d(u,{SceneInstrumentation:()=>f});var J=U(12748),v=U(13141);class f{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(z){z!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=z,z?(this._onBeforeActiveMeshesEvaluationObserver=this.ru.onBeforeActiveMeshesEvaluationObservable.add((()=>{J.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.ru.onAfterActiveMeshesEvaluationObservable.add((()=>{J.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.ru.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ru.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(z){z!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=z,z?(this._onBeforeRenderTargetsRenderObserver=this.ru.onBeforeRenderTargetsRenderObservable.add((()=>{J.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.ru.onAfterRenderTargetsRenderObservable.add((()=>{J.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.ru.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ru.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(z){z!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=z,z?(this._onBeforeParticlesRenderingObserver=this.ru.onBeforeParticlesRenderingObservable.add((()=>{J.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.ru.onAfterParticlesRenderingObservable.add((()=>{J.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.ru.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ru.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(z){z!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=z,this.ru.spriteManagers&&(z?(this._onBeforeSpritesRenderingObserver=this.ru.onBeforeSpritesRenderingObservable.add((()=>{J.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.ru.onAfterSpritesRenderingObservable.add((()=>{J.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.ru.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.ru.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(z){z!==this._capturePhysicsTime&&this.ru.onBeforePhysicsObservable&&(this._capturePhysicsTime=z,z?(this._onBeforePhysicsObserver=this.ru.onBeforePhysicsObservable.add((()=>{J.Tools.StartPerformanceCounter("pg"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.ru.onAfterPhysicsObservable.add((()=>{J.Tools.EndPerformanceCounter("pg"),this._physicsTime.endMonitoring()}))):(this.ru.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.ru.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(z){z!==this._captureAnimationsTime&&(this._captureAnimationsTime=z,z?this._onAfterAnimationsObserver=this.ru.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.ru.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(z){this._captureFrameTime=z}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(z){this._captureInterFrameTime=z}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(z){z!==this._captureRenderTime&&(this._captureRenderTime=z,z?(this._onBeforeDrawPhaseObserver=this.ru.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),J.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.ru.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),J.Tools.EndPerformanceCounter("Main render")}))):(this.ru.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ru.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(z){z!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=z,z?(this._onBeforeCameraRenderObserver=this.ru.onBeforeCameraRenderObservable.add((z=>{this._cameraRenderTime.beginMonitoring(),J.Tools.StartPerformanceCounter("Rendering camera ".concat(z.name))})),this._onAfterCameraRenderObserver=this.ru.onAfterCameraRenderObservable.add((z=>{this._cameraRenderTime.endMonitoring(!1),J.Tools.EndPerformanceCounter("Rendering camera ".concat(z.name))}))):(this.ru.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ru.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.ru.getEngine()._drawCalls}constructor(z){this.ru=z,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new v.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new v.e,this._captureFrameTime=!1,this._frameTime=new v.e,this._captureRenderTime=!1,this._renderTime=new v.e,this._captureInterFrameTime=!1,this._interFrameTime=new v.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new v.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new v.e,this._capturePhysicsTime=!1,this._physicsTime=new v.e,this._captureAnimationsTime=!1,this._animationsTime=new v.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new v.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=z.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(J.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.ru.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=z.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(J.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Tf(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Tf(),this._captureParticlesRenderTime&&this._particlesRenderTime.Tf(),this._captureSpritesRenderTime&&this._spritesRenderTime.Tf(),this._captureRenderTime&&this._renderTime.Tf(),this._captureCameraRenderTime&&this._cameraRenderTime.Tf()}))}dispose(){this._disposed||(this.ru.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.ru.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ru.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.ru.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ru.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.ru.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.ru.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ru.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.ru.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.ru.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.ru.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ru.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.ru.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.ru.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.ru.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.ru.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ru.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.ru=null,this._disposed=!0)}}},14170:(z,u,U)=>{"use strict";U.d(u,{b:()=>S});var J=U(12899),v=U(12901),f=U(12914),g=U(13318),w=U(13428),P=U(13463),R=U(12875);g.d.AddNodeConstructor("Light_Type_1",((z,u)=>()=>new S(z,f.Eu.Zero(),u)));class S extends P.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(z){this._shadowFrustumSize=z,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(z){this._shadowOrthoScale=z,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(z){this._orthoLeft=z}get orthoRight(){return this._orthoRight}set orthoRight(z){this._orthoRight=z}get orthoTop(){return this._orthoTop}set orthoTop(z){this._orthoTop=z}get orthoBottom(){return this._orthoBottom}set orthoBottom(z){this._orthoBottom=z}constructor(z,u,U){super(z,U),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=u.scale(-1),this.direction=u}getClassName(){return"jg"}getTypeID(){return w.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(z,u,U){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(z):this._setDefaultAutoExtendShadowProjectionMatrix(z,u,U)}_setDefaultFixedFrustumShadowProjectionMatrix(z){const u=this.Vz().activeCamera;u&&f.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:u.Bf,void 0!==this.shadowMaxZ?this.shadowMaxZ:u.maxZ,z,this.Vz().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(z,u,U){const J=this.Vz().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const z=f.Eu.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let J=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let g=0;g<U.length;g++){const w=U[g];if(!w)continue;const P=w.getBoundingInfo().boundingBox;for(let U=0;U<P.vectorsWorld.length;U++)f.Eu.TransformCoordinatesToRef(P.vectorsWorld[U],u,z),z.x<this._orthoLeft&&(this._orthoLeft=z.x),z.y<this._orthoBottom&&(this._orthoBottom=z.y),z.x>this._orthoRight&&(this._orthoRight=z.x),z.y>this._orthoTop&&(this._orthoTop=z.y),this.autoCalcShadowZBounds&&(z.z<J&&(J=z.z),z.z>v&&(v=z.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=J,this._shadowMaxZ=v)}const v=this._orthoRight-this._orthoLeft,g=this._orthoTop-this._orthoBottom,w=void 0!==this.shadowMinZ?this.shadowMinZ:(null===J||void 0===J?void 0:J.Bf)||0,P=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===J||void 0===J?void 0:J.maxZ)||1e4,R=this.Vz().getEngine().df;f.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-v*this.shadowOrthoScale,this._orthoRight+v*this.shadowOrthoScale,this._orthoBottom-g*this.shadowOrthoScale,this._orthoTop+g*this.shadowOrthoScale,R?P:w,R?w:P,z,this.Vz().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(z,u){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,u),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,u),this)}transferToNodeMaterialEffect(z,u){return this.computeTransformedInformation()?(z.setFloat3(u,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(z.setFloat3(u,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(z){const u=this._scene.getEngine();return!u.df&&u.isNDCHalfZRange?0:1}getDepthMaxZ(z){const u=this._scene.getEngine();return u.df&&u.isNDCHalfZRange?0:1}prepareLightSpecificDefines(z,u){z["DIRLIGHT"+u]=!0}}(0,J.b)([(0,v.K)()],S.prototype,"shadowFrustumSize",null),(0,J.b)([(0,v.K)()],S.prototype,"shadowOrthoScale",null),(0,J.b)([(0,v.K)()],S.prototype,"autoUpdateExtends",void 0),(0,J.b)([(0,v.K)()],S.prototype,"autoCalcShadowZBounds",void 0),(0,J.b)([(0,v.K)("orthoLeft")],S.prototype,"_orthoLeft",void 0),(0,J.b)([(0,v.K)("orthoRight")],S.prototype,"_orthoRight",void 0),(0,J.b)([(0,v.K)("orthoTop")],S.prototype,"_orthoTop",void 0),(0,J.b)([(0,v.K)("orthoBottom")],S.prototype,"_orthoBottom",void 0),(0,R.f)("BABYLON.DirectionalLight",S)},14734:(z,u,U)=>{"use strict";U.d(u,{c:()=>S});var J=U(12899),v=U(12901),f=U(12914),g=U(12967),w=U(13318),P=U(13428),R=U(12875);w.d.AddNodeConstructor("Light_Type_3",((z,u)=>()=>new S(z,f.Eu.Zero(),u)));class S extends P.c{constructor(z,u,U){super(z,U),this.groundColor=new g.Tu(0,0,0),this.direction=u||f.Eu.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"kg"}setDirectionToTarget(z){return this.direction=f.Eu.Normalize(z.Cu(f.Eu.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(z,u){const U=f.Eu.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",U.x,U.y,U.z,0,u),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Cg),u),this}transferToNodeMaterialEffect(z,u){const U=f.Eu.Normalize(this.direction);return z.setFloat3(u,U.x,U.y,U.z),this}af(){return this._worldMatrix||(this._worldMatrix=f.Matrix.Identity()),this._worldMatrix}getTypeID(){return P.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(z,u){z["HEMILIGHT"+u]=!0}}(0,J.b)([(0,v.k)()],S.prototype,"groundColor",void 0),(0,J.b)([(0,v.G)()],S.prototype,"direction",void 0),(0,R.f)("BABYLON.HemisphericLight",S)},14138:(z,u,U)=>{"use strict";U.d(u,{e:()=>d});var J=U(12899),v=U(12901),f=U(12914),g=U(13318),w=U(13428),P=U(13463),R=U(12894),S=U(12875);g.d.AddNodeConstructor("Light_Type_2",((z,u)=>()=>new d(z,f.Eu.Zero(),f.Eu.Zero(),0,0,u)));class d extends P.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(z){this._iesProfileTexture!==z&&(this._iesProfileTexture=z,this._iesProfileTexture&&d._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(z){this._angle=z,this._cosHalfAngle=Math.cos(.5*z),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(z){this._innerAngle=z,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(z){this._shadowAngleScale=z,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(z){this._projectionTextureLightNear=z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(z){this._projectionTextureLightFar=z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(z){this._projectionTextureUpDirection=z,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(z){this._projectionTexture!==z&&(this._projectionTexture=z,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(d._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):d._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(z){return void 0!==z.onGeneratedObservable}static _IsTexture(z){return void 0!==z.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(z){this._projectionTextureProjectionLightMatrix=z,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(z,u,U,J,v,g){super(z,g),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=f.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=f.Eu.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=f.Eu.Zero(),this._projectionTextureViewLightMatrix=f.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=f.Matrix.Zero(),this._projectionTextureScalingMatrix=f.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=u,this.direction=U,this.angle=J,this.exponent=v}getClassName(){return"SpotLight"}getTypeID(){return w.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(z){super._setDirection(z),this._projectionTextureViewLightDirty=!0}_setPosition(z){super._setPosition(z),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(z,u,U){const J=this.Vz().activeCamera;if(!J)return;this._shadowAngleScale=this._shadowAngleScale||1;const v=this._shadowAngleScale*this._angle,g=void 0!==this.shadowMinZ?this.shadowMinZ:J.Bf,w=void 0!==this.shadowMaxZ?this.shadowMaxZ:J.maxZ,P=this.Vz().getEngine().df;f.Matrix.PerspectiveFovLHToRef(v,1,P?w:g,P?g:w,z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,P)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),f.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const z=this.projectionTextureLightFar,u=this.projectionTextureLightNear,U=z/(z-u),J=-U*u,v=1/Math.tan(this._angle/2);f.Matrix.FromValuesToRef(v/1,0,0,0,0,v,0,0,0,0,U,1,0,0,J,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof R.e){const z=this._projectionTexture.uScale/2,u=this._projectionTexture.vScale/2;f.Matrix.FromValuesToRef(z,0,0,0,0,u,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(z,u){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),z.setMatrix("textureProjectionMatrix"+u,this._projectionTextureMatrix),z.setTexture("projectionLightTexture"+u,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&z.setTexture("iesLightTexture"+u,this._iesProfileTexture),this}transferToEffect(z,u){let U;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,u),U=f.Eu.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,u),U=f.Eu.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",U.x,U.y,U.z,this._cosHalfAngle,u),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,u),this}transferToNodeMaterialEffect(z,u){let U;return U=this.computeTransformedInformation()?f.Eu.Normalize(this.transformedDirection):f.Eu.Normalize(this.direction),this.Vz().useRightHandedSystem?z.setFloat3(u,-U.x,-U.y,-U.z):z.setFloat3(u,U.x,U.y,U.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(z){var u;const U=this._scene.getEngine(),J=void 0!==this.shadowMinZ?this.shadowMinZ:null!==(u=null===z||void 0===z?void 0:z.Bf)&&void 0!==u?u:0;return U.df&&U.isNDCHalfZRange?J:this._scene.getEngine().isNDCHalfZRange?0:J}getDepthMaxZ(z){var u;const U=this._scene.getEngine(),J=void 0!==this.shadowMaxZ?this.shadowMaxZ:null!==(u=null===z||void 0===z?void 0:z.maxZ)&&void 0!==u?u:1e4;return U.df&&U.isNDCHalfZRange?0:J}prepareLightSpecificDefines(z,u){z["SPOTLIGHT"+u]=!0,z["PROJECTEDLIGHTTEXTURE"+u]=!(!this.projectionTexture||!this.projectionTexture.isReady()),z["IESLIGHTTEXTURE"+u]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,J.b)([(0,v.K)()],d.prototype,"angle",null),(0,J.b)([(0,v.K)()],d.prototype,"innerAngle",null),(0,J.b)([(0,v.K)()],d.prototype,"shadowAngleScale",null),(0,J.b)([(0,v.K)()],d.prototype,"exponent",void 0),(0,J.b)([(0,v.K)()],d.prototype,"projectionTextureLightNear",null),(0,J.b)([(0,v.K)()],d.prototype,"projectionTextureLightFar",null),(0,J.b)([(0,v.K)()],d.prototype,"projectionTextureUpDirection",null),(0,J.b)([(0,v.C)("projectedLightTexture")],d.prototype,"_projectionTexture",void 0),(0,S.f)("BABYLON.SpotLight",d)},13850:(z,u,U)=>{"use strict";U.d(u,{e:()=>g,i:()=>f,l:()=>w});const J={},v={};function f(z,u){J[z]=u}function g(z,u){v[z]=u}function w(z){return v[z]?v[z]:null}},13754:(z,u,U)=>{"use strict";U.d(u,{d:()=>V,e:()=>W});var J,v=U(12748),f=U(12756),g=U(13161),w=U(12797),P=U(12760),R=U(13342),S=U(12800),d=U(12806),mz=U(12880),Z=U(12827),A=U(12790);!function(z){z[z.Clean=0]="Clean",z[z.Stop=1]="Stop",z[z.Sync=2]="Sync",z[z.NoSync=3]="NoSync"}(J||(J={}));const E=new f.e,C={};let r=!1;function M(){return C[".babylon"]}function T(z,u){const U=C[z];return U||(P.d.Warn("Unable to find a plugin to load "+z+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),u?M():void 0)}function X(z,u,U){let J="Unable to load from "+(z.rawData?"binary data":z.url);return u?J+=": ".concat(u):U&&(J+=": ".concat(U)),J}async function h(z,u,U,J,v,f,g,w,P){var R;const d="data:"===(mz=z.url).substring(0,5)?mz.substring(5):null;var mz;if(z.rawData&&!g)throw"When using ArrayBufferView to load data the file extension must be provided.";const r=d||g?"":function(z){const u=z.indexOf("?");-1!==u&&(z=z.substring(0,u));const U=z.lastIndexOf(".");return z.substring(U,z.length).toLowerCase()}(z.url);let X=g?T(g,!0):d?function(z){for(const u in C){const U=C[u].plugin;if(U.canDirectLoad&&U.canDirectLoad(z))return C[u]}return M()}(z.url):T(r,!1);if(!X&&r){if(z.url&&!z.url.startsWith("blob:")){const u=await async function(z,u){const U=u.method||"GET";return await new Promise(((J,v)=>{const f=new A.b;f.addEventListener("readystatechange",(()=>{if(4==f.readyState)if(200==f.status){const z={};if(u.responseHeaders)for(const U of u.responseHeaders)z[U]=f.getResponseHeader(U)||"";J({response:f.response,headerValues:z})}else v("Unable to fetch data from ".concat(z,". Error code: ").concat(f.status))})),f.open(U,z),f.send()}))}(z.url,{method:"HEAD",responseHeaders:["Content-Type"]}),U=u.headerValues?u.headerValues["Content-Type"]:"";U&&(X=function(z){for(const u in C){const U=C[u];if(U.mimeType===z)return U}}(U))}X||(X=M())}if(!X)throw new Error("No plugin or fallback for ".concat(null!==g&&void 0!==g?g:z.url));if(!1===(null===P||void 0===P||null===(R=P[X.plugin.name])||void 0===R?void 0:R.enabled))throw new Error("The '".concat(X.plugin.name,"' plugin is disabled via the loader options passed to the loading operation."));if(z.rawData&&!X.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(z=>{if(X.plugin.createPlugin){const u=X.plugin.createPlugin(null!==P&&void 0!==P?P:{});return u instanceof Promise?(u.then(z).catch((z=>{v("Error instantiating plugin.",z)})),null):(z(u),u)}return z(X.plugin),X.plugin})((P=>{var R;if(!P)throw"The loader plugin corresponding to the '".concat(g,"' file type has not been found. If using es6, please import the plugin you wish to use before.");if(E.notifyObservers(P),d&&(P.canDirectLoad&&P.canDirectLoad(z.url)||!(0,S.i)(z.url))){if(P.directLoad){const z=P.directLoad(u,d);z instanceof Promise?z.then((z=>{U(P,z)})).catch((z=>{v("Error in directLoad of _loadData: "+z,z)})):U(P,z)}else U(P,d);return}const mz=X.isBinary,A=(z,J)=>{u.S?v("Scene has been disposed"):U(P,z,J)};let C=null,r=!1;null===(R=P.Xf)||void 0===R||R.add((()=>{r=!0,C&&(C.abort(),C=null),f()}));const M=()=>{if(r)return;const U=(z,u)=>{v(null===z||void 0===z?void 0:z.statusText,u)};if(!P.loadFile&&z.rawData)throw"Plugin does not support loading ArrayBufferView.";C=P.loadFile?P.loadFile(u,z.rawData||z.file||z.url,z.rootUrl,A,J,mz,U,w):u._loadFile(z.file||z.url,A,J,!0,mz,U)},T=u.getEngine();let h=T.enableOfflineSupport;if(h){let U=!1;for(const J of u.disableOfflineSupportExceptionRules)if(J.test(z.url)){U=!0;break}h=!U}h&&Z.b.OfflineProviderFactory?u.offlineProvider=Z.b.OfflineProviderFactory(z.url,M,T.disableManifestCheck):M()}))}function t(z,u){let U,J,f=null,g=null;if(u)if(u.name)U="file:".concat(u.name),J=u.name,f=u;else if(ArrayBuffer.isView(u))U="",J=(0,mz.d)(),g=u;else if(u.startsWith("data:"))U=u,J="";else if(z){const f=u;if("/"===f.substring(0,1))return v.Tools.Error("Wrong sceneFilename parameter"),null;U=z+f,J=f}else U=u,J=v.Tools.GetFilename(u),z=v.Tools.GetFolderPath(u);else U=z,J=v.Tools.GetFilename(z),z=v.Tools.GetFolderPath(z);return{url:U,rootUrl:z,name:J,file:f,rawData:g}}function V(z){if("string"===typeof z.extensions){const u=z.extensions;C[u.toLowerCase()]={plugin:z,isBinary:!1}}else{const u=z.extensions,U=Object.keys(u);for(const J of U)C[J.toLowerCase()]={plugin:z,isBinary:u[J].isBinary,mimeType:u[J].mimeType}}}async function L(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.e.LastCreatedScene,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",mz=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!J)return P.d.Error("No scene available to import mesh to"),null;const Z=t(u,U);if(!Z)return null;const A={};J.addPendingData(A);const E=()=>{J.removePendingData(A)},C=(z,u)=>{const U=X(Z,z,u);g?g(J,U,new d.g(U,d.d.SceneLoaderError,u)):P.d.Error(U),E()},r=f?z=>{try{f(z)}catch(u){C("Error in onProgress callback: "+u,u)}}:void 0,M=(z,u,U,f,g,w,P,R)=>{if(J.importedMeshesFiles.push(Z.url),v)try{v(z,u,U,f,g,w,P,R)}catch(S){C("Error in onSuccess callback: "+S,S)}J.removePendingData(A)};return await h(Z,J,((u,U,v)=>{if(u.rewriteRootURL&&(Z.rootUrl=u.rewriteRootURL(Z.rootUrl,v)),u.importMesh){const v=[],f=[],g=[];if(!u.importMesh(z,J,U,Z.rootUrl,v,f,g,C))return;J.loadingPluginName=u.name,M(v,f,g,[],[],[],[],[])}else{u.importMeshAsync(z,J,U,Z.rootUrl,r,Z.name).then((z=>{J.loadingPluginName=u.name,M(z.meshes,z.mA,z.skeletons,z.animationGroups,z.transformNodes,z.geometries,z.lights,z.spriteManagers)})).catch((z=>{C(z.message,z)}))}}),r,C,E,R,S,mz)}async function O(z,u,U,J,v,f,g,w){return await new Promise(((P,R)=>{try{L(z,u,U,J,((z,u,U,J,v,f,g,w)=>{P({meshes:z,mA:u,skeletons:U,animationGroups:J,transformNodes:v,geometries:f,lights:g,spriteManagers:w})}),v,((z,u,U)=>{R(U||new Error(u))}),f,g,w).catch(R)}catch(d){R(d)}}))}async function x(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedEngine,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};U?await K(z,u,new g.d(U),J,f,P,R,S,d):v.Tools.Error("No engine available")}async function Q(z,u,U,J,v,f,g){return await new Promise(((w,P)=>{x(z,u,U,(z=>{w(z)}),J,((z,u,U)=>{P(U||new Error(u))}),v,f,g)}))}async function K(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedScene,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",mz=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!U)return P.d.Error("No scene available to append to"),null;const Z=t(z,u);if(!Z)return null;const A={};U.addPendingData(A);const E=()=>{U.removePendingData(A)};R.b.ShowLoadingScreen&&!r&&(r=!0,U.getEngine().displayLoadingUI(),U.executeWhenReady((()=>{U.getEngine().hideLoadingUI(),r=!1})));const C=(z,u)=>{const J=X(Z,z,u);f?f(U,J,new d.g(J,d.d.SceneLoaderError,u)):P.d.Error(J),E()},M=v?z=>{try{v(z)}catch(u){C("Error in onProgress callback",u)}}:void 0,T=()=>{if(J)try{J(U)}catch(z){C("Error in onSuccess callback",z)}U.removePendingData(A)};return await h(Z,U,((z,u)=>{if(z.load){if(!z.load(U,u,Z.rootUrl,C))return;U.loadingPluginName=z.name,T()}else{z.loadAsync(U,u,Z.rootUrl,M,Z.name).then((()=>{U.loadingPluginName=z.name,T()})).catch((z=>{C(z.message,z)}))}}),M,C,E,g,S,mz)}async function Y(z,u,U,J,v,f,g){return await new Promise(((w,P)=>{try{K(z,u,U,(z=>{w(z)}),J,((z,u,U)=>{P(U||new Error(u))}),v,f,g).catch(P)}catch(d){P(d)}}))}async function p(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedScene,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!U)return P.d.Error("No scene available to load asset container to"),null;const mz=t(z,u);if(!mz)return null;const Z={};U.addPendingData(Z);const A=()=>{U.removePendingData(Z)},E=(z,u)=>{const J=X(mz,z,u);f?f(U,J,new d.g(J,d.d.SceneLoaderError,u)):P.d.Error(J),A()},C=v?z=>{try{v(z)}catch(u){E("Error in onProgress callback",u)}}:void 0,r=z=>{if(J)try{J(z)}catch(u){E("Error in onSuccess callback",u)}U.removePendingData(Z)};return await h(mz,U,((z,u)=>{if(z.loadAssetContainer){const J=z.loadAssetContainer(U,u,mz.rootUrl,E);if(!J)return;J.populateRootNodes(),U.loadingPluginName=z.name,r(J)}else if(z.loadAssetContainerAsync){z.loadAssetContainerAsync(U,u,mz.rootUrl,C,mz.name).then((u=>{u.populateRootNodes(),U.loadingPluginName=z.name,r(u)})).catch((z=>{E(z.message,z)}))}else E("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),C,E,A,g,R,S)}async function N(z,u,U,J,v,f,g){return await new Promise(((w,P)=>{try{p(z,u,U,(z=>{w(z)}),J,((z,u,U)=>{P(U||new Error(u))}),v,f,g).catch(P)}catch(d){P(d)}}))}async function D(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedScene,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,mz=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",Z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!U)return void P.d.Error("No scene available to load animations to");if(J){for(const J of U.animatables)J.reset();U.stopAllAnimations();const z=U.animationGroups.slice();for(const U of z)U.dispose();const u=U.getNodes();for(const U of u)U.animations&&(U.animations=[])}else switch(v){case 0:const z=U.animationGroups.slice();for(const u of z)u.dispose();break;case 1:for(const u of U.animationGroups)u.stop();break;case 2:for(const u of U.animationGroups)u.reset(),u.restart();break;case 3:break;default:return void P.d.Error("Unknown animation group loading mode value '"+v+"'")}const A=U.animatables.length;await p(z,u,U,(z=>{z.mergeAnimationsTo(U,U.animatables.slice(A),f),z.dispose(),U.onAnimationFileImportedObservable.notifyObservers(U),g&&g(U)}),R,S,d,mz,Z)}async function c(z,u,U,J,v,f,g,w,P,R){return await new Promise(((S,mz)=>{try{D(z,u,U,J,v,f,(z=>{S(z)}),g,((z,u,U)=>{mz(U||new Error(u))}),w,P,R).catch(mz)}catch(d){mz(d)}}))}class W{static get ForceFullSceneLoadingForIncremental(){return R.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(z){R.b.ForceFullSceneLoadingForIncremental=z}static get ShowLoadingScreen(){return R.b.ShowLoadingScreen}static set ShowLoadingScreen(z){R.b.ShowLoadingScreen=z}static get loggingLevel(){return R.b.loggingLevel}static set loggingLevel(z){R.b.loggingLevel=z}static get CleanBoneMatrixWeights(){return R.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(z){R.b.CleanBoneMatrixWeights=z}static GetDefaultPlugin(){return M()}static GetPluginForExtension(z){var u;return null===(u=T(z,!0))||void 0===u?void 0:u.plugin}static IsPluginForExtensionAvailable(z){return function(z){return!!C[z]}(z)}static RegisterPlugin(z){V(z)}static ImportMesh(z,u,U,J,v,f,g,P,R){L(z,u,U,J,v,f,g,P,R).catch((z=>null===g||void 0===g?void 0:g(w.e.LastCreatedScene,null===z||void 0===z?void 0:z.message,z)))}static async ImportMeshAsync(z,u,U,J,v,f,g){return await O(z,u,U,J,v,f,g)}static Load(z,u,U,J,v,f,g,P){x(z,u,U,J,v,f,g,P).catch((z=>null===f||void 0===f?void 0:f(w.e.LastCreatedScene,null===z||void 0===z?void 0:z.message,z)))}static async LoadAsync(z,u,U,J,v,f){return await Q(z,u,U,J,v,f)}static Append(z,u,U,J,v,f,g,P){K(z,u,U,J,v,f,g,P).catch((z=>null===f||void 0===f?void 0:f(null!==U&&void 0!==U?U:w.e.LastCreatedScene,null===z||void 0===z?void 0:z.message,z)))}static async AppendAsync(z,u,U,J,v,f){return await Y(z,u,U,J,v,f)}static LoadAssetContainer(z,u,U,J,v,f,g,P){p(z,u,U,J,v,f,g,P).catch((z=>null===f||void 0===f?void 0:f(null!==U&&void 0!==U?U:w.e.LastCreatedScene,null===z||void 0===z?void 0:z.message,z)))}static async LoadAssetContainerAsync(z,u,U,J,v,f){return await N(z,u,U,J,v,f)}static ImportAnimations(z,u,U,J,v,f,g,P,R,S,d){D(z,u,U,J,v,f,g,P,R,S,d).catch((z=>null===R||void 0===R?void 0:R(null!==U&&void 0!==U?U:w.e.LastCreatedScene,null===z||void 0===z?void 0:z.message,z)))}static async ImportAnimationsAsync(z,u,U,J,v,f,g,w,P,R,S){return await c(z,u,U,J,v,f,w,R,S)}}W.NO_LOGGING=0,W.MINIMAL_LOGGING=1,W.SUMMARY_LOGGING=2,W.DETAILED_LOGGING=3,W.OnPluginActivatedObservable=E},14154:(z,u,U)=>{"use strict";U.d(u,{b:()=>mz});var J=U(12899),v=U(12901),f=U(12748),g=U(12914),w=U(12940),P=U(12894),R=U(12875),S=U(12756),d=U(12955);U(14159);class mz extends w.c{set boundingBoxSize(z){if(this._boundingBoxSize&&this._boundingBoxSize.equals(z))return;this._boundingBoxSize=z;const u=this.Vz();u&&u.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(z){this._rotationY=z,this.setReflectionTextureMatrix(g.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(z,u,U){let J="";for(const v of z)J+=v;return new mz(J,u,null,U,z)}static CreateFromPrefilteredData(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const v=u.useDelayedTextureLoading;u.useDelayedTextureLoading=!1;const f=new mz(z,u,null,!1,null,null,null,void 0,!0,U,J);return u.useDelayedTextureLoading=v,f}constructor(z,u){var U;let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,mz=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,A=arguments.length>10&&void 0!==arguments[10]&&arguments[10],E=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,C=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,r=arguments.length>13?arguments[13]:void 0,M=arguments.length>14?arguments[14]:void 0;super(u),this.onLoadObservable=new S.e,this.boundingBoxPosition=g.Eu.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new g.Matrix,this._buffer=null,this.name=z,this.url=z,this._noMipmap=v,this.kf=!1,this.isCube=!0,this._textureMatrix=g.Matrix.Identity(),this.coordinatesMode=P.e.CUBIC_MODE;let T=null,X=null;var h,t,V,L,O,x,Q,K,Y,p,N,D;null===J||Array.isArray(J)?(this._noMipmap=v,this._format=d,this._createPolynomials=A,T=J,this._loaderOptions=r,this._useSRGBBuffer=M,this._lodScale=E,this._lodOffset=C):(T=null!==(h=J.extensions)&&void 0!==h?h:null,this._noMipmap=null!==(t=J.noMipmap)&&void 0!==t&&t,f=null!==(V=J.files)&&void 0!==V?V:null,X=null!==(L=J.buffer)&&void 0!==L?L:null,this._format=null!==(O=J.format)&&void 0!==O?O:5,mz=null!==(x=J.prefiltered)&&void 0!==x&&x,Z=null!==(Q=J.forcedExtension)&&void 0!==Q?Q:null,this._createPolynomials=null!==(K=J.createPolynomials)&&void 0!==K&&K,this._lodScale=null!==(Y=J.lodScale)&&void 0!==Y?Y:.8,this._lodOffset=null!==(p=J.lodOffset)&&void 0!==p?p:0,this._loaderOptions=J.loaderOptions,this._useSRGBBuffer=J.useSRGBBuffer,w=null!==(N=J.G)&&void 0!==N?N:null,R=null!==(D=J.onError)&&void 0!==D?D:null);(z||f)&&this.updateURL(z,Z,w,mz,R,T,null===(U=this.Vz())||void 0===U?void 0:U.useDelayedTextureLoading,f,X)}getClassName(){return"CubeTexture"}updateURL(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=z),this.url=z,u&&(this._forcedExtension=u);const R=z.lastIndexOf("."),S=u||(R>-1?z.substring(R).toLowerCase():""),d=0===S.indexOf(".dds"),mz=0===S.indexOf(".env"),Z=0===S.indexOf(".basis");if(mz?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=J,J&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),w)this._files=w;else if(Z||mz||d||f||(f=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,f){for(let u=0;u<f.length;u++)this._files.push(z+f[u]);this._extensions=f}this._buffer=P,g?(this.delayLoadState=4,this._delayedOnLoad=U,this._delayedOnError=v):this._loadTexture(U,v)}delayLoad(z){4===this.delayLoadState&&(z&&(this._forcedExtension=z),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(z){var u,U;if(z.updateFlag===this._textureMatrix.updateFlag)return;z.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(U=this.Vz())||void 0===U||U.markAllMaterialsAsDirty(1,(z=>-1!==z.getActiveTextures().indexOf(this))));if(this._textureMatrix=z,null===(u=this.Vz())||void 0===u||!u.useRightHandedSystem)return;const J=g.TmpVectors.Eu[0],v=g.TmpVectors.Quaternion[0],f=g.TmpVectors.Eu[1];this._textureMatrix.decompose(J,v,f),v.z*=-1,v.w*=-1,g.Matrix.ComposeToRef(J,v,f,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var z;return null!==(z=this.Vz())&&void 0!==z&&z.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=this.Vz(),J=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const v=()=>{var u;(this.onLoadObservable.notifyObservers(this),J)&&(J.dispose(),null===(u=this.Vz())||void 0===u||u.markAllMaterialsAsDirty(1));z&&z()},g=(z,U)=>{this._loadingError=!0,this._errorObject={message:z,exception:U},u&&u(z,U),P.e.OnTextureLoadErrorObservable.notifyObservers(this)};var w;this._texture?this._texture.isReady?f.Tools.SetImmediate((()=>v())):this._texture.onLoadedObservable.add((()=>v())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,U,this._lodScale,this._lodOffset,z,g,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,U,this._files,this._noMipmap,z,g,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(w=this._texture)||void 0===w||w.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(z,u,U){const J=d.b.Parse((()=>{var J;let v=!1;return z.prefiltered&&(v=z.prefiltered),new mz(U+(null!==(J=z.url)&&void 0!==J?J:z.name),u,z.extensions,!1,z.files||null,null,null,void 0,v,z.forcedExtension)}),z,u);if(z.boundingBoxPosition&&(J.boundingBoxPosition=g.Eu.Xu(z.boundingBoxPosition)),z.boundingBoxSize&&(J.boundingBoxSize=g.Eu.Xu(z.boundingBoxSize)),z.animations)for(let v=0;v<z.animations.length;v++){const u=z.animations[v],U=(0,R.e)("BABYLON.Animation");U&&J.animations.push(U.Parse(u))}return J}clone(){let z=0;const u=d.b.Clone((()=>{const u=new mz(this.url,this.Vz()||this._getEngine(),this._extensions,this._noMipmap,this._files);return z=u.uniqueId,u}),this);return u.uniqueId=z,u}}(0,J.b)([(0,v.K)()],mz.prototype,"url",void 0),(0,J.b)([(0,v.G)()],mz.prototype,"boundingBoxPosition",void 0),(0,J.b)([(0,v.G)()],mz.prototype,"boundingBoxSize",null),(0,J.b)([(0,v.K)("rotationY")],mz.prototype,"rotationY",null),(0,J.b)([(0,v.K)("files")],mz.prototype,"_files",void 0),(0,J.b)([(0,v.K)("forcedExtension")],mz.prototype,"_forcedExtension",void 0),(0,J.b)([(0,v.K)("extensions")],mz.prototype,"_extensions",void 0),(0,J.b)([(0,v.v)("textureMatrix")],mz.prototype,"_textureMatrix",void 0),(0,J.b)([(0,v.v)("textureMatrixRefraction")],mz.prototype,"_textureMatrixRefraction",void 0),P.e._CubeTextureParser=mz.Parse,(0,R.f)("BABYLON.CubeTexture",mz)},14737:(z,u,U)=>{"use strict";U.d(u,{e:()=>P});var J=U(12760),v=U(12894),f=U(12882),g=U(13054),w=U(12853);g.ThinEngine.prototype.createDynamicTexture=function(z,u,U,J){const v=new w.c(this,4);return v.baseWidth=z,v.baseHeight=u,U&&(z=this.needPOTTextures?(0,f.c)(z,this._caps.maxTextureSize):z,u=this.needPOTTextures?(0,f.c)(u,this._caps.maxTextureSize):u),v.width=z,v.height=u,v.isReady=!1,v.generateMipMaps=U,v.samplingMode=J,this.updateTextureSamplingMode(J,v),this._internalTexturesCache.push(v),v},g.ThinEngine.prototype.updateDynamicTexture=function(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!z)return;const g=this._gl,w=g.TEXTURE_2D,P=this._bindTextureDirectly(w,z,!0,f);this._unpackFlipY(void 0===U?z.invertY:U),J&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const R=this._getWebGLTextureType(z.type),S=this._getInternalFormat(v||z.format),d=this._getRGBABufferInternalSizedFormat(z.type,S);g.texImage2D(w,0,d,S,R,u),z.generateMipMaps&&g.generateMipmap(w),P||this._bindTextureDirectly(w,null),J&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),v&&(z.format=v),z._dynamicTextureSource=u,z._premulAlpha=J,z.invertY=U||!1,z.isReady=!0};class P extends v.e{constructor(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,w=arguments.length>6?arguments[6]:void 0;const P=!U||U._isScene;super(null,P?U:null===U||void 0===U?void 0:U.ru,P?!J:U,w,f,void 0,void 0,void 0,void 0,g),this.name=z,this.wrapU=v.e.CLAMP_ADDRESSMODE,this.wrapV=v.e.CLAMP_ADDRESSMODE,this._generateMipMaps=J;const R=this._getEngine();if(!R)return;if(u.getContext)this._canvas=u,this._ownCanvas=!1,this._texture=R.createDynamicTexture(this._canvas.width,this._canvas.height,J,f);else{this._canvas=R.createCanvas(1,1),this._ownCanvas=!0;const z=u;z.width||0===z.width?this._texture=R.createDynamicTexture(z.width,z.height,J,f):this._texture=R.createDynamicTexture(u,u,J,f)}const S=this.getSize();this._canvas.width!==S.width&&(this._canvas.width=S.width),this._canvas.height!==S.height&&(this._canvas.height=S.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(z){this._canvas.width=z.width,this._canvas.height=z.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(z.width,z.height,this._generateMipMaps,this.samplingMode)}scale(z){const u=this.getSize();u.width*=z,u.height*=z,this._recreate(u)}scaleTo(z,u){const U=this.getSize();U.width=z,U.height=u,this._recreate(U)}getContext(){return this._context}clear(z){const u=this.getSize();z&&(this._context.fillStyle=z),this._context.clearRect(0,0,u.width,u.height)}update(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===z||z,u,this._format||void 0,void 0,U)}drawText(z,u,U,J,v,f,g){let w=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const P=this.getSize();if(f&&(this._context.fillStyle=f,this._context.fillRect(0,0,P.width,P.height)),this._context.font=J,null===u||void 0===u){const U=this._context.measureText(z);u=(P.width-U.width)/2}if(null===U||void 0===U){const z=parseInt(J.replace(/\D/g,""));U=P.height/2+z/3.65}this._context.fillStyle=v||"",this._context.fillText(z,u,U),w&&this.update(g)}dispose(){var z,u;(super.dispose(),this._ownCanvas)&&(null===(z=this._canvas)||void 0===z||null===(u=z.remove)||void 0===u||u.call(z));this._canvas=null,this._context=null}clone(){const z=this.Vz();if(!z)return this;const u=this.getSize(),U=new P(this.name,u,z,this._generateMipMaps);return U.kf=this.kf,U.level=this.level,U.wrapU=this.wrapU,U.wrapV=this.wrapV,U}serialize(){const z=this.Vz();z&&!z.isReady()&&J.d.Warn("The scene must be ready before serializing the dynamic texture");const u=super.serialize();return P._IsCanvasElement(this._canvas)&&(u.base64String=this._canvas.toDataURL()),u.invertY=this._invertY,u.samplingMode=this.samplingMode,u}static _IsCanvasElement(z){return void 0!==z.toDataURL}_rebuild(){this.update()}}},14081:(z,u,U)=>{"use strict";U.d(u,{e:()=>v});var J=U(12894);class v extends J.e{get depth(){return this._depth}constructor(z,u,U,v,f,g){let w=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],P=arguments.length>7&&void 0!==arguments[7]&&arguments[7],R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:J.e.TRILINEAR_SAMPLINGMODE,S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,d=arguments.length>10?arguments[10]:void 0;super(null,g,!w,P),this.format=f,this._texture=g.getEngine().createRawTexture2DArray(z,u,U,v,f,w,P,R,null,S,d),this._depth=v,this.is2DArray=!0}update(z){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,z,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(z,u,U,J,f){return new v(z,u,U,J,5,f,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13869:(z,u,U)=>{"use strict";U.d(u,{d:()=>w,g:()=>P,j:()=>f,m:()=>g});var J=U(12935),v=U(12914);function f(z,u){return"{X: ".concat(z.x.toFixed(u)," Y: ").concat(z.y.toFixed(u),"}")}function g(z,u){return"{X: ".concat(z._x.toFixed(u)," Y: ").concat(z._y.toFixed(u)," Z: ").concat(z._z.toFixed(u),"}")}function w(z,u){return 2*Math.acos((0,J.Clamp)(v.Quaternion.Dot(z,u)))}function P(z,u){const U=new v.Quaternion;return function(z,u,U){const f=v.Eu.Cross(z,u),g=Math.acos((0,J.Clamp)(v.Eu.Dot(z,u),-1,1));v.Quaternion.RotationAxisToRef(f,g,U)}(z,u,U),U}},13706:(z,u,U)=>{"use strict";U.d(u,{d:()=>R});var J=U(12914),v=U(12967),f=U(13335),g=U(13322),w=U(12982);U(13710);function P(z){let u=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const U=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],f=[];let P=[];const R=z.width||z.size||1,S=z.height||z.size||1,d=z.depth||z.size||1,mz=z.wrap||!1;let Z=void 0===z.topBaseAt?1:z.topBaseAt,A=void 0===z.bottomBaseAt?0:z.bottomBaseAt;Z=(Z+4)%4,A=(A+4)%4;let E=[2,0,3,1][Z],C=[2,0,1,3][A],r=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(mz){u=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],r=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let z=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],U=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const J=[17,18,19,16],v=[22,23,20,21];for(;E>0;)z.unshift(z.pop()),J.unshift(J.pop()),E--;for(;C>0;)U.unshift(U.pop()),v.unshift(v.pop()),C--;z=z.flat(),U=U.flat(),r=r.concat(z).concat(U),u.push(J[0],J[2],J[3],J[0],J[1],J[2]),u.push(v[0],v[2],v[3],v[0],v[1],v[2])}const M=[R/2,S/2,d/2];P=r.reduce(((z,u,U)=>z.concat(u*M[U%3])),[]);const T=0===z.sideOrientation?0:z.sideOrientation||g.e.DEFAULTSIDE,X=z.faceUV||new Array(6),h=z.faceColors,t=[];for(let g=0;g<6;g++)void 0===X[g]&&(X[g]=new J.Vector4(0,0,1,1)),h&&void 0===h[g]&&(h[g]=new v.wg(1,1,1,1));for(let J=0;J<6;J++)if(f.push(X[J].z,w.c?1-X[J].w:X[J].w),f.push(X[J].x,w.c?1-X[J].w:X[J].w),f.push(X[J].x,w.c?1-X[J].y:X[J].y),f.push(X[J].z,w.c?1-X[J].y:X[J].y),h)for(let z=0;z<4;z++)t.push(h[J].r,h[J].g,h[J].b,h[J].a);g.e._ComputeSides(T,P,u,U,f,z.frontUVs,z.backUVs);const V=new g.e;if(V.indices=u,V.Oz=P,V.xz=U,V.Kz=f,h){const z=T===g.e.DOUBLESIDE?t.concat(t):t;V.Qz=z}return V}function R(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new f.e(z,U);u.sideOrientation=f.e._GetDefaultSideOrientation(u.sideOrientation),J._originalBuilderSideOrientation=u.sideOrientation;return P(u).pz(J,u.updatable),J}g.e.CreateBox=P,f.e.CreateBox=function(z,u){return R(z,{size:u,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13858:(z,u,U)=>{"use strict";U.d(u,{e:()=>w});var J=U(13335),v=U(13322),f=U(12982);function g(z){const u=[],U=[],J=[],g=[],w=z.radius||.5,P=z.tessellation||64,R=z.arc&&(z.arc<=0||z.arc>1)?1:z.arc||1,S=0===z.sideOrientation?0:z.sideOrientation||v.e.DEFAULTSIDE;u.push(0,0,0),g.push(.5,.5);const d=2*Math.PI*R,mz=1===R?d/P:d/(P-1);let Z=0;for(let v=0;v<P;v++){const z=Math.cos(Z),U=Math.sin(Z),J=(z+1)/2,v=(1-U)/2;u.push(w*z,w*U,0),g.push(J,f.c?1-v:v),Z+=mz}1===R&&(u.push(u[3],u[4],u[5]),g.push(g[2],f.c?1-g[3]:g[3]));const A=u.length/3;for(let v=1;v<A-1;v++)U.push(v+1,0,v);v.e.ComputeNormals(u,U,J),v.e._ComputeSides(S,u,U,J,g,z.frontUVs,z.backUVs);const E=new v.e;return E.indices=U,E.Oz=u,E.xz=J,E.Kz=g,E}function w(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new J.e(z,U);u.sideOrientation=J.e._GetDefaultSideOrientation(u.sideOrientation),v._originalBuilderSideOrientation=u.sideOrientation;return g(u).pz(v,u.updatable),v}v.e.CreateDisc=g,J.e.CreateDisc=function(z,u,U){return w(z,{radius:u,tessellation:U,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13710:(z,u,U)=>{"use strict";U.d(u,{f:()=>C,d:()=>M,i:()=>r});var J=U(12914),v=U(12967),f=U(13335),g=U(13322),w=U(13e3);f.e._GroundMeshParser=(z,u)=>P.Parse(z,u);class P extends f.e{constructor(z,u){super(z,u),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=z,this._subdivisionsY=z,this.subdivide(z);const U=this;U.createOrUpdateSubmeshesOctree&&U.createOrUpdateSubmeshesOctree(u)}getHeightAtCoordinates(z,u){const U=this.getWorldMatrix(),v=J.TmpVectors.Matrix[5];U.invertToRef(v);const f=J.TmpVectors.Eu[8];if(J.Eu.TransformCoordinatesFromFloatsToRef(z,0,u,v,f),z=f.x,u=f.z,z<this._minX||z>=this._maxX||u<=this._minZ||u>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const g=this._getFacetAt(z,u),w=-(g.x*z+g.z*u+g.w)/g.y;return J.Eu.TransformCoordinatesFromFloatsToRef(0,w,0,U,f),f.y}getNormalAtCoordinates(z,u){const U=new J.Eu(0,1,0);return this.getNormalAtCoordinatesToRef(z,u,U),U}getNormalAtCoordinatesToRef(z,u,U){const v=this.getWorldMatrix(),f=J.TmpVectors.Matrix[5];v.invertToRef(f);const g=J.TmpVectors.Eu[8];if(J.Eu.TransformCoordinatesFromFloatsToRef(z,0,u,f,g),z=g.x,u=g.z,z<this._minX||z>this._maxX||u<this._minZ||u>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const w=this._getFacetAt(z,u);return J.Eu.TransformNormalFromFloatsToRef(w.x,w.y,w.z,v,U),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(z,u){const U=Math.floor((z+this._maxX)*this._subdivisionsX/this._width),J=Math.floor(-(u+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),v=this._heightQuads[J*this._subdivisionsX+U];let f;return f=u<v.slope.x*z+v.slope.y?v.facet1:v.facet2,f}_initHeightQuads(){const z=this._subdivisionsX,u=this._subdivisionsY;this._heightQuads=[];for(let U=0;U<u;U++)for(let u=0;u<z;u++){const v={slope:J.Vector2.Zero(),facet1:new J.Vector4(0,0,0,0),facet2:new J.Vector4(0,0,0,0)};this._heightQuads[U*z+u]=v}return this}_computeHeightQuads(){const z=this.getVerticesData(w.g.PositionKind);if(!z)return this;const u=J.TmpVectors.Eu[3],U=J.TmpVectors.Eu[2],v=J.TmpVectors.Eu[1],f=J.TmpVectors.Eu[0],g=J.TmpVectors.Eu[4],P=J.TmpVectors.Eu[5],R=J.TmpVectors.Eu[6],S=J.TmpVectors.Eu[7],d=J.TmpVectors.Eu[8];let mz=0,Z=0,A=0,E=0,C=0,r=0,M=0;const T=this._subdivisionsX,X=this._subdivisionsY;for(let w=0;w<X;w++)for(let X=0;X<T;X++){mz=3*X,Z=w*(T+1)*3,A=(w+1)*(T+1)*3,u.x=z[Z+mz],u.y=z[Z+mz+1],u.z=z[Z+mz+2],U.x=z[Z+mz+3],U.y=z[Z+mz+4],U.z=z[Z+mz+5],v.x=z[A+mz],v.y=z[A+mz+1],v.z=z[A+mz+2],f.x=z[A+mz+3],f.y=z[A+mz+4],f.z=z[A+mz+5],E=(f.z-u.z)/(f.x-u.x),C=u.z-E*u.x,U.subtractToRef(u,g),v.subtractToRef(u,P),f.subtractToRef(u,R),J.Eu.CrossToRef(R,P,S),J.Eu.CrossToRef(g,R,d),S.normalize(),d.normalize(),r=-(S.x*u.x+S.y*u.y+S.z*u.z),M=-(d.x*U.x+d.y*U.y+d.z*U.z);const h=this._heightQuads[w*T+X];h.slope.zg(E,C),h.facet1.zg(S.x,S.y,S.z,r),h.facet2.zg(d.x,d.y,d.z,M)}return this}serialize(z){super.serialize(z),z.subdivisionsX=this._subdivisionsX,z.subdivisionsY=this._subdivisionsY,z.minX=this._minX,z.maxX=this._maxX,z.Bf=this._minZ,z.maxZ=this._maxZ,z.width=this._width,z.height=this._height}static Parse(z,u){const U=new P(z.name,u);return U._subdivisionsX=z.subdivisionsX||1,U._subdivisionsY=z.subdivisionsY||1,U._minX=z.minX,U._maxX=z.maxX,U._minZ=z.Bf,U._maxZ=z.maxZ,U._width=z.width,U._height=z.height,U}}var R=U(12748),S=U(12797),d=U(12917),mz=U(12982);function Z(z){const u=[],U=[],v=[],f=[];let w,P;const R=z.width||z.size||1,S=z.height||z.size||1,d=0|(z.subdivisionsX||z.subdivisions||1),Z=0|(z.subdivisionsY||z.subdivisions||1);for(w=0;w<=Z;w++)for(P=0;P<=d;P++){const z=new J.Eu(P*R/d-R/2,0,(Z-w)*S/Z-S/2),u=new J.Eu(0,1,0);U.push(z.x,z.y,z.z),v.push(u.x,u.y,u.z),f.push(P/d,mz.c?w/Z:1-w/Z)}for(w=0;w<Z;w++)for(P=0;P<d;P++)u.push(P+1+(w+1)*(d+1)),u.push(P+1+w*(d+1)),u.push(P+w*(d+1)),u.push(P+(w+1)*(d+1)),u.push(P+1+(w+1)*(d+1)),u.push(P+w*(d+1));const A=new g.e;return A.indices=u,A.Oz=U,A.xz=v,A.Kz=f,A}function A(z){const u=void 0!==z.xmin&&null!==z.xmin?z.xmin:-1,U=void 0!==z.zmin&&null!==z.zmin?z.zmin:-1,v=void 0!==z.xmax&&null!==z.xmax?z.xmax:1,f=void 0!==z.zmax&&null!==z.zmax?z.zmax:1,w=z.subdivisions||{w:1,h:1},P=z.precision||{w:1,h:1},R=[],S=[],d=[],mz=[];let Z,A,E,C;w.h=w.h<1?1:w.h,w.w=w.w<1?1:w.w,P.w=P.w<1?1:P.w,P.h=P.h<1?1:P.h;const r=(v-u)/w.w,M=(f-U)/w.h;function T(z,u,U,v){const f=S.length/3,g=P.w+1;for(Z=0;Z<P.h;Z++)for(A=0;A<P.w;A++){const z=[f+A+Z*g,f+(A+1)+Z*g,f+(A+1)+(Z+1)*g,f+A+(Z+1)*g];R.push(z[1]),R.push(z[2]),R.push(z[3]),R.push(z[0]),R.push(z[1]),R.push(z[3])}const w=J.Eu.Zero(),E=new J.Eu(0,1,0);for(Z=0;Z<=P.h;Z++)for(w.z=Z*(v-u)/P.h+u,A=0;A<=P.w;A++)w.x=A*(U-z)/P.w+z,w.y=0,S.push(w.x,w.y,w.z),d.push(E.x,E.y,E.z),mz.push(A/P.w,Z/P.h)}for(E=0;E<w.h;E++)for(C=0;C<w.w;C++)T(u+C*r,U+E*M,u+(C+1)*r,U+(E+1)*M);const X=new g.e;return X.indices=R,X.Oz=S,X.xz=d,X.Kz=mz,X}function E(z){const u=[],U=[],f=[],w=[];let P,R;const S=z.colorFilter||new v.Tu(.3,.59,.11),mz=z.alphaFilter||0;let Z=!1;if(z.minHeight>z.maxHeight){Z=!0;const u=z.maxHeight;z.maxHeight=z.minHeight,z.minHeight=u}for(P=0;P<=z.subdivisions;P++)for(R=0;R<=z.subdivisions;R++){const u=new J.Eu(R*z.width/z.subdivisions-z.width/2,0,(z.subdivisions-P)*z.height/z.subdivisions-z.height/2),v=4*(((u.x+z.width/2)/z.width*(z.bufferWidth-1)|0)+((1-(u.z+z.height/2)/z.height)*(z.bufferHeight-1)|0)*z.bufferWidth);let g=z.buffer[v]/255,A=z.buffer[v+1]/255,E=z.buffer[v+2]/255;const C=z.buffer[v+3]/255;Z&&(g=1-g,A=1-A,E=1-E);const r=g*S.r+A*S.g+E*S.b;u.y=C>=mz?z.minHeight+(z.maxHeight-z.minHeight)*r:z.minHeight-d.d,z.heightBuffer&&(z.heightBuffer[P*(z.subdivisions+1)+R]=u.y),U.push(u.x,u.y,u.z),f.push(0,0,0),w.push(R/z.subdivisions,1-P/z.subdivisions)}for(P=0;P<z.subdivisions;P++)for(R=0;R<z.subdivisions;R++){const J=R+1+(P+1)*(z.subdivisions+1),v=R+1+P*(z.subdivisions+1),f=R+P*(z.subdivisions+1),g=R+(P+1)*(z.subdivisions+1),w=U[3*J+1]>=z.minHeight,S=U[3*v+1]>=z.minHeight,d=U[3*f+1]>=z.minHeight;w&&S&&d&&(u.push(J),u.push(v),u.push(f));U[3*g+1]>=z.minHeight&&w&&d&&(u.push(g),u.push(J),u.push(f))}g.e.ComputeNormals(U,u,f);const A=new g.e;return A.indices=u,A.Oz=U,A.xz=f,A.Kz=w,A}function C(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const U=new P(z,arguments.length>2?arguments[2]:void 0);U._setReady(!1),U._subdivisionsX=u.subdivisionsX||u.subdivisions||1,U._subdivisionsY=u.subdivisionsY||u.subdivisions||1,U._width=u.width||1,U._height=u.height||1,U._maxX=U._width/2,U._maxZ=U._height/2,U._minX=-U._maxX,U._minZ=-U._maxZ;return Z(u).pz(U,u.updatable),U._setReady(!0),U}function r(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new f.e(z,U);return A(u).pz(J,u.updatable),J}function M(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const f=U.width||10,g=U.height||10,w=U.subdivisions||1,d=U.minHeight||0,mz=U.maxHeight||1,Z=U.colorFilter||new v.Tu(.3,.59,.11),A=U.alphaFilter||0,C=U.updatable,r=U.onReady;J=J||S.e.LastCreatedScene;const M=new P(z,J);let T;M._subdivisionsX=w,M._subdivisionsY=w,M._width=f,M._height=g,M._maxX=M._width/2,M._maxZ=M._height/2,M._minX=-M._maxX,M._minZ=-M._maxZ,M._setReady(!1),U.passHeightBufferInCallback&&(T=new Float32Array((w+1)*(w+1)));const X=(z,u,U)=>{E({width:f,height:g,subdivisions:w,minHeight:d,maxHeight:mz,colorFilter:Z,buffer:z,bufferWidth:u,bufferHeight:U,alphaFilter:A,heightBuffer:T}).pz(M,C),r&&r(M,T),M._setReady(!0)};if("string"===typeof u){const z=z=>{var u;const U=z.width,v=z.height;if(J.S)return;const f=null===(u=J)||void 0===u?void 0:u.getEngine().resizeImageBitmap(z,U,v);X(f,U,v)};R.Tools.LoadImage(u,z,U.onError?U.onError:()=>{},J.offlineProvider)}else X(u.data,u.width,u.height);return M}g.e.CreateGround=Z,g.e.CreateTiledGround=A,g.e.CreateGroundFromHeightMap=E,f.e.CreateGround=(z,u,U,J,v,f)=>C(z,{width:u,height:U,subdivisions:J,updatable:f},v),f.e.CreateTiledGround=(z,u,U,J,v,f,g,w,P)=>r(z,{xmin:u,zmin:U,xmax:J,zmax:v,subdivisions:f,precision:g,updatable:P},w),f.e.CreateGroundFromHeightMap=(z,u,U,J,v,f,g,w,P,R,S)=>M(z,u,{width:U,height:J,subdivisions:v,minHeight:f,maxHeight:g,updatable:P,onReady:R,alphaFilter:S},w)},14319:(z,u,U)=>{"use strict";U.d(u,{d:()=>Z,h:()=>d,i:()=>mz});var J=U(12914),v=U(13335),f=U(13322),g=U(13431),w=U(13e3),P=U(12760);function R(z){const u=[],U=[],J=z.lines,v=z.Qz,g=[];let w=0;for(let f=0;f<J.length;f++){const z=J[f];for(let J=0;J<z.length;J++){const{x:P,y:R,z:S}=z[J];if(U.push(P,R,S),v){const z=v[f],{r:u,g:U,b:w,a:P}=z[J];g.push(u,U,w,P)}J>0&&(u.push(w-1),u.push(w)),w++}}const P=new f.e;return P.indices=u,P.Oz=U,v&&(P.Qz=g),P}function S(z){const u=z.dashSize||3,U=z.gapSize||1,v=z.dashNb||200,g=z.points,w=[],P=[],R=J.Eu.Zero();let S=0,d=0,mz=0,Z=0,A=0,E=0,C=0;for(C=0;C<g.length-1;C++)g[C+1].subtractToRef(g[C],R),S+=R.length();for(mz=S/v,Z=u*mz/(u+U),C=0;C<g.length-1;C++){g[C+1].subtractToRef(g[C],R),d=Math.floor(R.length()/mz),R.normalize();for(let z=0;z<d;z++)A=mz*z,w.push(g[C].x+A*R.x,g[C].y+A*R.y,g[C].z+A*R.z),w.push(g[C].x+(A+Z)*R.x,g[C].y+(A+Z)*R.y,g[C].z+(A+Z)*R.z),P.push(E,E+1),E+=2}const r=new f.e;return r.Oz=w,r.indices=P,r}function d(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=u.instance,v=u.lines,f=u.Qz;if(J){const z=J.getVerticesData(w.g.PositionKind);let u,U;f&&(u=J.getVerticesData(w.g.ColorKind));let g=0,P=0;for(let J=0;J<v.length;J++){const w=v[J];for(let v=0;v<w.length;v++)z[g]=w[v].x,z[g+1]=w[v].y,z[g+2]=w[v].z,f&&u&&(U=f[J],u[P]=U[v].r,u[P+1]=U[v].g,u[P+2]=U[v].b,u[P+3]=U[v].a,P+=4),g+=3}return J.updateVerticesData(w.g.PositionKind,z,!1,!1),f&&u&&J.updateVerticesData(w.g.ColorKind,u,!1,!1),J.refreshBoundingInfo(),J}const P=!!f,S=new g.b(z,U,null,void 0,void 0,P,u.useVertexAlpha,u.material);return R(u).pz(S,u.updatable),S}function mz(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=u.Qz?[u.Qz]:null;return d(z,{lines:[u.points],updatable:u.updatable,instance:u.instance,Qz:J,useVertexAlpha:u.useVertexAlpha,material:u.material},U)}function Z(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=u.points,w=u.instance,R=u.gapSize||1,d=u.dashSize||3;if(w){const z=z=>{const u=J.Eu.Zero(),U=z.length/6;let v=0,g=0,P=0,R=0,S=0,d=0,mz=0,Z=0;for(mz=0;mz<f.length-1;mz++)f[mz+1].subtractToRef(f[mz],u),v+=u.length();P=v/U;const A=w._creationDataStorage.dashSize;for(R=A*P/(A+w._creationDataStorage.gapSize),mz=0;mz<f.length-1;mz++)for(f[mz+1].subtractToRef(f[mz],u),g=Math.floor(u.length()/P),u.normalize(),Z=0;Z<g&&d<z.length;)S=P*Z,z[d]=f[mz].x+S*u.x,z[d+1]=f[mz].y+S*u.y,z[d+2]=f[mz].z+S*u.z,z[d+3]=f[mz].x+(S+R)*u.x,z[d+4]=f[mz].y+(S+R)*u.y,z[d+5]=f[mz].z+(S+R)*u.z,d+=6,Z++;for(;d<z.length;)z[d]=f[mz].x,z[d+1]=f[mz].y,z[d+2]=f[mz].z,d+=3};return(u.dashNb||u.dashSize||u.gapSize||u.useVertexAlpha||u.material)&&P.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),w.updateMeshPositions(z,!1),w}const mz=new g.b(z,U,null,void 0,void 0,void 0,u.useVertexAlpha,u.material);return S(u).pz(mz,u.updatable),mz._creationDataStorage=new v.h,mz._creationDataStorage.dashSize=d,mz._creationDataStorage.gapSize=R,mz}f.e.CreateLineSystem=R,f.e.CreateDashedLines=S,v.e.zS=function(z,u){return mz(z,{points:u,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},v.e.CreateDashedLines=function(z,u,U,J,v){return Z(z,{points:u,dashSize:U,gapSize:J,dashNb:v,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13760:(z,u,U)=>{"use strict";U.d(u,{c:()=>w,f:()=>P});var J=U(13335),v=U(13322),f=U(12982);function g(z){const u=[],U=[],J=[],g=[],w=void 0!==z.width?z.width:void 0!==z.size?z.size:1,P=void 0!==z.height?z.height:void 0!==z.size?z.size:1,R=0===z.sideOrientation?0:z.sideOrientation||v.e.DEFAULTSIDE,S=w/2,d=P/2;U.push(-S,-d,0),J.push(0,0,-1),g.push(0,f.c?1:0),U.push(S,-d,0),J.push(0,0,-1),g.push(1,f.c?1:0),U.push(S,d,0),J.push(0,0,-1),g.push(1,f.c?0:1),U.push(-S,d,0),J.push(0,0,-1),g.push(0,f.c?0:1),u.push(0),u.push(1),u.push(2),u.push(0),u.push(2),u.push(3),v.e._ComputeSides(R,U,u,J,g,z.frontUVs,z.backUVs);const mz=new v.e;return mz.indices=u,mz.Oz=U,mz.xz=J,mz.Kz=g,mz}function w(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new J.e(z,U);u.sideOrientation=J.e._GetDefaultSideOrientation(u.sideOrientation),v._originalBuilderSideOrientation=u.sideOrientation;return g(u).pz(v,u.updatable),u.sourcePlane&&(v.translate(u.sourcePlane.normal,-u.sourcePlane.d),v.setDirection(u.sourcePlane.normal.scale(-1))),v}const P={JS:w};v.e.JS=g,J.e.JS=(z,u,U,J,v)=>w(z,{size:u,width:u,height:u,sideOrientation:v,updatable:J},U)},13846:(z,u,U)=>{"use strict";U.d(u,{c:()=>P});var J=U(12914),v=U(13335),f=U(13322),g=U(12982);function w(z){const u=0|(z.segments||32),U=z.diameterX||z.diameter||1,v=z.diameterY||z.diameter||1,w=z.diameterZ||z.diameter||1,P=z.arc&&(z.arc<=0||z.arc>1)?1:z.arc||1,R=z.slice&&z.slice<=0?1:z.slice||1,S=0===z.sideOrientation?0:z.sideOrientation||f.e.DEFAULTSIDE,d=!!z.dedupTopBottomIndices,mz=new J.Eu(U/2,v/2,w/2),Z=2+u,A=2*Z,E=[],C=[],r=[],M=[];for(let f=0;f<=Z;f++){const z=f/Z,u=z*Math.PI*R;for(let U=0;U<=A;U++){const v=U/A,f=v*Math.PI*2*P,w=J.Matrix.RotationZ(-u),R=J.Matrix.RotationY(f),S=J.Eu.TransformCoordinates(J.Eu.Up(),w),d=J.Eu.TransformCoordinates(S,R),Z=d.multiply(mz),E=d.divide(mz).normalize();C.push(Z.x,Z.y,Z.z),r.push(E.x,E.y,E.z),M.push(v,g.c?1-z:z)}if(f>0){const z=C.length/3;for(let u=z-2*(A+1);u+A+2<z;u++)d?(f>1&&(E.push(u),E.push(u+1),E.push(u+A+1)),(f<Z||R<1)&&(E.push(u+A+1),E.push(u+1),E.push(u+A+2))):(E.push(u),E.push(u+1),E.push(u+A+1),E.push(u+A+1),E.push(u+1),E.push(u+A+2))}}f.e._ComputeSides(S,C,E,r,M,z.frontUVs,z.backUVs);const T=new f.e;return T.indices=E,T.Oz=C,T.xz=r,T.Kz=M,T}function P(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new v.e(z,U);u.sideOrientation=v.e._GetDefaultSideOrientation(u.sideOrientation),J._originalBuilderSideOrientation=u.sideOrientation;return w(u).pz(J,u.updatable),J}f.e.CreateSphere=w,v.e.CreateSphere=(z,u,U,J,v,f)=>P(z,{segments:u,diameterX:U,diameterY:U,diameterZ:U,sideOrientation:f,updatable:v},J)},14743:(z,u,U)=>{"use strict";U.d(u,{b:()=>P});var J=U(21),v=U(13448),f=U(14166),g=U(13455),w=U(13322);class P{static get Configuration(){return{get decoder(){return f.e.DefaultConfiguration},set decoder(z){f.e.DefaultConfiguration=z}}}static set Configuration(z){f.e.DefaultConfiguration=z.decoder}static get DecoderAvailable(){return(0,v.l)(f.e.DefaultConfiguration)}static get Default(){var z;return null!==(z=P._Default)&&void 0!==z||(P._Default=new P),P._Default}static ResetDefault(z){P._Default&&(z||P._Default.dispose(),P._Default=null)}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P.DefaultNumWorkers;const u="number"===typeof z?(0,J.e)((0,J.e)({},f.e.DefaultConfiguration),{},{numWorkers:z}):(0,J.e)((0,J.e)({},f.e.DefaultConfiguration),z);this._decoder=new f.e(u)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(z,u,U){return this._decoder.decodeMeshToMeshDataAsync(z,u,U)}async decodeMeshToGeometryAsync(z,u,U,J){return await this._decoder.decodeMeshToGeometryAsync(z,u,U,J)}async _decodeMeshToGeometryForGltfAsync(z,u,U,J,v,f){return await this._decoder._decodeMeshToGeometryForGltfAsync(z,u,U,J,v,f)}async decodeMeshAsync(z,u){const U=await this._decoder.decodeMeshToMeshDataAsync(z,u),J=new w.e;U.indices&&(J.indices=U.indices);for(const v of U.attributes){const z=g.b.GetFloatData(v.data,v.size,g.b.GetDataType(v.data),v.byteOffset,v.byteStride,v.normalized,U.totalVertices);J.set(z,v.kind)}return J}}P.DefaultNumWorkers=(0,v.h)(),P._Default=null},14166:(z,u,U)=>{"use strict";U.d(u,{e:()=>R});var J=U(13448),v=U(12748),f=U(13340),g=U(13455),w=U(12760),P=U(13452);class R extends J.d{static get DefaultAvailable(){return(0,J.l)(R.DefaultConfiguration)}static get Default(){var z;return null!==(z=R._Default)&&void 0!==z||(R._Default=new R),R._Default}static ResetDefault(z){R._Default&&(z||R._Default.dispose(),R._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(z,u){return{module:await(u||DracoDecoderModule)({wasmBinary:z})}}_getWorkerContent(){return"".concat(P.c,"(").concat(P.g,")()")}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.DefaultConfiguration)}decodeMeshToMeshDataAsync(z,u,U){const J=z instanceof ArrayBuffer?new Int8Array(z):new Int8Array(z.buffer,z.byteOffset,z.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async z=>await new Promise(((v,f)=>{z.push(((z,g)=>{let P=null;const R=[],S=u=>{z.removeEventListener("error",S),z.removeEventListener("message",d),f(u),g()},d=u=>{const J=u.data;switch(J.id){case"indices":P=J.data;break;case"attribute":R.push({kind:J.kind,data:J.data,size:J.size,byteOffset:J.byteOffset,byteStride:J.byteStride,normalized:(f=J.kind,mz=J.normalized,U&&void 0!==U[f]?(mz!==U[f]&&w.d.Warn("Normalized flag from Draco data (".concat(mz,") does not match normalized flag from glTF accessor (").concat(U[f],"). Using flag from glTF accessor.")),U[f]):mz)});break;case"decodeMeshDone":z.removeEventListener("error",S),z.removeEventListener("message",d),v({indices:P,attributes:R,totalVertices:J.totalVertices}),g()}var f,mz};z.addEventListener("error",S),z.addEventListener("message",d);const mz=J.slice();z.postMessage({id:"decodeMesh",dataView:mz,attributes:u},[mz.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((z=>{let U=null;const v=[],f=(0,P.c)(z.module,J,u,(z=>{U=z}),((z,u,U,J,f,g)=>{v.push({kind:z,data:u,size:U,byteOffset:J,byteStride:f,normalized:g})}));return{indices:U,attributes:v,totalVertices:f}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(z,u,U,J){const v=await this.decodeMeshToMeshDataAsync(U,J),w=new f.d(z,u);v.indices&&w.setIndices(v.indices);for(const f of v.attributes)w.setVerticesBuffer(new g.b(u.getEngine(),f.data,f.kind,!1,void 0,f.byteStride,void 0,f.byteOffset,f.size,void 0,f.normalized,!0),v.totalVertices);return w}async _decodeMeshToGeometryForGltfAsync(z,u,U,J,v,w){const P=await this.decodeMeshToMeshDataAsync(U,J,v),R=new f.d(z,u);w&&(R._boundingInfo=w,R.useBoundingInfoFromGeometry=!0),P.indices&&R.setIndices(P.indices);for(const f of P.attributes)R.setVerticesBuffer(new g.b(u.getEngine(),f.data,f.kind,!1,void 0,f.byteStride,void 0,f.byteOffset,f.size,void 0,f.normalized,!0),P.totalVertices);return R}}R.DefaultConfiguration={wasmUrl:"".concat(v.Tools._DefaultCdnUrl,"/draco_wasm_wrapper_gltf.js"),wasmBinaryUrl:"".concat(v.Tools._DefaultCdnUrl,"/draco_decoder_gltf.wasm"),fallbackUrl:"".concat(v.Tools._DefaultCdnUrl,"/draco_decoder_gltf.js")},R._Default=null},14313:(z,u,U)=>{"use strict";U.d(u,{c:()=>wz});var J=U(12914),v=U(13335),f=U(13e3),g=U(13322),w=U(12982);function P(z){let u=z.pathArray;const U=z.closeArray||!1,J=z.closePath||!1,v=z.invertUV||!1,P=Math.floor(u[0].length/2);let R=z.offset||P;R=R>P?P:Math.floor(R);const S=0===z.sideOrientation?0:z.sideOrientation||g.e.DEFAULTSIDE,d=z.Kz,mz=z.Qz,Z=[],A=[],E=[],C=[],r=[],M=[],T=[],X=[];let h;const t=[],V=[];let L,O,x;if(u.length<2){const z=[],U=[];for(O=0;O<u[0].length-R;O++)z.push(u[0][O]),U.push(u[0][O+R]);u=[z,U]}let Q=0;const K=J?1:0,Y=U?1:0;let p,N,D,c,W,j;for(h=u[0].length,L=0;L<u.length+Y;L++){for(T[L]=0,r[L]=[0],p=L===u.length?u[0]:u[L],N=p.length,h=h<N?h:N,x=0;x<N;)Z.push(p[x].x,p[x].y,p[x].z),x>0&&(D=p[x].Cu(p[x-1]).length(),c=D+T[L],r[L].push(c),T[L]=c),x++;J&&(x--,Z.push(p[0].x,p[0].y,p[0].z),D=p[x].Cu(p[0]).length(),c=D+T[L],r[L].push(c),T[L]=c),t[L]=N+K,V[L]=Q,Q+=N+K}let I,F,b=null,k=null;for(O=0;O<h+K;O++)for(X[O]=0,M[O]=[0],L=0;L<u.length-1+Y;L++)W=u[L],j=L===u.length-1?u[0]:u[L+1],O===h?(b=W[0],k=j[0]):(b=W[O],k=j[O]),D=k.Cu(b).length(),c=D+X[O],M[O].push(c),X[O]=c;if(d)for(L=0;L<d.length;L++)C.push(d[L].x,w.c?1-d[L].y:d[L].y);else for(L=0;L<u.length+Y;L++)for(O=0;O<h+K;O++)I=0!=T[L]?r[L][O]/T[L]:0,F=0!=X[O]?M[O][L]/X[O]:0,v?C.push(F,I):C.push(I,w.c?1-F:F);L=0;let B=0,y=t[L]-1,H=t[L+1]-1,G=y<H?y:H,a=V[1]-V[0];const i=t.length-1;for(;B<=G&&L<i;)A.push(B,B+a,B+1),A.push(B+a+1,B+1,B+a),B+=1,B===G&&(L++,a=V[L+1]-V[L],y=t[L]-1,H=t[L+1]-1,B=V[L],G=y<H?y+B:H+B);if(g.e.ComputeNormals(Z,A,E),J){let z=0,U=0;for(L=0;L<u.length;L++){z=3*V[L],U=L+1<u.length?3*(V[L+1]-1):E.length-3,E[z]=.5*(E[z]+E[U]),E[z+1]=.5*(E[z+1]+E[U+1]),E[z+2]=.5*(E[z+2]+E[U+2]);const J=Math.sqrt(E[z]*E[z]+E[z+1]*E[z+1]+E[z+2]*E[z+2]);E[z]/=J,E[z+1]/=J,E[z+2]/=J,E[U]=E[z],E[U+1]=E[z+1],E[U+2]=E[z+2]}}if(U){let z=3*V[0],U=3*V[u.length];for(O=0;O<h+K;O++){E[z]=.5*(E[z]+E[U]),E[z+1]=.5*(E[z+1]+E[U+1]),E[z+2]=.5*(E[z+2]+E[U+2]);const u=Math.sqrt(E[z]*E[z]+E[z+1]*E[z+1]+E[z+2]*E[z+2]);E[z]/=u,E[z+1]/=u,E[z+2]/=u,E[U]=E[z],E[U+1]=E[z+1],E[U+2]=E[z+2],z+=3,U+=3}}g.e._ComputeSides(S,Z,A,E,C,z.frontUVs,z.backUVs);let n=null;if(mz){n=new Float32Array(4*mz.length);for(let z=0;z<mz.length;z++)n[4*z]=mz[z].r,n[4*z+1]=mz[z].g,n[4*z+2]=mz[z].b,n[4*z+3]=mz[z].a}const q=new g.e,o=new Float32Array(Z),s=new Float32Array(E),l=new Float32Array(C);return q.indices=A,q.Oz=o,q.xz=s,q.Kz=l,n&&q.set(n,f.g.ColorKind),J&&(q._idx=V),q}function R(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=u.pathArray,S=u.closeArray,d=u.closePath,mz=v.e._GetDefaultSideOrientation(u.sideOrientation),Z=u.instance,A=u.updatable;if(Z){const z=J.TmpVectors.Eu[0].fg(Number.MAX_VALUE),U=J.TmpVectors.Eu[1].fg(-Number.MAX_VALUE),P=u=>{let J=R[0].length;const f=Z;let g=0;const w=f._originalBuilderSideOrientation===v.e.DOUBLESIDE?2:1;for(let v=1;v<=w;++v)for(let w=0;w<R.length;++w){const v=R[w],P=v.length;J=J<P?J:P;for(let f=0;f<J;++f){const J=v[f];u[g]=J.x,u[g+1]=J.y,u[g+2]=J.z,z.minimizeInPlaceFromFloats(J.x,J.y,J.z),U.maximizeInPlaceFromFloats(J.x,J.y,J.z),g+=3}if(f._creationDataStorage&&f._creationDataStorage.closePath){const z=v[0];u[g]=z.x,u[g+1]=z.y,u[g+2]=z.z,g+=3}}},S=Z.getVerticesData(f.g.PositionKind);if(P(S),Z.hasBoundingInfo?Z.getBoundingInfo().reConstruct(z,U,Z._worldMatrix):Z.buildBoundingInfo(z,U,Z._worldMatrix),Z.updateVerticesData(f.g.PositionKind,S,!1,!1),u.Qz){const z=Z.getVerticesData(f.g.ColorKind);for(let U=0,J=0;U<u.Qz.length;U++,J+=4){const v=u.Qz[U];z[J]=v.r,z[J+1]=v.g,z[J+2]=v.b,z[J+3]=v.a}Z.updateVerticesData(f.g.ColorKind,z,!1,!1)}if(u.Kz){const z=Z.getVerticesData(f.g.UVKind);for(let U=0;U<u.Kz.length;U++)z[2*U]=u.Kz[U].x,z[2*U+1]=w.c?1-u.Kz[U].y:u.Kz[U].y;Z.updateVerticesData(f.g.UVKind,z,!1,!1)}if(!Z.areNormalsFrozen||Z.isFacetDataEnabled){const z=Z.lf(),u=Z.getVerticesData(f.g.NormalKind),U=Z.isFacetDataEnabled?Z.getFacetDataParameters():null;if(g.e.ComputeNormals(S,z,u,U),Z._creationDataStorage&&Z._creationDataStorage.closePath){let z=0,U=0;for(let J=0;J<R.length;J++)z=3*Z._creationDataStorage.idx[J],U=J+1<R.length?3*(Z._creationDataStorage.idx[J+1]-1):u.length-3,u[z]=.5*(u[z]+u[U]),u[z+1]=.5*(u[z+1]+u[U+1]),u[z+2]=.5*(u[z+2]+u[U+2]),u[U]=u[z],u[U+1]=u[z+1],u[U+2]=u[z+2]}Z.areNormalsFrozen||Z.updateVerticesData(f.g.NormalKind,u,!1,!1)}return Z}{const J=new v.e(z,U);J._originalBuilderSideOrientation=mz,J._creationDataStorage=new v.h;const f=P(u);return d&&(J._creationDataStorage.idx=f._idx),J._creationDataStorage.closePath=d,J._creationDataStorage.closeArray=S,f.pz(J,A),J}}g.e.CreateRibbon=P,v.e.CreateRibbon=function(z,u){return R(z,{pathArray:u,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var S=U(13858),d=U(13706),mz=U(12967);function Z(z){const u=z.pattern||v.e.NO_FLIP,U=z.tileWidth||z.tileSize||1,J=z.tileHeight||z.tileSize||1,f=z.alignHorizontal||0,w=z.alignVertical||0,P=z.width||z.size||1,R=Math.floor(P/U);let S=P-R*U;const d=z.height||z.size||1,mz=Math.floor(d/J);let Z=d-mz*J;const A=U*R/2,E=J*mz/2;let C=0,r=0,M=0,T=0,X=0,h=0;if(S>0||Z>0){switch(M=-A,T=-E,X=A,h=E,f){case v.e.CENTER:S/=2,M-=S,X+=S;break;case v.e.LEFT:X+=S,C=-S/2;break;case v.e.RIGHT:M-=S,C=S/2}switch(w){case v.e.CENTER:Z/=2,T-=Z,h+=Z;break;case v.e.BOTTOM:h+=Z,r=-Z/2;break;case v.e.TOP:T-=Z,r=Z/2}}const t=[],V=[],L=[];L[0]=[0,0,1,0,1,1,0,1],L[1]=[0,0,1,0,1,1,0,1],u!==v.e.ROTATE_TILE&&u!==v.e.ROTATE_ROW||(L[1]=[1,1,0,1,0,0,1,0]),u!==v.e.FLIP_TILE&&u!==v.e.FLIP_ROW||(L[1]=[1,0,0,0,0,1,1,1]),u!==v.e.FLIP_N_ROTATE_TILE&&u!==v.e.FLIP_N_ROTATE_ROW||(L[1]=[0,1,1,1,1,0,0,0]);let O=[];const x=[],Q=[];let K=0;for(let g=0;g<mz;g++)for(let z=0;z<R;z++)t.push(z*U-A+C,g*J-E+r,0),t.push((z+1)*U-A+C,g*J-E+r,0),t.push((z+1)*U-A+C,(g+1)*J-E+r,0),t.push(z*U-A+C,(g+1)*J-E+r,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),O=u===v.e.FLIP_TILE||u===v.e.ROTATE_TILE||u===v.e.FLIP_N_ROTATE_TILE?O.concat(L[(z%2+g%2)%2]):u===v.e.FLIP_ROW||u===v.e.ROTATE_ROW||u===v.e.FLIP_N_ROTATE_ROW?O.concat(L[g%2]):O.concat(L[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),K+=4;if(S>0||Z>0){const z=Z>0&&(w===v.e.CENTER||w===v.e.TOP),g=Z>0&&(w===v.e.CENTER||w===v.e.BOTTOM),P=S>0&&(f===v.e.CENTER||f===v.e.RIGHT),d=S>0&&(f===v.e.CENTER||f===v.e.LEFT);let L,Y,p,N,D=[];if(z&&P&&(t.push(M+C,T+r,0),t.push(-A+C,T+r,0),t.push(-A+C,T+Z+r,0),t.push(M+C,T+Z+r,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,L=1-S/U,Y=1-Z/J,p=1,N=1,D=[L,Y,p,Y,p,N,L,N],u===v.e.ROTATE_ROW&&(D=[1-L,1-Y,1-p,1-Y,1-p,1-N,1-L,1-N]),u===v.e.FLIP_ROW&&(D=[1-L,Y,1-p,Y,1-p,N,1-L,N]),u===v.e.FLIP_N_ROTATE_ROW&&(D=[L,1-Y,p,1-Y,p,1-N,L,1-N]),O=O.concat(D),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),z&&d&&(t.push(A+C,T+r,0),t.push(X+C,T+r,0),t.push(X+C,T+Z+r,0),t.push(A+C,T+Z+r,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,L=0,Y=1-Z/J,p=S/U,N=1,D=[L,Y,p,Y,p,N,L,N],(u===v.e.ROTATE_ROW||u===v.e.ROTATE_TILE&&R%2===0)&&(D=[1-L,1-Y,1-p,1-Y,1-p,1-N,1-L,1-N]),(u===v.e.FLIP_ROW||u===v.e.FLIP_TILE&&R%2===0)&&(D=[1-L,Y,1-p,Y,1-p,N,1-L,N]),(u===v.e.FLIP_N_ROTATE_ROW||u===v.e.FLIP_N_ROTATE_TILE&&R%2===0)&&(D=[L,1-Y,p,1-Y,p,1-N,L,1-N]),O=O.concat(D),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&P&&(t.push(M+C,E+r,0),t.push(-A+C,E+r,0),t.push(-A+C,h+r,0),t.push(M+C,h+r,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,L=1-S/U,Y=0,p=1,N=Z/J,D=[L,Y,p,Y,p,N,L,N],(u===v.e.ROTATE_ROW&&mz%2===1||u===v.e.ROTATE_TILE&&mz%1===0)&&(D=[1-L,1-Y,1-p,1-Y,1-p,1-N,1-L,1-N]),(u===v.e.FLIP_ROW&&mz%2===1||u===v.e.FLIP_TILE&&mz%2===0)&&(D=[1-L,Y,1-p,Y,1-p,N,1-L,N]),(u===v.e.FLIP_N_ROTATE_ROW&&mz%2===1||u===v.e.FLIP_N_ROTATE_TILE&&mz%2===0)&&(D=[L,1-Y,p,1-Y,p,1-N,L,1-N]),O=O.concat(D),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&d&&(t.push(A+C,E+r,0),t.push(X+C,E+r,0),t.push(X+C,h+r,0),t.push(A+C,h+r,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,L=0,Y=0,p=S/U,N=Z/J,D=[L,Y,p,Y,p,N,L,N],(u===v.e.ROTATE_ROW&&mz%2===1||u===v.e.ROTATE_TILE&&(mz+R)%2===1)&&(D=[1-L,1-Y,1-p,1-Y,1-p,1-N,1-L,1-N]),(u===v.e.FLIP_ROW&&mz%2===1||u===v.e.FLIP_TILE&&(mz+R)%2===1)&&(D=[1-L,Y,1-p,Y,1-p,N,1-L,N]),(u===v.e.FLIP_N_ROTATE_ROW&&mz%2===1||u===v.e.FLIP_N_ROTATE_TILE&&(mz+R)%2===1)&&(D=[L,1-Y,p,1-Y,p,1-N,L,1-N]),O=O.concat(D),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),z){const z=[];L=0,Y=1-Z/J,p=1,N=1,z[0]=[L,Y,p,Y,p,N,L,N],z[1]=[L,Y,p,Y,p,N,L,N],u!==v.e.ROTATE_TILE&&u!==v.e.ROTATE_ROW||(z[1]=[1-L,1-Y,1-p,1-Y,1-p,1-N,1-L,1-N]),u!==v.e.FLIP_TILE&&u!==v.e.FLIP_ROW||(z[1]=[1-L,Y,1-p,Y,1-p,N,1-L,N]),u!==v.e.FLIP_N_ROTATE_TILE&&u!==v.e.FLIP_N_ROTATE_ROW||(z[1]=[L,1-Y,p,1-Y,p,1-N,L,1-N]);for(let J=0;J<R;J++)t.push(J*U-A+C,T+r,0),t.push((J+1)*U-A+C,T+r,0),t.push((J+1)*U-A+C,T+Z+r,0),t.push(J*U-A+C,T+Z+r,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,O=u===v.e.FLIP_TILE||u===v.e.ROTATE_TILE||u===v.e.FLIP_N_ROTATE_TILE?O.concat(z[(J+1)%2]):u===v.e.FLIP_ROW||u===v.e.ROTATE_ROW||u===v.e.FLIP_N_ROTATE_ROW?O.concat(z[1]):O.concat(z[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(g){const z=[];L=0,Y=0,p=1,N=Z/J,z[0]=[L,Y,p,Y,p,N,L,N],z[1]=[L,Y,p,Y,p,N,L,N],u!==v.e.ROTATE_TILE&&u!==v.e.ROTATE_ROW||(z[1]=[1-L,1-Y,1-p,1-Y,1-p,1-N,1-L,1-N]),u!==v.e.FLIP_TILE&&u!==v.e.FLIP_ROW||(z[1]=[1-L,Y,1-p,Y,1-p,N,1-L,N]),u!==v.e.FLIP_N_ROTATE_TILE&&u!==v.e.FLIP_N_ROTATE_ROW||(z[1]=[L,1-Y,p,1-Y,p,1-N,L,1-N]);for(let J=0;J<R;J++)t.push(J*U-A+C,h-Z+r,0),t.push((J+1)*U-A+C,h-Z+r,0),t.push((J+1)*U-A+C,h+r,0),t.push(J*U-A+C,h+r,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,O=u===v.e.FLIP_TILE||u===v.e.ROTATE_TILE||u===v.e.FLIP_N_ROTATE_TILE?O.concat(z[(J+mz)%2]):u===v.e.FLIP_ROW||u===v.e.ROTATE_ROW||u===v.e.FLIP_N_ROTATE_ROW?O.concat(z[mz%2]):O.concat(z[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(P){const z=[];L=1-S/U,Y=0,p=1,N=1,z[0]=[L,Y,p,Y,p,N,L,N],z[1]=[L,Y,p,Y,p,N,L,N],u!==v.e.ROTATE_TILE&&u!==v.e.ROTATE_ROW||(z[1]=[1-L,1-Y,1-p,1-Y,1-p,1-N,1-L,1-N]),u!==v.e.FLIP_TILE&&u!==v.e.FLIP_ROW||(z[1]=[1-L,Y,1-p,Y,1-p,N,1-L,N]),u!==v.e.FLIP_N_ROTATE_TILE&&u!==v.e.FLIP_N_ROTATE_ROW||(z[1]=[L,1-Y,p,1-Y,p,1-N,L,1-N]);for(let U=0;U<mz;U++)t.push(M+C,U*J-E+r,0),t.push(M+S+C,U*J-E+r,0),t.push(M+S+C,(U+1)*J-E+r,0),t.push(M+C,(U+1)*J-E+r,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,O=u===v.e.FLIP_TILE||u===v.e.ROTATE_TILE||u===v.e.FLIP_N_ROTATE_TILE?O.concat(z[(U+1)%2]):u===v.e.FLIP_ROW||u===v.e.ROTATE_ROW||u===v.e.FLIP_N_ROTATE_ROW?O.concat(z[U%2]):O.concat(z[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(d){const z=[];L=0,Y=0,p=S/J,N=1,z[0]=[L,Y,p,Y,p,N,L,N],z[1]=[L,Y,p,Y,p,N,L,N],u!==v.e.ROTATE_TILE&&u!==v.e.ROTATE_ROW||(z[1]=[1-L,1-Y,1-p,1-Y,1-p,1-N,1-L,1-N]),u!==v.e.FLIP_TILE&&u!==v.e.FLIP_ROW||(z[1]=[1-L,Y,1-p,Y,1-p,N,1-L,N]),u!==v.e.FLIP_N_ROTATE_TILE&&u!==v.e.FLIP_N_ROTATE_ROW||(z[1]=[L,1-Y,p,1-Y,p,1-N,L,1-N]);for(let U=0;U<mz;U++)t.push(X-S+C,U*J-E+r,0),t.push(X+C,U*J-E+r,0),t.push(X+C,(U+1)*J-E+r,0),t.push(X-S+C,(U+1)*J-E+r,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,O=u===v.e.FLIP_TILE||u===v.e.ROTATE_TILE||u===v.e.FLIP_N_ROTATE_TILE?O.concat(z[(U+R)%2]):u===v.e.FLIP_ROW||u===v.e.ROTATE_ROW||u===v.e.FLIP_N_ROTATE_ROW?O.concat(z[U%2]):O.concat(z[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const Y=0===z.sideOrientation?0:z.sideOrientation||g.e.DEFAULTSIDE;g.e._ComputeSides(Y,t,Q,V,O,z.frontUVs,z.backUVs);const p=new g.e;p.indices=Q,p.Oz=t,p.xz=V,p.Kz=O;const N=Y===g.e.DOUBLESIDE?x.concat(x):x;return p.Qz=N,p}function A(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new v.e(z,U);u.sideOrientation=v.e._GetDefaultSideOrientation(u.sideOrientation),J._originalBuilderSideOrientation=u.sideOrientation;return Z(u).pz(J,u.updatable),J}function E(z){const u=z.faceUV||new Array(6),U=z.faceColors,f=z.pattern||v.e.NO_FLIP,P=z.width||z.size||1,R=z.height||z.size||1,S=z.depth||z.size||1,d=z.tileWidth||z.tileSize||1,A=z.tileHeight||z.tileSize||1,E=z.alignHorizontal||0,C=z.alignVertical||0,r=0===z.sideOrientation?0:z.sideOrientation||g.e.DEFAULTSIDE;for(let v=0;v<6;v++)void 0===u[v]&&(u[v]=new J.Vector4(0,0,1,1)),U&&void 0===U[v]&&(U[v]=new mz.wg(1,1,1,1));const M=P/2,T=R/2,X=S/2,h=[];for(let J=0;J<2;J++)h[J]=Z({pattern:f,tileWidth:d,tileHeight:A,width:P,height:R,alignVertical:C,alignHorizontal:E,sideOrientation:r});for(let J=2;J<4;J++)h[J]=Z({pattern:f,tileWidth:d,tileHeight:A,width:S,height:R,alignVertical:C,alignHorizontal:E,sideOrientation:r});let t=C;C===v.e.BOTTOM?t=v.e.TOP:C===v.e.TOP&&(t=v.e.BOTTOM);for(let J=4;J<6;J++)h[J]=Z({pattern:f,tileWidth:d,tileHeight:A,width:P,height:S,alignVertical:t,alignHorizontal:E,sideOrientation:r});let V=[],L=[],O=[],x=[];const Q=[],K=[],Y=[],p=[];let N=0,D=0;for(let v=0;v<6;v++){const z=h[v].Oz.length;K[v]=[],Y[v]=[];for(let u=0;u<z/3;u++)K[v].push(new J.Eu(h[v].Oz[3*u],h[v].Oz[3*u+1],h[v].Oz[3*u+2])),Y[v].push(new J.Eu(h[v].xz[3*u],h[v].xz[3*u+1],h[v].xz[3*u+2]));N=h[v].Kz.length,p[v]=[];for(let U=0;U<N;U+=2)p[v][U]=u[v].x+(u[v].z-u[v].x)*h[v].Kz[U],p[v][U+1]=u[v].y+(u[v].w-u[v].y)*h[v].Kz[U+1],w.c&&(p[v][U+1]=1-p[v][U+1]);if(O=O.concat(p[v]),x=x.concat(h[v].indices.map((z=>z+D))),D+=K[v].length,U)for(let u=0;u<4;u++)Q.push(U[v].r,U[v].g,U[v].b,U[v].a)}const c=new J.Eu(0,0,X),W=J.Matrix.RotationY(Math.PI);V=K[0].map((z=>J.Eu.TransformNormal(z,W).add(c))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[]),L=Y[0].map((z=>J.Eu.TransformNormal(z,W))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[]),V=V.concat(K[1].map((z=>z.Cu(c))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[])),L=L.concat(Y[1].map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[]));const j=new J.Eu(M,0,0),I=J.Matrix.RotationY(-Math.PI/2);V=V.concat(K[2].map((z=>J.Eu.TransformNormal(z,I).add(j))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[])),L=L.concat(Y[2].map((z=>J.Eu.TransformNormal(z,I))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[]));const F=J.Matrix.RotationY(Math.PI/2);V=V.concat(K[3].map((z=>J.Eu.TransformNormal(z,F).Cu(j))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[])),L=L.concat(Y[3].map((z=>J.Eu.TransformNormal(z,F))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[]));const b=new J.Eu(0,T,0),k=J.Matrix.RotationX(Math.PI/2);V=V.concat(K[4].map((z=>J.Eu.TransformNormal(z,k).add(b))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[])),L=L.concat(Y[4].map((z=>J.Eu.TransformNormal(z,k))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[]));const B=J.Matrix.RotationX(-Math.PI/2);V=V.concat(K[5].map((z=>J.Eu.TransformNormal(z,B).Cu(b))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[])),L=L.concat(Y[5].map((z=>J.Eu.TransformNormal(z,B))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[])),g.e._ComputeSides(r,V,x,L,O);const y=new g.e;if(y.indices=x,y.Oz=V,y.xz=L,y.Kz=O,U){const z=r===g.e.DOUBLESIDE?Q.concat(Q):Q;y.Qz=z}return y}function C(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new v.e(z,U);u.sideOrientation=v.e._GetDefaultSideOrientation(u.sideOrientation),J._originalBuilderSideOrientation=u.sideOrientation;return E(u).pz(J,u.updatable),J}g.e.CreateTiledPlane=Z;g.e.CreateTiledBox=E;var r=U(13846),M=U(13161),T=U(13126);function X(z){const u=z.height||2;let U=0===z.diameterTop?0:z.diameterTop||z.diameter||1,f=0===z.diameterBottom?0:z.diameterBottom||z.diameter||1;U=U||1e-5,f=f||1e-5;const P=0|(z.tessellation||24),R=0|(z.subdivisions||1),S=!!z.hasRings,d=!!z.enclose,Z=0===z.cap?0:z.cap||v.e.CAP_ALL,A=z.arc&&(z.arc<=0||z.arc>1)?1:z.arc||1,E=0===z.sideOrientation?0:z.sideOrientation||g.e.DEFAULTSIDE,C=z.faceUV||new Array(3),r=z.faceColors,M=2+(1+(1!==A&&d?2:0))*(S?R:1);let X;for(X=0;X<M;X++)r&&void 0===r[X]&&(r[X]=new mz.wg(1,1,1,1));for(X=0;X<M;X++)C&&void 0===C[X]&&(C[X]=new J.Vector4(0,0,1,1));const h=[],t=[],V=[],L=[],O=[],x=2*Math.PI*A/P;let Q,K,Y;const p=(f-U)/2/u,N=J.Eu.Zero(),D=J.Eu.Zero(),c=J.Eu.Zero(),W=J.Eu.Zero(),j=J.Eu.Zero(),I=T.c.Y;let F,b,k,B=1,y=1,H=0,G=0;for(F=0;F<=R;F++)for(K=F/R,Y=(K*(U-f)+f)/2,B=S&&0!==F&&F!==R?2:1,k=0;k<B;k++){for(S&&(y+=k),d&&(y+=2*k),b=0;b<=P;b++)Q=b*x,N.x=Math.cos(-Q)*Y,N.y=-u/2+K*u,N.z=Math.sin(-Q)*Y,0===U&&F===R?(D.x=V[V.length-3*(P+1)],D.y=V[V.length-3*(P+1)+1],D.z=V[V.length-3*(P+1)+2]):(D.x=N.x,D.z=N.z,D.y=Math.sqrt(D.x*D.x+D.z*D.z)*p,D.normalize()),0===b&&(c.v(N),W.v(D)),t.push(N.x,N.y,N.z),V.push(D.x,D.y,D.z),G=S?H!==y?C[y].y:C[y].w:C[y].y+(C[y].w-C[y].y)*K,L.push(C[y].x+(C[y].z-C[y].x)*b/P,w.c?1-G:G),r&&O.push(r[y].r,r[y].g,r[y].b,r[y].a);1!==A&&d&&(t.push(N.x,N.y,N.z),t.push(0,N.y,0),t.push(0,N.y,0),t.push(c.x,c.y,c.z),J.Eu.CrossToRef(I,D,j),j.normalize(),V.push(j.x,j.y,j.z,j.x,j.y,j.z),J.Eu.CrossToRef(W,I,j),j.normalize(),V.push(j.x,j.y,j.z,j.x,j.y,j.z),G=S?H!==y?C[y+1].y:C[y+1].w:C[y+1].y+(C[y+1].w-C[y+1].y)*K,L.push(C[y+1].x,w.c?1-G:G),L.push(C[y+1].z,w.c?1-G:G),G=S?H!==y?C[y+2].y:C[y+2].w:C[y+2].y+(C[y+2].w-C[y+2].y)*K,L.push(C[y+2].x,w.c?1-G:G),L.push(C[y+2].z,w.c?1-G:G),r&&(O.push(r[y+1].r,r[y+1].g,r[y+1].b,r[y+1].a),O.push(r[y+1].r,r[y+1].g,r[y+1].b,r[y+1].a),O.push(r[y+2].r,r[y+2].g,r[y+2].b,r[y+2].a),O.push(r[y+2].r,r[y+2].g,r[y+2].b,r[y+2].a))),H!==y&&(H=y)}const a=1!==A&&d?P+4:P;for(F=0,y=0;y<R;y++){let z=0,u=0,U=0,J=0;for(b=0;b<P;b++)z=F*(a+1)+b,u=(F+1)*(a+1)+b,U=F*(a+1)+(b+1),J=(F+1)*(a+1)+(b+1),h.push(z,u,U),h.push(J,U,u);1!==A&&d&&(h.push(z+2,u+2,U+2),h.push(J+2,U+2,u+2),h.push(z+4,u+4,U+4),h.push(J+4,U+4,u+4)),F=S?F+2:F+1}const i=z=>{const v=z?U/2:f/2;if(0===v)return;let g,R,S;const d=z?C[M-1]:C[0];let mz=null;r&&(mz=z?r[M-1]:r[0]);const Z=t.length/3,E=z?u/2:-u/2,T=new J.Eu(0,E,0);t.push(T.x,T.y,T.z),V.push(0,z?1:-1,0);const X=d.y+.5*(d.w-d.y);L.push(d.x+.5*(d.z-d.x),w.c?1-X:X),mz&&O.push(mz.r,mz.g,mz.b,mz.a);const x=new J.Vector2(.5,.5);for(S=0;S<=P;S++){g=2*Math.PI*S*A/P;const u=Math.cos(-g),U=Math.sin(-g);R=new J.Eu(u*v,E,U*v);const f=new J.Vector2(u*x.x+.5,U*x.y+.5);t.push(R.x,R.y,R.z),V.push(0,z?1:-1,0);const Z=d.y+(d.w-d.y)*f.y;L.push(d.x+(d.z-d.x)*f.x,w.c?1-Z:Z),mz&&O.push(mz.r,mz.g,mz.b,mz.a)}for(S=0;S<P;S++)z?(h.push(Z),h.push(Z+(S+2)),h.push(Z+(S+1))):(h.push(Z),h.push(Z+(S+1)),h.push(Z+(S+2)))};Z!==v.e.CAP_START&&Z!==v.e.CAP_ALL||i(!1),Z!==v.e.CAP_END&&Z!==v.e.CAP_ALL||i(!0),g.e._ComputeSides(E,t,h,V,L,z.frontUVs,z.backUVs);const n=new g.e;return n.indices=h,n.Oz=t,n.xz=V,n.Kz=L,r&&(n.Qz=O),n}function h(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;const J=new v.e(z,U);u.sideOrientation=v.e._GetDefaultSideOrientation(u.sideOrientation),J._originalBuilderSideOrientation=u.sideOrientation;return X(u).pz(J,u.updatable),J}function t(z){const u=[],U=[],v=[],f=[],P=z.diameter||1,R=z.thickness||.5,S=0|(z.tessellation||16),d=0===z.sideOrientation?0:z.sideOrientation||g.e.DEFAULTSIDE,mz=S+1;for(let g=0;g<=S;g++){const z=g/S,d=g*Math.PI*2/S-Math.PI/2,Z=J.Matrix.Translation(P/2,0,0).multiply(J.Matrix.RotationY(d));for(let P=0;P<=S;P++){const d=1-P/S,A=P*Math.PI*2/S+Math.PI,E=Math.cos(A),C=Math.sin(A);let r=new J.Eu(E,C,0),M=r.scale(R/2);const T=new J.Vector2(z,d);M=J.Eu.TransformCoordinates(M,Z),r=J.Eu.TransformNormal(r,Z),U.push(M.x,M.y,M.z),v.push(r.x,r.y,r.z),f.push(T.x,w.c?1-T.y:T.y);const X=(g+1)%mz,h=(P+1)%mz;u.push(g*mz+P),u.push(g*mz+h),u.push(X*mz+P),u.push(g*mz+h),u.push(X*mz+h),u.push(X*mz+P)}}g.e._ComputeSides(d,U,u,v,f,z.frontUVs,z.backUVs);const Z=new g.e;return Z.indices=u,Z.Oz=U,Z.xz=v,Z.Kz=f,Z}function V(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;const J=new v.e(z,U);u.sideOrientation=v.e._GetDefaultSideOrientation(u.sideOrientation),J._originalBuilderSideOrientation=u.sideOrientation;return t(u).pz(J,u.updatable),J}g.e.CreateCylinder=X,v.e.CreateCylinder=(z,u,U,J,f,g,w,P,R)=>{void 0!==w&&w instanceof M.d||(void 0!==w&&(R=P||v.e.DEFAULTSIDE,P=w),w=g,g=1);return h(z,{height:u,diameterTop:U,diameterBottom:J,tessellation:f,subdivisions:g,sideOrientation:R,updatable:P},w)};function L(z){const u=[],U=[],v=[],f=[],P=z.radius||2,R=z.tube||.5,S=z.radialSegments||32,d=z.tubularSegments||32,mz=z.p||2,Z=z.q||3,A=0===z.sideOrientation?0:z.sideOrientation||g.e.DEFAULTSIDE,E=z=>{const u=Math.cos(z),U=Math.sin(z),v=Z/mz*z,f=Math.cos(v),g=P*(2+f)*.5*u,w=P*(2+f)*U*.5,R=P*Math.sin(v)*.5;return new J.Eu(g,w,R)};let C,r;for(C=0;C<=S;C++){const z=C%S/S*2*mz*Math.PI,u=E(z),v=E(z+.01),g=v.Cu(u);let P=v.add(u);const Z=J.Eu.Cross(g,P);for(P=J.Eu.Cross(Z,g),Z.normalize(),P.normalize(),r=0;r<d;r++){const z=r%d/d*2*Math.PI,J=-R*Math.cos(z),v=R*Math.sin(z);U.push(u.x+J*P.x+v*Z.x),U.push(u.y+J*P.y+v*Z.y),U.push(u.z+J*P.z+v*Z.z),f.push(C/S),f.push(w.c?1-r/d:r/d)}}for(C=0;C<S;C++)for(r=0;r<d;r++){const z=(r+1)%d,U=C*d+r,J=(C+1)*d+r,v=(C+1)*d+z,f=C*d+z;u.push(f),u.push(J),u.push(U),u.push(f),u.push(v),u.push(J)}g.e.ComputeNormals(U,u,v),g.e._ComputeSides(A,U,u,v,f,z.frontUVs,z.backUVs);const M=new g.e;return M.indices=u,M.Oz=U,M.xz=v,M.Kz=f,M}function O(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;const J=new v.e(z,U);u.sideOrientation=v.e._GetDefaultSideOrientation(u.sideOrientation),J._originalBuilderSideOrientation=u.sideOrientation;return L(u).pz(J,u.updatable),J}g.e.CreateTorus=t,v.e.CreateTorus=(z,u,U,J,v,f,g)=>V(z,{diameter:u,thickness:U,tessellation:J,sideOrientation:g,updatable:f},v);g.e.CreateTorusKnot=L,v.e.CreateTorusKnot=(z,u,U,J,v,f,g,w,P,R)=>O(z,{radius:u,tube:U,radialSegments:J,tubularSegments:v,p:f,q:g,sideOrientation:R,updatable:P},w);var x=U(14319),Q=U(13436),K=U(13132);function Y(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=u.path,f=u.shape,g=u.scale||1,w=u.rotation||0,P=0===u.cap?0:u.cap||v.e.NO_CAP,R=u.updatable,S=v.e._GetDefaultSideOrientation(u.sideOrientation),d=u.instance||null,mz=u.invertUV||!1,Z=u.closeShape||!1,A=u.closePath||!1,E=u.capFunction||null;return N(z,f,J,g,w,null,null,A,Z,P,!1,U,!!R,S,d,mz,u.frontUVs||null,u.backUVs||null,u.firstNormal||null,!!u.adjustFrame,E)}function p(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=u.path,f=u.shape,g=u.scaleFunction||(()=>1),w=u.rotationFunction||(()=>0),P=u.closePath||u.ribbonCloseArray||!1,R=u.closeShape||u.ribbonClosePath||!1,S=0===u.cap?0:u.cap||v.e.NO_CAP,d=u.updatable,mz=u.firstNormal||null,Z=u.adjustFrame||!1,A=v.e._GetDefaultSideOrientation(u.sideOrientation),E=u.instance,C=u.invertUV||!1,r=u.capFunction||null;return N(z,f,J,null,null,g,w,P,R,S,!0,U,!!d,A,E||null,C,u.frontUVs||null,u.backUVs||null,mz,Z,r||null)}function N(z,u,U,f,g,w,P,S,d,mz,Z,A,E,C,r,M,T,X,h,t,V){const L=(z,u,U,f,g,w,P,R,S,d,mz)=>{const Z=U.getTangents(),A=U.getNormals(),E=U.getBinormals(),C=U.getDistances();if(mz)for(let v=0;v<Z.length;v++)if(0==Z[v].x&&0==Z[v].y&&0==Z[v].z&&Z[v].v(Z[v-1]),0==A[v].x&&0==A[v].y&&0==A[v].z&&A[v].v(A[v-1]),0==E[v].x&&0==E[v].y&&0==E[v].z&&E[v].v(E[v-1]),v>0){let z=Z[v-1];J.Eu.Dot(z,Z[v])<0&&Z[v].scaleInPlace(-1),z=A[v-1],J.Eu.Dot(z,A[v])<0&&A[v].scaleInPlace(-1),z=E[v-1],J.Eu.Dot(z,E[v])<0&&E[v].scaleInPlace(-1)}let r=0;const M=d&&R?R:()=>null!==w?w:0,T=d&&P?P:()=>null!==g?g:1;let X=S===v.e.NO_CAP||S===v.e.CAP_END?0:2;const h=J.TmpVectors.Matrix[0];for(let v=0;v<u.length;v++){const U=[],g=M(v,C[v]),w=T(v,C[v]);J.Matrix.RotationAxisToRef(Z[v],r,h);for(let f=0;f<z.length;f++){const g=Z[v].scale(z[f].z).add(A[v].scale(z[f].x)).add(E[v].scale(z[f].y)),P=J.Eu.Zero();J.Eu.TransformCoordinatesToRef(g,h,P),P.scaleInPlace(w).addInPlace(u[v]),U[f]=P}f[X]=U,r+=g,X++}const t=V||(z=>{const u=Array(),U=J.Eu.Zero();let v;for(v=0;v<z.length;v++)U.addInPlace(z[v]);for(U.scaleInPlace(1/z.length),v=0;v<z.length;v++)u.push(U);return u});switch(S){case v.e.NO_CAP:break;case v.e.CAP_START:f[0]=t(f[2]),f[1]=f[2];break;case v.e.CAP_END:f[X]=f[X-1],f[X+1]=t(f[X-1]);break;case v.e.CAP_ALL:f[0]=t(f[2]),f[1]=f[2],f[X]=f[X-1],f[X+1]=t(f[X-1])}return f};let O,x;if(r){const z=r._creationDataStorage;return O=h?z.path3D.update(U,h):z.path3D.update(U),x=L(u,U,z.path3D,z.pathArray,f,g,w,P,z.cap,Z,t),r=R("",{pathArray:x,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:r},A||void 0)}O=h?new K.h(U,h):new K.h(U);x=L(u,U,O,new Array,f,g,w,P,mz=mz<0||mz>3?0:mz,Z,t);const Q=R(z,{pathArray:x,closeArray:S,closePath:d,updatable:E,sideOrientation:C,invertUV:M,frontUVs:T||void 0,backUVs:X||void 0},A);return Q._creationDataStorage.pathArray=x,Q._creationDataStorage.path3D=O,Q._creationDataStorage.cap=mz,Q}function D(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=u.arc?u.arc<=0||u.arc>1?1:u.arc:1,g=void 0===u.closed||u.closed,w=u.shape,P=u.radius||1,S=u.tessellation||64,d=u.clip||0,mz=u.updatable,Z=v.e._GetDefaultSideOrientation(u.sideOrientation),A=u.cap||v.e.NO_CAP,E=2*Math.PI,C=[],r=u.invertUV||!1;let M=0,T=0;const X=E/S*f;let h,t;for(M=0;M<=S-d;M++){for(t=[],A!=v.e.CAP_START&&A!=v.e.CAP_ALL||(t.push(new J.Eu(0,w[0].y,0)),t.push(new J.Eu(Math.cos(M*X)*w[0].x*P,w[0].y,Math.sin(M*X)*w[0].x*P))),T=0;T<w.length;T++)h=new J.Eu(Math.cos(M*X)*w[T].x*P,w[T].y,Math.sin(M*X)*w[T].x*P),t.push(h);A!=v.e.CAP_END&&A!=v.e.CAP_ALL||(t.push(new J.Eu(Math.cos(M*X)*w[w.length-1].x*P,w[w.length-1].y,Math.sin(M*X)*w[w.length-1].x*P)),t.push(new J.Eu(0,w[w.length-1].y,0))),C.push(t)}return R(z,{pathArray:C,closeArray:g,sideOrientation:Z,updatable:mz,invertUV:r,frontUVs:u.frontUVs,backUVs:u.backUVs},U)}v.e.ExtrudeShape=function(z,u,U,J,f,g){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7?arguments[7]:void 0,R=arguments.length>8?arguments[8]:void 0,S=arguments.length>9?arguments[9]:void 0;return Y(z,{shape:u,path:U,scale:J,rotation:f,cap:0===g?0:g||v.e.NO_CAP,sideOrientation:R,instance:S,updatable:P},w)},v.e.ExtrudeShapeCustom=(z,u,U,J,f,g,w,P,R,S,d,mz)=>p(z,{shape:u,path:U,scaleFunction:J,rotationFunction:f,ribbonCloseArray:g,ribbonClosePath:w,cap:0===P?0:P||v.e.NO_CAP,sideOrientation:d,instance:mz,updatable:S},R);v.e.CreateLathe=(z,u,U,J,v,f,g)=>D(z,{shape:u,radius:U,tessellation:J,sideOrientation:g,updatable:f},v);var c=U(13760),W=U(13710);function j(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=u.path;let g=u.instance,w=1;void 0!==u.radius?w=u.radius:g&&(w=g._creationDataStorage.radius);const P=u.tessellation||64,S=u.radiusFunction||null;let d=u.cap||v.e.NO_CAP;const mz=u.invertUV||!1,Z=u.updatable,A=v.e._GetDefaultSideOrientation(u.sideOrientation);u.arc=u.arc&&(u.arc<=0||u.arc>1)?1:u.arc||1;const E=(z,u,U,f,g,w,P,R)=>{const S=u.getTangents(),d=u.getNormals(),mz=u.getDistances(),Z=2*Math.PI/g*R,A=w||(()=>f);let E,C,r,M;const T=J.TmpVectors.Matrix[0];let X=P===v.e.NO_CAP||P===v.e.CAP_END?0:2;for(let v=0;v<z.length;v++){C=A(v,mz[v]),E=Array(),r=d[v];for(let u=0;u<g;u++)J.Matrix.RotationAxisToRef(S[v],Z*u,T),M=E[u]?E[u]:J.Eu.Zero(),J.Eu.TransformCoordinatesToRef(r,T,M),M.scaleInPlace(C).addInPlace(z[v]),E[u]=M;U[X]=E,X++}const h=(u,U)=>{const J=Array();for(let v=0;v<u;v++)J.push(z[U]);return J};switch(P){case v.e.NO_CAP:break;case v.e.CAP_START:U[0]=h(g,0),U[1]=U[2].slice(0);break;case v.e.CAP_END:U[X]=U[X-1].slice(0),U[X+1]=h(g,z.length-1);break;case v.e.CAP_ALL:U[0]=h(g,0),U[1]=U[2].slice(0),U[X]=U[X-1].slice(0),U[X+1]=h(g,z.length-1)}return U};let C,r;if(g){const z=g._creationDataStorage,U=u.arc||z.arc;return C=z.path3D.update(f),r=E(f,C,z.pathArray,w,z.tessellation,S,z.cap,U),g=R("",{pathArray:r,instance:g}),z.path3D=C,z.pathArray=r,z.arc=U,z.radius=w,g}C=new K.h(f);d=d<0||d>3?0:d,r=E(f,C,new Array,w,P,S,d,u.arc);const M=R(z,{pathArray:r,closePath:!0,closeArray:!1,updatable:Z,sideOrientation:A,invertUV:mz,frontUVs:u.frontUVs,backUVs:u.backUVs},U);return M._creationDataStorage.pathArray=r,M._creationDataStorage.path3D=C,M._creationDataStorage.tessellation=P,M._creationDataStorage.cap=d,M._creationDataStorage.arc=u.arc,M._creationDataStorage.radius=w,M}function I(z){const u=[];u[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},u[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},u[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},u[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},u[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},u[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},u[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},u[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},u[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},u[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},u[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},u[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},u[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},u[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},u[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const U=z.type&&(z.type<0||z.type>=u.length)?0:z.type||0,v=z.size,f=z.sizeX||v||1,P=z.sizeY||v||1,R=z.sizeZ||v||1,S=z.custom||u[U],d=S.face.length,Z=z.faceUV||new Array(d),A=z.faceColors,E=void 0===z.flat||z.flat,C=0===z.sideOrientation?0:z.sideOrientation||g.e.DEFAULTSIDE,r=[],M=[],T=[],X=[],h=[];let t=0,V=0;const L=[];let O,x,Q,K,Y,p,N=0,D=0;if(E)for(D=0;D<d;D++)A&&void 0===A[D]&&(A[D]=new mz.wg(1,1,1,1)),Z&&void 0===Z[D]&&(Z[D]=new J.Vector4(0,0,1,1));if(E)for(D=0;D<d;D++){const z=S.face[D].length;for(Q=2*Math.PI/z,K=.5*Math.tan(Q/2),Y=.5,N=0;N<z;N++)r.push(S.vertex[S.face[D][N]][0]*f,S.vertex[S.face[D][N]][1]*P,S.vertex[S.face[D][N]][2]*R),L.push(t),t++,O=Z[D].x+(Z[D].z-Z[D].x)*(.5+K),x=Z[D].y+(Z[D].w-Z[D].y)*(Y-.5),X.push(O,w.c?1-x:x),p=K*Math.cos(Q)-Y*Math.sin(Q),Y=K*Math.sin(Q)+Y*Math.cos(Q),K=p,A&&h.push(A[D].r,A[D].g,A[D].b,A[D].a);for(N=0;N<z-2;N++)M.push(L[0+V],L[N+2+V],L[N+1+V]);V+=z}else{for(N=0;N<S.vertex.length;N++)r.push(S.vertex[N][0]*f,S.vertex[N][1]*P,S.vertex[N][2]*R),X.push(0,w.c?1:0);for(D=0;D<d;D++)for(N=0;N<S.face[D].length-2;N++)M.push(S.face[D][0],S.face[D][N+2],S.face[D][N+1])}g.e.ComputeNormals(r,M,T),g.e._ComputeSides(C,r,M,T,X,z.frontUVs,z.backUVs);const c=new g.e;return c.Oz=r,c.indices=M,c.xz=T,c.Kz=X,A&&E&&(c.Qz=h),c}function F(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new v.e(z,U);u.sideOrientation=v.e._GetDefaultSideOrientation(u.sideOrientation),J._originalBuilderSideOrientation=u.sideOrientation;return I(u).pz(J,u.updatable),J}v.e.CreateTube=(z,u,U,J,v,f,g,w,P,R)=>j(z,{path:u,radius:U,tessellation:J,radiusFunction:v,arc:1,cap:f,updatable:w,sideOrientation:P,instance:R},g);function b(z){const u=z.sideOrientation||g.e.DEFAULTSIDE,U=z.radius||1,v=void 0===z.flat||z.flat,f=0|(z.subdivisions||4),P=z.radiusX||U,R=z.radiusY||U,S=z.radiusZ||U,d=(1+Math.sqrt(5))/2,mz=[-1,d,-0,1,d,0,-1,-d,0,1,-d,0,0,-1,-d,0,1,-d,0,-1,d,0,1,d,d,0,1,d,0,-1,-d,0,1,-d,0,-1],Z=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],A=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],E=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],C=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],r=[],M=[],T=[],X=[];let h=0;const t=new Array(3),V=new Array(3);let L;for(L=0;L<3;L++)t[L]=J.Eu.Zero(),V[L]=J.Vector2.Zero();for(let g=0;g<20;g++){for(L=0;L<3;L++){const z=Z[3*g+L];t[L].zg(mz[3*A[z]],mz[3*A[z]+1],mz[3*A[z]+2]),t[L].normalize(),V[L].zg(.134765625*E[2*z]+.05859375+-.0390625*C[g],.2333984375*E[2*z+1]+.025390625+.01953125*C[g])}const z=(z,u,U,g)=>{const d=J.Eu.Lerp(t[0],t[2],u/f),mz=J.Eu.Lerp(t[1],t[2],u/f),Z=f===u?t[2]:J.Eu.Lerp(d,mz,z/(f-u));let A;if(Z.normalize(),v){const z=J.Eu.Lerp(t[0],t[2],g/f),u=J.Eu.Lerp(t[1],t[2],g/f);A=J.Eu.Lerp(z,u,U/(f-g))}else A=new J.Eu(Z.x,Z.y,Z.z);A.x/=P,A.y/=R,A.z/=S,A.normalize();const E=J.Vector2.Lerp(V[0],V[2],u/f),C=J.Vector2.Lerp(V[1],V[2],u/f),L=f===u?V[2]:J.Vector2.Lerp(E,C,z/(f-u));M.push(Z.x*P,Z.y*R,Z.z*S),T.push(A.x,A.y,A.z),X.push(L.x,w.c?1-L.y:L.y),r.push(h),h++};for(let u=0;u<f;u++)for(let U=0;U+u<f;U++)z(U,u,U+1/3,u+1/3),z(U+1,u,U+1/3,u+1/3),z(U,u+1,U+1/3,u+1/3),U+u+1<f&&(z(U+1,u,U+2/3,u+2/3),z(U+1,u+1,U+2/3,u+2/3),z(U,u+1,U+2/3,u+2/3))}g.e._ComputeSides(u,M,r,T,X,z.frontUVs,z.backUVs);const O=new g.e;return O.indices=r,O.Oz=M,O.xz=T,O.Kz=X,O}function k(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new v.e(z,U);u.sideOrientation=v.e._GetDefaultSideOrientation(u.sideOrientation),J._originalBuilderSideOrientation=u.sideOrientation;return b(u).pz(J,u.updatable),J}g.e.CreatePolyhedron=I,v.e.CreatePolyhedron=(z,u,U)=>F(z,u,U);g.e.CreateIcoSphere=b,v.e.CreateIcoSphere=(z,u,U)=>k(z,u,U);var B=U(12935);const y=new J.Eu(1,0,0),H=new J.Eu(-1,0,0),G=new J.Eu(0,1,0),a=new J.Eu(0,-1,0),i=new J.Eu(0,0,1),n=new J.Eu(0,0,-1);class q{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.Eu.Zero(),u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.Eu.Up(),U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.Vector2.Zero(),v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=z,this.normal=u,this.uv=U,this.vertexIdx=v,this.vertexIdxForBones=f,this.localPositionOverride=g,this.localNormalOverride=w,this.matrixIndicesOverride=P,this.matrixWeightsOverride=R}clone(){var z,u,U,J;return new q(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(z=this.localPositionOverride)||void 0===z?void 0:z.slice(),null===(u=this.localNormalOverride)||void 0===u?void 0:u.slice(),null===(U=this.matrixIndicesOverride)||void 0===U?void 0:U.slice(),null===(J=this.matrixWeightsOverride)||void 0===J?void 0:J.slice())}}function o(z,u,U){var P,R,S,d,mz;const Z=!!u.skeleton,A=!(null===(P=u.morphTargetManager)||void 0===P||!P.numTargets),E=U.localMode||Z,C=u.lf(),r=Z||A?u.TP(!0,!0):u.getVerticesData(f.g.PositionKind),M=Z||A?u.getNormalsData(!0,!0):u.getVerticesData(f.g.NormalKind),T=E?Z?u.getVerticesData(f.g.PositionKind):r:null,X=E?Z?u.getVerticesData(f.g.NormalKind):M:null,h=u.getVerticesData(f.g.UVKind),t=Z?u.getVerticesData(f.g.MatricesIndicesKind):null,V=Z?u.getVerticesData(f.g.MatricesWeightsKind):null,L=Z?u.getVerticesData(f.g.MatricesIndicesExtraKind):null,O=Z?u.getVerticesData(f.g.MatricesWeightsExtraKind):null,x=U.position||J.Eu.Zero();let Q=U.normal||J.Eu.Up();const K=U.size||J.Eu.One(),Y=U.angle||0;if(!Q){const z=new J.Eu(0,0,1),U=u.Vz().activeCamera,v=J.Eu.TransformCoordinates(z,U.getWorldMatrix());Q=U.globalPosition.Cu(v)}const p=-Math.atan2(Q.z,Q.x)-Math.PI/2,N=Math.sqrt(Q.x*Q.x+Q.z*Q.z),D=Math.atan2(Q.y,N),c=new g.e;c.indices=[],c.Oz=[],c.xz=[],c.Kz=[],c.matricesIndices=Z?[]:null,c.matricesWeights=Z?[]:null,c.matricesIndicesExtra=L?[]:null,c.matricesWeightsExtra=O?[]:null;let W=0;const j=(z,u)=>{const v=new q;if(!C||!r||!M)return v;const f=C[z];if(v.vertexIdx=3*f,v.vertexIdxForBones=4*f,v.position=new J.Eu(r[3*f],r[3*f+1],r[3*f+2]),J.Eu.TransformCoordinatesToRef(v.position,u,v.position),v.normal=new J.Eu(M[3*f],M[3*f+1],M[3*f+2]),J.Eu.TransformNormalToRef(v.normal,u,v.normal),U.captureUVS&&h){const z=h[2*f+1];v.uv=new J.Vector2(h[2*f],w.c?1-z:z)}return v},I=[0,0,0,0],F=(z,u)=>{var U,v;if(0===z.length)return z;const f=.5*Math.abs(J.Eu.Dot(K,u)),g=(z,u,U,J)=>{for(let v=0;v<J;++v)if(z[U+v]===u)return U+v;return-1},w=(z,U)=>{var v,w,P,R,S,d,mz,Z,A,E,C,r;const M=J.Eu.GetClipFactor(z.position,U.position,u,f);let h=I,L=I;if(t&&V){var O,x,Q,K;const u=z.matrixIndicesOverride?0:z.vertexIdxForBones,J=null!==(O=z.matrixIndicesOverride)&&void 0!==O?O:t,v=null!==(x=z.matrixWeightsOverride)&&void 0!==x?x:V,f=U.matrixIndicesOverride?0:U.vertexIdxForBones,w=null!==(Q=U.matrixIndicesOverride)&&void 0!==Q?Q:t,P=null!==(K=U.matrixWeightsOverride)&&void 0!==K?K:V;h=[0,0,0,0],L=[0,0,0,0];let R=0;for(let z=0;z<4;++z)if(v[u+z]>0){const U=g(w,J[u+z],f,4);h[R]=J[u+z],L[R]=(0,B.Lerp)(v[u+z],U>=0?P[U]:0,M),R++}for(let z=0;z<4&&R<4;++z){const U=w[f+z];-1===g(J,U,u,4)&&(h[R]=U,L[R]=(0,B.Lerp)(0,P[f+z],M),R++)}const S=L[0]+L[1]+L[2]+L[3];L[0]/=S,L[1]/=S,L[2]/=S,L[3]/=S}const Y=z.localPositionOverride?z.localPositionOverride[0]:null!==(v=null===T||void 0===T?void 0:T[z.vertexIdx])&&void 0!==v?v:0,p=z.localPositionOverride?z.localPositionOverride[1]:null!==(w=null===T||void 0===T?void 0:T[z.vertexIdx+1])&&void 0!==w?w:0,N=z.localPositionOverride?z.localPositionOverride[2]:null!==(P=null===T||void 0===T?void 0:T[z.vertexIdx+2])&&void 0!==P?P:0,D=U.localPositionOverride?U.localPositionOverride[0]:null!==(R=null===T||void 0===T?void 0:T[U.vertexIdx])&&void 0!==R?R:0,c=U.localPositionOverride?U.localPositionOverride[1]:null!==(S=null===T||void 0===T?void 0:T[U.vertexIdx+1])&&void 0!==S?S:0,W=U.localPositionOverride?U.localPositionOverride[2]:null!==(d=null===T||void 0===T?void 0:T[U.vertexIdx+2])&&void 0!==d?d:0,j=z.localNormalOverride?z.localNormalOverride[0]:null!==(mz=null===X||void 0===X?void 0:X[z.vertexIdx])&&void 0!==mz?mz:0,F=z.localNormalOverride?z.localNormalOverride[1]:null!==(Z=null===X||void 0===X?void 0:X[z.vertexIdx+1])&&void 0!==Z?Z:0,b=z.localNormalOverride?z.localNormalOverride[2]:null!==(A=null===X||void 0===X?void 0:X[z.vertexIdx+2])&&void 0!==A?A:0,k=j+((U.localNormalOverride?U.localNormalOverride[0]:null!==(E=null===X||void 0===X?void 0:X[U.vertexIdx])&&void 0!==E?E:0)-j)*M,y=F+((U.localNormalOverride?U.localNormalOverride[1]:null!==(C=null===X||void 0===X?void 0:X[U.vertexIdx+1])&&void 0!==C?C:0)-F)*M,H=b+((U.localNormalOverride?U.localNormalOverride[2]:null!==(r=null===X||void 0===X?void 0:X[U.vertexIdx+2])&&void 0!==r?r:0)-b)*M,G=Math.sqrt(k*k+y*y+H*H);return new q(J.Eu.Lerp(z.position,U.position,M),J.Eu.Lerp(z.normal,U.normal,M).normalize(),J.Vector2.Lerp(z.uv,U.uv,M),-1,-1,T?[Y+(D-Y)*M,p+(c-p)*M,N+(W-N)*M]:null,X?[k/G,y/G,H/G]:null,h,L)};let P=null;z.length>3&&(P=[]);for(let R=0;R<z.length;R+=3){let g=0,S=null,d=null,mz=null,Z=null;const A=J.Eu.Dot(z[R].position,u)-f>0,E=J.Eu.Dot(z[R+1].position,u)-f>0,C=J.Eu.Dot(z[R+2].position,u)-f>0;switch(g=(A?1:0)+(E?1:0)+(C?1:0),g){case 0:z.length>3?(P.push(z[R]),P.push(z[R+1]),P.push(z[R+2])):P=z;break;case 1:if(P=null!==(U=P)&&void 0!==U?U:new Array,A&&(S=z[R+1],d=z[R+2],mz=w(z[R],S),Z=w(z[R],d)),E){S=z[R],d=z[R+2],mz=w(z[R+1],S),Z=w(z[R+1],d),P.push(mz),P.push(d.clone()),P.push(S.clone()),P.push(d.clone()),P.push(mz.clone()),P.push(Z);break}C&&(S=z[R],d=z[R+1],mz=w(z[R+2],S),Z=w(z[R+2],d)),S&&d&&mz&&Z&&(P.push(S.clone()),P.push(d.clone()),P.push(mz),P.push(Z),P.push(mz.clone()),P.push(d.clone()));break;case 2:P=null!==(v=P)&&void 0!==v?v:new Array,A||(S=z[R].clone(),d=w(S,z[R+1]),mz=w(S,z[R+2]),P.push(S),P.push(d),P.push(mz)),E||(S=z[R+1].clone(),d=w(S,z[R+2]),mz=w(S,z[R]),P.push(S),P.push(d),P.push(mz)),C||(S=z[R+2].clone(),d=w(S,z[R]),mz=w(S,z[R+1]),P.push(S),P.push(d),P.push(mz))}}return P},b=u instanceof v.e?u:null,k=null===b||void 0===b?void 0:b._thinInstanceDataStorage.matrixData,o=(null===b||void 0===b?void 0:b.Eg)||1,s=J.TmpVectors.Matrix[0];s.v(J.Matrix.IdentityReadOnly);for(let v=0;v<o;++v){if(null!==b&&void 0!==b&&b.hasThinInstances&&k){const z=16*v;s.setRowFromFloats(0,k[z+0],k[z+1],k[z+2],k[z+3]),s.setRowFromFloats(1,k[z+4],k[z+5],k[z+6],k[z+7]),s.setRowFromFloats(2,k[z+8],k[z+9],k[z+10],k[z+11]),s.setRowFromFloats(3,k[z+12],k[z+13],k[z+14],k[z+15])}const z=J.Matrix.RotationYawPitchRoll(p,D,Y).multiply(J.Matrix.Translation(x.x,x.y,x.z)),f=J.Matrix.Invert(z),g=u.getWorldMatrix(),P=s.multiply(g).multiply(f),R=new Array(3);for(let u=0;u<C.length;u+=3){let z=R;if(z[0]=j(u,P),z[1]=j(u+1,P),z[2]=j(u+2,P),!(U.cullBackFaces&&-z[0].normal.z<=0&&-z[1].normal.z<=0&&-z[2].normal.z<=0)&&(z=F(z,y),z&&(z=F(z,H),z&&(z=F(z,G),z&&(z=F(z,a),z&&(z=F(z,i),z&&(z=F(z,n),z)))))))for(let u=0;u<z.length;u++){const J=z[u];if(c.indices.push(W),E?(J.localPositionOverride?(c.Oz[3*W]=J.localPositionOverride[0],c.Oz[3*W+1]=J.localPositionOverride[1],c.Oz[3*W+2]=J.localPositionOverride[2]):T&&(c.Oz[3*W]=T[J.vertexIdx],c.Oz[3*W+1]=T[J.vertexIdx+1],c.Oz[3*W+2]=T[J.vertexIdx+2]),J.localNormalOverride?(c.xz[3*W]=J.localNormalOverride[0],c.xz[3*W+1]=J.localNormalOverride[1],c.xz[3*W+2]=J.localNormalOverride[2]):X&&(c.xz[3*W]=X[J.vertexIdx],c.xz[3*W+1]=X[J.vertexIdx+1],c.xz[3*W+2]=X[J.vertexIdx+2])):(J.position.toArray(c.Oz,3*W),J.normal.toArray(c.xz,3*W)),c.matricesIndices&&c.matricesWeights&&(J.matrixIndicesOverride?(c.matricesIndices[4*W]=J.matrixIndicesOverride[0],c.matricesIndices[4*W+1]=J.matrixIndicesOverride[1],c.matricesIndices[4*W+2]=J.matrixIndicesOverride[2],c.matricesIndices[4*W+3]=J.matrixIndicesOverride[3]):(t&&(c.matricesIndices[4*W]=t[J.vertexIdxForBones],c.matricesIndices[4*W+1]=t[J.vertexIdxForBones+1],c.matricesIndices[4*W+2]=t[J.vertexIdxForBones+2],c.matricesIndices[4*W+3]=t[J.vertexIdxForBones+3]),L&&c.matricesIndicesExtra&&(c.matricesIndicesExtra[4*W]=L[J.vertexIdxForBones],c.matricesIndicesExtra[4*W+1]=L[J.vertexIdxForBones+1],c.matricesIndicesExtra[4*W+2]=L[J.vertexIdxForBones+2],c.matricesIndicesExtra[4*W+3]=L[J.vertexIdxForBones+3])),J.matrixWeightsOverride?(c.matricesWeights[4*W]=J.matrixWeightsOverride[0],c.matricesWeights[4*W+1]=J.matrixWeightsOverride[1],c.matricesWeights[4*W+2]=J.matrixWeightsOverride[2],c.matricesWeights[4*W+3]=J.matrixWeightsOverride[3]):(V&&(c.matricesWeights[4*W]=V[J.vertexIdxForBones],c.matricesWeights[4*W+1]=V[J.vertexIdxForBones+1],c.matricesWeights[4*W+2]=V[J.vertexIdxForBones+2],c.matricesWeights[4*W+3]=V[J.vertexIdxForBones+3]),O&&c.matricesWeightsExtra&&(c.matricesWeightsExtra[4*W]=O[J.vertexIdxForBones],c.matricesWeightsExtra[4*W+1]=O[J.vertexIdxForBones+1],c.matricesWeightsExtra[4*W+2]=O[J.vertexIdxForBones+2],c.matricesWeightsExtra[4*W+3]=O[J.vertexIdxForBones+3]))),U.captureUVS)J.uv.toArray(c.Kz,2*W);else{c.Kz.push(.5+J.position.x/K.x);const z=.5+J.position.y/K.y;c.Kz.push(w.c?1-z:z)}W++}}}0===c.indices.length&&(c.indices=null),0===c.Oz.length&&(c.Oz=null),0===c.xz.length&&(c.xz=null),0===c.Kz.length&&(c.Kz=null),0===(null===(R=c.matricesIndices)||void 0===R?void 0:R.length)&&(c.matricesIndices=null),0===(null===(S=c.matricesWeights)||void 0===S?void 0:S.length)&&(c.matricesWeights=null),0===(null===(d=c.matricesIndicesExtra)||void 0===d?void 0:d.length)&&(c.matricesIndicesExtra=null),0===(null===(mz=c.matricesWeightsExtra)||void 0===mz?void 0:mz.length)&&(c.matricesWeightsExtra=null);const l=new v.e(z,u.Vz());return c.pz(l),E?(l.skeleton=u.skeleton,l.parent=u):(l.position=x.clone(),l.rotation=new J.Eu(D,p,Y)),l.af(!0),l.refreshBoundingInfo(!0,!0),l}function s(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const u=0|Math.max(z.subdivisions?z.subdivisions:2,1),U=0|Math.max(z.tessellation?z.tessellation:16,3),v=Math.max(z.height?z.height:1,0),f=Math.max(z.radius?z.radius:.25,0),P=0|Math.max(z.capSubdivisions?z.capSubdivisions:6,1),R=U,S=u,d=Math.max(z.radiusTop?z.radiusTop:f,0),mz=Math.max(z.radiusBottom?z.radiusBottom:f,0),Z=v-(d+mz),A=2*Math.PI,E=Math.max(z.topCapSubdivisions?z.topCapSubdivisions:P,1),C=Math.max(z.bottomCapSubdivisions?z.bottomCapSubdivisions:P,1),r=Math.acos((mz-d)/v);let M=[];const T=[],X=[],h=[];let t=0;const V=[],L=.5*Z,O=.5*Math.PI;let x,Q;const K=J.Eu.Zero(),Y=J.Eu.Zero(),p=Math.cos(r),N=Math.sin(r),D=new J.Vector2(d*N,L+d*p).Cu(new J.Vector2(mz*N,mz*p-L)).length(),c=d*r+D+mz*(O-r);let W=0;for(Q=0;Q<=E;Q++){const z=[],u=O-r*(Q/E);W+=d*r/E;const U=Math.cos(u),J=Math.sin(u),v=U*d;for(x=0;x<=R;x++){const u=x/R,f=u*A+0,g=Math.sin(f),P=Math.cos(f);Y.x=v*g,Y.y=L+J*d,Y.z=v*P,T.push(Y.x,Y.y,Y.z),K.set(U*g,J,U*P),X.push(K.x,K.y,K.z),h.push(u,w.c?W/c:1-W/c),z.push(t),t++}V.push(z)}const j=v-d-mz+p*d-p*mz,I=N*(mz-d)/j;for(Q=1;Q<=S;Q++){const z=[];W+=D/S;const u=N*(Q*(mz-d)/S+d);for(x=0;x<=R;x++){const U=x/R,J=U*A+0,v=Math.sin(J),f=Math.cos(J);Y.x=u*v,Y.y=L+p*d-Q*j/S,Y.z=u*f,T.push(Y.x,Y.y,Y.z),K.set(v,I,f).normalize(),X.push(K.x,K.y,K.z),h.push(U,w.c?W/c:1-W/c),z.push(t),t++}V.push(z)}for(Q=1;Q<=C;Q++){const z=[],u=O-r-(Math.PI-r)*(Q/C);W+=mz*r/C;const U=Math.cos(u),J=Math.sin(u),v=U*mz;for(x=0;x<=R;x++){const u=x/R,f=u*A+0,g=Math.sin(f),P=Math.cos(f);Y.x=v*g,Y.y=J*mz-L,Y.z=v*P,T.push(Y.x,Y.y,Y.z),K.set(U*g,J,U*P),X.push(K.x,K.y,K.z),h.push(u,w.c?W/c:1-W/c),z.push(t),t++}V.push(z)}for(x=0;x<R;x++)for(Q=0;Q<E+S+C;Q++){const z=V[Q][x],u=V[Q+1][x],U=V[Q+1][x+1],J=V[Q][x+1];M.push(z),M.push(u),M.push(J),M.push(u),M.push(U),M.push(J)}if(M=M.reverse(),z.orientation&&!z.orientation.equals(J.Eu.Up())){const u=new J.Matrix;z.orientation.clone().scale(.5*Math.PI).cross(J.Eu.Up()).toQuaternion().toRotationMatrix(u);const U=J.Eu.Zero();for(let z=0;z<T.length;z+=3)U.set(T[z],T[z+1],T[z+2]),J.Eu.TransformCoordinatesToRef(U.clone(),u,U),T[z]=U.x,T[z+1]=U.y,T[z+2]=U.z}const F=new g.e;return F.Oz=T,F.xz=X,F.Kz=h,F.indices=M,F}function l(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:J.Eu.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new v.e(z,U);return s(u).pz(f,u.updatable),f}v.e.CreateDecal=(z,u,U,J,v,f)=>o(z,u,{position:U,normal:J,size:v,angle:f});v.e.CreateCapsule=(z,u,U)=>l(z,u,U),g.e.CreateCapsule=s;var e=U(12760),zz=U(12917);class uz{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=z,this.y=u,z!==Math.floor(z)&&(z=Math.floor(z),e.d.Warn("x is not an integer, floor(x) used")),u!==Math.floor(u)&&(u=Math.floor(u),e.d.Warn("y is not an integer, floor(y) used"))}clone(){return new uz(this.x,this.y)}rotate60About(z){const u=this.x;return this.x=z.x+z.y-this.y,this.y=u+this.y-z.x,this}rotateNeg60About(z){const u=this.x;return this.x=u+this.y-z.y,this.y=z.x+z.y-u,this}rotate120(z,u){z!==Math.floor(z)&&(z=Math.floor(z),e.d.Warn("m not an integer only floor(m) used")),u!==Math.floor(u)&&(u=Math.floor(u),e.d.Warn("n not an integer only floor(n) used"));const U=this.x;return this.x=z-U-this.y,this.y=u+U,this}rotateNeg120(z,u){z!==Math.floor(z)&&(z=Math.floor(z),e.d.Warn("m is not an integer, floor(m) used")),u!==Math.floor(u)&&(u=Math.floor(u),e.d.Warn("n is not an integer,   floor(n) used"));const U=this.x;return this.x=this.y-u,this.y=z+u-U-this.y,this}toCartesianOrigin(z,u){const U=J.Eu.Zero();return U.x=z.x+2*this.x*u+this.y*u,U.y=z.y+Math.sqrt(3)*this.y*u,U}static Zero(){return new uz(0,0)}}class Uz{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Jz("icosahedron","Regular",[[0,zz.g,-1],[-zz.g,1,0],[-1,0,-zz.g],[1,0,-zz.g],[zz.g,1,0],[0,zz.g,1],[-1,0,zz.g],[-zz.g,-1,0],[0,-zz.g,-1],[zz.g,-1,0],[1,0,zz.g],[0,-zz.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let z=12;const u={},U=this.m,J=this.n;let v,f,g,w,P,R=U,S=1,d=0;0!==J&&(R=(0,B.HighestCommonFactor)(U,J)),S=U/R,d=J/R;const mz=uz.Zero(),Z=new uz(U,J),A=new uz(-J,U+J),E=uz.Zero(),C=uz.Zero(),r=uz.Zero();let M,T,X,h,t=[];const V=[],L=this.vertByDist,O=(U,J,v,f)=>{M=U+"|"+v,T=J+"|"+f,M in u||T in u?M in u&&!(T in u)?u[T]=u[M]:T in u&&!(M in u)&&(u[M]=u[T]):(u[M]=z,u[T]=z,z++),L[v][0]>2?V[u[M]]=[-L[v][0],L[v][1],u[M]]:V[u[M]]=[t[L[v][0]],L[v][1],u[M]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let x=0;x<20;x++){if(t=this.IDATA.face[x],g=t[2],w=t[1],P=t[0],X=mz.x+"|"+mz.y,M=x+"|"+X,M in u||(u[M]=g,V[g]=[t[L[X][0]],L[X][1]]),X=Z.x+"|"+Z.y,M=x+"|"+X,M in u||(u[M]=w,V[w]=[t[L[X][0]],L[X][1]]),X=A.x+"|"+A.y,M=x+"|"+X,M in u||(u[M]=P,V[P]=[t[L[X][0]],L[X][1]]),v=this.IDATA.edgematch[x][0],f=this.IDATA.edgematch[x][1],"B"===f)for(let z=1;z<R;z++)C.x=U-z*(S+d),C.y=J+z*S,r.x=-z*d,r.y=z*(S+d),X=C.x+"|"+C.y,h=r.x+"|"+r.y,O(x,v,X,h);if("O"===f)for(let z=1;z<R;z++)r.x=-z*d,r.y=z*(S+d),E.x=z*S,E.y=z*d,X=r.x+"|"+r.y,h=E.x+"|"+E.y,O(x,v,X,h);if(v=this.IDATA.edgematch[x][2],f=this.IDATA.edgematch[x][3],f&&"A"===f)for(let z=1;z<R;z++)E.x=z*S,E.y=z*d,C.x=U-(R-z)*(S+d),C.y=J+(R-z)*S,X=E.x+"|"+E.y,h=C.x+"|"+C.y,O(x,v,X,h);for(let U=0;U<this.vertices.length;U++)X=this.vertices[U].x+"|"+this.vertices[U].y,M=x+"|"+X,M in u||(u[M]=z++,L[X][0]>2?V[u[M]]=[-L[X][0],L[X][1],u[M]]:V[u[M]]=[t[L[X][0]],L[X][1],u[M]])}this.closestTo=V,this.vecToidx=u}calcCoeffs(){const z=this.m,u=this.n,U=Math.sqrt(3)/3,J=z*z+u*u+z*u;this.coau=(z+u)/J,this.cobu=-u/J,this.coav=-U*(z-u)/J,this.cobv=U*(2*z+u)/J}createInnerFacets(){const z=this.m,u=this.n;for(let U=0;U<u+z+1;U++)for(let z=this.min[U];z<this.max[U]+1;z++)z<this.max[U]&&z<this.max[U+1]+1&&this.innerFacets.push(["|"+z+"|"+U,"|"+z+"|"+(U+1),"|"+(z+1)+"|"+U]),U>0&&z<this.max[U-1]&&z+1<this.max[U]+1&&this.innerFacets.push(["|"+z+"|"+U,"|"+(z+1)+"|"+U,"|"+(z+1)+"|"+(U-1)])}edgeVecsABOB(){const z=this.m,u=this.n,U=new uz(-u,z+u);for(let J=1;J<z+u;J++){const z=new uz(this.min[J],J),u=new uz(this.min[J-1],J-1),v=new uz(this.min[J+1],J+1),f=z.clone(),g=u.clone(),w=v.clone();f.rotate60About(U),g.rotate60About(U),w.rotate60About(U);const P=new uz(this.max[f.y],f.y),R=new uz(this.max[f.y-1],f.y-1),S=new uz(this.max[f.y-1]-1,f.y-1);f.x===P.x&&f.y===P.y||(f.x!==R.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([z,R,S]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([z,S,P])):f.y===w.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([z,u,R]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([z,R,v])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([z,u,R]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([z,R,P])))}}mapABOBtoOBOA(){const z=new uz(0,0);for(let u=0;u<this.isoVecsABOB.length;u++){const U=[];for(let J=0;J<3;J++)z.x=this.isoVecsABOB[u][J].x,z.y=this.isoVecsABOB[u][J].y,0===this.vertexTypes[u][J]&&z.rotateNeg120(this.m,this.n),U.push(z.clone());this.isoVecsOBOA.push(U)}}mapABOBtoBAOA(){const z=new uz(0,0);for(let u=0;u<this.isoVecsABOB.length;u++){const U=[];for(let J=0;J<3;J++)z.x=this.isoVecsABOB[u][J].x,z.y=this.isoVecsABOB[u][J].y,1===this.vertexTypes[u][J]&&z.rotate120(this.m,this.n),U.push(z.clone());this.isoVecsBAOA.push(U)}}MapToFace(z,u){const U=this.IDATA.face[z],v=U[2],f=U[1],g=U[0],w=J.Eu.Xu(this.IDATA.vertex[v]),P=J.Eu.Xu(this.IDATA.vertex[f]),R=J.Eu.Xu(this.IDATA.vertex[g]),S=P.Cu(w),d=R.Cu(w),mz=S.scale(this.coau).add(d.scale(this.cobu)),Z=S.scale(this.coav).add(d.scale(this.cobv)),A=[];let E,C=J.TmpVectors.Eu[0];for(let J=0;J<this.cartesian.length;J++)C=mz.scale(this.cartesian[J].x).add(Z.scale(this.cartesian[J].y)).add(w),A[J]=[C.x,C.y,C.z],E=z+"|"+this.vertices[J].x+"|"+this.vertices[J].y,u.vertex[this.vecToidx[E]]=[C.x,C.y,C.z]}build(z,u){const U=[],J=uz.Zero(),v=new uz(z,u),f=new uz(-u,z+u);U.push(J,v,f);for(let X=u;X<z+1;X++)for(let u=0;u<z+1-X;u++)U.push(new uz(u,X));if(u>0){const J=(0,B.HighestCommonFactor)(z,u),v=z/J,f=u/J;for(let w=1;w<J;w++)U.push(new uz(w*v,w*f)),U.push(new uz(-w*f,w*(v+f))),U.push(new uz(z-w*(v+f),u+w*v));const g=z/u;for(let w=1;w<u;w++)for(let J=0;J<w*g;J++)U.push(new uz(J,w)),U.push(new uz(J,w).rotate120(z,u)),U.push(new uz(J,w).rotateNeg120(z,u))}U.sort(((z,u)=>z.x-u.x)),U.sort(((z,u)=>z.y-u.y));const g=new Array(z+u+1),w=new Array(z+u+1);for(let X=0;X<g.length;X++)g[X]=1/0,w[X]=-1/0;let P=0,R=0;const S=U.length;for(let X=0;X<S;X++)R=U[X].x,P=U[X].y,g[P]=Math.min(R,g[P]),w[P]=Math.max(R,w[P]);const d=(U,J)=>{const v=U.clone();return"A"===J&&v.rotateNeg120(z,u),"B"===J&&v.rotate120(z,u),v.x<0?v.y:v.x+v.y},mz=[],Z=[],A=[],E=[],C={},r=[];let M=-1,T=-1;for(let X=0;X<S;X++)mz[X]=U[X].toCartesianOrigin(new uz(0,0),.5),Z[X]=d(U[X],"O"),A[X]=d(U[X],"A"),E[X]=d(U[X],"B"),Z[X]===A[X]&&A[X]===E[X]?(M=3,T=Z[X]):Z[X]===A[X]?(M=4,T=Z[X]):A[X]===E[X]?(M=5,T=A[X]):E[X]===Z[X]&&(M=6,T=Z[X]),Z[X]<A[X]&&Z[X]<E[X]&&(M=2,T=Z[X]),A[X]<Z[X]&&A[X]<E[X]&&(M=1,T=A[X]),E[X]<A[X]&&E[X]<Z[X]&&(M=0,T=E[X]),r.push([M,T,U[X].x,U[X].y]);r.sort(((z,u)=>z[2]-u[2])),r.sort(((z,u)=>z[3]-u[3])),r.sort(((z,u)=>z[1]-u[1])),r.sort(((z,u)=>z[0]-u[0]));for(let X=0;X<r.length;X++)C[r[X][2]+"|"+r[X][3]]=[r[X][0],r[X][1],X];return this.m=z,this.n=u,this.vertices=U,this.vertByDist=C,this.cartesian=mz,this.min=g,this.max=w,this}}class Jz{constructor(z,u,U,J){this.name=z,this.category=u,this.vertex=U,this.face=J}}class vz extends Jz{innerToData(z,u){for(let U=0;U<u.innerFacets.length;U++)this.face.push(u.innerFacets[U].map((U=>u.vecToidx[z+U])))}mapABOBtoDATA(z,u){const U=u.IDATA.edgematch[z][0];for(let J=0;J<u.isoVecsABOB.length;J++){const v=[];for(let f=0;f<3;f++)0===u.vertexTypes[J][f]?v.push(z+"|"+u.isoVecsABOB[J][f].x+"|"+u.isoVecsABOB[J][f].y):v.push(U+"|"+u.isoVecsABOB[J][f].x+"|"+u.isoVecsABOB[J][f].y);this.face.push([u.vecToidx[v[0]],u.vecToidx[v[1]],u.vecToidx[v[2]]])}}mapOBOAtoDATA(z,u){const U=u.IDATA.edgematch[z][0];for(let J=0;J<u.isoVecsOBOA.length;J++){const v=[];for(let f=0;f<3;f++)1===u.vertexTypes[J][f]?v.push(z+"|"+u.isoVecsOBOA[J][f].x+"|"+u.isoVecsOBOA[J][f].y):v.push(U+"|"+u.isoVecsOBOA[J][f].x+"|"+u.isoVecsOBOA[J][f].y);this.face.push([u.vecToidx[v[0]],u.vecToidx[v[1]],u.vecToidx[v[2]]])}}mapBAOAtoDATA(z,u){const U=u.IDATA.edgematch[z][2];for(let J=0;J<u.isoVecsBAOA.length;J++){const v=[];for(let f=0;f<3;f++)1===u.vertexTypes[J][f]?v.push(z+"|"+u.isoVecsBAOA[J][f].x+"|"+u.isoVecsBAOA[J][f].y):v.push(U+"|"+u.isoVecsBAOA[J][f].x+"|"+u.isoVecsBAOA[J][f].y);this.face.push([u.vecToidx[v[0]],u.vecToidx[v[1]],u.vecToidx[v[2]]])}}orderData(z){const u=[];for(let f=0;f<13;f++)u[f]=[];const U=z.closestTo;for(let f=0;f<U.length;f++)U[f][0]>-1?U[f][1]>0&&u[U[f][0]].push([f,U[f][1]]):u[12].push([f,U[f][0]]);const J=[];for(let f=0;f<12;f++)J[f]=f;let v=12;for(let f=0;f<12;f++){u[f].sort(((z,u)=>z[1]-u[1]));for(let z=0;z<u[f].length;z++)J[u[f][z][0]]=v++}for(let f=0;f<u[12].length;f++)J[u[12][f][0]]=v++;for(let f=0;f<this.vertex.length;f++)this.vertex[f].push(J[f]);this.vertex.sort(((z,u)=>z[3]-u[3]));for(let f=0;f<this.vertex.length;f++)this.vertex[f].pop();for(let f=0;f<this.face.length;f++)for(let z=0;z<this.face[f].length;z++)this.face[f][z]=J[this.face[f][z]];this.sharedNodes=u[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(z,u){const U=[],J=[];let v=u.pop();J.push(v);let f=this.face[v].indexOf(z);f=(f+2)%3;let g=this.face[v][f];U.push(g);let w=0;for(;u.length>0;)v=u[w],this.face[v].indexOf(g)>-1?(f=(this.face[v].indexOf(g)+1)%3,g=this.face[v][f],U.push(g),J.push(v),u.splice(w,1),w=0):w++;return this.adjacentFaces.push(U),J}toGoldbergPolyhedronData(){const z=new Jz("GeoDual","Goldberg",[],[]);z.name="GD dual";const u=this.vertex.length,U=new Array(u);for(let P=0;P<u;P++)U[P]=[];for(let P=0;P<this.face.length;P++)for(let z=0;z<3;z++)U[this.face[P][z]].push(P);let J=0,v=0,f=0,g=[],w=[];this.adjacentFaces=[];for(let P=0;P<U.length;P++){z.face[P]=this.setOrder(P,U[P].concat([]));for(const u of U[P]){J=0,v=0,f=0,g=this.face[u];for(let z=0;z<3;z++)w=this.vertex[g[z]],J+=w[0],v+=w[1],f+=w[2];z.vertex[u]=[J/3,v/3,f/3]}}return z}static BuildGeodesicData(z){const u=new vz("Geodesic-m-n","Geodesic",[[0,zz.g,-1],[-zz.g,1,0],[-1,0,-zz.g],[1,0,-zz.g],[zz.g,1,0],[0,zz.g,1],[-1,0,zz.g],[-zz.g,-1,0],[0,-zz.g,-1],[zz.g,-1,0],[1,0,zz.g],[0,-zz.g,1]],[]);z.setIndices(),z.calcCoeffs(),z.createInnerFacets(),z.edgeVecsABOB(),z.mapABOBtoOBOA(),z.mapABOBtoBAOA();for(let U=0;U<z.IDATA.face.length;U++)z.MapToFace(U,u),u.innerToData(U,z),"B"===z.IDATA.edgematch[U][1]&&u.mapABOBtoDATA(U,z),"O"===z.IDATA.edgematch[U][1]&&u.mapOBOAtoDATA(U,z),"A"===z.IDATA.edgematch[U][3]&&u.mapBAOAtoDATA(U,z);u.orderData(z);return u.vertex=u.vertex.map((function(z){const u=z[0],U=z[1],J=z[2],v=Math.sqrt(u*u+U*U+J*J);return z[0]*=1/v,z[1]*=1/v,z[2]*=1/v,z})),u}}v.e._GoldbergMeshParser=(z,u)=>fz.Parse(z,u);class fz extends v.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(z,u){return void 0===u?(z>this.goldbergData.nbUnsharedFaces-1&&(e.d.Warn("Maximum number of unshared faces used"),z=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+z):(z>11&&(e.d.Warn("Last pole used"),z=11),u>this.goldbergData.nbFacesAtPole-1&&(e.d.Warn("Maximum number of faces at a pole used"),u=this.goldbergData.nbFacesAtPole-1),12+z*this.goldbergData.nbFacesAtPole+u)}_changeGoldbergFaceColors(z){for(let U=0;U<z.length;U++){const u=z[U][0],J=z[U][1],v=z[U][2];for(let z=u;z<J+1;z++)this.goldbergData.faceColors[z]=v}const u=[];for(let U=0;U<12;U++)for(let z=0;z<5;z++)u.push(this.goldbergData.faceColors[U].r,this.goldbergData.faceColors[U].g,this.goldbergData.faceColors[U].b,this.goldbergData.faceColors[U].a);for(let U=12;U<this.goldbergData.faceColors.length;U++)for(let z=0;z<6;z++)u.push(this.goldbergData.faceColors[U].r,this.goldbergData.faceColors[U].g,this.goldbergData.faceColors[U].b,this.goldbergData.faceColors[U].a);return u}setGoldbergFaceColors(z){const u=this._changeGoldbergFaceColors(z);this.Wz(f.g.ColorKind,u)}updateGoldbergFaceColors(z){const u=this._changeGoldbergFaceColors(z);this.updateVerticesData(f.g.ColorKind,u)}_changeGoldbergFaceUVs(z){const u=this.getVerticesData(f.g.UVKind);for(let U=0;U<z.length;U++){const J=z[U][0],v=z[U][1],f=z[U][2],g=z[U][3],w=z[U][4],P=[],R=[];let S,d;for(let z=0;z<5;z++)S=f.x+g*Math.cos(w+z*Math.PI/2.5),d=f.y+g*Math.sin(w+z*Math.PI/2.5),S<0&&(S=0),S>1&&(S=1),P.push(S,d);for(let z=0;z<6;z++)S=f.x+g*Math.cos(w+z*Math.PI/3),d=f.y+g*Math.sin(w+z*Math.PI/3),S<0&&(S=0),S>1&&(S=1),R.push(S,d);for(let z=J;z<Math.min(12,v+1);z++)for(let U=0;U<5;U++)u[10*z+2*U]=P[2*U],u[10*z+2*U+1]=P[2*U+1];for(let z=Math.max(12,J);z<v+1;z++)for(let U=0;U<6;U++)u[12*z-24+2*U]=R[2*U],u[12*z-23+2*U]=R[2*U+1]}return u}setGoldbergFaceUVs(z){const u=this._changeGoldbergFaceUVs(z);this.Wz(f.g.UVKind,u)}updateGoldbergFaceUVs(z){const u=this._changeGoldbergFaceUVs(z);this.updateVerticesData(f.g.UVKind,u)}placeOnGoldbergFaceAt(z,u,U){const v=J.Eu.RotationFromAxis(this.goldbergData.faceXaxis[u],this.goldbergData.faceYaxis[u],this.goldbergData.faceZaxis[u]);z.rotation=v,z.position=this.goldbergData.faceCenters[u].add(this.goldbergData.faceXaxis[u].scale(U.x)).add(this.goldbergData.faceYaxis[u].scale(U.y)).add(this.goldbergData.faceZaxis[u].scale(U.z))}serialize(z){super.serialize(z),z.type="GoldbergMesh";const u={};if(u.adjacentFaces=this.goldbergData.adjacentFaces,u.nbSharedFaces=this.goldbergData.nbSharedFaces,u.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,u.nbFaces=this.goldbergData.nbFaces,u.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){u.faceColors=[];for(const z of this.goldbergData.faceColors)u.faceColors.push(z.jf())}if(this.goldbergData.faceCenters){u.faceCenters=[];for(const z of this.goldbergData.faceCenters)u.faceCenters.push(z.jf())}if(this.goldbergData.faceZaxis){u.faceZaxis=[];for(const z of this.goldbergData.faceZaxis)u.faceZaxis.push(z.jf())}if(this.goldbergData.faceYaxis){u.faceYaxis=[];for(const z of this.goldbergData.faceYaxis)u.faceYaxis.push(z.jf())}if(this.goldbergData.faceXaxis){u.faceXaxis=[];for(const z of this.goldbergData.faceXaxis)u.faceXaxis.push(z.jf())}z.goldbergData=u}static Parse(z,u){const U=z.goldbergData;U.faceColors=U.faceColors.map((z=>mz.wg.Xu(z))),U.faceCenters=U.faceCenters.map((z=>J.Eu.Xu(z))),U.faceZaxis=U.faceZaxis.map((z=>J.Eu.Xu(z))),U.faceXaxis=U.faceXaxis.map((z=>J.Eu.Xu(z))),U.faceYaxis=U.faceYaxis.map((z=>J.Eu.Xu(z)));const v=new fz(z.name,u);return v.goldbergData=U,v}}var gz=U(13433);const wz={CreateBox:d.d,CreateTiledBox:C,CreateSphere:r.c,CreateDisc:S.e,CreateIcoSphere:k,CreateRibbon:R,CreateCylinder:h,CreateTorus:V,CreateTorusKnot:O,CreateLineSystem:x.h,zS:x.i,CreateDashedLines:x.d,ExtrudeShape:Y,ExtrudeShapeCustom:p,CreateLathe:D,CreateTiledPlane:A,JS:c.c,CreateGround:W.f,CreateTiledGround:W.i,CreateGroundFromHeightMap:W.d,CreatePolygon:Q.e,ExtrudePolygon:Q.i,CreateTube:j,CreatePolyhedron:F,CreateGeodesic:function(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=u.m||1;J!==Math.floor(J)&&(J=Math.floor(J),e.d.Warn("m not an integer only floor(m) used"));let v=u.n||0;if(v!==Math.floor(v)&&(v=Math.floor(v),e.d.Warn("n not an integer only floor(n) used")),v>J){const z=v;v=J,J=z,e.d.Warn("n > m therefore m and n swapped")}const f=new Uz;return f.build(J,v),F(z,{custom:vz.BuildGeodesicData(f),size:u.size,sizeX:u.sizeX,sizeY:u.sizeY,sizeZ:u.sizeZ,faceUV:u.faceUV,faceColors:u.faceColors,flat:u.flat,updatable:u.updatable,sideOrientation:u.sideOrientation,frontUVs:u.frontUVs,backUVs:u.backUVs},U)},CreateGoldberg:function(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=u.size,P=u.sizeX||f||1,R=u.sizeY||f||1,S=u.sizeZ||f||1;let d=u.m||1;d!==Math.floor(d)&&(d=Math.floor(d),e.d.Warn("m not an integer only floor(m) used"));let Z=u.n||0;if(Z!==Math.floor(Z)&&(Z=Math.floor(Z),e.d.Warn("n not an integer only floor(n) used")),Z>d){const z=Z;Z=d,d=z,e.d.Warn("n > m therefore m and n swapped")}const A=new Uz;A.build(d,Z);const E=vz.BuildGeodesicData(A),C=E.toGoldbergPolyhedronData(),r=new fz(z,U);u.sideOrientation=v.e._GetDefaultSideOrientation(u.sideOrientation),r._originalBuilderSideOrientation=u.sideOrientation;(function(z,u){const U=z.size,v=z.sizeX||U||1,f=z.sizeY||U||1,P=z.sizeZ||U||1,R=0===z.sideOrientation?0:z.sideOrientation||g.e.DEFAULTSIDE,S=[],d=[],mz=[],Z=[];let A=1/0,E=-1/0,C=1/0,r=-1/0;for(let J=0;J<u.vertex.length;J++)A=Math.min(A,u.vertex[J][0]*v),E=Math.max(E,u.vertex[J][0]*v),C=Math.min(C,u.vertex[J][1]*f),r=Math.max(r,u.vertex[J][1]*f);let M=0;for(let g=0;g<u.face.length;g++){const z=u.face[g],U=J.Eu.Xu(u.vertex[z[0]]),R=J.Eu.Xu(u.vertex[z[2]]),T=J.Eu.Xu(u.vertex[z[1]]),X=R.Cu(U),h=T.Cu(U),t=J.Eu.Cross(h,X).normalize();for(let J=0;J<z.length;J++){mz.push(t.x,t.y,t.z);const U=u.vertex[z[J]];S.push(U[0]*v,U[1]*f,U[2]*P);const g=(U[1]*f-C)/(r-C);Z.push((U[0]*v-A)/(E-A),w.c?1-g:g)}for(let u=0;u<z.length-2;u++)d.push(M,M+u+2,M+u+1);M+=z.length}g.e._ComputeSides(R,S,d,mz,Z);const T=new g.e;return T.Oz=S,T.indices=d,T.xz=mz,T.Kz=Z,T})(u,C).pz(r,u.updatable),r.goldbergData.nbSharedFaces=E.sharedNodes,r.goldbergData.nbUnsharedFaces=E.poleNodes,r.goldbergData.adjacentFaces=E.adjacentFaces,r.goldbergData.nbFaces=r.goldbergData.nbSharedFaces+r.goldbergData.nbUnsharedFaces,r.goldbergData.nbFacesAtPole=(r.goldbergData.nbUnsharedFaces-12)/12;for(let v=0;v<E.vertex.length;v++)r.goldbergData.faceCenters.push(J.Eu.Xu(E.vertex[v])),r.goldbergData.faceCenters[v].x*=P,r.goldbergData.faceCenters[v].y*=R,r.goldbergData.faceCenters[v].z*=S,r.goldbergData.faceColors.push(new mz.wg(1,1,1,1));for(let v=0;v<C.face.length;v++){const z=C.face[v],u=J.Eu.Xu(C.vertex[z[0]]),U=J.Eu.Xu(C.vertex[z[2]]),f=J.Eu.Xu(C.vertex[z[1]]),g=U.Cu(u),w=f.Cu(u),P=J.Eu.Cross(w,g).normalize(),R=J.Eu.Cross(w,P).normalize();r.goldbergData.faceXaxis.push(w.normalize()),r.goldbergData.faceYaxis.push(P),r.goldbergData.faceZaxis.push(R)}return r},CreateDecal:o,CreateCapsule:l,CreateText:gz.f}},13778:(z,u,U)=>{"use strict";U.d(u,{d:()=>Pu});var J=U(12914),v=U(13283);class f extends v.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var g=U(12967),w=(U(13092),U(12875));class P{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(z){this._targetStopDuration!==z&&(this._targetStopDuration=z)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(z){this._noiseTexture!==z&&(this._noiseTexture=z,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(z){this._animationSheetEnabled!==z&&(this._animationSheetEnabled=z)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(z){this._isAnimationSheetEnabled!=z&&(this._isAnimationSheetEnabled=z,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(z){this._useLogarithmicDepth=z&&this.Vz().getEngine().getCaps().fragmentDepthSupported}Vz(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(z){switch(z){case P.BLENDMODE_MULTIPLYADD:return;case P.BLENDMODE_ADD:z=1;break;case P.BLENDMODE_ONEONE:z=6;break;case P.BLENDMODE_STANDARD:z=2;break;case P.BLENDMODE_MULTIPLY:z=4;break;case P.BLENDMODE_SUBTRACT:z=3}this._engine.setAlphaMode(z)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:J.Eu.Zero()}set direction1(z){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=z)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:J.Eu.Zero()}set direction2(z){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=z)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:J.Eu.Zero()}set minEmitBox(z){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=z)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:J.Eu.Zero()}set maxEmitBox(z){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=z)}get billboardMode(){return this._billboardMode}set billboardMode(z){this._billboardMode!==z&&(this._billboardMode=z,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(z){this._isBillboardBased!==z&&(this._isBillboardBased=z,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(z){this._attachImageProcessingConfiguration(z)}_attachImageProcessingConfiguration(z){z!==this._imageProcessingConfiguration&&(!z&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=z)}_reset(){}_removeGradientAndTexture(z,u,U){if(!u)return this;let J=0;for(const v of u){if(v.gradient===z){u.splice(J,1);break}J++}return U&&U.dispose(),this}constructor(z){this.animations=[],this.renderingGroupId=0,this.vu=J.Eu.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new J.Eu(10,10,10),this.onAnimationEnd=null,this.blendMode=P.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new J.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.sR=new J.Eu(0,0,0),this._useLogarithmicDepth=!1,this.gravity=J.Eu.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new g.wg(1,1,1,1),this.color2=new g.wg(1,1,1,1),this.colorDead=new g.wg(0,0,0,1),this.textureMask=new g.wg(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new f,this.id=z,this.name=z}createPointEmitter(z,u){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new J.Eu(0,1,0),arguments.length>2&&void 0!==arguments[2]||new J.Eu(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new J.Eu(0,1,0),arguments.length>4&&void 0!==arguments[4]||new J.Eu(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new J.Eu(0,1,0),arguments.length>3&&void 0!==arguments[3]||new J.Eu(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(z,u,U,J){throw new Error("Method not implemented.")}}P.BLENDMODE_ONEONE=0,P.BLENDMODE_STANDARD=1,P.BLENDMODE_ADD=2,P.BLENDMODE_MULTIPLY=3,P.BLENDMODE_MULTIPLYADD=4,P.BLENDMODE_SUBTRACT=-1,(0,w.f)("BABYLON.BaseParticleSystem",P);var R=U(12935),S=U(12768);class d{constructor(){this.direction1=new J.Eu(0,1,0),this.direction2=new J.Eu(0,1,0),this.minEmitBox=new J.Eu(-.5,-.5,-.5),this.maxEmitBox=new J.Eu(.5,.5,.5)}startDirectionFunction(z,u,U,v){const f=(0,R.RandomRange)(this.direction1.x,this.direction2.x),g=(0,R.RandomRange)(this.direction1.y,this.direction2.y),w=(0,R.RandomRange)(this.direction1.z,this.direction2.z);if(v)return u.x=f,u.y=g,void(u.z=w);J.Eu.TransformNormalFromFloatsToRef(f,g,w,z,u)}startPositionFunction(z,u,U,v){const f=(0,R.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),g=(0,R.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),w=(0,R.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(v)return u.x=f,u.y=g,void(u.z=w);J.Eu.TransformCoordinatesFromFloatsToRef(f,g,w,z,u)}clone(){const z=new d;return S.c.DeepCopy(this,z),z}applyToShader(z){z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2),z.setVector3("minEmitBox",this.minEmitBox),z.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(z){z.addUniform("direction1",3),z.addUniform("direction2",3),z.addUniform("minEmitBox",3),z.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.direction1=this.direction1.jf(),z.direction2=this.direction2.jf(),z.minEmitBox=this.minEmitBox.jf(),z.maxEmitBox=this.maxEmitBox.jf(),z}parse(z){J.Eu.FromArrayToRef(z.direction1,0,this.direction1),J.Eu.FromArrayToRef(z.direction2,0,this.direction2),J.Eu.FromArrayToRef(z.minEmitBox,0,this.minEmitBox),J.Eu.FromArrayToRef(z.maxEmitBox,0,this.maxEmitBox)}}class mz{get radius(){return this._radius}set radius(z){this._radius=z,this._buildHeight()}get angle(){return this._angle}set angle(z){this._angle=z,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=U,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=u,this.radius=z}startDirectionFunction(z,u,U,v){v?J.TmpVectors.Eu[0].v(U.YP).normalize():U.position.subtractToRef(z.getTranslation(),J.TmpVectors.Eu[0]).normalize();const f=(0,R.RandomRange)(0,this.directionRandomizer),g=(0,R.RandomRange)(0,this.directionRandomizer),w=(0,R.RandomRange)(0,this.directionRandomizer);u.x=J.TmpVectors.Eu[0].x+f,u.y=J.TmpVectors.Eu[0].y+g,u.z=J.TmpVectors.Eu[0].z+w,u.normalize()}startPositionFunction(z,u,U,v){const f=(0,R.RandomRange)(0,2*Math.PI);let g;this.emitFromSpawnPointOnly?g=1e-4:(g=(0,R.RandomRange)(0,this.heightRange),g=1-g*g);let w=this._radius-(0,R.RandomRange)(0,this._radius*this.radiusRange);w*=g;const P=w*Math.sin(f),S=w*Math.cos(f),d=g*this._height;if(v)return u.x=P,u.y=d,void(u.z=S);J.Eu.TransformCoordinatesFromFloatsToRef(P,d,S,z,u)}clone(){const z=new mz(this._radius,this._angle,this.directionRandomizer);return S.c.DeepCopy(this,z),z}applyToShader(z){z.setFloat2("radius",this._radius,this.radiusRange),z.setFloat("coneAngle",this._angle),z.setFloat2("height",this._height,this.heightRange),z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(z){z.addUniform("radius",2),z.addUniform("coneAngle",1),z.addUniform("height",2),z.addUniform("directionRandomizer",1)}getEffectDefines(){let z="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(z+="\n#define CONEEMITTERSPAWNPOINT"),z}getClassName(){return"ConeParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.radius=this._radius,z.angle=this._angle,z.directionRandomizer=this.directionRandomizer,z.radiusRange=this.radiusRange,z.heightRange=this.heightRange,z.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,z}parse(z){this.radius=z.radius,this.angle=z.angle,this.directionRandomizer=z.directionRandomizer,this.radiusRange=void 0!==z.radiusRange?z.radiusRange:1,this.heightRange=void 0!==z.radiusRange?z.heightRange:1,this.emitFromSpawnPointOnly=void 0!==z.emitFromSpawnPointOnly&&z.emitFromSpawnPointOnly}}class Z extends mz{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.Eu(0,1,0),v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.Eu(0,1,0);super(z,u),this.direction1=U,this.direction2=v}startDirectionFunction(z,u){const U=(0,R.RandomRange)(this.direction1.x,this.direction2.x),v=(0,R.RandomRange)(this.direction1.y,this.direction2.y),f=(0,R.RandomRange)(this.direction1.z,this.direction2.z);J.Eu.TransformNormalFromFloatsToRef(U,v,f,z,u)}clone(){const z=new Z(this.radius,this.angle,this.direction1,this.direction2);return S.c.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("radiusRange",this.radiusRange),z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("radiusRange",1),z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const z=super.serialize();return z.direction1=this.direction1.jf(),z.direction2=this.direction2.jf(),z}parse(z){super.parse(z),this.direction1.v(z.direction1),this.direction2.v(z.direction2)}}class A{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=z,this.height=u,this.radiusRange=U,this.directionRandomizer=v,this._tempVector=J.Eu.Zero()}startDirectionFunction(z,u,U,v,f){U.position.subtractToRef(z.getTranslation(),this._tempVector),this._tempVector.normalize(),J.Eu.TransformNormalToRef(this._tempVector,f,this._tempVector);const g=(0,R.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let w=Math.atan2(this._tempVector.x,this._tempVector.z);w+=(0,R.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=g,this._tempVector.x=Math.sin(w),this._tempVector.z=Math.cos(w),this._tempVector.normalize(),v?u.v(this._tempVector):J.Eu.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,z,u)}startPositionFunction(z,u,U,v){const f=(0,R.RandomRange)(-this.height/2,this.height/2),g=(0,R.RandomRange)(0,2*Math.PI),w=(0,R.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),P=Math.sqrt(w)*this.radius,S=P*Math.cos(g),d=P*Math.sin(g);v?u.zg(S,f,d):J.Eu.TransformCoordinatesFromFloatsToRef(S,f,d,z,u)}clone(){const z=new A(this.radius,this.directionRandomizer);return S.c.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("height",this.height),z.setFloat("radiusRange",this.radiusRange),z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("height",1),z.addUniform("radiusRange",1),z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.radius=this.radius,z.height=this.height,z.radiusRange=this.radiusRange,z.directionRandomizer=this.directionRandomizer,z}parse(z){this.radius=z.radius,this.height=z.height,this.radiusRange=z.radiusRange,this.directionRandomizer=z.directionRandomizer}}class E extends A{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.Eu(0,1,0),f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.Eu(0,1,0);super(z,u,U),this.direction1=v,this.direction2=f}startDirectionFunction(z,u,U,v){const f=(0,R.RandomRange)(this.direction1.x,this.direction2.x),g=(0,R.RandomRange)(this.direction1.y,this.direction2.y),w=(0,R.RandomRange)(this.direction1.z,this.direction2.z);v?u.zg(f,g,w):J.Eu.TransformNormalFromFloatsToRef(f,g,w,z,u)}clone(){const z=new E(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return S.c.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("height",this.height),z.setFloat("radiusRange",this.radiusRange),z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("height",1),z.addUniform("radiusRange",1),z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const z=super.serialize();return z.direction1=this.direction1.jf(),z.direction2=this.direction2.jf(),z}parse(z){super.parse(z),J.Eu.FromArrayToRef(z.direction1,0,this.direction1),J.Eu.FromArrayToRef(z.direction2,0,this.direction2)}}class C{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=z,this.radiusRange=u,this.directionRandomizer=U}startDirectionFunction(z,u,U,v){const f=U.position.Cu(z.getTranslation()).normalize(),g=(0,R.RandomRange)(0,this.directionRandomizer),w=(0,R.RandomRange)(0,this.directionRandomizer),P=(0,R.RandomRange)(0,this.directionRandomizer);f.x+=g,f.y+=w,f.z+=P,f.normalize(),v?u.v(f):J.Eu.TransformNormalFromFloatsToRef(f.x,f.y,f.z,z,u)}startPositionFunction(z,u,U,v){const f=this.radius-(0,R.RandomRange)(0,this.radius*this.radiusRange),g=(0,R.RandomRange)(0,1),w=(0,R.RandomRange)(0,2*Math.PI),P=Math.acos(2*g-1),S=f*Math.cos(w)*Math.sin(P),d=f*Math.cos(P),mz=f*Math.sin(w)*Math.sin(P);v?u.zg(S,Math.abs(d),mz):J.Eu.TransformCoordinatesFromFloatsToRef(S,Math.abs(d),mz,z,u)}clone(){const z=new C(this.radius,this.directionRandomizer);return S.c.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("radiusRange",this.radiusRange),z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("radiusRange",1),z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.radius=this.radius,z.radiusRange=this.radiusRange,z.directionRandomizer=this.directionRandomizer,z}parse(z){this.radius=z.radius,this.radiusRange=z.radiusRange,this.directionRandomizer=z.directionRandomizer}}class r{constructor(){this.direction1=new J.Eu(0,1,0),this.direction2=new J.Eu(0,1,0)}startDirectionFunction(z,u,U,v){const f=(0,R.RandomRange)(this.direction1.x,this.direction2.x),g=(0,R.RandomRange)(this.direction1.y,this.direction2.y),w=(0,R.RandomRange)(this.direction1.z,this.direction2.z);v?u.zg(f,g,w):J.Eu.TransformNormalFromFloatsToRef(f,g,w,z,u)}startPositionFunction(z,u,U,v){v?u.zg(0,0,0):J.Eu.TransformCoordinatesFromFloatsToRef(0,0,0,z,u)}clone(){const z=new r;return S.c.DeepCopy(this,z),z}applyToShader(z){z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.direction1=this.direction1.jf(),z.direction2=this.direction2.jf(),z}parse(z){J.Eu.FromArrayToRef(z.direction1,0,this.direction1),J.Eu.FromArrayToRef(z.direction2,0,this.direction2)}}class M{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=z,this.radiusRange=u,this.directionRandomizer=U}startDirectionFunction(z,u,U,v){const f=U.position.Cu(z.getTranslation()).normalize(),g=(0,R.RandomRange)(0,this.directionRandomizer),w=(0,R.RandomRange)(0,this.directionRandomizer),P=(0,R.RandomRange)(0,this.directionRandomizer);f.x+=g,f.y+=w,f.z+=P,f.normalize(),v?u.v(f):J.Eu.TransformNormalFromFloatsToRef(f.x,f.y,f.z,z,u)}startPositionFunction(z,u,U,v){const f=this.radius-(0,R.RandomRange)(0,this.radius*this.radiusRange),g=(0,R.RandomRange)(0,1),w=(0,R.RandomRange)(0,2*Math.PI),P=Math.acos(2*g-1),S=f*Math.cos(w)*Math.sin(P),d=f*Math.cos(P),mz=f*Math.sin(w)*Math.sin(P);v?u.zg(S,d,mz):J.Eu.TransformCoordinatesFromFloatsToRef(S,d,mz,z,u)}clone(){const z=new M(this.radius,this.directionRandomizer);return S.c.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("radiusRange",this.radiusRange),z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("radiusRange",1),z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.radius=this.radius,z.radiusRange=this.radiusRange,z.directionRandomizer=this.directionRandomizer,z}parse(z){this.radius=z.radius,this.radiusRange=z.radiusRange,this.directionRandomizer=z.directionRandomizer}}class T extends M{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.Eu(0,1,0),U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.Eu(0,1,0);super(z),this.direction1=u,this.direction2=U}startDirectionFunction(z,u){const U=(0,R.RandomRange)(this.direction1.x,this.direction2.x),v=(0,R.RandomRange)(this.direction1.y,this.direction2.y),f=(0,R.RandomRange)(this.direction1.z,this.direction2.z);J.Eu.TransformNormalFromFloatsToRef(U,v,f,z,u)}clone(){const z=new T(this.radius,this.direction1,this.direction2);return S.c.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("radiusRange",this.radiusRange),z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("radiusRange",1),z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const z=super.serialize();return z.direction1=this.direction1.jf(),z.direction2=this.direction2.jf(),z}parse(z){super.parse(z),this.direction1.v(z.direction1),this.direction2.v(z.direction2)}}class X{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(z,u,U,v){const f=J.TmpVectors.Eu[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,U,f);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,U,f);const z=J.TmpVectors.Eu[1];f.subtractToRef(U.position,z),z.scaleToRef(1/U.lifeTime,f)}else f.set(0,0,0);v?u.v(f):J.Eu.TransformNormalToRef(f,z,u)}startPositionFunction(z,u,U,v){const f=J.TmpVectors.Eu[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,U,f):f.set(0,0,0),v?u.v(f):J.Eu.TransformCoordinatesToRef(f,z,u)}clone(){const z=new X;return S.c.DeepCopy(this,z),z}applyToShader(z){}buildUniformLayout(z){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.particlePositionGenerator=this.particlePositionGenerator,z.particleDestinationGenerator=this.particleDestinationGenerator,z}parse(z){z.particlePositionGenerator&&(this.particlePositionGenerator=z.particlePositionGenerator),z.particleDestinationGenerator&&(this.particleDestinationGenerator=z.particleDestinationGenerator)}}var h=U(13e3);class t{get mesh(){return this._mesh}set mesh(z){this._mesh!==z&&(this._mesh=z,z?(this._indices=z.lf(),this._positions=z.getVerticesData(h.g.PositionKind),this._normals=z.getVerticesData(h.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=J.Eu.Zero(),this._mesh=null,this.direction1=new J.Eu(0,1,0),this.direction2=new J.Eu(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=z}startDirectionFunction(z,u,U,v){if(this.useMeshNormalsForDirection&&this._normals)return void J.Eu.TransformNormalToRef(this._storedNormal,z,u);const f=(0,R.RandomRange)(this.direction1.x,this.direction2.x),g=(0,R.RandomRange)(this.direction1.y,this.direction2.y),w=(0,R.RandomRange)(this.direction1.z,this.direction2.z);v?u.zg(f,g,w):J.Eu.TransformNormalFromFloatsToRef(f,g,w,z,u)}startPositionFunction(z,u,U,v){if(!this._indices||!this._positions)return;const f=3*(Math.random()*(this._indices.length/3)|0),g=Math.random(),w=Math.random()*(1-g),P=1-g-w,R=this._indices[f],S=this._indices[f+1],d=this._indices[f+2],mz=J.TmpVectors.Eu[0],Z=J.TmpVectors.Eu[1],A=J.TmpVectors.Eu[2],E=J.TmpVectors.Eu[3];J.Eu.FromArrayToRef(this._positions,3*R,mz),J.Eu.FromArrayToRef(this._positions,3*S,Z),J.Eu.FromArrayToRef(this._positions,3*d,A),E.x=g*mz.x+w*Z.x+P*A.x,E.y=g*mz.y+w*Z.y+P*A.y,E.z=g*mz.z+w*Z.z+P*A.z,v?u.zg(E.x,E.y,E.z):J.Eu.TransformCoordinatesFromFloatsToRef(E.x,E.y,E.z,z,u),this.useMeshNormalsForDirection&&this._normals&&(J.Eu.FromArrayToRef(this._normals,3*R,mz),J.Eu.FromArrayToRef(this._normals,3*S,Z),J.Eu.FromArrayToRef(this._normals,3*d,A),this._storedNormal.x=g*mz.x+w*Z.x+P*A.x,this._storedNormal.y=g*mz.y+w*Z.y+P*A.y,this._storedNormal.z=g*mz.z+w*Z.z+P*A.z)}clone(){const z=new t(this.mesh);return S.c.DeepCopy(this,z),z}applyToShader(z){z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var z;const u={};return u.type=this.getClassName(),u.direction1=this.direction1.jf(),u.direction2=this.direction2.jf(),u.meshId=null===(z=this.mesh)||void 0===z?void 0:z.id,u.useMeshNormalsForDirection=this.useMeshNormalsForDirection,u}parse(z,u){J.Eu.FromArrayToRef(z.direction1,0,this.direction1),J.Eu.FromArrayToRef(z.direction2,0,this.direction2),z.meshId&&u&&(this.mesh=u.getLastMeshById(z.meshId)),this.useMeshNormalsForDirection=z.useMeshNormalsForDirection}}class V{_isUbo(z){return void 0!==z.addUniform}constructor(z){this._isUbo(z)?(this.setMatrix3x3=z.updateMatrix3x3.bind(z),this.setMatrix2x2=z.updateMatrix2x2.bind(z),this.setFloat=z.updateFloat.bind(z),this.setFloat2=z.updateFloat2.bind(z),this.setFloat3=z.updateFloat3.bind(z),this.setFloat4=z.updateFloat4.bind(z),this.setFloatArray=z.updateFloatArray.bind(z),this.setArray=z.updateArray.bind(z),this.setIntArray=z.updateIntArray.bind(z),this.setMatrix=z.Gf.bind(z),this.setMatrices=z.updateMatrices.bind(z),this.setVector3=z.updateVector3.bind(z),this.setVector4=z.updateVector4.bind(z),this.setColor3=z.updateColor3.bind(z),this.setColor4=z.updateColor4.bind(z),this.setDirectColor4=z.updateDirectColor4.bind(z),this.setInt=z.updateInt.bind(z),this.setInt2=z.updateInt2.bind(z),this.setInt3=z.updateInt3.bind(z),this.setInt4=z.updateInt4.bind(z)):(this.setMatrix3x3=z.setMatrix3x3.bind(z),this.setMatrix2x2=z.setMatrix2x2.bind(z),this.setFloat=z.setFloat.bind(z),this.setFloat2=z.setFloat2.bind(z),this.setFloat3=z.setFloat3.bind(z),this.setFloat4=z.setFloat4.bind(z),this.setFloatArray=z.setFloatArray.bind(z),this.setArray=z.setArray.bind(z),this.setIntArray=z.setIntArray.bind(z),this.setMatrix=z.setMatrix.bind(z),this.setMatrices=z.setMatrices.bind(z),this.setVector3=z.setVector3.bind(z),this.setVector4=z.setVector4.bind(z),this.setColor3=z.setColor3.bind(z),this.setColor4=z.setColor4.bind(z),this.setDirectColor4=z.setDirectColor4.bind(z),this.setInt=z.setInt.bind(z),this.setInt2=z.setInt2.bind(z),this.setInt3=z.setInt3.bind(z),this.setInt4=z.setInt4.bind(z))}}var L=U(12837);const O="gpuUpdateParticlesPixelShader",x="#version 300 es\nvoid main() {discard;}\n";L.d.ShadersStore[O]||(L.d.ShadersStore[O]=x);const Q="gpuUpdateParticlesVertexShader",K="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";L.d.ShadersStore[Q]||(L.d.ShadersStore[Q]=K);(0,w.f)("BABYLON.WebGL2ParticleSystem",class{constructor(z,u){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=z,this._engine=u,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var z,u;return null!==(z=null===(u=this._updateEffect)||void 0===u?void 0:u.isReady())&&void 0!==z&&z}createUpdateBuffer(z){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof X&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=z,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new V(this._updateEffect)}createVertexBuffers(z,u){this._updateVAO.push(this._createUpdateVAO(z)),this._renderVAO.push(this._engine.recordVertexArrayObject(u,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=u}createParticleBuffer(z){return z}bindDrawBuffers(z,u,U){U?this._engine.bindBuffers(this._renderVertexBuffers,U,u):this._engine.bindVertexArrayObject(this._renderVAO[z],null)}preUpdateParticleBuffer(){const z=this._engine;if(this._engine.enableEffect(this._updateEffect),!z.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(z,u,U){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[z],null);const J=this._engine;J.bindTransformFeedbackBuffer(u.getBuffer()),J.setRasterizerState(!1),J.beginTransformFeedback(!0),J.drawArraysType(3,0,U),J.endTransformFeedback(),J.setRasterizerState(!0),J.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let z=0;z<this._updateVAO.length;z++)this._engine.releaseVertexArrayObject(this._updateVAO[z]);this._updateVAO.length=0;for(let z=0;z<this._renderVAO.length;z++)this._engine.releaseVertexArrayObject(this._renderVAO[z]);this._renderVAO.length=0}_createUpdateVAO(z){const u={};u.position=z.createVertexBuffer("position",0,3);let U=3;u.age=z.createVertexBuffer("age",U,1),U+=1,u.size=z.createVertexBuffer("size",U,3),U+=3,u.life=z.createVertexBuffer("life",U,1),U+=1,u.seed=z.createVertexBuffer("seed",U,4),U+=4,u.direction=z.createVertexBuffer("direction",U,3),U+=3,this._parent.particleEmitterType instanceof X&&(u.initialPosition=z.createVertexBuffer("initialPosition",U,3),U+=3),this._parent._colorGradientsTexture||(u.color=z.createVertexBuffer("color",U,4),U+=4),this._parent._isBillboardBased||(u.initialDirection=z.createVertexBuffer("initialDirection",U,3),U+=3),this._parent.noiseTexture&&(u.noiseCoordinates1=z.createVertexBuffer("noiseCoordinates1",U,3),U+=3,u.noiseCoordinates2=z.createVertexBuffer("noiseCoordinates2",U,3),U+=3),this._parent._angularSpeedGradientsTexture?(u.angle=z.createVertexBuffer("angle",U,1),U+=1):(u.angle=z.createVertexBuffer("angle",U,2),U+=2),this._parent._isAnimationSheetEnabled&&(u.cellIndex=z.createVertexBuffer("cellIndex",U,1),U+=1,this._parent.spriteRandomStartCell&&(u.cellStartOffset=z.createVertexBuffer("cellStartOffset",U,1),U+=1));const J=this._engine.recordVertexArrayObject(u,null,this._updateEffect);return this._engine.bindArrayBuffer(null),J}});class Y{constructor(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,J=arguments.length>3?arguments[3]:void 0;this._engine=z,this._label=J,this._engine._storageBuffers.push(this),this._create(u,U)}_create(z,u){this._bufferSize=z,this._creationFlags=u,this._buffer=this._engine.createStorageBuffer(z,u,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(z,u,U){this._buffer&&this._engine.updateStorageBuffer(this._buffer,z,u,U)}async read(z,u,U,J){return await this._engine.readFromStorageBuffer(this._buffer,z,u,U,J)}dispose(){const z=this._engine._storageBuffers,u=z.indexOf(this);-1!==u&&(z[u]=z[z.length-1],z.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var p=U(21),N=U(12899),D=U(12901),c=U(12955),W=U(12894),j=U(13214),I=U(12760),F=U(12859),b=U(13141);class k{constructor(){this._gpuTimeInFrameId=-1,this.counter=new b.e}_addDuration(z,u){z<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==z?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(u,!1),this._gpuTimeInFrameId=z):this.counter.addCount(u,!1))}}var B=U(12825);class y{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=z,this._engine=u,this.uniqueId=j.e.UniqueId,u.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new k),this._engine.getCaps().supportComputeShaders?J.bindingsMapping?(this._context=u.createComputeContext(),this._shaderPath=U,this._options=(0,p.e)({bindingsMapping:{},defines:[]},J)):I.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):I.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(z,u){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const J=this._bindings[z];this._bindings[z]={type:U?0:4,object:u,indexInGroupEntries:null===J||void 0===J?void 0:J.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!J||J.object!==u||J.type!==this._bindings[z].type)}setStorageTexture(z,u){const U=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!U||U.object!==u),this._bindings[z]={type:1,object:u,indexInGroupEntries:null===U||void 0===U?void 0:U.indexInGroupEntries}}setExternalTexture(z,u){const U=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!U||U.object!==u),this._bindings[z]={type:6,object:u,indexInGroupEntries:null===U||void 0===U?void 0:U.indexInGroupEntries}}setVideoTexture(z,u){return!!u.externalTexture&&(this.setExternalTexture(z,u.externalTexture),!0)}setUniformBuffer(z,u){const U=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!U||U.object!==u),this._bindings[z]={type:y._BufferIsDataBuffer(u)?7:2,object:u,indexInGroupEntries:null===U||void 0===U?void 0:U.indexInGroupEntries}}setStorageBuffer(z,u){const U=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!U||U.object!==u),this._bindings[z]={type:y._BufferIsDataBuffer(u)?7:3,object:u,indexInGroupEntries:null===U||void 0===U?void 0:U.indexInGroupEntries}}setTextureSampler(z,u){const U=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!U||!u.compareSampler(U.object)),this._bindings[z]={type:5,object:u,indexInGroupEntries:null===U||void 0===U?void 0:U.indexInGroupEntries}}isReady(){let z=this._effect;for(const v in this._bindings){const z=this._bindings[v],u=z.type,U=z.object;switch(u){case 0:case 4:case 1:if(!U.isReady())return!1;break;case 6:if(!U.isReady())return!1;break}}const u=[],U=this._shaderPath;if(this._options.defines)for(let v=0;v<this._options.defines.length;v++)u.push(this._options.defines[v]);const J=u.join("\n");return this._cachedDefines!==J&&(this._cachedDefines=J,z=this._engine.createComputeEffect(U,{defines:J,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=z),!!z.isReady()}dispatch(z,u,U){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,z,u,U,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const U=y._BufferIsDataBuffer(z)?z:z.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,U,u,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const u in this._bindings){const U=this._bindings[u];if(!this._options.bindingsMapping[u])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+u+"'");switch(U.type){case 0:{const J=this._samplers[u],v=U.object;var z;if(!J||!v._texture||!J.compareSampler(v._texture))this._samplers[u]=(new F.c).setParameters(v.wrapU,v.wrapV,v.wrapR,v.anisotropicFilteringLevel,v._texture.samplingMode,null===(z=v._texture)||void 0===z?void 0:z._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const z=U.object;z.getBuffer()!==U.buffer&&(U.buffer=z.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((v=>{(0,B.e)((()=>this.dispatch(z,u,U)),v,void 0,J)}))}serialize(){const z=c.b.Serialize(this);z.options=this._options,z.shaderPath=this._shaderPath,z.TZ={},z.textures={};for(const u in this._bindings){const U=this._bindings[u],J=U.object;switch(U.type){case 0:case 4:case 1:{const v=J.serialize();v&&(z.textures[u]=v,z.TZ[u]={type:U.type});break}}}return z}static Parse(z,u,U){const J=c.b.Parse((()=>new y(z.name,u.getEngine(),z.shaderPath,z.options)),z,u,U);for(const v in z.textures){const f=z.TZ[v],g=W.e.Parse(z.textures[v],u,U);0===f.type?J.setTexture(v,g):4===f.type?J.setTexture(v,g,!1):J.setStorageTexture(v,g)}return J}static _BufferIsDataBuffer(z){return void 0!==z.underlyingResource}}(0,N.b)([(0,D.K)()],y.prototype,"name",void 0),(0,N.b)([(0,D.K)()],y.prototype,"fastMode",void 0),(0,w.f)("BABYLON.ComputeShader",y);var H=U(13183);const G="gpuUpdateParticlesComputeShader",a="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";L.d.ShadersStoreWGSL[G]||(L.d.ShadersStoreWGSL[G]=a);(0,w.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(z,u){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=z,this._engine=u}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var z,u;return null!==(z=null===(u=this._updateComputeShader)||void 0===u?void 0:u.isReady())&&void 0!==z&&z}createUpdateBuffer(z){var u;const U={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(U.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(U.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(U.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(U.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(U.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(U.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(U.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new y("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:U,defines:z.split("\n")}),null===(u=this._simParamsComputeShader)||void 0===u||u.dispose(),this._simParamsComputeShader=new H.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new V(this._simParamsComputeShader)}createVertexBuffers(z,u){this._renderVertexBuffers.push(u)}createParticleBuffer(z){const u=new Y(this._engine,4*z.length,11,"ComputeShaderParticleSystemBuffer");return u.update(z),this._bufferComputeShader.push(u),u.getBuffer()}bindDrawBuffers(z,u,U){this._engine.bindBuffers(this._renderVertexBuffers[z],U,u)}preUpdateParticleBuffer(){}updateParticleBuffer(z,u,U){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[z]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^z]),this._updateComputeShader.dispatch(Math.ceil(U/64))}releaseBuffers(){var z;for(let u=0;u<this._bufferComputeShader.length;++u)this._bufferComputeShader[u].dispose();this._bufferComputeShader.length=0,null===(z=this._simParamsComputeShader)||void 0===z||z.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class i{constructor(z,u,U){this.gradient=z,this.color1=u,this.color2=U}getColorToRef(z){this.color2?g.wg.LerpToRef(this.color1,this.color2,Math.random(),z):z.v(this.color1)}}class n{constructor(z,u){this.gradient=z,this.color=u}}class q{constructor(z,u,U){this.gradient=z,this.factor1=u,this.factor2=U}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class o{static GetCurrentGradient(z,u,U){if(u[0].gradient>z)return void U(u[0],u[0],1);for(let v=0;v<u.length-1;v++){const J=u[v],f=u[v+1];if(z>=J.gradient&&z<=f.gradient){return void U(J,f,(z-J.gradient)/(f.gradient-J.gradient))}}const J=u.length-1;U(u[J],u[J],1)}}var s=U(12756),l=U(13353),e=U(12797);class zz{constructor(z){this.particleSystem=z,this.position=J.Eu.Zero(),this.direction=J.Eu.Zero(),this.color=new g.wg(0,0,0,0),this.colorStep=new g.wg(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new J.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new g.wg(0,0,0,0),this._currentColor2=new g.wg(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=zz._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let z=this.age,u=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===u?(u=1,z=this._randomCellOffset):z+=this._randomCellOffset);const U=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let J;J=this._initialSpriteCellLoop?(0,R.Clamp)(z*u%this.lifeTime/this.lifeTime):(0,R.Clamp)(z*u/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+J*U|0}_inheritParticleInfoToSubEmitter(z){if(z.particleSystem.vu.position){const u=z.particleSystem.vu;if(u.position.v(this.position),z.inheritDirection){const z=J.TmpVectors.Eu[0];this.direction.normalizeToRef(z),u.setDirection(z,0,Math.PI/2)}}else{z.particleSystem.vu.v(this.position)}this.direction.scaleToRef(z.inheritedVelocityAmount/2,J.TmpVectors.Eu[0]),z.particleSystem._inheritedVelocityOffset.v(J.TmpVectors.Eu[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const z of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(z)}_reset(){this.age=0,this.id=zz._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(z){z.position.v(this.position),this._initialDirection?z._initialDirection?z._initialDirection.v(this._initialDirection):z._initialDirection=this._initialDirection.clone():z._initialDirection=null,z.direction.v(this.direction),this.YP&&(z.YP?z.YP.v(this.YP):z.YP=this.YP.clone()),z.color.v(this.color),z.colorStep.v(this.colorStep),z.lifeTime=this.lifeTime,z.age=this.age,z._randomCellOffset=this._randomCellOffset,z.size=this.size,z.scale.v(this.scale),z.angle=this.angle,z.angularSpeed=this.angularSpeed,z.particleSystem=this.particleSystem,z.cellIndex=this.cellIndex,z.id=this.id,z._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(z._currentColorGradient=this._currentColorGradient,z._currentColor1.v(this._currentColor1),z._currentColor2.v(this._currentColor2)),this._currentSizeGradient&&(z._currentSizeGradient=this._currentSizeGradient,z._currentSize1=this._currentSize1,z._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(z._currentAngularSpeedGradient=this._currentAngularSpeedGradient,z._currentAngularSpeed1=this._currentAngularSpeed1,z._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(z._currentVelocityGradient=this._currentVelocityGradient,z._currentVelocity1=this._currentVelocity1,z._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(z._currentLimitVelocityGradient=this._currentLimitVelocityGradient,z._currentLimitVelocity1=this._currentLimitVelocity1,z._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(z._currentDragGradient=this._currentDragGradient,z._currentDrag1=this._currentDrag1,z._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(z._initialStartSpriteCellId=this._initialStartSpriteCellId,z._initialEndSpriteCellId=this._initialEndSpriteCellId,z._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(z.remapData&&this.remapData?z.remapData.v(this.remapData):z.remapData=new J.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(z._randomNoiseCoordinates1?(z._randomNoiseCoordinates1.v(this._randomNoiseCoordinates1),z._randomNoiseCoordinates2.v(this._randomNoiseCoordinates2)):(z._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),z._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}zz._Count=0;var uz=U(13035),Uz=(U(13085),U(13266)),Jz=U(13261),vz=U(13175);function fz(z,u){const U=(0,R.RandomRange)(0,1);g.wg.LerpToRef(u.color1,u.color2,U,z.color),u.colorDead.subtractToRef(z.color,u._colorDiff),u._colorDiff.scaleToRef(1/z.lifeTime,z.colorStep)}function gz(z,u){z._currentColorGradient=u._colorGradients[0],z._currentColorGradient.getColorToRef(z.color),z._currentColor1.v(z.color),u._colorGradients.length>1?u._colorGradients[1].getColorToRef(z._currentColor2):z._currentColor2.v(z.color)}function wz(z,u){const U=u._colorGradients;o.GetCurrentGradient(u._ratio,U,((u,U,J)=>{u!==z._currentColorGradient&&(z._currentColor1.v(z._currentColor2),U.getColorToRef(z._currentColor2),z._currentColorGradient=u),g.wg.LerpToRef(z._currentColor1,z._currentColor2,J,z.color)}))}function Pz(z,u){z.colorStep.scaleToRef(u._scaledUpdateSpeed,u._scaledColorStep),z.color.addInPlace(u._scaledColorStep),z.color.a<0&&(z.color.a=0)}function Rz(z,u){o.GetCurrentGradient(u._ratio,u._angularSpeedGradients,((u,U,J)=>{u!==z._currentAngularSpeedGradient&&(z._currentAngularSpeed1=z._currentAngularSpeed2,z._currentAngularSpeed2=U.getFactor(),z._currentAngularSpeedGradient=u),z.angularSpeed=(0,R.Lerp)(z._currentAngularSpeed1,z._currentAngularSpeed2,J)}))}function Sz(z,u){z.angle+=z.angularSpeed*u._scaledUpdateSpeed}function dz(z,u){u.particleEmitterType.startDirectionFunction(u._emitterWorldMatrix,z.direction,z,u.isLocal,u._emitterInverseWorldMatrix)}function mu(z,u){u.startDirectionFunction(u._emitterWorldMatrix,z.direction,z,u.isLocal)}function Zz(z,u){z._currentVelocityGradient=u._velocityGradients[0],z._currentVelocity1=z._currentVelocityGradient.getFactor(),u._velocityGradients.length>1?z._currentVelocity2=u._velocityGradients[1].getFactor():z._currentVelocity2=z._currentVelocity1}function Az(z,u){z._currentLimitVelocityGradient=u._limitVelocityGradients[0],z._currentLimitVelocity1=z._currentLimitVelocityGradient.getFactor(),u._limitVelocityGradients.length>1?z._currentLimitVelocity2=u._limitVelocityGradients[1].getFactor():z._currentLimitVelocity2=z._currentLimitVelocity1}function Ez(z,u){o.GetCurrentGradient(u._ratio,u._velocityGradients,((U,J,v)=>{U!==z._currentVelocityGradient&&(z._currentVelocity1=z._currentVelocity2,z._currentVelocity2=J.getFactor(),z._currentVelocityGradient=U),u._directionScale*=(0,R.Lerp)(z._currentVelocity1,z._currentVelocity2,v)}))}function Cz(z,u){o.GetCurrentGradient(u._ratio,u._limitVelocityGradients,((U,J,v)=>{U!==z._currentLimitVelocityGradient&&(z._currentLimitVelocity1=z._currentLimitVelocity2,z._currentLimitVelocity2=J.getFactor(),z._currentLimitVelocityGradient=U);const f=(0,R.Lerp)(z._currentLimitVelocity1,z._currentLimitVelocity2,v);z.direction.length()>f&&z.direction.scaleInPlace(u.limitVelocityDamping)}))}function rz(z,u){z.direction.scaleToRef(u._directionScale,u._scaledDirection)}function Mz(z,u){u.particleEmitterType.startPositionFunction(u._emitterWorldMatrix,z.position,z,u.isLocal)}function Tz(z,u){u.startPositionFunction(u._emitterWorldMatrix,z.position,z,u.isLocal)}function Xz(z,u){z.YP?z.YP.v(z.position):z.YP=z.position.clone(),J.Eu.TransformCoordinatesToRef(z.YP,u._emitterWorldMatrix,z.position)}function hz(z,u){u.isLocal&&z.YP?(z.YP.addInPlace(u._scaledDirection),J.Eu.TransformCoordinatesToRef(z.YP,u._emitterWorldMatrix,z.position)):z.position.addInPlace(u._scaledDirection)}function tz(z,u){z._currentDragGradient=u._dragGradients[0],z._currentDrag1=z._currentDragGradient.getFactor(),u._dragGradients.length>1?z._currentDrag2=u._dragGradients[1].getFactor():z._currentDrag2=z._currentDrag1}function Vz(z,u){o.GetCurrentGradient(u._ratio,u._dragGradients,((U,J,v)=>{U!==z._currentDragGradient&&(z._currentDrag1=z._currentDrag2,z._currentDrag2=J.getFactor(),z._currentDragGradient=U);const f=(0,R.Lerp)(z._currentDrag1,z._currentDrag2,v);u._scaledDirection.scaleInPlace(1-f)}))}function Lz(z,u){z._randomNoiseCoordinates1?(z._randomNoiseCoordinates1.zg(Math.random(),Math.random(),Math.random()),z._randomNoiseCoordinates2.zg(Math.random(),Math.random(),Math.random())):(z._randomNoiseCoordinates1=new J.Eu(Math.random(),Math.random(),Math.random()),z._randomNoiseCoordinates2=new J.Eu(Math.random(),Math.random(),Math.random()))}function Oz(z,u){const U=u._noiseTextureData,v=u._noiseTextureSize;if(U&&v&&z._randomNoiseCoordinates1){const f=u._fetchR(z._randomNoiseCoordinates1.x,z._randomNoiseCoordinates1.y,v.width,v.height,U),g=u._fetchR(z._randomNoiseCoordinates1.z,z._randomNoiseCoordinates2.x,v.width,v.height,U),w=u._fetchR(z._randomNoiseCoordinates2.y,z._randomNoiseCoordinates2.z,v.width,v.height,U),P=J.TmpVectors.Eu[0],R=J.TmpVectors.Eu[1];P.zg((2*f-1)*u.noiseStrength.x,(2*g-1)*u.noiseStrength.y,(2*w-1)*u.noiseStrength.z),P.scaleToRef(u._tempScaledUpdateSpeed,R),z.direction.addInPlace(R)}}function xz(z,u){u.gravity.scaleToRef(u._tempScaledUpdateSpeed,u._scaledGravity),z.direction.addInPlace(u._scaledGravity)}function Qz(z,u){z.size=(0,R.RandomRange)(u.minSize,u.maxSize),z.scale.zg((0,R.RandomRange)(u.minScaleX,u.maxScaleX),(0,R.RandomRange)(u.minScaleY,u.maxScaleY))}function Kz(z,u){z._currentSizeGradient=u._sizeGradients[0],z._currentSize1=z._currentSizeGradient.getFactor(),z.size=z._currentSize1,u._sizeGradients.length>1?z._currentSize2=u._sizeGradients[1].getFactor():z._currentSize2=z._currentSize1,z.scale.zg((0,R.RandomRange)(u.minScaleX,u.maxScaleX),(0,R.RandomRange)(u.minScaleY,u.maxScaleY))}function Yz(z,u){const U=u._actualFrame/u.targetStopDuration;o.GetCurrentGradient(U,u._startSizeGradients,((U,J,v)=>{U!==u._currentStartSizeGradient&&(u._currentStartSize1=u._currentStartSize2,u._currentStartSize2=J.getFactor(),u._currentStartSizeGradient=U);const f=(0,R.Lerp)(u._currentStartSize1,u._currentStartSize2,v);z.scale.scaleInPlace(f)}))}function pz(z,u){o.GetCurrentGradient(u._ratio,u._sizeGradients,((u,U,J)=>{u!==z._currentSizeGradient&&(z._currentSize1=z._currentSize2,z._currentSize2=U.getFactor(),z._currentSizeGradient=u),z.size=(0,R.Lerp)(z._currentSize1,z._currentSize2,J)}))}function Nz(z,u){z.remapData=new J.Vector4(0,1,0,1)}function Dz(z,u){u._colorRemapGradients&&u._colorRemapGradients.length>0&&o.GetCurrentGradient(u._ratio,u._colorRemapGradients,((u,U,J)=>{const v=(0,R.Lerp)(u.factor1,U.factor1,J),f=(0,R.Lerp)(u.factor2,U.factor2,J);z.remapData.x=v,z.remapData.y=f-v})),u._alphaRemapGradients&&u._alphaRemapGradients.length>0&&o.GetCurrentGradient(u._ratio,u._alphaRemapGradients,((u,U,J)=>{const v=(0,R.Lerp)(u.factor1,U.factor1,J),f=(0,R.Lerp)(u.factor2,U.factor2,J);z.remapData.z=v,z.remapData.w=f-v}))}function cz(z,u){const U=(0,R.Clamp)(u._actualFrame/u.targetStopDuration);o.GetCurrentGradient(U,u._lifeTimeGradients,((u,J)=>{const v=u,f=J,g=v.getFactor(),w=f.getFactor(),P=(U-v.gradient)/(f.gradient-v.gradient);z.lifeTime=(0,R.Lerp)(g,w,P)})),u._emitPower=(0,R.RandomRange)(u.minEmitPower,u.maxEmitPower)}function Wz(z,u){z.lifeTime=(0,R.RandomRange)(u.minLifeTime,u.maxLifeTime),u._emitPower=(0,R.RandomRange)(u.minEmitPower,u.maxEmitPower)}function jz(z,u){0===u._emitPower?(z._initialDirection?z._initialDirection.v(z.direction):z._initialDirection=z.direction.clone(),z.direction.set(0,0,0)):(z._initialDirection=null,z.direction.scaleInPlace(u._emitPower)),z.direction.addInPlace(u._inheritedVelocityOffset)}function Iz(z,u){z.angularSpeed=(0,R.RandomRange)(u.minAngularSpeed,u.maxAngularSpeed),z.angle=(0,R.RandomRange)(u.minInitialRotation,u.maxInitialRotation)}function Fz(z,u){z._currentAngularSpeedGradient=u._angularSpeedGradients[0],z.angularSpeed=z._currentAngularSpeedGradient.getFactor(),z._currentAngularSpeed1=z.angularSpeed,u._angularSpeedGradients.length>1?z._currentAngularSpeed2=u._angularSpeedGradients[1].getFactor():z._currentAngularSpeed2=z._currentAngularSpeed1,z.angle=(0,R.RandomRange)(u.minInitialRotation,u.maxInitialRotation)}function bz(z,u){z._initialStartSpriteCellId=u.startSpriteCellID,z._initialEndSpriteCellId=u.endSpriteCellID,z._initialSpriteCellLoop=u.spriteCellLoop}function kz(z,u){z.previousItem=u.previousItem,z.nextItem=u,u.previousItem&&(u.previousItem.nextItem=z),u.previousItem=z}function Bz(z,u){z.previousItem=u,z.nextItem=u.nextItem,u.nextItem&&(u.nextItem.previousItem=z),u.nextItem=z}function yz(z,u){let U=u;for(;U.nextItem;)U=U.nextItem;z.previousItem=U,z.nextItem=U.nextItem,U.nextItem=z}function Hz(z){z.previousItem&&(z.previousItem.nextItem=z.nextItem),z.nextItem&&(z.nextItem.previousItem=z.previousItem)}class Gz extends P{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(z){this._startDirectionFunction!==z&&(this._startDirectionFunction=z,this._directionProcessing.process=z?mu:dz)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(z){this._startPositionFunction!==z&&(this._startPositionFunction=z,this._positionCreation.process=z?Tz:Mz)}set onDispose(z){this._onDisposeObserver&&this.Xf.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xf.add(z)}get S(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(z){this._useRampGradients!==z&&(this._useRampGradients=z,this._resetEffect(),z?(this._rampCreation={process:Nz,previousItem:null,nextItem:null},Bz(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Dz,previousItem:null,nextItem:null},Bz(this._remapGradientProcessing,this._gravityProcessing)):(Hz(this._rampCreation),Hz(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(z){this._isLocal!==z&&(this._isLocal=z,z?(this._isLocalCreation={process:Xz,previousItem:null,nextItem:null},Bz(this._isLocalCreation,this._positionCreation)):Hz(this._isLocalCreation))}get particles(){return this.AZ}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(z){this._animationSheetEnabled!==z&&(this._animationSheetEnabled=z,z?(this._sheetCreation={process:bz,previousItem:null,nextItem:null},Bz(this._sheetCreation,this._colorCreation)):Hz(this._sheetCreation),this._reset())}getActiveCount(){return this.AZ.length}getClassName(){return"Tg"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var z,u;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(z=null===(u=this._customWrappers[U])||void 0===u?void 0:u.effect)&&void 0!==z?z:this._customWrappers[0].effect}_getCustomDrawWrapper(){var z;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(z=this._customWrappers[u])&&void 0!==z?z:this._customWrappers[0]}setCustomEffect(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[u]=new uz.d(this._engine),this._customWrappers[u].effect=z,this._customWrappers[u].drawContext&&(this._customWrappers[u].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new s.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(z){if(this.noiseTexture!==z){if(this._noiseTexture=z,!z)return Hz(this._noiseCreation),void Hz(this._noiseProcessing);this._noiseCreation={process:Lz,previousItem:null,nextItem:null},Bz(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Oz,previousItem:null,nextItem:null},Bz(this._noiseProcessing,this._positionProcessing)}}constructor(z,u,U){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]&&arguments[4],w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,P=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(z),this._emitterInverseWorldMatrix=J.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new J.Eu,this.Xf=new s.e,this.onStoppedObservable=new s.e,this.onStartedObservable=new s.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.AZ=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new g.wg(0,0,0,0),this._colorDiff=new g.wg(0,0,0,0),this._scaledDirection=J.Eu.Zero(),this._scaledGravity=J.Eu.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=z=>{},this.recycleParticle=z=>{const u=this.AZ.pop();u!==z&&u.copyTo(z),this._stockParticles.push(u)},this._createParticle=()=>{let z;return 0!==this._stockParticles.length?(z=this._stockParticles.pop(),z._reset()):z=new zz(this),this._prepareParticle(z),z},this.paused=!1,this._shadersLoaded=!1,this._capacity=u,this._epsilon=w,U&&"Scene"!==U.getClassName()?(this._engine=U,this.defaultProjectionMatrix=J.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=U||e.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.mA.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Wz,previousItem:null,nextItem:null},this._positionCreation={process:Mz,previousItem:null,nextItem:null},Bz(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:dz,previousItem:null,nextItem:null},Bz(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:jz,previousItem:null,nextItem:null},Bz(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Qz,previousItem:null,nextItem:null},Bz(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Iz,previousItem:null,nextItem:null},Bz(this._angleCreation,this._sizeCreation),this._colorCreation={process:fz,previousItem:null,nextItem:null},Bz(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,P||(this._colorProcessing={process:Pz,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Sz,previousItem:null,nextItem:null},Bz(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:rz,previousItem:null,nextItem:null},Bz(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:hz,previousItem:null,nextItem:null},Bz(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:xz,previousItem:null,nextItem:null},Bz(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=f,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new uz.d(this._engine)},this._customWrappers[0].effect=v,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new d,this.updateFunction=z=>{var u;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(u=this.noiseTexture.getContent())||void 0===u||u.then((z=>{this._noiseTextureData=z})));const U=z===this.AZ;for(let J=0;J<z.length;J++){const u=z[J];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const v=u.age;if(u.age+=this._tempScaledUpdateSpeed,u.age>u.lifeTime){const z=u.age-v,U=u.lifeTime-v;this._tempScaledUpdateSpeed=U*this._tempScaledUpdateSpeed/z,u.age=u.lifeTime}this._ratio=u.age/u.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let f=this._updateQueueStart;for(;f;)f.process(u,this),f=f.nextItem;if(this._isAnimationSheetEnabled&&!P&&u.updateCellIndex(),u._inheritParticleInfoToSubEmitters(),u.age>=u.lifeTime){if(this._emitFromParticle(u),u._attachedSubEmitters){for(const z of u._attachedSubEmitters)z.particleSystem.disposeOnStop=!0,z.particleSystem.stop();u._attachedSubEmitters=null}this.recycleParticle(u),U&&J--}else;}}}serialize(z){throw new Error("Method not implemented.")}clone(z,u){throw new Error("Method not implemented.")}_addFactorGradient(z,u,U,J){const v=new q(u,U,J);z.push(v),z.sort(((z,u)=>z.gradient<u.gradient?-1:z.gradient>u.gradient?1:0))}_removeFactorGradient(z,u){if(!z)return;let U=0;for(const J of z){if(J.gradient===u){z.splice(U,1);break}U++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=cz:this._lifeTimeCreation.process=Wz}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Yz,previousItem:null,nextItem:null},Bz(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Hz(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(z){this.targetStopDuration!==z&&(this._targetStopDuration=z,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(z,u,U){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,z,u,U),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(z){return this._removeFactorGradient(this._lifeTimeGradients,z),this._syncLifeTimeCreation(),this}addSizeGradient(z,u,U){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Kz,this._sizeGradientProcessing={process:pz,previousItem:null,nextItem:null},kz(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,z,u,U),this}removeSizeGradient(z){var u;return this._removeFactorGradient(this._sizeGradients,z),0===(null===(u=this._sizeGradients)||void 0===u?void 0:u.length)&&(Hz(this._sizeGradientProcessing),this._sizeCreation.process=Qz),this}addColorRemapGradient(z,u,U){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,z,u,U),this}removeColorRemapGradient(z){return this._removeFactorGradient(this._colorRemapGradients,z),this}addAlphaRemapGradient(z,u,U){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,z,u,U),this}removeAlphaRemapGradient(z){return this._removeFactorGradient(this._alphaRemapGradients,z),this}addAngularSpeedGradient(z,u,U){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Fz,this._angularSpeedGradientProcessing={process:Rz,previousItem:null,nextItem:null},kz(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,z,u,U),this}removeAngularSpeedGradient(z){var u;return this._removeFactorGradient(this._angularSpeedGradients,z),0===(null===(u=this._angularSpeedGradients)||void 0===u?void 0:u.length)&&(this._angleCreation.process=Iz,Hz(this._angularSpeedGradientProcessing)),this}addVelocityGradient(z,u,U){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Zz,previousItem:null,nextItem:null},Bz(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Ez,previousItem:null,nextItem:null},kz(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,z,u,U),this}removeVelocityGradient(z){var u;return this._removeFactorGradient(this._velocityGradients,z),0===(null===(u=this._velocityGradients)||void 0===u?void 0:u.length)&&(Hz(this._velocityCreation),Hz(this._velocityGradientProcessing)),this}addLimitVelocityGradient(z,u,U){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Az,previousItem:null,nextItem:null},Bz(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Cz,previousItem:null,nextItem:null},Bz(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,z,u,U),this}removeLimitVelocityGradient(z){var u;return this._removeFactorGradient(this._limitVelocityGradients,z),0===(null===(u=this._limitVelocityGradients)||void 0===u?void 0:u.length)&&(Hz(this._limitVelocityCreation),Hz(this._limitVelocityGradientProcessing)),this}addDragGradient(z,u,U){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:tz,previousItem:null,nextItem:null},kz(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Vz,previousItem:null,nextItem:null},kz(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,z,u,U),this}removeDragGradient(z){var u;return this._removeFactorGradient(this._dragGradients,z),0===(null===(u=this._dragGradients)||void 0===u?void 0:u.length)&&(Hz(this._dragCreation),Hz(this._dragGradientProcessing)),this}addEmitRateGradient(z,u,U){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,z,u,U),this}removeEmitRateGradient(z){return this._removeFactorGradient(this._emitRateGradients,z),this}addStartSizeGradient(z,u,U){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,z,u,U),this._syncStartSizeCreation(),this}removeStartSizeGradient(z){return this._removeFactorGradient(this._startSizeGradients,z),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const z=new Uint8Array(4*this._rawTextureWidth),u=g.TmpColors.Tu[0];for(let U=0;U<this._rawTextureWidth;U++){const J=U/this._rawTextureWidth;o.GetCurrentGradient(J,this._rampGradients,((J,v,f)=>{g.Tu.LerpToRef(J.color,v.color,f,u),z[4*U]=255*u.r,z[4*U+1]=255*u.g,z[4*U+2]=255*u.b,z[4*U+3]=255}))}this._rampGradientsTexture=l.b.CreateRGBATexture(z,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((z,u)=>z.gradient<u.gradient?-1:z.gradient>u.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(z,u){this._rampGradients||(this._rampGradients=[]);const U=new n(z,u);return this._rampGradients.push(U),this._syncRampGradientTexture(),this}removeRampGradient(z){return this._removeGradientAndTexture(z,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(z,u,U){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=gz,this._colorProcessing.process=wz);const J=new i(z,u,U);return this._colorGradients.push(J),this._colorGradients.sort(((z,u)=>z.gradient<u.gradient?-1:z.gradient>u.gradient?1:0)),this}removeColorGradient(z){if(!this._colorGradients)return this;let u=0;for(const U of this._colorGradients){if(U.gradient===z){this._colorGradients.splice(u,1);break}u++}return 0===this._colorGradients.length&&(this._colorCreation.process=fz,this._colorProcessing.process=Pz),this}resetDrawCache(){if(this._drawWrappers){for(const z of this._drawWrappers)if(z)for(const u of z)null===u||void 0===u||u.dispose();this._drawWrappers=[]}}_fetchR(z,u,U,J,v){return v[4*(((z=.5*Math.abs(z)+.5)*U%U|0)+((u=.5*Math.abs(u)+.5)*J%J|0)*U)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const z=this._engine,u=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*u),this._vertexBuffer=new h.e(z,this._vertexData,!0,u);let U=0;const J=this._vertexBuffer.createVertexBuffer(h.g.PositionKind,U,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[h.g.PositionKind]=J,U+=3;const v=this._vertexBuffer.createVertexBuffer(h.g.ColorKind,U,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[h.g.ColorKind]=v,U+=4;const f=this._vertexBuffer.createVertexBuffer("angle",U,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=f,U+=1;const g=this._vertexBuffer.createVertexBuffer("size",U,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=g,U+=2,this._isAnimationSheetEnabled){const z=this._vertexBuffer.createVertexBuffer("cellIndex",U,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=z,U+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const z=this._vertexBuffer.createVertexBuffer("direction",U,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=z,U+=3}if(this._useRampGradients){const z=this._vertexBuffer.createVertexBuffer("remapData",U,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=z,U+=4}let w;if(this._useInstancing){const u=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new h.e(z,u,!1,2),w=this._spriteBuffer.createVertexBuffer("offset",0,2)}else w=this._vertexBuffer.createVertexBuffer("offset",U,2,this._vertexBufferSize,this._useInstancing),U+=2;this._vertexBuffers.offset=w,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const z=[],u=[];let U=0;for(let J=0;J<this._capacity;J++)z.push(U),z.push(U+1),z.push(U+2),z.push(U),z.push(U+2),z.push(U+3),u.push(U,U+1,U+1,U+2,U+2,U+3,U+3,U,U,U+3),U+=4;this._indexBuffer=this._engine.createIndexBuffer(z),this._linesIndexBuffer=this._engine.createIndexBuffer(u)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(z)setTimeout((()=>{this.start(0)}),z);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var u;-1!==(null===(u=this.vu)||void 0===u?void 0:u.getClassName().indexOf("Mesh"))&&this.vu.af(!0);const z=this.noiseTexture;if(z&&z.onGeneratedObservable)z.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let u=0;u<this.preWarmCycles;u++)this.animate(!0),z.render()}))}));else for(let u=0;u<this.preWarmCycles;u++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(z))}_postStop(z){}reset(){this._stockParticles.length=0,this.AZ.length=0}_appendParticleVertex(z,u,U,v){let f=z*this._vertexBufferSize;if(this._vertexData[f++]=u.position.x+this.sR.x,this._vertexData[f++]=u.position.y+this.sR.y,this._vertexData[f++]=u.position.z+this.sR.z,this._vertexData[f++]=u.color.r,this._vertexData[f++]=u.color.g,this._vertexData[f++]=u.color.b,this._vertexData[f++]=u.color.a,this._vertexData[f++]=u.angle,this._vertexData[f++]=u.scale.x*u.size,this._vertexData[f++]=u.scale.y*u.size,this._isAnimationSheetEnabled&&(this._vertexData[f++]=u.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[f++]=u.direction.x,this._vertexData[f++]=u.direction.y,this._vertexData[f++]=u.direction.z);else if(u._initialDirection){let z=u._initialDirection;this.isLocal&&(J.Eu.TransformNormalToRef(z,this._emitterWorldMatrix,J.TmpVectors.Eu[0]),z=J.TmpVectors.Eu[0]),0===z.x&&0===z.z&&(z.x=.001),this._vertexData[f++]=z.x,this._vertexData[f++]=z.y,this._vertexData[f++]=z.z}else{let z=u.direction;this.isLocal&&(J.Eu.TransformNormalToRef(z,this._emitterWorldMatrix,J.TmpVectors.Eu[0]),z=J.TmpVectors.Eu[0]),0===z.x&&0===z.z&&(z.x=.001),this._vertexData[f++]=z.x,this._vertexData[f++]=z.y,this._vertexData[f++]=z.z}this._useRampGradients&&u.remapData&&(this._vertexData[f++]=u.remapData.x,this._vertexData[f++]=u.remapData.y,this._vertexData[f++]=u.remapData.z,this._vertexData[f++]=u.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===U?U=this._epsilon:1===U&&(U=1-this._epsilon),0===v?v=this._epsilon:1===v&&(v=1-this._epsilon)),this._vertexData[f++]=U,this._vertexData[f++]=v)}_prepareParticle(z){}_createNewOnes(z){let u;for(let U=0;U<z&&this.AZ.length!==this._capacity;U++){u=this._createParticle(),this.AZ.push(u);let z=this._createQueueStart;for(;z;)z.process(u,this),z=z.nextItem;u._inheritParticleInfoToSubEmitters()}}_update(z){if(this._alive=this.AZ.length>0,this.vu.position){const z=this.vu;this._emitterWorldMatrix=z.getWorldMatrix()}else{const z=this.vu;this._emitterWorldMatrix=J.Matrix.Translation(z.x,z.y,z.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.AZ),this._createNewOnes(z)}static _GetAttributeNamesOrOptions(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=[h.g.PositionKind,h.g.ColorKind,"angle","offset","size"];return z&&J.push("cellIndex"),u||J.push("direction"),U&&J.push("remapData"),J}static _GetEffectCreationOptions(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Uz.b)(J),z&&J.push("particlesInfos"),u&&J.push("logarithmicDepthConstant"),U&&(J.push("vFogInfos"),J.push("vFogColor")),J}fillDefines(z,u){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Uz.k)(this,this._scene,z),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&z.push("#define FOG")),this._isAnimationSheetEnabled&&z.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&z.push("#define LOGARITHMICDEPTH"),u===P.BLENDMODE_MULTIPLY&&z.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&z.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(z.push("#define BILLBOARD"),this.billboardMode){case 2:z.push("#define BILLBOARDY");break;case 8:case 9:z.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&z.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:z.push("#define BILLBOARDMODE_ALL")}U&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),z.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(z,u,U){u.push(...Gz._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),z.push(...Gz._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),U.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,vz.g)(z,this._imageProcessingConfigurationDefines),(0,vz.d)(U,this._imageProcessingConfigurationDefines))}_getWrapper(z){const u=this._getCustomDrawWrapper(z);if(null!==u&&void 0!==u&&u.effect)return u;const U=[];this.fillDefines(U,z);const J=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let v=this._drawWrappers[J];v||(v=this._drawWrappers[J]=[]);let f=v[z];f||(f=new uz.d(this._engine),f.drawContext&&(f.drawContext.useInstancing=this._useInstancing),v[z]=f);const g=U.join("\n");if(f.defines!==g){const z=[],u=[],U=[];this.fillUniformsAttributesAndSamplerNames(u,z,U),f.setEffect(this._engine.createEffect("particles",z,u,U,g,void 0,void 0,void 0,void 0,this._shaderLanguage),g)}return f}animate(){var z;let u,U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!U&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(U?this.preWarmStepOffset:(null===(z=this._scene)||void 0===z?void 0:z.getAnimationRatio())||1),this.manualEmitCount>-1)u=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let z=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const u=this._actualFrame/this.targetStopDuration;o.GetCurrentGradient(u,this._emitRateGradients,((u,U,J)=>{u!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=U.getFactor(),this._currentEmitRateGradient=u),z=(0,R.Lerp)(this._currentEmitRate1,this._currentEmitRate2,J)}))}u=z*this._scaledUpdateSpeed|0,this._newPartsExcess+=z*this._scaledUpdateSpeed-u}if(this._newPartsExcess>1&&(u+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?u=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(u),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!U){let z=0;for(let u=0;u<this.AZ.length;u++){const U=this.AZ[u];this._appendParticleVertices(z,U),z+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.AZ.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(z,u){this._appendParticleVertex(z++,u,0,0),this._useInstancing||(this._appendParticleVertex(z++,u,1,0),this._appendParticleVertex(z++,u,1,1),this._appendParticleVertex(z++,u,0,1))}rebuild(){var z;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(z=this._spriteBuffer)||void 0===z||z._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Gz.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(U.bind(U,13958)),Promise.resolve().then(U.bind(U,13904))])):await Promise.all([Promise.resolve().then(U.bind(U,13892)),Promise.resolve().then(U.bind(U,13877))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.vu||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==P.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(P.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(P.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(z){var u,U;const v=this._getWrapper(z),f=v.effect,g=this._engine;g.enableEffect(v);const w=null!==(u=this.defaultViewMatrix)&&void 0!==u?u:this._scene.getViewMatrix();if(f.setTexture("diffuseSampler",this.particleTexture),f.setMatrix("view",w),f.setMatrix("projection",null!==(U=this.defaultProjectionMatrix)&&void 0!==U?U:this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const z=this.particleTexture.getBaseSize();f.setFloat3("particlesInfos",this.spriteCellWidth/z.width,this.spriteCellHeight/z.height,this.spriteCellWidth/z.width)}if(f.setVector2("translationPivot",this.translationPivot),f.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const z=this._scene.activeCamera;f.setVector3("eyePosition",z.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),f.setTexture("rampSampler",this._rampGradientsTexture));const P=f.defines;var R,S,d,mz,Z,A;(this._scene&&((0,Uz.f)(f,this,this._scene),this.applyFog&&(0,Jz.f)(this._scene,void 0,f)),P.indexOf("#define BILLBOARDMODE_ALL")>=0&&(w.invertToRef(J.TmpVectors.Matrix[0]),f.setMatrix("invView",J.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?g.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,f):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,f)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?g.bindBuffers(this._vertexBuffers,null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._linesIndexBuffer:this._indexBuffer,f):g.bindBuffers(this._vertexBuffers,null!==(mz=this._scene)&&void 0!==mz&&mz.forceWireframe?this._linesIndexBufferUseInstancing:null,f);(this.useLogarithmicDepth&&this._scene&&(0,Jz.h)(P,f,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(f),this._setEngineBasedOnBlendMode(z),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(f),this._useInstancing)?null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?g.drawElementsType(6,0,10,this.AZ.length):g.drawArraysType(7,0,4,this.AZ.length):null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?g.drawElementsType(1,0,10*this.AZ.length):g.drawElementsType(0,0,6*this.AZ.length);return this.AZ.length}render(){if(!this.isReady()||!this.AZ.length)return 0;const z=this._engine;z.setState&&(z.setState(!1),this.forceDepthWrite&&z.setDepthWrite(!0));let u=0;return u=this.blendMode===P.BLENDMODE_MULTIPLYADD?this._render(P.BLENDMODE_MULTIPLY)+this._render(P.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),u}_onDispose(){}dispose(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(u,U),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const z=this._scene.mA.indexOf(this);z>-1&&this._scene.mA.splice(z,1),this._scene._activeParticleSystems.dispose()}this.Xf.notifyObservers(this),this.Xf.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Gz.ForceGLSL=!1;var az,iz=U(12782);!function(z){z[z.ATTACHED=0]="ATTACHED",z[z.END=1]="END"}(az||(az={}));class nz{constructor(z){if(this.particleSystem=z,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!z.vu||!z.vu.dispose){const u=(0,w.e)("BABYLON.AbstractMesh");z.vu=new u("SubemitterSystemEmitter",z.Vz()),z._disposeEmitterOnDispose=!0}}clone(){let z=this.particleSystem.vu;if(z){if(z instanceof J.Eu)z=z.clone();else if(-1!==z.getClassName().indexOf("Mesh")){z=new((0,w.e)("BABYLON.Mesh"))("",z.Vz()),z.isVisible=!1}}else z=new J.Eu;const u=new nz(this.particleSystem.clone(this.particleSystem.name,z));return u.particleSystem.name+="Clone",u.type=this.type,u.inheritDirection=this.inheritDirection,u.inheritedVelocityAmount=this.inheritedVelocityAmount,u.particleSystem._disposeEmitterOnDispose=!0,u.particleSystem.disposeOnStop=!0,u}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={};return u.type=this.type,u.inheritDirection=this.inheritDirection,u.inheritedVelocityAmount=this.inheritedVelocityAmount,u.particleSystem=this.particleSystem.serialize(z),u}static _ParseParticleSystem(z,u,U){throw(0,iz.c)("ParseParticle")}static Parse(z,u,U){const J=z.particleSystem,v=new nz(nz._ParseParticleSystem(J,u,U,!0));return v.type=z.type,v.inheritDirection=z.inheritDirection,v.inheritedVelocityAmount=z.inheritedVelocityAmount,v.particleSystem._isSubEmitter=!0,v}dispose(){this.particleSystem.dispose()}}var qz=U(12827);function oz(z,u){const U=new r;return U.direction1=z,U.direction2=u,U}function sz(){return new C(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function lz(){return new M(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ez(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.Eu(0,1,0),U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.Eu(0,1,0);return new T(z,u,U)}function zu(){return new A(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function uu(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.Eu(0,1,0),f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.Eu(0,1,0);return new E(z,u,U,v,f)}function Uu(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new mz(z,u)}function Ju(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.Eu(0,1,0),v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.Eu(0,1,0);return new Z(z,u,U,v)}const vu=J.Eu.Zero(),fu=J.Eu.Zero(),gu=J.Eu.Zero();class wu{constructor(){this.strength=0,this.position=J.Eu.Zero()}_processParticle(z,u){this.position.subtractToRef(z.position,vu);const U=vu.lengthSquared()+1;vu.normalize().scaleToRef(this.strength/U,fu),fu.scaleToRef(u._tempScaledUpdateSpeed,gu),z.direction.addInPlace(gu)}serialize(){return{position:this.position.jf(),strength:this.strength}}}class Pu extends Gz{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=z=>{if(!this._subEmitters||0===this._subEmitters.length)return;const u=Math.floor(Math.random()*this._subEmitters.length);for(const U of this._subEmitters[u])if(1===U.type){const u=U.clone();z._inheritParticleInfoToSubEmitter(u),u.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(u.particleSystem),u.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(z,u){const U=oz(z,u);return this.particleEmitterType=U,U}get flowMap(){return this._flowMap}set flowMap(z){this._flowMap!==z&&(this._flowMap=z,this._flowMapUpdate&&(Hz(this._flowMapUpdate),this._flowMapUpdate=null),z&&(this._flowMapUpdate={process:z=>{var u;const U=null===(u=this.Vz())||void 0===u?void 0:u.getTransformMatrix();this._flowMap._processParticle(z,this.flowMapStrength*this._tempScaledUpdateSpeed,U)},previousItem:null,nextItem:null},Bz(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(z){this._attractors.push(z),1===this._attractors.length&&(this._attractorUpdate={process:z=>{for(const u of this._attractors)u._processParticle(z,this)},previousItem:null,nextItem:null},Bz(this._attractorUpdate,this._directionProcessing))}removeAttractor(z){const u=this._attractors.indexOf(z);-1!==u&&this._attractors.splice(u,1),0===this._attractors.length&&Hz(this._attractorUpdate)}start(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(z)}createHemisphericEmitter(){const z=sz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=z,z}createSphereEmitter(){const z=lz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=z,z}createDirectedSphereEmitter(){const z=ez(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.Eu(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.Eu(0,1,0));return this.particleEmitterType=z,z}createCylinderEmitter(){const z=zu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=z,z}createDirectedCylinderEmitter(){const z=uu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.Eu(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.Eu(0,1,0));return this.particleEmitterType=z,z}createConeEmitter(){const z=Uu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=z,z}createDirectedConeEmitter(){const z=Ju(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.Eu(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.Eu(0,1,0));return this.particleEmitterType=z,z}createBoxEmitter(z,u,U,J){const v=new d;return this.particleEmitterType=v,this.direction1=z,this.direction2=u,this.minEmitBox=U,this.maxEmitBox=J,v}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const z of this.subEmitters)z instanceof Pu?this._subEmitters.push([new nz(z)]):z instanceof nz?this._subEmitters.push([z]):z instanceof Array&&this._subEmitters.push(z)}_stopSubEmitters(){if(this.activeSubSystems){for(const z of this.activeSubSystems)z.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const z=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==z&&this._rootParticleSystem.activeSubSystems.splice(z,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(z){z&&this._stopSubEmitters()}_prepareParticle(z){if(this._subEmitters&&this._subEmitters.length>0){const u=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];z._attachedSubEmitters=[];for(const U of u)if(0===U.type){const u=U.clone();z._attachedSubEmitters.push(u),u.particleSystem.start()}}}_onDispose(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),z&&this.particles)for(const U of this.particles)if(U._attachedSubEmitters)for(let z=U._attachedSubEmitters.length-1;z>=0;z-=1)U._attachedSubEmitters[z].dispose();if(u&&this.activeSubSystems)for(let U=this.activeSubSystems.length-1;U>=0;U-=1)this.activeSubSystems[U].dispose();if(this._subEmitters&&this._subEmitters.length){for(let z=0;z<this._subEmitters.length;z++)for(const u of this._subEmitters[z])u.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.vu&&this.vu.dispose&&this.vu.dispose(!0)}static _Parse(z,u,U,v){var f,P,R;let S;S=U instanceof qz.b?null:U;const h=(0,w.e)("BABYLON.Texture");if(h&&S&&(z.texture?u.particleTexture=h.Parse(z.texture,S,v):z.textureName&&(u.particleTexture=new h(v+z.textureName,S,!1,void 0===z.invertY||z.invertY),u.particleTexture.name=z.textureName)),z.emitterId||0===z.emitterId||void 0!==z.vu?z.emitterId&&S?u.vu=S.getLastMeshById(z.emitterId):u.vu=J.Eu.Xu(z.vu):u.vu=J.Eu.Zero(),u.isLocal=!!z.isLocal,void 0!==z.renderingGroupId&&(u.renderingGroupId=z.renderingGroupId),void 0!==z.isBillboardBased&&(u.isBillboardBased=z.isBillboardBased),void 0!==z.billboardMode&&(u.billboardMode=z.billboardMode),void 0!==z.useLogarithmicDepth&&(u.useLogarithmicDepth=z.useLogarithmicDepth),z.animations){for(let U=0;U<z.animations.length;U++){const J=z.animations[U],v=(0,w.e)("BABYLON.Animation");v&&u.animations.push(v.Parse(J))}u.beginAnimationOnStart=z.beginAnimationOnStart,u.beginAnimationFrom=z.beginAnimationFrom,u.beginAnimationTo=z.beginAnimationTo,u.beginAnimationLoop=z.beginAnimationLoop}if(z.autoAnimate&&S&&S.beginAnimation(u,z.autoAnimateFrom,z.autoAnimateTo,z.autoAnimateLoop,z.autoAnimateSpeed||1),u.startDelay=0|z.startDelay,u.minAngularSpeed=z.minAngularSpeed,u.maxAngularSpeed=z.maxAngularSpeed,u.minSize=z.minSize,u.maxSize=z.maxSize,z.minScaleX&&(u.minScaleX=z.minScaleX,u.maxScaleX=z.maxScaleX,u.minScaleY=z.minScaleY,u.maxScaleY=z.maxScaleY),void 0!==z.preWarmCycles&&(u.preWarmCycles=z.preWarmCycles,u.preWarmStepOffset=z.preWarmStepOffset),void 0!==z.minInitialRotation&&(u.minInitialRotation=z.minInitialRotation,u.maxInitialRotation=z.maxInitialRotation),u.minLifeTime=z.minLifeTime,u.maxLifeTime=z.maxLifeTime,u.minEmitPower=z.minEmitPower,u.maxEmitPower=z.maxEmitPower,u.emitRate=z.emitRate,u.gravity=J.Eu.Xu(z.gravity),z.noiseStrength&&(u.noiseStrength=J.Eu.Xu(z.noiseStrength)),u.color1=g.wg.Xu(z.color1),u.color2=g.wg.Xu(z.color2),u.colorDead=g.wg.Xu(z.colorDead),u.updateSpeed=z.updateSpeed,u.targetStopDuration=z.targetStopDuration,u.blendMode=z.blendMode,z.colorGradients)for(const J of z.colorGradients)u.addColorGradient(J.gradient,g.wg.Xu(J.color1),J.color2?g.wg.Xu(J.color2):void 0);if(z.rampGradients){for(const U of z.rampGradients)u.addRampGradient(U.gradient,g.Tu.Xu(U.color));u.useRampGradients=z.useRampGradients}if(z.colorRemapGradients)for(const J of z.colorRemapGradients)u.addColorRemapGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(z.alphaRemapGradients)for(const J of z.alphaRemapGradients)u.addAlphaRemapGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(z.sizeGradients)for(const J of z.sizeGradients)u.addSizeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(z.angularSpeedGradients)for(const J of z.angularSpeedGradients)u.addAngularSpeedGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(z.velocityGradients)for(const J of z.velocityGradients)u.addVelocityGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(z.dragGradients)for(const J of z.dragGradients)u.addDragGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(z.emitRateGradients)for(const J of z.emitRateGradients)u.addEmitRateGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(z.startSizeGradients)for(const J of z.startSizeGradients)u.addStartSizeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(z.lifeTimeGradients)for(const J of z.lifeTimeGradients)u.addLifeTimeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(z.limitVelocityGradients){for(const U of z.limitVelocityGradients)u.addLimitVelocityGradient(U.gradient,void 0!==U.factor1?U.factor1:U.factor,U.factor2);u.limitVelocityDamping=z.limitVelocityDamping}if(z.noiseTexture&&S){const U=(0,w.e)("BABYLON.ProceduralTexture");u.noiseTexture=U.Parse(z.noiseTexture,S,v)}let V;if(z.particleEmitterType){switch(z.particleEmitterType.type){case"SphereParticleEmitter":V=new M;break;case"SphereDirectedParticleEmitter":V=new T;break;case"ConeEmitter":case"ConeParticleEmitter":V=new mz;break;case"ConeDirectedParticleEmitter":V=new Z;break;case"CylinderParticleEmitter":V=new A;break;case"CylinderDirectedParticleEmitter":V=new E;break;case"HemisphericParticleEmitter":V=new C;break;case"PointParticleEmitter":V=new r;break;case"MeshParticleEmitter":V=new t;break;case"CustomParticleEmitter":V=new X;break;default:V=new d}V.parse(z.particleEmitterType,S)}else V=new d,V.parse(z,S);u.particleEmitterType=V,u.startSpriteCellID=z.startSpriteCellID,u.endSpriteCellID=z.endSpriteCellID,u.spriteCellLoop=null===(f=z.spriteCellLoop)||void 0===f||f,u.spriteCellWidth=z.spriteCellWidth,u.spriteCellHeight=z.spriteCellHeight,u.spriteCellChangeSpeed=z.spriteCellChangeSpeed,u.spriteRandomStartCell=z.spriteRandomStartCell,u.disposeOnStop=null!==(P=z.disposeOnStop)&&void 0!==P&&P,u.manualEmitCount=null!==(R=z.manualEmitCount)&&void 0!==R?R:-1}static Parse(z,u,U){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],f=arguments.length>4?arguments[4]:void 0;const w=z.name;let P,R,S=null,d=null;if(u instanceof qz.b?P=u:(R=u,P=R.getEngine()),z.customShader&&P.createEffectForParticles){d=z.customShader;const u=d.shaderOptions.defines.length>0?d.shaderOptions.defines.join("\n"):"";S=P.createEffectForParticles(d.shaderPath.fragmentElement,d.shaderOptions.uniforms,d.shaderOptions.samplers,u)}const mz=new Pu(w,f||z.MU,u,S,z.isAnimationSheetEnabled);if(mz.customShader=d,mz._rootUrl=U,z.id&&(mz.id=z.id),z.subEmitters){mz.subEmitters=[];for(const J of z.subEmitters){const z=[];for(const v of J)z.push(nz.Parse(v,u,U));mz.subEmitters.push(z)}}if(z.attractors)for(const g of z.attractors){const z=new wu;z.position=J.Eu.Xu(g.position),z.strength=g.strength,mz.addAttractor(z)}return Pu._Parse(z,mz,u,U),z.textureMask&&(mz.textureMask=g.wg.Xu(z.textureMask)),z.sR&&(mz.sR=J.Eu.Xu(z.sR)),z.preventAutoStart&&(mz.preventAutoStart=z.preventAutoStart),v||mz.preventAutoStart||mz.start(),mz}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={};if(Pu._Serialize(u,this,z),u.textureMask=this.textureMask.jf(),u.customShader=this.customShader,u.preventAutoStart=this.preventAutoStart,u.sR=this.sR.jf(),this.subEmitters){u.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const U of this._subEmitters){const J=[];for(const u of U)J.push(u.serialize(z));u.subEmitters.push(J)}}if(this._attractors&&this._attractors.length){u.attractors=[];for(const z of this._attractors)u.attractors.push(z.serialize())}return u}static _Serialize(z,u,U){if(z.name=u.name,z.id=u.id,z.MU=u.getCapacity(),z.disposeOnStop=u.disposeOnStop,z.manualEmitCount=u.manualEmitCount,u.vu.position){const U=u.vu;z.emitterId=U.id}else{const U=u.vu;z.vu=U.jf()}u.particleEmitterType&&(z.particleEmitterType=u.particleEmitterType.serialize()),u.particleTexture&&(U?z.texture=u.particleTexture.serialize():(z.textureName=u.particleTexture.name,z.invertY=!!u.particleTexture._invertY)),z.isLocal=u.isLocal,c.b.AppendSerializedAnimations(u,z),z.beginAnimationOnStart=u.beginAnimationOnStart,z.beginAnimationFrom=u.beginAnimationFrom,z.beginAnimationTo=u.beginAnimationTo,z.beginAnimationLoop=u.beginAnimationLoop,z.startDelay=u.startDelay,z.renderingGroupId=u.renderingGroupId,z.isBillboardBased=u.isBillboardBased,z.billboardMode=u.billboardMode,z.minAngularSpeed=u.minAngularSpeed,z.maxAngularSpeed=u.maxAngularSpeed,z.minSize=u.minSize,z.maxSize=u.maxSize,z.minScaleX=u.minScaleX,z.maxScaleX=u.maxScaleX,z.minScaleY=u.minScaleY,z.maxScaleY=u.maxScaleY,z.minEmitPower=u.minEmitPower,z.maxEmitPower=u.maxEmitPower,z.minLifeTime=u.minLifeTime,z.maxLifeTime=u.maxLifeTime,z.emitRate=u.emitRate,z.gravity=u.gravity.jf(),z.noiseStrength=u.noiseStrength.jf(),z.color1=u.color1.jf(),z.color2=u.color2.jf(),z.colorDead=u.colorDead.jf(),z.updateSpeed=u.updateSpeed,z.targetStopDuration=u.targetStopDuration,z.blendMode=u.blendMode,z.preWarmCycles=u.preWarmCycles,z.preWarmStepOffset=u.preWarmStepOffset,z.minInitialRotation=u.minInitialRotation,z.maxInitialRotation=u.maxInitialRotation,z.startSpriteCellID=u.startSpriteCellID,z.spriteCellLoop=u.spriteCellLoop,z.endSpriteCellID=u.endSpriteCellID,z.spriteCellChangeSpeed=u.spriteCellChangeSpeed,z.spriteCellWidth=u.spriteCellWidth,z.spriteCellHeight=u.spriteCellHeight,z.spriteRandomStartCell=u.spriteRandomStartCell,z.isAnimationSheetEnabled=u.isAnimationSheetEnabled,z.useLogarithmicDepth=u.useLogarithmicDepth;const J=u.getColorGradients();if(J){z.colorGradients=[];for(const u of J){const U={gradient:u.gradient,color1:u.color1.jf()};u.color2?U.color2=u.color2.jf():U.color2=u.color1.jf(),z.colorGradients.push(U)}}const v=u.getRampGradients();if(v){z.rampGradients=[];for(const u of v){const U={gradient:u.gradient,color:u.color.jf()};z.rampGradients.push(U)}z.useRampGradients=u.useRampGradients}const f=u.getColorRemapGradients();if(f){z.colorRemapGradients=[];for(const u of f){const U={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?U.factor2=u.factor2:U.factor2=u.factor1,z.colorRemapGradients.push(U)}}const g=u.getAlphaRemapGradients();if(g){z.alphaRemapGradients=[];for(const u of g){const U={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?U.factor2=u.factor2:U.factor2=u.factor1,z.alphaRemapGradients.push(U)}}const w=u.getSizeGradients();if(w){z.sizeGradients=[];for(const u of w){const U={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?U.factor2=u.factor2:U.factor2=u.factor1,z.sizeGradients.push(U)}}const P=u.getAngularSpeedGradients();if(P){z.angularSpeedGradients=[];for(const u of P){const U={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?U.factor2=u.factor2:U.factor2=u.factor1,z.angularSpeedGradients.push(U)}}const R=u.getVelocityGradients();if(R){z.velocityGradients=[];for(const u of R){const U={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?U.factor2=u.factor2:U.factor2=u.factor1,z.velocityGradients.push(U)}}const S=u.getDragGradients();if(S){z.dragGradients=[];for(const u of S){const U={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?U.factor2=u.factor2:U.factor2=u.factor1,z.dragGradients.push(U)}}const d=u.getEmitRateGradients();if(d){z.emitRateGradients=[];for(const u of d){const U={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?U.factor2=u.factor2:U.factor2=u.factor1,z.emitRateGradients.push(U)}}const mz=u.getStartSizeGradients();if(mz){z.startSizeGradients=[];for(const u of mz){const U={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?U.factor2=u.factor2:U.factor2=u.factor1,z.startSizeGradients.push(U)}}const Z=u.getLifeTimeGradients();if(Z){z.lifeTimeGradients=[];for(const u of Z){const U={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?U.factor2=u.factor2:U.factor2=u.factor1,z.lifeTimeGradients.push(U)}}const A=u.getLimitVelocityGradients();if(A){z.limitVelocityGradients=[];for(const u of A){const U={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?U.factor2=u.factor2:U.factor2=u.factor1,z.limitVelocityGradients.push(U)}z.limitVelocityDamping=u.limitVelocityDamping}u.noiseTexture&&(z.noiseTexture=u.noiseTexture.serialize())}clone(z,u){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=(0,p.e)({},this._customWrappers);let v=null;const f=this._engine;if(f.createEffectForParticles&&null!=this.customShader){v=this.customShader;const z=v.shaderOptions.defines.length>0?v.shaderOptions.defines.join("\n"):"",u=f.createEffectForParticles(v.shaderPath.fragmentElement,v.shaderOptions.uniforms,v.shaderOptions.samplers,z);J[0]?J[0].effect=u:this.setCustomEffect(u,0)}const g=this.serialize(U),w=Pu.Parse(g,this._scene||this._engine,this._rootUrl);return w.name=z,w.customShader=v,w._customWrappers=J,void 0===u&&(u=this.vu),this.noiseTexture&&(w.noiseTexture=this.noiseTexture.clone()),w.vu=u,this.preventAutoStart||w.start(),w}}Pu.BILLBOARDMODE_Y=2,Pu.BILLBOARDMODE_ALL=7,Pu.BILLBOARDMODE_STRETCHED=8,Pu.BILLBOARDMODE_STRETCHED_LOCAL=9,nz._ParseParticleSystem=Pu.Parse;var Ru=U(13167),Su=U(13161),du=U(13050);du.b.prototype.createTransformFeedback=function(){const z=this._gl.createTransformFeedback();if(!z)throw new Error("Unable to create Transform Feedback");return z},du.b.prototype.deleteTransformFeedback=function(z){this._gl.deleteTransformFeedback(z)},du.b.prototype.bindTransformFeedback=function(z){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,z)},du.b.prototype.beginTransformFeedback=function(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(z?this._gl.POINTS:this._gl.TRIANGLES)},du.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},du.b.prototype.setTranformFeedbackVaryings=function(z,u){this._gl.transformFeedbackVaryings(z,u,this._gl.INTERLEAVED_ATTRIBS)},du.b.prototype.bindTransformFeedbackBuffer=function(z){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,z?z.underlyingResource:null)},du.b.prototype.readTransformFeedbackBuffer=function(z){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,z)};const mU="clipPlaneFragmentDeclaration2",Zu="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";L.d.IncludesShadersStore[mU]||(L.d.IncludesShadersStore[mU]=Zu);U(13780),U(13784),U(13792),U(13795),U(13800),U(13805),U(13811),U(13816);const Au="gpuRenderParticlesPixelShader",Eu="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";L.d.ShadersStore[Au]||(L.d.ShadersStore[Au]=Eu);const Cu="clipPlaneVertexDeclaration2",ru="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";L.d.IncludesShadersStore[Cu]||(L.d.IncludesShadersStore[Cu]=ru);U(13821),U(13829),U(13831),U(13839);const Mu="gpuRenderParticlesVertexShader",Tu="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";L.d.ShadersStore[Mu]||(L.d.ShadersStore[Mu]=Tu);class Xu extends P{static get IsSupported(){if(!e.e.LastCreatedEngine)return!1;const z=e.e.LastCreatedEngine.getCaps();return z.supportTransformFeedbacks||z.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(z){this._maxActiveParticleCount=Math.min(z,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(z){this.maxActiveParticleCount=z}createPointEmitter(z,u){const U=oz(z,u);return this.particleEmitterType=U,U}createHemisphericEmitter(){const z=sz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=z,z}createSphereEmitter(){const z=lz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=z,z}createDirectedSphereEmitter(){const z=ez(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.Eu(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.Eu(0,1,0));return this.particleEmitterType=z,z}createCylinderEmitter(){const z=zu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=z,z}createDirectedCylinderEmitter(){const z=uu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.Eu(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.Eu(0,1,0));return this.particleEmitterType=z,z}createConeEmitter(){const z=Uu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=z,z}createDirectedConeEmitter(){const z=Ju(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.Eu(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.Eu(0,1,0));return this.particleEmitterType=z,z}createBoxEmitter(z,u,U,J){const v=new d;return this.particleEmitterType=v,this.direction1=z,this.direction2=u,this.minEmitBox=U,this.maxEmitBox=J,v}get flowMap(){return this._flowMap}set flowMap(z){this._flowMap!==z&&(this._flowMap=z)}isReady(){if(!this.vu||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Pu.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Pu.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Pu.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";z?setTimeout((()=>{this.start(0)}),z):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var z,u;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(z=null===(u=this._customWrappers[U])||void 0===u?void 0:u.effect)&&void 0!==z?z:this._customWrappers[0].effect}_getCustomDrawWrapper(){var z;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(z=this._customWrappers[u])&&void 0!==z?z:this._customWrappers[0]}setCustomEffect(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[u]=new uz.d(this._engine),this._customWrappers[u].effect=z}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new s.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(z,u,U){return super._removeGradientAndTexture(z,u,U),this._releaseBuffers(),this}addColorGradient(z,u){this._colorGradients||(this._colorGradients=[]);const U=new i(z,u);return this._colorGradients.push(U),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(z&&this._colorGradients.sort(((z,u)=>z.gradient<u.gradient?-1:z.gradient>u.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(z){return this._removeGradientAndTexture(z,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const u in this._drawWrappers){var z;null===(z=this._drawWrappers[u].drawContext)||void 0===z||z.reset()}}_addFactorGradient(z,u,U){const J=new q(u,U);z.push(J),this._releaseBuffers()}addSizeGradient(z,u){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,z,u),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(z){return this._removeGradientAndTexture(z,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(z,u){if(!z)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&z.sort(((z,u)=>z.gradient<u.gradient?-1:z.gradient>u.gradient?1:0));const U=this;U[u]&&(U[u].dispose(),U[u]=null)}addAngularSpeedGradient(z,u){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,z,u),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(z){return this._removeGradientAndTexture(z,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(z,u){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,z,u),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(z){return this._removeGradientAndTexture(z,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(z,u){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,z,u),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(z){return this._removeGradientAndTexture(z,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(z,u){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,z,u),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(z){return this._removeGradientAndTexture(z,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(z){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(z,u,U){var v;let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(z),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Xf=new s.e,this.onStoppedObservable=new s.e,this.onStartedObservable=new s.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,U&&"Scene"!==U.getClassName()?(this._engine=U,this.defaultProjectionMatrix=J.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=U||e.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.mA.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,w.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,w.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,w.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,w.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new uz.d(this._engine)},this._customWrappers[0].effect=f,this._drawWrappers={0:new uz.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(u=null!==(v=u)&&void 0!==v?v:{}).randomTextureSize||delete u.randomTextureSize;const P=(0,p.e)({MU:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize},u),R=u;isFinite(R)&&(P.MU=R),this._capacity=P.MU,this._maxActiveParticleCount=P.MU,this._currentActiveCount=0,this._isAnimationSheetEnabled=g,this.particleEmitterType=new d;const S=Math.min(this._engine.getCaps().maxTextureSize,P.randomTextureSize);let mz=[];for(let J=0;J<S;++J)mz.push(Math.random()),mz.push(Math.random()),mz.push(Math.random()),mz.push(Math.random());this._randomTexture=new l.b(new Float32Array(mz),S,1,5,U,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,mz=[];for(let J=0;J<S;++J)mz.push(Math.random()),mz.push(Math.random()),mz.push(Math.random()),mz.push(Math.random());this._randomTexture2=new l.b(new Float32Array(mz),S,1,5,U,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=S}_reset(){this._releaseBuffers()}_createVertexBuffers(z,u,U){const J={};J.position=u.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let v=3;J.age=u.createVertexBuffer("age",v,1,this._attributesStrideSize,!0),v+=1,J.size=u.createVertexBuffer("size",v,3,this._attributesStrideSize,!0),v+=3,J.life=u.createVertexBuffer("life",v,1,this._attributesStrideSize,!0),v+=1,v+=4,this.billboardMode===Pu.BILLBOARDMODE_STRETCHED&&(J.direction=u.createVertexBuffer("direction",v,3,this._attributesStrideSize,!0)),v+=3,this._platform.alignDataInBuffer&&(v+=1),this.particleEmitterType instanceof X&&(v+=3,this._platform.alignDataInBuffer&&(v+=1)),this._colorGradientsTexture||(J.color=u.createVertexBuffer("color",v,4,this._attributesStrideSize,!0),v+=4),this._isBillboardBased||(J.initialDirection=u.createVertexBuffer("initialDirection",v,3,this._attributesStrideSize,!0),v+=3,this._platform.alignDataInBuffer&&(v+=1)),this.noiseTexture&&(J.noiseCoordinates1=u.createVertexBuffer("noiseCoordinates1",v,3,this._attributesStrideSize,!0),v+=3,this._platform.alignDataInBuffer&&(v+=1),J.noiseCoordinates2=u.createVertexBuffer("noiseCoordinates2",v,3,this._attributesStrideSize,!0),v+=3,this._platform.alignDataInBuffer&&(v+=1)),J.angle=u.createVertexBuffer("angle",v,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?v++:v+=2,this._isAnimationSheetEnabled&&(J.cellIndex=u.createVertexBuffer("cellIndex",v,1,this._attributesStrideSize,!0),v+=1,this.spriteRandomStartCell&&(J.cellStartOffset=u.createVertexBuffer("cellStartOffset",v,1,this._attributesStrideSize,!0),v+=1)),J.offset=U.createVertexBuffer("offset",0,2),J.uv=U.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(J),this._platform.createVertexBuffers(z,J),this.resetDrawCache()}_initialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!z)return;const u=this._engine,U=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof X&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const v=this.particleEmitterType instanceof X,f=J.TmpVectors.Eu[0];let g=0;for(let J=0;J<this._capacity;J++)if(U.push(0),U.push(0),U.push(0),U.push(0),U.push(0),U.push(0),U.push(0),U.push(0),U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),v?(this.particleEmitterType.particleDestinationGenerator(J,null,f),U.push(f.x),U.push(f.y),U.push(f.z)):(U.push(0),U.push(0),U.push(0)),this._platform.alignDataInBuffer&&U.push(0),g+=16,v&&(this.particleEmitterType.particlePositionGenerator(J,null,f),U.push(f.x),U.push(f.y),U.push(f.z),this._platform.alignDataInBuffer&&U.push(0),g+=4),this._colorGradientsTexture||(U.push(0),U.push(0),U.push(0),U.push(0),g+=4),this.isBillboardBased||(U.push(0),U.push(0),U.push(0),this._platform.alignDataInBuffer&&U.push(0),g+=4),this.noiseTexture&&(U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),this._platform.alignDataInBuffer&&U.push(0),U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),this._platform.alignDataInBuffer&&U.push(0),g+=8),U.push(0),g+=1,this._angularSpeedGradientsTexture||(U.push(0),g+=1),this._isAnimationSheetEnabled&&(U.push(0),g+=1,this.spriteRandomStartCell&&(U.push(0),g+=1)),this._platform.alignDataInBuffer){let z=3-(g+3&3);for(g+=z;z-- >0;)U.push(0)}const w=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),P=this._platform.createParticleBuffer(U),R=this._platform.createParticleBuffer(U);this._buffer0=new h.e(u,P,!1,this._attributesStrideSize),this._buffer1=new h.e(u,R,!1,this._attributesStrideSize),this._spriteBuffer=new h.e(u,w,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let z=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(z+="\n#define BILLBOARD"),this._colorGradientsTexture&&(z+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(z+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(z+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(z+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(z+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(z+="\n#define DRAGGRADIENTS"),this._flowMap&&(z+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(z+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(z+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(z+="\n#define NOISE"),this.isLocal&&(z+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===z||(this._cachedUpdateDefines=z,this._updateBuffer=this._platform.createUpdateBuffer(z)),this._platform.isUpdateBufferReady()}_getWrapper(z){const u=this._getCustomDrawWrapper(z);if(null!==u&&void 0!==u&&u.effect)return u;const U=[];this.fillDefines(U,z);let J=this._drawWrappers[z];J||(J=new uz.d(this._engine),J.drawContext&&(J.drawContext.useInstancing=!0),this._drawWrappers[z]=J);const v=U.join("\n");if(J.defines!==v){const z=[],u=[],U=[];this.fillUniformsAttributesAndSamplerNames(u,z,U),J.setEffect(this._engine.createEffect("gpuRenderParticles",z,u,U,v),v)}return J}static _GetAttributeNamesOrOptions(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const v=[h.g.PositionKind,"age","life","size","angle"];return z||v.push(h.g.ColorKind),u&&v.push("cellIndex"),U||v.push("initialDirection"),J&&v.push("direction"),v.push("offset",h.g.UVKind),v}static _GetEffectCreationOptions(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=["emitterWM","sR","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Uz.b)(J),z&&J.push("sheetInfos"),u&&J.push("logarithmicDepthConstant"),U&&(J.push("vFogInfos"),J.push("vFogColor")),J}fillDefines(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Uz.k)(this,this._scene,z),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Su.d.FOGMODE_NONE&&z.push("#define FOG")),u===Pu.BLENDMODE_MULTIPLY&&z.push("#define BLENDMULTIPLYMODE"),this.isLocal&&z.push("#define LOCAL"),this.useLogarithmicDepth&&z.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(z.push("#define BILLBOARD"),this.billboardMode){case Pu.BILLBOARDMODE_Y:z.push("#define BILLBOARDY");break;case Pu.BILLBOARDMODE_STRETCHED:z.push("#define BILLBOARDSTRETCHED");break;case Pu.BILLBOARDMODE_ALL:z.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&z.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&z.push("#define ANIMATESHEET"),U&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),z.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(z,u,U){u.push(...Xu._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Pu.BILLBOARDMODE_STRETCHED)),z.push(...Xu._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),U.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Ru.d.PrepareUniforms(z,this._imageProcessingConfigurationDefines),Ru.d.PrepareSamplers(U,this._imageProcessingConfigurationDefines))}animate(){var z;let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(u?this.preWarmStepOffset:(null===(z=this._scene)||void 0===z?void 0:z.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(z,u){const U=this[u];if(!z||!z.length||U)return;const J=new Float32Array(this._rawTextureWidth);for(let v=0;v<this._rawTextureWidth;v++){const u=v/this._rawTextureWidth;o.GetCurrentGradient(u,z,((z,u,U)=>{J[v]=(0,R.Lerp)(z.factor1,u.factor1,U)}))}this[u]=l.b.CreateRTexture(J,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[u].name=u.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const z=new Uint8Array(4*this._rawTextureWidth),u=g.TmpColors.wg[0];for(let U=0;U<this._rawTextureWidth;U++){const J=U/this._rawTextureWidth;o.GetCurrentGradient(J,this._colorGradients,((J,v,f)=>{g.wg.LerpToRef(J.color1,v.color1,f,u),z[4*U]=255*u.r,z[4*U+1]=255*u.g,z[4*U+2]=255*u.b,z[4*U+3]=255*u.a}))}this._colorGradientsTexture=l.b.CreateRGBATexture(z,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(z,u){var U,v,f,g,w;const P=this._getWrapper(z),R=P.effect;this._engine.enableEffect(P);const S=(null===(U=this._scene)||void 0===U?void 0:U.getViewMatrix())||J.Matrix.IdentityReadOnly;if(R.setMatrix("view",S),R.setMatrix("projection",null!==(v=this.defaultProjectionMatrix)&&void 0!==v?v:this._scene.getProjectionMatrix()),R.setTexture("diffuseSampler",this.particleTexture),R.setVector2("translationPivot",this.translationPivot),R.setVector3("sR",this.sR),this.isLocal&&R.setMatrix("emitterWM",u),this._colorGradientsTexture?R.setTexture("colorGradientSampler",this._colorGradientsTexture):R.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const z=this.particleTexture.getBaseSize();R.setFloat3("sheetInfos",this.spriteCellWidth/z.width,this.spriteCellHeight/z.height,z.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const z=this._scene.activeCamera;R.setVector3("eyePosition",z.globalPosition)}const d=R.defines;if(this._scene&&((0,Uz.f)(R,this,this._scene),this.applyFog&&(0,Jz.f)(this._scene,void 0,R)),d.indexOf("#define BILLBOARDMODE_ALL")>=0){const z=S.clone();z.invert(),R.setMatrix("invView",z)}return this.useLogarithmicDepth&&this._scene&&(0,Jz.h)(d,R,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(R),this._setEngineBasedOnBlendMode(z),this._platform.bindDrawBuffers(this._targetIndex,R,null!==(f=this._scene)&&void 0!==f&&f.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(R),null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(w=this._scene)&&void 0!==w&&w.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(z){if(!this.vu||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!z)if(this.vu.position){z=this.vu.getWorldMatrix()}else{const u=this.vu;z=J.TmpVectors.Matrix[0],J.Matrix.TranslationToRef(u.x,u.y,u.z,z)}const u=this._engine,U=u.getDepthWrite();if(u.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const z=this.Vz();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",z.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",z),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const v=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=v,u.setDepthWrite(U)}render(){let z,u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!u&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let z=0;z<this.preWarmCycles;z++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const z=0|this._accumulatedCount;this._accumulatedCount-=z,this._currentActiveCount+=z}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.vu.position){z=this.vu.getWorldMatrix()}else{const u=this.vu;z=J.TmpVectors.Matrix[0],J.Matrix.TranslationToRef(u.x,u.y,u.z,z)}const v=this._engine;this.updateInAnimate||this._update(z);let f=0;return u||U||(v.setState(!1),this.forceDepthWrite&&v.setDepthWrite(!0),f=this.blendMode===Pu.BLENDMODE_MULTIPLYADD?this._render(Pu.BLENDMODE_MULTIPLY,z)+this._render(Pu.BLENDMODE_ADD,z):this._render(this.blendMode,z),this._engine.setAlphaMode(0)),f}rebuild(){const z=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(z,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,z()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const u in this._drawWrappers){this._drawWrappers[u].dispose()}if(this._drawWrappers={},this._scene){const z=this._scene.mA.indexOf(this);z>-1&&this._scene.mA.splice(z,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let u=0;u<this._renderVertexBuffers.length;++u){const z=this._renderVertexBuffers[u];for(const u in z)z[u].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Xf.notifyObservers(this),this.Xf.clear()}clone(z,u){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=(0,p.e)({},this._customWrappers);let v=null;const f=this._engine;if(f.createEffectForParticles&&null!=this.customShader){v=this.customShader;const z=v.shaderOptions.defines.length>0?v.shaderOptions.defines.join("\n"):"";J[0]=f.createEffectForParticles(v.shaderPath.fragmentElement,v.shaderOptions.uniforms,v.shaderOptions.samplers,z,void 0,void 0,void 0,this)}const g=this.serialize(U),w=Xu.Parse(g,this._scene||this._engine,this._rootUrl);return w.name=z,w.customShader=v,w._customWrappers=J,void 0===u&&(u=this.vu),this.noiseTexture&&(w.noiseTexture=this.noiseTexture.clone()),w.vu=u,w}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={};return Pu._Serialize(u,this,z),u.activeParticleCount=this.activeParticleCount,u.randomTextureSize=this._randomTextureSize,u.customShader=this.customShader,u}static Parse(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4?arguments[4]:void 0;const f=z.name;let g,w;u instanceof qz.b?g=u:(w=u,g=w.getEngine());const P=new Xu(f,{MU:v||z.MU,randomTextureSize:z.randomTextureSize},u,null,z.isAnimationSheetEnabled);if(P._rootUrl=U,z.customShader&&g.createEffectForParticles){const u=z.customShader,U=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"",J=g.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,U,void 0,void 0,void 0,P);P.setCustomEffect(J,0),P.customShader=u}return z.id&&(P.id=z.id),z.activeParticleCount&&(P.activeParticleCount=z.activeParticleCount),Pu._Parse(z,P,u,U),z.preventAutoStart&&(P.preventAutoStart=z.preventAutoStart),J||P.preventAutoStart||P.start(),P}}var hu=U(12748),tu=U(13846),Vu=U(13271);class Lu{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(z){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const u of this.systems)u.vu=z;this._emitterNode=z}setEmitterAsSphere(z,u,U){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:z,renderingGroupId:u};const J=(0,tu.c)("emitterSphere",{diameter:z.diameter,segments:z.segments},U);J.renderingGroupId=u;const v=new Vu.Mu("emitterSphereMaterial",U);v.emissiveColor=z.color,J.material=v;for(const f of this.systems)f.vu=J;this._emitterNode=J}start(z){for(const u of this.systems)z&&(u.vu=z),u.start()}dispose(){for(const z of this.systems)z.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={systems:[]};for(const U of this.systems)u.systems.push(U.serialize(z));return this._emitterNode&&(u.vu=this._emitterCreationOptions),u}static Parse(z,u){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;const v=new Lu,f=this.BaseAssetsUrl+"/textures/";u=u||e.e.LastCreatedScene;for(const g of z.systems)v.systems.push(U?Xu.Parse(g,u,f,!0,J):Pu.Parse(g,u,f,!0,J));if(z.vu){const U=z.vu.options;if("Sphere"===z.vu.kind)v.setEmitterAsSphere({diameter:U.diameter,segments:U.segments,color:g.Tu.Xu(U.color)},z.vu.renderingGroupId,u)}return v}}Lu.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Ou=U(12790);class xu{static CreateDefault(z){let u,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,J=arguments.length>2?arguments[2]:void 0;u=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Xu("default system",{MU:U},J):new Pu("default system",U,J),u.vu=z;const v=hu.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return u.particleTexture=new W.e(v,u.Vz()),u.createConeEmitter(.1,Math.PI/4),u.color1=new g.wg(1,1,1,1),u.color2=new g.wg(1,1,1,1),u.colorDead=new g.wg(1,1,1,0),u.minSize=.1,u.maxSize=.1,u.minEmitPower=2,u.maxEmitPower=2,u.updateSpeed=1/60,u.emitRate=30,u}static CreateAsync(z,u){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;u||(u=e.e.LastCreatedScene);const v={};return u.addPendingData(v),new Promise(((f,g)=>{if(U&&!Xu.IsSupported)return u.removePendingData(v),g("Particle system with GPU is not supported.");hu.Tools.LoadFile("".concat(xu.BaseAssetsUrl,"/systems/").concat(z,".json"),(z=>{u.removePendingData(v);const g=JSON.parse(z.toString());return f(Lu.Parse(g,u,U,J))}),void 0,void 0,void 0,(()=>(u.removePendingData(v),g("An error occurred with the creation of your particle system. Check if your type '".concat(z,"' exists.")))))}))}static ExportSet(z){const u=new Lu;for(const U of z)u.systems.push(U);return u}static ParseFromFileAsync(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",f=arguments.length>5?arguments[5]:void 0;return new Promise(((g,w)=>{const P=new Ou.b;P.addEventListener("readystatechange",(()=>{if(4==P.readyState)if(200==P.status){const u=JSON.parse(P.responseText);let w;w=J?Xu.Parse(u,U,v,!1,f):Pu.Parse(u,U,v,!1,f),z&&(w.name=z),g(w)}else w("Unable to load the particle system")})),P.open("GET",u),P.send()}))}static ParseFromSnippetAsync(z,u){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",v=arguments.length>4?arguments[4]:void 0;if("_BLANK"===z){const z=this.CreateDefault(null);return z.start(),Promise.resolve(z)}return new Promise(((f,g)=>{const w=new Ou.b;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const g=JSON.parse(JSON.parse(w.responseText).jsonPayload),P=JSON.parse(g.particleSystem);let R;R=U?Xu.Parse(P,u,J,!1,v):Pu.Parse(P,u,J,!1,v),R.snippetId=z,f(R)}else g("Unable to load the snippet "+z)})),w.open("GET",this.SnippetUrl+"/"+z.replace(/#/g,"/")),w.send()}))}}xu.BaseAssetsUrl=Lu.BaseAssetsUrl,xu.SnippetUrl="https://snippet.babylonjs.com",xu.CreateFromSnippetAsync=xu.ParseFromSnippetAsync;var Qu=U(13335),Ku=U(13193),Yu=U(13850);(0,Yu.i)(Ku.c.NAME_PARTICLESYSTEM,((z,u,U,J)=>{const v=(0,Yu.l)(Ku.c.NAME_PARTICLESYSTEM);if(v&&void 0!==z.mA&&null!==z.mA)for(let f=0,g=z.mA.length;f<g;f++){const g=z.mA[f];U.mA.push(v(g,u,J))}})),(0,Yu.e)(Ku.c.NAME_PARTICLESYSTEM,((z,u,U)=>{if(z.activeParticleCount){return Xu.Parse(z,u,U)}return Pu.Parse(z,u,U)})),qz.b.prototype.createEffectForParticles=function(z){var u;let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",g=arguments.length>4?arguments[4]:void 0,w=arguments.length>5?arguments[5]:void 0,P=arguments.length>6?arguments[6]:void 0,R=arguments.length>7?arguments[7]:void 0,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,d=arguments.length>9?arguments[9]:void 0,mz=[],Z=[];const A=[];return R?R.fillUniformsAttributesAndSamplerNames(Z,mz,A):(mz=Pu._GetAttributeNamesOrOptions(),Z=Pu._GetEffectCreationOptions()),-1===f.indexOf(" BILLBOARD")&&(f+="\n#define BILLBOARD\n"),null!==R&&void 0!==R&&R.isAnimationSheetEnabled&&-1===f.indexOf(" ANIMATESHEET")&&(f+="\n#define ANIMATESHEET\n"),-1===v.indexOf("diffuseSampler")&&v.push("diffuseSampler"),this.createEffect({vertex:null!==(u=null!==d&&void 0!==d?d:null===R||void 0===R?void 0:R.vertexShaderName)&&void 0!==u?u:"particles",fragmentElement:z},mz,Z.concat(J),A.concat(v),f,g,w,P,void 0,S,(async()=>{0===S?await Promise.resolve().then(U.bind(U,13892)):await Promise.resolve().then(U.bind(U,13958))}))},Qu.e.prototype.getEmittedParticleSystems=function(){const z=[];for(let u=0;u<this.Vz().mA.length;u++){const U=this.Vz().mA[u];U.vu===this&&z.push(U)}return z},Qu.e.prototype.getHierarchyEmittedParticleSystems=function(){const z=[],u=this.getDescendants();u.push(this);for(let U=0;U<this.Vz().mA.length;U++){const J=this.Vz().mA[U],v=J.vu;v.position&&-1!==u.indexOf(v)&&z.push(J)}return z};U(13238),U(13250),U(13320);U(13322),U(13858),U(13126),U(13226),U(13348);U(13123);var pu;U(13866),U(12940);!function(z){z[z.Color=2]="Color",z[z.UV=1]="UV",z[z.Random=0]="Random",z[z.Stated=3]="Stated"}(pu||(pu={}));var Nu=U(13148);const Du=new J.Eu(0,0,0),cu=new J.Eu(0,0,0),Wu=new J.Eu(0,0,0);class ju{constructor(z,u,U){this.width=z,this.height=u,this.data=U}processFlowable(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2?arguments[2]:void 0;if(!U)return;U instanceof J.Matrix?J.Eu.TransformCoordinatesToRef(z.position,U,Wu):(Wu.x=U.x,Wu.y=U.y,Wu.z=U.z);const v=.5*Wu.x+.5,f=1-(.5*Wu.y+.5),g=Math.floor(v*this.width),w=Math.floor(f*this.height);if(g<0||g>=this.width||w<0||w>=this.height)return;const P=4*(w*this.width+g),R=this.data[P]/255*2-1,S=this.data[P+1]/255*2-1,d=this.data[P+2]/255*2-1,mz=this.data[P+3]/255;Du.set(R,S,d),Du.scaleToRef(u*mz,cu),z.direction.addInPlace(cu)}_processParticle(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2?arguments[2]:void 0;this.processFlowable(z,u,U)}static async FromUrlAsync(z){return await new Promise(((u,U)=>{const J=document.createElement("canvas"),v=J.getContext("2d");let f=null;const g=new Image;g.crossOrigin="anonymous",g.src=z,g.onerror=u=>{U(new Error("Failed to load image: ".concat(z," : ").concat(u)))},g.onload=()=>{J.width=g.width,J.height=g.height,v.drawImage(g,0,0),f=v.getImageData(0,0,J.width,J.height),u(new ju(J.width,J.height,f.data))}}))}static async ExtractFromTextureAsync(z){return await new Promise(((u,U)=>{if(!z.isReady())return void z.onLoadObservable.addOnce((async()=>{try{const U=await this.ExtractFromTextureAsync(z);u(U)}catch(J){U(J)}}));const J=z.getSize();Nu.k.GetTextureDataAsync(z,J.width,J.height).then((z=>{u(new ju(J.width,J.height,new Uint8ClampedArray(z)))})).catch(U)}))}}var Iu,Fu,bu,ku,Bu,yu,Hu,Gu,au;!function(z){z[z.Int=1]="Int",z[z.Float=2]="Float",z[z.Vector2=4]="Vector2",z[z.Eu=8]="Eu",z[z.Matrix=16]="Matrix",z[z.Particle=32]="Particle",z[z.Texture=64]="Texture",z[z.wg=128]="wg",z[z.FloatGradient=256]="FloatGradient",z[z.Vector2Gradient=512]="Vector2Gradient",z[z.Vector3Gradient=1024]="Vector3Gradient",z[z.Color4Gradient=2048]="Color4Gradient",z[z.System=4096]="System",z[z.AutoDetect=8192]="AutoDetect",z[z.BasedOnInput=16384]="BasedOnInput",z[z.Undefined=32768]="Undefined",z[z.All=65535]="All"}(Iu||(Iu={})),function(z){z[z.Compatible=0]="Compatible",z[z.TypeIncompatible=1]="TypeIncompatible",z[z.HierarchyIssue=2]="HierarchyIssue"}(Fu||(Fu={})),function(z){z[z.Input=0]="Input",z[z.Output=1]="Output"}(bu||(bu={}));class iu{get direction(){return this._direction}get type(){if(this._type===Iu.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Iu.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(z){this._type=z}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((z=>z.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(z,u,U){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Iu.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new s.e,this.onDisconnectionObservable=new s.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=u,this.name=z,this._direction=U}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(z){var u;return this.isConnected?null!==(u=this._connectedPoint)&&void 0!==u&&u._storedFunction?this._connectedPoint._storedFunction(z):this._connectedPoint._storedValue:this.value}canConnectTo(z){return 0===this.checkCompatibilityState(z)}checkCompatibilityState(z){const u=this._ownerBlock,U=z.ownerBlock;if(this.type!==z.type&&z.innerType!==Iu.AutoDetect)return z.acceptedConnectionPointTypes&&-1!==z.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(z.excludedConnectionPointTypes&&-1!==z.excludedConnectionPointTypes.indexOf(this.type))return 1;let J=U,v=u;return 0===this.direction&&(J=u,v=U),J.isAnAncestorOf(v)?2:0}connectTo(z){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(z))throw'Cannot connect these two connectors. source: "'.concat(this.ownerBlock.name,'".').concat(this.name,', target: "').concat(z.ownerBlock.name,'".').concat(z.name);return this._endpoints.push(z),z._connectedPoint=this,this.onConnectionObservable.notifyObservers(z),z.onConnectionObservable.notifyObservers(this),this}disconnectFrom(z){const u=this._endpoints.indexOf(z);return-1===u||(this._endpoints.splice(u,1),z._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(z),z.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(z){let u=1;for(;u<Iu.All;)z&u||this.excludedConnectionPointTypes.push(u),u<<=1}serialize(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const u={};return u.name=this.name,u.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.jf?(u.valueType="BABYLON."+this.value.getClassName(),u.value=this.value.jf()):(u.valueType="number",u.value=this.value)),z&&this.connectedPoint&&(u.inputName=this.name,u.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,u.targetConnectionName=this.connectedPoint.name,u.isExposedOnFrame=!0,u.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(u.isExposedOnFrame=!0,u.exposedPortPosition=this.exposedPortPosition),u}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class nu{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(z){this._name=z}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(z){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new s.e,this.Xf=new s.e,this.onInputChangedObservable=new s.e,this.visibleOnFrame=!1,this._name=z,this.uniqueId=j.e.UniqueId}_inputRename(z){return z}_outputRename(z){return z}isAnAncestorOf(z){for(const u of this._outputs)if(u.hasEndpoints)for(const U of u.endpoints){if(U.ownerBlock===z)return!0;if(U.ownerBlock.isAnAncestorOf(z))return!0}return!1}isAnAncestorOfType(z){if(this.getClassName()===z)return!0;for(const u of this._outputs)if(u.hasEndpoints)for(const U of u.endpoints)if(U.ownerBlock.isAnAncestorOfType(z))return!0;return!1}getInputByName(z){const u=this._inputs.filter((u=>u.name===z));return u.length?u[0]:null}_linkConnectionTypes(z,u){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[u]._acceptedConnectionPointType=this._inputs[z]:(this._inputs[z]._linkedConnectionSource=this._inputs[u],this._inputs[z]._isMainLinkSource=!0),this._inputs[u]._linkedConnectionSource=this._inputs[z]}registerInput(z,u){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0;const g=new iu(z,this,0);return g.type=u,g.isOptional=U,g.defaultValue=J,g.value=J,g.valueMin=v,g.valueMax=f,this._inputs.push(g),this.onInputChangedObservable.notifyObservers(g),this}registerOutput(z,u,U){var J;return(U=null!==(J=U)&&void 0!==J?J:new iu(z,this,1)).type=u,this._outputs.push(U),this}_build(z){}_customBuildStep(z){}build(z){if(this._buildId===z.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((z=>z.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=z.buildId;for(const u of this._inputs){if(!u.connectedPoint){u.isOptional||z.notConnectedNonOptionalInputs.push(u);continue}const U=u.connectedPoint.ownerBlock;U&&U!==this&&!U.isSystem&&U.build(z)}return this._customBuildStep(z),z.verbose&&I.d.Log("Building ".concat(this.name," [").concat(this.getClassName(),"]")),this._build(z),this.onBuildObservable.notifyObservers(this),!1}serialize(){const z={};z.customType="BABYLON."+this.getClassName(),z.id=this.uniqueId,z.name=this.name,z.visibleOnFrame=this.visibleOnFrame,z.inputs=[],z.outputs=[];for(const u of this.inputs)z.inputs.push(u.serialize());for(const u of this.outputs)z.outputs.push(u.serialize(!1));return z}_deserialize(z){this._name=z.name,this.comments=z.comments,this.visibleOnFrame=!!z.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(z)}_deserializePortDisplayNamesAndExposedOnFrame(z){const u=z.inputs,U=z.outputs;if(u)for(const J of u){const z=this.inputs.find((z=>z.name===J.name));if(!z)return;if(J.displayName&&(z.displayName=J.displayName),J.isExposedOnFrame&&(z.isExposedOnFrame=J.isExposedOnFrame,z.exposedPortPosition=J.exposedPortPosition),void 0!==J.value&&null!==J.value)if("number"===J.valueType)z.value=J.value;else{const u=(0,w.e)(J.valueType);u&&(z.value=u.Xu(J.value))}}if(U)for(let J=0;J<U.length;J++){const z=U[J];z.displayName&&(this.outputs[J].displayName=z.displayName),z.isExposedOnFrame&&(this.outputs[J].isExposedOnFrame=z.isExposedOnFrame,this.outputs[J].exposedPortPosition=z.exposedPortPosition)}}clone(){const z=this.serialize(),u=(0,w.e)(z.customType);if(u){const U=new u;return U._deserialize(z),U}return null}dispose(){this.Xf.notifyObservers(this),this.Xf.clear();for(const z of this.inputs)z.dispose();for(const z of this.outputs)z.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function qu(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",J=arguments.length>3?arguments[3]:void 0;return(v,f)=>{let g=v._propStore;g||(g=[],v._propStore=g),g.push({propertyName:f,displayName:z,type:u,groupName:U,options:null!==J&&void 0!==J?J:{},className:v.getClassName()})}}(0,N.b)([(0,D.K)("comment")],nu.prototype,"comments",void 0),function(z){z[z.Boolean=0]="Boolean",z[z.Float=1]="Float",z[z.Int=2]="Int",z[z.Vector2=3]="Vector2",z[z.List=4]="List",z[z.wg=5]="wg",z[z.SamplingMode=6]="SamplingMode",z[z.TextureFormat=7]="TextureFormat",z[z.TextureType=8]="TextureType"}(ku||(ku={})),function(z){z[z.None=0]="None",z[z.Position=1]="Position",z[z.Direction=2]="Direction",z[z.Age=3]="Age",z[z.Lifetime=4]="Lifetime",z[z.Color=5]="Color",z[z.ScaledDirection=6]="ScaledDirection",z[z.Scale=7]="Scale",z[z.AgeGradient=8]="AgeGradient",z[z.Angle=9]="Angle",z[z.SpriteCellIndex=16]="SpriteCellIndex",z[z.SpriteCellStart=17]="SpriteCellStart",z[z.SpriteCellEnd=18]="SpriteCellEnd"}(Bu||(Bu={})),function(z){z[z.None=0]="None",z[z.Time=1]="Time",z[z.Delta=2]="Delta",z[z.Emitter=3]="Emitter"}(yu||(yu={}));class ou{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let z="";for(const u of this.notConnectedNonOptionalInputs)z+="input ".concat(u.name," from block ").concat(u.ownerBlock.name,"[").concat(u.ownerBlock.getClassName(),"] is not connected and is not optional.\n");if(z)throw"Build of Node Particle System Set failed:\n"+z}adapt(z,u){const U=z.getConnectedValue(this)||0;if(z.type===u)return U;switch(u){case Iu.Vector2:return new J.Vector2(U,U);case Iu.Eu:return new J.Eu(U,U,U);case Iu.wg:return new g.wg(U,U,U,U)}return null}getContextualValue(z){if(!this.particleContext||!this.systemContext)return null;switch(z){case Bu.Position:return this.particleContext.position;case Bu.Direction:return this.particleContext.direction;case Bu.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Bu.Color:return this.particleContext.color;case Bu.Age:return this.particleContext.age;case Bu.Lifetime:return this.particleContext.lifeTime;case Bu.Angle:return this.particleContext.angle;case Bu.Scale:return this.particleContext.scale;case Bu.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Bu.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Bu.SpriteCellIndex:return this.particleContext.cellIndex;case Bu.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.vu.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.vu.absolutePosition:this.systemContext.vu:null}getSystemValue(z){if(!this.particleContext||!this.systemContext)return null;switch(z){case yu.Time:return this.systemContext._actualFrame;case yu.Delta:return this.systemContext._scaledUpdateSpeed;case yu.Emitter:if(this.isEmitterTransformNode){return this.systemContext.vu.absolutePosition}return this.systemContext.vu}return null}}function su(z,u,U){const J=new ou;J.ru=u;const v=z.createSystem(J);return v.canStart=()=>!0,v.vu=U.clone(),v.disposeOnStop=!0,v.start(),v}class lu extends nu{constructor(z){super(z),this.blendMode=P.BLENDMODE_ONEONE,this.MU=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Iu.Particle),this.registerInput("texture",Iu.Texture),this.registerInput("onStart",Iu.System,!0),this.registerInput("onEnd",Iu.System,!0),this.registerOutput("system",Iu.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(z){z.MU=this.MU,z.buildId=this._buildId++,this.build(z);const u=this.particle.getConnectedValue(z);return u.particleTexture=this.texture.getConnectedValue(z),u.emitRate=this.emitRate,u.blendMode=this.blendMode,u.name=this.name,u._nodeGenerated=!0,u._targetStopDuration=this.targetStopDuration,u.startDelay=this.startDelay,this.system._storedValue=this,u.canStart=()=>!this.doNoStart,u.onStartedObservable.add((U=>{const J=this.onStart.getConnectedValue(z);J&&U.onStartedObservable.addOnce((()=>{z.systemContext=u;const U=su(J,z.ru,z.emitterPosition);this.Xf.addOnce((()=>{U.dispose()}))}));const v=this.onEnd.getConnectedValue(z);v&&U.onStoppedObservable.addOnce((()=>{z.systemContext=u;const U=su(v,z.ru,z.emitterPosition);this.Xf.addOnce((()=>{U.dispose()}))}))})),this.Xf.addOnce((()=>{u.dispose()})),u}serialize(){const z=super.serialize();return z.MU=this.MU,z.emitRate=this.emitRate,z.blendMode=this.blendMode,z.doNoStart=this.doNoStart,z.targetStopDuration=this.targetStopDuration,z.startDelay=this.startDelay,z}_deserialize(z){super._deserialize(z),this.MU=z.MU,this.emitRate=z.emitRate,this.doNoStart=!!z.doNoStart,void 0!==z.blendMode&&(this.blendMode=z.blendMode),void 0!==z.targetStopDuration&&(this.targetStopDuration=z.targetStopDuration),void 0!==z.startDelay&&(this.startDelay=z.startDelay)}}(0,N.b)([qu("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:P.BLENDMODE_ONEONE},{label:"Standard",value:P.BLENDMODE_STANDARD},{label:"Add",value:P.BLENDMODE_ADD},{label:"Multiply",value:P.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:P.BLENDMODE_MULTIPLYADD}]})],lu.prototype,"blendMode",void 0),(0,N.b)([qu("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],lu.prototype,"MU",void 0),(0,N.b)([qu("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lu.prototype,"emitRate",void 0),(0,N.b)([qu("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lu.prototype,"targetStopDuration",void 0),(0,N.b)([qu("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lu.prototype,"startDelay",void 0),(0,N.b)([qu("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],lu.prototype,"doNoStart",void 0),(0,w.f)("BABYLON.SystemBlock",lu);class eu extends nu{get type(){if(this._type===Iu.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Iu.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Iu.Vector2,this._type;case"Eu":return this._type=Iu.Eu,this._type;case"wg":return this._type=Iu.wg,this._type;case"Matrix":return this._type=Iu.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Bu.None&&this._systemSource!==yu.None}get systemSource(){return this._systemSource}set systemSource(z){if(this._systemSource=z,z!==yu.None){switch(this._contextualSource=Bu.None,this._type=Iu.Float,z){case yu.Time:case yu.Delta:this._type=Iu.Float;break;case yu.Emitter:this._type=Iu.Eu}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Bu.None}get contextualValue(){return this._contextualSource}set contextualValue(z){if(this._contextualSource=z,z!==Bu.None){switch(this._systemSource=yu.None,z){case Bu.Scale:this._type=Iu.Vector2;break;case Bu.Position:case Bu.Direction:case Bu.ScaledDirection:this._type=Iu.Eu;break;case Bu.Color:this._type=Iu.wg;break;case Bu.Age:case Bu.Lifetime:case Bu.Angle:case Bu.AgeGradient:this._type=Iu.Float;break;case Bu.SpriteCellEnd:case Bu.SpriteCellStart:case Bu.SpriteCellIndex:this._type=Iu.Int}this.output&&(this.output.type=this._type)}}constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Iu.AutoDetect;super(z),this._type=Iu.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new s.e,this._systemSource=yu.None,this._contextualSource=Bu.None,this._type=u,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",u)}get value(){return this._storedValue}set value(z){this.type===Iu.Float&&this.min!==this.max&&(z=Math.max(this.min,z),z=Math.min(this.max,z)),this._storedValue=z,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(z){this._valueCallback=z}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Iu.Int:case Iu.Float:this.value=0;break;case Iu.Vector2:this.value=J.Vector2.Zero();break;case Iu.Eu:this.value=J.Eu.Zero();break;case Iu.wg:this.value=new g.wg(1,1,1,1);break;case Iu.Matrix:this.value=J.Matrix.Identity()}}_build(z){super._build(z),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=z=>z.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=z=>z.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const z=super.serialize();return z.type=this.type,z.contextualValue=this.contextualValue,z.systemSource=this.systemSource,z.min=this.min,z.max=this.max,z.groupInInspector=this.groupInInspector,z.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.jf?(z.valueType="BABYLON."+this._storedValue.getClassName(),z.value=this._storedValue.jf()):(z.valueType="number",z.value=this._storedValue)),z}_deserialize(z){if(super._deserialize(z),this._type=z.type,this.contextualValue=z.contextualValue,this.systemSource=z.systemSource||yu.None,this.min=z.min||0,this.max=z.max||0,this.groupInInspector=z.groupInInspector||"",void 0!==z.displayInInspector&&(this.displayInInspector=z.displayInInspector),z.valueType)if("number"===z.valueType)this._storedValue=z.value;else{const u=(0,w.e)(z.valueType);u&&(this._storedValue=u.Xu(z.value))}}}(0,w.f)("BABYLON.ParticleInputBlock",eu);class zU extends nu{get url(){return this._url}set url(z){this._url!==z&&(this._cachedData=null,this._url=z,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(z){this._textureDataUrl!==z&&(this._cachedData=null,this._textureDataUrl=z,this._url="",this._sourceTexture=null)}set sourceTexture(z){this._sourceTexture!==z&&(this._cachedData=null,this._sourceTexture=z,this._url="",this._textureDataUrl="")}constructor(z){super(z),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Iu.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const z=this.texture._storedValue;return await new Promise(((u,U)=>{if(!z.isReady())return void z.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),u(this._cachedData)}catch(z){U(z)}}));const J=z.getSize();Nu.k.GetTextureDataAsync(z,J.width,J.height).then((U=>{this._cachedData={width:J.width,height:J.height,data:new Uint8ClampedArray(U)},z.dispose(),u(this._cachedData)})).catch(U)}))}_build(z){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new W.e(this._textureDataUrl,z.ru):this.texture._storedValue=new W.e(this._url,z.ru):this.texture._storedValue=null}serialize(){const z=super.serialize();return z.url=this.url,z.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(z.textureDataUrl=this.textureDataUrl),z}_deserialize(z){super._deserialize(z),this.url=z.url,this.serializedCachedData=!!z.serializedCachedData,z.textureDataUrl&&(this.textureDataUrl=z.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,w.f)("BABYLON.ParticleTextureSourceBlock",zU);class uU extends nu{constructor(z){super(z),this.registerInput("particle",Iu.Particle),this.registerInput("position",Iu.Eu),this.registerOutput("output",Iu.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(z){const u=this.particle.getConnectedValue(z);if(this.output._storedValue=u,!this.position.isConnected)return;const U={process:U=>{z.particleContext=U,z.systemContext=u,U.position.v(this.position.getConnectedValue(z))},previousItem:null,nextItem:null};u._updateQueueStart?yz(U,u._updateQueueStart):u._updateQueueStart=U}}(0,w.f)("BABYLON.UpdatePositionBlock",uU),function(z){z[z.Add=0]="Add",z[z.Subtract=1]="Subtract",z[z.Multiply=2]="Multiply",z[z.Divide=3]="Divide",z[z.Max=4]="Max",z[z.Min=5]="Min"}(Hu||(Hu={}));class UU extends nu{constructor(z){super(z),this.operation=Hu.Add,this.registerInput("left",Iu.AutoDetect),this.registerInput("right",Iu.AutoDetect),this.registerOutput("output",Iu.BasedOnInput),this.output._typeConnectionSource=this.left;const u=[Iu.Matrix,Iu.Particle,Iu.Texture,Iu.System,Iu.FloatGradient,Iu.Color4Gradient,Iu.Vector2Gradient,Iu.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...u),this.right.excludedConnectionPointTypes.push(...u),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(z){let u;const U=this.left,v=this.right;if(!U.isConnected||!v.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const f=U.type===Iu.Float||U.type===Iu.Int,w=v.type===Iu.Float||v.type===Iu.Int,P=f&&w;switch(this.operation){case Hu.Add:u=P?z=>U.getConnectedValue(z)+v.getConnectedValue(z):f?z=>z.adapt(U,v.type).add(v.getConnectedValue(z)):z=>U.getConnectedValue(z).add(z.adapt(v,U.type));break;case Hu.Subtract:u=P?z=>U.getConnectedValue(z)-v.getConnectedValue(z):f?z=>z.adapt(U,v.type).Cu(v.getConnectedValue(z)):z=>U.getConnectedValue(z).Cu(z.adapt(v,U.type));break;case Hu.Multiply:u=P?z=>U.getConnectedValue(z)*v.getConnectedValue(z):f?z=>z.adapt(U,v.type).multiply(v.getConnectedValue(z)):z=>U.getConnectedValue(z).multiply(z.adapt(v,U.type));break;case Hu.Divide:u=P?z=>U.getConnectedValue(z)/v.getConnectedValue(z):f?z=>z.adapt(U,v.type).divide(v.getConnectedValue(z)):z=>U.getConnectedValue(z).divide(z.adapt(v,U.type));break;case Hu.Min:if(P)u=z=>Math.min(U.getConnectedValue(z),v.getConnectedValue(z));else{const[z,w]=f?[v,U]:[U,v];switch(z.type){case Iu.Vector2:u=u=>J.Vector2.Minimize(z.getConnectedValue(u),u.adapt(w,z.type));break;case Iu.Eu:u=u=>J.Eu.Minimize(z.getConnectedValue(u),u.adapt(w,z.type));break;case Iu.wg:u=u=>{const U=z.getConnectedValue(u),{r:J,g:v,b:f,a:P}=u.adapt(w,z.type);return new g.wg(Math.min(U.r,J),Math.min(U.g,v),Math.min(U.b,f),Math.min(U.a,P))}}}break;case Hu.Max:if(!P){const[z,w]=f?[v,U]:[U,v];switch(z.type){case Iu.Vector2:u=u=>J.Vector2.Maximize(z.getConnectedValue(u),u.adapt(w,z.type));break;case Iu.Eu:u=u=>J.Eu.Maximize(z.getConnectedValue(u),u.adapt(w,z.type));break;case Iu.wg:u=u=>{const U=z.getConnectedValue(u),{r:J,g:v,b:f,a:P}=u.adapt(w,z.type);return new g.wg(Math.max(U.r,J),Math.min(U.g,v),Math.min(U.b,f),Math.min(U.a,P))}}break}u=z=>Math.max(U.getConnectedValue(z),v.getConnectedValue(z))}this.output._storedFunction=z=>U.type===Iu.Int?0|u(z):u(z)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Iu.Int||this.left.type===Iu.Float&&this.right.type!==Iu.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[z,u]of[[this.left,this.right],[this.right,this.left]])z.acceptedConnectionPointTypes=[Iu.Int,Iu.Float],u.isConnected&&(z.acceptedConnectionPointTypes.push(u.type),u.type!==Iu.Int&&u.type!==Iu.Float||z.acceptedConnectionPointTypes.push(Iu.Vector2,Iu.Eu,Iu.wg))}dispose(){super.dispose();for(const z of this._connectionObservers)z.remove();this._connectionObservers.length=0}serialize(){const z=super.serialize();return z.operation=this.operation,z}_deserialize(z){super._deserialize(z),this.operation=z.operation}}(0,N.b)([qu("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Hu.Add},{label:"Subtract",value:Hu.Subtract},{label:"Multiply",value:Hu.Multiply},{label:"Divide",value:Hu.Divide},{label:"Max",value:Hu.Max},{label:"Min",value:Hu.Min}]})],UU.prototype,"operation",void 0),(0,w.f)("BABYLON.ParticleMathBlock",UU);class JU extends nu{constructor(z){super(z),this.registerInput("particle",Iu.Particle),this.registerInput("direction1",Iu.Eu,!0,new J.Eu(0,1,0)),this.registerInput("direction2",Iu.Eu,!0,new J.Eu(0,1,0)),this.registerInput("minEmitBox",Iu.Eu,!0,new J.Eu(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Iu.Eu,!0,new J.Eu(.5,.5,.5)),this.registerOutput("output",Iu.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(z){const u=this.particle.getConnectedValue(z);u._directionCreation.process=U=>{z.particleContext=U,z.systemContext=u;const v=this.direction1.getConnectedValue(z),f=this.direction2.getConnectedValue(z),g=(0,R.RandomRange)(v.x,f.x),w=(0,R.RandomRange)(v.y,f.y),P=(0,R.RandomRange)(v.z,f.z);z.isEmitterTransformNode?J.Eu.TransformNormalFromFloatsToRef(g,w,P,z.emitterWorldMatrix,U.direction):U.direction.zg(g,w,P)},u._positionCreation.process=U=>{z.particleContext=U,z.systemContext=u;const v=this.minEmitBox.getConnectedValue(z),f=this.maxEmitBox.getConnectedValue(z),g=(0,R.RandomRange)(v.x,f.x),w=(0,R.RandomRange)(v.y,f.y),P=(0,R.RandomRange)(v.z,f.z);z.isEmitterTransformNode?J.Eu.TransformCoordinatesFromFloatsToRef(g,w,P,z.emitterWorldMatrix,U.position):(U.position.zg(g,w,P),U.position.addInPlace(z.emitterPosition))},this.output._storedValue=u}}(0,w.f)("BABYLON.BoxShapeBlock",JU);class vU extends nu{constructor(z){super(z),this.registerInput("emitPower",Iu.Float,!0,1),this.registerInput("lifeTime",Iu.Float,!0,1),this.registerInput("color",Iu.wg,!0,new g.wg(1,1,1,1)),this.registerInput("scale",Iu.Vector2,!0,new J.Vector2(1,1)),this.registerInput("angle",Iu.Float,!0,0),this.registerOutput("particle",Iu.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(z){const u=new Pu(this.name,z.MU,z.ru,null,!1,void 0,!0);u.particleEmitterType=new r,u._lifeTimeCreation.process=(u,U)=>{z.particleContext=u,u.lifeTime=this.lifeTime.getConnectedValue(z),U._emitPower=this.emitPower.getConnectedValue(z)},u._colorCreation.process=u=>{z.particleContext=u,u.color.v(this.color.getConnectedValue(z))},u._sizeCreation.process=u=>{z.particleContext=u,u.size=1,u.scale.v(this.scale.getConnectedValue(z))},u._angleCreation.process=u=>{z.particleContext=u,u.angle=this.angle.getConnectedValue(z)},this.particle._storedValue=u}}(0,w.f)("BABYLON.CreateParticleBlock",vU);class fU{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const z=[];for(const u of this.attachedBlocks)u.isInput&&z.push(u);return z}constructor(z){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new s.e,this.name=z}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(z)&&this.attachedBlocks.push(z);for(const U of z.inputs){const J=U.connectedPoint;if(J){const U=J.ownerBlock;U!==z&&this._initializeBlock(U,u)}}}async buildAsync(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((U=>{const J=new Lu;for(const z of this._systemBlocks)this._initializeBlock(z);for(const v of this.systemBlocks){const U=new ou;U.buildId=this._buildId++,U.ru=z,U.verbose=u;const f=v.createSystem(U);U.emitErrors(),J.systems.push(f)}this.onBuildObservable.notifyObservers(this),U(J)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const z=new lu("Particle system"),u=new uU("Update position");u.output.connectTo(z.particle);const U=new eu("Position");U.contextualValue=Bu.Position;const J=new eu("Scaled direction");J.contextualValue=Bu.ScaledDirection;const v=new UU("Add");v.operation=Hu.Add,U.output.connectTo(v.left),J.output.connectTo(v.right),v.output.connectTo(u.position);const f=new vU("Create particle"),g=new JU("Box shape");f.particle.connectTo(g.particle),g.output.connectTo(u.particle);const w=new zU("Texture");w.texture.connectTo(z.texture),w.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(z)}removeBlock(z){const u=this.attachedBlocks.indexOf(z);if(u>-1&&this.attachedBlocks.splice(u,1),z.isSystem){const u=this._systemBlocks.indexOf(z);u>-1&&this._systemBlocks.splice(u,1)}}parseSerializedObject(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u||this.clear();const U={};for(const J of z.nS){const z=(0,w.e)(J.customType);if(z){const u=new z;u._deserialize(J),U[J.id]=u,this.attachedBlocks.push(u),u.isSystem&&this._systemBlocks.push(u)}}for(const J of this.attachedBlocks)if(J.isTeleportOut){const z=J,u=z._tempEntryPointUniqueId;if(u){const J=U[u];J&&J.attachToEndpoint(z)}}for(let J=0;J<z.nS.length;J++){const v=z.nS[J],f=U[v.id];f&&(f.inputs.length&&v.inputs.some((z=>z.targetConnectionName))&&!u||this._restoreConnections(f,z,U))}if(z.locations||z.editorData&&z.editorData.locations){const J=z.locations||z.editorData.locations;for(const z of J)U[z.yU]&&(z.yU=U[z.yU].uniqueId);u&&this.editorData&&this.editorData.locations&&J.concat(this.editorData.locations),z.locations?this.editorData={locations:J}:(this.editorData=z.editorData,this.editorData.locations=J);const v=[];for(const z in U)v[z]=U[z].uniqueId;this.editorData.map=v}this.comment=z.comment}_restoreConnections(z,u,U){for(const J of z.outputs)for(const v of u.nS){const f=U[v.id];if(f)for(const g of v.inputs)if(U[g.targetBlockId]!==z||g.targetConnectionName!==J.name);else{const z=f.getInputByName(g.inputName);if(!z||z.isConnected)continue;J.connectTo(z,!0),this._restoreConnections(f,u,U)}}}serialize(z){const u=z?{}:c.b.Serialize(this);u.editorData=JSON.parse(JSON.stringify(this.editorData));let U=[];z?U=z:u.customType="BABYLON.NodeParticleSystemSet",u.nS=[];for(const J of U)u.nS.push(J.serialize());if(!z)for(const J of this.attachedBlocks)-1===U.indexOf(J)&&u.nS.push(J.serialize());return u}dispose(){for(const z of this.attachedBlocks)z.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(z){const u=new fU(z);return u.setToDefault(),u}static Parse(z){const u=c.b.Parse((()=>new fU(z.name)),z,null);return u.parseSerializedObject(z),u}static ParseFromSnippetAsync(z,u){return"_BLANK"===z?Promise.resolve(fU.CreateDefault("blank")):new Promise(((U,J)=>{const v=new Ou.b;v.addEventListener("readystatechange",(()=>{if(4==v.readyState)if(200==v.status){const g=JSON.parse(JSON.parse(v.responseText).jsonPayload),w=JSON.parse(g.nodeParticle);u||(u=c.b.Parse((()=>new fU(z)),w,null)),u.parseSerializedObject(w),u.snippetId=z;try{U(u)}catch(f){J(f)}}else J("Unable to load the snippet "+z)})),v.open("GET",this.SnippetUrl+"/"+z.replace(/#/g,"/")),v.send()}))}}fU.EditorURL="".concat(hu.Tools._DefaultCdnUrl,"/v").concat(qz.b.Version,"/nodeParticleEditor/babylon.nodeParticleEditor.js"),fU.SnippetUrl="https://snippet.babylonjs.com",(0,N.b)([(0,D.K)()],fU.prototype,"name",void 0),(0,N.b)([(0,D.K)("comment")],fU.prototype,"comment",void 0),function(z){z[z.None=0]="None",z[z.PerParticle=1]="PerParticle",z[z.PerSystem=2]="PerSystem"}(Gu||(Gu={}));class gU extends nu{constructor(z){super(z),this._currentLockId=-2,this.lockMode=Gu.PerParticle,this.registerInput("min",Iu.AutoDetect,!0,0),this.registerInput("max",Iu.AutoDetect,!0,1),this.registerOutput("output",Iu.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Iu.Float|Iu.Int|Iu.Vector2|Iu.Eu|Iu.wg),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Iu.Float|Iu.Int|Iu.Vector2|Iu.Eu|Iu.wg),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Iu.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let z=null;switch(this._currentLockId=-2,this.min.type){case Iu.AutoDetect:case Iu.Int:case Iu.Float:z=z=>{const u=this.min.getConnectedValue(z)||0,U=this.max.getConnectedValue(z)||1;return u+Math.random()*(U-u)};break;case Iu.Vector2:z=z=>{const u=this.min.getConnectedValue(z)||J.Vector2.Zero(),U=this.max.getConnectedValue(z)||J.Vector2.One();return new J.Vector2(u.x+Math.random()*(U.x-u.x),u.y+Math.random()*(U.y-u.y))};break;case Iu.Eu:z=z=>{const u=this.min.getConnectedValue(z)||J.Eu.Zero(),U=this.max.getConnectedValue(z)||J.Eu.One();return new J.Eu(u.x+Math.random()*(U.x-u.x),u.y+Math.random()*(U.y-u.y),u.z+Math.random()*(U.z-u.z))};break;case Iu.wg:z=z=>{const u=this.min.getConnectedValue(z)||new g.wg(0,0,0,0),U=this.max.getConnectedValue(z)||new g.wg(1,1,1,1);return new g.wg(u.x+Math.random()*(U.x-u.x),u.y+Math.random()*(U.y-u.y),u.z+Math.random()*(U.z-u.z),u.w+Math.random()*(U.w-u.w))}}this.output._storedFunction=u=>{var U;let J=0;switch(this.lockMode){case Gu.PerParticle:J=(null===(U=u.particleContext)||void 0===U?void 0:U.id)||-1;break;case Gu.PerSystem:J=u.buildId||0}return this._currentLockId!==J&&(this.lockMode!==Gu.None&&(this._currentLockId=J),this.output._storedValue=z(u)),this.output._storedValue}}serialize(){const z=super.serialize();return z.lockMode=this.lockMode,z}_deserialize(z){super._deserialize(z),this.lockMode=z.lockMode}}(0,N.b)([qu("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Gu.None},{label:"Per particle",value:Gu.PerParticle},{label:"Per system",value:Gu.PerSystem}]})],gU.prototype,"lockMode",void 0),(0,w.f)("BABYLON.ParticleRandomBlock",gU);class wU extends nu{constructor(z){super(z),this._currentLockId=-2,this.lockMode=Gu.PerParticle,this.registerInput("min",Iu.AutoDetect),this.registerInput("max",Iu.AutoDetect),this.registerOutput("output",Iu.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const u=[Iu.Matrix,Iu.Particle,Iu.Texture,Iu.System,Iu.FloatGradient,Iu.Color4Gradient,Iu.Vector2Gradient,Iu.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...u),this.max.excludedConnectionPointTypes.push(...u)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let z=null;switch(this._currentLockId=-2,this.min.type){case Iu.Float:case Iu.Int:z=z=>{const u=this.min.getConnectedValue(z),U=this.max.getConnectedValue(z);return Math.random()*(U-u)+u};break;case Iu.Vector2:z=z=>{const u=this.min.getConnectedValue(z),U=this.max.getConnectedValue(z);return new J.Vector2(Math.random()*(U.x-u.x)+u.x,Math.random()*(U.y-u.y)+u.y)};break;case Iu.Eu:z=z=>{const u=this.min.getConnectedValue(z),U=this.max.getConnectedValue(z);return new J.Eu(Math.random()*(U.x-u.x)+u.x,Math.random()*(U.y-u.y)+u.y,Math.random()*(U.z-u.z)+u.z)};break;case Iu.wg:z=z=>{const u=this.min.getConnectedValue(z),U=this.max.getConnectedValue(z);return new g.wg(Math.random()*(U.r-u.r)+u.r,Math.random()*(U.g-u.g)+u.g,Math.random()*(U.b-u.b)+u.b,Math.random()*(U.a-u.a)+u.a)}}this.output._storedFunction=u=>{var U;let J=0;switch(this.lockMode){case Gu.PerParticle:J=(null===(U=u.particleContext)||void 0===U?void 0:U.id)||-1;break;case Gu.PerSystem:J=u.buildId||0}return this._currentLockId!==J&&(this.lockMode!==Gu.None&&(this._currentLockId=J),this.output._storedValue=z(u)),this.output._storedValue}}serialize(){const z=super.serialize();return z.lockMode=this.lockMode,z}_deserialize(z){super._deserialize(z),void 0!==z.lockMode&&(this.lockMode=z.lockMode)}}(0,N.b)([qu("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Gu.None},{label:"Per particle",value:Gu.PerParticle},{label:"Per system",value:Gu.PerSystem}]})],wU.prototype,"lockMode",void 0),(0,w.f)("BABYLON.RandomRangeBlock",wU);(0,w.f)("BABYLON.ParticleLerpBlock",class extends nu{constructor(z){super(z),this.registerInput("left",Iu.AutoDetect),this.registerInput("right",Iu.AutoDetect),this.registerInput("gradient",Iu.Float,!0,0,0,1),this.registerOutput("output",Iu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Iu.Float|Iu.Int|Iu.Vector2|Iu.Eu|Iu.wg)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const z=(z,u,U)=>(1-z)*u+z*U;this.output._storedFunction=u=>{const U=this.left.getConnectedValue(u),v=this.right.getConnectedValue(u),f=this.gradient.getConnectedValue(u);switch(this.left.type){case Iu.Int:case Iu.Float:return z(f,U,v);case Iu.Vector2:return new J.Vector2(z(f,U.x,v.x),z(f,U.y,v.y));case Iu.Eu:return new J.Eu(z(f,U.x,v.x),z(f,U.y,v.y),z(f,U.z,v.z));case Iu.wg:return new g.wg(z(f,U.r,v.r),z(f,U.g,v.g),z(f,U.b,v.b),z(f,U.a,v.a))}return 0}}});(0,w.f)("BABYLON.UpdateDirectionBlock",class extends nu{constructor(z){super(z),this.registerInput("particle",Iu.Particle),this.registerInput("direction",Iu.Eu),this.registerOutput("output",Iu.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(z){const u=this.particle.getConnectedValue(z);if(this.output._storedValue=u,!this.direction.isConnected)return;const U={process:U=>{z.particleContext=U,z.systemContext=u,U.direction.v(this.direction.getConnectedValue(z))},previousItem:null,nextItem:null};u._updateQueueStart?yz(U,u._updateQueueStart):u._updateQueueStart=U}});(0,w.f)("BABYLON.UpdateColorBlock",class extends nu{constructor(z){super(z),this.registerInput("particle",Iu.Particle),this.registerInput("color",Iu.wg),this.registerOutput("output",Iu.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(z){const u=this.particle.getConnectedValue(z);if(this.output._storedValue=u,!this.color.isConnected)return;const U={process:U=>{z.particleContext=U,z.systemContext=u,U.color.v(this.color.getConnectedValue(z))},previousItem:null,nextItem:null};u._updateQueueStart?yz(U,u._updateQueueStart):u._updateQueueStart=U}});(0,w.f)("BABYLON.UpdateScaleBlock",class extends nu{constructor(z){super(z),this.registerInput("particle",Iu.Particle),this.registerInput("scale",Iu.Vector2),this.registerOutput("output",Iu.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(z){const u=this.particle.getConnectedValue(z);if(this.output._storedValue=u,!this.scale.isConnected)return;const U={process:U=>{z.particleContext=U,z.systemContext=u,U.scale.v(this.scale.getConnectedValue(z))},previousItem:null,nextItem:null};u._updateQueueStart?yz(U,u._updateQueueStart):u._updateQueueStart=U}});(0,w.f)("BABYLON.UpdateAngleBlock",class extends nu{constructor(z){super(z),this.registerInput("particle",Iu.Particle),this.registerInput("angle",Iu.Float),this.registerOutput("output",Iu.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(z){const u=this.particle.getConnectedValue(z);if(this.output._storedValue=u,!this.angle.isConnected)return;const U={process:U=>{z.particleContext=U,z.systemContext=u,U.angle=this.angle.getConnectedValue(z)},previousItem:null,nextItem:null};u._updateQueueStart?yz(U,u._updateQueueStart):u._updateQueueStart=U}});(0,w.f)("BABYLON.BasicPositionUpdateBlock",class extends nu{constructor(z){super(z),this.registerInput("particle",Iu.Particle),this.registerOutput("output",Iu.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(z){const u=this.particle.getConnectedValue(z),U={process:U=>{z.particleContext=U,z.systemContext=u,U.direction.scaleToRef(u._directionScale,u._scaledDirection),U.position.addInPlace(u._scaledDirection)},previousItem:null,nextItem:null};u._updateQueueStart?yz(U,u._updateQueueStart):u._updateQueueStart=U,this.output._storedValue=u}});(0,w.f)("BABYLON.BasicSpriteUpdateBlock",class extends nu{constructor(z){super(z),this.registerInput("particle",Iu.Particle),this.registerOutput("output",Iu.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(z){const u=this.particle.getConnectedValue(z),U={process:U=>{z.particleContext=U,z.systemContext=u,U.updateCellIndex()},previousItem:null,nextItem:null};u._updateQueueStart?yz(U,u._updateQueueStart):u._updateQueueStart=U,this.output._storedValue=u}});(0,w.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends nu{constructor(z){super(z),this.registerInput("particle",Iu.Particle),this.registerInput("cellIndex",Iu.Int),this.registerOutput("output",Iu.Particle),this.cellIndex.acceptedConnectionPointTypes=[Iu.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(z){const u=this.particle.getConnectedValue(z);if(this.output._storedValue=u,!this.cellIndex.isConnected)return;const U={process:U=>{z.particleContext=U,z.systemContext=u,U.cellIndex=Math.floor(this.cellIndex.getConnectedValue(z))},previousItem:null,nextItem:null};u._updateQueueStart?yz(U,u._updateQueueStart):u._updateQueueStart=U}});class PU extends nu{constructor(z){super(z),this.strength=1,this.registerInput("particle",Iu.Particle),this.registerInput("flowMap",Iu.Texture),this.registerOutput("output",Iu.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(z){var u;const U=this.particle.getConnectedValue(z),J=z.ru;let v;(null===(u=this.flowMap.connectedPoint)||void 0===u?void 0:u.ownerBlock).extractTextureContentAsync().then((z=>{z&&(v=new ju(z.width,z.height,z.data))}));const f={process:z=>{const u=J.getTransformMatrix();v&&v._processParticle(z,this.strength*U._tempScaledUpdateSpeed,u)},previousItem:null,nextItem:null};U._updateQueueStart?yz(f,U._updateQueueStart):U._updateQueueStart=f,this.output._storedValue=U}serialize(){const z=super.serialize();return z.strength=this.strength,z}_deserialize(z){super._deserialize(z),this.strength=z.strength}}(0,N.b)([qu("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PU.prototype,"strength",void 0),(0,w.f)("BABYLON.UpdateFlowMapBlock",PU);(0,w.f)("BABYLON.SphereShapeBlock",class extends nu{constructor(z){super(z),this.registerInput("input",Iu.Particle),this.registerInput("radius",Iu.Float,!0,1),this.registerInput("radiusRange",Iu.Float,!0,1,0,1),this.registerInput("directionRandomizer",Iu.Float,!0,0,0,1),this.registerOutput("output",Iu.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(z){const u=this.input.getConnectedValue(z);u._directionCreation.process=U=>{z.particleContext=U,z.systemContext=u;const v=this.directionRandomizer.getConnectedValue(z),f=U.position.Cu(z.emitterPosition).normalize(),g=(0,R.RandomRange)(0,v),w=(0,R.RandomRange)(0,v),P=(0,R.RandomRange)(0,v);f.x+=g,f.y+=w,f.z+=P,f.normalize(),z.isEmitterTransformNode?J.Eu.TransformNormalFromFloatsToRef(g,w,P,z.emitterWorldMatrix,U.direction):U.direction.zg(g,w,P)},u._positionCreation.process=U=>{z.particleContext=U,z.systemContext=u;const v=this.radius.getConnectedValue(z),f=this.radiusRange.getConnectedValue(z),g=v-(0,R.RandomRange)(0,v*f),w=(0,R.RandomRange)(0,1),P=(0,R.RandomRange)(0,2*Math.PI),S=Math.acos(2*w-1),d=g*Math.cos(P)*Math.sin(S),mz=g*Math.cos(S),Z=g*Math.sin(P)*Math.sin(S);z.isEmitterTransformNode?J.Eu.TransformCoordinatesFromFloatsToRef(d,mz,Z,z.emitterWorldMatrix,U.position):(U.position.zg(d,mz,Z),U.position.addInPlace(z.emitterPosition))},this.output._storedValue=u}});(0,w.f)("BABYLON.PointShapeBlock",class extends nu{constructor(z){super(z),this.registerInput("particle",Iu.Particle),this.registerInput("direction1",Iu.Eu,!0,new J.Eu(0,1,0)),this.registerInput("direction2",Iu.Eu,!0,new J.Eu(0,1,0)),this.registerOutput("output",Iu.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(z){const u=this.particle.getConnectedValue(z);u._directionCreation.process=U=>{z.particleContext=U,z.systemContext=u;const v=this.direction1.getConnectedValue(z),f=this.direction2.getConnectedValue(z),g=(0,R.RandomRange)(v.x,f.x),w=(0,R.RandomRange)(v.y,f.y),P=(0,R.RandomRange)(v.z,f.z);z.isEmitterTransformNode?J.Eu.TransformNormalFromFloatsToRef(g,w,P,z.emitterWorldMatrix,U.direction):U.direction.zg(g,w,P)},u._positionCreation.process=U=>{z.systemContext=u,z.isEmitterTransformNode?J.Eu.TransformCoordinatesFromFloatsToRef(0,0,0,z.emitterWorldMatrix,U.position):U.position.v(z.emitterPosition)},this.output._storedValue=u}});(0,w.f)("BABYLON.CustomShapeBlock",class extends nu{constructor(z){super(z),this.registerInput("particle",Iu.Particle),this.registerInput("position",Iu.Eu,!0,new J.Eu(0,0,0)),this.registerInput("direction",Iu.Eu,!0,new J.Eu(0,1,0)),this.registerOutput("output",Iu.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(z){const u=this.particle.getConnectedValue(z);u._directionCreation.process=U=>{z.particleContext=U,z.systemContext=u;const v=this.direction.getConnectedValue(z);z.isEmitterTransformNode?J.Eu.TransformNormalToRef(v,z.emitterWorldMatrix,U.direction):U.direction.v(v)},u._positionCreation.process=U=>{z.particleContext=U,z.systemContext=u;const v=this.position.getConnectedValue(z);z.isEmitterTransformNode?J.Eu.TransformCoordinatesToRef(v,z.emitterWorldMatrix,U.position):(U.position.v(v),U.position.addInPlace(z.emitterPosition))},this.output._storedValue=u}});(0,w.f)("BABYLON.CylinderShapeBlock",class extends nu{constructor(z){super(z),this._tempVector=J.Eu.Zero(),this.registerInput("particle",Iu.Particle),this.registerInput("radius",Iu.Float,!0,1),this.registerInput("height",Iu.Float,!0,1,0),this.registerInput("radiusRange",Iu.Float,!0,1,0,1),this.registerInput("directionRandomizer",Iu.Float,!0,0,0,1),this.registerOutput("output",Iu.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(z){const u=this.particle.getConnectedValue(z);u._directionCreation.process=U=>{z.particleContext=U,z.systemContext=u;const v=this.directionRandomizer.getConnectedValue(z);U.position.subtractToRef(z.emitterPosition,this._tempVector),this._tempVector.normalize(),z.isEmitterTransformNode&&J.Eu.TransformNormalToRef(this._tempVector,z.emitterInverseWorldMatrix,this._tempVector);const f=(0,R.RandomRange)(-v/2,v/2);let g=Math.atan2(this._tempVector.x,this._tempVector.z);g+=(0,R.RandomRange)(-Math.PI/2,Math.PI/2)*v,this._tempVector.y=f,this._tempVector.x=Math.sin(g),this._tempVector.z=Math.cos(g),this._tempVector.normalize(),z.isEmitterTransformNode?J.Eu.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,z.emitterWorldMatrix,U.direction):U.direction.v(this._tempVector)},u._positionCreation.process=U=>{z.particleContext=U,z.systemContext=u;const v=this.height.getConnectedValue(z),f=this.radiusRange.getConnectedValue(z),g=this.radius.getConnectedValue(z),w=(0,R.RandomRange)(-v/2,v/2),P=(0,R.RandomRange)(0,2*Math.PI),S=(0,R.RandomRange)((1-f)*(1-f),1),d=Math.sqrt(S)*g,mz=d*Math.cos(P),Z=d*Math.sin(P);z.isEmitterTransformNode?J.Eu.TransformCoordinatesFromFloatsToRef(mz,w,Z,z.emitterWorldMatrix,U.position):(U.position.zg(mz,w,Z),U.position.addInPlace(z.emitterPosition))},this.output._storedValue=u}});class RU extends nu{constructor(z){super(z),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Iu.Particle),this.registerOutput("output",Iu.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(z){super._build(z);const u=this.particle.getConnectedValue(z);u._isAnimationSheetEnabled=!0,u.spriteCellWidth=this.width,u.spriteCellHeight=this.height,u.startSpriteCellID=this.start,u.endSpriteCellID=this.end,u.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=u}serialize(){const z=super.serialize();return z.width=this.width,z.height=this.height,z.start=this.start,z.end=this.end,z.randomStartCell=this.randomStartCell,z}_deserialize(z){super._deserialize(z),this.width=z.width,this.height=z.height,this.start=z.start,this.end=z.end,this.randomStartCell=z.randomStartCell}}(0,N.b)([qu("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],RU.prototype,"start",void 0),(0,N.b)([qu("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],RU.prototype,"end",void 0),(0,N.b)([qu("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],RU.prototype,"width",void 0),(0,N.b)([qu("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],RU.prototype,"height",void 0),(0,N.b)([qu("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],RU.prototype,"loop",void 0),(0,N.b)([qu("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],RU.prototype,"randomStartCell",void 0),(0,w.f)("BABYLON.SetupSpriteSheetBlock",RU);class SU extends nu{constructor(z){super(z),this.reference=0,this.registerInput("value",Iu.AutoDetect),this.registerOutput("output",Iu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=z=>{switch(z){case Iu.Float:return Iu.FloatGradient;case Iu.Vector2:return Iu.Vector2Gradient;case Iu.Eu:return Iu.Vector3Gradient;case Iu.wg:return Iu.Color4Gradient}return z},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Iu.Float|Iu.Vector2|Iu.Eu|Iu.wg)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=z=>null}serialize(){const z=super.serialize();return z.reference=this.reference,z}_deserialize(z){super._deserialize(z),this.reference=z.reference}}(0,N.b)([qu("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],SU.prototype,"reference",void 0),(0,w.f)("BABYLON.ParticleGradientValueBlock",SU);(0,w.f)("BABYLON.ParticleGradientBlock",class extends nu{constructor(z){super(z),this._entryCount=1,this.registerInput("gradient",Iu.Float,!0,1,0,1),this.registerInput("value0",Iu.AutoDetect),this.registerOutput("output",Iu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=z=>{switch(z){case Iu.FloatGradient:return Iu.Float;case Iu.Vector2Gradient:return Iu.Vector2;case Iu.Vector3Gradient:return Iu.Eu;case Iu.Color4Gradient:return Iu.wg}return z},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Iu.FloatGradient|Iu.Vector2Gradient|Iu.Vector3Gradient|Iu.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(z){this._inputs[z].onConnectionObservable.add((()=>{this._entryCount>z||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Iu.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const z=[];for(let U=1;U<this._inputs.length;U++){var u;if(this._inputs[U].isConnected)z.push(null===(u=this._inputs[U].connectedPoint)||void 0===u?void 0:u.ownerBlock)}z.sort(((z,u)=>z.reference-u.reference)),this.output._storedFunction=u=>{const U=this.gradient.getConnectedValue(u);if(1===z.length)return z[0].value.getConnectedValue(u);let v=null;for(let f=z.length-1;f>=0;f--){const w=z[f];if(w.reference<=U){const z=w.value.getConnectedValue(u);if(v){const f=v.value.getConnectedValue(u),P=v.reference,S=w.reference,d=Math.max(0,Math.min(1,(U-S)/(P-S)));switch(this.output.type){case Iu.Float:return(0,R.Lerp)(z,f,d);case Iu.Vector2:return J.Vector2.Lerp(z,f,d);case Iu.Eu:return J.Eu.Lerp(z,f,d);case Iu.wg:return g.wg.Lerp(z,f,d)}}return z}v=w}return 0}}});(0,w.f)("BABYLON.ParticleConverterBlock",class extends nu{constructor(z){super(z),this.registerInput("color ",Iu.wg,!0),this.registerInput("xyz ",Iu.Eu,!0),this.registerInput("xy ",Iu.Vector2,!0),this.registerInput("zw ",Iu.Vector2,!0),this.registerInput("x ",Iu.Float,!0),this.registerInput("y ",Iu.Float,!0),this.registerInput("z ",Iu.Float,!0),this.registerInput("w ",Iu.Float,!0),this.registerOutput("color",Iu.wg),this.registerOutput("xyz",Iu.Eu),this.registerOutput("xy",Iu.Vector2),this.registerOutput("zw",Iu.Vector2),this.registerOutput("x",Iu.Float),this.registerOutput("y",Iu.Float),this.registerOutput("z",Iu.Float),this.registerOutput("w",Iu.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(z){return"color "===z?"colorIn":"xyz "===z?"xyzIn":"xy "===z?"xyIn":"zw "===z?"zwIn":"x "===z?"xIn":"y "===z?"yIn":"z "===z?"zIn":"w "===z?"wIn":z}_outputRename(z){switch(z){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return z}}_build(z){super._build(z);const u=this.xIn,U=this.yIn,v=this.zIn,f=this.wIn,w=this.xyIn,P=this.zwIn,R=this.xyzIn,S=this.colorIn,d=this.colorOut,mz=this.xyzOut,Z=this.xyOut,A=this.zwOut,E=this.xOut,C=this.yOut,r=this.zOut,M=this.wOut,T=z=>{if(S.isConnected)return S.getConnectedValue(z);let J=0,d=0,mz=0,Z=0;if(u.isConnected&&(J=u.getConnectedValue(z)),U.isConnected&&(d=U.getConnectedValue(z)),v.isConnected&&(mz=v.getConnectedValue(z)),f.isConnected&&(Z=f.getConnectedValue(z)),w.isConnected){const u=w.getConnectedValue(z);u&&(J=u.x,d=u.y)}if(P.isConnected){const u=P.getConnectedValue(z);u&&(mz=u.x,Z=u.y)}if(R.isConnected){const u=R.getConnectedValue(z);u&&(J=u.x,d=u.y,mz=u.z)}return new g.wg(J,d,mz,Z)};d._storedFunction=z=>T(z),mz._storedFunction=z=>{const u=T(z);return new J.Eu(u.r,u.g,u.b)},Z._storedFunction=z=>{const u=T(z);return new J.Vector2(u.r,u.g)},A._storedFunction=z=>{const u=T(z);return new J.Vector2(u.b,u.a)},E._storedFunction=z=>T(z).r,C._storedFunction=z=>T(z).g,r._storedFunction=z=>T(z).b,M._storedFunction=z=>T(z).a}}),function(z){z[z.Cos=0]="Cos",z[z.Sin=1]="Sin",z[z.Abs=2]="Abs",z[z.Exp=3]="Exp",z[z.Exp2=4]="Exp2",z[z.Round=5]="Round",z[z.Floor=6]="Floor",z[z.Ceiling=7]="Ceiling",z[z.Sqrt=8]="Sqrt",z[z.Log=9]="Log",z[z.Tan=10]="Tan",z[z.ArcTan=11]="ArcTan",z[z.ArcCos=12]="ArcCos",z[z.ArcSin=13]="ArcSin",z[z.Sign=14]="Sign",z[z.Negate=15]="Negate",z[z.OneMinus=16]="OneMinus",z[z.Reciprocal=17]="Reciprocal",z[z.ToDegrees=18]="ToDegrees",z[z.ToRadians=19]="ToRadians",z[z.Fract=20]="Fract"}(au||(au={}));class dU extends nu{constructor(z){super(z),this.operation=au.Cos,this.registerInput("input",Iu.AutoDetect),this.registerOutput("output",Iu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Iu.Float|Iu.Int|Iu.Vector2|Iu.Eu|Iu.wg)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(z){super._build(z);let u=null;switch(this.operation){case au.Cos:u=z=>Math.cos(z);break;case au.Sin:u=z=>Math.sin(z);break;case au.Abs:u=z=>Math.abs(z);break;case au.Exp:u=z=>Math.exp(z);break;case au.Exp2:u=z=>Math.pow(2,z);break;case au.Round:u=z=>Math.round(z);break;case au.Floor:u=z=>Math.floor(z);break;case au.Ceiling:u=z=>Math.ceil(z);break;case au.Sqrt:u=z=>Math.sqrt(z);break;case au.Log:u=z=>Math.log(z);break;case au.Tan:u=z=>Math.tan(z);break;case au.ArcTan:u=z=>Math.atan(z);break;case au.ArcCos:u=z=>Math.acos(z);break;case au.ArcSin:u=z=>Math.asin(z);break;case au.Sign:u=z=>Math.sign(z);break;case au.Negate:u=z=>-z;break;case au.OneMinus:u=z=>1-z;break;case au.Reciprocal:u=z=>1/z;break;case au.ToRadians:u=z=>z*Math.PI/180;break;case au.ToDegrees:u=z=>180*z/Math.PI;break;case au.Fract:u=z=>z>=0?z-Math.floor(z):z-Math.ceil(z)}if(!u)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Iu.Int:case Iu.Float:this.output._storedFunction=z=>{const U=this.input.getConnectedValue(z);return u(U)};break;case Iu.Vector2:this.output._storedFunction=z=>{const U=this.input.getConnectedValue(z);return new J.Vector2(u(U.x),u(U.y))};break;case Iu.Eu:this.output._storedFunction=z=>{const U=this.input.getConnectedValue(z);return new J.Eu(u(U.x),u(U.y),u(U.z))};break;case Iu.wg:this.output._storedFunction=z=>{const U=this.input.getConnectedValue(z);return new g.wg(u(U.r),u(U.g),u(U.b),u(U.a))}}return this}serialize(){const z=super.serialize();return z.operation=this.operation,z}_deserialize(z){super._deserialize(z),this.operation=z.operation}}(0,N.b)([qu("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:au.Cos},{label:"Sin",value:au.Sin},{label:"Abs",value:au.Abs},{label:"Exp",value:au.Exp},{label:"Exp2",value:au.Exp2},{label:"Round",value:au.Round},{label:"Floor",value:au.Floor},{label:"Ceiling",value:au.Ceiling},{label:"Sqrt",value:au.Sqrt},{label:"Log",value:au.Log},{label:"Tan",value:au.Tan},{label:"ArcTan",value:au.ArcTan},{label:"ArcCos",value:au.ArcCos},{label:"ArcSin",value:au.ArcSin},{label:"Sign",value:au.Sign},{label:"Negate",value:au.Negate},{label:"OneMinus",value:au.OneMinus},{label:"Reciprocal",value:au.Reciprocal},{label:"ToDegrees",value:au.ToDegrees},{label:"ToRadians",value:au.ToRadians},{label:"Fract",value:au.Fract}]})],dU.prototype,"operation",void 0),(0,w.f)("BABYLON.ParticleTrigonometryBlock",dU);var mJ,ZU=U(13869);class AU extends nu{constructor(z){super(z),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Iu.AutoDetect),this.registerOutput("output",Iu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Iu.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Iu.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Iu.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Iu.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Iu.System),this._inputs[0].excludedConnectionPointTypes.push(Iu.Particle),this._inputs[0].excludedConnectionPointTypes.push(Iu.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(z){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const u=z=>{const u=this.input.getConnectedValue(z);if(this.log.length>=this.stackSize)return u;if(null===u||void 0===u)return this.log.push(["null",""]),u;switch(this.input.type){case Iu.Vector2:this.log.push([(0,ZU.j)(u,4),u.toString()]);break;case Iu.Eu:this.log.push([(0,ZU.m)(u,4),u.toString()]);break;case Iu.wg:this.log.push(["{R: ".concat(u.r.toFixed(4)," G: ").concat(u.g.toFixed(4)," B: ").concat(u.b.toFixed(4)," A: ").concat(u.a.toFixed(4),"}"),u.toString()]);break;default:this.log.push([u.toString(),u.toString()])}return u};this.output.isConnected?this.output._storedFunction=u:this.output._storedValue=u(z)}serialize(){const z=super.serialize();return z.stackSize=this.stackSize,z}_deserialize(z){super._deserialize(z),this.stackSize=z.stackSize}}(0,N.b)([qu("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],AU.prototype,"stackSize",void 0),(0,w.f)("BABYLON.ParticleDebugBlock",AU);(0,w.f)("BABYLON.ParticleElbowBlock",class extends nu{constructor(z){super(z),this.registerInput("input",Iu.AutoDetect),this.registerOutput("output",Iu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(z){super._build(z);const u=this._outputs[0],U=this._inputs[0];u._storedFunction=z=>U.getConnectedValue(z)}});(0,w.f)("BABYLON.ParticleTeleportInBlock",class extends nu{get endpoints(){return this._endpoints}constructor(z){super(z),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Iu.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(z){if(this.getClassName()===z)return!0;for(const u of this.endpoints)if(u.isAnAncestorOfType(z))return!0;return!1}isAnAncestorOf(z){for(const u of this.endpoints){if(u===z)return!0;if(u.isAnAncestorOf(z))return!0}return!1}attachToEndpoint(z){z.detach(),this._endpoints.push(z),z._entryPoint=this,z._outputs[0]._typeConnectionSource=this._inputs[0],z._tempEntryPointUniqueId=null,z.name="> "+this.name}detachFromEndpoint(z){const u=this._endpoints.indexOf(z);-1!==u&&(this._endpoints.splice(u,1),z._outputs[0]._typeConnectionSource=null,z._entryPoint=null)}_build(){for(const z of this._endpoints)z.output._storedFunction=z=>this.input.getConnectedValue(z)}});(0,w.f)("BABYLON.ParticleTeleportOutBlock",class extends nu{constructor(z){super(z),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Iu.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(z){this.entryPoint&&this.entryPoint.build(z)}clone(){const z=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(z),z}serialize(){var z,u;const U=super.serialize();return U.entryPoint=null!==(z=null===(u=this.entryPoint)||void 0===u?void 0:u.uniqueId)&&void 0!==z?z:"",U}_deserialize(z){super._deserialize(z),this._tempEntryPointUniqueId=z.entryPoint}}),function(z){z[z.Equal=0]="Equal",z[z.NotEqual=1]="NotEqual",z[z.LessThan=2]="LessThan",z[z.GreaterThan=3]="GreaterThan",z[z.LessOrEqual=4]="LessOrEqual",z[z.GreaterOrEqual=5]="GreaterOrEqual",z[z.Xor=6]="Xor",z[z.Or=7]="Or",z[z.And=8]="And"}(mJ||(mJ={}));class EU extends nu{constructor(z){super(z),this.test=mJ.Equal,this.epsilon=0,this.registerInput("left",Iu.Float),this.registerInput("right",Iu.Float,!0,0),this.registerInput("ifTrue",Iu.AutoDetect,!0,1),this.registerInput("ifFalse",Iu.AutoDetect,!0,0),this.registerOutput("output",Iu.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Iu.Float,this._inputs[0].acceptedConnectionPointTypes.push(Iu.Int),this._inputs[1].acceptedConnectionPointTypes.push(Iu.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const z=z=>{const u=this.left.getConnectedValue(z),U=this.right.getConnectedValue(z);let J=!1;switch(this.test){case mJ.Equal:J=(0,R.WithinEpsilon)(u,U,this.epsilon);break;case mJ.NotEqual:J=!(0,R.WithinEpsilon)(u,U,this.epsilon);break;case mJ.LessThan:J=u<U+this.epsilon;break;case mJ.GreaterThan:J=u>U-this.epsilon;break;case mJ.LessOrEqual:J=u<=U+this.epsilon;break;case mJ.GreaterOrEqual:J=u>=U-this.epsilon;break;case mJ.Xor:J=!!u&&!U||!u&&!!U;break;case mJ.Or:J=!!u||!!U;break;case mJ.And:J=!!u&&!!U}return J};this.output._storedFunction=u=>z(u)?this.ifTrue.getConnectedValue(u):this.ifFalse.getConnectedValue(u)}serialize(){const z=super.serialize();return z.test=this.test,z.epsilon=this.epsilon,z}_deserialize(z){super._deserialize(z),this.test=z.test,void 0!==z.epsilon&&(this.epsilon=z.epsilon)}}(0,N.b)([qu("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:mJ.Equal},{label:"NotEqual",value:mJ.NotEqual},{label:"LessThan",value:mJ.LessThan},{label:"GreaterThan",value:mJ.GreaterThan},{label:"LessOrEqual",value:mJ.LessOrEqual},{label:"GreaterOrEqual",value:mJ.GreaterOrEqual},{label:"Xor",value:mJ.Xor},{label:"Or",value:mJ.Or},{label:"And",value:mJ.And}]})],EU.prototype,"test",void 0),(0,N.b)([qu("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],EU.prototype,"epsilon",void 0),(0,w.f)("BABYLON.ParticleConditionBlock",EU);class CU extends nu{constructor(z){super(z),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Iu.Particle),this.registerInput("condition",Iu.Float,!0,0),this.registerInput("system",Iu.System),this.registerOutput("output",Iu.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(z){this._triggerCount=0;const u=this.input.getConnectedValue(z),U={process:U=>{if(z.particleContext=U,z.systemContext=u,0!==this.condition.getConnectedValue(z)&&(0===this.limit||this._triggerCount<this.limit)){const J=(new Date).getTime();if(this._previousOne&&J-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=J;const v=this.system.getConnectedValue(z);if(v){const J=su(v,z.ru,U.position);J.Xf.addOnce((()=>{this._triggerCount--})),u.Xf.addOnce((()=>{J.dispose()}))}}},previousItem:null,nextItem:null};u._updateQueueStart?yz(U,u._updateQueueStart):u._updateQueueStart=U,this.output._storedValue=u}serialize(){const z=super.serialize();return z.limit=this.limit,z.delay=this.delay,z}_deserialize(z){super._deserialize(z),void 0!==z.limit&&(this.limit=z.limit),void 0!==z.delay&&(this.delay=z.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,N.b)([qu("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],CU.prototype,"limit",void 0),(0,N.b)([qu("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],CU.prototype,"delay",void 0),(0,w.f)("BABYLON.ParticleTriggerBlock",CU);U(13877),U(13892),U(13904),U(13958)},13938:(z,u,U)=>{"use strict";var J=U(12837);const v="clipPlaneFragment",f="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13909:(z,u,U)=>{"use strict";var J=U(12837);const v="clipPlaneFragmentDeclaration",f="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13974:(z,u,U)=>{"use strict";var J=U(12837);const v="clipPlaneVertex",f="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13966:(z,u,U)=>{"use strict";var J=U(12837);const v="clipPlaneVertexDeclaration",f="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13952:(z,u,U)=>{"use strict";var J=U(12837);const v="fogFragment",f="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13935:(z,u,U)=>{"use strict";var J=U(12837);const v="fogFragmentDeclaration",f="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13982:(z,u,U)=>{"use strict";var J=U(12837);const v="fogVertex",f="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13971:(z,u,U)=>{"use strict";var J=U(12837);const v="fogVertexDeclaration",f="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13925:(z,u,U)=>{"use strict";var J=U(12837);const v="helperFunctions",f="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13914:(z,u,U)=>{"use strict";var J=U(12837);const v="imageProcessingDeclaration",f="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13933:(z,u,U)=>{"use strict";var J=U(12837);const v="imageProcessingFunctions",f="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13922:(z,u,U)=>{"use strict";var J=U(12837);const v="logDepthDeclaration",f="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13945:(z,u,U)=>{"use strict";var J=U(12837);const v="logDepthFragment",f="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13987:(z,u,U)=>{"use strict";var J=U(12837);const v="logDepthVertex",f="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";J.d.IncludesShadersStoreWGSL[v]||(J.d.IncludesShadersStoreWGSL[v]=f)},13904:(z,u,U)=>{"use strict";U.r(u),U.d(u,{particlesPixelShaderWGSL:()=>g});var J=U(12837);U(13909),U(13914),U(13922),U(13925),U(13933),U(13935),U(13938),U(13945),U(13952);const v="particlesPixelShader",f="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";J.d.ShadersStoreWGSL[v]||(J.d.ShadersStoreWGSL[v]=f);const g={name:v,shader:f}},13958:(z,u,U)=>{"use strict";U.r(u),U.d(u,{particlesVertexShaderWGSL:()=>g});var J=U(12837);U(13966),U(13971),U(13922),U(13974),U(13982),U(13987);const v="particlesVertexShader",f="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";J.d.ShadersStoreWGSL[v]||(J.d.ShadersStoreWGSL[v]=f);const g={name:v,shader:f}},13805:(z,u,U)=>{"use strict";var J=U(12837);const v="clipPlaneFragment",f="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13884:(z,u,U)=>{"use strict";var J=U(12837);const v="clipPlaneFragmentDeclaration",f="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13829:(z,u,U)=>{"use strict";var J=U(12837);const v="clipPlaneVertex",f="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13899:(z,u,U)=>{"use strict";var J=U(12837);const v="clipPlaneVertexDeclaration",f="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13816:(z,u,U)=>{"use strict";var J=U(12837);const v="fogFragment",f="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13800:(z,u,U)=>{"use strict";var J=U(12837);const v="fogFragmentDeclaration",f="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13831:(z,u,U)=>{"use strict";var J=U(12837);const v="fogVertex",f="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13821:(z,u,U)=>{"use strict";var J=U(12837);const v="fogVertexDeclaration",f="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13792:(z,u,U)=>{"use strict";var J=U(12837);const v="helperFunctions",f="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13780:(z,u,U)=>{"use strict";var J=U(12837);const v="imageProcessingDeclaration",f="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13795:(z,u,U)=>{"use strict";var J=U(12837);const v="imageProcessingFunctions",f="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13784:(z,u,U)=>{"use strict";var J=U(12837);const v="logDepthDeclaration",f="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13811:(z,u,U)=>{"use strict";var J=U(12837);const v="logDepthFragment",f="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13839:(z,u,U)=>{"use strict";var J=U(12837);const v="logDepthVertex",f="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";J.d.IncludesShadersStore[v]||(J.d.IncludesShadersStore[v]=f)},13877:(z,u,U)=>{"use strict";U.r(u),U.d(u,{particlesPixelShader:()=>g});var J=U(12837);U(13884),U(13780),U(13784),U(13792),U(13795),U(13800),U(13805),U(13811),U(13816);const v="particlesPixelShader",f="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";J.d.ShadersStore[v]||(J.d.ShadersStore[v]=f);const g={name:v,shader:f}},13892:(z,u,U)=>{"use strict";U.r(u),U.d(u,{particlesVertexShader:()=>g});var J=U(12837);U(13899),U(13821),U(13784),U(13829),U(13831),U(13839);const v="particlesVertexShader",f="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";J.d.ShadersStore[v]||(J.d.ShadersStore[v]=f);const g={name:v,shader:f}},14254:(z,u,U)=>{"use strict";U.r(u),U.d(u,{FlowGraphGLTFDataProvider:()=>f});var J=U(14218),v=U(14196);class f extends J.b{constructor(z){var u,U;super();const J=z.glTF,f=(null===(u=J.animations)||void 0===u?void 0:u.map((z=>z._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",v.e,f);const g=(null===(U=J.nodes)||void 0===U?void 0:U.map((z=>z._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",v.e,g)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14131:(z,u,U)=>{"use strict";U.d(u,{c:()=>C,g:()=>A,k:()=>Z,l:()=>E});var J=U(12914),v=U(13360),f=U(12967),g=U(14138);const w=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class P{constructor(z,u){this._gltf=z,this._infoTree=u}convert(z){let u,U=this._gltf,J=this._infoTree;if(!z.startsWith("/"))throw new Error("Path must start with a /");const v=z.split("/");if(v.shift(),v[v.length-1].includes(".length")){const z=v[v.length-1].split(".");v.pop(),v.push(...z)}let f=!1;for(const P of v){const v="length"===P;if(v&&!J.__array__)throw new Error("Path ".concat(z," is invalid"));if(J.__ignoreObjectTree__&&(f=!0),J.__array__&&!v)J=J.__array__;else if(J=J[P],!J)throw new Error("Path ".concat(z," is invalid"));if(!f)if(void 0===U){if(!w.find((u=>u.regex.test(z))))throw new Error("Path ".concat(z," is invalid"))}else if(!v){var g;U=null===(g=U)||void 0===g?void 0:g[P]}(J.__target__||v)&&(u=U)}return{object:u,info:J}}}function R(z,u,U,J){const v=S(z,u);return J?v[U][J]:v[U]}function S(z,u,U){var J,f,g;return null===(J=z._data)||void 0===J||null===(f=J[null!==(g=null===U||void 0===U?void 0:U.fillMode)&&void 0!==g?g:v.d.MATERIAL_TriangleFillMode])||void 0===f?void 0:f.babylonMaterial}function d(z,u){return{offset:{componentsCount:2,type:"Vector2",get:(U,v,f)=>{const g=R(U,f,z,u);return new J.Vector2(null===g||void 0===g?void 0:g.uOffset,null===g||void 0===g?void 0:g.vOffset)},getTarget:S,set:(U,J,v,f)=>{const g=R(J,f,z,u);g.uOffset=U.x,g.vOffset=U.y},getPropertyName:[()=>"".concat(z).concat(u?"."+u:"",".uOffset"),()=>"".concat(z).concat(u?"."+u:"",".vOffset")]},rotation:{type:"number",get:(U,J,v)=>{var f;return null===(f=R(U,v,z,u))||void 0===f?void 0:f.wAng},getTarget:S,set:(U,J,v,f)=>R(J,f,z,u).wAng=U,getPropertyName:[()=>"".concat(z).concat(u?"."+u:"",".wAng")]},scale:{componentsCount:2,type:"Vector2",get:(U,v,f)=>{const g=R(U,f,z,u);return new J.Vector2(null===g||void 0===g?void 0:g.uScale,null===g||void 0===g?void 0:g.vScale)},getTarget:S,set:(U,J,v,f)=>{const g=R(J,f,z,u);g.uScale=U.x,g.vScale=U.y},getPropertyName:[()=>"".concat(z).concat(u?"."+u:"",".uScale"),()=>"".concat(z).concat(u?"."+u:"",".vScale")]}}}const mz={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:z=>{var u,U,v,f;return new J.Vector2(null!==(u=null===(U=z._babylonCamera)||void 0===U?void 0:U.orthoLeft)&&void 0!==u?u:0,null!==(v=null===(f=z._babylonCamera)||void 0===f?void 0:f.orthoRight)&&void 0!==v?v:0)},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.orthoLeft=z.x,u._babylonCamera.orthoRight=z.y)},getTarget:z=>z,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:z=>{var u,U,v,f;return new J.Vector2(null!==(u=null===(U=z._babylonCamera)||void 0===U?void 0:U.orthoBottom)&&void 0!==u?u:0,null!==(v=null===(f=z._babylonCamera)||void 0===f?void 0:f.orthoTop)&&void 0!==v?v:0)},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.orthoBottom=z.x,u._babylonCamera.orthoTop=z.y)},getTarget:z=>z,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:z=>{var u;return null===(u=z._babylonCamera)||void 0===u?void 0:u.maxZ},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.maxZ=z)},getTarget:z=>z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:z=>{var u;return null===(u=z._babylonCamera)||void 0===u?void 0:u.Bf},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.Bf=z)},getTarget:z=>z,getPropertyName:[()=>"Bf"]}},perspective:{aspectRatio:{type:"number",get:z=>{var u;return null===(u=z._babylonCamera)||void 0===u?void 0:u.getEngine().getAspectRatio(z._babylonCamera)},getTarget:z=>z,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:z=>{var u;return null===(u=z._babylonCamera)||void 0===u?void 0:u.fov},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.fov=z)},getTarget:z=>z,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:z=>{var u;return null===(u=z._babylonCamera)||void 0===u?void 0:u.maxZ},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.maxZ=z)},getTarget:z=>z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:z=>{var u;return null===(u=z._babylonCamera)||void 0===u?void 0:u.Bf},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.Bf=z)},getTarget:z=>z,getPropertyName:[()=>"Bf"]}}}},nodes:{length:{type:"number",get:z=>z.length,getTarget:z=>z.map((z=>z._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Eu",get:z=>{var u;return null===(u=z._babylonTransformNode)||void 0===u?void 0:u.position},set:(z,u)=>{var U;return null===(U=u._babylonTransformNode)||void 0===U?void 0:U.position.v(z)},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:z=>{var u;return null===(u=z._babylonTransformNode)||void 0===u?void 0:u.rotationQuaternion},set:(z,u)=>{var U,J;return null===(U=u._babylonTransformNode)||void 0===U||null===(J=U.rotationQuaternion)||void 0===J?void 0:J.v(z)},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Eu",get:z=>{var u;return null===(u=z._babylonTransformNode)||void 0===u?void 0:u.Ug},set:(z,u)=>{var U;return null===(U=u._babylonTransformNode)||void 0===U?void 0:U.Ug.v(z)},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"Ug"]},weights:{length:{type:"number",get:z=>z._numMorphTargets,getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(z,u)=>{var U,J;return void 0!==u?null===(U=z._primitiveBabylonMeshes)||void 0===U||null===(J=U[0].morphTargetManager)||void 0===J?void 0:J.getTarget(u).influence:void 0},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(z,u)=>[0],getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:z=>{var u,U,v;return J.Matrix.Compose(null===(u=z._babylonTransformNode)||void 0===u?void 0:u.Ug,null===(U=z._babylonTransformNode)||void 0===U?void 0:U.rotationQuaternion,null===(v=z._babylonTransformNode)||void 0===v?void 0:v.position)},getTarget:z=>z._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:z=>{var u,U,v,f;const g=J.Matrix.Identity();let w=z.parent;for(;w&&w.parent;)w=w.parent;const P=(null===(u=z._babylonTransformNode)||void 0===u?void 0:u.position._isDirty)||(null===(U=z._babylonTransformNode)||void 0===U||null===(v=U.rotationQuaternion)||void 0===v?void 0:v._isDirty)||(null===(f=z._babylonTransformNode)||void 0===f?void 0:f.Ug._isDirty);if(w){var R;const u=null===(R=w._babylonTransformNode)||void 0===R?void 0:R.af(!0).invert();var S,d;if(u)null===(S=z._babylonTransformNode)||void 0===S||null===(d=S.af(P))||void 0===d||d.multiplyToRef(u,g)}else z._babylonTransformNode&&g.v(z._babylonTransformNode.af(P));return g},getTarget:z=>z._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:z=>{var u,U;return null===(u=z._babylonTransformNode)||void 0===u||null===(U=u.getChildren((z=>z instanceof g.e),!0)[0])||void 0===U?void 0:U.Cg},getTarget:z=>{var u;return null===(u=z._babylonTransformNode)||void 0===u?void 0:u.getChildren((z=>z instanceof g.e),!0)[0]},set:(z,u)=>{if(u._babylonTransformNode){const U=u._babylonTransformNode.getChildren((z=>z instanceof g.e),!0)[0];U&&(U.Cg=z)}}},color:{type:"Tu",get:z=>{var u,U;return null===(u=z._babylonTransformNode)||void 0===u||null===(U=u.getChildren((z=>z instanceof g.e),!0)[0])||void 0===U?void 0:U.Mg},getTarget:z=>{var u;return null===(u=z._babylonTransformNode)||void 0===u?void 0:u.getChildren((z=>z instanceof g.e),!0)[0]},set:(z,u)=>{if(u._babylonTransformNode){const U=u._babylonTransformNode.getChildren((z=>z instanceof g.e),!0)[0];U&&(U.Mg=z)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Tu",get:(z,u,U)=>S(z,u,U).emissiveColor,set:(z,u,U,J)=>S(u,U,J).emissiveColor.v(z),getTarget:(z,u,U)=>S(z,u,U),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:d("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(z,u,U)=>{var J;return null===(J=R(z,U,"bumpTexture"))||void 0===J?void 0:J.level},set:(z,u,U,J)=>{const v=R(u,J,"bumpTexture");v&&(v.level=z)},getTarget:(z,u,U)=>S(z,u,U),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:d("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(z,u,U)=>S(z,u,U).ambientTextureStrength,set:(z,u,U,J)=>{const v=S(u,U,J);v&&(v.ambientTextureStrength=z)},getTarget:(z,u,U)=>S(z,u,U),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:d("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"wg",get:(z,u,U)=>{const J=S(z,u,U);return f.wg.FromColor3(J.albedoColor,J.alpha)},set:(z,u,U,J)=>{const v=S(u,U,J);v.albedoColor.set(z.r,z.g,z.b),v.alpha=z.a},getTarget:(z,u,U)=>S(z,u,U),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:d("albedoTexture")}},metallicFactor:{type:"number",get:(z,u,U)=>S(z,u,U).metallic,set:(z,u,U,J)=>{const v=S(u,U,J);v&&(v.metallic=z)},getTarget:(z,u,U)=>S(z,u,U),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(z,u,U)=>S(z,u,U).roughness,set:(z,u,U,J)=>{const v=S(u,U,J);v&&(v.roughness=z)},getTarget:(z,u,U)=>S(z,u,U),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:d("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(z,u,U)=>S(z,u,U).anisotropy.Cg,set:(z,u,U,J)=>{S(u,U,J).anisotropy.Cg=z},getTarget:(z,u,U)=>S(z,u,U),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(z,u,U)=>S(z,u,U).anisotropy.angle,set:(z,u,U,J)=>{S(u,U,J).anisotropy.angle=z},getTarget:(z,u,U)=>S(z,u,U),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:d("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(z,u,U)=>S(z,u,U).clearCoat.Cg,set:(z,u,U,J)=>{S(u,U,J).clearCoat.Cg=z},getTarget:(z,u,U)=>S(z,u,U),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(z,u,U)=>S(z,u,U).clearCoat.roughness,set:(z,u,U,J)=>{S(u,U,J).clearCoat.roughness=z},getTarget:(z,u,U)=>S(z,u,U),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:d("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(z,u,U)=>{var J;return null===(J=S(z,u,U).clearCoat.bumpTexture)||void 0===J?void 0:J.level},getTarget:S,set:(z,u,U,J)=>S(u,U,J).clearCoat.bumpTexture.level=z},extensions:{KHR_texture_transform:d("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:d("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(z,u,U)=>S(z,u,U).subSurface.dispersion,getTarget:S,set:(z,u,U,J)=>S(u,U,J).subSurface.dispersion=z}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(z,u,U)=>S(z,u,U).emissiveIntensity,getTarget:S,set:(z,u,U,J)=>S(u,U,J).emissiveIntensity=z}},KHR_materials_ior:{ior:{type:"number",get:(z,u,U)=>S(z,u,U).indexOfRefraction,getTarget:S,set:(z,u,U,J)=>S(u,U,J).indexOfRefraction=z}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(z,u,U)=>S(z,u,U).iridescence.Cg,getTarget:S,set:(z,u,U,J)=>S(u,U,J).iridescence.Cg=z},iridescenceIor:{type:"number",get:(z,u,U)=>S(z,u,U).iridescence.indexOfRefraction,getTarget:S,set:(z,u,U,J)=>S(u,U,J).iridescence.indexOfRefraction=z},iridescenceTexture:{extensions:{KHR_texture_transform:d("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(z,u,U)=>S(z,u,U).iridescence.maximumThickness,getTarget:S,set:(z,u,U,J)=>S(u,U,J).iridescence.maximumThickness=z},iridescenceThicknessMinimum:{type:"number",get:(z,u,U)=>S(z,u,U).iridescence.minimumThickness,getTarget:S,set:(z,u,U,J)=>S(u,U,J).iridescence.minimumThickness=z},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:d("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Tu",get:(z,u,U)=>S(z,u,U).sheen.color,getTarget:S,set:(z,u,U,J)=>S(u,U,J).sheen.color.v(z)},sheenColorTexture:{extensions:{KHR_texture_transform:d("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(z,u,U)=>S(z,u,U).sheen.Cg,getTarget:S,set:(z,u,U,J)=>S(u,U,J).sheen.Cg=z},sheenRoughnessTexture:{extensions:{KHR_texture_transform:d("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(z,u,U)=>S(z,u,U).metallicF0Factor,getTarget:S,set:(z,u,U,J)=>S(u,U,J).metallicF0Factor=z,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Tu",get:(z,u,U)=>S(z,u,U).metallicReflectanceColor,getTarget:S,set:(z,u,U,J)=>S(u,U,J).metallicReflectanceColor.v(z),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:d("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:d("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(z,u,U)=>S(z,u,U).subSurface.refractionIntensity,getTarget:S,set:(z,u,U,J)=>S(u,U,J).subSurface.refractionIntensity=z,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:d("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(z,u,U)=>S(z,u,U).subSurface.translucencyIntensity,getTarget:S,set:(z,u,U,J)=>S(u,U,J).subSurface.translucencyIntensity=z},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:d("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Tu",get:(z,u,U)=>S(z,u,U).subSurface.translucencyColor,getTarget:S,set:(z,u,U,J)=>{var v;return z&&(null===(v=S(u,U,J).subSurface.translucencyColor)||void 0===v?void 0:v.v(z))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:d("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Tu",get:(z,u,U)=>S(z,u,U).subSurface.tintColor,getTarget:S,set:(z,u,U,J)=>S(u,U,J).subSurface.tintColor.v(z)},attenuationDistance:{type:"number",get:(z,u,U)=>S(z,u,U).subSurface.tintColorAtDistance,getTarget:S,set:(z,u,U,J)=>S(u,U,J).subSurface.tintColorAtDistance=z},thicknessFactor:{type:"number",get:(z,u,U)=>S(z,u,U).subSurface.maximumThickness,getTarget:S,set:(z,u,U,J)=>S(u,U,J).subSurface.maximumThickness=z},thicknessTexture:{extensions:{KHR_texture_transform:d("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:z=>z.length,getTarget:z=>z.map((z=>z._babylonLight)),getPropertyName:[z=>"length"]},__array__:{__target__:!0,color:{type:"Tu",get:z=>{var u;return null===(u=z._babylonLight)||void 0===u?void 0:u.Mg},set:(z,u)=>{var U;return null===(U=u._babylonLight)||void 0===U?void 0:U.Mg.v(z)},getTarget:z=>z._babylonLight,getPropertyName:[z=>"diffuse"]},Cg:{type:"number",get:z=>{var u;return null===(u=z._babylonLight)||void 0===u?void 0:u.Cg},set:(z,u)=>u._babylonLight?u._babylonLight.Cg=z:void 0,getTarget:z=>z._babylonLight,getPropertyName:[z=>"intensity"]},range:{type:"number",get:z=>{var u;return null===(u=z._babylonLight)||void 0===u?void 0:u.range},set:(z,u)=>u._babylonLight?u._babylonLight.range=z:void 0,getTarget:z=>z._babylonLight,getPropertyName:[z=>"range"]},spot:{innerConeAngle:{type:"number",get:z=>{var u;return null===(u=z._babylonLight)||void 0===u?void 0:u.innerAngle},set:(z,u)=>u._babylonLight?u._babylonLight.innerAngle=z:void 0,getTarget:z=>z._babylonLight,getPropertyName:[z=>"innerConeAngle"]},outerConeAngle:{type:"number",get:z=>{var u;return null===(u=z._babylonLight)||void 0===u?void 0:u.angle},set:(z,u)=>u._babylonLight?u._babylonLight.angle=z:void 0,getTarget:z=>z._babylonLight,getPropertyName:[z=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:z=>z.length,getTarget:z=>z.map((z=>z._babylonLight)),getPropertyName:[z=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:z=>z.length,getTarget:z=>z.map((z=>z._babylonTexture)),getPropertyName:[z=>"length"]},__array__:{__target__:!0,Cg:{type:"number",get:z=>{var u;return null===(u=z._babylonTexture)||void 0===u?void 0:u.level},set:(z,u)=>{u._babylonTexture&&(u._babylonTexture.level=z)},getTarget:z=>z._babylonTexture},rotation:{type:"Quaternion",get:z=>{var u;return z._babylonTexture&&J.Quaternion.FromRotationMatrix(null===(u=z._babylonTexture)||void 0===u?void 0:u.getReflectionTextureMatrix())},set:(z,u)=>{var U;u._babylonTexture&&(null!==(U=u._babylonTexture.Vz())&&void 0!==U&&U.useRightHandedSystem||(z=J.Quaternion.Inverse(z)),J.Matrix.FromQuaternionToRef(z,u._babylonTexture.getReflectionTextureMatrix()))},getTarget:z=>z._babylonTexture}}}}},animations:{length:{type:"number",get:z=>z.length,getTarget:z=>z.map((z=>z._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:z=>z.length,getTarget:z=>z.map((z=>{var u;return null===(u=z.primitives[0]._instanceData)||void 0===u?void 0:u.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function Z(z){return new P(z,mz)}function A(z){const u=z.split("/").map((z=>z.replace(/{}/g,"__array__")));let U=mz;for(const J of u)J&&(U=U[J]);if(U&&U.type&&U.get)return U}function E(z,u){const U=z.split("/").map((z=>z.replace(/{}/g,"__array__")));let J=mz;for(const v of U)v&&(J=J[v]);J&&J.type&&J.get&&(J.interpolation=u)}function C(z,u){const U=z.split("/").map((z=>z.replace(/{}/g,"__array__")));let J=mz;for(const v of U)if(v){if(!J[v]){if("?"===v){J.__ignoreObjectTree__=!0;continue}J[v]={},"__array__"===v&&(J[v].__target__=!0)}J=J[v]}Object.assign(J,u)}},14141:(z,u,U)=>{"use strict";U.r(u),U.d(u,{AnimationPropertyInfo:()=>R,TransformNodeAnimationPropertyInfo:()=>S,WeightAnimationPropertyInfo:()=>d,getQuaternion:()=>w,getVector3:()=>g,getWeights:()=>P});var J=U(13406),v=U(12914),f=U(14131);function g(z,u,U,J){return v.Eu.Xu(u,U).scaleInPlace(J)}function w(z,u,U,J){return v.Quaternion.Xu(u,U).scaleInPlace(J)}function P(z,u,U,J){const v=new Array(z._numMorphTargets);for(let f=0;f<v.length;f++)v[f]=u[U++]*J;return v}class R{constructor(z,u,U,J){this.type=z,this.name=u,this.getValue=U,this.getStride=J}_buildAnimation(z,u,U){const v=new J.b(z,this.name,u,this.type);return v.setKeys(U),v}}class S extends R{buildAnimations(z,u,U,J){const v=[];return v.push({babylonAnimatable:z._babylonTransformNode,babylonAnimation:this._buildAnimation(u,U,J)}),v}}class d extends R{buildAnimations(z,u,U,v){const f=[];if(z._numMorphTargets)for(let g=0;g<z._numMorphTargets;g++){const w=new J.b("".concat(u,"_").concat(g),this.name,U,this.type);if(w.setKeys(v.map((z=>({frame:z.frame,inTangent:z.inTangent?z.inTangent[g]:void 0,value:z.value[g],outTangent:z.outTangent?z.outTangent[g]:void 0,interpolation:z.interpolation})))),z._primitiveBabylonMeshes)for(const u of z._primitiveBabylonMeshes)if(u.morphTargetManager){const z=u.morphTargetManager.getTarget(g),U=w.clone();z.animations.push(U),f.push({babylonAnimatable:z,babylonAnimation:U})}}return f}}(0,f.l)("/nodes/{}/translation",[new S(J.b.ANIMATIONTYPE_VECTOR3,"position",g,(()=>3))]),(0,f.l)("/nodes/{}/rotation",[new S(J.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",w,(()=>4))]),(0,f.l)("/nodes/{}/scale",[new S(J.b.ANIMATIONTYPE_VECTOR3,"Ug",g,(()=>3))]),(0,f.l)("/nodes/{}/weights",[new d(J.b.ANIMATIONTYPE_FLOAT,"influence",P,(z=>z._numMorphTargets))])},14110:(z,u,U)=>{"use strict";class J{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((z,u)=>{this._resolve=z,this._reject=u}))}}var v=U(12914),f=U(12967),g=U(12748),w=U(13338),P=U(14116),R=U(14123),S=U(12756),d=U(13353),mz=U(13406),Z=U(13410),A=U(12797),E=U(12760),C=U(12768);class r{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(z){this._useTextureToStoreBoneMatrices=z,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(z){this._animationPropertiesOverride=z}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(z,u,U){this.name=z,this.id=u,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=v.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new S.e,this.bones=[],this._scene=U||A.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const J=this._scene.getEngine().getCaps();this._canUseTextureForBones=J.textureFloat&&J.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((z=>!z.getParent()))}getTransformMatrices(z){if(this.needInitialSkinMatrix){if(!z)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return z._bonesTransformMatrices||this.prepare(!0),z._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(z){return this.needInitialSkinMatrix&&z._transformMatrixTexture?z._transformMatrixTexture:this._transformMatrixTexture}Vz(){return this._scene}toString(z){let u="Name: ".concat(this.name,", nBones: ").concat(this.bones.length);if(u+=", nAnimationRanges: ".concat(this._ranges?Object.keys(this._ranges).length:"none"),z){u+=", Ranges: {";let z=!0;for(const U in this._ranges)z&&(u+=", ",z=!1),u+=U;u+="}"}return u}getBoneIndexByName(z){for(let u=0,U=this.bones.length;u<U;u++)if(this.bones[u].name===z)return u;return-1}createAnimationRange(z,u,U){if(!this._ranges[z]){this._ranges[z]=new Z.c(z,u,U);for(let J=0,v=this.bones.length;J<v;J++)this.bones[J].animations[0]&&this.bones[J].animations[0].createRange(z,u,U)}}deleteAnimationRange(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let U=0,J=this.bones.length;U<J;U++)this.bones[U].animations[0]&&this.bones[U].animations[0].deleteRange(z,u);this._ranges[z]=null}getAnimationRange(z){return this._ranges[z]||null}getAnimationRanges(){const z=[];let u;for(u in this._ranges)z.push(this._ranges[u]);return z}copyAnimationRange(z,u){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[u]||!z.getAnimationRange(u))return!1;let J=!0;const v=this._getHighestAnimationFrame()+1,f={},g=z.bones;let w,P;for(P=0,w=g.length;P<w;P++)f[g[P].name]=g[P];this.bones.length!==g.length&&(E.d.Warn("copyAnimationRange: this rig has ".concat(this.bones.length," bones, while source as ").concat(g.length)),J=!1);const R=U&&this.dimensionsAtRest&&z.dimensionsAtRest?this.dimensionsAtRest.divide(z.dimensionsAtRest):null;for(P=0,w=this.bones.length;P<w;P++){const z=this.bones[P].name,g=f[z];g?J=J&&this.bones[P].copyAnimationRange(g,u,v,U,R):(E.d.Warn("copyAnimationRange: not same rig, missing source bone "+z),J=!1)}const S=z.getAnimationRange(u);return S&&(this._ranges[u]=new Z.c(u,S.from+v,S.to+v)),J}returnToRest(){for(const z of this.bones)-1!==z._index&&z.returnToRest()}_getHighestAnimationFrame(){let z=0;for(let u=0,U=this.bones.length;u<U;u++)if(this.bones[u].animations[0]){const U=this.bones[u].animations[0].getHighestFrame();z<U&&(z=U)}return z}beginAnimation(z,u,U,J){const v=this.getAnimationRange(z);return v?this._scene.beginAnimation(this,v.from,v.to,u,U,J):null}static MakeAnimationAdditive(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;const J=z.getAnimationRange(U);if(!J)return null;const v=z._scene.getAllAnimatablesByTarget(z);let f=null;for(let w=0;w<v.length;w++){const z=v[w];if(z.fromFrame===(null===J||void 0===J?void 0:J.from)&&z.toFrame===(null===J||void 0===J?void 0:J.to)){f=z;break}}const g=z.getAnimatables();for(let w=0;w<g.length;w++){const z=g[w].animations;if(z)for(let J=0;J<z.length;J++)mz.b.MakeAnimationAdditive(z[J],u,U)}return f&&(f.isAdditive=!0),z}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(z){this._meshesWithPoseMatrix.push(z)}_unregisterMeshWithPoseMatrix(z){const u=this._meshesWithPoseMatrix.indexOf(z);u>-1&&this._meshesWithPoseMatrix.splice(u,1)}_computeTransformMatrices(z,u){this.onBeforeComputeObservable.notifyObservers(this);for(let U=0;U<this.bones.length;U++){const J=this.bones[U];J._childUpdateId++;const v=J.getParent();if(v?J.getLocalMatrix().multiplyToRef(v.getFinalMatrix(),J.getFinalMatrix()):u?J.getLocalMatrix().multiplyToRef(u,J.getFinalMatrix()):J.getFinalMatrix().v(J.getLocalMatrix()),-1!==J._index){const u=null===J._index?U:J._index;J.getAbsoluteInverseBindMatrix().multiplyToArray(J.getFinalMatrix(),z,16*u)}}this._identity.copyToArray(z,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const z=this.Vz().getRenderId();if(this._currentRenderId===z)return;this._currentRenderId=z}if(this._numBonesWithLinkedTransformNode>0)for(const z of this.bones)if(z._linkedTransformNode){const u=z._linkedTransformNode;z.position=u.position,u.rotationQuaternion?z.rotationQuaternion=u.rotationQuaternion:z.rotation=u.rotation,z.Ug=u.Ug}if(this.needInitialSkinMatrix)for(const z of this._meshesWithPoseMatrix){const u=z.getPoseMatrix();let U=this._isDirty;if(z._bonesTransformMatrices&&z._bonesTransformMatrices.length===16*(this.bones.length+1)||(z._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),U=!0),U){if(this._synchronizedWithMesh!==z){this._synchronizedWithMesh=z;for(const z of this.bones)if(!z.getParent()){z.getBindMatrix().multiplyToRef(u,v.TmpVectors.Matrix[1]),z._updateAbsoluteBindMatrices(v.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const u=4*(this.bones.length+1);z._transformMatrixTexture&&z._transformMatrixTexture.getSize().width===u||(z._transformMatrixTexture&&z._transformMatrixTexture.dispose(),z._transformMatrixTexture=d.b.CreateRGBATexture(z._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(z._bonesTransformMatrices,u),this.isUsingTextureForMatrices&&z._transformMatrixTexture&&z._transformMatrixTexture.update(z._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=d.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let z=0;z<this.bones.length;z++)this._animatables.push(this.bones[z])}return this._animatables}clone(z,u){const U=new r(z,u||z,this._scene);U.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let J=0;J<this.bones.length;J++){const z=this.bones[J];let u=null;const v=z.getParent();if(v){const z=this.bones.indexOf(v);u=U.bones[z]}const f=new R.b(z.name,U,u,z.getBindMatrix().clone(),z.getRestMatrix().clone());f._index=z._index,z._linkedTransformNode&&f.linkTransformNode(z._linkedTransformNode),C.c.DeepCopy(z.animations,f.animations)}if(this._ranges){U._ranges={};for(const z in this._ranges){const u=this._ranges[z];u&&(U._ranges[z]=u.clone())}}return this._isDirty=!0,U.prepare(!0),U}enableBlending(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const u of this.bones)for(const U of u.animations)U.enableBlending=!0,U.blendingSpeed=z}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Vz().stopAnimation(this),this.Vz().removeSkeleton(this),this._parentContainer){const z=this._parentContainer.skeletons.indexOf(this);z>-1&&this._parentContainer.skeletons.splice(z,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const z={};z.name=this.name,z.id=this.id,this.dimensionsAtRest&&(z.dimensionsAtRest=this.dimensionsAtRest.jf()),z.bones=[],z.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let U=0;U<this.bones.length;U++){var u;const J=this.bones[U],v=J.getParent(),f={parentBoneIndex:v?this.bones.indexOf(v):-1,index:J.getIndex(),name:J.name,id:J.id,matrix:J.getBindMatrix().jf(),rest:J.getRestMatrix().jf(),linkedTransformNodeId:null===(u=J.getTransformNode())||void 0===u?void 0:u.id};z.bones.push(f),J.length&&(f.length=J.length),J.metadata&&(f.metadata=J.metadata),J.animations&&J.animations.length>0&&(f.animation=J.animations[0].serialize()),z.ranges=[];for(const u in this._ranges){const U=this._ranges[u];if(!U)continue;const J={};J.name=u,J.from=U.from,J.to=U.to,z.ranges.push(J)}}return z}static Parse(z,u){const U=new r(z.name,z.id,u);let J;for(z.dimensionsAtRest&&(U.dimensionsAtRest=v.Eu.Xu(z.dimensionsAtRest)),U.needInitialSkinMatrix=z.needInitialSkinMatrix,J=0;J<z.bones.length;J++){const u=z.bones[J],f=z.bones[J].index;let g=null;u.parentBoneIndex>-1&&(g=U.bones[u.parentBoneIndex]);const w=u.rest?v.Matrix.Xu(u.rest):null,P=new R.b(u.name,U,g,v.Matrix.Xu(u.matrix),w,null,f);void 0!==u.id&&null!==u.id&&(P.id=u.id),u.length&&(P.length=u.length),u.metadata&&(P.metadata=u.metadata),u.animation&&P.animations.push(mz.b.Parse(u.animation)),void 0!==u.linkedTransformNodeId&&null!==u.linkedTransformNodeId&&(U._hasWaitingData=!0,P._waitingTransformNodeId=u.linkedTransformNodeId)}if(z.ranges)for(J=0;J<z.ranges.length;J++){const u=z.ranges[J];U.createAnimationRange(u.name,u.from,u.to)}return U}computeAbsoluteMatrices(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||z)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(z)}getPoseMatrix(){let z=null;return this._meshesWithPoseMatrix.length>0&&(z=this._meshesWithPoseMatrix[0].getPoseMatrix()),z}sortBones(){const z=[],u=new Array(this.bones.length);for(let U=0;U<this.bones.length;U++)this._sortBones(U,z,u);this.bones=z}_sortBones(z,u,U){if(U[z])return;U[z]=!0;const J=this.bones[z];if(!J)return;void 0===J._index&&(J._index=z);const v=J.getParent();v&&this._sortBones(this.bones.indexOf(v),u,U),u.push(J)}setCurrentPoseAsRest(){for(const z of this.bones)z.setCurrentPoseAsRest()}}var M=U(13224),T=U(13369),X=U(12894),h=U(13314),t=U(13e3),V=U(13340),L=U(13320),O=U(13335),x=U(13419),Q=U(13014),K=U(14081);class Y{set areUpdatesFrozen(z){z?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new Q.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,z||(z=A.e.LastCreatedScene),this._scene=z,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const z=this._scene.getEngine().getCaps();this._canUseTextureForTargets=z.canUseGLVertexID&&z.textureFloat&&z.maxVertexTextureImageUnits>0&&z.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return Y.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?Y.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(z){this._numMaxInfluencers!==z&&(this._numMaxInfluencers=z,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(z){this._useTextureToStoreTargets!==z&&(this._useTextureToStoreTargets=z,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var z;return Y.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(z=this._scene)&&void 0!==z&&z.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(z){return this._activeTargets.data[z]}getTarget(z){return this._targets[z]}getTargetByName(z){for(const u of this._targets)if(u.name===z)return u;return null}addTarget(z){this._targets.push(z),this._targetInfluenceChangedObservers.push(z.onInfluenceChanged.add((z=>{this.areUpdatesFrozen&&z&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(z)}))),this._targetDataLayoutChangedObservers.push(z._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(z){const u=this._targets.indexOf(z);u>=0&&(this._targets.splice(u,1),z.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(u,1)[0]),z._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(u,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(z)}_bind(z){z.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),z.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),z.setTexture("morphTargets",this._targetStoreTexture),z.setInt("morphTargetCount",this.numInfluencers)}clone(){const z=new Y(this._scene);for(const u of this._targets)z.addTarget(u.clone());return z.enablePositionMorphing=this.enablePositionMorphing,z.enableNormalMorphing=this.enableNormalMorphing,z.enableTangentMorphing=this.enableTangentMorphing,z.enableUVMorphing=this.enableUVMorphing,z.enableUV2Morphing=this.enableUV2Morphing,z.enableColorMorphing=this.enableColorMorphing,z}serialize(){const z={};z.id=this.uniqueId,z.targets=[];for(const u of this._targets)z.targets.push(u.serialize());return z}_syncActiveTargets(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const u=!!this._targetStoreTexture,U=this.isUsingTextureForTargets;(this._mustSynchronize||u!==U)&&(this._mustSynchronize=!1,this.synchronize());let J=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let v=-1;for(const f of this._targets)if(v++,0!==f.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=Y.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(f),this._morphTargetTextureIndices[J]=v,this._tempInfluences[J++]=f.influence}this._morphTargetTextureIndices.length!==J&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,J)),this._influences&&this._influences.length===J||(this._influences=new Float32Array(J));for(let f=0;f<J;f++)this._influences[f]=this._tempInfluences[f];if(z&&this._scene)for(const f of this._scene.meshes)f.morphTargetManager===this&&(U?f._markSubMeshesAsAttributesDirty():f._syncGeometryWithMorphTargetManager())}synchronize(){var z;if(!this._scene||this.areUpdatesFrozen)return;const u=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(z=this._targetStoreTexture)||void 0===z||z.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>u.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const U of this._targets){this._supportsPositions=this._supportsPositions&&U.hasPositions,this._supportsNormals=this._supportsNormals&&U.hasNormals,this._supportsTangents=this._supportsTangents&&U.hasTangents,this._supportsUVs=this._supportsUVs&&U.hasUVs,this._supportsUV2s=this._supportsUV2s&&U.hasUV2s,this._supportsColors=this._supportsColors&&U.hasColors;const z=U.vertexCount;if(0===this._vertexCount)this._vertexCount=z;else if(this._vertexCount!==z)return void E.d.Error("Incompatible target. Targets must all have the same vertices count. Current vertex count: ".concat(this._vertexCount,', vertex count for target "').concat(U.name,'": ').concat(z))}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const z=u.getCaps().maxTextureSize;this._textureWidth>z&&(this._textureHeight=Math.ceil(this._textureWidth/z),this._textureWidth=z);const U=this._targets.length,J=new Float32Array(U*this._textureWidth*this._textureHeight*4);let v=0;for(let u=0;u<U;u++){const z=this._targets[u],U=z.getPositions(),f=z.getNormals(),g=z.getUVs(),w=z.getTangents(),P=z.getUV2s(),R=z.getColors();v=u*this._textureWidth*this._textureHeight*4;for(let u=0;u<this._vertexCount;u++)this._supportsPositions&&U&&(J[v]=U[3*u],J[v+1]=U[3*u+1],J[v+2]=U[3*u+2],v+=4),this._supportsNormals&&f&&(J[v]=f[3*u],J[v+1]=f[3*u+1],J[v+2]=f[3*u+2],v+=4),this._supportsUVs&&g&&(J[v]=g[2*u],J[v+1]=g[2*u+1],v+=4),this._supportsTangents&&w&&(J[v]=w[3*u],J[v+1]=w[3*u+1],J[v+2]=w[3*u+2],v+=4),this._supportsUV2s&&P&&(J[v]=P[2*u],J[v+1]=P[2*u+1],v+=4),this._supportsColors&&R&&(J[v]=R[4*u],J[v+1]=R[4*u+1],J[v+2]=R[4*u+2],J[v+3]=R[4*u+3],v+=4)}this._targetStoreTexture=K.e.CreateRGBATexture(J,this._textureWidth,this._textureHeight,U,this._scene,!1,!1,1,1),this._targetStoreTexture.name="Morph texture_".concat(this.uniqueId)}for(const U of this._scene.meshes)U.morphTargetManager===this&&U._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const z=this._parentContainer.morphTargetManagers.indexOf(this);z>-1&&this._parentContainer.morphTargetManagers.splice(z,1),this._parentContainer=null}for(const z of this._targets)this._scene.stopAnimation(z)}}static Parse(z,u){const U=new Y(u);for(const J of z.targets)U.addTarget(x.e.Parse(J,u));return U}}Y.EnableTextureStorage=!0,Y.MaxActiveMorphTargetsInVertexAttributeMode=8,Y.ConstantTargetCountForTextureMode=0;var p=U(14126),N=U(12800),D=U(13238);const c=new Map,W=c;function j(z,u,U){I(z)&&E.d.Warn("Extension with the name '".concat(z,"' already exists")),c.set(z,{isGLTFExtension:u,factory:U})}function I(z){return c.delete(z)}var F=U(14131),b=U(13460),k=U(13004);class B{static Get(z,u,U){if(!u||void 0==U||!u[U])throw new Error("".concat(z,": Failed to find index (").concat(U,")"));return u[U]}static TryGet(z,u){return z&&void 0!=u&&z[u]?z[u]:null}static Assign(z){if(z)for(let u=0;u<z.length;u++)z[u].index=u}}function y(z){if(z.min&&z.max){const u=z.min,U=z.max,J=v.TmpVectors.Eu[0].zg(u[0],u[1],u[2]),f=v.TmpVectors.Eu[1].zg(U[0],U[1],U[2]);if(z.normalized&&5126!==z.componentType){let u=1;switch(z.componentType){case 5120:u=127;break;case 5121:u=255;break;case 5122:u=32767;break;case 5123:u=65535}const U=1/u;J.scaleInPlace(U),f.scaleInPlace(U)}return new D.b(J,f)}return null}class H{static RegisterExtension(z,u){j(z,!1,u)}static UnregisterExtension(z){return I(z)}get Kf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(z){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=z}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((z=>z.dispose&&z.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(z,u,U,J,v,f){let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=u,this._assetContainer=U,this._loadData(J);let f=null;if(z){const u={};if(this._gltf.nodes)for(const z of this._gltf.nodes)z.name&&(u[z.name]=z.index);f=(z instanceof Array?z:[z]).map((z=>{const U=u[z];if(void 0===U)throw new Error("Failed to find node '".concat(z,"'"));return U}))}return await this._loadAsync(v,g,f,(()=>({meshes:this._getMeshes(),mA:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=z,this._loadData(u),await this._loadAsync(U,v,null,(()=>{}))}async _loadAsync(z,u,U,J){return await Promise.resolve().then((async()=>{this._rootUrl=z,this._uniqueRootUrl=!z.startsWith("file:")&&u?z:"".concat(z).concat(Date.now(),"/"),this._fileName=u,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const v="".concat(p.n[p.n.LOADING]," => ").concat(p.n[p.n.READY]),f="".concat(p.n[p.n.LOADING]," => ").concat(p.n[p.n.COMPLETE]);this._parent._startPerformanceCounter(v),this._parent._startPerformanceCounter(f),this._parent._setState(p.n.LOADING),this._extensionsOnLoading();const w=new Array;if(!this.parent.loadOnlyMaterials)if(U)w.push(this.loadSceneAsync("/nodes",{nodes:U,index:-1}));else if(void 0!=this._gltf.ru||this._gltf.scenes&&this._gltf.scenes[0]){const z=B.Get("/scene",this._gltf.scenes,this._gltf.ru||0);w.push(this.loadSceneAsync("/scenes/".concat(z.index),z))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let z=0;z<this._gltf.materials.length;++z){const u=this._gltf.materials[z],U="/materials/"+z,J=M.e.TriangleFillMode;w.push(this._loadMaterialAsync(U,u,null,J,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&w.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&w.push(this._compileShadowGeneratorsAsync());const P=Promise.all(w).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.QP(!0);for(const z of this._babylonScene.materials){const u=z;void 0!==u.maxSimultaneousLights&&(u.maxSimultaneousLights=Math.max(u.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(p.n.READY),this._skipStartAnimationStep||this._startAnimations(),J()}));return await P.then((z=>(this._parent._endPerformanceCounter(v),g.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(f),this._parent._setState(p.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(z=>{this._parent.onErrorObservable.notifyObservers(z),this._parent.onErrorObservable.clear(),this.dispose()}))})),z)))})).catch((z=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(z),this._parent.onErrorObservable.clear(),this.dispose()),z}))}_loadData(z){if(this._gltf=z.json,this._setupData(),z.bin){const u=this._gltf.buffers;if(u&&u[0]&&!u[0].uri){const U=u[0];(U.byteLength<z.bin.byteLength-3||U.byteLength>z.bin.byteLength)&&E.d.Warn("Binary buffer length (".concat(U.byteLength,") from JSON does not match chunk length (").concat(z.bin.byteLength,")")),this._bin=z.bin}else E.d.Warn("Unexpected BIN chunk")}}_setupData(){if(B.Assign(this._gltf.accessors),B.Assign(this._gltf.animations),B.Assign(this._gltf.buffers),B.Assign(this._gltf.bufferViews),B.Assign(this._gltf.cameras),B.Assign(this._gltf.images),B.Assign(this._gltf.materials),B.Assign(this._gltf.meshes),B.Assign(this._gltf.nodes),B.Assign(this._gltf.samplers),B.Assign(this._gltf.scenes),B.Assign(this._gltf.skins),B.Assign(this._gltf.textures),this._gltf.nodes){const z={};for(const U of this._gltf.nodes)if(U.children)for(const u of U.children)z[u]=U.index;const u=this._createRootNode();for(const U of this._gltf.nodes){const J=z[U.index];U.parent=void 0===J?u:this._gltf.nodes[J]}}}async _loadExtensionsAsync(){const z=[];if(W.forEach(((u,U)=>{var J;!1===(null===(J=this.parent.extensionOptions[U])||void 0===J?void 0:J.enabled)?u.isGLTFExtension&&this.isExtensionUsed(U)&&E.d.Warn("Extension ".concat(U," is used but has been explicitly disabled.")):u.isGLTFExtension&&!this.isExtensionUsed(U)||z.push((async()=>{const z=await u.factory(this);return z.name!==U&&E.d.Warn("The name of the glTF loader extension instance does not match the registered name: ".concat(z.name," !== ").concat(U)),this._parent.onExtensionLoadedObservable.notifyObservers(z),z})())})),this._extensions.push(...await Promise.all(z)),this._extensions.sort(((z,u)=>(z.order||Number.MAX_VALUE)-(u.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const U of this._gltf.extensionsRequired){if(!this._extensions.some((z=>z.name===U&&z.enabled))){var u;if(!1===(null===(u=this.parent.extensionOptions[U])||void 0===u?void 0:u.enabled))throw new Error("Required extension ".concat(U," is disabled"));throw new Error("Required extension ".concat(U," is not available"))}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new O.e("__root__",this._babylonScene);this._rootBabylonMesh=z,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.QP(!1);const u={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case p.j.AUTO:this._babylonScene.useRightHandedSystem||(u.rotation=[0,1,0,0],u.scale=[1,1,-1],H._LoadTransform(u,this._rootBabylonMesh));break;case p.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode (".concat(this._parent.coordinateSystemMode,")"))}return this._parent.onMeshLoadedObservable.notifyObservers(z),u}loadSceneAsync(z,u){const U=this._extensionsLoadSceneAsync(z,u);if(U)return U;const J=new Array;if(this.logOpen("".concat(z," ").concat(u.name||"")),u.nodes)for(const v of u.nodes){const u=B.Get("".concat(z,"/nodes/").concat(v),this._gltf.nodes,v);J.push(this.loadNodeAsync("/nodes/".concat(u.index),u,(z=>{z.parent=this._rootBabylonMesh})))}for(const v of this._postSceneLoadActions)v();return J.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(J).then((()=>{}))}_forEachPrimitive(z,u){if(z._primitiveBabylonMeshes)for(const U of z._primitiveBabylonMeshes)u(U)}_getGeometries(){const z=[],u=this._gltf.nodes;if(u)for(const U of u)this._forEachPrimitive(U,(u=>{const U=u.nf;U&&-1===z.indexOf(U)&&z.push(U)}));return z}_getMeshes(){const z=[];this._rootBabylonMesh instanceof L.d&&z.push(this._rootBabylonMesh);const u=this._gltf.nodes;if(u)for(const U of u)this._forEachPrimitive(U,(u=>{z.push(u)}));return z}_getTransformNodes(){const z=[],u=this._gltf.nodes;if(u)for(const U of u)U._babylonTransformNode&&"Ym"===U._babylonTransformNode.getClassName()&&z.push(U._babylonTransformNode),U._babylonTransformNodeForSkin&&z.push(U._babylonTransformNodeForSkin);return z}_getSkeletons(){const z=[],u=this._gltf.skins;if(u)for(const U of u)U._data&&z.push(U._data.babylonSkeleton);return z}_getAnimationGroups(){const z=[],u=this._gltf.animations;if(u)for(const U of u)U._babylonAnimationGroup&&z.push(U._babylonAnimationGroup);return z}_startAnimations(){switch(this._parent.animationStartMode){case p.f.NONE:break;case p.f.FIRST:{const z=this._getAnimationGroups();0!==z.length&&z[0].start(!0);break}case p.f.ALL:{const z=this._getAnimationGroups();for(const u of z)u.start(!0);break}default:return void E.d.Error("Invalid animation start mode (".concat(this._parent.animationStartMode,")"))}}loadNodeAsync(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadNodeAsync(z,u,U);if(J)return J;if(u._babylonTransformNode)throw new Error("".concat(z,": Invalid recursive node hierarchy"));const v=new Array;this.logOpen("".concat(z," ").concat(u.name||""));const f=J=>{if(H.AddPointerMetadata(J,z),H._LoadTransform(u,J),void 0!=u.camera){const U=B.Get("".concat(z,"/camera"),this._gltf.cameras,u.camera);v.push(this.loadCameraAsync("/cameras/".concat(U.index),U,(z=>{z.parent=J,this._babylonScene.useRightHandedSystem||(J.Ug.x=-1)})))}if(u.children)for(const U of u.children){const u=B.Get("".concat(z,"/children/").concat(U),this._gltf.nodes,U);v.push(this.loadNodeAsync("/nodes/".concat(u.index),u,(z=>{z.parent=J})))}U(J)},g=void 0!=u.mesh,w=this._parent.loadSkins&&void 0!=u.skin;if(!g||w){const z=u.name||"node".concat(u.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new h.c(z,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==u.mesh?u._babylonTransformNode=U:u._babylonTransformNodeForSkin=U,f(U)}if(g)if(w){const U=B.Get("".concat(z,"/mesh"),this._gltf.meshes,u.mesh);v.push(this._loadMeshAsync("/meshes/".concat(U.index),u,U,(U=>{const J=u._babylonTransformNodeForSkin;U.metadata=(0,b.d)(J.metadata,U.metadata||{});const f=B.Get("".concat(z,"/skin"),this._gltf.skins,u.skin);v.push(this._loadSkinAsync("/skins/".concat(f.index),u,f,(z=>{this._forEachPrimitive(u,(u=>{u.skeleton=z})),this._postSceneLoadActions.push((()=>{if(void 0!=f.skeleton){const z=B.Get("/skins/".concat(f.index,"/skeleton"),this._gltf.nodes,f.skeleton).parent;u.index===z.index?U.parent=J.parent:U.parent=z._babylonTransformNode}else U.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:J,skinnedNode:U})}))})))})))}else{const U=B.Get("".concat(z,"/mesh"),this._gltf.meshes,u.mesh);v.push(this._loadMeshAsync("/meshes/".concat(U.index),u,U,f))}return this.logClose(),Promise.all(v).then((()=>(this._forEachPrimitive(u,(z=>{const u=z;!u.isAnInstance&&u.nf&&u.nf.useBoundingInfoFromGeometry?z.Dz():z.refreshBoundingInfo(!0,!0)})),u._babylonTransformNode)))}_loadMeshAsync(z,u,U,J){const v=U.primitives;if(!v||!v.length)throw new Error("".concat(z,": Primitives are missing"));void 0==v[0].index&&B.Assign(v);const f=new Array;this.logOpen("".concat(z," ").concat(U.name||""));const g=u.name||"node".concat(u.index);if(1===v.length){const J=U.primitives[0];f.push(this._loadMeshPrimitiveAsync("".concat(z,"/primitives/").concat(J.index),g,u,U,J,(z=>{u._babylonTransformNode=z,u._primitiveBabylonMeshes=[z]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,u._babylonTransformNode=new h.c(g,this._babylonScene),u._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u._primitiveBabylonMeshes=[];for(const J of v)f.push(this._loadMeshPrimitiveAsync("".concat(z,"/primitives/").concat(J.index),"".concat(g,"_primitive").concat(J.index),u,U,J,(z=>{z.parent=u._babylonTransformNode,u._primitiveBabylonMeshes.push(z)})))}return J(u._babylonTransformNode),this.logClose(),Promise.all(f).then((()=>u._babylonTransformNode))}_loadMeshPrimitiveAsync(z,u,U,J,v,f){const g=this._extensionsLoadMeshPrimitiveAsync(z,u,U,J,v,f);if(g)return g;this.logOpen("".concat(z));const w=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==U.skin&&!J.primitives[0].targets;let P,R;if(w&&v._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,P=v._instanceData.babylonSourceMesh.createInstance(u),P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R=v._instanceData.promise;else{const f=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new O.e(u,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.sideOrientation=this._babylonScene.useRightHandedSystem?M.e.CounterClockWiseSideOrientation:M.e.ClockWiseSideOrientation,this._createMorphTargets(z,U,J,v,g),f.push(this._loadVertexDataAsync(z,v,g).then((async u=>await this._loadMorphTargetsAsync(z,v,g,u).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,u.pz(g),u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const S=H._GetDrawMode(z,v.mode);if(void 0==v.material){let z=this._defaultBabylonMaterialData[S];z||(z=this._createDefaultMaterial("__GLTFLoader._default",S),this._parent.onMaterialLoadedObservable.notifyObservers(z),this._defaultBabylonMaterialData[S]=z),g.material=z}else if(!this.parent.skipMaterials){const u=B.Get("".concat(z,"/material"),this._gltf.materials,v.material);f.push(this._loadMaterialAsync("/materials/".concat(u.index),u,g,S,(z=>{g.material=z})))}R=Promise.all(f),w&&(v._instanceData={babylonSourceMesh:g,promise:R}),P=g}return H.AddPointerMetadata(P,z),this._parent.onMeshLoadedObservable.notifyObservers(P),f(P),this.logClose(),R.then((()=>P))}_loadVertexDataAsync(z,u,U){const J=this._extensionsLoadVertexDataAsync(z,u,U);if(J)return J;const v=u.attributes;if(!v)throw new Error("".concat(z,": Attributes are missing"));const f=new Array,g=new V.d(U.name,this._babylonScene);if(void 0==u.indices)U.isUnIndexed=!0;else{const U=B.Get("".concat(z,"/indices"),this._gltf.accessors,u.indices);f.push(this._loadIndicesAccessorAsync("/accessors/".concat(U.index),U).then((z=>{g.setIndices(z)})))}const w=(u,J,w)=>{if(void 0==v[u])return;U._delayInfo=U._delayInfo||[],-1===U._delayInfo.indexOf(J)&&U._delayInfo.push(J);const P=B.Get("".concat(z,"/attributes/").concat(u),this._gltf.accessors,v[u]);f.push(this._loadVertexAccessorAsync("/accessors/".concat(P.index),P,J).then((z=>{if(z.getKind()===t.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!U.skeleton){const z=y(P);z&&(g._boundingInfo=z,g.useBoundingInfoFromGeometry=!0)}g.setVerticesBuffer(z,P.count)}))),J==t.g.MatricesIndicesExtraKind&&(U.numBoneInfluencers=8),w&&w(P)};return w("POSITION",t.g.PositionKind),w("NORMAL",t.g.NormalKind),w("TANGENT",t.g.TangentKind),w("TEXCOORD_0",t.g.UVKind),w("TEXCOORD_1",t.g.UV2Kind),w("TEXCOORD_2",t.g.UV3Kind),w("TEXCOORD_3",t.g.UV4Kind),w("TEXCOORD_4",t.g.UV5Kind),w("TEXCOORD_5",t.g.UV6Kind),w("JOINTS_0",t.g.MatricesIndicesKind),w("WEIGHTS_0",t.g.MatricesWeightsKind),w("JOINTS_1",t.g.MatricesIndicesExtraKind),w("WEIGHTS_1",t.g.MatricesWeightsExtraKind),w("COLOR_0",t.g.ColorKind,(z=>{"VEC4"===z.type&&(U.hasVertexAlpha=!0)})),Promise.all(f).then((()=>g))}_createMorphTargets(z,u,U,J,v){if(!J.targets||!this._parent.loadMorphTargets)return;if(void 0==u._numMorphTargets)u._numMorphTargets=J.targets.length;else if(J.targets.length!==u._numMorphTargets)throw new Error("".concat(z,": Primitives do not have the same number of targets"));const f=U.extras?U.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,v.morphTargetManager=new Y(this._babylonScene),v.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v.morphTargetManager.areUpdatesFrozen=!0;for(let g=0;g<J.targets.length;g++){const z=u.weights?u.weights[g]:U.weights?U.weights[g]:0,J=f?f[g]:"morphTarget".concat(g);v.morphTargetManager.addTarget(new x.e(J,z,v.Vz()))}}_loadMorphTargetsAsync(z,u,U,J){if(!u.targets||!this._parent.loadMorphTargets)return Promise.resolve();const v=new Array,f=U.morphTargetManager;for(let g=0;g<f.numTargets;g++){const U=f.getTarget(g);v.push(this._loadMorphTargetVertexDataAsync("".concat(z,"/targets/").concat(g),J,u.targets[g],U))}return Promise.all(v).then((()=>{f.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(z,u,U,J){const v=new Array,f=(J,f,g)=>{if(void 0==U[J])return;const w=u.getVertexBuffer(f);if(!w)return;const P=B.Get("".concat(z,"/").concat(J),this._gltf.accessors,U[J]);v.push(this._loadFloatAccessorAsync("/accessors/".concat(P.index),P).then((z=>{g(w,z)})))};return f("POSITION",t.g.PositionKind,((z,u)=>{const U=new Float32Array(u.length);z.forEach(u.length,((z,J)=>{U[J]=u[J]+z})),J.setPositions(U)})),f("NORMAL",t.g.NormalKind,((z,u)=>{const U=new Float32Array(u.length);z.forEach(U.length,((z,J)=>{U[J]=u[J]+z})),J.setNormals(U)})),f("TANGENT",t.g.TangentKind,((z,u)=>{const U=new Float32Array(u.length/3*4);let v=0;z.forEach(u.length/3*4,((z,J)=>{(J+1)%4!==0&&(U[v]=u[v]+z,v++)})),J.setTangents(U)})),f("TEXCOORD_0",t.g.UVKind,((z,u)=>{const U=new Float32Array(u.length);z.forEach(u.length,((z,J)=>{U[J]=u[J]+z})),J.setUVs(U)})),f("TEXCOORD_1",t.g.UV2Kind,((z,u)=>{const U=new Float32Array(u.length);z.forEach(u.length,((z,J)=>{U[J]=u[J]+z})),J.setUV2s(U)})),f("COLOR_0",t.g.ColorKind,((u,U)=>{let v=null;const f=u.getSize();if(3===f){v=new Float32Array(U.length/3*4),u.forEach(U.length,((z,u)=>{const J=Math.floor(u/3),f=u%3;v[4*J+f]=U[3*J+f]+z}));for(let z=0;z<U.length/3;++z)v[4*z+3]=1}else{if(4!==f)throw new Error("".concat(z,": Invalid number of components (").concat(f,") for COLOR_0 attribute"));v=new Float32Array(U.length),u.forEach(U.length,((z,u)=>{v[u]=U[u]+z}))}J.setColors(v)})),await Promise.all(v).then((()=>{}))}static _LoadTransform(z,u){if(void 0!=z.skin)return;let U=v.Eu.Zero(),J=v.Quaternion.Identity(),f=v.Eu.One();if(z.matrix){v.Matrix.Xu(z.matrix).decompose(f,J,U)}else z.translation&&(U=v.Eu.Xu(z.translation)),z.rotation&&(J=v.Quaternion.Xu(z.rotation)),z.scale&&(f=v.Eu.Xu(z.scale));u.position=U,u.rotationQuaternion=J,u.Ug=f}_loadSkinAsync(z,u,U,J){if(!this._parent.loadSkins)return Promise.resolve();const v=this._extensionsLoadSkinAsync(z,u,U);if(v)return v;if(U._data)return J(U._data.babylonSkeleton),U._data.promise;const f="skeleton".concat(U.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new r(U.name||f,f,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(z,U,g);const w=this._loadSkinInverseBindMatricesDataAsync(z,U).then((z=>{this._updateBoneMatrices(g,z)}));return U._data={babylonSkeleton:g,promise:w},J(g),w}_loadBones(z,u,U){if(void 0==u.skeleton||this._parent.alwaysComputeSkeletonRootNode){const U=this._findSkeletonRootNode("".concat(z,"/joints"),u.joints);if(U)if(void 0===u.skeleton)u.skeleton=U.index;else{const J=(z,u)=>{for(;u.parent;u=u.parent)if(u.parent===z)return!0;return!1},v=B.Get("".concat(z,"/skeleton"),this._gltf.nodes,u.skeleton);v===U||J(v,U)||(E.d.Warn("".concat(z,"/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root")),u.skeleton=U.index)}else E.d.Warn("".concat(z,": Failed to find common root"))}const J={};for(const v of u.joints){const f=B.Get("".concat(z,"/joints/").concat(v),this._gltf.nodes,v);this._loadBone(f,u,U,J)}}_findSkeletonRootNode(z,u){if(0===u.length)return null;const U={};for(const v of u){const u=[];let J=B.Get("".concat(z,"/").concat(v),this._gltf.nodes,v);for(;-1!==J.index;)u.unshift(J),J=J.parent;U[v]=u}let J=null;for(let v=0;;++v){let z=U[u[0]];if(v>=z.length)return J;const f=z[v];for(let g=1;g<u.length;++g)if(z=U[u[g]],v>=z.length||f!==z[v])return J;J=f}}_loadBone(z,u,U,J){z._isJoint=!0;let v=J[z.index];if(v)return v;let f=null;z.index!==u.skeleton&&(z.parent&&-1!==z.parent.index?f=this._loadBone(z.parent,u,U,J):void 0!==u.skeleton&&E.d.Warn("/skins/".concat(u.index,"/skeleton: Skeleton node is not a common root")));const g=u.joints.indexOf(z.index);return v=new R.b(z.name||"joint".concat(z.index),U,f,this._getNodeMatrix(z),null,null,g),J[z.index]=v,this._postSceneLoadActions.push((()=>{v.linkTransformNode(z._babylonTransformNode)})),v}_loadSkinInverseBindMatricesDataAsync(z,u){if(void 0==u.inverseBindMatrices)return Promise.resolve(null);const U=B.Get("".concat(z,"/inverseBindMatrices"),this._gltf.accessors,u.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/".concat(U.index),U)}_updateBoneMatrices(z,u){for(const U of z.bones){const z=v.Matrix.Identity(),J=U._index;u&&-1!==J&&(v.Matrix.FromArrayToRef(u,16*J,z),z.invertToRef(z));const f=U.getParent();f&&z.multiplyToRef(f.getAbsoluteInverseBindMatrix(),z),U.Gf(z,!1,!1),U._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(z){return z.matrix?v.Matrix.Xu(z.matrix):v.Matrix.Compose(z.scale?v.Eu.Xu(z.scale):v.Eu.One(),z.rotation?v.Quaternion.Xu(z.rotation):v.Quaternion.Identity(),z.translation?v.Eu.Xu(z.translation):v.Eu.Zero())}loadCameraAsync(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadCameraAsync(z,u,U);if(J)return J;const f=new Array;this.logOpen("".concat(z," ").concat(u.name||"")),this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new P.e(u.name||"camera".concat(u.index),v.Eu.Zero(),this._babylonScene,!1);switch(g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u._babylonCamera=g,g.setTarget(new v.Eu(0,0,-1)),u.type){case"perspective":{const U=u.perspective;if(!U)throw new Error("".concat(z,": Camera perspective properties are missing"));g.fov=U.yfov,g.Bf=U.znear,g.maxZ=U.zfar||0;break}case"orthographic":if(!u.orthographic)throw new Error("".concat(z,": Camera orthographic properties are missing"));g.mode=w.b.ORTHOGRAPHIC_CAMERA,g.orthoLeft=-u.orthographic.xmag,g.orthoRight=u.orthographic.xmag,g.orthoBottom=-u.orthographic.ymag,g.orthoTop=u.orthographic.ymag,g.Bf=u.orthographic.znear,g.maxZ=u.orthographic.zfar;break;default:throw new Error("".concat(z,": Invalid camera type (").concat(u.type,")"))}return H.AddPointerMetadata(g,z),this._parent.onCameraLoadedObservable.notifyObservers(g),U(g),this.logClose(),Promise.all(f).then((()=>g))}_loadAnimationsAsync(){const z=this._gltf.animations;if(!z)return Promise.resolve();const u=new Array;for(let U=0;U<z.length;U++){const J=z[U];u.push(this.loadAnimationAsync("/animations/".concat(J.index),J).then((z=>{0===z.targetedAnimations.length&&z.dispose()})))}return Promise.all(u).then((()=>{}))}loadAnimationAsync(z,u){const J=this._extensionsLoadAnimationAsync(z,u);return J||U.e(78).then(U.bind(U,15654)).then((U=>{let{AnimationGroup:J}=U;this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new J(u.name||"animation".concat(u.index),this._babylonScene);v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u._babylonAnimationGroup=v;const f=new Array;B.Assign(u.channels),B.Assign(u.samplers);for(const g of u.channels)f.push(this._loadAnimationChannelAsync("".concat(z,"/channels/").concat(g.index),z,u,g,((z,u)=>{z.animations=z.animations||[],z.animations.push(u),v.addTargetedAnimation(u,z)})));return Promise.all(f).then((()=>(v.normalize(0),v)))}))}async _loadAnimationChannelAsync(z,u,J,v,f){const g=this._extensionsLoadAnimationChannelAsync(z,u,J,v,f);if(g)return await g;if(void 0==v.target.node)return await Promise.resolve();const w=B.Get("".concat(z,"/target/node"),this._gltf.nodes,v.target.node),P=v.target.path,R="weights"===P;if(R&&!w._numMorphTargets||!R&&!w._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!R&&!w._isJoint)return await Promise.resolve();let S;switch(await Promise.resolve().then(U.bind(U,14141)),P){case"translation":var d;S=null===(d=(0,F.g)("/nodes/{}/translation"))||void 0===d?void 0:d.interpolation;break;case"rotation":var mz;S=null===(mz=(0,F.g)("/nodes/{}/rotation"))||void 0===mz?void 0:mz.interpolation;break;case"scale":var Z;S=null===(Z=(0,F.g)("/nodes/{}/scale"))||void 0===Z?void 0:Z.interpolation;break;case"weights":var A;S=null===(A=(0,F.g)("/nodes/{}/weights"))||void 0===A?void 0:A.interpolation;break;default:throw new Error("".concat(z,"/target/path: Invalid value (").concat(v.target.path,")"))}if(!S)throw new Error("".concat(z,"/target/path: Could not find interpolation properties for target path (").concat(v.target.path,")"));const E={object:w,info:S};return await this._loadAnimationChannelFromTargetInfoAsync(z,u,J,v,E,f)}_loadAnimationChannelFromTargetInfoAsync(z,u,U,J,v,f){const g=this.parent.targetFps,w=1/g,P=B.Get("".concat(z,"/sampler"),U.samplers,J.sampler);return this._loadAnimationSamplerAsync("".concat(u,"/samplers/").concat(J.sampler),P).then((z=>{let u=0;const P=v.object,R=v.info;for(const v of R){const R=v.getStride(P),S=z.input,d=z.output,mz=new Array(S.length);let Z=0;switch(z.interpolation){case"STEP":for(let z=0;z<S.length;z++){const u=v.getValue(P,d,Z,1);Z+=R,mz[z]={frame:S[z]*g,value:u,interpolation:1}}break;case"CUBICSPLINE":for(let z=0;z<S.length;z++){const u=v.getValue(P,d,Z,w);Z+=R;const U=v.getValue(P,d,Z,1);Z+=R;const J=v.getValue(P,d,Z,w);Z+=R,mz[z]={frame:S[z]*g,inTangent:u,value:U,outTangent:J}}break;case"LINEAR":for(let z=0;z<S.length;z++){const u=v.getValue(P,d,Z,1);Z+=R,mz[z]={frame:S[z]*g,value:u}}}if(Z>0){const z="".concat(U.name||"animation".concat(U.index),"_channel").concat(J.index,"_").concat(u),w=v.buildAnimations(P,z,g,mz);for(const U of w)u++,f(U.babylonAnimatable,U.babylonAnimation)}}}))}_loadAnimationSamplerAsync(z,u){if(u._data)return u._data;const U=u.interpolation||"LINEAR";switch(U){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error("".concat(z,"/interpolation: Invalid value (").concat(u.interpolation,")"))}const J=B.Get("".concat(z,"/input"),this._gltf.accessors,u.input),v=B.Get("".concat(z,"/output"),this._gltf.accessors,u.output);return u._data=Promise.all([this._loadFloatAccessorAsync("/accessors/".concat(J.index),J),this._loadFloatAccessorAsync("/accessors/".concat(v.index),v)]).then((z=>{let[u,J]=z;return{input:u,interpolation:U,output:J}})),u._data}loadBufferAsync(z,u,U,J){const v=this._extensionsLoadBufferAsync(z,u,U,J);if(v)return v;if(!u._data)if(u.uri)u._data=this.loadUriAsync("".concat(z,"/uri"),u,u.uri);else{if(!this._bin)throw new Error("".concat(z,": Uri is missing or the binary glTF is missing its binary chunk"));u._data=this._bin.readAsync(0,u.byteLength)}return u._data.then((u=>{try{return new Uint8Array(u.buffer,u.byteOffset+U,J)}catch(v){throw new Error("".concat(z,": ").concat(v.message))}}))}loadBufferViewAsync(z,u){const U=this._extensionsLoadBufferViewAsync(z,u);if(U)return U;if(u._data)return u._data;const J=B.Get("".concat(z,"/buffer"),this._gltf.buffers,u.buffer);return u._data=this.loadBufferAsync("/buffers/".concat(J.index),J,u.byteOffset||0,u.byteLength),u._data}_loadAccessorAsync(z,u,U){if(u._data)return u._data;const J=H._GetNumComponents(z,u.type),v=J*t.g.GetTypeByteLength(u.componentType),f=J*u.count;if(void 0==u.bufferView)u._data=Promise.resolve(new U(f));else{const g=B.Get("".concat(z,"/bufferView"),this._gltf.bufferViews,u.bufferView);u._data=this.loadBufferViewAsync("/bufferViews/".concat(g.index),g).then((w=>{if(5126!==u.componentType||u.normalized||g.byteStride&&g.byteStride!==v){const z=new U(f);return t.g.ForEach(w,u.byteOffset||0,g.byteStride||v,J,u.componentType,z.length,u.normalized||!1,((u,U)=>{z[U]=u})),z}return H._GetTypedArray(z,u.componentType,w,u.byteOffset,f)}))}if(u.sparse){const f=u.sparse;u._data=u._data.then((g=>{const w=g,P=B.Get("".concat(z,"/sparse/indices/bufferView"),this._gltf.bufferViews,f.indices.bufferView),R=B.Get("".concat(z,"/sparse/values/bufferView"),this._gltf.bufferViews,f.values.bufferView);return Promise.all([this.loadBufferViewAsync("/bufferViews/".concat(P.index),P),this.loadBufferViewAsync("/bufferViews/".concat(R.index),R)]).then((g=>{let[P,R]=g;const S=H._GetTypedArray("".concat(z,"/sparse/indices"),f.indices.componentType,P,f.indices.byteOffset,f.count),d=J*f.count;let mz;if(5126!==u.componentType||u.normalized){const g=H._GetTypedArray("".concat(z,"/sparse/values"),u.componentType,R,f.values.byteOffset,d);mz=new U(d),t.g.ForEach(g,0,v,J,u.componentType,mz.length,u.normalized||!1,((z,u)=>{mz[u]=z}))}else mz=H._GetTypedArray("".concat(z,"/sparse/values"),u.componentType,R,f.values.byteOffset,d);let Z=0;for(let z=0;z<S.length;z++){let u=S[z]*J;for(let z=0;z<J;z++)w[u++]=mz[Z++]}return w}))}))}return u._data}_loadFloatAccessorAsync(z,u){return this._loadAccessorAsync(z,u,Float32Array)}_loadIndicesAccessorAsync(z,u){if("SCALAR"!==u.type)throw new Error("".concat(z,"/type: Invalid value ").concat(u.type));if(5121!==u.componentType&&5123!==u.componentType&&5125!==u.componentType)throw new Error("".concat(z,"/componentType: Invalid value ").concat(u.componentType));if(u._data)return u._data;if(u.sparse){const U=H._GetTypedArrayConstructor("".concat(z,"/componentType"),u.componentType);u._data=this._loadAccessorAsync(z,u,U)}else{const U=B.Get("".concat(z,"/bufferView"),this._gltf.bufferViews,u.bufferView);u._data=this.loadBufferViewAsync("/bufferViews/".concat(U.index),U).then((U=>H._GetTypedArray(z,u.componentType,U,u.byteOffset,u.count)))}return u._data}_loadVertexBufferViewAsync(z){if(z._babylonBuffer)return z._babylonBuffer;const u=this._babylonScene.getEngine();return z._babylonBuffer=this.loadBufferViewAsync("/bufferViews/".concat(z.index),z).then((z=>new t.e(u,z,!1))),z._babylonBuffer}_loadVertexAccessorAsync(z,u,U){var J;if(null!==(J=u._babylonVertexBuffer)&&void 0!==J&&J[U])return u._babylonVertexBuffer[U];u._babylonVertexBuffer||(u._babylonVertexBuffer={});const v=this._babylonScene.getEngine();if(u.sparse||void 0==u.bufferView)u._babylonVertexBuffer[U]=this._loadFloatAccessorAsync(z,u).then((z=>new t.g(v,z,U,!1)));else{const J=B.Get("".concat(z,"/bufferView"),this._gltf.bufferViews,u.bufferView);u._babylonVertexBuffer[U]=this._loadVertexBufferViewAsync(J).then((f=>{const g=H._GetNumComponents(z,u.type);return new t.g(v,f,U,!1,void 0,J.byteStride,void 0,u.byteOffset,g,u.componentType,u.normalized,!0,void 0,!0)}))}return u._babylonVertexBuffer[U]}_loadMaterialMetallicRoughnessPropertiesAsync(z,u,U){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));const J=new Array;return u&&(u.baseColorFactor?(U.albedoColor=f.Tu.Xu(u.baseColorFactor),U.alpha=u.baseColorFactor[3]):U.albedoColor=f.Tu.White(),U.metallic=void 0==u.metallicFactor?1:u.metallicFactor,U.roughness=void 0==u.roughnessFactor?1:u.roughnessFactor,u.baseColorTexture&&J.push(this.loadTextureInfoAsync("".concat(z,"/baseColorTexture"),u.baseColorTexture,(z=>{z.name="".concat(U.name," (Base Color)"),U.albedoTexture=z}))),u.metallicRoughnessTexture&&(u.metallicRoughnessTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync("".concat(z,"/metallicRoughnessTexture"),u.metallicRoughnessTexture,(z=>{z.name="".concat(U.name," (Metallic Roughness)"),U.metallicTexture=z}))),U.useMetallnessFromMetallicTextureBlue=!0,U.useRoughnessFromMetallicTextureGreen=!0,U.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(J).then((()=>{}))}_loadMaterialAsync(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const f=this._extensionsLoadMaterialAsync(z,u,U,J,v);if(f)return f;u._data=u._data||{};let g=u._data[J];if(!g){this.logOpen("".concat(z," ").concat(u.name||""));const U=this.createMaterial(z,u,J);g={babylonMaterial:U,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(z,u,U)},u._data[J]=g,H.AddPointerMetadata(U,z),this._parent.onMaterialLoadedObservable.notifyObservers(U),this.logClose()}return U&&(g.babylonMeshes.push(U),U.Xf.addOnce((()=>{const z=g.babylonMeshes.indexOf(U);-1!==z&&g.babylonMeshes.splice(z,1)}))),v(g.babylonMaterial),g.promise.then((()=>g.babylonMaterial))}_createDefaultMaterial(z,u){this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new T.e(z,this._babylonScene);return U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.fillMode=u,U.enableSpecularAntiAliasing=!0,U.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,U.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,U.transparencyMode=T.e.PBRMATERIAL_OPAQUE,U.metallic=1,U.roughness=1,U}createMaterial(z,u,U){const J=this._extensionsCreateMaterial(z,u,U);if(J)return J;const v=u.name||"material".concat(u.index);return this._createDefaultMaterial(v,U)}loadMaterialPropertiesAsync(z,u,U){const J=this._extensionsLoadMaterialPropertiesAsync(z,u,U);if(J)return J;const v=new Array;return v.push(this.loadMaterialBasePropertiesAsync(z,u,U)),u.pbrMetallicRoughness&&v.push(this._loadMaterialMetallicRoughnessPropertiesAsync("".concat(z,"/pbrMetallicRoughness"),u.pbrMetallicRoughness,U)),this.loadMaterialAlphaProperties(z,u,U),Promise.all(v).then((()=>{}))}loadMaterialBasePropertiesAsync(z,u,U){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));const J=new Array;return U.emissiveColor=u.emissiveFactor?f.Tu.Xu(u.emissiveFactor):new f.Tu(0,0,0),u.doubleSided&&(U.ef=!1,U.twoSidedLighting=!0),u.normalTexture&&(u.normalTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync("".concat(z,"/normalTexture"),u.normalTexture,(z=>{z.name="".concat(U.name," (Normal)"),U.bumpTexture=z}))),U.invertNormalMapX=!this._babylonScene.useRightHandedSystem,U.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=u.normalTexture.scale&&U.bumpTexture&&(U.bumpTexture.level=u.normalTexture.scale),U.forceIrradianceInFragment=!0),u.occlusionTexture&&(u.occlusionTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync("".concat(z,"/occlusionTexture"),u.occlusionTexture,(z=>{z.name="".concat(U.name," (Occlusion)"),U.ambientTexture=z}))),U.useAmbientInGrayScale=!0,void 0!=u.occlusionTexture.strength&&(U.ambientTextureStrength=u.occlusionTexture.strength)),u.emissiveTexture&&J.push(this.loadTextureInfoAsync("".concat(z,"/emissiveTexture"),u.emissiveTexture,(z=>{z.name="".concat(U.name," (Emissive)"),U.emissiveTexture=z}))),Promise.all(J).then((()=>{}))}loadMaterialAlphaProperties(z,u,U){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));switch(u.alphaMode||"OPAQUE"){case"OPAQUE":U.transparencyMode=T.e.PBRMATERIAL_OPAQUE,U.alpha=1;break;case"MASK":U.transparencyMode=T.e.PBRMATERIAL_ALPHATEST,U.alphaCutOff=void 0==u.alphaCutoff?.5:u.alphaCutoff,U.albedoTexture&&(U.albedoTexture.kf=!0);break;case"BLEND":U.transparencyMode=T.e.PBRMATERIAL_ALPHABLEND,U.albedoTexture&&(U.albedoTexture.kf=!0,U.useAlphaFromAlbedoTexture=!0);break;default:throw new Error("".concat(z,"/alphaMode: Invalid value (").concat(u.alphaMode,")"))}}loadTextureInfoAsync(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadTextureInfoAsync(z,u,U);if(J)return J;if(this.logOpen("".concat(z)),u.texCoord>=6)throw new Error("".concat(z,"/texCoord: Invalid value (").concat(u.texCoord,")"));const v=B.Get("".concat(z,"/index"),this._gltf.textures,u.index);v._textureInfo=u;const f=this._loadTextureAsync("/textures/".concat(u.index),v,(J=>{J.coordinatesIndex=u.texCoord||0,H.AddPointerMetadata(J,z),this._parent.onTextureLoadedObservable.notifyObservers(J),U(J)}));return this.logClose(),f}_loadTextureAsync(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadTextureAsync(z,u,U);if(J)return J;this.logOpen("".concat(z," ").concat(u.name||""));const v=void 0==u.sampler?H.DefaultSampler:B.Get("".concat(z,"/sampler"),this._gltf.samplers,u.sampler),f=B.Get("".concat(z,"/source"),this._gltf.images,u.source),g=this._createTextureAsync(z,v,f,U,void 0,!u._textureInfo.nonColorData);return this.logClose(),g}_createTextureAsync(z,u,U){var v,f;let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},w=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0;const R=this._loadSampler("/samplers/".concat(u.index),u),S=new Array,d=new J;this._babylonScene._blockEntityCollection=!!this._assetContainer;const mz={noMipmap:R.noMipMaps,invertY:!1,samplingMode:R.samplingMode,G:()=>{this._disposed||d.resolve()},onError:(u,U)=>{this._disposed||d.reject(new Error("".concat(z,": ").concat(U&&U.message?U.message:u||"Failed to load texture")))},mimeType:null!==(v=U.mimeType)&&void 0!==v?v:(0,N.e)(null!==(f=U.uri)&&void 0!==f?f:""),loaderOptions:w,useSRGBBuffer:!!P&&this._parent.useSRGBBuffers},Z=new X.e(null,this._babylonScene,mz);return Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S.push(d.promise),S.push(this.loadImageAsync("/images/".concat(U.index),U).then((z=>{const u=U.uri||"".concat(this._fileName,"#image").concat(U.index),J="data:".concat(this._uniqueRootUrl).concat(u);Z.updateURL(J,z);const v=Z.getInternalTexture();v&&(v.label=U.name)}))),Z.wrapU=R.wrapU,Z.wrapV=R.wrapV,g(Z),this._parent.useGltfTextureNames&&(Z.name=U.name||U.uri||"image".concat(U.index)),Promise.all(S).then((()=>Z))}_loadSampler(z,u){return u._data||(u._data={noMipMaps:9728===u.minFilter||9729===u.minFilter,samplingMode:H._GetTextureSamplingMode(z,u),wrapU:H._GetTextureWrapMode("".concat(z,"/wrapS"),u.wrapS),wrapV:H._GetTextureWrapMode("".concat(z,"/wrapT"),u.wrapT)}),u._data}loadImageAsync(z,u){if(!u._data){if(this.logOpen("".concat(z," ").concat(u.name||"")),u.uri)u._data=this.loadUriAsync("".concat(z,"/uri"),u,u.uri);else{const U=B.Get("".concat(z,"/bufferView"),this._gltf.bufferViews,u.bufferView);u._data=this.loadBufferViewAsync("/bufferViews/".concat(U.index),U)}this.logClose()}return u._data}loadUriAsync(z,u,U){const J=this._extensionsLoadUriAsync(z,u,U);if(J)return J;if(!H._ValidateUri(U))throw new Error("".concat(z,": '").concat(U,"' is invalid"));if((0,N.i)(U)){const u=new Uint8Array((0,N.b)(U));return this.log("".concat(z,": Decoded ").concat(U.substring(0,64),"... (").concat(u.length," bytes)")),Promise.resolve(u)}return this.log("".concat(z,": Loading ").concat(U)),this._parent.preprocessUrlAsync(this._rootUrl+U).then((u=>new Promise(((J,v)=>{this._parent._loadFile(this._babylonScene,u,(u=>{this._disposed||(this.log("".concat(z,": Loaded ").concat(U," (").concat(u.byteLength," bytes)")),J(new Uint8Array(u)))}),!0,(u=>{v(new N.l("".concat(z,": Failed to load '").concat(U,"'").concat(u?": "+u.status+" "+u.statusText:""),u))}))}))))}static AddPointerMetadata(z,u){z.metadata=z.metadata||{};const U=z._internalMetadata=z._internalMetadata||{},J=U.Kf=U.Kf||{};(J.pointers=J.pointers||[]).push(u)}static _GetTextureWrapMode(z,u){switch(u=void 0==u?10497:u){case 33071:return X.e.CLAMP_ADDRESSMODE;case 33648:return X.e.MIRROR_ADDRESSMODE;case 10497:return X.e.WRAP_ADDRESSMODE;default:return E.d.Warn("".concat(z,": Invalid value (").concat(u,")")),X.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(z,u){const U=void 0==u.magFilter?9729:u.magFilter,J=void 0==u.minFilter?9987:u.minFilter;if(9729===U)switch(J){case 9728:return X.e.LINEAR_NEAREST;case 9729:return X.e.LINEAR_LINEAR;case 9984:return X.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return X.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return X.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return X.e.LINEAR_LINEAR_MIPLINEAR;default:return E.d.Warn("".concat(z,"/minFilter: Invalid value (").concat(J,")")),X.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==U&&E.d.Warn("".concat(z,"/magFilter: Invalid value (").concat(U,")")),J){case 9728:return X.e.NEAREST_NEAREST;case 9729:return X.e.NEAREST_LINEAR;case 9984:return X.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return X.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return X.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return X.e.NEAREST_LINEAR_MIPLINEAR;default:return E.d.Warn("".concat(z,"/minFilter: Invalid value (").concat(J,")")),X.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(z,u){try{return(0,k.p)(u)}catch(U){throw new Error("".concat(z,": ").concat(U.message))}}static _GetTypedArray(z,u,U,J,v){const f=U.buffer;J=U.byteOffset+(J||0);const g=H._GetTypedArrayConstructor("".concat(z,"/componentType"),u),w=t.g.GetTypeByteLength(u);return J%w!==0?(E.d.Warn("".concat(z,": Copying buffer as byte offset (").concat(J,") is not a multiple of component type byte length (").concat(w,")")),new g(f.slice(J,J+v*w),0)):new g(f,J,v)}static _GetNumComponents(z,u){switch(u){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error("".concat(z,": Invalid type (").concat(u,")"))}static _ValidateUri(z){return g.Tools.IsBase64(z)||-1===z.indexOf("..")}static _GetDrawMode(z,u){switch(void 0==u&&(u=4),u){case 0:return M.e.PointListDrawMode;case 1:return M.e.LineListDrawMode;case 2:return M.e.LineLoopDrawMode;case 3:return M.e.LineStripDrawMode;case 4:return M.e.TriangleFillMode;case 5:return M.e.TriangleStripDrawMode;case 6:return M.e.TriangleFanDrawMode}throw new Error("".concat(z,": Invalid mesh primitive mode (").concat(u,")"))}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const z=new Array;if(this._gltf.materials)for(const u of this._gltf.materials)if(u._data)for(const U in u._data){const J=u._data[U];for(const u of J.babylonMeshes){u.af(!0);const U=J.babylonMaterial;z.push(U.forceCompilationAsync(u)),z.push(U.forceCompilationAsync(u,{useInstances:!0})),this._parent.useClipPlane&&(z.push(U.forceCompilationAsync(u,{clipPlane:!0})),z.push(U.forceCompilationAsync(u,{clipPlane:!0,useInstances:!0})))}}return Promise.all(z).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const z=new Array,u=this._babylonScene.lights;for(const U of u){const u=U.getShadowGenerator();u&&z.push(u.forceCompilationAsync())}return Promise.all(z).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(z){for(const u of this._extensions)u.enabled&&z(u)}_applyExtensions(z,u,U){for(const J of this._extensions)if(J.enabled){const v="".concat(J.name,".").concat(u),f=z;f._activeLoaderExtensionFunctions=f._activeLoaderExtensionFunctions||{};const g=f._activeLoaderExtensionFunctions;if(!g[v]){g[v]=!0;try{const z=U(J);if(z)return z}finally{delete g[v]}}}return null}_extensionsOnLoading(){this._forEachExtensions((z=>z.onLoading&&z.onLoading()))}_extensionsOnReady(){this._forEachExtensions((z=>z.onReady&&z.onReady()))}_extensionsLoadSceneAsync(z,u){return this._applyExtensions(u,"loadScene",(U=>U.loadSceneAsync&&U.loadSceneAsync(z,u)))}_extensionsLoadNodeAsync(z,u,U){return this._applyExtensions(u,"loadNode",(J=>J.loadNodeAsync&&J.loadNodeAsync(z,u,U)))}_extensionsLoadCameraAsync(z,u,U){return this._applyExtensions(u,"loadCamera",(J=>J.loadCameraAsync&&J.loadCameraAsync(z,u,U)))}_extensionsLoadVertexDataAsync(z,u,U){return this._applyExtensions(u,"loadVertexData",(J=>J._loadVertexDataAsync&&J._loadVertexDataAsync(z,u,U)))}_extensionsLoadMeshPrimitiveAsync(z,u,U,J,v,f){return this._applyExtensions(v,"loadMeshPrimitive",(g=>g._loadMeshPrimitiveAsync&&g._loadMeshPrimitiveAsync(z,u,U,J,v,f)))}_extensionsLoadMaterialAsync(z,u,U,J,v){return this._applyExtensions(u,"loadMaterial",(f=>f._loadMaterialAsync&&f._loadMaterialAsync(z,u,U,J,v)))}_extensionsCreateMaterial(z,u,U){return this._applyExtensions(u,"createMaterial",(J=>J.createMaterial&&J.createMaterial(z,u,U)))}_extensionsLoadMaterialPropertiesAsync(z,u,U){return this._applyExtensions(u,"loadMaterialProperties",(J=>J.loadMaterialPropertiesAsync&&J.loadMaterialPropertiesAsync(z,u,U)))}_extensionsLoadTextureInfoAsync(z,u,U){return this._applyExtensions(u,"loadTextureInfo",(J=>J.loadTextureInfoAsync&&J.loadTextureInfoAsync(z,u,U)))}_extensionsLoadTextureAsync(z,u,U){return this._applyExtensions(u,"loadTexture",(J=>J._loadTextureAsync&&J._loadTextureAsync(z,u,U)))}_extensionsLoadAnimationAsync(z,u){return this._applyExtensions(u,"loadAnimation",(U=>U.loadAnimationAsync&&U.loadAnimationAsync(z,u)))}_extensionsLoadAnimationChannelAsync(z,u,U,J,v){return this._applyExtensions(U,"loadAnimationChannel",(f=>f._loadAnimationChannelAsync&&f._loadAnimationChannelAsync(z,u,U,J,v)))}_extensionsLoadSkinAsync(z,u,U){return this._applyExtensions(U,"loadSkin",(J=>J._loadSkinAsync&&J._loadSkinAsync(z,u,U)))}_extensionsLoadUriAsync(z,u,U){return this._applyExtensions(u,"loadUri",(J=>J._loadUriAsync&&J._loadUriAsync(z,u,U)))}_extensionsLoadBufferViewAsync(z,u){return this._applyExtensions(u,"loadBufferView",(U=>U.loadBufferViewAsync&&U.loadBufferViewAsync(z,u)))}_extensionsLoadBufferAsync(z,u,U,J){return this._applyExtensions(u,"loadBuffer",(v=>v.loadBufferAsync&&v.loadBufferAsync(z,u,U,J)))}static LoadExtensionAsync(z,u,U,J){if(!u.extensions)return null;const v=u.extensions[U];return v?J("".concat(z,"/extensions/").concat(U),v):null}static LoadExtraAsync(z,u,U,J){if(!u.extras)return null;const v=u.extras[U];return v?J("".concat(z,"/extras/").concat(U),v):null}isExtensionUsed(z){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(z)}logOpen(z){this._parent._logOpen(z)}logClose(){this._parent._logClose()}log(z){this._parent._log(z)}startPerformanceCounter(z){this._parent._startPerformanceCounter(z)}endPerformanceCounter(z){this._parent._endPerformanceCounter(z)}}H.DefaultSampler={index:-1},p.d._CreateGLTF2Loader=z=>new H(z);var G=U(14141),a=U(13116),i=U(12955),n=U(14149),q=U(14154);class o extends q.b{constructor(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",z),this._texture=z.getEngine().createRawCubeTexture(u,U,J,v,f,g,w,P)}update(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,z,u,U,J,v)}updateRGBDAsync(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,n.p)(this._texture,z,u,U,J).then((()=>{}))}clone(){return i.b.Clone((()=>{const z=this.Vz(),u=this._texture,U=new o(z,u._bufferViewArray,u.width,u.format,u.type,u.generateMipMaps,u.invertY,u.samplingMode,u._compression);return 13===u.source&&U.updateRGBDAsync(u._bufferViewArrayArray,u._sphericalPolynomial,u._lodGenerationScale,u._lodGenerationOffset),U}),this)}}const s="EXT_lights_image_based";class l{constructor(z){this.name=s,this._loader=z,this.enabled=this._loader.isExtensionUsed(s)}dispose(){this._loader=null,delete this._lights}onLoading(){const z=this._loader.Kf.extensions;if(z&&z[this.name]){const u=z[this.name];this._lights=u.lights}}loadSceneAsync(z,u){return H.LoadExtensionAsync(z,u,this.name,(async(U,J)=>{this._loader._allMaterialsDirtyRequired=!0;const v=new Array;v.push(this._loader.loadSceneAsync(z,u)),this._loader.logOpen("".concat(U));const f=B.Get("".concat(U,"/light"),this._lights,J.Pf);return v.push(this._loadLightAsync("/extensions/".concat(this.name,"/lights/").concat(J.Pf),f).then((z=>{this._loader.babylonScene.environmentTexture=z}))),this._loader.logClose(),await Promise.all(v).then((()=>{}))}))}_loadLightAsync(z,u){if(!u._loaded){const U=new Array;this._loader.logOpen("".concat(z));const J=new Array(u.specularImages.length);for(let v=0;v<u.specularImages.length;v++){const f=u.specularImages[v];J[v]=new Array(f.length);for(let u=0;u<f.length;u++){const g="".concat(z,"/specularImages/").concat(v,"/").concat(u);this._loader.logOpen("".concat(g));const w=f[u],P=B.Get(g,this._loader.Kf.images,w);U.push(this._loader.loadImageAsync("/images/".concat(w),P).then((z=>{J[v][u]=z}))),this._loader.logClose()}}this._loader.logClose(),u._loaded=Promise.all(U).then((async()=>{const U=new o(this._loader.babylonScene,null,u.specularImageSize);if(U.name=u.name||"environment",u._babylonTexture=U,void 0!=u.Cg&&(U.level=u.Cg),u.rotation){let z=v.Quaternion.Xu(u.rotation);this._loader.babylonScene.useRightHandedSystem||(z=v.Quaternion.Inverse(z)),v.Matrix.FromQuaternionToRef(z,U.getReflectionTextureMatrix())}if(!u.irradianceCoefficients)throw new Error("".concat(z,": Irradiance coefficients are missing"));const f=a.c.Xu(u.irradianceCoefficients);f.scaleInPlace(u.Cg),f.convertIrradianceToLambertianRadiance();const g=a.f.FromHarmonics(f),w=(J.length-1)/Math.log2(u.specularImageSize);return await U.updateRGBDAsync(J,g,w)}))}return u._loaded.then((()=>u._babylonTexture))}}I(s),j(s,!0,(z=>new l(z)));U(13439);const e="EXT_mesh_gpu_instancing";class zz{constructor(z){this.name=e,this._loader=z,this.enabled=this._loader.isExtensionUsed(e)}dispose(){this._loader=null}loadNodeAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(z,J)=>{this._loader._disableInstancedMesh++;const f=this._loader.loadNodeAsync("/nodes/".concat(u.index),u,U);if(this._loader._disableInstancedMesh--,!u._primitiveBabylonMeshes)return await f;const g=new Array;let w=0;const P=u=>{if(void 0==J.attributes[u])return void g.push(Promise.resolve(null));const U=B.Get("".concat(z,"/attributes/").concat(u),this._loader.Kf.accessors,J.attributes[u]);if(g.push(this._loader._loadFloatAccessorAsync("/accessors/".concat(U.bufferView),U)),0===w)w=U.count;else if(w!==U.count)throw new Error("".concat(z,"/attributes: Instance buffer accessors do not have the same count."))};return P("TRANSLATION"),P("ROTATION"),P("SCALE"),await f.then((async z=>{const[U,J,f]=await Promise.all(g),P=new Float32Array(16*w);v.TmpVectors.Eu[0].zg(0,0,0),v.TmpVectors.Quaternion[0].zg(0,0,0,1),v.TmpVectors.Eu[1].zg(1,1,1);for(let u=0;u<w;++u)U&&v.Eu.FromArrayToRef(U,3*u,v.TmpVectors.Eu[0]),J&&v.Quaternion.FromArrayToRef(J,4*u,v.TmpVectors.Quaternion[0]),f&&v.Eu.FromArrayToRef(f,3*u,v.TmpVectors.Eu[1]),v.Matrix.ComposeToRef(v.TmpVectors.Eu[1],v.TmpVectors.Quaternion[0],v.TmpVectors.Eu[0],v.TmpVectors.Matrix[0]),v.TmpVectors.Matrix[0].copyToArray(P,16*u);for(const v of u._primitiveBabylonMeshes)v.Qm("matrix",P,16,!0);return z}))}))}}I(e),j(e,!0,(z=>new zz(z)));let uz=0,Uz=null;class Jz{static get Default(){return Jz._Default||(Jz._Default=new Jz),Jz._Default}constructor(){const z=Jz.Configuration.decoder;this._decoderModulePromise=g.Tools.LoadBabylonScriptAsync(z.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(z,u,U,J,v){await this._decoderModulePromise,0===uz&&(MeshoptDecoder.useWorkers(1),uz=1);const f=await MeshoptDecoder.decodeGltfBufferAsync(u,U,z,J,v);return null!==Uz&&clearTimeout(Uz),Uz=setTimeout((()=>{MeshoptDecoder.useWorkers(0),uz=0,Uz=null}),1e3),f}}Jz.Configuration={decoder:{url:"".concat(g.Tools._DefaultCdnUrl,"/meshopt_decoder.js")}},Jz._Default=null;const vz="EXT_meshopt_compression";class fz{constructor(z){this.name=vz,this.enabled=z.isExtensionUsed(vz),this._loader=z}dispose(){this._loader=null}loadBufferViewAsync(z,u){return H.LoadExtensionAsync(z,u,this.name,(async(U,J)=>{const v=u;if(v._meshOptData)return await v._meshOptData;const f=B.Get("".concat(z,"/buffer"),this._loader.Kf.buffers,J.buffer);return v._meshOptData=this._loader.loadBufferAsync("/buffers/".concat(f.index),f,J.byteOffset||0,J.byteLength).then((async z=>await Jz.Default.decodeGltfBufferAsync(z,J.count,J.byteStride,J.mode,J.filter))),await v._meshOptData}))}}I(vz),j(vz,!0,(z=>new fz(z)));const gz="EXT_texture_webp";class wz{constructor(z){this.name=gz,this._loader=z,this.enabled=z.isExtensionUsed(gz)}dispose(){this._loader=null}_loadTextureAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=void 0==u.sampler?H.DefaultSampler:B.Get("".concat(z,"/sampler"),this._loader.Kf.samplers,u.sampler),g=B.Get("".concat(J,"/source"),this._loader.Kf.images,v.source);return await this._loader._createTextureAsync(z,f,g,(z=>{U(z)}),void 0,!u._textureInfo.nonColorData)}))}}I(gz),j(gz,!0,(z=>new wz(z)));const Pz="EXT_texture_avif";class Rz{constructor(z){this.name=Pz,this._loader=z,this.enabled=z.isExtensionUsed(Pz)}dispose(){this._loader=null}_loadTextureAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=void 0==u.sampler?H.DefaultSampler:B.Get("".concat(z,"/sampler"),this._loader.Kf.samplers,u.sampler),g=B.Get("".concat(J,"/source"),this._loader.Kf.images,v.source);return await this._loader._createTextureAsync(z,f,g,(z=>{U(z)}),void 0,!u._textureInfo.nonColorData)}))}}I(Pz),j(Pz,!0,(z=>new Rz(z)));var Sz=U(14138),dz=U(13428);const mu="EXT_lights_ies";class Zz{constructor(z){this.name=mu,this._loader=z,this.enabled=this._loader.isExtensionUsed(mu)}dispose(){this._loader=null,delete this._lights}onLoading(){const z=this._loader.Kf.extensions;if(z&&z[this.name]){const u=z[this.name];this._lights=u.lights,B.Assign(this._lights)}}loadNodeAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,g)=>{let w,P;this._loader._allMaterialsDirtyRequired=!0;const R=await this._loader.loadNodeAsync(z,u,(z=>{P=B.Get(J,this._lights,g.Pf);const u=P.name||z.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,w=new Sz.e(u,v.Eu.Zero(),v.Eu.Backward(),0,1,this._loader.babylonScene),w.angle=Math.PI/2,w.innerAngle=0,w._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,P._babylonLight=w,w.falloffType=dz.c.FALLOFF_GLTF,w.Mg=g.color?f.Tu.Xu(g.color):f.Tu.White(),w.Cg=g.multiplier||1,w.range=Number.MAX_VALUE,w.parent=z,this._loader._babylonLights.push(w),H.AddPointerMetadata(w,J),U(z)}));let S;if(P.uri)S=await this._loader.loadUriAsync(z,P,P.uri);else{const u=B.Get("".concat(z,"/bufferView"),this._loader.Kf.bufferViews,P.bufferView);S=await this._loader.loadBufferViewAsync("/bufferViews/".concat(u.index),u)}return w.iesProfileTexture=new X.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,S,!0,void 0,void 0,void 0,void 0,".ies"),R}))}}I(mu),j(mu,!0,(z=>new Zz(z)));var Az=U(14166);const Ez="KHR_draco_mesh_compression";class Cz{constructor(z){this.name=Ez,this.useNormalizedFlagFromAccessor=!0,this._loader=z,this.enabled=Az.e.DefaultAvailable&&this._loader.isExtensionUsed(Ez)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{if(void 0!=u.mode&&4!==u.mode&&5!==u.mode)throw new Error("".concat(z,": Unsupported mode ").concat(u.mode));const f={},g={},w=(z,J)=>{const w=v.attributes[z];if(void 0!=w&&(U._delayInfo=U._delayInfo||[],-1===U._delayInfo.indexOf(J)&&U._delayInfo.push(J),f[J]=w,this.useNormalizedFlagFromAccessor)){const U=B.TryGet(this._loader.Kf.accessors,u.attributes[z]);U&&(g[J]=U.normalized||!1)}};w("POSITION",t.g.PositionKind),w("NORMAL",t.g.NormalKind),w("TANGENT",t.g.TangentKind),w("TEXCOORD_0",t.g.UVKind),w("TEXCOORD_1",t.g.UV2Kind),w("TEXCOORD_2",t.g.UV3Kind),w("TEXCOORD_3",t.g.UV4Kind),w("TEXCOORD_4",t.g.UV5Kind),w("TEXCOORD_5",t.g.UV6Kind),w("JOINTS_0",t.g.MatricesIndicesKind),w("WEIGHTS_0",t.g.MatricesWeightsKind),w("COLOR_0",t.g.ColorKind);const P=B.Get(J,this._loader.Kf.bufferViews,v.bufferView);return P._dracoBabylonGeometry||(P._dracoBabylonGeometry=this._loader.loadBufferViewAsync("/bufferViews/".concat(P.index),P).then((async J=>{const v=this.dracoDecoder||Az.e.Default,w=B.TryGet(this._loader.Kf.accessors,u.attributes.POSITION),P=this._loader.parent.alwaysComputeBoundingBox||U.skeleton||!w?null:y(w);return await v._decodeMeshToGeometryForGltfAsync(U.name,this._loader.babylonScene,J,f,g,P).catch((u=>{throw new Error("".concat(z,": ").concat(u.message))}))}))),await P._dracoBabylonGeometry}))}}I(Ez),j(Ez,!0,(z=>new Cz(z)));var rz=U(14170),Mz=U(12899),Tz=U(12901),Xz=U(13318),hz=U(13463),tz=U(12875);Xz.d.AddNodeConstructor("Light_Type_0",((z,u)=>()=>new Vz(z,v.Eu.Zero(),u)));class Vz extends hz.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(z){this._shadowAngle=z,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(z){const u=this.needCube();if(this._direction=z,this.needCube()!==u&&this._shadowGenerators){const z=this._shadowGenerators.values();for(let u=z.next();!0!==u.done;u=z.next()){u.value.recreateShadowMap()}}}constructor(z,u,U){super(z,U),this._shadowAngle=Math.PI/2,this.position=u}getClassName(){return"PointLight"}getTypeID(){return dz.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(z){if(this.direction)return super.getShadowDirection(z);switch(z){case 0:return new v.Eu(1,0,0);case 1:return new v.Eu(-1,0,0);case 2:return new v.Eu(0,-1,0);case 3:return new v.Eu(0,1,0);case 4:return new v.Eu(0,0,1);case 5:return new v.Eu(0,0,-1)}return v.Eu.Zero()}_setDefaultShadowProjectionMatrix(z,u,U){const J=this.Vz().activeCamera;if(!J)return;const f=void 0!==this.shadowMinZ?this.shadowMinZ:J.Bf,g=void 0!==this.shadowMaxZ?this.shadowMaxZ:J.maxZ,w=this.Vz().getEngine().df;v.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,w?g:f,w?f:g,z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,w)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(z,u){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,u):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,u),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,u),this}transferToNodeMaterialEffect(z,u){return this.computeTransformedInformation()?z.setFloat3(u,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):z.setFloat3(u,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(z,u){z["POINTLIGHT"+u]=!0}}(0,Mz.b)([(0,Tz.K)()],Vz.prototype,"shadowAngle",null),(0,tz.f)("BABYLON.PointLight",Vz);const Lz="KHR_lights_punctual";class Oz{constructor(z){this.name=Lz,this._loader=z,this.enabled=this._loader.isExtensionUsed(Lz)}dispose(){this._loader=null,delete this._lights}onLoading(){const z=this._loader.Kf.extensions;if(z&&z[this.name]){const u=z[this.name];this._lights=u.lights,B.Assign(this._lights)}}loadNodeAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,g)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(z,u,(z=>{let u;const w=B.Get(J,this._lights,g.Pf),P=w.name||z.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,w.type){case"directional":{const z=new rz.b(P,v.Eu.Backward(),this._loader.babylonScene);z.position.fg(0),u=z;break}case"point":u=new Vz(P,v.Eu.Zero(),this._loader.babylonScene);break;case"spot":{const z=new Sz.e(P,v.Eu.Zero(),v.Eu.Backward(),0,1,this._loader.babylonScene);z.angle=2*(w.spot&&w.spot.outerConeAngle||Math.PI/4),z.innerAngle=2*(w.spot&&w.spot.innerConeAngle||0),u=z;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error("".concat(J,": Invalid light type (").concat(w.type,")"))}u._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,w._babylonLight=u,u.falloffType=dz.c.FALLOFF_GLTF,u.Mg=w.color?f.Tu.Xu(w.color):f.Tu.White(),u.Cg=void 0==w.Cg?1:w.Cg,u.range=void 0==w.range?Number.MAX_VALUE:w.range,u.parent=z,this._loader._babylonLights.push(u),H.AddPointerMetadata(u,J),U(z)})))))}}I(Lz),j(Lz,!0,(z=>new Oz(z)));const xz="KHR_materials_pbrSpecularGlossiness";class Qz{constructor(z){this.name=xz,this.order=200,this._loader=z,this.enabled=this._loader.isExtensionUsed(xz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=new Array;return f.push(this._loader.loadMaterialBasePropertiesAsync(z,u,U)),f.push(this._loadSpecularGlossinessPropertiesAsync(J,v,U)),this._loader.loadMaterialAlphaProperties(z,u,U),await Promise.all(f).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(z,u,U){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));const J=new Array;return U.metallic=null,U.roughness=null,u.diffuseFactor?(U.albedoColor=f.Tu.Xu(u.diffuseFactor),U.alpha=u.diffuseFactor[3]):U.albedoColor=f.Tu.White(),U.reflectivityColor=u.specularFactor?f.Tu.Xu(u.specularFactor):f.Tu.White(),U.microSurface=void 0==u.glossinessFactor?1:u.glossinessFactor,u.diffuseTexture&&J.push(this._loader.loadTextureInfoAsync("".concat(z,"/diffuseTexture"),u.diffuseTexture,(z=>{z.name="".concat(U.name," (Diffuse)"),U.albedoTexture=z}))),u.specularGlossinessTexture&&(J.push(this._loader.loadTextureInfoAsync("".concat(z,"/specularGlossinessTexture"),u.specularGlossinessTexture,(z=>{z.name="".concat(U.name," (Specular Glossiness)"),U.reflectivityTexture=z,U.reflectivityTexture.kf=!0}))),U.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(J).then((()=>{}))}}I(xz),j(xz,!0,(z=>new Qz(z)));const Kz="KHR_materials_unlit";class Yz{constructor(z){this.name=Kz,this.order=210,this._loader=z,this.enabled=this._loader.isExtensionUsed(Kz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async()=>await this._loadUnlitPropertiesAsync(z,u,U)))}_loadUnlitPropertiesAsync(z,u,U){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));const J=new Array;U.unlit=!0;const v=u.pbrMetallicRoughness;return v&&(v.baseColorFactor?(U.albedoColor=f.Tu.Xu(v.baseColorFactor),U.alpha=v.baseColorFactor[3]):U.albedoColor=f.Tu.White(),v.baseColorTexture&&J.push(this._loader.loadTextureInfoAsync("".concat(z,"/baseColorTexture"),v.baseColorTexture,(z=>{z.name="".concat(U.name," (Base Color)"),U.albedoTexture=z})))),u.doubleSided&&(U.ef=!1,U.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(z,u,U),Promise.all(J).then((()=>{}))}}I(Kz),j(Kz,!0,(z=>new Yz(z)));const pz="KHR_materials_clearcoat";class Nz{constructor(z){this.name=pz,this.order=190,this._loader=z,this.enabled=this._loader.isExtensionUsed(pz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=new Array;f.push(this._loader.loadMaterialPropertiesAsync(z,u,U)),f.push(this._loadClearCoatPropertiesAsync(J,v,U)),await Promise.all(f)}))}_loadClearCoatPropertiesAsync(z,u,U){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));const J=new Array;return U.clearCoat.isEnabled=!0,U.clearCoat.useRoughnessFromMainTexture=!1,U.clearCoat.remapF0OnInterfaceChange=!1,void 0!=u.clearcoatFactor?U.clearCoat.Cg=u.clearcoatFactor:U.clearCoat.Cg=0,u.clearcoatTexture&&J.push(this._loader.loadTextureInfoAsync("".concat(z,"/clearcoatTexture"),u.clearcoatTexture,(z=>{z.name="".concat(U.name," (ClearCoat)"),U.clearCoat.texture=z}))),void 0!=u.clearcoatRoughnessFactor?U.clearCoat.roughness=u.clearcoatRoughnessFactor:U.clearCoat.roughness=0,u.clearcoatRoughnessTexture&&(u.clearcoatRoughnessTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync("".concat(z,"/clearcoatRoughnessTexture"),u.clearcoatRoughnessTexture,(z=>{z.name="".concat(U.name," (ClearCoat Roughness)"),U.clearCoat.textureRoughness=z})))),u.clearcoatNormalTexture&&(u.clearcoatNormalTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync("".concat(z,"/clearcoatNormalTexture"),u.clearcoatNormalTexture,(z=>{z.name="".concat(U.name," (ClearCoat Normal)"),U.clearCoat.bumpTexture=z}))),U.invertNormalMapX=!U.Vz().useRightHandedSystem,U.invertNormalMapY=U.Vz().useRightHandedSystem,void 0!=u.clearcoatNormalTexture.scale&&(U.clearCoat.bumpTexture.level=u.clearcoatNormalTexture.scale)),Promise.all(J).then((()=>{}))}}I(pz),j(pz,!0,(z=>new Nz(z)));const Dz="KHR_materials_iridescence";class cz{constructor(z){this.name=Dz,this.order=195,this._loader=z,this.enabled=this._loader.isExtensionUsed(Dz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(z,u,U)),f.push(this._loadIridescencePropertiesAsync(J,v,U)),await Promise.all(f).then((()=>{}))}))}_loadIridescencePropertiesAsync(z,u,U){var J,v,f,g,w;if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));const P=new Array;return U.iridescence.isEnabled=!0,U.iridescence.Cg=null!==(J=u.iridescenceFactor)&&void 0!==J?J:0,U.iridescence.indexOfRefraction=null!==(v=null!==(f=u.iridescenceIor)&&void 0!==f?f:u.iridescenceIOR)&&void 0!==v?v:1.3,U.iridescence.minimumThickness=null!==(g=u.iridescenceThicknessMinimum)&&void 0!==g?g:100,U.iridescence.maximumThickness=null!==(w=u.iridescenceThicknessMaximum)&&void 0!==w?w:400,u.iridescenceTexture&&P.push(this._loader.loadTextureInfoAsync("".concat(z,"/iridescenceTexture"),u.iridescenceTexture,(z=>{z.name="".concat(U.name," (Iridescence)"),U.iridescence.texture=z}))),u.iridescenceThicknessTexture&&P.push(this._loader.loadTextureInfoAsync("".concat(z,"/iridescenceThicknessTexture"),u.iridescenceThicknessTexture,(z=>{z.name="".concat(U.name," (Iridescence Thickness)"),U.iridescence.thicknessTexture=z}))),Promise.all(P).then((()=>{}))}}I(Dz),j(Dz,!0,(z=>new cz(z)));const Wz="KHR_materials_anisotropy";class jz{constructor(z){this.name=Wz,this.order=195,this._loader=z,this.enabled=this._loader.isExtensionUsed(Wz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=new Array;f.push(this._loader.loadMaterialPropertiesAsync(z,u,U)),f.push(this._loadIridescencePropertiesAsync(J,v,U)),await Promise.all(f)}))}async _loadIridescencePropertiesAsync(z,u,U){var J,v;if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));const f=new Array;U.anisotropy.isEnabled=!0,U.anisotropy.Cg=null!==(J=u.anisotropyStrength)&&void 0!==J?J:0,U.anisotropy.angle=null!==(v=u.anisotropyRotation)&&void 0!==v?v:0,u.anisotropyTexture&&(u.anisotropyTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync("".concat(z,"/anisotropyTexture"),u.anisotropyTexture,(z=>{z.name="".concat(U.name," (Anisotropy Intensity)"),U.anisotropy.texture=z})))),await Promise.all(f)}}I(Wz),j(Wz,!0,(z=>new jz(z)));const Iz="KHR_materials_emissive_strength";class Fz{constructor(z){this.name=Iz,this.order=170,this._loader=z,this.enabled=this._loader.isExtensionUsed(Iz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>await this._loader.loadMaterialPropertiesAsync(z,u,U).then((()=>{this._loadEmissiveProperties(J,v,U)}))))}_loadEmissiveProperties(z,u,U){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));void 0!==u.emissiveStrength&&(U.emissiveIntensity=u.emissiveStrength)}}I(Iz),j(Iz,!0,(z=>new Fz(z)));const bz="KHR_materials_sheen";class kz{constructor(z){this.name=bz,this.order=190,this._loader=z,this.enabled=this._loader.isExtensionUsed(bz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(z,u,U)),f.push(this._loadSheenPropertiesAsync(J,v,U)),await Promise.all(f).then((()=>{}))}))}_loadSheenPropertiesAsync(z,u,U){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));const J=new Array;return U.sheen.isEnabled=!0,U.sheen.Cg=1,void 0!=u.sheenColorFactor?U.sheen.color=f.Tu.Xu(u.sheenColorFactor):U.sheen.color=f.Tu.Black(),u.sheenColorTexture&&J.push(this._loader.loadTextureInfoAsync("".concat(z,"/sheenColorTexture"),u.sheenColorTexture,(z=>{z.name="".concat(U.name," (Sheen Color)"),U.sheen.texture=z}))),void 0!==u.sheenRoughnessFactor?U.sheen.roughness=u.sheenRoughnessFactor:U.sheen.roughness=0,u.sheenRoughnessTexture&&(u.sheenRoughnessTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync("".concat(z,"/sheenRoughnessTexture"),u.sheenRoughnessTexture,(z=>{z.name="".concat(U.name," (Sheen Roughness)"),U.sheen.textureRoughness=z})))),U.sheen.albedoScaling=!0,U.sheen.useRoughnessFromMainTexture=!1,Promise.all(J).then((()=>{}))}}I(bz),j(bz,!0,(z=>new kz(z)));var Bz=U(13360);const yz="KHR_materials_specular";class Hz{constructor(z){this.name=yz,this.order=190,this._loader=z,this.enabled=this._loader.isExtensionUsed(yz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=new Array;if(f.push(this._loader.loadMaterialPropertiesAsync(z,u,U)),f.push(this._loadSpecularPropertiesAsync(J,v,U)),v.extensions&&v.extensions.EXT_materials_specular_edge_color&&U instanceof T.e){v.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(U.brdf.dielectricSpecularModel=Bz.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,U.brdf.conductorSpecularModel=Bz.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(f).then((()=>{}))}))}_loadSpecularPropertiesAsync(z,u,U){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));const J=new Array;return void 0!==u.specularFactor&&(U.metallicF0Factor=u.specularFactor),void 0!==u.specularColorFactor&&(U.metallicReflectanceColor=f.Tu.Xu(u.specularColorFactor)),u.specularTexture&&(u.specularTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync("".concat(z,"/specularTexture"),u.specularTexture,(z=>{z.name="".concat(U.name," (Specular)"),U.metallicReflectanceTexture=z,U.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),u.specularColorTexture&&J.push(this._loader.loadTextureInfoAsync("".concat(z,"/specularColorTexture"),u.specularColorTexture,(z=>{z.name="".concat(U.name," (Specular Color)"),U.reflectanceTexture=z}))),Promise.all(J).then((()=>{}))}}I(yz),j(yz,!0,(z=>new Hz(z)));const Gz="KHR_materials_ior";class az{constructor(z){this.name=Gz,this.order=180,this._loader=z,this.enabled=this._loader.isExtensionUsed(Gz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(z,u,U)),f.push(this._loadIorPropertiesAsync(J,v,U)),await Promise.all(f).then((()=>{}))}))}_loadIorPropertiesAsync(z,u,U){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));return void 0!==u.ior?U.indexOfRefraction=u.ior:U.indexOfRefraction=az._DEFAULT_IOR,Promise.resolve()}}az._DEFAULT_IOR=1.5,I(Gz),j(Gz,!0,(z=>new az(z)));const iz="KHR_materials_variants";class nz{constructor(z){this.name=iz,this._loader=z,this.enabled=this._loader.isExtensionUsed(iz)}dispose(){this._loader=null}static GetAvailableVariants(z){const u=this._GetExtensionMetadata(z);return u?Object.keys(u.variants):[]}getAvailableVariants(z){return nz.GetAvailableVariants(z)}static SelectVariant(z,u){const U=this._GetExtensionMetadata(z);if(!U)throw new Error("Cannot select variant on a glTF mesh that does not have the ".concat(iz," extension"));const J=z=>{const u=U.variants[z];if(u)for(const U of u)U.mesh.material=U.material};if(u instanceof Array)for(const v of u)J(v);else J(u);U.lastSelected=u}selectVariant(z,u){nz.SelectVariant(z,u)}static Reset(z){const u=this._GetExtensionMetadata(z);if(!u)throw new Error("Cannot reset on a glTF mesh that does not have the ".concat(iz," extension"));for(const U of u.original)U.mesh.material=U.material;u.lastSelected=null}reset(z){nz.Reset(z)}static GetLastSelectedVariant(z){const u=this._GetExtensionMetadata(z);if(!u)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the ".concat(iz," extension"));return u.lastSelected}getLastSelectedVariant(z){return nz.GetLastSelectedVariant(z)}static _GetExtensionMetadata(z){var u,U;return(null===z||void 0===z||null===(u=z._internalMetadata)||void 0===u||null===(U=u.Kf)||void 0===U?void 0:U[iz])||null}onLoading(){const z=this._loader.Kf.extensions;if(z&&z[this.name]){const u=z[this.name];this._variants=u.variants}}onReady(){const z=this._loader.rootBabylonMesh;if(z){var u;const U=this._loader.parent.extensionOptions[iz];null!==U&&void 0!==U&&U.defaultVariant&&nz.SelectVariant(z,U.defaultVariant),null===U||void 0===U||null===(u=U.onLoaded)||void 0===u||u.call(U,{get variants(){return nz.GetAvailableVariants(z)},get selectedVariant(){const u=nz.GetLastSelectedVariant(z);return u?Array.isArray(u)?u[0]:u:nz.GetAvailableVariants(z)[0]},set selectedVariant(u){nz.SelectVariant(z,u)}})}}_loadMeshPrimitiveAsync(z,u,U,J,v,f){return H.LoadExtensionAsync(z,v,this.name,(async(g,w)=>{const P=new Array;return P.push(this._loader._loadMeshPrimitiveAsync(z,u,U,J,v,(u=>{if(f(u),u instanceof O.e){const U=H._GetDrawMode(z,v.mode),J=this._loader.rootBabylonMesh,f=J?J._internalMetadata=J._internalMetadata||{}:{},R=f.Kf=f.Kf||{},S=R[iz]=R[iz]||{lastSelected:null,original:[],variants:{}};S.original.push({mesh:u,material:u.material});for(let z=0;z<w.mappings.length;++z){const v=w.mappings[z],f=B.Get("".concat(g,"/mappings/").concat(z,"/material"),this._loader.Kf.materials,v.material);P.push(this._loader._loadMaterialAsync("#/materials/".concat(v.material),f,u,U,(z=>{for(let U=0;U<v.variants.length;++U){const f=v.variants[U],g=B.Get("/extensions/".concat(iz,"/variants/").concat(f),this._variants,f);S.variants[g.name]=S.variants[g.name]||[],S.variants[g.name].push({mesh:u,material:z}),u.onClonedObservable.add((z=>{const U=z;let v=null,f=U;do{if(f=f.parent,!f)return;v=nz._GetExtensionMetadata(f)}while(null===v);if(J&&v===nz._GetExtensionMetadata(J)){f._internalMetadata={};for(const z in J._internalMetadata)f._internalMetadata[z]=J._internalMetadata[z];f._internalMetadata.Kf=[];for(const z in J._internalMetadata.Kf)f._internalMetadata.Kf[z]=J._internalMetadata.Kf[z];f._internalMetadata.Kf[iz]={lastSelected:null,original:[],variants:{}};for(const z of v.original)f._internalMetadata.Kf[iz].original.push({mesh:z.mesh,material:z.material});for(const z in v.variants)if(Object.prototype.hasOwnProperty.call(v.variants,z)){f._internalMetadata.Kf[iz].variants[z]=[];for(const u of v.variants[z])f._internalMetadata.Kf[iz].variants[z].push({mesh:u.mesh,material:u.material})}v=f._internalMetadata.Kf[iz]}for(const J of v.original)J.mesh===u&&(J.mesh=U);for(const J of v.variants[g.name])J.mesh===u&&(J.mesh=U)}))}})))}}}))),await Promise.all(P).then((z=>{let[u]=z;return u}))}))}}I(iz),j(iz,!0,(z=>new nz(z)));var qz=U(21),oz=U(12986);class sz{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Bz.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(z,u){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options=(0,qz.e)((0,qz.e)({},sz._GetDefaultOptions()),z),this._scene=u,this._scene._transmissionHelper=this,this.onErrorObservable=new S.e,this._scene.Xf.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(z){if(!Object.keys(z).filter((u=>this._options[u]!==z[u])).length)return;const u=(0,qz.e)((0,qz.e)({},this._options),z),U=this._options;this._options=u,u.renderSize===U.renderSize&&u.renderTargetTextureType===U.renderTargetTextureType&&u.generateMipmaps===U.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=u.samples,this._opaqueRenderTarget.lodGenerationScale=u.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=u.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(z){return!!z&&!!(z instanceof T.e&&z.subSurface.isRefractionEnabled)}_addMesh(z){this._materialObservers[z.uniqueId]=z.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),g.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(z.material)?(z.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(z)&&this._transparentMeshesCache.push(z)):-1===this._opaqueMeshesCache.indexOf(z)&&this._opaqueMeshesCache.push(z)}))}_removeMesh(z){z.onMaterialChangedObservable.remove(this._materialObservers[z.uniqueId]),delete this._materialObservers[z.uniqueId];let u=this._transparentMeshesCache.indexOf(z);-1!==u&&this._transparentMeshesCache.splice(u,1),u=this._opaqueMeshesCache.indexOf(z),-1!==u&&this._opaqueMeshesCache.splice(u,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(z){const u=this._transparentMeshesCache.indexOf(z),U=this._opaqueMeshesCache.indexOf(z);this._shouldRenderAsTransmission(z.material)?(z.material instanceof T.e&&(z.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==U?(this._opaqueMeshesCache.splice(U,1),this._transparentMeshesCache.push(z)):-1===u&&this._transparentMeshesCache.push(z)):-1!==u?(this._transparentMeshesCache.splice(u,1),this._opaqueMeshesCache.push(z)):-1===U&&this._opaqueMeshesCache.push(z)}_isRenderTargetValid(){var z;return null!==(null===(z=this._opaqueRenderTarget)||void 0===z?void 0:z.getInternalTexture())}_setupRenderTargets(){var z,u;let U;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new oz.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=null!==(z=null===(u=this._options.clearColor)||void 0===u?void 0:u.clone())&&void 0!==z?z:this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((z=>{U=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?z.clearColor.v(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(z.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=U}));for(const J of this._transparentMeshesCache)this._shouldRenderAsTransmission(J.material)&&(J.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const lz="KHR_materials_transmission";class ez{constructor(z){this.name=lz,this.order=175,this._loader=z,this.enabled=this._loader.isExtensionUsed(lz),this.enabled&&(z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(z,u,U)),f.push(this._loadTransparentPropertiesAsync(J,u,U,v)),await Promise.all(f).then((()=>{}))}))}_loadTransparentPropertiesAsync(z,u,U,J){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));const v=U;if(v.subSurface.isRefractionEnabled=!0,v.subSurface.volumeIndexOfRefraction=1,v.subSurface.useAlbedoToTintRefraction=!0,void 0===J.transmissionFactor)return v.subSurface.refractionIntensity=0,v.subSurface.isRefractionEnabled=!1,Promise.resolve();{var f;v.subSurface.refractionIntensity=J.transmissionFactor;const z=v.Vz();if(v.subSurface.refractionIntensity&&!z._transmissionHelper)new sz({},v.Vz());else if(v.subSurface.refractionIntensity&&(null===(f=z._transmissionHelper)||void 0===f||!f._isRenderTargetValid())){var g;null===(g=z._transmissionHelper)||void 0===g||g._setupRenderTargets()}}return v.subSurface.minimumThickness=0,v.subSurface.maximumThickness=0,J.transmissionTexture?(J.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(z,"/transmissionTexture"),J.transmissionTexture,void 0).then((z=>{z.name="".concat(U.name," (Transmission)"),v.subSurface.refractionIntensityTexture=z,v.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}I(lz),j(lz,!0,(z=>new ez(z)));const zu="KHR_materials_diffuse_transmission";class uu{constructor(z){this.name=zu,this.order=174,this._loader=z,this.enabled=this._loader.isExtensionUsed(zu),this.enabled&&(z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(z,u,U)),f.push(this._loadTranslucentPropertiesAsync(J,u,U,v)),await Promise.all(f).then((()=>{}))}))}_loadTranslucentPropertiesAsync(z,u,U,J){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));const v=U;if(v.subSurface.isTranslucencyEnabled=!0,v.subSurface.volumeIndexOfRefraction=1,v.subSurface.minimumThickness=0,v.subSurface.maximumThickness=0,v.subSurface.useAlbedoToTintTranslucency=!1,void 0===J.diffuseTransmissionFactor)return v.subSurface.translucencyIntensity=0,v.subSurface.isTranslucencyEnabled=!1,Promise.resolve();v.subSurface.translucencyIntensity=J.diffuseTransmissionFactor;const g=new Array;return v.subSurface.useGltfStyleTextures=!0,J.diffuseTransmissionTexture&&(J.diffuseTransmissionTexture.nonColorData=!0,g.push(this._loader.loadTextureInfoAsync("".concat(z,"/diffuseTransmissionTexture"),J.diffuseTransmissionTexture).then((z=>{z.name="".concat(U.name," (Diffuse Transmission)"),v.subSurface.translucencyIntensityTexture=z})))),void 0!==J.diffuseTransmissionColorFactor?v.subSurface.translucencyColor=f.Tu.Xu(J.diffuseTransmissionColorFactor):v.subSurface.translucencyColor=f.Tu.White(),J.diffuseTransmissionColorTexture&&g.push(this._loader.loadTextureInfoAsync("".concat(z,"/diffuseTransmissionColorTexture"),J.diffuseTransmissionColorTexture).then((z=>{z.name="".concat(U.name," (Diffuse Transmission Color)"),v.subSurface.translucencyColorTexture=z}))),Promise.all(g).then((()=>{}))}}I(zu),j(zu,!0,(z=>new uu(z)));const Uu="KHR_materials_volume";class Ju{constructor(z){this.name=Uu,this.order=173,this._loader=z,this.enabled=this._loader.isExtensionUsed(Uu),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(z,u,U)),f.push(this._loadVolumePropertiesAsync(J,u,U,v)),await Promise.all(f).then((()=>{}))}))}_loadVolumePropertiesAsync(z,u,U,J){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));if(!U.subSurface.isRefractionEnabled&&!U.subSurface.isTranslucencyEnabled||!J.thicknessFactor)return Promise.resolve();U.subSurface.volumeIndexOfRefraction=U.indexOfRefraction;const v=void 0!==J.attenuationDistance?J.attenuationDistance:Number.MAX_VALUE;return U.subSurface.tintColorAtDistance=v,void 0!==J.attenuationColor&&3==J.attenuationColor.length&&U.subSurface.tintColor.zg(J.attenuationColor[0],J.attenuationColor[1],J.attenuationColor[2]),U.subSurface.minimumThickness=0,U.subSurface.maximumThickness=J.thicknessFactor,U.subSurface.useThicknessAsDepth=!0,J.thicknessTexture?(J.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(z,"/thicknessTexture"),J.thicknessTexture).then((z=>{z.name="".concat(U.name," (Thickness)"),U.subSurface.thicknessTexture=z,U.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}I(Uu),j(Uu,!0,(z=>new Ju(z)));const vu="KHR_materials_dispersion";class fu{constructor(z){this.name=vu,this.order=174,this._loader=z,this.enabled=this._loader.isExtensionUsed(vu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(z,u,U)),f.push(this._loadDispersionPropertiesAsync(J,u,U,v)),await Promise.all(f).then((()=>{}))}))}_loadDispersionPropertiesAsync(z,u,U,J){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));return U.subSurface.isRefractionEnabled&&J.dispersion?(U.subSurface.isDispersionEnabled=!0,U.subSurface.dispersion=J.dispersion,Promise.resolve()):Promise.resolve()}}I(vu),j(vu,!0,(z=>new fu(z)));const gu="EXT_materials_diffuse_roughness";class wu{constructor(z){this.name=gu,this.order=190,this._loader=z,this.enabled=this._loader.isExtensionUsed(gu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(z,u,U)),f.push(this._loadDiffuseRoughnessPropertiesAsync(J,v,U)),await Promise.all(f).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(z,u,U){if(!(U instanceof T.e))throw new Error("".concat(z,": Material type not supported"));const J=new Array;return U.brdf.baseDiffuseModel=Bz.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=u.diffuseRoughnessFactor?U.baseDiffuseRoughness=u.diffuseRoughnessFactor:U.baseDiffuseRoughness=0,u.diffuseRoughnessTexture&&J.push(this._loader.loadTextureInfoAsync("".concat(z,"/diffuseRoughnessTexture"),u.diffuseRoughnessTexture,(z=>{z.name="".concat(U.name," (Diffuse Roughness)"),U.baseDiffuseRoughnessTexture=z}))),Promise.all(J).then((()=>{}))}}I(gu),j(gu,!0,(z=>new wu(z)));const Pu="KHR_mesh_quantization";class Ru{constructor(z){this.name=Pu,this.enabled=z.isExtensionUsed(Pu)}dispose(){}}I(Pu),j(Pu,!0,(z=>new Ru(z)));const Su="KHR_texture_basisu";class du{constructor(z){this.name=Su,this._loader=z,this.enabled=z.isExtensionUsed(Su)}dispose(){this._loader=null}_loadTextureAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>{const f=void 0==u.sampler?H.DefaultSampler:B.Get("".concat(z,"/sampler"),this._loader.Kf.samplers,u.sampler),g=B.Get("".concat(J,"/source"),this._loader.Kf.images,v.source);return await this._loader._createTextureAsync(z,f,g,(z=>{U(z)}),u._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!u._textureInfo.nonColorData)}))}}I(Su),j(Su,!0,(z=>new du(z)));const mU="KHR_texture_transform";class Zu{constructor(z){this.name=mU,this._loader=z,this.enabled=this._loader.isExtensionUsed(mU)}dispose(){this._loader=null}loadTextureInfoAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(J,v)=>await this._loader.loadTextureInfoAsync(z,u,(z=>{if(!(z instanceof X.e))throw new Error("".concat(J,": Texture type not supported"));v.offset&&(z.uOffset=v.offset[0],z.vOffset=v.offset[1]),z.uRotationCenter=0,z.vRotationCenter=0,v.rotation&&(z.wAng=-v.rotation),v.scale&&(z.uScale=v.scale[0],z.vScale=v.scale[1]),void 0!=v.texCoord&&(z.coordinatesIndex=v.texCoord),U(z)}))))}}I(mU),j(mU,!0,(z=>new Zu(z)));const Au="KHR_xmp_json_ld";class Eu{constructor(z){this.name=Au,this.order=100,this._loader=z,this.enabled=this._loader.isExtensionUsed(Au)}dispose(){this._loader=null}onLoading(){var z,u,U;if(null===this._loader.rootBabylonMesh)return;const J=null===(z=this._loader.Kf.extensions)||void 0===z?void 0:z.KHR_xmp_json_ld,v=null===(u=this._loader.Kf.asset)||void 0===u||null===(U=u.extensions)||void 0===U?void 0:U.KHR_xmp_json_ld;if(J&&v){const z=+v.packet;J.packets&&z<J.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=J.packets[z])}}}function Cu(z,u,U,J){return f.Tu.Xu(u,U).scale(J)}function ru(z,u,U,J){return u[U]*J}function Mu(z,u,U,J){return-u[U]*J}function Tu(z,u,U,J){return u[U+1]*J}function Xu(z,u,U,J){return u[U]*J*2}function hu(z){return{scale:[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"".concat(z,".uScale"),ru,(()=>2)),new Vu(mz.b.ANIMATIONTYPE_FLOAT,"".concat(z,".vScale"),Tu,(()=>2))],offset:[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"".concat(z,".uOffset"),ru,(()=>2)),new Vu(mz.b.ANIMATIONTYPE_FLOAT,"".concat(z,".vOffset"),Tu,(()=>2))],rotation:[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"".concat(z,".wAng"),Mu,(()=>1))]}}I(Au),j(Au,!0,(z=>new Eu(z)));class tu extends G.AnimationPropertyInfo{buildAnimations(z,u,U,J){return[{babylonAnimatable:z._babylonCamera,babylonAnimation:this._buildAnimation(u,U,J)}]}}class Vu extends G.AnimationPropertyInfo{buildAnimations(z,u,U,J){const v=[];for(const f in z._data)v.push({babylonAnimatable:z._data[f].babylonMaterial,babylonAnimation:this._buildAnimation(u,U,J)});return v}}class Lu extends G.AnimationPropertyInfo{buildAnimations(z,u,U,J){return[{babylonAnimatable:z._babylonLight,babylonAnimation:this._buildAnimation(u,U,J)}]}}(0,F.l)("/cameras/{}/orthographic/xmag",[new tu(mz.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Mu,(()=>1)),new tu(mz.b.ANIMATIONTYPE_FLOAT,"orthoRight",Tu,(()=>1))]),(0,F.l)("/cameras/{}/orthographic/ymag",[new tu(mz.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Mu,(()=>1)),new tu(mz.b.ANIMATIONTYPE_FLOAT,"orthoTop",Tu,(()=>1))]),(0,F.l)("/cameras/{}/orthographic/zfar",[new tu(mz.b.ANIMATIONTYPE_FLOAT,"maxZ",ru,(()=>1))]),(0,F.l)("/cameras/{}/orthographic/znear",[new tu(mz.b.ANIMATIONTYPE_FLOAT,"Bf",ru,(()=>1))]),(0,F.l)("/cameras/{}/perspective/yfov",[new tu(mz.b.ANIMATIONTYPE_FLOAT,"fov",ru,(()=>1))]),(0,F.l)("/cameras/{}/perspective/zfar",[new tu(mz.b.ANIMATIONTYPE_FLOAT,"maxZ",ru,(()=>1))]),(0,F.l)("/cameras/{}/perspective/znear",[new tu(mz.b.ANIMATIONTYPE_FLOAT,"Bf",ru,(()=>1))]),(0,F.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Vu(mz.b.ANIMATIONTYPE_COLOR3,"albedoColor",Cu,(()=>4)),new Vu(mz.b.ANIMATIONTYPE_FLOAT,"alpha",(function(z,u,U,J){return u[U+3]*J}),(()=>4))]),(0,F.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"metallic",ru,(()=>1))]),(0,F.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"roughness",ru,(()=>1))]);const Ou=hu("albedoTexture");(0,F.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Ou.scale),(0,F.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Ou.offset),(0,F.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Ou.rotation);const xu=hu("metallicTexture");(0,F.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",xu.scale),(0,F.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",xu.offset),(0,F.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",xu.rotation),(0,F.l)("/materials/{}/emissiveFactor",[new Vu(mz.b.ANIMATIONTYPE_COLOR3,"emissiveColor",Cu,(()=>3))]);const Qu=hu("bumpTexture");(0,F.l)("/materials/{}/normalTexture/scale",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",ru,(()=>1))]),(0,F.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Qu.scale),(0,F.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Qu.offset),(0,F.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Qu.rotation),(0,F.l)("/materials/{}/occlusionTexture/strength",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",ru,(()=>1))]);const Ku=hu("ambientTexture");(0,F.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Ku.scale),(0,F.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Ku.offset),(0,F.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Ku.rotation);const Yu=hu("emissiveTexture");(0,F.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Yu.scale),(0,F.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Yu.offset),(0,F.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Yu.rotation),(0,F.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",ru,(()=>1))]),(0,F.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",ru,(()=>1))]);const pu=hu("anisotropy.texture");(0,F.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",pu.scale),(0,F.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",pu.offset),(0,F.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",pu.rotation),(0,F.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",ru,(()=>1))]),(0,F.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",ru,(()=>1))]);const Nu=hu("clearCoat.texture");(0,F.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Nu.scale),(0,F.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Nu.offset),(0,F.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Nu.rotation);const Du=hu("clearCoat.bumpTexture");(0,F.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",ru,(()=>1))]),(0,F.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Du.scale),(0,F.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Du.offset),(0,F.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Du.rotation);const cu=hu("clearCoat.textureRoughness");(0,F.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",cu.scale),(0,F.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",cu.offset),(0,F.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",cu.rotation),(0,F.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",ru,(()=>1))]),(0,F.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",ru,(()=>1))]),(0,F.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",ru,(()=>1))]),(0,F.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",ru,(()=>1))]),(0,F.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",ru,(()=>1))]),(0,F.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",ru,(()=>1))]),(0,F.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",ru,(()=>1))]);const Wu=hu("iridescence.texture");(0,F.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Wu.scale),(0,F.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Wu.offset),(0,F.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Wu.rotation);const ju=hu("iridescence.thicknessTexture");(0,F.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",ju.scale),(0,F.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",ju.offset),(0,F.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",ju.rotation),(0,F.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Vu(mz.b.ANIMATIONTYPE_COLOR3,"sheen.color",Cu,(()=>3))]),(0,F.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",ru,(()=>1))]);const Iu=hu("sheen.texture");(0,F.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Iu.scale),(0,F.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Iu.offset),(0,F.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Iu.rotation);const Fu=hu("sheen.textureRoughness");(0,F.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Fu.scale),(0,F.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Fu.offset),(0,F.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Fu.rotation),(0,F.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",ru,(()=>1))]),(0,F.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Vu(mz.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Cu,(()=>3))]);const bu=hu("metallicReflectanceTexture");(0,F.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",bu.scale),(0,F.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",bu.offset),(0,F.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",bu.rotation);const ku=hu("reflectanceTexture");(0,F.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",ku.scale),(0,F.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",ku.offset),(0,F.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",ku.rotation),(0,F.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",ru,(()=>1))]);const Bu=hu("subSurface.refractionIntensityTexture");(0,F.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Bu.scale),(0,F.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Bu.offset),(0,F.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Bu.rotation),(0,F.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Vu(mz.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Cu,(()=>3))]),(0,F.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",ru,(()=>1))]),(0,F.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",ru,(()=>1))]);const yu=hu("subSurface.thicknessTexture");(0,F.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",yu.scale),(0,F.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",yu.offset),(0,F.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",yu.rotation),(0,F.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Vu(mz.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",ru,(()=>1))]);const Hu=hu("subSurface.translucencyIntensityTexture");(0,F.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Hu.scale),(0,F.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Hu.offset),(0,F.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Hu.rotation),(0,F.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Vu(mz.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Cu,(()=>3))]);const Gu=hu("subSurface.translucencyColorTexture");(0,F.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Gu.scale),(0,F.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Gu.offset),(0,F.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Gu.rotation),(0,F.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new Lu(mz.b.ANIMATIONTYPE_COLOR3,"diffuse",Cu,(()=>3))]),(0,F.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Lu(mz.b.ANIMATIONTYPE_FLOAT,"intensity",ru,(()=>1))]),(0,F.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new Lu(mz.b.ANIMATIONTYPE_FLOAT,"range",ru,(()=>1))]),(0,F.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Lu(mz.b.ANIMATIONTYPE_FLOAT,"innerAngle",Xu,(()=>1))]),(0,F.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Lu(mz.b.ANIMATIONTYPE_FLOAT,"angle",Xu,(()=>1))]),(0,F.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new Lu(mz.b.ANIMATIONTYPE_COLOR3,"diffuse",Cu,(()=>3))]),(0,F.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Lu(mz.b.ANIMATIONTYPE_FLOAT,"intensity",ru,(()=>1))]);const au="KHR_animation_pointer";class iu{constructor(z){this.name=au,this._loader=z,this._pathToObjectConverter=(0,F.k)(this._loader.Kf)}get enabled(){return this._loader.isExtensionUsed(au)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(z,u,U,J,v){var f;const g=null===(f=J.target.extensions)||void 0===f?void 0:f.KHR_animation_pointer;if(!g||!this._pathToObjectConverter)return null;"pointer"!==J.target.path&&E.d.Warn("".concat(z,"/target/path: Value (").concat(J.target.path,") must be (","pointer",") when using the ").concat(this.name," extension")),void 0!=J.target.node&&E.d.Warn("".concat(z,"/target/node: Value (").concat(J.target.node,") must not be present when using the ").concat(this.name," extension"));const w="".concat(z,"/extensions/").concat(this.name),P=g.pointer;if(!P)throw new Error("".concat(w,": Pointer is missing"));try{const f=this._pathToObjectConverter.convert(P);if(!f.info.interpolation)throw new Error("".concat(w,"/pointer: Interpolation is missing"));return this._loader._loadAnimationChannelFromTargetInfoAsync(z,u,U,J,{object:f.object,info:f.info.interpolation},v)}catch(R){return E.d.Warn("".concat(w,"/pointer: Invalid pointer (").concat(P,") skipped")),null}}}I(au),j(au,!0,(z=>new iu(z)));class nu{constructor(z,u,U){this.frame=z,this.action=u,this.onlyOnce=U,this.isDone=!1}_clone(){return new nu(this.frame,this.action,this.onlyOnce)}}var qu=U(12782),ou=U(12827),su=U(12825);class lu{get loop(){return this._loop}set loop(z){z!==this._loop&&(this._loop=z,this.updateOptions({loop:z}))}get currentTime(){var z;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(z=ou.b.audioEngine)&&void 0!==z&&z.audioContext&&(this.isPlaying||this.isPaused)){const z=this.isPaused?0:ou.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+z}return 0}get spatialSound(){return this._spatialSound}set spatialSound(z){if(z==this._spatialSound)return;const u=this.isPlaying;this.pause(),z?(this._spatialSound=z,this._updateSpatialParameters()):this._disableSpatialSound(),u&&this.play()}constructor(z,u,U){var J;let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new S.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=v.Eu.Zero(),this._localDirection=new v.Eu(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=z,U=U||A.e.LastCreatedScene){var P,R,d,mz;if(this._scene=U,lu._SceneComponentInitialization(U),this._readyToPlayCallback=f,this._customAttenuationFunction=(z,u,U,J,v)=>u<U?z*(1-u/U):0,w)this.autoplay=w.autoplay||!1,this._loop=w.loop||!1,void 0!==w.volume&&(this._volume=w.volume),this._spatialSound=null!==(P=w.spatialSound)&&void 0!==P&&P,this.maxDistance=null!==(R=w.maxDistance)&&void 0!==R?R:100,this.useCustomAttenuation=null!==(d=w.useCustomAttenuation)&&void 0!==d&&d,this.rolloffFactor=w.rolloffFactor||1,this.refDistance=w.refDistance||1,this.distanceModel=w.distanceModel||"linear",this._playbackRate=w.playbackRate||1,this._streaming=null!==(mz=w.streaming)&&void 0!==mz&&mz,this._length=w.length,this._offset=w.offset;if(null!==(J=ou.b.audioEngine)&&void 0!==J&&J.canUseWebAudio&&ou.b.audioEngine.audioContext){this._soundGain=ou.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let z=!0;if(u)try{"string"===typeof u?(this._urlType="String",this._url=u):u instanceof ArrayBuffer?this._urlType="ArrayBuffer":u instanceof HTMLMediaElement?this._urlType="MediaElement":u instanceof MediaStream?this._urlType="MediaStream":u instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(u)&&(this._urlType="Array");let U=[],J=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=ou.b.audioEngine.audioContext.createMediaElementSource(u),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=ou.b.audioEngine.audioContext.createMediaStreamSource(u),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":u.byteLength>0&&(J=!0,this._soundLoaded(u));break;case"AudioBuffer":this._audioBufferLoaded(u);break;case"String":U.push(u);case"Array":0===U.length&&(U=u);for(let z=0;z<U.length;z++){const u=U[z];if(J=w&&w.skipCodecCheck||-1!==u.indexOf(".mp3",u.length-4)&&ou.b.audioEngine.isMP3supported||-1!==u.indexOf(".ogg",u.length-4)&&ou.b.audioEngine.isOGGsupported||-1!==u.indexOf(".wav",u.length-4)||-1!==u.indexOf(".m4a",u.length-4)||-1!==u.indexOf(".mp4",u.length-4)||-1!==u.indexOf("blob:"),J){this._streaming?(this._htmlAudioElement=new Audio(u),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,g.Tools.SetCorsBehavior(u,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(u,(z=>{this._soundLoaded(z)}),void 0,!0,!0,(z=>{z&&E.d.Error("XHR "+z.status+" error on: "+u+"."),E.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:z=!1}z?J||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):E.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(Z){E.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),ou.b.audioEngine&&!ou.b.audioEngine.WarnedWebAudioUnsupported&&(E.d.Error("Web Audio is not supported by your browser."),ou.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}}dispose(){var z;null!==(z=ou.b.audioEngine)&&void 0!==z&&z.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(z){var u;null!==(u=ou.b.audioEngine)&&void 0!==u&&u.audioContext&&(this._audioBuffer=z,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(z){var u;null!==(u=ou.b.audioEngine)&&void 0!==u&&u.audioContext&&ou.b.audioEngine.audioContext.decodeAudioData(z,(z=>{this._audioBufferLoaded(z)}),(z=>{E.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+z)}))}setAudioBuffer(z){var u;null!==(u=ou.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&(this._audioBuffer=z,this._isReadyToPlay=!0)}updateOptions(z){var u,U,J,v,f,g,w,P,R,S,d;z&&(this.loop=null!==(u=z.loop)&&void 0!==u?u:this.loop,this.maxDistance=null!==(U=z.maxDistance)&&void 0!==U?U:this.maxDistance,this.useCustomAttenuation=null!==(J=z.useCustomAttenuation)&&void 0!==J?J:this.useCustomAttenuation,this.rolloffFactor=null!==(v=z.rolloffFactor)&&void 0!==v?v:this.rolloffFactor,this.refDistance=null!==(f=z.refDistance)&&void 0!==f?f:this.refDistance,this.distanceModel=null!==(g=z.distanceModel)&&void 0!==g?g:this.distanceModel,this._playbackRate=null!==(w=z.playbackRate)&&void 0!==w?w:this._playbackRate,this._length=null!==(P=z.length)&&void 0!==P?P:void 0,this.spatialSound=null!==(R=z.spatialSound)&&void 0!==R?R:this._spatialSound,this._setOffset(null!==(S=z.offset)&&void 0!==S?S:void 0),this.setVolume(null!==(d=z.volume)&&void 0!==d?d:this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var z,u;null!==(z=ou.b.audioEngine)&&void 0!==z&&z.canUseWebAudio&&ou.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=null!==(u=this._soundPanner)&&void 0!==u?u:ou.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var z;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(z=this._soundPanner)||void 0===z||z.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var z;null!==(z=ou.b.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(z){var u;null!==(u=ou.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(z),this._isOutputConnected=!0)}setDirectionalCone(z,u,U){u<z?E.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=z,this._coneOuterAngle=u,this._coneOuterGain=U,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(z){if(z!=this._coneInnerAngle){var u;if(this._coneOuterAngle<z)return void E.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=z,null!==(u=ou.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(z){if(z!=this._coneOuterAngle){var u;if(z<this._coneInnerAngle)return void E.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=z,null!==(u=ou.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(z){var u;z.equals(this._position)||(this._position.v(z),null!==(u=ou.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(z){var u;this._localDirection=z,null!==(u=ou.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const z=this._connectedTransformNode.getWorldMatrix(),u=v.Eu.TransformNormal(this._localDirection,z);u.normalize(),this._soundPanner.orientationX.value=u.x,this._soundPanner.orientationY.value=u.y,this._soundPanner.orientationZ.value=u.z}updateDistanceFromListener(){var z;if(null!==(z=ou.b.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const z=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Cu(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,z,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(z){this._customAttenuationFunction=z}play(z,u,U){var J;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(J=ou.b.audioEngine)&&void 0!==J&&J.audioContext)try{var v,f;this._clearTimeoutsAndObservers();let J=z?(null===(v=ou.b.audioEngine)||void 0===v?void 0:v.audioContext.currentTime)+z:null===(f=ou.b.audioEngine)||void 0===f?void 0:f.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=ou.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const z=()=>{var U;if(null!==(U=ou.b.audioEngine)&&void 0!==U&&U.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=null!==u&&void 0!==u?u:0;const U=this._htmlAudioElement.play();void 0!==U&&U.catch((()=>{var u,U;(null===(u=ou.b.audioEngine)||void 0===u||u.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(U=ou.b.audioEngine)||void 0===U?void 0:U.onAudioUnlockedObservable.addOnce((()=>{z()})))}))}else{var J;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(J=ou.b.audioEngine)||void 0===J?void 0:J.onAudioUnlockedObservable.addOnce((()=>{z()}))}};z()}}else{var g;const v=()=>{var v;if(null!==(v=ou.b.audioEngine)&&void 0!==v&&v.audioContext){var f;if(U=U||this._length,void 0!==u&&this._setOffset(u),this._soundSource){const z=this._soundSource;z.onended=()=>{z.disconnect()}}if(this._soundSource=null===(f=ou.b.audioEngine)||void 0===f?void 0:f.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var g,w;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==u&&(this._soundSource.loopStart=u),void 0!==U&&(this._soundSource.loopEnd=(0|u)+U),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},J=z?(null===(g=ou.b.audioEngine)||void 0===g?void 0:g.audioContext.currentTime)+z:ou.b.audioEngine.audioContext.currentTime;const v=((this.isPaused?this.currentTime:0)+(null!==(w=this._offset)&&void 0!==w?w:0))%this._soundSource.buffer.duration;this._soundSource.start(J,v,this.loop?void 0:U)}}};"suspended"===(null===(g=ou.b.audioEngine)||void 0===g?void 0:g.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var z;"suspended"===(null===(z=ou.b.audioEngine)||void 0===z?void 0:z.audioContext.state)?(ou.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=ou.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{v()})))):v()}),500):v()}this._startTime=J,this.isPlaying=!0,this.isPaused=!1}catch(w){E.d.Error("Error while trying to play audio: "+this.name+", "+w.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(z){var u;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var U;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(U=this._streamingSource)||void 0===U||U.disconnect();this.isPlaying=!1}else if(null!==(u=ou.b.audioEngine)&&void 0!==u&&u.audioContext&&this._soundSource){const u=z?ou.b.audioEngine.audioContext.currentTime+z:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(u)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var z;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var u;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(u=this._streamingSource)||void 0===u||u.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(z=ou.b.audioEngine)&&void 0!==z&&z.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=ou.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(z,u){var U;null!==(U=ou.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._soundGain&&(u&&ou.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(ou.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,ou.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(z,ou.b.audioEngine.audioContext.currentTime+u)):this._soundGain.gain.value=z),this._volume=z}setPlaybackRate(z){this._playbackRate=z,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(z){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=z,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=z=>this._onRegisterAfterWorldMatrixUpdate(z),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(z){var u;if(z.getBoundingInfo){const u=z.getBoundingInfo();this.setPosition(u.boundingSphere.centerWorld)}else this.setPosition(z.absolutePosition);null!==(u=ou.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const z=()=>{(0,su.e)((()=>this._isReadyToPlay),(()=>{U._audioBuffer=this.getAudioBuffer(),U._isReadyToPlay=!0,U.autoplay&&U.play(0,this._offset,this._length)}),void 0,300)},u={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},U=new lu(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,u);return this.useCustomAttenuation&&U.setAttenuationFunction(this._customAttenuationFunction),U.setPosition(this._position),U.setPlaybackRate(this._playbackRate),z(),U}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const z={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(z.connectedMeshId=this._connectedTransformNode.id),z.position=this._position.jf(),z.refDistance=this.refDistance,z.distanceModel=this.distanceModel,z.isDirectional=this._isDirectional,z.localDirectionToMesh=this._localDirection.jf(),z.coneInnerAngle=this._coneInnerAngle,z.coneOuterAngle=this._coneOuterAngle,z.coneOuterGain=this._coneOuterGain),z}static Parse(z,u,U,J){const f=z.name;let g;g=z.url?U+z.url:U+f;const w={autoplay:z.autoplay,loop:z.loop,volume:z.volume,spatialSound:z.spatialSound,maxDistance:z.maxDistance,rolloffFactor:z.rolloffFactor,refDistance:z.refDistance,distanceModel:z.distanceModel,playbackRate:z.playbackRate};let P;if(J){const z=()=>{(0,su.e)((()=>J._isReadyToPlay),(()=>{P._audioBuffer=J.getAudioBuffer(),P._isReadyToPlay=!0,P.autoplay&&P.play(0,P._offset,P._length)}),void 0,300)};P=new lu(f,new ArrayBuffer(0),u,null,w),z()}else P=new lu(f,g,u,(()=>{u.removePendingData(P)}),w),u.addPendingData(P);if(z.position){const u=v.Eu.Xu(z.position);P.setPosition(u)}if(z.isDirectional&&(P.setDirectionalCone(z.coneInnerAngle||360,z.coneOuterAngle||360,z.coneOuterGain||0),z.localDirectionToMesh)){const u=v.Eu.Xu(z.localDirectionToMesh);P.setLocalDirectionToMesh(u)}if(z.connectedMeshId){const U=u.getMeshById(z.connectedMeshId);U&&P.attachToMesh(U)}return z.metadata&&(P.metadata=z.metadata),P}_setOffset(z){this._offset!==z&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=z)}_clearTimeoutsAndObservers(){var z;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(z=ou.b.audioEngine)||void 0===z||z.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}lu._SceneComponentInitialization=z=>{throw(0,qu.c)("AudioSceneComponent")},(0,tz.f)("BABYLON.Sound",lu);class eu{constructor(z,u,U){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],u.length!==U.length)throw new Error("Sounds length does not equal weights length");this.loop=z,this._weights=U;let J=0;for(const f of U)J+=f;const v=J>0?1/J:0;for(let f=0;f<this._weights.length;f++)this._weights[f]*=v;this._sounds=u;for(const f of this._sounds)f.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(z){if(z!==this._coneInnerAngle){if(this._coneOuterAngle<z)return void E.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=z;for(const u of this._sounds)u.directionalConeInnerAngle=z}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(z){if(z!==this._coneOuterAngle){if(z<this._coneInnerAngle)return void E.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=z;for(const u of this._sounds)u.directionalConeOuterAngle=z}}get volume(){return this._volume}set volume(z){if(z!==this._volume)for(const u of this._sounds)u.setVolume(z)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(z){var u;if(!this.isPaused){this.stop();const z=Math.random();let u=0;for(let U=0;U<this._weights.length;U++)if(u+=this._weights[U],z<=u){this._currentIndex=U;break}}const U=this._sounds[null!==(u=this._currentIndex)&&void 0!==u?u:0];U.isReady()?U.play(0,this.isPaused?void 0:z):U.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class zU{constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(z=z||A.e.LastCreatedScene)&&(this._scene=z,this.soundCollection=[],this._options=u,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var z;null!==(z=ou.b.audioEngine)&&void 0!==z&&z.canUseWebAudio&&ou.b.audioEngine.audioContext&&(this._outputAudioNode=ou.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(ou.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(ou.b.audioEngine&&ou.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(z){var u;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(u=ou.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&z.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==z.soundTrackId&&(-1===z.soundTrackId?this._scene.mainSoundTrack.removeSound(z):this._scene.soundTracks&&this._scene.soundTracks[z.soundTrackId].removeSound(z)),this.soundCollection.push(z),z.soundTrackId=this.id}removeSound(z){const u=this.soundCollection.indexOf(z);-1!==u&&this.soundCollection.splice(u,1)}setVolume(z){var u;null!==(u=ou.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=z)}switchPanningModelToHRTF(){var z;if(null!==(z=ou.b.audioEngine)&&void 0!==z&&z.canUseWebAudio)for(let u=0;u<this.soundCollection.length;u++)this.soundCollection[u].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var z;if(null!==(z=ou.b.audioEngine)&&void 0!==z&&z.canUseWebAudio)for(let u=0;u<this.soundCollection.length;u++)this.soundCollection[u].switchPanningModelToEqualPower()}connectToAnalyser(z){var u;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=z,null!==(u=ou.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,ou.b.audioEngine.masterGain))}}var uU=U(13193),UU=U(13161),JU=U(12758);ou.b.AudioEngineFactory=(z,u,U)=>new vU(z,u,U);class vU{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new S.e,this.onAudioLockedObservable=new S.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,JU.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const J=document.createElement("audio");this._hostElement=z,this._audioContext=u,this._audioDestination=U;try{J&&J.canPlayType&&(J.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||J.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(v){}try{J&&J.canPlayType&&J.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(v){}}lock(){this._triggerSuspendedState()}unlock(){var z,u;if("running"===(null===(z=this._audioContext)||void 0===z?void 0:z.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(u=this._audioContext)||void 0===u||u.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{E.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var z;null===(z=this._audioContext)||void 0===z||z.addEventListener("statechange",(()=>{var z;this.unlocked&&"running"!==(null===(z=this._audioContext)||void 0===z?void 0:z.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var z;return null!==(z=this._audioContext)&&void 0!==z&&z.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(z){this.canUseWebAudio=!1,E.d.Error("Web Audio: "+z.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(z){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const z=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",u=document.createElement("style");u.appendChild(document.createTextNode(z)),document.getElementsByTagName("head")[0].appendChild(u),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var z;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(z=this._audioContext)||void 0===z||z.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(z){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=z)}connectToAnalyser(z){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=z,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var fU=U(12777);(0,U(13850).i)(uU.c.NAME_AUDIO,((z,u,U,J)=>{let v,f=[];if(U.iZ=U.iZ||[],void 0!==z.iZ&&null!==z.iZ)for(let w=0,P=z.iZ.length;w<P;w++){var g;const P=z.iZ[w];null!==(g=ou.b.audioEngine)&&void 0!==g&&g.canUseWebAudio?(P.url||(P.url=P.name),f[P.url]?U.iZ.push(lu.Parse(P,u,J,f[P.url])):(v=lu.Parse(P,u,J),f[P.url]=v,U.iZ.push(v))):U.iZ.push(new lu(P.name,null,u))}f=[]})),Object.defineProperty(UU.d.prototype,"mainSoundTrack",{get:function(){let z=this._getComponent(uU.c.NAME_AUDIO);return z||(z=new gU(this),this.o(z)),this._mainSoundTrack||(this._mainSoundTrack=new zU(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),UU.d.prototype.getSoundByName=function(z){let u;for(u=0;u<this.mainSoundTrack.soundCollection.length;u++)if(this.mainSoundTrack.soundCollection[u].name===z)return this.mainSoundTrack.soundCollection[u];if(this.soundTracks)for(let U=0;U<this.soundTracks.length;U++)for(u=0;u<this.soundTracks[U].soundCollection.length;u++)if(this.soundTracks[U].soundCollection[u].name===z)return this.soundTracks[U].soundCollection[u];return null},Object.defineProperty(UU.d.prototype,"audioEnabled",{get:function(){let z=this._getComponent(uU.c.NAME_AUDIO);return z||(z=new gU(this),this.o(z)),z.audioEnabled},set:function(z){let u=this._getComponent(uU.c.NAME_AUDIO);u||(u=new gU(this),this.o(u)),z?u.enableAudio():u.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(UU.d.prototype,"headphone",{get:function(){let z=this._getComponent(uU.c.NAME_AUDIO);return z||(z=new gU(this),this.o(z)),z.headphone},set:function(z){let u=this._getComponent(uU.c.NAME_AUDIO);u||(u=new gU(this),this.o(u)),z?u.switchAudioModeForHeadphones():u.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(UU.d.prototype,"audioListenerPositionProvider",{get:function(){let z=this._getComponent(uU.c.NAME_AUDIO);return z||(z=new gU(this),this.o(z)),z.audioListenerPositionProvider},set:function(z){let u=this._getComponent(uU.c.NAME_AUDIO);if(u||(u=new gU(this),this.o(u)),z&&"function"!==typeof z)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");u.audioListenerPositionProvider=z},enumerable:!0,configurable:!0}),Object.defineProperty(UU.d.prototype,"audioListenerRotationProvider",{get:function(){let z=this._getComponent(uU.c.NAME_AUDIO);return z||(z=new gU(this),this.o(z)),z.audioListenerRotationProvider},set:function(z){let u=this._getComponent(uU.c.NAME_AUDIO);if(u||(u=new gU(this),this.o(u)),z&&"function"!==typeof z)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");u.audioListenerRotationProvider=z},enumerable:!0,configurable:!0}),Object.defineProperty(UU.d.prototype,"audioPositioningRefreshRate",{get:function(){let z=this._getComponent(uU.c.NAME_AUDIO);return z||(z=new gU(this),this.o(z)),z.audioPositioningRefreshRate},set:function(z){let u=this._getComponent(uU.c.NAME_AUDIO);u||(u=new gU(this),this.o(u)),u.audioPositioningRefreshRate=z},enumerable:!0,configurable:!0});class gU{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(z){this.name=uU.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new v.Eu,this._cachedCameraPosition=new v.Eu,this._lastCheck=0,this._invertMatrixTemp=new v.Matrix,this._cameraDirectionTemp=new v.Eu,(z=z||A.e.LastCreatedScene)&&(this.ru=z,z.soundTracks=[],z.iZ=[])}register(){this.ru._afterRenderStage.registerStep(uU.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(z){if(z.iZ=[],this.ru.soundTracks)for(let u=0;u<this.ru.soundTracks.length;u++){const U=this.ru.soundTracks[u];for(let u=0;u<U.soundCollection.length;u++)z.iZ.push(U.soundCollection[u].serialize())}}addFromContainer(z){if(z.iZ)for(const u of z.iZ)u.play(),u.autoplay=!0,this.ru.mainSoundTrack.addSound(u)}removeFromContainer(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(z.iZ)for(const U of z.iZ)U.stop(),U.autoplay=!1,this.ru.mainSoundTrack.removeSound(U),u&&U.dispose()}dispose(){const z=this.ru;if(z._mainSoundTrack&&z.mainSoundTrack.dispose(),z.soundTracks)for(let u=0;u<z.soundTracks.length;u++)z.soundTracks[u].dispose()}disableAudio(){const z=this.ru;let u;for(this._audioEnabled=!1,ou.b.audioEngine&&ou.b.audioEngine.audioContext&&ou.b.audioEngine.audioContext.suspend(),u=0;u<z.mainSoundTrack.soundCollection.length;u++)z.mainSoundTrack.soundCollection[u].pause();if(z.soundTracks)for(u=0;u<z.soundTracks.length;u++)for(let U=0;U<z.soundTracks[u].soundCollection.length;U++)z.soundTracks[u].soundCollection[U].pause()}enableAudio(){const z=this.ru;let u;for(this._audioEnabled=!0,ou.b.audioEngine&&ou.b.audioEngine.audioContext&&ou.b.audioEngine.audioContext.resume(),u=0;u<z.mainSoundTrack.soundCollection.length;u++)z.mainSoundTrack.soundCollection[u].isPaused&&z.mainSoundTrack.soundCollection[u].play();if(z.soundTracks)for(u=0;u<z.soundTracks.length;u++)for(let U=0;U<z.soundTracks[u].soundCollection.length;U++)z.soundTracks[u].soundCollection[U].isPaused&&z.soundTracks[u].soundCollection[U].play()}switchAudioModeForHeadphones(){const z=this.ru;if(this._headphone=!0,z.mainSoundTrack.switchPanningModelToHRTF(),z.soundTracks)for(let u=0;u<z.soundTracks.length;u++)z.soundTracks[u].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const z=this.ru;if(this._headphone=!1,z.mainSoundTrack.switchPanningModelToEqualPower(),z.soundTracks)for(let u=0;u<z.soundTracks.length;u++)z.soundTracks[u].switchPanningModelToEqualPower()}_afterRender(){const z=fU.e.Now;if(this._lastCheck&&z-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=z;const u=this.ru;if(!this._audioEnabled||!u._mainSoundTrack||!u.soundTracks||0===u._mainSoundTrack.soundCollection.length&&1===u.soundTracks.length)return;const U=ou.b.audioEngine;if(U&&U.audioContext){let z,J=u.activeCamera;if(u.activeCameras&&u.activeCameras.length>0&&(J=u.activeCameras[0]),this.audioListenerPositionProvider){const z=this.audioListenerPositionProvider();U.audioContext.listener.setPosition(z.x||0,z.y||0,z.z||0)}else J?this._cachedCameraPosition.equals(J.globalPosition)||(this._cachedCameraPosition.v(J.globalPosition),U.audioContext.listener.setPosition(J.globalPosition.x,J.globalPosition.y,J.globalPosition.z)):U.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const z=this.audioListenerRotationProvider();U.audioContext.listener.setOrientation(z.x||0,z.y||0,z.z||0,0,1,0)}else J?(J.rigCameras&&J.rigCameras.length>0&&(J=J.rigCameras[0]),J.getViewMatrix().invertToRef(this._invertMatrixTemp),v.Eu.TransformNormalToRef(gU._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.v(this._cameraDirectionTemp),U.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):U.audioContext.listener.setOrientation(0,0,0,0,1,0);for(z=0;z<u.mainSoundTrack.soundCollection.length;z++){const U=u.mainSoundTrack.soundCollection[z];U.useCustomAttenuation&&U.updateDistanceFromListener()}if(u.soundTracks)for(z=0;z<u.soundTracks.length;z++)for(let U=0;U<u.soundTracks[z].soundCollection.length;U++){const J=u.soundTracks[z].soundCollection[U];J.useCustomAttenuation&&J.updateDistanceFromListener()}}}}gU._CameraDirection=new v.Eu(0,0,-1),lu._SceneComponentInitialization=z=>{let u=z._getComponent(uU.c.NAME_AUDIO);u||(u=new gU(z),z.o(u))};const wU="MSFT_audio_emitter";class PU{constructor(z){this.name=wU,this._loader=z,this.enabled=this._loader.isExtensionUsed(wU)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const z=this._loader.Kf.extensions;if(z&&z[this.name]){const u=z[this.name];this._clips=u.clips,this._emitters=u.emitters,B.Assign(this._clips),B.Assign(this._emitters)}}loadSceneAsync(z,u){return H.LoadExtensionAsync(z,u,this.name,(async(U,J)=>{const v=new Array;v.push(this._loader.loadSceneAsync(z,u));for(const z of J.emitters){const u=B.Get("".concat(U,"/emitters"),this._emitters,z);if(void 0!=u.refDistance||void 0!=u.maxDistance||void 0!=u.rolloffFactor||void 0!=u.distanceModel||void 0!=u.innerAngle||void 0!=u.outerAngle)throw new Error("".concat(U,": Direction or Distance properties are not allowed on emitters attached to a scene"));v.push(this._loadEmitterAsync("".concat(U,"/emitters/").concat(u.index),u))}await Promise.all(v)}))}loadNodeAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(z,J)=>{const f=new Array,w=await this._loader.loadNodeAsync(z,u,(u=>{for(const U of J.emitters){const J=B.Get("".concat(z,"/emitters"),this._emitters,U);f.push(this._loadEmitterAsync("".concat(z,"/emitters/").concat(J.index),J).then((()=>{for(const z of J._babylonSounds)z.attachToMesh(u),void 0==J.innerAngle&&void 0==J.outerAngle||(z.setLocalDirectionToMesh(v.Eu.Forward()),z.setDirectionalCone(2*g.Tools.ToDegrees(void 0==J.innerAngle?Math.PI:J.innerAngle),2*g.Tools.ToDegrees(void 0==J.outerAngle?Math.PI:J.outerAngle),0))})))}U(u)}));return await Promise.all(f),w}))}loadAnimationAsync(z,u){return H.LoadExtensionAsync(z,u,this.name,(async(U,J)=>{const v=await this._loader.loadAnimationAsync(z,u),f=new Array;B.Assign(J.events);for(const g of J.events)f.push(this._loadAnimationEventAsync("".concat(U,"/events/").concat(g.index),z,u,g,v));return await Promise.all(f),v}))}_loadClipAsync(z,u){if(u._objectURL)return u._objectURL;let U;if(u.uri)U=this._loader.loadUriAsync(z,u,u.uri);else{const J=B.Get("".concat(z,"/bufferView"),this._loader.Kf.bufferViews,u.bufferView);U=this._loader.loadBufferViewAsync("/bufferViews/".concat(J.index),J)}return u._objectURL=U.then((z=>URL.createObjectURL(new Blob([z],{type:u.mimeType})))),u._objectURL}_loadEmitterAsync(z,u){if(u._babylonSounds=u._babylonSounds||[],!u._babylonData){const z=new Array,U=u.name||"vu".concat(u.index),J={loop:!1,autoplay:!1,volume:void 0==u.volume?1:u.volume};for(let f=0;f<u.clips.length;f++){const v="/extensions/".concat(this.name,"/clips"),g=B.Get(v,this._clips,u.clips[f].clip);z.push(this._loadClipAsync("".concat(v,"/").concat(u.clips[f].clip),g).then((z=>{const v=u._babylonSounds[f]=new lu(U,z,this._loader.babylonScene,null,J);v.refDistance=u.refDistance||1,v.maxDistance=u.maxDistance||256,v.rolloffFactor=u.rolloffFactor||1,v.distanceModel=u.distanceModel||"exponential"})))}const v=Promise.all(z).then((()=>{const z=u.clips.map((z=>z.weight||1)),U=new eu(u.loop||!1,u._babylonSounds,z);u.innerAngle&&(U.directionalConeInnerAngle=2*g.Tools.ToDegrees(u.innerAngle)),u.outerAngle&&(U.directionalConeOuterAngle=2*g.Tools.ToDegrees(u.outerAngle)),u.volume&&(U.volume=u.volume),u._babylonData.sound=U}));u._babylonData={loaded:v}}return u._babylonData.loaded}_getEventAction(z,u,U,J,v){switch(U){case"play":return z=>{const U=(v||0)+(z-J);u.play(U)};case"stop":return()=>{u.stop()};case"pause":return()=>{u.pause()};default:throw new Error("".concat(z,": Unsupported action ").concat(U))}}_loadAnimationEventAsync(z,u,U,J,v){if(0==v.targetedAnimations.length)return Promise.resolve();const f=v.targetedAnimations[0],g=J.vu,w=B.Get("/extensions/".concat(this.name,"/emitters"),this._emitters,g);return this._loadEmitterAsync(z,w).then((()=>{const u=w._babylonData.sound;if(u){const U=new nu(J.time,this._getEventAction(z,u,J.action,J.time,J.startOffset));f.animation.addEvent(U),v.onAnimationGroupEndObservable.add((()=>{u.stop()})),v.onAnimationGroupPauseObservable.add((()=>{u.pause()}))}}))}}I(wU),j(wU,!0,(z=>new PU(z)));const RU="MSFT_lod";class SU{constructor(z){var u,U;this.name=RU,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new S.e,this.onMaterialLODsLoadedObservable=new S.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=z,this.maxLODsToLoad=null!==(u=null===(U=this._loader.parent.extensionOptions[RU])||void 0===U?void 0:U.maxLODsToLoad)&&void 0!==u?u:this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(RU)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let z=0;z<this._nodePromiseLODs.length;z++){const u=Promise.all(this._nodePromiseLODs[z]).then((()=>{0!==z&&(this._loader.endPerformanceCounter("Node LOD ".concat(z)),this._loader.log("Loaded node LOD ".concat(z))),this.onNodeLODsLoadedObservable.notifyObservers(z),z!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter("Node LOD ".concat(z+1)),this._loadBufferLOD(this._nodeBufferLODs,z+1),this._nodeSignalLODs[z]&&this._nodeSignalLODs[z].resolve())}));this._loader._completePromises.push(u)}for(let z=0;z<this._materialPromiseLODs.length;z++){const u=Promise.all(this._materialPromiseLODs[z]).then((()=>{0!==z&&(this._loader.endPerformanceCounter("Material LOD ".concat(z)),this._loader.log("Loaded material LOD ".concat(z))),this.onMaterialLODsLoadedObservable.notifyObservers(z),z!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter("Material LOD ".concat(z+1)),this._loadBufferLOD(this._materialBufferLODs,z+1),this._materialSignalLODs[z]&&this._materialSignalLODs[z].resolve())}));this._loader._completePromises.push(u)}}loadSceneAsync(z,u){const U=this._loader.loadSceneAsync(z,u);return this._loadBufferLOD(this._bufferLODs,0),U}loadNodeAsync(z,u,U){return H.LoadExtensionAsync(z,u,this.name,(async(z,v)=>{let f;const g=this._getLODs(z,u,this._loader.Kf.nodes,v.ids);this._loader.logOpen("".concat(z));for(let u=0;u<g.length;u++){const z=g[u];0!==u&&(this._nodeIndexLOD=u,this._nodeSignalLODs[u]=this._nodeSignalLODs[u]||new J);const v=z=>{U(z),z.QP(!1)},w=this._loader.loadNodeAsync("/nodes/".concat(z.index),z,v).then((z=>{if(0!==u){const z=g[u-1];z._babylonTransformNode&&(this._disposeTransformNode(z._babylonTransformNode),delete z._babylonTransformNode)}return z.QP(!0),z}));this._nodePromiseLODs[u]=this._nodePromiseLODs[u]||[],0===u?f=w:(this._nodeIndexLOD=null,this._nodePromiseLODs[u].push(w))}return this._loader.logClose(),await f}))}_loadMaterialAsync(z,u,U,J,v){return this._nodeIndexLOD?null:H.LoadExtensionAsync(z,u,this.name,(async(z,f)=>{let g;const w=this._getLODs(z,u,this._loader.Kf.materials,f.ids);this._loader.logOpen("".concat(z));for(let u=0;u<w.length;u++){const z=w[u];0!==u&&(this._materialIndexLOD=u);const f=this._loader._loadMaterialAsync("/materials/".concat(z.index),z,U,J,(z=>{0===u&&v(z)})).then((z=>{if(0!==u){v(z);const U=w[u-1]._data;U[J]&&(this._disposeMaterials([U[J].babylonMaterial]),delete U[J])}return z}));this._materialPromiseLODs[u]=this._materialPromiseLODs[u]||[],0===u?g=f:(this._materialIndexLOD=null,this._materialPromiseLODs[u].push(f))}return this._loader.logClose(),await g}))}_loadUriAsync(z,u,U){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const v=this._nodeIndexLOD-1;return this._nodeSignalLODs[v]=this._nodeSignalLODs[v]||new J,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(z,u,U)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const v=this._materialIndexLOD-1;return this._materialSignalLODs[v]=this._materialSignalLODs[v]||new J,this._materialSignalLODs[v].promise.then((async()=>await this._loader.loadUriAsync(z,u,U)))}return null}loadBufferAsync(z,u,U,v){if(this._loader.parent.useRangeRequests&&!u.uri){if(!this._loader.bin)throw new Error("".concat(z,": Uri is missing or the binary glTF is missing its binary chunk"));const u=async(z,u)=>{const f=U,g=f+v-1;let w=z[u];return w?(w.start=Math.min(w.start,f),w.end=Math.max(w.end,g)):(w={start:f,end:g,loaded:new J},z[u]=w),await w.loaded.promise.then((z=>new Uint8Array(z.buffer,z.byteOffset+U-w.start,v)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?u(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?u(this._materialBufferLODs,this._materialIndexLOD):u(this._bufferLODs,0)}return null}_loadBufferLOD(z,u){const U=z[u];U&&(this._loader.log("Loading buffer range [".concat(U.start,"-").concat(U.end,"]")),this._loader.bin.readAsync(U.start,U.end-U.start+1).then((z=>{U.loaded.resolve(z)}),(z=>{U.loaded.reject(z)})))}_getLODs(z,u,U,J){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const v=[];for(let f=J.length-1;f>=0;f--)if(v.push(B.Get("".concat(z,"/ids/").concat(J[f]),U,J[f])),v.length===this.maxLODsToLoad)return v;return v.push(u),v}_disposeTransformNode(z){const u=[],U=z.material;U&&u.push(U);for(const v of z.getChildMeshes())v.material&&u.push(v.material);z.dispose();const J=u.filter((z=>this._loader.babylonScene.meshes.every((u=>u.material!=z))));this._disposeMaterials(J)}_disposeMaterials(z){const u={};for(const U of z){for(const z of U.getActiveTextures())u[z.uniqueId]=z;U.dispose()}for(const U in u)for(const z of this._loader.babylonScene.materials)z.hasTexture(u[U])&&delete u[U];for(const U in u)u[U].dispose()}}I(RU),j(RU,!0,(z=>new SU(z)));const dU="MSFT_minecraftMesh";class mJ{constructor(z){this.name=dU,this._loader=z,this.enabled=this._loader.isExtensionUsed(dU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtraAsync(z,u,this.name,(async(J,v)=>{if(v){if(!(U instanceof T.e))throw new Error("".concat(J,": Material type not supported"));const v=this._loader.loadMaterialPropertiesAsync(z,u,U);return U.needAlphaBlending()&&(U.forceDepthWrite=!0,U.separateCullingPass=!0),U.ef=U.forceDepthWrite,U.twoSidedLighting=!0,await v}}))}}I(dU),j(dU,!0,(z=>new mJ(z)));const ZU="MSFT_sRGBFactors";class AU{constructor(z){this.name=ZU,this._loader=z,this.enabled=this._loader.isExtensionUsed(ZU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,U){return H.LoadExtraAsync(z,u,this.name,(async(J,v)=>{if(v){if(!(U instanceof T.e))throw new Error("".concat(J,": Material type not supported"));const v=this._loader.loadMaterialPropertiesAsync(z,u,U),f=U.Vz().getEngine().useExactSrgbConversions;return U.albedoTexture||U.albedoColor.toLinearSpaceToRef(U.albedoColor,f),U.reflectivityTexture||U.reflectivityColor.toLinearSpaceToRef(U.reflectivityColor,f),await v}}))}}I(ZU),j(ZU,!0,(z=>new AU(z)));var EU=U(14175);const CU={};var rU=U(14236),MU=U(14211),TU=U(14184),XU=U(14196);function hU(z,u){for(const U of z)for(const z of U.dataOutputs)if(z.uniqueId===u)return z;throw new Error("Could not find data out connection with unique id "+u)}function tU(z,u){for(const U of z)if(U instanceof MU.d)for(const z of U.signalInputs)if(z.uniqueId===u)return z;throw new Error("Could not find signal in connection with unique id "+u)}async function VU(z,u){const J=await Promise.all(z.allBlocks.map((async z=>{const u=function(z){switch(z){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([U.e(78),U.e(79)]).then(U.bind(U,15659))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await U.e(80).then(U.bind(U,15662))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await U.e(81).then(U.bind(U,15671))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await U.e(82).then(U.bind(U,15676))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await U.e(83).then(U.bind(U,15678))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await U.e(84).then(U.bind(U,15685))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await U.e(85).then(U.bind(U,15693))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await U.e(86).then(U.bind(U,15702))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await U.e(87).then(U.bind(U,15711))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await U.e(89).then(U.bind(U,15736))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await U.e(89).then(U.bind(U,15736))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await U.e(89).then(U.bind(U,15736))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await U.e(89).then(U.bind(U,15736))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await U.e(89).then(U.bind(U,15736))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await U.e(89).then(U.bind(U,15736))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await U.e(90).then(U.bind(U,15745))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await U.e(90).then(U.bind(U,15745))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await U.e(90).then(U.bind(U,15745))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await U.e(90).then(U.bind(U,15745))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await U.e(95).then(U.bind(U,15753))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await U.e(96).then(U.bind(U,15758))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await U.e(97).then(U.bind(U,15767))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await U.e(98).then(U.bind(U,15773))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await U.e(99).then(U.bind(U,15780))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await U.e(100).then(U.bind(U,15785))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await U.e(101).then(U.bind(U,15788))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await U.e(102).then(U.bind(U,15796))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await U.e(103).then(U.bind(U,15805))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await U.e(104).then(U.bind(U,15814))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await U.e(105).then(U.bind(U,15820))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await U.e(106).then(U.bind(U,15825))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await U.e(107).then(U.bind(U,15834))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await U.e(108).then(U.bind(U,15843))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await U.e(109).then(U.bind(U,15849))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await U.e(110).then(U.bind(U,15853))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await U.e(111).then(U.bind(U,15859))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await U.e(112).then(U.bind(U,15861))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await U.e(113).then(U.bind(U,15864))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await U.e(92).then(U.bind(U,15871))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await U.e(114).then(U.bind(U,15877))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await U.e(115).then(U.bind(U,15881))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await U.e(116).then(U.bind(U,15890))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await U.e(93).then(U.bind(U,15896))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await U.e(88).then(U.bind(U,15718))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await U.e(94).then(U.bind(U,15903))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await U.e(94).then(U.bind(U,15903))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await U.e(94).then(U.bind(U,15903))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await U.e(94).then(U.bind(U,15903))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await U.e(94).then(U.bind(U,15903))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await U.e(94).then(U.bind(U,15903))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await U.e(94).then(U.bind(U,15903))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await U.e(94).then(U.bind(U,15903))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await U.e(89).then(U.bind(U,15736))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await U.e(89).then(U.bind(U,15736))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await U.e(89).then(U.bind(U,15736))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await U.e(89).then(U.bind(U,15736))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await U.e(89).then(U.bind(U,15736))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await U.e(89).then(U.bind(U,15736))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await U.e(89).then(U.bind(U,15736))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await U.e(90).then(U.bind(U,15745))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await U.e(90).then(U.bind(U,15745))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await U.e(91).then(U.bind(U,15908))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await U.e(91).then(U.bind(U,15908))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await U.e(91).then(U.bind(U,15908))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await U.e(91).then(U.bind(U,15908))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await U.e(91).then(U.bind(U,15908))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await U.e(91).then(U.bind(U,15908))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await U.e(117).then(U.bind(U,15917))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await U.e(118).then(U.bind(U,15924))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await U.e(119).then(U.bind(U,15926))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await U.e(120).then(U.bind(U,15934))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await U.e(121).then(U.bind(U,15937))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await U.e(122).then(U.bind(U,15940))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await U.e(123).then(U.bind(U,15942))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await U.e(124).then(U.bind(U,15951))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await U.e(125).then(U.bind(U,15957))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await U.e(126).then(U.bind(U,15959))).FlowGraphDataSwitchBlock;default:if(CU[z])return CU[z];throw new Error("Unknown block name ".concat(z))}}(z.className);return await u()})));return function(z,u,U){var J;const v=u.coordinator.createGraph(),f=[],g=null!==(J=u.valueParseFunction)&&void 0!==J?J:TU.d;for(let w=0;w<z.allBlocks.length;w++){const J=OU(z.allBlocks[w],{ru:u.coordinator.config.ru,pathConverter:u.pathConverter,assetsContainer:u.coordinator.config.ru,valueParseFunction:g},U[w]);f.push(J),J instanceof rU.e&&v.addEventBlock(J)}for(const w of f){for(const z of w.dataInputs)for(const u of z.connectedPointIds){const U=hU(f,u);z.connectTo(U)}if(w instanceof MU.d)for(const z of w.signalOutputs)for(const u of z.connectedPointIds){const U=tU(f,u);z.connectTo(U)}}for(const w of z.executionContexts)LU(w,{graph:v,valueParseFunction:g},z.rightHanded);return v}(z,u,J)}function LU(z,u,U){var J;const v=u.graph.createContext();z.enableLogging&&(v.enableLogging=!0),v.treatDataAsRightHanded=U||!1;const f=null!==(J=u.valueParseFunction)&&void 0!==J?J:TU.d;v.uniqueId=z.uniqueId;const g=v.Vz();if(z._assetsContext){var w,P,R,S,d,mz,Z,A,E,C;const u=z._assetsContext,U={meshes:null===(w=u.meshes)||void 0===w?void 0:w.map((z=>g.getMeshById(z))),lights:null===(P=u.lights)||void 0===P?void 0:P.map((z=>g.getLightByName(z))),cameras:null===(R=u.cameras)||void 0===R?void 0:R.map((z=>g.getCameraByName(z))),materials:null===(S=u.materials)||void 0===S?void 0:S.map((z=>g.getMaterialById(z))),textures:null===(d=u.textures)||void 0===d?void 0:d.map((z=>g.getTextureByName(z))),animations:null===(mz=u.animations)||void 0===mz?void 0:mz.map((z=>g.animations.find((u=>u.name===z)))),skeletons:null===(Z=u.skeletons)||void 0===Z?void 0:Z.map((z=>g.getSkeletonByName(z))),mA:null===(A=u.mA)||void 0===A?void 0:A.map((z=>g.getParticleSystemById(z))),animationGroups:null===(E=u.animationGroups)||void 0===E?void 0:E.map((z=>g.getAnimationGroupByName(z))),transformNodes:null===(C=u.transformNodes)||void 0===C?void 0:C.map((z=>g.getTransformNodeById(z))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],iZ:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};v.assetsContext=U}for(const r in z._userVariables){const u=f(r,z._userVariables,v.assetsContext,g);v.userVariables[r]=u}for(const r in z._connectionValues){const u=f(r,z._connectionValues,v.assetsContext,g);v._setConnectionValueByKey(r,u)}return v}function OU(z,u,U){var J;const v={},f=null!==(J=u.valueParseFunction)&&void 0!==J?J:TU.d;if(z.config)for(const w in z.config)v[w]=f(w,z.config,u.assetsContainer||u.ru,u.ru);if((0,TU.j)(z.className)){if(!u.pathConverter)throw new Error("Path converter is required for this block");v.pathConverter=u.pathConverter}const g=new U(v);g.uniqueId=z.uniqueId;for(let w=0;w<z.dataInputs.length;w++){const u=g.getDataInput(z.dataInputs[w].name);if(!u)throw new Error("Could not find data input with name "+z.dataInputs[w].name+" in block "+z.className);u.deserialize(z.dataInputs[w])}for(let w=0;w<z.dataOutputs.length;w++){const u=g.getDataOutput(z.dataOutputs[w].name);if(!u)throw new Error("Could not find data output with name "+z.dataOutputs[w].name+" in block "+z.className);u.deserialize(z.dataOutputs[w])}return g.metadata=z.metadata,g.deserialize&&g.deserialize(z),g}function xU(z){const[u,U]=z.split(":");return QU({op:u,extension:U})}function QU(z){var u;let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const J=z.extension?null===(u=YU[z.extension])||void 0===u?void 0:u[z.op]:pU[z.op];if(!J&&(E.d.Warn("No mapping found for operation ".concat(z.op," and extension ").concat(z.extension||"KHR_interactivity")),U)){const u={},U={flows:{}};if(z.inputValueSockets){u.values={};for(const U in z.inputValueSockets)u.values[U]={name:U}}return z.outputValueSockets&&(U.values={},Object.keys(z.outputValueSockets).forEach((z=>{U.values[z]={name:z}}))),{nS:[],inputs:u,outputs:U}}return J}function KU(z,u,U){YU[u]||(YU[u]={}),YU[u][z]=U}const YU={BABYLON:{"flow/log":{nS:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},pU={"event/onStart":{nS:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{nS:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{nS:["FlowGraphSendCustomEventBlock"],extraProcessor(z,u,U,J,v){if("event/send"!==u.op||!z.configuration||1!==Object.keys(z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const f=z.configuration.event.value[0];if("number"!==typeof f)throw new Error("Event id should be a number");const g=J.arrays.events[f],w=v[0];return w.config||(w.config={}),w.config.eventId=g.eventId,w.config.eventData=g.eventData,v}},"event/receive":{nS:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(z,u){var U;if(!z.configuration)return E.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const J=z.configuration.event;if(!J)return E.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const v=J.value[0];if("number"!==typeof v)return E.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(U=u.events)||void 0===U?void 0:U[v])?{valid:!0}:(E.d.Error("Event with id ".concat(v," not found")),{valid:!1,error:"Event with id ".concat(v," not found")})},extraProcessor(z,u,U,J,v){if("event/receive"!==u.op||!z.configuration||1!==Object.keys(z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const f=z.configuration.event.value[0];if("number"!==typeof f)throw new Error("Event id should be a number");const g=J.arrays.events[f],w=v[0];return w.config||(w.config={}),w.config.eventId=g.eventId,w.config.eventData=g.eventData,v}},"math/e":NU("FlowGraphEBlock"),"math/pi":NU("FlowGraphPIBlock"),"math/inf":NU("FlowGraphInfBlock"),"math/nan":NU("FlowGraphNaNBlock"),"math/abs":NU("FlowGraphAbsBlock"),"math/sign":NU("FlowGraphSignBlock"),"math/trunc":NU("FlowGraphTruncBlock"),"math/floor":NU("FlowGraphFloorBlock"),"math/ceil":NU("FlowGraphCeilBlock"),"math/round":{nS:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,U,J,v){var f;return(f=v[0]).config||(f.config={}),v[0].config.roundHalfAwayFromZero=!0,v}},"math/fract":NU("FlowGraphFractBlock"),"math/neg":NU("FlowGraphNegationBlock"),"math/add":NU("FlowGraphAddBlock",["a","b"],!0),"math/sub":NU("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{nS:["FlowGraphMultiplyBlock"],extraProcessor(z,u,U,J,v){var f;(f=v[0]).config||(f.config={}),v[0].config.useMatrixPerComponent=!0,v[0].config.preventIntegerFloatArithmetic=!0;let g=-1;return Object.keys(z.values||{}).find((u=>{var U;return void 0!==(null===(U=z.values)||void 0===U?void 0:U[u].type)&&(g=z.values[u].type,!0)})),-1!==g&&(v[0].config.type=J.arrays.types[g].flowGraphType),v},validation:z=>z.values?DU(z):{valid:!0}},"math/div":NU("FlowGraphDivideBlock",["a","b"],!0),"math/rem":NU("FlowGraphModuloBlock",["a","b"]),"math/min":NU("FlowGraphMinBlock",["a","b"]),"math/max":NU("FlowGraphMaxBlock",["a","b"]),"math/clamp":NU("FlowGraphClampBlock",["a","b","c"]),"math/saturate":NU("FlowGraphSaturateBlock"),"math/mix":NU("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":NU("FlowGraphEqualityBlock",["a","b"]),"math/lt":NU("FlowGraphLessThanBlock",["a","b"]),"math/le":NU("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":NU("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":NU("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":NU("FlowGraphIsNaNBlock"),"math/isinf":NU("FlowGraphIsInfBlock"),"math/select":{nS:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{nS:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":NU("FlowGraphSinBlock"),"math/cos":NU("FlowGraphCosBlock"),"math/tan":NU("FlowGraphTanBlock"),"math/asin":NU("FlowGraphASinBlock"),"math/acos":NU("FlowGraphACosBlock"),"math/atan":NU("FlowGraphATanBlock"),"math/atan2":NU("FlowGraphATan2Block",["a","b"]),"math/sinh":NU("FlowGraphSinhBlock"),"math/cosh":NU("FlowGraphCoshBlock"),"math/tanh":NU("FlowGraphTanhBlock"),"math/asinh":NU("FlowGraphASinhBlock"),"math/acosh":NU("FlowGraphACoshBlock"),"math/atanh":NU("FlowGraphATanhBlock"),"math/exp":NU("FlowGraphExponentialBlock"),"math/log":NU("FlowGraphLogBlock"),"math/log2":NU("FlowGraphLog2Block"),"math/log10":NU("FlowGraphLog10Block"),"math/sqrt":NU("FlowGraphSquareRootBlock"),"math/cbrt":NU("FlowGraphCubeRootBlock"),"math/pow":NU("FlowGraphPowerBlock",["a","b"]),"math/length":NU("FlowGraphLengthBlock"),"math/normalize":NU("FlowGraphNormalizeBlock"),"math/dot":NU("FlowGraphDotBlock",["a","b"]),"math/cross":NU("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":NU("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":NU("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{nS:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{nS:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{nS:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{nS:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{nS:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{nS:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{nS:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":NU("FlowGraphTransposeBlock"),"math/determinant":NU("FlowGraphDeterminantBlock"),"math/inverse":NU("FlowGraphInvertMatrixBlock"),"math/matmul":NU("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{nS:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Ug",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,U,J,v,f){const g=v[0].dataInputs.find((z=>"rotationQuaternion"===z.name));if(!g)throw new Error("Rotation quaternion input not found");return f._connectionValues[g.uniqueId]&&(f._connectionValues[g.uniqueId].type="Quaternion"),v}},"math/matDecompose":{nS:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Ug"}}}},"math/quatConjugate":NU("FlowGraphConjugateBlock",["a"]),"math/quatMul":{nS:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,U,J,v){var f;return(f=v[0]).config||(f.config={}),v[0].config.type="Quaternion",v}},"math/quatAngleBetween":NU("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{nS:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":NU("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":NU("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{nS:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,U,J,v){var f;return(f=v[0]).config||(f.config={}),v[0].config.inputIsColumnMajor=!0,v}},"math/extract2x2":{nS:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{nS:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,U,J,v){var f;return(f=v[0]).config||(f.config={}),v[0].config.inputIsColumnMajor=!0,v}},"math/extract3x3":{nS:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{nS:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,U,J,v){var f;return(f=v[0]).config||(f.config={}),v[0].config.inputIsColumnMajor=!0,v}},"math/extract4x4":{nS:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{nS:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,U,J,v,f){var g,w,P;(P=v[0]).config||(P.config={});const R=v[0].dataInputs[0];return v[0].config.valueType=null!==(g=null===(w=f._connectionValues[R.uniqueId])||void 0===w?void 0:w.type)&&void 0!==g?g:"FlowGraphInteger",v}},"math/and":{nS:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,U,J,v,f){var g,w,P,R,S;(S=v[0]).config||(S.config={});const d=v[0].dataInputs[0],mz=v[0].dataInputs[1];return v[0].config.valueType=null!==(g=null!==(w=null===(P=f._connectionValues[d.uniqueId])||void 0===P?void 0:P.type)&&void 0!==w?w:null===(R=f._connectionValues[mz.uniqueId])||void 0===R?void 0:R.type)&&void 0!==g?g:"FlowGraphInteger",v}},"math/or":{nS:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,U,J,v,f){var g,w,P,R,S;(S=v[0]).config||(S.config={});const d=v[0].dataInputs[0],mz=v[0].dataInputs[1];return v[0].config.valueType=null!==(g=null!==(w=null===(P=f._connectionValues[d.uniqueId])||void 0===P?void 0:P.type)&&void 0!==w?w:null===(R=f._connectionValues[mz.uniqueId])||void 0===R?void 0:R.type)&&void 0!==g?g:"FlowGraphInteger",v}},"math/xor":{nS:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,U,J,v,f){var g,w,P,R,S;(S=v[0]).config||(S.config={});const d=v[0].dataInputs[0],mz=v[0].dataInputs[1];return v[0].config.valueType=null!==(g=null!==(w=null===(P=f._connectionValues[d.uniqueId])||void 0===P?void 0:P.type)&&void 0!==w?w:null===(R=f._connectionValues[mz.uniqueId])||void 0===R?void 0:R.type)&&void 0!==g?g:"FlowGraphInteger",v}},"math/asr":NU("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":NU("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":NU("FlowGraphLeadingZerosBlock"),"math/ctz":NU("FlowGraphTrailingZerosBlock"),"math/popcnt":NU("FlowGraphOneBitsCounterBlock"),"math/rad":NU("FlowGraphDegToRadBlock"),"math/deg":NU("FlowGraphRadToDegBlock"),"type/boolToInt":NU("FlowGraphBooleanToInt"),"type/boolToFloat":NU("FlowGraphBooleanToFloat"),"type/intToBool":NU("FlowGraphIntToBoolean"),"type/intToFloat":NU("FlowGraphIntToFloat"),"type/floatToInt":NU("FlowGraphFloatToInt"),"type/floatToBool":NU("FlowGraphFloatToBoolean"),"flow/sequence":{nS:["FlowGraphSequenceBlock"],extraProcessor(z,u,U,J,v){const f=v[0];return f.config||(f.config={}),f.config.outputSignalCount=Object.keys(z.flows||[]).length,f.signalOutputs.forEach(((z,u)=>{z.name="out_"+u})),v}},"flow/branch":{nS:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{nS:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(z){if(z.configuration&&z.configuration.cases){const u=z.configuration.cases.value;if(!u.every((z=>"number"===typeof z&&/^-?\d+$/.test(z.toString()))))return E.d.Warn("Switch cases should be integers. Using empty array instead."),z.configuration.cases.value=[],{valid:!0};const U=new Set(u);z.configuration.cases.value=Array.from(U)}return{valid:!0}},extraProcessor(z,u,U,J,v){if("flow/switch"!==u.op||!z.flows||0===Object.keys(z.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return v[0].signalOutputs.forEach((z=>{"default"!==z.name&&(z.name="out_"+z.name)})),v}},"flow/while":{nS:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{nS:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(z,u,U,J,v){const f=v[0];return f.config||(f.config={}),f.config.incrementIndexWhenLoopDone=!0,v}},"flow/doN":{nS:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{nS:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(z,u,U,J,v){if("flow/multiGate"!==u.op||!z.flows||0===Object.keys(z.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const f=v[0];return f.config||(f.config={}),f.config.outputSignalCount=Object.keys(z.flows).length,f.signalOutputs.forEach(((z,u)=>{z.name="out_"+u})),v}},"flow/waitAll":{nS:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(z){var u,U;return"number"!==typeof(null===(u=z.configuration)||void 0===u||null===(U=u.inputFlows)||void 0===U?void 0:U.value[0])&&(z.configuration=z.configuration||{inputFlows:{value:[0]}},z.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{nS:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{nS:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{nS:["FlowGraphCancelDelayBlock"]},"variable/get":{nS:["FlowGraphGetVariableBlock"],validation(z){var u,U;return null!==(u=z.configuration)&&void 0!==u&&null!==(U=u.variable)&&void 0!==U&&U.value?{valid:!0}:(E.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(z,u)=>[u.getVariableName(z[0])]}}},"variable/set":{nS:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(z,u)=>[u.getVariableName(z[0])]}}},"variable/setMultiple":{nS:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(z,u)=>[z[0].map((z=>u.getVariableName(z)))]}},extraProcessor:(z,u,U,J,v)=>(v[0].dataInputs.forEach((z=>{z.name=J.getVariableName(+z.name)})),v)},"variable/interpolate":{nS:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(z,u)=>[u.getVariableName(z[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:z=>!0===z[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",LU:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",LU:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",LU:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",LU:"FlowGraphPlayAnimationBlock"},out:{name:"out",LU:"FlowGraphPlayAnimationBlock"},done:{name:"done",LU:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(z,u,U,J,v){var f,g,w;const P=v[0],R=null===(f=z.configuration)||void 0===f?void 0:f.variable.value[0];if("number"!==typeof R)throw E.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const S=J.arrays.staticVariables[R];"undefined"===typeof P.config.animationType.value&&(J.arrays.staticVariables,P.config.animationType.value=(0,XU.M)(S.type));const d=v[4];return d.config||(d.config={}),(g=d.config).variable||(g.variable={}),d.config.variable.value=J.getVariableName(R),(w=v[3]).config||(w.config={}),v}},"pointer/get":{nS:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",LU:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",LU:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(z,u,U,J,v)=>(v.forEach((z=>{"FlowGraphJsonPointerParserBlock"===z.className&&(z.config||(z.config={}),z.config.outputValue=!0)})),v)},"pointer/set":{nS:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",LU:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",LU:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(z,u,U,J,v)=>(v.forEach((z=>{"FlowGraphJsonPointerParserBlock"===z.className&&(z.config||(z.config={}),z.config.outputValue=!0)})),v)},"pointer/interpolate":{nS:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",LU:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",LU:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",LU:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",LU:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",LU:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",LU:"FlowGraphPlayAnimationBlock"},out:{name:"out",LU:"FlowGraphPlayAnimationBlock"},done:{name:"done",LU:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(z,u,U,J,v)=>(v.forEach((u=>{"FlowGraphJsonPointerParserBlock"===u.className?(u.config||(u.config={}),u.config.outputValue=!0):"FlowGraphInterpolationBlock"===u.className&&(u.config||(u.config={}),Object.keys(z.values||[]).forEach((U=>{var v;const f=null===(v=z.values)||void 0===v?void 0:v[U];if("value"===U&&f){const z=f.type;void 0!==z&&(u.config.animationType=J.arrays.types[z].flowGraphType)}})))})),v)},"animation/start":{nS:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",LU:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(z,u)=>[z[0]*u._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(z,u)=>[z[0]*u._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(z,u,U,J,v,f,g){const w=v[v.length-1];return w.config||(w.config={}),w.config.glTF=g,v}},"animation/stop":{nS:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",LU:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(z,u,U,J,v,f,g){const w=v[v.length-1];return w.config||(w.config={}),w.config.glTF=g,v}},"animation/stopAt":{nS:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",LU:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(z,u)=>[z[0]*u._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(z,u,U,J,v,f,g){const w=v[v.length-1];return w.config||(w.config={}),w.config.glTF=g,v}},"math/switch":{nS:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(z){if(z.configuration&&z.configuration.cases){const u=z.configuration.cases.value;if(!u.every((z=>"number"===typeof z&&/^-?\d+$/.test(z.toString()))))return E.d.Warn("Switch cases should be integers. Using empty array instead."),z.configuration.cases.value=[],{valid:!0};const U=new Set(u);z.configuration.cases.value=Array.from(U)}return{valid:!0}},extraProcessor(z,u,U,J,v){const f=v[0];return f.dataInputs.forEach((z=>{"default"!==z.name&&"case"!==z.name&&(z.name="in_"+z.name)})),f.config||(f.config={}),f.config.treatCasesAsIntegers=!0,v}},"debug/log":{nS:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function NU(z){let u=arguments.length>2?arguments[2]:void 0;return{nS:[z],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((z,u)=>(z[u]={name:u},z)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(z,U,J,v,f){var g;if(u){(g=f[0]).config||(g.config={}),f[0].config.preventIntegerFloatArithmetic=!0;let u=-1;Object.keys(z.values||{}).find((U=>{var J;return void 0!==(null===(J=z.values)||void 0===J?void 0:J[U].type)&&(u=z.values[U].type,!0)})),-1!==u&&(f[0].config.type=v.arrays.types[u].flowGraphType)}return f},validation:z=>u?DU(z):{valid:!0}}}function DU(z){if(z.values){const u=Object.keys(z.values).map((u=>z.values[u].type)).filter((z=>void 0!==z));if(!u.every((z=>z===u[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}pU["math/compose"]=pU["math/matCompose"],pU["math/decompose"]=pU["math/matDecompose"];var cU=U(12880);const WU={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Eu",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class jU{constructor(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=z,this._gltf=u,this._animationTargetFps=U,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const z of this._interactivityGraph.types)this._types.push(WU[z.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const z of this._interactivityGraph.declarations){const u=QU(z);if(!u)throw E.d.Error(["No mapping found for declaration",z]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:u,fullOperationName:z.extension?z.op+":"+z.extension:z.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const z of this._interactivityGraph.variables){const u=this._parseVariable(z);this._staticVariables.push(u)}}_parseVariable(z,u){const U=this._types[z.type];if(!U)throw E.d.Error(["No type found for variable",z]),new Error("Error parsing variables");if(z.value&&z.value.length!==U.length)throw E.d.Error(["Invalid value length for variable",z,U]),new Error("Error parsing variables");const J=z.value||[];if(!J.length)switch(U.flowGraphType){case"boolean":J.push(!1);break;case"FlowGraphInteger":J.push(0);break;case"number":J.push(NaN);break;case"Vector2":J.push(NaN,NaN);break;case"Eu":J.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":J.fill(NaN,0,4);break;case"Matrix":J.fill(NaN,0,16);break;case"Matrix3D":J.fill(NaN,0,9)}return"number"===U.elementType&&"string"===typeof J[0]&&(J[0]=parseFloat(J[0])),{type:U.flowGraphType,value:u?u(J,this):J}}_parseEvents(){if(this._interactivityGraph.events)for(const z of this._interactivityGraph.events){const u={eventId:z.id||"internalEvent_"+this._internalEventsCounter++};z.values&&(u.eventData=Object.keys(z.values).map((u=>{var U;const J=null===(U=z.values)||void 0===U?void 0:U[u];if(!J)throw E.d.Error(["No value found for event key",u]),new Error("Error parsing events");const v=this._types[J.type];if(!v)throw E.d.Error(["No type found for event value",J]),new Error("Error parsing events");const f="undefined"!==typeof J.value?this._parseVariable(J):void 0;return{id:u,type:v.flowGraphType,eventData:!0,value:f}}))),this._events.push(u)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const u of this._interactivityGraph.nodes){if("number"!==typeof u.declaration)throw E.d.Error(["No declaration found for node",u]),new Error("Error parsing nodes");const U=this._mappings[u.declaration];if(!U)throw E.d.Error(["No mapping found for node",u]),new Error("Error parsing nodes");if(U.flowGraphMapping.validation){const J=U.flowGraphMapping.validation(u,this._interactivityGraph,this._gltf);var z;if(!J.valid)throw new Error("Error validating interactivity node ".concat(null===(z=this._interactivityGraph.declarations)||void 0===z?void 0:z[u.declaration].op," - ").concat(J.error))}const J=[];for(const z of U.flowGraphMapping.nS){const v=this._getEmptyBlock(z,U.fullOperationName);this._parseNodeConfiguration(u,v,U.flowGraphMapping,z),J.push(v)}this._nodes.push({nS:J,fullOperationName:U.fullOperationName})}}_getEmptyBlock(z,u){return{uniqueId:(0,cU.d)(),className:z,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:u,metadata:{}}}_parseNodeConfiguration(z,u,U,J){const v=u.config;if(z.configuration){const u=Object.keys(z.configuration);for(const w of u){var f,g;const u=null===(f=z.configuration)||void 0===f?void 0:f[w];if(!u)throw E.d.Error(["No value found for node configuration",w]),new Error("Error parsing node configuration");const P=null===(g=U.configuration)||void 0===g?void 0:g[w];if(P&&P.LU?P.LU===J:0===U.nS.indexOf(J)){const z=(null===P||void 0===P?void 0:P.name)||w;u&&"undefined"!==typeof u.value||"undefined"===typeof(null===P||void 0===P?void 0:P.defaultValue)?u.value.length>=0?v[z]={value:1===u.value.length?u.value[0]:u.value}:E.d.Warn(["Invalid value for node configuration",u]):v[z]={value:P.defaultValue},P&&P.dataTransformer&&(v[z].value=P.dataTransformer([v[z].value],this)[0])}}}}_parseNodeConnections(z){for(let t=0;t<this._nodes.length;t++){var u;const V=null===(u=this._interactivityGraph.nodes)||void 0===u?void 0:u[t];if(!V)throw E.d.Error(["No node found for interactivity node",this._nodes[t]]),new Error("Error parsing node connections");const L=this._nodes[t],O=this._mappings[V.declaration];if(!O)throw E.d.Error(["No mapping found for node",V]),new Error("Error parsing node connections");const x=V.flows||{},Q=Object.keys(x).sort();for(const z of Q){var U,J,v,f;const u=x[z],R=null===(U=O.flowGraphMapping.outputs)||void 0===U||null===(J=U.flows)||void 0===J?void 0:J[z],S=(null===R||void 0===R?void 0:R.name)||z,d=this._createNewSocketConnection(S,!0);(R&&R.LU&&L.nS.find((z=>z.className===R.LU))||L.nS[0]).signalOutputs.push(d);const mz=u.node,Z=this._nodes[mz];if(!Z)throw E.d.Error(["No node found for input node id",mz]),new Error("Error parsing node connections");const A=xU(Z.fullOperationName);if(!A)throw E.d.Error(["No mapping found for input node",Z]),new Error("Error parsing node connections");let C=null===(v=A.inputs)||void 0===v||null===(f=v.flows)||void 0===f?void 0:f[u.socket||"in"],r=!1;if(!C)for(const z in null===(g=A.inputs)||void 0===g?void 0:g.flows){var g,w,P;if(z.startsWith("[")&&z.endsWith("]"))r=!0,C=null===(w=A.inputs)||void 0===w||null===(P=w.flows)||void 0===P?void 0:P[z]}const M=C?r?C.name.replace("$1",u.socket||""):C.name:u.socket||"in",T=C&&C.LU&&Z.nS.find((z=>z.className===C.LU))||Z.nS[0];let X=T.signalInputs.find((z=>z.name===M));X||(X=this._createNewSocketConnection(M),T.signalInputs.push(X)),X.connectedPointIds.push(d.uniqueId),d.connectedPointIds.push(X.uniqueId)}const K=V.values||{},Y=Object.keys(K);for(const u of Y){var R,S;const U=K[u];let J=null===(R=O.flowGraphMapping.inputs)||void 0===R||null===(S=R.values)||void 0===S?void 0:S[u],v=!1;if(!J)for(const z in null===(d=O.flowGraphMapping.inputs)||void 0===d?void 0:d.values){var d,mz,Z;if(z.startsWith("[")&&z.endsWith("]"))v=!0,J=null===(mz=O.flowGraphMapping.inputs)||void 0===mz||null===(Z=mz.values)||void 0===Z?void 0:Z[z]}const f=J?v?J.name.replace("$1",u):J.name:u,g=this._createNewSocketConnection(f);if((J&&J.LU&&L.nS.find((z=>z.className===J.LU))||L.nS[0]).dataInputs.push(g),void 0!==U.value){const u=this._parseVariable(U,J&&J.dataTransformer);z._connectionValues[g.uniqueId]=u}else{if("undefined"===typeof U.node)throw E.d.Error(["Invalid value for value connection",U]),new Error("Error parsing node connections");{var A,C,r;const z=U.node,u=U.socket||"value",J=this._nodes[z];if(!J)throw E.d.Error(["No node found for output socket reference",U]),new Error("Error parsing node connections");const v=xU(J.fullOperationName);if(!v)throw E.d.Error(["No mapping found for output socket reference",U]),new Error("Error parsing node connections");let f=null===(A=v.outputs)||void 0===A||null===(C=A.values)||void 0===C?void 0:C[u],w=!1;if(!f)for(const U in null===(M=v.outputs)||void 0===M?void 0:M.values){var M,T,X;if(U.startsWith("[")&&U.endsWith("]"))w=!0,f=null===(T=v.outputs)||void 0===T||null===(X=T.values)||void 0===X?void 0:X[U]}const P=f?w?f.name.replace("$1",u):null===(r=f)||void 0===r?void 0:r.name:u,R=f&&f.LU&&J.nS.find((z=>z.className===f.LU))||J.nS[0];let S=R.dataOutputs.find((z=>z.name===P));S||(S=this._createNewSocketConnection(P,!0),R.dataOutputs.push(S)),g.connectedPointIds.push(S.uniqueId),S.connectedPointIds.push(g.uniqueId)}}}if(O.flowGraphMapping.interBlockConnectors)for(const z of O.flowGraphMapping.interBlockConnectors){const u=z.input,U=z.output,J=z.isVariable;this._connectFlowGraphNodes(u,U,L.nS[z.inputBlockIndex],L.nS[z.outputBlockIndex],J)}if(O.flowGraphMapping.extraProcessor){var h;const u=null===(h=this._interactivityGraph.declarations)||void 0===h?void 0:h[V.declaration];if(!u)throw E.d.Error(["No declaration found for extra processor",V]),new Error("Error parsing node connections");L.nS=O.flowGraphMapping.extraProcessor(V,u,O.flowGraphMapping,this,L.nS,z,this._gltf)}}}_createNewSocketConnection(z,u){return{uniqueId:(0,cU.d)(),name:z,_connectionType:u?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(z,u,U,J,v){const f=v?U.dataInputs:U.signalInputs,g=v?J.dataOutputs:J.signalOutputs,w=f.find((u=>u.name===z))||this._createNewSocketConnection(z),P=g.find((z=>z.name===u))||this._createNewSocketConnection(u,!0);f.find((u=>u.name===z))||f.push(w),g.find((z=>z.name===u))||g.push(P),w.connectedPointIds.push(P.uniqueId),P.connectedPointIds.push(w.uniqueId)}getVariableName(z){return"staticVariable_"+z}serializeToFlowGraph(){const z={uniqueId:(0,cU.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(z);for(let u=0;u<this._staticVariables.length;u++){const U=this._staticVariables[u];z._userVariables[this.getVariableName(u)]=U}return{rightHanded:!0,allBlocks:this._nodes.reduce(((z,u)=>z.concat(u.nS)),[]),executionContexts:[z]}}}const IU="KHR_interactivity";class FU{constructor(z){this._loader=z,this.name=IU,this.enabled=this._loader.isExtensionUsed(IU),this._pathConverter=(0,F.k)(this._loader.Kf),z._skipStartAnimationStep=!0;const u=z.babylonScene;u&&function(z){(0,F.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!z.activeCamera)return new v.Quaternion(NaN,NaN,NaN,NaN);const u=v.Quaternion.FromRotationMatrix(z.activeCamera.getWorldMatrix()).normalize();return z.useRightHandedSystem||(u.w*=-1,u.x*=-1),u},type:"Quaternion",getTarget:()=>z.activeCamera}),(0,F.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!z.activeCamera)return new v.Eu(NaN,NaN,NaN);const u=z.activeCamera.getWorldMatrix().getTranslation();return z.useRightHandedSystem||(u.x*=-1),u},type:"Eu",getTarget:()=>z.activeCamera}),(0,F.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:z=>{var u,U;return null!==(u=null===(U=z._babylonAnimationGroup)||void 0===U?void 0:U.isPlaying)&&void 0!==u&&u},type:"boolean",getTarget:z=>z._babylonAnimationGroup}),(0,F.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:z=>{var u,U;return(null!==(u=null===(U=z._babylonAnimationGroup)||void 0===U?void 0:U.from)&&void 0!==u?u:0)/60},type:"number",getTarget:z=>z._babylonAnimationGroup}),(0,F.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:z=>{var u,U;return(null!==(u=null===(U=z._babylonAnimationGroup)||void 0===U?void 0:U.to)&&void 0!==u?u:0)/60},type:"number",getTarget:z=>z._babylonAnimationGroup}),(0,F.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:z=>{var u,U;return(null!==(u=null===(U=z._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())&&void 0!==u?u:0)/60},type:"number",getTarget:z=>z._babylonAnimationGroup}),(0,F.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:z=>{var u,U;return(null!==(u=null===(U=z._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())&&void 0!==u?u:0)/60},type:"number",getTarget:z=>z._babylonAnimationGroup})}(u)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var z;if(!this._loader.babylonScene||!this._pathConverter)return;const u=this._loader.babylonScene,U=null===(z=this._loader.Kf.extensions)||void 0===z?void 0:z.KHR_interactivity;if(!U)return;const J=new EU.c({ru:u});J.dispatchEventsSynchronously=!1;const v=U.graphs.map((z=>new jU(z,this._loader.Kf,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(v.map((async z=>await VU(z,{coordinator:J,pathConverter:this._pathConverter})))),J.start()}}var bU,kU;bU="FlowGraphGLTFDataProvider",kU=async()=>(await Promise.resolve().then(U.bind(U,14254))).FlowGraphGLTFDataProvider,CU["".concat(IU,"/").concat(bU)]=kU,I(IU),j(IU,!0,(z=>new FU(z)));const BU="KHR_node_visibility";(0,F.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:z=>{const u=z._babylonTransformNode;return!u||void 0===u.isVisible||u.isVisible},set:(z,u)=>{var U,J;null===(U=u._primitiveBabylonMeshes)||void 0===U||U.forEach((z=>{z.inheritVisibility=!0})),u._babylonTransformNode&&(u._babylonTransformNode.isVisible=z),null===(J=u._primitiveBabylonMeshes)||void 0===J||J.forEach((u=>{u.isVisible=z}))},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class yU{constructor(z){this.name=BU,this._loader=z,this.enabled=z.isExtensionUsed(BU)}async onReady(){var z;null===(z=this._loader.Kf.nodes)||void 0===z||z.forEach((z=>{var u,U,J,v;(null===(u=z._primitiveBabylonMeshes)||void 0===u||u.forEach((z=>{z.inheritVisibility=!0})),null!==(U=z.extensions)&&void 0!==U&&U.KHR_node_visibility)&&(!1===(null===(J=z.extensions)||void 0===J?void 0:J.KHR_node_visibility.visible)&&(z._babylonTransformNode&&(z._babylonTransformNode.isVisible=!1),null===(v=z._primitiveBabylonMeshes)||void 0===v||v.forEach((z=>{z.isVisible=!1}))))}))}dispose(){this._loader=null}}I(BU),j(BU,!0,(z=>new yU(z)));const HU="KHR_node_selectability";KU("event/onSelect",HU,{nS:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",LU:"FlowGraphGetVariableBlock",dataTransformer:z=>["pickedMesh_"+z[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",LU:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(z,u,U,J,v,f,g){var w,P,R,S,d,mz;const Z=v[v.length-1];Z.config=Z.config||{},Z.config.glTF=g;const A=null===(w=z.configuration)||void 0===w||null===(P=w.nodeIndex)||void 0===P?void 0:P.value[0];if(void 0===A||"number"!==typeof A)throw new Error("nodeIndex not found in configuration");const E="pickedMesh_"+A;return v[1].config.variable=E,f._userVariables[E]={className:"Mesh",id:null===g||void 0===g||null===(R=g.nodes)||void 0===R||null===(S=R[A]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===g||void 0===g||null===(d=g.nodes)||void 0===d||null===(mz=d[A]._babylonTransformNode)||void 0===mz?void 0:mz.uniqueId},v}}),(0,F.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:z=>{const u=z._babylonTransformNode;return!u||void 0===u.XR||u.XR},set:(z,u)=>{var U;null===(U=u._primitiveBabylonMeshes)||void 0===U||U.forEach((u=>{u.XR=z}))},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"XR"],type:"boolean"});class GU{constructor(z){this.name=HU,this._loader=z,this.enabled=z.isExtensionUsed(HU)}async onReady(){var z;null===(z=this._loader.Kf.nodes)||void 0===z||z.forEach((z=>{var u,U,J;null!==(u=z.extensions)&&void 0!==u&&u.KHR_node_selectability&&!1===(null===(U=z.extensions)||void 0===U?void 0:U.KHR_node_selectability.selectable)&&(null===(J=z._babylonTransformNode)||void 0===J||J.getChildMeshes().forEach((z=>{z.XR=!1})))}))}dispose(){this._loader=null}}I(HU),j(HU,!0,(z=>new GU(z)));const aU="KHR_node_hoverability",iU="targetMeshPointerOver_";KU("event/onHoverIn",aU,{nS:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",LU:"FlowGraphGetVariableBlock",dataTransformer:z=>[iU+z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",LU:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(z,u,U,J,v,f,g){var w,P,R,S,d,mz;const Z=v[v.length-1];Z.config=Z.config||{},Z.config.glTF=g;const A=null===(w=z.configuration)||void 0===w||null===(P=w.nodeIndex)||void 0===P?void 0:P.value[0];if(void 0===A||"number"!==typeof A)throw new Error("nodeIndex not found in configuration");const E=iU+A;return v[1].config.variable=E,f._userVariables[E]={className:"Mesh",id:null===g||void 0===g||null===(R=g.nodes)||void 0===R||null===(S=R[A]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===g||void 0===g||null===(d=g.nodes)||void 0===d||null===(mz=d[A]._babylonTransformNode)||void 0===mz?void 0:mz.uniqueId},v}});const nU="targetMeshPointerOut_";KU("event/onHoverOut",aU,{nS:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",LU:"FlowGraphGetVariableBlock",dataTransformer:z=>[nU+z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",LU:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(z,u,U,J,v,f,g){var w,P,R,S,d,mz;const Z=v[v.length-1];Z.config=Z.config||{},Z.config.glTF=g;const A=null===(w=z.configuration)||void 0===w||null===(P=w.nodeIndex)||void 0===P?void 0:P.value[0];if(void 0===A||"number"!==typeof A)throw new Error("nodeIndex not found in configuration");const E=nU+A;return v[1].config.variable=E,f._userVariables[E]={className:"Mesh",id:null===g||void 0===g||null===(R=g.nodes)||void 0===R||null===(S=R[A]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===g||void 0===g||null===(d=g.nodes)||void 0===d||null===(mz=d[A]._babylonTransformNode)||void 0===mz?void 0:mz.uniqueId},v}}),(0,F.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:z=>{const u=z._babylonTransformNode;return!u||void 0===u.pointerOverDisableMeshTesting||u.pointerOverDisableMeshTesting},set:(z,u)=>{var U;null===(U=u._primitiveBabylonMeshes)||void 0===U||U.forEach((u=>{u.pointerOverDisableMeshTesting=!z}))},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class qU{constructor(z){this.name=aU,this._loader=z,this.enabled=z.isExtensionUsed(aU)}async onReady(){var z;null===(z=this._loader.Kf.nodes)||void 0===z||z.forEach((z=>{var u,U,J;null!==(u=z.extensions)&&void 0!==u&&u.KHR_node_hoverability&&!1===(null===(U=z.extensions)||void 0===U?void 0:U.KHR_node_hoverability.hoverable)&&(null===(J=z._babylonTransformNode)||void 0===J||J.getChildMeshes().forEach((z=>{z.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}I(aU),j(aU,!0,(z=>new qU(z)));const oU="ExtrasAsMetadata";class sU{_assignExtras(z,u){if(u.extras&&Object.keys(u.extras).length>0){const U=z.metadata=z.metadata||{};(U.Kf=U.Kf||{}).extras=u.extras}}constructor(z){this.name=oU,this.enabled=!0,this._loader=z}dispose(){this._loader=null}loadNodeAsync(z,u,U){return this._loader.loadNodeAsync(z,u,(z=>{this._assignExtras(z,u),U(z)}))}loadCameraAsync(z,u,U){return this._loader.loadCameraAsync(z,u,(z=>{this._assignExtras(z,u),U(z)}))}createMaterial(z,u,U){const J=this._loader.createMaterial(z,u,U);return this._assignExtras(J,u),J}}I(oU),j(oU,!1,(z=>new sU(z)));U(14254)},14126:(z,u,U)=>{"use strict";U.d(u,{d:()=>D,f:()=>x,j:()=>O,n:()=>Q});var J=U(12756),v=U(12748),f=U(13754),g=U(21),w=U(13335),P=U(13314),R=U(13320),S=U(12760),d=U(12797),mz=U(13333),Z=U(13428),A=U(13338),E=U(12960);class C{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.mA=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.iZ=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(z){this._environmentTexture=z}getNodes(){let z=[];z=z.concat(this.meshes),z=z.concat(this.lights),z=z.concat(this.cameras),z=z.concat(this.transformNodes);for(const u of this.skeletons)z=z.concat(u.bones);return z}}class r extends C{}class M{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const z=this.rootNodes;for(const J of z)J.dispose();z.length=0;const u=this.skeletons;for(const J of u)J.dispose();u.length=0;const U=this.animationGroups;for(const J of U)J.dispose();U.length=0}}class T extends C{constructor(z){super(),this._wasAddedToScene=!1,(z=z||d.e.LastCreatedScene)&&(this.ru=z,this.proceduralTextures=[],z.Xf.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=z.getEngine().onContextRestoredObservable.add((()=>{for(const z of this.geometries)z._rebuild();for(const z of this.meshes)z._rebuild();for(const z of this.mA)z.rebuild();for(const z of this.textures)z._rebuild()})))}_topologicalSort(z){const u=new Map;for(const g of z)u.set(g.uniqueId,g);const U={dependsOn:new Map,dependedBy:new Map};for(const g of z){const z=g.uniqueId;U.dependsOn.set(z,new Set),U.dependedBy.set(z,new Set)}for(const g of z){const z=g.uniqueId,J=U.dependsOn.get(z);if(g instanceof mz.c){const v=g.sourceMesh;u.has(v.uniqueId)&&(J.add(v.uniqueId),U.dependedBy.get(v.uniqueId).add(z))}const v=U.dependedBy.get(z);for(const f of g.getDescendants()){const J=f.uniqueId;if(u.has(J)){v.add(J);U.dependsOn.get(J).add(z)}}}const J=[],v=[];for(const g of z){const z=g.uniqueId;0===U.dependsOn.get(z).size&&(v.push(g),u.delete(z))}const f=v;for(;f.length>0;){const z=f.shift();J.push(z);const v=U.dependedBy.get(z.uniqueId);for(const J of Array.from(v.values())){const v=U.dependsOn.get(J);v.delete(z.uniqueId),0===v.size&&u.get(J)&&(f.push(u.get(J)),u.delete(J))}}return u.size>0&&(S.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),u.forEach((z=>{S.d.Error(z.name)}))),J}_addNodeAndDescendantsToList(z,u,U,J){if(U&&(!J||J(U))&&!u.has(U.uniqueId)){z.push(U),u.add(U.uniqueId);for(const v of U.getDescendants(!0))this._addNodeAndDescendantsToList(z,u,v,J)}}_isNodeInContainer(z){return z instanceof R.d&&-1!==this.meshes.indexOf(z)||(z instanceof P.c&&-1!==this.transformNodes.indexOf(z)||(z instanceof Z.c&&-1!==this.lights.indexOf(z)||z instanceof A.b&&-1!==this.cameras.indexOf(z)))}_isValidHierarchy(){for(const z of this.meshes)if(z.parent&&!this._isNodeInContainer(z.parent))return S.d.Warn("Node ".concat(z.name," has a parent that is not in the container.")),!1;for(const z of this.transformNodes)if(z.parent&&!this._isNodeInContainer(z.parent))return S.d.Warn("Node ".concat(z.name," has a parent that is not in the container.")),!1;for(const z of this.lights)if(z.parent&&!this._isNodeInContainer(z.parent))return S.d.Warn("Node ".concat(z.name," has a parent that is not in the container.")),!1;for(const z of this.cameras)if(z.parent&&!this._isNodeInContainer(z.parent))return S.d.Warn("Node ".concat(z.name," has a parent that is not in the container.")),!1;return!0}instantiateModelsToScene(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||v.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const J={},f={},P=new M,R=[],S=[],d=(0,g.e)({doNotInstantiate:!0},U),mz=[],Z=new Set;for(const v of this.transformNodes)null===v.parent&&this._addNodeAndDescendantsToList(mz,Z,v,d.predicate);for(const v of this.meshes)null===v.parent&&this._addNodeAndDescendantsToList(mz,Z,v,d.predicate);const A=this._topologicalSort(mz),E=(U,v)=>{if(((u,U)=>{if(J[u.uniqueId]=U.uniqueId,f[U.uniqueId]=U,z&&(U.name=z(u.name)),U instanceof w.e){const z=U;if(z.morphTargetManager){const U=u.morphTargetManager;z.morphTargetManager=U.clone();for(let u=0;u<U.numTargets;u++){const v=U.getTarget(u),g=z.morphTargetManager.getTarget(u);J[v.uniqueId]=g.uniqueId,f[g.uniqueId]=g}}}})(U,v),U.parent){const z=J[U.parent.uniqueId],u=f[z];v.parent=u||U.parent}if(v.position&&U.position&&v.position.v(U.position),v.rotationQuaternion&&U.rotationQuaternion&&v.rotationQuaternion.v(U.rotationQuaternion),v.rotation&&U.rotation&&v.rotation.v(U.rotation),v.Ug&&U.Ug&&v.Ug.v(U.Ug),v.material){const g=v;if(g.material)if(u){const u=U.material;if(-1===S.indexOf(u)){let U=u.clone(z?z(u.name):"Clone of "+u.name);if(S.push(u),J[u.uniqueId]=U.uniqueId,f[U.uniqueId]=U,"MultiMaterial"===u.getClassName()){const v=u;for(const u of v.Pg)u&&(U=u.clone(z?z(u.name):"Clone of "+u.name),S.push(u),J[u.uniqueId]=U.uniqueId,f[U.uniqueId]=U);v.Pg=v.Pg.map((z=>z&&f[J[z.uniqueId]]))}}"InstancedMesh"!==g.getClassName()&&(g.material=f[J[u.uniqueId]])}else"MultiMaterial"===g.material.getClassName()?-1===this.ru.multiMaterials.indexOf(g.material)&&this.ru.addMultiMaterial(g.material):-1===this.ru.materials.indexOf(g.material)&&this.ru.addMaterial(g.material)}null===v.parent&&P.rootNodes.push(v)};for(const v of A)if("InstancedMesh"===v.getClassName()){const z=v,u=z.sourceMesh,U=J[u.uniqueId];E(z,("number"===typeof U?f[U]:u).createInstance(z.name))}else{let z=!0;"Ym"===v.getClassName()||"Node"===v.getClassName()||v.skeleton||!v.getTotalVertices||0===v.getTotalVertices()?z=!1:d.doNotInstantiate&&(z="function"===typeof d.doNotInstantiate?!d.doNotInstantiate(v):!d.doNotInstantiate);const u=z?v.createInstance("instance of ".concat(v.name)):v.clone("Clone of ".concat(v.name),null,!0);if(!u)throw new Error("Could not clone or instantiate node on Asset Container ".concat(v.name));E(v,u)}for(const v of this.skeletons){if(d.predicate&&!d.predicate(v))continue;const u=v.clone(z?z(v.name):"Clone of "+v.name);for(const z of this.meshes)if(z.skeleton===v&&!z.isAnInstance){const U=f[J[z.uniqueId]];if(!U||U.isAnInstance)continue;if(U.skeleton=u,-1!==R.indexOf(u))continue;R.push(u);for(const z of u.bones)z._linkedTransformNode&&(z._linkedTransformNode=f[J[z._linkedTransformNode.uniqueId]])}P.skeletons.push(u)}for(const v of this.animationGroups){if(d.predicate&&!d.predicate(v))continue;const u=v.clone(z?z(v.name):"Clone of "+v.name,(z=>f[J[z.uniqueId]]||z));P.animationGroups.push(u)}return P}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||v.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.ru.environmentTexture=this.environmentTexture);for(const z of this.ru._serializableComponents)z.addFromContainer(this);this.ru.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const u=[];for(const U of this.cameras)z&&!z(U)||(this.ru.addCamera(U),u.push(U));for(const U of this.lights)z&&!z(U)||(this.ru.addLight(U),u.push(U));for(const U of this.meshes)z&&!z(U)||(this.ru.bS(U),u.push(U));for(const U of this.skeletons)z&&!z(U)||this.ru.addSkeleton(U);for(const U of this.animations)z&&!z(U)||this.ru.addAnimation(U);for(const U of this.animationGroups)z&&!z(U)||this.ru.addAnimationGroup(U);for(const U of this.multiMaterials)z&&!z(U)||this.ru.addMultiMaterial(U);for(const U of this.materials)z&&!z(U)||this.ru.addMaterial(U);for(const U of this.morphTargetManagers)z&&!z(U)||this.ru.addMorphTargetManager(U);for(const U of this.geometries)z&&!z(U)||this.ru.addGeometry(U);for(const U of this.transformNodes)z&&!z(U)||(this.ru.addTransformNode(U),u.push(U));for(const U of this.actionManagers)z&&!z(U)||this.ru.addActionManager(U);for(const U of this.textures)z&&!z(U)||this.ru.addTexture(U);for(const U of this.reflectionProbes)z&&!z(U)||this.ru.addReflectionProbe(U);for(const U of u)U.parent&&-1===this.ru.getNodes().indexOf(U.parent)&&(U.setParent?U.setParent(null):U.parent=null)}removeAllFromScene(){this._isValidHierarchy()||v.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.ru.environmentTexture&&(this.ru.environmentTexture=null);for(const z of this.ru._serializableComponents)z.removeFromContainer(this)}removeFromScene(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const u of this.cameras)z&&!z(u)||this.ru.removeCamera(u);for(const u of this.lights)z&&!z(u)||this.ru.removeLight(u);for(const u of this.meshes)z&&!z(u)||this.ru.FS(u,!0);for(const u of this.skeletons)z&&!z(u)||this.ru.removeSkeleton(u);for(const u of this.animations)z&&!z(u)||this.ru.removeAnimation(u);for(const u of this.animationGroups)z&&!z(u)||this.ru.removeAnimationGroup(u);for(const u of this.multiMaterials)z&&!z(u)||this.ru.removeMultiMaterial(u);for(const u of this.materials)z&&!z(u)||this.ru.removeMaterial(u);for(const u of this.morphTargetManagers)z&&!z(u)||this.ru.removeMorphTargetManager(u);for(const u of this.geometries)z&&!z(u)||this.ru.removeGeometry(u);for(const u of this.transformNodes)z&&!z(u)||this.ru.removeTransformNode(u);for(const u of this.actionManagers)z&&!z(u)||this.ru.removeActionManager(u);for(const u of this.textures)z&&!z(u)||this.ru.removeTexture(u);for(const u of this.reflectionProbes)z&&!z(u)||this.ru.removeReflectionProbe(u)}dispose(){const z=this.cameras.slice(0);for(const Z of z)Z.dispose();this.cameras.length=0;const u=this.lights.slice(0);for(const Z of u)Z.dispose();this.lights.length=0;const U=this.meshes.slice(0);for(const Z of U)Z.dispose();this.meshes.length=0;const J=this.skeletons.slice(0);for(const Z of J)Z.dispose();this.skeletons.length=0;const v=this.animationGroups.slice(0);for(const Z of v)Z.dispose();this.animationGroups.length=0;const f=this.multiMaterials.slice(0);for(const Z of f)Z.dispose();this.multiMaterials.length=0;const g=this.materials.slice(0);for(const Z of g)Z.dispose();this.materials.length=0;const w=this.geometries.slice(0);for(const Z of w)Z.dispose();this.geometries.length=0;const P=this.transformNodes.slice(0);for(const Z of P)Z.dispose();this.transformNodes.length=0;const R=this.actionManagers.slice(0);for(const Z of R)Z.dispose();this.actionManagers.length=0;const S=this.textures.slice(0);for(const Z of S)Z.dispose();this.textures.length=0;const d=this.reflectionProbes.slice(0);for(const Z of d)Z.dispose();this.reflectionProbes.length=0;const mz=this.morphTargetManagers.slice(0);for(const Z of mz)Z.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const Z of this.ru._serializableComponents)Z.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.ru.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(z,u,U){if(z&&u)for(const J of z){let z=!0;if(U)for(const u of U)if(J===u){z=!1;break}z&&(u.push(J),J._parentContainer=this)}}moveAllFromScene(z){this._wasAddedToScene=!1,void 0===z&&(z=new r);for(const u in this)Object.prototype.hasOwnProperty.call(this,u)&&(this[u]=this[u]||("_environmentTexture"===u?null:[]),this._moveAssets(this.ru[u],this[u],z[u]));this.environmentTexture=this.ru.environmentTexture,this.removeAllFromScene()}createRootMesh(){const z=new w.e("assetContainerRootMesh",this.ru);for(const u of this.meshes)u.parent||z.addChild(u);return this.meshes.unshift(z),z}mergeAnimationsTo(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.e.LastCreatedScene,u=arguments.length>1?arguments[1]:void 0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!z)return S.d.Error("No scene available to merge animations to"),[];const J=U||(u=>{let U=null;const J=u.animations.length?u.animations[0].targetProperty:"",v=u.name.split(".").join("").split("_primitive")[0];switch(J){case"position":case"rotationQuaternion":U=z.getTransformNodeByName(u.name)||z.getTransformNodeByName(v);break;case"influence":U=z.getMorphTargetByName(u.name)||z.getMorphTargetByName(v);break;default:U=z.getNodeByName(u.name)||z.getNodeByName(v)}return U}),v=this.getNodes();for(const w of v){const z=J(w);if(null!==z){for(const u of w.animations){const U=z.animations.filter((z=>z.targetProperty===u.targetProperty));for(const u of U){const U=z.animations.indexOf(u,0);U>-1&&z.animations.splice(U,1)}}z.animations=z.animations.concat(w.animations)}}const f=[],g=this.animationGroups.slice();for(const w of g){f.push(w.clone(w.name,J));for(const z of w.animatables)z.stop()}for(const w of u){const u=J(w.target);u&&(z.beginAnimation(u,w.fromFrame,w.toFrame,w.loopAnimation,w.speedRatio,w.onAnimationEnd?w.onAnimationEnd:void 0,void 0,!0,void 0,w.onAnimationLoop?w.onAnimationLoop:void 0),z.stopAnimation(w.target))}return f}populateRootNodes(){this.rootNodes.length=0;for(const z of this.meshes)z.parent||-1!==this.rootNodes.indexOf(z)||this.rootNodes.push(z);for(const z of this.transformNodes)z.parent||-1!==this.rootNodes.indexOf(z)||this.rootNodes.push(z);for(const z of this.lights)z.parent||-1!==this.rootNodes.indexOf(z)||this.rootNodes.push(z);for(const z of this.cameras)z.parent||-1!==this.rootNodes.indexOf(z)||this.rootNodes.push(z)}addAllAssetsToContainer(z){if(!z)return;const u=[],U=new Set;for(u.push(z);u.length>0;){const z=u.pop();if(z instanceof w.e?(z.nf&&-1===this.geometries.indexOf(z.nf)&&this.geometries.push(z.nf),this.meshes.push(z)):z instanceof mz.c?this.meshes.push(z):z instanceof P.c?this.transformNodes.push(z):z instanceof Z.c?this.lights.push(z):z instanceof A.b&&this.cameras.push(z),z instanceof R.d){if(z.material&&-1===this.materials.indexOf(z.material)){this.materials.push(z.material);for(const u of z.material.getActiveTextures())-1===this.textures.indexOf(u)&&this.textures.push(u)}z.skeleton&&-1===this.skeletons.indexOf(z.skeleton)&&this.skeletons.push(z.skeleton),z.morphTargetManager&&-1===this.morphTargetManagers.indexOf(z.morphTargetManager)&&this.morphTargetManagers.push(z.morphTargetManager)}for(const J of z.getChildren())U.has(J)||u.push(J);U.add(z)}this.populateRootNodes()}_getByTags(z,u,U){if(void 0===u)return z;const J=[];for(const v in z){const f=z[v];E.b&&E.b.MatchesQuery(f,u)&&(!U||U(f))&&J.push(f)}return J}getMeshesByTags(z,u){return this._getByTags(this.meshes,z,u)}getCamerasByTags(z,u){return this._getByTags(this.cameras,z,u)}getLightsByTags(z,u){return this._getByTags(this.lights,z,u)}getMaterialsByTags(z,u){return this._getByTags(this.materials,z,u).concat(this._getByTags(this.multiMaterials,z,u))}getTransformNodesByTags(z,u){return this._getByTags(this.transformNodes,z,u)}}var X=U(12809);class h{constructor(z){this.byteOffset=0,this.buffer=z}async loadAsync(z){const u=await this.buffer.readAsync(this.byteOffset,z);this._dataView=new DataView(u.buffer,u.byteOffset,u.byteLength),this._dataByteOffset=0}readUint32(){const z=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,z}readUint8Array(z){const u=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,z);return this._dataByteOffset+=z,this.byteOffset+=z,u}readString(z){return(0,X.g)(this.readUint8Array(z))}skipBytes(z){this._dataByteOffset+=z,this.byteOffset+=z}}var t=U(14129);const V="Z2xURg",L={name:"Kf",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:z=>-1!==z.indexOf("asset")&&-1!==z.indexOf("version")||z.startsWith("data:base64,"+V)||z.startsWith("data:;base64,"+V)||z.startsWith("data:application/octet-stream;base64,"+V)||z.startsWith("data:model/gltf-binary;base64,"+V)};var O,x,Q,K=U(12800),Y=U(12806);function p(z,u,U){try{return Promise.resolve(new Uint8Array(z,u,U))}catch(J){return Promise.reject(J)}}!function(z){z[z.AUTO=0]="AUTO",z[z.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(O||(O={})),function(z){z[z.NONE=0]="NONE",z[z.FIRST=1]="FIRST",z[z.ALL=2]="ALL"}(x||(x={})),function(z){z[z.LOADING=0]="LOADING",z[z.READY=1]="READY",z[z.COMPLETE=2]="COMPLETE"}(Q||(Q={}));class N{constructor(){this.coordinateSystemMode=O.AUTO,this.animationStartMode=x.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=z=>Promise.resolve(z),this.extensionOptions={}}v(z){var u,U,J,v,f,g,w,P,R,S,d,mz,Z,A,E,C,r,M,T,X,h;z&&(this.onParsed=z.onParsed,this.coordinateSystemMode=null!==(u=z.coordinateSystemMode)&&void 0!==u?u:this.coordinateSystemMode,this.animationStartMode=null!==(U=z.animationStartMode)&&void 0!==U?U:this.animationStartMode,this.loadNodeAnimations=null!==(J=z.loadNodeAnimations)&&void 0!==J?J:this.loadNodeAnimations,this.loadSkins=null!==(v=z.loadSkins)&&void 0!==v?v:this.loadSkins,this.loadMorphTargets=null!==(f=z.loadMorphTargets)&&void 0!==f?f:this.loadMorphTargets,this.compileMaterials=null!==(g=z.compileMaterials)&&void 0!==g?g:this.compileMaterials,this.useClipPlane=null!==(w=z.useClipPlane)&&void 0!==w?w:this.useClipPlane,this.compileShadowGenerators=null!==(P=z.compileShadowGenerators)&&void 0!==P?P:this.compileShadowGenerators,this.transparencyAsCoverage=null!==(R=z.transparencyAsCoverage)&&void 0!==R?R:this.transparencyAsCoverage,this.useRangeRequests=null!==(S=z.useRangeRequests)&&void 0!==S?S:this.useRangeRequests,this.createInstances=null!==(d=z.createInstances)&&void 0!==d?d:this.createInstances,this.alwaysComputeBoundingBox=null!==(mz=z.alwaysComputeBoundingBox)&&void 0!==mz?mz:this.alwaysComputeBoundingBox,this.loadAllMaterials=null!==(Z=z.loadAllMaterials)&&void 0!==Z?Z:this.loadAllMaterials,this.loadOnlyMaterials=null!==(A=z.loadOnlyMaterials)&&void 0!==A?A:this.loadOnlyMaterials,this.skipMaterials=null!==(E=z.skipMaterials)&&void 0!==E?E:this.skipMaterials,this.useSRGBBuffers=null!==(C=z.useSRGBBuffers)&&void 0!==C?C:this.useSRGBBuffers,this.targetFps=null!==(r=z.targetFps)&&void 0!==r?r:this.targetFps,this.alwaysComputeSkeletonRootNode=null!==(M=z.alwaysComputeSkeletonRootNode)&&void 0!==M?M:this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=null!==(T=z.useGltfTextureNames)&&void 0!==T?T:this.useGltfTextureNames,this.preprocessUrlAsync=null!==(X=z.preprocessUrlAsync)&&void 0!==X?X:this.preprocessUrlAsync,this.customRootNode=z.customRootNode,this.onMeshLoaded=z.onMeshLoaded,this.onSkinLoaded=z.onSkinLoaded,this.onTextureLoaded=z.onTextureLoaded,this.onMaterialLoaded=z.onMaterialLoaded,this.onCameraLoaded=z.onCameraLoaded,this.extensionOptions=null!==(h=z.extensionOptions)&&void 0!==h?h:this.extensionOptions)}}class D extends N{constructor(z){super(),this.onParsedObservable=new J.e,this.onMeshLoadedObservable=new J.e,this.onSkinLoadedObservable=new J.e,this.onTextureLoadedObservable=new J.e,this.onMaterialLoadedObservable=new J.e,this.onCameraLoadedObservable=new J.e,this.onCompleteObservable=new J.e,this.onErrorObservable=new J.e,this.Xf=new J.e,this.onExtensionLoadedObservable=new J.e,this.validate=!1,this.onValidatedObservable=new J.e,this._loader=null,this._state=null,this._requests=new Array,this.name=L.name,this.extensions=L.extensions,this.onLoaderStateChangedObservable=new J.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.v(z)}set onParsed(z){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),z&&(this._onParsedObserver=this.onParsedObservable.add(z))}set onMeshLoaded(z){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),z&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(z))}set onSkinLoaded(z){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),z&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((u=>z(u.node,u.skinnedNode))))}set onTextureLoaded(z){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),z&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(z))}set onMaterialLoaded(z){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),z&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(z))}set onCameraLoaded(z){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),z&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(z))}set onComplete(z){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(z)}set onError(z){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(z)}set onDispose(z){this._onDisposeObserver&&this.Xf.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xf.add(z)}set onExtensionLoaded(z){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(z)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(z){this._loggingEnabled!==z&&(this._loggingEnabled=z,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(z){this._capturePerformanceCounters!==z&&(this._capturePerformanceCounters=z,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(z){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(z)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const z of this._requests)z.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=z=>Promise.resolve(z),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Xf.notifyObservers(void 0),this.Xf.clear()}loadFile(z,u,U,f,g,w,P,R){if(ArrayBuffer.isView(u))return this._loadBinary(z,u,U,f,P,R),null;this._progressCallback=g;const d=u.name||v.Tools.GetFilename(u);if(w){if(this.useRangeRequests){this.validate&&S.d.Warn("glTF validation is not supported when range requests are enabled");const U={abort:()=>{},onCompleteObservable:new J.e},v={readAsync:(U,J)=>new Promise(((v,f)=>{this._loadFile(z,u,(z=>{v(new Uint8Array(z))}),!0,(z=>{f(z)}),(z=>{z.setRequestHeader("Range","bytes=".concat(U,"-").concat(U+J-1))}))})),byteLength:0};return this._unpackBinaryAsync(new h(v)).then((z=>{U.onCompleteObservable.notifyObservers(U),f(z)}),P?z=>P(void 0,z):void 0),U}return this._loadFile(z,u,(u=>{this._validate(z,new Uint8Array(u,0,u.byteLength),U,d),this._unpackBinaryAsync(new h({readAsync:(z,U)=>p(u,z,U),byteLength:u.byteLength})).then((z=>{f(z)}),P?z=>P(void 0,z):void 0)}),!0,P)}return this._loadFile(z,u,(u=>{try{this._validate(z,u,U,d),f({json:this._parseJson(u)})}catch(J){P&&P()}}),!1,P)}_loadBinary(z,u,U,J,v,f){this._validate(z,new Uint8Array(u.buffer,u.byteOffset,u.byteLength),U,f),this._unpackBinaryAsync(new h({readAsync:(z,U)=>function(z,u,U){try{if(u<0||u>=z.byteLength)throw new RangeError("Offset is out of range.");if(u+U>z.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(z.buffer,z.byteOffset+u,U))}catch(J){return Promise.reject(J)}}(u,z,U),byteLength:u.byteLength})).then((z=>{J(z)}),v?z=>v(void 0,z):void 0)}importMeshAsync(z,u,U,J,v,f){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log("Loading ".concat(f||"")),this._loader=this._getLoader(U),this._loader.importMeshAsync(z,u,null,U,J,v,f))))}loadAsync(z,u,U,J,v){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(u),this.onParsedObservable.clear(),this._log("Loading ".concat(v||"")),this._loader=this._getLoader(u),this._loader.loadAsync(z,u,U,J,v))))}loadAssetContainerAsync(z,u,U,J,v){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(u),this.onParsedObservable.clear(),this._log("Loading ".concat(v||"")),this._loader=this._getLoader(u);const f=new T(z),g=[];this.onMaterialLoadedObservable.add((z=>{g.push(z)}));const w=[];this.onTextureLoadedObservable.add((z=>{w.push(z)}));const P=[];this.onCameraLoadedObservable.add((z=>{P.push(z)}));const R=[];return this.onMeshLoadedObservable.add((z=>{z.morphTargetManager&&R.push(z.morphTargetManager)})),this._loader.importMeshAsync(null,z,f,u,U,J,v).then((z=>(Array.prototype.push.apply(f.geometries,z.geometries),Array.prototype.push.apply(f.meshes,z.meshes),Array.prototype.push.apply(f.mA,z.mA),Array.prototype.push.apply(f.skeletons,z.skeletons),Array.prototype.push.apply(f.animationGroups,z.animationGroups),Array.prototype.push.apply(f.materials,g),Array.prototype.push.apply(f.textures,w),Array.prototype.push.apply(f.lights,z.lights),Array.prototype.push.apply(f.transformNodes,z.transformNodes),Array.prototype.push.apply(f.cameras,P),Array.prototype.push.apply(f.morphTargetManagers,R),f)))}))}canDirectLoad(z){return L.canDirectLoad(z)}directLoad(z,u){if(u.startsWith("base64,"+V)||u.startsWith(";base64,"+V)||u.startsWith("application/octet-stream;base64,"+V)||u.startsWith("model/gltf-binary;base64,"+V)){const U=(0,K.b)(u);return this._validate(z,new Uint8Array(U,0,U.byteLength)),this._unpackBinaryAsync(new h({readAsync:(z,u)=>p(U,z,u),byteLength:U.byteLength}))}return this._validate(z,u),Promise.resolve({json:this._parseJson(u)})}createPlugin(z){return new D(z[L.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((z,u)=>{this.onCompleteObservable.addOnce((()=>{z()})),this.onErrorObservable.addOnce((z=>{u(z)}))}))}_setState(z){this._state!==z&&(this._state=z,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(Q[this._state]))}_loadFile(z,u,U,J,v,f){const g=z._loadFile(u,U,(z=>{this._onProgress(z,g)}),!0,J,v,f);return g.onCompleteObservable.add((()=>{g._lengthComputable=!0,g._total=g._loaded})),this._requests.push(g),g}_onProgress(z,u){if(!this._progressCallback)return;u._lengthComputable=z.lengthComputable,u._loaded=z.loaded,u._total=z.total;let U=!0,J=0,v=0;for(const f of this._requests){if(void 0===f._lengthComputable||void 0===f._loaded||void 0===f._total)return;U=U&&f._lengthComputable,J+=f._loaded,v+=f._total}this._progressCallback({lengthComputable:U,loaded:J,total:U?v:0})}_validate(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),t.e.ValidateAsync(u,U,J,(u=>this.preprocessUrlAsync(U+u).then((u=>z._loadFileAsync(u,void 0,!0,!0).then((z=>new Uint8Array(z,0,z.byteLength))))))).then((z=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(z),this.onValidatedObservable.clear()}),(z=>{this._endPerformanceCounter("Validate JSON"),v.Tools.Warn("Failed to validate: ".concat(z.message)),this.onValidatedObservable.clear()})))}_getLoader(z){const u=z.json.asset||{};this._log("Asset version: ".concat(u.version)),u.minVersion&&this._log("Asset minimum version: ".concat(u.minVersion)),u.generator&&this._log("Asset generator: ".concat(u.generator));const U=D._parseVersion(u.version);if(!U)throw new Error("Invalid version: "+u.version);if(void 0!==u.minVersion){const z=D._parseVersion(u.minVersion);if(!z)throw new Error("Invalid minimum version: "+u.minVersion);if(D._compareVersion(z,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+u.minVersion)}const J={1:D._CreateGLTF1Loader,2:D._CreateGLTF2Loader}[U.major];if(!J)throw new Error("Unsupported version: "+u.version);return J(this)}_parseJson(z){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: ".concat(z.length));const u=JSON.parse(z);return this._endPerformanceCounter("Parse JSON"),u}_unpackBinaryAsync(z){return this._startPerformanceCounter("Unpack Binary"),z.loadAsync(20).then((()=>{const u=z.readUint32();if(1179937895!==u)throw new Y.g("Unexpected magic: "+u,Y.d.GLTFLoaderUnexpectedMagicError);const U=z.readUint32();this.loggingEnabled&&this._log("Binary version: ".concat(U));const J=z.readUint32();let v;switch(this.useRangeRequests||J===z.buffer.byteLength||S.d.Warn("Length in header does not match actual data length: ".concat(J," != ").concat(z.buffer.byteLength)),U){case 1:v=this._unpackBinaryV1Async(z,J);break;case 2:v=this._unpackBinaryV2Async(z,J);break;default:throw new Error("Unsupported version: "+U)}return this._endPerformanceCounter("Unpack Binary"),v}))}_unpackBinaryV1Async(z,u){const U=z.readUint32(),J=z.readUint32();if(0!==J)throw new Error("Unexpected content format: ".concat(J));const v=u-z.byteOffset,f={json:this._parseJson(z.readString(U)),bin:null};if(0!==v){const u=z.byteOffset;f.bin={readAsync:(U,J)=>z.buffer.readAsync(u+U,J),byteLength:v}}return Promise.resolve(f)}_unpackBinaryV2Async(z,u){const U=1313821514,J=5130562,v=z.readUint32();if(z.readUint32()!==U)throw new Error("First chunk format is not JSON");return z.byteOffset+v===u?z.loadAsync(v).then((()=>({json:this._parseJson(z.readString(v)),bin:null}))):z.loadAsync(v+8).then((()=>{const f={json:this._parseJson(z.readString(v)),bin:null},g=()=>{const v=z.readUint32();switch(z.readUint32()){case U:throw new Error("Unexpected JSON chunk");case J:{const u=z.byteOffset;f.bin={readAsync:(U,J)=>z.buffer.readAsync(u+U,J),byteLength:v},z.skipBytes(v);break}default:z.skipBytes(v)}return z.byteOffset!==u?z.loadAsync(8).then(g):Promise.resolve(f)};return g()}))}static _parseVersion(z){if("1.0"===z||"1.0.1"===z)return{major:1,minor:0};const u=(z+"").match(/^(\d+)\.(\d+)/);return u?{major:parseInt(u[1]),minor:parseInt(u[2])}:null}static _compareVersion(z,u){return z.major>u.major?1:z.major<u.major?-1:z.minor>u.minor?1:z.minor<u.minor?-1:0}_logOpen(z){this._log(z),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(z){const u=D._logSpaces.substring(0,2*this._logIndentLevel);S.d.Log("".concat(u).concat(z))}_logDisabled(z){}_startPerformanceCounterEnabled(z){v.Tools.StartPerformanceCounter(z)}_startPerformanceCounterDisabled(z){}_endPerformanceCounterEnabled(z){v.Tools.EndPerformanceCounter(z)}_endPerformanceCounterDisabled(z){}}D.IncrementalLoading=!0,D.HomogeneousCoordinates=!1,D._logSpaces="                                ",(0,f.d)(new D)},14129:(z,u,U)=>{"use strict";U.d(u,{e:()=>g});var J=U(12748);function v(z,u,U,J){const v={externalResourceFunction:J};return U&&(v.uri="file:"===u?U:u+U),ArrayBuffer.isView(z)?GLTFValidator.validateBytes(z,v):GLTFValidator.validateString(z,v)}function f(){const z=[];onmessage=u=>{const U=u.data;switch(U.id){case"init":importScripts(U.url);break;case"validate":v(U.data,U.rootUrl,U.fileName,(u=>new Promise(((U,J)=>{const v=z.length;z.push({resolve:U,reject:J}),postMessage({id:"getExternalResource",index:v,uri:u})})))).then((z=>{postMessage({id:"validate.resolve",value:z})}),(z=>{postMessage({id:"validate.reject",reason:z})}));break;case"getExternalResource.resolve":z[U.index].resolve(U.value);break;case"getExternalResource.reject":z[U.index].reject(U.reason)}}}class g{static ValidateAsync(z,u,U,g){return"function"===typeof Worker?new Promise(((w,P)=>{const R="".concat(v,"(").concat(f,")()"),S=URL.createObjectURL(new Blob([R],{type:"application/javascript"})),d=new Worker(S),mz=z=>{d.removeEventListener("error",mz),d.removeEventListener("message",Z),P(z)},Z=z=>{const u=z.data;switch(u.id){case"getExternalResource":g(u.uri).then((z=>{d.postMessage({id:"getExternalResource.resolve",index:u.index,value:z},[z.buffer])}),(z=>{d.postMessage({id:"getExternalResource.reject",index:u.index,reason:z})}));break;case"validate.resolve":d.removeEventListener("error",mz),d.removeEventListener("message",Z),w(u.value),d.terminate();break;case"validate.reject":d.removeEventListener("error",mz),d.removeEventListener("message",Z),P(u.reason),d.terminate()}};if(d.addEventListener("error",mz),d.addEventListener("message",Z),d.postMessage({id:"init",url:J.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(z)){const J=z.slice();d.postMessage({id:"validate",data:J,rootUrl:u,fileName:U},[J.buffer])}else d.postMessage({id:"validate",data:z,rootUrl:u,fileName:U})})):(this._LoadScriptPromise||(this._LoadScriptPromise=J.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>v(z,u,U,g))))}}g.Configuration={url:"".concat(J.Tools._DefaultCdnUrl,"/gltf_validator.js")}},14741:(z,u,U)=>{"use strict";U.d(u,{c:()=>V});var J=U(12899),v=U(12901),f=U(12955),g=U(12914),w=U(13283),P=U(13221),R=U(13e3),S=U(13161),d=U(12875),mz=U(12837);U(13884),U(13784),U(13800),U(13792),U(13805),U(13811),U(13816);const Z="imageProcessingCompatibility",A="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";mz.d.IncludesShadersStore[Z]||(mz.d.IncludesShadersStore[Z]=A);const E="skyPixelShader",C="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";mz.d.ShadersStore[E]||(mz.d.ShadersStore[E]=C);U(13899),U(13821),U(13829),U(13839),U(13831);const r="skyVertexShader",M="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";mz.d.ShadersStore[r]||(mz.d.ShadersStore[r]=M);var T=U(13219),X=U(13266),h=U(13261);class t extends w.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class V extends P.c{constructor(z,u){super(z,u),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new g.Eu(0,100,0),this.useSunPosition=!1,this.cameraOffset=g.Eu.Zero(),this.up=g.Eu.Up(),this.dithering=!1,this._cameraPosition=g.Eu.Zero(),this._skyOrientation=new g.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(z,u){const U=u._drawWrapper;if(this.isFrozen&&U.effect&&U._wasPreviouslyReady)return!0;u.materialDefines||(u.materialDefines=new t);const J=u.materialDefines,v=this.Vz();if(this._isReadyForSubMesh(u))return!0;if((0,h.I)(z,v,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,J),(0,h.B)(z,J,!0,!1),J.IMAGEPROCESSINGPOSTPROCESS!==v.imageProcessingConfiguration.applyByPostProcess&&J.markAsMiscDirty(),J.DITHER!==this.dithering&&J.markAsMiscDirty(),J.isDirty){J.markAsProcessed(),v.resetCachedMaterial();const z=new T.d;J.FOG&&z.addFallback(1,"FOG"),J.IMAGEPROCESSINGPOSTPROCESS=v.imageProcessingConfiguration.applyByPostProcess,J.DITHER=this.dithering;const U=[R.g.PositionKind];J.VERTEXCOLOR&&U.push(R.g.ColorKind);const f="sky",g=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,X.b)(g);const w=J.toString();u.setEffect(v.getEngine().createEffect(f,U,g,[],w,z,this.onCompiled,this.onError),J,this._materialContext)}return!(!u.effect||!u.effect.isReady())&&(J._renderId=v.getRenderId(),U._wasPreviouslyReady=!0,!0)}bindForSubMesh(z,u,U){const J=this.Vz(),v=U.materialDefines;if(!v)return;const f=U.effect;if(!f)return;this._activeEffect=f,this.bindOnlyWorldMatrix(z),this._activeEffect.setMatrix("viewProjection",J.getTransformMatrix()),this._mustRebind(J,f,U)&&((0,X.f)(f,this,J),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,h.h)(v,f,J)),J.fogEnabled&&u.applyFog&&J.fogMode!==S.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",J.getViewMatrix()),(0,h.f)(J,u,this._activeEffect);const w=J.activeCamera;if(w){const z=w.getWorldMatrix();this._cameraPosition.x=z.m[12],this._cameraPosition.y=z.m[13],this._cameraPosition.z=z.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const z=Math.PI*(this.inclination-.5),u=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(u)*Math.cos(z),this.sunPosition.y=this.distance*Math.sin(-z),this.sunPosition.z=this.distance*Math.sin(u)*Math.cos(z),g.Quaternion.FromUnitVectorsToRef(g.Eu.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(u,this._activeEffect,U)}getAnimatables(){return[]}dispose(z){super.dispose(z)}clone(z){return f.b.Clone((()=>new V(z,this.Vz())),this)}serialize(){const z=super.serialize();return z.customType="BABYLON.SkyMaterial",z}getClassName(){return"SkyMaterial"}static Parse(z,u,U){return f.b.Parse((()=>new V(z.name,u)),z,u,U)}}(0,J.b)([(0,v.K)()],V.prototype,"luminance",void 0),(0,J.b)([(0,v.K)()],V.prototype,"turbidity",void 0),(0,J.b)([(0,v.K)()],V.prototype,"rayleigh",void 0),(0,J.b)([(0,v.K)()],V.prototype,"mieCoefficient",void 0),(0,J.b)([(0,v.K)()],V.prototype,"mieDirectionalG",void 0),(0,J.b)([(0,v.K)()],V.prototype,"distance",void 0),(0,J.b)([(0,v.K)()],V.prototype,"inclination",void 0),(0,J.b)([(0,v.K)()],V.prototype,"azimuth",void 0),(0,J.b)([(0,v.G)()],V.prototype,"sunPosition",void 0),(0,J.b)([(0,v.K)()],V.prototype,"useSunPosition",void 0),(0,J.b)([(0,v.G)()],V.prototype,"cameraOffset",void 0),(0,J.b)([(0,v.G)()],V.prototype,"up",void 0),(0,J.b)([(0,v.K)()],V.prototype,"dithering",void 0),(0,d.f)("BABYLON.SkyMaterial",V)},13556:(z,u,U)=>{"use strict";function J(z,u){u.headers=z.headers||{},u.statusMessage=z.statusText,u.statusCode=z.status,u.data=z.response}function v(z,u,U){return new Promise((function(v,f){U=U||{};var g,w,P,R=new XMLHttpRequest,S=U.body,d=U.headers||{};for(g in U.timeout&&(R.timeout=U.timeout),R.ontimeout=R.onerror=function(z){z.timeout="timeout"==z.type,f(z)},R.open(z,u.href||u),R.onload=function(){for(P=R.getAllResponseHeaders().trim().split(/[\r\n]+/),J(R,R);w=P.shift();)w=w.split(": "),R.headers[w.shift().toLowerCase()]=w.join(": ");if((w=R.headers["content-type"])&&~w.indexOf("application/json"))try{R.data=JSON.parse(R.data,U.reviver)}catch(z){return J(R,z),f(z)}(R.status>=400?f:v)(R)},typeof FormData<"u"&&S instanceof FormData||S&&"object"==typeof S&&(d["content-type"]="application/json",S=JSON.stringify(S)),R.withCredentials=!!U.withCredentials,d)R.setRequestHeader(g,d[g]);R.send(S)}))}U.r(u),U.d(u,{del:()=>P,get:()=>f,patch:()=>w,post:()=>g,put:()=>R,send:()=>v});var f=v.bind(v,"GET"),g=v.bind(v,"POST"),w=v.bind(v,"PATCH"),P=v.bind(v,"DELETE"),R=v.bind(v,"PUT")},14832:(z,u,U)=>{"use strict";U.d(u,{b:()=>d});const J=.5*(Math.sqrt(3)-1),v=(3-Math.sqrt(3))/6,f=1/3,g=1/6,w=(Math.sqrt(5)-1)/4,P=(5-Math.sqrt(5))/20,R=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),S=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const d=class{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const u="function"==typeof z?z:function(z){let u=0,U=0,J=0,v=1;const f=function(){let z=4022871197;return function(u){u=u.toString();for(let U=0;U<u.length;U++){z+=u.charCodeAt(U);let J=.02519603282416938*z;z=J>>>0,J-=z,J*=z,z=J>>>0,J-=z,z+=4294967296*J}return 2.3283064365386963e-10*(z>>>0)}}();u=f(" "),U=f(" "),J=f(" "),u-=f(z),u<0&&(u+=1);U-=f(z),U<0&&(U+=1);J-=f(z),J<0&&(J+=1);return function(){const z=2091639*u+2.3283064365386963e-10*v;return u=U,U=J,J=z-(v=0|z)}}(z);this.p=function(z){const u=new Uint8Array(256);for(let U=0;U<256;U++)u[U]=U;for(let U=0;U<255;U++){const J=U+~~(z()*(256-U)),v=u[U];u[U]=u[J],u[J]=v}return u}(u),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let U=0;U<512;U++)this.perm[U]=this.p[255&U],this.permMod12[U]=this.perm[U]%12}noise2D(z,u){const U=this.permMod12,f=this.perm;let g=0,w=0,P=0;const S=(z+u)*J,d=Math.floor(z+S),mz=Math.floor(u+S),Z=(d+mz)*v,A=z-(d-Z),E=u-(mz-Z);let C,r;A>E?(C=1,r=0):(C=0,r=1);const M=A-C+v,T=E-r+v,X=A-1+2*v,h=E-1+2*v,t=255&d,V=255&mz;let L=.5-A*A-E*E;if(L>=0){const z=3*U[t+f[V]];L*=L,g=L*L*(R[z]*A+R[z+1]*E)}let O=.5-M*M-T*T;if(O>=0){const z=3*U[t+C+f[V+r]];O*=O,w=O*O*(R[z]*M+R[z+1]*T)}let x=.5-X*X-h*h;if(x>=0){const z=3*U[t+1+f[V+1]];x*=x,P=x*x*(R[z]*X+R[z+1]*h)}return 70*(g+w+P)}noise3D(z,u,U){const J=this.permMod12,v=this.perm;let w,P,S,d;const mz=(z+u+U)*f,Z=Math.floor(z+mz),A=Math.floor(u+mz),E=Math.floor(U+mz),C=(Z+A+E)*g,r=z-(Z-C),M=u-(A-C),T=U-(E-C);let X,h,t,V,L,O;r>=M?M>=T?(X=1,h=0,t=0,V=1,L=1,O=0):r>=T?(X=1,h=0,t=0,V=1,L=0,O=1):(X=0,h=0,t=1,V=1,L=0,O=1):M<T?(X=0,h=0,t=1,V=0,L=1,O=1):r<T?(X=0,h=1,t=0,V=0,L=1,O=1):(X=0,h=1,t=0,V=1,L=1,O=0);const x=r-X+g,Q=M-h+g,K=T-t+g,Y=r-V+2*g,p=M-L+2*g,N=T-O+2*g,D=r-1+.5,c=M-1+.5,W=T-1+.5,j=255&Z,I=255&A,F=255&E;let b=.6-r*r-M*M-T*T;if(b<0)w=0;else{const z=3*J[j+v[I+v[F]]];b*=b,w=b*b*(R[z]*r+R[z+1]*M+R[z+2]*T)}let k=.6-x*x-Q*Q-K*K;if(k<0)P=0;else{const z=3*J[j+X+v[I+h+v[F+t]]];k*=k,P=k*k*(R[z]*x+R[z+1]*Q+R[z+2]*K)}let B=.6-Y*Y-p*p-N*N;if(B<0)S=0;else{const z=3*J[j+V+v[I+L+v[F+O]]];B*=B,S=B*B*(R[z]*Y+R[z+1]*p+R[z+2]*N)}let y=.6-D*D-c*c-W*W;if(y<0)d=0;else{const z=3*J[j+1+v[I+1+v[F+1]]];y*=y,d=y*y*(R[z]*D+R[z+1]*c+R[z+2]*W)}return 32*(w+P+S+d)}noise4D(z,u,U,J){const v=this.perm;let f,g,R,d,mz;const Z=(z+u+U+J)*w,A=Math.floor(z+Z),E=Math.floor(u+Z),C=Math.floor(U+Z),r=Math.floor(J+Z),M=(A+E+C+r)*P,T=z-(A-M),X=u-(E-M),h=U-(C-M),t=J-(r-M);let V=0,L=0,O=0,x=0;T>X?V++:L++,T>h?V++:O++,T>t?V++:x++,X>h?L++:O++,X>t?L++:x++,h>t?O++:x++;const Q=V>=3?1:0,K=L>=3?1:0,Y=O>=3?1:0,p=x>=3?1:0,N=V>=2?1:0,D=L>=2?1:0,c=O>=2?1:0,W=x>=2?1:0,j=V>=1?1:0,I=L>=1?1:0,F=O>=1?1:0,b=x>=1?1:0,k=T-Q+P,B=X-K+P,y=h-Y+P,H=t-p+P,G=T-N+2*P,a=X-D+2*P,i=h-c+2*P,n=t-W+2*P,q=T-j+3*P,o=X-I+3*P,s=h-F+3*P,l=t-b+3*P,e=T-1+4*P,zz=X-1+4*P,uz=h-1+4*P,Uz=t-1+4*P,Jz=255&A,vz=255&E,fz=255&C,gz=255&r;let wz=.6-T*T-X*X-h*h-t*t;if(wz<0)f=0;else{const z=v[Jz+v[vz+v[fz+v[gz]]]]%32*4;wz*=wz,f=wz*wz*(S[z]*T+S[z+1]*X+S[z+2]*h+S[z+3]*t)}let Pz=.6-k*k-B*B-y*y-H*H;if(Pz<0)g=0;else{const z=v[Jz+Q+v[vz+K+v[fz+Y+v[gz+p]]]]%32*4;Pz*=Pz,g=Pz*Pz*(S[z]*k+S[z+1]*B+S[z+2]*y+S[z+3]*H)}let Rz=.6-G*G-a*a-i*i-n*n;if(Rz<0)R=0;else{const z=v[Jz+N+v[vz+D+v[fz+c+v[gz+W]]]]%32*4;Rz*=Rz,R=Rz*Rz*(S[z]*G+S[z+1]*a+S[z+2]*i+S[z+3]*n)}let Sz=.6-q*q-o*o-s*s-l*l;if(Sz<0)d=0;else{const z=v[Jz+j+v[vz+I+v[fz+F+v[gz+b]]]]%32*4;Sz*=Sz,d=Sz*Sz*(S[z]*q+S[z+1]*o+S[z+2]*s+S[z+3]*l)}let dz=.6-e*e-zz*zz-uz*uz-Uz*Uz;if(dz<0)mz=0;else{const z=v[Jz+1+v[vz+1+v[fz+1+v[gz+1]]]]%32*4;dz*=dz,mz=dz*dz*(S[z]*e+S[z+1]*zz+S[z+2]*uz+S[z+3]*Uz)}return 27*(f+g+R+d+mz)}}}}]);