/*! For license information please see k76s1.32.9b4a784f.chunk.js.LICENSE.txt */
(self.n52dyox90qa=self.n52dyox90qa||[]).push([[32],{13739:(E,t,z)=>{"use strict";var A=z(13748),X=z(13756),R=z(13763);z.g.__TYPEDARRAY_POOL||(z.g.__TYPEDARRAY_POOL={UINT8:X([32,0]),UINT16:X([32,0]),UINT32:X([32,0]),INT8:X([32,0]),INT16:X([32,0]),INT32:X([32,0]),FLOAT:X([32,0]),DOUBLE:X([32,0]),DATA:X([32,0]),UINT8C:X([32,0]),BUFFER:X([32,0])});var u="undefined"!==typeof Uint8ClampedArray,p=z.g.__TYPEDARRAY_POOL;p.UINT8C||(p.UINT8C=X([32,0])),p.BUFFER||(p.BUFFER=X([32,0]));var C=p.DATA,Z=p.BUFFER;function H(E){if(E){var t=E.length||E.byteLength,z=A.log2(t);C[z].push(E)}}function h(E){E=A.nextPow2(E);var t=A.log2(E),z=C[t];return z.length>0?z.pop():new ArrayBuffer(E)}function d(E){return new Uint8Array(h(E),0,E)}function y(E){return new Uint16Array(h(2*E),0,E)}function O(E){return new Uint32Array(h(4*E),0,E)}function c(E){return new Int8Array(h(E),0,E)}function a(E){return new Int16Array(h(2*E),0,E)}function L(E){return new Int32Array(h(4*E),0,E)}function mE(E){return new Float32Array(h(4*E),0,E)}function W(E){return new Float64Array(h(8*E),0,E)}function I(E){return u?new Uint8ClampedArray(h(E),0,E):d(E)}function e(E){return new DataView(h(E),0,E)}t.free=function(E){if(R(E))Z[A.log2(E.length)].push(E);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(E)&&(E=E.buffer),!E)return;var t=E.length||E.byteLength,z=0|A.log2(t);C[z].push(E)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeInt8=t.freeInt16=t.freeInt32=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(E){H(E.buffer)},t.freeArrayBuffer=H,t.freeBuffer=function(E){Z[A.log2(E.length)].push(E)},t.malloc=function(E,t){if(void 0===t||"arraybuffer"===t)return h(E);switch(t){case"uint8":return d(E);case"uint16":return y(E);case"uint32":return O(E);case"int8":return c(E);case"int16":return a(E);case"int32":return L(E);case"float":case"float32":return mE(E);case"double":case"float64":return W(E);case"uint8_clamped":return I(E);case"buffer":throw"Buffer not supported";case"data":case"dataview":return e(E);default:return null}return null},t.mallocArrayBuffer=h,t.mallocUint8=d,t.mallocUint16=y,t.mallocUint32=O,t.mallocInt8=c,t.mallocInt16=a,t.mallocInt32=L,t.mallocFloat32=t.mallocFloat=mE,t.mallocFloat64=t.mallocDouble=W,t.mallocUint8Clamped=I,t.mallocDataView=e,t.clearCache=function(){for(var E=0;E<32;++E)p.UINT8[E].length=0,p.UINT16[E].length=0,p.UINT32[E].length=0,p.INT8[E].length=0,p.INT16[E].length=0,p.INT32[E].length=0,p.FLOAT[E].length=0,p.DOUBLE[E].length=0,p.UINT8C[E].length=0,C[E].length=0,Z[E].length=0}},13834:(E,t,z)=>{E.exports=X;var A=z(12616);function X(E,t){if(!(this instanceof X))return new X(E,t);var z=A.create();A.add(z,E,t),this.base=A.min(A.create(),E,z),this.jZ=A.clone(t),this.max=A.max(A.create(),E,z),this.mag=A.length(this.jZ)}var R=X.prototype;R.width=function(){return this.jZ[0]},R.height=function(){return this.jZ[1]},R.depth=function(){return this.jZ[2]},R.x0=function(){return this.base[0]},R.y0=function(){return this.base[1]},R.z0=function(){return this.base[2]},R.x1=function(){return this.max[0]},R.y1=function(){return this.max[1]},R.z1=function(){return this.max[2]},R.translate=function(E){return A.add(this.max,this.max,E),A.add(this.base,this.base,E),this},R.setPosition=function(E){return A.add(this.max,E,this.jZ),A.k(this.base,E),this},R.expand=function(E){var t=A.create(),z=A.create();return A.max(t,E.max,this.max),A.min(z,E.base,this.base),A.Wt(t,t,z),new X(z,t)},R.intersects=function(E){return!(E.base[0]>this.max[0])&&(!(E.base[1]>this.max[1])&&(!(E.base[2]>this.max[2])&&(!(E.max[0]<this.base[0])&&(!(E.max[1]<this.base[1])&&!(E.max[2]<this.base[2])))))},R.touches=function(E){var t=this.union(E);return null!==t&&(0==t.width()||0==t.height()||0==t.depth())},R.union=function(E){if(!this.intersects(E))return null;var t=Math.max(E.base[0],this.base[0]),z=Math.max(E.base[1],this.base[1]),A=Math.max(E.base[2],this.base[2]);return new X([t,z,A],[Math.min(E.max[0],this.max[0])-t,Math.min(E.max[1],this.max[1])-z,Math.min(E.max[2],this.max[2])-A])}},13748:(E,t)=>{"use strict";function z(E){var t=32;return(E&=-E)&&t--,65535&E&&(t-=16),16711935&E&&(t-=8),252645135&E&&(t-=4),858993459&E&&(t-=2),1431655765&E&&(t-=1),t}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(E){return(E>0)-(E<0)},t.abs=function(E){var t=E>>31;return(E^t)-t},t.min=function(E,t){return t^(E^t)&-(E<t)},t.max=function(E,t){return E^(E^t)&-(E<t)},t.isPow2=function(E){return!(E&E-1)&&!!E},t.log2=function(E){var t,z;return t=(E>65535)<<4,t|=z=((E>>>=t)>255)<<3,t|=z=((E>>>=z)>15)<<2,(t|=z=((E>>>=z)>3)<<1)|(E>>>=z)>>1},t.log10=function(E){return E>=1e9?9:E>=1e8?8:E>=1e7?7:E>=1e6?6:E>=1e5?5:E>=1e4?4:E>=1e3?3:E>=100?2:E>=10?1:0},t.popCount=function(E){return 16843009*((E=(858993459&(E-=E>>>1&1431655765))+(E>>>2&858993459))+(E>>>4)&252645135)>>>24},t.countTrailingZeros=z,t.nextPow2=function(E){return E+=0===E,--E,E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)+1},t.prevPow2=function(E){return E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)-(E>>>1)},t.parity=function(E){return E^=E>>>16,E^=E>>>8,E^=E>>>4,27030>>>(E&=15)&1};var A=new Array(256);!function(E){for(var t=0;t<256;++t){var z=t,A=t,X=7;for(z>>>=1;z;z>>>=1)A<<=1,A|=1&z,--X;E[t]=A<<X&255}}(A),t.reverse=function(E){return A[255&E]<<24|A[E>>>8&255]<<16|A[E>>>16&255]<<8|A[E>>>24&255]},t.interleave2=function(E,t){return(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},t.deinterleave2=function(E,t){return(E=65535&((E=16711935&((E=252645135&((E=858993459&((E=E>>>t&1431655765)|E>>>1))|E>>>2))|E>>>4))|E>>>16))<<16>>16},t.interleave3=function(E,t,z){return E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2),(E|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(z=1227133513&((z=3272356035&((z=251719695&((z=4278190335&((z&=1023)|z<<16))|z<<8))|z<<4))|z<<2))<<2},t.deinterleave3=function(E,t){return(E=1023&((E=4278190335&((E=251719695&((E=3272356035&((E=E>>>t&1227133513)|E>>>2))|E>>>4))|E>>>8))|E>>>16))<<22>>22},t.nextCombination=function(E){var t=E|E-1;return t+1|(~t&-~t)-1>>>z(E)+1}},13737:(E,t,z)=>{"use strict";E.exports=function(E,t,z){switch(arguments.length){case 1:return A=[],Z(X=E,X,H,!0),A;case 2:return"function"===typeof t?Z(E,E,t,!0):function(E,t){return A=[],Z(E,t,H,!1),A}(E,t);case 3:return Z(E,t,z,!1);default:throw new Error("box-intersect: Invalid arguments")}var X};var A,X=z(13739),R=z(13771),u=z(13777);function p(E,t){for(var z=0;z<E;++z)if(!(t[z]<=t[z+E]))return!0;return!1}function C(E,t,z,A){for(var X=0,R=0,u=0,C=E.length;u<C;++u){var Z=E[u];if(!p(t,Z)){for(var H=0;H<2*t;++H)z[X++]=Z[H];A[R++]=u}}return R}function Z(E,t,z,A){var p=E.length,Z=t.length;if(!(p<=0||Z<=0)){var H=E[0].length>>>1;if(!(H<=0)){var h,d=X.mallocDouble(2*H*p),y=X.mallocInt32(p);if((p=C(E,H,d,y))>0){if(1===H&&A)R.init(p),h=R.sweepComplete(H,z,0,p,d,y,0,p,d,y);else{var O=X.mallocDouble(2*H*Z),c=X.mallocInt32(Z);(Z=C(t,H,O,c))>0&&(R.init(p+Z),h=1===H?R.sweepBipartite(H,z,0,p,d,y,0,Z,O,c):u(H,z,A,p,d,y,Z,O,c),X.free(O),X.free(c))}X.free(d),X.free(y)}return h}}}function H(E,t){A.push([E,t])}},13783:(E,t)=>{"use strict";var z="d",A="ax",X="fp",R="es",u="rs",p="re",C="rb",Z="bs",H="be",h="bb",d=[z,A,"vv",u,p,C,"ri",Z,H,h,"bi"];function y(E){var t="bruteForce"+(E?"Full":"Partial"),A=[],u=d.slice();E||u.splice(3,0,X);var p=["function "+t+"("+u.join()+"){"];function C(t,X){var u=function(E,t,A){var X="bruteForce"+(E?"Red":"Blue")+(t?"Flip":"")+(A?"Full":""),u=["function ",X,"(",d.join(),"){","var ",R,"=2*",z,";"],p="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",C="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(A?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return E?u.push(p,"Q",":",C):u.push(C,"Q",":",p),A?u.push("if(y1<x0||x1<y0)continue;"):t?u.push("if(y0<=x0||x1<y0)continue;"):u.push("if(y0<x0||x1<y0)continue;"),u.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),t?u.push("yi,xi"):u.push("xi,yi"),u.push(");if(rv!==void 0)return rv;}}}"),{name:X,code:u.join("")}}(t,X,E);A.push(u.code),p.push("return "+u.name+"("+d.join()+");")}p.push("if(re-rs>be-bs){"),E?(C(!0,!1),p.push("}else{"),C(!1,!1)):(p.push("if(fp){"),C(!0,!0),p.push("}else{"),C(!0,!1),p.push("}}else{if(fp){"),C(!1,!0),p.push("}else{"),C(!1,!1),p.push("}")),p.push("}}return "+t);var Z=A.join("")+p.join("");return new Function(Z)()}t.partial=y(!1),t.full=y(!0)},13777:(E,t,z)=>{"use strict";E.exports=function(E,t,z,R,H,F,B,b,x){!function(E,t){var z=8*X.log2(t+1)*(E+1)|0,R=X.nextPow2(I*z);D.length<R&&(A.free(D),D=A.mallocInt32(R));var u=X.nextPow2(e*z);S.length<u&&(A.free(S),S=A.mallocDouble(u))}(E,R+B);var J,V=0,r=2*E;l(V++,0,0,R,0,B,z?16:0,-1/0,1/0),z||l(V++,0,0,B,0,R,1,-1/0,1/0);for(;V>0;){var i=(V-=1)*I,g=D[i],o=D[i+1],Q=D[i+2],T=D[i+3],q=D[i+4],M=D[i+5],w=V*e,n=S[w],s=S[w+1],j=1&M,U=!!(16&M),k=H,v=F,Y=b,G=x;if(j&&(k=b,v=x,Y=H,G=F),!(2&M&&o>=(Q=a(E,g,o,Q,k,v,s)))&&!(4&M&&(o=L(E,g,o,Q,k,v,n))>=Q)){var N=Q-o,P=q-T;if(U){if(E*N*(N+P)<y){if(void 0!==(J=C.scanComplete(E,g,t,o,Q,k,v,T,q,Y,G)))return J;continue}}else{if(E*Math.min(N,P)<h){if(void 0!==(J=u(E,g,t,j,o,Q,k,v,T,q,Y,G)))return J;continue}if(E*N*P<d){if(void 0!==(J=C.scanBipartite(E,g,t,j,o,Q,k,v,T,q,Y,G)))return J;continue}}var EE=O(E,g,o,Q,k,v,n,s);if(o<EE)if(E*(EE-o)<h){if(void 0!==(J=p(E,g+1,t,o,EE,k,v,T,q,Y,G)))return J}else if(g===E-2){if(void 0!==(J=j?C.sweepBipartite(E,t,T,q,Y,G,o,EE,k,v):C.sweepBipartite(E,t,o,EE,k,v,T,q,Y,G)))return J}else l(V++,g+1,o,EE,T,q,j,-1/0,1/0),l(V++,g+1,T,q,o,EE,1^j,-1/0,1/0);if(EE<Q){var tE=Z(E,g,T,q,Y,G),zE=Y[r*tE+g],AE=c(E,g,tE,q,Y,G,zE);if(AE<q&&l(V++,g,EE,Q,AE,q,(4|j)+(U?16:0),zE,s),T<tE&&l(V++,g,EE,Q,T,tE,(2|j)+(U?16:0),n,zE),tE+1===AE){if(void 0!==(J=U?K(E,g,t,EE,Q,k,v,tE,Y,G[tE]):f(E,g,t,j,EE,Q,k,v,tE,Y,G[tE])))return J}else if(tE<AE){var XE;if(U){if(EE<(XE=mE(E,g,EE,Q,k,v,zE))){var RE=c(E,g,EE,XE,k,v,zE);if(g===E-2){if(EE<RE&&void 0!==(J=C.sweepComplete(E,t,EE,RE,k,v,tE,AE,Y,G)))return J;if(RE<XE&&void 0!==(J=C.sweepBipartite(E,t,RE,XE,k,v,tE,AE,Y,G)))return J}else EE<RE&&l(V++,g+1,EE,RE,tE,AE,16,-1/0,1/0),RE<XE&&(l(V++,g+1,RE,XE,tE,AE,0,-1/0,1/0),l(V++,g+1,tE,AE,RE,XE,1,-1/0,1/0))}}else EE<(XE=j?W(E,g,EE,Q,k,v,zE):mE(E,g,EE,Q,k,v,zE))&&(g===E-2?J=j?C.sweepBipartite(E,t,tE,AE,Y,G,EE,XE,k,v):C.sweepBipartite(E,t,EE,XE,k,v,tE,AE,Y,G):(l(V++,g+1,EE,XE,tE,AE,j,-1/0,1/0),l(V++,g+1,tE,AE,EE,XE,1^j,-1/0,1/0)))}}}}};var A=z(13739),X=z(13748),R=z(13783),u=R.partial,p=R.full,C=z(13771),Z=z(13785),H=z(13792),h=128,d=1<<22,y=1<<22,O=H("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),c=H("lo===p0",["p0"]),a=H("lo<p0",["p0"]),L=H("hi<=p0",["p0"]),mE=H("lo<=p0&&p0<=hi",["p0"]),W=H("lo<p0&&p0<=hi",["p0"]),I=6,e=2,D=A.mallocInt32(1024),S=A.mallocDouble(1024);function l(E,t,z,A,X,R,u,p,C){var Z=I*E;D[Z]=t,D[Z+1]=z,D[Z+2]=A,D[Z+3]=X,D[Z+4]=R,D[Z+5]=u;var H=e*E;S[H]=p,S[H+1]=C}function f(E,t,z,A,X,R,u,p,C,Z,H){var h=2*E,d=C*h,y=Z[d+t];E:for(var O=X,c=X*h;O<R;++O,c+=h){var a=u[c+t],L=u[c+t+E];if(!(y<a||L<y)&&(!A||y!==a)){for(var mE,W=p[O],I=t+1;I<E;++I){a=u[c+I],L=u[c+I+E];var e=Z[d+I],D=Z[d+I+E];if(L<e||D<a)continue E}if(void 0!==(mE=A?z(H,W):z(W,H)))return mE}}}function K(E,t,z,A,X,R,u,p,C,Z){var H=2*E,h=p*H,d=C[h+t];E:for(var y=A,O=A*H;y<X;++y,O+=H){var c=u[y];if(c!==Z){var a=R[O+t],L=R[O+t+E];if(!(d<a||L<d)){for(var mE=t+1;mE<E;++mE){a=R[O+mE],L=R[O+mE+E];var W=C[h+mE],I=C[h+mE+E];if(L<W||I<a)continue E}var e=z(c,Z);if(void 0!==e)return e}}}}},13785:(E,t,z)=>{"use strict";E.exports=function(E,t,z,u,p,C){if(u<=z+1)return z;var Z=z,H=u,h=u+z>>>1,d=2*E,y=h,O=p[d*h+t];for(;Z<H;){if(H-Z<X){R(E,t,Z,H,p,C),O=p[d*h+t];break}var c=H-Z,a=Math.random()*c+Z|0,L=p[d*a+t],mE=Math.random()*c+Z|0,W=p[d*mE+t],I=Math.random()*c+Z|0,e=p[d*I+t];L<=W?e>=W?(y=mE,O=W):L>=e?(y=a,O=L):(y=I,O=e):W>=e?(y=mE,O=W):e>=L?(y=a,O=L):(y=I,O=e);for(var D=d*(H-1),S=d*y,l=0;l<d;++l,++D,++S){var f=p[D];p[D]=p[S],p[S]=f}var K=C[H-1];C[H-1]=C[y],C[y]=K;for(D=d*(H-1),S=d*(y=A(E,t,Z,H-1,p,C,O)),l=0;l<d;++l,++D,++S){f=p[D];p[D]=p[S],p[S]=f}K=C[H-1];if(C[H-1]=C[y],C[y]=K,h<y){for(H=y-1;Z<H&&p[d*(H-1)+t]===O;)H-=1;H+=1}else{if(!(y<h))break;for(Z=y+1;Z<H&&p[d*Z+t]===O;)Z+=1}}return A(E,t,z,h,p,C,p[d*h+t])};var A=z(13792)("lo<p0",["p0"]),X=8;function R(E,t,z,A,X,R){for(var u=2*E,p=u*(z+1)+t,C=z+1;C<A;++C,p+=u)for(var Z=X[p],H=C,h=u*(C-1);H>z&&X[h+t]>Z;--H,h-=u){for(var d=h,y=h+u,O=0;O<u;++O,++d,++y){var c=X[d];X[d]=X[y],X[y]=c}var a=R[H];R[H]=R[H-1],R[H-1]=a}}},13792:E=>{"use strict";E.exports=function(E,z){var A="abcdef".split("").concat(z),X=[];E.indexOf("lo")>=0&&X.push("lo=e[k+n]");E.indexOf("hi")>=0&&X.push("hi=e[k+o]");return A.push(t.replace("_",X.join()).replace("$",E)),Function.apply(void 0,A)};var t="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13774:E=>{"use strict";E.exports=function(E,A){A<=4*t?z(0,A-1,E):Z(0,A-1,E)};var t=32;function z(E,t,z){for(var A=2*(E+1),X=E+1;X<=t;++X){for(var R=z[A++],u=z[A++],p=X,C=A-2;p-- >E;){var Z=z[C-2],H=z[C-1];if(Z<R)break;if(Z===R&&H<u)break;z[C]=Z,z[C+1]=H,C-=2}z[C]=R,z[C+1]=u}}function A(E,t,z){t*=2;var A=z[E*=2],X=z[E+1];z[E]=z[t],z[E+1]=z[t+1],z[t]=A,z[t+1]=X}function X(E,t,z){t*=2,z[E*=2]=z[t],z[E+1]=z[t+1]}function R(E,t,z,A){t*=2,z*=2;var X=A[E*=2],R=A[E+1];A[E]=A[t],A[E+1]=A[t+1],A[t]=A[z],A[t+1]=A[z+1],A[z]=X,A[z+1]=R}function u(E,t,z,A,X){t*=2,X[E*=2]=X[t],X[t]=z,X[E+1]=X[t+1],X[t+1]=A}function p(E,t,z){t*=2;var A=z[E*=2],X=z[t];return!(A<X)&&(A!==X||z[E+1]>z[t+1])}function C(E,t,z,A){var X=A[E*=2];return X<t||X===t&&A[E+1]<z}function Z(E,H,h){var d=(H-E+1)/6|0,y=E+d,O=H-d,c=E+H>>1,a=c-d,L=c+d,mE=y,W=a,I=c,e=L,D=O,S=E+1,l=H-1,f=0;p(mE,W,h)&&(f=mE,mE=W,W=f),p(e,D,h)&&(f=e,e=D,D=f),p(mE,I,h)&&(f=mE,mE=I,I=f),p(W,I,h)&&(f=W,W=I,I=f),p(mE,e,h)&&(f=mE,mE=e,e=f),p(I,e,h)&&(f=I,I=e,e=f),p(W,D,h)&&(f=W,W=D,D=f),p(W,I,h)&&(f=W,W=I,I=f),p(e,D,h)&&(f=e,e=D,D=f);for(var K=h[2*W],F=h[2*W+1],B=h[2*e],b=h[2*e+1],x=2*mE,J=2*I,V=2*D,r=2*y,i=2*c,g=2*O,o=0;o<2;++o){var Q=h[x+o],T=h[J+o],q=h[V+o];h[r+o]=Q,h[i+o]=T,h[g+o]=q}X(a,E,h),X(L,H,h);for(var M=S;M<=l;++M)if(C(M,K,F,h))M!==S&&A(M,S,h),++S;else if(!C(M,B,b,h))for(;;){if(C(l,B,b,h)){C(l,K,F,h)?(R(M,S,l,h),++S,--l):(A(M,l,h),--l);break}if(--l<M)break}u(E,S-1,K,F,h),u(H,l+1,B,b,h),S-2-E<=t?z(E,S-2,h):Z(E,S-2,h),H-(l+2)<=t?z(l+2,H,h):Z(l+2,H,h),l-S<=t?z(S,l,h):Z(S,l,h)}},13771:(E,t,z)=>{"use strict";E.exports={init:function(E){var t=X.nextPow2(E);C.length<t&&(A.free(C),C=A.mallocInt32(t));Z.length<t&&(A.free(Z),Z=A.mallocInt32(t));H.length<t&&(A.free(H),H=A.mallocInt32(t));h.length<t&&(A.free(h),h=A.mallocInt32(t));d.length<t&&(A.free(d),d=A.mallocInt32(t));y.length<t&&(A.free(y),y=A.mallocInt32(t));var z=8*t;O.length<z&&(A.free(O),O=A.mallocDouble(z))},sweepBipartite:function(E,t,z,A,X,p,d,y,L,mE){for(var W=0,I=2*E,e=E-1,D=I-1,S=z;S<A;++S){var l=p[S],f=I*S;O[W++]=X[f+e],O[W++]=-(l+1),O[W++]=X[f+D],O[W++]=l}for(S=d;S<y;++S){l=mE[S]+u;var K=I*S;O[W++]=L[K+e],O[W++]=-l,O[W++]=L[K+D],O[W++]=l}var F=W>>>1;R(O,F);var B=0,b=0;for(S=0;S<F;++S){var x=0|O[2*S+1];if(x>=u)c(H,h,b--,x=x-u|0);else if(x>=0)c(C,Z,B--,x);else if(x<=-u){x=-x-u|0;for(var J=0;J<B;++J){if(void 0!==(V=t(C[J],x)))return V}a(H,h,b++,x)}else{x=-x-1|0;for(J=0;J<b;++J){var V;if(void 0!==(V=t(x,H[J])))return V}a(C,Z,B++,x)}}},sweepComplete:function(E,t,z,A,X,u,p,L,mE,W){for(var I=0,e=2*E,D=E-1,S=e-1,l=z;l<A;++l){var f=u[l]+1<<1,K=e*l;O[I++]=X[K+D],O[I++]=-f,O[I++]=X[K+S],O[I++]=f}for(l=p;l<L;++l){f=W[l]+1<<1;var F=e*l;O[I++]=mE[F+D],O[I++]=1|-f,O[I++]=mE[F+S],O[I++]=1|f}var B=I>>>1;R(O,B);var b=0,x=0,J=0;for(l=0;l<B;++l){var V=0|O[2*l+1],r=1&V;if(l<B-1&&V>>1===O[2*l+3]>>1&&(r=2,l+=1),V<0){for(var i=-(V>>1)-1,g=0;g<J;++g){if(void 0!==(o=t(d[g],i)))return o}if(0!==r)for(g=0;g<b;++g){if(void 0!==(o=t(C[g],i)))return o}if(1!==r)for(g=0;g<x;++g){var o;if(void 0!==(o=t(H[g],i)))return o}0===r?a(C,Z,b++,i):1===r?a(H,h,x++,i):2===r&&a(d,y,J++,i)}else{i=(V>>1)-1;0===r?c(C,Z,b--,i):1===r?c(H,h,x--,i):2===r&&c(d,y,J--,i)}}},scanBipartite:function(E,t,z,A,X,p,H,h,d,y,L,mE){var W=0,I=2*E,e=t,D=t+E,S=1,l=1;A?l=u:S=u;for(var f=X;f<p;++f){var K=f+S,F=I*f;O[W++]=H[F+e],O[W++]=-K,O[W++]=H[F+D],O[W++]=K}for(f=d;f<y;++f){K=f+l;var B=I*f;O[W++]=L[B+e],O[W++]=-K}var b=W>>>1;R(O,b);var x=0;for(f=0;f<b;++f){var J=0|O[2*f+1];if(J<0){var V=!1;if((K=-J)>=u?(V=!A,K-=u):(V=!!A,K-=1),V)a(C,Z,x++,K);else{var r=mE[K],i=I*K,g=L[i+t+1],o=L[i+t+1+E];E:for(var Q=0;Q<x;++Q){var T=C[Q],q=I*T;if(!(o<H[q+t+1]||H[q+t+1+E]<g)){for(var M=t+2;M<E;++M)if(L[i+M+E]<H[q+M]||H[q+M+E]<L[i+M])continue E;var w,n=h[T];if(void 0!==(w=A?z(r,n):z(n,r)))return w}}}}else c(C,Z,x--,J-S)}},scanComplete:function(E,t,z,A,X,p,Z,H,h,d,y){for(var c=0,a=2*E,L=t,mE=t+E,W=A;W<X;++W){var I=W+u,e=a*W;O[c++]=p[e+L],O[c++]=-I,O[c++]=p[e+mE],O[c++]=I}for(W=H;W<h;++W){I=W+1;var D=a*W;O[c++]=d[D+L],O[c++]=-I}var S=c>>>1;R(O,S);var l=0;for(W=0;W<S;++W){var f=0|O[2*W+1];if(f<0){if((I=-f)>=u)C[l++]=I-u;else{var K=y[I-=1],F=a*I,B=d[F+t+1],b=d[F+t+1+E];E:for(var x=0;x<l;++x){var J=C[x],V=Z[J];if(V===K)break;var r=a*J;if(!(b<p[r+t+1]||p[r+t+1+E]<B)){for(var i=t+2;i<E;++i)if(d[F+i+E]<p[r+i]||p[r+i+E]<d[F+i])continue E;var g=z(V,K);if(void 0!==g)return g}}}}else{for(I=f-u,x=l-1;x>=0;--x)if(C[x]===I){for(i=x+1;i<l;++i)C[i-1]=C[i];break}--l}}}};var A=z(13739),X=z(13748),R=z(13774),u=1<<28,p=1024,C=A.mallocInt32(p),Z=A.mallocInt32(p),H=A.mallocInt32(p),h=A.mallocInt32(p),d=A.mallocInt32(p),y=A.mallocInt32(p),O=A.mallocDouble(8192);function c(E,t,z,A){var X=t[A],R=E[z-1];E[X]=R,t[R]=X}function a(E,t,z,A){E[z]=A,t[A]=z}},13756:E=>{"use strict";function t(E,z,A){var X=0|E[A];if(X<=0)return[];var R,u=new Array(X);if(A===E.length-1)for(R=0;R<X;++R)u[R]=z;else for(R=0;R<X;++R)u[R]=t(E,z,A+1);return u}E.exports=function(E,z){switch("undefined"===typeof z&&(z=0),typeof E){case"number":if(E>0)return function(E,t){var z,A;for(z=new Array(E),A=0;A<E;++A)z[A]=t;return z}(0|E,z);break;case"object":if("number"===typeof E.length)return t(E,z,0)}return[]}},13712:(E,t,z)=>{E.exports=function(){var E=this;this.components={},this.comps=this.components;var t=this.components,z=1,X={},R=[],u=[],p={timeout:!1,removals:[],multiComps:[]};function C(E,z){var A=t[z],R=X[z],u=R.hash[E];u&&(R.remove(E),A.mz&&(A.multi?(u.forEach((t=>{t&&A.mz(E,t)})),u.length=0):A.mz(E,u)),p.removals.push(R),Z())}function Z(){p.timeout||(p.timeout=!0,setTimeout(H,1))}function H(){p.timeout=!1,h()}function h(){p.multiComps.length&&function(E){for(var t=0;t<E.length;t++){var{entID:z,data:A}=E[t],X=A.hash[z];if(X){for(var R=0;R<X.length;R++)X[R]||(X.splice(R,1),R--);0===X.length&&(A.remove(z),p.removals.push(A))}}E.length=0}(p.multiComps),p.removals.length&&function(E){for(var t=0;t<E.length;t++){E[t].flush()}E.length=0}(p.removals)}this.ph=X,this._systems=R,this._renderSystems=u,this.vZ=function(t){var A=z++;return Array.isArray(t)&&t.forEach((t=>E.xC(A,t))),A},this.deleteEntity=function(t){return Object.keys(X).forEach((E=>{X[E].hash[t]&&C(t,E)})),E},this.HH=function(E){if(!E)throw new Error("Missing component definition");var z=E.name;if(!z)throw new Error("Component definition must have a name property.");if("string"!==typeof z)throw new Error("Component name must be a string.");if(""===z)throw new Error("Component name must be a non-empty string.");if(X[z])throw new Error(`Component ${z} already exists.`);var p={};return p.name=z,p.multi=!!E.multi,p.order=isNaN(E.order)?99:E.order,p.stateConstructor=E.stateConstructor||null,p.state=E.state||{},p.Fp=E.Fp||null,p.mz=E.mz||null,p.system=E.system||null,p.rp=E.rp||null,t[z]=p,X[z]=new A,X[z]._pendingMultiCleanup=!1,X[z]._multiCleanupIDs=p.multi?[]:null,p.system&&(R.push(z),R.sort(((E,z)=>t[E].order-t[z].order))),p.rp&&(u.push(z),u.sort(((E,z)=>t[E].order-t[z].order))),z},this.overwriteComponent=function(E,z){var A=t[E];if(!A)throw new Error(`Unknown component: ${E}`);if(!z)throw new Error("Missing component definition");if(A.name!==z.name)throw new Error("Overwriting component must use the same name property.");var p={};p.name=E,p.multi=!!z.multi,p.order=isNaN(z.order)?99:z.order,p.state=z.state||{},p.Fp=z.Fp||null,p.mz=z.mz||null,p.system=z.system||null,p.rp=z.rp||null,t[E]=p,X[E]._pendingMultiCleanup=!1,X[E]._multiCleanupIDs=p.multi?[]:null;var C=R.indexOf(E);p.system&&C<0&&R.push(E),!p.system&&C>=0&&R.splice(C,1),R.sort(((E,z)=>t[E].order-t[z].order));var Z=u.indexOf(E);p.rp&&Z<0&&u.push(E),!p.rp&&Z>=0&&u.splice(Z,1),u.sort(((E,z)=>t[E].order-t[z].order));var H=p.state;return this.bZ(E).forEach((E=>{for(var t in H)t in E||(E[t]=H[t]);p.Fp&&p.Fp(E.Jp,E)})),E},this.deleteComponent=function(z){var A=X[z];if(!A)throw new Error(`Unknown component: ${z}`);A.flush(),A.list.forEach((E=>{E&&C(E.Jp||E[0].Jp,z)}));var p=R.indexOf(z),Z=u.indexOf(z);return p>-1&&R.splice(p,1),Z>-1&&u.splice(Z,1),X[z].dispose(),delete X[z],delete t[z],E},this.xC=function(E,z,A){var R,u=t[z],p=X[z];if(!p)throw new Error(`Unknown component: ${z}.`);if(p.hash[E]&&!u.multi)throw new Error(`Entity ${E} already has component: ${z}.`);if(u.stateConstructor){if(!(R=new u.stateConstructor).hasOwnProperty("Jp"))throw new Error(`Component ${u.name} stateConstructor type does not have property __id`)}else R=Object.assign({},{Jp:E},u.state,A);if(R.Jp=E,u.multi){var C=p.hash[E];C||(C=[],p.add(E,C)),C.push(R)}else p.add(E,R);return u.Fp&&u.Fp(E,R),this},this.MC=function(E,t){var z=X[t];if(!z)throw new Error(`Unknown component: ${t}.`);return!!z.hash[E]},this.iC=function(t,z){if(!X[z])throw new Error(`Unknown component: ${z}.`);return C(t,z),E},this.getState=function(E,t){var z=X[t];if(!z)throw new Error(`Unknown component: ${t}.`);return z.hash[E]},this.bZ=function(E){var t=X[E];if(!t)throw new Error(`Unknown component: ${E}.`);return h(),t.list},this.vy=function(E){if(!X[E])throw new Error(`Unknown component: ${E}.`);var t=X[E].hash;return E=>t[E]},this.Ny=function(E){if(!X[E])throw new Error(`Unknown component: ${E}.`);var t=X[E].hash;return E=>!!t[E]},this.Pu=function(z){h();for(var A=0;A<R.length;A++){var u=R[A],p=t[u],C=X[u];p.system(z,C.list),h()}return E},this.render=function(z){h();for(var A=0;A<u.length;A++){var R=u[A],p=t[R],C=X[R];p.rp(z,C.list),h()}return E},this.removeMultiComponent=function(z,A,R){var u=t[A],C=X[A];if(!C)throw new Error(`Unknown component: ${A}.`);if(!u.multi)throw new Error("removeMultiComponent called on non-multi component");return function(E,t,z,A){var X=z.hash[E];if(X){var R=X[A];R&&(X[A]=null,t.mz&&t.mz(E,R),p.multiComps.push({entID:E,data:z}),Z())}}(z,u,C,R),E}};var A=z(13719)},13719:E=>{function t(E,t){var z=E._map[t];if(delete E.hash[t],delete E._map[t],z===E.list.length-1)E.list.pop();else{var A=E.list.pop();if(E.list[z]=A,null===A||null===A[0]){var X=E.list.length;for(var R in E._map)if(E._map[R]===X)return void(E._map[R]=z)}else{var u=A.Jp||A[0].Jp;E._map[u]=z}}}E.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(E,t){if("number"===typeof this._map[E]){var z=this._map[E];this.hash[E]=t,this.list[z]=t}else this._map[E]=this.list.length,this.hash[E]=t,this.list.push(t)}remove(E){var t=this._map[E];this.hash[E]=null,this.list[t]=null,this._pendingRemovals.push(E)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var E=0;E<this._pendingRemovals.length;E++){var z=this._pendingRemovals[E];null===this.hash[z]&&t(this,z)}this._pendingRemovals.length=0}}},13675:E=>{"use strict";var t,z="object"===typeof Reflect?Reflect:null,A=function(E,t,z){return Function.prototype.apply.call(E,t,z)};t=z&&"function"===typeof z.ownKeys?z.ownKeys:Object.getOwnPropertySymbols?function(E){return Object.getOwnPropertyNames(E).concat(Object.getOwnPropertySymbols(E))}:function(E){return Object.getOwnPropertyNames(E)};var X=Number.isNaN||function(E){return E!==E};function R(){R.init.call(this)}E.exports=R,E.exports.once=function(E,t){return new Promise((function(z,A){function X(z){E.removeListener(t,R),A(z)}function R(){"function"===typeof E.removeListener&&E.removeListener("error",X),z([].slice.call(arguments))}c(E,t,R,{once:!0}),"error"!==t&&function(E,t,z){"function"===typeof E.on&&c(E,"error",t,z)}(E,X,{once:!0})}))},R.EventEmitter=R,R.prototype._events=void 0,R.prototype._eventsCount=0,R.prototype._maxListeners=void 0;var u=10;function p(E){if("function"!==typeof E)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}function C(E){return void 0===E._maxListeners?R.defaultMaxListeners:E._maxListeners}function Z(E,t,z,A){var X,R,u,Z;if(p(z),void 0===(R=E._events)?(R=E._events=Object.create(null),E._eventsCount=0):(void 0!==R.newListener&&(E.emit("newListener",t,z.listener?z.listener:z),R=E._events),u=R[t]),void 0===u)u=R[t]=z,++E._eventsCount;else if("function"===typeof u?u=R[t]=A?[z,u]:[u,z]:A?u.unshift(z):u.push(z),(X=C(E))>0&&u.length>X&&!u.warned){u.warned=!0;var H=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");H.name="MaxListenersExceededWarning",H.Xt=E,H.type=t,H.count=u.length,Z=H,console&&console.warn&&console.warn(Z)}return E}function H(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(E,t,z){var A={fired:!1,wrapFn:void 0,target:E,type:t,listener:z},X=H.bind(A);return X.listener=z,A.wrapFn=X,X}function d(E,t,z){var A=E._events;if(void 0===A)return[];var X=A[t];return void 0===X?[]:"function"===typeof X?z?[X.listener||X]:[X]:z?function(E){for(var t=new Array(E.length),z=0;z<t.length;++z)t[z]=E[z].listener||E[z];return t}(X):O(X,X.length)}function y(E){var t=this._events;if(void 0!==t){var z=t[E];if("function"===typeof z)return 1;if(void 0!==z)return z.length}return 0}function O(E,t){for(var z=new Array(t),A=0;A<t;++A)z[A]=E[A];return z}function c(E,t,z,A){if("function"===typeof E.on)A.once?E.once(t,z):E.on(t,z);else{if("function"!==typeof E.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E);E.addEventListener(t,(function X(R){A.once&&E.removeEventListener(t,X),z(R)}))}}Object.defineProperty(R,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(E){if("number"!==typeof E||E<0||X(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");u=E}}),R.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},R.prototype.setMaxListeners=function(E){if("number"!==typeof E||E<0||X(E))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+E+".");return this._maxListeners=E,this},R.prototype.getMaxListeners=function(){return C(this)},R.prototype.emit=function(E){for(var t=[],z=1;z<arguments.length;z++)t.push(arguments[z]);var X="error"===E,R=this._events;if(void 0!==R)X=X&&void 0===R.error;else if(!X)return!1;if(X){var u;if(t.length>0&&(u=t[0]),u instanceof Error)throw u;var p=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw p.context=u,p}var C=R[E];if(void 0===C)return!1;if("function"===typeof C)A(C,this,t);else{var Z=C.length,H=O(C,Z);for(z=0;z<Z;++z)A(H[z],this,t)}return!0},R.prototype.addListener=function(E,t){return Z(this,E,t,!1)},R.prototype.on=R.prototype.addListener,R.prototype.prependListener=function(E,t){return Z(this,E,t,!0)},R.prototype.once=function(E,t){return p(t),this.on(E,h(this,E,t)),this},R.prototype.prependOnceListener=function(E,t){return p(t),this.prependListener(E,h(this,E,t)),this},R.prototype.removeListener=function(E,t){var z,A,X,R,u;if(p(t),void 0===(A=this._events))return this;if(void 0===(z=A[E]))return this;if(z===t||z.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete A[E],A.removeListener&&this.emit("removeListener",E,z.listener||t));else if("function"!==typeof z){for(X=-1,R=z.length-1;R>=0;R--)if(z[R]===t||z[R].listener===t){u=z[R].listener,X=R;break}if(X<0)return this;0===X?z.shift():function(E,t){for(;t+1<E.length;t++)E[t]=E[t+1];E.pop()}(z,X),1===z.length&&(A[E]=z[0]),void 0!==A.removeListener&&this.emit("removeListener",E,u||t)}return this},R.prototype.off=R.prototype.removeListener,R.prototype.Rt=function(E){var t,z,A;if(void 0===(z=this._events))return this;if(void 0===z.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==z[E]&&(0===--this._eventsCount?this._events=Object.create(null):delete z[E]),this;if(0===arguments.length){var X,R=Object.keys(z);for(A=0;A<R.length;++A)"removeListener"!==(X=R[A])&&this.Rt(X);return this.Rt("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=z[E]))this.removeListener(E,t);else if(void 0!==t)for(A=t.length-1;A>=0;A--)this.removeListener(E,t[A]);return this},R.prototype.listeners=function(E){return d(this,E,!0)},R.prototype.rawListeners=function(E){return d(this,E,!1)},R.listenerCount=function(E,t){return"function"===typeof E.listenerCount?E.listenerCount(t):y.call(E,t)},R.prototype.listenerCount=y,R.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},13960:E=>{"use strict";E.exports=function(E,t,z,A,X,R){var u=+t[0],p=+t[1],C=+t[2],Z=+z[0],H=+z[1],h=+z[2],d=Math.sqrt(Z*Z+H*H+h*h);if(0===d)throw new Error("Can't raycast along a zero vector");return function(E,t,z,A,X,R,u,p,C,Z){for(var H=0,h=Math.floor,d=0|h(t),y=0|h(z),O=0|h(A),c=X>0?1:-1,a=R>0?1:-1,L=u>0?1:-1,mE=Math.abs(1/X),W=Math.abs(1/R),I=Math.abs(1/u),e=mE<1/0?mE*(c>0?d+1-t:t-d):1/0,D=W<1/0?W*(a>0?y+1-z:z-y):1/0,S=I<1/0?I*(L>0?O+1-A:A-O):1/0,l=-1;H<=p;){var f=E(d,y,O);if(f)return C&&(C[0]=t+H*X,C[1]=z+H*R,C[2]=A+H*u),Z&&(Z[0]=Z[1]=Z[2]=0,0===l&&(Z[0]=-c),1===l&&(Z[1]=-a),2===l&&(Z[2]=-L)),f;e<D?e<S?(d+=c,H=e,e+=mE,l=0):(O+=L,H=S,S+=I,l=2):D<S?(y+=a,H=D,D+=W,l=1):(O+=L,H=S,S+=I,l=2)}return C&&(C[0]=t+H*X,C[1]=z+H*R,C[2]=A+H*u),Z&&(Z[0]=Z[1]=Z[2]=0),0}(E,u,p,C,Z/=d,H/=d,h/=d,A="undefined"===typeof A?64:+A,X,R)}},13988:(E,t,z)=>{"use strict";z.d(t,{b:()=>R});var A=z(13675);function X(){this.gd=!1,this.stopPropagation=!1,this.od=!1,this.disabled=!1}class R{constructor(E,t){this.version="0.7.0";var z=Object.assign({},new X,t||{});this.element=E||document,this.gd=!!z.gd,this.stopPropagation=!!z.stopPropagation,this.od=!!z.od,this.disabled=!!z.disabled,this.filterEvents=(E,t)=>!0,this.down=new A.EventEmitter,this.up=new A.EventEmitter,this.state={},this.SZ={dx:0,dy:0,Qy:0,DZ:0,Ty:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?p(this):document.addEventListener("DOMContentLoaded",(E=>{p(this)}),{once:!0})}bind(E){for(var t=arguments.length,z=new Array(t>1?t-1:0),A=1;A<t;A++)z[A-1]=arguments[A];z.forEach((t=>{var z=this._keyBindmap[t]||[];z.includes(E)||(z.push(E),this._keyBindmap[t]=z)})),this.state[E]=!!this.state[E],this.pressCount[E]=this.pressCount[E]||0,this.releaseCount[E]=this.releaseCount[E]||0}unbind(E){for(var t in this._keyBindmap){var z=this._keyBindmap[t],A=z.indexOf(E);A>-1&&z.splice(A,1)}}getBindings(){var E={};for(var t in this._keyBindmap){this._keyBindmap[t].forEach((z=>{E[z]=E[z]||[],E[z].push(t)}))}return E}Pu(){u(this.SZ),u(this.pressCount),u(this.releaseCount)}}function u(E){for(var t in E)E[t]=0}function p(E){window.addEventListener("keydown",O.bind(null,E,!0),!1),window.addEventListener("keyup",O.bind(null,E,!1),!1);var t={passive:!0};E.element.addEventListener("touchstart",h.bind(void 0,E),{passive:!1}),E.element.addEventListener("touchend",y.bind(void 0,E),t),E.element.addEventListener("mousedown",c.bind(null,E,!0),t),window.document.addEventListener("mouseup",c.bind(null,E,!1),t),E.element.addEventListener("touchmove",a.bind(null,E),t),E.element.addEventListener("mousemove",a.bind(null,E),t),window.PointerEvent,E.element.addEventListener("wheel",L.bind(null,E),t),E.element.addEventListener("contextmenu",mE.bind(null,E),!1),window.addEventListener("blur",W.bind(null,E),!1)}var C=0,Z=0,H=null;function h(E,t){t.preventDefault(),d(t)}function d(E){let t=!1;for(let z=0;z<E.touches.length;++z)if(E.touches[z].identifier===H){t=!0;break}if(!t){const t=E.changedTouches[0];C=t.clientX,Z=t.clientY,H=t.identifier}}function y(E,t){for(var z=t.changedTouches,A=0;A<z.length;++A)z[A].identifier===H&&(H=null)}function O(E,t,z){I(z.code,t,E,z)}function c(E,t,z){if("pointerId"in z)if(t){if(null!==E._touches.currID)return;E._touches.currID=z.pointerId}else{if(E._touches.currID!==z.pointerId)return;E._touches.currID=null}return I("Mouse"+("button"in z?z.button+1:1),t,E,z),!1}function a(E,t){var z=t.movementX||t.mozMovementX||0,A=t.movementY||t.mozMovementY||0;if(t.touches&&0===(z|A)){var X=function(E){d(E);for(let t=0;t<E.changedTouches.length;++t)if(E.changedTouches[t].identifier==H){const z=E.changedTouches[t],A=[z.clientX-C,z.clientY-Z];return C=z.clientX,Z=z.clientY,A}return console.error(`Did not find touch id ${H}`),[0,0]}(t);z=X[0],A=X[1]}E.SZ.dx+=z,E.SZ.dy+=A}function L(E,t){var z=1;switch(t.deltaMode){case 0:z=1;break;case 1:z=12;break;case 2:z=E.element.clientHeight||window.innerHeight}E.SZ.Qy+=(t.deltaX||0)*z,E.SZ.DZ+=(t.deltaY||0)*z,E.SZ.Ty+=(t.deltaZ||0)*z}function mE(E,t){if(!E.od)return t.preventDefault(),!1}function W(E){for(var t in E._keyStates)E._keyStates[t]&&(/^Mouse\d/.test(t)||I(t,!1,E,{code:t,note:"sjly86vqdw",preventDefault:()=>{},stopPropagation:()=>{}}))}function I(E,t,z,A){var X=z._keyBindmap[E];X&&(e(z._keyStates[E],t)&&(z._keyStates[E]=t,X.forEach((E=>{(!z.filterEvents||z.filterEvents(A,E))&&function(E,t,z,A){var X=t?z.pressCount:z.releaseCount;X[E]=(X[E]||0)+1;var R=z._bindPressCount[E]||0;(R+=t?1:-1)<0&&(R=0);z._bindPressCount[E]=R;var u=z.state[E];if(e(u,R)){z.state[E]=R>0;var p=t?z.down:z.up;z.disabled||p.emit(E,A)}}(E,t,z,A)}))),"button"in A||(z.gd&&!A.defaultPrevented&&A.preventDefault(),z.stopPropagation&&A.stopPropagation()))}function e(E,t){return E?!t:t}},12691:E=>{E.exports=function(E,t,z){return E[0]=t[0]+z[0],E[1]=t[1]+z[1],E[2]=t[2]+z[2],E}},12639:(E,t,z)=>{E.exports=function(E,t){var z=A(E[0],E[1],E[2]),u=A(t[0],t[1],t[2]);X(z,z),X(u,u);var p=R(z,u);return p>1?0:Math.acos(p)};var A=z(12643),X=z(12652),R=z(12659)},12746:E=>{E.exports=function(E,t){return E[0]=Math.ceil(t[0]),E[1]=Math.ceil(t[1]),E[2]=Math.ceil(t[2]),E}},12635:E=>{E.exports=function(E){var t=new Float32Array(3);return t[0]=E[0],t[1]=E[1],t[2]=E[2],t}},12662:E=>{E.exports=function(E,t){return E[0]=t[0],E[1]=t[1],E[2]=t[2],E}},12626:E=>{E.exports=function(){var E=new Float32Array(3);return E[0]=0,E[1]=0,E[2]=0,E}},12816:E=>{E.exports=function(E,t,z){var A=t[0],X=t[1],R=t[2],u=z[0],p=z[1],C=z[2];return E[0]=X*C-R*p,E[1]=R*u-A*C,E[2]=A*p-X*u,E}},12765:(E,t,z)=>{E.exports=z(12762)},12762:E=>{E.exports=function(E,t){var z=t[0]-E[0],A=t[1]-E[1],X=t[2]-E[2];return Math.sqrt(z*z+A*A+X*X)}},12727:(E,t,z)=>{E.exports=z(12724)},12724:E=>{E.exports=function(E,t,z){return E[0]=t[0]/z[0],E[1]=t[1]/z[1],E[2]=t[2]/z[2],E}},12659:E=>{E.exports=function(E,t){return E[0]*t[0]+E[1]*t[1]+E[2]*t[2]}},12623:E=>{E.exports=1e-6},12679:(E,t,z)=>{E.exports=function(E,t){var z=E[0],X=E[1],R=E[2],u=t[0],p=t[1],C=t[2];return Math.abs(z-u)<=A*Math.max(1,Math.abs(z),Math.abs(u))&&Math.abs(X-p)<=A*Math.max(1,Math.abs(X),Math.abs(p))&&Math.abs(R-C)<=A*Math.max(1,Math.abs(R),Math.abs(C))};var A=z(12623)},12687:E=>{E.exports=function(E,t){return E[0]===t[0]&&E[1]===t[1]&&E[2]===t[2]}},12741:E=>{E.exports=function(E,t){return E[0]=Math.floor(t[0]),E[1]=Math.floor(t[1]),E[2]=Math.floor(t[2]),E}},12863:(E,t,z)=>{E.exports=function(E,t,z,X,R,u){var p,C;t||(t=3);z||(z=0);C=X?Math.min(X*t+z,E.length):E.length;for(p=z;p<C;p+=t)A[0]=E[p],A[1]=E[p+1],A[2]=E[p+2],R(A,A,u),E[p]=A[0],E[p+1]=A[1],E[p+2]=A[2];return E};var A=z(12626)()},12643:E=>{E.exports=function(E,t,z){var A=new Float32Array(3);return A[0]=E,A[1]=t,A[2]=z,A}},12616:(E,t,z)=>{E.exports={EPSILON:z(12623),create:z(12626),clone:z(12635),angle:z(12639),nu:z(12643),k:z(12662),set:z(12670),equals:z(12679),exactEquals:z(12687),add:z(12691),Wt:z(12695),sub:z(12703),multiply:z(12709),mul:z(12717),divide:z(12724),div:z(12727),min:z(12729),max:z(12735),floor:z(12741),ceil:z(12746),round:z(12749),scale:z(12752),su:z(12760),distance:z(12762),i:z(12765),squaredDistance:z(12773),sqrDist:z(12776),length:z(12781),len:z(12785),squaredLength:z(12794),ju:z(12801),negate:z(12806),inverse:z(12812),normalize:z(12652),dot:z(12659),cross:z(12816),qu:z(12824),random:z(12831),transformMat4:z(12833),transformMat3:z(12836),transformQuat:z(12839),Uu:z(12847),ku:z(12850),vu:z(12859),forEach:z(12863)}},12812:E=>{E.exports=function(E,t){return E[0]=1/t[0],E[1]=1/t[1],E[2]=1/t[2],E}},12785:(E,t,z)=>{E.exports=z(12781)},12781:E=>{E.exports=function(E){var t=E[0],z=E[1],A=E[2];return Math.sqrt(t*t+z*z+A*A)}},12824:E=>{E.exports=function(E,t,z,A){var X=t[0],R=t[1],u=t[2];return E[0]=X+A*(z[0]-X),E[1]=R+A*(z[1]-R),E[2]=u+A*(z[2]-u),E}},12735:E=>{E.exports=function(E,t,z){return E[0]=Math.max(t[0],z[0]),E[1]=Math.max(t[1],z[1]),E[2]=Math.max(t[2],z[2]),E}},12729:E=>{E.exports=function(E,t,z){return E[0]=Math.min(t[0],z[0]),E[1]=Math.min(t[1],z[1]),E[2]=Math.min(t[2],z[2]),E}},12717:(E,t,z)=>{E.exports=z(12709)},12709:E=>{E.exports=function(E,t,z){return E[0]=t[0]*z[0],E[1]=t[1]*z[1],E[2]=t[2]*z[2],E}},12806:E=>{E.exports=function(E,t){return E[0]=-t[0],E[1]=-t[1],E[2]=-t[2],E}},12652:E=>{E.exports=function(E,t){var z=t[0],A=t[1],X=t[2],R=z*z+A*A+X*X;R>0&&(R=1/Math.sqrt(R),E[0]=t[0]*R,E[1]=t[1]*R,E[2]=t[2]*R);return E}},12831:E=>{E.exports=function(E,t){t=t||1;var z=2*Math.random()*Math.PI,A=2*Math.random()-1,X=Math.sqrt(1-A*A)*t;return E[0]=Math.cos(z)*X,E[1]=Math.sin(z)*X,E[2]=A*t,E}},12847:E=>{E.exports=function(E,t,z,A){var X=z[1],R=z[2],u=t[1]-X,p=t[2]-R,C=Math.sin(A),Z=Math.cos(A);return E[0]=t[0],E[1]=X+u*Z-p*C,E[2]=R+u*C+p*Z,E}},12850:E=>{E.exports=function(E,t,z,A){var X=z[0],R=z[2],u=t[0]-X,p=t[2]-R,C=Math.sin(A),Z=Math.cos(A);return E[0]=X+p*C+u*Z,E[1]=t[1],E[2]=R+p*Z-u*C,E}},12859:E=>{E.exports=function(E,t,z,A){var X=z[0],R=z[1],u=t[0]-X,p=t[1]-R,C=Math.sin(A),Z=Math.cos(A);return E[0]=X+u*Z-p*C,E[1]=R+u*C+p*Z,E[2]=t[2],E}},12749:E=>{E.exports=function(E,t){return E[0]=Math.round(t[0]),E[1]=Math.round(t[1]),E[2]=Math.round(t[2]),E}},12752:E=>{E.exports=function(E,t,z){return E[0]=t[0]*z,E[1]=t[1]*z,E[2]=t[2]*z,E}},12760:E=>{E.exports=function(E,t,z,A){return E[0]=t[0]+z[0]*A,E[1]=t[1]+z[1]*A,E[2]=t[2]+z[2]*A,E}},12670:E=>{E.exports=function(E,t,z,A){return E[0]=t,E[1]=z,E[2]=A,E}},12776:(E,t,z)=>{E.exports=z(12773)},12801:(E,t,z)=>{E.exports=z(12794)},12773:E=>{E.exports=function(E,t){var z=t[0]-E[0],A=t[1]-E[1],X=t[2]-E[2];return z*z+A*A+X*X}},12794:E=>{E.exports=function(E){var t=E[0],z=E[1],A=E[2];return t*t+z*z+A*A}},12703:(E,t,z)=>{E.exports=z(12695)},12695:E=>{E.exports=function(E,t,z){return E[0]=t[0]-z[0],E[1]=t[1]-z[1],E[2]=t[2]-z[2],E}},12836:E=>{E.exports=function(E,t,z){var A=t[0],X=t[1],R=t[2];return E[0]=A*z[0]+X*z[3]+R*z[6],E[1]=A*z[1]+X*z[4]+R*z[7],E[2]=A*z[2]+X*z[5]+R*z[8],E}},12833:E=>{E.exports=function(E,t,z){var A=t[0],X=t[1],R=t[2],u=z[3]*A+z[7]*X+z[11]*R+z[15];return u=u||1,E[0]=(z[0]*A+z[4]*X+z[8]*R+z[12])/u,E[1]=(z[1]*A+z[5]*X+z[9]*R+z[13])/u,E[2]=(z[2]*A+z[6]*X+z[10]*R+z[14])/u,E}},12839:E=>{E.exports=function(E,t,z){var A=t[0],X=t[1],R=t[2],u=z[0],p=z[1],C=z[2],Z=z[3],H=Z*A+p*R-C*X,h=Z*X+C*A-u*R,d=Z*R+u*X-p*A,y=-u*A-p*X-C*R;return E[0]=H*Z+y*-u+h*-C-d*-p,E[1]=h*Z+y*-p+d*-u-H*-C,E[2]=d*Z+y*-C+H*-p-h*-u,E}},13696:E=>{"use strict";E.exports=function(E){for(var t=new Array(E),z=0;z<E;++z)t[z]=z;return t}},13763:E=>{E.exports=function(E){return null!=E&&null!=E.constructor&&"function"===typeof E.constructor.isBuffer&&E.constructor.isBuffer(E)}},13968:(E,t,z)=>{"use strict";z.d(t,{d:()=>A});class A{constructor(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.xH=!1,this.JH=!1,this.BH=30,this.bH=0,this.qH=!1,this.fullscreen=!1,this.rH=function(E){},this.iH=function(){},this.QH=function(){},this.lt=function(){},this.gH=function(E){},this.onFullscreenChanged=function(E){},Z((()=>{!function(E,t){E._nowObject=performance||Date,E._lastTick=0,E._renderAccum=0,E._rt=0,E._frameCB=p.bind(null,E),requestAnimationFrame(E._frameCB),t>0&&(E._intervalCB=u.bind(null,E),E._interval=setInterval(E._intervalCB,Math.max(t,1e3/E.BH/2)))}(this,t),function(E,t){if(!t)return;var z=!1,A=!1;document.addEventListener("pointerlockchange",(A=>{z=document.pointerLockElement===t,E.gH(z)})),document.addEventListener("fullscreenchange",(z=>{A=document.fullscreenElement===t,E.onFullscreenChanged(A)})),Object.defineProperty(E,"qH",{get:()=>z,set:E=>{E&&!z?C(t):z&&!E&&function(E){E.exitPointerLock&&E.exitPointerLock()}(document)}}),Object.defineProperty(E,"fullscreen",{get:()=>A,set:E=>{E&&!A?t.requestFullscreen():A&&!E&&document.exitFullscreen()}}),t.addEventListener("click",(X=>{E.xH&&!z&&C(t),E.JH&&!A&&t.requestFullscreen()}));var X=()=>E.lt();if(window.ResizeObserver){new ResizeObserver(X).observe(t)}else window.addEventListener("resize",X)}(this,E),this.QH()}))}}var X=3,R=20;function u(E){for(var t=1e3/E.BH,z=E._nowObject.now()+R,A=0;E._nowObject.now()>=E._lastTick+t&&E._nowObject.now()<z&&++A<=X;)E.rH(t),E._lastTick+=t;var u=5*(t+5),p=E._nowObject.now();if(p-E._lastTick>u)for(;p>=E._lastTick+t;)E._lastTick+=t}function p(E){requestAnimationFrame(E._frameCB),u(E);var t=E._nowObject.now(),z=t-E._rt;if(E._rt=t,E.bH>0){E._renderAccum+=z;var A=1e3/E.bH;if(E._renderAccum<A)return;E._renderAccum=Math.min(E._renderAccum-A,A)}var X=1e3/E.BH,R=(t-E._lastTick)/X;E.iH(z,R,X)}function C(E){E.requestPointerLock&&E.requestPointerLock()}var Z=E=>{if("loading"===document.readyState){var t=()=>{document.removeEventListener("readystatechange",t),E()};document.addEventListener("readystatechange",t)}else setTimeout(E,1)}},13691:(E,t,z)=>{var A=z(13696),X=z(13705),R="undefined"!==typeof Float64Array;function u(E,t){return E[0]-t[0]}function p(){var E,t=this.stride,z=new Array(t.length);for(E=0;E<z.length;++E)z[E]=[Math.abs(t[E]),E];z.sort(u);var A=new Array(z.length);for(E=0;E<A.length;++E)A[E]=z[E][1];return A}function C(E,t){var z=["View",t,"d",E].join("");t<0&&(z="View_Nil"+E);var X="generic"===E;if(-1===t){var R="function "+z+"(a){this.data=a;};var proto="+z+".prototype;proto.dtype='"+E+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+z+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+z+"(a){return new "+z+"(a);}";return new Function(R)()}if(0===t){R="function "+z+"(a,d) {this.data = a;this.offset = d};var proto="+z+".prototype;proto.dtype='"+E+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+z+"_copy() {return new "+z+"(this.data,this.offset)};proto.pick=function "+z+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+z+"_get(){return "+(X?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+z+"_set(v){return "+(X?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+z+"(a,b,c,d){return new "+z+"(a,d)}";return new Function("TrivialArray",R)(Z[E][0])}R=["'use strict'"];var u=A(t),C=u.map((function(E){return"i"+E})),H="this.offset+"+u.map((function(E){return"this.stride["+E+"]*i"+E})).join("+"),h=u.map((function(E){return"b"+E})).join(","),d=u.map((function(E){return"c"+E})).join(",");R.push("function "+z+"(a,"+h+","+d+",d){this.data=a","this.shape=["+h+"]","this.stride=["+d+"]","this.offset=d|0}","var proto="+z+".prototype","proto.dtype='"+E+"'","proto.dimension="+t),R.push("Object.defineProperty(proto,'size',{get:function "+z+"_size(){return "+u.map((function(E){return"this.shape["+E+"]"})).join("*"),"}})"),1===t?R.push("proto.order=[0]"):(R.push("Object.defineProperty(proto,'order',{get:"),t<4?(R.push("function "+z+"_order(){"),2===t?R.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&R.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):R.push("ORDER})")),R.push("proto.set=function "+z+"_set("+C.join(",")+",v){"),X?R.push("return this.data.set("+H+",v)}"):R.push("return this.data["+H+"]=v}"),R.push("proto.get=function "+z+"_get("+C.join(",")+"){"),X?R.push("return this.data.get("+H+")}"):R.push("return this.data["+H+"]}"),R.push("proto.index=function "+z+"_index(",C.join(),"){return "+H+"}"),R.push("proto.hi=function "+z+"_hi("+C.join(",")+"){return new "+z+"(this.data,"+u.map((function(E){return["(typeof i",E,"!=='number'||i",E,"<0)?this.shape[",E,"]:i",E,"|0"].join("")})).join(",")+","+u.map((function(E){return"this.stride["+E+"]"})).join(",")+",this.offset)}");var y=u.map((function(E){return"a"+E+"=this.shape["+E+"]"})),O=u.map((function(E){return"c"+E+"=this.stride["+E+"]"}));R.push("proto.lo=function "+z+"_lo("+C.join(",")+"){var b=this.offset,d=0,"+y.join(",")+","+O.join(","));for(var c=0;c<t;++c)R.push("if(typeof i"+c+"==='number'&&i"+c+">=0){d=i"+c+"|0;b+=c"+c+"*d;a"+c+"-=d}");R.push("return new "+z+"(this.data,"+u.map((function(E){return"a"+E})).join(",")+","+u.map((function(E){return"c"+E})).join(",")+",b)}"),R.push("proto.step=function "+z+"_step("+C.join(",")+"){var "+u.map((function(E){return"a"+E+"=this.shape["+E+"]"})).join(",")+","+u.map((function(E){return"b"+E+"=this.stride["+E+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(c=0;c<t;++c)R.push("if(typeof i"+c+"==='number'){d=i"+c+"|0;if(d<0){c+=b"+c+"*(a"+c+"-1);a"+c+"=ceil(-a"+c+"/d)}else{a"+c+"=ceil(a"+c+"/d)}b"+c+"*=d}");R.push("return new "+z+"(this.data,"+u.map((function(E){return"a"+E})).join(",")+","+u.map((function(E){return"b"+E})).join(",")+",c)}");var a=new Array(t),L=new Array(t);for(c=0;c<t;++c)a[c]="a[i"+c+"]",L[c]="b[i"+c+"]";R.push("proto.transpose=function "+z+"_transpose("+C+"){"+C.map((function(E,t){return E+"=("+E+"===undefined?"+t+":"+E+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+z+"(this.data,"+a.join(",")+","+L.join(",")+",this.offset)}"),R.push("proto.pick=function "+z+"_pick("+C+"){var a=[],b=[],c=this.offset");for(c=0;c<t;++c)R.push("if(typeof i"+c+"==='number'&&i"+c+">=0){c=(c+this.stride["+c+"]*i"+c+")|0}else{a.push(this.shape["+c+"]);b.push(this.stride["+c+"])}");return R.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),R.push("return function construct_"+z+"(data,shape,stride,offset){return new "+z+"(data,"+u.map((function(E){return"shape["+E+"]"})).join(",")+","+u.map((function(E){return"stride["+E+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",R.join("\n"))(Z[E],p)}var Z={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};E.exports=function(E,t,z,A){if(void 0===E)return(0,Z.array[0])([]);"number"===typeof E&&(E=[E]),void 0===t&&(t=[E.length]);var u=t.length;if(void 0===z){z=new Array(u);for(var p=u-1,H=1;p>=0;--p)z[p]=H,H*=t[p]}if(void 0===A){A=0;for(p=0;p<u;++p)z[p]<0&&(A-=(t[p]-1)*z[p])}for(var h=function(E){if(X(E))return"buffer";if(R)switch(Object.prototype.toString.call(E)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(E)?"array":"generic"}(E),d=Z[h];d.length<=u+1;)d.push(C(h,d.length-1));return(0,d[u+1])(E,t,z,A)}},13705:E=>{function t(E){return!!E.constructor&&"function"===typeof E.constructor.isBuffer&&E.constructor.isBuffer(E)}E.exports=function(E){return null!=E&&(t(E)||function(E){return"function"===typeof E.readFloatLE&&"function"===typeof E.slice&&t(E.slice(0,0))}(E)||!!E._isBuffer)}},13840:E=>{"use strict";var t=[],z=[],A=[],X=[],R=[],u=[],p=[],C=[],Z=[],H=[],h=[],d=[];E.exports=function(E,y,O,c,a,L){for(var mE=p,W=Z,I=H,e=d,D=0;D<3;D++)mE[D]=+O[D],I[D]=+y.max[D],W[D]=+y.base[D];L||(L=1e-10);var S=function(E,p,Z,H,d,y){var O=t,c=z,a=A,L=X,mE=R,W=u,I=C,e=Math.floor,D=0,S=0,l=0,f=0,K=0;if(F(),0===l)return 0;for(f=x();S<=l;){if(B(f)&&b())return D;f=x()}for(D+=l,K=0;K<3;K++)H[K]+=Z[K],d[K]+=Z[K];return D;function F(){if(S=0,0!==(l=Math.sqrt(Z[0]*Z[0]+Z[1]*Z[1]+Z[2]*Z[2])))for(var E=0;E<3;E++){var t=Z[E]>=0;L[E]=t?1:-1;var z=t?d[E]:H[E];O[E]=t?H[E]:d[E],c[E]=J(z,L[E]),a[E]=V(O[E],L[E]),I[E]=Z[E]/l,mE[E]=Math.abs(1/I[E]);var A=t?c[E]+1-z:z-c[E];W[E]=mE[E]<1/0?mE[E]*A:1/0}}function B(t){for(var z=L[0],A=0===t?c[0]:a[0],X=c[0]+z,R=L[1],u=1===t?c[1]:a[1],p=c[1]+R,C=L[2],Z=2===t?c[2]:a[2],H=c[2]+C,h=A;h!=X;h+=z)for(var d=u;d!=p;d+=R)for(var y=Z;y!=H;y+=C)if(E(h,d,y))return!0;return!1}function b(){D+=S;var E=L[f],t=S/l,z=h;for(K=0;K<3;K++){var A=Z[K]*t;H[K]+=A,d[K]+=A,z[K]=Z[K]-A}if(E>0?d[f]=Math.round(d[f]):H[f]=Math.round(H[f]),p(D,f,E,z))return!0;for(K=0;K<3;K++)Z[K]=z[K];return F(),0===l}function x(){var E=W[0]<W[1]?W[0]<W[2]?0:2:W[1]<W[2]?1:2,t=W[E]-S;for(S=W[E],c[E]+=L[E],W[E]+=mE[E],K=0;K<3;K++)O[K]+=t*I[K],a[K]=V(O[K],L[K]);return E}function J(E,t){return e(E-t*y)}function V(E,t){return e(E+t*y)}}(E,c,mE,W,I,L);if(!a){for(D=0;D<3;D++)e[D]=O[D]>0?I[D]-y.max[D]:W[D]-y.base[D];y.translate(e)}return S}},13992:(E,t,z)=>{"use strict";z.d(t,{d:()=>h});var A=z(13834),X=z(12616);class R{constructor(E,t,z,R,u,p,C){this.BZ=new A(E.base,E.jZ),this.hA=t,this.friction=z,this.restitution=R,this.Vu=u,this.uO=p,this.ru=!!C,this.sZ=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.kO=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.AZ=X.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=X.create(),this._impulses=X.create(),this._sleepFrameCount=10}loadFromCopy(E){X.k(this.BZ.base,E.BZ.base),X.k(this.BZ.jZ,E.BZ.jZ),X.k(this.BZ.max,E.BZ.max),this.BZ.mag=E.BZ.mag,this.hA=E.hA,this.friction=E.friction,this.restitution=E.restitution,this.Vu=E.Vu,this.uO=E.uO,this.ru=E.ru,this.sZ=E.sZ,this.fluidDrag=E.fluidDrag,this.kO=E.kO,this.preventFallOffEdge=E.preventFallOffEdge,this.rolledBackLastTick=E.rolledBackLastTick,X.k(this.AZ,E.AZ),X.k(this.resting,E.resting),this.inFluid=E.inFluid,this._ratioInFluid=E._ratioInFluid,X.k(this._forces,E._forces),X.k(this._impulses,E._impulses),this._sleepFrameCount=E._sleepFrameCount}setPosition(E){u(E),X.Wt(E,E,this.BZ.base),this.BZ.translate(E),this.uZ()}gt(){return X.clone(this.BZ.base)}applyForce(E){u(E),X.add(this._forces,this._forces,E),this.uZ()}applyImpulse(E){u(E),X.add(this._impulses,this._impulses,E),this.uZ()}uZ(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var u=E=>{};var p=z(13834),C=z(12616),Z=z(13840);function H(){this.sZ=.1,this.fluidDrag=.4,this.Tu=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function h(E,t,z){E=Object.assign(new H,E),this.gravity=E.gravity||[0,-10,0],this.sZ=E.sZ||.1,this.Tu=E.Tu||2,this.fluidDrag=E.fluidDrag||.4,this.minBounceImpulse=E.minBounceImpulse,this.bodies=[],this.Ky=E.Ky,this.testSolid=t,this.testFluid=z}h.prototype.yO=function(E,t,z,A,X,u){E=E||new p([0,0,0],[1,1,1]),"undefined"==typeof t&&(t=1),"undefined"==typeof z&&(z=1),"undefined"==typeof A&&(A=0),"undefined"==typeof X&&(X=1);var C=new R(E,t,z,A,X,u);return this.bodies.push(C),C},h.prototype.OO=function(E){var t=this.bodies.indexOf(E);t<0||(this.bodies.splice(t,1),E.BZ=E.uO=null)};var d=C.create(),y=C.create(),O=C.create(),c=C.create(),a=C.create(),L=C.create(),mE=C.create(),W=new p([0,0,0],[1,1,1]),I=new R(W,1,1,0,1,(()=>{}),!1);function e(E,t,z){return t=z,t*=1-(1-E.ratioInFluid)**2}h.prototype.Pu=function(E){E/=1e3;var t=Q(0,C.squaredLength(this.gravity));this.bodies.forEach((z=>function(E,t,z,A){C.k(a,t.resting),E.Ky&&I.loadFromCopy(t);if(t.hA<=0)return C.set(t.AZ,0,0,0),C.set(t._forces,0,0,0),void C.set(t._impulses,0,0,0);var X=A||0===t.Vu;if(function(E,t,z,A){if(t._sleepFrameCount>0)return!1;if(A)return!0;var X=!1,R=.5*z*z*t.Vu;return C.scale(o,E.gravity,R),Z(E.testSolid,t.BZ,o,(function(){return X=!0,!0}),!0),X}(E,t,z,X))return;t._sleepFrameCount--,function(E,t){var z=t.BZ,A=Math.floor(z.base[0]),X=Math.floor(z.base[2]),R=Math.floor(z.base[1]),u=Math.floor(z.max[1]);if(!E.testFluid(A,R,X))return t.inFluid=!1,void(t.ratioInFluid=0);var p=1,Z=R+1;for(;Z<=u&&E.testFluid(A,Z,X);)p++,Z++;var H=(R+p-z.base[1])/z.jZ[1];H>1&&(H=1);var h=z.jZ[0]*z.jZ[1]*z.jZ[2]*H,d=S;C.scale(d,E.gravity,-E.Tu*h*t.Vu),t.applyForce(d),t.inFluid=!0,t.ratioInFluid=H}(E,t),q(t._forces),q(t._impulses),q(t.AZ),q(t.resting),C.scale(d,t._forces,1/t.hA),C.su(d,d,E.gravity,t.Vu),C.scale(y,t._impulses,1/t.hA),C.su(y,y,d,z),C.add(t.AZ,t.AZ,y),t.friction&&(l(E,0,t,y,z),l(E,1,t,y,z),l(E,2,t,y,z));var R=t.fluidDrag>=0?t.fluidDrag:E.fluidDrag,u=t.sZ>=0?t.sZ:E.sZ,p=u,H=u;t.inFluid&&(p=e(t,p,t.fluidDragHoriz>=0?t.fluidDragHoriz:R),H=e(t,H,t.fluidDragVert>=0?t.fluidDragVert:R));p=Math.max(1-p*z/t.hA,0),H=Math.max(1-H*z/t.hA,0),C.set(D,p,H,p),C.multiply(t.AZ,t.AZ,D),C.scale(O,t.AZ,z),C.set(t._forces,0,0,0),C.set(t._impulses,0,0,0),t.ru&&T(F,t.BZ);C.k(L,O),C.set(mE,0,0,0),t.preventFallOffEdge&&function(E,t,z,A){if(!t.resting[1]||z[1]>0)return;var X=r;T(X,t.BZ);for(var R=0;R<3;R+=2){C.set(V,0,0,0),V[R]=z[R];var u=!0;(u=(u=(u=(u=u&&!g(E,X.base[0]+V[0]+1e-5,X.base[1],X.base[2]+V[2]+1e-5))&&!g(E,X.max[0]+V[0]-1e-5,X.base[1],X.base[2]+V[2]+1e-5))&&!g(E,X.base[0]+V[0]+1e-5,X.base[1],X.max[2]+V[2]-1e-5))&&!g(E,X.max[0]+V[0]-1e-5,X.base[1],X.max[2]+V[2]-1e-5))?(A[R]=z[R]>0?1:-1,z[R]=0):0===R&&(C.set(i,z[0],0,0),K(E,X,i,A,t.slideOnCollision))}}(E,t,O,mE);K(E,t.BZ,O,t.resting,t.slideOnCollision),t.ru&&function(E,t,z,A){if(t.resting[1]>=0&&!t.inFluid)return;var X=0!==t.resting[0],R=0!==t.resting[2];if(!X&&!R)return;var u=Math.abs(A[0]/A[2]),p=4;if(!X&&u>p)return;if(!R&&u<1/p)return;C.add(b,z.base,A);var H=E.testSolid;Z(H,z,A,(function(E,t,z,A){if(1!==t)return!0;A[t]=0}));var h=z.base[1],d=t.inFluid?1.951:1.001,y=Math.floor(h+d)-h;C.set(x,0,y,0);var O=!1;if(Z(H,z,x,(function(E,t,z,A){return O=!0,!0})),O)return;C.Wt(J,b,z.base),J[1]=0,K(E,z,J,B,!0);var c=Q(z.base[0],b[0]),a=Q(z.base[2],b[2]);if(X&&!c&&(!a||!R))return;if(R&&(!c||!X)&&!a)return;var L=!0;if(L=L&&!g(E,z.base[0]+1e-5,z.base[1],z.base[2]+1e-5),L=L&&!g(E,z.max[0]-1e-5,z.base[1],z.base[2]+1e-5),L=L&&!g(E,z.base[0]+1e-5,z.base[1],z.max[2]-1e-5),L=L&&!g(E,z.max[0]-1e-5,z.base[1],z.max[2]-1e-5),L)return;T(t.BZ,z),t.resting[0]=B[0],t.resting[2]=B[2],t.kO&&t.kO()}(E,t,F,L);for(var h=0;h<3;++h)t.resting[h]=t.resting[h]||mE[h],c[h]=0,t.resting[h]&&(a[h]||(c[h]=-t.AZ[h]),t.AZ[h]=0);var W=C.length(c);W>.001&&(C.scale(c,c,t.hA),t.uO&&t.uO(c),t.restitution>0&&W>E.minBounceImpulse&&(C.scale(c,c,t.restitution),t.applyImpulse(c)));var f=C.squaredLength(t.AZ);f>1e-5&&t.uZ();E.Ky&&E.Ky(t)?(t.loadFromCopy(I),t.rolledBackLastTick=!0):t.rolledBackLastTick=!1}(this,z,E,t)))};var D=C.create([0,0,0]);var S=C.create();function l(E,t,z,A,X){var R=z.resting[t],u=A[t];if(!z.alwaysApplyHorizFriction||1!==t){if(0===R)return;if(R*u<=0)return}C.k(f,z.AZ),f[t]=0;var p=C.length(f);if(!Q(p,0)){var Z=Math.abs(z.friction*E.gravity[t]*X),H=p>Z?(p-Z)/p:0;z.AZ[(t+1)%3]*=H,z.AZ[(t+2)%3]*=H}}var f=C.create();function K(E,t,z,A,X){return C.set(A,0,0,0),Z(E.testSolid,t,z,(function(E,t,z,R){A[t]=z,R[t]=0,X||(R[0]=0,R[1]=0,R[2]=0)}))}var F=new p([],[]),B=C.create(),b=C.create(),x=C.create(),J=C.create();var V=C.create(),r=new p([],[]),i=C.create();function g(E,t,z,A){return E.testSolid(Math.floor(t),Math.floor(z-1),Math.floor(A))}var o=C.create();function Q(E,t){return Math.abs(E-t)<1e-5}function T(E,t){for(var z=0;z<3;z++)E.base[z]=t.base[z],E.max[z]=t.max[z],E.jZ[z]=t.jZ[z]}var q=function(E){}},12496:function(E,t){!function(E){"use strict";var t=function(E,z){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,t){E.__proto__=t}||function(E,t){for(var z in t)Object.prototype.hasOwnProperty.call(t,z)&&(E[z]=t[z])},t(E,z)};function z(E,z){if("function"!==typeof z&&null!==z)throw new TypeError("Class extends value "+String(z)+" is not a constructor or null");function A(){this.constructor=E}t(E,z),E.prototype=null===z?Object.create(z):(A.prototype=z.prototype,new A)}function A(E,t,z,A){var X,R=arguments.length,u=R<3?t:null===A?A=Object.getOwnPropertyDescriptor(t,z):A;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)u=Reflect.decorate(E,t,z,A);else for(var p=E.length-1;p>=0;p--)(X=E[p])&&(u=(R<3?X(u):R>3?X(t,z,u):X(t,z))||u);return R>3&&u&&Object.defineProperty(t,z,u),u}function X(E,t,z){if(z||2===arguments.length)for(var A,X=0,R=t.length;X<R;X++)!A&&X in t||(A||(A=Array.prototype.slice.call(t,0,X)),A[X]=t[X]);return E.concat(A||Array.prototype.slice.call(t))}var R,u=255,p=213;E.OPERATION=void 0,(R=E.OPERATION||(E.OPERATION={}))[R.ADD=128]="ADD",R[R.REPLACE=0]="REPLACE",R[R.DELETE=64]="DELETE",R[R.DELETE_AND_ADD=192]="DELETE_AND_ADD",R[R.TOUCH=1]="TOUCH",R[R.CLEAR=10]="CLEAR";var C=function(){function t(E,t,z){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=E,this.setParent(t,z)}return t.prototype.setParent=function(E,t,z){var A=this;if(this.indexes||(this.indexes=this.ref instanceof JE?this.ref._definition.indexes:{}),this.parent=E,this.parentIndex=z,t)if(this.root=t,this.ref instanceof JE){var X=this.ref._definition;for(var R in X.schema){var u=this.ref[R];if(u&&u.$changes){var p=X.indexes[R];u.$changes.setParent(this.ref,t,p)}}}else"object"===typeof this.ref&&this.ref.forEach((function(E,t){if(E instanceof JE){var z=E.$changes,X=A.ref.$changes.indexes[t];z.setParent(A.ref,A.root,X)}}))},t.prototype.operation=function(E){this.changes.set(--this.currentCustomOperation,E)},t.prototype.change=function(t,z){void 0===z&&(z=E.OPERATION.ADD);var A="number"===typeof t?t:this.indexes[t];this.assertValidIndex(A,t);var X=this.changes.get(A);X&&X.op!==E.OPERATION.DELETE&&X.op!==E.OPERATION.TOUCH||this.changes.set(A,{op:X&&X.op===E.OPERATION.DELETE?E.OPERATION.DELETE_AND_ADD:z,index:A}),this.allChanges.add(A),this.changed=!0,this.touchParents()},t.prototype.touch=function(t){var z="number"===typeof t?t:this.indexes[t];this.assertValidIndex(z,t),this.changes.has(z)||this.changes.set(z,{op:E.OPERATION.TOUCH,index:z}),this.allChanges.add(z),this.touchParents()},t.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},t.prototype.getType=function(E){if(this.ref._definition)return(t=this.ref._definition).schema[t.fieldsByIndex[E]];var t,z=(t=this.parent._definition).schema[t.fieldsByIndex[this.parentIndex]];return Object.values(z)[0]},t.prototype.getChildrenFilter=function(){var E=this.parent._definition.childFilters;return E&&E[this.parentIndex]},t.prototype.getValue=function(E){return this.ref.getByIndex(E)},t.prototype.delete=function(t){var z="number"===typeof t?t:this.indexes[t];if(void 0!==z){var A=this.getValue(z);this.changes.set(z,{op:E.OPERATION.DELETE,index:z}),this.allChanges.delete(z),delete this.caches[z],A&&A.$changes&&(A.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(t," (").concat(z,")"))},t.prototype.discard=function(t,z){var A=this;void 0===t&&(t=!1),void 0===z&&(z=!1),this.ref instanceof JE||this.changes.forEach((function(t){if(t.op===E.OPERATION.DELETE){var z=A.ref.getIndex(t.index);delete A.indexes[z]}})),this.changes.clear(),this.changed=t,z&&this.allChanges.clear(),this.currentCustomOperation=0},t.prototype.discardAll=function(){var E=this;this.changes.forEach((function(t){var z=E.getValue(t.index);z&&z.$changes&&z.$changes.discardAll()})),this.discard()},t.prototype.cache=function(E,t){this.caches[E]=t},t.prototype.clone=function(){return new t(this.ref,this.parent,this.root)},t.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},t.prototype.assertValidIndex=function(E,t){if(void 0===E)throw new Error('ChangeTree: missing index for field "'.concat(t,'"'))},t}();function Z(E,t,z,A){return E[t]||(E[t]=[]),E[t].push(z),null===A||void 0===A||A.forEach((function(E,t){return z(E,t)})),function(){return h(E[t],E[t].indexOf(z))}}function H(t){var z=this,A="string"!==typeof this.$changes.getType();this.$items.forEach((function(X,R){t.push({refId:z.$changes.refId,op:E.OPERATION.DELETE,field:R,value:void 0,previousValue:X}),A&&z.$changes.root.removeRef(X.$changes.refId)}))}function h(E,t){if(-1===t||t>=E.length)return!1;for(var z=E.length-1,A=t;A<z;A++)E[A]=E[A+1];return E.length=z,!0}var d=function(E,t){var z=E.toString(),A=t.toString();return z<A?-1:z>A?1:0};function y(E){return E.$proxy=!0,E=new Proxy(E,{get:function(E,t){return"symbol"===typeof t||isNaN(t)?E[t]:E.at(t)},set:function(E,t,z){if("symbol"===typeof t||isNaN(t))E[t]=z;else{var A=Array.from(E.$items.keys()),X=parseInt(A[t]||t);void 0===z||null===z?E.deleteAt(X):E.setAt(X,z)}return!0},deleteProperty:function(E,t){return"number"===typeof t?E.deleteAt(t):delete E[t],!0}})}var O=function(){function t(){for(var E=[],t=0;t<arguments.length;t++)E[t]=arguments[t];this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,E)}return t.prototype.Fp=function(t,z){return void 0===z&&(z=!0),Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,t,z?this.$items:void 0)},t.prototype.mz=function(t){return Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,t)},t.is=function(E){return Array.isArray(E)||void 0!==E.array},Object.defineProperty(t.prototype,"length",{get:function(){return this.$items.size},set:function(E){0===E?this.clear():this.splice(E,this.length-E)},enumerable:!1,configurable:!0}),t.prototype.push=function(){for(var E,t=this,z=[],A=0;A<arguments.length;A++)z[A]=arguments[A];return z.forEach((function(z){E=t.$refId++,t.setAt(E,z)})),E},t.prototype.pop=function(){var E=Array.from(this.$indexes.values()).pop();if(void 0!==E){this.$changes.delete(E),this.$indexes.delete(E);var t=this.$items.get(E);return this.$items.delete(E),t}},t.prototype.at=function(E){var t=Array.from(this.$items.keys())[E];return this.$items.get(t)},t.prototype.setAt=function(t,z){var A,X;if(void 0!==z&&null!==z){if(this.$items.get(t)!==z){void 0!==z.$changes&&z.$changes.setParent(this,this.$changes.root,t);var R=null!==(X=null===(A=this.$changes.indexes[t])||void 0===A?void 0:A.op)&&void 0!==X?X:E.OPERATION.ADD;this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,z),this.$changes.change(t,R)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},t.prototype.deleteAt=function(E){var t=Array.from(this.$items.keys())[E];return void 0!==t&&this.$deleteAt(t)},t.prototype.$deleteAt=function(E){return this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E)},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&H.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.concat=function(){for(var E,z=[],A=0;A<arguments.length;A++)z[A]=arguments[A];return new(t.bind.apply(t,X([void 0],(E=Array.from(this.$items.values())).concat.apply(E,z),!1)))},t.prototype.join=function(E){return Array.from(this.$items.values()).join(E)},t.prototype.reverse=function(){var E=this,t=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(z,A){E.setAt(t[A],z)})),this},t.prototype.shift=function(){var E=Array.from(this.$items.keys()).shift();if(void 0!==E){var t=this.$items.get(E);return this.$deleteAt(E),t}},t.prototype.slice=function(E,z){var A=new t;return A.push.apply(A,Array.from(this.$items.values()).slice(E,z)),A},t.prototype.sort=function(E){var t=this;void 0===E&&(E=d);var z=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(E).forEach((function(E,A){t.setAt(z[A],E)})),this},t.prototype.splice=function(E,t){void 0===t&&(t=this.length-E);for(var z=Array.from(this.$items.keys()),A=[],X=E;X<E+t;X++)A.push(this.$items.get(z[X])),this.$deleteAt(z[X]);return A},t.prototype.unshift=function(){for(var E=this,t=[],z=0;z<arguments.length;z++)t[z]=arguments[z];var A=this.length,X=t.length,R=Array.from(this.$items.values());return t.forEach((function(t,z){E.setAt(z,t)})),R.forEach((function(t,z){E.setAt(X+z,t)})),A+X},t.prototype.indexOf=function(E,t){return Array.from(this.$items.values()).indexOf(E,t)},t.prototype.lastIndexOf=function(E,t){return void 0===t&&(t=this.length-1),Array.from(this.$items.values()).lastIndexOf(E,t)},t.prototype.every=function(E,t){return Array.from(this.$items.values()).every(E,t)},t.prototype.some=function(E,t){return Array.from(this.$items.values()).some(E,t)},t.prototype.forEach=function(E,t){Array.from(this.$items.values()).forEach(E,t)},t.prototype.map=function(E,t){return Array.from(this.$items.values()).map(E,t)},t.prototype.filter=function(E,t){return Array.from(this.$items.values()).filter(E,t)},t.prototype.reduce=function(E,t){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},t.prototype.reduceRight=function(E,t){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},t.prototype.find=function(E,t){return Array.from(this.$items.values()).find(E,t)},t.prototype.findIndex=function(E,t){return Array.from(this.$items.values()).findIndex(E,t)},t.prototype.fill=function(E,t,z){throw new Error("ArraySchema#fill() not implemented")},t.prototype.copyWithin=function(E,t,z){throw new Error("ArraySchema#copyWithin() not implemented")},t.prototype.toString=function(){return this.$items.toString()},t.prototype.toLocaleString=function(){return this.$items.toLocaleString()},t.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},t.prototype.includes=function(E,t){return Array.from(this.$items.values()).includes(E,t)},t.prototype.flatMap=function(E,t){throw new Error("ArraySchema#flatMap() is not supported.")},t.prototype.flat=function(E){throw new Error("ArraySchema#flat() is not supported.")},t.prototype.findLast=function(){var E=Array.from(this.$items.values());return E.findLast.apply(E,arguments)},t.prototype.findLastIndex=function(){var E=Array.from(this.$items.values());return E.findLastIndex.apply(E,arguments)},t.prototype.setIndex=function(E,t){this.$indexes.set(E,t)},t.prototype.getIndex=function(E){return this.$indexes.get(E)},t.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},t.prototype.deleteByIndex=function(E){var t=this.$indexes.get(E);this.$items.delete(t),this.$indexes.delete(E)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){return this.toArray().map((function(E){return"function"===typeof E.toJSON?E.toJSON():E}))},t.prototype.clone=function(E){return E?new(t.bind.apply(t,X([void 0],Array.from(this.$items.values()),!1))):new(t.bind.apply(t,X([void 0],this.map((function(E){return E.$changes?E.clone():E})),!1)))},t}();function c(E){return E.$proxy=!0,E=new Proxy(E,{get:function(E,t){return"symbol"!==typeof t&&"undefined"===typeof E[t]?E.get(t):E[t]},set:function(E,t,z){return"symbol"!==typeof t&&-1===t.indexOf("$")&&"Fp"!==t&&"mz"!==t&&"onChange"!==t?E.set(t,z):E[t]=z,!0},deleteProperty:function(E,t){return E.delete(t),!0}})}var a=function(){function t(E){var z=this;if(this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,E)if(E instanceof Map||E instanceof t)E.forEach((function(E,t){return z.set(t,E)}));else for(var A in E)this.set(A,E[A])}return t.prototype.Fp=function(t,z){return void 0===z&&(z=!0),Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,t,z?this.$items:void 0)},t.prototype.mz=function(t){return Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,t)},t.is=function(E){return void 0!==E.map},t.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.set=function(t,z){if(void 0===z||null===z)throw new Error("MapSchema#set('".concat(t,"', ").concat(z,"): trying to set ").concat(z," value on '").concat(t,"'."));t=t.toString();var A="undefined"!==typeof this.$changes.indexes[t],X=A?this.$changes.indexes[t]:this.$refId++,R=A?E.OPERATION.REPLACE:E.OPERATION.ADD,u=void 0!==z.$changes;if(u&&z.$changes.setParent(this,this.$changes.root,X),A){if(!u&&this.$items.get(t)===z)return;u&&this.$items.get(t)!==z&&(R=E.OPERATION.ADD)}else this.$changes.indexes[t]=X,this.$indexes.set(X,t);return this.$items.set(t,z),this.$changes.change(t,R),this},t.prototype.get=function(E){return this.$items.get(E)},t.prototype.delete=function(E){return this.$changes.delete(E),this.$items.delete(E)},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&H.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(E){return this.$items.has(E)},t.prototype.forEach=function(E){this.$items.forEach(E)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(E,t){this.$indexes.set(E,t)},t.prototype.getIndex=function(E){return this.$indexes.get(E)},t.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},t.prototype.deleteByIndex=function(E){var t=this.$indexes.get(E);this.$items.delete(t),this.$indexes.delete(E)},t.prototype.toJSON=function(){var E={};return this.forEach((function(t,z){E[z]="function"===typeof t.toJSON?t.toJSON():t})),E},t.prototype.clone=function(E){var z;return E?z=Object.assign(new t,this):(z=new t,this.forEach((function(E,t){E.$changes?z.set(t,E.clone()):z.set(t,E)}))),z},t}(),L={};function mE(E,t){L[E]=t}function W(E){return L[E]}var I=function(){function E(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return E.create=function(t){var z=new E;return z.schema=Object.assign({},t&&t.schema||{}),z.indexes=Object.assign({},t&&t.indexes||{}),z.fieldsByIndex=Object.assign({},t&&t.fieldsByIndex||{}),z.descriptors=Object.assign({},t&&t.descriptors||{}),z.deprecated=Object.assign({},t&&t.deprecated||{}),z},E.prototype.addField=function(E,t){var z=this.getNextFieldIndex();this.fieldsByIndex[z]=E,this.indexes[E]=z,this.schema[E]=Array.isArray(t)?{array:t[0]}:t},E.prototype.hasField=function(E){return void 0!==this.indexes[E]},E.prototype.addFilter=function(E,t){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[E]]=t,this.indexesWithFilters.push(this.indexes[E]),!0},E.prototype.addChildrenFilter=function(E,t){var z=this.indexes[E],A=this.schema[E];if(W(Object.keys(A)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[z]=t,!0;console.warn("@filterChildren: field '".concat(E,"' can't have children. Ignoring filter."))},E.prototype.getChildrenFilter=function(E){return this.childFilters&&this.childFilters[this.indexes[E]]},E.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},E}();function e(E){return E._context&&E._context.useFilters}var D=function(){function E(){this.types={},this.schemas=new Map,this.useFilters=!1}return E.prototype.has=function(E){return this.schemas.has(E)},E.prototype.get=function(E){return this.types[E]},E.prototype.add=function(E,t){void 0===t&&(t=this.schemas.size),E._definition=I.create(E._definition),E._typeid=t,this.types[t]=E,this.schemas.set(E,t)},E.create=function(t){return void 0===t&&(t={}),function(z){return t.context||(t.context=new E),l(z,t)}},E}(),S=new D;function l(E,t){return void 0===t&&(t={}),function(z,A){var R=t.context||S,u=z.constructor;if(u._context=R,!E)throw new Error("".concat(u.name,': @type() reference provided for "').concat(A,"\" is undefined. Make sure you don't have any circular dependencies."));R.has(u)||R.add(u);var p=u._definition;if(p.addField(A,E),p.descriptors[A]){if(p.deprecated[A])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(A,"' definition on '").concat(u.name,"'.\nCheck @type() annotation"))}catch(L){var C=L.stack.split("\n")[4].trim();throw new Error("".concat(L.message," ").concat(C))}}var Z=O.is(E),H=!Z&&a.is(E);if("string"!==typeof E&&!JE.is(E)){var h=Object.values(E)[0];"string"===typeof h||R.has(h)||R.add(h)}if(t.manual)p.descriptors[A]={enumerable:!0,configurable:!0,writable:!0};else{var d="_".concat(A);p.descriptors[d]={enumerable:!1,configurable:!1,writable:!0},p.descriptors[A]={get:function(){return this[d]},set:function(E){E!==this[d]&&(void 0!==E&&null!==E?(!Z||E instanceof O||(E=new(O.bind.apply(O,X([void 0],E,!1)))),!H||E instanceof a||(E=new a(E)),void 0===E.$proxy&&(H?E=c(E):Z&&(E=y(E))),this.$changes.change(A),E.$changes&&E.$changes.setParent(this,this.$changes.root,this._definition.indexes[A])):this[d]&&this.$changes.delete(A),this[d]=E)},enumerable:!0,configurable:!0}}}}function f(E){return function(t,z){var A=t.constructor;A._definition.addFilter(z,E)&&(A._context.useFilters=!0)}}function K(E){return function(t,z){var A=t.constructor;A._definition.addChildrenFilter(z,E)&&(A._context.useFilters=!0)}}function F(E){return void 0===E&&(E=!0),function(t,z){var A=t.constructor._definition;A.deprecated[z]=!0,E&&(A.descriptors[z]={get:function(){throw new Error("".concat(z," is deprecated."))},set:function(E){},enumerable:!1,configurable:!0})}}function B(E,t,z){for(var A in void 0===z&&(z={}),z.context||(z.context=E._context||z.context||S),t)l(t[A],z)(E.prototype,A);return E}function b(E){for(var t=0,z=0,A=0,X=E.length;A<X;A++)(t=E.charCodeAt(A))<128?z+=1:t<2048?z+=2:t<55296||t>=57344?z+=3:(A++,z+=4);return z}function x(E,t,z){for(var A=0,X=0,R=z.length;X<R;X++)(A=z.charCodeAt(X))<128?E[t++]=A:A<2048?(E[t++]=192|A>>6,E[t++]=128|63&A):A<55296||A>=57344?(E[t++]=224|A>>12,E[t++]=128|A>>6&63,E[t++]=128|63&A):(X++,A=65536+((1023&A)<<10|1023&z.charCodeAt(X)),E[t++]=240|A>>18,E[t++]=128|A>>12&63,E[t++]=128|A>>6&63,E[t++]=128|63&A)}function J(E,t){E.push(255&t)}function V(E,t){E.push(255&t)}function r(E,t){E.push(255&t),E.push(t>>8&255)}function i(E,t){E.push(255&t),E.push(t>>8&255)}function g(E,t){E.push(255&t),E.push(t>>8&255),E.push(t>>16&255),E.push(t>>24&255)}function o(E,t){var z=t>>24,A=t>>16,X=t>>8,R=t;E.push(255&R),E.push(255&X),E.push(255&A),E.push(255&z)}function Q(E,t){var z=Math.floor(t/Math.pow(2,32));o(E,t>>>0),o(E,z)}function T(E,t){var z=t/Math.pow(2,32)|0;o(E,t>>>0),o(E,z)}function q(E,t){j(E,t)}function M(E,t){U(E,t)}var w=new Int32Array(2),n=new Float32Array(w.buffer),s=new Float64Array(w.buffer);function j(E,t){n[0]=t,g(E,w[0])}function U(E,t){s[0]=t,g(E,w[0]),g(E,w[1])}function k(E,t){return V(E,t?1:0)}function v(E,t){t||(t="");var z=b(t),A=0;if(z<32)E.push(160|z),A=1;else if(z<256)E.push(217),V(E,z),A=2;else if(z<65536)E.push(218),i(E,z),A=3;else{if(!(z<4294967296))throw new Error("String too long");E.push(219),o(E,z),A=5}return x(E,E.length,t),A+z}function Y(E,t){return isNaN(t)?Y(E,0):isFinite(t)?t!==(0|t)?(E.push(203),U(E,t),9):t>=0?t<128?(V(E,t),1):t<256?(E.push(204),V(E,t),2):t<65536?(E.push(205),i(E,t),3):t<4294967296?(E.push(206),o(E,t),5):(E.push(207),T(E,t),9):t>=-32?(E.push(224|t+32),1):t>=-128?(E.push(208),J(E,t),2):t>=-32768?(E.push(209),r(E,t),3):t>=-2147483648?(E.push(210),g(E,t),5):(E.push(211),Q(E,t),9):Y(E,t>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var G=Object.freeze({__proto__:null,utf8Write:x,int8:J,uint8:V,int16:r,uint16:i,int32:g,uint32:o,int64:Q,uint64:T,float32:q,float64:M,writeFloat32:j,writeFloat64:U,boolean:k,string:v,number:Y});function N(E,t,z){for(var A="",X=0,R=t,u=t+z;R<u;R++){var p=E[R];0!==(128&p)?192!==(224&p)?224!==(240&p)?240!==(248&p)?console.error("Invalid byte "+p.toString(16)):(X=(7&p)<<18|(63&E[++R])<<12|(63&E[++R])<<6|63&E[++R])>=65536?(X-=65536,A+=String.fromCharCode(55296+(X>>>10),56320+(1023&X))):A+=String.fromCharCode(X):A+=String.fromCharCode((15&p)<<12|(63&E[++R])<<6|63&E[++R]):A+=String.fromCharCode((31&p)<<6|63&E[++R]):A+=String.fromCharCode(p)}return A}function P(E,t){return EE(E,t)<<24>>24}function EE(E,t){return E[t.offset++]}function tE(E,t){return zE(E,t)<<16>>16}function zE(E,t){return E[t.offset++]|E[t.offset++]<<8}function AE(E,t){return E[t.offset++]|E[t.offset++]<<8|E[t.offset++]<<16|E[t.offset++]<<24}function XE(E,t){return AE(E,t)>>>0}function RE(E,t){return dE(E,t)}function uE(E,t){return yE(E,t)}function pE(E,t){var z=XE(E,t);return AE(E,t)*Math.pow(2,32)+z}function CE(E,t){var z=XE(E,t);return XE(E,t)*Math.pow(2,32)+z}var ZE=new Int32Array(2),HE=new Float32Array(ZE.buffer),hE=new Float64Array(ZE.buffer);function dE(E,t){return ZE[0]=AE(E,t),HE[0]}function yE(E,t){return ZE[0]=AE(E,t),ZE[1]=AE(E,t),hE[0]}function OE(E,t){return EE(E,t)>0}function cE(E,t){var z,A=E[t.offset++];A<192?z=31&A:217===A?z=EE(E,t):218===A?z=zE(E,t):219===A&&(z=XE(E,t));var X=N(E,t.offset,z);return t.offset+=z,X}function aE(E,t){var z=E[t.offset];return z<192&&z>160||217===z||218===z||219===z}function LE(E,t){var z=E[t.offset++];return z<128?z:202===z?dE(E,t):203===z?yE(E,t):204===z?EE(E,t):205===z?zE(E,t):206===z?XE(E,t):207===z?CE(E,t):208===z?P(E,t):209===z?tE(E,t):210===z?AE(E,t):211===z?pE(E,t):z>223?-1*(255-z+1):void 0}function mt(E,t){var z=E[t.offset];return z<128||z>=202&&z<=211}function WE(E,t){return E[t.offset]<160}function IE(E,t){return E[t.offset-1]===u&&(E[t.offset]<128||E[t.offset]>=202&&E[t.offset]<=211)}var eE=Object.freeze({__proto__:null,int8:P,uint8:EE,int16:tE,uint16:zE,int32:AE,uint32:XE,float32:RE,float64:uE,int64:pE,uint64:CE,readFloat32:dE,readFloat64:yE,boolean:OE,string:cE,stringCheck:aE,number:LE,numberCheck:mt,arrayCheck:WE,switchStructureCheck:IE}),DE=function(){function t(E){var t=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,E&&E.forEach((function(E){return t.add(E)}))}return t.prototype.Fp=function(t,z){return void 0===z&&(z=!0),Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,t,z?this.$items:void 0)},t.prototype.mz=function(t){return Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,t)},t.is=function(E){return void 0!==E.collection},t.prototype.add=function(E){var t=this.$refId++;return void 0!==E.$changes&&E.$changes.setParent(this,this.$changes.root,t),this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,E),this.$changes.change(t),t},t.prototype.at=function(E){var t=Array.from(this.$items.keys())[E];return this.$items.get(t)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(E){for(var t,z,A=this.$items.entries();(z=A.next())&&!z.done;)if(E===z.value[1]){t=z.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&H.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(E){return Array.from(this.$items.values()).some((function(t){return t===E}))},t.prototype.forEach=function(E){var t=this;this.$items.forEach((function(z,A,X){return E(z,A,t)}))},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(E,t){this.$indexes.set(E,t)},t.prototype.getIndex=function(E){return this.$indexes.get(E)},t.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},t.prototype.deleteByIndex=function(E){var t=this.$indexes.get(E);this.$items.delete(t),this.$indexes.delete(E)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var E=[];return this.forEach((function(t,z){E.push("function"===typeof t.toJSON?t.toJSON():t)})),E},t.prototype.clone=function(E){var z;return E?z=Object.assign(new t,this):(z=new t,this.forEach((function(E){E.$changes?z.add(E.clone()):z.add(E)}))),z},t}(),SE=function(){function t(E){var t=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,E&&E.forEach((function(E){return t.add(E)}))}return t.prototype.Fp=function(t,z){return void 0===z&&(z=!0),Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,t,z?this.$items:void 0)},t.prototype.mz=function(t){return Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,t)},t.is=function(E){return void 0!==E.set},t.prototype.add=function(t){var z,A;if(this.has(t))return!1;var X=this.$refId++;void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,X);var R=null!==(A=null===(z=this.$changes.indexes[X])||void 0===z?void 0:z.op)&&void 0!==A?A:E.OPERATION.ADD;return this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,t),this.$changes.change(X,R),X},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(E){for(var t,z,A=this.$items.entries();(z=A.next())&&!z.done;)if(E===z.value[1]){t=z.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&H.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(E){for(var t,z=this.$items.values(),A=!1;(t=z.next())&&!t.done;)if(E===t.value){A=!0;break}return A},t.prototype.forEach=function(E){var t=this;this.$items.forEach((function(z,A,X){return E(z,A,t)}))},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(E,t){this.$indexes.set(E,t)},t.prototype.getIndex=function(E){return this.$indexes.get(E)},t.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},t.prototype.deleteByIndex=function(E){var t=this.$indexes.get(E);this.$items.delete(t),this.$indexes.delete(E)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var E=[];return this.forEach((function(t,z){E.push("function"===typeof t.toJSON?t.toJSON():t)})),E},t.prototype.clone=function(E){var z;return E?z=Object.assign(new t,this):(z=new t,this.forEach((function(E){E.$changes?z.add(E.clone()):z.add(E)}))),z},t}(),lE=function(){function E(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return E.prototype.addRefId=function(E){this.refIds.has(E)||(this.refIds.add(E),this.containerIndexes.set(E,new Set))},E.get=function(t){return void 0===t.$filterState&&(t.$filterState=new E),t.$filterState},E}(),fE=function(){function E(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return E.prototype.getNextUniqueId=function(){return this.nextUniqueId++},E.prototype.addRef=function(E,t,z){void 0===z&&(z=!0),this.refs.set(E,t),z&&(this.refCounts[E]=(this.refCounts[E]||0)+1)},E.prototype.removeRef=function(E){this.refCounts[E]=this.refCounts[E]-1,this.deletedRefs.add(E)},E.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},E.prototype.garbageCollectDeletedRefs=function(){var E=this;this.deletedRefs.forEach((function(t){if(!(E.refCounts[t]>0)){var z=E.refs.get(t);if(z instanceof JE)for(var A in z._definition.schema)"string"!==typeof z._definition.schema[A]&&z[A]&&z[A].$changes&&E.removeRef(z[A].$changes.refId);else{var X=z.$changes.parent._definition,R=X.schema[X.fieldsByIndex[z.$changes.parentIndex]];"function"===typeof Object.values(R)[0]&&Array.from(z.values()).forEach((function(t){return E.removeRef(t.$changes.refId)}))}E.refs.delete(t),delete E.refCounts[t]}})),this.deletedRefs.clear()},E}(),KE=function(E){function t(){return null!==E&&E.apply(this,arguments)||this}return z(t,E),t}(Error);function FE(E,t,z,A){var X,R=!1;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":X="number",isNaN(E)&&console.log('trying to encode "NaN" in '.concat(z.constructor.name,"#").concat(A));break;case"string":X="string",R=!0;break;case"boolean":return}if(typeof E!==X&&(!R||R&&null!==E)){var u="'".concat(JSON.stringify(E),"'").concat(E&&E.constructor&&" (".concat(E.constructor.name,")")||"");throw new KE("a '".concat(X,"' was expected, but ").concat(u," was provided in ").concat(z.constructor.name,"#").concat(A))}}function BE(E,t,z,A){if(!(E instanceof t))throw new KE("a '".concat(t.name,"' was expected, but '").concat(E.constructor.name,"' was provided in ").concat(z.constructor.name,"#").concat(A))}function bE(E,t,z,A,X){FE(z,E,A,X);var R=G[E];if(!R)throw new KE("a '".concat(E,"' was expected, but ").concat(z," was provided in ").concat(A.constructor.name,"#").concat(X));R(t,z)}function xE(E,t,z){return eE[E](t,z)}var JE=function(){function t(){for(var E=[],t=0;t<arguments.length;t++)E[t]=arguments[t];Object.defineProperties(this,{$changes:{value:new C(this,void 0,new fE),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var z=this._definition.descriptors;z&&Object.defineProperties(this,z),E[0]&&this.assign(E[0])}return t.onError=function(E){console.error(E)},t.is=function(E){return E._definition&&void 0!==E._definition.schema},t.prototype.onChange=function(t){return Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,t)},t.prototype.mz=function(t){return Z(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,t)},t.prototype.assign=function(E){return Object.assign(this,E),this},Object.defineProperty(t.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),t.prototype.setDirty=function(E,t){this.$changes.change(E,t)},t.prototype.listen=function(E,t,z){var A=this;return void 0===z&&(z=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[E]||(this.$callbacks[E]=[]),this.$callbacks[E].push(t),z&&void 0!==this[E]&&t(this[E],void 0),function(){return h(A.$callbacks[E],A.$callbacks[E].indexOf(t))}},t.prototype.decode=function(z,A,X){var R;void 0===A&&(A={offset:0}),void 0===X&&(X=this);var p=[],C=this.$changes.root,Z=z.length,H=0;for(C.refs.set(H,this);A.offset<Z;){var h=z[A.offset++];if(h!=u){var d=X.$changes,y=void 0!==X._definition,c=y?h>>6<<6:h;if(c!==E.OPERATION.CLEAR){var L=y?h%(c||255):LE(z,A),mE=y?X._definition.fieldsByIndex[L]:"",I=d.getType(L),e=void 0,D=void 0,S=void 0;if(y?D=X["_".concat(mE)]:(D=X.getByIndex(L),(c&E.OPERATION.ADD)===E.OPERATION.ADD?(S=X instanceof a?cE(z,A):L,X.setIndex(L,S)):S=X.getIndex(L)),(c&E.OPERATION.DELETE)===E.OPERATION.DELETE&&(c!==E.OPERATION.DELETE_AND_ADD&&X.deleteByIndex(L),D&&D.$changes&&C.removeRef(D.$changes.refId),e=null),void 0!==mE){if(c===E.OPERATION.DELETE);else if(t.is(I)){var l=LE(z,A);if(e=C.refs.get(l),c!==E.OPERATION.REPLACE){var f=this.getSchemaType(z,A,I);e||((e=this.createTypeInstance(f)).$changes.refId=l,D&&(e.$callbacks=D.$callbacks,D.$changes.refId&&l!==D.$changes.refId&&C.removeRef(D.$changes.refId))),C.addRef(l,e,e!==D)}}else if("string"===typeof I)e=xE(I,z,A);else{var K=W(Object.keys(I)[0]),F=LE(z,A),B=C.refs.has(F)?D||C.refs.get(F):new K.constructor;if((e=B.clone(!0)).$changes.refId=F,D&&(e.$callbacks=D.$callbacks,D.$changes.refId&&F!==D.$changes.refId)){C.removeRef(D.$changes.refId);for(var b=D.entries(),x=void 0;(x=b.next())&&!x.done;){var J=(R=x.value)[0],V=R[1];p.push({refId:F,op:E.OPERATION.DELETE,field:J,value:void 0,previousValue:V})}}C.addRef(F,e,B!==D)}if(null!==e&&void 0!==e)if(e.$changes&&e.$changes.setParent(d.ref,d.root,L),X instanceof t)X[mE]=e;else if(X instanceof a)J=S,X.$items.set(J,e),X.$changes.allChanges.add(L);else if(X instanceof O)X.setAt(L,e);else if(X instanceof DE){var r=X.add(e);X.setIndex(L,r)}else X instanceof SE&&!1!==(r=X.add(e))&&X.setIndex(L,r);D!==e&&p.push({refId:H,op:c,field:mE,dynamicIndex:S,value:e,previousValue:D})}else{console.warn("@colyseus/schema: definition mismatch");for(var i={offset:A.offset};A.offset<Z&&(!IE(z,A)||(i.offset=A.offset+1,!C.refs.has(LE(z,i))));)A.offset++}}else X.clear(p)}else{H=LE(z,A);var g=C.refs.get(H);if(!g)throw new Error('"refId" not found: '.concat(H));X=g}}return this._triggerChanges(p),C.garbageCollectDeletedRefs(),p},t.prototype.encode=function(z,A,X){void 0===z&&(z=!1),void 0===A&&(A=[]),void 0===X&&(X=!1);for(var R=this.$changes,p=new WeakSet,C=[R],Z=1,H=0;H<Z;H++){var h=C[H],d=h.ref,y=d instanceof t;h.ensureRefId(),p.add(h),h!==R&&(h.changed||z)&&(V(A,u),Y(A,h.refId));for(var O=z?Array.from(h.allChanges):Array.from(h.changes.values()),c=0,L=O.length;c<L;c++){var mE=z?{op:E.OPERATION.ADD,index:O[c]}:O[c],I=mE.index,e=y?d._definition.fieldsByIndex&&d._definition.fieldsByIndex[I]:I,D=A.length;if(mE.op!==E.OPERATION.TOUCH)if(y)V(A,I|mE.op);else{if(V(A,mE.op),mE.op===E.OPERATION.CLEAR)continue;Y(A,I)}if(y||(mE.op&E.OPERATION.ADD)!=E.OPERATION.ADD||d instanceof a&&v(A,h.ref.$indexes.get(I)),mE.op!==E.OPERATION.DELETE){var S=h.getType(I),l=h.getValue(I);if(l&&l.$changes&&!p.has(l.$changes)&&(C.push(l.$changes),l.$changes.ensureRefId(),Z++),mE.op!==E.OPERATION.TOUCH){if(t.is(S))BE(l,S,d,e),Y(A,l.$changes.refId),(mE.op&E.OPERATION.ADD)===E.OPERATION.ADD&&this.tryEncodeTypeId(A,S,l.constructor);else if("string"===typeof S)bE(S,A,l,d,e);else{var f=W(Object.keys(S)[0]);BE(d["_".concat(e)],f.constructor,d,e),Y(A,l.$changes.refId)}X&&h.cache(I,A.slice(D))}}}z||X||h.discard()}return A},t.prototype.encodeAll=function(E){return this.encode(!0,[],E)},t.prototype.applyFilters=function(z,A){var X,R;void 0===A&&(A=!1);for(var p=this,C=new Set,Z=lE.get(z),H=[this.$changes],h=1,d=[],y=function(y){var O=H[y];if(C.has(O.refId))return"continue";var c=O.ref,L=c instanceof t;V(d,u),Y(d,O.refId);var mE=Z.refIds.has(O),W=A||!mE;Z.addRefId(O);var I=Z.containerIndexes.get(O),e=W?Array.from(O.allChanges):Array.from(O.changes.values());!A&&L&&c._definition.indexesWithFilters&&c._definition.indexesWithFilters.forEach((function(t){!I.has(t)&&O.allChanges.has(t)&&(W?e.push(t):e.push({op:E.OPERATION.ADD,index:t}))}));for(var D=0,S=e.length;D<S;D++){var l=W?{op:E.OPERATION.ADD,index:e[D]}:e[D];if(l.op!==E.OPERATION.CLEAR){var f=l.index;if(l.op!==E.OPERATION.DELETE){var K=O.getValue(f),F=O.getType(f);if(L){if((B=c._definition.filters&&c._definition.filters[f])&&!B.call(c,z,K,p)){K&&K.$changes&&C.add(K.$changes.refId);continue}}else{var B,b=O.parent;if((B=O.getChildrenFilter())&&!B.call(b,z,c.$indexes.get(f),K,p)){K&&K.$changes&&C.add(K.$changes.refId);continue}}if(K.$changes&&(H.push(K.$changes),h++),l.op!==E.OPERATION.TOUCH)if(l.op===E.OPERATION.ADD||L)d.push.apply(d,null!==(X=O.caches[f])&&void 0!==X?X:[]),I.add(f);else if(I.has(f))d.push.apply(d,null!==(R=O.caches[f])&&void 0!==R?R:[]);else{if(I.add(f),V(d,E.OPERATION.ADD),Y(d,f),c instanceof a){var x=O.ref.$indexes.get(f);v(d,x)}K.$changes?Y(d,K.$changes.refId):G[F](d,K)}else K.$changes&&!L&&(V(d,E.OPERATION.ADD),Y(d,f),c instanceof a&&(x=O.ref.$indexes.get(f),v(d,x)),Y(d,K.$changes.refId))}else L?V(d,l.op|f):(V(d,l.op),Y(d,f))}else V(d,l.op)}},O=0;O<h;O++)y(O);return d},t.prototype.clone=function(){var E,t=new this.constructor,z=this._definition.schema;for(var A in z)"object"===typeof this[A]&&"function"===typeof(null===(E=this[A])||void 0===E?void 0:E.clone)?t[A]=this[A].clone():t[A]=this[A];return t},t.prototype.toJSON=function(){var E=this._definition.schema,t=this._definition.deprecated,z={};for(var A in E)t[A]||null===this[A]||"undefined"===typeof this[A]||(z[A]="function"===typeof this[A].toJSON?this[A].toJSON():this["_".concat(A)]);return z},t.prototype.discardAllChanges=function(){this.$changes.discardAll()},t.prototype.getByIndex=function(E){return this[this._definition.fieldsByIndex[E]]},t.prototype.deleteByIndex=function(E){this[this._definition.fieldsByIndex[E]]=void 0},t.prototype.tryEncodeTypeId=function(E,t,z){t._typeid!==z._typeid&&(V(E,p),Y(E,z._typeid))},t.prototype.getSchemaType=function(E,t,z){var A;return E[t.offset]===p&&(t.offset++,A=this.constructor._context.get(LE(E,t))),A||z},t.prototype.createTypeInstance=function(E){var t=new E;return t.$changes.root=this.$changes.root,t},t.prototype._triggerChanges=function(z){for(var A,X,R,u,p,C,Z,H,h,d=new Set,y=this.$changes.root.refs,O=function(O){var c=z[O],a=c.refId,L=y.get(a),mE=L.$callbacks;if((c.op&E.OPERATION.DELETE)===E.OPERATION.DELETE&&c.previousValue instanceof t&&(null===(X=null===(A=c.previousValue.$callbacks)||void 0===A?void 0:A[E.OPERATION.DELETE])||void 0===X||X.forEach((function(E){return E()}))),!mE)return"continue";if(L instanceof t){if(!d.has(a))try{null===(R=null===mE||void 0===mE?void 0:mE[E.OPERATION.REPLACE])||void 0===R||R.forEach((function(E){return E()}))}catch(W){t.onError(W)}try{mE.hasOwnProperty(c.field)&&(null===(u=mE[c.field])||void 0===u||u.forEach((function(E){return E(c.value,c.previousValue)})))}catch(W){t.onError(W)}}else c.op===E.OPERATION.ADD&&void 0===c.previousValue?null===(p=mE[E.OPERATION.ADD])||void 0===p||p.forEach((function(E){var t;return E(c.value,null!==(t=c.dynamicIndex)&&void 0!==t?t:c.field)})):c.op===E.OPERATION.DELETE?void 0!==c.previousValue&&(null===(C=mE[E.OPERATION.DELETE])||void 0===C||C.forEach((function(E){var t;return E(c.previousValue,null!==(t=c.dynamicIndex)&&void 0!==t?t:c.field)}))):c.op===E.OPERATION.DELETE_AND_ADD&&(void 0!==c.previousValue&&(null===(Z=mE[E.OPERATION.DELETE])||void 0===Z||Z.forEach((function(E){var t;return E(c.previousValue,null!==(t=c.dynamicIndex)&&void 0!==t?t:c.field)}))),null===(H=mE[E.OPERATION.ADD])||void 0===H||H.forEach((function(E){var t;return E(c.value,null!==(t=c.dynamicIndex)&&void 0!==t?t:c.field)}))),c.value!==c.previousValue&&(null===(h=mE[E.OPERATION.REPLACE])||void 0===h||h.forEach((function(E){var t;return E(c.value,null!==(t=c.dynamicIndex)&&void 0!==t?t:c.field)})));d.add(a)},c=0;c<z.length;c++)O(c)},t._definition=I.create(),t}();function VE(E){for(var t=[E.$changes],z=1,A={},X=A,R=function(E){var z=t[E];z.changes.forEach((function(E){var t=z.ref,A=E.index,R=t._definition?t._definition.fieldsByIndex[A]:t.$indexes.get(A);X[R]=z.getValue(A)}))},u=0;u<z;u++)R(u);return A}var rE={context:new D},iE=function(E){function t(){return null!==E&&E.apply(this,arguments)||this}return z(t,E),A([l("string",rE)],t.prototype,"name",void 0),A([l("string",rE)],t.prototype,"type",void 0),A([l("number",rE)],t.prototype,"referencedType",void 0),t}(JE),gE=function(E){function t(){var t=null!==E&&E.apply(this,arguments)||this;return t.fields=new O,t}return z(t,E),A([l("number",rE)],t.prototype,"id",void 0),A([l([iE],rE)],t.prototype,"fields",void 0),t}(JE),oE=function(E){function t(){var t=null!==E&&E.apply(this,arguments)||this;return t.types=new O,t}return z(t,E),t.encode=function(E){var z=E.constructor,A=new t;A.rootType=z._typeid;var X=function(E,t){for(var z in t){var X=new iE;X.name=z;var R=void 0;if("string"===typeof t[z])R=t[z];else{var u=t[z],p=void 0;JE.is(u)?(R="ref",p=t[z]):"string"===typeof u[R=Object.keys(u)[0]]?R+=":"+u[R]:p=u[R],X.referencedType=p?p._typeid:-1}X.type=R,E.fields.push(X)}A.types.push(E)},R=z._context.types;for(var u in R){var p=new gE;p.id=Number(u),X(p,R[u]._definition.schema)}return A.encodeAll()},t.decode=function(E,A){var X=new D,R=new t;R.decode(E,A);var u=R.types.reduce((function(E,t){var A=function(E){function t(){return null!==E&&E.apply(this,arguments)||this}return z(t,E),t}(JE),R=t.id;return E[R]=A,X.add(A,R),E}),{});R.types.forEach((function(E){var t=u[E.id];E.fields.forEach((function(E){var z;if(void 0!==E.referencedType){var A=E.type,R=u[E.referencedType];if(!R){var p=E.type.split(":");A=p[0],R=p[1]}"ref"===A?l(R,{context:X})(t.prototype,E.name):l(((z={})[A]=R,z),{context:X})(t.prototype,E.name)}else l(E.type,{context:X})(t.prototype,E.name)}))}));var p=u[R.rootType],C=new p;for(var Z in p._definition.schema){var H=p._definition.schema[Z];"string"!==typeof H&&(C[Z]="function"===typeof H?new H:new(W(Object.keys(H)[0]).constructor))}return C},A([l([gE],rE)],t.prototype,"types",void 0),A([l("number",rE)],t.prototype,"rootType",void 0),t}(JE);mE("map",{constructor:a}),mE("array",{constructor:O}),mE("set",{constructor:SE}),mE("collection",{constructor:DE}),E.ArraySchema=O,E.CollectionSchema=DE,E.Context=D,E.MapSchema=a,E.Reflection=oE,E.ReflectionField=iE,E.ReflectionType=gE,E.Schema=JE,E.SchemaDefinition=I,E.SetSchema=SE,E.decode=eE,E.defineTypes=B,E.deprecated=F,E.dumpChanges=VE,E.encode=G,E.filter=f,E.filterChildren=K,E.hasFilter=e,E.registerType=mE,E.type=l,Object.defineProperty(E,"__esModule",{value:!0})}(t)},13867:E=>{"use strict";E.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13860:(E,t,z)=>{var A=z(13867),X=z(13875),R=Object.hasOwnProperty,u=Object.create(null);for(var p in A)R.call(A,p)&&(u[A[p]]=p);var C=E.exports={to:{},get:{}};function Z(E,t,z){return Math.min(Math.max(t,E),z)}function H(E){var t=Math.round(E).toString(16).toUpperCase();return t.length<2?"0"+t:t}C.get=function(E){var t,z;switch(E.substring(0,3).toLowerCase()){case"hsl":t=C.get.hsl(E),z="hsl";break;case"hwb":t=C.get.hwb(E),z="hwb";break;default:t=C.get.rgb(E),z="rgb"}return t?{model:z,value:t}:null},C.get.rgb=function(E){if(!E)return null;var t,z,X,u=[0,0,0,1];if(t=E.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(X=t[2],t=t[1],z=0;z<3;z++){var p=2*z;u[z]=parseInt(t.slice(p,p+2),16)}X&&(u[3]=parseInt(X,16)/255)}else if(t=E.match(/^#([a-f0-9]{3,4})$/i)){for(X=(t=t[1])[3],z=0;z<3;z++)u[z]=parseInt(t[z]+t[z],16);X&&(u[3]=parseInt(X+X,16)/255)}else if(t=E.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(z=0;z<3;z++)u[z]=parseInt(t[z+1],0);t[4]&&(t[5]?u[3]=.01*parseFloat(t[4]):u[3]=parseFloat(t[4]))}else{if(!(t=E.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(t=E.match(/^(\w+)$/))?"transparent"===t[1]?[0,0,0,0]:R.call(A,t[1])?((u=A[t[1]])[3]=1,u):null:null;for(z=0;z<3;z++)u[z]=Math.round(2.55*parseFloat(t[z+1]));t[4]&&(t[5]?u[3]=.01*parseFloat(t[4]):u[3]=parseFloat(t[4]))}for(z=0;z<3;z++)u[z]=Z(u[z],0,255);return u[3]=Z(u[3],0,1),u},C.get.hsl=function(E){if(!E)return null;var t=E.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(t){var z=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,Z(parseFloat(t[2]),0,100),Z(parseFloat(t[3]),0,100),Z(isNaN(z)?1:z,0,1)]}return null},C.get.hwb=function(E){if(!E)return null;var t=E.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(t){var z=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,Z(parseFloat(t[2]),0,100),Z(parseFloat(t[3]),0,100),Z(isNaN(z)?1:z,0,1)]}return null},C.to.hex=function(){var E=X(arguments);return"#"+H(E[0])+H(E[1])+H(E[2])+(E[3]<1?H(Math.round(255*E[3])):"")},C.to.rgb=function(){var E=X(arguments);return E.length<4||1===E[3]?"rgb("+Math.round(E[0])+", "+Math.round(E[1])+", "+Math.round(E[2])+")":"rgba("+Math.round(E[0])+", "+Math.round(E[1])+", "+Math.round(E[2])+", "+E[3]+")"},C.to.rgb.percent=function(){var E=X(arguments),t=Math.round(E[0]/255*100),z=Math.round(E[1]/255*100),A=Math.round(E[2]/255*100);return E.length<4||1===E[3]?"rgb("+t+"%, "+z+"%, "+A+"%)":"rgba("+t+"%, "+z+"%, "+A+"%, "+E[3]+")"},C.to.hsl=function(){var E=X(arguments);return E.length<4||1===E[3]?"hsl("+E[0]+", "+E[1]+"%, "+E[2]+"%)":"hsla("+E[0]+", "+E[1]+"%, "+E[2]+"%, "+E[3]+")"},C.to.hwb=function(){var E=X(arguments),t="";return E.length>=4&&1!==E[3]&&(t=", "+E[3]),"hwb("+E[0]+", "+E[1]+"%, "+E[2]+"%"+t+")"},C.to.keyword=function(E){return u[E.slice(0,3)]}},13858:(E,t,z)=>{const A=z(13860),X=z(13891),R=["keyword","gray","hex"],u={};for(const y of Object.keys(X))u[[...X[y].labels].sort().join("")]=y;const p={};function C(E,t){if(!(this instanceof C))return new C(E,t);if(t&&t in R&&(t=null),t&&!(t in X))throw new Error("Unknown model: "+t);let z,Z;if(null==E)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(E instanceof C)this.model=E.model,this.color=[...E.color],this.valpha=E.valpha;else if("string"===typeof E){const t=A.get(E);if(null===t)throw new Error("Unable to parse color from string: "+E);this.model=t.model,Z=X[this.model].channels,this.color=t.value.slice(0,Z),this.valpha="number"===typeof t.value[Z]?t.value[Z]:1}else if(E.length>0){this.model=t||"rgb",Z=X[this.model].channels;const z=Array.prototype.slice.call(E,0,Z);this.color=d(z,Z),this.valpha="number"===typeof E[Z]?E[Z]:1}else if("number"===typeof E)this.model="rgb",this.color=[E>>16&255,E>>8&255,255&E],this.valpha=1;else{this.valpha=1;const t=Object.keys(E);"alpha"in E&&(t.splice(t.indexOf("alpha"),1),this.valpha="number"===typeof E.alpha?E.alpha:0);const A=t.sort().join("");if(!(A in u))throw new Error("Unable to parse color from object: "+JSON.stringify(E));this.model=u[A];const{labels:R}=X[this.model],p=[];for(z=0;z<R.length;z++)p.push(E[R[z]]);this.color=d(p)}if(p[this.model])for(Z=X[this.model].channels,z=0;z<Z;z++){const E=p[this.model][z];E&&(this.color[z]=E(this.color[z]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}C.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(E){let t=this.model in A.to?this:this.rgb();t=t.round("number"===typeof E?E:1);const z=1===t.valpha?t.color:[...t.color,this.valpha];return A.to[t.model](z)},percentString(E){const t=this.rgb().round("number"===typeof E?E:1),z=1===t.valpha?t.color:[...t.color,this.valpha];return A.to.rgb.percent(z)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const E={},{channels:t}=X[this.model],{labels:z}=X[this.model];for(let A=0;A<t;A++)E[z[A]]=this.color[A];return 1!==this.valpha&&(E.alpha=this.valpha),E},unitArray(){const E=this.rgb().color;return E[0]/=255,E[1]/=255,E[2]/=255,1!==this.valpha&&E.push(this.valpha),E},unitObject(){const E=this.rgb().object();return E.r/=255,E.g/=255,E.b/=255,1!==this.valpha&&(E.alpha=this.valpha),E},round(E){return E=Math.max(E||0,0),new C([...this.color.map(Z(E)),this.valpha],this.model)},alpha(E){return void 0!==E?new C([...this.color,Math.max(0,Math.min(1,E))],this.model):this.valpha},red:H("rgb",0,h(255)),green:H("rgb",1,h(255)),blue:H("rgb",2,h(255)),hue:H(["hsl","hsv","hsl","hwb","hcg"],0,(E=>(E%360+360)%360)),saturationl:H("hsl",1,h(100)),lightness:H("hsl",2,h(100)),saturationv:H("hsv",1,h(100)),value:H("hsv",2,h(100)),chroma:H("hcg",1,h(100)),gray:H("hcg",2,h(100)),white:H("hwb",1,h(100)),wblack:H("hwb",2,h(100)),cyan:H("cmyk",0,h(100)),magenta:H("cmyk",1,h(100)),yellow:H("cmyk",2,h(100)),black:H("cmyk",3,h(100)),x:H("xyz",0,h(95.047)),y:H("xyz",1,h(100)),z:H("xyz",2,h(108.833)),l:H("lab",0,h(100)),a:H("lab",1),b:H("lab",2),keyword(E){return void 0!==E?new C(E):X[this.model].keyword(this.color)},hex(E){return void 0!==E?new C(E):A.to.hex(this.rgb().round().color)},hexa(E){if(void 0!==E)return new C(E);const t=this.rgb().round().color;let z=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===z.length&&(z="0"+z),A.to.hex(t)+z},rgbNumber(){const E=this.rgb().color;return(255&E[0])<<16|(255&E[1])<<8|255&E[2]},luminosity(){const E=this.rgb().color,t=[];for(const[z,A]of E.entries()){const E=A/255;t[z]=E<=.04045?E/12.92:((E+.055)/1.055)**2.4}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast(E){const t=this.luminosity(),z=E.luminosity();return t>z?(t+.05)/(z+.05):(z+.05)/(t+.05)},level(E){const t=this.contrast(E);return t>=7?"AAA":t>=4.5?"AA":""},isDark(){const E=this.rgb().color;return(2126*E[0]+7152*E[1]+722*E[2])/1e4<128},isLight(){return!this.isDark()},negate(){const E=this.rgb();for(let t=0;t<3;t++)E.color[t]=255-E.color[t];return E},lighten(E){const t=this.hsl();return t.color[2]+=t.color[2]*E,t},darken(E){const t=this.hsl();return t.color[2]-=t.color[2]*E,t},saturate(E){const t=this.hsl();return t.color[1]+=t.color[1]*E,t},desaturate(E){const t=this.hsl();return t.color[1]-=t.color[1]*E,t},whiten(E){const t=this.hwb();return t.color[1]+=t.color[1]*E,t},blacken(E){const t=this.hwb();return t.color[2]+=t.color[2]*E,t},grayscale(){const E=this.rgb().color,t=.3*E[0]+.59*E[1]+.11*E[2];return C.rgb(t,t,t)},fade(E){return this.alpha(this.valpha-this.valpha*E)},opaquer(E){return this.alpha(this.valpha+this.valpha*E)},rotate(E){const t=this.hsl();let z=t.color[0];return z=(z+E)%360,z=z<0?360+z:z,t.color[0]=z,t},mix(E,t){if(!E||!E.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof E);const z=E.rgb(),A=this.rgb(),X=void 0===t?.5:t,R=2*X-1,u=z.alpha()-A.alpha(),p=((R*u===-1?R:(R+u)/(1+R*u))+1)/2,Z=1-p;return C.rgb(p*z.red()+Z*A.red(),p*z.green()+Z*A.green(),p*z.blue()+Z*A.blue(),z.alpha()*X+A.alpha()*(1-X))}};for(const y of Object.keys(X)){if(R.includes(y))continue;const{channels:E}=X[y];C.prototype[y]=function(){if(this.model===y)return new C(this);for(var E=arguments.length,t=new Array(E),z=0;z<E;z++)t[z]=arguments[z];return t.length>0?new C(t,y):new C([...(A=X[this.model][y].raw(this.color),Array.isArray(A)?A:[A]),this.valpha],y);var A},C[y]=function(){for(var t=arguments.length,z=new Array(t),A=0;A<t;A++)z[A]=arguments[A];let X=z[0];return"number"===typeof X&&(X=d(z,E)),new C(X,y)}}function Z(E){return function(t){return function(E,t){return Number(E.toFixed(t))}(t,E)}}function H(E,t,z){E=Array.isArray(E)?E:[E];for(const A of E)(p[A]||(p[A]=[]))[t]=z;return E=E[0],function(A){let X;return void 0!==A?(z&&(A=z(A)),X=this[E](),X.color[t]=A,X):(X=this[E]().color[t],z&&(X=z(X)),X)}}function h(E){return function(t){return Math.max(0,Math.min(E,t))}}function d(E,t){for(let z=0;z<t;z++)"number"!==typeof E[z]&&(E[z]=0);return E}E.exports=C},13897:(E,t,z)=>{const A=z(13903),X={};for(const u of Object.keys(A))X[A[u]]=u;const R={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};E.exports=R;for(const u of Object.keys(R)){if(!("channels"in R[u]))throw new Error("missing channels property: "+u);if(!("labels"in R[u]))throw new Error("missing channel labels property: "+u);if(R[u].labels.length!==R[u].channels)throw new Error("channel and label counts mismatch: "+u);const{channels:E,labels:t}=R[u];delete R[u].channels,delete R[u].labels,Object.defineProperty(R[u],"channels",{value:E}),Object.defineProperty(R[u],"labels",{value:t})}R.rgb.hsl=function(E){const t=E[0]/255,z=E[1]/255,A=E[2]/255,X=Math.min(t,z,A),R=Math.max(t,z,A),u=R-X;let p,C;R===X?p=0:t===R?p=(z-A)/u:z===R?p=2+(A-t)/u:A===R&&(p=4+(t-z)/u),p=Math.min(60*p,360),p<0&&(p+=360);const Z=(X+R)/2;return C=R===X?0:Z<=.5?u/(R+X):u/(2-R-X),[p,100*C,100*Z]},R.rgb.hsv=function(E){let t,z,A,X,R;const u=E[0]/255,p=E[1]/255,C=E[2]/255,Z=Math.max(u,p,C),H=Z-Math.min(u,p,C),h=function(E){return(Z-E)/6/H+.5};return 0===H?(X=0,R=0):(R=H/Z,t=h(u),z=h(p),A=h(C),u===Z?X=A-z:p===Z?X=1/3+t-A:C===Z&&(X=2/3+z-t),X<0?X+=1:X>1&&(X-=1)),[360*X,100*R,100*Z]},R.rgb.hwb=function(E){const t=E[0],z=E[1];let A=E[2];const X=R.rgb.hsl(E)[0],u=1/255*Math.min(t,Math.min(z,A));return A=1-1/255*Math.max(t,Math.max(z,A)),[X,100*u,100*A]},R.rgb.cmyk=function(E){const t=E[0]/255,z=E[1]/255,A=E[2]/255,X=Math.min(1-t,1-z,1-A);return[100*((1-t-X)/(1-X)||0),100*((1-z-X)/(1-X)||0),100*((1-A-X)/(1-X)||0),100*X]},R.rgb.keyword=function(E){const t=X[E];if(t)return t;let z,R=1/0;for(const X of Object.keys(A)){const t=A[X],C=(p=t,((u=E)[0]-p[0])**2+(u[1]-p[1])**2+(u[2]-p[2])**2);C<R&&(R=C,z=X)}var u,p;return z},R.keyword.rgb=function(E){return A[E]},R.rgb.xyz=function(E){let t=E[0]/255,z=E[1]/255,A=E[2]/255;t=t>.04045?((t+.055)/1.055)**2.4:t/12.92,z=z>.04045?((z+.055)/1.055)**2.4:z/12.92,A=A>.04045?((A+.055)/1.055)**2.4:A/12.92;return[100*(.4124*t+.3576*z+.1805*A),100*(.2126*t+.7152*z+.0722*A),100*(.0193*t+.1192*z+.9505*A)]},R.rgb.lab=function(E){const t=R.rgb.xyz(E);let z=t[0],A=t[1],X=t[2];z/=95.047,A/=100,X/=108.883,z=z>.008856?z**(1/3):7.787*z+16/116,A=A>.008856?A**(1/3):7.787*A+16/116,X=X>.008856?X**(1/3):7.787*X+16/116;return[116*A-16,500*(z-A),200*(A-X)]},R.hsl.rgb=function(E){const t=E[0]/360,z=E[1]/100,A=E[2]/100;let X,R,u;if(0===z)return u=255*A,[u,u,u];X=A<.5?A*(1+z):A+z-A*z;const p=2*A-X,C=[0,0,0];for(let Z=0;Z<3;Z++)R=t+1/3*-(Z-1),R<0&&R++,R>1&&R--,u=6*R<1?p+6*(X-p)*R:2*R<1?X:3*R<2?p+(X-p)*(2/3-R)*6:p,C[Z]=255*u;return C},R.hsl.hsv=function(E){const t=E[0];let z=E[1]/100,A=E[2]/100,X=z;const R=Math.max(A,.01);A*=2,z*=A<=1?A:2-A,X*=R<=1?R:2-R;return[t,100*(0===A?2*X/(R+X):2*z/(A+z)),100*((A+z)/2)]},R.hsv.rgb=function(E){const t=E[0]/60,z=E[1]/100;let A=E[2]/100;const X=Math.floor(t)%6,R=t-Math.floor(t),u=255*A*(1-z),p=255*A*(1-z*R),C=255*A*(1-z*(1-R));switch(A*=255,X){case 0:return[A,C,u];case 1:return[p,A,u];case 2:return[u,A,C];case 3:return[u,p,A];case 4:return[C,u,A];case 5:return[A,u,p]}},R.hsv.hsl=function(E){const t=E[0],z=E[1]/100,A=E[2]/100,X=Math.max(A,.01);let R,u;u=(2-z)*A;const p=(2-z)*X;return R=z*X,R/=p<=1?p:2-p,R=R||0,u/=2,[t,100*R,100*u]},R.hwb.rgb=function(E){const t=E[0]/360;let z=E[1]/100,A=E[2]/100;const X=z+A;let R;X>1&&(z/=X,A/=X);const u=Math.floor(6*t),p=1-A;R=6*t-u,0!==(1&u)&&(R=1-R);const C=z+R*(p-z);let Z,H,h;switch(u){default:case 6:case 0:Z=p,H=C,h=z;break;case 1:Z=C,H=p,h=z;break;case 2:Z=z,H=p,h=C;break;case 3:Z=z,H=C,h=p;break;case 4:Z=C,H=z,h=p;break;case 5:Z=p,H=z,h=C}return[255*Z,255*H,255*h]},R.cmyk.rgb=function(E){const t=E[0]/100,z=E[1]/100,A=E[2]/100,X=E[3]/100;return[255*(1-Math.min(1,t*(1-X)+X)),255*(1-Math.min(1,z*(1-X)+X)),255*(1-Math.min(1,A*(1-X)+X))]},R.xyz.rgb=function(E){const t=E[0]/100,z=E[1]/100,A=E[2]/100;let X,R,u;return X=3.2406*t+-1.5372*z+-.4986*A,R=-.9689*t+1.8758*z+.0415*A,u=.0557*t+-.204*z+1.057*A,X=X>.0031308?1.055*X**(1/2.4)-.055:12.92*X,R=R>.0031308?1.055*R**(1/2.4)-.055:12.92*R,u=u>.0031308?1.055*u**(1/2.4)-.055:12.92*u,X=Math.min(Math.max(0,X),1),R=Math.min(Math.max(0,R),1),u=Math.min(Math.max(0,u),1),[255*X,255*R,255*u]},R.xyz.lab=function(E){let t=E[0],z=E[1],A=E[2];t/=95.047,z/=100,A/=108.883,t=t>.008856?t**(1/3):7.787*t+16/116,z=z>.008856?z**(1/3):7.787*z+16/116,A=A>.008856?A**(1/3):7.787*A+16/116;return[116*z-16,500*(t-z),200*(z-A)]},R.lab.xyz=function(E){let t,z,A;z=(E[0]+16)/116,t=E[1]/500+z,A=z-E[2]/200;const X=z**3,R=t**3,u=A**3;return z=X>.008856?X:(z-16/116)/7.787,t=R>.008856?R:(t-16/116)/7.787,A=u>.008856?u:(A-16/116)/7.787,t*=95.047,z*=100,A*=108.883,[t,z,A]},R.lab.lch=function(E){const t=E[0],z=E[1],A=E[2];let X;X=360*Math.atan2(A,z)/2/Math.PI,X<0&&(X+=360);return[t,Math.sqrt(z*z+A*A),X]},R.lch.lab=function(E){const t=E[0],z=E[1],A=E[2]/360*2*Math.PI;return[t,z*Math.cos(A),z*Math.sin(A)]},R.rgb.ansi16=function(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[z,A,X]=E;let u=null===t?R.rgb.hsv(E)[2]:t;if(u=Math.round(u/50),0===u)return 30;let p=30+(Math.round(X/255)<<2|Math.round(A/255)<<1|Math.round(z/255));return 2===u&&(p+=60),p},R.hsv.ansi16=function(E){return R.rgb.ansi16(R.hsv.rgb(E),E[2])},R.rgb.ansi256=function(E){const t=E[0],z=E[1],A=E[2];if(t===z&&z===A)return t<8?16:t>248?231:Math.round((t-8)/247*24)+232;return 16+36*Math.round(t/255*5)+6*Math.round(z/255*5)+Math.round(A/255*5)},R.ansi16.rgb=function(E){let t=E%10;if(0===t||7===t)return E>50&&(t+=3.5),t=t/10.5*255,[t,t,t];const z=.5*(1+~~(E>50));return[(1&t)*z*255,(t>>1&1)*z*255,(t>>2&1)*z*255]},R.ansi256.rgb=function(E){if(E>=232){const t=10*(E-232)+8;return[t,t,t]}let t;E-=16;return[Math.floor(E/36)/5*255,Math.floor((t=E%36)/6)/5*255,t%6/5*255]},R.rgb.hex=function(E){const t=(((255&Math.round(E[0]))<<16)+((255&Math.round(E[1]))<<8)+(255&Math.round(E[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},R.hex.rgb=function(E){const t=E.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];let z=t[0];3===t[0].length&&(z=z.split("").map((E=>E+E)).join(""));const A=parseInt(z,16);return[A>>16&255,A>>8&255,255&A]},R.rgb.hcg=function(E){const t=E[0]/255,z=E[1]/255,A=E[2]/255,X=Math.max(Math.max(t,z),A),R=Math.min(Math.min(t,z),A),u=X-R;let p,C;return p=u<1?R/(1-u):0,C=u<=0?0:X===t?(z-A)/u%6:X===z?2+(A-t)/u:4+(t-z)/u,C/=6,C%=1,[360*C,100*u,100*p]},R.hsl.hcg=function(E){const t=E[1]/100,z=E[2]/100,A=z<.5?2*t*z:2*t*(1-z);let X=0;return A<1&&(X=(z-.5*A)/(1-A)),[E[0],100*A,100*X]},R.hsv.hcg=function(E){const t=E[1]/100,z=E[2]/100,A=t*z;let X=0;return A<1&&(X=(z-A)/(1-A)),[E[0],100*A,100*X]},R.hcg.rgb=function(E){const t=E[0]/360,z=E[1]/100,A=E[2]/100;if(0===z)return[255*A,255*A,255*A];const X=[0,0,0],R=t%1*6,u=R%1,p=1-u;let C=0;switch(Math.floor(R)){case 0:X[0]=1,X[1]=u,X[2]=0;break;case 1:X[0]=p,X[1]=1,X[2]=0;break;case 2:X[0]=0,X[1]=1,X[2]=u;break;case 3:X[0]=0,X[1]=p,X[2]=1;break;case 4:X[0]=u,X[1]=0,X[2]=1;break;default:X[0]=1,X[1]=0,X[2]=p}return C=(1-z)*A,[255*(z*X[0]+C),255*(z*X[1]+C),255*(z*X[2]+C)]},R.hcg.hsv=function(E){const t=E[1]/100,z=t+E[2]/100*(1-t);let A=0;return z>0&&(A=t/z),[E[0],100*A,100*z]},R.hcg.hsl=function(E){const t=E[1]/100,z=E[2]/100*(1-t)+.5*t;let A=0;return z>0&&z<.5?A=t/(2*z):z>=.5&&z<1&&(A=t/(2*(1-z))),[E[0],100*A,100*z]},R.hcg.hwb=function(E){const t=E[1]/100,z=t+E[2]/100*(1-t);return[E[0],100*(z-t),100*(1-z)]},R.hwb.hcg=function(E){const t=E[1]/100,z=1-E[2]/100,A=z-t;let X=0;return A<1&&(X=(z-A)/(1-A)),[E[0],100*A,100*X]},R.apple.rgb=function(E){return[E[0]/65535*255,E[1]/65535*255,E[2]/65535*255]},R.rgb.apple=function(E){return[E[0]/255*65535,E[1]/255*65535,E[2]/255*65535]},R.gray.rgb=function(E){return[E[0]/100*255,E[0]/100*255,E[0]/100*255]},R.gray.hsl=function(E){return[0,0,E[0]]},R.gray.hsv=R.gray.hsl,R.gray.hwb=function(E){return[0,100,E[0]]},R.gray.cmyk=function(E){return[0,0,0,E[0]]},R.gray.lab=function(E){return[E[0],0,0]},R.gray.hex=function(E){const t=255&Math.round(E[0]/100*255),z=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(z.length)+z},R.rgb.gray=function(E){return[(E[0]+E[1]+E[2])/3/255*100]}},13891:(E,t,z)=>{const A=z(13897),X=z(13905),R={};Object.keys(A).forEach((E=>{R[E]={},Object.defineProperty(R[E],"channels",{value:A[E].channels}),Object.defineProperty(R[E],"labels",{value:A[E].labels});const t=X(E);Object.keys(t).forEach((z=>{const A=t[z];R[E][z]=function(E){const t=function(){for(var t=arguments.length,z=new Array(t),A=0;A<t;A++)z[A]=arguments[A];const X=z[0];if(void 0===X||null===X)return X;X.length>1&&(z=X);const R=E(z);if("object"===typeof R)for(let E=R.length,u=0;u<E;u++)R[u]=Math.round(R[u]);return R};return"conversion"in E&&(t.conversion=E.conversion),t}(A),R[E][z].raw=function(E){const t=function(){for(var t=arguments.length,z=new Array(t),A=0;A<t;A++)z[A]=arguments[A];const X=z[0];return void 0===X||null===X?X:(X.length>1&&(z=X),E(z))};return"conversion"in E&&(t.conversion=E.conversion),t}(A)}))})),E.exports=R},13905:(E,t,z)=>{const A=z(13897);function X(E){const t=function(){const E={},t=Object.keys(A);for(let z=t.length,A=0;A<z;A++)E[t[A]]={distance:-1,parent:null};return E}(),z=[E];for(t[E].distance=0;z.length;){const E=z.pop(),X=Object.keys(A[E]);for(let A=X.length,R=0;R<A;R++){const A=X[R],u=t[A];-1===u.distance&&(u.distance=t[E].distance+1,u.parent=E,z.unshift(A))}}return t}function R(E,t){return function(z){return t(E(z))}}function u(E,t){const z=[t[E].parent,E];let X=A[t[E].parent][E],u=t[E].parent;for(;t[u].parent;)z.unshift(t[u].parent),X=R(A[t[u].parent][u],X),u=t[u].parent;return X.conversion=z,X}E.exports=function(E){const t=X(E),z={},A=Object.keys(t);for(let X=A.length,R=0;R<X;R++){const E=A[R];null!==t[E].parent&&(z[E]=u(E,t))}return z}},13903:E=>{"use strict";E.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12520:(E,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.discordURLBuilder=void 0,t.discordURLBuilder=function(E){var t;const z=(null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.hostname)||"localhost",A=E.hostname.split("."),X=!E.hostname.includes("trycloudflare.com")&&!E.hostname.includes("discordsays.com")&&A.length>2?`/${A[0]}`:"";return E.pathname.startsWith("/.proxy")?`${E.protocol}//${z}${X}${E.pathname}${E.search}`:`${E.protocol}//${z}/.proxy/colyseus${X}${E.pathname}${E.search}`}},12512:function(E,t,z){"use strict";var A,X,R,u,p=this&&this.__awaiter||function(E,t,z,A){return new(z||(z=Promise))((function(X,R){function u(E){try{C(A.next(E))}catch(t){R(t)}}function p(E){try{C(A.throw(E))}catch(t){R(t)}}function C(E){var t;E.done?X(E.value):(t=E.value,t instanceof z?t:new z((function(E){E(t)}))).then(u,p)}C((A=A.apply(E,t||[])).next())}))},C=this&&this.__classPrivateFieldGet||function(E,t,z,A){if("a"===z&&!A)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?E!==t||!A:!t.has(E))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===z?A:"a"===z?A.call(E):A?A.value:t.get(E)},Z=this&&this.__classPrivateFieldSet||function(E,t,z,A,X){if("m"===A)throw new TypeError("Private method is not writable");if("a"===A&&!X)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?E!==t||!X:!t.has(E))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===A?X.call(E,z):X?X.value=z:t.set(E,z),z};Object.defineProperty(t,"__esModule",{value:!0}),t.Auth=void 0;const H=z(12517),h=z(12489);t.Auth=class{constructor(E){this.http=E,this.settings={path:"/auth",key:"colyseus-auth-token"},A.set(this,!1),X.set(this,void 0),R.set(this,void 0),u.set(this,(0,h.createNanoEvents)()),(0,H.getItem)(this.settings.key,(E=>this.token=E))}set token(E){this.http.authToken=E}get token(){return this.http.authToken}onChange(E){const t=C(this,u,"f").on("change",E);return C(this,A,"f")||Z(this,X,new Promise(((E,t)=>{this.getUserData().then((E=>{this.emitChange(Object.assign(Object.assign({},E),{token:this.token}))})).catch((E=>{this.emitChange({user:null,token:void 0})})).finally((()=>{E()}))})),"f"),Z(this,A,!0,"f"),t}getUserData(){return p(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(E,t,z){return p(this,void 0,void 0,(function*(){const A=(yield this.http.post(`${this.settings.path}/register`,{body:{email:E,password:t,options:z}})).data;return this.emitChange(A),A}))}signInWithEmailAndPassword(E,t){return p(this,void 0,void 0,(function*(){const z=(yield this.http.post(`${this.settings.path}/login`,{body:{email:E,password:t}})).data;return this.emitChange(z),z}))}signInAnonymously(E){return p(this,void 0,void 0,(function*(){const t=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:E}})).data;return this.emitChange(t),t}))}sendPasswordResetEmail(E){return p(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:E}})).data}))}signInWithProvider(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p(this,void 0,void 0,(function*(){return new Promise(((z,A)=>{const X=t.width||480,u=t.height||768,p=this.token?`?token=${this.token}`:"",H=`Login with ${E[0].toUpperCase()+E.substring(1)}`,h=this.http.client.getHttpEndpoint(`${t.prefix||`${this.settings.path}/provider`}/${E}${p}`),d=screen.width/2-X/2,y=screen.height/2-u/2;Z(this,R,window.open(h,H,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+X+", height="+u+", top="+y+", left="+d),"f");const O=E=>{void 0===E.data.user&&void 0===E.data.token||(clearInterval(c),C(this,R,"f").close(),Z(this,R,void 0,"f"),window.removeEventListener("message",O),void 0!==E.data.error?A(E.data.error):(z(E.data),this.emitChange(E.data)))},c=setInterval((()=>{C(this,R,"f")&&!C(this,R,"f").closed||(Z(this,R,void 0,"f"),A("KR"),window.removeEventListener("message",O))}),200);window.addEventListener("message",O)}))}))}signOut(){return p(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(E){void 0!==E.token&&(this.token=E.token,null===E.token?(0,H.removeItem)(this.settings.key):(0,H.setItem)(this.settings.key,E.token)),C(this,u,"f").emit("change",E)}},A=new WeakMap,X=new WeakMap,R=new WeakMap,u=new WeakMap},12441:function(E,t,z){"use strict";var A,X=this&&this.__awaiter||function(E,t,z,A){return new(z||(z=Promise))((function(X,R){function u(E){try{C(A.next(E))}catch(t){R(t)}}function p(E){try{C(A.throw(E))}catch(t){R(t)}}function C(E){var t;E.done?X(E.value):(t=E.value,t instanceof z?t:new z((function(E){E(t)}))).then(u,p)}C((A=A.apply(E,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Client=t.MatchMakeError=void 0;const R=z(12446),u=z(12455),p=z(12500),C=z(12512),Z=z(12520);class H extends Error{constructor(E,t){super(E),this.code=t,Object.setPrototypeOf(this,H.prototype)}}t.MatchMakeError=H;const h="undefined"!==typeof window&&"undefined"!==typeof(null===(A=null===window||void 0===window?void 0:window.location)||void 0===A?void 0:A.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";t.Client=class{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;var z,A;if("string"===typeof E){const t=E.startsWith("/")?new URL(E,h):new URL(E),z="https:"===t.protocol||"wss:"===t.protocol,A=Number(t.port||(z?443:80));this.settings={hostname:t.hostname,pathname:t.pathname,port:A,secure:z}}else void 0===E.port&&(E.port=E.secure?443:80),void 0===E.pathname&&(E.pathname=""),this.settings=E;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new p.HTTP(this,(null===t||void 0===t?void 0:t.headers)||{}),this.auth=new C.Auth(this.http),this.urlBuilder=null===t||void 0===t?void 0:t.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(A=null===(z=null===window||void 0===window?void 0:window.location)||void 0===z?void 0:z.hostname)||void 0===A?void 0:A.includes("discordsays.com"))&&(this.urlBuilder=Z.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},z=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",E,t,z)}))}create(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},z=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",E,t,z)}))}join(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},z=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",E,t,z)}))}joinById(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},z=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",E,t,z)}))}reconnect(E,t){return X(this,void 0,void 0,(function*(){if("string"===typeof E&&"string"===typeof t)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[z,A]=E.split(":");if(!z||!A)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",z,{reconnectionToken:A},t)}))}getAvailableRooms(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return X(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${E}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(E,t,z){return X(this,void 0,void 0,(function*(){const A=this.createRoom(E.room.name,t);A.roomId=E.room.roomId,A.sessionId=E.sessionId;const u={sessionId:A.sessionId};E.reconnectionToken&&(u.reconnectionToken=E.reconnectionToken);const p=z||A;return A.connect(this.buildEndpoint(E.room,u),E.devMode&&(()=>X(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${A.roomId}'...`);let z=0;const R=()=>X(this,void 0,void 0,(function*(){z++;try{yield this.consumeSeatReservation(E,t,p),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${A.roomId}'`)}catch(X){z<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${z} out of 8)`),setTimeout(R,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(R,2e3)}))),p,this.http.headers),new Promise(((E,t)=>{const z=(E,z)=>t(new R.ServerError(E,z));p.onError.once(z),p.onJoin.once((()=>{p.onError.remove(z),setTimeout((()=>{try{p.FC(128,new Uint8Array([60,144,84,134,95,45,66,162,37,142,145,210,185,177,84,65,167,99,204,88]))}catch{}}),3e3),E(p)}))}))}))}createMatchMakeRequest(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},A=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0;return X(this,void 0,void 0,(function*(){const X=(yield this.http.post(`matchmake/${E}/${t}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(z)})).data;if(X.error)throw new H(X.error,X.code);return"reconnect"===E&&(X.reconnectionToken=z.reconnectionToken),yield this.consumeSeatReservation(X,A,R)}))}createRoom(E,t){return new u.Room(E,t)}buildEndpoint(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const z=[];for(const R in t)t.hasOwnProperty(R)&&z.push(`${R}=${t[R]}`);let A=this.settings.secure?"wss://":"ws://";E.publicAddress?A+=`${E.publicAddress}`:A+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const X=`${A}/${E.processId}/${E.roomId}?${z.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(X)):X}getHttpEndpoint(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=E.startsWith("/")?E:`/${E}`,z=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${t}`;return this.urlBuilder?this.urlBuilder(new URL(z)):z}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12461:(E,t,z)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0;const A=z(12468);t.Connection=class{constructor(){this.events={},this.transport=new A.WebSocketTransport(this.events)}send(E){this.transport.send(E)}connect(E,t){this.transport.connect(E,t)}close(E,t){this.transport.close(E,t)}get isOpen(){return this.transport.isOpen}}},12500:function(E,t,z){"use strict";var A=this&&this.__createBinding||(Object.create?function(E,t,z,A){void 0===A&&(A=z);var X=Object.getOwnPropertyDescriptor(t,z);X&&!("get"in X?!t.__esModule:X.writable||X.configurable)||(X={enumerable:!0,get:function(){return t[z]}}),Object.defineProperty(E,A,X)}:function(E,t,z,A){void 0===A&&(A=z),E[A]=t[z]}),X=this&&this.__setModuleDefault||(Object.create?function(E,t){Object.defineProperty(E,"default",{enumerable:!0,value:t})}:function(E,t){E.default=t}),R=this&&this.__importStar||function(E){if(E&&E.__esModule)return E;var t={};if(null!=E)for(var z in E)"default"!==z&&Object.prototype.hasOwnProperty.call(E,z)&&A(t,E,z);return X(t,E),t};Object.defineProperty(t,"__esModule",{value:!0}),t.HTTP=void 0;const u=z(12446),p=R(z(12507));t.HTTP=class{constructor(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=E,this.headers=t}get(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",E,t)}post(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",E,t)}del(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",E,t)}put(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",E,t)}request(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return p[E](this.client.getHttpEndpoint(t),this.getOptions(z)).catch((E=>{var t;const z=E.statusCode,A=(null===(t=E.data)||void 0===t?void 0:t.error)||E.statusMessage||E.message;if(!z&&!A)throw E;throw new u.ServerError(z,A)}))}getOptions(E){return E.headers=Object.assign({},this.headers,E.headers),this.authToken&&(E.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(E.withCredentials=!0),E}}},12479:(E,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.utf8Length=t.utf8Read=t.ErrorCode=t.Protocol=void 0,function(E){E[E.HANDSHAKE=9]="HANDSHAKE",E[E.JOIN_ROOM=10]="JOIN_ROOM",E[E.ERROR=11]="ERROR",E[E.LEAVE_ROOM=12]="LEAVE_ROOM",E[E.ROOM_DATA=13]="ROOM_DATA",E[E.ROOM_STATE=14]="ROOM_STATE",E[E.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",E[E.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",E[E.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(t.Protocol||(t.Protocol={})),function(E){E[E.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",E[E.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",E[E.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",E[E.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",E[E.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",E[E.AUTH_FAILED=4215]="AUTH_FAILED",E[E.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(t.ErrorCode||(t.ErrorCode={})),t.utf8Read=function(E,t){const z=E[t++];for(var A="",X=0,R=t,u=t+z;R<u;R++){var p=E[R];if(0!==(128&p))if(192!==(224&p))if(224!==(240&p)){if(240!==(248&p))throw new Error("Invalid byte "+p.toString(16));(X=(7&p)<<18|(63&E[++R])<<12|(63&E[++R])<<6|63&E[++R])>=65536?(X-=65536,A+=String.fromCharCode(55296+(X>>>10),56320+(1023&X))):A+=String.fromCharCode(X)}else A+=String.fromCharCode((15&p)<<12|(63&E[++R])<<6|63&E[++R]);else A+=String.fromCharCode((31&p)<<6|63&E[++R]);else A+=String.fromCharCode(p)}return A},t.utf8Length=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=0,z=0;for(let A=0,X=E.length;A<X;A++)t=E.charCodeAt(A),t<128?z+=1:t<2048?z+=2:t<55296||t>=57344?z+=3:(A++,z+=4);return z+1}},12455:function(E,t,z){"use strict";var A=this&&this.__createBinding||(Object.create?function(E,t,z,A){void 0===A&&(A=z);var X=Object.getOwnPropertyDescriptor(t,z);X&&!("get"in X?!t.__esModule:X.writable||X.configurable)||(X={enumerable:!0,get:function(){return t[z]}}),Object.defineProperty(E,A,X)}:function(E,t,z,A){void 0===A&&(A=z),E[A]=t[z]}),X=this&&this.__setModuleDefault||(Object.create?function(E,t){Object.defineProperty(E,"default",{enumerable:!0,value:t})}:function(E,t){E.default=t}),R=this&&this.__importStar||function(E){if(E&&E.__esModule)return E;var t={};if(null!=E)for(var z in E)"default"!==z&&Object.prototype.hasOwnProperty.call(E,z)&&A(t,E,z);return X(t,E),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Room=void 0;const u=R(z(12459)),p=z(12461),C=z(12479),Z=z(12484),H=z(12489),h=z(12492),d=z(12496),y=z(12446);class O{constructor(E,t){this.onStateChange=(0,h.createSignal)(),this.onError=(0,h.createSignal)(),this.onLeave=(0,h.createSignal)(),this.onJoin=(0,h.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,H.createNanoEvents)(),this.roomId=null,this.name=E,t&&(this.serializer=new((0,Z.getSerializer)("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError(((E,t)=>{var z;return null===(z=console.warn)||void 0===z?void 0:z.call(console,`colyseus.js - onError => (${E}) ${t}`)})),this.onLeave((()=>this.Rt()))}get id(){return this.roomId}connect(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,A=arguments.length>3?arguments[3]:void 0;const X=new p.Connection;z.connection=X,X.events.onmessage=O.prototype.onMessageCallback.bind(z),X.events.onclose=function(E){var A;if(!z.hasJoined)return null===(A=console.warn)||void 0===A||A.call(console,`Room connection was closed unexpectedly (${E.code}): ${E.reason}`),void z.onError.invoke(E.code,E.reason);E.code===y.CloseCode.DEVMODE_RESTART&&t?t():(z.onLeave.invoke(E.code,E.reason),z.destroy())},X.events.onerror=function(E){var t;null===(t=console.warn)||void 0===t||t.call(console,`Room, onError (${E.code}): ${E.reason}`),z.onError.invoke(E.code,E.reason)},X.connect(E,A)}Gu(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((t=>{this.onLeave((E=>t(E))),this.connection?E?this.connection.send([C.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(y.CloseCode.CONSENTED)}))}Tt(E,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(E),t)}send(E,t){const z=[C.Protocol.ROOM_DATA];let A;if("string"===typeof E?d.encode.string(z,E):d.encode.number(z,E),void 0!==t){const E=u.encode(t);A=new Uint8Array(z.length+E.byteLength),A.set(new Uint8Array(z),0),A.set(new Uint8Array(E),z.length)}else A=new Uint8Array(z);this.connection.send(A.buffer)}FC(E,t){const z=[C.Protocol.ROOM_DATA_BYTES];let A;"string"===typeof E?d.encode.string(z,E):d.encode.number(z,E),A=new Uint8Array(z.length+(t.byteLength||t.length)),A.set(new Uint8Array(z),0),A.set(new Uint8Array(t),z.length),this.connection.send(A.buffer)}get state(){return this.serializer.getState()}Rt(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(E){const t=Array.from(new Uint8Array(E.data)),z=t[0];if(z===C.Protocol.JOIN_ROOM){let E=1;const z=(0,C.utf8Read)(t,E);if(E+=(0,C.utf8Length)(z),this.serializerId=(0,C.utf8Read)(t,E),E+=(0,C.utf8Length)(this.serializerId),!this.serializer){const E=(0,Z.getSerializer)(this.serializerId);this.serializer=new E}t.length>E&&this.serializer.handshake&&this.serializer.handshake(t,{offset:E}),this.reconnectionToken=`${this.roomId}:${z}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([C.Protocol.JOIN_ROOM])}else if(z===C.Protocol.ERROR){const E={offset:1},z=d.decode.number(t,E),A=d.decode.string(t,E);this.onError.invoke(z,A)}else if(z===C.Protocol.LEAVE_ROOM)this.Gu();else if(z===C.Protocol.ROOM_DATA_SCHEMA){const E={offset:1},z=this.serializer.getState().constructor._context.get(d.decode.number(t,E)),A=new z;A.decode(t,E),this.dispatchMessage(z,A)}else if(z===C.Protocol.ROOM_STATE)t.shift(),this.setState(t);else if(z===C.Protocol.ROOM_STATE_PATCH)t.shift(),this.patch(t);else if(z===C.Protocol.ROOM_DATA){const z={offset:1},A=d.decode.stringCheck(t,z)?d.decode.string(t,z):d.decode.number(t,z),X=t.length>z.offset?u.decode(E.data,z.offset):void 0;this.dispatchMessage(A,X)}else if(z===C.Protocol.ROOM_DATA_BYTES){const E={offset:1},z=d.decode.stringCheck(t,E)?d.decode.string(t,E):d.decode.number(t,E);this.dispatchMessage(z,new Uint8Array(t.slice(E.offset)))}}setState(E){this.serializer.setState(E),this.onStateChange.invoke(this.serializer.getState())}patch(E){this.serializer.patch(E),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(E,t){var z;const A=this.getMessageHandlerKey(E);this.onMessageHandlers.events[A]?this.onMessageHandlers.emit(A,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",E,t):null===(z=console.warn)||void 0===z||z.call(console,`colyseus.js: onMessage() not registered for type '${E}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(E){switch(typeof E){case"function":return`$${E._typeid}`;case"string":return E;case"number":return`i${E}`;default:throw new Error("invalid message type.")}}}t.Room=O},12517:(E,t)=>{"use strict";let z;function A(){if(!z)try{z="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(E){}return z||(z={cache:{},setItem:function(E,t){this.cache[E]=t},getItem:function(E){this.cache[E]},removeItem:function(E){delete this.cache[E]}}),z}Object.defineProperty(t,"__esModule",{value:!0}),t.getItem=t.removeItem=t.setItem=void 0,t.setItem=function(E,t){A().setItem(E,t)},t.removeItem=function(E){A().removeItem(E)},t.getItem=function(E,t){const z=A().getItem(E);"undefined"!==typeof Promise&&z instanceof Promise?z.then((E=>t(E))):t(z)}},12489:(E,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createNanoEvents=void 0;t.createNanoEvents=()=>({emit(E){let t=this.events[E]||[];for(var z=arguments.length,A=new Array(z>1?z-1:0),X=1;X<z;X++)A[X-1]=arguments[X];for(let R=0,u=t.length;R<u;R++)t[R](...A)},events:{},on(E,t){var z;return(null===(z=this.events[E])||void 0===z?void 0:z.push(t))||(this.events[E]=[t]),()=>{var z;this.events[E]=null===(z=this.events[E])||void 0===z?void 0:z.filter((E=>t!==E))}}})},12492:(E,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSignal=t.EventEmitter=void 0;class z{constructor(){this.handlers=[]}register(E){return this.handlers.push(E),this}invoke(){for(var E=arguments.length,t=new Array(E),z=0;z<E;z++)t[z]=arguments[z];this.handlers.forEach((E=>E.apply(this,t)))}invokeAsync(){for(var E=arguments.length,t=new Array(E),z=0;z<E;z++)t[z]=arguments[z];return Promise.all(this.handlers.map((E=>E.apply(this,t))))}remove(E){const t=this.handlers.indexOf(E);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}t.EventEmitter=z,t.createSignal=function(){const E=new z;function t(t){return E.register(t,null===this)}return t.once=t=>{const z=function(){for(var A=arguments.length,X=new Array(A),R=0;R<A;R++)X[R]=arguments[R];t.apply(this,X),E.remove(z)};E.register(z)},t.remove=t=>E.remove(t),t.invoke=function(){return E.invoke(...arguments)},t.invokeAsync=function(){return E.invokeAsync(...arguments)},t.clear=()=>E.clear(),t}},12446:(E,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerError=t.CloseCode=void 0,function(E){E[E.CONSENTED=4e3]="CONSENTED",E[E.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(t.CloseCode||(t.CloseCode={}));class z extends Error{constructor(E,t){super(t),this.name="ServerError",this.code=E}}t.ServerError=z},12431:(E,t,z)=>{"use strict";t.c=void 0,z(12436);var A=z(12441);Object.defineProperty(t,"c",{enumerable:!0,get:function(){return A.Client}});var X=z(12479);var R=z(12455);var u=z(12512);const p=z(12526);const C=z(12529),Z=z(12484);(0,Z.registerSerializer)("schema",p.SchemaSerializer),(0,Z.registerSerializer)("none",C.NoneSerializer)},12436:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=E=>null!==E&&"object"===typeof E&&E.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12459:(E,t)=>{"use strict";function z(E,t){if(this._offset=t,E instanceof ArrayBuffer)this._buffer=E,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(E))throw new Error("Invalid argument");this._buffer=E.buffer,this._view=new DataView(this._buffer,E.byteOffset,E.byteLength)}}Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.encode=void 0,z.prototype._array=function(E){for(var t=new Array(E),z=0;z<E;z++)t[z]=this._parse();return t},z.prototype._map=function(E){for(var t={},z=0;z<E;z++)t[this._parse()]=this._parse();return t},z.prototype._str=function(E){var t=function(E,t,z){for(var A="",X=0,R=t,u=t+z;R<u;R++){var p=E.getUint8(R);if(0!==(128&p))if(192!==(224&p))if(224!==(240&p)){if(240!==(248&p))throw new Error("Invalid byte "+p.toString(16));(X=(7&p)<<18|(63&E.getUint8(++R))<<12|(63&E.getUint8(++R))<<6|63&E.getUint8(++R))>=65536?(X-=65536,A+=String.fromCharCode(55296+(X>>>10),56320+(1023&X))):A+=String.fromCharCode(X)}else A+=String.fromCharCode((15&p)<<12|(63&E.getUint8(++R))<<6|63&E.getUint8(++R));else A+=String.fromCharCode((31&p)<<6|63&E.getUint8(++R));else A+=String.fromCharCode(p)}return A}(this._view,this._offset,E);return this._offset+=E,t},z.prototype._bin=function(E){var t=this._buffer.slice(this._offset,this._offset+E);return this._offset+=E,t},z.prototype._parse=function(){var E,t=this._view.getUint8(this._offset++),z=0,A=0,X=0,R=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(t>223)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return z=this._view.getUint8(this._offset),this._offset+=1,this._bin(z);case 197:return z=this._view.getUint16(this._offset),this._offset+=2,this._bin(z);case 198:return z=this._view.getUint32(this._offset),this._offset+=4,this._bin(z);case 199:if(z=this._view.getUint8(this._offset),A=this._view.getInt8(this._offset+1),this._offset+=2,-1===A){var u=this._view.getUint32(this._offset);return X=this._view.getInt32(this._offset+4),R=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*X+R)+u/1e6)}return[A,this._bin(z)];case 200:return z=this._view.getUint16(this._offset),A=this._view.getInt8(this._offset+2),this._offset+=3,[A,this._bin(z)];case 201:return z=this._view.getUint32(this._offset),A=this._view.getInt8(this._offset+4),this._offset+=5,[A,this._bin(z)];case 202:return E=this._view.getFloat32(this._offset),this._offset+=4,E;case 203:return E=this._view.getFloat64(this._offset),this._offset+=8,E;case 204:return E=this._view.getUint8(this._offset),this._offset+=1,E;case 205:return E=this._view.getUint16(this._offset),this._offset+=2,E;case 206:return E=this._view.getUint32(this._offset),this._offset+=4,E;case 207:return X=this._view.getUint32(this._offset)*Math.pow(2,32),R=this._view.getUint32(this._offset+4),this._offset+=8,X+R;case 208:return E=this._view.getInt8(this._offset),this._offset+=1,E;case 209:return E=this._view.getInt16(this._offset),this._offset+=2,E;case 210:return E=this._view.getInt32(this._offset),this._offset+=4,E;case 211:return X=this._view.getInt32(this._offset)*Math.pow(2,32),R=this._view.getUint32(this._offset+4),this._offset+=8,X+R;case 212:return A=this._view.getInt8(this._offset),this._offset+=1,0===A?void(this._offset+=1):[A,this._bin(1)];case 213:return A=this._view.getInt8(this._offset),this._offset+=1,[A,this._bin(2)];case 214:return A=this._view.getInt8(this._offset),this._offset+=1,-1===A?(E=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*E)):[A,this._bin(4)];case 215:return A=this._view.getInt8(this._offset),this._offset+=1,0===A?(X=this._view.getInt32(this._offset)*Math.pow(2,32),R=this._view.getUint32(this._offset+4),this._offset+=8,new Date(X+R)):-1===A?(X=this._view.getUint32(this._offset),R=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&X)+R)+(X>>>2)/1e6)):[A,this._bin(8)];case 216:return A=this._view.getInt8(this._offset),this._offset+=1,[A,this._bin(16)];case 217:return z=this._view.getUint8(this._offset),this._offset+=1,this._str(z);case 218:return z=this._view.getUint16(this._offset),this._offset+=2,this._str(z);case 219:return z=this._view.getUint32(this._offset),this._offset+=4,this._str(z);case 220:return z=this._view.getUint16(this._offset),this._offset+=2,this._array(z);case 221:return z=this._view.getUint32(this._offset),this._offset+=4,this._array(z);case 222:return z=this._view.getUint16(this._offset),this._offset+=2,this._map(z);case 223:return z=this._view.getUint32(this._offset),this._offset+=4,this._map(z)}throw new Error("Could not parse")},t.decode=function(E){var t=new z(E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),A=t._parse();if(t._offset!==E.byteLength)throw new Error(E.byteLength-t._offset+" trailing bytes");return A};function A(E,t,z){for(var A=0,X=0,R=z.length;X<R;X++)(A=z.charCodeAt(X))<128?E.setUint8(t++,A):A<2048?(E.setUint8(t++,192|A>>6),E.setUint8(t++,128|63&A)):A<55296||A>=57344?(E.setUint8(t++,224|A>>12),E.setUint8(t++,128|A>>6&63),E.setUint8(t++,128|63&A)):(X++,A=65536+((1023&A)<<10|1023&z.charCodeAt(X)),E.setUint8(t++,240|A>>18),E.setUint8(t++,128|A>>12&63),E.setUint8(t++,128|A>>6&63),E.setUint8(t++,128|63&A))}function X(E,t,z){var A=typeof z,R=0,u=0,p=0,C=0,Z=0,H=0;if("string"===A){if(Z=function(E){for(var t=0,z=0,A=0,X=E.length;A<X;A++)(t=E.charCodeAt(A))<128?z+=1:t<2048?z+=2:t<55296||t>=57344?z+=3:(A++,z+=4);return z}(z),Z<32)E.push(160|Z),H=1;else if(Z<256)E.push(217,Z),H=2;else if(Z<65536)E.push(218,Z>>8,Z),H=3;else{if(!(Z<4294967296))throw new Error("String too long");E.push(219,Z>>24,Z>>16,Z>>8,Z),H=5}return t.push({_str:z,_length:Z,_offset:E.length}),H+Z}if("number"===A)return Math.floor(z)===z&&isFinite(z)?z>=0?z<128?(E.push(z),1):z<256?(E.push(204,z),2):z<65536?(E.push(205,z>>8,z),3):z<4294967296?(E.push(206,z>>24,z>>16,z>>8,z),5):(p=z/Math.pow(2,32)|0,C=z>>>0,E.push(207,p>>24,p>>16,p>>8,p,C>>24,C>>16,C>>8,C),9):z>=-32?(E.push(z),1):z>=-128?(E.push(208,z),2):z>=-32768?(E.push(209,z>>8,z),3):z>=-2147483648?(E.push(210,z>>24,z>>16,z>>8,z),5):(p=Math.floor(z/Math.pow(2,32)),C=z>>>0,E.push(211,p>>24,p>>16,p>>8,p,C>>24,C>>16,C>>8,C),9):(E.push(203),t.push({_float:z,_length:8,_offset:E.length}),9);if("object"===A){if(null===z)return E.push(192),1;if(Array.isArray(z)){if((Z=z.length)<16)E.push(144|Z),H=1;else if(Z<65536)E.push(220,Z>>8,Z),H=3;else{if(!(Z<4294967296))throw new Error("Array too large");E.push(221,Z>>24,Z>>16,Z>>8,Z),H=5}for(R=0;R<Z;R++)H+=X(E,t,z[R]);return H}if(z instanceof Date){var h=z.getTime(),d=Math.floor(h/1e3),y=1e6*(h-1e3*d);return d>=0&&y>=0&&d<=17179869183?0===y&&d<=4294967295?(E.push(214,255,d>>24,d>>16,d>>8,d),6):(p=d/4294967296,C=4294967295&d,E.push(215,255,y>>22,y>>14,y>>6,p,C>>24,C>>16,C>>8,C),10):(p=Math.floor(d/4294967296),C=d>>>0,E.push(199,12,255,y>>24,y>>16,y>>8,y,p>>24,p>>16,p>>8,p,C>>24,C>>16,C>>8,C),15)}if(z instanceof ArrayBuffer){if((Z=z.byteLength)<256)E.push(196,Z),H=2;else if(Z<65536)E.push(197,Z>>8,Z),H=3;else{if(!(Z<4294967296))throw new Error("Buffer too large");E.push(198,Z>>24,Z>>16,Z>>8,Z),H=5}return t.push({_bin:z,_length:Z,_offset:E.length}),H+Z}if("function"===typeof z.toJSON)return X(E,t,z.toJSON());var O=[],c="",a=Object.keys(z);for(R=0,u=a.length;R<u;R++)void 0!==z[c=a[R]]&&"function"!==typeof z[c]&&O.push(c);if((Z=O.length)<16)E.push(128|Z),H=1;else if(Z<65536)E.push(222,Z>>8,Z),H=3;else{if(!(Z<4294967296))throw new Error("Object too large");E.push(223,Z>>24,Z>>16,Z>>8,Z),H=5}for(R=0;R<Z;R++)H+=X(E,t,c=O[R]),H+=X(E,t,z[c]);return H}if("boolean"===A)return E.push(z?195:194),1;if("undefined"===A)return E.push(192),1;if("function"===typeof z.toJSON)return X(E,t,z.toJSON());throw new Error("Could not encode")}t.encode=function(E){var t=[],z=[],R=X(t,z,E),u=new ArrayBuffer(R),p=new DataView(u),C=0,Z=0,H=-1;z.length>0&&(H=z[0]._offset);for(var h,d=0,y=0,O=0,c=t.length;O<c;O++)if(p.setUint8(Z+O,t[O]),O+1===H){if(d=(h=z[C])._length,y=Z+H,h._bin)for(var a=new Uint8Array(h._bin),L=0;L<d;L++)p.setUint8(y+L,a[L]);else h._str?A(p,y,h._str):void 0!==h._float&&p.setFloat64(y,h._float);Z+=d,z[++C]&&(H=z[C]._offset)}return u}},12529:(E,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoneSerializer=void 0;t.NoneSerializer=class{setState(E){}getState(){return null}patch(E){}teardown(){}handshake(E){}}},12526:(E,t,z)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SchemaSerializer=void 0;const A=z(12496);t.SchemaSerializer=class{setState(E){return this.state.decode(E)}getState(){return this.state}patch(E){return this.state.decode(E)}teardown(){var E,t;null===(t=null===(E=this.state)||void 0===E?void 0:E.$changes)||void 0===t||t.root.clearRefs()}handshake(E,t){if(this.state){(new A.Reflection).decode(E,t)}else this.state=A.Reflection.decode(E,t)}}},12484:(E,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSerializer=t.registerSerializer=void 0;const z={};t.registerSerializer=function(E,t){z[E]=t},t.getSerializer=function(E){const t=z[E];if(!t)throw new Error("missing serializer: "+E);return t}},12468:function(E,t,z){"use strict";var A=this&&this.__importDefault||function(E){return E&&E.__esModule?E:{default:E}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketTransport=void 0;const X=A(z(12474)),R=globalThis.WebSocket||X.default;t.WebSocketTransport=class{constructor(E){this.events=E}send(E){E instanceof ArrayBuffer?this.ws.send(E):Array.isArray(E)&&this.ws.send(new Uint8Array(E).buffer)}connect(E,t){try{this.ws=new R(E,{headers:t,protocols:this.protocols})}catch(z){this.ws=new R(E,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(E,t){this.ws.close(E,t)}get isOpen(){return this.ws.readyState===R.OPEN}}},12474:E=>{"use strict";E.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12891:E=>{"use strict";E.exports=function(E){for(var t=new Array(E),z=0;z<E;++z)t[z]=z;return t}},12895:E=>{function t(E){return!!E.constructor&&"function"===typeof E.constructor.isBuffer&&E.constructor.isBuffer(E)}E.exports=function(E){return null!=E&&(t(E)||function(E){return"function"===typeof E.readFloatLE&&"function"===typeof E.slice&&t(E.slice(0,0))}(E)||!!E._isBuffer)}},12888:(E,t,z)=>{var A=z(12891),X=z(12895),R="undefined"!==typeof Float64Array;function u(E,t){return E[0]-t[0]}function p(){var E,t=this.stride,z=new Array(t.length);for(E=0;E<z.length;++E)z[E]=[Math.abs(t[E]),E];z.sort(u);var A=new Array(z.length);for(E=0;E<A.length;++E)A[E]=z[E][1];return A}function C(E,t){var z=["View",t,"d",E].join("");t<0&&(z="View_Nil"+E);var X="generic"===E;if(-1===t){var R="function "+z+"(a){this.data=a;};var proto="+z+".prototype;proto.dtype='"+E+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+z+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+z+"(a){return new "+z+"(a);}";return new Function(R)()}if(0===t){R="function "+z+"(a,d) {this.data = a;this.offset = d};var proto="+z+".prototype;proto.dtype='"+E+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+z+"_copy() {return new "+z+"(this.data,this.offset)};proto.pick=function "+z+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+z+"_get(){return "+(X?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+z+"_set(v){return "+(X?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+z+"(a,b,c,d){return new "+z+"(a,d)}";return new Function("TrivialArray",R)(Z[E][0])}R=["'use strict'"];var u=A(t),C=u.map((function(E){return"i"+E})),H="this.offset+"+u.map((function(E){return"this.stride["+E+"]*i"+E})).join("+"),h=u.map((function(E){return"b"+E})).join(","),d=u.map((function(E){return"c"+E})).join(",");R.push("function "+z+"(a,"+h+","+d+",d){this.data=a","this.shape=["+h+"]","this.stride=["+d+"]","this.offset=d|0}","var proto="+z+".prototype","proto.dtype='"+E+"'","proto.dimension="+t),R.push("Object.defineProperty(proto,'size',{get:function "+z+"_size(){return "+u.map((function(E){return"this.shape["+E+"]"})).join("*"),"}})"),1===t?R.push("proto.order=[0]"):(R.push("Object.defineProperty(proto,'order',{get:"),t<4?(R.push("function "+z+"_order(){"),2===t?R.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&R.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):R.push("ORDER})")),R.push("proto.set=function "+z+"_set("+C.join(",")+",v){"),X?R.push("return this.data.set("+H+",v)}"):R.push("return this.data["+H+"]=v}"),R.push("proto.get=function "+z+"_get("+C.join(",")+"){"),X?R.push("return this.data.get("+H+")}"):R.push("return this.data["+H+"]}"),R.push("proto.index=function "+z+"_index(",C.join(),"){return "+H+"}"),R.push("proto.hi=function "+z+"_hi("+C.join(",")+"){return new "+z+"(this.data,"+u.map((function(E){return["(typeof i",E,"!=='number'||i",E,"<0)?this.shape[",E,"]:i",E,"|0"].join("")})).join(",")+","+u.map((function(E){return"this.stride["+E+"]"})).join(",")+",this.offset)}");var y=u.map((function(E){return"a"+E+"=this.shape["+E+"]"})),O=u.map((function(E){return"c"+E+"=this.stride["+E+"]"}));R.push("proto.lo=function "+z+"_lo("+C.join(",")+"){var b=this.offset,d=0,"+y.join(",")+","+O.join(","));for(var c=0;c<t;++c)R.push("if(typeof i"+c+"==='number'&&i"+c+">=0){d=i"+c+"|0;b+=c"+c+"*d;a"+c+"-=d}");R.push("return new "+z+"(this.data,"+u.map((function(E){return"a"+E})).join(",")+","+u.map((function(E){return"c"+E})).join(",")+",b)}"),R.push("proto.step=function "+z+"_step("+C.join(",")+"){var "+u.map((function(E){return"a"+E+"=this.shape["+E+"]"})).join(",")+","+u.map((function(E){return"b"+E+"=this.stride["+E+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(c=0;c<t;++c)R.push("if(typeof i"+c+"==='number'){d=i"+c+"|0;if(d<0){c+=b"+c+"*(a"+c+"-1);a"+c+"=ceil(-a"+c+"/d)}else{a"+c+"=ceil(a"+c+"/d)}b"+c+"*=d}");R.push("return new "+z+"(this.data,"+u.map((function(E){return"a"+E})).join(",")+","+u.map((function(E){return"b"+E})).join(",")+",c)}");var a=new Array(t),L=new Array(t);for(c=0;c<t;++c)a[c]="a[i"+c+"]",L[c]="b[i"+c+"]";R.push("proto.transpose=function "+z+"_transpose("+C+"){"+C.map((function(E,t){return E+"=("+E+"===undefined?"+t+":"+E+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+z+"(this.data,"+a.join(",")+","+L.join(",")+",this.offset)}"),R.push("proto.pick=function "+z+"_pick("+C+"){var a=[],b=[],c=this.offset");for(c=0;c<t;++c)R.push("if(typeof i"+c+"==='number'&&i"+c+">=0){c=(c+this.stride["+c+"]*i"+c+")|0}else{a.push(this.shape["+c+"]);b.push(this.stride["+c+"])}");return R.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),R.push("return function construct_"+z+"(data,shape,stride,offset){return new "+z+"(data,"+u.map((function(E){return"shape["+E+"]"})).join(",")+","+u.map((function(E){return"stride["+E+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",R.join("\n"))(Z[E],p)}var Z={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};E.exports=function(E,t,z,A){if(void 0===E)return(0,Z.array[0])([]);"number"===typeof E&&(E=[E]),void 0===t&&(t=[E.length]);var u=t.length;if(void 0===z){z=new Array(u);for(var p=u-1,H=1;p>=0;--p)z[p]=H,H*=t[p]}if(void 0===A){A=0;for(p=0;p<u;++p)z[p]<0&&(A-=(t[p]-1)*z[p])}for(var h=function(E){if(X(E))return"buffer";if(R)switch(Object.prototype.toString.call(E)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(E)?"array":"generic"}(E),d=Z[h];d.length<=u+1;)d.push(C(h,d.length-1));return(0,d[u+1])(E,t,z,A)}},13849:E=>{var t;self,t=()=>(()=>{"use strict";var E={d:(t,z)=>{for(var A in z)E.o(z,A)&&!E.o(t,A)&&Object.defineProperty(t,A,{enumerable:!0,get:z[A]})},o:(E,t)=>Object.prototype.hasOwnProperty.call(E,t)},t={};E.d(t,{default:()=>V});var z,A=function(E,t){var z=t.x-E.x,A=t.y-E.y;return Math.sqrt(z*z+A*A)},X=function(E){return E*(Math.PI/180)},R=new Map,u=function(E){R.has(E)&&clearTimeout(R.get(E)),R.set(E,setTimeout(E,100))},p=function(E,t,z){for(var A,X=t.split(/[ ,]+/g),R=0;R<X.length;R+=1)A=X[R],E.addEventListener?E.addEventListener(A,z,!1):E.attachEvent&&E.attachEvent(A,z)},C=function(E,t,z){for(var A,X=t.split(/[ ,]+/g),R=0;R<X.length;R+=1)A=X[R],E.removeEventListener?E.removeEventListener(A,z):E.detachEvent&&E.detachEvent(A,z)},Z=function(E){return E.preventDefault(),E.type.match(/^touch/)?E.changedTouches:E},H=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},h=function(E,t){t.top||t.right||t.bottom||t.left?(E.style.top=t.top,E.style.right=t.right,E.style.bottom=t.bottom,E.style.left=t.left):(E.style.left=t.x+"px",E.style.top=t.y+"px")},d=function(E,t,z){var A=y(E);for(var X in A)if(A.hasOwnProperty(X))if("string"==typeof t)A[X]=t+" "+z;else{for(var R="",u=0,p=t.length;u<p;u+=1)R+=t[u]+" "+z+", ";A[X]=R.slice(0,-2)}return A},y=function(E){var t={};return t[E]="",["webkit","Moz","o"].forEach((function(z){t[z+E.charAt(0).toUpperCase()+E.slice(1)]=""})),t},O=function(E,t){for(var z in t)t.hasOwnProperty(z)&&(E[z]=t[z]);return E},c=function(E,t){if(E.length)for(var z=0,A=E.length;z<A;z+=1)t(E[z]);else t(E)},a="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,L=window.matchMedia("(any-hover: none)").matches,mE=!!("ontouchstart"in window),W=!!window.PointerEvent,I=!!window.MSPointerEvent,e={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},D={start:"mousedown",move:"mousemove",end:"mouseup"},S={};function l(){}a&&!L?z=e:W?z={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:I?z={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:mE?(z=e,S=D):z=D,l.prototype.on=function(E,t){var z,A=this,X=E.split(/[ ,]+/g);A._handlers_=A._handlers_||{};for(var R=0;R<X.length;R+=1)z=X[R],A._handlers_[z]=A._handlers_[z]||[],A._handlers_[z].push(t);return A},l.prototype.off=function(E,t){var z=this;return z._handlers_=z._handlers_||{},void 0===E?z._handlers_={}:void 0===t?z._handlers_[E]=null:z._handlers_[E]&&z._handlers_[E].indexOf(t)>=0&&z._handlers_[E].splice(z._handlers_[E].indexOf(t),1),z},l.prototype.trigger=function(E,t){var z,A=this,X=E.split(/[ ,]+/g);A._handlers_=A._handlers_||{};for(var R=0;R<X.length;R+=1)z=X[R],A._handlers_[z]&&A._handlers_[z].length&&A._handlers_[z].forEach((function(E){E.call(A,{type:z,target:A},t)}))},l.prototype.config=function(E){var t=this;t.options=t.defaults||{},E&&(t.options=function(E,t){var z={};for(var A in E)E.hasOwnProperty(A)&&t.hasOwnProperty(A)?z[A]=t[A]:E.hasOwnProperty(A)&&(z[A]=E[A]);return z}(t.options,E))},l.prototype.bindEvt=function(E,t){var A=this;return A._domHandlers_=A._domHandlers_||{},A._domHandlers_[t]=function(){"function"==typeof A["on"+t]?A["on"+t].apply(A,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},p(E,z[t],A._domHandlers_[t]),S[t]&&p(E,S[t],A._domHandlers_[t]),A},l.prototype.unbindEvt=function(E,t){var A=this;return A._domHandlers_=A._domHandlers_||{},C(E,z[t],A._domHandlers_[t]),S[t]&&C(E,S[t],A._domHandlers_[t]),delete A._domHandlers_[t],this};const f=l;function K(E,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=E,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=K.id,K.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}K.prototype=new f,K.constructor=K,K.id=0,K.prototype.buildEl=function(E){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},K.prototype.stylize=function(){if(this.options.dataOnly)return this;var E=this.options.fadeTime+"ms",t=function(){var E=y("borderRadius");for(var t in E)E.hasOwnProperty(t)&&(E[t]="50%");return E}(),z=d("transition","opacity",E),A={};return A.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},A.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},A.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},O(A.el,z),"circle"===this.options.shape&&O(A.back,t),O(A.front,t),this.applyStyles(A),this},K.prototype.applyStyles=function(E){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var z in E[t])this.ui[t].style[z]=E[t][z];return this},K.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},K.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},K.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},K.prototype.show=function(E){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout((function(){t.ui.el.style.opacity=1}),0),t.showTimeout=setTimeout((function(){t.trigger("shown",t.instance),"function"==typeof E&&E.call(this)}),t.options.fadeTime)),t},K.prototype.hide=function(E){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout((function(){var z="dynamic"===t.options.mode?"none":"block";t.ui.el.style.display=z,"function"==typeof E&&E.call(t),t.trigger("hidden",t.instance)}),t.options.fadeTime),t.options.restJoystick){var z=t.options.restJoystick,A={};A.x=!0===z||!1!==z.x?0:t.instance.frontPosition.x,A.y=!0===z||!1!==z.y?0:t.instance.frontPosition.y,t.setPosition(E,A)}return t},K.prototype.setPosition=function(E,t){var z=this;z.frontPosition={x:t.x,y:t.y};var A=z.options.fadeTime+"ms",X={};X.front=d("transition",["transform"],A);var R={front:{}};R.front={transform:"translate("+z.frontPosition.x+"px,"+z.frontPosition.y+"px)"},z.applyStyles(X),z.applyStyles(R),z.restTimeout=setTimeout((function(){"function"==typeof E&&E.call(z),z.restCallback()}),z.options.fadeTime)},K.prototype.restCallback=function(){var E=this,t={};t.front=d("transition","none",""),E.applyStyles(t),E.trigger("rested",E.instance)},K.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},K.prototype.computeDirection=function(E){var t,z,A,X=E.angle.radian,R=Math.PI/4,u=Math.PI/2;if(X>R&&X<3*R&&!E.lockX?t="up":X>-R&&X<=R&&!E.lockY?t="left":X>3*-R&&X<=-R&&!E.lockX?t="down":E.lockY||(t="right"),E.lockY||(z=X>-u&&X<u?"left":"right"),E.lockX||(A=X>0?"up":"down"),E.force>this.options.threshold){var p,C={};for(p in this.direction)this.direction.hasOwnProperty(p)&&(C[p]=this.direction[p]);var Z={};for(p in this.direction={x:z,y:A,angle:t},E.direction=this.direction,C)C[p]===this.direction[p]&&(Z[p]=!0);if(Z.x&&Z.y&&Z.angle)return E;Z.x&&Z.y||this.trigger("plain",E),Z.x||this.trigger("plain:"+z,E),Z.y||this.trigger("plain:"+A,E),Z.angle||this.trigger("dir dir:"+t,E)}else this.resetDirection();return E};const F=K;function B(E,t){var z=this;z.nipples=[],z.idles=[],z.actives=[],z.ids=[],z.pressureIntervals={},z.manager=E,z.id=B.id,B.id+=1,z.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},z.config(t),"static"!==z.options.mode&&"semi"!==z.options.mode||(z.options.multitouch=!1),z.options.multitouch||(z.options.maxNumberOfNipples=1);var A=getComputedStyle(z.options.zone.parentElement);return A&&"flex"===A.display&&(z.parentIsFlex=!0),z.updateBox(),z.prepareNipples(),z.Qd(),z.begin(),z.nipples}B.prototype=new f,B.constructor=B,B.id=0,B.prototype.prepareNipples=function(){var E=this,t=E.nipples;t.on=E.on.bind(E),t.off=E.off.bind(E),t.options=E.options,t.destroy=E.destroy.bind(E),t.ids=E.ids,t.id=E.id,t.processOnMove=E.processOnMove.bind(E),t.processOnEnd=E.processOnEnd.bind(E),t.get=function(E){if(void 0===E)return t[0];for(var z=0,A=t.length;z<A;z+=1)if(t[z].identifier===E)return t[z];return!1}},B.prototype.Qd=function(){var E=this;E.bindEvt(E.options.zone,"start"),E.options.zone.style.touchAction="none",E.options.zone.style.msTouchAction="none"},B.prototype.begin=function(){var E=this,t=E.options;if("static"===t.mode){var z=E.createNipple(t.position,E.manager.getIdentifier());z.add(),E.idles.push(z)}},B.prototype.createNipple=function(E,t){var z=this,A=z.manager.scroll,X={},R=z.options,u=z.parentIsFlex?A.x:A.x+z.box.left,p=z.parentIsFlex?A.y:A.y+z.box.top;if(E.x&&E.y)X={x:E.x-u,y:E.y-p};else if(E.top||E.right||E.bottom||E.left){var C=document.createElement("DIV");C.style.display="hidden",C.style.top=E.top,C.style.right=E.right,C.style.bottom=E.bottom,C.style.left=E.left,C.style.position="absolute",R.zone.appendChild(C);var Z=C.getBoundingClientRect();R.zone.removeChild(C),X=E,E={x:Z.left+A.x,y:Z.top+A.y}}var H=new F(z,{color:R.color,size:R.size,threshold:R.threshold,fadeTime:R.fadeTime,dataOnly:R.dataOnly,restJoystick:R.restJoystick,restOpacity:R.restOpacity,mode:R.mode,identifier:t,position:E,zone:R.zone,frontPosition:{x:0,y:0},shape:R.shape});return R.dataOnly||(h(H.ui.el,X),h(H.ui.front,H.frontPosition)),z.nipples.push(H),z.trigger("added "+H.identifier+":added",H),z.manager.trigger("added "+H.identifier+":added",H),z.bindNipple(H),H},B.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},B.prototype.bindNipple=function(E){var t,z=this,A=function(E,A){t=E.type+" "+A.id+":"+E.type,z.trigger(t,A)};E.on("destroyed",z.onDestroyed.bind(z)),E.on("shown hidden rested dir plain",A),E.on("dir:up dir:right dir:down dir:left",A),E.on("plain:up plain:right plain:down plain:left",A)},B.prototype.pressureFn=function(E,t,z){var A=this,X=0;clearInterval(A.pressureIntervals[z]),A.pressureIntervals[z]=setInterval(function(){var z=E.force||E.pressure||E.webkitForce||0;z!==X&&(t.trigger("pressure",z),A.trigger("pressure "+t.identifier+":pressure",z),X=z)}.bind(A),100)},B.prototype.onstart=function(E){var t=this,z=t.options,A=E;return E=Z(E),t.updateBox(),c(E,(function(X){t.actives.length<z.maxNumberOfNipples?t.processOnStart(X):A.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach((function(z){if(Object.values(A.touches).findIndex((function(E){return E.identifier===z}))<0){var X=[E[0]];X.identifier=z,t.processOnEnd(X)}})),t.actives.length<z.maxNumberOfNipples&&t.processOnStart(X))})),t.manager.bindDocument(),!1},B.prototype.processOnStart=function(E){var t,z=this,X=z.options,R=z.manager.getIdentifier(E),u=E.force||E.pressure||E.webkitForce||0,p={x:E.pageX,y:E.pageY},C=z.getOrCreate(R,p);C.identifier!==R&&z.manager.removeIdentifier(C.identifier),C.identifier=R;var Z=function(t){t.trigger("start",t),z.trigger("start "+t.id+":start",t),t.show(),u>0&&z.pressureFn(E,t,t.identifier),z.processOnMove(E)};if((t=z.idles.indexOf(C))>=0&&z.idles.splice(t,1),z.actives.push(C),z.ids.push(C.identifier),"semi"!==X.mode)Z(C);else{if(!(A(p,C.position)<=X.catchDistance))return C.destroy(),void z.processOnStart(E);Z(C)}return C},B.prototype.getOrCreate=function(E,t){var z,A=this,X=A.options;return/(semi|static)/.test(X.mode)?(z=A.idles[0])?(A.idles.splice(0,1),z):"semi"===X.mode?A.createNipple(t,E):(console.warn("Coudln't find the needed nipple."),!1):z=A.createNipple(t,E)},B.prototype.processOnMove=function(E){var t=this,z=t.options,R=t.manager.getIdentifier(E),u=t.nipples.get(R),p=t.manager.scroll;if(function(E){return isNaN(E.buttons)?0!==E.pressure:0!==E.buttons}(E)){if(!u)return console.error("Found zombie joystick with ID "+R),void t.manager.removeIdentifier(R);if(z.dynamicPage){var C=u.el.getBoundingClientRect();u.position={x:p.x+C.left,y:p.y+C.top}}u.identifier=R;var Z=u.options.size/2,H={x:E.pageX,y:E.pageY};z.lockX&&(H.y=u.position.y),z.lockY&&(H.x=u.position.x);var h,d,y,O,c,a,L,mE,W,I,e=A(H,u.position),D=(h=H,y=(d=u.position).x-h.x,O=d.y-h.y,function(E){return E*(180/Math.PI)}(Math.atan2(O,y))),S=X(D),l=e/Z,f={distance:e,position:H};if("circle"===u.options.shape?(c=Math.min(e,Z),L=u.position,mE=c,I={x:0,y:0},W=X(W=D),I.x=L.x-mE*Math.cos(W),I.y=L.y-mE*Math.sin(W),a=I):(a=function(E,t,z){return{x:Math.min(Math.max(E.x,t.x-z),t.x+z),y:Math.min(Math.max(E.y,t.y-z),t.y+z)}}(H,u.position,Z),c=A(a,u.position)),z.follow){if(e>Z){var K=H.x-a.x,F=H.y-a.y;u.position.x+=K,u.position.y+=F,u.el.style.top=u.position.y-(t.box.top+p.y)+"px",u.el.style.left=u.position.x-(t.box.left+p.x)+"px",e=A(H,u.position)}}else H=a,e=c;var B=H.x-u.position.x,b=H.y-u.position.y;u.frontPosition={x:B,y:b},z.dataOnly||(u.ui.front.style.transform="translate("+B+"px,"+b+"px)");var x={identifier:u.identifier,position:H,force:l,pressure:E.force||E.pressure||E.webkitForce||0,distance:e,angle:{radian:S,degree:D},vector:{x:B/Z,y:-b/Z},raw:f,instance:u,lockX:z.lockX,lockY:z.lockY};(x=u.computeDirection(x)).angle={radian:X(180-D),degree:180-D},u.trigger("move",x),t.trigger("move "+u.id+":move",x)}else this.processOnEnd(E)},B.prototype.processOnEnd=function(E){var t=this,z=t.options,A=t.manager.getIdentifier(E),X=t.nipples.get(A),R=t.manager.removeIdentifier(X.identifier);X&&(z.dataOnly||X.hide((function(){"dynamic"===z.mode&&(X.trigger("removed",X),t.trigger("removed "+X.id+":removed",X),t.manager.trigger("removed "+X.id+":removed",X),X.destroy())})),clearInterval(t.pressureIntervals[X.identifier]),X.resetDirection(),X.trigger("end",X),t.trigger("end "+X.id+":end",X),t.ids.indexOf(X.identifier)>=0&&t.ids.splice(t.ids.indexOf(X.identifier),1),t.actives.indexOf(X)>=0&&t.actives.splice(t.actives.indexOf(X),1),/(semi|static)/.test(z.mode)?t.idles.push(X):t.nipples.indexOf(X)>=0&&t.nipples.splice(t.nipples.indexOf(X),1),t.manager.unbindDocument(),/(semi|static)/.test(z.mode)&&(t.manager.ids[R.id]=R.identifier))},B.prototype.onDestroyed=function(E,t){var z=this;z.nipples.indexOf(t)>=0&&z.nipples.splice(z.nipples.indexOf(t),1),z.actives.indexOf(t)>=0&&z.actives.splice(z.actives.indexOf(t),1),z.idles.indexOf(t)>=0&&z.idles.splice(z.idles.indexOf(t),1),z.ids.indexOf(t.identifier)>=0&&z.ids.splice(z.ids.indexOf(t.identifier),1),z.manager.removeIdentifier(t.identifier),z.manager.unbindDocument()},B.prototype.destroy=function(){var E=this;for(var t in E.unbindEvt(E.options.zone,"start"),E.nipples.forEach((function(E){E.destroy()})),E.pressureIntervals)E.pressureIntervals.hasOwnProperty(t)&&clearInterval(E.pressureIntervals[t]);E.trigger("destroyed",E.nipples),E.manager.unbindDocument(),E.off()};const b=B;function x(E){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=H(),t.config(E),t.prepareCollections();var z=function(){var E;t.collections.forEach((function(z){z.forEach((function(z){E=z.el.getBoundingClientRect(),z.position={x:t.scroll.x+E.left,y:t.scroll.y+E.top}}))}))};p(window,"resize",(function(){u(z)}));var A=function(){t.scroll=H()};return p(window,"scroll",(function(){u(A)})),t.collections}x.prototype=new f,x.constructor=x,x.prototype.prepareCollections=function(){var E=this;E.collections.create=E.create.bind(E),E.collections.on=E.on.bind(E),E.collections.off=E.off.bind(E),E.collections.destroy=E.destroy.bind(E),E.collections.get=function(t){var z;return E.collections.every((function(E){return!(z=E.get(t))})),z}},x.prototype.create=function(E){return this.createCollection(E)},x.prototype.createCollection=function(E){var t=this,z=new b(t,E);return t.bindCollection(z),t.collections.push(z),z},x.prototype.bindCollection=function(E){var t,z=this,A=function(E,A){t=E.type+" "+A.id+":"+E.type,z.trigger(t,A)};E.on("destroyed",z.onDestroyed.bind(z)),E.on("shown hidden rested dir plain",A),E.on("dir:up dir:right dir:down dir:left",A),E.on("plain:up plain:right plain:down plain:left",A)},x.prototype.bindDocument=function(){var E=this;E.binded||(E.bindEvt(document,"move").bindEvt(document,"end"),E.binded=!0)},x.prototype.unbindDocument=function(E){var t=this;Object.keys(t.ids).length&&!0!==E||(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)},x.prototype.getIdentifier=function(E){var t;return E?void 0===(t=void 0===E.identifier?E.pointerId:E.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},x.prototype.removeIdentifier=function(E){var t={};for(var z in this.ids)if(this.ids[z]===E){t.id=z,t.identifier=this.ids[z],delete this.ids[z];break}return t},x.prototype.onmove=function(E){return this.onAny("move",E),!1},x.prototype.onend=function(E){return this.onAny("end",E),!1},x.prototype.oncancel=function(E){return this.onAny("end",E),!1},x.prototype.onAny=function(E,t){var z,A=this,X="processOn"+E.charAt(0).toUpperCase()+E.slice(1);t=Z(t);var R=function(E,t,z){z.ids.indexOf(t)>=0&&(z[X](E),E._found_=!0)};return c(t,(function(E){z=A.getIdentifier(E),c(A.collections,R.bind(null,E,z)),E._found_||A.removeIdentifier(z)})),!1},x.prototype.destroy=function(){var E=this;E.unbindDocument(!0),E.ids={},E.index=0,E.collections.forEach((function(E){E.destroy()})),E.off()},x.prototype.onDestroyed=function(E,t){var z=this;if(z.collections.indexOf(t)<0)return!1;z.collections.splice(z.collections.indexOf(t),1)};var J=new x;const V={create:function(E){return J.create(E)},factory:J};return t.default})(),E.exports=t()},12912:(E,t,z)=>{"use strict";const{Deflate:A,deflate:X,deflateRaw:R,gzip:u}=z(12916),{Inflate:p,inflate:C,inflateRaw:Z,ungzip:H}=z(12963),h=z(12943);E.exports.Deflate=A,E.exports.deflate=X,E.exports.deflateRaw=R,E.exports.gzip=u,E.exports.Inflate=p,E.exports.inflate=C,E.exports.inflateRaw=Z,E.exports.ungzip=H,E.exports.constants=h},12916:(E,t,z)=>{"use strict";const A=z(12922),X=z(12945),R=z(12948),u=z(12937),p=z(12957),C=Object.prototype.toString,{Z_NO_FLUSH:Z,Z_SYNC_FLUSH:H,Z_FULL_FLUSH:h,Z_FINISH:d,Z_OK:y,Z_STREAM_END:O,Z_DEFAULT_COMPRESSION:c,Z_DEFAULT_STRATEGY:a,Z_DEFLATED:L}=z(12943);function mE(E){this.options=X.assign({level:c,method:L,TE:16384,windowBits:15,memLevel:8,strategy:a},E||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.ht="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;let z=A.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(z!==y)throw new Error(u[z]);if(t.header&&A.deflateSetHeader(this.strm,t.header),t.dictionary){let E;if(E="string"===typeof t.dictionary?R.string2buf(t.dictionary):"[object ArrayBuffer]"===C.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,z=A.deflateSetDictionary(this.strm,E),z!==y)throw new Error(u[z]);this._dict_set=!0}}function W(E,t){const z=new mE(t);if(z.push(E,!0),z.err)throw z.ht||u[z.err];return z.result}mE.prototype.push=function(E,t){const z=this.strm,X=this.options.TE;let u,p;if(this.ended)return!1;for(p=t===~~t?t:!0===t?d:Z,"string"===typeof E?z.input=R.string2buf(E):"[object ArrayBuffer]"===C.call(E)?z.input=new Uint8Array(E):z.input=E,z.next_in=0,z.avail_in=z.input.length;;)if(0===z.avail_out&&(z.output=new Uint8Array(X),z.next_out=0,z.avail_out=X),(p===H||p===h)&&z.avail_out<=6)this.onData(z.output.subarray(0,z.next_out)),z.avail_out=0;else{if(u=A.deflate(z,p),u===O)return z.next_out>0&&this.onData(z.output.subarray(0,z.next_out)),u=A.deflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===y;if(0!==z.avail_out){if(p>0&&z.next_out>0)this.onData(z.output.subarray(0,z.next_out)),z.avail_out=0;else if(0===z.avail_in)break}else this.onData(z.output)}return!0},mE.prototype.onData=function(E){this.chunks.push(E)},mE.prototype.onEnd=function(E){E===y&&(this.result=X.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.ht=this.strm.ht},E.exports.Deflate=mE,E.exports.deflate=W,E.exports.deflateRaw=function(E,t){return(t=t||{}).raw=!0,W(E,t)},E.exports.gzip=function(E,t){return(t=t||{}).gzip=!0,W(E,t)},E.exports.constants=z(12943)},12963:(E,t,z)=>{"use strict";const A=z(12968),X=z(12945),R=z(12948),u=z(12937),p=z(12957),C=z(12987),Z=Object.prototype.toString,{Z_NO_FLUSH:H,Z_FINISH:h,Z_OK:d,Z_STREAM_END:y,Z_NEED_DICT:O,Z_STREAM_ERROR:c,Z_DATA_ERROR:a,Z_MEM_ERROR:L}=z(12943);function mE(E){this.options=X.assign({TE:65536,windowBits:15,to:""},E||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||E&&E.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.ht="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;let z=A.inflateInit2(this.strm,t.windowBits);if(z!==d)throw new Error(u[z]);if(this.header=new C,A.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=R.string2buf(t.dictionary):"[object ArrayBuffer]"===Z.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(z=A.inflateSetDictionary(this.strm,t.dictionary),z!==d)))throw new Error(u[z])}function W(E,t){const z=new mE(t);if(z.push(E),z.err)throw z.ht||u[z.err];return z.result}mE.prototype.push=function(E,t){const z=this.strm,X=this.options.TE,u=this.options.dictionary;let p,C,mE;if(this.ended)return!1;for(C=t===~~t?t:!0===t?h:H,"[object ArrayBuffer]"===Z.call(E)?z.input=new Uint8Array(E):z.input=E,z.next_in=0,z.avail_in=z.input.length;;){for(0===z.avail_out&&(z.output=new Uint8Array(X),z.next_out=0,z.avail_out=X),p=A.inflate(z,C),p===O&&u&&(p=A.inflateSetDictionary(z,u),p===d?p=A.inflate(z,C):p===a&&(p=O));z.avail_in>0&&p===y&&z.state.wrap>0&&0!==E[z.next_in];)A.inflateReset(z),p=A.inflate(z,C);switch(p){case c:case a:case O:case L:return this.onEnd(p),this.ended=!0,!1}if(mE=z.avail_out,z.next_out&&(0===z.avail_out||p===y))if("string"===this.options.to){let E=R.utf8border(z.output,z.next_out),t=z.next_out-E,A=R.buf2string(z.output,E);z.next_out=t,z.avail_out=X-t,t&&z.output.set(z.output.subarray(E,E+t),0),this.onData(A)}else this.onData(z.output.length===z.next_out?z.output:z.output.subarray(0,z.next_out));if(p!==d||0!==mE){if(p===y)return p=A.inflateEnd(this.strm),this.onEnd(p),this.ended=!0,!0;if(0===z.avail_in)break}}return!0},mE.prototype.onData=function(E){this.chunks.push(E)},mE.prototype.onEnd=function(E){E===d&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=X.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.ht=this.strm.ht},E.exports.Inflate=mE,E.exports.inflate=W,E.exports.inflateRaw=function(E,t){return(t=t||{}).raw=!0,W(E,t)},E.exports.ungzip=W,E.exports.constants=z(12943)},12945:E=>{"use strict";const t=(E,t)=>Object.prototype.hasOwnProperty.call(E,t);E.exports.assign=function(E){const z=Array.prototype.slice.call(arguments,1);for(;z.length;){const A=z.shift();if(A){if("object"!==typeof A)throw new TypeError(A+"must be non-object");for(const z in A)t(A,z)&&(E[z]=A[z])}}return E},E.exports.flattenChunks=E=>{let t=0;for(let A=0,X=E.length;A<X;A++)t+=E[A].length;const z=new Uint8Array(t);for(let A=0,X=0,R=E.length;A<R;A++){let t=E[A];z.set(t,X),X+=t.length}return z}},12948:E=>{"use strict";let t=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(A){t=!1}const z=new Uint8Array(256);for(let X=0;X<256;X++)z[X]=X>=252?6:X>=248?5:X>=240?4:X>=224?3:X>=192?2:1;z[254]=z[254]=1,E.exports.string2buf=E=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(E);let t,z,A,X,R,u=E.length,p=0;for(X=0;X<u;X++)z=E.charCodeAt(X),55296===(64512&z)&&X+1<u&&(A=E.charCodeAt(X+1),56320===(64512&A)&&(z=65536+(z-55296<<10)+(A-56320),X++)),p+=z<128?1:z<2048?2:z<65536?3:4;for(t=new Uint8Array(p),R=0,X=0;R<p;X++)z=E.charCodeAt(X),55296===(64512&z)&&X+1<u&&(A=E.charCodeAt(X+1),56320===(64512&A)&&(z=65536+(z-55296<<10)+(A-56320),X++)),z<128?t[R++]=z:z<2048?(t[R++]=192|z>>>6,t[R++]=128|63&z):z<65536?(t[R++]=224|z>>>12,t[R++]=128|z>>>6&63,t[R++]=128|63&z):(t[R++]=240|z>>>18,t[R++]=128|z>>>12&63,t[R++]=128|z>>>6&63,t[R++]=128|63&z);return t};E.exports.buf2string=(E,A)=>{const X=A||E.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(E.subarray(0,A));let R,u;const p=new Array(2*X);for(u=0,R=0;R<X;){let t=E[R++];if(t<128){p[u++]=t;continue}let A=z[t];if(A>4)p[u++]=65533,R+=A-1;else{for(t&=2===A?31:3===A?15:7;A>1&&R<X;)t=t<<6|63&E[R++],A--;A>1?p[u++]=65533:t<65536?p[u++]=t:(t-=65536,p[u++]=55296|t>>10&1023,p[u++]=56320|1023&t)}}return((E,z)=>{if(z<65534&&E.subarray&&t)return String.fromCharCode.apply(null,E.length===z?E:E.subarray(0,z));let A="";for(let t=0;t<z;t++)A+=String.fromCharCode(E[t]);return A})(p,u)},E.exports.utf8border=(E,t)=>{(t=t||E.length)>E.length&&(t=E.length);let A=t-1;for(;A>=0&&128===(192&E[A]);)A--;return A<0||0===A?t:A+z[E[A]]>t?A:t}},12928:E=>{"use strict";E.exports=(E,t,z,A)=>{let X=65535&E,R=E>>>16&65535,u=0;for(;0!==z;){u=z>2e3?2e3:z,z-=u;do{X=X+t[A++]|0,R=R+X|0}while(--u);X%=65521,R%=65521}return X|R<<16}},12943:E=>{"use strict";E.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12934:E=>{"use strict";const t=new Uint32Array((()=>{let E,t=[];for(var z=0;z<256;z++){E=z;for(var A=0;A<8;A++)E=1&E?3988292384^E>>>1:E>>>1;t[z]=E}return t})());E.exports=(E,z,A,X)=>{const R=t,u=X+A;E^=-1;for(let t=X;t<u;t++)E=E>>>8^R[255&(E^z[t])];return~E}},12922:(E,t,z)=>{"use strict";const{_tr_init:A,_tr_stored_block:X,_tr_flush_block:R,_tr_tally:u,_tr_align:p}=z(12924),C=z(12928),Z=z(12934),H=z(12937),{Z_NO_FLUSH:h,Z_PARTIAL_FLUSH:d,Z_FULL_FLUSH:y,Z_FINISH:O,Z_BLOCK:c,Z_OK:a,Z_STREAM_END:L,Z_STREAM_ERROR:mE,Z_DATA_ERROR:W,Z_BUF_ERROR:I,Z_DEFAULT_COMPRESSION:e,Z_FILTERED:D,Z_HUFFMAN_ONLY:S,Z_RLE:l,Z_FIXED:f,Z_DEFAULT_STRATEGY:K,Z_UNKNOWN:F,Z_DEFLATED:B}=z(12943),b=258,x=262,J=103,V=113,r=666,i=(E,t)=>(E.ht=H[t],t),g=E=>(E<<1)-(E>4?9:0),o=E=>{let t=E.length;for(;--t>=0;)E[t]=0};let Q=(E,t,z)=>(t<<E.hash_shift^z)&E.hash_mask;const T=E=>{const t=E.state;let z=t.pending;z>E.avail_out&&(z=E.avail_out),0!==z&&(E.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+z),E.next_out),E.next_out+=z,t.pending_out+=z,E.total_out+=z,E.avail_out-=z,t.pending-=z,0===t.pending&&(t.pending_out=0))},q=(E,t)=>{R(E,E.block_start>=0?E.block_start:-1,E.strstart-E.block_start,t),E.block_start=E.strstart,T(E.strm)},M=(E,t)=>{E.pending_buf[E.pending++]=t},w=(E,t)=>{E.pending_buf[E.pending++]=t>>>8&255,E.pending_buf[E.pending++]=255&t},n=(E,t,z,A)=>{let X=E.avail_in;return X>A&&(X=A),0===X?0:(E.avail_in-=X,t.set(E.input.subarray(E.next_in,E.next_in+X),z),1===E.state.wrap?E.adler=C(E.adler,t,X,z):2===E.state.wrap&&(E.adler=Z(E.adler,t,X,z)),E.next_in+=X,E.total_in+=X,X)},s=(E,t)=>{let z,A,X=E.max_chain_length,R=E.strstart,u=E.prev_length,p=E.nice_match;const C=E.strstart>E.w_size-x?E.strstart-(E.w_size-x):0,Z=E.window,H=E.w_mask,h=E.prev,d=E.strstart+b;let y=Z[R+u-1],O=Z[R+u];E.prev_length>=E.good_match&&(X>>=2),p>E.lookahead&&(p=E.lookahead);do{if(z=t,Z[z+u]===O&&Z[z+u-1]===y&&Z[z]===Z[R]&&Z[++z]===Z[R+1]){R+=2,z++;do{}while(Z[++R]===Z[++z]&&Z[++R]===Z[++z]&&Z[++R]===Z[++z]&&Z[++R]===Z[++z]&&Z[++R]===Z[++z]&&Z[++R]===Z[++z]&&Z[++R]===Z[++z]&&Z[++R]===Z[++z]&&R<d);if(A=b-(d-R),R=d-b,A>u){if(E.match_start=t,u=A,A>=p)break;y=Z[R+u-1],O=Z[R+u]}}}while((t=h[t&H])>C&&0!==--X);return u<=E.lookahead?u:E.lookahead},j=E=>{const t=E.w_size;let z,A,X,R,u;do{if(R=E.window_size-E.lookahead-E.strstart,E.strstart>=t+(t-x)){E.window.set(E.window.subarray(t,t+t),0),E.match_start-=t,E.strstart-=t,E.block_start-=t,A=E.hash_size,z=A;do{X=E.head[--z],E.head[z]=X>=t?X-t:0}while(--A);A=t,z=A;do{X=E.prev[--z],E.prev[z]=X>=t?X-t:0}while(--A);R+=t}if(0===E.strm.avail_in)break;if(A=n(E.strm,E.window,E.strstart+E.lookahead,R),E.lookahead+=A,E.lookahead+E.insert>=3)for(u=E.strstart-E.insert,E.ins_h=E.window[u],E.ins_h=Q(E,E.ins_h,E.window[u+1]);E.insert&&(E.ins_h=Q(E,E.ins_h,E.window[u+3-1]),E.prev[u&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=u,u++,E.insert--,!(E.lookahead+E.insert<3)););}while(E.lookahead<x&&0!==E.strm.avail_in)},U=(E,t)=>{let z,A;for(;;){if(E.lookahead<x){if(j(E),E.lookahead<x&&t===h)return 1;if(0===E.lookahead)break}if(z=0,E.lookahead>=3&&(E.ins_h=Q(E,E.ins_h,E.window[E.strstart+3-1]),z=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),0!==z&&E.strstart-z<=E.w_size-x&&(E.match_length=s(E,z)),E.match_length>=3)if(A=u(E,E.strstart-E.match_start,E.match_length-3),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=3){E.match_length--;do{E.strstart++,E.ins_h=Q(E,E.ins_h,E.window[E.strstart+3-1]),z=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart}while(0!==--E.match_length);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=Q(E,E.ins_h,E.window[E.strstart+1]);else A=u(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if(A&&(q(E,!1),0===E.strm.avail_out))return 1}return E.insert=E.strstart<2?E.strstart:2,t===O?(q(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(q(E,!1),0===E.strm.avail_out)?1:2},k=(E,t)=>{let z,A,X;for(;;){if(E.lookahead<x){if(j(E),E.lookahead<x&&t===h)return 1;if(0===E.lookahead)break}if(z=0,E.lookahead>=3&&(E.ins_h=Q(E,E.ins_h,E.window[E.strstart+3-1]),z=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=2,0!==z&&E.prev_length<E.max_lazy_match&&E.strstart-z<=E.w_size-x&&(E.match_length=s(E,z),E.match_length<=5&&(E.strategy===D||3===E.match_length&&E.strstart-E.match_start>4096)&&(E.match_length=2)),E.prev_length>=3&&E.match_length<=E.prev_length){X=E.strstart+E.lookahead-3,A=u(E,E.strstart-1-E.prev_match,E.prev_length-3),E.lookahead-=E.prev_length-1,E.prev_length-=2;do{++E.strstart<=X&&(E.ins_h=Q(E,E.ins_h,E.window[E.strstart+3-1]),z=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart)}while(0!==--E.prev_length);if(E.match_available=0,E.match_length=2,E.strstart++,A&&(q(E,!1),0===E.strm.avail_out))return 1}else if(E.match_available){if(A=u(E,0,E.window[E.strstart-1]),A&&q(E,!1),E.strstart++,E.lookahead--,0===E.strm.avail_out)return 1}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&(A=u(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<2?E.strstart:2,t===O?(q(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(q(E,!1),0===E.strm.avail_out)?1:2};function v(E,t,z,A,X){this.good_length=E,this.max_lazy=t,this.nice_length=z,this.max_chain=A,this.func=X}const Y=[new v(0,0,0,0,((E,t)=>{let z=65535;for(z>E.pending_buf_size-5&&(z=E.pending_buf_size-5);;){if(E.lookahead<=1){if(j(E),0===E.lookahead&&t===h)return 1;if(0===E.lookahead)break}E.strstart+=E.lookahead,E.lookahead=0;const A=E.block_start+z;if((0===E.strstart||E.strstart>=A)&&(E.lookahead=E.strstart-A,E.strstart=A,q(E,!1),0===E.strm.avail_out))return 1;if(E.strstart-E.block_start>=E.w_size-x&&(q(E,!1),0===E.strm.avail_out))return 1}return E.insert=0,t===O?(q(E,!0),0===E.strm.avail_out?3:4):(E.strstart>E.block_start&&(q(E,!1),E.strm.avail_out),1)})),new v(4,4,8,4,U),new v(4,5,16,8,U),new v(4,6,32,32,U),new v(4,4,16,16,k),new v(8,16,32,32,k),new v(8,16,128,128,k),new v(8,32,128,256,k),new v(32,128,258,1024,k),new v(32,258,258,4096,k)];function G(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=B,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const N=E=>{if(!E||!E.state)return i(E,mE);E.total_in=E.total_out=0,E.data_type=F;const t=E.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:V,E.adler=2===t.wrap?0:1,t.last_flush=h,A(t),a},P=E=>{const t=N(E);var z;return t===a&&((z=E.state).window_size=2*z.w_size,o(z.head),z.max_lazy_match=Y[z.level].max_lazy,z.good_match=Y[z.level].good_length,z.nice_match=Y[z.level].nice_length,z.max_chain_length=Y[z.level].max_chain,z.strstart=0,z.block_start=0,z.lookahead=0,z.insert=0,z.match_length=z.prev_length=2,z.match_available=0,z.ins_h=0),t},EE=(E,t,z,A,X,R)=>{if(!E)return mE;let u=1;if(t===e&&(t=6),A<0?(u=0,A=-A):A>15&&(u=2,A-=16),X<1||X>9||z!==B||A<8||A>15||t<0||t>9||R<0||R>f)return i(E,mE);8===A&&(A=9);const p=new G;return E.state=p,p.strm=E,p.wrap=u,p.gzhead=null,p.w_bits=A,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=X+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<X+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.d_buf=1*p.lit_bufsize,p.l_buf=3*p.lit_bufsize,p.level=t,p.strategy=R,p.method=z,P(E)};E.exports.deflateInit=(E,t)=>EE(E,t,B,15,8,K),E.exports.deflateInit2=EE,E.exports.deflateReset=P,E.exports.deflateResetKeep=N,E.exports.deflateSetHeader=(E,t)=>E&&E.state?2!==E.state.wrap?mE:(E.state.gzhead=t,a):mE,E.exports.deflate=(E,t)=>{let z,A;if(!E||!E.state||t>c||t<0)return E?i(E,mE):mE;const R=E.state;if(!E.output||!E.input&&0!==E.avail_in||R.status===r&&t!==O)return i(E,0===E.avail_out?I:mE);R.strm=E;const C=R.last_flush;if(R.last_flush=t,42===R.status)if(2===R.wrap)E.adler=0,M(R,31),M(R,139),M(R,8),R.gzhead?(M(R,(R.gzhead.text?1:0)+(R.gzhead.hcrc?2:0)+(R.gzhead.extra?4:0)+(R.gzhead.name?8:0)+(R.gzhead.comment?16:0)),M(R,255&R.gzhead.time),M(R,R.gzhead.time>>8&255),M(R,R.gzhead.time>>16&255),M(R,R.gzhead.time>>24&255),M(R,9===R.level?2:R.strategy>=S||R.level<2?4:0),M(R,255&R.gzhead.os),R.gzhead.extra&&R.gzhead.extra.length&&(M(R,255&R.gzhead.extra.length),M(R,R.gzhead.extra.length>>8&255)),R.gzhead.hcrc&&(E.adler=Z(E.adler,R.pending_buf,R.pending,0)),R.gzindex=0,R.status=69):(M(R,0),M(R,0),M(R,0),M(R,0),M(R,0),M(R,9===R.level?2:R.strategy>=S||R.level<2?4:0),M(R,3),R.status=V);else{let t=B+(R.w_bits-8<<4)<<8,z=-1;z=R.strategy>=S||R.level<2?0:R.level<6?1:6===R.level?2:3,t|=z<<6,0!==R.strstart&&(t|=32),t+=31-t%31,R.status=V,w(R,t),0!==R.strstart&&(w(R,E.adler>>>16),w(R,65535&E.adler)),E.adler=1}if(69===R.status)if(R.gzhead.extra){for(z=R.pending;R.gzindex<(65535&R.gzhead.extra.length)&&(R.pending!==R.pending_buf_size||(R.gzhead.hcrc&&R.pending>z&&(E.adler=Z(E.adler,R.pending_buf,R.pending-z,z)),T(E),z=R.pending,R.pending!==R.pending_buf_size));)M(R,255&R.gzhead.extra[R.gzindex]),R.gzindex++;R.gzhead.hcrc&&R.pending>z&&(E.adler=Z(E.adler,R.pending_buf,R.pending-z,z)),R.gzindex===R.gzhead.extra.length&&(R.gzindex=0,R.status=73)}else R.status=73;if(73===R.status)if(R.gzhead.name){z=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>z&&(E.adler=Z(E.adler,R.pending_buf,R.pending-z,z)),T(E),z=R.pending,R.pending===R.pending_buf_size)){A=1;break}A=R.gzindex<R.gzhead.name.length?255&R.gzhead.name.charCodeAt(R.gzindex++):0,M(R,A)}while(0!==A);R.gzhead.hcrc&&R.pending>z&&(E.adler=Z(E.adler,R.pending_buf,R.pending-z,z)),0===A&&(R.gzindex=0,R.status=91)}else R.status=91;if(91===R.status)if(R.gzhead.comment){z=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>z&&(E.adler=Z(E.adler,R.pending_buf,R.pending-z,z)),T(E),z=R.pending,R.pending===R.pending_buf_size)){A=1;break}A=R.gzindex<R.gzhead.comment.length?255&R.gzhead.comment.charCodeAt(R.gzindex++):0,M(R,A)}while(0!==A);R.gzhead.hcrc&&R.pending>z&&(E.adler=Z(E.adler,R.pending_buf,R.pending-z,z)),0===A&&(R.status=J)}else R.status=J;if(R.status===J&&(R.gzhead.hcrc?(R.pending+2>R.pending_buf_size&&T(E),R.pending+2<=R.pending_buf_size&&(M(R,255&E.adler),M(R,E.adler>>8&255),E.adler=0,R.status=V)):R.status=V),0!==R.pending){if(T(E),0===E.avail_out)return R.last_flush=-1,a}else if(0===E.avail_in&&g(t)<=g(C)&&t!==O)return i(E,I);if(R.status===r&&0!==E.avail_in)return i(E,I);if(0!==E.avail_in||0!==R.lookahead||t!==h&&R.status!==r){let z=R.strategy===S?((E,t)=>{let z;for(;;){if(0===E.lookahead&&(j(E),0===E.lookahead)){if(t===h)return 1;break}if(E.match_length=0,z=u(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++,z&&(q(E,!1),0===E.strm.avail_out))return 1}return E.insert=0,t===O?(q(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(q(E,!1),0===E.strm.avail_out)?1:2})(R,t):R.strategy===l?((E,t)=>{let z,A,X,R;const p=E.window;for(;;){if(E.lookahead<=b){if(j(E),E.lookahead<=b&&t===h)return 1;if(0===E.lookahead)break}if(E.match_length=0,E.lookahead>=3&&E.strstart>0&&(X=E.strstart-1,A=p[X],A===p[++X]&&A===p[++X]&&A===p[++X])){R=E.strstart+b;do{}while(A===p[++X]&&A===p[++X]&&A===p[++X]&&A===p[++X]&&A===p[++X]&&A===p[++X]&&A===p[++X]&&A===p[++X]&&X<R);E.match_length=b-(R-X),E.match_length>E.lookahead&&(E.match_length=E.lookahead)}if(E.match_length>=3?(z=u(E,1,E.match_length-3),E.lookahead-=E.match_length,E.strstart+=E.match_length,E.match_length=0):(z=u(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++),z&&(q(E,!1),0===E.strm.avail_out))return 1}return E.insert=0,t===O?(q(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(q(E,!1),0===E.strm.avail_out)?1:2})(R,t):Y[R.level].func(R,t);if(3!==z&&4!==z||(R.status=r),1===z||3===z)return 0===E.avail_out&&(R.last_flush=-1),a;if(2===z&&(t===d?p(R):t!==c&&(X(R,0,0,!1),t===y&&(o(R.head),0===R.lookahead&&(R.strstart=0,R.block_start=0,R.insert=0))),T(E),0===E.avail_out))return R.last_flush=-1,a}return t!==O?a:R.wrap<=0?L:(2===R.wrap?(M(R,255&E.adler),M(R,E.adler>>8&255),M(R,E.adler>>16&255),M(R,E.adler>>24&255),M(R,255&E.total_in),M(R,E.total_in>>8&255),M(R,E.total_in>>16&255),M(R,E.total_in>>24&255)):(w(R,E.adler>>>16),w(R,65535&E.adler)),T(E),R.wrap>0&&(R.wrap=-R.wrap),0!==R.pending?a:L)},E.exports.deflateEnd=E=>{if(!E||!E.state)return mE;const t=E.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==J&&t!==V&&t!==r?i(E,mE):(E.state=null,t===V?i(E,W):a)},E.exports.deflateSetDictionary=(E,t)=>{let z=t.length;if(!E||!E.state)return mE;const A=E.state,X=A.wrap;if(2===X||1===X&&42!==A.status||A.lookahead)return mE;if(1===X&&(E.adler=C(E.adler,t,z,0)),A.wrap=0,z>=A.w_size){0===X&&(o(A.head),A.strstart=0,A.block_start=0,A.insert=0);let E=new Uint8Array(A.w_size);E.set(t.subarray(z-A.w_size,z),0),t=E,z=A.w_size}const R=E.avail_in,u=E.next_in,p=E.input;for(E.avail_in=z,E.next_in=0,E.input=t,j(A);A.lookahead>=3;){let E=A.strstart,t=A.lookahead-2;do{A.ins_h=Q(A,A.ins_h,A.window[E+3-1]),A.prev[E&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=E,E++}while(--t);A.strstart=E,A.lookahead=2,j(A)}return A.strstart+=A.lookahead,A.block_start=A.strstart,A.insert=A.lookahead,A.lookahead=0,A.match_length=A.prev_length=2,A.match_available=0,E.next_in=u,E.input=p,E.avail_in=R,A.wrap=X,a},E.exports.deflateInfo="pako deflate (from Nodeca project)"},12987:E=>{"use strict";E.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12974:E=>{"use strict";E.exports=function(E,t){let z,A,X,R,u,p,C,Z,H,h,d,y,O,c,a,L,mE,W,I,e,D,S,l,f;const K=E.state;z=E.next_in,l=E.input,A=z+(E.avail_in-5),X=E.next_out,f=E.output,R=X-(t-E.avail_out),u=X+(E.avail_out-257),p=K.dmax,C=K.wsize,Z=K.whave,H=K.wnext,h=K.window,d=K.hold,y=K.bits,O=K.lencode,c=K.distcode,a=(1<<K.lenbits)-1,L=(1<<K.distbits)-1;E:do{y<15&&(d+=l[z++]<<y,y+=8,d+=l[z++]<<y,y+=8),mE=O[d&a];t:for(;;){if(W=mE>>>24,d>>>=W,y-=W,W=mE>>>16&255,0===W)f[X++]=65535&mE;else{if(!(16&W)){if(0===(64&W)){mE=O[(65535&mE)+(d&(1<<W)-1)];continue t}if(32&W){K.mode=12;break E}E.ht="invalid literal/length code",K.mode=30;break E}I=65535&mE,W&=15,W&&(y<W&&(d+=l[z++]<<y,y+=8),I+=d&(1<<W)-1,d>>>=W,y-=W),y<15&&(d+=l[z++]<<y,y+=8,d+=l[z++]<<y,y+=8),mE=c[d&L];z:for(;;){if(W=mE>>>24,d>>>=W,y-=W,W=mE>>>16&255,!(16&W)){if(0===(64&W)){mE=c[(65535&mE)+(d&(1<<W)-1)];continue z}E.ht="invalid distance code",K.mode=30;break E}if(e=65535&mE,W&=15,y<W&&(d+=l[z++]<<y,y+=8,y<W&&(d+=l[z++]<<y,y+=8)),e+=d&(1<<W)-1,e>p){E.ht="invalid distance too far back",K.mode=30;break E}if(d>>>=W,y-=W,W=X-R,e>W){if(W=e-W,W>Z&&K.sane){E.ht="invalid distance too far back",K.mode=30;break E}if(D=0,S=h,0===H){if(D+=C-W,W<I){I-=W;do{f[X++]=h[D++]}while(--W);D=X-e,S=f}}else if(H<W){if(D+=C+H-W,W-=H,W<I){I-=W;do{f[X++]=h[D++]}while(--W);if(D=0,H<I){W=H,I-=W;do{f[X++]=h[D++]}while(--W);D=X-e,S=f}}}else if(D+=H-W,W<I){I-=W;do{f[X++]=h[D++]}while(--W);D=X-e,S=f}for(;I>2;)f[X++]=S[D++],f[X++]=S[D++],f[X++]=S[D++],I-=3;I&&(f[X++]=S[D++],I>1&&(f[X++]=S[D++]))}else{D=X-e;do{f[X++]=f[D++],f[X++]=f[D++],f[X++]=f[D++],I-=3}while(I>2);I&&(f[X++]=f[D++],I>1&&(f[X++]=f[D++]))}break}}break}}while(z<A&&X<u);I=y>>3,z-=I,y-=I<<3,d&=(1<<y)-1,E.next_in=z,E.next_out=X,E.avail_in=z<A?A-z+5:5-(z-A),E.avail_out=X<u?u-X+257:257-(X-u),K.hold=d,K.bits=y}},12968:(E,t,z)=>{"use strict";const A=z(12928),X=z(12934),R=z(12974),u=z(12982),{Z_FINISH:p,Z_BLOCK:C,Z_TREES:Z,Z_OK:H,Z_STREAM_END:h,Z_NEED_DICT:d,Z_STREAM_ERROR:y,Z_DATA_ERROR:O,Z_MEM_ERROR:c,Z_BUF_ERROR:a,Z_DEFLATED:L}=z(12943),mE=12,W=30,I=E=>(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24);function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const D=E=>{if(!E||!E.state)return y;const t=E.state;return E.total_in=E.total_out=t.total=0,E.ht="",t.wrap&&(E.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,H},S=E=>{if(!E||!E.state)return y;const t=E.state;return t.wsize=0,t.whave=0,t.wnext=0,D(E)},l=(E,t)=>{let z;if(!E||!E.state)return y;const A=E.state;return t<0?(z=0,t=-t):(z=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?y:(null!==A.window&&A.wbits!==t&&(A.window=null),A.wrap=z,A.wbits=t,S(E))},f=(E,t)=>{if(!E)return y;const z=new e;E.state=z,z.window=null;const A=l(E,t);return A!==H&&(E.state=null),A};let K,F,B=!0;const b=E=>{if(B){K=new Int32Array(512),F=new Int32Array(32);let t=0;for(;t<144;)E.lens[t++]=8;for(;t<256;)E.lens[t++]=9;for(;t<280;)E.lens[t++]=7;for(;t<288;)E.lens[t++]=8;for(u(1,E.lens,0,288,K,0,E.work,{bits:9}),t=0;t<32;)E.lens[t++]=5;u(2,E.lens,0,32,F,0,E.work,{bits:5}),B=!1}E.lencode=K,E.lenbits=9,E.distcode=F,E.distbits=5},x=(E,t,z,A)=>{let X;const R=E.state;return null===R.window&&(R.wsize=1<<R.wbits,R.wnext=0,R.whave=0,R.window=new Uint8Array(R.wsize)),A>=R.wsize?(R.window.set(t.subarray(z-R.wsize,z),0),R.wnext=0,R.whave=R.wsize):(X=R.wsize-R.wnext,X>A&&(X=A),R.window.set(t.subarray(z-A,z-A+X),R.wnext),(A-=X)?(R.window.set(t.subarray(z-A,z),0),R.wnext=A,R.whave=R.wsize):(R.wnext+=X,R.wnext===R.wsize&&(R.wnext=0),R.whave<R.wsize&&(R.whave+=X))),0};E.exports.inflateReset=S,E.exports.inflateReset2=l,E.exports.inflateResetKeep=D,E.exports.inflateInit=E=>f(E,15),E.exports.inflateInit2=f,E.exports.inflate=(E,t)=>{let z,e,D,S,l,f,K,F,B,J,V,r,i,g,o,Q,T,q,M,w,n,s,j=0;const U=new Uint8Array(4);let k,v;const Y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!E||!E.state||!E.output||!E.input&&0!==E.avail_in)return y;z=E.state,z.mode===mE&&(z.mode=13),l=E.next_out,D=E.output,K=E.avail_out,S=E.next_in,e=E.input,f=E.avail_in,F=z.hold,B=z.bits,J=f,V=K,s=H;E:for(;;)switch(z.mode){case 1:if(0===z.wrap){z.mode=13;break}for(;B<16;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}if(2&z.wrap&&35615===F){z.check=0,U[0]=255&F,U[1]=F>>>8&255,z.check=X(z.check,U,2,0),F=0,B=0,z.mode=2;break}if(z.flags=0,z.head&&(z.head.done=!1),!(1&z.wrap)||(((255&F)<<8)+(F>>8))%31){E.ht="incorrect header check",z.mode=W;break}if((15&F)!==L){E.ht="unknown compression method",z.mode=W;break}if(F>>>=4,B-=4,n=8+(15&F),0===z.wbits)z.wbits=n;else if(n>z.wbits){E.ht="invalid window size",z.mode=W;break}z.dmax=1<<z.wbits,E.adler=z.check=1,z.mode=512&F?10:mE,F=0,B=0;break;case 2:for(;B<16;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}if(z.flags=F,(255&z.flags)!==L){E.ht="unknown compression method",z.mode=W;break}if(57344&z.flags){E.ht="unknown header flags set",z.mode=W;break}z.head&&(z.head.text=F>>8&1),512&z.flags&&(U[0]=255&F,U[1]=F>>>8&255,z.check=X(z.check,U,2,0)),F=0,B=0,z.mode=3;case 3:for(;B<32;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}z.head&&(z.head.time=F),512&z.flags&&(U[0]=255&F,U[1]=F>>>8&255,U[2]=F>>>16&255,U[3]=F>>>24&255,z.check=X(z.check,U,4,0)),F=0,B=0,z.mode=4;case 4:for(;B<16;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}z.head&&(z.head.xflags=255&F,z.head.os=F>>8),512&z.flags&&(U[0]=255&F,U[1]=F>>>8&255,z.check=X(z.check,U,2,0)),F=0,B=0,z.mode=5;case 5:if(1024&z.flags){for(;B<16;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}z.length=F,z.head&&(z.head.extra_len=F),512&z.flags&&(U[0]=255&F,U[1]=F>>>8&255,z.check=X(z.check,U,2,0)),F=0,B=0}else z.head&&(z.head.extra=null);z.mode=6;case 6:if(1024&z.flags&&(r=z.length,r>f&&(r=f),r&&(z.head&&(n=z.head.extra_len-z.length,z.head.extra||(z.head.extra=new Uint8Array(z.head.extra_len)),z.head.extra.set(e.subarray(S,S+r),n)),512&z.flags&&(z.check=X(z.check,e,r,S)),f-=r,S+=r,z.length-=r),z.length))break E;z.length=0,z.mode=7;case 7:if(2048&z.flags){if(0===f)break E;r=0;do{n=e[S+r++],z.head&&n&&z.length<65536&&(z.head.name+=String.fromCharCode(n))}while(n&&r<f);if(512&z.flags&&(z.check=X(z.check,e,r,S)),f-=r,S+=r,n)break E}else z.head&&(z.head.name=null);z.length=0,z.mode=8;case 8:if(4096&z.flags){if(0===f)break E;r=0;do{n=e[S+r++],z.head&&n&&z.length<65536&&(z.head.comment+=String.fromCharCode(n))}while(n&&r<f);if(512&z.flags&&(z.check=X(z.check,e,r,S)),f-=r,S+=r,n)break E}else z.head&&(z.head.comment=null);z.mode=9;case 9:if(512&z.flags){for(;B<16;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}if(F!==(65535&z.check)){E.ht="header crc mismatch",z.mode=W;break}F=0,B=0}z.head&&(z.head.hcrc=z.flags>>9&1,z.head.done=!0),E.adler=z.check=0,z.mode=mE;break;case 10:for(;B<32;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}E.adler=z.check=I(F),F=0,B=0,z.mode=11;case 11:if(0===z.havedict)return E.next_out=l,E.avail_out=K,E.next_in=S,E.avail_in=f,z.hold=F,z.bits=B,d;E.adler=z.check=1,z.mode=mE;case mE:if(t===C||t===Z)break E;case 13:if(z.last){F>>>=7&B,B-=7&B,z.mode=27;break}for(;B<3;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}switch(z.last=1&F,F>>>=1,B-=1,3&F){case 0:z.mode=14;break;case 1:if(b(z),z.mode=20,t===Z){F>>>=2,B-=2;break E}break;case 2:z.mode=17;break;case 3:E.ht="invalid block type",z.mode=W}F>>>=2,B-=2;break;case 14:for(F>>>=7&B,B-=7&B;B<32;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}if((65535&F)!==(F>>>16^65535)){E.ht="invalid stored block lengths",z.mode=W;break}if(z.length=65535&F,F=0,B=0,z.mode=15,t===Z)break E;case 15:z.mode=16;case 16:if(r=z.length,r){if(r>f&&(r=f),r>K&&(r=K),0===r)break E;D.set(e.subarray(S,S+r),l),f-=r,S+=r,K-=r,l+=r,z.length-=r;break}z.mode=mE;break;case 17:for(;B<14;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}if(z.nlen=257+(31&F),F>>>=5,B-=5,z.ndist=1+(31&F),F>>>=5,B-=5,z.ncode=4+(15&F),F>>>=4,B-=4,z.nlen>286||z.ndist>30){E.ht="too many length or distance symbols",z.mode=W;break}z.have=0,z.mode=18;case 18:for(;z.have<z.ncode;){for(;B<3;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}z.lens[Y[z.have++]]=7&F,F>>>=3,B-=3}for(;z.have<19;)z.lens[Y[z.have++]]=0;if(z.lencode=z.lendyn,z.lenbits=7,k={bits:z.lenbits},s=u(0,z.lens,0,19,z.lencode,0,z.work,k),z.lenbits=k.bits,s){E.ht="invalid code lengths set",z.mode=W;break}z.have=0,z.mode=19;case 19:for(;z.have<z.nlen+z.ndist;){for(;j=z.lencode[F&(1<<z.lenbits)-1],o=j>>>24,Q=j>>>16&255,T=65535&j,!(o<=B);){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}if(T<16)F>>>=o,B-=o,z.lens[z.have++]=T;else{if(16===T){for(v=o+2;B<v;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}if(F>>>=o,B-=o,0===z.have){E.ht="invalid bit length repeat",z.mode=W;break}n=z.lens[z.have-1],r=3+(3&F),F>>>=2,B-=2}else if(17===T){for(v=o+3;B<v;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}F>>>=o,B-=o,n=0,r=3+(7&F),F>>>=3,B-=3}else{for(v=o+7;B<v;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}F>>>=o,B-=o,n=0,r=11+(127&F),F>>>=7,B-=7}if(z.have+r>z.nlen+z.ndist){E.ht="invalid bit length repeat",z.mode=W;break}for(;r--;)z.lens[z.have++]=n}}if(z.mode===W)break;if(0===z.lens[256]){E.ht="invalid code -- missing end-of-block",z.mode=W;break}if(z.lenbits=9,k={bits:z.lenbits},s=u(1,z.lens,0,z.nlen,z.lencode,0,z.work,k),z.lenbits=k.bits,s){E.ht="invalid literal/lengths set",z.mode=W;break}if(z.distbits=6,z.distcode=z.distdyn,k={bits:z.distbits},s=u(2,z.lens,z.nlen,z.ndist,z.distcode,0,z.work,k),z.distbits=k.bits,s){E.ht="invalid distances set",z.mode=W;break}if(z.mode=20,t===Z)break E;case 20:z.mode=21;case 21:if(f>=6&&K>=258){E.next_out=l,E.avail_out=K,E.next_in=S,E.avail_in=f,z.hold=F,z.bits=B,R(E,V),l=E.next_out,D=E.output,K=E.avail_out,S=E.next_in,e=E.input,f=E.avail_in,F=z.hold,B=z.bits,z.mode===mE&&(z.back=-1);break}for(z.back=0;j=z.lencode[F&(1<<z.lenbits)-1],o=j>>>24,Q=j>>>16&255,T=65535&j,!(o<=B);){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}if(Q&&0===(240&Q)){for(q=o,M=Q,w=T;j=z.lencode[w+((F&(1<<q+M)-1)>>q)],o=j>>>24,Q=j>>>16&255,T=65535&j,!(q+o<=B);){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}F>>>=q,B-=q,z.back+=q}if(F>>>=o,B-=o,z.back+=o,z.length=T,0===Q){z.mode=26;break}if(32&Q){z.back=-1,z.mode=mE;break}if(64&Q){E.ht="invalid literal/length code",z.mode=W;break}z.extra=15&Q,z.mode=22;case 22:if(z.extra){for(v=z.extra;B<v;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}z.length+=F&(1<<z.extra)-1,F>>>=z.extra,B-=z.extra,z.back+=z.extra}z.was=z.length,z.mode=23;case 23:for(;j=z.distcode[F&(1<<z.distbits)-1],o=j>>>24,Q=j>>>16&255,T=65535&j,!(o<=B);){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}if(0===(240&Q)){for(q=o,M=Q,w=T;j=z.distcode[w+((F&(1<<q+M)-1)>>q)],o=j>>>24,Q=j>>>16&255,T=65535&j,!(q+o<=B);){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}F>>>=q,B-=q,z.back+=q}if(F>>>=o,B-=o,z.back+=o,64&Q){E.ht="invalid distance code",z.mode=W;break}z.offset=T,z.extra=15&Q,z.mode=24;case 24:if(z.extra){for(v=z.extra;B<v;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}z.offset+=F&(1<<z.extra)-1,F>>>=z.extra,B-=z.extra,z.back+=z.extra}if(z.offset>z.dmax){E.ht="invalid distance too far back",z.mode=W;break}z.mode=25;case 25:if(0===K)break E;if(r=V-K,z.offset>r){if(r=z.offset-r,r>z.whave&&z.sane){E.ht="invalid distance too far back",z.mode=W;break}r>z.wnext?(r-=z.wnext,i=z.wsize-r):i=z.wnext-r,r>z.length&&(r=z.length),g=z.window}else g=D,i=l-z.offset,r=z.length;r>K&&(r=K),K-=r,z.length-=r;do{D[l++]=g[i++]}while(--r);0===z.length&&(z.mode=21);break;case 26:if(0===K)break E;D[l++]=z.length,K--,z.mode=21;break;case 27:if(z.wrap){for(;B<32;){if(0===f)break E;f--,F|=e[S++]<<B,B+=8}if(V-=K,E.total_out+=V,z.total+=V,V&&(E.adler=z.check=z.flags?X(z.check,D,V,l-V):A(z.check,D,V,l-V)),V=K,(z.flags?F:I(F))!==z.check){E.ht="incorrect data check",z.mode=W;break}F=0,B=0}z.mode=28;case 28:if(z.wrap&&z.flags){for(;B<32;){if(0===f)break E;f--,F+=e[S++]<<B,B+=8}if(F!==(4294967295&z.total)){E.ht="incorrect length check",z.mode=W;break}F=0,B=0}z.mode=29;case 29:s=h;break E;case W:s=O;break E;case 31:return c;default:return y}return E.next_out=l,E.avail_out=K,E.next_in=S,E.avail_in=f,z.hold=F,z.bits=B,(z.wsize||V!==E.avail_out&&z.mode<W&&(z.mode<27||t!==p))&&x(E,E.output,E.next_out,V-E.avail_out)?(z.mode=31,c):(J-=E.avail_in,V-=E.avail_out,E.total_in+=J,E.total_out+=V,z.total+=V,z.wrap&&V&&(E.adler=z.check=z.flags?X(z.check,D,V,E.next_out-V):A(z.check,D,V,E.next_out-V)),E.data_type=z.bits+(z.last?64:0)+(z.mode===mE?128:0)+(20===z.mode||15===z.mode?256:0),(0===J&&0===V||t===p)&&s===H&&(s=a),s)},E.exports.inflateEnd=E=>{if(!E||!E.state)return y;let t=E.state;return t.window&&(t.window=null),E.state=null,H},E.exports.inflateGetHeader=(E,t)=>{if(!E||!E.state)return y;const z=E.state;return 0===(2&z.wrap)?y:(z.head=t,t.done=!1,H)},E.exports.inflateSetDictionary=(E,t)=>{const z=t.length;let X,R,u;return E&&E.state?(X=E.state,0!==X.wrap&&11!==X.mode?y:11===X.mode&&(R=1,R=A(R,t,z,0),R!==X.check)?O:(u=x(E,t,z,z),u?(X.mode=31,c):(X.havedict=1,H))):y},E.exports.inflateInfo="pako inflate (from Nodeca project)"},12982:E=>{"use strict";const t=15,z=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),A=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),X=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),R=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);E.exports=(E,u,p,C,Z,H,h,d)=>{const y=d.bits;let O,c,a,L,mE,W,I=0,e=0,D=0,S=0,l=0,f=0,K=0,F=0,B=0,b=0,x=null,J=0;const V=new Uint16Array(16),r=new Uint16Array(16);let i,g,o,Q=null,T=0;for(I=0;I<=t;I++)V[I]=0;for(e=0;e<C;e++)V[u[p+e]]++;for(l=y,S=t;S>=1&&0===V[S];S--);if(l>S&&(l=S),0===S)return Z[H++]=20971520,Z[H++]=20971520,d.bits=1,0;for(D=1;D<S&&0===V[D];D++);for(l<D&&(l=D),F=1,I=1;I<=t;I++)if(F<<=1,F-=V[I],F<0)return-1;if(F>0&&(0===E||1!==S))return-1;for(r[1]=0,I=1;I<t;I++)r[I+1]=r[I]+V[I];for(e=0;e<C;e++)0!==u[p+e]&&(h[r[u[p+e]]++]=e);if(0===E?(x=Q=h,W=19):1===E?(x=z,J-=257,Q=A,T-=257,W=256):(x=X,Q=R,W=-1),b=0,e=0,I=D,mE=H,f=l,K=0,a=-1,B=1<<l,L=B-1,1===E&&B>852||2===E&&B>592)return 1;for(;;){i=I-K,h[e]<W?(g=0,o=h[e]):h[e]>W?(g=Q[T+h[e]],o=x[J+h[e]]):(g=96,o=0),O=1<<I-K,c=1<<f,D=c;do{c-=O,Z[mE+(b>>K)+c]=i<<24|g<<16|o}while(0!==c);for(O=1<<I-1;b&O;)O>>=1;if(0!==O?(b&=O-1,b+=O):b=0,e++,0===--V[I]){if(I===S)break;I=u[p+h[e]]}if(I>l&&(b&L)!==a){for(0===K&&(K=l),mE+=D,f=I-K,F=1<<f;f+K<S&&(F-=V[f+K],!(F<=0));)f++,F<<=1;if(B+=1<<f,1===E&&B>852||2===E&&B>592)return 1;a=b&L,Z[a]=l<<24|f<<16|mE-H}}return 0!==b&&(Z[mE+b]=I-K<<24|64<<16),d.bits=l,0}},12937:E=>{"use strict";E.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12924:E=>{"use strict";function t(E){let t=E.length;for(;--t>=0;)E[t]=0}const z=256,A=286,X=30,R=15,u=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),p=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),C=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),H=new Array(576);t(H);const h=new Array(60);t(h);const d=new Array(512);t(d);const y=new Array(256);t(y);const O=new Array(29);t(O);const c=new Array(X);function a(E,t,z,A,X){this.static_tree=E,this.extra_bits=t,this.extra_base=z,this.elems=A,this.max_length=X,this.has_stree=E&&E.length}let L,mE,W;function I(E,t){this.dyn_tree=E,this.max_code=0,this.stat_desc=t}t(c);const e=E=>E<256?d[E]:d[256+(E>>>7)],D=(E,t)=>{E.pending_buf[E.pending++]=255&t,E.pending_buf[E.pending++]=t>>>8&255},S=(E,t,z)=>{E.bi_valid>16-z?(E.bi_buf|=t<<E.bi_valid&65535,D(E,E.bi_buf),E.bi_buf=t>>16-E.bi_valid,E.bi_valid+=z-16):(E.bi_buf|=t<<E.bi_valid&65535,E.bi_valid+=z)},l=(E,t,z)=>{S(E,z[2*t],z[2*t+1])},f=(E,t)=>{let z=0;do{z|=1&E,E>>>=1,z<<=1}while(--t>0);return z>>>1},K=(E,t,z)=>{const A=new Array(16);let X,u,p=0;for(X=1;X<=R;X++)A[X]=p=p+z[X-1]<<1;for(u=0;u<=t;u++){let t=E[2*u+1];0!==t&&(E[2*u]=f(A[t]++,t))}},F=E=>{let t;for(t=0;t<A;t++)E.dyn_ltree[2*t]=0;for(t=0;t<X;t++)E.dyn_dtree[2*t]=0;for(t=0;t<19;t++)E.bl_tree[2*t]=0;E.dyn_ltree[512]=1,E.opt_len=E.static_len=0,E.last_lit=E.matches=0},B=E=>{E.bi_valid>8?D(E,E.bi_buf):E.bi_valid>0&&(E.pending_buf[E.pending++]=E.bi_buf),E.bi_buf=0,E.bi_valid=0},b=(E,t,z,A)=>{const X=2*t,R=2*z;return E[X]<E[R]||E[X]===E[R]&&A[t]<=A[z]},x=(E,t,z)=>{const A=E.heap[z];let X=z<<1;for(;X<=E.heap_len&&(X<E.heap_len&&b(t,E.heap[X+1],E.heap[X],E.depth)&&X++,!b(t,A,E.heap[X],E.depth));)E.heap[z]=E.heap[X],z=X,X<<=1;E.heap[z]=A},J=(E,t,A)=>{let X,R,C,Z,H=0;if(0!==E.last_lit)do{X=E.pending_buf[E.d_buf+2*H]<<8|E.pending_buf[E.d_buf+2*H+1],R=E.pending_buf[E.l_buf+H],H++,0===X?l(E,R,t):(C=y[R],l(E,C+z+1,t),Z=u[C],0!==Z&&(R-=O[C],S(E,R,Z)),X--,C=e(X),l(E,C,A),Z=p[C],0!==Z&&(X-=c[C],S(E,X,Z)))}while(H<E.last_lit);l(E,256,t)},V=(E,t)=>{const z=t.dyn_tree,A=t.stat_desc.static_tree,X=t.stat_desc.has_stree,u=t.stat_desc.elems;let p,C,Z,H=-1;for(E.heap_len=0,E.heap_max=573,p=0;p<u;p++)0!==z[2*p]?(E.heap[++E.heap_len]=H=p,E.depth[p]=0):z[2*p+1]=0;for(;E.heap_len<2;)Z=E.heap[++E.heap_len]=H<2?++H:0,z[2*Z]=1,E.depth[Z]=0,E.opt_len--,X&&(E.static_len-=A[2*Z+1]);for(t.max_code=H,p=E.heap_len>>1;p>=1;p--)x(E,z,p);Z=u;do{p=E.heap[1],E.heap[1]=E.heap[E.heap_len--],x(E,z,1),C=E.heap[1],E.heap[--E.heap_max]=p,E.heap[--E.heap_max]=C,z[2*Z]=z[2*p]+z[2*C],E.depth[Z]=(E.depth[p]>=E.depth[C]?E.depth[p]:E.depth[C])+1,z[2*p+1]=z[2*C+1]=Z,E.heap[1]=Z++,x(E,z,1)}while(E.heap_len>=2);E.heap[--E.heap_max]=E.heap[1],((E,t)=>{const z=t.dyn_tree,A=t.max_code,X=t.stat_desc.static_tree,u=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,C=t.stat_desc.extra_base,Z=t.stat_desc.max_length;let H,h,d,y,O,c,a=0;for(y=0;y<=R;y++)E.bl_count[y]=0;for(z[2*E.heap[E.heap_max]+1]=0,H=E.heap_max+1;H<573;H++)h=E.heap[H],y=z[2*z[2*h+1]+1]+1,y>Z&&(y=Z,a++),z[2*h+1]=y,h>A||(E.bl_count[y]++,O=0,h>=C&&(O=p[h-C]),c=z[2*h],E.opt_len+=c*(y+O),u&&(E.static_len+=c*(X[2*h+1]+O)));if(0!==a){do{for(y=Z-1;0===E.bl_count[y];)y--;E.bl_count[y]--,E.bl_count[y+1]+=2,E.bl_count[Z]--,a-=2}while(a>0);for(y=Z;0!==y;y--)for(h=E.bl_count[y];0!==h;)d=E.heap[--H],d>A||(z[2*d+1]!==y&&(E.opt_len+=(y-z[2*d+1])*z[2*d],z[2*d+1]=y),h--)}})(E,t),K(z,H,E.bl_count)},r=(E,t,z)=>{let A,X,R=-1,u=t[1],p=0,C=7,Z=4;for(0===u&&(C=138,Z=3),t[2*(z+1)+1]=65535,A=0;A<=z;A++)X=u,u=t[2*(A+1)+1],++p<C&&X===u||(p<Z?E.bl_tree[2*X]+=p:0!==X?(X!==R&&E.bl_tree[2*X]++,E.bl_tree[32]++):p<=10?E.bl_tree[34]++:E.bl_tree[36]++,p=0,R=X,0===u?(C=138,Z=3):X===u?(C=6,Z=3):(C=7,Z=4))},i=(E,t,z)=>{let A,X,R=-1,u=t[1],p=0,C=7,Z=4;for(0===u&&(C=138,Z=3),A=0;A<=z;A++)if(X=u,u=t[2*(A+1)+1],!(++p<C&&X===u)){if(p<Z)do{l(E,X,E.bl_tree)}while(0!==--p);else 0!==X?(X!==R&&(l(E,X,E.bl_tree),p--),l(E,16,E.bl_tree),S(E,p-3,2)):p<=10?(l(E,17,E.bl_tree),S(E,p-3,3)):(l(E,18,E.bl_tree),S(E,p-11,7));p=0,R=X,0===u?(C=138,Z=3):X===u?(C=6,Z=3):(C=7,Z=4)}};let g=!1;const o=(E,t,z,A)=>{S(E,0+(A?1:0),3),((E,t,z,A)=>{B(E),A&&(D(E,z),D(E,~z)),E.pending_buf.set(E.window.subarray(t,t+z),E.pending),E.pending+=z})(E,t,z,!0)};E.exports._tr_init=E=>{g||((()=>{let E,t,z,Z,I;const e=new Array(16);for(z=0,Z=0;Z<28;Z++)for(O[Z]=z,E=0;E<1<<u[Z];E++)y[z++]=Z;for(y[z-1]=Z,I=0,Z=0;Z<16;Z++)for(c[Z]=I,E=0;E<1<<p[Z];E++)d[I++]=Z;for(I>>=7;Z<X;Z++)for(c[Z]=I<<7,E=0;E<1<<p[Z]-7;E++)d[256+I++]=Z;for(t=0;t<=R;t++)e[t]=0;for(E=0;E<=143;)H[2*E+1]=8,E++,e[8]++;for(;E<=255;)H[2*E+1]=9,E++,e[9]++;for(;E<=279;)H[2*E+1]=7,E++,e[7]++;for(;E<=287;)H[2*E+1]=8,E++,e[8]++;for(K(H,287,e),E=0;E<X;E++)h[2*E+1]=5,h[2*E]=f(E,5);L=new a(H,u,257,A,R),mE=new a(h,p,0,X,R),W=new a(new Array(0),C,0,19,7)})(),g=!0),E.l_desc=new I(E.dyn_ltree,L),E.d_desc=new I(E.dyn_dtree,mE),E.bl_desc=new I(E.bl_tree,W),E.bi_buf=0,E.bi_valid=0,F(E)},E.exports._tr_stored_block=o,E.exports._tr_flush_block=(E,t,A,X)=>{let R,u,p=0;E.level>0?(2===E.strm.data_type&&(E.strm.data_type=(E=>{let t,A=4093624447;for(t=0;t<=31;t++,A>>>=1)if(1&A&&0!==E.dyn_ltree[2*t])return 0;if(0!==E.dyn_ltree[18]||0!==E.dyn_ltree[20]||0!==E.dyn_ltree[26])return 1;for(t=32;t<z;t++)if(0!==E.dyn_ltree[2*t])return 1;return 0})(E)),V(E,E.l_desc),V(E,E.d_desc),p=(E=>{let t;for(r(E,E.dyn_ltree,E.l_desc.max_code),r(E,E.dyn_dtree,E.d_desc.max_code),V(E,E.bl_desc),t=18;t>=3&&0===E.bl_tree[2*Z[t]+1];t--);return E.opt_len+=3*(t+1)+5+5+4,t})(E),R=E.opt_len+3+7>>>3,u=E.static_len+3+7>>>3,u<=R&&(R=u)):R=u=A+5,A+4<=R&&-1!==t?o(E,t,A,X):4===E.strategy||u===R?(S(E,2+(X?1:0),3),J(E,H,h)):(S(E,4+(X?1:0),3),((E,t,z,A)=>{let X;for(S(E,t-257,5),S(E,z-1,5),S(E,A-4,4),X=0;X<A;X++)S(E,E.bl_tree[2*Z[X]+1],3);i(E,E.dyn_ltree,t-1),i(E,E.dyn_dtree,z-1)})(E,E.l_desc.max_code+1,E.d_desc.max_code+1,p+1),J(E,E.dyn_ltree,E.dyn_dtree)),F(E),X&&B(E)},E.exports._tr_tally=(E,t,A)=>(E.pending_buf[E.d_buf+2*E.last_lit]=t>>>8&255,E.pending_buf[E.d_buf+2*E.last_lit+1]=255&t,E.pending_buf[E.l_buf+E.last_lit]=255&A,E.last_lit++,0===t?E.dyn_ltree[2*A]++:(E.matches++,t--,E.dyn_ltree[2*(y[A]+z+1)]++,E.dyn_dtree[2*e(t)]++),E.last_lit===E.lit_bufsize-1),E.exports._tr_align=E=>{S(E,2,3),l(E,256,H),(E=>{16===E.bi_valid?(D(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):E.bi_valid>=8&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)})(E)}},12957:E=>{"use strict";E.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.ht="",this.state=null,this.data_type=2,this.adler=0}},12602:E=>{function t(E,t,z){for(var A=E.length,X=-1/0,R=1/0,u=0;u<A;u++){var p=(z[0][u]-E[u])/t[u],C=(z[1][u]-E[u])/t[u];if(p>C){var Z=p;p=C,C=Z}if(C<X||p>R)return 1/0;p>X&&(X=p),C<R&&(R=C)}return X>R?1/0:X}E.exports=function(E,z,A,X){var R=t(z,A,X);if(R===1/0)E=null;else{E=E||[];for(var u=0;u<z.length;u++)E[u]=z[u]+A[u]*R}return E},E.exports.distance=t},13925:(E,t,z)=>{"use strict";z.d(t,{b:()=>u});var A=z(25);const X=A.useLayoutEffect;const R=function(E){var t=(0,A.useRef)(E);return X((function(){t.current=E})),t};var u=function(E){var t=R(E);(0,A.Ct)((function(){var E=function(E){var z;if(null!=t.current&&(z=t.current(E)),E.defaultPrevented&&(E.returnValue=""),"string"===typeof z)return E.returnValue=z,z};return window.addEventListener("beforeunload",E),function(){window.removeEventListener("beforeunload",E)}}),[])}},13875:(E,t,z)=>{"use strict";var A=z(13882),X=Array.prototype.concat,R=Array.prototype.slice,u=E.exports=function(E){for(var t=[],z=0,u=E.length;z<u;z++){var p=E[z];A(p)?t=X.call(t,R.call(p)):t.push(p)}return t};u.wrap=function(E){return function(){return E(u(arguments))}}},13882:E=>{E.exports=function(E){return!(!E||"string"===typeof E)&&(E instanceof Array||Array.isArray(E)||E.length>=0&&(E.splice instanceof Function||Object.getOwnPropertyDescriptor(E,E.length-1)&&"String"!==E.constructor.name))}},12877:(E,t,z)=>{var A=z(12881);function X(E){for(var t,z,X=0,R=E.length,u=0;u<E.length;){for(t=E[u],z=0;u<R&&E[u]===t;)++u,++z;X+=A.log2(z)/7|0,X+=A.log2(t>>>0)/7|0,X+=2}return X}t.size=X,t.encode=function(E,t){t||(t=new Uint8Array(X(E)));for(var z,A,R=0,u=t.length,p=0;p<E.length;){for(z=E[p],A=0;p<E.length&&E[p]===z;)++p,++A;for(;R<u&&A>=128;)t[R++]=128+(127&A),A>>>=7;if(R>=u)throw new Error("RLE buffer overflow");for(t[R++]=A,z>>>=0;R<u&&z>=128;)t[R++]=128+(127&z),z>>>=7;if(R>=u)throw new Error("RLE buffer overflow");t[R++]=z}return t},t.decode=function(E,t){for(var z,A,X,R,u=t.length,p=E.length,C=0,Z=0;Z<p;){for(z=0,A=0;Z<p&&E[Z]>=128;)z+=(127&E[Z++])<<A,A+=7;if(z+=E[Z++]<<A,Z>=p)throw new Error("RLE buffer underrun");if(C+z>u)throw new Error("Chunk buffer overflow");for(X=0,A=0;Z<p&&E[Z]>=128;)X+=(127&E[Z++])<<A,A+=7;if(Z>=p)throw new Error("RLE buffer underrun");for(X+=E[Z++]<<A,R=0;R<z;++R)t[C++]=X}return t}},12881:(E,t)=>{"use strict";function z(E){var t=32;return(E&=-E)&&t--,65535&E&&(t-=16),16711935&E&&(t-=8),252645135&E&&(t-=4),858993459&E&&(t-=2),1431655765&E&&(t-=1),t}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(E){return(E>0)-(E<0)},t.abs=function(E){var t=E>>31;return(E^t)-t},t.min=function(E,t){return t^(E^t)&-(E<t)},t.max=function(E,t){return E^(E^t)&-(E<t)},t.isPow2=function(E){return!(E&E-1)&&!!E},t.log2=function(E){var t,z;return t=(E>65535)<<4,t|=z=((E>>>=t)>255)<<3,t|=z=((E>>>=z)>15)<<2,(t|=z=((E>>>=z)>3)<<1)|(E>>>=z)>>1},t.log10=function(E){return E>=1e9?9:E>=1e8?8:E>=1e7?7:E>=1e6?6:E>=1e5?5:E>=1e4?4:E>=1e3?3:E>=100?2:E>=10?1:0},t.popCount=function(E){return 16843009*((E=(858993459&(E-=E>>>1&1431655765))+(E>>>2&858993459))+(E>>>4)&252645135)>>>24},t.countTrailingZeros=z,t.nextPow2=function(E){return E+=0===E,--E,E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)+1},t.prevPow2=function(E){return E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)-(E>>>1)},t.parity=function(E){return E^=E>>>16,E^=E>>>8,E^=E>>>4,27030>>>(E&=15)&1};var A=new Array(256);!function(E){for(var t=0;t<256;++t){var z=t,A=t,X=7;for(z>>>=1;z;z>>>=1)A<<=1,A|=1&z,--X;E[t]=A<<X&255}}(A),t.reverse=function(E){return A[255&E]<<24|A[E>>>8&255]<<16|A[E>>>16&255]<<8|A[E>>>24&255]},t.interleave2=function(E,t){return(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},t.deinterleave2=function(E,t){return(E=65535&((E=16711935&((E=252645135&((E=858993459&((E=E>>>t&1431655765)|E>>>1))|E>>>2))|E>>>4))|E>>>16))<<16>>16},t.interleave3=function(E,t,z){return E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2),(E|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(z=1227133513&((z=3272356035&((z=251719695&((z=4278190335&((z&=1023)|z<<16))|z<<8))|z<<4))|z<<2))<<2},t.deinterleave3=function(E,t){return(E=1023&((E=4278190335&((E=251719695&((E=3272356035&((E=E>>>t&1227133513)|E>>>2))|E>>>4))|E>>>8))|E>>>16))<<22>>22},t.nextCombination=function(E){var t=E|E-1;return t+1|(~t&-~t)-1>>>z(E)+1}},12904:E=>{"use strict";E.exports=function(E,t,z,A){var X=self||window;try{try{var R;try{R=new X.Blob([E])}catch(Z){(R=new(X.BlobBuilder||X.WebKitBlobBuilder||X.MozBlobBuilder||X.MSBlobBuilder)).append(E),R=R.getBlob()}var u=X.URL||X.webkitURL,p=u.createObjectURL(R),C=new X[t](p,z);return u.revokeObjectURL(p),C}catch(Z){return new X[t]("data:application/javascript,".concat(encodeURIComponent(E)),z)}}catch(Z){if(!A)throw Error("Inline worker is not supported");return new X[t](A,z)}}},12587:(E,t,z)=>{"use strict";function A(E,t,z,A,X){var R={};return Object.keys(A).forEach((function(E){R[E]=A[E]})),R.enumerable=!!R.enumerable,R.configurable=!!R.configurable,("value"in R||R.initializer)&&(R.writable=!0),R=z.slice().reverse().reduce((function(z,A){return A(E,t,z)||z}),R),X&&void 0!==R.initializer&&(R.value=R.initializer?R.initializer.call(X):void 0,R.initializer=void 0),void 0===R.initializer&&(Object.defineProperty(E,t,R),R=null),R}z.d(t,{c:()=>A})},12583:(E,t,z)=>{"use strict";function A(E,t,z,A){z&&Object.defineProperty(E,t,{enumerable:z.enumerable,configurable:z.configurable,writable:z.writable,value:z.initializer?z.initializer.call(A):void 0})}z.d(t,{d:()=>A})},13916:(E,t,z)=>{"use strict";z.d(t,{d:()=>u,f:()=>h,h:()=>p,l:()=>R,n:()=>C,r:()=>X,u:()=>Z,w:()=>H});var A=z(12028);class X{constructor(){this._easingMode=X.EASINGMODE_EASEIN}setEasingMode(E){const t=Math.min(Math.max(E,0),2);this._easingMode=t}getEasingMode(){return this._easingMode}easeInCore(E){throw new Error("You must implement this method")}ease(E){switch(this._easingMode){case X.EASINGMODE_EASEIN:return this.easeInCore(E);case X.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-E)}return E>=.5?.5*(1-this.easeInCore(2*(1-E)))+.5:.5*this.easeInCore(2*E)}}X.EASINGMODE_EASEIN=0,X.EASINGMODE_EASEOUT=1,X.EASINGMODE_EASEINOUT=2;class R extends X{easeInCore(E){return E=Math.max(0,Math.min(1,E)),1-Math.sqrt(1-E*E)}}class u extends X{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=E}easeInCore(E){const t=Math.max(0,this.amplitude);return Math.pow(E,3)-E*t*Math.sin(3.141592653589793*E)}}class p extends X{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=E,this.bounciness=t}easeInCore(E){const t=Math.max(0,this.bounces);let z=this.bounciness;z<=1&&(z=1.001);const A=Math.pow(z,t),X=1-z,R=(1-A)/X+.5*A,u=E*R,p=Math.log(-u*(1-z)+1)/Math.log(z),C=Math.floor(p),Z=C+1,H=(1-Math.pow(z,C))/(X*R),h=.5*(H+(1-Math.pow(z,Z))/(X*R)),d=E-h,y=h-H;return-Math.pow(1/z,t-C)/(y*y)*(d-y)*(d+y)}}class C extends X{easeInCore(E){return E*E*E}}class Z extends X{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=E,this.springiness=t}easeInCore(E){let t;const z=Math.max(0,this.oscillations),A=Math.max(0,this.springiness);return t=0==A?E:(Math.exp(A*E)-1)/(Math.exp(A)-1),t*Math.sin((6.283185307179586*z+1.5707963267948966)*E)}}class H extends X{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=E}easeInCore(E){return this.exponent<=0?E:(Math.exp(this.exponent*E)-1)/(Math.exp(this.exponent)-1)}}class h extends X{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=E,this.y1=t,this.x2=z,this.y2=A}easeInCore(E){return A.b.Interpolate(E,this.x1,this.y1,this.x2,this.y2)}}},13397:(E,t,z)=>{"use strict";z.d(t,{d:()=>u});var A=z(11812),X=z(11826),R=z(12227);class u extends R.b{get _matrix(){return this._compose(),this.uy}set _matrix(E){(E.updateFlag!==this.uy.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.uy.R(E),this._markAsDirtyAndDecompose())}constructor(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(E,t.lE(),!1),this.name=E,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=t,this.uy=(null===X||void 0===X?void 0:X.clone())??A.Matrix.Identity(),this._restMatrix=R??this.uy.clone(),this._bindMatrix=u??this.uy.clone(),this._index=p,this._absoluteMatrix=new A.Matrix,this._absoluteBindMatrix=new A.Matrix,this._absoluteInverseBindMatrix=new A.Matrix,this._finalMatrix=new A.Matrix,t.bones.push(this),this.setParent(z,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(E){this.setParent(E)}setParent(E){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==E){if(this.parent){const E=this.parent.children.indexOf(this);-1!==E&&this.parent.children.splice(E,1)}this._parentNode=E,this.parent&&this.parent.children.push(this),t&&this._updateAbsoluteBindMatrices(),this.oZ()}}getLocalMatrix(){return this._compose(),this.uy}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(E){this._restMatrix.R(E)}setRestPose(E){this.setRestMatrix(E)}getBindPose(){return this.getBindMatrix()}setBindMatrix(E){this.Zp(E)}setBindPose(E){this.setBindMatrix(E)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const E=A.TmpVectors.Lt[0],t=A.TmpVectors.Quaternion[0],z=A.TmpVectors.Lt[1];this.getRestMatrix().decompose(E,t,z),this._linkedTransformNode.position.R(z),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??A.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.R(t),this._linkedTransformNode.cp.R(E)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(E){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=E,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Mp}set position(E){this._decompose(),this.Mp.R(E),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(E){this.setRotation(E)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(E){this.setRotationQuaternion(E)}get cp(){return this.getScale()}set cp(E){this.setScale(E)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=A.Lt.Zero(),this._localRotation=A.Quaternion.Zero(),this.Mp=A.Lt.Zero()),this.uy.decompose(this._localScaling,this._localRotation,this.Mp))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,A.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Mp,this.uy)):this._needToCompose=!1)}Zp(E){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.R(E),t&&this._updateAbsoluteBindMatrices(),z?this._matrix=E:this.oZ()}_updateAbsoluteBindMatrices(E){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(E||(E=this._bindMatrix),this.parent?E.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.R(E),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),t)for(let z=0;z<this.children.length;z++)this.children[z]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}oZ(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.oZ(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.oZ(),this._needToDecompose=!0}_updatePosition(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,z=arguments.length>2?arguments[2]:void 0,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const R=this.getLocalMatrix();if(0==t)X?(R.addAtIndex(12,E.x),R.addAtIndex(13,E.y),R.addAtIndex(14,E.z)):R.setTranslationFromFloats(E.x,E.y,E.z);else{let t=null;z&&(t=z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const p=u._TmpMats[0],C=u._TmpVecs[0];this.parent?z&&t?(p.R(this.parent.getAbsoluteMatrix()),p.multiplyToRef(t,p)):p.R(this.parent.getAbsoluteMatrix()):A.Matrix.IdentityToRef(p),X&&p.setTranslationFromFloats(0,0,0),p.invert(),A.Lt.TransformCoordinatesToRef(E,p,C),X?(R.addAtIndex(12,C.x),R.addAtIndex(13,C.y),R.addAtIndex(14,C.z)):R.setTranslationFromFloats(C.x,C.y,C.z)}this._markAsDirtyAndDecompose()}translate(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,z=arguments.length>2?arguments[2]:void 0;this._updatePosition(E,t,z,!0)}setPosition(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,z=arguments.length>2?arguments[2]:void 0;this._updatePosition(E,t,z,!1)}setAbsolutePosition(E,t){this.setPosition(E,1,t)}scale(E,t,z){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const R=this.getLocalMatrix(),p=u._TmpMats[0];A.Matrix.ScalingToRef(E,t,z,p),p.multiplyToRef(R,R),p.invert();for(const A of this.children){const X=A.getLocalMatrix();X.multiplyToRef(p,X),X.multiplyAtIndex(12,E),X.multiplyAtIndex(13,t),X.multiplyAtIndex(14,z),A._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),X)for(const A of this.children)A.scale(E,t,z,X)}setScale(E){this._decompose(),this._localScaling.R(E),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(E){this._decompose(),E.R(this._localScaling)}setYawPitchRoll(E,t,z){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=arguments.length>4?arguments[4]:void 0;if(0===X){const p=u._TmpQuat;return A.Quaternion.RotationYawPitchRollToRef(E,t,z,p),void this.setRotationQuaternion(p,X,R)}const p=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(p,R))return;const C=u._TmpMats[1];A.Matrix.RotationYawPitchRollToRef(E,t,z,C),p.multiplyToRef(C,C),this._rotateWithMatrix(C,X,R)}rotate(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3?arguments[3]:void 0;const R=u._TmpMats[0];R.setTranslationFromFloats(0,0,0),A.Matrix.RotationAxisToRef(E,t,R),this._rotateWithMatrix(R,z,X)}setAxisAngle(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3?arguments[3]:void 0;if(0===z){const R=u._TmpQuat;return A.Quaternion.RotationAxisToRef(E,t,R),void this.setRotationQuaternion(R,z,X)}const R=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(R,X))return;const p=u._TmpMats[1];A.Matrix.RotationAxisToRef(E,t,p),R.multiplyToRef(p,p),this._rotateWithMatrix(p,z,X)}setRotation(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,z=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(E.y,E.x,E.z,t,z)}setRotationQuaternion(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,z=arguments.length>2?arguments[2]:void 0;if(0===t)return this._decompose(),this._localRotation.R(E),void this._markAsDirtyAndCompose();const X=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,z))return;const R=u._TmpMats[1];A.Matrix.FromQuaternionToRef(E,R),X.multiplyToRef(R,R),this._rotateWithMatrix(R,t,z)}setRotationMatrix(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,z=arguments.length>2?arguments[2]:void 0;if(0===t){const X=u._TmpQuat;return A.Quaternion.FromRotationMatrixToRef(E,X),void this.setRotationQuaternion(X,t,z)}const X=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,z))return;const R=u._TmpMats[1];R.R(E),X.multiplyToRef(E,R),this._rotateWithMatrix(R,t,z)}_rotateWithMatrix(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,z=arguments.length>2?arguments[2]:void 0;const A=this.getLocalMatrix(),X=A.m[12],R=A.m[13],p=A.m[14],C=this.getParent(),Z=u._TmpMats[3],H=u._TmpMats[4];C&&1==t?(z?(Z.R(z.getWorldMatrix()),C.getAbsoluteMatrix().multiplyToRef(Z,Z)):Z.R(C.getAbsoluteMatrix()),H.R(Z),H.invert(),A.multiplyToRef(Z,A),A.multiplyToRef(E,A),A.multiplyToRef(H,A)):1==t&&z?(Z.R(z.getWorldMatrix()),H.R(Z),H.invert(),A.multiplyToRef(Z,A),A.multiplyToRef(E,A),A.multiplyToRef(H,A)):A.multiplyToRef(E,A),A.setTranslationFromFloats(X,R,p),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(E,t){const z=u._TmpMats[2];return E.R(this.getAbsoluteMatrix()),t?(E.multiplyToRef(t.getWorldMatrix(),E),A.Matrix.ScalingToRef(t.cp.x,t.cp.y,t.cp.z,z)):A.Matrix.IdentityToRef(z),E.invert(),!isNaN(E.m[0])&&(z.multiplyAtIndex(0,this._scalingDeterminant),E.multiplyToRef(z,E),!0)}gt(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const z=A.Lt.Zero();return this.getPositionToRef(E,t,z),z}getPositionToRef(){let E=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const E=this.getLocalMatrix();t.x=E.m[12],t.y=E.m[13],t.z=E.m[14]}else{let z=null;E&&(z=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let A=u._TmpMats[0];E&&z?(A.R(this.getAbsoluteMatrix()),A.multiplyToRef(z,A)):A=this.getAbsoluteMatrix(),t.x=A.m[12],t.y=A.m[13],t.z=A.m[14]}}getAbsolutePosition(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=A.Lt.Zero();return this.getPositionToRef(1,E,t),t}getAbsolutePositionToRef(E,t){this.getPositionToRef(1,E,t)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.uy.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.R(this.uy);const E=this._skeleton.getPoseMatrix();E&&this._absoluteMatrix.multiplyToRef(E,this._absoluteMatrix)}const E=this.children,t=E.length;for(let z=0;z<t;z++)E[z].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}cC(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const z=A.Lt.Zero();return this.getDirectionToRef(E,t,z),z}getDirectionToRef(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2?arguments[2]:void 0,X=null;t&&(X=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const R=u._TmpMats[0];R.R(this.getAbsoluteMatrix()),t&&X&&R.multiplyToRef(X,R),A.Lt.TransformNormalToRef(E,R,z),z.normalize()}getRotation(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const z=A.Lt.Zero();return this.getRotationToRef(E,t,z),z}getRotationToRef(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2?arguments[2]:void 0;const A=u._TmpQuat;this.getRotationQuaternionToRef(E,t,A),A.toEulerAnglesToRef(z)}getRotationQuaternion(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const z=A.Quaternion.Identity();return this.getRotationQuaternionToRef(E,t,z),z}getRotationQuaternionToRef(){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),t.R(this._localRotation);else{const z=u._TmpMats[0],A=this.getAbsoluteMatrix();E?A.multiplyToRef(E.getWorldMatrix(),z):z.R(A),z.multiplyAtIndex(0,this._scalingDeterminant),z.multiplyAtIndex(1,this._scalingDeterminant),z.multiplyAtIndex(2,this._scalingDeterminant),z.decompose(void 0,t,void 0)}}getRotationMatrix(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;const z=A.Matrix.Identity();return this.getRotationMatrixToRef(E,t,z),z}getRotationMatrixToRef(){let E=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(t);else{const z=u._TmpMats[0],A=this.getAbsoluteMatrix();E?A.multiplyToRef(E.getWorldMatrix(),z):z.R(A),z.multiplyAtIndex(0,this._scalingDeterminant),z.multiplyAtIndex(1,this._scalingDeterminant),z.multiplyAtIndex(2,this._scalingDeterminant),z.getRotationMatrixToRef(t)}}getAbsolutePositionFromLocal(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const z=A.Lt.Zero();return this.getAbsolutePositionFromLocalToRef(E,t,z),z}getAbsolutePositionFromLocalToRef(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2?arguments[2]:void 0,X=null;t&&(X=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const R=u._TmpMats[0];R.R(this.getAbsoluteMatrix()),t&&X&&R.multiplyToRef(X,R),A.Lt.TransformCoordinatesToRef(E,R,z)}getLocalPositionFromAbsolute(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const z=A.Lt.Zero();return this.getLocalPositionFromAbsoluteToRef(E,t,z),z}getLocalPositionFromAbsoluteToRef(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2?arguments[2]:void 0,X=null;t&&(X=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const R=u._TmpMats[0];R.R(this.getAbsoluteMatrix()),t&&X&&R.multiplyToRef(X,R),R.invert(),A.Lt.TransformCoordinatesToRef(E,R,z)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const E=this._skeleton.bones.indexOf(this);if(-1!==E&&this._skeleton.bones.splice(E,1),this._parentNode&&this._parentNode.children){const E=this._parentNode.children,t=E.indexOf(this);-1!==t&&E.splice(t,1)}super.dispose()}}u._TmpVecs=(0,X.c)(2,A.Lt.Zero),u._TmpQuat=A.Quaternion.Identity(),u._TmpMats=(0,X.c)(5,A.Matrix.Identity)},13913:(E,t,z)=>{"use strict";z.d(t,{b:()=>V});var A=z(11792),X=z(11801),R=z(11632),u=z(11812),p=z(11834),C=z(12227),Z=z(12250),H=z(12090),h=z(11649),d=z(11817);class y{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(E){this._zoomStopsAnimation=E}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(E){this._idleRotationSpeed=E}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(E){this._idleRotationWaitTime=E}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(E){this._idleRotationSpinupTime=E}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(E){this._attachedCamera=E;const t=this._attachedCamera.lE();this._onPrePointerObservableObserver=t.onPrePointerObservable.add((E=>{E.type!==H.b.POINTERDOWN?E.type===H.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=E.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const E=h.c.Now;let t=0;null!=this._lastFrameTime&&(t=E-this._lastFrameTime),this._lastFrameTime=E,this._applyUserInteraction();const z=E-this._lastInteractionTime-this._idleRotationWaitTime,A=Math.max(Math.min(z/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*A,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(t/1e3))}))}detach(){if(!this._attachedCamera)return;const E=this._attachedCamera.lE();this._onPrePointerObservableObserver&&E.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(E){this._lastInteractionTime=E??h.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<d.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let E=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(E=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?E:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=h.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var O=z(13916),c=z(12342);class a{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(E){if(this._autoTransitionRange===E)return;this._autoTransitionRange=E;const t=this._attachedCamera;t&&(E?this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((E=>{if(E&&(E.Hp(!0),E.getBoundingInfo)){const t=E.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*t,this.upperRadiusTransitionRange=.05*t}})):this._onMeshTargetChangedObserver&&t.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(E){this._attachedCamera=E,this._onAfterCheckInputsObserver=E.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(E){return!!this._attachedCamera&&(this._attachedCamera.radius===E&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(E){if(!this._attachedCamera)return;this._radiusBounceTransition||(a.EasingFunction.setEasingMode(a.EasingMode),this._radiusBounceTransition=c.c.CreateAnimation("radius",c.c.ANIMATIONTYPE_FLOAT,60,a.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const t=c.c.TransitionTo("radius",this._attachedCamera.radius+E,this._attachedCamera,this._attachedCamera.lE(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));t&&this._animatables.push(t)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}a.EasingFunction=new O.d(.3),a.EasingMode=O.r.EASINGMODE_EASEOUT;class L{constructor(){this.onTargetFramingAnimationEndObservable=new R.b,this._mode=L.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(E){this._mode=E}get mode(){return this._mode}set radiusScale(E){this._radiusScale=E}get radiusScale(){return this._radiusScale}set positionScale(E){this._positionScale=E}get positionScale(){return this._positionScale}set defaultElevation(E){this._defaultElevation=E}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(E){this._elevationReturnTime=E}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(E){this._elevationReturnWaitTime=E}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(E){this._zoomStopsAnimation=E}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(E){this._framingTime=E}get framingTime(){return this._framingTime}init(){}attach(E){this._attachedCamera=E;const t=this._attachedCamera.lE();L.EasingFunction.setEasingMode(L.EasingMode),this._onPrePointerObservableObserver=t.onPrePointerObservable.add((E=>{E.type!==H.b.POINTERDOWN?E.type===H.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=E.onMeshTargetChangedObservable.add((E=>{E&&E.getBoundingInfo&&this.zoomOnMesh(E,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=E.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const E=this._attachedCamera.lE();this._onPrePointerObservableObserver&&E.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(E){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;E.Hp(!0);const A=E.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(A.minimumWorld,A.maximumWorld,t,z)}zoomOnMeshHierarchy(E){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;E.Hp(!0);const A=E.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(A.min,A.max,t,z)}zoomOnMeshesHierarchy(E){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new u.Lt(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),X=new u.Lt(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let R=0;R<E.length;R++){const t=E[R].getHierarchyBoundingVectors(!0);u.Lt.CheckExtends(t.min,A,X),u.Lt.CheckExtends(t.max,A,X)}this.zoomOnBoundingInfo(A,X,t,z)}zoomOnBoundingInfo(E,t){let z,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const R=E.y,p=R+(t.y-R)*this._positionScale,C=t.Wt(E).scale(.5);if(!isFinite(p))return!1;if(A)z=new u.Lt(0,p,0);else{const t=E.add(C);z=new u.Lt(t.x,p,t.z)}this._vectorTransition||(this._vectorTransition=c.c.CreateAnimation("target",c.c.ANIMATIONTYPE_VECTOR3,60,L.EasingFunction)),this._betaIsAnimating=!0;let Z=c.c.TransitionTo("target",z,this._attachedCamera,this._attachedCamera.lE(),60,this._vectorTransition,this._framingTime);Z&&this._animatables.push(Z);let H=0;if(this._mode===L.FitFrustumSidesMode){const z=this._calculateLowerRadiusFromModelBoundingSphere(E,t);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=C.length()+this._attachedCamera.Cp),H=z}else this._mode===L.IgnoreBoundsSizeMode&&(H=this._calculateLowerRadiusFromModelBoundingSphere(E,t),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Cp));if(this.autoCorrectCameraLimitsAndSensibility){const z=t.Wt(E).length();this._attachedCamera.panningSensibility=5e3/z,this._attachedCamera.wheelPrecision=100/H}return this._radiusTransition||(this._radiusTransition=c.c.CreateAnimation("radius",c.c.ANIMATIONTYPE_FLOAT,60,L.EasingFunction)),Z=c.c.TransitionTo("radius",H,this._attachedCamera,this._attachedCamera.lE(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),X&&X(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),Z&&this._animatables.push(Z),!0}_calculateLowerRadiusFromModelBoundingSphere(E,t){const z=this._attachedCamera;if(!z)return 0;let A=z._calculateLowerRadiusFromModelBoundingSphere(E,t,this._radiusScale);return z.lowerRadiusLimit&&this._mode===L.IgnoreBoundsSizeMode&&(A=A<z.lowerRadiusLimit?z.lowerRadiusLimit:A),z.upperRadiusLimit&&(A=A>z.upperRadiusLimit?z.upperRadiusLimit:A),A}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const E=h.c.Now-this._lastInteractionTime,t=.5*Math.PI-this._defaultElevation,z=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>z&&E>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=c.c.CreateAnimation("beta",c.c.ANIMATIONTYPE_FLOAT,60,L.EasingFunction));const E=c.c.TransitionTo("beta",t,this._attachedCamera,this._attachedCamera.lE(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));E&&this._animatables.push(E)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=h.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}L.EasingFunction=new O.w,L.EasingMode=O.r.EASINGMODE_EASEINOUT,L.IgnoreBoundsSizeMode=0,L.FitFrustumSidesMode=1;var mE=z(12256),W=z(12295),I=z(13391),e=z(11630);class D{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(E){E=e.Tools.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),z=t.getInputElement();let A=0,X=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=R=>{var u,p;const C=R.event,Z="touch"===C.pointerType;if(R.type!==H.b.POINTERMOVE&&-1===this.buttons.indexOf(C.button))return;const h=C.target;if(this._altKey=C.altKey,this._ctrlKey=C.ctrlKey,this._metaKey=C.metaKey,this._shiftKey=C.shiftKey,this._buttonsPressed=C.buttons,t.isPointerLock){const E=C.movementX,t=C.movementY;this.onTouch(null,E,t),this._pointA=null,this._pointB=null}else{if(R.type!==H.b.POINTERDOWN&&R.type!==H.b.POINTERDOUBLETAP&&Z&&(null===(u=this._pointA)||void 0===u?void 0:u.pointerId)!==C.pointerId&&(null===(p=this._pointB)||void 0===p?void 0:p.pointerId)!==C.pointerId)return;if(R.type!==H.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!Z)if(R.type===H.b.POINTERDOUBLETAP)this.onDoubleTap(C.pointerType);else if(R.type!==H.b.POINTERUP||this._currentMousePointerIdDown!==C.pointerId&&!Z){if(R.type===H.b.POINTERMOVE)if(E||C.preventDefault(),this._pointA&&null===this._pointB){const E=C.clientX-this._pointA.x,t=C.clientY-this._pointA.y;this._pointA.x=C.clientX,this._pointA.y=C.clientY,this.onTouch(this._pointA,E,t)}else if(this._pointA&&this._pointB){const E=this._pointA.pointerId===C.pointerId?this._pointA:this._pointB;E.x=C.clientX,E.y=C.clientY;const t=this._pointA.x-this._pointB.x,z=this._pointA.y-this._pointB.y,u=t*t+z*z,p={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:C.pointerId,type:R.type};this.onMultiTouch(this._pointA,this._pointB,A,u,X,p),X=p,A=u}}else{try{null===h||void 0===h||h.releasePointerCapture(C.pointerId)}catch(d){}Z||(this._pointB=null),t._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==C.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==C.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==A||X)&&(this.onMultiTouch(this._pointA,this._pointB,A,0,X,null),A=0,X=null),this._currentMousePointerIdDown=-1,this.onButtonUp(C),E||C.preventDefault()}else{try{null===h||void 0===h||h.setPointerCapture(C.pointerId)}catch(d){}if(null===this._pointA)this._pointA={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType};else{if(null!==this._pointB)return;this._pointB={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType}}-1!==this._currentMousePointerIdDown||Z||(this._currentMousePointerIdDown=C.pointerId),this.onButtonDown(C),E||(C.preventDefault(),z&&z.focus())}}},this._observer=this.camera.lE()._inputManager._addCameraPointerObserver(this._pointerInput,H.b.POINTERDOWN|H.b.POINTERUP|H.b.POINTERMOVE|H.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,A=0,X=null,this.onLostFocus()},this._contextMenuBind=E=>this.onContextMenu(E),z&&z.addEventListener("contextmenu",this._contextMenuBind,!1);const R=this.camera.lE().getEngine().getHostWindow();R&&e.Tools.RegisterTopRootEvents(R,[{name:"blur",handler:this._onLostFocus}])}qh(){if(this._onLostFocus){const E=this.camera.lE().getEngine().getHostWindow();E&&e.Tools.UnregisterTopRootEvents(E,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.lE()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const E=this.camera.lE().getEngine().getInputElement();E&&E.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(E){}onTouch(E,t,z){}onMultiTouch(E,t,z,A,X,R){}onContextMenu(E){E.preventDefault()}onButtonDown(E){}onButtonUp(E){}onLostFocus(){}}(0,A.b)([(0,X.K)()],D.prototype,"buttons",void 0);class S extends D{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(E,t){if(0!==this.panningSensibility&&E&&t){const z=t.x-E.x,A=t.y-E.y;this.camera.inertialPanningX+=-z/this.panningSensibility,this.camera.inertialPanningY+=A/this.panningSensibility}}_computePinchZoom(E,t){const z=this.camera.radius||S.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=z*Math.sqrt(E)/Math.sqrt(t):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(t-E)*z*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(t-E)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(E,t,z){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=z/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=z/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(E,t,z,A,X,R){0===z&&null===X||0===A&&null===R||(this.multiTouchPanAndZoom?(this._computePinchZoom(z,A),this._computeMultiTouchPanning(X,R)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(A)-Math.sqrt(z))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(z,A),this._isPinching=!0):this._computeMultiTouchPanning(X,R)):this.multiTouchPanning?this._computeMultiTouchPanning(X,R):this.pinchZoom&&this._computePinchZoom(z,A))}onButtonDown(E){this._isPanClick=E.button===this.camera._panningMouseButton}onButtonUp(E){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}S.MinimumRadiusForPinch=.001,(0,A.b)([(0,X.K)()],S.prototype,"buttons",void 0),(0,A.b)([(0,X.K)()],S.prototype,"angularSensibilityX",void 0),(0,A.b)([(0,X.K)()],S.prototype,"angularSensibilityY",void 0),(0,A.b)([(0,X.K)()],S.prototype,"pinchPrecision",void 0),(0,A.b)([(0,X.K)()],S.prototype,"pinchDeltaPercentage",void 0),(0,A.b)([(0,X.K)()],S.prototype,"useNaturalPinchZoom",void 0),(0,A.b)([(0,X.K)()],S.prototype,"pinchZoom",void 0),(0,A.b)([(0,X.K)()],S.prototype,"panningSensibility",void 0),(0,A.b)([(0,X.K)()],S.prototype,"multiTouchPanning",void 0),(0,A.b)([(0,X.K)()],S.prototype,"multiTouchPanAndZoom",void 0),I.c.ArcRotateCameraPointersInput=S;var l=z(12094);class f{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(E){E=e.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.lE(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((t=>{const z=t.event;if(!z.metaKey)if(t.type===l.e.KEYDOWN){if(this._ctrlPressed=z.ctrlKey,this._altPressed=z.altKey,-1!==this.keysUp.indexOf(z.keyCode)||-1!==this.keysDown.indexOf(z.keyCode)||-1!==this.keysLeft.indexOf(z.keyCode)||-1!==this.keysRight.indexOf(z.keyCode)||-1!==this.keysReset.indexOf(z.keyCode)){-1===this._keys.indexOf(z.keyCode)&&this._keys.push(z.keyCode),z.preventDefault&&(E||z.preventDefault())}}else if(-1!==this.keysUp.indexOf(z.keyCode)||-1!==this.keysDown.indexOf(z.keyCode)||-1!==this.keysLeft.indexOf(z.keyCode)||-1!==this.keysRight.indexOf(z.keyCode)||-1!==this.keysReset.indexOf(z.keyCode)){const t=this._keys.indexOf(z.keyCode);t>=0&&this._keys.splice(t,1),z.preventDefault&&(E||z.preventDefault())}})))}qh(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const E=this.camera;for(let t=0;t<this._keys.length;t++){const z=this._keys[t];-1!==this.keysLeft.indexOf(z)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningX-=1/this.panningSensibility:E.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(z)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?E.inertialRadiusOffset+=1/this.zoomingSensibility:E.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(z)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningX+=1/this.panningSensibility:E.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(z)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?E.inertialRadiusOffset-=1/this.zoomingSensibility:E.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(z)&&E.useInputToRestoreState&&E.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,A.b)([(0,X.K)()],f.prototype,"keysUp",void 0),(0,A.b)([(0,X.K)()],f.prototype,"keysDown",void 0),(0,A.b)([(0,X.K)()],f.prototype,"keysLeft",void 0),(0,A.b)([(0,X.K)()],f.prototype,"keysRight",void 0),(0,A.b)([(0,X.K)()],f.prototype,"keysReset",void 0),(0,A.b)([(0,X.K)()],f.prototype,"panningSensibility",void 0),(0,A.b)([(0,X.K)()],f.prototype,"zoomingSensibility",void 0),(0,A.b)([(0,X.K)()],f.prototype,"useAltToZoom",void 0),(0,A.b)([(0,X.K)()],f.prototype,"angularSpeed",void 0),I.c.ArcRotateCameraKeyboardMoveInput=f;var K=z(11861),F=z(12096);class B{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new u.Lt(0,0,0),this._globalOffset=new u.Lt(0,0,0),this._inertialPanning=u.Lt.Zero()}_computeDeltaFromMouseWheelLegacyEvent(E,t){let z=0;const A=.01*E*this.wheelDeltaPercentage*t;return z=E>0?A/(1+this.wheelDeltaPercentage):A*(1+this.wheelDeltaPercentage),z}attachControl(E){E=e.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==H.b.POINTERWHEEL)return;const z=t.event;let A=0;const X=z.deltaMode===F.e.DOM_DELTA_LINE?40:1,R=-z.deltaY*X;if(this.customComputeDeltaFromMouseWheel)A=this.customComputeDeltaFromMouseWheel(R,this,z);else if(this.wheelDeltaPercentage){if(A=this._computeDeltaFromMouseWheelLegacyEvent(R,this.camera.radius),A>0){let E=this.camera.radius,t=this.camera.inertialRadiusOffset+A;for(let z=0;z<20&&!(E<=t)&&!(Math.abs(t*this.camera.inertia)<.001);z++)E-=t,t*=this.camera.inertia;E=(0,p.Clamp)(E,0,Number.MAX_VALUE),A=this._computeDeltaFromMouseWheelLegacyEvent(R,E)}}else A=R/(40*this.wheelPrecision);A&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(A)):this.camera.inertialRadiusOffset+=A),z.preventDefault&&(E||z.preventDefault())},this._observer=this.camera.lE()._inputManager._addCameraPointerObserver(this._wheel,H.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.ap(0)}qh(){this._observer&&(this.camera.lE()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const E=this.camera;0+E.inertialAlphaOffset+E.inertialBetaOffset+E.inertialRadiusOffset&&(this._updateHitPlane(),E.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(E.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const E=this.camera,t=E.target.Wt(E.position);this._hitPlane=K.d.FromPositionAndNormal(E.target,t)}_getPosition(){const E=this.camera,t=E.lE(),z=t.createPickingRay(t.pointerX,t.pointerY,u.Matrix.Identity(),E,!1);0===E.targetScreenOffset.x&&0===E.targetScreenOffset.y||(this._viewOffset.set(E.targetScreenOffset.x,E.targetScreenOffset.y,0),E.getViewMatrix().invertToRef(E._cameraTransformMatrix),this._globalOffset=u.Lt.TransformNormal(this._viewOffset,E._cameraTransformMatrix),z.origin.addInPlace(this._globalOffset));let A=0;return this._hitPlane&&(A=z.intersectsPlane(this._hitPlane)??0),z.origin.addInPlace(z.direction.scaleInPlace(A))}_zoomToMouse(E){const t=this.camera,z=1-t.inertia;if(t.lowerRadiusLimit){const A=t.lowerRadiusLimit??0;t.radius-(t.inertialRadiusOffset+E)/z<A&&(E=(t.radius-A)*z-t.inertialRadiusOffset)}if(t.upperRadiusLimit){const A=t.upperRadiusLimit??0;t.radius-(t.inertialRadiusOffset+E)/z>A&&(E=(t.radius-A)*z-t.inertialRadiusOffset)}const A=E/z/t.radius,X=this._getPosition(),R=u.TmpVectors.Lt[6];X.subtractToRef(t.target,R),R.scaleInPlace(A),R.scaleInPlace(z),this._inertialPanning.addInPlace(R),t.inertialRadiusOffset+=E}_zeroIfClose(E){Math.abs(E.x)<d.c&&(E.x=0),Math.abs(E.y)<d.c&&(E.y=0),Math.abs(E.z)<d.c&&(E.z=0)}}(0,A.b)([(0,X.K)()],B.prototype,"wheelPrecision",void 0),(0,A.b)([(0,X.K)()],B.prototype,"zoomToMouseLocation",void 0),(0,A.b)([(0,X.K)()],B.prototype,"wheelDeltaPercentage",void 0),I.c.ArcRotateCameraMouseWheelInput=B;class b extends I.e{constructor(E){super(E)}addMouseWheel(){return this.add(new B),this}addPointers(){return this.add(new S),this}addKeyboard(){return this.add(new f),this}}var x=z(11766);function J(E,t){return isNaN(E)?t:E}C.b.AddNodeConstructor("ArcRotateCamera",((E,t)=>()=>new V(E,0,0,1,u.Lt.Zero(),t)));class V extends W.e{get target(){return this._target}set target(E){this.setTarget(E)}get targetHost(){return this._targetHost}set targetHost(E){E&&this.setTarget(E)}getTarget(){return this.target}get position(){return this._position}set position(E){this.setPosition(E)}set upVector(E){this._upToYMatrix||(this._yToUpMatrix=new u.Matrix,this._upToYMatrix=new u.Matrix,this._upVector=u.Lt.Zero()),E.normalize(),this._upVector.R(E),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){u.Matrix.RotationAlignToRef(u.Lt.UpReadOnly,this._upVector,this._yToUpMatrix),u.Matrix.RotationAlignToRef(this._upVector,u.Lt.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const E=this.inputs.attached.pointers;return E?E.angularSensibilityX:0}set angularSensibilityX(E){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=E)}get angularSensibilityY(){const E=this.inputs.attached.pointers;return E?E.angularSensibilityY:0}set angularSensibilityY(E){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=E)}get pinchPrecision(){const E=this.inputs.attached.pointers;return E?E.pinchPrecision:0}set pinchPrecision(E){const t=this.inputs.attached.pointers;t&&(t.pinchPrecision=E)}get pinchDeltaPercentage(){const E=this.inputs.attached.pointers;return E?E.pinchDeltaPercentage:0}set pinchDeltaPercentage(E){const t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=E)}get useNaturalPinchZoom(){const E=this.inputs.attached.pointers;return!!E&&E.useNaturalPinchZoom}set useNaturalPinchZoom(E){const t=this.inputs.attached.pointers;t&&(t.useNaturalPinchZoom=E)}get panningSensibility(){const E=this.inputs.attached.pointers;return E?E.panningSensibility:0}set panningSensibility(E){const t=this.inputs.attached.pointers;t&&(t.panningSensibility=E)}get keysUp(){const E=this.inputs.attached.keyboard;return E?E.keysUp:[]}set keysUp(E){const t=this.inputs.attached.keyboard;t&&(t.keysUp=E)}get keysDown(){const E=this.inputs.attached.keyboard;return E?E.keysDown:[]}set keysDown(E){const t=this.inputs.attached.keyboard;t&&(t.keysDown=E)}get keysLeft(){const E=this.inputs.attached.keyboard;return E?E.keysLeft:[]}set keysLeft(E){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=E)}get keysRight(){const E=this.inputs.attached.keyboard;return E?E.keysRight:[]}set keysRight(E){const t=this.inputs.attached.keyboard;t&&(t.keysRight=E)}get wheelPrecision(){const E=this.inputs.attached.mousewheel;return E?E.wheelPrecision:0}set wheelPrecision(E){const t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=E)}get zoomToMouseLocation(){const E=this.inputs.attached.mousewheel;return!!E&&E.zoomToMouseLocation}set zoomToMouseLocation(E){const t=this.inputs.attached.mousewheel;t&&(t.zoomToMouseLocation=E)}get wheelDeltaPercentage(){const E=this.inputs.attached.mousewheel;return E?E.wheelDeltaPercentage:0}set wheelDeltaPercentage(E){const t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=E)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(E){E!==this.useBouncingBehavior&&(E?(this._bouncingBehavior=new a,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(E){E!==this.useFramingBehavior&&(E?(this._framingBehavior=new L,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(E){E!==this.useAutoRotationBehavior&&(E?(this._autoRotationBehavior=new y,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(E,t,z,A,X,p){var C;let Z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(E,u.Lt.Zero(),p,Z),C=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=u.Lt.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=u.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new u.Matrix,this.panningAxis=new u.Lt(1,1,0),this._transformedDirection=new u.Lt,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new R.b,this.checkCollisions=!1,this.collisionRadius=new u.Lt(.5,.5,.5),this._previousPosition=u.Lt.Zero(),this._collisionVelocity=u.Lt.Zero(),this._newPosition=u.Lt.Zero(),this._computationVector=u.Lt.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new u.Lt(NaN,NaN,NaN),this._goalTargetScreenOffset=new u.Vector2(NaN,NaN),this._onCollisionPositionChange=function(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;z?(C.setPosition(t),C.uO&&C.uO(z)):C._previousPosition.R(C._position);const A=Math.cos(C.alpha),X=Math.sin(C.alpha),R=Math.cos(C.beta);let u=Math.sin(C.beta);0===u&&(u=1e-4);const p=C._getTargetPosition();C._computationVector.Op(C.radius*A*u,C.radius*R,C.radius*X*u),p.addToRef(C._computationVector,C._newPosition),C._position.R(C._newPosition);let Z=C.upVector;C.allowUpsideDown&&C.beta<0&&(Z=Z.clone(),Z=Z.negate()),C._computeViewMatrix(C._position,p,Z),C._viewMatrix.addAtIndex(12,C.targetScreenOffset.x),C._viewMatrix.addAtIndex(13,C.targetScreenOffset.y),C._collisionTriggered=!1},this._target=u.Lt.Zero(),X&&this.setTarget(X),this.alpha=t,this.beta=z,this.radius=A,this.getViewMatrix(),this.inputs=new b(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new u.Lt(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=u.Vector2.Zero()}_updateCache(E){E||super._updateCache(),this._cache._target.R(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.R(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const E=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?E.addToRef(this._targetBoundingCenter,this._target):this._target.R(E)}const E=this._getLockedTargetPosition();return E||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>d.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,R=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=R?this._currentInterpolationFactor=R:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=J(E,this._goalAlpha),this._goalBeta=J(t,this._goalBeta),this._goalRadius=J(z,this._goalRadius),this._goalTarget.set(J(A.x,this._goalTarget.x),J(A.y,this._goalTarget.y),J(A.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(J(X.x,this._goalTargetScreenOffset.x),J(X.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,p.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,p.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,p.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,p.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(E,t){let z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const X=arguments;t=e.Tools.BackCompatCameraNoPreventDefault(X),this._useCtrlForPanning=z,this._panningMouseButton=A,"boolean"===typeof X[0]&&(X.length>1&&(this._useCtrlForPanning=X[1]),X.length>2&&(this._panningMouseButton=X[2])),this.inputs.attachElement(t),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}qh(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let E=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){E=!0;const t=this.invertRotation?-1:1,z=this._calculateHandednessMultiplier();let A=this.inertialAlphaOffset*z;this.beta<0&&(A*=-1),this.alpha+=A*t,this.beta+=this.inertialBetaOffset*t,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<d.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<d.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*d.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){E=!0;const t=new u.Lt(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),t.multiplyInPlace(this.panningAxis),u.Lt.TransformNormalToRef(t,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const E=this.upVector,t=u.Lt.CrossToRef(this._transformedDirection,E,this._transformedDirection);u.Lt.CrossToRef(E,t,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);u.Lt.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.R(this._transformedDirection)}else{if(this.parent){const E=u.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(E),E.transposeToRef(E),u.Lt.TransformCoordinatesToRef(this._transformedDirection,E,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*d.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*d.c&&(this.inertialPanningY=0)}if(E)this.stopInterpolation();else if(this._isInterpolating){let E=!1;const t=this._scene.getEngine().getDeltaTime()/1e3,z=1-Math.pow(2,-t/this._currentInterpolationFactor),A=J(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const t=u.TmpVectors.Lt[0].set(J(this._goalTarget.x,this._target.x),J(this._goalTarget.y,this._target.y),J(this._goalTarget.z,this._target.z));u.Lt.LerpToRef(this.target,t,z,this._target),10*u.Lt.Distance(this.target,t)/A<d.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.R(t),this.setTarget(this.target,!1,!0,!0)):E=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const t=u.Quaternion.RotationAlphaBetaGammaToRef(J(this._goalAlpha,this.alpha),J(this._goalBeta,this.beta),0,u.TmpVectors.Quaternion[0]),A=u.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,u.TmpVectors.Quaternion[1]),X=u.Quaternion.SlerpToRef(A,t,z,u.TmpVectors.Quaternion[2]);X.normalize();const R=X.toAlphaBetaGammaToRef(u.TmpVectors.Lt[0]);if(this.alpha=R.x,this.beta=R.y,X.isApprox(t,d.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const E=t.toAlphaBetaGammaToRef(u.TmpVectors.Lt[0]);this.alpha=E.x,this.beta=E.y}else E=!0}if(isNaN(this._goalRadius)||(this.radius+=(A-this.radius)*z,Math.abs(A/this.radius-1)<d.c?(this._goalRadius=NaN,this.radius=A):E=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const t=u.TmpVectors.Vector2[0].set(J(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),J(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));u.Vector2.LerpToRef(this.targetScreenOffset,t,z,this.targetScreenOffset),u.Vector2.Distance(this.targetScreenOffset,t)<d.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.R(t)):E=!0}this._isInterpolating=E}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||u.Lt.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const E=this.alpha;var t,z;this.alpha=function(E){let t=Math.PI/2;return 0===E.x&&0===E.z||(t=Math.acos(E.x/Math.sqrt(Math.pow(E.x,2)+Math.pow(E.z,2)))),E.z<0&&(t=2*Math.PI-t),t}(this._computationVector),this.beta=(t=this._computationVector.y,z=this.radius,Math.acos(t/z));const A=Math.round((E-this.alpha)/(2*Math.PI));this.alpha+=2*A*Math.PI,this._checkLimits()}setPosition(E){this._position.equals(E)||(this._position.R(E),this.rebuildAnglesAndRadius())}setTarget(E){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(A=this.overrideCloneAlphaBetaRadius??A,E.Hp)t&&E.getBoundingInfo?this._targetBoundingCenter=E.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,E.Hp(),this._targetHost=E,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const t=E,A=this._getTargetPosition();if(A&&!z&&A.equals(t))return;this._targetHost=null,this._target=t,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}A||this.rebuildAnglesAndRadius()}_getViewMatrix(){const E=Math.cos(this.alpha),t=Math.sin(this.alpha),z=Math.cos(this.beta);let A=Math.sin(this.beta);0===A&&(A=1e-4),0===this.radius&&(this.radius=1e-4);const X=this._getTargetPosition();if(this._computationVector.Op(this.radius*E*A,this.radius*z,this.radius*t*A),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||u.Lt.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),X.addToRef(this._computationVector,this._newPosition),this.lE().collisionsEnabled&&this.checkCollisions){const E=this.lE().collisionCoordinator;this._collider||(this._collider=E.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,E.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.R(this._newPosition);let E=this.upVector;this.allowUpsideDown&&A<0&&(E=E.negate()),this._computeViewMatrix(this._position,X,E),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.R(X),this._viewMatrix}zoomOn(E){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E=E||this.lE().meshes;const z=Z.e.MinMax(E);let A=this._calculateLowerRadiusFromModelBoundingSphere(z.min,z.max);if(A=Math.max(Math.min(A,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=A*this.zoomOnFactor,this.mode===mE.d.ORTHOGRAPHIC_CAMERA){const E=this.lE().getEngine().getAspectRatio(this),t=A*this.zoomOnFactor/2;this.orthoLeft=-t*E,this.orthoRight=t*E,this.orthoBottom=-t,this.orthoTop=t}this.focusOn({min:z.min,max:z.max,distance:A},t)}focusOn(E){let t,z,A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===E.min){const A=E||this.lE().meshes;t=Z.e.MinMax(A),z=u.Lt.Distance(t.min,t.max)}else{t=E,z=E.distance}this._target=Z.e.Center(t),A||(this.maxZ=2*z)}createRigCamera(E,t){let z=0;switch(this.cameraRigMode){case mE.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case mE.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case mE.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case mE.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case mE.d.RIG_MODE_VR:z=this._cameraRigParams.stereoHalfAngle*(0===t?1:-1);break;case mE.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:z=this._cameraRigParams.stereoHalfAngle*(0===t?-1:1)}const A=new V(E,this.alpha+z,this.beta,this.radius,this._target,this.lE());return A._cameraRigParams={},A.isRigCamera=!0,A.rigParent=this,A.upVector=this.upVector,A.mode=this.mode,A.orthoLeft=this.orthoLeft,A.orthoRight=this.orthoRight,A.orthoBottom=this.orthoBottom,A.orthoTop=this.orthoTop,A}_updateRigCameras(){const E=this._rigCameras[0],t=this._rigCameras[1];switch(E.beta=t.beta=this.beta,this.cameraRigMode){case mE.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case mE.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case mE.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case mE.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case mE.d.RIG_MODE_VR:E.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case mE.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:E.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const A=u.Lt.Distance(E,t),X=this.lE().getEngine().getAspectRatio(this),R=Math.tan(this.fov/2),p=R*X,C=.5*A*z,Z=C*Math.sqrt(1+1/(p*p)),H=C*Math.sqrt(1+1/(R*R));return Math.max(Z,H)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,A.b)([(0,X.K)()],V.prototype,"alpha",void 0),(0,A.b)([(0,X.K)()],V.prototype,"beta",void 0),(0,A.b)([(0,X.K)()],V.prototype,"radius",void 0),(0,A.b)([(0,X.K)()],V.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,A.b)([(0,X.G)("target")],V.prototype,"_target",void 0),(0,A.b)([(0,X.x)("targetHost")],V.prototype,"_targetHost",void 0),(0,A.b)([(0,X.K)()],V.prototype,"inertialAlphaOffset",void 0),(0,A.b)([(0,X.K)()],V.prototype,"inertialBetaOffset",void 0),(0,A.b)([(0,X.K)()],V.prototype,"inertialRadiusOffset",void 0),(0,A.b)([(0,X.K)()],V.prototype,"lowerAlphaLimit",void 0),(0,A.b)([(0,X.K)()],V.prototype,"upperAlphaLimit",void 0),(0,A.b)([(0,X.K)()],V.prototype,"lowerBetaLimit",void 0),(0,A.b)([(0,X.K)()],V.prototype,"upperBetaLimit",void 0),(0,A.b)([(0,X.K)()],V.prototype,"lowerRadiusLimit",void 0),(0,A.b)([(0,X.K)()],V.prototype,"upperRadiusLimit",void 0),(0,A.b)([(0,X.K)()],V.prototype,"lowerTargetYLimit",void 0),(0,A.b)([(0,X.K)()],V.prototype,"inertialPanningX",void 0),(0,A.b)([(0,X.K)()],V.prototype,"inertialPanningY",void 0),(0,A.b)([(0,X.K)()],V.prototype,"pinchToPanMaxDistance",void 0),(0,A.b)([(0,X.K)()],V.prototype,"panningDistanceLimit",void 0),(0,A.b)([(0,X.G)()],V.prototype,"panningOriginTarget",void 0),(0,A.b)([(0,X.K)()],V.prototype,"panningInertia",void 0),(0,A.b)([(0,X.K)()],V.prototype,"zoomToMouseLocation",null),(0,A.b)([(0,X.K)()],V.prototype,"zoomOnFactor",void 0),(0,A.b)([(0,X.D)()],V.prototype,"targetScreenOffset",void 0),(0,A.b)([(0,X.K)()],V.prototype,"allowUpsideDown",void 0),(0,A.b)([(0,X.K)()],V.prototype,"useInputToRestoreState",void 0),(0,A.b)([(0,X.K)()],V.prototype,"restoreStateInterpolationFactor",void 0),(0,x.f)("BABYLON.ArcRotateCamera",V)},13391:(E,t,z)=>{"use strict";z.d(t,{c:()=>u,e:()=>p});var A=z(11640),X=z(11849),R=z(12256),u={};class p{constructor(E){this.attachedToElement=!1,this.attached={},this.camera=E,this.checkInputs=()=>{}}add(E){const t=E.getSimpleName();this.attached[t]?A.d.Warn("camera input of type "+t+" already exists on camera"):(this.attached[t]=E,E.camera=this.camera,E.checkInputs&&(this.checkInputs=this._addCheckInputs(E.checkInputs.bind(E))),this.attachedToElement&&E.attachControl(this.noPreventDefault))}remove(E){for(const t in this.attached){const z=this.attached[t];if(z===E)return z.qh(),z.camera=null,delete this.attached[t],void this.rebuildInputCheck()}}removeByType(E){for(const t in this.attached){const z=this.attached[t];z.getClassName()===E&&(z.qh(),z.camera=null,delete this.attached[t],this.rebuildInputCheck())}}_addCheckInputs(E){const t=this.checkInputs;return()=>{t(),E()}}attachInput(E){this.attachedToElement&&E.attachControl(this.noPreventDefault)}attachElement(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){E=!R.d.ForceAttachControlToAlwaysPreventDefault&&E,this.attachedToElement=!0,this.noPreventDefault=E;for(const t in this.attached)this.attached[t].attachControl(E)}}detachElement(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const t in this.attached)this.attached[t].qh(),E&&(this.attached[t].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const E in this.attached){const t=this.attached[E];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(E){const t={};for(const z in this.attached){const E=this.attached[z],A=X.b.Serialize(E);t[E.getClassName()]=A}E.inputsmgr=t}parse(E){const t=E.inputsmgr;if(t){this.clear();for(const E in t){const z=u[E];if(z){const A=t[E],R=X.b.Parse((()=>new z),A,null);this.add(R)}}}else for(const z in this.attached){const t=u[this.attached[z].getClassName()];if(t){const A=X.b.Parse((()=>new t),E,null);this.remove(this.attached[z]),this.add(A)}}}}},13386:(E,t,z)=>{"use strict";z.d(t,{c:()=>D});var A=z(11792),X=z(11801),R=z(11812),u=z(12295),p=z(13391),C=z(12094),Z=z(11630);class H{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(E){E=Z.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.lE(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((t=>{const z=t.event;if(!z.metaKey)if(t.type===C.e.KEYDOWN){if(-1!==this.keysUp.indexOf(z.keyCode)||-1!==this.keysDown.indexOf(z.keyCode)||-1!==this.keysLeft.indexOf(z.keyCode)||-1!==this.keysRight.indexOf(z.keyCode)||-1!==this.keysUpward.indexOf(z.keyCode)||-1!==this.keysDownward.indexOf(z.keyCode)||-1!==this.keysRotateLeft.indexOf(z.keyCode)||-1!==this.keysRotateRight.indexOf(z.keyCode)||-1!==this.keysRotateUp.indexOf(z.keyCode)||-1!==this.keysRotateDown.indexOf(z.keyCode)){-1===this._keys.indexOf(z.keyCode)&&this._keys.push(z.keyCode),E||z.preventDefault()}}else if(-1!==this.keysUp.indexOf(z.keyCode)||-1!==this.keysDown.indexOf(z.keyCode)||-1!==this.keysLeft.indexOf(z.keyCode)||-1!==this.keysRight.indexOf(z.keyCode)||-1!==this.keysUpward.indexOf(z.keyCode)||-1!==this.keysDownward.indexOf(z.keyCode)||-1!==this.keysRotateLeft.indexOf(z.keyCode)||-1!==this.keysRotateRight.indexOf(z.keyCode)||-1!==this.keysRotateUp.indexOf(z.keyCode)||-1!==this.keysRotateDown.indexOf(z.keyCode)){const t=this._keys.indexOf(z.keyCode);t>=0&&this._keys.splice(t,1),E||z.preventDefault()}})))}qh(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const E=this.camera;for(let t=0;t<this._keys.length;t++){const z=this._keys[t],A=E._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(z)?E._localDirection.Op(-A,0,0):-1!==this.keysUp.indexOf(z)?E._localDirection.Op(0,0,A):-1!==this.keysRight.indexOf(z)?E._localDirection.Op(A,0,0):-1!==this.keysDown.indexOf(z)?E._localDirection.Op(0,0,-A):-1!==this.keysUpward.indexOf(z)?E._localDirection.Op(0,A,0):-1!==this.keysDownward.indexOf(z)?E._localDirection.Op(0,-A,0):-1!==this.keysRotateLeft.indexOf(z)?(E._localDirection.Op(0,0,0),E.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(z)?(E._localDirection.Op(0,0,0),E.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(z)?(E._localDirection.Op(0,0,0),E.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(z)&&(E._localDirection.Op(0,0,0),E.cameraRotation.x+=this._getLocalRotation()),E.lE().useRightHandedSystem&&(E._localDirection.z*=-1),E.getViewMatrix().invertToRef(E._cameraTransformMatrix),R.Lt.TransformNormalToRef(E._localDirection,E._cameraTransformMatrix,E._transformedDirection),E.cameraDirection.addInPlace(E._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const E=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*E}}(0,A.b)([(0,X.K)()],H.prototype,"keysUp",void 0),(0,A.b)([(0,X.K)()],H.prototype,"keysUpward",void 0),(0,A.b)([(0,X.K)()],H.prototype,"keysDown",void 0),(0,A.b)([(0,X.K)()],H.prototype,"keysDownward",void 0),(0,A.b)([(0,X.K)()],H.prototype,"keysLeft",void 0),(0,A.b)([(0,X.K)()],H.prototype,"keysRight",void 0),(0,A.b)([(0,X.K)()],H.prototype,"rotationSpeed",void 0),(0,A.b)([(0,X.K)()],H.prototype,"keysRotateLeft",void 0),(0,A.b)([(0,X.K)()],H.prototype,"keysRotateRight",void 0),(0,A.b)([(0,X.K)()],H.prototype,"keysRotateUp",void 0),(0,A.b)([(0,X.K)()],H.prototype,"keysRotateDown",void 0),p.c.FreeCameraKeyboardMoveInput=H;var h=z(11632),d=z(12090);class y{constructor(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=E,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new h.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(E){E=Z.Tools.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),z=t.getInputElement();this._pointerInput||(this._pointerInput=A=>{const X=A.event,R="touch"===X.pointerType;if(!this.touchEnabled&&R)return;if(A.type!==d.b.POINTERMOVE&&-1===this.buttons.indexOf(X.button))return;const u=X.target;if(A.type===d.b.POINTERDOWN){if(R&&-1!==this._activePointerId||!R&&-1!==this._currentActiveButton)return;this._activePointerId=X.pointerId;try{null===u||void 0===u||u.setPointerCapture(X.pointerId)}catch(p){}-1===this._currentActiveButton&&(this._currentActiveButton=X.button),this._previousPosition={x:X.clientX,y:X.clientY},E||(X.preventDefault(),z&&z.focus()),t.isPointerLock&&this._onMouseMove&&this._onMouseMove(A.event)}else if(A.type===d.b.POINTERUP){if(R&&this._activePointerId!==X.pointerId||!R&&this._currentActiveButton!==X.button)return;try{null===u||void 0===u||u.releasePointerCapture(X.pointerId)}catch(p){}this._currentActiveButton=-1,this._previousPosition=null,E||X.preventDefault(),this._activePointerId=-1}else if(A.type===d.b.POINTERMOVE&&(this._activePointerId===X.pointerId||!R))if(t.isPointerLock&&this._onMouseMove)this._onMouseMove(A.event);else if(this._previousPosition){const t=this.camera._calculateHandednessMultiplier(),z=(X.clientX-this._previousPosition.x)*t,A=X.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=z/this.angularSensibility,this.camera.cameraRotation.x+=A/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:z,offsetY:A}),this._previousPosition={x:X.clientX,y:X.clientY},E||X.preventDefault()}}),this._onMouseMove=z=>{if(!t.isPointerLock)return;const A=this.camera._calculateHandednessMultiplier(),X=z.movementX*A;this.camera.cameraRotation.y+=X/this.angularSensibility;const R=z.movementY;this.camera.cameraRotation.x+=R/this.angularSensibility,this._previousPosition=null,E||z.preventDefault()},this._observer=this.camera.lE()._inputManager._addCameraPointerObserver(this._pointerInput,d.b.POINTERDOWN|d.b.POINTERUP|d.b.POINTERMOVE),z&&(this._contextMenuBind=E=>this.onContextMenu(E),z.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(E){E.preventDefault()}qh(){if(this._observer){if(this.camera.lE()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const E=this.camera.getEngine().getInputElement();E&&E.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,A.b)([(0,X.K)()],y.prototype,"buttons",void 0),(0,A.b)([(0,X.K)()],y.prototype,"angularSensibility",void 0),p.c.FreeCameraMouseInput=y;var O,c=z(12096);class a{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new h.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(E){E=Z.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==d.b.POINTERWHEEL)return;const z=t.event,A=z.deltaMode===c.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*A*z.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*A*z.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*A*z.deltaZ/this._normalize,z.preventDefault&&(E||z.preventDefault())},this._observer=this.camera.lE()._inputManager._addCameraPointerObserver(this._wheel,d.b.POINTERWHEEL)}qh(){this._observer&&(this.camera.lE()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,A.b)([(0,X.K)()],a.prototype,"wheelPrecisionX",void 0),(0,A.b)([(0,X.K)()],a.prototype,"wheelPrecisionY",void 0),(0,A.b)([(0,X.K)()],a.prototype,"wheelPrecisionZ",void 0),function(E){E[E.MoveRelative=0]="MoveRelative",E[E.RotateRelative=1]="RotateRelative",E[E.MoveScene=2]="MoveScene"}(O||(O={}));class L extends a{constructor(){super(...arguments),this._moveRelative=R.Lt.Zero(),this._rotateRelative=R.Lt.Zero(),this._moveScene=R.Lt.Zero(),this._wheelXAction=O.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=O.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(E){null===E&&this._wheelXAction!==O.MoveRelative||(this._wheelXAction=O.MoveRelative,this._wheelXActionCoordinate=E)}get wheelXMoveRelative(){return this._wheelXAction!==O.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(E){null===E&&this._wheelYAction!==O.MoveRelative||(this._wheelYAction=O.MoveRelative,this._wheelYActionCoordinate=E)}get wheelYMoveRelative(){return this._wheelYAction!==O.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(E){null===E&&this._wheelZAction!==O.MoveRelative||(this._wheelZAction=O.MoveRelative,this._wheelZActionCoordinate=E)}get wheelZMoveRelative(){return this._wheelZAction!==O.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(E){null===E&&this._wheelXAction!==O.RotateRelative||(this._wheelXAction=O.RotateRelative,this._wheelXActionCoordinate=E)}get wheelXRotateRelative(){return this._wheelXAction!==O.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(E){null===E&&this._wheelYAction!==O.RotateRelative||(this._wheelYAction=O.RotateRelative,this._wheelYActionCoordinate=E)}get wheelYRotateRelative(){return this._wheelYAction!==O.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(E){null===E&&this._wheelZAction!==O.RotateRelative||(this._wheelZAction=O.RotateRelative,this._wheelZActionCoordinate=E)}get wheelZRotateRelative(){return this._wheelZAction!==O.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(E){null===E&&this._wheelXAction!==O.MoveScene||(this._wheelXAction=O.MoveScene,this._wheelXActionCoordinate=E)}get wheelXMoveScene(){return this._wheelXAction!==O.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(E){null===E&&this._wheelYAction!==O.MoveScene||(this._wheelYAction=O.MoveScene,this._wheelYActionCoordinate=E)}get wheelYMoveScene(){return this._wheelYAction!==O.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(E){null===E&&this._wheelZAction!==O.MoveScene||(this._wheelZAction=O.MoveScene,this._wheelZActionCoordinate=E)}get wheelZMoveScene(){return this._wheelZAction!==O.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.ap(0),this._rotateRelative.ap(0),this._moveScene.ap(0),this._updateCamera(),this.camera.lE().useRightHandedSystem&&(this._moveRelative.z*=-1);const E=R.Matrix.Zero();this.camera.getViewMatrix().invertToRef(E);const t=R.Lt.Zero();R.Lt.TransformNormalToRef(this._moveRelative,E,t),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(t),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(E,t,z){if(0===E)return;if(null===t||null===z)return;let A=null;switch(t){case O.MoveRelative:A=this._moveRelative;break;case O.RotateRelative:A=this._rotateRelative;break;case O.MoveScene:A=this._moveScene}switch(z){case 0:A.set(E,0,0);break;case 1:A.set(0,E,0);break;case 2:A.set(0,0,E)}}}(0,A.b)([(0,X.K)()],L.prototype,"wheelXMoveRelative",null),(0,A.b)([(0,X.K)()],L.prototype,"wheelYMoveRelative",null),(0,A.b)([(0,X.K)()],L.prototype,"wheelZMoveRelative",null),(0,A.b)([(0,X.K)()],L.prototype,"wheelXRotateRelative",null),(0,A.b)([(0,X.K)()],L.prototype,"wheelYRotateRelative",null),(0,A.b)([(0,X.K)()],L.prototype,"wheelZRotateRelative",null),(0,A.b)([(0,X.K)()],L.prototype,"wheelXMoveScene",null),(0,A.b)([(0,X.K)()],L.prototype,"wheelYMoveScene",null),(0,A.b)([(0,X.K)()],L.prototype,"wheelZMoveScene",null),p.c.FreeCameraMouseWheelInput=L;class mE{constructor(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=E,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=Z.Tools.IsSafari()}attachControl(E){E=Z.Tools.BackCompatCameraNoPreventDefault(arguments);let t=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=z=>{const A=z.event,X="mouse"===A.pointerType||this._isSafari&&"undefined"===typeof A.pointerType;if(this.allowMouse||!X)if(z.type===d.b.POINTERDOWN){if(E||A.preventDefault(),this._pointerPressed.push(A.pointerId),1!==this._pointerPressed.length)return;t={x:A.clientX,y:A.clientY}}else if(z.type===d.b.POINTERUP){E||A.preventDefault();const z=this._pointerPressed.indexOf(A.pointerId);if(-1===z)return;if(this._pointerPressed.splice(z,1),0!=z)return;t=null,this._offsetX=null,this._offsetY=null}else if(z.type===d.b.POINTERMOVE){if(E||A.preventDefault(),!t)return;if(0!=this._pointerPressed.indexOf(A.pointerId))return;this._offsetX=A.clientX-t.x,this._offsetY=-(A.clientY-t.y)}}),this._observer=this.camera.lE()._inputManager._addCameraPointerObserver(this._pointerInput,d.b.POINTERDOWN|d.b.POINTERUP|d.b.POINTERMOVE),this._onLostFocus){const E=this.camera.getEngine().getInputElement();E&&E.addEventListener("blur",this._onLostFocus)}}qh(){if(this._pointerInput){if(this._observer&&(this.camera.lE()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const E=this.camera.getEngine().getInputElement();E&&E.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const E=this.camera,t=E._calculateHandednessMultiplier();E.cameraRotation.y=t*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)E.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const t=E._computeLocalCameraSpeed(),z=new R.Lt(0,0,0!==this.touchMoveSensibility?t*this._offsetY/this.touchMoveSensibility:0);R.Matrix.RotationYawPitchRollToRef(E.rotation.y,E.rotation.x,0,E._cameraRotationMatrix),E.cameraDirection.addInPlace(R.Lt.TransformCoordinates(z,E._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,A.b)([(0,X.K)()],mE.prototype,"touchAngularSensibility",void 0),(0,A.b)([(0,X.K)()],mE.prototype,"touchMoveSensibility",void 0),p.c.FreeCameraTouchInput=mE;class W extends p.e{constructor(E){super(E),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new H),this}addMouse(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new y(E),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new L,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new mE),this}clear(){super.clear(),this._mouseInput=null}}var I=z(11766),e=z(11712);class D extends u.e{get angularSensibility(){const E=this.inputs.attached.mouse;return E?E.angularSensibility:0}set angularSensibility(E){const t=this.inputs.attached.mouse;t&&(t.angularSensibility=E)}get keysUp(){const E=this.inputs.attached.keyboard;return E?E.keysUp:[]}set keysUp(E){const t=this.inputs.attached.keyboard;t&&(t.keysUp=E)}get keysUpward(){const E=this.inputs.attached.keyboard;return E?E.keysUpward:[]}set keysUpward(E){const t=this.inputs.attached.keyboard;t&&(t.keysUpward=E)}get keysDown(){const E=this.inputs.attached.keyboard;return E?E.keysDown:[]}set keysDown(E){const t=this.inputs.attached.keyboard;t&&(t.keysDown=E)}get keysDownward(){const E=this.inputs.attached.keyboard;return E?E.keysDownward:[]}set keysDownward(E){const t=this.inputs.attached.keyboard;t&&(t.keysDownward=E)}get keysLeft(){const E=this.inputs.attached.keyboard;return E?E.keysLeft:[]}set keysLeft(E){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=E)}get keysRight(){const E=this.inputs.attached.keyboard;return E?E.keysRight:[]}set keysRight(E){const t=this.inputs.attached.keyboard;t&&(t.keysRight=E)}get keysRotateLeft(){const E=this.inputs.attached.keyboard;return E?E.keysRotateLeft:[]}set keysRotateLeft(E){const t=this.inputs.attached.keyboard;t&&(t.keysRotateLeft=E)}get keysRotateRight(){const E=this.inputs.attached.keyboard;return E?E.keysRotateRight:[]}set keysRotateRight(E){const t=this.inputs.attached.keyboard;t&&(t.keysRotateRight=E)}get keysRotateUp(){const E=this.inputs.attached.keyboard;return E?E.keysRotateUp:[]}set keysRotateUp(E){const t=this.inputs.attached.keyboard;t&&(t.keysRotateUp=E)}get keysRotateDown(){const E=this.inputs.attached.keyboard;return E?E.keysRotateDown:[]}set keysRotateDown(E){const t=this.inputs.attached.keyboard;t&&(t.keysRotateDown=E)}constructor(E,t,z){var A;super(E,t,z,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),A=this,this.ellipsoid=new R.Lt(.5,1,.5),this.ellipsoidOffset=new R.Lt(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=R.Lt.Zero(),this._diffPosition=R.Lt.Zero(),this._newPosition=R.Lt.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;A._newPosition.R(t),A._newPosition.subtractToRef(A._oldPosition,A._diffPosition),A._diffPosition.length()>e.b.CollisionsEpsilon&&(A.position.addToRef(A._diffPosition,A._deferredPositionUpdate),A._deferOnly?A._deferredUpdated=!0:A.position.R(A._deferredPositionUpdate),A.uO&&z&&A.uO(z))},this.inputs=new W(this),this.inputs.addKeyboard().addMouse()}attachControl(E,t){t=Z.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(t)}qh(){this.inputs.detachElement(),this.cameraDirection=new R.Lt(0,0,0),this.cameraRotation=new R.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(E){this._collisionMask=isNaN(E)?-1:E}_collideWithWorld(E){let t;t=this.parent?R.Lt.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const z=this.lE().collisionCoordinator;this._collider||(this._collider=z.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let A=E;this.applyGravity&&(A=E.add(this.lE().gravity)),z.getNewPosition(this._oldPosition,A,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=R.Lt.Zero(),this._transformedDirection=R.Lt.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(E){this._needMoveForGravity=E}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.lE().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Ch"}}(0,A.b)([(0,X.G)()],D.prototype,"ellipsoid",void 0),(0,A.b)([(0,X.G)()],D.prototype,"ellipsoidOffset",void 0),(0,A.b)([(0,X.K)()],D.prototype,"checkCollisions",void 0),(0,A.b)([(0,X.K)()],D.prototype,"applyGravity",void 0),(0,I.f)("BABYLON.FreeCamera",D)},13971:(E,t,z)=>{"use strict";z.d(t,{d:()=>R});var A=z(11920),X=z(13973);class R{constructor(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=z,this.nH=[],this._maxBlockCapacity=t||64,this._selectionContent=new A.e(1024),this._creationFunc=E}update(E,t,z){X.d._CreateBlocks(E,t,z,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}GZ(E){for(let t=0;t<this.ZH.length;t++){this.ZH[t].addEntry(E)}}YZ(E){for(let t=0;t<this.ZH.length;t++){this.ZH[t].removeEntry(E)}}select(E,t){this._selectionContent.reset();for(let z=0;z<this.ZH.length;z++){this.ZH[z].select(E,this._selectionContent,t)}return t?this._selectionContent.concat(this.nH):this._selectionContent.concatWithNoDuplicate(this.nH),this._selectionContent}intersects(E,t,z){this._selectionContent.reset();for(let A=0;A<this.ZH.length;A++){this.ZH[A].intersects(E,t,this._selectionContent,z)}return z?this._selectionContent.concat(this.nH):this._selectionContent.concatWithNoDuplicate(this.nH),this._selectionContent}intersectsRay(E){this._selectionContent.reset();for(let t=0;t<this.ZH.length;t++){this.ZH[t].intersectsRay(E,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.nH),this._selectionContent}}R.CreationFuncForMeshes=(E,t)=>{const z=E.getBoundingInfo();!E.isBlocked&&z.boundingBox.intersectsMinMax(t.vH,t.YH)&&t.entries.push(E)},R.CreationFuncForSubMeshes=(E,t)=>{E.getBoundingInfo().boundingBox.intersectsMinMax(t.vH,t.YH)&&t.entries.push(E)}},13973:(E,t,z)=>{"use strict";z.d(t,{d:()=>R});var A=z(11812),X=z(12144);class R{constructor(E,t,z,A,X,R){this.entries=[],this.GH=new Array,this._capacity=z,this._depth=A,this._maxDepth=X,this._creationFunc=R,this._minPoint=E,this._maxPoint=t,this.GH.push(E.clone()),this.GH.push(t.clone()),this.GH.push(E.clone()),this.GH[2].x=t.x,this.GH.push(E.clone()),this.GH[3].y=t.y,this.GH.push(E.clone()),this.GH[4].z=t.z,this.GH.push(t.clone()),this.GH[5].z=E.z,this.GH.push(t.clone()),this.GH[6].x=E.x,this.GH.push(t.clone()),this.GH[7].y=E.y}get wt(){return this._capacity}get vH(){return this._minPoint}get YH(){return this._maxPoint}addEntry(E){if(this.ZH)for(let t=0;t<this.ZH.length;t++){this.ZH[t].addEntry(E)}else this._creationFunc(E,this),this.entries.length>this.wt&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(E){if(this.ZH){for(let t=0;t<this.ZH.length;t++){this.ZH[t].removeEntry(E)}return}const t=this.entries.indexOf(E);t>-1&&this.entries.splice(t,1)}addEntries(E){for(let t=0;t<E.length;t++){const z=E[t];this.addEntry(z)}}select(E,t,z){if(X.e.IsInFrustum(this.GH,E)){if(this.ZH){for(let A=0;A<this.ZH.length;A++){this.ZH[A].select(E,t,z)}return}z?t.concat(this.entries):t.concatWithNoDuplicate(this.entries)}}intersects(E,t,z,A){if(X.e.IntersectsSphere(this._minPoint,this._maxPoint,E,t)){if(this.ZH){for(let X=0;X<this.ZH.length;X++){this.ZH[X].intersects(E,t,z,A)}return}A?z.concat(this.entries):z.concatWithNoDuplicate(this.entries)}}intersectsRay(E,t){if(E.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.ZH){for(let z=0;z<this.ZH.length;z++){this.ZH[z].intersectsRay(E,t)}return}t.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){R._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(E,t,z,X,u,p,C,Z){C.ZH=new Array;const H=new A.Lt((t.x-E.x)/2,(t.y-E.y)/2,(t.z-E.z)/2);for(let A=0;A<2;A++)for(let t=0;t<2;t++)for(let h=0;h<2;h++){const d=E.add(H.multiplyByFloats(A,t,h)),y=E.add(H.multiplyByFloats(A+1,t+1,h+1)),O=new R(d,y,X,u+1,p,Z);O.addEntries(z),C.ZH.push(O)}}}},13981:(E,t,z)=>{"use strict";z.d(t,{d:()=>H});var A=z(12051),X=z(11812),R=z(12231),u=z(13168),p=z(12085),C=z(13971),Z=z(11667);A.c.prototype.createOrUpdateSelectionOctree=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,z=this._getComponent(p.c.NAME_OCTREE);z||(z=new H(this),this.o(z)),this.MH||(this.MH=new C.d(C.d.CreationFuncForMeshes,E,t));const A=this.getWorldExtends();return this.MH.update(A.min,A.max,this.meshes),this.MH},Object.defineProperty(A.c.prototype,"selectionOctree",{get:function(){return this.MH},enumerable:!0,configurable:!0}),R.d.prototype.createOrUpdateSubmeshesOctree=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const z=this.lE();let A=z._getComponent(p.c.NAME_OCTREE);A||(A=new H(z),z.o(A)),this._submeshesOctree||(this._submeshesOctree=new C.d(C.d.CreationFuncForSubMeshes,E,t)),this.Hp(!0);const X=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(X.minimumWorld,X.maximumWorld,this.Rp),this._submeshesOctree};class H{constructor(E){this.name=p.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new u.b(X.Lt.Zero(),new X.Lt(1,1,1)),(E=E||Z.d.LastCreatedScene)&&(this.It=E,this.It.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.It.getActiveSubMeshCandidates=E=>this.getActiveSubMeshCandidates(E),this.It.getCollidingSubMeshCandidates=(E,t)=>this.getCollidingSubMeshCandidates(E,t),this.It.getIntersectingSubMeshCandidates=(E,t)=>this.getIntersectingSubMeshCandidates(E,t))}register(){this.It.onMeshRemovedObservable.add((E=>{const t=this.It.selectionOctree;if(void 0!==t&&null!==t){const z=t.nH.indexOf(E);-1!==z&&t.nH.splice(z,1)}})),this.It.onMeshImportedObservable.add((E=>{const t=this.It.selectionOctree;void 0!==t&&null!==t&&t.GZ(E)}))}getActiveMeshCandidates(){var E;return(null===(E=this.It.MH)||void 0===E?void 0:E.select(this.It.frustumPlanes))||this.It._getDefaultMeshCandidates()}getActiveSubMeshCandidates(E){if(E._submeshesOctree&&E.useOctreeForRenderingSelection){return E._submeshesOctree.select(this.It.frustumPlanes)}return this.It._getDefaultSubMeshCandidates(E)}getIntersectingSubMeshCandidates(E,t){if(E._submeshesOctree&&E.useOctreeForPicking){u.b.TransformToRef(t,E.getWorldMatrix(),this._tempRay);return E._submeshesOctree.intersectsRay(this._tempRay)}return this.It._getDefaultSubMeshCandidates(E)}getCollidingSubMeshCandidates(E,t){if(E._submeshesOctree&&E.useOctreeForCollisions){const z=t._velocityWorldLength+Math.max(t._radius.x,t._radius.y,t._radius.z);return E._submeshesOctree.intersects(t._basePointWorld,z)}return this.It._getDefaultSubMeshCandidates(E)}rebuild(){}dispose(){}}},13168:(E,t,z)=>{"use strict";z.d(t,{b:()=>y});var A=z(12051),X=z(12256),R=z(11817),u=z(11812),p=z(11826),C=z(12132),Z=z(12082),H=z(11667),h=z(12098);const d={internalPickerForMesh:void 0};class y{constructor(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.c;this.origin=E,this.direction=t,this.length=z,this.epsilon=A}clone(){return new y(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const A=y._TmpVector3[0].Op(E.x-z,E.y-z,E.z-z),X=y._TmpVector3[1].Op(t.x+z,t.y+z,t.z+z);let R,u,p,C,Z=0,H=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<A.x||this.origin.x>X.x)return!1}else if(R=1/this.direction.x,u=(A.x-this.origin.x)*R,p=(X.x-this.origin.x)*R,p===-1/0&&(p=1/0),u>p&&(C=u,u=p,p=C),Z=Math.max(u,Z),H=Math.min(p,H),Z>H)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<A.y||this.origin.y>X.y)return!1}else if(R=1/this.direction.y,u=(A.y-this.origin.y)*R,p=(X.y-this.origin.y)*R,p===-1/0&&(p=1/0),u>p&&(C=u,u=p,p=C),Z=Math.max(u,Z),H=Math.min(p,H),Z>H)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<A.z||this.origin.z>X.z)return!1}else if(R=1/this.direction.z,u=(A.z-this.origin.z)*R,p=(X.z-this.origin.z)*R,p===-1/0&&(p=1/0),u>p&&(C=u,u=p,p=C),Z=Math.max(u,Z),H=Math.min(p,H),Z>H)return!1;return!0}intersectsBox(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(E.minimum,E.maximum,t)}intersectsSphere(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const z=E.center.x-this.origin.x,A=E.center.y-this.origin.y,X=E.center.z-this.origin.z,R=z*z+A*A+X*X,u=E.radius+t,p=u*u;if(R<=p)return!0;const C=z*this.direction.x+A*this.direction.y+X*this.direction.z;if(C<0)return!1;return R-C*C<=p}intersectsTriangle(E,t,z){const A=y._TmpVector3[0],X=y._TmpVector3[1],R=y._TmpVector3[2],p=y._TmpVector3[3],Z=y._TmpVector3[4];t.subtractToRef(E,A),z.subtractToRef(E,X),u.Lt.CrossToRef(this.direction,X,R);const H=u.Lt.Dot(A,R);if(0===H)return null;const h=1/H;this.origin.subtractToRef(E,p);const d=u.Lt.Dot(p,R)*h;if(d<-this.epsilon||d>1+this.epsilon)return null;u.Lt.CrossToRef(p,A,Z);const O=u.Lt.Dot(this.direction,Z)*h;if(O<-this.epsilon||d+O>1+this.epsilon)return null;const c=u.Lt.Dot(X,Z)*h;return c>this.length?null:new C.e(1-d-O,d,c)}intersectsPlane(E){let t;const z=u.Lt.Dot(E.normal,this.direction);if(Math.abs(z)<9.99999997475243e-7)return null;{const A=u.Lt.Dot(E.normal,this.origin);return t=(-E.d-A)/z,t<0?t<-9.99999997475243e-7?null:0:t}}intersectsAxis(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(E){case"y":{const E=(this.origin.y-t)/this.direction.y;return E>0?null:new u.Lt(this.origin.x+this.direction.x*-E,t,this.origin.z+this.direction.z*-E)}case"x":{const E=(this.origin.x-t)/this.direction.x;return E>0?null:new u.Lt(t,this.origin.y+this.direction.y*-E,this.origin.z+this.direction.z*-E)}case"z":{const E=(this.origin.z-t)/this.direction.z;return E>0?null:new u.Lt(this.origin.x+this.direction.x*-E,this.origin.y+this.direction.y*-E,t)}default:return null}}intersectsMesh(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4?arguments[4]:void 0,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const p=u.TmpVectors.Matrix[0];return E.getWorldMatrix().invertToRef(p),this._tmpRay?y.TransformToRef(this,p,this._tmpRay):this._tmpRay=y.Transform(this,p),E.intersects(this._tmpRay,t,z,A,X,R)}intersectsMeshes(E,t,z){z?z.length=0:z=[];for(let A=0;A<E.length;A++){const X=this.intersectsMesh(E[A],t);X.hit&&z.push(X)}return z.sort(this._comparePickingInfo),z}_comparePickingInfo(E,t){return E.distance<t.distance?-1:E.distance>t.distance?1:0}intersectionSegment(E,t,z){const A=this.origin,X=u.TmpVectors.Lt[0],R=u.TmpVectors.Lt[1],p=u.TmpVectors.Lt[2],C=u.TmpVectors.Lt[3];t.subtractToRef(E,X),this.direction.scaleToRef(y._Rayl,p),A.addToRef(p,R),E.subtractToRef(A,C);const Z=u.Lt.Dot(X,X),H=u.Lt.Dot(X,p),h=u.Lt.Dot(p,p),d=u.Lt.Dot(X,C),O=u.Lt.Dot(p,C),c=Z*h-H*H;let a,L,mE=c,W=c;c<y._Smallnum?(a=0,mE=1,L=O,W=h):(a=H*O-h*d,L=Z*O-H*d,a<0?(a=0,L=O,W=h):a>mE&&(a=mE,L=O+H,W=h)),L<0?(L=0,-d<0?a=0:-d>Z?a=mE:(a=-d,mE=Z)):L>W&&(L=W,-d+H<0?a=0:-d+H>Z?a=mE:(a=-d+H,mE=Z));const I=Math.abs(a)<y._Smallnum?0:a/mE,e=Math.abs(L)<y._Smallnum?0:L/W,D=u.TmpVectors.Lt[4];p.scaleToRef(e,D);const S=u.TmpVectors.Lt[5];X.scaleToRef(I,S),S.addInPlace(C);const l=u.TmpVectors.Lt[6];S.subtractToRef(D,l);return e>0&&e<=this.length&&l.lengthSquared()<z*z?S.length():-1}update(E,t,z,A,X,R,p){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){y._RayDistant||(y._RayDistant=y.Zero()),y._RayDistant.unprojectRayToRef(E,t,z,A,u.Matrix.IdentityReadOnly,R,p);const C=u.TmpVectors.Matrix[0];X.invertToRef(C),y.TransformToRef(y._RayDistant,C,this)}else this.unprojectRayToRef(E,t,z,A,X,R,p);return this}static Zero(){return new y(u.Lt.Zero(),u.Lt.Zero())}static CreateNew(E,t,z,A,X,R,u){return y.Zero().update(E,t,z,A,X,R,u)}static CreateNewFromTo(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.Matrix.IdentityReadOnly;const A=new y(new u.Lt(0,0,0),new u.Lt(0,0,0));return y.CreateFromToToRef(E,t,A,z)}static CreateFromToToRef(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.Matrix.IdentityReadOnly;z.origin.R(E);const X=t.subtractToRef(E,z.direction),R=Math.sqrt(X.x*X.x+X.y*X.y+X.z*X.z);return z.length=R,z.direction.normalize(),y.TransformToRef(z,A,z)}static Transform(E,t){const z=new y(new u.Lt(0,0,0),new u.Lt(0,0,0));return y.TransformToRef(E,t,z),z}static TransformToRef(E,t,z){u.Lt.TransformCoordinatesToRef(E.origin,t,z.origin),u.Lt.TransformNormalToRef(E.direction,t,z.direction),z.length=E.length,z.epsilon=E.epsilon;const A=z.direction,X=A.length();if(0!==X&&1!==X){const E=1/X;A.x*=E,A.y*=E,A.z*=E,z.length*=X}return z}unprojectRayToRef(E,t,z,A,X,R,p){const C=u.TmpVectors.Matrix[0];X.multiplyToRef(R,C),C.multiplyToRef(p,C),C.invert();const Z=H.d.LastCreatedEngine,h=u.TmpVectors.Lt[0];h.x=E/z*2-1,h.y=-(t/A*2-1),h.z=null!==Z&&void 0!==Z&&Z.useReverseDepthBuffer?1:null!==Z&&void 0!==Z&&Z.isNDCHalfZRange?0:-1;const d=u.TmpVectors.Lt[1].Op(h.x,h.y,1-1e-8),y=u.TmpVectors.Lt[2],O=u.TmpVectors.Lt[3];u.Lt._UnprojectFromInvertedMatrixToRef(h,C,y),u.Lt._UnprojectFromInvertedMatrixToRef(d,C,O),this.origin.R(y),O.subtractToRef(y,this.direction),this.direction.normalize()}}function O(E,t,z,A,X){let R=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const u=y.Zero();return c(E,t,z,A,u,X,R),u}function c(E,t,z,A,X,R){let p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const Z=E.getEngine();if(!R&&!(R=E.activeCamera))return E;const H=R.viewport,h=Z.getRenderHeight(),{x:d,y:y,width:O,height:c}=H.toGlobal(Z.getRenderWidth(),h),a=1/Z.getHardwareScalingLevel();return t=t*a-d,z=z*a-(h-y-c),X.update(t,z,O,c,A||u.Matrix.IdentityReadOnly,p?u.Matrix.IdentityReadOnly:R.getViewMatrix(),R.getProjectionMatrix(),C),E}function a(E,t,z,A,X){if(!Z.c)return E;const R=E.getEngine();if(!X&&!(X=E.activeCamera))throw new Error("Active camera not set");const p=X.viewport,C=R.getRenderHeight(),{x:H,y:h,width:d,height:y}=p.toGlobal(R.getRenderWidth(),C),O=u.Matrix.Identity(),c=1/R.getHardwareScalingLevel();return t=t*c-H,z=z*c-(C-h-y),A.update(t,z,d,y,O,O,X.getProjectionMatrix()),E}function L(E,t,z,A,X,R,u,p){const C=t(A,z.enableDistantPicking),Z=z.intersects(C,X,u,R,A,p);return Z&&Z.hit?!X&&null!=E&&Z.distance>=E.distance?null:Z:null}function mE(E,t,z,A,X,R){let p=null;const C=!!(E.activeCameras&&E.activeCameras.length>1&&E.cameraToUseForPointers!==E.activeCamera),H=E.cameraToUseForPointers||E.activeCamera,h=d.internalPickerForMesh||L;for(let Z=0;Z<E.meshes.length;Z++){const d=E.meshes[Z];if(z){if(!z(d,-1))continue}else if(!d.isEnabled()||!d.isVisible||!d.VC)continue;const y=C&&d.isWorldMatrixCameraDependent(),O=d.Hp(y,H);if(d.hasThinInstances&&d.yZ){const E=h(p,t,d,O,!0,!0,R);if(E){if(X)return E;const C=u.TmpVectors.Matrix[1],Z=d.thinInstanceGetWorldMatrices();for(let E=0;E<Z.length;E++){if(z&&!z(d,E))continue;Z[E].multiplyToRef(O,C);const u=h(p,t,d,C,A,X,R,!0);if(u&&(p=u,p.thinInstanceIndex=E,A))return p}}}else{const E=h(p,t,d,O,A,X,R);if(E&&(p=E,A))return p}}return p||new Z.c}function W(E,t,z,A){if(!Z.c)return null;const X=[],R=!!(E.activeCameras&&E.activeCameras.length>1&&E.cameraToUseForPointers!==E.activeCamera),p=E.cameraToUseForPointers||E.activeCamera,C=d.internalPickerForMesh||L;for(let Z=0;Z<E.meshes.length;Z++){const H=E.meshes[Z];if(z){if(!z(H,-1))continue}else if(!H.isEnabled()||!H.isVisible||!H.VC)continue;const h=R&&H.isWorldMatrixCameraDependent(),d=H.Hp(h,p);if(H.hasThinInstances&&H.yZ){if(C(null,t,H,d,!0,!0,A)){const E=u.TmpVectors.Matrix[1],R=H.thinInstanceGetWorldMatrices();for(let u=0;u<R.length;u++){if(z&&!z(H,u))continue;R[u].multiplyToRef(d,E);const p=C(null,t,H,E,!1,!1,A,!0);p&&(p.thinInstanceIndex=u,X.push(p))}}}else{const E=C(null,t,H,d,!1,!1,A);E&&X.push(E)}}return X}function I(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,A=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0;A||(A=E.getWorldMatrix()),t.length=z,X?t.origin.R(X):t.origin.R(E.position);const R=u.TmpVectors.Lt[2];R.set(0,0,E._scene.useRightHandedSystem?-1:1);const p=u.TmpVectors.Lt[3];return u.Lt.TransformNormalToRef(R,A,p),u.Lt.NormalizeToRef(p,t.direction),t}var e,D;y._TmpVector3=(0,p.c)(6,u.Lt.Zero),y._RayDistant=y.Zero(),y._Smallnum=1e-8,y._Rayl=1e9,e=A.c,(D=X.d)&&(D.prototype.getForwardRay=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1?arguments[1]:void 0,z=arguments.length>2?arguments[2]:void 0;return I(this,new y(u.Lt.Zero(),u.Lt.Zero(),E),E,t,z)},D.prototype.getForwardRayToRef=function(E){return I(this,E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),e&&(h.d._IsPickingAvailable=!0,e.prototype.createPickingRay=function(E,t,z,A){return O(this,E,t,z,A,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),A.c.prototype.createPickingRayToRef=function(E,t,z,A,X){return c(this,E,t,z,A,X,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},A.c.prototype.createPickingRayInCameraSpace=function(E,t,z){return function(E,t,z,A){const X=y.Zero();return a(E,t,z,X,A),X}(this,E,t,z)},A.c.prototype.createPickingRayInCameraSpaceToRef=function(E,t,z,A){return a(this,E,t,z,A)},A.c.prototype.pickWithBoundingInfo=function(E,t,z,A,X){return function(E,t,z,A,X,R){if(!Z.c)return null;const p=mE(E,(A=>(E._tempPickingRay||(E._tempPickingRay=y.Zero()),c(E,t,z,A,E._tempPickingRay,R||null),E._tempPickingRay)),A,X,!0);return p&&(p.ray=O(E,t,z,u.Matrix.Identity(),R||null)),p}(this,E,t,z,A,X)},A.c.prototype.ez=function(E,t,z,A,X,R){return function(E,t,z,A,X,R,p){const C=mE(E,((A,X)=>(E._tempPickingRay||(E._tempPickingRay=y.Zero()),c(E,t,z,A,E._tempPickingRay,R||null,!1,X),E._tempPickingRay)),A,X,!1,p);return C&&(C.ray=O(E,t,z,u.Matrix.Identity(),R||null)),C}(this,E,t,z,A,X,R)},A.c.prototype.pickWithRay=function(E,t,z,A){return function(E,t,z,A,X){const R=mE(E,(z=>(E._pickWithRayInverseMatrix||(E._pickWithRayInverseMatrix=u.Matrix.Identity()),z.invertToRef(E._pickWithRayInverseMatrix),E._cachedRayForTransform||(E._cachedRayForTransform=y.Zero()),y.TransformToRef(t,E._pickWithRayInverseMatrix,E._cachedRayForTransform),E._cachedRayForTransform)),z,A,!1,X);return R&&(R.ray=t),R}(this,E,t,z,A)},A.c.prototype.multiPick=function(E,t,z,A,X){return function(E,t,z,A,X,R){return W(E,(A=>O(E,t,z,A,X||null)),A,R)}(this,E,t,z,A,X)},A.c.prototype.multiPickWithRay=function(E,t,z){return function(E,t,z,A){return W(E,(z=>(E._pickWithRayInverseMatrix||(E._pickWithRayInverseMatrix=u.Matrix.Identity()),z.invertToRef(E._pickWithRayInverseMatrix),E._cachedRayForTransform||(E._cachedRayForTransform=y.Zero()),y.TransformToRef(t,E._pickWithRayInverseMatrix,E._cachedRayForTransform),E._cachedRayForTransform)),z,A)}(this,E,t,z)}},13434:(E,t,z)=>{"use strict";var A=z(11751),X=z(11640),R=z(11674),u=z(11772),p=z(11712),C=z(11759);p.b.prototype._partialLoadFile=function(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(E,(E=>{z[t]=E,z._internalCount++,6===z._internalCount&&A(z)}),void 0,void 0,!0,((E,t)=>{X&&E&&X(E.status+" "+E.statusText,t)}))},p.b.prototype._cascadeLoadFiles=function(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const X=[];X._internalCount=0;for(let R=0;R<6;R++)this._partialLoadFile(z[R],R,X,t,A)},p.b.prototype._cascadeLoadImgs=function(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5?arguments[5]:void 0;const u=[];u._internalCount=0;for(let p=0;p<6;p++)this._partialLoadImg(A[p],p,u,E,t,z,X,R)},p.b.prototype._partialLoadImg=function(E,t,z,A,X,p){let C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7?arguments[7]:void 0;const H=(0,u.d)();(0,R.p)(E,(E=>{z[t]=E,z._internalCount++,A&&A.removePendingData(H),6===z._internalCount&&p&&p(X,z)}),((E,t)=>{A&&A.removePendingData(H),C&&C(E,t)}),A?A.offlineProvider:null,Z),A&&A.addPendingData(H)},p.b.prototype.createCubeTextureBase=function(E,t,z,R){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6?arguments[6]:void 0,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]&&arguments[8],d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,a=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,L=arguments.length>14&&void 0!==arguments[14]&&arguments[14],mE=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const W=O||new A.e(this,7);W.isCube=!0,W.url=E,W.generateMipMaps=!R,W._lodGenerationScale=d,W._lodGenerationOffset=y,W._useSRGBBuffer=!!L&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!R),W!==O&&(W.label=E.substring(0,60)),this._doNotHandleContextLost||(W._extension=H,W._files=z,W._buffer=mE);const I=E;this._transformTextureUrl&&!O&&(E=this._transformTextureUrl(E));const e=H??function(E){const t=E.split("?")[0],z=t.lastIndexOf(".");return z>-1?t.substring(z).toLowerCase():""}(E),D=(0,C.d)(e),S=(E,t)=>{W.dispose(),p?p(E,t):E&&X.d.Warn(E)},l=(A,p)=>{E===I?A&&S(A.status+" "+A.statusText,p):(X.d.Warn(`Failed to load ${E}, falling back to the ${I}`),this.createCubeTextureBase(I,t,z,!!R,u,S,Z,H,h,d,y,W,c,a,L,mE))};if(D)D.then((A=>{const X=E=>{c&&c(W,E),A.loadCubeData(E,W,h,u,((E,t)=>{S(E,t)}))};mE?X(mE):z&&6===z.length?A.supportCascades?this._cascadeLoadFiles(t,(E=>X(E.map((E=>new Uint8Array(E))))),z,S):S("Textures type does not support cascades."):this._loadFile(E,(E=>X(new Uint8Array(E))),void 0,void 0,!0,l)}));else{if(!z||0===z.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,W,((E,t)=>{a&&a(E,t)}),z,S)}return this._internalTexturesCache.push(W),W}},13985:(E,t,z)=>{"use strict";z(11640);var A=z(11956);z(11751),z(11899),z(11745),z(11990),z(11963);A.e},13456:(E,t,z)=>{"use strict";z.d(t,{e:()=>X});var A=z(11766);class X{constructor(E){this.value=this._toInt(E)}_toInt(E){return 0|E}add(E){return new X(this.value+E.value)}Wt(E){return new X(this.value-E.value)}multiply(E){return new X(Math.imul(this.value,E.value))}divide(E){return new X(this.value/E.value)}getClassName(){return X.ClassName}equals(E){return this.value===E.value}static FromValue(E){return new X(E)}toString(){return this.value.toString()}}X.ClassName="FlowGraphInteger",(0,A.f)("FlowGraphInteger",X)},13466:(E,t,z)=>{"use strict";z.d(t,{d:()=>X,f:()=>R});var A=z(11812);class X{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Ep=E}get m(){return this.Ep}transformVector(E){return this.transformVectorToRef(E,new A.Vector2)}transformVectorToRef(E,t){return t.x=E.x*this.Ep[0]+E.y*this.Ep[1],t.y=E.x*this.Ep[2]+E.y*this.Ep[3],t}upE(){return this.toArray()}toArray(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=0;t<4;t++)E[t]=this.Ep[t];return E}Dz(E){for(let t=0;t<4;t++)this.Ep[t]=E[t];return this}multiplyToRef(E,t){const z=E.Ep,A=this.Ep,X=t.Ep;return X[0]=z[0]*A[0]+z[1]*A[2],X[1]=z[0]*A[1]+z[1]*A[3],X[2]=z[2]*A[0]+z[3]*A[2],X[3]=z[2]*A[1]+z[3]*A[3],t}multiply(E){return this.multiplyToRef(E,new X)}divideToRef(E,t){const z=this.Ep,A=E.Ep,X=t.Ep;return X[0]=z[0]/A[0],X[1]=z[1]/A[1],X[2]=z[2]/A[2],X[3]=z[3]/A[3],t}divide(E){return this.divideToRef(E,new X)}addToRef(E,t){const z=this.Ep,A=E.m,X=t.m;return X[0]=z[0]+A[0],X[1]=z[1]+A[1],X[2]=z[2]+A[2],X[3]=z[3]+A[3],t}add(E){return this.addToRef(E,new X)}subtractToRef(E,t){const z=this.Ep,A=E.m,X=t.m;return X[0]=z[0]-A[0],X[1]=z[1]-A[1],X[2]=z[2]-A[2],X[3]=z[3]-A[3],t}Wt(E){return this.subtractToRef(E,new X)}transpose(){const E=this.Ep;return new X([E[0],E[2],E[1],E[3]])}determinant(){const E=this.Ep;return E[0]*E[3]-E[1]*E[2]}inverse(){const E=this.determinant();if(0===E)throw new Error("Matrix is not invertible");const t=this.Ep,z=1/E;return new X([t[3]*z,-t[1]*z,-t[2]*z,t[0]*z])}equals(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const z=this.Ep,A=E.m;return 0===t?z[0]===A[0]&&z[1]===A[1]&&z[2]===A[2]&&z[3]===A[3]:Math.abs(z[0]-A[0])<t&&Math.abs(z[1]-A[1])<t&&Math.abs(z[2]-A[2])<t&&Math.abs(z[3]-A[3])<t}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Ep.join(", ")})`}}class R{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Ep=E}get m(){return this.Ep}transformVector(E){return this.transformVectorToRef(E,new A.Lt)}transformVectorToRef(E,t){const z=this.Ep;return t.x=E.x*z[0]+E.y*z[1]+E.z*z[2],t.y=E.x*z[3]+E.y*z[4]+E.z*z[5],t.z=E.x*z[6]+E.y*z[7]+E.z*z[8],t}multiplyToRef(E,t){const z=E.Ep,A=this.Ep,X=t.m;return X[0]=z[0]*A[0]+z[1]*A[3]+z[2]*A[6],X[1]=z[0]*A[1]+z[1]*A[4]+z[2]*A[7],X[2]=z[0]*A[2]+z[1]*A[5]+z[2]*A[8],X[3]=z[3]*A[0]+z[4]*A[3]+z[5]*A[6],X[4]=z[3]*A[1]+z[4]*A[4]+z[5]*A[7],X[5]=z[3]*A[2]+z[4]*A[5]+z[5]*A[8],X[6]=z[6]*A[0]+z[7]*A[3]+z[8]*A[6],X[7]=z[6]*A[1]+z[7]*A[4]+z[8]*A[7],X[8]=z[6]*A[2]+z[7]*A[5]+z[8]*A[8],t}multiply(E){return this.multiplyToRef(E,new R)}divideToRef(E,t){const z=this.Ep,A=E.m,X=t.m;return X[0]=z[0]/A[0],X[1]=z[1]/A[1],X[2]=z[2]/A[2],X[3]=z[3]/A[3],X[4]=z[4]/A[4],X[5]=z[5]/A[5],X[6]=z[6]/A[6],X[7]=z[7]/A[7],X[8]=z[8]/A[8],t}divide(E){return this.divideToRef(E,new R)}addToRef(E,t){const z=this.Ep,A=E.m,X=t.m;return X[0]=z[0]+A[0],X[1]=z[1]+A[1],X[2]=z[2]+A[2],X[3]=z[3]+A[3],X[4]=z[4]+A[4],X[5]=z[5]+A[5],X[6]=z[6]+A[6],X[7]=z[7]+A[7],X[8]=z[8]+A[8],t}add(E){return this.addToRef(E,new R)}subtractToRef(E,t){const z=this.Ep,A=E.m,X=t.m;return X[0]=z[0]-A[0],X[1]=z[1]-A[1],X[2]=z[2]-A[2],X[3]=z[3]-A[3],X[4]=z[4]-A[4],X[5]=z[5]-A[5],X[6]=z[6]-A[6],X[7]=z[7]-A[7],X[8]=z[8]-A[8],t}Wt(E){return this.subtractToRef(E,new R)}toArray(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=0;t<9;t++)E[t]=this.Ep[t];return E}upE(){return this.toArray()}Dz(E){for(let t=0;t<9;t++)this.Ep[t]=E[t];return this}transpose(){const E=this.Ep;return new R([E[0],E[3],E[6],E[1],E[4],E[7],E[2],E[5],E[8]])}determinant(){const E=this.Ep;return E[0]*(E[4]*E[8]-E[5]*E[7])-E[1]*(E[3]*E[8]-E[5]*E[6])+E[2]*(E[3]*E[7]-E[4]*E[6])}inverse(){const E=this.determinant();if(0===E)throw new Error("Matrix is not invertible");const t=this.Ep,z=1/E;return new R([(t[4]*t[8]-t[5]*t[7])*z,(t[2]*t[7]-t[1]*t[8])*z,(t[1]*t[5]-t[2]*t[4])*z,(t[5]*t[6]-t[3]*t[8])*z,(t[0]*t[8]-t[2]*t[6])*z,(t[2]*t[3]-t[0]*t[5])*z,(t[3]*t[7]-t[4]*t[6])*z,(t[1]*t[6]-t[0]*t[7])*z,(t[0]*t[4]-t[1]*t[3])*z])}equals(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const z=this.Ep,A=E.m;return 0===t?z[0]===A[0]&&z[1]===A[1]&&z[2]===A[2]&&z[3]===A[3]&&z[4]===A[4]&&z[5]===A[5]&&z[6]===A[6]&&z[7]===A[7]&&z[8]===A[8]:Math.abs(z[0]-A[0])<t&&Math.abs(z[1]-A[1])<t&&Math.abs(z[2]-A[2])<t&&Math.abs(z[3]-A[3])<t&&Math.abs(z[4]-A[4])<t&&Math.abs(z[5]-A[5])<t&&Math.abs(z[6]-A[6])<t&&Math.abs(z[7]-A[7])<t&&Math.abs(z[8]-A[8])<t}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Ep.join(", ")})`}}},13472:(E,t,z)=>{"use strict";var A;function X(E,t,z,A){switch(t){case"Animation":return A?E.animations.find((E=>E.uniqueId===z))??null:E.animations[z]??null;case"AnimationGroup":return A?E.animationGroups.find((E=>E.uniqueId===z))??null:E.animationGroups[z]??null;case"Mesh":return A?E.meshes.find((E=>E.uniqueId===z))??null:E.meshes[z]??null;case"Material":return A?E.materials.find((E=>E.uniqueId===z))??null:E.materials[z]??null;case"RH":return A?E.cameras.find((E=>E.uniqueId===z))??null:E.cameras[z]??null;case"Light":return A?E.lights.find((E=>E.uniqueId===z))??null:E.lights[z]??null;default:return null}}z.d(t,{d:()=>X}),function(E){E.Animation="Animation",E.AnimationGroup="AnimationGroup",E.Mesh="Mesh",E.Material="Material",E.RH="RH",E.Light="Light"}(A||(A={}))},13509:(E,t,z)=>{"use strict";z.d(t,{c:()=>X});var A=z(13517);class X extends A.e{constructor(E,t){if(super(E),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),t)for(const z of t)this._eventsSignalOutputs[z]=this._registerSignalOutput(z+"Event")}_executeOnTick(E){}_startPendingTasks(E){E._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(E),this._resetAfterCanceled(E)),this._preparePendingTasks(E),E._addPendingBlock(this),this.out._activateSignal(E),E._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(E){E._deleteExecutionVariable(this,"_initialized"),E._removePendingBlock(this)}}},13480:(E,t,z)=>{"use strict";z.d(t,{c:()=>Z});var A=z(11772),X=z(11766),R=z(13487),u=z(11632),p=z(13453);class C extends R.b{constructor(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:A.defaultValue,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(E,t,z),this.richType=A,this._defaultValue=X,this._optional=R,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new u.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(E){this._isDisabled!==E&&(this._isDisabled=E,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(E,t){t._getConnectionValue(this)!==E&&(t._setConnectionValue(this,E),this.onValueChangedObservable.notifyObservers(E))}resetToDefaultValue(E){E._setConnectionValue(this,this._defaultValue)}connectTo(E){this._isDisabled||super.connectTo(E)}_getValueOrDefault(E){const t=E._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(t):t}getValue(E){if(1===this.connectionType){E._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(E);const t=this._getValueOrDefault(E);return this._lastValue=t,this.richType.typeTransformer?this.richType.typeTransformer(t):t}const t=this.isConnected()?this._connectedPoint[0].getValue(E):this._getValueOrDefault(E);return this._lastValue=t,this.richType.typeTransformer?this.richType.typeTransformer(t):t}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(E),E.richType={},this.richType.serialize(E.richType),E.optional=this._optional,(0,p.d)("defaultValue",this._defaultValue,E)}}(0,X.f)("FlowGraphDataConnection",C);class Z{constructor(E){var t;this.config=E,this.uniqueId=(0,A.d)(),this.name=(null===(t=this.config)||void 0===t?void 0:t.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(E){}registerDataInput(E,t,z){const A=new C(E,0,this,t,z);return this.dataInputs.push(A),A}registerDataOutput(E,t,z){const A=new C(E,1,this,t,z);return this.dataOutputs.push(A),A}getDataInput(E){return this.dataInputs.find((t=>t.name===E))}getDataOutput(E){return this.dataOutputs.find((t=>t.name===E))}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.d;if(E.uniqueId=this.uniqueId,E.config={},this.config){const z=this.config,A=Object.keys(z);for(const X of A)t(X,z[X],E.config)}E.dataInputs=[],E.dataOutputs=[],E.className=this.getClassName();for(const z of this.dataInputs){const t={};z.serialize(t),E.dataInputs.push(t)}for(const z of this.dataOutputs){const t={};z.serialize(t),E.dataOutputs.push(t)}}deserialize(E){}_log(E,t,z){var A;null===(A=E.logger)||void 0===A||A.addLogItem({action:t,Sz:z,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13487:(E,t,z)=>{"use strict";z.d(t,{b:()=>R});var A,X=z(11772);!function(E){E[E.Input=0]="Input",E[E.Output=1]="Output"}(A||(A={}));class R{constructor(E,t,z){this._ownerBlock=z,this._connectedPoint=[],this.uniqueId=(0,X.d)(),this.connectedPointIds=[],this.name=E,this._connectionType=t}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(E){if(this._connectionType===E._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||E._isSingularConnection()&&E._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(E),E._connectedPoint.push(this)}disconnectFrom(E){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const z=this._connectedPoint.indexOf(E),A=E._connectedPoint.indexOf(this);-1!==z&&-1!==A&&(t&&this._connectedPoint.splice(z,1),E._connectedPoint.splice(A,1))}disconnectFromAll(){for(const E of this._connectedPoint)this.disconnectFrom(E,!1);this._connectedPoint.length=0}dispose(){for(const E of this._connectedPoint)this.disconnectFrom(E)}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};E.uniqueId=this.uniqueId,E.name=this.name,E._connectionType=this._connectionType,E.connectedPointIds=[],E.className=this.getClassName();for(const t of this._connectedPoint)E.connectedPointIds.push(t.uniqueId)}getClassName(){return"FGConnection"}deserialize(E){this.uniqueId=E.uniqueId,this.name=E.name,this._connectionType=E._connectionType,this.connectedPointIds=E.connectedPointIds}}},13450:(E,t,z)=>{"use strict";z.d(t,{e:()=>W});var A,X=z(11632),R=z(11792),u=z(11801),p=z(11772),C=z(13453),Z=z(13472),H=z(11640);!function(E){E.ExecuteBlock="ExecuteBlock",E.ExecuteEvent="ExecuteEvent",E.TriggerConnection="TriggerConnection",E.ContextVariableSet="ContextVariableSet",E.GlobalVariableSet="GlobalVariableSet",E.GlobalVariableDelete="GlobalVariableDelete",E.GlobalVariableGet="GlobalVariableGet",E.AddConnection="AddConnection",E.GetConnectionValue="GetConnectionValue",E.SetConnectionValue="SetConnectionValue",E.ActivateSignal="ActivateSignal",E.ContextVariableGet="ContextVariableGet"}(A||(A={}));class h{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(E){if(E.time||(E.time=Date.now()),this.log.push(E),this.logToConsole){var t;const z=null===(t=E.Sz)||void 0===t?void 0:t.value;"object"===typeof z&&z.getClassName?H.d.Log(`[FGLog] ${E.className}:${E.uniqueId.split("-")[0]} ${E.action} - ${JSON.stringify(z.getClassName())}: ${z.toString()}`):H.d.Log(`[FGLog] ${E.className}:${E.uniqueId.split("-")[0]} ${E.action} - ${JSON.stringify(E.Sz)}`)}}getItemsOfType(E){return this.log.filter((t=>t.action===E))}}class d{get enableLogging(){return this._enableLogging}set enableLogging(E){this._enableLogging!==E&&(this._enableLogging=E,this._enableLogging?(this.logger=new h,this.logger.logToConsole=!0):this.logger=null)}constructor(E){this.uniqueId=(0,p.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new X.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=E,this.assetsContext=E.assetsContext??E.It}hasVariable(E){return E in this._userVariables}setVariable(E,t){var z;this._userVariables[E]=t,null===(z=this.logger)||void 0===z||z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Sz:{name:E,value:t}})}getAsset(E,t){return(0,Z.d)(this.assetsContext,E,t)}getVariable(E){var t;return null===(t=this.logger)||void 0===t||t.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Sz:{name:E,value:this._userVariables[E]}}),this._userVariables[E]}get userVariables(){return this._userVariables}lE(){return this._configuration.It}_getUniqueIdPrefixedName(E,t){return`${E.uniqueId}_${t}`}_getGlobalContextVariable(E,t){var z;return null===(z=this.logger)||void 0===z||z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Sz:{name:E,defaultValue:t,possibleValue:this._globalContextVariables[E]}}),this._hasGlobalContextVariable(E)?this._globalContextVariables[E]:t}_setGlobalContextVariable(E,t){var z;null===(z=this.logger)||void 0===z||z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Sz:{name:E,value:t}}),this._globalContextVariables[E]=t}_deleteGlobalContextVariable(E){var t;null===(t=this.logger)||void 0===t||t.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Sz:{name:E}}),delete this._globalContextVariables[E]}_hasGlobalContextVariable(E){return E in this._globalContextVariables}_setExecutionVariable(E,t,z){this._executionVariables[this._getUniqueIdPrefixedName(E,t)]=z}_getExecutionVariable(E,t,z){return this._hasExecutionVariable(E,t)?this._executionVariables[this._getUniqueIdPrefixedName(E,t)]:z}_deleteExecutionVariable(E,t){delete this._executionVariables[this._getUniqueIdPrefixedName(E,t)]}_hasExecutionVariable(E,t){return this._getUniqueIdPrefixedName(E,t)in this._executionVariables}_hasConnectionValue(E){return E.uniqueId in this._connectionValues}_setConnectionValue(E,t){var z;this._connectionValues[E.uniqueId]=t,null===(z=this.logger)||void 0===z||z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Sz:{connectionPointId:E.uniqueId,value:t}})}_setConnectionValueByKey(E,t){this._connectionValues[E]=t}_getConnectionValue(E){var t;return null===(t=this.logger)||void 0===t||t.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Sz:{connectionPointId:E.uniqueId,value:this._connectionValues[E.uniqueId]}}),this._connectionValues[E.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(E){this._pendingBlocks.includes(E)||(this._pendingBlocks.push(E),this._pendingBlocks.sort(((E,t)=>E.priority-t.priority)))}_removePendingBlock(E){const t=this._pendingBlocks.indexOf(E);-1!==t&&this._pendingBlocks.splice(t,1)}_clearPendingBlocks(){for(const E of this._pendingBlocks)E._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(E){var t;this.onNodeExecutedObservable.notifyObservers(E),null===(t=this.logger)||void 0===t||t.addLogItem({time:Date.now(),className:E.getClassName(),uniqueId:E.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(E){this._setGlobalContextVariable("timeSinceStart",E.timeSinceStart),this._setGlobalContextVariable("deltaTime",E.deltaTime);for(const z of this._pendingBlocks){var t;null===(t=z._executeOnTick)||void 0===t||t.call(z,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.d;E.uniqueId=this.uniqueId,E._userVariables={};for(const A in this._userVariables)t(A,this._userVariables[A],E._userVariables);E._connectionValues={};for(const A in this._connectionValues)t(A,this._connectionValues[A],E._connectionValues);var z;this.assetsContext!==this.lE()&&(E._assetsContext={meshes:this.assetsContext.meshes.map((E=>E.id)),materials:this.assetsContext.materials.map((E=>E.id)),textures:this.assetsContext.textures.map((E=>E.name)),animations:this.assetsContext.animations.map((E=>E.name)),lights:this.assetsContext.lights.map((E=>E.id)),cameras:this.assetsContext.cameras.map((E=>E.id)),ey:null===(z=this.assetsContext.ey)||void 0===z?void 0:z.map((E=>E.name)),skeletons:this.assetsContext.skeletons.map((E=>E.id)),Kd:this.assetsContext.Kd.map((E=>E.name)),geometries:this.assetsContext.geometries.map((E=>E.id)),multiMaterials:this.assetsContext.multiMaterials.map((E=>E.id)),transformNodes:this.assetsContext.transformNodes.map((E=>E.id))})}getClassName(){return"FlowGraphContext"}}(0,R.b)([(0,u.K)()],d.prototype,"uniqueId",void 0);var y=z(13476),O=z(12090);class c{constructor(E){this.onEventTriggeredObservable=new X.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=E,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.IX.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const E=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Sz:{timeSinceStart:this._startingTime,deltaTime:E}}),this._startingTime+=E})),this._meshPickedObserver=this._scene.onPointerObservable.add((E=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Sz:E})}),O.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((E=>{const t=E.pointerId,z=E.mesh,A=this._pointerUnderMeshState[t];!A&&z?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Sz:{pointerId:t,mesh:z}}):A&&!z?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Sz:{pointerId:t,mesh:A}}):A&&z&&A!==z&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Sz:{pointerId:t,mesh:A,over:z}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Sz:{pointerId:t,mesh:z,out:A}})),this._pointerUnderMeshState[t]=z}),O.b.POINTERMOVE)}dispose(){var E,t,z,A,X;null===(E=this._sceneDisposeObserver)||void 0===E||E.remove(),null===(t=this._sceneReadyObserver)||void 0===t||t.remove(),null===(z=this._sceneOnBeforeRenderObserver)||void 0===z||z.remove(),null===(A=this._meshPickedObserver)||void 0===A||A.remove(),null===(X=this._meshUnderPointerObserver)||void 0===X||X.remove(),this.onEventTriggeredObservable.clear()}}var a,L=z(13494);!function(E){E[E.Stopped=0]="Stopped",E[E.Started=1]="Started"}(a||(a={}));class mE{get state(){return this._state}set state(E){this._state=E,this.onStateChangedObservable.notifyObservers(E)}constructor(E){this.onStateChangedObservable=new X.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=E.It,this._sceneEventCoordinator=new c(this._scene),this._coordinator=E.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((E=>{for(const t of this._executionContexts){const z=this._getContextualOrder(E.type,t);for(const A of z)if(!A._executeEvent(t,E.Sz))break}switch(E.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const t of this._executionContexts)t._notifyOnTick(E.Sz);break;case"SceneDispose":this.dispose()}}))}createContext(){const E=new d({It:this._scene,coordinator:this._coordinator});return this._executionContexts.push(E),E}getContext(E){return this._executionContexts[E]}addEventBlock(E){if("PointerOver"!==E.type&&"PointerOut"!==E.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==E.type&&this._eventBlocks[E.type].push(E),1===this.state)for(const t of this._executionContexts)E._startPendingTasks(t);else this.onStateChangedObservable.addOnce((t=>{if(1===t)for(const z of this._executionContexts)E._startPendingTasks(z)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((E=>{1===E&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const E of this._executionContexts)for(const t in this._eventBlocks){const z=this._getContextualOrder(t,E);for(const t of z)t._startPendingTasks(E)}}_getContextualOrder(E,t){const z=this._eventBlocks[E].sort(((E,t)=>t.initPriority-E.initPriority));if("MeshPick"===E){const E=[];for(const A of z){const X=A.asset.getValue(t);let R=0;for(;R<z.length;R++){const E=z[R].asset.getValue(t);if(X&&E&&(0,L.p)(X,E))break}E.splice(R,0,A)}return E}return z}dispose(){var E;if(0!==this.state){this.state=0;for(const E of this._executionContexts)E._clearPendingBlocks();this._executionContexts.length=0;for(const E in this._eventBlocks)this._eventBlocks[E].length=0;null===(E=this._eventObserver)||void 0===E||E.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(E){const t=[],z=new Set;for(const A in this._eventBlocks)for(const E of this._eventBlocks[A])t.push(E),z.add(E.uniqueId);for(;t.length>0;){const A=t.pop();E(A);for(const E of A.dataInputs)for(const A of E._connectedPoint)z.has(A._ownerBlock.uniqueId)||(t.push(A._ownerBlock),z.add(A._ownerBlock.uniqueId));if(A instanceof y.b)for(const E of A.signalOutputs)for(const A of E._connectedPoint)z.has(A._ownerBlock.uniqueId)||(t.push(A._ownerBlock),z.add(A._ownerBlock.uniqueId))}}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;E.allBlocks=[],this.visitAllBlocks((t=>{const z={};t.serialize(z),E.allBlocks.push(z)})),E.executionContexts=[];for(const z of this._executionContexts){const A={};z.serialize(A,t),E.executionContexts.push(A)}}}class W{constructor(E){this.config=E,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.It.IX.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.It.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const E=this._executeOnNextFrame.slice(0);if(E.length)for(const t of E){this.notifyCustomEvent(t.id,t.data,!1);const E=this._executeOnNextFrame.findIndex((E=>E.uniqueId===t.uniqueId));-1!==E&&this._executeOnNextFrame.splice(E,1)}}));(W.SceneCoordinators.get(this.config.It)??[]).push(this)}createGraph(){const E=new mE({It:this.config.It,coordinator:this});return this._flowGraphs.push(E),E}removeGraph(E){const t=this._flowGraphs.indexOf(E);-1!==t&&(E.dispose(),this._flowGraphs.splice(t,1))}start(){for(const E of this._flowGraphs)E.start()}dispose(){var E,t;for(const X of this._flowGraphs)X.dispose();this._flowGraphs.length=0,null===(E=this._disposeObserver)||void 0===E||E.remove(),null===(t=this._onBeforeRenderObserver)||void 0===t||t.remove();const z=W.SceneCoordinators.get(this.config.It)??[],A=z.indexOf(this);-1!==A&&z.splice(A,1)}serialize(E,t){E._flowGraphs=[];for(const z of this._flowGraphs){const A={};z.serialize(A,t),E._flowGraphs.push(A)}E.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(E){let t=this._customEventsMap.get(E);return t||(t=new X.b,this._customEventsMap.set(E,t)),t}notifyCustomEvent(E,t){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:E,data:t,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(E)){const t=this._eventExecutionCounter.get(E);if(this._eventExecutionCounter.set(E,t+1),t>=W.MaxEventTypeExecutionPerFrame)return void(t===W.MaxEventTypeExecutionPerFrame&&H.d.Warn(`FlowGraphCoordinator: Too many executions of event "${E}".`))}else this._eventExecutionCounter.set(E,1);const z=this._customEventsMap.get(E);z&&z.notifyObservers(t)}}W.MaxEventsPerType=30,W.MaxEventTypeExecutionPerFrame=30,W.SceneCoordinators=new Map},13503:(E,t,z)=>{"use strict";z.d(t,{e:()=>X});var A=z(13509);class X extends A.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(E){E._notifyExecuteNode(this),this.done._activateSignal(E)}}},13476:(E,t,z)=>{"use strict";z.d(t,{b:()=>p});var A=z(13480),X=z(13487),R=z(11766);class u extends X.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(E){super.connectTo(E),this._connectedPoint.sort(((E,t)=>t.priority-E.priority))}_activateSignal(E){var t;if(null===(t=E.logger)||void 0===t||t.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Sz:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)E._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(E,this),E._increaseExecutionId();else for(const z of this._connectedPoint)z._activateSignal(E)}}(0,R.f)("FlowGraphSignalConnection",u);class p extends A.c{constructor(E){super(E),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(E){const t=new u(E,0,this);return this.signalInputs.push(t),t}_registerSignalOutput(E){const t=new u(E,1,this);return this.signalOutputs.push(t),t}_unregisterSignalInput(E){const t=this.signalInputs.findIndex((t=>t.name===E));-1!==t&&(this.signalInputs[t].dispose(),this.signalInputs.splice(t,1))}_unregisterSignalOutput(E){const t=this.signalOutputs.findIndex((t=>t.name===E));-1!==t&&(this.signalOutputs[t].dispose(),this.signalOutputs.splice(t,1))}_reportError(E,t){this.error.Sz="string"===typeof t?new Error(t):t,this.error._activateSignal(E)}getSignalInput(E){return this.signalInputs.find((t=>t.name===E))}getSignalOutput(E){return this.signalOutputs.find((t=>t.name===E))}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(E),E.signalInputs=[],E.signalOutputs=[];for(const t of this.signalInputs){const z={};t.serialize(z),E.signalInputs.push(z)}for(const t of this.signalOutputs){const z={};t.serialize(z),E.signalOutputs.push(z)}}deserialize(E){for(let t=0;t<E.signalInputs.length;t++){const z=this.getSignalInput(E.signalInputs[t].name);if(!z)throw new Error("Could not find signal input with name "+E.signalInputs[t].name+" in block "+E.className);z.deserialize(E.signalInputs[t])}for(let t=0;t<E.signalOutputs.length;t++){const z=this.getSignalOutput(E.signalOutputs[t].name);if(!z)throw new Error("Could not find signal output with name "+E.signalOutputs[t].name+" in block "+E.className);z.deserialize(E.signalOutputs[t])}}getClassName(){return"FlowGraphExecutionBlock"}}},13517:(E,t,z)=>{"use strict";z.d(t,{e:()=>X});var A=z(13476);class X extends A.b{constructor(E){super(E),this.out=this._registerSignalOutput("out")}}},13458:(E,t,z)=>{"use strict";z.d(t,{C:()=>f,F:()=>K,J:()=>l,K:()=>S,c:()=>Z,d:()=>d,e:()=>D,i:()=>a,k:()=>L,l:()=>mE,p:()=>h,q:()=>e,r:()=>H,v:()=>y,x:()=>O,z:()=>c});var A,X=z(11812),R=z(11856),u=z(13456),p=z(13466);!function(E){E.Any="any",E.String="string",E.Number="number",E.Boolean="boolean",E.Object="object",E.Integer="FlowGraphInteger",E.Vector2="Vector2",E.Lt="Lt",E.Vector4="Vector4",E.Quaternion="Quaternion",E.Matrix="Matrix",E.Matrix2D="Matrix2D",E.Matrix3D="Matrix3D",E.Dt="Dt",E.Lp="Lp"}(A||(A={}));class C{constructor(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=E,this.defaultValue=t,this.animationType=z}serialize(E){E.typeName=this.typeName,E.defaultValue=this.defaultValue}}const Z=new C("any",void 0),H=new C("string",""),h=new C("number",0,0),d=new C("boolean",!1),y=new C("Vector2",X.Vector2.Zero(),5),O=new C("Lt",X.Lt.Zero(),1),c=new C("Vector4",X.Vector4.Zero()),a=new C("Matrix",X.Matrix.Identity(),3),L=new C("Matrix2D",new p.d),mE=new C("Matrix3D",new p.f),W=new C("Dt",R.Dt.Black(),4),I=new C("Lp",new R.Lp(0,0,0,0),7),e=new C("Quaternion",X.Quaternion.Identity(),2);e.typeTransformer=E=>{if(E.getClassName){if("Vector4"===E.getClassName())return X.Quaternion.St(E.upE());if("Lt"===E.getClassName())return X.Quaternion.FromEulerVector(E);if("Matrix"===E.getClassName())return X.Quaternion.FromRotationMatrix(E)}return E};const D=new C("FlowGraphInteger",new u.e(0),0);function S(E){const t=E;switch(typeof E){case"string":return H;case"number":return h;case"boolean":return d;case"object":if(t.getClassName)switch(t.getClassName()){case"Vector2":return y;case"Lt":return O;case"Vector4":return c;case"Matrix":return a;case"Dt":return W;case"Lp":return I;case"Quaternion":return e;case"FlowGraphInteger":return D;case"Matrix2D":return L;case"Matrix3D":return mE}return Z;default:return Z}}function l(E){switch(E){case"string":return H;case"number":return h;case"boolean":return d;case"Vector2":return y;case"Lt":return O;case"Vector4":return c;case"Matrix":return a;case"Dt":return W;case"Lp":return I;case"Quaternion":return e;case"FlowGraphInteger":return D;case"Matrix2D":return L;case"Matrix3D":return mE;default:return Z}}function f(E){switch(E){case"number":default:return 0;case"Vector2":return 5;case"Lt":return 1;case"Matrix":return 3;case"Dt":return 4;case"Lp":return 7;case"Quaternion":return 2}}function K(E){switch(E){case 0:return h;case 5:return y;case 1:return O;case 3:return a;case 4:return W;case 7:return I;case 2:return e;default:return Z}}},13453:(E,t,z)=>{"use strict";z.d(t,{b:()=>H,d:()=>Z,g:()=>h});var A=z(11856),X=z(11812),R=z(13456),u=z(13458),p=z(13466);function C(E){return"Vector2"===E||"Lt"===E||"Vector4"===E||"Quaternion"===E||"Dt"===E||"Lp"===E}function Z(E,t,z){var A;const X=(null===t||void 0===t||null===(A=t.getClassName)||void 0===A?void 0:A.call(t))??"";if(C(X)||function(E){return"Matrix"===E||"Matrix2D"===E||"Matrix3D"===E}(X))z[E]={value:t.upE(),className:X};else if("FlowGraphInteger"===X)z[E]={value:t.value,className:X};else if(X&&(t.id||t.name))z[E]={id:t.id,name:t.name,className:X};else{if("object"===typeof t)throw new Error(`Could not serialize value ${t}`);z[E]=t}}function H(E,t,z,Z){const h=t[E];let d;const y=(null===h||void 0===h?void 0:h.type)??(null===h||void 0===h?void 0:h.className);if(function(E){return"Mesh"===E||"AbstractMesh"===E||"GroundMesh"===E||"InstanceMesh"===E||"LinesMesh"===E||"GoldbergMesh"===E||"GreasedLineMesh"===E||"TrailMesh"===E}(y)){let E=Z.meshes.filter((E=>h.id?E.id===h.id:E.name===h.name));0===E.length&&(E=Z.transformNodes.filter((E=>h.id?E.id===h.id:E.name===h.name))),d=h.uniqueId?E.find((E=>E.uniqueId===h.uniqueId)):E[0]}else if(C(y))d=function(E,t){let z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===E)return X.Vector2.St(t);if("Lt"===E)return z&&(t[2]*=-1),X.Lt.St(t);if("Vector4"===E)return X.Vector4.St(t);if("Quaternion"===E)return z&&(t[2]*=-1,t[3]*=-1),X.Quaternion.St(t);if("Dt"===E)return new A.Dt(t[0],t[1],t[2]);if("Lp"===E)return new A.Lp(t[0],t[1],t[2],t[3]);throw new Error(`Unknown vector class name ${E}`)}(y,h.value);else if(function(E){return"AnimationGroup"===E}(y)){const E=Z.animationGroups.filter((E=>E.name===h.name));d=1===E.length?E[0]:E.find((E=>E.uniqueId===h.uniqueId))}else d="Matrix"===y?X.Matrix.St(h.value):"Matrix2D"===y?new p.d(h.value):"Matrix3D"===y?new p.f(h.value):"FlowGraphInteger"===y?R.e.FromValue(h.value):"number"===y||"string"===y||"boolean"===y?h.value[0]:h&&void 0!==h.value?h.value:Array.isArray(h)?h.reduce(((E,t)=>t.eventData?(E[t.id]={type:(0,u.J)(t.type)},"undefined"!==typeof t.value&&(E[t.id].value=H("value",t,z,Z)),E):E),{}):h;return d}function h(E){return"FlowGraphJsonPointerParserBlock"===E}},13494:(E,t,z)=>{"use strict";function A(E,t){return!(!E.parent||E.parent!==t&&!A(E.parent,t))}function X(E){if(E.getClassName)return E.getClassName()}function R(E,t){return E===t&&("Vector2"===E||"Lt"===E||"Vector4"===E||"Quaternion"===E)}function u(E,t){return E===t&&("Matrix"===E||"Matrix2D"===E||"Matrix3D"===E)}function p(E,t){return"FlowGraphInteger"===E&&"FlowGraphInteger"===t}function C(E,t){const z="number"===typeof E||"number"===typeof(null===E||void 0===E?void 0:E.value);return z&&!t?!isNaN(Z(E)):z}function Z(E){return"number"===typeof E?E:E.value}z.d(t,{c:()=>p,e:()=>u,i:()=>R,m:()=>X,p:()=>A,s:()=>Z,u:()=>C})},12899:(E,t,z)=>{"use strict";z.r(t),z.d(t,{SceneInstrumentation:()=>R});var A=z(11630),X=z(12032);class R{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(E){E!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=E,E?(this._onBeforeActiveMeshesEvaluationObserver=this.It.onBeforeActiveMeshesEvaluationObservable.add((()=>{A.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.It.onAfterActiveMeshesEvaluationObservable.add((()=>{A.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.It.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.It.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(E){E!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=E,E?(this._onBeforeRenderTargetsRenderObserver=this.It.onBeforeRenderTargetsRenderObservable.add((()=>{A.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.It.onAfterRenderTargetsRenderObservable.add((()=>{A.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.It.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.It.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(E){E!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=E,E?(this._onBeforeParticlesRenderingObserver=this.It.onBeforeParticlesRenderingObservable.add((()=>{A.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.It.onAfterParticlesRenderingObservable.add((()=>{A.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.It.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.It.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(E){E!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=E,this.It.spriteManagers&&(E?(this._onBeforeSpritesRenderingObserver=this.It.onBeforeSpritesRenderingObservable.add((()=>{A.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.It.onAfterSpritesRenderingObservable.add((()=>{A.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.It.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.It.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(E){E!==this._capturePhysicsTime&&this.It.onBeforePhysicsObservable&&(this._capturePhysicsTime=E,E?(this._onBeforePhysicsObserver=this.It.onBeforePhysicsObservable.add((()=>{A.Tools.StartPerformanceCounter("dh"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.It.onAfterPhysicsObservable.add((()=>{A.Tools.EndPerformanceCounter("dh"),this._physicsTime.endMonitoring()}))):(this.It.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.It.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(E){E!==this._captureAnimationsTime&&(this._captureAnimationsTime=E,E?this._onAfterAnimationsObserver=this.It.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.It.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(E){this._captureFrameTime=E}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(E){this._captureInterFrameTime=E}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(E){E!==this._captureRenderTime&&(this._captureRenderTime=E,E?(this._onBeforeDrawPhaseObserver=this.It.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),A.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.It.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),A.Tools.EndPerformanceCounter("Main render")}))):(this.It.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.It.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(E){E!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=E,E?(this._onBeforeCameraRenderObserver=this.It.onBeforeCameraRenderObservable.add((E=>{this._cameraRenderTime.beginMonitoring(),A.Tools.StartPerformanceCounter(`Rendering camera ${E.name}`)})),this._onAfterCameraRenderObserver=this.It.onAfterCameraRenderObservable.add((E=>{this._cameraRenderTime.endMonitoring(!1),A.Tools.EndPerformanceCounter(`Rendering camera ${E.name}`)}))):(this.It.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.It.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.It.getEngine()._drawCalls}constructor(E){this.It=E,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new X.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new X.c,this._captureFrameTime=!1,this._frameTime=new X.c,this._captureRenderTime=!1,this._renderTime=new X.c,this._captureInterFrameTime=!1,this._interFrameTime=new X.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new X.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new X.c,this._capturePhysicsTime=!1,this._physicsTime=new X.c,this._captureAnimationsTime=!1,this._animationsTime=new X.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new X.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=E.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(A.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.It.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=E.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(A.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.nz(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.nz(),this._captureParticlesRenderTime&&this._particlesRenderTime.nz(),this._captureSpritesRenderTime&&this._spritesRenderTime.nz(),this._captureRenderTime&&this._renderTime.nz(),this._captureCameraRenderTime&&this._cameraRenderTime.nz()}))}dispose(){this._disposed||(this.It.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.It.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.It.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.It.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.It.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.It.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.It.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.It.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.It.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.It.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.It.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.It.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.It.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.It.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.It.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.It.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.It.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.It=null,this._disposed=!0)}}},13443:(E,t,z)=>{"use strict";z.d(t,{c:()=>H});var A=z(11792),X=z(11801),R=z(11812),u=z(12227),p=z(12361),C=z(12424),Z=z(11766);u.b.AddNodeConstructor("Light_Type_1",((E,t)=>()=>new H(E,R.Lt.Zero(),t)));class H extends C.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(E){this._shadowFrustumSize=E,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(E){this._shadowOrthoScale=E,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(E){this._orthoLeft=E}get orthoRight(){return this._orthoRight}set orthoRight(E){this._orthoRight=E}get orthoTop(){return this._orthoTop}set orthoTop(E){this._orthoTop=E}get orthoBottom(){return this._orthoBottom}set orthoBottom(E){this._orthoBottom=E}constructor(E,t,z){super(E,z),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=t.scale(-1),this.direction=t}getClassName(){return"yh"}getTypeID(){return p.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(E,t,z){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(E):this._setDefaultAutoExtendShadowProjectionMatrix(E,t,z)}_setDefaultFixedFrustumShadowProjectionMatrix(E){const t=this.lE().activeCamera;t&&R.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:t.Cp,void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,E,this.lE().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(E,t,z){const A=this.lE().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const E=R.Lt.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let A=Number.MAX_VALUE,X=-Number.MAX_VALUE;for(let u=0;u<z.length;u++){const p=z[u];if(!p)continue;const C=p.getBoundingInfo().boundingBox;for(let z=0;z<C.vectorsWorld.length;z++)R.Lt.TransformCoordinatesToRef(C.vectorsWorld[z],t,E),E.x<this._orthoLeft&&(this._orthoLeft=E.x),E.y<this._orthoBottom&&(this._orthoBottom=E.y),E.x>this._orthoRight&&(this._orthoRight=E.x),E.y>this._orthoTop&&(this._orthoTop=E.y),this.autoCalcShadowZBounds&&(E.z<A&&(A=E.z),E.z>X&&(X=E.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=A,this._shadowMaxZ=X)}const X=this._orthoRight-this._orthoLeft,u=this._orthoTop-this._orthoBottom,p=void 0!==this.shadowMinZ?this.shadowMinZ:(null===A||void 0===A?void 0:A.Cp)||0,C=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===A||void 0===A?void 0:A.maxZ)||1e4,Z=this.lE().getEngine().useReverseDepthBuffer;R.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-X*this.shadowOrthoScale,this._orthoRight+X*this.shadowOrthoScale,this._orthoBottom-u*this.shadowOrthoScale,this._orthoTop+u*this.shadowOrthoScale,Z?C:p,Z?p:C,E,this.lE().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(E,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,t),this)}transferToNodeMaterialEffect(E,t){return this.computeTransformedInformation()?(E.setFloat3(t,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(E.setFloat3(t,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(E){const t=this._scene.getEngine();return!t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1}getDepthMaxZ(E){const t=this._scene.getEngine();return t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1}prepareLightSpecificDefines(E,t){E["DIRLIGHT"+t]=!0}}(0,A.b)([(0,X.K)()],H.prototype,"shadowFrustumSize",null),(0,A.b)([(0,X.K)()],H.prototype,"shadowOrthoScale",null),(0,A.b)([(0,X.K)()],H.prototype,"autoUpdateExtends",void 0),(0,A.b)([(0,X.K)()],H.prototype,"autoCalcShadowZBounds",void 0),(0,A.b)([(0,X.K)("orthoLeft")],H.prototype,"_orthoLeft",void 0),(0,A.b)([(0,X.K)("orthoRight")],H.prototype,"_orthoRight",void 0),(0,A.b)([(0,X.K)("orthoTop")],H.prototype,"_orthoTop",void 0),(0,A.b)([(0,X.K)("orthoBottom")],H.prototype,"_orthoBottom",void 0),(0,Z.f)("BABYLON.DirectionalLight",H)},13922:(E,t,z)=>{"use strict";z.d(t,{c:()=>H});var A=z(11792),X=z(11801),R=z(11812),u=z(11856),p=z(12227),C=z(12361),Z=z(11766);p.b.AddNodeConstructor("Light_Type_3",((E,t)=>()=>new H(E,R.Lt.Zero(),t)));class H extends C.d{constructor(E,t,z){super(E,z),this.groundColor=new u.Dt(0,0,0),this.direction=t||R.Lt.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Oh"}setDirectionToTarget(E){return this.direction=R.Lt.Normalize(E.Wt(R.Lt.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(E,t){const z=R.Lt.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",z.x,z.y,z.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Ip),t),this}transferToNodeMaterialEffect(E,t){const z=R.Lt.Normalize(this.direction);return E.setFloat3(t,z.x,z.y,z.z),this}Hp(){return this._worldMatrix||(this._worldMatrix=R.Matrix.Identity()),this._worldMatrix}getTypeID(){return C.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(E,t){E["HEMILIGHT"+t]=!0}}(0,A.b)([(0,X.j)()],H.prototype,"groundColor",void 0),(0,A.b)([(0,X.G)()],H.prototype,"direction",void 0),(0,Z.f)("BABYLON.HemisphericLight",H)},13411:(E,t,z)=>{"use strict";z.d(t,{b:()=>h});var A=z(11792),X=z(11801),R=z(11812),u=z(12227),p=z(12361),C=z(12424),Z=z(11790),H=z(11766);u.b.AddNodeConstructor("Light_Type_2",((E,t)=>()=>new h(E,R.Lt.Zero(),R.Lt.Zero(),0,0,t)));class h extends C.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(E){this._iesProfileTexture!==E&&(this._iesProfileTexture=E,this._iesProfileTexture&&h._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(E){this._angle=E,this._cosHalfAngle=Math.cos(.5*E),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(E){this._innerAngle=E,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(E){this._shadowAngleScale=E,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(E){this._projectionTextureLightNear=E,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(E){this._projectionTextureLightFar=E,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(E){this._projectionTextureUpDirection=E,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(E){this._projectionTexture!==E&&(this._projectionTexture=E,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(h._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):h._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(E){return void 0!==E.onGeneratedObservable}static _IsTexture(E){return void 0!==E.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(E){this._projectionTextureProjectionLightMatrix=E,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(E,t,z,A,X,u){super(E,u),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=R.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=R.Lt.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=R.Lt.Zero(),this._projectionTextureViewLightMatrix=R.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=R.Matrix.Zero(),this._projectionTextureScalingMatrix=R.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=t,this.direction=z,this.angle=A,this.exponent=X}getClassName(){return"SpotLight"}getTypeID(){return p.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(E){super._setDirection(E),this._projectionTextureViewLightDirty=!0}_setPosition(E){super._setPosition(E),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(E,t,z){const A=this.lE().activeCamera;if(!A)return;this._shadowAngleScale=this._shadowAngleScale||1;const X=this._shadowAngleScale*this._angle,u=void 0!==this.shadowMinZ?this.shadowMinZ:A.Cp,p=void 0!==this.shadowMaxZ?this.shadowMaxZ:A.maxZ,C=this.lE().getEngine().useReverseDepthBuffer;R.Matrix.PerspectiveFovLHToRef(X,1,C?p:u,C?u:p,E,!0,this._scene.getEngine().isNDCHalfZRange,void 0,C)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),R.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const E=this.projectionTextureLightFar,t=this.projectionTextureLightNear,z=E/(E-t),A=-z*t,X=1/Math.tan(this._angle/2);R.Matrix.FromValuesToRef(X/1,0,0,0,0,X,0,0,0,0,z,1,0,0,A,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof Z.d){const E=this._projectionTexture.uScale/2,t=this._projectionTexture.vScale/2;R.Matrix.FromValuesToRef(E,0,0,0,0,t,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(E,t){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),E.setMatrix("textureProjectionMatrix"+t,this._projectionTextureMatrix),E.setTexture("projectionLightTexture"+t,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&E.setTexture("iesLightTexture"+t,this._iesProfileTexture),this}transferToEffect(E,t){let z;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,t),z=R.Lt.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,t),z=R.Lt.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",z.x,z.y,z.z,this._cosHalfAngle,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,t),this}transferToNodeMaterialEffect(E,t){let z;return z=this.computeTransformedInformation()?R.Lt.Normalize(this.transformedDirection):R.Lt.Normalize(this.direction),this.lE().useRightHandedSystem?E.setFloat3(t,-z.x,-z.y,-z.z):E.setFloat3(t,z.x,z.y,z.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(E){const t=this._scene.getEngine(),z=void 0!==this.shadowMinZ?this.shadowMinZ:(null===E||void 0===E?void 0:E.Cp)??0;return t.useReverseDepthBuffer&&t.isNDCHalfZRange?z:this._scene.getEngine().isNDCHalfZRange?0:z}getDepthMaxZ(E){const t=this._scene.getEngine(),z=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===E||void 0===E?void 0:E.maxZ)??1e4;return t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:z}prepareLightSpecificDefines(E,t){E["SPOTLIGHT"+t]=!0,E["PROJECTEDLIGHTTEXTURE"+t]=!(!this.projectionTexture||!this.projectionTexture.isReady()),E["IESLIGHTTEXTURE"+t]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,A.b)([(0,X.K)()],h.prototype,"angle",null),(0,A.b)([(0,X.K)()],h.prototype,"innerAngle",null),(0,A.b)([(0,X.K)()],h.prototype,"shadowAngleScale",null),(0,A.b)([(0,X.K)()],h.prototype,"exponent",void 0),(0,A.b)([(0,X.K)()],h.prototype,"projectionTextureLightNear",null),(0,A.b)([(0,X.K)()],h.prototype,"projectionTextureLightFar",null),(0,A.b)([(0,X.K)()],h.prototype,"projectionTextureUpDirection",null),(0,A.b)([(0,X.B)("projectedLightTexture")],h.prototype,"_projectionTexture",void 0),(0,H.f)("BABYLON.SpotLight",h)},13154:(E,t,z)=>{"use strict";z.d(t,{b:()=>u,d:()=>R,f:()=>p});const A={},X={};function R(E,t){A[E]=t}function u(E,t){X[E]=t}function p(E){return X[E]?X[E]:null}},13060:(E,t,z)=>{"use strict";z.d(t,{b:()=>S,d:()=>i});var A,X=z(11630),R=z(11632),u=z(12051),p=z(11667),C=z(11640),Z=z(12270),H=z(11674),h=z(11681),d=z(11772),y=z(11712),O=z(11661);!function(E){E[E.Clean=0]="Clean",E[E.Stop=1]="Stop",E[E.Sync=2]="Sync",E[E.NoSync=3]="NoSync"}(A||(A={}));const c=new R.b,a={};let L=!1;function mE(){return a[".babylon"]}function W(E,t){const z=a[E];return z||(C.d.Warn("Unable to find a plugin to load "+E+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),t?mE():void 0)}function I(E,t,z){let A="Unable to load from "+(E.rawData?"binary data":E.url);return t?A+=`: ${t}`:z&&(A+=`: ${z}`),A}async function e(E,t,z,A,X,R,u,p,C){var Z;const h="data:"===(d=E.url).substring(0,5)?d.substring(5):null;var d;if(E.rawData&&!u)throw"When using ArrayBufferView to load data the file extension must be provided.";const L=h||u?"":function(E){const t=E.indexOf("?");-1!==t&&(E=E.substring(0,t));const z=E.lastIndexOf(".");return E.substring(z,E.length).toLowerCase()}(E.url);let I=u?W(u,!0):h?function(E){for(const t in a){const z=a[t].plugin;if(z.canDirectLoad&&z.canDirectLoad(E))return a[t]}return mE()}(E.url):W(L,!1);if(!I&&L){if(E.url&&!E.url.startsWith("blob:")){const t=await async function(E,t){const z=t.method||"GET";return await new Promise(((A,X)=>{const R=new O.d;R.addEventListener("readystatechange",(()=>{if(4==R.readyState)if(200==R.status){const E={};if(t.responseHeaders)for(const z of t.responseHeaders)E[z]=R.getResponseHeader(z)||"";A({response:R.response,headerValues:E})}else X(`Unable to fetch data from ${E}. Error code: ${R.status}`)})),R.open(z,E),R.send()}))}(E.url,{method:"HEAD",responseHeaders:["Content-Type"]}),z=t.headerValues?t.headerValues["Content-Type"]:"";z&&(I=function(E){for(const t in a){const z=a[t];if(z.mimeType===E)return z}}(z))}I||(I=mE())}if(!I)throw new Error(`No plugin or fallback for ${u??E.url}`);if(!1===(null===C||void 0===C||null===(Z=C[I.plugin.name])||void 0===Z?void 0:Z.enabled))throw new Error(`The '${I.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(E.rawData&&!I.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(E=>{if(I.plugin.createPlugin){const t=I.plugin.createPlugin(C??{});return t instanceof Promise?(t.then(E).catch((E=>{X("Error instantiating plugin.",E)})),null):(E(t),t)}return E(I.plugin),I.plugin})((C=>{var Z;if(!C)throw`The loader plugin corresponding to the '${u}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(c.notifyObservers(C),h&&(C.canDirectLoad&&C.canDirectLoad(E.url)||!(0,H.l)(E.url))){if(C.directLoad){const E=C.directLoad(t,h);E instanceof Promise?E.then((E=>{z(C,E)})).catch((E=>{X("Error in directLoad of _loadData: "+E,E)})):z(C,E)}else z(C,h);return}const d=I.isBinary,O=(E,A)=>{t.C?X("Scene has been disposed"):z(C,E,A)};let a=null,L=!1;null===(Z=C.IX)||void 0===Z||Z.add((()=>{L=!0,a&&(a.abort(),a=null),R()}));const mE=()=>{if(L)return;const z=(E,t)=>{X(null===E||void 0===E?void 0:E.statusText,t)};if(!C.loadFile&&E.rawData)throw"Plugin does not support loading ArrayBufferView.";a=C.loadFile?C.loadFile(t,E.rawData||E.file||E.url,E.rootUrl,O,A,d,z,p):t._loadFile(E.file||E.url,O,A,!0,d,z)},W=t.getEngine();let e=W.enableOfflineSupport;if(e){let z=!1;for(const A of t.disableOfflineSupportExceptionRules)if(A.test(E.url)){z=!0;break}e=!z}e&&y.b.OfflineProviderFactory?t.offlineProvider=y.b.OfflineProviderFactory(E.url,mE,W.disableManifestCheck):mE()}))}function D(E,t){let z,A,R=null,u=null;if(t)if(t.name)z=`file:${t.name}`,A=t.name,R=t;else if(ArrayBuffer.isView(t))z="",A=(0,d.d)(),u=t;else if(t.startsWith("data:"))z=t,A="";else if(E){const R=t;if("/"===R.substring(0,1))return X.Tools.Error("Wrong sceneFilename parameter"),null;z=E+R,A=R}else z=t,A=X.Tools.GetFilename(t),E=X.Tools.GetFolderPath(t);else z=E,A=X.Tools.GetFilename(E),E=X.Tools.GetFolderPath(E);return{url:z,rootUrl:E,name:A,file:R,rawData:u}}function S(E){if("string"===typeof E.extensions){const t=E.extensions;a[t.toLowerCase()]={plugin:E,isBinary:!1}}else{const t=E.extensions,z=Object.keys(t);for(const A of z)a[A.toLowerCase()]={plugin:E,isBinary:t[A].isBinary,mimeType:t[A].mimeType}}}async function l(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.d.LastCreatedScene,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!A)return C.d.Error("No scene available to import mesh to"),null;const y=D(t,z);if(!y)return null;const O={};A.addPendingData(O);const c=()=>{A.removePendingData(O)},a=(E,t)=>{const z=I(y,E,t);u?u(A,z,new h.g(z,h.d.SceneLoaderError,t)):C.d.Error(z),c()},L=R?E=>{try{R(E)}catch(t){a("Error in onProgress callback: "+t,t)}}:void 0,mE=(E,t,z,R,u,p,C,Z)=>{if(A.importedMeshesFiles.push(y.url),X)try{X(E,t,z,R,u,p,C,Z)}catch(H){a("Error in onSuccess callback: "+H,H)}A.removePendingData(O)};return await e(y,A,((t,z,X)=>{if(t.rewriteRootURL&&(y.rootUrl=t.rewriteRootURL(y.rootUrl,X)),t.importMesh){const X=[],R=[],u=[];if(!t.importMesh(E,A,z,y.rootUrl,X,R,u,a))return;A.loadingPluginName=t.name,mE(X,R,u,[],[],[],[],[])}else{t.importMeshAsync(E,A,z,y.rootUrl,L,y.name).then((E=>{A.loadingPluginName=t.name,mE(E.meshes,E.Kd,E.skeletons,E.animationGroups,E.transformNodes,E.geometries,E.lights,E.spriteManagers)})).catch((E=>{a(E.message,E)}))}}),L,a,c,Z,H,d)}async function f(E,t,z,A,X,R,u,p){return await new Promise(((C,Z)=>{try{l(E,t,z,A,((E,t,z,A,X,R,u,p)=>{C({meshes:E,Kd:t,skeletons:z,animationGroups:A,transformNodes:X,geometries:R,lights:u,spriteManagers:p})}),X,((E,t,z)=>{Z(z||new Error(t))}),R,u,p).catch(Z)}catch(h){Z(h)}}))}async function K(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.d.LastCreatedEngine,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};z?await B(E,t,new u.c(z),A,R,C,Z,H,h):X.Tools.Error("No engine available")}async function F(E,t,z,A,X,R,u){return await new Promise(((p,C)=>{K(E,t,z,(E=>{p(E)}),A,((E,t,z)=>{C(z||new Error(t))}),X,R,u)}))}async function B(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.d.LastCreatedScene,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!z)return C.d.Error("No scene available to append to"),null;const y=D(E,t);if(!y)return null;const O={};z.addPendingData(O);const c=()=>{z.removePendingData(O)};Z.d.ShowLoadingScreen&&!L&&(L=!0,z.getEngine().displayLoadingUI(),z.executeWhenReady((()=>{z.getEngine().hideLoadingUI(),L=!1})));const a=(E,t)=>{const A=I(y,E,t);R?R(z,A,new h.g(A,h.d.SceneLoaderError,t)):C.d.Error(A),c()},mE=X?E=>{try{X(E)}catch(t){a("Error in onProgress callback",t)}}:void 0,W=()=>{if(A)try{A(z)}catch(E){a("Error in onSuccess callback",E)}z.removePendingData(O)};return await e(y,z,((E,t)=>{if(E.load){if(!E.load(z,t,y.rootUrl,a))return;z.loadingPluginName=E.name,W()}else{E.loadAsync(z,t,y.rootUrl,mE,y.name).then((()=>{z.loadingPluginName=E.name,W()})).catch((E=>{a(E.message,E)}))}}),mE,a,c,u,H,d)}async function b(E,t,z,A,X,R,u){return await new Promise(((p,C)=>{try{B(E,t,z,(E=>{p(E)}),A,((E,t,z)=>{C(z||new Error(t))}),X,R,u).catch(C)}catch(h){C(h)}}))}async function x(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.d.LastCreatedScene,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!z)return C.d.Error("No scene available to load asset container to"),null;const d=D(E,t);if(!d)return null;const y={};z.addPendingData(y);const O=()=>{z.removePendingData(y)},c=(E,t)=>{const A=I(d,E,t);R?R(z,A,new h.g(A,h.d.SceneLoaderError,t)):C.d.Error(A),O()},a=X?E=>{try{X(E)}catch(t){c("Error in onProgress callback",t)}}:void 0,L=E=>{if(A)try{A(E)}catch(t){c("Error in onSuccess callback",t)}z.removePendingData(y)};return await e(d,z,((E,t)=>{if(E.loadAssetContainer){const A=E.loadAssetContainer(z,t,d.rootUrl,c);if(!A)return;A.populateRootNodes(),z.loadingPluginName=E.name,L(A)}else if(E.loadAssetContainerAsync){E.loadAssetContainerAsync(z,t,d.rootUrl,a,d.name).then((t=>{t.populateRootNodes(),z.loadingPluginName=E.name,L(t)})).catch((E=>{c(E.message,E)}))}else c("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),a,c,O,u,Z,H)}async function J(E,t,z,A,X,R,u){return await new Promise(((p,C)=>{try{x(E,t,z,(E=>{p(E)}),A,((E,t,z)=>{C(z||new Error(t))}),X,R,u).catch(C)}catch(h){C(h)}}))}async function V(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.d.LastCreatedScene,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!z)return void C.d.Error("No scene available to load animations to");if(A){for(const A of z.animatables)A.reset();z.stopAllAnimations();const E=z.animationGroups.slice();for(const z of E)z.dispose();const t=z.getNodes();for(const z of t)z.animations&&(z.animations=[])}else switch(X){case 0:const E=z.animationGroups.slice();for(const t of E)t.dispose();break;case 1:for(const t of z.animationGroups)t.stop();break;case 2:for(const t of z.animationGroups)t.reset(),t.restart();break;case 3:break;default:return void C.d.Error("Unknown animation group loading mode value '"+X+"'")}const O=z.animatables.length;await x(E,t,z,(E=>{E.mergeAnimationsTo(z,z.animatables.slice(O),R),E.dispose(),z.onAnimationFileImportedObservable.notifyObservers(z),u&&u(z)}),Z,H,h,d,y)}async function r(E,t,z,A,X,R,u,p,C,Z){return await new Promise(((H,d)=>{try{V(E,t,z,A,X,R,(E=>{H(E)}),u,((E,t,z)=>{d(z||new Error(t))}),p,C,Z).catch(d)}catch(h){d(h)}}))}class i{static get ForceFullSceneLoadingForIncremental(){return Z.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(E){Z.d.ForceFullSceneLoadingForIncremental=E}static get ShowLoadingScreen(){return Z.d.ShowLoadingScreen}static set ShowLoadingScreen(E){Z.d.ShowLoadingScreen=E}static get loggingLevel(){return Z.d.loggingLevel}static set loggingLevel(E){Z.d.loggingLevel=E}static get CleanBoneMatrixWeights(){return Z.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(E){Z.d.CleanBoneMatrixWeights=E}static GetDefaultPlugin(){return mE()}static GetPluginForExtension(E){var t;return null===(t=W(E,!0))||void 0===t?void 0:t.plugin}static IsPluginForExtensionAvailable(E){return function(E){return!!a[E]}(E)}static RegisterPlugin(E){S(E)}static ImportMesh(E,t,z,A,X,R,u,C,Z){l(E,t,z,A,X,R,u,C,Z).catch((E=>null===u||void 0===u?void 0:u(p.d.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async ImportMeshAsync(E,t,z,A,X,R,u){return await f(E,t,z,A,X,R,u)}static Load(E,t,z,A,X,R,u,C){K(E,t,z,A,X,R,u,C).catch((E=>null===R||void 0===R?void 0:R(p.d.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async LoadAsync(E,t,z,A,X,R){return await F(E,t,z,A,X,R)}static Append(E,t,z,A,X,R,u,C){B(E,t,z,A,X,R,u,C).catch((E=>null===R||void 0===R?void 0:R(z??p.d.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async AppendAsync(E,t,z,A,X,R){return await b(E,t,z,A,X,R)}static LoadAssetContainer(E,t,z,A,X,R,u,C){x(E,t,z,A,X,R,u,C).catch((E=>null===R||void 0===R?void 0:R(z??p.d.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async LoadAssetContainerAsync(E,t,z,A,X,R){return await J(E,t,z,A,X,R)}static ImportAnimations(E,t,z,A,X,R,u,C,Z,H,h){V(E,t,z,A,X,R,u,C,Z,H,h).catch((E=>null===Z||void 0===Z?void 0:Z(z??p.d.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async ImportAnimationsAsync(E,t,z,A,X,R,u,p,C,Z,H){return await r(E,t,z,A,X,R,p,Z,H)}}i.NO_LOGGING=0,i.MINIMAL_LOGGING=1,i.SUMMARY_LOGGING=2,i.DETAILED_LOGGING=3,i.OnPluginActivatedObservable=c},13428:(E,t,z)=>{"use strict";z.d(t,{d:()=>d});var A=z(11792),X=z(11801),R=z(11630),u=z(11812),p=z(11840),C=z(11790),Z=z(11766),H=z(11632),h=z(11849);z(13434);class d extends p.b{set boundingBoxSize(E){if(this._boundingBoxSize&&this._boundingBoxSize.equals(E))return;this._boundingBoxSize=E;const t=this.lE();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(E){this._rotationY=E,this.setReflectionTextureMatrix(u.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(E,t,z){let A="";for(const X of E)A+=X;return new d(A,t,null,z,E)}static CreateFromPrefilteredData(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const X=t.useDelayedTextureLoading;t.useDelayedTextureLoading=!1;const R=new d(E,t,null,!1,null,null,null,void 0,!0,z,A);return t.useDelayedTextureLoading=X,R}constructor(E,t){var z;let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,d=arguments.length>8&&void 0!==arguments[8]&&arguments[8],y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,O=arguments.length>10&&void 0!==arguments[10]&&arguments[10],c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,a=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,L=arguments.length>13?arguments[13]:void 0,mE=arguments.length>14?arguments[14]:void 0;super(t),this.onLoadObservable=new H.b,this.boundingBoxPosition=u.Lt.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new u.Matrix,this._buffer=null,this.name=E,this.url=E,this._noMipmap=X,this.pp=!1,this.isCube=!0,this._textureMatrix=u.Matrix.Identity(),this.coordinatesMode=C.d.CUBIC_MODE;let W=null,I=null;null===A||Array.isArray(A)?(this._noMipmap=X,this._format=h,this._createPolynomials=O,W=A,this._loaderOptions=L,this._useSRGBBuffer=mE,this._lodScale=c,this._lodOffset=a):(W=A.extensions??null,this._noMipmap=A.noMipmap??!1,R=A.files??null,I=A.buffer??null,this._format=A.format??5,d=A.prefiltered??!1,y=A.forcedExtension??null,this._createPolynomials=A.createPolynomials??!1,this._lodScale=A.lodScale??.8,this._lodOffset=A.lodOffset??0,this._loaderOptions=A.loaderOptions,this._useSRGBBuffer=A.useSRGBBuffer,p=A.G??null,Z=A.onError??null),(E||R)&&this.updateURL(E,y,p,d,Z,W,null===(z=this.lE())||void 0===z?void 0:z.useDelayedTextureLoading,R,I)}getClassName(){return"CubeTexture"}updateURL(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=E),this.url=E,t&&(this._forcedExtension=t);const Z=E.lastIndexOf("."),H=t||(Z>-1?E.substring(Z).toLowerCase():""),h=0===H.indexOf(".dds"),d=0===H.indexOf(".env"),y=0===H.indexOf(".basis");if(d?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=A,A&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),p)this._files=p;else if(y||d||h||R||(R=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,R){for(let t=0;t<R.length;t++)this._files.push(E+R[t]);this._extensions=R}this._buffer=C,u?(this.delayLoadState=4,this._delayedOnLoad=z,this._delayedOnError=X):this._loadTexture(z,X)}delayLoad(E){4===this.delayLoadState&&(E&&(this._forcedExtension=E),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(E){var t,z;if(E.updateFlag===this._textureMatrix.updateFlag)return;E.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(z=this.lE())||void 0===z||z.markAllMaterialsAsDirty(1,(E=>-1!==E.getActiveTextures().indexOf(this))));if(this._textureMatrix=E,null===(t=this.lE())||void 0===t||!t.useRightHandedSystem)return;const A=u.TmpVectors.Lt[0],X=u.TmpVectors.Quaternion[0],R=u.TmpVectors.Lt[1];this._textureMatrix.decompose(A,X,R),X.z*=-1,X.w*=-1,u.Matrix.ComposeToRef(A,X,R,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var E;return null!==(E=this.lE())&&void 0!==E&&E.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const z=this.lE(),A=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const X=()=>{var t;(this.onLoadObservable.notifyObservers(this),A)&&(A.dispose(),null===(t=this.lE())||void 0===t||t.markAllMaterialsAsDirty(1));E&&E()},u=(E,z)=>{this._loadingError=!0,this._errorObject={message:E,exception:z},t&&t(E,z),C.d.OnTextureLoadErrorObservable.notifyObservers(this)};var p;this._texture?this._texture.isReady?R.Tools.SetImmediate((()=>X())):this._texture.onLoadedObservable.add((()=>X())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,z,this._lodScale,this._lodOffset,E,u,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,z,this._files,this._noMipmap,E,u,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(p=this._texture)||void 0===p||p.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(E,t,z){const A=h.b.Parse((()=>{let A=!1;return E.prefiltered&&(A=E.prefiltered),new d(z+(E.url??E.name),t,E.extensions,!1,E.files||null,null,null,void 0,A,E.forcedExtension)}),E,t);if(E.boundingBoxPosition&&(A.boundingBoxPosition=u.Lt.St(E.boundingBoxPosition)),E.boundingBoxSize&&(A.boundingBoxSize=u.Lt.St(E.boundingBoxSize)),E.animations)for(let X=0;X<E.animations.length;X++){const t=E.animations[X],z=(0,Z.d)("BABYLON.Animation");z&&A.animations.push(z.Parse(t))}return A}clone(){let E=0;const t=h.b.Clone((()=>{const t=new d(this.url,this.lE()||this._getEngine(),this._extensions,this._noMipmap,this._files);return E=t.uniqueId,t}),this);return t.uniqueId=E,t}}(0,A.b)([(0,X.K)()],d.prototype,"url",void 0),(0,A.b)([(0,X.G)()],d.prototype,"boundingBoxPosition",void 0),(0,A.b)([(0,X.G)()],d.prototype,"boundingBoxSize",null),(0,A.b)([(0,X.K)("rotationY")],d.prototype,"rotationY",null),(0,A.b)([(0,X.K)("files")],d.prototype,"_files",void 0),(0,A.b)([(0,X.K)("forcedExtension")],d.prototype,"_forcedExtension",void 0),(0,A.b)([(0,X.K)("extensions")],d.prototype,"_extensions",void 0),(0,A.b)([(0,X.v)("textureMatrix")],d.prototype,"_textureMatrix",void 0),(0,A.b)([(0,X.v)("textureMatrixRefraction")],d.prototype,"_textureMatrixRefraction",void 0),C.d._CubeTextureParser=d.Parse,(0,Z.f)("BABYLON.CubeTexture",d)},13927:(E,t,z)=>{"use strict";z.d(t,{d:()=>C});var A=z(11640),X=z(11790),R=z(11778),u=z(11960),p=z(11751);u.ThinEngine.prototype.createDynamicTexture=function(E,t,z,A){const X=new p.e(this,4);return X.baseWidth=E,X.baseHeight=t,z&&(E=this.needPOTTextures?(0,R.d)(E,this._caps.maxTextureSize):E,t=this.needPOTTextures?(0,R.d)(t,this._caps.maxTextureSize):t),X.width=E,X.height=t,X.isReady=!1,X.generateMipMaps=z,X.samplingMode=A,this.updateTextureSamplingMode(A,X),this._internalTexturesCache.push(X),X},u.ThinEngine.prototype.updateDynamicTexture=function(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4?arguments[4]:void 0,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!E)return;const u=this._gl,p=u.TEXTURE_2D,C=this._bindTextureDirectly(p,E,!0,R);this._unpackFlipY(void 0===z?E.invertY:z),A&&u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const Z=this._getWebGLTextureType(E.type),H=this._getInternalFormat(X||E.format),h=this._getRGBABufferInternalSizedFormat(E.type,H);u.texImage2D(p,0,h,H,Z,t),E.generateMipMaps&&u.generateMipmap(p),C||this._bindTextureDirectly(p,null),A&&u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),X&&(E.format=X),E._dynamicTextureSource=t,E._premulAlpha=A,E.invertY=z||!1,E.isReady=!0};class C extends X.d{constructor(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,p=arguments.length>6?arguments[6]:void 0;const C=!z||z._isScene;super(null,C?z:null===z||void 0===z?void 0:z.It,C?!A:z,p,R,void 0,void 0,void 0,void 0,u),this.name=E,this.wrapU=X.d.CLAMP_ADDRESSMODE,this.wrapV=X.d.CLAMP_ADDRESSMODE,this._generateMipMaps=A;const Z=this._getEngine();if(!Z)return;if(t.getContext)this._canvas=t,this._ownCanvas=!1,this._texture=Z.createDynamicTexture(this._canvas.width,this._canvas.height,A,R);else{this._canvas=Z.createCanvas(1,1),this._ownCanvas=!0;const E=t;E.width||0===E.width?this._texture=Z.createDynamicTexture(E.width,E.height,A,R):this._texture=Z.createDynamicTexture(t,t,A,R)}const H=this.getSize();this._canvas.width!==H.width&&(this._canvas.width=H.width),this._canvas.height!==H.height&&(this._canvas.height=H.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(E){this._canvas.width=E.width,this._canvas.height=E.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(E.width,E.height,this._generateMipMaps,this.samplingMode)}scale(E){const t=this.getSize();t.width*=E,t.height*=E,this._recreate(t)}scaleTo(E,t){const z=this.getSize();z.width=E,z.height=t,this._recreate(z)}getContext(){return this._context}clear(E){const t=this.getSize();E&&(this._context.fillStyle=E),this._context.clearRect(0,0,t.width,t.height)}update(E){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===E||E,t,this._format||void 0,void 0,z)}drawText(E,t,z,A,X,R,u){let p=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const C=this.getSize();if(R&&(this._context.fillStyle=R,this._context.fillRect(0,0,C.width,C.height)),this._context.font=A,null===t||void 0===t){const z=this._context.measureText(E);t=(C.width-z.width)/2}if(null===z||void 0===z){const E=parseInt(A.replace(/\D/g,""));z=C.height/2+E/3.65}this._context.fillStyle=X||"",this._context.fillText(E,t,z),p&&this.update(u)}dispose(){var E,t;(super.dispose(),this._ownCanvas)&&(null===(E=this._canvas)||void 0===E||null===(t=E.remove)||void 0===t||t.call(E));this._canvas=null,this._context=null}clone(){const E=this.lE();if(!E)return this;const t=this.getSize(),z=new C(this.name,t,E,this._generateMipMaps);return z.pp=this.pp,z.level=this.level,z.wrapU=this.wrapU,z.wrapV=this.wrapV,z}serialize(){const E=this.lE();E&&!E.isReady()&&A.d.Warn("The scene must be ready before serializing the dynamic texture");const t=super.serialize();return C._IsCanvasElement(this._canvas)&&(t.base64String=this._canvas.toDataURL()),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t}static _IsCanvasElement(E){return void 0!==E.toDataURL}_rebuild(){this.update()}}},13362:(E,t,z)=>{"use strict";z.d(t,{d:()=>X});var A=z(11790);class X extends A.d{get depth(){return this._depth}constructor(E,t,z,X,R,u){let p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:A.d.TRILINEAR_SAMPLINGMODE,H=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,h=arguments.length>10?arguments[10]:void 0;super(null,u,!p,C),this.format=R,this._texture=u.getEngine().createRawTexture2DArray(E,t,z,X,R,p,C,Z,null,H,h),this._depth=X,this.is2DArray=!0}update(E){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,E,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(E,t,z,A,R){return new X(E,t,z,A,5,R,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13173:(E,t,z)=>{"use strict";z.d(t,{e:()=>p,i:()=>C,l:()=>R,o:()=>u});var A=z(11834),X=z(11812);function R(E,t){return`{X: ${E.x.toFixed(t)} Y: ${E.y.toFixed(t)}}`}function u(E,t){return`{X: ${E._x.toFixed(t)} Y: ${E._y.toFixed(t)} Z: ${E._z.toFixed(t)}}`}function p(E,t){return 2*Math.acos((0,A.Clamp)(X.Quaternion.Dot(E,t)))}function C(E,t){const z=new X.Quaternion;return function(E,t,z){const R=X.Lt.Cross(E,t),u=Math.acos((0,A.Clamp)(X.Lt.Dot(E,t),-1,1));X.Quaternion.RotationAxisToRef(R,u,z)}(E,t,z),z}},13011:(E,t,z)=>{"use strict";z.d(t,{e:()=>Z});var A=z(11812),X=z(11856),R=z(12250),u=z(12238),p=z(11870);z(13019);function C(E){let t=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const z=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],R=[];let C=[];const Z=E.width||E.size||1,H=E.height||E.size||1,h=E.depth||E.size||1,d=E.wrap||!1;let y=void 0===E.topBaseAt?1:E.topBaseAt,O=void 0===E.bottomBaseAt?0:E.bottomBaseAt;y=(y+4)%4,O=(O+4)%4;let c=[2,0,3,1][y],a=[2,0,1,3][O],L=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(d){t=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],L=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let E=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],z=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const A=[17,18,19,16],X=[22,23,20,21];for(;c>0;)E.unshift(E.pop()),A.unshift(A.pop()),c--;for(;a>0;)z.unshift(z.pop()),X.unshift(X.pop()),a--;E=E.flat(),z=z.flat(),L=L.concat(E).concat(z),t.push(A[0],A[2],A[3],A[0],A[1],A[2]),t.push(X[0],X[2],X[3],X[0],X[1],X[2])}const mE=[Z/2,H/2,h/2];C=L.reduce(((E,t,z)=>E.concat(t*mE[z%3])),[]);const W=0===E.sideOrientation?0:E.sideOrientation||u.c.DEFAULTSIDE,I=E.faceUV||new Array(6),e=E.faceColors,D=[];for(let u=0;u<6;u++)void 0===I[u]&&(I[u]=new A.Vector4(0,0,1,1)),e&&void 0===e[u]&&(e[u]=new X.Lp(1,1,1,1));for(let A=0;A<6;A++)if(R.push(I[A].z,p.d?1-I[A].w:I[A].w),R.push(I[A].x,p.d?1-I[A].w:I[A].w),R.push(I[A].x,p.d?1-I[A].y:I[A].y),R.push(I[A].z,p.d?1-I[A].y:I[A].y),e)for(let E=0;E<4;E++)D.push(e[A].r,e[A].g,e[A].b,e[A].a);u.c._ComputeSides(W,C,t,z,R,E.frontUVs,E.backUVs);const S=new u.c;if(S.indices=t,S.KE=C,S.FE=z,S.bE=R,e){const E=W===u.c.DOUBLESIDE?D.concat(D):D;S.BE=E}return S}function Z(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new R.e(E,z);t.sideOrientation=R.e._GetDefaultSideOrientation(t.sideOrientation),A._originalBuilderSideOrientation=t.sideOrientation;return C(t).JE(A,t.updatable),A}u.c.CreateBox=C,R.e.CreateBox=function(E,t){return Z(E,{size:t,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13163:(E,t,z)=>{"use strict";z.d(t,{c:()=>p});var A=z(12250),X=z(12238),R=z(11870);function u(E){const t=[],z=[],A=[],u=[],p=E.radius||.5,C=E.tessellation||64,Z=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1,H=0===E.sideOrientation?0:E.sideOrientation||X.c.DEFAULTSIDE;t.push(0,0,0),u.push(.5,.5);const h=2*Math.PI*Z,d=1===Z?h/C:h/(C-1);let y=0;for(let X=0;X<C;X++){const E=Math.cos(y),z=Math.sin(y),A=(E+1)/2,X=(1-z)/2;t.push(p*E,p*z,0),u.push(A,R.d?1-X:X),y+=d}1===Z&&(t.push(t[3],t[4],t[5]),u.push(u[2],R.d?1-u[3]:u[3]));const O=t.length/3;for(let X=1;X<O-1;X++)z.push(X+1,0,X);X.c.ComputeNormals(t,z,A),X.c._ComputeSides(H,t,z,A,u,E.frontUVs,E.backUVs);const c=new X.c;return c.indices=z,c.KE=t,c.FE=A,c.bE=u,c}function p(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new A.e(E,z);t.sideOrientation=A.e._GetDefaultSideOrientation(t.sideOrientation),X._originalBuilderSideOrientation=t.sideOrientation;return u(t).JE(X,t.updatable),X}X.c.CreateDisc=u,A.e.CreateDisc=function(E,t,z){return p(E,{radius:t,tessellation:z,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13019:(E,t,z)=>{"use strict";z.d(t,{f:()=>a,b:()=>mE,i:()=>L});var A=z(11812),X=z(11856),R=z(12250),u=z(12238),p=z(11894);R.e._GroundMeshParser=(E,t)=>C.Parse(E,t);class C extends R.e{constructor(E,t){super(E,t),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=E,this._subdivisionsY=E,this.subdivide(E);const z=this;z.createOrUpdateSubmeshesOctree&&z.createOrUpdateSubmeshesOctree(t)}getHeightAtCoordinates(E,t){const z=this.getWorldMatrix(),X=A.TmpVectors.Matrix[5];z.invertToRef(X);const R=A.TmpVectors.Lt[8];if(A.Lt.TransformCoordinatesFromFloatsToRef(E,0,t,X,R),E=R.x,t=R.z,E<this._minX||E>=this._maxX||t<=this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const u=this._getFacetAt(E,t),p=-(u.x*E+u.z*t+u.w)/u.y;return A.Lt.TransformCoordinatesFromFloatsToRef(0,p,0,z,R),R.y}getNormalAtCoordinates(E,t){const z=new A.Lt(0,1,0);return this.getNormalAtCoordinatesToRef(E,t,z),z}getNormalAtCoordinatesToRef(E,t,z){const X=this.getWorldMatrix(),R=A.TmpVectors.Matrix[5];X.invertToRef(R);const u=A.TmpVectors.Lt[8];if(A.Lt.TransformCoordinatesFromFloatsToRef(E,0,t,R,u),E=u.x,t=u.z,E<this._minX||E>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const p=this._getFacetAt(E,t);return A.Lt.TransformNormalFromFloatsToRef(p.x,p.y,p.z,X,z),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(E,t){const z=Math.floor((E+this._maxX)*this._subdivisionsX/this._width),A=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),X=this._heightQuads[A*this._subdivisionsX+z];let R;return R=t<X.slope.x*E+X.slope.y?X.facet1:X.facet2,R}_initHeightQuads(){const E=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=[];for(let z=0;z<t;z++)for(let t=0;t<E;t++){const X={slope:A.Vector2.Zero(),facet1:new A.Vector4(0,0,0,0),facet2:new A.Vector4(0,0,0,0)};this._heightQuads[z*E+t]=X}return this}_computeHeightQuads(){const E=this.getVerticesData(p.f.PositionKind);if(!E)return this;const t=A.TmpVectors.Lt[3],z=A.TmpVectors.Lt[2],X=A.TmpVectors.Lt[1],R=A.TmpVectors.Lt[0],u=A.TmpVectors.Lt[4],C=A.TmpVectors.Lt[5],Z=A.TmpVectors.Lt[6],H=A.TmpVectors.Lt[7],h=A.TmpVectors.Lt[8];let d=0,y=0,O=0,c=0,a=0,L=0,mE=0;const W=this._subdivisionsX,I=this._subdivisionsY;for(let p=0;p<I;p++)for(let I=0;I<W;I++){d=3*I,y=p*(W+1)*3,O=(p+1)*(W+1)*3,t.x=E[y+d],t.y=E[y+d+1],t.z=E[y+d+2],z.x=E[y+d+3],z.y=E[y+d+4],z.z=E[y+d+5],X.x=E[O+d],X.y=E[O+d+1],X.z=E[O+d+2],R.x=E[O+d+3],R.y=E[O+d+4],R.z=E[O+d+5],c=(R.z-t.z)/(R.x-t.x),a=t.z-c*t.x,z.subtractToRef(t,u),X.subtractToRef(t,C),R.subtractToRef(t,Z),A.Lt.CrossToRef(Z,C,H),A.Lt.CrossToRef(u,Z,h),H.normalize(),h.normalize(),L=-(H.x*t.x+H.y*t.y+H.z*t.z),mE=-(h.x*z.x+h.y*z.y+h.z*z.z);const e=this._heightQuads[p*W+I];e.slope.Op(c,a),e.facet1.Op(H.x,H.y,H.z,L),e.facet2.Op(h.x,h.y,h.z,mE)}return this}serialize(E){super.serialize(E),E.subdivisionsX=this._subdivisionsX,E.subdivisionsY=this._subdivisionsY,E.minX=this._minX,E.maxX=this._maxX,E.Cp=this._minZ,E.maxZ=this._maxZ,E.width=this._width,E.height=this._height}static Parse(E,t){const z=new C(E.name,t);return z._subdivisionsX=E.subdivisionsX||1,z._subdivisionsY=E.subdivisionsY||1,z._minX=E.minX,z._maxX=E.maxX,z._minZ=E.Cp,z._maxZ=E.maxZ,z._width=E.width,z._height=E.height,z}}var Z=z(11630),H=z(11667),h=z(11817),d=z(11870);function y(E){const t=[],z=[],X=[],R=[];let p,C;const Z=E.width||E.size||1,H=E.height||E.size||1,h=0|(E.subdivisionsX||E.subdivisions||1),y=0|(E.subdivisionsY||E.subdivisions||1);for(p=0;p<=y;p++)for(C=0;C<=h;C++){const E=new A.Lt(C*Z/h-Z/2,0,(y-p)*H/y-H/2),t=new A.Lt(0,1,0);z.push(E.x,E.y,E.z),X.push(t.x,t.y,t.z),R.push(C/h,d.d?p/y:1-p/y)}for(p=0;p<y;p++)for(C=0;C<h;C++)t.push(C+1+(p+1)*(h+1)),t.push(C+1+p*(h+1)),t.push(C+p*(h+1)),t.push(C+(p+1)*(h+1)),t.push(C+1+(p+1)*(h+1)),t.push(C+p*(h+1));const O=new u.c;return O.indices=t,O.KE=z,O.FE=X,O.bE=R,O}function O(E){const t=void 0!==E.xmin&&null!==E.xmin?E.xmin:-1,z=void 0!==E.zmin&&null!==E.zmin?E.zmin:-1,X=void 0!==E.xmax&&null!==E.xmax?E.xmax:1,R=void 0!==E.zmax&&null!==E.zmax?E.zmax:1,p=E.subdivisions||{w:1,h:1},C=E.precision||{w:1,h:1},Z=[],H=[],h=[],d=[];let y,O,c,a;p.h=p.h<1?1:p.h,p.w=p.w<1?1:p.w,C.w=C.w<1?1:C.w,C.h=C.h<1?1:C.h;const L=(X-t)/p.w,mE=(R-z)/p.h;function W(E,t,z,X){const R=H.length/3,u=C.w+1;for(y=0;y<C.h;y++)for(O=0;O<C.w;O++){const E=[R+O+y*u,R+(O+1)+y*u,R+(O+1)+(y+1)*u,R+O+(y+1)*u];Z.push(E[1]),Z.push(E[2]),Z.push(E[3]),Z.push(E[0]),Z.push(E[1]),Z.push(E[3])}const p=A.Lt.Zero(),c=new A.Lt(0,1,0);for(y=0;y<=C.h;y++)for(p.z=y*(X-t)/C.h+t,O=0;O<=C.w;O++)p.x=O*(z-E)/C.w+E,p.y=0,H.push(p.x,p.y,p.z),h.push(c.x,c.y,c.z),d.push(O/C.w,y/C.h)}for(c=0;c<p.h;c++)for(a=0;a<p.w;a++)W(t+a*L,z+c*mE,t+(a+1)*L,z+(c+1)*mE);const I=new u.c;return I.indices=Z,I.KE=H,I.FE=h,I.bE=d,I}function c(E){const t=[],z=[],R=[],p=[];let C,Z;const H=E.colorFilter||new X.Dt(.3,.59,.11),d=E.alphaFilter||0;let y=!1;if(E.minHeight>E.maxHeight){y=!0;const t=E.maxHeight;E.maxHeight=E.minHeight,E.minHeight=t}for(C=0;C<=E.subdivisions;C++)for(Z=0;Z<=E.subdivisions;Z++){const t=new A.Lt(Z*E.width/E.subdivisions-E.width/2,0,(E.subdivisions-C)*E.height/E.subdivisions-E.height/2),X=4*(((t.x+E.width/2)/E.width*(E.bufferWidth-1)|0)+((1-(t.z+E.height/2)/E.height)*(E.bufferHeight-1)|0)*E.bufferWidth);let u=E.buffer[X]/255,O=E.buffer[X+1]/255,c=E.buffer[X+2]/255;const a=E.buffer[X+3]/255;y&&(u=1-u,O=1-O,c=1-c);const L=u*H.r+O*H.g+c*H.b;t.y=a>=d?E.minHeight+(E.maxHeight-E.minHeight)*L:E.minHeight-h.c,E.heightBuffer&&(E.heightBuffer[C*(E.subdivisions+1)+Z]=t.y),z.push(t.x,t.y,t.z),R.push(0,0,0),p.push(Z/E.subdivisions,1-C/E.subdivisions)}for(C=0;C<E.subdivisions;C++)for(Z=0;Z<E.subdivisions;Z++){const A=Z+1+(C+1)*(E.subdivisions+1),X=Z+1+C*(E.subdivisions+1),R=Z+C*(E.subdivisions+1),u=Z+(C+1)*(E.subdivisions+1),p=z[3*A+1]>=E.minHeight,H=z[3*X+1]>=E.minHeight,h=z[3*R+1]>=E.minHeight;p&&H&&h&&(t.push(A),t.push(X),t.push(R));z[3*u+1]>=E.minHeight&&p&&h&&(t.push(u),t.push(A),t.push(R))}u.c.ComputeNormals(z,t,R);const O=new u.c;return O.indices=t,O.KE=z,O.FE=R,O.bE=p,O}function a(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const z=new C(E,arguments.length>2?arguments[2]:void 0);z._setReady(!1),z._subdivisionsX=t.subdivisionsX||t.subdivisions||1,z._subdivisionsY=t.subdivisionsY||t.subdivisions||1,z._width=t.width||1,z._height=t.height||1,z._maxX=z._width/2,z._maxZ=z._height/2,z._minX=-z._maxX,z._minZ=-z._maxZ;return y(t).JE(z,t.updatable),z._setReady(!0),z}function L(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new R.e(E,z);return O(t).JE(A,t.updatable),A}function mE(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const R=z.width||10,u=z.height||10,p=z.subdivisions||1,h=z.minHeight||0,d=z.maxHeight||1,y=z.colorFilter||new X.Dt(.3,.59,.11),O=z.alphaFilter||0,a=z.updatable,L=z.onReady;A=A||H.d.LastCreatedScene;const mE=new C(E,A);let W;mE._subdivisionsX=p,mE._subdivisionsY=p,mE._width=R,mE._height=u,mE._maxX=mE._width/2,mE._maxZ=mE._height/2,mE._minX=-mE._maxX,mE._minZ=-mE._maxZ,mE._setReady(!1),z.passHeightBufferInCallback&&(W=new Float32Array((p+1)*(p+1)));const I=(E,t,z)=>{c({width:R,height:u,subdivisions:p,minHeight:h,maxHeight:d,colorFilter:y,buffer:E,bufferWidth:t,bufferHeight:z,alphaFilter:O,heightBuffer:W}).JE(mE,a),L&&L(mE,W),mE._setReady(!0)};if("string"===typeof t){const E=E=>{var t;const z=E.width,X=E.height;if(A.C)return;const R=null===(t=A)||void 0===t?void 0:t.getEngine().resizeImageBitmap(E,z,X);I(R,z,X)};Z.Tools.LoadImage(t,E,z.onError?z.onError:()=>{},A.offlineProvider)}else I(t.data,t.width,t.height);return mE}u.c.CreateGround=y,u.c.CreateTiledGround=O,u.c.CreateGroundFromHeightMap=c,R.e.CreateGround=(E,t,z,A,X,R)=>a(E,{width:t,height:z,subdivisions:A,updatable:R},X),R.e.CreateTiledGround=(E,t,z,A,X,R,u,p,C)=>L(E,{xmin:t,zmin:z,xmax:A,zmax:X,subdivisions:R,precision:u,updatable:C},p),R.e.CreateGroundFromHeightMap=(E,t,z,A,X,R,u,p,C,Z,H)=>mE(E,t,{width:z,height:A,subdivisions:X,minHeight:R,maxHeight:u,updatable:C,onReady:Z,alphaFilter:H},p)},13657:(E,t,z)=>{"use strict";z.d(t,{e:()=>y,g:()=>h,j:()=>d});var A=z(11812),X=z(12250),R=z(12238),u=z(12369),p=z(11894),C=z(11640);function Z(E){const t=[],z=[],A=E.lines,X=E.BE,u=[];let p=0;for(let R=0;R<A.length;R++){const E=A[R];for(let A=0;A<E.length;A++){const{x:C,y:Z,z:H}=E[A];if(z.push(C,Z,H),X){const E=X[R],{r:t,g:z,b:p,a:C}=E[A];u.push(t,z,p,C)}A>0&&(t.push(p-1),t.push(p)),p++}}const C=new R.c;return C.indices=t,C.KE=z,X&&(C.BE=u),C}function H(E){const t=E.dashSize||3,z=E.gapSize||1,X=E.dashNb||200,u=E.points,p=[],C=[],Z=A.Lt.Zero();let H=0,h=0,d=0,y=0,O=0,c=0,a=0;for(a=0;a<u.length-1;a++)u[a+1].subtractToRef(u[a],Z),H+=Z.length();for(d=H/X,y=t*d/(t+z),a=0;a<u.length-1;a++){u[a+1].subtractToRef(u[a],Z),h=Math.floor(Z.length()/d),Z.normalize();for(let E=0;E<h;E++)O=d*E,p.push(u[a].x+O*Z.x,u[a].y+O*Z.y,u[a].z+O*Z.z),p.push(u[a].x+(O+y)*Z.x,u[a].y+(O+y)*Z.y,u[a].z+(O+y)*Z.z),C.push(c,c+1),c+=2}const L=new R.c;return L.KE=p,L.indices=C,L}function h(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=t.instance,X=t.lines,R=t.BE;if(A){const E=A.getVerticesData(p.f.PositionKind);let t,z;R&&(t=A.getVerticesData(p.f.ColorKind));let u=0,C=0;for(let A=0;A<X.length;A++){const p=X[A];for(let X=0;X<p.length;X++)E[u]=p[X].x,E[u+1]=p[X].y,E[u+2]=p[X].z,R&&t&&(z=R[A],t[C]=z[X].r,t[C+1]=z[X].g,t[C+2]=z[X].b,t[C+3]=z[X].a,C+=4),u+=3}return A.updateVerticesData(p.f.PositionKind,E,!1,!1),R&&t&&A.updateVerticesData(p.f.ColorKind,t,!1,!1),A.refreshBoundingInfo(),A}const C=!!R,H=new u.d(E,z,null,void 0,void 0,C,t.useVertexAlpha,t.material);return Z(t).JE(H,t.updatable),H}function d(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=t.BE?[t.BE]:null;return h(E,{lines:[t.points],updatable:t.updatable,instance:t.instance,BE:A,useVertexAlpha:t.useVertexAlpha,material:t.material},z)}function y(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=t.points,p=t.instance,Z=t.gapSize||1,h=t.dashSize||3;if(p){const E=E=>{const t=A.Lt.Zero(),z=E.length/6;let X=0,u=0,C=0,Z=0,H=0,h=0,d=0,y=0;for(d=0;d<R.length-1;d++)R[d+1].subtractToRef(R[d],t),X+=t.length();C=X/z;const O=p._creationDataStorage.dashSize;for(Z=O*C/(O+p._creationDataStorage.gapSize),d=0;d<R.length-1;d++)for(R[d+1].subtractToRef(R[d],t),u=Math.floor(t.length()/C),t.normalize(),y=0;y<u&&h<E.length;)H=C*y,E[h]=R[d].x+H*t.x,E[h+1]=R[d].y+H*t.y,E[h+2]=R[d].z+H*t.z,E[h+3]=R[d].x+(H+Z)*t.x,E[h+4]=R[d].y+(H+Z)*t.y,E[h+5]=R[d].z+(H+Z)*t.z,h+=6,y++;for(;h<E.length;)E[h]=R[d].x,E[h+1]=R[d].y,E[h+2]=R[d].z,h+=3};return(t.dashNb||t.dashSize||t.gapSize||t.useVertexAlpha||t.material)&&C.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),p.updateMeshPositions(E,!1),p}const d=new u.d(E,z,null,void 0,void 0,void 0,t.useVertexAlpha,t.material);return H(t).JE(d,t.updatable),d._creationDataStorage=new X.g,d._creationDataStorage.dashSize=h,d._creationDataStorage.gapSize=Z,d}R.c.CreateLineSystem=Z,R.c.CreateDashedLines=H,X.e.hZ=function(E,t){return d(E,{points:t,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},X.e.CreateDashedLines=function(E,t,z,A,X){return y(E,{points:t,dashSize:z,gapSize:A,dashNb:X,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13062:(E,t,z)=>{"use strict";z.d(t,{c:()=>p,g:()=>C});var A=z(12250),X=z(12238),R=z(11870);function u(E){const t=[],z=[],A=[],u=[],p=void 0!==E.width?E.width:void 0!==E.size?E.size:1,C=void 0!==E.height?E.height:void 0!==E.size?E.size:1,Z=0===E.sideOrientation?0:E.sideOrientation||X.c.DEFAULTSIDE,H=p/2,h=C/2;z.push(-H,-h,0),A.push(0,0,-1),u.push(0,R.d?1:0),z.push(H,-h,0),A.push(0,0,-1),u.push(1,R.d?1:0),z.push(H,h,0),A.push(0,0,-1),u.push(1,R.d?0:1),z.push(-H,h,0),A.push(0,0,-1),u.push(0,R.d?0:1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),X.c._ComputeSides(Z,z,t,A,u,E.frontUVs,E.backUVs);const d=new X.c;return d.indices=t,d.KE=z,d.FE=A,d.bE=u,d}function p(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new A.e(E,z);t.sideOrientation=A.e._GetDefaultSideOrientation(t.sideOrientation),X._originalBuilderSideOrientation=t.sideOrientation;return u(t).JE(X,t.updatable),t.sourcePlane&&(X.translate(t.sourcePlane.normal,-t.sourcePlane.d),X.setDirection(t.sourcePlane.normal.scale(-1))),X}const C={cZ:p};X.c.cZ=u,A.e.cZ=(E,t,z,A,X)=>p(E,{size:t,width:t,height:t,sideOrientation:X,updatable:A},z)},13151:(E,t,z)=>{"use strict";z.d(t,{c:()=>C});var A=z(11812),X=z(12250),R=z(12238),u=z(11870);function p(E){const t=0|(E.segments||32),z=E.diameterX||E.diameter||1,X=E.diameterY||E.diameter||1,p=E.diameterZ||E.diameter||1,C=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1,Z=E.slice&&E.slice<=0?1:E.slice||1,H=0===E.sideOrientation?0:E.sideOrientation||R.c.DEFAULTSIDE,h=!!E.dedupTopBottomIndices,d=new A.Lt(z/2,X/2,p/2),y=2+t,O=2*y,c=[],a=[],L=[],mE=[];for(let R=0;R<=y;R++){const E=R/y,t=E*Math.PI*Z;for(let z=0;z<=O;z++){const X=z/O,R=X*Math.PI*2*C,p=A.Matrix.RotationZ(-t),Z=A.Matrix.RotationY(R),H=A.Lt.TransformCoordinates(A.Lt.Up(),p),h=A.Lt.TransformCoordinates(H,Z),y=h.multiply(d),c=h.divide(d).normalize();a.push(y.x,y.y,y.z),L.push(c.x,c.y,c.z),mE.push(X,u.d?1-E:E)}if(R>0){const E=a.length/3;for(let t=E-2*(O+1);t+O+2<E;t++)h?(R>1&&(c.push(t),c.push(t+1),c.push(t+O+1)),(R<y||Z<1)&&(c.push(t+O+1),c.push(t+1),c.push(t+O+2))):(c.push(t),c.push(t+1),c.push(t+O+1),c.push(t+O+1),c.push(t+1),c.push(t+O+2))}}R.c._ComputeSides(H,a,c,L,mE,E.frontUVs,E.backUVs);const W=new R.c;return W.indices=c,W.KE=a,W.FE=L,W.bE=mE,W}function C(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new X.e(E,z);t.sideOrientation=X.e._GetDefaultSideOrientation(t.sideOrientation),A._originalBuilderSideOrientation=t.sideOrientation;return p(t).JE(A,t.updatable),A}R.c.CreateSphere=p,X.e.CreateSphere=(E,t,z,A,X,R)=>C(E,{segments:t,diameterX:z,diameterY:z,diameterZ:z,sideOrientation:R,updatable:X},A)},13941:(E,t,z)=>{"use strict";z.d(t,{b:()=>p});var A=z(12392),X=z(13437),R=z(12415),u=z(12238);class p{static get Configuration(){return{get decoder(){return X.c.DefaultConfiguration},set decoder(E){X.c.DefaultConfiguration=E}}}static set Configuration(E){X.c.DefaultConfiguration=E.decoder}static get DecoderAvailable(){return(0,A.g)(X.c.DefaultConfiguration)}static get Default(){return p._Default??(p._Default=new p),p._Default}static ResetDefault(E){p._Default&&(E||p._Default.dispose(),p._Default=null)}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.DefaultNumWorkers;const t="number"===typeof E?{...X.c.DefaultConfiguration,numWorkers:E}:{...X.c.DefaultConfiguration,...E};this._decoder=new X.c(t)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(E,t,z){return this._decoder.decodeMeshToMeshDataAsync(E,t,z)}async decodeMeshToGeometryAsync(E,t,z,A){return await this._decoder.decodeMeshToGeometryAsync(E,t,z,A)}async _decodeMeshToGeometryForGltfAsync(E,t,z,A,X,R){return await this._decoder._decodeMeshToGeometryForGltfAsync(E,t,z,A,X,R)}async decodeMeshAsync(E,t){const z=await this._decoder.decodeMeshToMeshDataAsync(E,t),A=new u.c;z.indices&&(A.indices=z.indices);for(const X of z.attributes){const E=R.c.GetFloatData(X.data,X.size,R.c.GetDataType(X.data),X.byteOffset,X.byteStride,X.normalized,z.totalVertices);A.set(E,X.kind)}return A}}p.DefaultNumWorkers=(0,A.e)(),p._Default=null},13437:(E,t,z)=>{"use strict";z.d(t,{c:()=>Z});var A=z(12392),X=z(11630),R=z(12265),u=z(12415),p=z(11640),C=z(12406);class Z extends A.c{static get DefaultAvailable(){return(0,A.g)(Z.DefaultConfiguration)}static get Default(){return Z._Default??(Z._Default=new Z),Z._Default}static ResetDefault(E){Z._Default&&(E||Z._Default.dispose(),Z._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(E,t){return{module:await(t||DracoDecoderModule)({wasmBinary:E})}}_getWorkerContent(){return`${C.c}(${C.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z.DefaultConfiguration)}decodeMeshToMeshDataAsync(E,t,z){const A=E instanceof ArrayBuffer?new Int8Array(E):new Int8Array(E.buffer,E.byteOffset,E.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async E=>await new Promise(((X,R)=>{E.push(((E,u)=>{let C=null;const Z=[],H=t=>{E.removeEventListener("error",H),E.removeEventListener("message",h),R(t),u()},h=t=>{const A=t.data;switch(A.id){case"indices":C=A.data;break;case"attribute":Z.push({kind:A.kind,data:A.data,size:A.size,byteOffset:A.byteOffset,byteStride:A.byteStride,normalized:(R=A.kind,d=A.normalized,z&&void 0!==z[R]?(d!==z[R]&&p.d.Warn(`Normalized flag from Draco data (${d}) does not match normalized flag from glTF accessor (${z[R]}). Using flag from glTF accessor.`),z[R]):d)});break;case"decodeMeshDone":E.removeEventListener("error",H),E.removeEventListener("message",h),X({indices:C,attributes:Z,totalVertices:A.totalVertices}),u()}var R,d};E.addEventListener("error",H),E.addEventListener("message",h);const d=A.slice();E.postMessage({id:"decodeMesh",dataView:d,attributes:t},[d.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((E=>{let z=null;const X=[],R=(0,C.c)(E.module,A,t,(E=>{z=E}),((E,t,z,A,R,u)=>{X.push({kind:E,data:t,size:z,byteOffset:A,byteStride:R,normalized:u})}));return{indices:z,attributes:X,totalVertices:R}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(E,t,z,A){const X=await this.decodeMeshToMeshDataAsync(z,A),p=new R.c(E,t);X.indices&&p.setIndices(X.indices);for(const R of X.attributes)p.setVerticesBuffer(new u.c(t.getEngine(),R.data,R.kind,!1,void 0,R.byteStride,void 0,R.byteOffset,R.size,void 0,R.normalized,!0),X.totalVertices);return p}async _decodeMeshToGeometryForGltfAsync(E,t,z,A,X,p){const C=await this.decodeMeshToMeshDataAsync(z,A,X),Z=new R.c(E,t);p&&(Z._boundingInfo=p,Z.useBoundingInfoFromGeometry=!0),C.indices&&Z.setIndices(C.indices);for(const R of C.attributes)Z.setVerticesBuffer(new u.c(t.getEngine(),R.data,R.kind,!1,void 0,R.byteStride,void 0,R.byteOffset,R.size,void 0,R.normalized,!0),C.totalVertices);return Z}}Z.DefaultConfiguration={wasmUrl:`${X.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${X.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${X.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},Z._Default=null},13654:(E,t,z)=>{"use strict";z.d(t,{e:()=>pE});var A=z(11812),X=z(12250),R=z(11894),u=z(12238),p=z(11870);function C(E){let t=E.pathArray;const z=E.closeArray||!1,A=E.closePath||!1,X=E.invertUV||!1,C=Math.floor(t[0].length/2);let Z=E.offset||C;Z=Z>C?C:Math.floor(Z);const H=0===E.sideOrientation?0:E.sideOrientation||u.c.DEFAULTSIDE,h=E.bE,d=E.BE,y=[],O=[],c=[],a=[],L=[],mE=[],W=[],I=[];let e;const D=[],S=[];let l,f,K;if(t.length<2){const E=[],z=[];for(f=0;f<t[0].length-Z;f++)E.push(t[0][f]),z.push(t[0][f+Z]);t=[E,z]}let F=0;const B=A?1:0,b=z?1:0;let x,J,V,r,i,g;for(e=t[0].length,l=0;l<t.length+b;l++){for(W[l]=0,L[l]=[0],x=l===t.length?t[0]:t[l],J=x.length,e=e<J?e:J,K=0;K<J;)y.push(x[K].x,x[K].y,x[K].z),K>0&&(V=x[K].Wt(x[K-1]).length(),r=V+W[l],L[l].push(r),W[l]=r),K++;A&&(K--,y.push(x[0].x,x[0].y,x[0].z),V=x[K].Wt(x[0]).length(),r=V+W[l],L[l].push(r),W[l]=r),D[l]=J+B,S[l]=F,F+=J+B}let o,Q,T=null,q=null;for(f=0;f<e+B;f++)for(I[f]=0,mE[f]=[0],l=0;l<t.length-1+b;l++)i=t[l],g=l===t.length-1?t[0]:t[l+1],f===e?(T=i[0],q=g[0]):(T=i[f],q=g[f]),V=q.Wt(T).length(),r=V+I[f],mE[f].push(r),I[f]=r;if(h)for(l=0;l<h.length;l++)a.push(h[l].x,p.d?1-h[l].y:h[l].y);else for(l=0;l<t.length+b;l++)for(f=0;f<e+B;f++)o=0!=W[l]?L[l][f]/W[l]:0,Q=0!=I[f]?mE[f][l]/I[f]:0,X?a.push(Q,o):a.push(o,p.d?1-Q:Q);l=0;let M=0,w=D[l]-1,n=D[l+1]-1,s=w<n?w:n,j=S[1]-S[0];const U=D.length-1;for(;M<=s&&l<U;)O.push(M,M+j,M+1),O.push(M+j+1,M+1,M+j),M+=1,M===s&&(l++,j=S[l+1]-S[l],w=D[l]-1,n=D[l+1]-1,M=S[l],s=w<n?w+M:n+M);if(u.c.ComputeNormals(y,O,c),A){let E=0,z=0;for(l=0;l<t.length;l++){E=3*S[l],z=l+1<t.length?3*(S[l+1]-1):c.length-3,c[E]=.5*(c[E]+c[z]),c[E+1]=.5*(c[E+1]+c[z+1]),c[E+2]=.5*(c[E+2]+c[z+2]);const A=Math.sqrt(c[E]*c[E]+c[E+1]*c[E+1]+c[E+2]*c[E+2]);c[E]/=A,c[E+1]/=A,c[E+2]/=A,c[z]=c[E],c[z+1]=c[E+1],c[z+2]=c[E+2]}}if(z){let E=3*S[0],z=3*S[t.length];for(f=0;f<e+B;f++){c[E]=.5*(c[E]+c[z]),c[E+1]=.5*(c[E+1]+c[z+1]),c[E+2]=.5*(c[E+2]+c[z+2]);const t=Math.sqrt(c[E]*c[E]+c[E+1]*c[E+1]+c[E+2]*c[E+2]);c[E]/=t,c[E+1]/=t,c[E+2]/=t,c[z]=c[E],c[z+1]=c[E+1],c[z+2]=c[E+2],E+=3,z+=3}}u.c._ComputeSides(H,y,O,c,a,E.frontUVs,E.backUVs);let k=null;if(d){k=new Float32Array(4*d.length);for(let E=0;E<d.length;E++)k[4*E]=d[E].r,k[4*E+1]=d[E].g,k[4*E+2]=d[E].b,k[4*E+3]=d[E].a}const v=new u.c,Y=new Float32Array(y),G=new Float32Array(c),N=new Float32Array(a);return v.indices=O,v.KE=Y,v.FE=G,v.bE=N,k&&v.set(k,R.f.ColorKind),A&&(v._idx=S),v}function Z(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=t.pathArray,H=t.closeArray,h=t.closePath,d=X.e._GetDefaultSideOrientation(t.sideOrientation),y=t.instance,O=t.updatable;if(y){const E=A.TmpVectors.Lt[0].ap(Number.MAX_VALUE),z=A.TmpVectors.Lt[1].ap(-Number.MAX_VALUE),C=t=>{let A=Z[0].length;const R=y;let u=0;const p=R._originalBuilderSideOrientation===X.e.DOUBLESIDE?2:1;for(let X=1;X<=p;++X)for(let p=0;p<Z.length;++p){const X=Z[p],C=X.length;A=A<C?A:C;for(let R=0;R<A;++R){const A=X[R];t[u]=A.x,t[u+1]=A.y,t[u+2]=A.z,E.minimizeInPlaceFromFloats(A.x,A.y,A.z),z.maximizeInPlaceFromFloats(A.x,A.y,A.z),u+=3}if(R._creationDataStorage&&R._creationDataStorage.closePath){const E=X[0];t[u]=E.x,t[u+1]=E.y,t[u+2]=E.z,u+=3}}},H=y.getVerticesData(R.f.PositionKind);if(C(H),y.hasBoundingInfo?y.getBoundingInfo().reConstruct(E,z,y._worldMatrix):y.buildBoundingInfo(E,z,y._worldMatrix),y.updateVerticesData(R.f.PositionKind,H,!1,!1),t.BE){const E=y.getVerticesData(R.f.ColorKind);for(let z=0,A=0;z<t.BE.length;z++,A+=4){const X=t.BE[z];E[A]=X.r,E[A+1]=X.g,E[A+2]=X.b,E[A+3]=X.a}y.updateVerticesData(R.f.ColorKind,E,!1,!1)}if(t.bE){const E=y.getVerticesData(R.f.UVKind);for(let z=0;z<t.bE.length;z++)E[2*z]=t.bE[z].x,E[2*z+1]=p.d?1-t.bE[z].y:t.bE[z].y;y.updateVerticesData(R.f.UVKind,E,!1,!1)}if(!y.areNormalsFrozen||y.isFacetDataEnabled){const E=y.dp(),t=y.getVerticesData(R.f.NormalKind),z=y.isFacetDataEnabled?y.getFacetDataParameters():null;if(u.c.ComputeNormals(H,E,t,z),y._creationDataStorage&&y._creationDataStorage.closePath){let E=0,z=0;for(let A=0;A<Z.length;A++)E=3*y._creationDataStorage.idx[A],z=A+1<Z.length?3*(y._creationDataStorage.idx[A+1]-1):t.length-3,t[E]=.5*(t[E]+t[z]),t[E+1]=.5*(t[E+1]+t[z+1]),t[E+2]=.5*(t[E+2]+t[z+2]),t[z]=t[E],t[z+1]=t[E+1],t[z+2]=t[E+2]}y.areNormalsFrozen||y.updateVerticesData(R.f.NormalKind,t,!1,!1)}return y}{const A=new X.e(E,z);A._originalBuilderSideOrientation=d,A._creationDataStorage=new X.g;const R=C(t);return h&&(A._creationDataStorage.idx=R._idx),A._creationDataStorage.closePath=h,A._creationDataStorage.closeArray=H,R.JE(A,O),A}}u.c.CreateRibbon=C,X.e.CreateRibbon=function(E,t){return Z(E,{pathArray:t,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var H=z(13163),h=z(13011),d=z(11856);function y(E){const t=E.pattern||X.e.NO_FLIP,z=E.tileWidth||E.tileSize||1,A=E.tileHeight||E.tileSize||1,R=E.alignHorizontal||0,p=E.alignVertical||0,C=E.width||E.size||1,Z=Math.floor(C/z);let H=C-Z*z;const h=E.height||E.size||1,d=Math.floor(h/A);let y=h-d*A;const O=z*Z/2,c=A*d/2;let a=0,L=0,mE=0,W=0,I=0,e=0;if(H>0||y>0){switch(mE=-O,W=-c,I=O,e=c,R){case X.e.CENTER:H/=2,mE-=H,I+=H;break;case X.e.LEFT:I+=H,a=-H/2;break;case X.e.RIGHT:mE-=H,a=H/2}switch(p){case X.e.CENTER:y/=2,W-=y,e+=y;break;case X.e.BOTTOM:e+=y,L=-y/2;break;case X.e.TOP:W-=y,L=y/2}}const D=[],S=[],l=[];l[0]=[0,0,1,0,1,1,0,1],l[1]=[0,0,1,0,1,1,0,1],t!==X.e.ROTATE_TILE&&t!==X.e.ROTATE_ROW||(l[1]=[1,1,0,1,0,0,1,0]),t!==X.e.FLIP_TILE&&t!==X.e.FLIP_ROW||(l[1]=[1,0,0,0,0,1,1,1]),t!==X.e.FLIP_N_ROTATE_TILE&&t!==X.e.FLIP_N_ROTATE_ROW||(l[1]=[0,1,1,1,1,0,0,0]);let f=[];const K=[],F=[];let B=0;for(let u=0;u<d;u++)for(let E=0;E<Z;E++)D.push(E*z-O+a,u*A-c+L,0),D.push((E+1)*z-O+a,u*A-c+L,0),D.push((E+1)*z-O+a,(u+1)*A-c+L,0),D.push(E*z-O+a,(u+1)*A-c+L,0),F.push(B,B+1,B+3,B+1,B+2,B+3),f=t===X.e.FLIP_TILE||t===X.e.ROTATE_TILE||t===X.e.FLIP_N_ROTATE_TILE?f.concat(l[(E%2+u%2)%2]):t===X.e.FLIP_ROW||t===X.e.ROTATE_ROW||t===X.e.FLIP_N_ROTATE_ROW?f.concat(l[u%2]):f.concat(l[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),B+=4;if(H>0||y>0){const E=y>0&&(p===X.e.CENTER||p===X.e.TOP),u=y>0&&(p===X.e.CENTER||p===X.e.BOTTOM),C=H>0&&(R===X.e.CENTER||R===X.e.RIGHT),h=H>0&&(R===X.e.CENTER||R===X.e.LEFT);let l,b,x,J,V=[];if(E&&C&&(D.push(mE+a,W+L,0),D.push(-O+a,W+L,0),D.push(-O+a,W+y+L,0),D.push(mE+a,W+y+L,0),F.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,l=1-H/z,b=1-y/A,x=1,J=1,V=[l,b,x,b,x,J,l,J],t===X.e.ROTATE_ROW&&(V=[1-l,1-b,1-x,1-b,1-x,1-J,1-l,1-J]),t===X.e.FLIP_ROW&&(V=[1-l,b,1-x,b,1-x,J,1-l,J]),t===X.e.FLIP_N_ROTATE_ROW&&(V=[l,1-b,x,1-b,x,1-J,l,1-J]),f=f.concat(V),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),E&&h&&(D.push(O+a,W+L,0),D.push(I+a,W+L,0),D.push(I+a,W+y+L,0),D.push(O+a,W+y+L,0),F.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,l=0,b=1-y/A,x=H/z,J=1,V=[l,b,x,b,x,J,l,J],(t===X.e.ROTATE_ROW||t===X.e.ROTATE_TILE&&Z%2===0)&&(V=[1-l,1-b,1-x,1-b,1-x,1-J,1-l,1-J]),(t===X.e.FLIP_ROW||t===X.e.FLIP_TILE&&Z%2===0)&&(V=[1-l,b,1-x,b,1-x,J,1-l,J]),(t===X.e.FLIP_N_ROTATE_ROW||t===X.e.FLIP_N_ROTATE_TILE&&Z%2===0)&&(V=[l,1-b,x,1-b,x,1-J,l,1-J]),f=f.concat(V),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),u&&C&&(D.push(mE+a,c+L,0),D.push(-O+a,c+L,0),D.push(-O+a,e+L,0),D.push(mE+a,e+L,0),F.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,l=1-H/z,b=0,x=1,J=y/A,V=[l,b,x,b,x,J,l,J],(t===X.e.ROTATE_ROW&&d%2===1||t===X.e.ROTATE_TILE&&d%1===0)&&(V=[1-l,1-b,1-x,1-b,1-x,1-J,1-l,1-J]),(t===X.e.FLIP_ROW&&d%2===1||t===X.e.FLIP_TILE&&d%2===0)&&(V=[1-l,b,1-x,b,1-x,J,1-l,J]),(t===X.e.FLIP_N_ROTATE_ROW&&d%2===1||t===X.e.FLIP_N_ROTATE_TILE&&d%2===0)&&(V=[l,1-b,x,1-b,x,1-J,l,1-J]),f=f.concat(V),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),u&&h&&(D.push(O+a,c+L,0),D.push(I+a,c+L,0),D.push(I+a,e+L,0),D.push(O+a,e+L,0),F.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,l=0,b=0,x=H/z,J=y/A,V=[l,b,x,b,x,J,l,J],(t===X.e.ROTATE_ROW&&d%2===1||t===X.e.ROTATE_TILE&&(d+Z)%2===1)&&(V=[1-l,1-b,1-x,1-b,1-x,1-J,1-l,1-J]),(t===X.e.FLIP_ROW&&d%2===1||t===X.e.FLIP_TILE&&(d+Z)%2===1)&&(V=[1-l,b,1-x,b,1-x,J,1-l,J]),(t===X.e.FLIP_N_ROTATE_ROW&&d%2===1||t===X.e.FLIP_N_ROTATE_TILE&&(d+Z)%2===1)&&(V=[l,1-b,x,1-b,x,1-J,l,1-J]),f=f.concat(V),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),E){const E=[];l=0,b=1-y/A,x=1,J=1,E[0]=[l,b,x,b,x,J,l,J],E[1]=[l,b,x,b,x,J,l,J],t!==X.e.ROTATE_TILE&&t!==X.e.ROTATE_ROW||(E[1]=[1-l,1-b,1-x,1-b,1-x,1-J,1-l,1-J]),t!==X.e.FLIP_TILE&&t!==X.e.FLIP_ROW||(E[1]=[1-l,b,1-x,b,1-x,J,1-l,J]),t!==X.e.FLIP_N_ROTATE_TILE&&t!==X.e.FLIP_N_ROTATE_ROW||(E[1]=[l,1-b,x,1-b,x,1-J,l,1-J]);for(let A=0;A<Z;A++)D.push(A*z-O+a,W+L,0),D.push((A+1)*z-O+a,W+L,0),D.push((A+1)*z-O+a,W+y+L,0),D.push(A*z-O+a,W+y+L,0),F.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,f=t===X.e.FLIP_TILE||t===X.e.ROTATE_TILE||t===X.e.FLIP_N_ROTATE_TILE?f.concat(E[(A+1)%2]):t===X.e.FLIP_ROW||t===X.e.ROTATE_ROW||t===X.e.FLIP_N_ROTATE_ROW?f.concat(E[1]):f.concat(E[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(u){const E=[];l=0,b=0,x=1,J=y/A,E[0]=[l,b,x,b,x,J,l,J],E[1]=[l,b,x,b,x,J,l,J],t!==X.e.ROTATE_TILE&&t!==X.e.ROTATE_ROW||(E[1]=[1-l,1-b,1-x,1-b,1-x,1-J,1-l,1-J]),t!==X.e.FLIP_TILE&&t!==X.e.FLIP_ROW||(E[1]=[1-l,b,1-x,b,1-x,J,1-l,J]),t!==X.e.FLIP_N_ROTATE_TILE&&t!==X.e.FLIP_N_ROTATE_ROW||(E[1]=[l,1-b,x,1-b,x,1-J,l,1-J]);for(let A=0;A<Z;A++)D.push(A*z-O+a,e-y+L,0),D.push((A+1)*z-O+a,e-y+L,0),D.push((A+1)*z-O+a,e+L,0),D.push(A*z-O+a,e+L,0),F.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,f=t===X.e.FLIP_TILE||t===X.e.ROTATE_TILE||t===X.e.FLIP_N_ROTATE_TILE?f.concat(E[(A+d)%2]):t===X.e.FLIP_ROW||t===X.e.ROTATE_ROW||t===X.e.FLIP_N_ROTATE_ROW?f.concat(E[d%2]):f.concat(E[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(C){const E=[];l=1-H/z,b=0,x=1,J=1,E[0]=[l,b,x,b,x,J,l,J],E[1]=[l,b,x,b,x,J,l,J],t!==X.e.ROTATE_TILE&&t!==X.e.ROTATE_ROW||(E[1]=[1-l,1-b,1-x,1-b,1-x,1-J,1-l,1-J]),t!==X.e.FLIP_TILE&&t!==X.e.FLIP_ROW||(E[1]=[1-l,b,1-x,b,1-x,J,1-l,J]),t!==X.e.FLIP_N_ROTATE_TILE&&t!==X.e.FLIP_N_ROTATE_ROW||(E[1]=[l,1-b,x,1-b,x,1-J,l,1-J]);for(let z=0;z<d;z++)D.push(mE+a,z*A-c+L,0),D.push(mE+H+a,z*A-c+L,0),D.push(mE+H+a,(z+1)*A-c+L,0),D.push(mE+a,(z+1)*A-c+L,0),F.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,f=t===X.e.FLIP_TILE||t===X.e.ROTATE_TILE||t===X.e.FLIP_N_ROTATE_TILE?f.concat(E[(z+1)%2]):t===X.e.FLIP_ROW||t===X.e.ROTATE_ROW||t===X.e.FLIP_N_ROTATE_ROW?f.concat(E[z%2]):f.concat(E[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(h){const E=[];l=0,b=0,x=H/A,J=1,E[0]=[l,b,x,b,x,J,l,J],E[1]=[l,b,x,b,x,J,l,J],t!==X.e.ROTATE_TILE&&t!==X.e.ROTATE_ROW||(E[1]=[1-l,1-b,1-x,1-b,1-x,1-J,1-l,1-J]),t!==X.e.FLIP_TILE&&t!==X.e.FLIP_ROW||(E[1]=[1-l,b,1-x,b,1-x,J,1-l,J]),t!==X.e.FLIP_N_ROTATE_TILE&&t!==X.e.FLIP_N_ROTATE_ROW||(E[1]=[l,1-b,x,1-b,x,1-J,l,1-J]);for(let z=0;z<d;z++)D.push(I-H+a,z*A-c+L,0),D.push(I+a,z*A-c+L,0),D.push(I+a,(z+1)*A-c+L,0),D.push(I-H+a,(z+1)*A-c+L,0),F.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,f=t===X.e.FLIP_TILE||t===X.e.ROTATE_TILE||t===X.e.FLIP_N_ROTATE_TILE?f.concat(E[(z+Z)%2]):t===X.e.FLIP_ROW||t===X.e.ROTATE_ROW||t===X.e.FLIP_N_ROTATE_ROW?f.concat(E[z%2]):f.concat(E[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const b=0===E.sideOrientation?0:E.sideOrientation||u.c.DEFAULTSIDE;u.c._ComputeSides(b,D,F,S,f,E.frontUVs,E.backUVs);const x=new u.c;x.indices=F,x.KE=D,x.FE=S,x.bE=f;const J=b===u.c.DOUBLESIDE?K.concat(K):K;return x.BE=J,x}function O(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new X.e(E,z);t.sideOrientation=X.e._GetDefaultSideOrientation(t.sideOrientation),A._originalBuilderSideOrientation=t.sideOrientation;return y(t).JE(A,t.updatable),A}function c(E){const t=E.faceUV||new Array(6),z=E.faceColors,R=E.pattern||X.e.NO_FLIP,C=E.width||E.size||1,Z=E.height||E.size||1,H=E.depth||E.size||1,h=E.tileWidth||E.tileSize||1,O=E.tileHeight||E.tileSize||1,c=E.alignHorizontal||0,a=E.alignVertical||0,L=0===E.sideOrientation?0:E.sideOrientation||u.c.DEFAULTSIDE;for(let X=0;X<6;X++)void 0===t[X]&&(t[X]=new A.Vector4(0,0,1,1)),z&&void 0===z[X]&&(z[X]=new d.Lp(1,1,1,1));const mE=C/2,W=Z/2,I=H/2,e=[];for(let A=0;A<2;A++)e[A]=y({pattern:R,tileWidth:h,tileHeight:O,width:C,height:Z,alignVertical:a,alignHorizontal:c,sideOrientation:L});for(let A=2;A<4;A++)e[A]=y({pattern:R,tileWidth:h,tileHeight:O,width:H,height:Z,alignVertical:a,alignHorizontal:c,sideOrientation:L});let D=a;a===X.e.BOTTOM?D=X.e.TOP:a===X.e.TOP&&(D=X.e.BOTTOM);for(let A=4;A<6;A++)e[A]=y({pattern:R,tileWidth:h,tileHeight:O,width:C,height:H,alignVertical:D,alignHorizontal:c,sideOrientation:L});let S=[],l=[],f=[],K=[];const F=[],B=[],b=[],x=[];let J=0,V=0;for(let X=0;X<6;X++){const E=e[X].KE.length;B[X]=[],b[X]=[];for(let t=0;t<E/3;t++)B[X].push(new A.Lt(e[X].KE[3*t],e[X].KE[3*t+1],e[X].KE[3*t+2])),b[X].push(new A.Lt(e[X].FE[3*t],e[X].FE[3*t+1],e[X].FE[3*t+2]));J=e[X].bE.length,x[X]=[];for(let z=0;z<J;z+=2)x[X][z]=t[X].x+(t[X].z-t[X].x)*e[X].bE[z],x[X][z+1]=t[X].y+(t[X].w-t[X].y)*e[X].bE[z+1],p.d&&(x[X][z+1]=1-x[X][z+1]);if(f=f.concat(x[X]),K=K.concat(e[X].indices.map((E=>E+V))),V+=B[X].length,z)for(let t=0;t<4;t++)F.push(z[X].r,z[X].g,z[X].b,z[X].a)}const r=new A.Lt(0,0,I),i=A.Matrix.RotationY(Math.PI);S=B[0].map((E=>A.Lt.TransformNormal(E,i).add(r))).map((E=>[E.x,E.y,E.z])).reduce(((E,t)=>E.concat(t)),[]),l=b[0].map((E=>A.Lt.TransformNormal(E,i))).map((E=>[E.x,E.y,E.z])).reduce(((E,t)=>E.concat(t)),[]),S=S.concat(B[1].map((E=>E.Wt(r))).map((E=>[E.x,E.y,E.z])).reduce(((E,t)=>E.concat(t)),[])),l=l.concat(b[1].map((E=>[E.x,E.y,E.z])).reduce(((E,t)=>E.concat(t)),[]));const g=new A.Lt(mE,0,0),o=A.Matrix.RotationY(-Math.PI/2);S=S.concat(B[2].map((E=>A.Lt.TransformNormal(E,o).add(g))).map((E=>[E.x,E.y,E.z])).reduce(((E,t)=>E.concat(t)),[])),l=l.concat(b[2].map((E=>A.Lt.TransformNormal(E,o))).map((E=>[E.x,E.y,E.z])).reduce(((E,t)=>E.concat(t)),[]));const Q=A.Matrix.RotationY(Math.PI/2);S=S.concat(B[3].map((E=>A.Lt.TransformNormal(E,Q).Wt(g))).map((E=>[E.x,E.y,E.z])).reduce(((E,t)=>E.concat(t)),[])),l=l.concat(b[3].map((E=>A.Lt.TransformNormal(E,Q))).map((E=>[E.x,E.y,E.z])).reduce(((E,t)=>E.concat(t)),[]));const T=new A.Lt(0,W,0),q=A.Matrix.RotationX(Math.PI/2);S=S.concat(B[4].map((E=>A.Lt.TransformNormal(E,q).add(T))).map((E=>[E.x,E.y,E.z])).reduce(((E,t)=>E.concat(t)),[])),l=l.concat(b[4].map((E=>A.Lt.TransformNormal(E,q))).map((E=>[E.x,E.y,E.z])).reduce(((E,t)=>E.concat(t)),[]));const M=A.Matrix.RotationX(-Math.PI/2);S=S.concat(B[5].map((E=>A.Lt.TransformNormal(E,M).Wt(T))).map((E=>[E.x,E.y,E.z])).reduce(((E,t)=>E.concat(t)),[])),l=l.concat(b[5].map((E=>A.Lt.TransformNormal(E,M))).map((E=>[E.x,E.y,E.z])).reduce(((E,t)=>E.concat(t)),[])),u.c._ComputeSides(L,S,K,l,f);const w=new u.c;if(w.indices=K,w.KE=S,w.FE=l,w.bE=f,z){const E=L===u.c.DOUBLESIDE?F.concat(F):F;w.BE=E}return w}function a(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new X.e(E,z);t.sideOrientation=X.e._GetDefaultSideOrientation(t.sideOrientation),A._originalBuilderSideOrientation=t.sideOrientation;return c(t).JE(A,t.updatable),A}u.c.CreateTiledPlane=y;u.c.CreateTiledBox=c;var L=z(13151),mE=z(12051),W=z(12011);function I(E){const t=E.height||2;let z=0===E.diameterTop?0:E.diameterTop||E.diameter||1,R=0===E.diameterBottom?0:E.diameterBottom||E.diameter||1;z=z||1e-5,R=R||1e-5;const C=0|(E.tessellation||24),Z=0|(E.subdivisions||1),H=!!E.hasRings,h=!!E.enclose,y=0===E.cap?0:E.cap||X.e.CAP_ALL,O=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1,c=0===E.sideOrientation?0:E.sideOrientation||u.c.DEFAULTSIDE,a=E.faceUV||new Array(3),L=E.faceColors,mE=2+(1+(1!==O&&h?2:0))*(H?Z:1);let I;for(I=0;I<mE;I++)L&&void 0===L[I]&&(L[I]=new d.Lp(1,1,1,1));for(I=0;I<mE;I++)a&&void 0===a[I]&&(a[I]=new A.Vector4(0,0,1,1));const e=[],D=[],S=[],l=[],f=[],K=2*Math.PI*O/C;let F,B,b;const x=(R-z)/2/t,J=A.Lt.Zero(),V=A.Lt.Zero(),r=A.Lt.Zero(),i=A.Lt.Zero(),g=A.Lt.Zero(),o=W.b.Y;let Q,T,q,M=1,w=1,n=0,s=0;for(Q=0;Q<=Z;Q++)for(B=Q/Z,b=(B*(z-R)+R)/2,M=H&&0!==Q&&Q!==Z?2:1,q=0;q<M;q++){for(H&&(w+=q),h&&(w+=2*q),T=0;T<=C;T++)F=T*K,J.x=Math.cos(-F)*b,J.y=-t/2+B*t,J.z=Math.sin(-F)*b,0===z&&Q===Z?(V.x=S[S.length-3*(C+1)],V.y=S[S.length-3*(C+1)+1],V.z=S[S.length-3*(C+1)+2]):(V.x=J.x,V.z=J.z,V.y=Math.sqrt(V.x*V.x+V.z*V.z)*x,V.normalize()),0===T&&(r.R(J),i.R(V)),D.push(J.x,J.y,J.z),S.push(V.x,V.y,V.z),s=H?n!==w?a[w].y:a[w].w:a[w].y+(a[w].w-a[w].y)*B,l.push(a[w].x+(a[w].z-a[w].x)*T/C,p.d?1-s:s),L&&f.push(L[w].r,L[w].g,L[w].b,L[w].a);1!==O&&h&&(D.push(J.x,J.y,J.z),D.push(0,J.y,0),D.push(0,J.y,0),D.push(r.x,r.y,r.z),A.Lt.CrossToRef(o,V,g),g.normalize(),S.push(g.x,g.y,g.z,g.x,g.y,g.z),A.Lt.CrossToRef(i,o,g),g.normalize(),S.push(g.x,g.y,g.z,g.x,g.y,g.z),s=H?n!==w?a[w+1].y:a[w+1].w:a[w+1].y+(a[w+1].w-a[w+1].y)*B,l.push(a[w+1].x,p.d?1-s:s),l.push(a[w+1].z,p.d?1-s:s),s=H?n!==w?a[w+2].y:a[w+2].w:a[w+2].y+(a[w+2].w-a[w+2].y)*B,l.push(a[w+2].x,p.d?1-s:s),l.push(a[w+2].z,p.d?1-s:s),L&&(f.push(L[w+1].r,L[w+1].g,L[w+1].b,L[w+1].a),f.push(L[w+1].r,L[w+1].g,L[w+1].b,L[w+1].a),f.push(L[w+2].r,L[w+2].g,L[w+2].b,L[w+2].a),f.push(L[w+2].r,L[w+2].g,L[w+2].b,L[w+2].a))),n!==w&&(n=w)}const j=1!==O&&h?C+4:C;for(Q=0,w=0;w<Z;w++){let E=0,t=0,z=0,A=0;for(T=0;T<C;T++)E=Q*(j+1)+T,t=(Q+1)*(j+1)+T,z=Q*(j+1)+(T+1),A=(Q+1)*(j+1)+(T+1),e.push(E,t,z),e.push(A,z,t);1!==O&&h&&(e.push(E+2,t+2,z+2),e.push(A+2,z+2,t+2),e.push(E+4,t+4,z+4),e.push(A+4,z+4,t+4)),Q=H?Q+2:Q+1}const U=E=>{const X=E?z/2:R/2;if(0===X)return;let u,Z,H;const h=E?a[mE-1]:a[0];let d=null;L&&(d=E?L[mE-1]:L[0]);const y=D.length/3,c=E?t/2:-t/2,W=new A.Lt(0,c,0);D.push(W.x,W.y,W.z),S.push(0,E?1:-1,0);const I=h.y+.5*(h.w-h.y);l.push(h.x+.5*(h.z-h.x),p.d?1-I:I),d&&f.push(d.r,d.g,d.b,d.a);const K=new A.Vector2(.5,.5);for(H=0;H<=C;H++){u=2*Math.PI*H*O/C;const t=Math.cos(-u),z=Math.sin(-u);Z=new A.Lt(t*X,c,z*X);const R=new A.Vector2(t*K.x+.5,z*K.y+.5);D.push(Z.x,Z.y,Z.z),S.push(0,E?1:-1,0);const y=h.y+(h.w-h.y)*R.y;l.push(h.x+(h.z-h.x)*R.x,p.d?1-y:y),d&&f.push(d.r,d.g,d.b,d.a)}for(H=0;H<C;H++)E?(e.push(y),e.push(y+(H+2)),e.push(y+(H+1))):(e.push(y),e.push(y+(H+1)),e.push(y+(H+2)))};y!==X.e.CAP_START&&y!==X.e.CAP_ALL||U(!1),y!==X.e.CAP_END&&y!==X.e.CAP_ALL||U(!0),u.c._ComputeSides(c,D,e,S,l,E.frontUVs,E.backUVs);const k=new u.c;return k.indices=e,k.KE=D,k.FE=S,k.bE=l,L&&(k.BE=f),k}function e(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},z=arguments.length>2?arguments[2]:void 0;const A=new X.e(E,z);t.sideOrientation=X.e._GetDefaultSideOrientation(t.sideOrientation),A._originalBuilderSideOrientation=t.sideOrientation;return I(t).JE(A,t.updatable),A}function D(E){const t=[],z=[],X=[],R=[],C=E.diameter||1,Z=E.thickness||.5,H=0|(E.tessellation||16),h=0===E.sideOrientation?0:E.sideOrientation||u.c.DEFAULTSIDE,d=H+1;for(let u=0;u<=H;u++){const E=u/H,h=u*Math.PI*2/H-Math.PI/2,y=A.Matrix.Translation(C/2,0,0).multiply(A.Matrix.RotationY(h));for(let C=0;C<=H;C++){const h=1-C/H,O=C*Math.PI*2/H+Math.PI,c=Math.cos(O),a=Math.sin(O);let L=new A.Lt(c,a,0),mE=L.scale(Z/2);const W=new A.Vector2(E,h);mE=A.Lt.TransformCoordinates(mE,y),L=A.Lt.TransformNormal(L,y),z.push(mE.x,mE.y,mE.z),X.push(L.x,L.y,L.z),R.push(W.x,p.d?1-W.y:W.y);const I=(u+1)%d,e=(C+1)%d;t.push(u*d+C),t.push(u*d+e),t.push(I*d+C),t.push(u*d+e),t.push(I*d+e),t.push(I*d+C)}}u.c._ComputeSides(h,z,t,X,R,E.frontUVs,E.backUVs);const y=new u.c;return y.indices=t,y.KE=z,y.FE=X,y.bE=R,y}function S(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},z=arguments.length>2?arguments[2]:void 0;const A=new X.e(E,z);t.sideOrientation=X.e._GetDefaultSideOrientation(t.sideOrientation),A._originalBuilderSideOrientation=t.sideOrientation;return D(t).JE(A,t.updatable),A}u.c.CreateCylinder=I,X.e.CreateCylinder=(E,t,z,A,R,u,p,C,Z)=>{void 0!==p&&p instanceof mE.c||(void 0!==p&&(Z=C||X.e.DEFAULTSIDE,C=p),p=u,u=1);return e(E,{height:t,diameterTop:z,diameterBottom:A,tessellation:R,subdivisions:u,sideOrientation:Z,updatable:C},p)};function l(E){const t=[],z=[],X=[],R=[],C=E.radius||2,Z=E.tube||.5,H=E.radialSegments||32,h=E.tubularSegments||32,d=E.p||2,y=E.q||3,O=0===E.sideOrientation?0:E.sideOrientation||u.c.DEFAULTSIDE,c=E=>{const t=Math.cos(E),z=Math.sin(E),X=y/d*E,R=Math.cos(X),u=C*(2+R)*.5*t,p=C*(2+R)*z*.5,Z=C*Math.sin(X)*.5;return new A.Lt(u,p,Z)};let a,L;for(a=0;a<=H;a++){const E=a%H/H*2*d*Math.PI,t=c(E),X=c(E+.01),u=X.Wt(t);let C=X.add(t);const y=A.Lt.Cross(u,C);for(C=A.Lt.Cross(y,u),y.normalize(),C.normalize(),L=0;L<h;L++){const E=L%h/h*2*Math.PI,A=-Z*Math.cos(E),X=Z*Math.sin(E);z.push(t.x+A*C.x+X*y.x),z.push(t.y+A*C.y+X*y.y),z.push(t.z+A*C.z+X*y.z),R.push(a/H),R.push(p.d?1-L/h:L/h)}}for(a=0;a<H;a++)for(L=0;L<h;L++){const E=(L+1)%h,z=a*h+L,A=(a+1)*h+L,X=(a+1)*h+E,R=a*h+E;t.push(R),t.push(A),t.push(z),t.push(R),t.push(X),t.push(A)}u.c.ComputeNormals(z,t,X),u.c._ComputeSides(O,z,t,X,R,E.frontUVs,E.backUVs);const mE=new u.c;return mE.indices=t,mE.KE=z,mE.FE=X,mE.bE=R,mE}function f(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},z=arguments.length>2?arguments[2]:void 0;const A=new X.e(E,z);t.sideOrientation=X.e._GetDefaultSideOrientation(t.sideOrientation),A._originalBuilderSideOrientation=t.sideOrientation;return l(t).JE(A,t.updatable),A}u.c.CreateTorus=D,X.e.CreateTorus=(E,t,z,A,X,R,u)=>S(E,{diameter:t,thickness:z,tessellation:A,sideOrientation:u,updatable:R},X);u.c.CreateTorusKnot=l,X.e.CreateTorusKnot=(E,t,z,A,X,R,u,p,C,Z)=>f(E,{radius:t,tube:z,radialSegments:A,tubularSegments:X,p:R,q:u,sideOrientation:Z,updatable:C},p);var K=z(13657),F=z(12384),B=z(12028);function b(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=t.path,R=t.shape,u=t.scale||1,p=t.rotation||0,C=0===t.cap?0:t.cap||X.e.NO_CAP,Z=t.updatable,H=X.e._GetDefaultSideOrientation(t.sideOrientation),h=t.instance||null,d=t.invertUV||!1,y=t.closeShape||!1,O=t.closePath||!1,c=t.capFunction||null;return J(E,R,A,u,p,null,null,O,y,C,!1,z,!!Z,H,h,d,t.frontUVs||null,t.backUVs||null,t.firstNormal||null,!!t.adjustFrame,c)}function x(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=t.path,R=t.shape,u=t.scaleFunction||(()=>1),p=t.rotationFunction||(()=>0),C=t.closePath||t.ribbonCloseArray||!1,Z=t.closeShape||t.ribbonClosePath||!1,H=0===t.cap?0:t.cap||X.e.NO_CAP,h=t.updatable,d=t.firstNormal||null,y=t.adjustFrame||!1,O=X.e._GetDefaultSideOrientation(t.sideOrientation),c=t.instance,a=t.invertUV||!1,L=t.capFunction||null;return J(E,R,A,null,null,u,p,C,Z,H,!0,z,!!h,O,c||null,a,t.frontUVs||null,t.backUVs||null,d,y,L||null)}function J(E,t,z,R,u,p,C,H,h,d,y,O,c,a,L,mE,W,I,e,D,S){const l=(E,t,z,R,u,p,C,Z,H,h,d)=>{const y=z.getTangents(),O=z.getNormals(),c=z.getBinormals(),a=z.getDistances();if(d)for(let X=0;X<y.length;X++)if(0==y[X].x&&0==y[X].y&&0==y[X].z&&y[X].R(y[X-1]),0==O[X].x&&0==O[X].y&&0==O[X].z&&O[X].R(O[X-1]),0==c[X].x&&0==c[X].y&&0==c[X].z&&c[X].R(c[X-1]),X>0){let E=y[X-1];A.Lt.Dot(E,y[X])<0&&y[X].scaleInPlace(-1),E=O[X-1],A.Lt.Dot(E,O[X])<0&&O[X].scaleInPlace(-1),E=c[X-1],A.Lt.Dot(E,c[X])<0&&c[X].scaleInPlace(-1)}let L=0;const mE=h&&Z?Z:()=>null!==p?p:0,W=h&&C?C:()=>null!==u?u:1;let I=H===X.e.NO_CAP||H===X.e.CAP_END?0:2;const e=A.TmpVectors.Matrix[0];for(let X=0;X<t.length;X++){const z=[],u=mE(X,a[X]),p=W(X,a[X]);A.Matrix.RotationAxisToRef(y[X],L,e);for(let R=0;R<E.length;R++){const u=y[X].scale(E[R].z).add(O[X].scale(E[R].x)).add(c[X].scale(E[R].y)),C=A.Lt.Zero();A.Lt.TransformCoordinatesToRef(u,e,C),C.scaleInPlace(p).addInPlace(t[X]),z[R]=C}R[I]=z,L+=u,I++}const D=S||(E=>{const t=Array(),z=A.Lt.Zero();let X;for(X=0;X<E.length;X++)z.addInPlace(E[X]);for(z.scaleInPlace(1/E.length),X=0;X<E.length;X++)t.push(z);return t});switch(H){case X.e.NO_CAP:break;case X.e.CAP_START:R[0]=D(R[2]),R[1]=R[2];break;case X.e.CAP_END:R[I]=R[I-1],R[I+1]=D(R[I-1]);break;case X.e.CAP_ALL:R[0]=D(R[2]),R[1]=R[2],R[I]=R[I-1],R[I+1]=D(R[I-1])}return R};let f,K;if(L){const E=L._creationDataStorage;return f=e?E.path3D.update(z,e):E.path3D.update(z),K=l(t,z,E.path3D,E.pathArray,R,u,p,C,E.cap,y,D),L=Z("",{pathArray:K,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:L},O||void 0)}f=e?new B.g(z,e):new B.g(z);K=l(t,z,f,new Array,R,u,p,C,d=d<0||d>3?0:d,y,D);const F=Z(E,{pathArray:K,closeArray:H,closePath:h,updatable:c,sideOrientation:a,invertUV:mE,frontUVs:W||void 0,backUVs:I||void 0},O);return F._creationDataStorage.pathArray=K,F._creationDataStorage.path3D=f,F._creationDataStorage.cap=d,F}function V(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=t.arc?t.arc<=0||t.arc>1?1:t.arc:1,u=void 0===t.closed||t.closed,p=t.shape,C=t.radius||1,H=t.tessellation||64,h=t.clip||0,d=t.updatable,y=X.e._GetDefaultSideOrientation(t.sideOrientation),O=t.cap||X.e.NO_CAP,c=2*Math.PI,a=[],L=t.invertUV||!1;let mE=0,W=0;const I=c/H*R;let e,D;for(mE=0;mE<=H-h;mE++){for(D=[],O!=X.e.CAP_START&&O!=X.e.CAP_ALL||(D.push(new A.Lt(0,p[0].y,0)),D.push(new A.Lt(Math.cos(mE*I)*p[0].x*C,p[0].y,Math.sin(mE*I)*p[0].x*C))),W=0;W<p.length;W++)e=new A.Lt(Math.cos(mE*I)*p[W].x*C,p[W].y,Math.sin(mE*I)*p[W].x*C),D.push(e);O!=X.e.CAP_END&&O!=X.e.CAP_ALL||(D.push(new A.Lt(Math.cos(mE*I)*p[p.length-1].x*C,p[p.length-1].y,Math.sin(mE*I)*p[p.length-1].x*C)),D.push(new A.Lt(0,p[p.length-1].y,0))),a.push(D)}return Z(E,{pathArray:a,closeArray:u,sideOrientation:y,updatable:d,invertUV:L,frontUVs:t.frontUVs,backUVs:t.backUVs},z)}X.e.ExtrudeShape=function(E,t,z,A,R,u){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0,Z=arguments.length>8?arguments[8]:void 0,H=arguments.length>9?arguments[9]:void 0;return b(E,{shape:t,path:z,scale:A,rotation:R,cap:0===u?0:u||X.e.NO_CAP,sideOrientation:Z,instance:H,updatable:C},p)},X.e.ExtrudeShapeCustom=(E,t,z,A,R,u,p,C,Z,H,h,d)=>x(E,{shape:t,path:z,scaleFunction:A,rotationFunction:R,ribbonCloseArray:u,ribbonClosePath:p,cap:0===C?0:C||X.e.NO_CAP,sideOrientation:h,instance:d,updatable:H},Z);X.e.CreateLathe=(E,t,z,A,X,R,u)=>V(E,{shape:t,radius:z,tessellation:A,sideOrientation:u,updatable:R},X);var r=z(13062),i=z(13019);function g(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=t.path;let u=t.instance,p=1;void 0!==t.radius?p=t.radius:u&&(p=u._creationDataStorage.radius);const C=t.tessellation||64,H=t.radiusFunction||null;let h=t.cap||X.e.NO_CAP;const d=t.invertUV||!1,y=t.updatable,O=X.e._GetDefaultSideOrientation(t.sideOrientation);t.arc=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1;const c=(E,t,z,R,u,p,C,Z)=>{const H=t.getTangents(),h=t.getNormals(),d=t.getDistances(),y=2*Math.PI/u*Z,O=p||(()=>R);let c,a,L,mE;const W=A.TmpVectors.Matrix[0];let I=C===X.e.NO_CAP||C===X.e.CAP_END?0:2;for(let X=0;X<E.length;X++){a=O(X,d[X]),c=Array(),L=h[X];for(let t=0;t<u;t++)A.Matrix.RotationAxisToRef(H[X],y*t,W),mE=c[t]?c[t]:A.Lt.Zero(),A.Lt.TransformCoordinatesToRef(L,W,mE),mE.scaleInPlace(a).addInPlace(E[X]),c[t]=mE;z[I]=c,I++}const e=(t,z)=>{const A=Array();for(let X=0;X<t;X++)A.push(E[z]);return A};switch(C){case X.e.NO_CAP:break;case X.e.CAP_START:z[0]=e(u,0),z[1]=z[2].slice(0);break;case X.e.CAP_END:z[I]=z[I-1].slice(0),z[I+1]=e(u,E.length-1);break;case X.e.CAP_ALL:z[0]=e(u,0),z[1]=z[2].slice(0),z[I]=z[I-1].slice(0),z[I+1]=e(u,E.length-1)}return z};let a,L;if(u){const E=u._creationDataStorage,z=t.arc||E.arc;return a=E.path3D.update(R),L=c(R,a,E.pathArray,p,E.tessellation,H,E.cap,z),u=Z("",{pathArray:L,instance:u}),E.path3D=a,E.pathArray=L,E.arc=z,E.radius=p,u}a=new B.g(R);h=h<0||h>3?0:h,L=c(R,a,new Array,p,C,H,h,t.arc);const mE=Z(E,{pathArray:L,closePath:!0,closeArray:!1,updatable:y,sideOrientation:O,invertUV:d,frontUVs:t.frontUVs,backUVs:t.backUVs},z);return mE._creationDataStorage.pathArray=L,mE._creationDataStorage.path3D=a,mE._creationDataStorage.tessellation=C,mE._creationDataStorage.cap=h,mE._creationDataStorage.arc=t.arc,mE._creationDataStorage.radius=p,mE}function o(E){const t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const z=E.type&&(E.type<0||E.type>=t.length)?0:E.type||0,X=E.size,R=E.sizeX||X||1,C=E.sizeY||X||1,Z=E.sizeZ||X||1,H=E.custom||t[z],h=H.face.length,y=E.faceUV||new Array(h),O=E.faceColors,c=void 0===E.flat||E.flat,a=0===E.sideOrientation?0:E.sideOrientation||u.c.DEFAULTSIDE,L=[],mE=[],W=[],I=[],e=[];let D=0,S=0;const l=[];let f,K,F,B,b,x,J=0,V=0;if(c)for(V=0;V<h;V++)O&&void 0===O[V]&&(O[V]=new d.Lp(1,1,1,1)),y&&void 0===y[V]&&(y[V]=new A.Vector4(0,0,1,1));if(c)for(V=0;V<h;V++){const E=H.face[V].length;for(F=2*Math.PI/E,B=.5*Math.tan(F/2),b=.5,J=0;J<E;J++)L.push(H.vertex[H.face[V][J]][0]*R,H.vertex[H.face[V][J]][1]*C,H.vertex[H.face[V][J]][2]*Z),l.push(D),D++,f=y[V].x+(y[V].z-y[V].x)*(.5+B),K=y[V].y+(y[V].w-y[V].y)*(b-.5),I.push(f,p.d?1-K:K),x=B*Math.cos(F)-b*Math.sin(F),b=B*Math.sin(F)+b*Math.cos(F),B=x,O&&e.push(O[V].r,O[V].g,O[V].b,O[V].a);for(J=0;J<E-2;J++)mE.push(l[0+S],l[J+2+S],l[J+1+S]);S+=E}else{for(J=0;J<H.vertex.length;J++)L.push(H.vertex[J][0]*R,H.vertex[J][1]*C,H.vertex[J][2]*Z),I.push(0,p.d?1:0);for(V=0;V<h;V++)for(J=0;J<H.face[V].length-2;J++)mE.push(H.face[V][0],H.face[V][J+2],H.face[V][J+1])}u.c.ComputeNormals(L,mE,W),u.c._ComputeSides(a,L,mE,W,I,E.frontUVs,E.backUVs);const r=new u.c;return r.KE=L,r.indices=mE,r.FE=W,r.bE=I,O&&c&&(r.BE=e),r}function Q(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new X.e(E,z);t.sideOrientation=X.e._GetDefaultSideOrientation(t.sideOrientation),A._originalBuilderSideOrientation=t.sideOrientation;return o(t).JE(A,t.updatable),A}X.e.CreateTube=(E,t,z,A,X,R,u,p,C,Z)=>g(E,{path:t,radius:z,tessellation:A,radiusFunction:X,arc:1,cap:R,updatable:p,sideOrientation:C,instance:Z},u);function T(E){const t=E.sideOrientation||u.c.DEFAULTSIDE,z=E.radius||1,X=void 0===E.flat||E.flat,R=0|(E.subdivisions||4),C=E.radiusX||z,Z=E.radiusY||z,H=E.radiusZ||z,h=(1+Math.sqrt(5))/2,d=[-1,h,-0,1,h,0,-1,-h,0,1,-h,0,0,-1,-h,0,1,-h,0,-1,h,0,1,h,h,0,1,h,0,-1,-h,0,1,-h,0,-1],y=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],O=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],c=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],a=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],L=[],mE=[],W=[],I=[];let e=0;const D=new Array(3),S=new Array(3);let l;for(l=0;l<3;l++)D[l]=A.Lt.Zero(),S[l]=A.Vector2.Zero();for(let u=0;u<20;u++){for(l=0;l<3;l++){const E=y[3*u+l];D[l].Op(d[3*O[E]],d[3*O[E]+1],d[3*O[E]+2]),D[l].normalize(),S[l].Op(.134765625*c[2*E]+.05859375+-.0390625*a[u],.2333984375*c[2*E+1]+.025390625+.01953125*a[u])}const E=(E,t,z,u)=>{const h=A.Lt.Lerp(D[0],D[2],t/R),d=A.Lt.Lerp(D[1],D[2],t/R),y=R===t?D[2]:A.Lt.Lerp(h,d,E/(R-t));let O;if(y.normalize(),X){const E=A.Lt.Lerp(D[0],D[2],u/R),t=A.Lt.Lerp(D[1],D[2],u/R);O=A.Lt.Lerp(E,t,z/(R-u))}else O=new A.Lt(y.x,y.y,y.z);O.x/=C,O.y/=Z,O.z/=H,O.normalize();const c=A.Vector2.Lerp(S[0],S[2],t/R),a=A.Vector2.Lerp(S[1],S[2],t/R),l=R===t?S[2]:A.Vector2.Lerp(c,a,E/(R-t));mE.push(y.x*C,y.y*Z,y.z*H),W.push(O.x,O.y,O.z),I.push(l.x,p.d?1-l.y:l.y),L.push(e),e++};for(let t=0;t<R;t++)for(let z=0;z+t<R;z++)E(z,t,z+1/3,t+1/3),E(z+1,t,z+1/3,t+1/3),E(z,t+1,z+1/3,t+1/3),z+t+1<R&&(E(z+1,t,z+2/3,t+2/3),E(z+1,t+1,z+2/3,t+2/3),E(z,t+1,z+2/3,t+2/3))}u.c._ComputeSides(t,mE,L,W,I,E.frontUVs,E.backUVs);const f=new u.c;return f.indices=L,f.KE=mE,f.FE=W,f.bE=I,f}function q(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new X.e(E,z);t.sideOrientation=X.e._GetDefaultSideOrientation(t.sideOrientation),A._originalBuilderSideOrientation=t.sideOrientation;return T(t).JE(A,t.updatable),A}u.c.CreatePolyhedron=o,X.e.CreatePolyhedron=(E,t,z)=>Q(E,t,z);u.c.CreateIcoSphere=T,X.e.CreateIcoSphere=(E,t,z)=>q(E,t,z);var M=z(11834);const w=new A.Lt(1,0,0),n=new A.Lt(-1,0,0),s=new A.Lt(0,1,0),j=new A.Lt(0,-1,0),U=new A.Lt(0,0,1),k=new A.Lt(0,0,-1);class v{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.Lt.Zero(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.Lt.Up(),z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.Vector2.Zero(),X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=E,this.normal=t,this.uv=z,this.vertexIdx=X,this.vertexIdxForBones=R,this.localPositionOverride=u,this.localNormalOverride=p,this.matrixIndicesOverride=C,this.matrixWeightsOverride=Z}clone(){var E,t,z,A;return new v(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(E=this.localPositionOverride)||void 0===E?void 0:E.slice(),null===(t=this.localNormalOverride)||void 0===t?void 0:t.slice(),null===(z=this.matrixIndicesOverride)||void 0===z?void 0:z.slice(),null===(A=this.matrixWeightsOverride)||void 0===A?void 0:A.slice())}}function Y(E,t,z){var C,Z,H,h,d;const y=!!t.skeleton,O=!(null===(C=t.morphTargetManager)||void 0===C||!C.numTargets),c=z.localMode||y,a=t.dp(),L=y||O?t.bp(!0,!0):t.getVerticesData(R.f.PositionKind),mE=y||O?t.getNormalsData(!0,!0):t.getVerticesData(R.f.NormalKind),W=c?y?t.getVerticesData(R.f.PositionKind):L:null,I=c?y?t.getVerticesData(R.f.NormalKind):mE:null,e=t.getVerticesData(R.f.UVKind),D=y?t.getVerticesData(R.f.MatricesIndicesKind):null,S=y?t.getVerticesData(R.f.MatricesWeightsKind):null,l=y?t.getVerticesData(R.f.MatricesIndicesExtraKind):null,f=y?t.getVerticesData(R.f.MatricesWeightsExtraKind):null,K=z.position||A.Lt.Zero();let F=z.normal||A.Lt.Up();const B=z.size||A.Lt.One(),b=z.angle||0;if(!F){const E=new A.Lt(0,0,1),z=t.lE().activeCamera,X=A.Lt.TransformCoordinates(E,z.getWorldMatrix());F=z.globalPosition.Wt(X)}const x=-Math.atan2(F.z,F.x)-Math.PI/2,J=Math.sqrt(F.x*F.x+F.z*F.z),V=Math.atan2(F.y,J),r=new u.c;r.indices=[],r.KE=[],r.FE=[],r.bE=[],r.matricesIndices=y?[]:null,r.matricesWeights=y?[]:null,r.matricesIndicesExtra=l?[]:null,r.matricesWeightsExtra=f?[]:null;let i=0;const g=(E,t)=>{const X=new v;if(!a||!L||!mE)return X;const R=a[E];if(X.vertexIdx=3*R,X.vertexIdxForBones=4*R,X.position=new A.Lt(L[3*R],L[3*R+1],L[3*R+2]),A.Lt.TransformCoordinatesToRef(X.position,t,X.position),X.normal=new A.Lt(mE[3*R],mE[3*R+1],mE[3*R+2]),A.Lt.TransformNormalToRef(X.normal,t,X.normal),z.captureUVS&&e){const E=e[2*R+1];X.uv=new A.Vector2(e[2*R],p.d?1-E:E)}return X},o=[0,0,0,0],Q=(E,t)=>{if(0===E.length)return E;const z=.5*Math.abs(A.Lt.Dot(B,t)),X=(E,t,z,A)=>{for(let X=0;X<A;++X)if(E[z+X]===t)return z+X;return-1},R=(E,R)=>{const u=A.Lt.GetClipFactor(E.position,R.position,t,z);let p=o,C=o;if(D&&S){const t=E.matrixIndicesOverride?0:E.vertexIdxForBones,z=E.matrixIndicesOverride??D,A=E.matrixWeightsOverride??S,Z=R.matrixIndicesOverride?0:R.vertexIdxForBones,H=R.matrixIndicesOverride??D,h=R.matrixWeightsOverride??S;p=[0,0,0,0],C=[0,0,0,0];let d=0;for(let E=0;E<4;++E)if(A[t+E]>0){const R=X(H,z[t+E],Z,4);p[d]=z[t+E],C[d]=(0,M.Lerp)(A[t+E],R>=0?h[R]:0,u),d++}for(let E=0;E<4&&d<4;++E){const A=H[Z+E];-1===X(z,A,t,4)&&(p[d]=A,C[d]=(0,M.Lerp)(0,h[Z+E],u),d++)}const y=C[0]+C[1]+C[2]+C[3];C[0]/=y,C[1]/=y,C[2]/=y,C[3]/=y}const Z=E.localPositionOverride?E.localPositionOverride[0]:(null===W||void 0===W?void 0:W[E.vertexIdx])??0,H=E.localPositionOverride?E.localPositionOverride[1]:(null===W||void 0===W?void 0:W[E.vertexIdx+1])??0,h=E.localPositionOverride?E.localPositionOverride[2]:(null===W||void 0===W?void 0:W[E.vertexIdx+2])??0,d=R.localPositionOverride?R.localPositionOverride[0]:(null===W||void 0===W?void 0:W[R.vertexIdx])??0,y=R.localPositionOverride?R.localPositionOverride[1]:(null===W||void 0===W?void 0:W[R.vertexIdx+1])??0,O=R.localPositionOverride?R.localPositionOverride[2]:(null===W||void 0===W?void 0:W[R.vertexIdx+2])??0,c=E.localNormalOverride?E.localNormalOverride[0]:(null===I||void 0===I?void 0:I[E.vertexIdx])??0,a=E.localNormalOverride?E.localNormalOverride[1]:(null===I||void 0===I?void 0:I[E.vertexIdx+1])??0,L=E.localNormalOverride?E.localNormalOverride[2]:(null===I||void 0===I?void 0:I[E.vertexIdx+2])??0,mE=c+((R.localNormalOverride?R.localNormalOverride[0]:(null===I||void 0===I?void 0:I[R.vertexIdx])??0)-c)*u,e=a+((R.localNormalOverride?R.localNormalOverride[1]:(null===I||void 0===I?void 0:I[R.vertexIdx+1])??0)-a)*u,l=L+((R.localNormalOverride?R.localNormalOverride[2]:(null===I||void 0===I?void 0:I[R.vertexIdx+2])??0)-L)*u,f=Math.sqrt(mE*mE+e*e+l*l);return new v(A.Lt.Lerp(E.position,R.position,u),A.Lt.Lerp(E.normal,R.normal,u).normalize(),A.Vector2.Lerp(E.uv,R.uv,u),-1,-1,W?[Z+(d-Z)*u,H+(y-H)*u,h+(O-h)*u]:null,I?[mE/f,e/f,l/f]:null,p,C)};let u=null;E.length>3&&(u=[]);for(let p=0;p<E.length;p+=3){let X=0,C=null,Z=null,H=null,h=null;const d=A.Lt.Dot(E[p].position,t)-z>0,y=A.Lt.Dot(E[p+1].position,t)-z>0,O=A.Lt.Dot(E[p+2].position,t)-z>0;switch(X=(d?1:0)+(y?1:0)+(O?1:0),X){case 0:E.length>3?(u.push(E[p]),u.push(E[p+1]),u.push(E[p+2])):u=E;break;case 1:if(u=u??new Array,d&&(C=E[p+1],Z=E[p+2],H=R(E[p],C),h=R(E[p],Z)),y){C=E[p],Z=E[p+2],H=R(E[p+1],C),h=R(E[p+1],Z),u.push(H),u.push(Z.clone()),u.push(C.clone()),u.push(Z.clone()),u.push(H.clone()),u.push(h);break}O&&(C=E[p],Z=E[p+1],H=R(E[p+2],C),h=R(E[p+2],Z)),C&&Z&&H&&h&&(u.push(C.clone()),u.push(Z.clone()),u.push(H),u.push(h),u.push(H.clone()),u.push(Z.clone()));break;case 2:u=u??new Array,d||(C=E[p].clone(),Z=R(C,E[p+1]),H=R(C,E[p+2]),u.push(C),u.push(Z),u.push(H)),y||(C=E[p+1].clone(),Z=R(C,E[p+2]),H=R(C,E[p]),u.push(C),u.push(Z),u.push(H)),O||(C=E[p+2].clone(),Z=R(C,E[p]),H=R(C,E[p+1]),u.push(C),u.push(Z),u.push(H))}}return u},T=t instanceof X.e?t:null,q=null===T||void 0===T?void 0:T._thinInstanceDataStorage.matrixData,Y=(null===T||void 0===T?void 0:T.Wp)||1,G=A.TmpVectors.Matrix[0];G.R(A.Matrix.IdentityReadOnly);for(let X=0;X<Y;++X){if(null!==T&&void 0!==T&&T.hasThinInstances&&q){const E=16*X;G.setRowFromFloats(0,q[E+0],q[E+1],q[E+2],q[E+3]),G.setRowFromFloats(1,q[E+4],q[E+5],q[E+6],q[E+7]),G.setRowFromFloats(2,q[E+8],q[E+9],q[E+10],q[E+11]),G.setRowFromFloats(3,q[E+12],q[E+13],q[E+14],q[E+15])}const E=A.Matrix.RotationYawPitchRoll(x,V,b).multiply(A.Matrix.Translation(K.x,K.y,K.z)),R=A.Matrix.Invert(E),u=t.getWorldMatrix(),C=G.multiply(u).multiply(R),Z=new Array(3);for(let t=0;t<a.length;t+=3){let E=Z;if(E[0]=g(t,C),E[1]=g(t+1,C),E[2]=g(t+2,C),!(z.cullBackFaces&&-E[0].normal.z<=0&&-E[1].normal.z<=0&&-E[2].normal.z<=0)&&(E=Q(E,w),E&&(E=Q(E,n),E&&(E=Q(E,s),E&&(E=Q(E,j),E&&(E=Q(E,U),E&&(E=Q(E,k),E)))))))for(let t=0;t<E.length;t++){const A=E[t];if(r.indices.push(i),c?(A.localPositionOverride?(r.KE[3*i]=A.localPositionOverride[0],r.KE[3*i+1]=A.localPositionOverride[1],r.KE[3*i+2]=A.localPositionOverride[2]):W&&(r.KE[3*i]=W[A.vertexIdx],r.KE[3*i+1]=W[A.vertexIdx+1],r.KE[3*i+2]=W[A.vertexIdx+2]),A.localNormalOverride?(r.FE[3*i]=A.localNormalOverride[0],r.FE[3*i+1]=A.localNormalOverride[1],r.FE[3*i+2]=A.localNormalOverride[2]):I&&(r.FE[3*i]=I[A.vertexIdx],r.FE[3*i+1]=I[A.vertexIdx+1],r.FE[3*i+2]=I[A.vertexIdx+2])):(A.position.toArray(r.KE,3*i),A.normal.toArray(r.FE,3*i)),r.matricesIndices&&r.matricesWeights&&(A.matrixIndicesOverride?(r.matricesIndices[4*i]=A.matrixIndicesOverride[0],r.matricesIndices[4*i+1]=A.matrixIndicesOverride[1],r.matricesIndices[4*i+2]=A.matrixIndicesOverride[2],r.matricesIndices[4*i+3]=A.matrixIndicesOverride[3]):(D&&(r.matricesIndices[4*i]=D[A.vertexIdxForBones],r.matricesIndices[4*i+1]=D[A.vertexIdxForBones+1],r.matricesIndices[4*i+2]=D[A.vertexIdxForBones+2],r.matricesIndices[4*i+3]=D[A.vertexIdxForBones+3]),l&&r.matricesIndicesExtra&&(r.matricesIndicesExtra[4*i]=l[A.vertexIdxForBones],r.matricesIndicesExtra[4*i+1]=l[A.vertexIdxForBones+1],r.matricesIndicesExtra[4*i+2]=l[A.vertexIdxForBones+2],r.matricesIndicesExtra[4*i+3]=l[A.vertexIdxForBones+3])),A.matrixWeightsOverride?(r.matricesWeights[4*i]=A.matrixWeightsOverride[0],r.matricesWeights[4*i+1]=A.matrixWeightsOverride[1],r.matricesWeights[4*i+2]=A.matrixWeightsOverride[2],r.matricesWeights[4*i+3]=A.matrixWeightsOverride[3]):(S&&(r.matricesWeights[4*i]=S[A.vertexIdxForBones],r.matricesWeights[4*i+1]=S[A.vertexIdxForBones+1],r.matricesWeights[4*i+2]=S[A.vertexIdxForBones+2],r.matricesWeights[4*i+3]=S[A.vertexIdxForBones+3]),f&&r.matricesWeightsExtra&&(r.matricesWeightsExtra[4*i]=f[A.vertexIdxForBones],r.matricesWeightsExtra[4*i+1]=f[A.vertexIdxForBones+1],r.matricesWeightsExtra[4*i+2]=f[A.vertexIdxForBones+2],r.matricesWeightsExtra[4*i+3]=f[A.vertexIdxForBones+3]))),z.captureUVS)A.uv.toArray(r.bE,2*i);else{r.bE.push(.5+A.position.x/B.x);const E=.5+A.position.y/B.y;r.bE.push(p.d?1-E:E)}i++}}}0===r.indices.length&&(r.indices=null),0===r.KE.length&&(r.KE=null),0===r.FE.length&&(r.FE=null),0===r.bE.length&&(r.bE=null),0===(null===(Z=r.matricesIndices)||void 0===Z?void 0:Z.length)&&(r.matricesIndices=null),0===(null===(H=r.matricesWeights)||void 0===H?void 0:H.length)&&(r.matricesWeights=null),0===(null===(h=r.matricesIndicesExtra)||void 0===h?void 0:h.length)&&(r.matricesIndicesExtra=null),0===(null===(d=r.matricesWeightsExtra)||void 0===d?void 0:d.length)&&(r.matricesWeightsExtra=null);const N=new X.e(E,t.lE());return r.JE(N),c?(N.skeleton=t.skeleton,N.parent=t):(N.position=K.clone(),N.rotation=new A.Lt(V,x,b)),N.Hp(!0),N.refreshBoundingInfo(!0,!0),N}function G(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const t=0|Math.max(E.subdivisions?E.subdivisions:2,1),z=0|Math.max(E.tessellation?E.tessellation:16,3),X=Math.max(E.height?E.height:1,0),R=Math.max(E.radius?E.radius:.25,0),C=0|Math.max(E.capSubdivisions?E.capSubdivisions:6,1),Z=z,H=t,h=Math.max(E.radiusTop?E.radiusTop:R,0),d=Math.max(E.radiusBottom?E.radiusBottom:R,0),y=X-(h+d),O=2*Math.PI,c=Math.max(E.topCapSubdivisions?E.topCapSubdivisions:C,1),a=Math.max(E.bottomCapSubdivisions?E.bottomCapSubdivisions:C,1),L=Math.acos((d-h)/X);let mE=[];const W=[],I=[],e=[];let D=0;const S=[],l=.5*y,f=.5*Math.PI;let K,F;const B=A.Lt.Zero(),b=A.Lt.Zero(),x=Math.cos(L),J=Math.sin(L),V=new A.Vector2(h*J,l+h*x).Wt(new A.Vector2(d*J,d*x-l)).length(),r=h*L+V+d*(f-L);let i=0;for(F=0;F<=c;F++){const E=[],t=f-L*(F/c);i+=h*L/c;const z=Math.cos(t),A=Math.sin(t),X=z*h;for(K=0;K<=Z;K++){const t=K/Z,R=t*O+0,u=Math.sin(R),C=Math.cos(R);b.x=X*u,b.y=l+A*h,b.z=X*C,W.push(b.x,b.y,b.z),B.set(z*u,A,z*C),I.push(B.x,B.y,B.z),e.push(t,p.d?i/r:1-i/r),E.push(D),D++}S.push(E)}const g=X-h-d+x*h-x*d,o=J*(d-h)/g;for(F=1;F<=H;F++){const E=[];i+=V/H;const t=J*(F*(d-h)/H+h);for(K=0;K<=Z;K++){const z=K/Z,A=z*O+0,X=Math.sin(A),R=Math.cos(A);b.x=t*X,b.y=l+x*h-F*g/H,b.z=t*R,W.push(b.x,b.y,b.z),B.set(X,o,R).normalize(),I.push(B.x,B.y,B.z),e.push(z,p.d?i/r:1-i/r),E.push(D),D++}S.push(E)}for(F=1;F<=a;F++){const E=[],t=f-L-(Math.PI-L)*(F/a);i+=d*L/a;const z=Math.cos(t),A=Math.sin(t),X=z*d;for(K=0;K<=Z;K++){const t=K/Z,R=t*O+0,u=Math.sin(R),C=Math.cos(R);b.x=X*u,b.y=A*d-l,b.z=X*C,W.push(b.x,b.y,b.z),B.set(z*u,A,z*C),I.push(B.x,B.y,B.z),e.push(t,p.d?i/r:1-i/r),E.push(D),D++}S.push(E)}for(K=0;K<Z;K++)for(F=0;F<c+H+a;F++){const E=S[F][K],t=S[F+1][K],z=S[F+1][K+1],A=S[F][K+1];mE.push(E),mE.push(t),mE.push(A),mE.push(t),mE.push(z),mE.push(A)}if(mE=mE.reverse(),E.orientation&&!E.orientation.equals(A.Lt.Up())){const t=new A.Matrix;E.orientation.clone().scale(.5*Math.PI).cross(A.Lt.Up()).toQuaternion().toRotationMatrix(t);const z=A.Lt.Zero();for(let E=0;E<W.length;E+=3)z.set(W[E],W[E+1],W[E+2]),A.Lt.TransformCoordinatesToRef(z.clone(),t,z),W[E]=z.x,W[E+1]=z.y,W[E+2]=z.z}const Q=new u.c;return Q.KE=W,Q.FE=I,Q.bE=e,Q.indices=mE,Q}function N(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:A.Lt.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new X.e(E,z);return G(t).JE(R,t.updatable),R}X.e.CreateDecal=(E,t,z,A,X,R)=>Y(E,t,{position:z,normal:A,size:X,angle:R});X.e.CreateCapsule=(E,t,z)=>N(E,t,z),u.c.CreateCapsule=G;var P=z(11640),EE=z(11817);class tE{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=E,this.y=t,E!==Math.floor(E)&&(E=Math.floor(E),P.d.Warn("x is not an integer, floor(x) used")),t!==Math.floor(t)&&(t=Math.floor(t),P.d.Warn("y is not an integer, floor(y) used"))}clone(){return new tE(this.x,this.y)}rotate60About(E){const t=this.x;return this.x=E.x+E.y-this.y,this.y=t+this.y-E.x,this}rotateNeg60About(E){const t=this.x;return this.x=t+this.y-E.y,this.y=E.x+E.y-t,this}rotate120(E,t){E!==Math.floor(E)&&(E=Math.floor(E),P.d.Warn("m not an integer only floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),P.d.Warn("n not an integer only floor(n) used"));const z=this.x;return this.x=E-z-this.y,this.y=t+z,this}rotateNeg120(E,t){E!==Math.floor(E)&&(E=Math.floor(E),P.d.Warn("m is not an integer, floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),P.d.Warn("n is not an integer,   floor(n) used"));const z=this.x;return this.x=this.y-t,this.y=E+t-z-this.y,this}toCartesianOrigin(E,t){const z=A.Lt.Zero();return z.x=E.x+2*this.x*t+this.y*t,z.y=E.y+Math.sqrt(3)*this.y*t,z}static Zero(){return new tE(0,0)}}class zE{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new AE("icosahedron","Regular",[[0,EE.e,-1],[-EE.e,1,0],[-1,0,-EE.e],[1,0,-EE.e],[EE.e,1,0],[0,EE.e,1],[-1,0,EE.e],[-EE.e,-1,0],[0,-EE.e,-1],[EE.e,-1,0],[1,0,EE.e],[0,-EE.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let E=12;const t={},z=this.m,A=this.n;let X,R,u,p,C,Z=z,H=1,h=0;0!==A&&(Z=(0,M.HighestCommonFactor)(z,A)),H=z/Z,h=A/Z;const d=tE.Zero(),y=new tE(z,A),O=new tE(-A,z+A),c=tE.Zero(),a=tE.Zero(),L=tE.Zero();let mE,W,I,e,D=[];const S=[],l=this.vertByDist,f=(z,A,X,R)=>{mE=z+"|"+X,W=A+"|"+R,mE in t||W in t?mE in t&&!(W in t)?t[W]=t[mE]:W in t&&!(mE in t)&&(t[mE]=t[W]):(t[mE]=E,t[W]=E,E++),l[X][0]>2?S[t[mE]]=[-l[X][0],l[X][1],t[mE]]:S[t[mE]]=[D[l[X][0]],l[X][1],t[mE]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let K=0;K<20;K++){if(D=this.IDATA.face[K],u=D[2],p=D[1],C=D[0],I=d.x+"|"+d.y,mE=K+"|"+I,mE in t||(t[mE]=u,S[u]=[D[l[I][0]],l[I][1]]),I=y.x+"|"+y.y,mE=K+"|"+I,mE in t||(t[mE]=p,S[p]=[D[l[I][0]],l[I][1]]),I=O.x+"|"+O.y,mE=K+"|"+I,mE in t||(t[mE]=C,S[C]=[D[l[I][0]],l[I][1]]),X=this.IDATA.edgematch[K][0],R=this.IDATA.edgematch[K][1],"B"===R)for(let E=1;E<Z;E++)a.x=z-E*(H+h),a.y=A+E*H,L.x=-E*h,L.y=E*(H+h),I=a.x+"|"+a.y,e=L.x+"|"+L.y,f(K,X,I,e);if("O"===R)for(let E=1;E<Z;E++)L.x=-E*h,L.y=E*(H+h),c.x=E*H,c.y=E*h,I=L.x+"|"+L.y,e=c.x+"|"+c.y,f(K,X,I,e);if(X=this.IDATA.edgematch[K][2],R=this.IDATA.edgematch[K][3],R&&"A"===R)for(let E=1;E<Z;E++)c.x=E*H,c.y=E*h,a.x=z-(Z-E)*(H+h),a.y=A+(Z-E)*H,I=c.x+"|"+c.y,e=a.x+"|"+a.y,f(K,X,I,e);for(let z=0;z<this.vertices.length;z++)I=this.vertices[z].x+"|"+this.vertices[z].y,mE=K+"|"+I,mE in t||(t[mE]=E++,l[I][0]>2?S[t[mE]]=[-l[I][0],l[I][1],t[mE]]:S[t[mE]]=[D[l[I][0]],l[I][1],t[mE]])}this.closestTo=S,this.vecToidx=t}calcCoeffs(){const E=this.m,t=this.n,z=Math.sqrt(3)/3,A=E*E+t*t+E*t;this.coau=(E+t)/A,this.cobu=-t/A,this.coav=-z*(E-t)/A,this.cobv=z*(2*E+t)/A}createInnerFacets(){const E=this.m,t=this.n;for(let z=0;z<t+E+1;z++)for(let E=this.min[z];E<this.max[z]+1;E++)E<this.max[z]&&E<this.max[z+1]+1&&this.innerFacets.push(["|"+E+"|"+z,"|"+E+"|"+(z+1),"|"+(E+1)+"|"+z]),z>0&&E<this.max[z-1]&&E+1<this.max[z]+1&&this.innerFacets.push(["|"+E+"|"+z,"|"+(E+1)+"|"+z,"|"+(E+1)+"|"+(z-1)])}edgeVecsABOB(){const E=this.m,t=this.n,z=new tE(-t,E+t);for(let A=1;A<E+t;A++){const E=new tE(this.min[A],A),t=new tE(this.min[A-1],A-1),X=new tE(this.min[A+1],A+1),R=E.clone(),u=t.clone(),p=X.clone();R.rotate60About(z),u.rotate60About(z),p.rotate60About(z);const C=new tE(this.max[R.y],R.y),Z=new tE(this.max[R.y-1],R.y-1),H=new tE(this.max[R.y-1]-1,R.y-1);R.x===C.x&&R.y===C.y||(R.x!==Z.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([E,Z,H]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([E,H,C])):R.y===p.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([E,t,Z]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([E,Z,X])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([E,t,Z]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([E,Z,C])))}}mapABOBtoOBOA(){const E=new tE(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const z=[];for(let A=0;A<3;A++)E.x=this.isoVecsABOB[t][A].x,E.y=this.isoVecsABOB[t][A].y,0===this.vertexTypes[t][A]&&E.rotateNeg120(this.m,this.n),z.push(E.clone());this.isoVecsOBOA.push(z)}}mapABOBtoBAOA(){const E=new tE(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const z=[];for(let A=0;A<3;A++)E.x=this.isoVecsABOB[t][A].x,E.y=this.isoVecsABOB[t][A].y,1===this.vertexTypes[t][A]&&E.rotate120(this.m,this.n),z.push(E.clone());this.isoVecsBAOA.push(z)}}MapToFace(E,t){const z=this.IDATA.face[E],X=z[2],R=z[1],u=z[0],p=A.Lt.St(this.IDATA.vertex[X]),C=A.Lt.St(this.IDATA.vertex[R]),Z=A.Lt.St(this.IDATA.vertex[u]),H=C.Wt(p),h=Z.Wt(p),d=H.scale(this.coau).add(h.scale(this.cobu)),y=H.scale(this.coav).add(h.scale(this.cobv)),O=[];let c,a=A.TmpVectors.Lt[0];for(let A=0;A<this.cartesian.length;A++)a=d.scale(this.cartesian[A].x).add(y.scale(this.cartesian[A].y)).add(p),O[A]=[a.x,a.y,a.z],c=E+"|"+this.vertices[A].x+"|"+this.vertices[A].y,t.vertex[this.vecToidx[c]]=[a.x,a.y,a.z]}build(E,t){const z=[],A=tE.Zero(),X=new tE(E,t),R=new tE(-t,E+t);z.push(A,X,R);for(let I=t;I<E+1;I++)for(let t=0;t<E+1-I;t++)z.push(new tE(t,I));if(t>0){const A=(0,M.HighestCommonFactor)(E,t),X=E/A,R=t/A;for(let p=1;p<A;p++)z.push(new tE(p*X,p*R)),z.push(new tE(-p*R,p*(X+R))),z.push(new tE(E-p*(X+R),t+p*X));const u=E/t;for(let p=1;p<t;p++)for(let A=0;A<p*u;A++)z.push(new tE(A,p)),z.push(new tE(A,p).rotate120(E,t)),z.push(new tE(A,p).rotateNeg120(E,t))}z.sort(((E,t)=>E.x-t.x)),z.sort(((E,t)=>E.y-t.y));const u=new Array(E+t+1),p=new Array(E+t+1);for(let I=0;I<u.length;I++)u[I]=1/0,p[I]=-1/0;let C=0,Z=0;const H=z.length;for(let I=0;I<H;I++)Z=z[I].x,C=z[I].y,u[C]=Math.min(Z,u[C]),p[C]=Math.max(Z,p[C]);const h=(z,A)=>{const X=z.clone();return"A"===A&&X.rotateNeg120(E,t),"B"===A&&X.rotate120(E,t),X.x<0?X.y:X.x+X.y},d=[],y=[],O=[],c=[],a={},L=[];let mE=-1,W=-1;for(let I=0;I<H;I++)d[I]=z[I].toCartesianOrigin(new tE(0,0),.5),y[I]=h(z[I],"O"),O[I]=h(z[I],"A"),c[I]=h(z[I],"B"),y[I]===O[I]&&O[I]===c[I]?(mE=3,W=y[I]):y[I]===O[I]?(mE=4,W=y[I]):O[I]===c[I]?(mE=5,W=O[I]):c[I]===y[I]&&(mE=6,W=y[I]),y[I]<O[I]&&y[I]<c[I]&&(mE=2,W=y[I]),O[I]<y[I]&&O[I]<c[I]&&(mE=1,W=O[I]),c[I]<O[I]&&c[I]<y[I]&&(mE=0,W=c[I]),L.push([mE,W,z[I].x,z[I].y]);L.sort(((E,t)=>E[2]-t[2])),L.sort(((E,t)=>E[3]-t[3])),L.sort(((E,t)=>E[1]-t[1])),L.sort(((E,t)=>E[0]-t[0]));for(let I=0;I<L.length;I++)a[L[I][2]+"|"+L[I][3]]=[L[I][0],L[I][1],I];return this.m=E,this.n=t,this.vertices=z,this.vertByDist=a,this.cartesian=d,this.min=u,this.max=p,this}}class AE{constructor(E,t,z,A){this.name=E,this.category=t,this.vertex=z,this.face=A}}class XE extends AE{innerToData(E,t){for(let z=0;z<t.innerFacets.length;z++)this.face.push(t.innerFacets[z].map((z=>t.vecToidx[E+z])))}mapABOBtoDATA(E,t){const z=t.IDATA.edgematch[E][0];for(let A=0;A<t.isoVecsABOB.length;A++){const X=[];for(let R=0;R<3;R++)0===t.vertexTypes[A][R]?X.push(E+"|"+t.isoVecsABOB[A][R].x+"|"+t.isoVecsABOB[A][R].y):X.push(z+"|"+t.isoVecsABOB[A][R].x+"|"+t.isoVecsABOB[A][R].y);this.face.push([t.vecToidx[X[0]],t.vecToidx[X[1]],t.vecToidx[X[2]]])}}mapOBOAtoDATA(E,t){const z=t.IDATA.edgematch[E][0];for(let A=0;A<t.isoVecsOBOA.length;A++){const X=[];for(let R=0;R<3;R++)1===t.vertexTypes[A][R]?X.push(E+"|"+t.isoVecsOBOA[A][R].x+"|"+t.isoVecsOBOA[A][R].y):X.push(z+"|"+t.isoVecsOBOA[A][R].x+"|"+t.isoVecsOBOA[A][R].y);this.face.push([t.vecToidx[X[0]],t.vecToidx[X[1]],t.vecToidx[X[2]]])}}mapBAOAtoDATA(E,t){const z=t.IDATA.edgematch[E][2];for(let A=0;A<t.isoVecsBAOA.length;A++){const X=[];for(let R=0;R<3;R++)1===t.vertexTypes[A][R]?X.push(E+"|"+t.isoVecsBAOA[A][R].x+"|"+t.isoVecsBAOA[A][R].y):X.push(z+"|"+t.isoVecsBAOA[A][R].x+"|"+t.isoVecsBAOA[A][R].y);this.face.push([t.vecToidx[X[0]],t.vecToidx[X[1]],t.vecToidx[X[2]]])}}orderData(E){const t=[];for(let R=0;R<13;R++)t[R]=[];const z=E.closestTo;for(let R=0;R<z.length;R++)z[R][0]>-1?z[R][1]>0&&t[z[R][0]].push([R,z[R][1]]):t[12].push([R,z[R][0]]);const A=[];for(let R=0;R<12;R++)A[R]=R;let X=12;for(let R=0;R<12;R++){t[R].sort(((E,t)=>E[1]-t[1]));for(let E=0;E<t[R].length;E++)A[t[R][E][0]]=X++}for(let R=0;R<t[12].length;R++)A[t[12][R][0]]=X++;for(let R=0;R<this.vertex.length;R++)this.vertex[R].push(A[R]);this.vertex.sort(((E,t)=>E[3]-t[3]));for(let R=0;R<this.vertex.length;R++)this.vertex[R].pop();for(let R=0;R<this.face.length;R++)for(let E=0;E<this.face[R].length;E++)this.face[R][E]=A[this.face[R][E]];this.sharedNodes=t[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(E,t){const z=[],A=[];let X=t.pop();A.push(X);let R=this.face[X].indexOf(E);R=(R+2)%3;let u=this.face[X][R];z.push(u);let p=0;for(;t.length>0;)X=t[p],this.face[X].indexOf(u)>-1?(R=(this.face[X].indexOf(u)+1)%3,u=this.face[X][R],z.push(u),A.push(X),t.splice(p,1),p=0):p++;return this.adjacentFaces.push(z),A}toGoldbergPolyhedronData(){const E=new AE("GeoDual","Goldberg",[],[]);E.name="GD dual";const t=this.vertex.length,z=new Array(t);for(let C=0;C<t;C++)z[C]=[];for(let C=0;C<this.face.length;C++)for(let E=0;E<3;E++)z[this.face[C][E]].push(C);let A=0,X=0,R=0,u=[],p=[];this.adjacentFaces=[];for(let C=0;C<z.length;C++){E.face[C]=this.setOrder(C,z[C].concat([]));for(const t of z[C]){A=0,X=0,R=0,u=this.face[t];for(let E=0;E<3;E++)p=this.vertex[u[E]],A+=p[0],X+=p[1],R+=p[2];E.vertex[t]=[A/3,X/3,R/3]}}return E}static BuildGeodesicData(E){const t=new XE("Geodesic-m-n","Geodesic",[[0,EE.e,-1],[-EE.e,1,0],[-1,0,-EE.e],[1,0,-EE.e],[EE.e,1,0],[0,EE.e,1],[-1,0,EE.e],[-EE.e,-1,0],[0,-EE.e,-1],[EE.e,-1,0],[1,0,EE.e],[0,-EE.e,1]],[]);E.setIndices(),E.calcCoeffs(),E.createInnerFacets(),E.edgeVecsABOB(),E.mapABOBtoOBOA(),E.mapABOBtoBAOA();for(let z=0;z<E.IDATA.face.length;z++)E.MapToFace(z,t),t.innerToData(z,E),"B"===E.IDATA.edgematch[z][1]&&t.mapABOBtoDATA(z,E),"O"===E.IDATA.edgematch[z][1]&&t.mapOBOAtoDATA(z,E),"A"===E.IDATA.edgematch[z][3]&&t.mapBAOAtoDATA(z,E);t.orderData(E);return t.vertex=t.vertex.map((function(E){const t=E[0],z=E[1],A=E[2],X=Math.sqrt(t*t+z*z+A*A);return E[0]*=1/X,E[1]*=1/X,E[2]*=1/X,E})),t}}X.e._GoldbergMeshParser=(E,t)=>RE.Parse(E,t);class RE extends X.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(E,t){return void 0===t?(E>this.goldbergData.nbUnsharedFaces-1&&(P.d.Warn("Maximum number of unshared faces used"),E=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+E):(E>11&&(P.d.Warn("Last pole used"),E=11),t>this.goldbergData.nbFacesAtPole-1&&(P.d.Warn("Maximum number of faces at a pole used"),t=this.goldbergData.nbFacesAtPole-1),12+E*this.goldbergData.nbFacesAtPole+t)}_changeGoldbergFaceColors(E){for(let z=0;z<E.length;z++){const t=E[z][0],A=E[z][1],X=E[z][2];for(let E=t;E<A+1;E++)this.goldbergData.faceColors[E]=X}const t=[];for(let z=0;z<12;z++)for(let E=0;E<5;E++)t.push(this.goldbergData.faceColors[z].r,this.goldbergData.faceColors[z].g,this.goldbergData.faceColors[z].b,this.goldbergData.faceColors[z].a);for(let z=12;z<this.goldbergData.faceColors.length;z++)for(let E=0;E<6;E++)t.push(this.goldbergData.faceColors[z].r,this.goldbergData.faceColors[z].g,this.goldbergData.faceColors[z].b,this.goldbergData.faceColors[z].a);return t}setGoldbergFaceColors(E){const t=this._changeGoldbergFaceColors(E);this.gE(R.f.ColorKind,t)}updateGoldbergFaceColors(E){const t=this._changeGoldbergFaceColors(E);this.updateVerticesData(R.f.ColorKind,t)}_changeGoldbergFaceUVs(E){const t=this.getVerticesData(R.f.UVKind);for(let z=0;z<E.length;z++){const A=E[z][0],X=E[z][1],R=E[z][2],u=E[z][3],p=E[z][4],C=[],Z=[];let H,h;for(let E=0;E<5;E++)H=R.x+u*Math.cos(p+E*Math.PI/2.5),h=R.y+u*Math.sin(p+E*Math.PI/2.5),H<0&&(H=0),H>1&&(H=1),C.push(H,h);for(let E=0;E<6;E++)H=R.x+u*Math.cos(p+E*Math.PI/3),h=R.y+u*Math.sin(p+E*Math.PI/3),H<0&&(H=0),H>1&&(H=1),Z.push(H,h);for(let E=A;E<Math.min(12,X+1);E++)for(let z=0;z<5;z++)t[10*E+2*z]=C[2*z],t[10*E+2*z+1]=C[2*z+1];for(let E=Math.max(12,A);E<X+1;E++)for(let z=0;z<6;z++)t[12*E-24+2*z]=Z[2*z],t[12*E-23+2*z]=Z[2*z+1]}return t}setGoldbergFaceUVs(E){const t=this._changeGoldbergFaceUVs(E);this.gE(R.f.UVKind,t)}updateGoldbergFaceUVs(E){const t=this._changeGoldbergFaceUVs(E);this.updateVerticesData(R.f.UVKind,t)}placeOnGoldbergFaceAt(E,t,z){const X=A.Lt.RotationFromAxis(this.goldbergData.faceXaxis[t],this.goldbergData.faceYaxis[t],this.goldbergData.faceZaxis[t]);E.rotation=X,E.position=this.goldbergData.faceCenters[t].add(this.goldbergData.faceXaxis[t].scale(z.x)).add(this.goldbergData.faceYaxis[t].scale(z.y)).add(this.goldbergData.faceZaxis[t].scale(z.z))}serialize(E){super.serialize(E),E.type="GoldbergMesh";const t={};if(t.adjacentFaces=this.goldbergData.adjacentFaces,t.nbSharedFaces=this.goldbergData.nbSharedFaces,t.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,t.nbFaces=this.goldbergData.nbFaces,t.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){t.faceColors=[];for(const E of this.goldbergData.faceColors)t.faceColors.push(E.upE())}if(this.goldbergData.faceCenters){t.faceCenters=[];for(const E of this.goldbergData.faceCenters)t.faceCenters.push(E.upE())}if(this.goldbergData.faceZaxis){t.faceZaxis=[];for(const E of this.goldbergData.faceZaxis)t.faceZaxis.push(E.upE())}if(this.goldbergData.faceYaxis){t.faceYaxis=[];for(const E of this.goldbergData.faceYaxis)t.faceYaxis.push(E.upE())}if(this.goldbergData.faceXaxis){t.faceXaxis=[];for(const E of this.goldbergData.faceXaxis)t.faceXaxis.push(E.upE())}E.goldbergData=t}static Parse(E,t){const z=E.goldbergData;z.faceColors=z.faceColors.map((E=>d.Lp.St(E))),z.faceCenters=z.faceCenters.map((E=>A.Lt.St(E))),z.faceZaxis=z.faceZaxis.map((E=>A.Lt.St(E))),z.faceXaxis=z.faceXaxis.map((E=>A.Lt.St(E))),z.faceYaxis=z.faceYaxis.map((E=>A.Lt.St(E)));const X=new RE(E.name,t);return X.goldbergData=z,X}}var uE=z(12376);const pE={CreateBox:h.e,CreateTiledBox:a,CreateSphere:L.c,CreateDisc:H.c,CreateIcoSphere:q,CreateRibbon:Z,CreateCylinder:e,CreateTorus:S,CreateTorusKnot:f,CreateLineSystem:K.g,hZ:K.j,CreateDashedLines:K.e,ExtrudeShape:b,ExtrudeShapeCustom:x,CreateLathe:V,CreateTiledPlane:O,cZ:r.c,CreateGround:i.f,CreateTiledGround:i.i,CreateGroundFromHeightMap:i.b,CreatePolygon:F.c,ExtrudePolygon:F.d,CreateTube:g,CreatePolyhedron:Q,CreateGeodesic:function(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=t.m||1;A!==Math.floor(A)&&(A=Math.floor(A),P.d.Warn("m not an integer only floor(m) used"));let X=t.n||0;if(X!==Math.floor(X)&&(X=Math.floor(X),P.d.Warn("n not an integer only floor(n) used")),X>A){const E=X;X=A,A=E,P.d.Warn("n > m therefore m and n swapped")}const R=new zE;return R.build(A,X),Q(E,{custom:XE.BuildGeodesicData(R),size:t.size,sizeX:t.sizeX,sizeY:t.sizeY,sizeZ:t.sizeZ,faceUV:t.faceUV,faceColors:t.faceColors,flat:t.flat,updatable:t.updatable,sideOrientation:t.sideOrientation,frontUVs:t.frontUVs,backUVs:t.backUVs},z)},CreateGoldberg:function(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=t.size,C=t.sizeX||R||1,Z=t.sizeY||R||1,H=t.sizeZ||R||1;let h=t.m||1;h!==Math.floor(h)&&(h=Math.floor(h),P.d.Warn("m not an integer only floor(m) used"));let y=t.n||0;if(y!==Math.floor(y)&&(y=Math.floor(y),P.d.Warn("n not an integer only floor(n) used")),y>h){const E=y;y=h,h=E,P.d.Warn("n > m therefore m and n swapped")}const O=new zE;O.build(h,y);const c=XE.BuildGeodesicData(O),a=c.toGoldbergPolyhedronData(),L=new RE(E,z);t.sideOrientation=X.e._GetDefaultSideOrientation(t.sideOrientation),L._originalBuilderSideOrientation=t.sideOrientation;(function(E,t){const z=E.size,X=E.sizeX||z||1,R=E.sizeY||z||1,C=E.sizeZ||z||1,Z=0===E.sideOrientation?0:E.sideOrientation||u.c.DEFAULTSIDE,H=[],h=[],d=[],y=[];let O=1/0,c=-1/0,a=1/0,L=-1/0;for(let A=0;A<t.vertex.length;A++)O=Math.min(O,t.vertex[A][0]*X),c=Math.max(c,t.vertex[A][0]*X),a=Math.min(a,t.vertex[A][1]*R),L=Math.max(L,t.vertex[A][1]*R);let mE=0;for(let u=0;u<t.face.length;u++){const E=t.face[u],z=A.Lt.St(t.vertex[E[0]]),Z=A.Lt.St(t.vertex[E[2]]),W=A.Lt.St(t.vertex[E[1]]),I=Z.Wt(z),e=W.Wt(z),D=A.Lt.Cross(e,I).normalize();for(let A=0;A<E.length;A++){d.push(D.x,D.y,D.z);const z=t.vertex[E[A]];H.push(z[0]*X,z[1]*R,z[2]*C);const u=(z[1]*R-a)/(L-a);y.push((z[0]*X-O)/(c-O),p.d?1-u:u)}for(let t=0;t<E.length-2;t++)h.push(mE,mE+t+2,mE+t+1);mE+=E.length}u.c._ComputeSides(Z,H,h,d,y);const W=new u.c;return W.KE=H,W.indices=h,W.FE=d,W.bE=y,W})(t,a).JE(L,t.updatable),L.goldbergData.nbSharedFaces=c.sharedNodes,L.goldbergData.nbUnsharedFaces=c.poleNodes,L.goldbergData.adjacentFaces=c.adjacentFaces,L.goldbergData.nbFaces=L.goldbergData.nbSharedFaces+L.goldbergData.nbUnsharedFaces,L.goldbergData.nbFacesAtPole=(L.goldbergData.nbUnsharedFaces-12)/12;for(let X=0;X<c.vertex.length;X++)L.goldbergData.faceCenters.push(A.Lt.St(c.vertex[X])),L.goldbergData.faceCenters[X].x*=C,L.goldbergData.faceCenters[X].y*=Z,L.goldbergData.faceCenters[X].z*=H,L.goldbergData.faceColors.push(new d.Lp(1,1,1,1));for(let X=0;X<a.face.length;X++){const E=a.face[X],t=A.Lt.St(a.vertex[E[0]]),z=A.Lt.St(a.vertex[E[2]]),R=A.Lt.St(a.vertex[E[1]]),u=z.Wt(t),p=R.Wt(t),C=A.Lt.Cross(p,u).normalize(),Z=A.Lt.Cross(p,C).normalize();L.goldbergData.faceXaxis.push(p.normalize()),L.goldbergData.faceYaxis.push(C),L.goldbergData.faceZaxis.push(Z)}return L},CreateDecal:Y,CreateCapsule:N,CreateText:uE.g}},13072:(E,t,z)=>{"use strict";z.d(t,{c:()=>pt});var A=z(11812),X=z(12190);class R extends X.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var u=z(11856),p=(z(11982),z(11766));class C{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(E){this._targetStopDuration!==E&&(this._targetStopDuration=E)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(E){this._noiseTexture!==E&&(this._noiseTexture=E,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(E){this._animationSheetEnabled!==E&&(this._animationSheetEnabled=E)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(E){this._isAnimationSheetEnabled!=E&&(this._isAnimationSheetEnabled=E,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(E){this._useLogarithmicDepth=E&&this.lE().getEngine().getCaps().fragmentDepthSupported}lE(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(E){switch(E){case C.BLENDMODE_MULTIPLYADD:return;case C.BLENDMODE_ADD:E=1;break;case C.BLENDMODE_ONEONE:E=6;break;case C.BLENDMODE_STANDARD:E=2;break;case C.BLENDMODE_MULTIPLY:E=4;break;case C.BLENDMODE_SUBTRACT:E=3}this._engine.setAlphaMode(E)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:A.Lt.Zero()}set direction1(E){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=E)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:A.Lt.Zero()}set direction2(E){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=E)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:A.Lt.Zero()}set minEmitBox(E){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=E)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:A.Lt.Zero()}set maxEmitBox(E){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=E)}get billboardMode(){return this._billboardMode}set billboardMode(E){this._billboardMode!==E&&(this._billboardMode=E,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(E){this._isBillboardBased!==E&&(this._isBillboardBased=E,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(E){this._attachImageProcessingConfiguration(E)}_attachImageProcessingConfiguration(E){E!==this._imageProcessingConfiguration&&(!E&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=E)}_reset(){}_removeGradientAndTexture(E,t,z){if(!t)return this;let A=0;for(const X of t){if(X.gradient===E){t.splice(A,1);break}A++}return z&&z.dispose(),this}constructor(E){this.animations=[],this.renderingGroupId=0,this.Xt=A.Lt.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new A.Lt(10,10,10),this.onAnimationEnd=null,this.blendMode=C.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new A.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.CZ=new A.Lt(0,0,0),this._useLogarithmicDepth=!1,this.gravity=A.Lt.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new u.Lp(1,1,1,1),this.color2=new u.Lp(1,1,1,1),this.colorDead=new u.Lp(0,0,0,1),this.textureMask=new u.Lp(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new R,this.id=E,this.name=E}createPointEmitter(E,t){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new A.Lt(0,1,0),arguments.length>2&&void 0!==arguments[2]||new A.Lt(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new A.Lt(0,1,0),arguments.length>4&&void 0!==arguments[4]||new A.Lt(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new A.Lt(0,1,0),arguments.length>3&&void 0!==arguments[3]||new A.Lt(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(E,t,z,A){throw new Error("Method not implemented.")}}C.BLENDMODE_ONEONE=0,C.BLENDMODE_STANDARD=1,C.BLENDMODE_ADD=2,C.BLENDMODE_MULTIPLY=3,C.BLENDMODE_MULTIPLYADD=4,C.BLENDMODE_SUBTRACT=-1,(0,p.f)("BABYLON.BaseParticleSystem",C);var Z=z(11834),H=z(11647);class h{constructor(){this.direction1=new A.Lt(0,1,0),this.direction2=new A.Lt(0,1,0),this.minEmitBox=new A.Lt(-.5,-.5,-.5),this.maxEmitBox=new A.Lt(.5,.5,.5)}startDirectionFunction(E,t,z,X){const R=(0,Z.RandomRange)(this.direction1.x,this.direction2.x),u=(0,Z.RandomRange)(this.direction1.y,this.direction2.y),p=(0,Z.RandomRange)(this.direction1.z,this.direction2.z);if(X)return t.x=R,t.y=u,void(t.z=p);A.Lt.TransformNormalFromFloatsToRef(R,u,p,E,t)}startPositionFunction(E,t,z,X){const R=(0,Z.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),u=(0,Z.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),p=(0,Z.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(X)return t.x=R,t.y=u,void(t.z=p);A.Lt.TransformCoordinatesFromFloatsToRef(R,u,p,E,t)}clone(){const E=new h;return H.d.DeepCopy(this,E),E}applyToShader(E){E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2),E.setVector3("minEmitBox",this.minEmitBox),E.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(E){E.addUniform("direction1",3),E.addUniform("direction2",3),E.addUniform("minEmitBox",3),E.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.direction1=this.direction1.upE(),E.direction2=this.direction2.upE(),E.minEmitBox=this.minEmitBox.upE(),E.maxEmitBox=this.maxEmitBox.upE(),E}parse(E){A.Lt.FromArrayToRef(E.direction1,0,this.direction1),A.Lt.FromArrayToRef(E.direction2,0,this.direction2),A.Lt.FromArrayToRef(E.minEmitBox,0,this.minEmitBox),A.Lt.FromArrayToRef(E.maxEmitBox,0,this.maxEmitBox)}}class d{get radius(){return this._radius}set radius(E){this._radius=E,this._buildHeight()}get angle(){return this._angle}set angle(E){this._angle=E,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=z,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=t,this.radius=E}startDirectionFunction(E,t,z,X){X?A.TmpVectors.Lt[0].R(z.Mp).normalize():z.position.subtractToRef(E.getTranslation(),A.TmpVectors.Lt[0]).normalize();const R=(0,Z.RandomRange)(0,this.directionRandomizer),u=(0,Z.RandomRange)(0,this.directionRandomizer),p=(0,Z.RandomRange)(0,this.directionRandomizer);t.x=A.TmpVectors.Lt[0].x+R,t.y=A.TmpVectors.Lt[0].y+u,t.z=A.TmpVectors.Lt[0].z+p,t.normalize()}startPositionFunction(E,t,z,X){const R=(0,Z.RandomRange)(0,2*Math.PI);let u;this.emitFromSpawnPointOnly?u=1e-4:(u=(0,Z.RandomRange)(0,this.heightRange),u=1-u*u);let p=this._radius-(0,Z.RandomRange)(0,this._radius*this.radiusRange);p*=u;const C=p*Math.sin(R),H=p*Math.cos(R),h=u*this._height;if(X)return t.x=C,t.y=h,void(t.z=H);A.Lt.TransformCoordinatesFromFloatsToRef(C,h,H,E,t)}clone(){const E=new d(this._radius,this._angle,this.directionRandomizer);return H.d.DeepCopy(this,E),E}applyToShader(E){E.setFloat2("radius",this._radius,this.radiusRange),E.setFloat("coneAngle",this._angle),E.setFloat2("height",this._height,this.heightRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",2),E.addUniform("coneAngle",1),E.addUniform("height",2),E.addUniform("directionRandomizer",1)}getEffectDefines(){let E="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(E+="\n#define CONEEMITTERSPAWNPOINT"),E}getClassName(){return"ConeParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this._radius,E.angle=this._angle,E.directionRandomizer=this.directionRandomizer,E.radiusRange=this.radiusRange,E.heightRange=this.heightRange,E.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,E}parse(E){this.radius=E.radius,this.angle=E.angle,this.directionRandomizer=E.directionRandomizer,this.radiusRange=void 0!==E.radiusRange?E.radiusRange:1,this.heightRange=void 0!==E.radiusRange?E.heightRange:1,this.emitFromSpawnPointOnly=void 0!==E.emitFromSpawnPointOnly&&E.emitFromSpawnPointOnly}}class y extends d{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Lt(0,1,0),X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Lt(0,1,0);super(E,t),this.direction1=z,this.direction2=X}startDirectionFunction(E,t){const z=(0,Z.RandomRange)(this.direction1.x,this.direction2.x),X=(0,Z.RandomRange)(this.direction1.y,this.direction2.y),R=(0,Z.RandomRange)(this.direction1.z,this.direction2.z);A.Lt.TransformNormalFromFloatsToRef(z,X,R,E,t)}clone(){const E=new y(this.radius,this.angle,this.direction1,this.direction2);return H.d.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const E=super.serialize();return E.direction1=this.direction1.upE(),E.direction2=this.direction2.upE(),E}parse(E){super.parse(E),this.direction1.R(E.direction1),this.direction2.R(E.direction2)}}class O{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=E,this.height=t,this.radiusRange=z,this.directionRandomizer=X,this._tempVector=A.Lt.Zero()}startDirectionFunction(E,t,z,X,R){z.position.subtractToRef(E.getTranslation(),this._tempVector),this._tempVector.normalize(),A.Lt.TransformNormalToRef(this._tempVector,R,this._tempVector);const u=(0,Z.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let p=Math.atan2(this._tempVector.x,this._tempVector.z);p+=(0,Z.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=u,this._tempVector.x=Math.sin(p),this._tempVector.z=Math.cos(p),this._tempVector.normalize(),X?t.R(this._tempVector):A.Lt.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,E,t)}startPositionFunction(E,t,z,X){const R=(0,Z.RandomRange)(-this.height/2,this.height/2),u=(0,Z.RandomRange)(0,2*Math.PI),p=(0,Z.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),C=Math.sqrt(p)*this.radius,H=C*Math.cos(u),h=C*Math.sin(u);X?t.Op(H,R,h):A.Lt.TransformCoordinatesFromFloatsToRef(H,R,h,E,t)}clone(){const E=new O(this.radius,this.directionRandomizer);return H.d.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("height",this.height),E.setFloat("radiusRange",this.radiusRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("height",1),E.addUniform("radiusRange",1),E.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this.radius,E.height=this.height,E.radiusRange=this.radiusRange,E.directionRandomizer=this.directionRandomizer,E}parse(E){this.radius=E.radius,this.height=E.height,this.radiusRange=E.radiusRange,this.directionRandomizer=E.directionRandomizer}}class c extends O{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Lt(0,1,0),R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.Lt(0,1,0);super(E,t,z),this.direction1=X,this.direction2=R}startDirectionFunction(E,t,z,X){const R=(0,Z.RandomRange)(this.direction1.x,this.direction2.x),u=(0,Z.RandomRange)(this.direction1.y,this.direction2.y),p=(0,Z.RandomRange)(this.direction1.z,this.direction2.z);X?t.Op(R,u,p):A.Lt.TransformNormalFromFloatsToRef(R,u,p,E,t)}clone(){const E=new c(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return H.d.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("height",this.height),E.setFloat("radiusRange",this.radiusRange),E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("height",1),E.addUniform("radiusRange",1),E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const E=super.serialize();return E.direction1=this.direction1.upE(),E.direction2=this.direction2.upE(),E}parse(E){super.parse(E),A.Lt.FromArrayToRef(E.direction1,0,this.direction1),A.Lt.FromArrayToRef(E.direction2,0,this.direction2)}}class a{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=E,this.radiusRange=t,this.directionRandomizer=z}startDirectionFunction(E,t,z,X){const R=z.position.Wt(E.getTranslation()).normalize(),u=(0,Z.RandomRange)(0,this.directionRandomizer),p=(0,Z.RandomRange)(0,this.directionRandomizer),C=(0,Z.RandomRange)(0,this.directionRandomizer);R.x+=u,R.y+=p,R.z+=C,R.normalize(),X?t.R(R):A.Lt.TransformNormalFromFloatsToRef(R.x,R.y,R.z,E,t)}startPositionFunction(E,t,z,X){const R=this.radius-(0,Z.RandomRange)(0,this.radius*this.radiusRange),u=(0,Z.RandomRange)(0,1),p=(0,Z.RandomRange)(0,2*Math.PI),C=Math.acos(2*u-1),H=R*Math.cos(p)*Math.sin(C),h=R*Math.cos(C),d=R*Math.sin(p)*Math.sin(C);X?t.Op(H,Math.abs(h),d):A.Lt.TransformCoordinatesFromFloatsToRef(H,Math.abs(h),d,E,t)}clone(){const E=new a(this.radius,this.directionRandomizer);return H.d.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this.radius,E.radiusRange=this.radiusRange,E.directionRandomizer=this.directionRandomizer,E}parse(E){this.radius=E.radius,this.radiusRange=E.radiusRange,this.directionRandomizer=E.directionRandomizer}}class L{constructor(){this.direction1=new A.Lt(0,1,0),this.direction2=new A.Lt(0,1,0)}startDirectionFunction(E,t,z,X){const R=(0,Z.RandomRange)(this.direction1.x,this.direction2.x),u=(0,Z.RandomRange)(this.direction1.y,this.direction2.y),p=(0,Z.RandomRange)(this.direction1.z,this.direction2.z);X?t.Op(R,u,p):A.Lt.TransformNormalFromFloatsToRef(R,u,p,E,t)}startPositionFunction(E,t,z,X){X?t.Op(0,0,0):A.Lt.TransformCoordinatesFromFloatsToRef(0,0,0,E,t)}clone(){const E=new L;return H.d.DeepCopy(this,E),E}applyToShader(E){E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.direction1=this.direction1.upE(),E.direction2=this.direction2.upE(),E}parse(E){A.Lt.FromArrayToRef(E.direction1,0,this.direction1),A.Lt.FromArrayToRef(E.direction2,0,this.direction2)}}class mE{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=E,this.radiusRange=t,this.directionRandomizer=z}startDirectionFunction(E,t,z,X){const R=z.position.Wt(E.getTranslation()).normalize(),u=(0,Z.RandomRange)(0,this.directionRandomizer),p=(0,Z.RandomRange)(0,this.directionRandomizer),C=(0,Z.RandomRange)(0,this.directionRandomizer);R.x+=u,R.y+=p,R.z+=C,R.normalize(),X?t.R(R):A.Lt.TransformNormalFromFloatsToRef(R.x,R.y,R.z,E,t)}startPositionFunction(E,t,z,X){const R=this.radius-(0,Z.RandomRange)(0,this.radius*this.radiusRange),u=(0,Z.RandomRange)(0,1),p=(0,Z.RandomRange)(0,2*Math.PI),C=Math.acos(2*u-1),H=R*Math.cos(p)*Math.sin(C),h=R*Math.cos(C),d=R*Math.sin(p)*Math.sin(C);X?t.Op(H,h,d):A.Lt.TransformCoordinatesFromFloatsToRef(H,h,d,E,t)}clone(){const E=new mE(this.radius,this.directionRandomizer);return H.d.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this.radius,E.radiusRange=this.radiusRange,E.directionRandomizer=this.directionRandomizer,E}parse(E){this.radius=E.radius,this.radiusRange=E.radiusRange,this.directionRandomizer=E.directionRandomizer}}class W extends mE{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.Lt(0,1,0),z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Lt(0,1,0);super(E),this.direction1=t,this.direction2=z}startDirectionFunction(E,t){const z=(0,Z.RandomRange)(this.direction1.x,this.direction2.x),X=(0,Z.RandomRange)(this.direction1.y,this.direction2.y),R=(0,Z.RandomRange)(this.direction1.z,this.direction2.z);A.Lt.TransformNormalFromFloatsToRef(z,X,R,E,t)}clone(){const E=new W(this.radius,this.direction1,this.direction2);return H.d.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const E=super.serialize();return E.direction1=this.direction1.upE(),E.direction2=this.direction2.upE(),E}parse(E){super.parse(E),this.direction1.R(E.direction1),this.direction2.R(E.direction2)}}class I{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(E,t,z,X){const R=A.TmpVectors.Lt[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,z,R);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,z,R);const E=A.TmpVectors.Lt[1];R.subtractToRef(z.position,E),E.scaleToRef(1/z.lifeTime,R)}else R.set(0,0,0);X?t.R(R):A.Lt.TransformNormalToRef(R,E,t)}startPositionFunction(E,t,z,X){const R=A.TmpVectors.Lt[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,z,R):R.set(0,0,0),X?t.R(R):A.Lt.TransformCoordinatesToRef(R,E,t)}clone(){const E=new I;return H.d.DeepCopy(this,E),E}applyToShader(E){}buildUniformLayout(E){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.particlePositionGenerator=this.particlePositionGenerator,E.particleDestinationGenerator=this.particleDestinationGenerator,E}parse(E){E.particlePositionGenerator&&(this.particlePositionGenerator=E.particlePositionGenerator),E.particleDestinationGenerator&&(this.particleDestinationGenerator=E.particleDestinationGenerator)}}var e=z(11894);class D{get mesh(){return this._mesh}set mesh(E){this._mesh!==E&&(this._mesh=E,E?(this._indices=E.dp(),this._positions=E.getVerticesData(e.f.PositionKind),this._normals=E.getVerticesData(e.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=A.Lt.Zero(),this._mesh=null,this.direction1=new A.Lt(0,1,0),this.direction2=new A.Lt(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=E}startDirectionFunction(E,t,z,X){if(this.useMeshNormalsForDirection&&this._normals)return void A.Lt.TransformNormalToRef(this._storedNormal,E,t);const R=(0,Z.RandomRange)(this.direction1.x,this.direction2.x),u=(0,Z.RandomRange)(this.direction1.y,this.direction2.y),p=(0,Z.RandomRange)(this.direction1.z,this.direction2.z);X?t.Op(R,u,p):A.Lt.TransformNormalFromFloatsToRef(R,u,p,E,t)}startPositionFunction(E,t,z,X){if(!this._indices||!this._positions)return;const R=3*(Math.random()*(this._indices.length/3)|0),u=Math.random(),p=Math.random()*(1-u),C=1-u-p,Z=this._indices[R],H=this._indices[R+1],h=this._indices[R+2],d=A.TmpVectors.Lt[0],y=A.TmpVectors.Lt[1],O=A.TmpVectors.Lt[2],c=A.TmpVectors.Lt[3];A.Lt.FromArrayToRef(this._positions,3*Z,d),A.Lt.FromArrayToRef(this._positions,3*H,y),A.Lt.FromArrayToRef(this._positions,3*h,O),c.x=u*d.x+p*y.x+C*O.x,c.y=u*d.y+p*y.y+C*O.y,c.z=u*d.z+p*y.z+C*O.z,X?t.Op(c.x,c.y,c.z):A.Lt.TransformCoordinatesFromFloatsToRef(c.x,c.y,c.z,E,t),this.useMeshNormalsForDirection&&this._normals&&(A.Lt.FromArrayToRef(this._normals,3*Z,d),A.Lt.FromArrayToRef(this._normals,3*H,y),A.Lt.FromArrayToRef(this._normals,3*h,O),this._storedNormal.x=u*d.x+p*y.x+C*O.x,this._storedNormal.y=u*d.y+p*y.y+C*O.y,this._storedNormal.z=u*d.z+p*y.z+C*O.z)}clone(){const E=new D(this.mesh);return H.d.DeepCopy(this,E),E}applyToShader(E){E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var E;const t={};return t.type=this.getClassName(),t.direction1=this.direction1.upE(),t.direction2=this.direction2.upE(),t.meshId=null===(E=this.mesh)||void 0===E?void 0:E.id,t.useMeshNormalsForDirection=this.useMeshNormalsForDirection,t}parse(E,t){A.Lt.FromArrayToRef(E.direction1,0,this.direction1),A.Lt.FromArrayToRef(E.direction2,0,this.direction2),E.meshId&&t&&(this.mesh=t.getLastMeshById(E.meshId)),this.useMeshNormalsForDirection=E.useMeshNormalsForDirection}}class S{_isUbo(E){return void 0!==E.addUniform}constructor(E){this._isUbo(E)?(this.setMatrix3x3=E.updateMatrix3x3.bind(E),this.setMatrix2x2=E.updateMatrix2x2.bind(E),this.setFloat=E.updateFloat.bind(E),this.setFloat2=E.updateFloat2.bind(E),this.setFloat3=E.updateFloat3.bind(E),this.setFloat4=E.updateFloat4.bind(E),this.setFloatArray=E.updateFloatArray.bind(E),this.setArray=E.updateArray.bind(E),this.setIntArray=E.updateIntArray.bind(E),this.setMatrix=E.Zp.bind(E),this.setMatrices=E.updateMatrices.bind(E),this.setVector3=E.updateVector3.bind(E),this.setVector4=E.updateVector4.bind(E),this.setColor3=E.updateColor3.bind(E),this.setColor4=E.updateColor4.bind(E),this.setDirectColor4=E.updateDirectColor4.bind(E),this.setInt=E.updateInt.bind(E),this.setInt2=E.updateInt2.bind(E),this.setInt3=E.updateInt3.bind(E),this.setInt4=E.updateInt4.bind(E)):(this.setMatrix3x3=E.setMatrix3x3.bind(E),this.setMatrix2x2=E.setMatrix2x2.bind(E),this.setFloat=E.setFloat.bind(E),this.setFloat2=E.setFloat2.bind(E),this.setFloat3=E.setFloat3.bind(E),this.setFloat4=E.setFloat4.bind(E),this.setFloatArray=E.setFloatArray.bind(E),this.setArray=E.setArray.bind(E),this.setIntArray=E.setIntArray.bind(E),this.setMatrix=E.setMatrix.bind(E),this.setMatrices=E.setMatrices.bind(E),this.setVector3=E.setVector3.bind(E),this.setVector4=E.setVector4.bind(E),this.setColor3=E.setColor3.bind(E),this.setColor4=E.setColor4.bind(E),this.setDirectColor4=E.setDirectColor4.bind(E),this.setInt=E.setInt.bind(E),this.setInt2=E.setInt2.bind(E),this.setInt3=E.setInt3.bind(E),this.setInt4=E.setInt4.bind(E))}}var l=z(11726);const f="gpuUpdateParticlesPixelShader",K="#version 300 es\nvoid main() {discard;}\n";l.d.ShadersStore[f]||(l.d.ShadersStore[f]=K);const F="gpuUpdateParticlesVertexShader",B="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";l.d.ShadersStore[F]||(l.d.ShadersStore[F]=B);(0,p.f)("BABYLON.WebGL2ParticleSystem",class{constructor(E,t){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=E,this._engine=t,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var E;return(null===(E=this._updateEffect)||void 0===E?void 0:E.isReady())??!1}createUpdateBuffer(E){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof I&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=E,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new S(this._updateEffect)}createVertexBuffers(E,t){this._updateVAO.push(this._createUpdateVAO(E)),this._renderVAO.push(this._engine.recordVertexArrayObject(t,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=t}createParticleBuffer(E){return E}bindDrawBuffers(E,t,z){z?this._engine.bindBuffers(this._renderVertexBuffers,z,t):this._engine.bindVertexArrayObject(this._renderVAO[E],null)}preUpdateParticleBuffer(){const E=this._engine;if(this._engine.enableEffect(this._updateEffect),!E.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(E,t,z){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[E],null);const A=this._engine;A.bindTransformFeedbackBuffer(t.getBuffer()),A.setRasterizerState(!1),A.beginTransformFeedback(!0),A.drawArraysType(3,0,z),A.endTransformFeedback(),A.setRasterizerState(!0),A.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let E=0;E<this._updateVAO.length;E++)this._engine.releaseVertexArrayObject(this._updateVAO[E]);this._updateVAO.length=0;for(let E=0;E<this._renderVAO.length;E++)this._engine.releaseVertexArrayObject(this._renderVAO[E]);this._renderVAO.length=0}_createUpdateVAO(E){const t={};t.position=E.createVertexBuffer("position",0,3);let z=3;t.age=E.createVertexBuffer("age",z,1),z+=1,t.size=E.createVertexBuffer("size",z,3),z+=3,t.life=E.createVertexBuffer("life",z,1),z+=1,t.seed=E.createVertexBuffer("seed",z,4),z+=4,t.direction=E.createVertexBuffer("direction",z,3),z+=3,this._parent.particleEmitterType instanceof I&&(t.initialPosition=E.createVertexBuffer("initialPosition",z,3),z+=3),this._parent._colorGradientsTexture||(t.color=E.createVertexBuffer("color",z,4),z+=4),this._parent._isBillboardBased||(t.initialDirection=E.createVertexBuffer("initialDirection",z,3),z+=3),this._parent.noiseTexture&&(t.noiseCoordinates1=E.createVertexBuffer("noiseCoordinates1",z,3),z+=3,t.noiseCoordinates2=E.createVertexBuffer("noiseCoordinates2",z,3),z+=3),this._parent._angularSpeedGradientsTexture?(t.angle=E.createVertexBuffer("angle",z,1),z+=1):(t.angle=E.createVertexBuffer("angle",z,2),z+=2),this._parent._isAnimationSheetEnabled&&(t.cellIndex=E.createVertexBuffer("cellIndex",z,1),z+=1,this._parent.spriteRandomStartCell&&(t.cellStartOffset=E.createVertexBuffer("cellStartOffset",z,1),z+=1));const A=this._engine.recordVertexArrayObject(t,null,this._updateEffect);return this._engine.bindArrayBuffer(null),A}});class b{constructor(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,A=arguments.length>3?arguments[3]:void 0;this._engine=E,this._label=A,this._engine._storageBuffers.push(this),this._create(t,z)}_create(E,t){this._bufferSize=E,this._creationFlags=t,this._buffer=this._engine.createStorageBuffer(E,t,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(E,t,z){this._buffer&&this._engine.updateStorageBuffer(this._buffer,E,t,z)}async read(E,t,z,A){return await this._engine.readFromStorageBuffer(this._buffer,E,t,z,A)}dispose(){const E=this._engine._storageBuffers,t=E.indexOf(this);-1!==t&&(E[t]=E[E.length-1],E.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var x=z(11792),J=z(11801),V=z(11849),r=z(11790),i=z(12104),g=z(11640),o=z(11756),Q=z(12032);class T{constructor(){this._gpuTimeInFrameId=-1,this.counter=new Q.c}_addDuration(E,t){E<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==E?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(t,!1),this._gpuTimeInFrameId=E):this.counter.addCount(t,!1))}}var q=z(11707);class M{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=E,this._engine=t,this.uniqueId=i.b.UniqueId,t.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new T),this._engine.getCaps().supportComputeShaders?A.bindingsMapping?(this._context=t.createComputeContext(),this._shaderPath=z,this._options={bindingsMapping:{},defines:[],...A}):g.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):g.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(E,t){let z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const A=this._bindings[E];this._bindings[E]={type:z?0:4,object:t,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!A||A.object!==t||A.type!==this._bindings[E].type)}setStorageTexture(E,t){const z=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!z||z.object!==t),this._bindings[E]={type:1,object:t,indexInGroupEntries:null===z||void 0===z?void 0:z.indexInGroupEntries}}setExternalTexture(E,t){const z=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!z||z.object!==t),this._bindings[E]={type:6,object:t,indexInGroupEntries:null===z||void 0===z?void 0:z.indexInGroupEntries}}setVideoTexture(E,t){return!!t.externalTexture&&(this.setExternalTexture(E,t.externalTexture),!0)}setUniformBuffer(E,t){const z=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!z||z.object!==t),this._bindings[E]={type:M._BufferIsDataBuffer(t)?7:2,object:t,indexInGroupEntries:null===z||void 0===z?void 0:z.indexInGroupEntries}}setStorageBuffer(E,t){const z=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!z||z.object!==t),this._bindings[E]={type:M._BufferIsDataBuffer(t)?7:3,object:t,indexInGroupEntries:null===z||void 0===z?void 0:z.indexInGroupEntries}}setTextureSampler(E,t){const z=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!z||!t.compareSampler(z.object)),this._bindings[E]={type:5,object:t,indexInGroupEntries:null===z||void 0===z?void 0:z.indexInGroupEntries}}isReady(){let E=this._effect;for(const X in this._bindings){const E=this._bindings[X],t=E.type,z=E.object;switch(t){case 0:case 4:case 1:if(!z.isReady())return!1;break;case 6:if(!z.isReady())return!1;break}}const t=[],z=this._shaderPath;if(this._options.defines)for(let X=0;X<this._options.defines.length;X++)t.push(this._options.defines[X]);const A=t.join("\n");return this._cachedDefines!==A&&(this._cachedDefines=A,E=this._engine.createComputeEffect(z,{defines:A,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=E),!!E.isReady()}dispatch(E,t,z){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,E,t,z,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const z=M._BufferIsDataBuffer(E)?E:E.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,z,t,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const t in this._bindings){const z=this._bindings[t];if(!this._options.bindingsMapping[t])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+t+"'");switch(z.type){case 0:{const A=this._samplers[t],X=z.object;var E;if(!A||!X._texture||!A.compareSampler(X._texture))this._samplers[t]=(new o.d).setParameters(X.wrapU,X.wrapV,X.wrapR,X.anisotropicFilteringLevel,X._texture.samplingMode,null===(E=X._texture)||void 0===E?void 0:E._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const E=z.object;E.getBuffer()!==z.buffer&&(z.buffer=E.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((X=>{(0,q.e)((()=>this.dispatch(E,t,z)),X,void 0,A)}))}serialize(){const E=V.b.Serialize(this);E.options=this._options,E.shaderPath=this._shaderPath,E.Qd={},E.textures={};for(const t in this._bindings){const z=this._bindings[t],A=z.object;switch(z.type){case 0:case 4:case 1:{const X=A.serialize();X&&(E.textures[t]=X,E.Qd[t]={type:z.type});break}}}return E}static Parse(E,t,z){const A=V.b.Parse((()=>new M(E.name,t.getEngine(),E.shaderPath,E.options)),E,t,z);for(const X in E.textures){const R=E.Qd[X],u=r.d.Parse(E.textures[X],t,z);0===R.type?A.setTexture(X,u):4===R.type?A.setTexture(X,u,!1):A.setStorageTexture(X,u)}return A}static _BufferIsDataBuffer(E){return void 0!==E.underlyingResource}}(0,x.b)([(0,J.K)()],M.prototype,"name",void 0),(0,x.b)([(0,J.K)()],M.prototype,"fastMode",void 0),(0,p.f)("BABYLON.ComputeShader",M);var w=z(12073);const n="gpuUpdateParticlesComputeShader",s="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";l.d.ShadersStoreWGSL[n]||(l.d.ShadersStoreWGSL[n]=s);(0,p.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(E,t){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=E,this._engine=t}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var E;return(null===(E=this._updateComputeShader)||void 0===E?void 0:E.isReady())??!1}createUpdateBuffer(E){var t;const z={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(z.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(z.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(z.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(z.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(z.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(z.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(z.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new M("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:z,defines:E.split("\n")}),null===(t=this._simParamsComputeShader)||void 0===t||t.dispose(),this._simParamsComputeShader=new w.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new S(this._simParamsComputeShader)}createVertexBuffers(E,t){this._renderVertexBuffers.push(t)}createParticleBuffer(E){const t=new b(this._engine,4*E.length,11,"ComputeShaderParticleSystemBuffer");return t.update(E),this._bufferComputeShader.push(t),t.getBuffer()}bindDrawBuffers(E,t,z){this._engine.bindBuffers(this._renderVertexBuffers[E],z,t)}preUpdateParticleBuffer(){}updateParticleBuffer(E,t,z){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[E]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^E]),this._updateComputeShader.dispatch(Math.ceil(z/64))}releaseBuffers(){var E;for(let t=0;t<this._bufferComputeShader.length;++t)this._bufferComputeShader[t].dispose();this._bufferComputeShader.length=0,null===(E=this._simParamsComputeShader)||void 0===E||E.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class j{constructor(E,t,z){this.gradient=E,this.color1=t,this.color2=z}getColorToRef(E){this.color2?u.Lp.LerpToRef(this.color1,this.color2,Math.random(),E):E.R(this.color1)}}class U{constructor(E,t){this.gradient=E,this.color=t}}class k{constructor(E,t,z){this.gradient=E,this.factor1=t,this.factor2=z}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class v{static GetCurrentGradient(E,t,z){if(t[0].gradient>E)return void z(t[0],t[0],1);for(let X=0;X<t.length-1;X++){const A=t[X],R=t[X+1];if(E>=A.gradient&&E<=R.gradient){return void z(A,R,(E-A.gradient)/(R.gradient-A.gradient))}}const A=t.length-1;z(t[A],t[A],1)}}var Y=z(11632),G=z(12279),N=z(11667);class P{constructor(E){this.particleSystem=E,this.position=A.Lt.Zero(),this.direction=A.Lt.Zero(),this.color=new u.Lp(0,0,0,0),this.colorStep=new u.Lp(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new A.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new u.Lp(0,0,0,0),this._currentColor2=new u.Lp(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=P._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let E=this.age,t=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===t?(t=1,E=this._randomCellOffset):E+=this._randomCellOffset);const z=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let A;A=this._initialSpriteCellLoop?(0,Z.Clamp)(E*t%this.lifeTime/this.lifeTime):(0,Z.Clamp)(E*t/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+A*z|0}_inheritParticleInfoToSubEmitter(E){if(E.particleSystem.Xt.position){const t=E.particleSystem.Xt;if(t.position.R(this.position),E.inheritDirection){const E=A.TmpVectors.Lt[0];this.direction.normalizeToRef(E),t.setDirection(E,0,Math.PI/2)}}else{E.particleSystem.Xt.R(this.position)}this.direction.scaleToRef(E.inheritedVelocityAmount/2,A.TmpVectors.Lt[0]),E.particleSystem._inheritedVelocityOffset.R(A.TmpVectors.Lt[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const E of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(E)}_reset(){this.age=0,this.id=P._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(E){E.position.R(this.position),this._initialDirection?E._initialDirection?E._initialDirection.R(this._initialDirection):E._initialDirection=this._initialDirection.clone():E._initialDirection=null,E.direction.R(this.direction),this.Mp&&(E.Mp?E.Mp.R(this.Mp):E.Mp=this.Mp.clone()),E.color.R(this.color),E.colorStep.R(this.colorStep),E.lifeTime=this.lifeTime,E.age=this.age,E._randomCellOffset=this._randomCellOffset,E.size=this.size,E.scale.R(this.scale),E.angle=this.angle,E.angularSpeed=this.angularSpeed,E.particleSystem=this.particleSystem,E.cellIndex=this.cellIndex,E.id=this.id,E._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(E._currentColorGradient=this._currentColorGradient,E._currentColor1.R(this._currentColor1),E._currentColor2.R(this._currentColor2)),this._currentSizeGradient&&(E._currentSizeGradient=this._currentSizeGradient,E._currentSize1=this._currentSize1,E._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(E._currentAngularSpeedGradient=this._currentAngularSpeedGradient,E._currentAngularSpeed1=this._currentAngularSpeed1,E._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(E._currentVelocityGradient=this._currentVelocityGradient,E._currentVelocity1=this._currentVelocity1,E._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(E._currentLimitVelocityGradient=this._currentLimitVelocityGradient,E._currentLimitVelocity1=this._currentLimitVelocity1,E._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(E._currentDragGradient=this._currentDragGradient,E._currentDrag1=this._currentDrag1,E._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(E._initialStartSpriteCellId=this._initialStartSpriteCellId,E._initialEndSpriteCellId=this._initialEndSpriteCellId,E._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(E.remapData&&this.remapData?E.remapData.R(this.remapData):E.remapData=new A.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(E._randomNoiseCoordinates1?(E._randomNoiseCoordinates1.R(this._randomNoiseCoordinates1),E._randomNoiseCoordinates2.R(this._randomNoiseCoordinates2)):(E._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),E._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}P._Count=0;var EE=z(11951),tE=(z(11978),z(12168)),zE=z(12162),AE=z(12067);function XE(E,t){const z=(0,Z.RandomRange)(0,1);u.Lp.LerpToRef(t.color1,t.color2,z,E.color),t.colorDead.subtractToRef(E.color,t._colorDiff),t._colorDiff.scaleToRef(1/E.lifeTime,E.colorStep)}function RE(E,t){E._currentColorGradient=t._colorGradients[0],E._currentColorGradient.getColorToRef(E.color),E._currentColor1.R(E.color),t._colorGradients.length>1?t._colorGradients[1].getColorToRef(E._currentColor2):E._currentColor2.R(E.color)}function uE(E,t){const z=t._colorGradients;v.GetCurrentGradient(t._ratio,z,((t,z,A)=>{t!==E._currentColorGradient&&(E._currentColor1.R(E._currentColor2),z.getColorToRef(E._currentColor2),E._currentColorGradient=t),u.Lp.LerpToRef(E._currentColor1,E._currentColor2,A,E.color)}))}function pE(E,t){E.colorStep.scaleToRef(t._scaledUpdateSpeed,t._scaledColorStep),E.color.addInPlace(t._scaledColorStep),E.color.a<0&&(E.color.a=0)}function CE(E,t){v.GetCurrentGradient(t._ratio,t._angularSpeedGradients,((t,z,A)=>{t!==E._currentAngularSpeedGradient&&(E._currentAngularSpeed1=E._currentAngularSpeed2,E._currentAngularSpeed2=z.getFactor(),E._currentAngularSpeedGradient=t),E.angularSpeed=(0,Z.Lerp)(E._currentAngularSpeed1,E._currentAngularSpeed2,A)}))}function ZE(E,t){E.angle+=E.angularSpeed*t._scaledUpdateSpeed}function HE(E,t){t.particleEmitterType.startDirectionFunction(t._emitterWorldMatrix,E.direction,E,t.isLocal,t._emitterInverseWorldMatrix)}function hE(E,t){t.startDirectionFunction(t._emitterWorldMatrix,E.direction,E,t.isLocal)}function dE(E,t){E._currentVelocityGradient=t._velocityGradients[0],E._currentVelocity1=E._currentVelocityGradient.getFactor(),t._velocityGradients.length>1?E._currentVelocity2=t._velocityGradients[1].getFactor():E._currentVelocity2=E._currentVelocity1}function yE(E,t){E._currentLimitVelocityGradient=t._limitVelocityGradients[0],E._currentLimitVelocity1=E._currentLimitVelocityGradient.getFactor(),t._limitVelocityGradients.length>1?E._currentLimitVelocity2=t._limitVelocityGradients[1].getFactor():E._currentLimitVelocity2=E._currentLimitVelocity1}function OE(E,t){v.GetCurrentGradient(t._ratio,t._velocityGradients,((z,A,X)=>{z!==E._currentVelocityGradient&&(E._currentVelocity1=E._currentVelocity2,E._currentVelocity2=A.getFactor(),E._currentVelocityGradient=z),t._directionScale*=(0,Z.Lerp)(E._currentVelocity1,E._currentVelocity2,X)}))}function cE(E,t){v.GetCurrentGradient(t._ratio,t._limitVelocityGradients,((z,A,X)=>{z!==E._currentLimitVelocityGradient&&(E._currentLimitVelocity1=E._currentLimitVelocity2,E._currentLimitVelocity2=A.getFactor(),E._currentLimitVelocityGradient=z);const R=(0,Z.Lerp)(E._currentLimitVelocity1,E._currentLimitVelocity2,X);E.direction.length()>R&&E.direction.scaleInPlace(t.limitVelocityDamping)}))}function aE(E,t){E.direction.scaleToRef(t._directionScale,t._scaledDirection)}function LE(E,t){t.particleEmitterType.startPositionFunction(t._emitterWorldMatrix,E.position,E,t.isLocal)}function mt(E,t){t.startPositionFunction(t._emitterWorldMatrix,E.position,E,t.isLocal)}function WE(E,t){E.Mp?E.Mp.R(E.position):E.Mp=E.position.clone(),A.Lt.TransformCoordinatesToRef(E.Mp,t._emitterWorldMatrix,E.position)}function IE(E,t){t.isLocal&&E.Mp?(E.Mp.addInPlace(t._scaledDirection),A.Lt.TransformCoordinatesToRef(E.Mp,t._emitterWorldMatrix,E.position)):E.position.addInPlace(t._scaledDirection)}function eE(E,t){E._currentDragGradient=t._dragGradients[0],E._currentDrag1=E._currentDragGradient.getFactor(),t._dragGradients.length>1?E._currentDrag2=t._dragGradients[1].getFactor():E._currentDrag2=E._currentDrag1}function DE(E,t){v.GetCurrentGradient(t._ratio,t._dragGradients,((z,A,X)=>{z!==E._currentDragGradient&&(E._currentDrag1=E._currentDrag2,E._currentDrag2=A.getFactor(),E._currentDragGradient=z);const R=(0,Z.Lerp)(E._currentDrag1,E._currentDrag2,X);t._scaledDirection.scaleInPlace(1-R)}))}function SE(E,t){E._randomNoiseCoordinates1?(E._randomNoiseCoordinates1.Op(Math.random(),Math.random(),Math.random()),E._randomNoiseCoordinates2.Op(Math.random(),Math.random(),Math.random())):(E._randomNoiseCoordinates1=new A.Lt(Math.random(),Math.random(),Math.random()),E._randomNoiseCoordinates2=new A.Lt(Math.random(),Math.random(),Math.random()))}function lE(E,t){const z=t._noiseTextureData,X=t._noiseTextureSize;if(z&&X&&E._randomNoiseCoordinates1){const R=t._fetchR(E._randomNoiseCoordinates1.x,E._randomNoiseCoordinates1.y,X.width,X.height,z),u=t._fetchR(E._randomNoiseCoordinates1.z,E._randomNoiseCoordinates2.x,X.width,X.height,z),p=t._fetchR(E._randomNoiseCoordinates2.y,E._randomNoiseCoordinates2.z,X.width,X.height,z),C=A.TmpVectors.Lt[0],Z=A.TmpVectors.Lt[1];C.Op((2*R-1)*t.noiseStrength.x,(2*u-1)*t.noiseStrength.y,(2*p-1)*t.noiseStrength.z),C.scaleToRef(t._tempScaledUpdateSpeed,Z),E.direction.addInPlace(Z)}}function fE(E,t){t.gravity.scaleToRef(t._tempScaledUpdateSpeed,t._scaledGravity),E.direction.addInPlace(t._scaledGravity)}function KE(E,t){E.size=(0,Z.RandomRange)(t.minSize,t.maxSize),E.scale.Op((0,Z.RandomRange)(t.minScaleX,t.maxScaleX),(0,Z.RandomRange)(t.minScaleY,t.maxScaleY))}function FE(E,t){E._currentSizeGradient=t._sizeGradients[0],E._currentSize1=E._currentSizeGradient.getFactor(),E.size=E._currentSize1,t._sizeGradients.length>1?E._currentSize2=t._sizeGradients[1].getFactor():E._currentSize2=E._currentSize1,E.scale.Op((0,Z.RandomRange)(t.minScaleX,t.maxScaleX),(0,Z.RandomRange)(t.minScaleY,t.maxScaleY))}function BE(E,t){const z=t._actualFrame/t.targetStopDuration;v.GetCurrentGradient(z,t._startSizeGradients,((z,A,X)=>{z!==t._currentStartSizeGradient&&(t._currentStartSize1=t._currentStartSize2,t._currentStartSize2=A.getFactor(),t._currentStartSizeGradient=z);const R=(0,Z.Lerp)(t._currentStartSize1,t._currentStartSize2,X);E.scale.scaleInPlace(R)}))}function bE(E,t){v.GetCurrentGradient(t._ratio,t._sizeGradients,((t,z,A)=>{t!==E._currentSizeGradient&&(E._currentSize1=E._currentSize2,E._currentSize2=z.getFactor(),E._currentSizeGradient=t),E.size=(0,Z.Lerp)(E._currentSize1,E._currentSize2,A)}))}function xE(E,t){E.remapData=new A.Vector4(0,1,0,1)}function JE(E,t){t._colorRemapGradients&&t._colorRemapGradients.length>0&&v.GetCurrentGradient(t._ratio,t._colorRemapGradients,((t,z,A)=>{const X=(0,Z.Lerp)(t.factor1,z.factor1,A),R=(0,Z.Lerp)(t.factor2,z.factor2,A);E.remapData.x=X,E.remapData.y=R-X})),t._alphaRemapGradients&&t._alphaRemapGradients.length>0&&v.GetCurrentGradient(t._ratio,t._alphaRemapGradients,((t,z,A)=>{const X=(0,Z.Lerp)(t.factor1,z.factor1,A),R=(0,Z.Lerp)(t.factor2,z.factor2,A);E.remapData.z=X,E.remapData.w=R-X}))}function VE(E,t){const z=(0,Z.Clamp)(t._actualFrame/t.targetStopDuration);v.GetCurrentGradient(z,t._lifeTimeGradients,((t,A)=>{const X=t,R=A,u=X.getFactor(),p=R.getFactor(),C=(z-X.gradient)/(R.gradient-X.gradient);E.lifeTime=(0,Z.Lerp)(u,p,C)})),t._emitPower=(0,Z.RandomRange)(t.minEmitPower,t.maxEmitPower)}function rE(E,t){E.lifeTime=(0,Z.RandomRange)(t.minLifeTime,t.maxLifeTime),t._emitPower=(0,Z.RandomRange)(t.minEmitPower,t.maxEmitPower)}function iE(E,t){0===t._emitPower?(E._initialDirection?E._initialDirection.R(E.direction):E._initialDirection=E.direction.clone(),E.direction.set(0,0,0)):(E._initialDirection=null,E.direction.scaleInPlace(t._emitPower)),E.direction.addInPlace(t._inheritedVelocityOffset)}function gE(E,t){E.angularSpeed=(0,Z.RandomRange)(t.minAngularSpeed,t.maxAngularSpeed),E.angle=(0,Z.RandomRange)(t.minInitialRotation,t.maxInitialRotation)}function oE(E,t){E._currentAngularSpeedGradient=t._angularSpeedGradients[0],E.angularSpeed=E._currentAngularSpeedGradient.getFactor(),E._currentAngularSpeed1=E.angularSpeed,t._angularSpeedGradients.length>1?E._currentAngularSpeed2=t._angularSpeedGradients[1].getFactor():E._currentAngularSpeed2=E._currentAngularSpeed1,E.angle=(0,Z.RandomRange)(t.minInitialRotation,t.maxInitialRotation)}function QE(E,t){E._initialStartSpriteCellId=t.startSpriteCellID,E._initialEndSpriteCellId=t.endSpriteCellID,E._initialSpriteCellLoop=t.spriteCellLoop}function TE(E,t){E.previousItem=t.previousItem,E.nextItem=t,t.previousItem&&(t.previousItem.nextItem=E),t.previousItem=E}function qE(E,t){E.previousItem=t,E.nextItem=t.nextItem,t.nextItem&&(t.nextItem.previousItem=E),t.nextItem=E}function ME(E,t){let z=t;for(;z.nextItem;)z=z.nextItem;E.previousItem=z,E.nextItem=z.nextItem,z.nextItem=E}function wE(E){E.previousItem&&(E.previousItem.nextItem=E.nextItem),E.nextItem&&(E.nextItem.previousItem=E.previousItem)}class nE extends C{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(E){this._startDirectionFunction!==E&&(this._startDirectionFunction=E,this._directionProcessing.process=E?hE:HE)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(E){this._startPositionFunction!==E&&(this._startPositionFunction=E,this._positionCreation.process=E?mt:LE)}set onDispose(E){this._onDisposeObserver&&this.IX.remove(this._onDisposeObserver),this._onDisposeObserver=this.IX.add(E)}get C(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(E){this._useRampGradients!==E&&(this._useRampGradients=E,this._resetEffect(),E?(this._rampCreation={process:xE,previousItem:null,nextItem:null},qE(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:JE,previousItem:null,nextItem:null},qE(this._remapGradientProcessing,this._gravityProcessing)):(wE(this._rampCreation),wE(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(E){this._isLocal!==E&&(this._isLocal=E,E?(this._isLocalCreation={process:WE,previousItem:null,nextItem:null},qE(this._isLocalCreation,this._positionCreation)):wE(this._isLocalCreation))}get particles(){return this.xd}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(E){this._animationSheetEnabled!==E&&(this._animationSheetEnabled=E,E?(this._sheetCreation={process:QE,previousItem:null,nextItem:null},qE(this._sheetCreation,this._colorCreation)):wE(this._sheetCreation),this._reset())}getActiveCount(){return this.xd.length}getClassName(){return"ip"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var E;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(E=this._customWrappers[t])||void 0===E?void 0:E.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[E]??this._customWrappers[0]}setCustomEffect(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[t]=new EE.b(this._engine),this._customWrappers[t].effect=E,this._customWrappers[t].drawContext&&(this._customWrappers[t].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Y.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(E){if(this.noiseTexture!==E){if(this._noiseTexture=E,!E)return wE(this._noiseCreation),void wE(this._noiseProcessing);this._noiseCreation={process:SE,previousItem:null,nextItem:null},qE(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:lE,previousItem:null,nextItem:null},qE(this._noiseProcessing,this._positionProcessing)}}constructor(E,t,z){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,C=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(E),this._emitterInverseWorldMatrix=A.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new A.Lt,this.IX=new Y.b,this.onStoppedObservable=new Y.b,this.onStartedObservable=new Y.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.xd=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new u.Lp(0,0,0,0),this._colorDiff=new u.Lp(0,0,0,0),this._scaledDirection=A.Lt.Zero(),this._scaledGravity=A.Lt.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=E=>{},this.recycleParticle=E=>{const t=this.xd.pop();t!==E&&t.copyTo(E),this._stockParticles.push(t)},this._createParticle=()=>{let E;return 0!==this._stockParticles.length?(E=this._stockParticles.pop(),E._reset()):E=new P(this),this._prepareParticle(E),E},this.paused=!1,this._shadersLoaded=!1,this._capacity=t,this._epsilon=p,z&&"Scene"!==z.getClassName()?(this._engine=z,this.defaultProjectionMatrix=A.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=z||N.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Kd.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:rE,previousItem:null,nextItem:null},this._positionCreation={process:LE,previousItem:null,nextItem:null},qE(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:HE,previousItem:null,nextItem:null},qE(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:iE,previousItem:null,nextItem:null},qE(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:KE,previousItem:null,nextItem:null},qE(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:gE,previousItem:null,nextItem:null},qE(this._angleCreation,this._sizeCreation),this._colorCreation={process:XE,previousItem:null,nextItem:null},qE(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,C||(this._colorProcessing={process:pE,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:ZE,previousItem:null,nextItem:null},qE(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:aE,previousItem:null,nextItem:null},qE(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:IE,previousItem:null,nextItem:null},qE(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:fE,previousItem:null,nextItem:null},qE(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=R,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new EE.b(this._engine)},this._customWrappers[0].effect=X,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new h,this.updateFunction=E=>{var t;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(t=this.noiseTexture.getContent())||void 0===t||t.then((E=>{this._noiseTextureData=E})));const z=E===this.xd;for(let A=0;A<E.length;A++){const t=E[A];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const X=t.age;if(t.age+=this._tempScaledUpdateSpeed,t.age>t.lifeTime){const E=t.age-X,z=t.lifeTime-X;this._tempScaledUpdateSpeed=z*this._tempScaledUpdateSpeed/E,t.age=t.lifeTime}this._ratio=t.age/t.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let R=this._updateQueueStart;for(;R;)R.process(t,this),R=R.nextItem;if(this._isAnimationSheetEnabled&&!C&&t.updateCellIndex(),t._inheritParticleInfoToSubEmitters(),t.age>=t.lifeTime){if(this._emitFromParticle(t),t._attachedSubEmitters){for(const E of t._attachedSubEmitters)E.particleSystem.disposeOnStop=!0,E.particleSystem.stop();t._attachedSubEmitters=null}this.recycleParticle(t),z&&A--}else;}}}serialize(E){throw new Error("Method not implemented.")}clone(E,t){throw new Error("Method not implemented.")}_addFactorGradient(E,t,z,A){const X=new k(t,z,A);E.push(X),E.sort(((E,t)=>E.gradient<t.gradient?-1:E.gradient>t.gradient?1:0))}_removeFactorGradient(E,t){if(!E)return;let z=0;for(const A of E){if(A.gradient===t){E.splice(z,1);break}z++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=VE:this._lifeTimeCreation.process=rE}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:BE,previousItem:null,nextItem:null},qE(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(wE(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(E){this.targetStopDuration!==E&&(this._targetStopDuration=E,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(E,t,z){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,E,t,z),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(E){return this._removeFactorGradient(this._lifeTimeGradients,E),this._syncLifeTimeCreation(),this}addSizeGradient(E,t,z){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=FE,this._sizeGradientProcessing={process:bE,previousItem:null,nextItem:null},TE(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,E,t,z),this}removeSizeGradient(E){var t;return this._removeFactorGradient(this._sizeGradients,E),0===(null===(t=this._sizeGradients)||void 0===t?void 0:t.length)&&(wE(this._sizeGradientProcessing),this._sizeCreation.process=KE),this}addColorRemapGradient(E,t,z){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,E,t,z),this}removeColorRemapGradient(E){return this._removeFactorGradient(this._colorRemapGradients,E),this}addAlphaRemapGradient(E,t,z){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,E,t,z),this}removeAlphaRemapGradient(E){return this._removeFactorGradient(this._alphaRemapGradients,E),this}addAngularSpeedGradient(E,t,z){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=oE,this._angularSpeedGradientProcessing={process:CE,previousItem:null,nextItem:null},TE(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,E,t,z),this}removeAngularSpeedGradient(E){var t;return this._removeFactorGradient(this._angularSpeedGradients,E),0===(null===(t=this._angularSpeedGradients)||void 0===t?void 0:t.length)&&(this._angleCreation.process=gE,wE(this._angularSpeedGradientProcessing)),this}addVelocityGradient(E,t,z){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:dE,previousItem:null,nextItem:null},qE(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:OE,previousItem:null,nextItem:null},TE(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,E,t,z),this}removeVelocityGradient(E){var t;return this._removeFactorGradient(this._velocityGradients,E),0===(null===(t=this._velocityGradients)||void 0===t?void 0:t.length)&&(wE(this._velocityCreation),wE(this._velocityGradientProcessing)),this}addLimitVelocityGradient(E,t,z){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:yE,previousItem:null,nextItem:null},qE(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:cE,previousItem:null,nextItem:null},qE(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,E,t,z),this}removeLimitVelocityGradient(E){var t;return this._removeFactorGradient(this._limitVelocityGradients,E),0===(null===(t=this._limitVelocityGradients)||void 0===t?void 0:t.length)&&(wE(this._limitVelocityCreation),wE(this._limitVelocityGradientProcessing)),this}addDragGradient(E,t,z){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:eE,previousItem:null,nextItem:null},TE(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:DE,previousItem:null,nextItem:null},TE(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,E,t,z),this}removeDragGradient(E){var t;return this._removeFactorGradient(this._dragGradients,E),0===(null===(t=this._dragGradients)||void 0===t?void 0:t.length)&&(wE(this._dragCreation),wE(this._dragGradientProcessing)),this}addEmitRateGradient(E,t,z){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,E,t,z),this}removeEmitRateGradient(E){return this._removeFactorGradient(this._emitRateGradients,E),this}addStartSizeGradient(E,t,z){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,E,t,z),this._syncStartSizeCreation(),this}removeStartSizeGradient(E){return this._removeFactorGradient(this._startSizeGradients,E),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const E=new Uint8Array(4*this._rawTextureWidth),t=u.TmpColors.Dt[0];for(let z=0;z<this._rawTextureWidth;z++){const A=z/this._rawTextureWidth;v.GetCurrentGradient(A,this._rampGradients,((A,X,R)=>{u.Dt.LerpToRef(A.color,X.color,R,t),E[4*z]=255*t.r,E[4*z+1]=255*t.g,E[4*z+2]=255*t.b,E[4*z+3]=255}))}this._rampGradientsTexture=G.d.CreateRGBATexture(E,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((E,t)=>E.gradient<t.gradient?-1:E.gradient>t.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(E,t){this._rampGradients||(this._rampGradients=[]);const z=new U(E,t);return this._rampGradients.push(z),this._syncRampGradientTexture(),this}removeRampGradient(E){return this._removeGradientAndTexture(E,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(E,t,z){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=RE,this._colorProcessing.process=uE);const A=new j(E,t,z);return this._colorGradients.push(A),this._colorGradients.sort(((E,t)=>E.gradient<t.gradient?-1:E.gradient>t.gradient?1:0)),this}removeColorGradient(E){if(!this._colorGradients)return this;let t=0;for(const z of this._colorGradients){if(z.gradient===E){this._colorGradients.splice(t,1);break}t++}return 0===this._colorGradients.length&&(this._colorCreation.process=XE,this._colorProcessing.process=pE),this}resetDrawCache(){if(this._drawWrappers){for(const E of this._drawWrappers)if(E)for(const t of E)null===t||void 0===t||t.dispose();this._drawWrappers=[]}}_fetchR(E,t,z,A,X){return X[4*(((E=.5*Math.abs(E)+.5)*z%z|0)+((t=.5*Math.abs(t)+.5)*A%A|0)*z)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const E=this._engine,t=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*t),this._vertexBuffer=new e.b(E,this._vertexData,!0,t);let z=0;const A=this._vertexBuffer.createVertexBuffer(e.f.PositionKind,z,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[e.f.PositionKind]=A,z+=3;const X=this._vertexBuffer.createVertexBuffer(e.f.ColorKind,z,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[e.f.ColorKind]=X,z+=4;const R=this._vertexBuffer.createVertexBuffer("angle",z,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=R,z+=1;const u=this._vertexBuffer.createVertexBuffer("size",z,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=u,z+=2,this._isAnimationSheetEnabled){const E=this._vertexBuffer.createVertexBuffer("cellIndex",z,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=E,z+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const E=this._vertexBuffer.createVertexBuffer("direction",z,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=E,z+=3}if(this._useRampGradients){const E=this._vertexBuffer.createVertexBuffer("remapData",z,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=E,z+=4}let p;if(this._useInstancing){const t=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new e.b(E,t,!1,2),p=this._spriteBuffer.createVertexBuffer("offset",0,2)}else p=this._vertexBuffer.createVertexBuffer("offset",z,2,this._vertexBufferSize,this._useInstancing),z+=2;this._vertexBuffers.offset=p,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const E=[],t=[];let z=0;for(let A=0;A<this._capacity;A++)E.push(z),E.push(z+1),E.push(z+2),E.push(z),E.push(z+2),E.push(z+3),t.push(z,z+1,z+1,z+2,z+2,z+3,z+3,z,z,z+3),z+=4;this._indexBuffer=this._engine.createIndexBuffer(E),this._linesIndexBuffer=this._engine.createIndexBuffer(t)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(E)setTimeout((()=>{this.start(0)}),E);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var t;-1!==(null===(t=this.Xt)||void 0===t?void 0:t.getClassName().indexOf("Mesh"))&&this.Xt.Hp(!0);const E=this.noiseTexture;if(E&&E.onGeneratedObservable)E.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let t=0;t<this.preWarmCycles;t++)this.animate(!0),E.render()}))}));else for(let t=0;t<this.preWarmCycles;t++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(E))}_postStop(E){}reset(){this._stockParticles.length=0,this.xd.length=0}_appendParticleVertex(E,t,z,X){let R=E*this._vertexBufferSize;if(this._vertexData[R++]=t.position.x+this.CZ.x,this._vertexData[R++]=t.position.y+this.CZ.y,this._vertexData[R++]=t.position.z+this.CZ.z,this._vertexData[R++]=t.color.r,this._vertexData[R++]=t.color.g,this._vertexData[R++]=t.color.b,this._vertexData[R++]=t.color.a,this._vertexData[R++]=t.angle,this._vertexData[R++]=t.scale.x*t.size,this._vertexData[R++]=t.scale.y*t.size,this._isAnimationSheetEnabled&&(this._vertexData[R++]=t.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[R++]=t.direction.x,this._vertexData[R++]=t.direction.y,this._vertexData[R++]=t.direction.z);else if(t._initialDirection){let E=t._initialDirection;this.isLocal&&(A.Lt.TransformNormalToRef(E,this._emitterWorldMatrix,A.TmpVectors.Lt[0]),E=A.TmpVectors.Lt[0]),0===E.x&&0===E.z&&(E.x=.001),this._vertexData[R++]=E.x,this._vertexData[R++]=E.y,this._vertexData[R++]=E.z}else{let E=t.direction;this.isLocal&&(A.Lt.TransformNormalToRef(E,this._emitterWorldMatrix,A.TmpVectors.Lt[0]),E=A.TmpVectors.Lt[0]),0===E.x&&0===E.z&&(E.x=.001),this._vertexData[R++]=E.x,this._vertexData[R++]=E.y,this._vertexData[R++]=E.z}this._useRampGradients&&t.remapData&&(this._vertexData[R++]=t.remapData.x,this._vertexData[R++]=t.remapData.y,this._vertexData[R++]=t.remapData.z,this._vertexData[R++]=t.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===z?z=this._epsilon:1===z&&(z=1-this._epsilon),0===X?X=this._epsilon:1===X&&(X=1-this._epsilon)),this._vertexData[R++]=z,this._vertexData[R++]=X)}_prepareParticle(E){}_createNewOnes(E){let t;for(let z=0;z<E&&this.xd.length!==this._capacity;z++){t=this._createParticle(),this.xd.push(t);let E=this._createQueueStart;for(;E;)E.process(t,this),E=E.nextItem;t._inheritParticleInfoToSubEmitters()}}_update(E){if(this._alive=this.xd.length>0,this.Xt.position){const E=this.Xt;this._emitterWorldMatrix=E.getWorldMatrix()}else{const E=this.Xt;this._emitterWorldMatrix=A.Matrix.Translation(E.x,E.y,E.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.xd),this._createNewOnes(E)}static _GetAttributeNamesOrOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=[e.f.PositionKind,e.f.ColorKind,"angle","offset","size"];return E&&A.push("cellIndex"),t||A.push("direction"),z&&A.push("remapData"),A}static _GetEffectCreationOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,tE.d)(A),E&&A.push("particlesInfos"),t&&A.push("logarithmicDepthConstant"),z&&(A.push("vFogInfos"),A.push("vFogColor")),A}fillDefines(E,t){let z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,tE.k)(this,this._scene,E),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&E.push("#define FOG")),this._isAnimationSheetEnabled&&E.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&E.push("#define LOGARITHMICDEPTH"),t===C.BLENDMODE_MULTIPLY&&E.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&E.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(E.push("#define BILLBOARD"),this.billboardMode){case 2:E.push("#define BILLBOARDY");break;case 8:case 9:E.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&E.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:E.push("#define BILLBOARDMODE_ALL")}z&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),E.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(E,t,z){t.push(...nE._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),E.push(...nE._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),z.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,AE.e)(E,this._imageProcessingConfigurationDefines),(0,AE.d)(z,this._imageProcessingConfigurationDefines))}_getWrapper(E){const t=this._getCustomDrawWrapper(E);if(null!==t&&void 0!==t&&t.effect)return t;const z=[];this.fillDefines(z,E);const A=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let X=this._drawWrappers[A];X||(X=this._drawWrappers[A]=[]);let R=X[E];R||(R=new EE.b(this._engine),R.drawContext&&(R.drawContext.useInstancing=this._useInstancing),X[E]=R);const u=z.join("\n");if(R.defines!==u){const E=[],t=[],z=[];this.fillUniformsAttributesAndSamplerNames(t,E,z),R.setEffect(this._engine.createEffect("particles",E,t,z,u,void 0,void 0,void 0,void 0,this._shaderLanguage),u)}return R}animate(){var E;let t,z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!z&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(z?this.preWarmStepOffset:(null===(E=this._scene)||void 0===E?void 0:E.getAnimationRatio())||1),this.manualEmitCount>-1)t=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let E=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const t=this._actualFrame/this.targetStopDuration;v.GetCurrentGradient(t,this._emitRateGradients,((t,z,A)=>{t!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=z.getFactor(),this._currentEmitRateGradient=t),E=(0,Z.Lerp)(this._currentEmitRate1,this._currentEmitRate2,A)}))}t=E*this._scaledUpdateSpeed|0,this._newPartsExcess+=E*this._scaledUpdateSpeed-t}if(this._newPartsExcess>1&&(t+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?t=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(t),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!z){let E=0;for(let t=0;t<this.xd.length;t++){const z=this.xd[t];this._appendParticleVertices(E,z),E+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.xd.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(E,t){this._appendParticleVertex(E++,t,0,0),this._useInstancing||(this._appendParticleVertex(E++,t,1,0),this._appendParticleVertex(E++,t,1,1),this._appendParticleVertex(E++,t,0,1))}rebuild(){var E;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(E=this._spriteBuffer)||void 0===E||E._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!nE.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(z.bind(z,13258)),Promise.resolve().then(z.bind(z,13206))])):await Promise.all([Promise.resolve().then(z.bind(z,13195)),Promise.resolve().then(z.bind(z,13180))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Xt||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==C.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(C.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(C.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(E){const t=this._getWrapper(E),z=t.effect,X=this._engine;X.enableEffect(t);const R=this.defaultViewMatrix??this._scene.getViewMatrix();if(z.setTexture("diffuseSampler",this.particleTexture),z.setMatrix("view",R),z.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const E=this.particleTexture.getBaseSize();z.setFloat3("particlesInfos",this.spriteCellWidth/E.width,this.spriteCellHeight/E.height,this.spriteCellWidth/E.width)}if(z.setVector2("translationPivot",this.translationPivot),z.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const E=this._scene.activeCamera;z.setVector3("eyePosition",E.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),z.setTexture("rampSampler",this._rampGradientsTexture));const u=z.defines;var p,C,Z,H,h,d;(this._scene&&((0,tE.g)(z,this,this._scene),this.applyFog&&(0,zE.i)(this._scene,void 0,z)),u.indexOf("#define BILLBOARDMODE_ALL")>=0&&(R.invertToRef(A.TmpVectors.Matrix[0]),z.setMatrix("invView",A.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?X.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,z):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,z)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?X.bindBuffers(this._vertexBuffers,null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._linesIndexBuffer:this._indexBuffer,z):X.bindBuffers(this._vertexBuffers,null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?this._linesIndexBufferUseInstancing:null,z);(this.useLogarithmicDepth&&this._scene&&(0,zE.o)(u,z,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(z),this._setEngineBasedOnBlendMode(E),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(z),this._useInstancing)?null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?X.drawElementsType(6,0,10,this.xd.length):X.drawArraysType(7,0,4,this.xd.length):null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?X.drawElementsType(1,0,10*this.xd.length):X.drawElementsType(0,0,6*this.xd.length);return this.xd.length}render(){if(!this.isReady()||!this.xd.length)return 0;const E=this._engine;E.setState&&(E.setState(!1),this.forceDepthWrite&&E.setDepthWrite(!0));let t=0;return t=this.blendMode===C.BLENDMODE_MULTIPLYADD?this._render(C.BLENDMODE_MULTIPLY)+this._render(C.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),t}_onDispose(){}dispose(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),E&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),E&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(t,z),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const E=this._scene.Kd.indexOf(this);E>-1&&this._scene.Kd.splice(E,1),this._scene._activeParticleSystems.dispose()}this.IX.notifyObservers(this),this.IX.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}nE.ForceGLSL=!1;var sE,jE=z(11657);!function(E){E[E.ATTACHED=0]="ATTACHED",E[E.END=1]="END"}(sE||(sE={}));class UE{constructor(E){if(this.particleSystem=E,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!E.Xt||!E.Xt.dispose){const t=(0,p.d)("BABYLON.AbstractMesh");E.Xt=new t("SubemitterSystemEmitter",E.lE()),E._disposeEmitterOnDispose=!0}}clone(){let E=this.particleSystem.Xt;if(E){if(E instanceof A.Lt)E=E.clone();else if(-1!==E.getClassName().indexOf("Mesh")){E=new((0,p.d)("BABYLON.Mesh"))("",E.lE()),E.isVisible=!1}}else E=new A.Lt;const t=new UE(this.particleSystem.clone(this.particleSystem.name,E));return t.particleSystem.name+="Clone",t.type=this.type,t.inheritDirection=this.inheritDirection,t.inheritedVelocityAmount=this.inheritedVelocityAmount,t.particleSystem._disposeEmitterOnDispose=!0,t.particleSystem.disposeOnStop=!0,t}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t={};return t.type=this.type,t.inheritDirection=this.inheritDirection,t.inheritedVelocityAmount=this.inheritedVelocityAmount,t.particleSystem=this.particleSystem.serialize(E),t}static _ParseParticleSystem(E,t,z){throw(0,jE.b)("ParseParticle")}static Parse(E,t,z){const A=E.particleSystem,X=new UE(UE._ParseParticleSystem(A,t,z,!0));return X.type=E.type,X.inheritDirection=E.inheritDirection,X.inheritedVelocityAmount=E.inheritedVelocityAmount,X.particleSystem._isSubEmitter=!0,X}dispose(){this.particleSystem.dispose()}}var kE=z(11712);function vE(E,t){const z=new L;return z.direction1=E,z.direction2=t,z}function YE(){return new a(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function GE(){return new mE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function NE(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.Lt(0,1,0),z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Lt(0,1,0);return new W(E,t,z)}function PE(){return new O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Et(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Lt(0,1,0),R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.Lt(0,1,0);return new c(E,t,z,X,R)}function tt(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new d(E,t)}function zt(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Lt(0,1,0),X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Lt(0,1,0);return new y(E,t,z,X)}const At=A.Lt.Zero(),Xt=A.Lt.Zero(),Rt=A.Lt.Zero();class ut{constructor(){this.strength=0,this.position=A.Lt.Zero()}_processParticle(E,t){this.position.subtractToRef(E.position,At);const z=At.lengthSquared()+1;At.normalize().scaleToRef(this.strength/z,Xt),Xt.scaleToRef(t._tempScaledUpdateSpeed,Rt),E.direction.addInPlace(Rt)}serialize(){return{position:this.position.upE(),strength:this.strength}}}class pt extends nE{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=E=>{if(!this._subEmitters||0===this._subEmitters.length)return;const t=Math.floor(Math.random()*this._subEmitters.length);for(const z of this._subEmitters[t])if(1===z.type){const t=z.clone();E._inheritParticleInfoToSubEmitter(t),t.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(t.particleSystem),t.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(E,t){const z=vE(E,t);return this.particleEmitterType=z,z}get flowMap(){return this._flowMap}set flowMap(E){this._flowMap!==E&&(this._flowMap=E,this._flowMapUpdate&&(wE(this._flowMapUpdate),this._flowMapUpdate=null),E&&(this._flowMapUpdate={process:E=>{var t;const z=null===(t=this.lE())||void 0===t?void 0:t.getTransformMatrix();this._flowMap._processParticle(E,this.flowMapStrength*this._tempScaledUpdateSpeed,z)},previousItem:null,nextItem:null},qE(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(E){this._attractors.push(E),1===this._attractors.length&&(this._attractorUpdate={process:E=>{for(const t of this._attractors)t._processParticle(E,this)},previousItem:null,nextItem:null},qE(this._attractorUpdate,this._directionProcessing))}removeAttractor(E){const t=this._attractors.indexOf(E);-1!==t&&this._attractors.splice(t,1),0===this._attractors.length&&wE(this._attractorUpdate)}start(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(E)}createHemisphericEmitter(){const E=YE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createSphereEmitter(){const E=GE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createDirectedSphereEmitter(){const E=NE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.Lt(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Lt(0,1,0));return this.particleEmitterType=E,E}createCylinderEmitter(){const E=PE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=E,E}createDirectedCylinderEmitter(){const E=Et(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Lt(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.Lt(0,1,0));return this.particleEmitterType=E,E}createConeEmitter(){const E=tt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=E,E}createDirectedConeEmitter(){const E=zt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Lt(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Lt(0,1,0));return this.particleEmitterType=E,E}createBoxEmitter(E,t,z,A){const X=new h;return this.particleEmitterType=X,this.direction1=E,this.direction2=t,this.minEmitBox=z,this.maxEmitBox=A,X}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const E of this.subEmitters)E instanceof pt?this._subEmitters.push([new UE(E)]):E instanceof UE?this._subEmitters.push([E]):E instanceof Array&&this._subEmitters.push(E)}_stopSubEmitters(){if(this.activeSubSystems){for(const E of this.activeSubSystems)E.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const E=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==E&&this._rootParticleSystem.activeSubSystems.splice(E,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(E){E&&this._stopSubEmitters()}_prepareParticle(E){if(this._subEmitters&&this._subEmitters.length>0){const t=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];E._attachedSubEmitters=[];for(const z of t)if(0===z.type){const t=z.clone();E._attachedSubEmitters.push(t),t.particleSystem.start()}}}_onDispose(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),E&&this.particles)for(const z of this.particles)if(z._attachedSubEmitters)for(let E=z._attachedSubEmitters.length-1;E>=0;E-=1)z._attachedSubEmitters[E].dispose();if(t&&this.activeSubSystems)for(let z=this.activeSubSystems.length-1;z>=0;z-=1)this.activeSubSystems[z].dispose();if(this._subEmitters&&this._subEmitters.length){for(let E=0;E<this._subEmitters.length;E++)for(const t of this._subEmitters[E])t.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Xt&&this.Xt.dispose&&this.Xt.dispose(!0)}static _Parse(E,t,z,X){let R;R=z instanceof kE.b?null:z;const C=(0,p.d)("BABYLON.Texture");if(C&&R&&(E.texture?t.particleTexture=C.Parse(E.texture,R,X):E.textureName&&(t.particleTexture=new C(X+E.textureName,R,!1,void 0===E.invertY||E.invertY),t.particleTexture.name=E.textureName)),E.emitterId||0===E.emitterId||void 0!==E.Xt?E.emitterId&&R?t.Xt=R.getLastMeshById(E.emitterId):t.Xt=A.Lt.St(E.Xt):t.Xt=A.Lt.Zero(),t.isLocal=!!E.isLocal,void 0!==E.renderingGroupId&&(t.renderingGroupId=E.renderingGroupId),void 0!==E.isBillboardBased&&(t.isBillboardBased=E.isBillboardBased),void 0!==E.billboardMode&&(t.billboardMode=E.billboardMode),void 0!==E.useLogarithmicDepth&&(t.useLogarithmicDepth=E.useLogarithmicDepth),E.animations){for(let z=0;z<E.animations.length;z++){const A=E.animations[z],X=(0,p.d)("BABYLON.Animation");X&&t.animations.push(X.Parse(A))}t.beginAnimationOnStart=E.beginAnimationOnStart,t.beginAnimationFrom=E.beginAnimationFrom,t.beginAnimationTo=E.beginAnimationTo,t.beginAnimationLoop=E.beginAnimationLoop}if(E.autoAnimate&&R&&R.beginAnimation(t,E.autoAnimateFrom,E.autoAnimateTo,E.autoAnimateLoop,E.autoAnimateSpeed||1),t.startDelay=0|E.startDelay,t.minAngularSpeed=E.minAngularSpeed,t.maxAngularSpeed=E.maxAngularSpeed,t.minSize=E.minSize,t.maxSize=E.maxSize,E.minScaleX&&(t.minScaleX=E.minScaleX,t.maxScaleX=E.maxScaleX,t.minScaleY=E.minScaleY,t.maxScaleY=E.maxScaleY),void 0!==E.preWarmCycles&&(t.preWarmCycles=E.preWarmCycles,t.preWarmStepOffset=E.preWarmStepOffset),void 0!==E.minInitialRotation&&(t.minInitialRotation=E.minInitialRotation,t.maxInitialRotation=E.maxInitialRotation),t.minLifeTime=E.minLifeTime,t.maxLifeTime=E.maxLifeTime,t.minEmitPower=E.minEmitPower,t.maxEmitPower=E.maxEmitPower,t.emitRate=E.emitRate,t.gravity=A.Lt.St(E.gravity),E.noiseStrength&&(t.noiseStrength=A.Lt.St(E.noiseStrength)),t.color1=u.Lp.St(E.color1),t.color2=u.Lp.St(E.color2),t.colorDead=u.Lp.St(E.colorDead),t.updateSpeed=E.updateSpeed,t.targetStopDuration=E.targetStopDuration,t.blendMode=E.blendMode,E.colorGradients)for(const A of E.colorGradients)t.addColorGradient(A.gradient,u.Lp.St(A.color1),A.color2?u.Lp.St(A.color2):void 0);if(E.rampGradients){for(const z of E.rampGradients)t.addRampGradient(z.gradient,u.Dt.St(z.color));t.useRampGradients=E.useRampGradients}if(E.colorRemapGradients)for(const A of E.colorRemapGradients)t.addColorRemapGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(E.alphaRemapGradients)for(const A of E.alphaRemapGradients)t.addAlphaRemapGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(E.sizeGradients)for(const A of E.sizeGradients)t.addSizeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(E.angularSpeedGradients)for(const A of E.angularSpeedGradients)t.addAngularSpeedGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(E.velocityGradients)for(const A of E.velocityGradients)t.addVelocityGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(E.dragGradients)for(const A of E.dragGradients)t.addDragGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(E.emitRateGradients)for(const A of E.emitRateGradients)t.addEmitRateGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(E.startSizeGradients)for(const A of E.startSizeGradients)t.addStartSizeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(E.lifeTimeGradients)for(const A of E.lifeTimeGradients)t.addLifeTimeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(E.limitVelocityGradients){for(const z of E.limitVelocityGradients)t.addLimitVelocityGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);t.limitVelocityDamping=E.limitVelocityDamping}if(E.noiseTexture&&R){const z=(0,p.d)("BABYLON.ProceduralTexture");t.noiseTexture=z.Parse(E.noiseTexture,R,X)}let Z;if(E.particleEmitterType){switch(E.particleEmitterType.type){case"SphereParticleEmitter":Z=new mE;break;case"SphereDirectedParticleEmitter":Z=new W;break;case"ConeEmitter":case"ConeParticleEmitter":Z=new d;break;case"ConeDirectedParticleEmitter":Z=new y;break;case"CylinderParticleEmitter":Z=new O;break;case"CylinderDirectedParticleEmitter":Z=new c;break;case"HemisphericParticleEmitter":Z=new a;break;case"PointParticleEmitter":Z=new L;break;case"MeshParticleEmitter":Z=new D;break;case"CustomParticleEmitter":Z=new I;break;default:Z=new h}Z.parse(E.particleEmitterType,R)}else Z=new h,Z.parse(E,R);t.particleEmitterType=Z,t.startSpriteCellID=E.startSpriteCellID,t.endSpriteCellID=E.endSpriteCellID,t.spriteCellLoop=E.spriteCellLoop??!0,t.spriteCellWidth=E.spriteCellWidth,t.spriteCellHeight=E.spriteCellHeight,t.spriteCellChangeSpeed=E.spriteCellChangeSpeed,t.spriteRandomStartCell=E.spriteRandomStartCell,t.disposeOnStop=E.disposeOnStop??!1,t.manualEmitCount=E.manualEmitCount??-1}static Parse(E,t,z){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4?arguments[4]:void 0;const p=E.name;let C,Z,H=null,h=null;if(t instanceof kE.b?C=t:(Z=t,C=Z.getEngine()),E.customShader&&C.createEffectForParticles){h=E.customShader;const t=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"";H=C.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,t)}const d=new pt(p,R||E.wt,t,H,E.isAnimationSheetEnabled);if(d.customShader=h,d._rootUrl=z,E.id&&(d.id=E.id),E.subEmitters){d.subEmitters=[];for(const A of E.subEmitters){const E=[];for(const X of A)E.push(UE.Parse(X,t,z));d.subEmitters.push(E)}}if(E.attractors)for(const u of E.attractors){const E=new ut;E.position=A.Lt.St(u.position),E.strength=u.strength,d.addAttractor(E)}return pt._Parse(E,d,t,z),E.textureMask&&(d.textureMask=u.Lp.St(E.textureMask)),E.CZ&&(d.CZ=A.Lt.St(E.CZ)),E.preventAutoStart&&(d.preventAutoStart=E.preventAutoStart),X||d.preventAutoStart||d.start(),d}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t={};if(pt._Serialize(t,this,E),t.textureMask=this.textureMask.upE(),t.customShader=this.customShader,t.preventAutoStart=this.preventAutoStart,t.CZ=this.CZ.upE(),this.subEmitters){t.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const z of this._subEmitters){const A=[];for(const t of z)A.push(t.serialize(E));t.subEmitters.push(A)}}if(this._attractors&&this._attractors.length){t.attractors=[];for(const E of this._attractors)t.attractors.push(E.serialize())}return t}static _Serialize(E,t,z){if(E.name=t.name,E.id=t.id,E.wt=t.getCapacity(),E.disposeOnStop=t.disposeOnStop,E.manualEmitCount=t.manualEmitCount,t.Xt.position){const z=t.Xt;E.emitterId=z.id}else{const z=t.Xt;E.Xt=z.upE()}t.particleEmitterType&&(E.particleEmitterType=t.particleEmitterType.serialize()),t.particleTexture&&(z?E.texture=t.particleTexture.serialize():(E.textureName=t.particleTexture.name,E.invertY=!!t.particleTexture._invertY)),E.isLocal=t.isLocal,V.b.AppendSerializedAnimations(t,E),E.beginAnimationOnStart=t.beginAnimationOnStart,E.beginAnimationFrom=t.beginAnimationFrom,E.beginAnimationTo=t.beginAnimationTo,E.beginAnimationLoop=t.beginAnimationLoop,E.startDelay=t.startDelay,E.renderingGroupId=t.renderingGroupId,E.isBillboardBased=t.isBillboardBased,E.billboardMode=t.billboardMode,E.minAngularSpeed=t.minAngularSpeed,E.maxAngularSpeed=t.maxAngularSpeed,E.minSize=t.minSize,E.maxSize=t.maxSize,E.minScaleX=t.minScaleX,E.maxScaleX=t.maxScaleX,E.minScaleY=t.minScaleY,E.maxScaleY=t.maxScaleY,E.minEmitPower=t.minEmitPower,E.maxEmitPower=t.maxEmitPower,E.minLifeTime=t.minLifeTime,E.maxLifeTime=t.maxLifeTime,E.emitRate=t.emitRate,E.gravity=t.gravity.upE(),E.noiseStrength=t.noiseStrength.upE(),E.color1=t.color1.upE(),E.color2=t.color2.upE(),E.colorDead=t.colorDead.upE(),E.updateSpeed=t.updateSpeed,E.targetStopDuration=t.targetStopDuration,E.blendMode=t.blendMode,E.preWarmCycles=t.preWarmCycles,E.preWarmStepOffset=t.preWarmStepOffset,E.minInitialRotation=t.minInitialRotation,E.maxInitialRotation=t.maxInitialRotation,E.startSpriteCellID=t.startSpriteCellID,E.spriteCellLoop=t.spriteCellLoop,E.endSpriteCellID=t.endSpriteCellID,E.spriteCellChangeSpeed=t.spriteCellChangeSpeed,E.spriteCellWidth=t.spriteCellWidth,E.spriteCellHeight=t.spriteCellHeight,E.spriteRandomStartCell=t.spriteRandomStartCell,E.isAnimationSheetEnabled=t.isAnimationSheetEnabled,E.useLogarithmicDepth=t.useLogarithmicDepth;const A=t.getColorGradients();if(A){E.colorGradients=[];for(const t of A){const z={gradient:t.gradient,color1:t.color1.upE()};t.color2?z.color2=t.color2.upE():z.color2=t.color1.upE(),E.colorGradients.push(z)}}const X=t.getRampGradients();if(X){E.rampGradients=[];for(const t of X){const z={gradient:t.gradient,color:t.color.upE()};E.rampGradients.push(z)}E.useRampGradients=t.useRampGradients}const R=t.getColorRemapGradients();if(R){E.colorRemapGradients=[];for(const t of R){const z={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?z.factor2=t.factor2:z.factor2=t.factor1,E.colorRemapGradients.push(z)}}const u=t.getAlphaRemapGradients();if(u){E.alphaRemapGradients=[];for(const t of u){const z={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?z.factor2=t.factor2:z.factor2=t.factor1,E.alphaRemapGradients.push(z)}}const p=t.getSizeGradients();if(p){E.sizeGradients=[];for(const t of p){const z={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?z.factor2=t.factor2:z.factor2=t.factor1,E.sizeGradients.push(z)}}const C=t.getAngularSpeedGradients();if(C){E.angularSpeedGradients=[];for(const t of C){const z={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?z.factor2=t.factor2:z.factor2=t.factor1,E.angularSpeedGradients.push(z)}}const Z=t.getVelocityGradients();if(Z){E.velocityGradients=[];for(const t of Z){const z={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?z.factor2=t.factor2:z.factor2=t.factor1,E.velocityGradients.push(z)}}const H=t.getDragGradients();if(H){E.dragGradients=[];for(const t of H){const z={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?z.factor2=t.factor2:z.factor2=t.factor1,E.dragGradients.push(z)}}const h=t.getEmitRateGradients();if(h){E.emitRateGradients=[];for(const t of h){const z={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?z.factor2=t.factor2:z.factor2=t.factor1,E.emitRateGradients.push(z)}}const d=t.getStartSizeGradients();if(d){E.startSizeGradients=[];for(const t of d){const z={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?z.factor2=t.factor2:z.factor2=t.factor1,E.startSizeGradients.push(z)}}const y=t.getLifeTimeGradients();if(y){E.lifeTimeGradients=[];for(const t of y){const z={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?z.factor2=t.factor2:z.factor2=t.factor1,E.lifeTimeGradients.push(z)}}const O=t.getLimitVelocityGradients();if(O){E.limitVelocityGradients=[];for(const t of O){const z={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?z.factor2=t.factor2:z.factor2=t.factor1,E.limitVelocityGradients.push(z)}E.limitVelocityDamping=t.limitVelocityDamping}t.noiseTexture&&(E.noiseTexture=t.noiseTexture.serialize())}clone(E,t){let z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A={...this._customWrappers};let X=null;const R=this._engine;if(R.createEffectForParticles&&null!=this.customShader){X=this.customShader;const E=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"",t=R.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,E);A[0]?A[0].effect=t:this.setCustomEffect(t,0)}const u=this.serialize(z),p=pt.Parse(u,this._scene||this._engine,this._rootUrl);return p.name=E,p.customShader=X,p._customWrappers=A,void 0===t&&(t=this.Xt),this.noiseTexture&&(p.noiseTexture=this.noiseTexture.clone()),p.Xt=t,this.preventAutoStart||p.start(),p}}pt.BILLBOARDMODE_Y=2,pt.BILLBOARDMODE_ALL=7,pt.BILLBOARDMODE_STRETCHED=8,pt.BILLBOARDMODE_STRETCHED_LOCAL=9,UE._ParseParticleSystem=pt.Parse;var Ct=z(12056),Zt=z(12051),Ht=z(11956);Ht.e.prototype.createTransformFeedback=function(){const E=this._gl.createTransformFeedback();if(!E)throw new Error("Unable to create Transform Feedback");return E},Ht.e.prototype.deleteTransformFeedback=function(E){this._gl.deleteTransformFeedback(E)},Ht.e.prototype.bindTransformFeedback=function(E){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,E)},Ht.e.prototype.beginTransformFeedback=function(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(E?this._gl.POINTS:this._gl.TRIANGLES)},Ht.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Ht.e.prototype.setTranformFeedbackVaryings=function(E,t){this._gl.transformFeedbackVaryings(E,t,this._gl.INTERLEAVED_ATTRIBS)},Ht.e.prototype.bindTransformFeedbackBuffer=function(E){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,E?E.underlyingResource:null)},Ht.e.prototype.readTransformFeedbackBuffer=function(E){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,E)};const ht="clipPlaneFragmentDeclaration2",dt="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";l.d.IncludesShadersStore[ht]||(l.d.IncludesShadersStore[ht]=dt);z(13075),z(13084),z(13093),z(13097),z(13102),z(13106),z(13114),z(13123);const yt="gpuRenderParticlesPixelShader",Ot="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";l.d.ShadersStore[yt]||(l.d.ShadersStore[yt]=Ot);const ct="clipPlaneVertexDeclaration2",at="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";l.d.IncludesShadersStore[ct]||(l.d.IncludesShadersStore[ct]=at);z(13128),z(13134),z(13141),z(13145);const Lt="gpuRenderParticlesVertexShader",mz="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";l.d.ShadersStore[Lt]||(l.d.ShadersStore[Lt]=mz);class Wt extends C{static get IsSupported(){if(!N.d.LastCreatedEngine)return!1;const E=N.d.LastCreatedEngine.getCaps();return E.supportTransformFeedbacks||E.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(E){this._maxActiveParticleCount=Math.min(E,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(E){this.maxActiveParticleCount=E}createPointEmitter(E,t){const z=vE(E,t);return this.particleEmitterType=z,z}createHemisphericEmitter(){const E=YE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createSphereEmitter(){const E=GE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createDirectedSphereEmitter(){const E=NE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.Lt(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Lt(0,1,0));return this.particleEmitterType=E,E}createCylinderEmitter(){const E=PE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=E,E}createDirectedCylinderEmitter(){const E=Et(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Lt(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.Lt(0,1,0));return this.particleEmitterType=E,E}createConeEmitter(){const E=tt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=E,E}createDirectedConeEmitter(){const E=zt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Lt(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Lt(0,1,0));return this.particleEmitterType=E,E}createBoxEmitter(E,t,z,A){const X=new h;return this.particleEmitterType=X,this.direction1=E,this.direction2=t,this.minEmitBox=z,this.maxEmitBox=A,X}get flowMap(){return this._flowMap}set flowMap(E){this._flowMap!==E&&(this._flowMap=E)}isReady(){if(!this.Xt||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==pt.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(pt.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(pt.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";E?setTimeout((()=>{this.start(0)}),E):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var E;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(E=this._customWrappers[t])||void 0===E?void 0:E.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[E]??this._customWrappers[0]}setCustomEffect(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[t]=new EE.b(this._engine),this._customWrappers[t].effect=E}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Y.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(E,t,z){return super._removeGradientAndTexture(E,t,z),this._releaseBuffers(),this}addColorGradient(E,t){this._colorGradients||(this._colorGradients=[]);const z=new j(E,t);return this._colorGradients.push(z),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(E&&this._colorGradients.sort(((E,t)=>E.gradient<t.gradient?-1:E.gradient>t.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(E){return this._removeGradientAndTexture(E,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const t in this._drawWrappers){var E;null===(E=this._drawWrappers[t].drawContext)||void 0===E||E.reset()}}_addFactorGradient(E,t,z){const A=new k(t,z);E.push(A),this._releaseBuffers()}addSizeGradient(E,t){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,E,t),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(E){return this._removeGradientAndTexture(E,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(E,t){if(!E)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&E.sort(((E,t)=>E.gradient<t.gradient?-1:E.gradient>t.gradient?1:0));const z=this;z[t]&&(z[t].dispose(),z[t]=null)}addAngularSpeedGradient(E,t){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,E,t),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(E){return this._removeGradientAndTexture(E,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(E,t){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,E,t),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(E){return this._removeGradientAndTexture(E,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(E,t){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,E,t),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(E){return this._removeGradientAndTexture(E,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(E,t){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,E,t),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(E){return this._removeGradientAndTexture(E,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(E){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(E,t,z){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(E),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.IX=new Y.b,this.onStoppedObservable=new Y.b,this.onStartedObservable=new Y.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,z&&"Scene"!==z.getClassName()?(this._engine=z,this.defaultProjectionMatrix=A.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=z||N.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Kd.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,p.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,p.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,p.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,p.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new EE.b(this._engine)},this._customWrappers[0].effect=X,this._drawWrappers={0:new EE.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(t=t??{}).randomTextureSize||delete t.randomTextureSize;const u={wt:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...t},C=t;isFinite(C)&&(u.wt=C),this._capacity=u.wt,this._maxActiveParticleCount=u.wt,this._currentActiveCount=0,this._isAnimationSheetEnabled=R,this.particleEmitterType=new h;const Z=Math.min(this._engine.getCaps().maxTextureSize,u.randomTextureSize);let H=[];for(let A=0;A<Z;++A)H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),H.push(Math.random());this._randomTexture=new G.d(new Float32Array(H),Z,1,5,z,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,H=[];for(let A=0;A<Z;++A)H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),H.push(Math.random());this._randomTexture2=new G.d(new Float32Array(H),Z,1,5,z,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=Z}_reset(){this._releaseBuffers()}_createVertexBuffers(E,t,z){const A={};A.position=t.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let X=3;A.age=t.createVertexBuffer("age",X,1,this._attributesStrideSize,!0),X+=1,A.size=t.createVertexBuffer("size",X,3,this._attributesStrideSize,!0),X+=3,A.life=t.createVertexBuffer("life",X,1,this._attributesStrideSize,!0),X+=1,X+=4,this.billboardMode===pt.BILLBOARDMODE_STRETCHED&&(A.direction=t.createVertexBuffer("direction",X,3,this._attributesStrideSize,!0)),X+=3,this._platform.alignDataInBuffer&&(X+=1),this.particleEmitterType instanceof I&&(X+=3,this._platform.alignDataInBuffer&&(X+=1)),this._colorGradientsTexture||(A.color=t.createVertexBuffer("color",X,4,this._attributesStrideSize,!0),X+=4),this._isBillboardBased||(A.initialDirection=t.createVertexBuffer("initialDirection",X,3,this._attributesStrideSize,!0),X+=3,this._platform.alignDataInBuffer&&(X+=1)),this.noiseTexture&&(A.noiseCoordinates1=t.createVertexBuffer("noiseCoordinates1",X,3,this._attributesStrideSize,!0),X+=3,this._platform.alignDataInBuffer&&(X+=1),A.noiseCoordinates2=t.createVertexBuffer("noiseCoordinates2",X,3,this._attributesStrideSize,!0),X+=3,this._platform.alignDataInBuffer&&(X+=1)),A.angle=t.createVertexBuffer("angle",X,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?X++:X+=2,this._isAnimationSheetEnabled&&(A.cellIndex=t.createVertexBuffer("cellIndex",X,1,this._attributesStrideSize,!0),X+=1,this.spriteRandomStartCell&&(A.cellStartOffset=t.createVertexBuffer("cellStartOffset",X,1,this._attributesStrideSize,!0),X+=1)),A.offset=z.createVertexBuffer("offset",0,2),A.uv=z.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(A),this._platform.createVertexBuffers(E,A),this.resetDrawCache()}_initialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!E)return;const t=this._engine,z=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof I&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const X=this.particleEmitterType instanceof I,R=A.TmpVectors.Lt[0];let u=0;for(let A=0;A<this._capacity;A++)if(z.push(0),z.push(0),z.push(0),z.push(0),z.push(0),z.push(0),z.push(0),z.push(0),z.push(Math.random()),z.push(Math.random()),z.push(Math.random()),z.push(Math.random()),X?(this.particleEmitterType.particleDestinationGenerator(A,null,R),z.push(R.x),z.push(R.y),z.push(R.z)):(z.push(0),z.push(0),z.push(0)),this._platform.alignDataInBuffer&&z.push(0),u+=16,X&&(this.particleEmitterType.particlePositionGenerator(A,null,R),z.push(R.x),z.push(R.y),z.push(R.z),this._platform.alignDataInBuffer&&z.push(0),u+=4),this._colorGradientsTexture||(z.push(0),z.push(0),z.push(0),z.push(0),u+=4),this.isBillboardBased||(z.push(0),z.push(0),z.push(0),this._platform.alignDataInBuffer&&z.push(0),u+=4),this.noiseTexture&&(z.push(Math.random()),z.push(Math.random()),z.push(Math.random()),this._platform.alignDataInBuffer&&z.push(0),z.push(Math.random()),z.push(Math.random()),z.push(Math.random()),this._platform.alignDataInBuffer&&z.push(0),u+=8),z.push(0),u+=1,this._angularSpeedGradientsTexture||(z.push(0),u+=1),this._isAnimationSheetEnabled&&(z.push(0),u+=1,this.spriteRandomStartCell&&(z.push(0),u+=1)),this._platform.alignDataInBuffer){let E=3-(u+3&3);for(u+=E;E-- >0;)z.push(0)}const p=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),C=this._platform.createParticleBuffer(z),Z=this._platform.createParticleBuffer(z);this._buffer0=new e.b(t,C,!1,this._attributesStrideSize),this._buffer1=new e.b(t,Z,!1,this._attributesStrideSize),this._spriteBuffer=new e.b(t,p,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let E=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(E+="\n#define BILLBOARD"),this._colorGradientsTexture&&(E+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(E+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(E+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(E+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(E+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(E+="\n#define DRAGGRADIENTS"),this._flowMap&&(E+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(E+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(E+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(E+="\n#define NOISE"),this.isLocal&&(E+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===E||(this._cachedUpdateDefines=E,this._updateBuffer=this._platform.createUpdateBuffer(E)),this._platform.isUpdateBufferReady()}_getWrapper(E){const t=this._getCustomDrawWrapper(E);if(null!==t&&void 0!==t&&t.effect)return t;const z=[];this.fillDefines(z,E);let A=this._drawWrappers[E];A||(A=new EE.b(this._engine),A.drawContext&&(A.drawContext.useInstancing=!0),this._drawWrappers[E]=A);const X=z.join("\n");if(A.defines!==X){const E=[],t=[],z=[];this.fillUniformsAttributesAndSamplerNames(t,E,z),A.setEffect(this._engine.createEffect("gpuRenderParticles",E,t,z,X),X)}return A}static _GetAttributeNamesOrOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const X=[e.f.PositionKind,"age","life","size","angle"];return E||X.push(e.f.ColorKind),t&&X.push("cellIndex"),z||X.push("initialDirection"),A&&X.push("direction"),X.push("offset",e.f.UVKind),X}static _GetEffectCreationOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=["emitterWM","CZ","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,tE.d)(A),E&&A.push("sheetInfos"),t&&A.push("logarithmicDepthConstant"),z&&(A.push("vFogInfos"),A.push("vFogColor")),A}fillDefines(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,tE.k)(this,this._scene,E),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Zt.c.FOGMODE_NONE&&E.push("#define FOG")),t===pt.BLENDMODE_MULTIPLY&&E.push("#define BLENDMULTIPLYMODE"),this.isLocal&&E.push("#define LOCAL"),this.useLogarithmicDepth&&E.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(E.push("#define BILLBOARD"),this.billboardMode){case pt.BILLBOARDMODE_Y:E.push("#define BILLBOARDY");break;case pt.BILLBOARDMODE_STRETCHED:E.push("#define BILLBOARDSTRETCHED");break;case pt.BILLBOARDMODE_ALL:E.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&E.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&E.push("#define ANIMATESHEET"),z&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),E.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(E,t,z){t.push(...Wt._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===pt.BILLBOARDMODE_STRETCHED)),E.push(...Wt._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),z.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Ct.c.PrepareUniforms(E,this._imageProcessingConfigurationDefines),Ct.c.PrepareSamplers(z,this._imageProcessingConfigurationDefines))}animate(){var E;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(t?this.preWarmStepOffset:(null===(E=this._scene)||void 0===E?void 0:E.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(E,t){const z=this[t];if(!E||!E.length||z)return;const A=new Float32Array(this._rawTextureWidth);for(let X=0;X<this._rawTextureWidth;X++){const t=X/this._rawTextureWidth;v.GetCurrentGradient(t,E,((E,t,z)=>{A[X]=(0,Z.Lerp)(E.factor1,t.factor1,z)}))}this[t]=G.d.CreateRTexture(A,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[t].name=t.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const E=new Uint8Array(4*this._rawTextureWidth),t=u.TmpColors.Lp[0];for(let z=0;z<this._rawTextureWidth;z++){const A=z/this._rawTextureWidth;v.GetCurrentGradient(A,this._colorGradients,((A,X,R)=>{u.Lp.LerpToRef(A.color1,X.color1,R,t),E[4*z]=255*t.r,E[4*z+1]=255*t.g,E[4*z+2]=255*t.b,E[4*z+3]=255*t.a}))}this._colorGradientsTexture=G.d.CreateRGBATexture(E,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(E,t){var z,X,R,u;const p=this._getWrapper(E),C=p.effect;this._engine.enableEffect(p);const Z=(null===(z=this._scene)||void 0===z?void 0:z.getViewMatrix())||A.Matrix.IdentityReadOnly;if(C.setMatrix("view",Z),C.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),C.setTexture("diffuseSampler",this.particleTexture),C.setVector2("translationPivot",this.translationPivot),C.setVector3("CZ",this.CZ),this.isLocal&&C.setMatrix("emitterWM",t),this._colorGradientsTexture?C.setTexture("colorGradientSampler",this._colorGradientsTexture):C.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const E=this.particleTexture.getBaseSize();C.setFloat3("sheetInfos",this.spriteCellWidth/E.width,this.spriteCellHeight/E.height,E.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const E=this._scene.activeCamera;C.setVector3("eyePosition",E.globalPosition)}const H=C.defines;if(this._scene&&((0,tE.g)(C,this,this._scene),this.applyFog&&(0,zE.i)(this._scene,void 0,C)),H.indexOf("#define BILLBOARDMODE_ALL")>=0){const E=Z.clone();E.invert(),C.setMatrix("invView",E)}return this.useLogarithmicDepth&&this._scene&&(0,zE.o)(H,C,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(C),this._setEngineBasedOnBlendMode(E),this._platform.bindDrawBuffers(this._targetIndex,C,null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(C),null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(u=this._scene)&&void 0!==u&&u.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(E){if(!this.Xt||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!E)if(this.Xt.position){E=this.Xt.getWorldMatrix()}else{const t=this.Xt;E=A.TmpVectors.Matrix[0],A.Matrix.TranslationToRef(t.x,t.y,t.z,E)}const t=this._engine,z=t.getDepthWrite();if(t.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const E=this.lE();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",E.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",E),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const X=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=X,t.setDepthWrite(z)}render(){let E,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!t&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let E=0;E<this.preWarmCycles;E++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const E=0|this._accumulatedCount;this._accumulatedCount-=E,this._currentActiveCount+=E}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Xt.position){E=this.Xt.getWorldMatrix()}else{const t=this.Xt;E=A.TmpVectors.Matrix[0],A.Matrix.TranslationToRef(t.x,t.y,t.z,E)}const X=this._engine;this.updateInAnimate||this._update(E);let R=0;return t||z||(X.setState(!1),this.forceDepthWrite&&X.setDepthWrite(!0),R=this.blendMode===pt.BLENDMODE_MULTIPLYADD?this._render(pt.BLENDMODE_MULTIPLY,E)+this._render(pt.BLENDMODE_ADD,E):this._render(this.blendMode,E),this._engine.setAlphaMode(0)),R}rebuild(){const E=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(E,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,E()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const t in this._drawWrappers){this._drawWrappers[t].dispose()}if(this._drawWrappers={},this._scene){const E=this._scene.Kd.indexOf(this);E>-1&&this._scene.Kd.splice(E,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let t=0;t<this._renderVertexBuffers.length;++t){const E=this._renderVertexBuffers[t];for(const t in E)E[t].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),E&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),E&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.IX.notifyObservers(this),this.IX.clear()}clone(E,t){let z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A={...this._customWrappers};let X=null;const R=this._engine;if(R.createEffectForParticles&&null!=this.customShader){X=this.customShader;const E=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"";A[0]=R.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,E,void 0,void 0,void 0,this)}const u=this.serialize(z),p=Wt.Parse(u,this._scene||this._engine,this._rootUrl);return p.name=E,p.customShader=X,p._customWrappers=A,void 0===t&&(t=this.Xt),this.noiseTexture&&(p.noiseTexture=this.noiseTexture.clone()),p.Xt=t,p}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t={};return pt._Serialize(t,this,E),t.activeParticleCount=this.activeParticleCount,t.randomTextureSize=this._randomTextureSize,t.customShader=this.customShader,t}static Parse(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4?arguments[4]:void 0;const R=E.name;let u,p;t instanceof kE.b?u=t:(p=t,u=p.getEngine());const C=new Wt(R,{wt:X||E.wt,randomTextureSize:E.randomTextureSize},t,null,E.isAnimationSheetEnabled);if(C._rootUrl=z,E.customShader&&u.createEffectForParticles){const t=E.customShader,z=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"",A=u.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,z,void 0,void 0,void 0,C);C.setCustomEffect(A,0),C.customShader=t}return E.id&&(C.id=E.id),E.activeParticleCount&&(C.activeParticleCount=E.activeParticleCount),pt._Parse(E,C,t,z),E.preventAutoStart&&(C.preventAutoStart=E.preventAutoStart),A||C.preventAutoStart||C.start(),C}}var It=z(11630),et=z(13151),Dt=z(12175);class St{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(E){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const t of this.systems)t.Xt=E;this._emitterNode=E}setEmitterAsSphere(E,t,z){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:E,renderingGroupId:t};const A=(0,et.c)("emitterSphere",{diameter:E.diameter,segments:E.segments},z);A.renderingGroupId=t;const X=new Dt.et("emitterSphereMaterial",z);X.emissiveColor=E.color,A.material=X;for(const R of this.systems)R.Xt=A;this._emitterNode=A}start(E){for(const t of this.systems)E&&(t.Xt=E),t.start()}dispose(){for(const E of this.systems)E.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t={systems:[]};for(const z of this.systems)t.systems.push(z.serialize(E));return this._emitterNode&&(t.Xt=this._emitterCreationOptions),t}static Parse(E,t){let z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0;const X=new St,R=this.BaseAssetsUrl+"/textures/";t=t||N.d.LastCreatedScene;for(const u of E.systems)X.systems.push(z?Wt.Parse(u,t,R,!0,A):pt.Parse(u,t,R,!0,A));if(E.Xt){const z=E.Xt.options;if("Sphere"===E.Xt.kind)X.setEmitterAsSphere({diameter:z.diameter,segments:z.segments,color:u.Dt.St(z.color)},E.Xt.renderingGroupId,t)}return X}}St.BaseAssetsUrl="https://assets.babylonjs.com/particles";var lt=z(11661);class ft{static CreateDefault(E){let t,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,A=arguments.length>2?arguments[2]:void 0;t=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Wt("default system",{wt:z},A):new pt("default system",z,A),t.Xt=E;const X=It.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return t.particleTexture=new r.d(X,t.lE()),t.createConeEmitter(.1,Math.PI/4),t.color1=new u.Lp(1,1,1,1),t.color2=new u.Lp(1,1,1,1),t.colorDead=new u.Lp(1,1,1,0),t.minSize=.1,t.maxSize=.1,t.minEmitPower=2,t.maxEmitPower=2,t.updateSpeed=1/60,t.emitRate=30,t}static CreateAsync(E,t){let z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0;t||(t=N.d.LastCreatedScene);const X={};return t.addPendingData(X),new Promise(((R,u)=>{if(z&&!Wt.IsSupported)return t.removePendingData(X),u("Particle system with GPU is not supported.");It.Tools.LoadFile(`${ft.BaseAssetsUrl}/systems/${E}.json`,(E=>{t.removePendingData(X);const u=JSON.parse(E.toString());return R(St.Parse(u,t,z,A))}),void 0,void 0,void 0,(()=>(t.removePendingData(X),u(`An error occurred with the creation of your particle system. Check if your type '${E}' exists.`))))}))}static ExportSet(E){const t=new St;for(const z of E)t.systems.push(z);return t}static ParseFromFileAsync(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",R=arguments.length>5?arguments[5]:void 0;return new Promise(((u,p)=>{const C=new lt.d;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const t=JSON.parse(C.responseText);let p;p=A?Wt.Parse(t,z,X,!1,R):pt.Parse(t,z,X,!1,R),E&&(p.name=E),u(p)}else p("Unable to load the particle system")})),C.open("GET",t),C.send()}))}static ParseFromSnippetAsync(E,t){let z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",X=arguments.length>4?arguments[4]:void 0;if("_BLANK"===E){const E=this.CreateDefault(null);return E.start(),Promise.resolve(E)}return new Promise(((R,u)=>{const p=new lt.d;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const u=JSON.parse(JSON.parse(p.responseText).jsonPayload),C=JSON.parse(u.particleSystem);let Z;Z=z?Wt.Parse(C,t,A,!1,X):pt.Parse(C,t,A,!1,X),Z.snippetId=E,R(Z)}else u("Unable to load the snippet "+E)})),p.open("GET",this.SnippetUrl+"/"+E.replace(/#/g,"/")),p.send()}))}}ft.BaseAssetsUrl=St.BaseAssetsUrl,ft.SnippetUrl="https://snippet.babylonjs.com",ft.CreateFromSnippetAsync=ft.ParseFromSnippetAsync;var Kt=z(12250),Ft=z(12085),Bt=z(13154);(0,Bt.d)(Ft.c.NAME_PARTICLESYSTEM,((E,t,z,A)=>{const X=(0,Bt.f)(Ft.c.NAME_PARTICLESYSTEM);if(X&&void 0!==E.Kd&&null!==E.Kd)for(let R=0,u=E.Kd.length;R<u;R++){const u=E.Kd[R];z.Kd.push(X(u,t,A))}})),(0,Bt.b)(Ft.c.NAME_PARTICLESYSTEM,((E,t,z)=>{if(E.activeParticleCount){return Wt.Parse(E,t,z)}return pt.Parse(E,t,z)})),kE.b.prototype.createEffectForParticles=function(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",R=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0,C=arguments.length>7?arguments[7]:void 0,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,H=arguments.length>9?arguments[9]:void 0,h=[],d=[];const y=[];return C?C.fillUniformsAttributesAndSamplerNames(d,h,y):(h=pt._GetAttributeNamesOrOptions(),d=pt._GetEffectCreationOptions()),-1===X.indexOf(" BILLBOARD")&&(X+="\n#define BILLBOARD\n"),null!==C&&void 0!==C&&C.isAnimationSheetEnabled&&-1===X.indexOf(" ANIMATESHEET")&&(X+="\n#define ANIMATESHEET\n"),-1===A.indexOf("diffuseSampler")&&A.push("diffuseSampler"),this.createEffect({vertex:H??(null===C||void 0===C?void 0:C.vertexShaderName)??"particles",fragmentElement:E},h,d.concat(t),y.concat(A),X,R,u,p,void 0,Z,(async()=>{0===Z?await Promise.resolve().then(z.bind(z,13195)):await Promise.resolve().then(z.bind(z,13258))}))},Kt.e.prototype.getEmittedParticleSystems=function(){const E=[];for(let t=0;t<this.lE().Kd.length;t++){const z=this.lE().Kd[t];z.Xt===this&&E.push(z)}return E},Kt.e.prototype.getHierarchyEmittedParticleSystems=function(){const E=[],t=this.getDescendants();t.push(this);for(let z=0;z<this.lE().Kd.length;z++){const A=this.lE().Kd[z],X=A.Xt;X.position&&-1!==t.indexOf(X)&&E.push(A)}return E};z(12139),z(12148),z(12231);z(12238),z(13163),z(12011),z(12128),z(12272);z(12004);var bt;z(13168),z(11840);!function(E){E[E.Color=2]="Color",E[E.UV=1]="UV",E[E.Random=0]="Random",E[E.Stated=3]="Stated"}(bt||(bt={}));var xt=z(12044);const Jt=new A.Lt(0,0,0),Vt=new A.Lt(0,0,0),rt=new A.Lt(0,0,0);class it{constructor(E,t,z){this.width=E,this.height=t,this.data=z}processFlowable(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,z=arguments.length>2?arguments[2]:void 0;if(!z)return;z instanceof A.Matrix?A.Lt.TransformCoordinatesToRef(E.position,z,rt):(rt.x=z.x,rt.y=z.y,rt.z=z.z);const X=.5*rt.x+.5,R=1-(.5*rt.y+.5),u=Math.floor(X*this.width),p=Math.floor(R*this.height);if(u<0||u>=this.width||p<0||p>=this.height)return;const C=4*(p*this.width+u),Z=this.data[C]/255*2-1,H=this.data[C+1]/255*2-1,h=this.data[C+2]/255*2-1,d=this.data[C+3]/255;Jt.set(Z,H,h),Jt.scaleToRef(t*d,Vt),E.direction.addInPlace(Vt)}_processParticle(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,z=arguments.length>2?arguments[2]:void 0;this.processFlowable(E,t,z)}static async FromUrlAsync(E){return await new Promise(((t,z)=>{const A=document.createElement("canvas"),X=A.getContext("2d");let R=null;const u=new Image;u.crossOrigin="anonymous",u.src=E,u.onerror=t=>{z(new Error(`Failed to load image: ${E} : ${t}`))},u.onload=()=>{A.width=u.width,A.height=u.height,X.drawImage(u,0,0),R=X.getImageData(0,0,A.width,A.height),t(new it(A.width,A.height,R.data))}}))}static async ExtractFromTextureAsync(E){return await new Promise(((t,z)=>{if(!E.isReady())return void E.onLoadObservable.addOnce((async()=>{try{const z=await this.ExtractFromTextureAsync(E);t(z)}catch(A){z(A)}}));const A=E.getSize();xt.l.GetTextureDataAsync(E,A.width,A.height).then((E=>{t(new it(A.width,A.height,new Uint8ClampedArray(E)))})).catch(z)}))}}var gt,ot,Qt,Tt,qt,Mt,wt,nt,st;!function(E){E[E.Int=1]="Int",E[E.Float=2]="Float",E[E.Vector2=4]="Vector2",E[E.Lt=8]="Lt",E[E.Matrix=16]="Matrix",E[E.Particle=32]="Particle",E[E.Texture=64]="Texture",E[E.Lp=128]="Lp",E[E.FloatGradient=256]="FloatGradient",E[E.Vector2Gradient=512]="Vector2Gradient",E[E.Vector3Gradient=1024]="Vector3Gradient",E[E.Color4Gradient=2048]="Color4Gradient",E[E.System=4096]="System",E[E.AutoDetect=8192]="AutoDetect",E[E.BasedOnInput=16384]="BasedOnInput",E[E.Undefined=32768]="Undefined",E[E.All=65535]="All"}(gt||(gt={})),function(E){E[E.Compatible=0]="Compatible",E[E.TypeIncompatible=1]="TypeIncompatible",E[E.HierarchyIssue=2]="HierarchyIssue"}(ot||(ot={})),function(E){E[E.Input=0]="Input",E[E.Output=1]="Output"}(Qt||(Qt={}));class jt{get direction(){return this._direction}get type(){if(this._type===gt.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===gt.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(E){this._type=E}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((E=>E.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(E,t,z){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=gt.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new Y.b,this.onDisconnectionObservable=new Y.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=t,this.name=E,this._direction=z}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(E){var t;return this.isConnected?null!==(t=this._connectedPoint)&&void 0!==t&&t._storedFunction?this._connectedPoint._storedFunction(E):this._connectedPoint._storedValue:this.value}canConnectTo(E){return 0===this.checkCompatibilityState(E)}checkCompatibilityState(E){const t=this._ownerBlock,z=E.ownerBlock;if(this.type!==E.type&&E.innerType!==gt.AutoDetect)return E.acceptedConnectionPointTypes&&-1!==E.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(E.excludedConnectionPointTypes&&-1!==E.excludedConnectionPointTypes.indexOf(this.type))return 1;let A=z,X=t;return 0===this.direction&&(A=t,X=z),A.isAnAncestorOf(X)?2:0}connectTo(E){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(E))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${E.ownerBlock.name}".${E.name}`;return this._endpoints.push(E),E._connectedPoint=this,this.onConnectionObservable.notifyObservers(E),E.onConnectionObservable.notifyObservers(this),this}disconnectFrom(E){const t=this._endpoints.indexOf(E);return-1===t||(this._endpoints.splice(t,1),E._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(E),E.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(E){let t=1;for(;t<gt.All;)E&t||this.excludedConnectionPointTypes.push(t),t<<=1}serialize(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t={};return t.name=this.name,t.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.upE?(t.valueType="BABYLON."+this.value.getClassName(),t.value=this.value.upE()):(t.valueType="number",t.value=this.value)),E&&this.connectedPoint&&(t.inputName=this.name,t.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,t.targetConnectionName=this.connectedPoint.name,t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),t}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Ut{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(E){this._name=E}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(E){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new Y.b,this.IX=new Y.b,this.onInputChangedObservable=new Y.b,this.visibleOnFrame=!1,this._name=E,this.uniqueId=i.b.UniqueId}_inputRename(E){return E}_outputRename(E){return E}isAnAncestorOf(E){for(const t of this._outputs)if(t.hasEndpoints)for(const z of t.endpoints){if(z.ownerBlock===E)return!0;if(z.ownerBlock.isAnAncestorOf(E))return!0}return!1}isAnAncestorOfType(E){if(this.getClassName()===E)return!0;for(const t of this._outputs)if(t.hasEndpoints)for(const z of t.endpoints)if(z.ownerBlock.isAnAncestorOfType(E))return!0;return!1}getInputByName(E){const t=this._inputs.filter((t=>t.name===E));return t.length?t[0]:null}_linkConnectionTypes(E,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[t]._acceptedConnectionPointType=this._inputs[E]:(this._inputs[E]._linkedConnectionSource=this._inputs[t],this._inputs[E]._isMainLinkSource=!0),this._inputs[t]._linkedConnectionSource=this._inputs[E]}registerInput(E,t){let z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0,R=arguments.length>5?arguments[5]:void 0;const u=new jt(E,this,0);return u.type=t,u.isOptional=z,u.defaultValue=A,u.value=A,u.valueMin=X,u.valueMax=R,this._inputs.push(u),this.onInputChangedObservable.notifyObservers(u),this}registerOutput(E,t,z){return(z=z??new jt(E,this,1)).type=t,this._outputs.push(z),this}_build(E){}_customBuildStep(E){}build(E){if(this._buildId===E.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((E=>E.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=E.buildId;for(const t of this._inputs){if(!t.connectedPoint){t.isOptional||E.notConnectedNonOptionalInputs.push(t);continue}const z=t.connectedPoint.ownerBlock;z&&z!==this&&!z.isSystem&&z.build(E)}return this._customBuildStep(E),E.verbose&&g.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(E),this.onBuildObservable.notifyObservers(this),!1}serialize(){const E={};E.customType="BABYLON."+this.getClassName(),E.id=this.uniqueId,E.name=this.name,E.visibleOnFrame=this.visibleOnFrame,E.inputs=[],E.outputs=[];for(const t of this.inputs)E.inputs.push(t.serialize());for(const t of this.outputs)E.outputs.push(t.serialize(!1));return E}_deserialize(E){this._name=E.name,this.comments=E.comments,this.visibleOnFrame=!!E.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(E)}_deserializePortDisplayNamesAndExposedOnFrame(E){const t=E.inputs,z=E.outputs;if(t)for(const A of t){const E=this.inputs.find((E=>E.name===A.name));if(!E)return;if(A.displayName&&(E.displayName=A.displayName),A.isExposedOnFrame&&(E.isExposedOnFrame=A.isExposedOnFrame,E.exposedPortPosition=A.exposedPortPosition),void 0!==A.value&&null!==A.value)if("number"===A.valueType)E.value=A.value;else{const t=(0,p.d)(A.valueType);t&&(E.value=t.St(A.value))}}if(z)for(let A=0;A<z.length;A++){const E=z[A];E.displayName&&(this.outputs[A].displayName=E.displayName),E.isExposedOnFrame&&(this.outputs[A].isExposedOnFrame=E.isExposedOnFrame,this.outputs[A].exposedPortPosition=E.exposedPortPosition)}}clone(){const E=this.serialize(),t=(0,p.d)(E.customType);if(t){const z=new t;return z._deserialize(E),z}return null}dispose(){this.IX.notifyObservers(this),this.IX.clear();for(const E of this.inputs)E.dispose();for(const E of this.outputs)E.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function kt(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",A=arguments.length>3?arguments[3]:void 0;return(X,R)=>{let u=X._propStore;u||(u=[],X._propStore=u),u.push({propertyName:R,displayName:E,type:t,groupName:z,options:A??{},className:X.getClassName()})}}(0,x.b)([(0,J.K)("comment")],Ut.prototype,"comments",void 0),function(E){E[E.Boolean=0]="Boolean",E[E.Float=1]="Float",E[E.Int=2]="Int",E[E.Vector2=3]="Vector2",E[E.List=4]="List",E[E.Lp=5]="Lp",E[E.SamplingMode=6]="SamplingMode",E[E.TextureFormat=7]="TextureFormat",E[E.TextureType=8]="TextureType"}(Tt||(Tt={})),function(E){E[E.None=0]="None",E[E.Position=1]="Position",E[E.Direction=2]="Direction",E[E.Age=3]="Age",E[E.Lifetime=4]="Lifetime",E[E.Color=5]="Color",E[E.ScaledDirection=6]="ScaledDirection",E[E.Scale=7]="Scale",E[E.AgeGradient=8]="AgeGradient",E[E.Angle=9]="Angle",E[E.SpriteCellIndex=16]="SpriteCellIndex",E[E.SpriteCellStart=17]="SpriteCellStart",E[E.SpriteCellEnd=18]="SpriteCellEnd"}(qt||(qt={})),function(E){E[E.None=0]="None",E[E.Time=1]="Time",E[E.Delta=2]="Delta",E[E.Emitter=3]="Emitter"}(Mt||(Mt={}));class vt{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let E="";for(const t of this.notConnectedNonOptionalInputs)E+=`input ${t.name} from block ${t.ownerBlock.name}[${t.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(E)throw"Build of Node Particle System Set failed:\n"+E}adapt(E,t){const z=E.getConnectedValue(this)||0;if(E.type===t)return z;switch(t){case gt.Vector2:return new A.Vector2(z,z);case gt.Lt:return new A.Lt(z,z,z);case gt.Lp:return new u.Lp(z,z,z,z)}return null}getContextualValue(E){if(!this.particleContext||!this.systemContext)return null;switch(E){case qt.Position:return this.particleContext.position;case qt.Direction:return this.particleContext.direction;case qt.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case qt.Color:return this.particleContext.color;case qt.Age:return this.particleContext.age;case qt.Lifetime:return this.particleContext.lifeTime;case qt.Angle:return this.particleContext.angle;case qt.Scale:return this.particleContext.scale;case qt.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case qt.SpriteCellEnd:return this.systemContext.endSpriteCellID;case qt.SpriteCellIndex:return this.particleContext.cellIndex;case qt.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Xt.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Xt.absolutePosition:this.systemContext.Xt:null}getSystemValue(E){if(!this.particleContext||!this.systemContext)return null;switch(E){case Mt.Time:return this.systemContext._actualFrame;case Mt.Delta:return this.systemContext._scaledUpdateSpeed;case Mt.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Xt.absolutePosition}return this.systemContext.Xt}return null}}function Yt(E,t,z){const A=new vt;A.It=t;const X=E.createSystem(A);return X.canStart=()=>!0,X.Xt=z.clone(),X.disposeOnStop=!0,X.start(),X}class Gt extends Ut{constructor(E){super(E),this.blendMode=C.BLENDMODE_ONEONE,this.wt=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",gt.Particle),this.registerInput("texture",gt.Texture),this.registerInput("onStart",gt.System,!0),this.registerInput("onEnd",gt.System,!0),this.registerOutput("system",gt.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(E){E.wt=this.wt,E.buildId=this._buildId++,this.build(E);const t=this.particle.getConnectedValue(E);return t.particleTexture=this.texture.getConnectedValue(E),t.emitRate=this.emitRate,t.blendMode=this.blendMode,t.name=this.name,t._nodeGenerated=!0,t._targetStopDuration=this.targetStopDuration,t.startDelay=this.startDelay,this.system._storedValue=this,t.canStart=()=>!this.doNoStart,t.onStartedObservable.add((z=>{const A=this.onStart.getConnectedValue(E);A&&z.onStartedObservable.addOnce((()=>{E.systemContext=t;const z=Yt(A,E.It,E.emitterPosition);this.IX.addOnce((()=>{z.dispose()}))}));const X=this.onEnd.getConnectedValue(E);X&&z.onStoppedObservable.addOnce((()=>{E.systemContext=t;const z=Yt(X,E.It,E.emitterPosition);this.IX.addOnce((()=>{z.dispose()}))}))})),this.IX.addOnce((()=>{t.dispose()})),t}serialize(){const E=super.serialize();return E.wt=this.wt,E.emitRate=this.emitRate,E.blendMode=this.blendMode,E.doNoStart=this.doNoStart,E.targetStopDuration=this.targetStopDuration,E.startDelay=this.startDelay,E}_deserialize(E){super._deserialize(E),this.wt=E.wt,this.emitRate=E.emitRate,this.doNoStart=!!E.doNoStart,void 0!==E.blendMode&&(this.blendMode=E.blendMode),void 0!==E.targetStopDuration&&(this.targetStopDuration=E.targetStopDuration),void 0!==E.startDelay&&(this.startDelay=E.startDelay)}}(0,x.b)([kt("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:C.BLENDMODE_ONEONE},{label:"Standard",value:C.BLENDMODE_STANDARD},{label:"Add",value:C.BLENDMODE_ADD},{label:"Multiply",value:C.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:C.BLENDMODE_MULTIPLYADD}]})],Gt.prototype,"blendMode",void 0),(0,x.b)([kt("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Gt.prototype,"wt",void 0),(0,x.b)([kt("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gt.prototype,"emitRate",void 0),(0,x.b)([kt("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gt.prototype,"targetStopDuration",void 0),(0,x.b)([kt("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gt.prototype,"startDelay",void 0),(0,x.b)([kt("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Gt.prototype,"doNoStart",void 0),(0,p.f)("BABYLON.SystemBlock",Gt);class Nt extends Ut{get type(){if(this._type===gt.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=gt.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=gt.Vector2,this._type;case"Lt":return this._type=gt.Lt,this._type;case"Lp":return this._type=gt.Lp,this._type;case"Matrix":return this._type=gt.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===qt.None&&this._systemSource!==Mt.None}get systemSource(){return this._systemSource}set systemSource(E){if(this._systemSource=E,E!==Mt.None){switch(this._contextualSource=qt.None,this._type=gt.Float,E){case Mt.Time:case Mt.Delta:this._type=gt.Float;break;case Mt.Emitter:this._type=gt.Lt}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==qt.None}get contextualValue(){return this._contextualSource}set contextualValue(E){if(this._contextualSource=E,E!==qt.None){switch(this._systemSource=Mt.None,E){case qt.Scale:this._type=gt.Vector2;break;case qt.Position:case qt.Direction:case qt.ScaledDirection:this._type=gt.Lt;break;case qt.Color:this._type=gt.Lp;break;case qt.Age:case qt.Lifetime:case qt.Angle:case qt.AgeGradient:this._type=gt.Float;break;case qt.SpriteCellEnd:case qt.SpriteCellStart:case qt.SpriteCellIndex:this._type=gt.Int}this.output&&(this.output.type=this._type)}}constructor(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gt.AutoDetect;super(E),this._type=gt.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new Y.b,this._systemSource=Mt.None,this._contextualSource=qt.None,this._type=t,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",t)}get value(){return this._storedValue}set value(E){this.type===gt.Float&&this.min!==this.max&&(E=Math.max(this.min,E),E=Math.min(this.max,E)),this._storedValue=E,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(E){this._valueCallback=E}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case gt.Int:case gt.Float:this.value=0;break;case gt.Vector2:this.value=A.Vector2.Zero();break;case gt.Lt:this.value=A.Lt.Zero();break;case gt.Lp:this.value=new u.Lp(1,1,1,1);break;case gt.Matrix:this.value=A.Matrix.Identity()}}_build(E){super._build(E),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=E=>E.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=E=>E.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const E=super.serialize();return E.type=this.type,E.contextualValue=this.contextualValue,E.systemSource=this.systemSource,E.min=this.min,E.max=this.max,E.groupInInspector=this.groupInInspector,E.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.upE?(E.valueType="BABYLON."+this._storedValue.getClassName(),E.value=this._storedValue.upE()):(E.valueType="number",E.value=this._storedValue)),E}_deserialize(E){if(super._deserialize(E),this._type=E.type,this.contextualValue=E.contextualValue,this.systemSource=E.systemSource||Mt.None,this.min=E.min||0,this.max=E.max||0,this.groupInInspector=E.groupInInspector||"",void 0!==E.displayInInspector&&(this.displayInInspector=E.displayInInspector),E.valueType)if("number"===E.valueType)this._storedValue=E.value;else{const t=(0,p.d)(E.valueType);t&&(this._storedValue=t.St(E.value))}}}(0,p.f)("BABYLON.ParticleInputBlock",Nt);class Pt extends Ut{get url(){return this._url}set url(E){this._url!==E&&(this._cachedData=null,this._url=E,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(E){this._textureDataUrl!==E&&(this._cachedData=null,this._textureDataUrl=E,this._url="",this._sourceTexture=null)}set sourceTexture(E){this._sourceTexture!==E&&(this._cachedData=null,this._sourceTexture=E,this._url="",this._textureDataUrl="")}constructor(E){super(E),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",gt.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const E=this.texture._storedValue;return await new Promise(((t,z)=>{if(!E.isReady())return void E.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),t(this._cachedData)}catch(E){z(E)}}));const A=E.getSize();xt.l.GetTextureDataAsync(E,A.width,A.height).then((z=>{this._cachedData={width:A.width,height:A.height,data:new Uint8ClampedArray(z)},E.dispose(),t(this._cachedData)})).catch(z)}))}_build(E){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new r.d(this._textureDataUrl,E.It):this.texture._storedValue=new r.d(this._url,E.It):this.texture._storedValue=null}serialize(){const E=super.serialize();return E.url=this.url,E.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(E.textureDataUrl=this.textureDataUrl),E}_deserialize(E){super._deserialize(E),this.url=E.url,this.serializedCachedData=!!E.serializedCachedData,E.textureDataUrl&&(this.textureDataUrl=E.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,p.f)("BABYLON.ParticleTextureSourceBlock",Pt);class Ez extends Ut{constructor(E){super(E),this.registerInput("particle",gt.Particle),this.registerInput("position",gt.Lt),this.registerOutput("output",gt.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(E){const t=this.particle.getConnectedValue(E);if(this.output._storedValue=t,!this.position.isConnected)return;const z={process:z=>{E.particleContext=z,E.systemContext=t,z.position.R(this.position.getConnectedValue(E))},previousItem:null,nextItem:null};t._updateQueueStart?ME(z,t._updateQueueStart):t._updateQueueStart=z}}(0,p.f)("BABYLON.UpdatePositionBlock",Ez),function(E){E[E.Add=0]="Add",E[E.Subtract=1]="Subtract",E[E.Multiply=2]="Multiply",E[E.Divide=3]="Divide",E[E.Max=4]="Max",E[E.Min=5]="Min"}(wt||(wt={}));class tz extends Ut{constructor(E){super(E),this.operation=wt.Add,this.registerInput("left",gt.AutoDetect),this.registerInput("right",gt.AutoDetect),this.registerOutput("output",gt.BasedOnInput),this.output._typeConnectionSource=this.left;const t=[gt.Matrix,gt.Particle,gt.Texture,gt.System,gt.FloatGradient,gt.Color4Gradient,gt.Vector2Gradient,gt.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...t),this.right.excludedConnectionPointTypes.push(...t),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(E){let t;const z=this.left,X=this.right;if(!z.isConnected||!X.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const R=z.type===gt.Float||z.type===gt.Int,p=X.type===gt.Float||X.type===gt.Int,C=R&&p;switch(this.operation){case wt.Add:t=C?E=>z.getConnectedValue(E)+X.getConnectedValue(E):R?E=>E.adapt(z,X.type).add(X.getConnectedValue(E)):E=>z.getConnectedValue(E).add(E.adapt(X,z.type));break;case wt.Subtract:t=C?E=>z.getConnectedValue(E)-X.getConnectedValue(E):R?E=>E.adapt(z,X.type).Wt(X.getConnectedValue(E)):E=>z.getConnectedValue(E).Wt(E.adapt(X,z.type));break;case wt.Multiply:t=C?E=>z.getConnectedValue(E)*X.getConnectedValue(E):R?E=>E.adapt(z,X.type).multiply(X.getConnectedValue(E)):E=>z.getConnectedValue(E).multiply(E.adapt(X,z.type));break;case wt.Divide:t=C?E=>z.getConnectedValue(E)/X.getConnectedValue(E):R?E=>E.adapt(z,X.type).divide(X.getConnectedValue(E)):E=>z.getConnectedValue(E).divide(E.adapt(X,z.type));break;case wt.Min:if(C)t=E=>Math.min(z.getConnectedValue(E),X.getConnectedValue(E));else{const[E,p]=R?[X,z]:[z,X];switch(E.type){case gt.Vector2:t=t=>A.Vector2.Minimize(E.getConnectedValue(t),t.adapt(p,E.type));break;case gt.Lt:t=t=>A.Lt.Minimize(E.getConnectedValue(t),t.adapt(p,E.type));break;case gt.Lp:t=t=>{const z=E.getConnectedValue(t),{r:A,g:X,b:R,a:C}=t.adapt(p,E.type);return new u.Lp(Math.min(z.r,A),Math.min(z.g,X),Math.min(z.b,R),Math.min(z.a,C))}}}break;case wt.Max:if(!C){const[E,p]=R?[X,z]:[z,X];switch(E.type){case gt.Vector2:t=t=>A.Vector2.Maximize(E.getConnectedValue(t),t.adapt(p,E.type));break;case gt.Lt:t=t=>A.Lt.Maximize(E.getConnectedValue(t),t.adapt(p,E.type));break;case gt.Lp:t=t=>{const z=E.getConnectedValue(t),{r:A,g:X,b:R,a:C}=t.adapt(p,E.type);return new u.Lp(Math.max(z.r,A),Math.min(z.g,X),Math.min(z.b,R),Math.min(z.a,C))}}break}t=E=>Math.max(z.getConnectedValue(E),X.getConnectedValue(E))}this.output._storedFunction=E=>z.type===gt.Int?0|t(E):t(E)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===gt.Int||this.left.type===gt.Float&&this.right.type!==gt.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[E,t]of[[this.left,this.right],[this.right,this.left]])E.acceptedConnectionPointTypes=[gt.Int,gt.Float],t.isConnected&&(E.acceptedConnectionPointTypes.push(t.type),t.type!==gt.Int&&t.type!==gt.Float||E.acceptedConnectionPointTypes.push(gt.Vector2,gt.Lt,gt.Lp))}dispose(){super.dispose();for(const E of this._connectionObservers)E.remove();this._connectionObservers.length=0}serialize(){const E=super.serialize();return E.operation=this.operation,E}_deserialize(E){super._deserialize(E),this.operation=E.operation}}(0,x.b)([kt("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:wt.Add},{label:"Subtract",value:wt.Subtract},{label:"Multiply",value:wt.Multiply},{label:"Divide",value:wt.Divide},{label:"Max",value:wt.Max},{label:"Min",value:wt.Min}]})],tz.prototype,"operation",void 0),(0,p.f)("BABYLON.ParticleMathBlock",tz);class zz extends Ut{constructor(E){super(E),this.registerInput("particle",gt.Particle),this.registerInput("direction1",gt.Lt,!0,new A.Lt(0,1,0)),this.registerInput("direction2",gt.Lt,!0,new A.Lt(0,1,0)),this.registerInput("minEmitBox",gt.Lt,!0,new A.Lt(-.5,-.5,-.5)),this.registerInput("maxEmitBox",gt.Lt,!0,new A.Lt(.5,.5,.5)),this.registerOutput("output",gt.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(E){const t=this.particle.getConnectedValue(E);t._directionCreation.process=z=>{E.particleContext=z,E.systemContext=t;const X=this.direction1.getConnectedValue(E),R=this.direction2.getConnectedValue(E),u=(0,Z.RandomRange)(X.x,R.x),p=(0,Z.RandomRange)(X.y,R.y),C=(0,Z.RandomRange)(X.z,R.z);E.isEmitterTransformNode?A.Lt.TransformNormalFromFloatsToRef(u,p,C,E.emitterWorldMatrix,z.direction):z.direction.Op(u,p,C)},t._positionCreation.process=z=>{E.particleContext=z,E.systemContext=t;const X=this.minEmitBox.getConnectedValue(E),R=this.maxEmitBox.getConnectedValue(E),u=(0,Z.RandomRange)(X.x,R.x),p=(0,Z.RandomRange)(X.y,R.y),C=(0,Z.RandomRange)(X.z,R.z);E.isEmitterTransformNode?A.Lt.TransformCoordinatesFromFloatsToRef(u,p,C,E.emitterWorldMatrix,z.position):(z.position.Op(u,p,C),z.position.addInPlace(E.emitterPosition))},this.output._storedValue=t}}(0,p.f)("BABYLON.BoxShapeBlock",zz);class Az extends Ut{constructor(E){super(E),this.registerInput("emitPower",gt.Float,!0,1),this.registerInput("lifeTime",gt.Float,!0,1),this.registerInput("color",gt.Lp,!0,new u.Lp(1,1,1,1)),this.registerInput("scale",gt.Vector2,!0,new A.Vector2(1,1)),this.registerInput("angle",gt.Float,!0,0),this.registerOutput("particle",gt.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(E){const t=new pt(this.name,E.wt,E.It,null,!1,void 0,!0);t.particleEmitterType=new L,t._lifeTimeCreation.process=(t,z)=>{E.particleContext=t,t.lifeTime=this.lifeTime.getConnectedValue(E),z._emitPower=this.emitPower.getConnectedValue(E)},t._colorCreation.process=t=>{E.particleContext=t,t.color.R(this.color.getConnectedValue(E))},t._sizeCreation.process=t=>{E.particleContext=t,t.size=1,t.scale.R(this.scale.getConnectedValue(E))},t._angleCreation.process=t=>{E.particleContext=t,t.angle=this.angle.getConnectedValue(E)},this.particle._storedValue=t}}(0,p.f)("BABYLON.CreateParticleBlock",Az);class Xz{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const E=[];for(const t of this.attachedBlocks)t.isInput&&E.push(t);return E}constructor(E){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new Y.b,this.name=E}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(E){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(E)&&this.attachedBlocks.push(E);for(const z of E.inputs){const A=z.connectedPoint;if(A){const z=A.ownerBlock;z!==E&&this._initializeBlock(z,t)}}}async buildAsync(E){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((z=>{const A=new St;for(const E of this._systemBlocks)this._initializeBlock(E);for(const X of this.systemBlocks){const z=new vt;z.buildId=this._buildId++,z.It=E,z.verbose=t;const R=X.createSystem(z);z.emitErrors(),A.systems.push(R)}this.onBuildObservable.notifyObservers(this),z(A)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const E=new Gt("Particle system"),t=new Ez("Update position");t.output.connectTo(E.particle);const z=new Nt("Position");z.contextualValue=qt.Position;const A=new Nt("Scaled direction");A.contextualValue=qt.ScaledDirection;const X=new tz("Add");X.operation=wt.Add,z.output.connectTo(X.left),A.output.connectTo(X.right),X.output.connectTo(t.position);const R=new Az("Create particle"),u=new zz("Box shape");R.particle.connectTo(u.particle),u.output.connectTo(t.particle);const p=new Pt("Texture");p.texture.connectTo(E.texture),p.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(E)}removeBlock(E){const t=this.attachedBlocks.indexOf(E);if(t>-1&&this.attachedBlocks.splice(t,1),E.isSystem){const t=this._systemBlocks.indexOf(E);t>-1&&this._systemBlocks.splice(t,1)}}parseSerializedObject(E){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||this.clear();const z={};for(const A of E.ZH){const E=(0,p.d)(A.customType);if(E){const t=new E;t._deserialize(A),z[A.id]=t,this.attachedBlocks.push(t),t.isSystem&&this._systemBlocks.push(t)}}for(const A of this.attachedBlocks)if(A.isTeleportOut){const E=A,t=E._tempEntryPointUniqueId;if(t){const A=z[t];A&&A.attachToEndpoint(E)}}for(let A=0;A<E.ZH.length;A++){const X=E.ZH[A],R=z[X.id];R&&(R.inputs.length&&X.inputs.some((E=>E.targetConnectionName))&&!t||this._restoreConnections(R,E,z))}if(E.locations||E.editorData&&E.editorData.locations){const A=E.locations||E.editorData.locations;for(const E of A)z[E.AX]&&(E.AX=z[E.AX].uniqueId);t&&this.editorData&&this.editorData.locations&&A.concat(this.editorData.locations),E.locations?this.editorData={locations:A}:(this.editorData=E.editorData,this.editorData.locations=A);const X=[];for(const E in z)X[E]=z[E].uniqueId;this.editorData.map=X}this.comment=E.comment}_restoreConnections(E,t,z){for(const A of E.outputs)for(const X of t.ZH){const R=z[X.id];if(R)for(const u of X.inputs)if(z[u.targetBlockId]!==E||u.targetConnectionName!==A.name);else{const E=R.getInputByName(u.inputName);if(!E||E.isConnected)continue;A.connectTo(E,!0),this._restoreConnections(R,t,z)}}}serialize(E){const t=E?{}:V.b.Serialize(this);t.editorData=JSON.parse(JSON.stringify(this.editorData));let z=[];E?z=E:t.customType="BABYLON.NodeParticleSystemSet",t.ZH=[];for(const A of z)t.ZH.push(A.serialize());if(!E)for(const A of this.attachedBlocks)-1===z.indexOf(A)&&t.ZH.push(A.serialize());return t}dispose(){for(const E of this.attachedBlocks)E.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(E){const t=new Xz(E);return t.setToDefault(),t}static Parse(E){const t=V.b.Parse((()=>new Xz(E.name)),E,null);return t.parseSerializedObject(E),t}static ParseFromSnippetAsync(E,t){return"_BLANK"===E?Promise.resolve(Xz.CreateDefault("blank")):new Promise(((z,A)=>{const X=new lt.d;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const u=JSON.parse(JSON.parse(X.responseText).jsonPayload),p=JSON.parse(u.nodeParticle);t||(t=V.b.Parse((()=>new Xz(E)),p,null)),t.parseSerializedObject(p),t.snippetId=E;try{z(t)}catch(R){A(R)}}else A("Unable to load the snippet "+E)})),X.open("GET",this.SnippetUrl+"/"+E.replace(/#/g,"/")),X.send()}))}}Xz.EditorURL=`${It.Tools._DefaultCdnUrl}/v${kE.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Xz.SnippetUrl="https://snippet.babylonjs.com",(0,x.b)([(0,J.K)()],Xz.prototype,"name",void 0),(0,x.b)([(0,J.K)("comment")],Xz.prototype,"comment",void 0),function(E){E[E.None=0]="None",E[E.PerParticle=1]="PerParticle",E[E.PerSystem=2]="PerSystem"}(nt||(nt={}));class Rz extends Ut{constructor(E){super(E),this._currentLockId=-2,this.lockMode=nt.PerParticle,this.registerInput("min",gt.AutoDetect,!0,0),this.registerInput("max",gt.AutoDetect,!0,1),this.registerOutput("output",gt.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(gt.Float|gt.Int|gt.Vector2|gt.Lt|gt.Lp),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(gt.Float|gt.Int|gt.Vector2|gt.Lt|gt.Lp),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=gt.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let E=null;switch(this._currentLockId=-2,this.min.type){case gt.AutoDetect:case gt.Int:case gt.Float:E=E=>{const t=this.min.getConnectedValue(E)||0,z=this.max.getConnectedValue(E)||1;return t+Math.random()*(z-t)};break;case gt.Vector2:E=E=>{const t=this.min.getConnectedValue(E)||A.Vector2.Zero(),z=this.max.getConnectedValue(E)||A.Vector2.One();return new A.Vector2(t.x+Math.random()*(z.x-t.x),t.y+Math.random()*(z.y-t.y))};break;case gt.Lt:E=E=>{const t=this.min.getConnectedValue(E)||A.Lt.Zero(),z=this.max.getConnectedValue(E)||A.Lt.One();return new A.Lt(t.x+Math.random()*(z.x-t.x),t.y+Math.random()*(z.y-t.y),t.z+Math.random()*(z.z-t.z))};break;case gt.Lp:E=E=>{const t=this.min.getConnectedValue(E)||new u.Lp(0,0,0,0),z=this.max.getConnectedValue(E)||new u.Lp(1,1,1,1);return new u.Lp(t.x+Math.random()*(z.x-t.x),t.y+Math.random()*(z.y-t.y),t.z+Math.random()*(z.z-t.z),t.w+Math.random()*(z.w-t.w))}}this.output._storedFunction=t=>{var z;let A=0;switch(this.lockMode){case nt.PerParticle:A=(null===(z=t.particleContext)||void 0===z?void 0:z.id)||-1;break;case nt.PerSystem:A=t.buildId||0}return this._currentLockId!==A&&(this.lockMode!==nt.None&&(this._currentLockId=A),this.output._storedValue=E(t)),this.output._storedValue}}serialize(){const E=super.serialize();return E.lockMode=this.lockMode,E}_deserialize(E){super._deserialize(E),this.lockMode=E.lockMode}}(0,x.b)([kt("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:nt.None},{label:"Per particle",value:nt.PerParticle},{label:"Per system",value:nt.PerSystem}]})],Rz.prototype,"lockMode",void 0),(0,p.f)("BABYLON.ParticleRandomBlock",Rz);class uz extends Ut{constructor(E){super(E),this._currentLockId=-2,this.lockMode=nt.PerParticle,this.registerInput("min",gt.AutoDetect),this.registerInput("max",gt.AutoDetect),this.registerOutput("output",gt.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const t=[gt.Matrix,gt.Particle,gt.Texture,gt.System,gt.FloatGradient,gt.Color4Gradient,gt.Vector2Gradient,gt.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...t),this.max.excludedConnectionPointTypes.push(...t)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let E=null;switch(this._currentLockId=-2,this.min.type){case gt.Float:case gt.Int:E=E=>{const t=this.min.getConnectedValue(E),z=this.max.getConnectedValue(E);return Math.random()*(z-t)+t};break;case gt.Vector2:E=E=>{const t=this.min.getConnectedValue(E),z=this.max.getConnectedValue(E);return new A.Vector2(Math.random()*(z.x-t.x)+t.x,Math.random()*(z.y-t.y)+t.y)};break;case gt.Lt:E=E=>{const t=this.min.getConnectedValue(E),z=this.max.getConnectedValue(E);return new A.Lt(Math.random()*(z.x-t.x)+t.x,Math.random()*(z.y-t.y)+t.y,Math.random()*(z.z-t.z)+t.z)};break;case gt.Lp:E=E=>{const t=this.min.getConnectedValue(E),z=this.max.getConnectedValue(E);return new u.Lp(Math.random()*(z.r-t.r)+t.r,Math.random()*(z.g-t.g)+t.g,Math.random()*(z.b-t.b)+t.b,Math.random()*(z.a-t.a)+t.a)}}this.output._storedFunction=t=>{var z;let A=0;switch(this.lockMode){case nt.PerParticle:A=(null===(z=t.particleContext)||void 0===z?void 0:z.id)||-1;break;case nt.PerSystem:A=t.buildId||0}return this._currentLockId!==A&&(this.lockMode!==nt.None&&(this._currentLockId=A),this.output._storedValue=E(t)),this.output._storedValue}}serialize(){const E=super.serialize();return E.lockMode=this.lockMode,E}_deserialize(E){super._deserialize(E),void 0!==E.lockMode&&(this.lockMode=E.lockMode)}}(0,x.b)([kt("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:nt.None},{label:"Per particle",value:nt.PerParticle},{label:"Per system",value:nt.PerSystem}]})],uz.prototype,"lockMode",void 0),(0,p.f)("BABYLON.RandomRangeBlock",uz);(0,p.f)("BABYLON.ParticleLerpBlock",class extends Ut{constructor(E){super(E),this.registerInput("left",gt.AutoDetect),this.registerInput("right",gt.AutoDetect),this.registerInput("gradient",gt.Float,!0,0,0,1),this.registerOutput("output",gt.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(gt.Float|gt.Int|gt.Vector2|gt.Lt|gt.Lp)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const E=(E,t,z)=>(1-E)*t+E*z;this.output._storedFunction=t=>{const z=this.left.getConnectedValue(t),X=this.right.getConnectedValue(t),R=this.gradient.getConnectedValue(t);switch(this.left.type){case gt.Int:case gt.Float:return E(R,z,X);case gt.Vector2:return new A.Vector2(E(R,z.x,X.x),E(R,z.y,X.y));case gt.Lt:return new A.Lt(E(R,z.x,X.x),E(R,z.y,X.y),E(R,z.z,X.z));case gt.Lp:return new u.Lp(E(R,z.r,X.r),E(R,z.g,X.g),E(R,z.b,X.b),E(R,z.a,X.a))}return 0}}});(0,p.f)("BABYLON.UpdateDirectionBlock",class extends Ut{constructor(E){super(E),this.registerInput("particle",gt.Particle),this.registerInput("direction",gt.Lt),this.registerOutput("output",gt.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(E){const t=this.particle.getConnectedValue(E);if(this.output._storedValue=t,!this.direction.isConnected)return;const z={process:z=>{E.particleContext=z,E.systemContext=t,z.direction.R(this.direction.getConnectedValue(E))},previousItem:null,nextItem:null};t._updateQueueStart?ME(z,t._updateQueueStart):t._updateQueueStart=z}});(0,p.f)("BABYLON.UpdateColorBlock",class extends Ut{constructor(E){super(E),this.registerInput("particle",gt.Particle),this.registerInput("color",gt.Lp),this.registerOutput("output",gt.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(E){const t=this.particle.getConnectedValue(E);if(this.output._storedValue=t,!this.color.isConnected)return;const z={process:z=>{E.particleContext=z,E.systemContext=t,z.color.R(this.color.getConnectedValue(E))},previousItem:null,nextItem:null};t._updateQueueStart?ME(z,t._updateQueueStart):t._updateQueueStart=z}});(0,p.f)("BABYLON.UpdateScaleBlock",class extends Ut{constructor(E){super(E),this.registerInput("particle",gt.Particle),this.registerInput("scale",gt.Vector2),this.registerOutput("output",gt.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(E){const t=this.particle.getConnectedValue(E);if(this.output._storedValue=t,!this.scale.isConnected)return;const z={process:z=>{E.particleContext=z,E.systemContext=t,z.scale.R(this.scale.getConnectedValue(E))},previousItem:null,nextItem:null};t._updateQueueStart?ME(z,t._updateQueueStart):t._updateQueueStart=z}});(0,p.f)("BABYLON.UpdateAngleBlock",class extends Ut{constructor(E){super(E),this.registerInput("particle",gt.Particle),this.registerInput("angle",gt.Float),this.registerOutput("output",gt.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(E){const t=this.particle.getConnectedValue(E);if(this.output._storedValue=t,!this.angle.isConnected)return;const z={process:z=>{E.particleContext=z,E.systemContext=t,z.angle=this.angle.getConnectedValue(E)},previousItem:null,nextItem:null};t._updateQueueStart?ME(z,t._updateQueueStart):t._updateQueueStart=z}});(0,p.f)("BABYLON.BasicPositionUpdateBlock",class extends Ut{constructor(E){super(E),this.registerInput("particle",gt.Particle),this.registerOutput("output",gt.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(E){const t=this.particle.getConnectedValue(E),z={process:z=>{E.particleContext=z,E.systemContext=t,z.direction.scaleToRef(t._directionScale,t._scaledDirection),z.position.addInPlace(t._scaledDirection)},previousItem:null,nextItem:null};t._updateQueueStart?ME(z,t._updateQueueStart):t._updateQueueStart=z,this.output._storedValue=t}});(0,p.f)("BABYLON.BasicSpriteUpdateBlock",class extends Ut{constructor(E){super(E),this.registerInput("particle",gt.Particle),this.registerOutput("output",gt.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(E){const t=this.particle.getConnectedValue(E),z={process:z=>{E.particleContext=z,E.systemContext=t,z.updateCellIndex()},previousItem:null,nextItem:null};t._updateQueueStart?ME(z,t._updateQueueStart):t._updateQueueStart=z,this.output._storedValue=t}});(0,p.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends Ut{constructor(E){super(E),this.registerInput("particle",gt.Particle),this.registerInput("cellIndex",gt.Int),this.registerOutput("output",gt.Particle),this.cellIndex.acceptedConnectionPointTypes=[gt.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(E){const t=this.particle.getConnectedValue(E);if(this.output._storedValue=t,!this.cellIndex.isConnected)return;const z={process:z=>{E.particleContext=z,E.systemContext=t,z.cellIndex=Math.floor(this.cellIndex.getConnectedValue(E))},previousItem:null,nextItem:null};t._updateQueueStart?ME(z,t._updateQueueStart):t._updateQueueStart=z}});class pz extends Ut{constructor(E){super(E),this.strength=1,this.registerInput("particle",gt.Particle),this.registerInput("flowMap",gt.Texture),this.registerOutput("output",gt.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(E){var t;const z=this.particle.getConnectedValue(E),A=E.It;let X;(null===(t=this.flowMap.connectedPoint)||void 0===t?void 0:t.ownerBlock).extractTextureContentAsync().then((E=>{E&&(X=new it(E.width,E.height,E.data))}));const R={process:E=>{const t=A.getTransformMatrix();X&&X._processParticle(E,this.strength*z._tempScaledUpdateSpeed,t)},previousItem:null,nextItem:null};z._updateQueueStart?ME(R,z._updateQueueStart):z._updateQueueStart=R,this.output._storedValue=z}serialize(){const E=super.serialize();return E.strength=this.strength,E}_deserialize(E){super._deserialize(E),this.strength=E.strength}}(0,x.b)([kt("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pz.prototype,"strength",void 0),(0,p.f)("BABYLON.UpdateFlowMapBlock",pz);(0,p.f)("BABYLON.SphereShapeBlock",class extends Ut{constructor(E){super(E),this.registerInput("input",gt.Particle),this.registerInput("radius",gt.Float,!0,1),this.registerInput("radiusRange",gt.Float,!0,1,0,1),this.registerInput("directionRandomizer",gt.Float,!0,0,0,1),this.registerOutput("output",gt.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(E){const t=this.input.getConnectedValue(E);t._directionCreation.process=z=>{E.particleContext=z,E.systemContext=t;const X=this.directionRandomizer.getConnectedValue(E),R=z.position.Wt(E.emitterPosition).normalize(),u=(0,Z.RandomRange)(0,X),p=(0,Z.RandomRange)(0,X),C=(0,Z.RandomRange)(0,X);R.x+=u,R.y+=p,R.z+=C,R.normalize(),E.isEmitterTransformNode?A.Lt.TransformNormalFromFloatsToRef(u,p,C,E.emitterWorldMatrix,z.direction):z.direction.Op(u,p,C)},t._positionCreation.process=z=>{E.particleContext=z,E.systemContext=t;const X=this.radius.getConnectedValue(E),R=this.radiusRange.getConnectedValue(E),u=X-(0,Z.RandomRange)(0,X*R),p=(0,Z.RandomRange)(0,1),C=(0,Z.RandomRange)(0,2*Math.PI),H=Math.acos(2*p-1),h=u*Math.cos(C)*Math.sin(H),d=u*Math.cos(H),y=u*Math.sin(C)*Math.sin(H);E.isEmitterTransformNode?A.Lt.TransformCoordinatesFromFloatsToRef(h,d,y,E.emitterWorldMatrix,z.position):(z.position.Op(h,d,y),z.position.addInPlace(E.emitterPosition))},this.output._storedValue=t}});(0,p.f)("BABYLON.PointShapeBlock",class extends Ut{constructor(E){super(E),this.registerInput("particle",gt.Particle),this.registerInput("direction1",gt.Lt,!0,new A.Lt(0,1,0)),this.registerInput("direction2",gt.Lt,!0,new A.Lt(0,1,0)),this.registerOutput("output",gt.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(E){const t=this.particle.getConnectedValue(E);t._directionCreation.process=z=>{E.particleContext=z,E.systemContext=t;const X=this.direction1.getConnectedValue(E),R=this.direction2.getConnectedValue(E),u=(0,Z.RandomRange)(X.x,R.x),p=(0,Z.RandomRange)(X.y,R.y),C=(0,Z.RandomRange)(X.z,R.z);E.isEmitterTransformNode?A.Lt.TransformNormalFromFloatsToRef(u,p,C,E.emitterWorldMatrix,z.direction):z.direction.Op(u,p,C)},t._positionCreation.process=z=>{E.systemContext=t,E.isEmitterTransformNode?A.Lt.TransformCoordinatesFromFloatsToRef(0,0,0,E.emitterWorldMatrix,z.position):z.position.R(E.emitterPosition)},this.output._storedValue=t}});(0,p.f)("BABYLON.CustomShapeBlock",class extends Ut{constructor(E){super(E),this.registerInput("particle",gt.Particle),this.registerInput("position",gt.Lt,!0,new A.Lt(0,0,0)),this.registerInput("direction",gt.Lt,!0,new A.Lt(0,1,0)),this.registerOutput("output",gt.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(E){const t=this.particle.getConnectedValue(E);t._directionCreation.process=z=>{E.particleContext=z,E.systemContext=t;const X=this.direction.getConnectedValue(E);E.isEmitterTransformNode?A.Lt.TransformNormalToRef(X,E.emitterWorldMatrix,z.direction):z.direction.R(X)},t._positionCreation.process=z=>{E.particleContext=z,E.systemContext=t;const X=this.position.getConnectedValue(E);E.isEmitterTransformNode?A.Lt.TransformCoordinatesToRef(X,E.emitterWorldMatrix,z.position):(z.position.R(X),z.position.addInPlace(E.emitterPosition))},this.output._storedValue=t}});(0,p.f)("BABYLON.CylinderShapeBlock",class extends Ut{constructor(E){super(E),this._tempVector=A.Lt.Zero(),this.registerInput("particle",gt.Particle),this.registerInput("radius",gt.Float,!0,1),this.registerInput("height",gt.Float,!0,1,0),this.registerInput("radiusRange",gt.Float,!0,1,0,1),this.registerInput("directionRandomizer",gt.Float,!0,0,0,1),this.registerOutput("output",gt.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(E){const t=this.particle.getConnectedValue(E);t._directionCreation.process=z=>{E.particleContext=z,E.systemContext=t;const X=this.directionRandomizer.getConnectedValue(E);z.position.subtractToRef(E.emitterPosition,this._tempVector),this._tempVector.normalize(),E.isEmitterTransformNode&&A.Lt.TransformNormalToRef(this._tempVector,E.emitterInverseWorldMatrix,this._tempVector);const R=(0,Z.RandomRange)(-X/2,X/2);let u=Math.atan2(this._tempVector.x,this._tempVector.z);u+=(0,Z.RandomRange)(-Math.PI/2,Math.PI/2)*X,this._tempVector.y=R,this._tempVector.x=Math.sin(u),this._tempVector.z=Math.cos(u),this._tempVector.normalize(),E.isEmitterTransformNode?A.Lt.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,E.emitterWorldMatrix,z.direction):z.direction.R(this._tempVector)},t._positionCreation.process=z=>{E.particleContext=z,E.systemContext=t;const X=this.height.getConnectedValue(E),R=this.radiusRange.getConnectedValue(E),u=this.radius.getConnectedValue(E),p=(0,Z.RandomRange)(-X/2,X/2),C=(0,Z.RandomRange)(0,2*Math.PI),H=(0,Z.RandomRange)((1-R)*(1-R),1),h=Math.sqrt(H)*u,d=h*Math.cos(C),y=h*Math.sin(C);E.isEmitterTransformNode?A.Lt.TransformCoordinatesFromFloatsToRef(d,p,y,E.emitterWorldMatrix,z.position):(z.position.Op(d,p,y),z.position.addInPlace(E.emitterPosition))},this.output._storedValue=t}});class Cz extends Ut{constructor(E){super(E),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",gt.Particle),this.registerOutput("output",gt.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(E){super._build(E);const t=this.particle.getConnectedValue(E);t._isAnimationSheetEnabled=!0,t.spriteCellWidth=this.width,t.spriteCellHeight=this.height,t.startSpriteCellID=this.start,t.endSpriteCellID=this.end,t.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=t}serialize(){const E=super.serialize();return E.width=this.width,E.height=this.height,E.start=this.start,E.end=this.end,E.randomStartCell=this.randomStartCell,E}_deserialize(E){super._deserialize(E),this.width=E.width,this.height=E.height,this.start=E.start,this.end=E.end,this.randomStartCell=E.randomStartCell}}(0,x.b)([kt("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cz.prototype,"start",void 0),(0,x.b)([kt("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cz.prototype,"end",void 0),(0,x.b)([kt("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cz.prototype,"width",void 0),(0,x.b)([kt("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cz.prototype,"height",void 0),(0,x.b)([kt("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Cz.prototype,"loop",void 0),(0,x.b)([kt("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Cz.prototype,"randomStartCell",void 0),(0,p.f)("BABYLON.SetupSpriteSheetBlock",Cz);class Zz extends Ut{constructor(E){super(E),this.reference=0,this.registerInput("value",gt.AutoDetect),this.registerOutput("output",gt.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=E=>{switch(E){case gt.Float:return gt.FloatGradient;case gt.Vector2:return gt.Vector2Gradient;case gt.Lt:return gt.Vector3Gradient;case gt.Lp:return gt.Color4Gradient}return E},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(gt.Float|gt.Vector2|gt.Lt|gt.Lp)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=E=>null}serialize(){const E=super.serialize();return E.reference=this.reference,E}_deserialize(E){super._deserialize(E),this.reference=E.reference}}(0,x.b)([kt("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Zz.prototype,"reference",void 0),(0,p.f)("BABYLON.ParticleGradientValueBlock",Zz);(0,p.f)("BABYLON.ParticleGradientBlock",class extends Ut{constructor(E){super(E),this._entryCount=1,this.registerInput("gradient",gt.Float,!0,1,0,1),this.registerInput("value0",gt.AutoDetect),this.registerOutput("output",gt.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=E=>{switch(E){case gt.FloatGradient:return gt.Float;case gt.Vector2Gradient:return gt.Vector2;case gt.Vector3Gradient:return gt.Lt;case gt.Color4Gradient:return gt.Lp}return E},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(gt.FloatGradient|gt.Vector2Gradient|gt.Vector3Gradient|gt.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(E){this._inputs[E].onConnectionObservable.add((()=>{this._entryCount>E||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),gt.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const E=[];for(let z=1;z<this._inputs.length;z++){var t;if(this._inputs[z].isConnected)E.push(null===(t=this._inputs[z].connectedPoint)||void 0===t?void 0:t.ownerBlock)}E.sort(((E,t)=>E.reference-t.reference)),this.output._storedFunction=t=>{const z=this.gradient.getConnectedValue(t);if(1===E.length)return E[0].value.getConnectedValue(t);let X=null;for(let R=E.length-1;R>=0;R--){const p=E[R];if(p.reference<=z){const E=p.value.getConnectedValue(t);if(X){const R=X.value.getConnectedValue(t),C=X.reference,H=p.reference,h=Math.max(0,Math.min(1,(z-H)/(C-H)));switch(this.output.type){case gt.Float:return(0,Z.Lerp)(E,R,h);case gt.Vector2:return A.Vector2.Lerp(E,R,h);case gt.Lt:return A.Lt.Lerp(E,R,h);case gt.Lp:return u.Lp.Lerp(E,R,h)}}return E}X=p}return 0}}});(0,p.f)("BABYLON.ParticleConverterBlock",class extends Ut{constructor(E){super(E),this.registerInput("color ",gt.Lp,!0),this.registerInput("xyz ",gt.Lt,!0),this.registerInput("xy ",gt.Vector2,!0),this.registerInput("zw ",gt.Vector2,!0),this.registerInput("x ",gt.Float,!0),this.registerInput("y ",gt.Float,!0),this.registerInput("z ",gt.Float,!0),this.registerInput("w ",gt.Float,!0),this.registerOutput("color",gt.Lp),this.registerOutput("xyz",gt.Lt),this.registerOutput("xy",gt.Vector2),this.registerOutput("zw",gt.Vector2),this.registerOutput("x",gt.Float),this.registerOutput("y",gt.Float),this.registerOutput("z",gt.Float),this.registerOutput("w",gt.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(E){return"color "===E?"colorIn":"xyz "===E?"xyzIn":"xy "===E?"xyIn":"zw "===E?"zwIn":"x "===E?"xIn":"y "===E?"yIn":"z "===E?"zIn":"w "===E?"wIn":E}_outputRename(E){switch(E){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return E}}_build(E){super._build(E);const t=this.xIn,z=this.yIn,X=this.zIn,R=this.wIn,p=this.xyIn,C=this.zwIn,Z=this.xyzIn,H=this.colorIn,h=this.colorOut,d=this.xyzOut,y=this.xyOut,O=this.zwOut,c=this.xOut,a=this.yOut,L=this.zOut,mE=this.wOut,W=E=>{if(H.isConnected)return H.getConnectedValue(E);let A=0,h=0,d=0,y=0;if(t.isConnected&&(A=t.getConnectedValue(E)),z.isConnected&&(h=z.getConnectedValue(E)),X.isConnected&&(d=X.getConnectedValue(E)),R.isConnected&&(y=R.getConnectedValue(E)),p.isConnected){const t=p.getConnectedValue(E);t&&(A=t.x,h=t.y)}if(C.isConnected){const t=C.getConnectedValue(E);t&&(d=t.x,y=t.y)}if(Z.isConnected){const t=Z.getConnectedValue(E);t&&(A=t.x,h=t.y,d=t.z)}return new u.Lp(A,h,d,y)};h._storedFunction=E=>W(E),d._storedFunction=E=>{const t=W(E);return new A.Lt(t.r,t.g,t.b)},y._storedFunction=E=>{const t=W(E);return new A.Vector2(t.r,t.g)},O._storedFunction=E=>{const t=W(E);return new A.Vector2(t.b,t.a)},c._storedFunction=E=>W(E).r,a._storedFunction=E=>W(E).g,L._storedFunction=E=>W(E).b,mE._storedFunction=E=>W(E).a}}),function(E){E[E.Cos=0]="Cos",E[E.Sin=1]="Sin",E[E.Abs=2]="Abs",E[E.Exp=3]="Exp",E[E.Exp2=4]="Exp2",E[E.Round=5]="Round",E[E.Floor=6]="Floor",E[E.Ceiling=7]="Ceiling",E[E.Sqrt=8]="Sqrt",E[E.Log=9]="Log",E[E.Tan=10]="Tan",E[E.ArcTan=11]="ArcTan",E[E.ArcCos=12]="ArcCos",E[E.ArcSin=13]="ArcSin",E[E.Sign=14]="Sign",E[E.Negate=15]="Negate",E[E.OneMinus=16]="OneMinus",E[E.Reciprocal=17]="Reciprocal",E[E.ToDegrees=18]="ToDegrees",E[E.ToRadians=19]="ToRadians",E[E.Fract=20]="Fract"}(st||(st={}));class Hz extends Ut{constructor(E){super(E),this.operation=st.Cos,this.registerInput("input",gt.AutoDetect),this.registerOutput("output",gt.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(gt.Float|gt.Int|gt.Vector2|gt.Lt|gt.Lp)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(E){super._build(E);let t=null;switch(this.operation){case st.Cos:t=E=>Math.cos(E);break;case st.Sin:t=E=>Math.sin(E);break;case st.Abs:t=E=>Math.abs(E);break;case st.Exp:t=E=>Math.exp(E);break;case st.Exp2:t=E=>Math.pow(2,E);break;case st.Round:t=E=>Math.round(E);break;case st.Floor:t=E=>Math.floor(E);break;case st.Ceiling:t=E=>Math.ceil(E);break;case st.Sqrt:t=E=>Math.sqrt(E);break;case st.Log:t=E=>Math.log(E);break;case st.Tan:t=E=>Math.tan(E);break;case st.ArcTan:t=E=>Math.atan(E);break;case st.ArcCos:t=E=>Math.acos(E);break;case st.ArcSin:t=E=>Math.asin(E);break;case st.Sign:t=E=>Math.sign(E);break;case st.Negate:t=E=>-E;break;case st.OneMinus:t=E=>1-E;break;case st.Reciprocal:t=E=>1/E;break;case st.ToRadians:t=E=>E*Math.PI/180;break;case st.ToDegrees:t=E=>180*E/Math.PI;break;case st.Fract:t=E=>E>=0?E-Math.floor(E):E-Math.ceil(E)}if(!t)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case gt.Int:case gt.Float:this.output._storedFunction=E=>{const z=this.input.getConnectedValue(E);return t(z)};break;case gt.Vector2:this.output._storedFunction=E=>{const z=this.input.getConnectedValue(E);return new A.Vector2(t(z.x),t(z.y))};break;case gt.Lt:this.output._storedFunction=E=>{const z=this.input.getConnectedValue(E);return new A.Lt(t(z.x),t(z.y),t(z.z))};break;case gt.Lp:this.output._storedFunction=E=>{const z=this.input.getConnectedValue(E);return new u.Lp(t(z.r),t(z.g),t(z.b),t(z.a))}}return this}serialize(){const E=super.serialize();return E.operation=this.operation,E}_deserialize(E){super._deserialize(E),this.operation=E.operation}}(0,x.b)([kt("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:st.Cos},{label:"Sin",value:st.Sin},{label:"Abs",value:st.Abs},{label:"Exp",value:st.Exp},{label:"Exp2",value:st.Exp2},{label:"Round",value:st.Round},{label:"Floor",value:st.Floor},{label:"Ceiling",value:st.Ceiling},{label:"Sqrt",value:st.Sqrt},{label:"Log",value:st.Log},{label:"Tan",value:st.Tan},{label:"ArcTan",value:st.ArcTan},{label:"ArcCos",value:st.ArcCos},{label:"ArcSin",value:st.ArcSin},{label:"Sign",value:st.Sign},{label:"Negate",value:st.Negate},{label:"OneMinus",value:st.OneMinus},{label:"Reciprocal",value:st.Reciprocal},{label:"ToDegrees",value:st.ToDegrees},{label:"ToRadians",value:st.ToRadians},{label:"Fract",value:st.Fract}]})],Hz.prototype,"operation",void 0),(0,p.f)("BABYLON.ParticleTrigonometryBlock",Hz);var hz,dz=z(13173);class yz extends Ut{constructor(E){super(E),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",gt.AutoDetect),this.registerOutput("output",gt.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(gt.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(gt.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(gt.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(gt.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(gt.System),this._inputs[0].excludedConnectionPointTypes.push(gt.Particle),this._inputs[0].excludedConnectionPointTypes.push(gt.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(E){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const t=E=>{const t=this.input.getConnectedValue(E);if(this.log.length>=this.stackSize)return t;if(null===t||void 0===t)return this.log.push(["null",""]),t;switch(this.input.type){case gt.Vector2:this.log.push([(0,dz.l)(t,4),t.toString()]);break;case gt.Lt:this.log.push([(0,dz.o)(t,4),t.toString()]);break;case gt.Lp:this.log.push([`{R: ${t.r.toFixed(4)} G: ${t.g.toFixed(4)} B: ${t.b.toFixed(4)} A: ${t.a.toFixed(4)}}`,t.toString()]);break;default:this.log.push([t.toString(),t.toString()])}return t};this.output.isConnected?this.output._storedFunction=t:this.output._storedValue=t(E)}serialize(){const E=super.serialize();return E.stackSize=this.stackSize,E}_deserialize(E){super._deserialize(E),this.stackSize=E.stackSize}}(0,x.b)([kt("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],yz.prototype,"stackSize",void 0),(0,p.f)("BABYLON.ParticleDebugBlock",yz);(0,p.f)("BABYLON.ParticleElbowBlock",class extends Ut{constructor(E){super(E),this.registerInput("input",gt.AutoDetect),this.registerOutput("output",gt.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(E){super._build(E);const t=this._outputs[0],z=this._inputs[0];t._storedFunction=E=>z.getConnectedValue(E)}});(0,p.f)("BABYLON.ParticleTeleportInBlock",class extends Ut{get endpoints(){return this._endpoints}constructor(E){super(E),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",gt.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(E){if(this.getClassName()===E)return!0;for(const t of this.endpoints)if(t.isAnAncestorOfType(E))return!0;return!1}isAnAncestorOf(E){for(const t of this.endpoints){if(t===E)return!0;if(t.isAnAncestorOf(E))return!0}return!1}attachToEndpoint(E){E.detach(),this._endpoints.push(E),E._entryPoint=this,E._outputs[0]._typeConnectionSource=this._inputs[0],E._tempEntryPointUniqueId=null,E.name="> "+this.name}detachFromEndpoint(E){const t=this._endpoints.indexOf(E);-1!==t&&(this._endpoints.splice(t,1),E._outputs[0]._typeConnectionSource=null,E._entryPoint=null)}_build(){for(const E of this._endpoints)E.output._storedFunction=E=>this.input.getConnectedValue(E)}});(0,p.f)("BABYLON.ParticleTeleportOutBlock",class extends Ut{constructor(E){super(E),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",gt.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(E){this.entryPoint&&this.entryPoint.build(E)}clone(){const E=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(E),E}serialize(){var E;const t=super.serialize();return t.entryPoint=(null===(E=this.entryPoint)||void 0===E?void 0:E.uniqueId)??"",t}_deserialize(E){super._deserialize(E),this._tempEntryPointUniqueId=E.entryPoint}}),function(E){E[E.Equal=0]="Equal",E[E.NotEqual=1]="NotEqual",E[E.LessThan=2]="LessThan",E[E.GreaterThan=3]="GreaterThan",E[E.LessOrEqual=4]="LessOrEqual",E[E.GreaterOrEqual=5]="GreaterOrEqual",E[E.Xor=6]="Xor",E[E.Or=7]="Or",E[E.And=8]="And"}(hz||(hz={}));class Oz extends Ut{constructor(E){super(E),this.test=hz.Equal,this.epsilon=0,this.registerInput("left",gt.Float),this.registerInput("right",gt.Float,!0,0),this.registerInput("ifTrue",gt.AutoDetect,!0,1),this.registerInput("ifFalse",gt.AutoDetect,!0,0),this.registerOutput("output",gt.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=gt.Float,this._inputs[0].acceptedConnectionPointTypes.push(gt.Int),this._inputs[1].acceptedConnectionPointTypes.push(gt.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const E=E=>{const t=this.left.getConnectedValue(E),z=this.right.getConnectedValue(E);let A=!1;switch(this.test){case hz.Equal:A=(0,Z.WithinEpsilon)(t,z,this.epsilon);break;case hz.NotEqual:A=!(0,Z.WithinEpsilon)(t,z,this.epsilon);break;case hz.LessThan:A=t<z+this.epsilon;break;case hz.GreaterThan:A=t>z-this.epsilon;break;case hz.LessOrEqual:A=t<=z+this.epsilon;break;case hz.GreaterOrEqual:A=t>=z-this.epsilon;break;case hz.Xor:A=!!t&&!z||!t&&!!z;break;case hz.Or:A=!!t||!!z;break;case hz.And:A=!!t&&!!z}return A};this.output._storedFunction=t=>E(t)?this.ifTrue.getConnectedValue(t):this.ifFalse.getConnectedValue(t)}serialize(){const E=super.serialize();return E.test=this.test,E.epsilon=this.epsilon,E}_deserialize(E){super._deserialize(E),this.test=E.test,void 0!==E.epsilon&&(this.epsilon=E.epsilon)}}(0,x.b)([kt("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:hz.Equal},{label:"NotEqual",value:hz.NotEqual},{label:"LessThan",value:hz.LessThan},{label:"GreaterThan",value:hz.GreaterThan},{label:"LessOrEqual",value:hz.LessOrEqual},{label:"GreaterOrEqual",value:hz.GreaterOrEqual},{label:"Xor",value:hz.Xor},{label:"Or",value:hz.Or},{label:"And",value:hz.And}]})],Oz.prototype,"test",void 0),(0,x.b)([kt("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Oz.prototype,"epsilon",void 0),(0,p.f)("BABYLON.ParticleConditionBlock",Oz);class cz extends Ut{constructor(E){super(E),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",gt.Particle),this.registerInput("condition",gt.Float,!0,0),this.registerInput("system",gt.System),this.registerOutput("output",gt.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(E){this._triggerCount=0;const t=this.input.getConnectedValue(E),z={process:z=>{if(E.particleContext=z,E.systemContext=t,0!==this.condition.getConnectedValue(E)&&(0===this.limit||this._triggerCount<this.limit)){const A=(new Date).getTime();if(this._previousOne&&A-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=A;const X=this.system.getConnectedValue(E);if(X){const A=Yt(X,E.It,z.position);A.IX.addOnce((()=>{this._triggerCount--})),t.IX.addOnce((()=>{A.dispose()}))}}},previousItem:null,nextItem:null};t._updateQueueStart?ME(z,t._updateQueueStart):t._updateQueueStart=z,this.output._storedValue=t}serialize(){const E=super.serialize();return E.limit=this.limit,E.delay=this.delay,E}_deserialize(E){super._deserialize(E),void 0!==E.limit&&(this.limit=E.limit),void 0!==E.delay&&(this.delay=E.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,x.b)([kt("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],cz.prototype,"limit",void 0),(0,x.b)([kt("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],cz.prototype,"delay",void 0),(0,p.f)("BABYLON.ParticleTriggerBlock",cz);z(13180),z(13195),z(13206),z(13258)},13241:(E,t,z)=>{"use strict";var A=z(11726);const X="clipPlaneFragment",R="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13214:(E,t,z)=>{"use strict";var A=z(11726);const X="clipPlaneFragmentDeclaration",R="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13272:(E,t,z)=>{"use strict";var A=z(11726);const X="clipPlaneVertex",R="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13261:(E,t,z)=>{"use strict";var A=z(11726);const X="clipPlaneVertexDeclaration",R="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13249:(E,t,z)=>{"use strict";var A=z(11726);const X="fogFragment",R="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13232:(E,t,z)=>{"use strict";var A=z(11726);const X="fogFragmentDeclaration",R="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13275:(E,t,z)=>{"use strict";var A=z(11726);const X="fogVertex",R="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13265:(E,t,z)=>{"use strict";var A=z(11726);const X="fogVertexDeclaration",R="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13226:(E,t,z)=>{"use strict";var A=z(11726);const X="helperFunctions",R="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13216:(E,t,z)=>{"use strict";var A=z(11726);const X="imageProcessingDeclaration",R="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13229:(E,t,z)=>{"use strict";var A=z(11726);const X="imageProcessingFunctions",R="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13221:(E,t,z)=>{"use strict";var A=z(11726);const X="logDepthDeclaration",R="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13245:(E,t,z)=>{"use strict";var A=z(11726);const X="logDepthFragment",R="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13279:(E,t,z)=>{"use strict";var A=z(11726);const X="logDepthVertex",R="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";A.d.IncludesShadersStoreWGSL[X]||(A.d.IncludesShadersStoreWGSL[X]=R)},13206:(E,t,z)=>{"use strict";z.r(t),z.d(t,{particlesPixelShaderWGSL:()=>u});var A=z(11726);z(13214),z(13216),z(13221),z(13226),z(13229),z(13232),z(13241),z(13245),z(13249);const X="particlesPixelShader",R="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";A.d.ShadersStoreWGSL[X]||(A.d.ShadersStoreWGSL[X]=R);const u={name:X,shader:R}},13258:(E,t,z)=>{"use strict";z.r(t),z.d(t,{particlesVertexShaderWGSL:()=>u});var A=z(11726);z(13261),z(13265),z(13221),z(13272),z(13275),z(13279);const X="particlesVertexShader",R="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";A.d.ShadersStoreWGSL[X]||(A.d.ShadersStoreWGSL[X]=R);const u={name:X,shader:R}},13106:(E,t,z)=>{"use strict";var A=z(11726);const X="clipPlaneFragment",R="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13188:(E,t,z)=>{"use strict";var A=z(11726);const X="clipPlaneFragmentDeclaration",R="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13134:(E,t,z)=>{"use strict";var A=z(11726);const X="clipPlaneVertex",R="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13204:(E,t,z)=>{"use strict";var A=z(11726);const X="clipPlaneVertexDeclaration",R="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13123:(E,t,z)=>{"use strict";var A=z(11726);const X="fogFragment",R="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13102:(E,t,z)=>{"use strict";var A=z(11726);const X="fogFragmentDeclaration",R="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13141:(E,t,z)=>{"use strict";var A=z(11726);const X="fogVertex",R="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13128:(E,t,z)=>{"use strict";var A=z(11726);const X="fogVertexDeclaration",R="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13093:(E,t,z)=>{"use strict";var A=z(11726);const X="helperFunctions",R="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13075:(E,t,z)=>{"use strict";var A=z(11726);const X="imageProcessingDeclaration",R="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13097:(E,t,z)=>{"use strict";var A=z(11726);const X="imageProcessingFunctions",R="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13084:(E,t,z)=>{"use strict";var A=z(11726);const X="logDepthDeclaration",R="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13114:(E,t,z)=>{"use strict";var A=z(11726);const X="logDepthFragment",R="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13145:(E,t,z)=>{"use strict";var A=z(11726);const X="logDepthVertex",R="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";A.d.IncludesShadersStore[X]||(A.d.IncludesShadersStore[X]=R)},13180:(E,t,z)=>{"use strict";z.r(t),z.d(t,{particlesPixelShader:()=>u});var A=z(11726);z(13188),z(13075),z(13084),z(13093),z(13097),z(13102),z(13106),z(13114),z(13123);const X="particlesPixelShader",R="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";A.d.ShadersStore[X]||(A.d.ShadersStore[X]=R);const u={name:X,shader:R}},13195:(E,t,z)=>{"use strict";z.r(t),z.d(t,{particlesVertexShader:()=>u});var A=z(11726);z(13204),z(13128),z(13084),z(13134),z(13141),z(13145);const X="particlesVertexShader",R="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";A.d.ShadersStore[X]||(A.d.ShadersStore[X]=R);const u={name:X,shader:R}},13521:(E,t,z)=>{"use strict";z.r(t),z.d(t,{FlowGraphGLTFDataProvider:()=>R});var A=z(13480),X=z(13458);class R extends A.c{constructor(E){var t,z;super();const A=E.glTF,R=(null===(t=A.animations)||void 0===t?void 0:t.map((E=>E._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",X.c,R);const u=(null===(z=A.nodes)||void 0===z?void 0:z.map((E=>E._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",X.c,u)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13408:(E,t,z)=>{"use strict";z.d(t,{c:()=>a,d:()=>O,e:()=>y,f:()=>c});var A=z(11812),X=z(12286),R=z(11856),u=z(13411);const p=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class C{constructor(E,t){this._gltf=E,this._infoTree=t}convert(E){let t,z=this._gltf,A=this._infoTree;if(!E.startsWith("/"))throw new Error("Path must start with a /");const X=E.split("/");if(X.shift(),X[X.length-1].includes(".length")){const E=X[X.length-1].split(".");X.pop(),X.push(...E)}let R=!1;for(const C of X){const X="length"===C;if(X&&!A.__array__)throw new Error(`Path ${E} is invalid`);if(A.__ignoreObjectTree__&&(R=!0),A.__array__&&!X)A=A.__array__;else if(A=A[C],!A)throw new Error(`Path ${E} is invalid`);if(!R)if(void 0===z){if(!p.find((t=>t.regex.test(E))))throw new Error(`Path ${E} is invalid`)}else if(!X){var u;z=null===(u=z)||void 0===u?void 0:u[C]}(A.__target__||X)&&(t=z)}return{object:t,info:A}}}function Z(E,t,z,A){const X=H(E,t);return A?X[z][A]:X[z]}function H(E,t,z){var A,R;return null===(A=E._data)||void 0===A||null===(R=A[(null===z||void 0===z?void 0:z.fillMode)??X.d.MATERIAL_TriangleFillMode])||void 0===R?void 0:R.babylonMaterial}function h(E,t){return{offset:{componentsCount:2,type:"Vector2",get:(z,X,R)=>{const u=Z(z,R,E,t);return new A.Vector2(null===u||void 0===u?void 0:u.uOffset,null===u||void 0===u?void 0:u.vOffset)},getTarget:H,set:(z,A,X,R)=>{const u=Z(A,R,E,t);u.uOffset=z.x,u.vOffset=z.y},getPropertyName:[()=>`${E}${t?"."+t:""}.uOffset`,()=>`${E}${t?"."+t:""}.vOffset`]},rotation:{type:"number",get:(z,A,X)=>{var R;return null===(R=Z(z,X,E,t))||void 0===R?void 0:R.wAng},getTarget:H,set:(z,A,X,R)=>Z(A,R,E,t).wAng=z,getPropertyName:[()=>`${E}${t?"."+t:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(z,X,R)=>{const u=Z(z,R,E,t);return new A.Vector2(null===u||void 0===u?void 0:u.uScale,null===u||void 0===u?void 0:u.vScale)},getTarget:H,set:(z,A,X,R)=>{const u=Z(A,R,E,t);u.uScale=z.x,u.vScale=z.y},getPropertyName:[()=>`${E}${t?"."+t:""}.uScale`,()=>`${E}${t?"."+t:""}.vScale`]}}}const d={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:E=>{var t,z;return new A.Vector2((null===(t=E._babylonCamera)||void 0===t?void 0:t.orthoLeft)??0,(null===(z=E._babylonCamera)||void 0===z?void 0:z.orthoRight)??0)},set:(E,t)=>{t._babylonCamera&&(t._babylonCamera.orthoLeft=E.x,t._babylonCamera.orthoRight=E.y)},getTarget:E=>E,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:E=>{var t,z;return new A.Vector2((null===(t=E._babylonCamera)||void 0===t?void 0:t.orthoBottom)??0,(null===(z=E._babylonCamera)||void 0===z?void 0:z.orthoTop)??0)},set:(E,t)=>{t._babylonCamera&&(t._babylonCamera.orthoBottom=E.x,t._babylonCamera.orthoTop=E.y)},getTarget:E=>E,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:E=>{var t;return null===(t=E._babylonCamera)||void 0===t?void 0:t.maxZ},set:(E,t)=>{t._babylonCamera&&(t._babylonCamera.maxZ=E)},getTarget:E=>E,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:E=>{var t;return null===(t=E._babylonCamera)||void 0===t?void 0:t.Cp},set:(E,t)=>{t._babylonCamera&&(t._babylonCamera.Cp=E)},getTarget:E=>E,getPropertyName:[()=>"Cp"]}},perspective:{aspectRatio:{type:"number",get:E=>{var t;return null===(t=E._babylonCamera)||void 0===t?void 0:t.getEngine().getAspectRatio(E._babylonCamera)},getTarget:E=>E,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:E=>{var t;return null===(t=E._babylonCamera)||void 0===t?void 0:t.fov},set:(E,t)=>{t._babylonCamera&&(t._babylonCamera.fov=E)},getTarget:E=>E,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:E=>{var t;return null===(t=E._babylonCamera)||void 0===t?void 0:t.maxZ},set:(E,t)=>{t._babylonCamera&&(t._babylonCamera.maxZ=E)},getTarget:E=>E,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:E=>{var t;return null===(t=E._babylonCamera)||void 0===t?void 0:t.Cp},set:(E,t)=>{t._babylonCamera&&(t._babylonCamera.Cp=E)},getTarget:E=>E,getPropertyName:[()=>"Cp"]}}}},nodes:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Lt",get:E=>{var t;return null===(t=E._babylonTransformNode)||void 0===t?void 0:t.position},set:(E,t)=>{var z;return null===(z=t._babylonTransformNode)||void 0===z?void 0:z.position.R(E)},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:E=>{var t;return null===(t=E._babylonTransformNode)||void 0===t?void 0:t.rotationQuaternion},set:(E,t)=>{var z,A;return null===(z=t._babylonTransformNode)||void 0===z||null===(A=z.rotationQuaternion)||void 0===A?void 0:A.R(E)},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Lt",get:E=>{var t;return null===(t=E._babylonTransformNode)||void 0===t?void 0:t.cp},set:(E,t)=>{var z;return null===(z=t._babylonTransformNode)||void 0===z?void 0:z.cp.R(E)},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"cp"]},weights:{length:{type:"number",get:E=>E._numMorphTargets,getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(E,t)=>{var z,A;return void 0!==t?null===(z=E._primitiveBabylonMeshes)||void 0===z||null===(A=z[0].morphTargetManager)||void 0===A?void 0:A.getTarget(t).influence:void 0},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(E,t)=>[0],getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:E=>{var t,z,X;return A.Matrix.Compose(null===(t=E._babylonTransformNode)||void 0===t?void 0:t.cp,null===(z=E._babylonTransformNode)||void 0===z?void 0:z.rotationQuaternion,null===(X=E._babylonTransformNode)||void 0===X?void 0:X.position)},getTarget:E=>E._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:E=>{var t,z,X,R;const u=A.Matrix.Identity();let p=E.parent;for(;p&&p.parent;)p=p.parent;const C=(null===(t=E._babylonTransformNode)||void 0===t?void 0:t.position._isDirty)||(null===(z=E._babylonTransformNode)||void 0===z||null===(X=z.rotationQuaternion)||void 0===X?void 0:X._isDirty)||(null===(R=E._babylonTransformNode)||void 0===R?void 0:R.cp._isDirty);if(p){var Z;const t=null===(Z=p._babylonTransformNode)||void 0===Z?void 0:Z.Hp(!0).invert();var H,h;if(t)null===(H=E._babylonTransformNode)||void 0===H||null===(h=H.Hp(C))||void 0===h||h.multiplyToRef(t,u)}else E._babylonTransformNode&&u.R(E._babylonTransformNode.Hp(C));return u},getTarget:E=>E._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:E=>{var t,z;return null===(t=E._babylonTransformNode)||void 0===t||null===(z=t.getChildren((E=>E instanceof u.b),!0)[0])||void 0===z?void 0:z.Ip},getTarget:E=>{var t;return null===(t=E._babylonTransformNode)||void 0===t?void 0:t.getChildren((E=>E instanceof u.b),!0)[0]},set:(E,t)=>{if(t._babylonTransformNode){const z=t._babylonTransformNode.getChildren((E=>E instanceof u.b),!0)[0];z&&(z.Ip=E)}}},color:{type:"Dt",get:E=>{var t,z;return null===(t=E._babylonTransformNode)||void 0===t||null===(z=t.getChildren((E=>E instanceof u.b),!0)[0])||void 0===z?void 0:z.ep},getTarget:E=>{var t;return null===(t=E._babylonTransformNode)||void 0===t?void 0:t.getChildren((E=>E instanceof u.b),!0)[0]},set:(E,t)=>{if(t._babylonTransformNode){const z=t._babylonTransformNode.getChildren((E=>E instanceof u.b),!0)[0];z&&(z.ep=E)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Dt",get:(E,t,z)=>H(E,t,z).emissiveColor,set:(E,t,z,A)=>H(t,z,A).emissiveColor.R(E),getTarget:(E,t,z)=>H(E,t,z),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:h("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(E,t,z)=>{var A;return null===(A=Z(E,z,"bumpTexture"))||void 0===A?void 0:A.level},set:(E,t,z,A)=>{const X=Z(t,A,"bumpTexture");X&&(X.level=E)},getTarget:(E,t,z)=>H(E,t,z),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:h("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(E,t,z)=>H(E,t,z).ambientTextureStrength,set:(E,t,z,A)=>{const X=H(t,z,A);X&&(X.ambientTextureStrength=E)},getTarget:(E,t,z)=>H(E,t,z),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:h("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Lp",get:(E,t,z)=>{const A=H(E,t,z);return R.Lp.FromColor3(A.albedoColor,A.alpha)},set:(E,t,z,A)=>{const X=H(t,z,A);X.albedoColor.set(E.r,E.g,E.b),X.alpha=E.a},getTarget:(E,t,z)=>H(E,t,z),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:h("albedoTexture")}},metallicFactor:{type:"number",get:(E,t,z)=>H(E,t,z).metallic,set:(E,t,z,A)=>{const X=H(t,z,A);X&&(X.metallic=E)},getTarget:(E,t,z)=>H(E,t,z),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(E,t,z)=>H(E,t,z).roughness,set:(E,t,z,A)=>{const X=H(t,z,A);X&&(X.roughness=E)},getTarget:(E,t,z)=>H(E,t,z),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:h("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(E,t,z)=>H(E,t,z).anisotropy.Ip,set:(E,t,z,A)=>{H(t,z,A).anisotropy.Ip=E},getTarget:(E,t,z)=>H(E,t,z),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(E,t,z)=>H(E,t,z).anisotropy.angle,set:(E,t,z,A)=>{H(t,z,A).anisotropy.angle=E},getTarget:(E,t,z)=>H(E,t,z),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:h("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(E,t,z)=>H(E,t,z).clearCoat.Ip,set:(E,t,z,A)=>{H(t,z,A).clearCoat.Ip=E},getTarget:(E,t,z)=>H(E,t,z),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(E,t,z)=>H(E,t,z).clearCoat.roughness,set:(E,t,z,A)=>{H(t,z,A).clearCoat.roughness=E},getTarget:(E,t,z)=>H(E,t,z),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:h("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(E,t,z)=>{var A;return null===(A=H(E,t,z).clearCoat.bumpTexture)||void 0===A?void 0:A.level},getTarget:H,set:(E,t,z,A)=>H(t,z,A).clearCoat.bumpTexture.level=E},extensions:{KHR_texture_transform:h("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:h("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(E,t,z)=>H(E,t,z).subSurface.dispersion,getTarget:H,set:(E,t,z,A)=>H(t,z,A).subSurface.dispersion=E}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(E,t,z)=>H(E,t,z).emissiveIntensity,getTarget:H,set:(E,t,z,A)=>H(t,z,A).emissiveIntensity=E}},KHR_materials_ior:{ior:{type:"number",get:(E,t,z)=>H(E,t,z).indexOfRefraction,getTarget:H,set:(E,t,z,A)=>H(t,z,A).indexOfRefraction=E}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(E,t,z)=>H(E,t,z).iridescence.Ip,getTarget:H,set:(E,t,z,A)=>H(t,z,A).iridescence.Ip=E},iridescenceIor:{type:"number",get:(E,t,z)=>H(E,t,z).iridescence.indexOfRefraction,getTarget:H,set:(E,t,z,A)=>H(t,z,A).iridescence.indexOfRefraction=E},iridescenceTexture:{extensions:{KHR_texture_transform:h("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(E,t,z)=>H(E,t,z).iridescence.maximumThickness,getTarget:H,set:(E,t,z,A)=>H(t,z,A).iridescence.maximumThickness=E},iridescenceThicknessMinimum:{type:"number",get:(E,t,z)=>H(E,t,z).iridescence.minimumThickness,getTarget:H,set:(E,t,z,A)=>H(t,z,A).iridescence.minimumThickness=E},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:h("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Dt",get:(E,t,z)=>H(E,t,z).sheen.color,getTarget:H,set:(E,t,z,A)=>H(t,z,A).sheen.color.R(E)},sheenColorTexture:{extensions:{KHR_texture_transform:h("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(E,t,z)=>H(E,t,z).sheen.Ip,getTarget:H,set:(E,t,z,A)=>H(t,z,A).sheen.Ip=E},sheenRoughnessTexture:{extensions:{KHR_texture_transform:h("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(E,t,z)=>H(E,t,z).metallicF0Factor,getTarget:H,set:(E,t,z,A)=>H(t,z,A).metallicF0Factor=E,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Dt",get:(E,t,z)=>H(E,t,z).metallicReflectanceColor,getTarget:H,set:(E,t,z,A)=>H(t,z,A).metallicReflectanceColor.R(E),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:h("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:h("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(E,t,z)=>H(E,t,z).subSurface.refractionIntensity,getTarget:H,set:(E,t,z,A)=>H(t,z,A).subSurface.refractionIntensity=E,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:h("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(E,t,z)=>H(E,t,z).subSurface.translucencyIntensity,getTarget:H,set:(E,t,z,A)=>H(t,z,A).subSurface.translucencyIntensity=E},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:h("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Dt",get:(E,t,z)=>H(E,t,z).subSurface.translucencyColor,getTarget:H,set:(E,t,z,A)=>{var X;return E&&(null===(X=H(t,z,A).subSurface.translucencyColor)||void 0===X?void 0:X.R(E))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:h("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Dt",get:(E,t,z)=>H(E,t,z).subSurface.tintColor,getTarget:H,set:(E,t,z,A)=>H(t,z,A).subSurface.tintColor.R(E)},attenuationDistance:{type:"number",get:(E,t,z)=>H(E,t,z).subSurface.tintColorAtDistance,getTarget:H,set:(E,t,z,A)=>H(t,z,A).subSurface.tintColorAtDistance=E},thicknessFactor:{type:"number",get:(E,t,z)=>H(E,t,z).subSurface.maximumThickness,getTarget:H,set:(E,t,z,A)=>H(t,z,A).subSurface.maximumThickness=E},thicknessTexture:{extensions:{KHR_texture_transform:h("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonLight)),getPropertyName:[E=>"length"]},__array__:{__target__:!0,color:{type:"Dt",get:E=>{var t;return null===(t=E._babylonLight)||void 0===t?void 0:t.ep},set:(E,t)=>{var z;return null===(z=t._babylonLight)||void 0===z?void 0:z.ep.R(E)},getTarget:E=>E._babylonLight,getPropertyName:[E=>"diffuse"]},Ip:{type:"number",get:E=>{var t;return null===(t=E._babylonLight)||void 0===t?void 0:t.Ip},set:(E,t)=>t._babylonLight?t._babylonLight.Ip=E:void 0,getTarget:E=>E._babylonLight,getPropertyName:[E=>"intensity"]},range:{type:"number",get:E=>{var t;return null===(t=E._babylonLight)||void 0===t?void 0:t.range},set:(E,t)=>t._babylonLight?t._babylonLight.range=E:void 0,getTarget:E=>E._babylonLight,getPropertyName:[E=>"range"]},spot:{innerConeAngle:{type:"number",get:E=>{var t;return null===(t=E._babylonLight)||void 0===t?void 0:t.innerAngle},set:(E,t)=>t._babylonLight?t._babylonLight.innerAngle=E:void 0,getTarget:E=>E._babylonLight,getPropertyName:[E=>"innerConeAngle"]},outerConeAngle:{type:"number",get:E=>{var t;return null===(t=E._babylonLight)||void 0===t?void 0:t.angle},set:(E,t)=>t._babylonLight?t._babylonLight.angle=E:void 0,getTarget:E=>E._babylonLight,getPropertyName:[E=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonLight)),getPropertyName:[E=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonTexture)),getPropertyName:[E=>"length"]},__array__:{__target__:!0,Ip:{type:"number",get:E=>{var t;return null===(t=E._babylonTexture)||void 0===t?void 0:t.level},set:(E,t)=>{t._babylonTexture&&(t._babylonTexture.level=E)},getTarget:E=>E._babylonTexture},rotation:{type:"Quaternion",get:E=>{var t;return E._babylonTexture&&A.Quaternion.FromRotationMatrix(null===(t=E._babylonTexture)||void 0===t?void 0:t.getReflectionTextureMatrix())},set:(E,t)=>{var z;t._babylonTexture&&(null!==(z=t._babylonTexture.lE())&&void 0!==z&&z.useRightHandedSystem||(E=A.Quaternion.Inverse(E)),A.Matrix.FromQuaternionToRef(E,t._babylonTexture.getReflectionTextureMatrix()))},getTarget:E=>E._babylonTexture}}}}},animations:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>{var t;return null===(t=E.primitives[0]._instanceData)||void 0===t?void 0:t.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function y(E){return new C(E,d)}function O(E){const t=E.split("/").map((E=>E.replace(/{}/g,"__array__")));let z=d;for(const A of t)A&&(z=z[A]);if(z&&z.type&&z.get)return z}function c(E,t){const z=E.split("/").map((E=>E.replace(/{}/g,"__array__")));let A=d;for(const X of z)X&&(A=A[X]);A&&A.type&&A.get&&(A.interpolation=t)}function a(E,t){const z=E.split("/").map((E=>E.replace(/{}/g,"__array__")));let A=d;for(const X of z)if(X){if(!A[X]){if("?"===X){A.__ignoreObjectTree__=!0;continue}A[X]={},"__array__"===X&&(A[X].__target__=!0)}A=A[X]}Object.assign(A,t)}},13418:(E,t,z)=>{"use strict";z.r(t),z.d(t,{AnimationPropertyInfo:()=>Z,TransformNodeAnimationPropertyInfo:()=>H,WeightAnimationPropertyInfo:()=>h,getQuaternion:()=>p,getVector3:()=>u,getWeights:()=>C});var A=z(12342),X=z(11812),R=z(13408);function u(E,t,z,A){return X.Lt.St(t,z).scaleInPlace(A)}function p(E,t,z,A){return X.Quaternion.St(t,z).scaleInPlace(A)}function C(E,t,z,A){const X=new Array(E._numMorphTargets);for(let R=0;R<X.length;R++)X[R]=t[z++]*A;return X}class Z{constructor(E,t,z,A){this.type=E,this.name=t,this.getValue=z,this.getStride=A}_buildAnimation(E,t,z){const X=new A.c(E,this.name,t,this.type);return X.setKeys(z),X}}class H extends Z{buildAnimations(E,t,z,A){const X=[];return X.push({babylonAnimatable:E._babylonTransformNode,babylonAnimation:this._buildAnimation(t,z,A)}),X}}class h extends Z{buildAnimations(E,t,z,X){const R=[];if(E._numMorphTargets)for(let u=0;u<E._numMorphTargets;u++){const p=new A.c(`${t}_${u}`,this.name,z,this.type);if(p.setKeys(X.map((E=>({frame:E.frame,inTangent:E.inTangent?E.inTangent[u]:void 0,value:E.value[u],outTangent:E.outTangent?E.outTangent[u]:void 0,interpolation:E.interpolation})))),E._primitiveBabylonMeshes)for(const t of E._primitiveBabylonMeshes)if(t.morphTargetManager){const E=t.morphTargetManager.getTarget(u),z=p.clone();E.animations.push(z),R.push({babylonAnimatable:E,babylonAnimation:z})}}return R}}(0,R.f)("/nodes/{}/translation",[new H(A.c.ANIMATIONTYPE_VECTOR3,"position",u,(()=>3))]),(0,R.f)("/nodes/{}/rotation",[new H(A.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",p,(()=>4))]),(0,R.f)("/nodes/{}/scale",[new H(A.c.ANIMATIONTYPE_VECTOR3,"cp",u,(()=>3))]),(0,R.f)("/nodes/{}/weights",[new h(A.c.ANIMATIONTYPE_FLOAT,"influence",C,(E=>E._numMorphTargets))])},13382:(E,t,z)=>{"use strict";class A{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((E,t)=>{this._resolve=E,this._reject=t}))}}var X=z(11812),R=z(11856),u=z(11630),p=z(12256),C=z(13386),Z=z(13397),H=z(11632),h=z(12279),d=z(12342),y=z(12347),O=z(11667),c=z(11640),a=z(11647);class L{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(E){this._useTextureToStoreBoneMatrices=E,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(E){this._animationPropertiesOverride=E}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(E,t,z){this.name=E,this.id=t,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=X.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new H.b,this.bones=[],this._scene=z||O.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const A=this._scene.getEngine().getCaps();this._canUseTextureForBones=A.textureFloat&&A.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((E=>!E.getParent()))}getTransformMatrices(E){if(this.needInitialSkinMatrix){if(!E)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return E._bonesTransformMatrices||this.prepare(!0),E._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(E){return this.needInitialSkinMatrix&&E._transformMatrixTexture?E._transformMatrixTexture:this._transformMatrixTexture}lE(){return this._scene}toString(E){let t=`Name: ${this.name}, nBones: ${this.bones.length}`;if(t+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,E){t+=", Ranges: {";let E=!0;for(const z in this._ranges)E&&(t+=", ",E=!1),t+=z;t+="}"}return t}getBoneIndexByName(E){for(let t=0,z=this.bones.length;t<z;t++)if(this.bones[t].name===E)return t;return-1}createAnimationRange(E,t,z){if(!this._ranges[E]){this._ranges[E]=new y.c(E,t,z);for(let A=0,X=this.bones.length;A<X;A++)this.bones[A].animations[0]&&this.bones[A].animations[0].createRange(E,t,z)}}deleteAnimationRange(E){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let z=0,A=this.bones.length;z<A;z++)this.bones[z].animations[0]&&this.bones[z].animations[0].deleteRange(E,t);this._ranges[E]=null}getAnimationRange(E){return this._ranges[E]||null}getAnimationRanges(){const E=[];let t;for(t in this._ranges)E.push(this._ranges[t]);return E}copyAnimationRange(E,t){let z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[t]||!E.getAnimationRange(t))return!1;let A=!0;const X=this._getHighestAnimationFrame()+1,R={},u=E.bones;let p,C;for(C=0,p=u.length;C<p;C++)R[u[C].name]=u[C];this.bones.length!==u.length&&(c.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${u.length}`),A=!1);const Z=z&&this.dimensionsAtRest&&E.dimensionsAtRest?this.dimensionsAtRest.divide(E.dimensionsAtRest):null;for(C=0,p=this.bones.length;C<p;C++){const E=this.bones[C].name,u=R[E];u?A=A&&this.bones[C].copyAnimationRange(u,t,X,z,Z):(c.d.Warn("copyAnimationRange: not same rig, missing source bone "+E),A=!1)}const H=E.getAnimationRange(t);return H&&(this._ranges[t]=new y.c(t,H.from+X,H.to+X)),A}returnToRest(){for(const E of this.bones)-1!==E._index&&E.returnToRest()}_getHighestAnimationFrame(){let E=0;for(let t=0,z=this.bones.length;t<z;t++)if(this.bones[t].animations[0]){const z=this.bones[t].animations[0].getHighestFrame();E<z&&(E=z)}return E}beginAnimation(E,t,z,A){const X=this.getAnimationRange(E);return X?this._scene.beginAnimation(this,X.from,X.to,t,z,A):null}static MakeAnimationAdditive(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,z=arguments.length>2?arguments[2]:void 0;const A=E.getAnimationRange(z);if(!A)return null;const X=E._scene.getAllAnimatablesByTarget(E);let R=null;for(let p=0;p<X.length;p++){const E=X[p];if(E.fromFrame===(null===A||void 0===A?void 0:A.from)&&E.toFrame===(null===A||void 0===A?void 0:A.to)){R=E;break}}const u=E.getAnimatables();for(let p=0;p<u.length;p++){const E=u[p].animations;if(E)for(let A=0;A<E.length;A++)d.c.MakeAnimationAdditive(E[A],t,z)}return R&&(R.isAdditive=!0),E}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(E){this._meshesWithPoseMatrix.push(E)}_unregisterMeshWithPoseMatrix(E){const t=this._meshesWithPoseMatrix.indexOf(E);t>-1&&this._meshesWithPoseMatrix.splice(t,1)}_computeTransformMatrices(E,t){this.onBeforeComputeObservable.notifyObservers(this);for(let z=0;z<this.bones.length;z++){const A=this.bones[z];A._childUpdateId++;const X=A.getParent();if(X?A.getLocalMatrix().multiplyToRef(X.getFinalMatrix(),A.getFinalMatrix()):t?A.getLocalMatrix().multiplyToRef(t,A.getFinalMatrix()):A.getFinalMatrix().R(A.getLocalMatrix()),-1!==A._index){const t=null===A._index?z:A._index;A.getAbsoluteInverseBindMatrix().multiplyToArray(A.getFinalMatrix(),E,16*t)}}this._identity.copyToArray(E,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const E=this.lE().getRenderId();if(this._currentRenderId===E)return;this._currentRenderId=E}if(this._numBonesWithLinkedTransformNode>0)for(const E of this.bones)if(E._linkedTransformNode){const t=E._linkedTransformNode;E.position=t.position,t.rotationQuaternion?E.rotationQuaternion=t.rotationQuaternion:E.rotation=t.rotation,E.cp=t.cp}if(this.needInitialSkinMatrix)for(const E of this._meshesWithPoseMatrix){const t=E.getPoseMatrix();let z=this._isDirty;if(E._bonesTransformMatrices&&E._bonesTransformMatrices.length===16*(this.bones.length+1)||(E._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),z=!0),z){if(this._synchronizedWithMesh!==E){this._synchronizedWithMesh=E;for(const E of this.bones)if(!E.getParent()){E.getBindMatrix().multiplyToRef(t,X.TmpVectors.Matrix[1]),E._updateAbsoluteBindMatrices(X.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const t=4*(this.bones.length+1);E._transformMatrixTexture&&E._transformMatrixTexture.getSize().width===t||(E._transformMatrixTexture&&E._transformMatrixTexture.dispose(),E._transformMatrixTexture=h.d.CreateRGBATexture(E._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(E._bonesTransformMatrices,t),this.isUsingTextureForMatrices&&E._transformMatrixTexture&&E._transformMatrixTexture.update(E._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=h.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let E=0;E<this.bones.length;E++)this._animatables.push(this.bones[E])}return this._animatables}clone(E,t){const z=new L(E,t||E,this._scene);z.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let A=0;A<this.bones.length;A++){const E=this.bones[A];let t=null;const X=E.getParent();if(X){const E=this.bones.indexOf(X);t=z.bones[E]}const R=new Z.d(E.name,z,t,E.getBindMatrix().clone(),E.getRestMatrix().clone());R._index=E._index,E._linkedTransformNode&&R.linkTransformNode(E._linkedTransformNode),a.d.DeepCopy(E.animations,R.animations)}if(this._ranges){z._ranges={};for(const E in this._ranges){const t=this._ranges[E];t&&(z._ranges[E]=t.clone())}}return this._isDirty=!0,z.prepare(!0),z}enableBlending(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const t of this.bones)for(const z of t.animations)z.enableBlending=!0,z.blendingSpeed=E}dispose(){if(this._meshesWithPoseMatrix.length=0,this.lE().stopAnimation(this),this.lE().removeSkeleton(this),this._parentContainer){const E=this._parentContainer.skeletons.indexOf(this);E>-1&&this._parentContainer.skeletons.splice(E,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const E={};E.name=this.name,E.id=this.id,this.dimensionsAtRest&&(E.dimensionsAtRest=this.dimensionsAtRest.upE()),E.bones=[],E.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let z=0;z<this.bones.length;z++){var t;const A=this.bones[z],X=A.getParent(),R={parentBoneIndex:X?this.bones.indexOf(X):-1,index:A.getIndex(),name:A.name,id:A.id,matrix:A.getBindMatrix().upE(),rest:A.getRestMatrix().upE(),linkedTransformNodeId:null===(t=A.getTransformNode())||void 0===t?void 0:t.id};E.bones.push(R),A.length&&(R.length=A.length),A.metadata&&(R.metadata=A.metadata),A.animations&&A.animations.length>0&&(R.animation=A.animations[0].serialize()),E.ranges=[];for(const t in this._ranges){const z=this._ranges[t];if(!z)continue;const A={};A.name=t,A.from=z.from,A.to=z.to,E.ranges.push(A)}}return E}static Parse(E,t){const z=new L(E.name,E.id,t);let A;for(E.dimensionsAtRest&&(z.dimensionsAtRest=X.Lt.St(E.dimensionsAtRest)),z.needInitialSkinMatrix=E.needInitialSkinMatrix,A=0;A<E.bones.length;A++){const t=E.bones[A],R=E.bones[A].index;let u=null;t.parentBoneIndex>-1&&(u=z.bones[t.parentBoneIndex]);const p=t.rest?X.Matrix.St(t.rest):null,C=new Z.d(t.name,z,u,X.Matrix.St(t.matrix),p,null,R);void 0!==t.id&&null!==t.id&&(C.id=t.id),t.length&&(C.length=t.length),t.metadata&&(C.metadata=t.metadata),t.animation&&C.animations.push(d.c.Parse(t.animation)),void 0!==t.linkedTransformNodeId&&null!==t.linkedTransformNodeId&&(z._hasWaitingData=!0,C._waitingTransformNodeId=t.linkedTransformNodeId)}if(E.ranges)for(A=0;A<E.ranges.length;A++){const t=E.ranges[A];z.createAnimationRange(t.name,t.from,t.to)}return z}computeAbsoluteMatrices(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||E)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(E)}getPoseMatrix(){let E=null;return this._meshesWithPoseMatrix.length>0&&(E=this._meshesWithPoseMatrix[0].getPoseMatrix()),E}sortBones(){const E=[],t=new Array(this.bones.length);for(let z=0;z<this.bones.length;z++)this._sortBones(z,E,t);this.bones=E}_sortBones(E,t,z){if(z[E])return;z[E]=!0;const A=this.bones[E];if(!A)return;void 0===A._index&&(A._index=E);const X=A.getParent();X&&this._sortBones(this.bones.indexOf(X),t,z),t.push(A)}setCurrentPoseAsRest(){for(const E of this.bones)E.setCurrentPoseAsRest()}}var mE=z(12121),W=z(12304),I=z(11790),e=z(12224),D=z(11894),S=z(12265),l=z(12231),f=z(12250),K=z(12355),F=z(11920),B=z(13362);class b{set areUpdatesFrozen(E){E?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new F.i(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,E||(E=O.d.LastCreatedScene),this._scene=E,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const E=this._scene.getEngine().getCaps();this._canUseTextureForTargets=E.canUseGLVertexID&&E.textureFloat&&E.maxVertexTextureImageUnits>0&&E.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return b.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?b.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(E){this._numMaxInfluencers!==E&&(this._numMaxInfluencers=E,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(E){this._useTextureToStoreTargets!==E&&(this._useTextureToStoreTargets=E,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var E;return b.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(E=this._scene)&&void 0!==E&&E.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(E){return this._activeTargets.data[E]}getTarget(E){return this._targets[E]}getTargetByName(E){for(const t of this._targets)if(t.name===E)return t;return null}addTarget(E){this._targets.push(E),this._targetInfluenceChangedObservers.push(E.onInfluenceChanged.add((E=>{this.areUpdatesFrozen&&E&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(E)}))),this._targetDataLayoutChangedObservers.push(E._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(E){const t=this._targets.indexOf(E);t>=0&&(this._targets.splice(t,1),E.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(t,1)[0]),E._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(t,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(E)}_bind(E){E.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),E.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),E.setTexture("morphTargets",this._targetStoreTexture),E.setInt("morphTargetCount",this.numInfluencers)}clone(){const E=new b(this._scene);for(const t of this._targets)E.addTarget(t.clone());return E.enablePositionMorphing=this.enablePositionMorphing,E.enableNormalMorphing=this.enableNormalMorphing,E.enableTangentMorphing=this.enableTangentMorphing,E.enableUVMorphing=this.enableUVMorphing,E.enableUV2Morphing=this.enableUV2Morphing,E.enableColorMorphing=this.enableColorMorphing,E}serialize(){const E={};E.id=this.uniqueId,E.targets=[];for(const t of this._targets)E.targets.push(t.serialize());return E}_syncActiveTargets(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const t=!!this._targetStoreTexture,z=this.isUsingTextureForTargets;(this._mustSynchronize||t!==z)&&(this._mustSynchronize=!1,this.synchronize());let A=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let X=-1;for(const R of this._targets)if(X++,0!==R.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=b.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(R),this._morphTargetTextureIndices[A]=X,this._tempInfluences[A++]=R.influence}this._morphTargetTextureIndices.length!==A&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,A)),this._influences&&this._influences.length===A||(this._influences=new Float32Array(A));for(let R=0;R<A;R++)this._influences[R]=this._tempInfluences[R];if(E&&this._scene)for(const R of this._scene.meshes)R.morphTargetManager===this&&(z?R._markSubMeshesAsAttributesDirty():R._syncGeometryWithMorphTargetManager())}synchronize(){var E;if(!this._scene||this.areUpdatesFrozen)return;const t=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(E=this._targetStoreTexture)||void 0===E||E.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>t.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const z of this._targets){this._supportsPositions=this._supportsPositions&&z.hasPositions,this._supportsNormals=this._supportsNormals&&z.hasNormals,this._supportsTangents=this._supportsTangents&&z.hasTangents,this._supportsUVs=this._supportsUVs&&z.hasUVs,this._supportsUV2s=this._supportsUV2s&&z.hasUV2s,this._supportsColors=this._supportsColors&&z.hasColors;const E=z.vertexCount;if(0===this._vertexCount)this._vertexCount=E;else if(this._vertexCount!==E)return void c.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${z.name}": ${E}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const E=t.getCaps().maxTextureSize;this._textureWidth>E&&(this._textureHeight=Math.ceil(this._textureWidth/E),this._textureWidth=E);const z=this._targets.length,A=new Float32Array(z*this._textureWidth*this._textureHeight*4);let X=0;for(let t=0;t<z;t++){const E=this._targets[t],z=E.getPositions(),R=E.getNormals(),u=E.getUVs(),p=E.getTangents(),C=E.getUV2s(),Z=E.getColors();X=t*this._textureWidth*this._textureHeight*4;for(let t=0;t<this._vertexCount;t++)this._supportsPositions&&z&&(A[X]=z[3*t],A[X+1]=z[3*t+1],A[X+2]=z[3*t+2],X+=4),this._supportsNormals&&R&&(A[X]=R[3*t],A[X+1]=R[3*t+1],A[X+2]=R[3*t+2],X+=4),this._supportsUVs&&u&&(A[X]=u[2*t],A[X+1]=u[2*t+1],X+=4),this._supportsTangents&&p&&(A[X]=p[3*t],A[X+1]=p[3*t+1],A[X+2]=p[3*t+2],X+=4),this._supportsUV2s&&C&&(A[X]=C[2*t],A[X+1]=C[2*t+1],X+=4),this._supportsColors&&Z&&(A[X]=Z[4*t],A[X+1]=Z[4*t+1],A[X+2]=Z[4*t+2],A[X+3]=Z[4*t+3],X+=4)}this._targetStoreTexture=B.d.CreateRGBATexture(A,this._textureWidth,this._textureHeight,z,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const z of this._scene.meshes)z.morphTargetManager===this&&z._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const E=this._parentContainer.morphTargetManagers.indexOf(this);E>-1&&this._parentContainer.morphTargetManagers.splice(E,1),this._parentContainer=null}for(const E of this._targets)this._scene.stopAnimation(E)}}static Parse(E,t){const z=new b(t);for(const A of E.targets)z.addTarget(K.c.Parse(A,t));return z}}b.EnableTextureStorage=!0,b.MaxActiveMorphTargetsInVertexAttributeMode=8,b.ConstantTargetCountForTextureMode=0;var x=z(13399),J=z(11674),V=z(12139);const r=new Map,i=r;function g(E,t,z){o(E)&&c.d.Warn(`Extension with the name '${E}' already exists`),r.set(E,{isGLTFExtension:t,factory:z})}function o(E){return r.delete(E)}var Q=z(13408),T=z(12422),q=z(11907);class M{static Get(E,t,z){if(!t||void 0==z||!t[z])throw new Error(`${E}: Failed to find index (${z})`);return t[z]}static TryGet(E,t){return E&&void 0!=t&&E[t]?E[t]:null}static Assign(E){if(E)for(let t=0;t<E.length;t++)E[t].index=t}}function w(E){if(E.min&&E.max){const t=E.min,z=E.max,A=X.TmpVectors.Lt[0].Op(t[0],t[1],t[2]),R=X.TmpVectors.Lt[1].Op(z[0],z[1],z[2]);if(E.normalized&&5126!==E.componentType){let t=1;switch(E.componentType){case 5120:t=127;break;case 5121:t=255;break;case 5122:t=32767;break;case 5123:t=65535}const z=1/t;A.scaleInPlace(z),R.scaleInPlace(z)}return new V.c(A,R)}return null}class n{static RegisterExtension(E,t){g(E,!1,t)}static UnregisterExtension(E){return o(E)}get zp(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(E){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=E}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((E=>E.dispose&&E.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(E,t,z,A,X,R){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=t,this._assetContainer=z,this._loadData(A);let R=null;if(E){const t={};if(this._gltf.nodes)for(const E of this._gltf.nodes)E.name&&(t[E.name]=E.index);R=(E instanceof Array?E:[E]).map((E=>{const z=t[E];if(void 0===z)throw new Error(`Failed to find node '${E}'`);return z}))}return await this._loadAsync(X,u,R,(()=>({meshes:this._getMeshes(),Kd:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=E,this._loadData(t),await this._loadAsync(z,X,null,(()=>{}))}async _loadAsync(E,t,z,A){return await Promise.resolve().then((async()=>{this._rootUrl=E,this._uniqueRootUrl=!E.startsWith("file:")&&t?E:`${E}${Date.now()}/`,this._fileName=t,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const X=`${x.k[x.k.LOADING]} => ${x.k[x.k.READY]}`,R=`${x.k[x.k.LOADING]} => ${x.k[x.k.COMPLETE]}`;this._parent._startPerformanceCounter(X),this._parent._startPerformanceCounter(R),this._parent._setState(x.k.LOADING),this._extensionsOnLoading();const p=new Array;if(!this.parent.loadOnlyMaterials)if(z)p.push(this.loadSceneAsync("/nodes",{nodes:z,index:-1}));else if(void 0!=this._gltf.It||this._gltf.scenes&&this._gltf.scenes[0]){const E=M.Get("/scene",this._gltf.scenes,this._gltf.It||0);p.push(this.loadSceneAsync(`/scenes/${E.index}`,E))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let E=0;E<this._gltf.materials.length;++E){const t=this._gltf.materials[E],z="/materials/"+E,A=mE.b.TriangleFillMode;p.push(this._loadMaterialAsync(z,t,null,A,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&p.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&p.push(this._compileShadowGeneratorsAsync());const C=Promise.all(p).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Tp(!0);for(const E of this._babylonScene.materials){const t=E;void 0!==t.maxSimultaneousLights&&(t.maxSimultaneousLights=Math.max(t.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(x.k.READY),this._skipStartAnimationStep||this._startAnimations(),A()}));return await C.then((E=>(this._parent._endPerformanceCounter(X),u.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(R),this._parent._setState(x.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(E=>{this._parent.onErrorObservable.notifyObservers(E),this._parent.onErrorObservable.clear(),this.dispose()}))})),E)))})).catch((E=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(E),this._parent.onErrorObservable.clear(),this.dispose()),E}))}_loadData(E){if(this._gltf=E.json,this._setupData(),E.bin){const t=this._gltf.buffers;if(t&&t[0]&&!t[0].uri){const z=t[0];(z.byteLength<E.bin.byteLength-3||z.byteLength>E.bin.byteLength)&&c.d.Warn(`Binary buffer length (${z.byteLength}) from JSON does not match chunk length (${E.bin.byteLength})`),this._bin=E.bin}else c.d.Warn("Unexpected BIN chunk")}}_setupData(){if(M.Assign(this._gltf.accessors),M.Assign(this._gltf.animations),M.Assign(this._gltf.buffers),M.Assign(this._gltf.bufferViews),M.Assign(this._gltf.cameras),M.Assign(this._gltf.images),M.Assign(this._gltf.materials),M.Assign(this._gltf.meshes),M.Assign(this._gltf.nodes),M.Assign(this._gltf.samplers),M.Assign(this._gltf.scenes),M.Assign(this._gltf.skins),M.Assign(this._gltf.textures),this._gltf.nodes){const E={};for(const z of this._gltf.nodes)if(z.children)for(const t of z.children)E[t]=z.index;const t=this._createRootNode();for(const z of this._gltf.nodes){const A=E[z.index];z.parent=void 0===A?t:this._gltf.nodes[A]}}}async _loadExtensionsAsync(){const E=[];if(i.forEach(((t,z)=>{var A;!1===(null===(A=this.parent.extensionOptions[z])||void 0===A?void 0:A.enabled)?t.isGLTFExtension&&this.isExtensionUsed(z)&&c.d.Warn(`Extension ${z} is used but has been explicitly disabled.`):t.isGLTFExtension&&!this.isExtensionUsed(z)||E.push((async()=>{const E=await t.factory(this);return E.name!==z&&c.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${E.name} !== ${z}`),this._parent.onExtensionLoadedObservable.notifyObservers(E),E})())})),this._extensions.push(...await Promise.all(E)),this._extensions.sort(((E,t)=>(E.order||Number.MAX_VALUE)-(t.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const z of this._gltf.extensionsRequired){if(!this._extensions.some((E=>E.name===z&&E.enabled))){var t;if(!1===(null===(t=this.parent.extensionOptions[z])||void 0===t?void 0:t.enabled))throw new Error(`Required extension ${z} is disabled`);throw new Error(`Required extension ${z} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const E=new f.e("__root__",this._babylonScene);this._rootBabylonMesh=E,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Tp(!1);const t={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case x.i.AUTO:this._babylonScene.useRightHandedSystem||(t.rotation=[0,1,0,0],t.scale=[1,1,-1],n._LoadTransform(t,this._rootBabylonMesh));break;case x.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(E),t}loadSceneAsync(E,t){const z=this._extensionsLoadSceneAsync(E,t);if(z)return z;const A=new Array;if(this.logOpen(`${E} ${t.name||""}`),t.nodes)for(const X of t.nodes){const t=M.Get(`${E}/nodes/${X}`,this._gltf.nodes,X);A.push(this.loadNodeAsync(`/nodes/${t.index}`,t,(E=>{E.parent=this._rootBabylonMesh})))}for(const X of this._postSceneLoadActions)X();return A.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(A).then((()=>{}))}_forEachPrimitive(E,t){if(E._primitiveBabylonMeshes)for(const z of E._primitiveBabylonMeshes)t(z)}_getGeometries(){const E=[],t=this._gltf.nodes;if(t)for(const z of t)this._forEachPrimitive(z,(t=>{const z=t.hp;z&&-1===E.indexOf(z)&&E.push(z)}));return E}_getMeshes(){const E=[];this._rootBabylonMesh instanceof l.d&&E.push(this._rootBabylonMesh);const t=this._gltf.nodes;if(t)for(const z of t)this._forEachPrimitive(z,(t=>{E.push(t)}));return E}_getTransformNodes(){const E=[],t=this._gltf.nodes;if(t)for(const z of t)z._babylonTransformNode&&"th"===z._babylonTransformNode.getClassName()&&E.push(z._babylonTransformNode),z._babylonTransformNodeForSkin&&E.push(z._babylonTransformNodeForSkin);return E}_getSkeletons(){const E=[],t=this._gltf.skins;if(t)for(const z of t)z._data&&E.push(z._data.babylonSkeleton);return E}_getAnimationGroups(){const E=[],t=this._gltf.animations;if(t)for(const z of t)z._babylonAnimationGroup&&E.push(z._babylonAnimationGroup);return E}_startAnimations(){switch(this._parent.animationStartMode){case x.e.NONE:break;case x.e.FIRST:{const E=this._getAnimationGroups();0!==E.length&&E[0].start(!0);break}case x.e.ALL:{const E=this._getAnimationGroups();for(const t of E)t.start(!0);break}default:return void c.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadNodeAsync(E,t,z);if(A)return A;if(t._babylonTransformNode)throw new Error(`${E}: Invalid recursive node hierarchy`);const X=new Array;this.logOpen(`${E} ${t.name||""}`);const R=A=>{if(n.AddPointerMetadata(A,E),n._LoadTransform(t,A),void 0!=t.camera){const z=M.Get(`${E}/camera`,this._gltf.cameras,t.camera);X.push(this.loadCameraAsync(`/cameras/${z.index}`,z,(E=>{E.parent=A,this._babylonScene.useRightHandedSystem||(A.cp.x=-1)})))}if(t.children)for(const z of t.children){const t=M.Get(`${E}/children/${z}`,this._gltf.nodes,z);X.push(this.loadNodeAsync(`/nodes/${t.index}`,t,(E=>{E.parent=A})))}z(A)},u=void 0!=t.mesh,p=this._parent.loadSkins&&void 0!=t.skin;if(!u||p){const E=t.name||`node${t.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new e.d(E,this._babylonScene);z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==t.mesh?t._babylonTransformNode=z:t._babylonTransformNodeForSkin=z,R(z)}if(u)if(p){const z=M.Get(`${E}/mesh`,this._gltf.meshes,t.mesh);X.push(this._loadMeshAsync(`/meshes/${z.index}`,t,z,(z=>{const A=t._babylonTransformNodeForSkin;z.metadata=(0,T.e)(A.metadata,z.metadata||{});const R=M.Get(`${E}/skin`,this._gltf.skins,t.skin);X.push(this._loadSkinAsync(`/skins/${R.index}`,t,R,(E=>{this._forEachPrimitive(t,(t=>{t.skeleton=E})),this._postSceneLoadActions.push((()=>{if(void 0!=R.skeleton){const E=M.Get(`/skins/${R.index}/skeleton`,this._gltf.nodes,R.skeleton).parent;t.index===E.index?z.parent=A.parent:z.parent=E._babylonTransformNode}else z.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:A,skinnedNode:z})}))})))})))}else{const z=M.Get(`${E}/mesh`,this._gltf.meshes,t.mesh);X.push(this._loadMeshAsync(`/meshes/${z.index}`,t,z,R))}return this.logClose(),Promise.all(X).then((()=>(this._forEachPrimitive(t,(E=>{const t=E;!t.isAnInstance&&t.hp&&t.hp.useBoundingInfoFromGeometry?E.rE():E.refreshBoundingInfo(!0,!0)})),t._babylonTransformNode)))}_loadMeshAsync(E,t,z,A){const X=z.primitives;if(!X||!X.length)throw new Error(`${E}: Primitives are missing`);void 0==X[0].index&&M.Assign(X);const R=new Array;this.logOpen(`${E} ${z.name||""}`);const u=t.name||`node${t.index}`;if(1===X.length){const A=z.primitives[0];R.push(this._loadMeshPrimitiveAsync(`${E}/primitives/${A.index}`,u,t,z,A,(E=>{t._babylonTransformNode=E,t._primitiveBabylonMeshes=[E]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,t._babylonTransformNode=new e.d(u,this._babylonScene),t._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._primitiveBabylonMeshes=[];for(const A of X)R.push(this._loadMeshPrimitiveAsync(`${E}/primitives/${A.index}`,`${u}_primitive${A.index}`,t,z,A,(E=>{E.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(E)})))}return A(t._babylonTransformNode),this.logClose(),Promise.all(R).then((()=>t._babylonTransformNode))}_loadMeshPrimitiveAsync(E,t,z,A,X,R){const u=this._extensionsLoadMeshPrimitiveAsync(E,t,z,A,X,R);if(u)return u;this.logOpen(`${E}`);const p=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==z.skin&&!A.primitives[0].targets;let C,Z;if(p&&X._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,C=X._instanceData.babylonSourceMesh.createInstance(t),C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z=X._instanceData.promise;else{const R=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new f.e(t,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.sideOrientation=this._babylonScene.useRightHandedSystem?mE.b.CounterClockWiseSideOrientation:mE.b.ClockWiseSideOrientation,this._createMorphTargets(E,z,A,X,u),R.push(this._loadVertexDataAsync(E,X,u).then((async t=>await this._loadMorphTargetsAsync(E,X,u,t).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,t.JE(u),t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const H=n._GetDrawMode(E,X.mode);if(void 0==X.material){let E=this._defaultBabylonMaterialData[H];E||(E=this._createDefaultMaterial("__GLTFLoader._default",H),this._parent.onMaterialLoadedObservable.notifyObservers(E),this._defaultBabylonMaterialData[H]=E),u.material=E}else if(!this.parent.skipMaterials){const t=M.Get(`${E}/material`,this._gltf.materials,X.material);R.push(this._loadMaterialAsync(`/materials/${t.index}`,t,u,H,(E=>{u.material=E})))}Z=Promise.all(R),p&&(X._instanceData={babylonSourceMesh:u,promise:Z}),C=u}return n.AddPointerMetadata(C,E),this._parent.onMeshLoadedObservable.notifyObservers(C),R(C),this.logClose(),Z.then((()=>C))}_loadVertexDataAsync(E,t,z){const A=this._extensionsLoadVertexDataAsync(E,t,z);if(A)return A;const X=t.attributes;if(!X)throw new Error(`${E}: Attributes are missing`);const R=new Array,u=new S.c(z.name,this._babylonScene);if(void 0==t.indices)z.isUnIndexed=!0;else{const z=M.Get(`${E}/indices`,this._gltf.accessors,t.indices);R.push(this._loadIndicesAccessorAsync(`/accessors/${z.index}`,z).then((E=>{u.setIndices(E)})))}const p=(t,A,p)=>{if(void 0==X[t])return;z._delayInfo=z._delayInfo||[],-1===z._delayInfo.indexOf(A)&&z._delayInfo.push(A);const C=M.Get(`${E}/attributes/${t}`,this._gltf.accessors,X[t]);R.push(this._loadVertexAccessorAsync(`/accessors/${C.index}`,C,A).then((E=>{if(E.getKind()===D.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!z.skeleton){const E=w(C);E&&(u._boundingInfo=E,u.useBoundingInfoFromGeometry=!0)}u.setVerticesBuffer(E,C.count)}))),A==D.f.MatricesIndicesExtraKind&&(z.numBoneInfluencers=8),p&&p(C)};return p("POSITION",D.f.PositionKind),p("NORMAL",D.f.NormalKind),p("TANGENT",D.f.TangentKind),p("TEXCOORD_0",D.f.UVKind),p("TEXCOORD_1",D.f.UV2Kind),p("TEXCOORD_2",D.f.UV3Kind),p("TEXCOORD_3",D.f.UV4Kind),p("TEXCOORD_4",D.f.UV5Kind),p("TEXCOORD_5",D.f.UV6Kind),p("JOINTS_0",D.f.MatricesIndicesKind),p("WEIGHTS_0",D.f.MatricesWeightsKind),p("JOINTS_1",D.f.MatricesIndicesExtraKind),p("WEIGHTS_1",D.f.MatricesWeightsExtraKind),p("COLOR_0",D.f.ColorKind,(E=>{"VEC4"===E.type&&(z.hasVertexAlpha=!0)})),Promise.all(R).then((()=>u))}_createMorphTargets(E,t,z,A,X){if(!A.targets||!this._parent.loadMorphTargets)return;if(void 0==t._numMorphTargets)t._numMorphTargets=A.targets.length;else if(A.targets.length!==t._numMorphTargets)throw new Error(`${E}: Primitives do not have the same number of targets`);const R=z.extras?z.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,X.morphTargetManager=new b(this._babylonScene),X.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X.morphTargetManager.areUpdatesFrozen=!0;for(let u=0;u<A.targets.length;u++){const E=t.weights?t.weights[u]:z.weights?z.weights[u]:0,A=R?R[u]:`morphTarget${u}`;X.morphTargetManager.addTarget(new K.c(A,E,X.lE()))}}_loadMorphTargetsAsync(E,t,z,A){if(!t.targets||!this._parent.loadMorphTargets)return Promise.resolve();const X=new Array,R=z.morphTargetManager;for(let u=0;u<R.numTargets;u++){const z=R.getTarget(u);X.push(this._loadMorphTargetVertexDataAsync(`${E}/targets/${u}`,A,t.targets[u],z))}return Promise.all(X).then((()=>{R.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(E,t,z,A){const X=new Array,R=(A,R,u)=>{if(void 0==z[A])return;const p=t.getVertexBuffer(R);if(!p)return;const C=M.Get(`${E}/${A}`,this._gltf.accessors,z[A]);X.push(this._loadFloatAccessorAsync(`/accessors/${C.index}`,C).then((E=>{u(p,E)})))};return R("POSITION",D.f.PositionKind,((E,t)=>{const z=new Float32Array(t.length);E.forEach(t.length,((E,A)=>{z[A]=t[A]+E})),A.setPositions(z)})),R("NORMAL",D.f.NormalKind,((E,t)=>{const z=new Float32Array(t.length);E.forEach(z.length,((E,A)=>{z[A]=t[A]+E})),A.setNormals(z)})),R("TANGENT",D.f.TangentKind,((E,t)=>{const z=new Float32Array(t.length/3*4);let X=0;E.forEach(t.length/3*4,((E,A)=>{(A+1)%4!==0&&(z[X]=t[X]+E,X++)})),A.setTangents(z)})),R("TEXCOORD_0",D.f.UVKind,((E,t)=>{const z=new Float32Array(t.length);E.forEach(t.length,((E,A)=>{z[A]=t[A]+E})),A.setUVs(z)})),R("TEXCOORD_1",D.f.UV2Kind,((E,t)=>{const z=new Float32Array(t.length);E.forEach(t.length,((E,A)=>{z[A]=t[A]+E})),A.setUV2s(z)})),R("COLOR_0",D.f.ColorKind,((t,z)=>{let X=null;const R=t.getSize();if(3===R){X=new Float32Array(z.length/3*4),t.forEach(z.length,((E,t)=>{const A=Math.floor(t/3),R=t%3;X[4*A+R]=z[3*A+R]+E}));for(let E=0;E<z.length/3;++E)X[4*E+3]=1}else{if(4!==R)throw new Error(`${E}: Invalid number of components (${R}) for COLOR_0 attribute`);X=new Float32Array(z.length),t.forEach(z.length,((E,t)=>{X[t]=z[t]+E}))}A.setColors(X)})),await Promise.all(X).then((()=>{}))}static _LoadTransform(E,t){if(void 0!=E.skin)return;let z=X.Lt.Zero(),A=X.Quaternion.Identity(),R=X.Lt.One();if(E.matrix){X.Matrix.St(E.matrix).decompose(R,A,z)}else E.translation&&(z=X.Lt.St(E.translation)),E.rotation&&(A=X.Quaternion.St(E.rotation)),E.scale&&(R=X.Lt.St(E.scale));t.position=z,t.rotationQuaternion=A,t.cp=R}_loadSkinAsync(E,t,z,A){if(!this._parent.loadSkins)return Promise.resolve();const X=this._extensionsLoadSkinAsync(E,t,z);if(X)return X;if(z._data)return A(z._data.babylonSkeleton),z._data.promise;const R=`skeleton${z.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new L(z.name||R,R,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(E,z,u);const p=this._loadSkinInverseBindMatricesDataAsync(E,z).then((E=>{this._updateBoneMatrices(u,E)}));return z._data={babylonSkeleton:u,promise:p},A(u),p}_loadBones(E,t,z){if(void 0==t.skeleton||this._parent.alwaysComputeSkeletonRootNode){const z=this._findSkeletonRootNode(`${E}/joints`,t.joints);if(z)if(void 0===t.skeleton)t.skeleton=z.index;else{const A=(E,t)=>{for(;t.parent;t=t.parent)if(t.parent===E)return!0;return!1},X=M.Get(`${E}/skeleton`,this._gltf.nodes,t.skeleton);X===z||A(X,z)||(c.d.Warn(`${E}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),t.skeleton=z.index)}else c.d.Warn(`${E}: Failed to find common root`)}const A={};for(const X of t.joints){const R=M.Get(`${E}/joints/${X}`,this._gltf.nodes,X);this._loadBone(R,t,z,A)}}_findSkeletonRootNode(E,t){if(0===t.length)return null;const z={};for(const X of t){const t=[];let A=M.Get(`${E}/${X}`,this._gltf.nodes,X);for(;-1!==A.index;)t.unshift(A),A=A.parent;z[X]=t}let A=null;for(let X=0;;++X){let E=z[t[0]];if(X>=E.length)return A;const R=E[X];for(let u=1;u<t.length;++u)if(E=z[t[u]],X>=E.length||R!==E[X])return A;A=R}}_loadBone(E,t,z,A){E._isJoint=!0;let X=A[E.index];if(X)return X;let R=null;E.index!==t.skeleton&&(E.parent&&-1!==E.parent.index?R=this._loadBone(E.parent,t,z,A):void 0!==t.skeleton&&c.d.Warn(`/skins/${t.index}/skeleton: Skeleton node is not a common root`));const u=t.joints.indexOf(E.index);return X=new Z.d(E.name||`joint${E.index}`,z,R,this._getNodeMatrix(E),null,null,u),A[E.index]=X,this._postSceneLoadActions.push((()=>{X.linkTransformNode(E._babylonTransformNode)})),X}_loadSkinInverseBindMatricesDataAsync(E,t){if(void 0==t.inverseBindMatrices)return Promise.resolve(null);const z=M.Get(`${E}/inverseBindMatrices`,this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${z.index}`,z)}_updateBoneMatrices(E,t){for(const z of E.bones){const E=X.Matrix.Identity(),A=z._index;t&&-1!==A&&(X.Matrix.FromArrayToRef(t,16*A,E),E.invertToRef(E));const R=z.getParent();R&&E.multiplyToRef(R.getAbsoluteInverseBindMatrix(),E),z.Zp(E,!1,!1),z._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(E){return E.matrix?X.Matrix.St(E.matrix):X.Matrix.Compose(E.scale?X.Lt.St(E.scale):X.Lt.One(),E.rotation?X.Quaternion.St(E.rotation):X.Quaternion.Identity(),E.translation?X.Lt.St(E.translation):X.Lt.Zero())}loadCameraAsync(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadCameraAsync(E,t,z);if(A)return A;const R=new Array;this.logOpen(`${E} ${t.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new C.c(t.name||`camera${t.index}`,X.Lt.Zero(),this._babylonScene,!1);switch(u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonCamera=u,u.setTarget(new X.Lt(0,0,-1)),t.type){case"perspective":{const z=t.perspective;if(!z)throw new Error(`${E}: Camera perspective properties are missing`);u.fov=z.yfov,u.Cp=z.znear,u.maxZ=z.zfar||0;break}case"orthographic":if(!t.orthographic)throw new Error(`${E}: Camera orthographic properties are missing`);u.mode=p.d.ORTHOGRAPHIC_CAMERA,u.orthoLeft=-t.orthographic.xmag,u.orthoRight=t.orthographic.xmag,u.orthoBottom=-t.orthographic.ymag,u.orthoTop=t.orthographic.ymag,u.Cp=t.orthographic.znear,u.maxZ=t.orthographic.zfar;break;default:throw new Error(`${E}: Invalid camera type (${t.type})`)}return n.AddPointerMetadata(u,E),this._parent.onCameraLoadedObservable.notifyObservers(u),z(u),this.logClose(),Promise.all(R).then((()=>u))}_loadAnimationsAsync(){const E=this._gltf.animations;if(!E)return Promise.resolve();const t=new Array;for(let z=0;z<E.length;z++){const A=E[z];t.push(this.loadAnimationAsync(`/animations/${A.index}`,A).then((E=>{0===E.targetedAnimations.length&&E.dispose()})))}return Promise.all(t).then((()=>{}))}loadAnimationAsync(E,t){const A=this._extensionsLoadAnimationAsync(E,t);return A||z.e(78).then(z.bind(z,14907)).then((z=>{let{AnimationGroup:A}=z;this._babylonScene._blockEntityCollection=!!this._assetContainer;const X=new A(t.name||`animation${t.index}`,this._babylonScene);X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonAnimationGroup=X;const R=new Array;M.Assign(t.channels),M.Assign(t.samplers);for(const u of t.channels)R.push(this._loadAnimationChannelAsync(`${E}/channels/${u.index}`,E,t,u,((E,t)=>{E.animations=E.animations||[],E.animations.push(t),X.addTargetedAnimation(t,E)})));return Promise.all(R).then((()=>(X.normalize(0),X)))}))}async _loadAnimationChannelAsync(E,t,A,X,R){const u=this._extensionsLoadAnimationChannelAsync(E,t,A,X,R);if(u)return await u;if(void 0==X.target.node)return await Promise.resolve();const p=M.Get(`${E}/target/node`,this._gltf.nodes,X.target.node),C=X.target.path,Z="weights"===C;if(Z&&!p._numMorphTargets||!Z&&!p._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!Z&&!p._isJoint)return await Promise.resolve();let H;switch(await Promise.resolve().then(z.bind(z,13418)),C){case"translation":var h;H=null===(h=(0,Q.d)("/nodes/{}/translation"))||void 0===h?void 0:h.interpolation;break;case"rotation":var d;H=null===(d=(0,Q.d)("/nodes/{}/rotation"))||void 0===d?void 0:d.interpolation;break;case"scale":var y;H=null===(y=(0,Q.d)("/nodes/{}/scale"))||void 0===y?void 0:y.interpolation;break;case"weights":var O;H=null===(O=(0,Q.d)("/nodes/{}/weights"))||void 0===O?void 0:O.interpolation;break;default:throw new Error(`${E}/target/path: Invalid value (${X.target.path})`)}if(!H)throw new Error(`${E}/target/path: Could not find interpolation properties for target path (${X.target.path})`);const c={object:p,info:H};return await this._loadAnimationChannelFromTargetInfoAsync(E,t,A,X,c,R)}_loadAnimationChannelFromTargetInfoAsync(E,t,z,A,X,R){const u=this.parent.targetFps,p=1/u,C=M.Get(`${E}/sampler`,z.samplers,A.sampler);return this._loadAnimationSamplerAsync(`${t}/samplers/${A.sampler}`,C).then((E=>{let t=0;const C=X.object,Z=X.info;for(const X of Z){const Z=X.getStride(C),H=E.input,h=E.output,d=new Array(H.length);let y=0;switch(E.interpolation){case"STEP":for(let E=0;E<H.length;E++){const t=X.getValue(C,h,y,1);y+=Z,d[E]={frame:H[E]*u,value:t,interpolation:1}}break;case"CUBICSPLINE":for(let E=0;E<H.length;E++){const t=X.getValue(C,h,y,p);y+=Z;const z=X.getValue(C,h,y,1);y+=Z;const A=X.getValue(C,h,y,p);y+=Z,d[E]={frame:H[E]*u,inTangent:t,value:z,outTangent:A}}break;case"LINEAR":for(let E=0;E<H.length;E++){const t=X.getValue(C,h,y,1);y+=Z,d[E]={frame:H[E]*u,value:t}}}if(y>0){const E=`${z.name||`animation${z.index}`}_channel${A.index}_${t}`,p=X.buildAnimations(C,E,u,d);for(const z of p)t++,R(z.babylonAnimatable,z.babylonAnimation)}}}))}_loadAnimationSamplerAsync(E,t){if(t._data)return t._data;const z=t.interpolation||"LINEAR";switch(z){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${E}/interpolation: Invalid value (${t.interpolation})`)}const A=M.Get(`${E}/input`,this._gltf.accessors,t.input),X=M.Get(`${E}/output`,this._gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${A.index}`,A),this._loadFloatAccessorAsync(`/accessors/${X.index}`,X)]).then((E=>{let[t,A]=E;return{input:t,interpolation:z,output:A}})),t._data}loadBufferAsync(E,t,z,A){const X=this._extensionsLoadBufferAsync(E,t,z,A);if(X)return X;if(!t._data)if(t.uri)t._data=this.loadUriAsync(`${E}/uri`,t,t.uri);else{if(!this._bin)throw new Error(`${E}: Uri is missing or the binary glTF is missing its binary chunk`);t._data=this._bin.readAsync(0,t.byteLength)}return t._data.then((t=>{try{return new Uint8Array(t.buffer,t.byteOffset+z,A)}catch(X){throw new Error(`${E}: ${X.message}`)}}))}loadBufferViewAsync(E,t){const z=this._extensionsLoadBufferViewAsync(E,t);if(z)return z;if(t._data)return t._data;const A=M.Get(`${E}/buffer`,this._gltf.buffers,t.buffer);return t._data=this.loadBufferAsync(`/buffers/${A.index}`,A,t.byteOffset||0,t.byteLength),t._data}_loadAccessorAsync(E,t,z){if(t._data)return t._data;const A=n._GetNumComponents(E,t.type),X=A*D.f.GetTypeByteLength(t.componentType),R=A*t.count;if(void 0==t.bufferView)t._data=Promise.resolve(new z(R));else{const u=M.Get(`${E}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${u.index}`,u).then((p=>{if(5126!==t.componentType||t.normalized||u.byteStride&&u.byteStride!==X){const E=new z(R);return D.f.ForEach(p,t.byteOffset||0,u.byteStride||X,A,t.componentType,E.length,t.normalized||!1,((t,z)=>{E[z]=t})),E}return n._GetTypedArray(E,t.componentType,p,t.byteOffset,R)}))}if(t.sparse){const R=t.sparse;t._data=t._data.then((u=>{const p=u,C=M.Get(`${E}/sparse/indices/bufferView`,this._gltf.bufferViews,R.indices.bufferView),Z=M.Get(`${E}/sparse/values/bufferView`,this._gltf.bufferViews,R.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${C.index}`,C),this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z)]).then((u=>{let[C,Z]=u;const H=n._GetTypedArray(`${E}/sparse/indices`,R.indices.componentType,C,R.indices.byteOffset,R.count),h=A*R.count;let d;if(5126!==t.componentType||t.normalized){const u=n._GetTypedArray(`${E}/sparse/values`,t.componentType,Z,R.values.byteOffset,h);d=new z(h),D.f.ForEach(u,0,X,A,t.componentType,d.length,t.normalized||!1,((E,t)=>{d[t]=E}))}else d=n._GetTypedArray(`${E}/sparse/values`,t.componentType,Z,R.values.byteOffset,h);let y=0;for(let E=0;E<H.length;E++){let t=H[E]*A;for(let E=0;E<A;E++)p[t++]=d[y++]}return p}))}))}return t._data}_loadFloatAccessorAsync(E,t){return this._loadAccessorAsync(E,t,Float32Array)}_loadIndicesAccessorAsync(E,t){if("SCALAR"!==t.type)throw new Error(`${E}/type: Invalid value ${t.type}`);if(5121!==t.componentType&&5123!==t.componentType&&5125!==t.componentType)throw new Error(`${E}/componentType: Invalid value ${t.componentType}`);if(t._data)return t._data;if(t.sparse){const z=n._GetTypedArrayConstructor(`${E}/componentType`,t.componentType);t._data=this._loadAccessorAsync(E,t,z)}else{const z=M.Get(`${E}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${z.index}`,z).then((z=>n._GetTypedArray(E,t.componentType,z,t.byteOffset,t.count)))}return t._data}_loadVertexBufferViewAsync(E){if(E._babylonBuffer)return E._babylonBuffer;const t=this._babylonScene.getEngine();return E._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${E.index}`,E).then((E=>new D.b(t,E,!1))),E._babylonBuffer}_loadVertexAccessorAsync(E,t,z){var A;if(null!==(A=t._babylonVertexBuffer)&&void 0!==A&&A[z])return t._babylonVertexBuffer[z];t._babylonVertexBuffer||(t._babylonVertexBuffer={});const X=this._babylonScene.getEngine();if(t.sparse||void 0==t.bufferView)t._babylonVertexBuffer[z]=this._loadFloatAccessorAsync(E,t).then((E=>new D.f(X,E,z,!1)));else{const A=M.Get(`${E}/bufferView`,this._gltf.bufferViews,t.bufferView);t._babylonVertexBuffer[z]=this._loadVertexBufferViewAsync(A).then((R=>{const u=n._GetNumComponents(E,t.type);return new D.f(X,R,z,!1,void 0,A.byteStride,void 0,t.byteOffset,u,t.componentType,t.normalized,!0,void 0,!0)}))}return t._babylonVertexBuffer[z]}_loadMaterialMetallicRoughnessPropertiesAsync(E,t,z){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);const A=new Array;return t&&(t.baseColorFactor?(z.albedoColor=R.Dt.St(t.baseColorFactor),z.alpha=t.baseColorFactor[3]):z.albedoColor=R.Dt.White(),z.metallic=void 0==t.metallicFactor?1:t.metallicFactor,z.roughness=void 0==t.roughnessFactor?1:t.roughnessFactor,t.baseColorTexture&&A.push(this.loadTextureInfoAsync(`${E}/baseColorTexture`,t.baseColorTexture,(E=>{E.name=`${z.name} (Base Color)`,z.albedoTexture=E}))),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${E}/metallicRoughnessTexture`,t.metallicRoughnessTexture,(E=>{E.name=`${z.name} (Metallic Roughness)`,z.metallicTexture=E}))),z.useMetallnessFromMetallicTextureBlue=!0,z.useRoughnessFromMetallicTextureGreen=!0,z.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(A).then((()=>{}))}_loadMaterialAsync(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const R=this._extensionsLoadMaterialAsync(E,t,z,A,X);if(R)return R;t._data=t._data||{};let u=t._data[A];if(!u){this.logOpen(`${E} ${t.name||""}`);const z=this.createMaterial(E,t,A);u={babylonMaterial:z,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(E,t,z)},t._data[A]=u,n.AddPointerMetadata(z,E),this._parent.onMaterialLoadedObservable.notifyObservers(z),this.logClose()}return z&&(u.babylonMeshes.push(z),z.IX.addOnce((()=>{const E=u.babylonMeshes.indexOf(z);-1!==E&&u.babylonMeshes.splice(E,1)}))),X(u.babylonMaterial),u.promise.then((()=>u.babylonMaterial))}_createDefaultMaterial(E,t){this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new W.b(E,this._babylonScene);return z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z.fillMode=t,z.enableSpecularAntiAliasing=!0,z.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,z.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,z.transparencyMode=W.b.PBRMATERIAL_OPAQUE,z.metallic=1,z.roughness=1,z}createMaterial(E,t,z){const A=this._extensionsCreateMaterial(E,t,z);if(A)return A;const X=t.name||`material${t.index}`;return this._createDefaultMaterial(X,z)}loadMaterialPropertiesAsync(E,t,z){const A=this._extensionsLoadMaterialPropertiesAsync(E,t,z);if(A)return A;const X=new Array;return X.push(this.loadMaterialBasePropertiesAsync(E,t,z)),t.pbrMetallicRoughness&&X.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${E}/pbrMetallicRoughness`,t.pbrMetallicRoughness,z)),this.loadMaterialAlphaProperties(E,t,z),Promise.all(X).then((()=>{}))}loadMaterialBasePropertiesAsync(E,t,z){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);const A=new Array;return z.emissiveColor=t.emissiveFactor?R.Dt.St(t.emissiveFactor):new R.Dt(0,0,0),t.doubleSided&&(z.yp=!1,z.twoSidedLighting=!0),t.normalTexture&&(t.normalTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${E}/normalTexture`,t.normalTexture,(E=>{E.name=`${z.name} (Normal)`,z.bumpTexture=E}))),z.invertNormalMapX=!this._babylonScene.useRightHandedSystem,z.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=t.normalTexture.scale&&z.bumpTexture&&(z.bumpTexture.level=t.normalTexture.scale),z.forceIrradianceInFragment=!0),t.occlusionTexture&&(t.occlusionTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${E}/occlusionTexture`,t.occlusionTexture,(E=>{E.name=`${z.name} (Occlusion)`,z.ambientTexture=E}))),z.useAmbientInGrayScale=!0,void 0!=t.occlusionTexture.strength&&(z.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&A.push(this.loadTextureInfoAsync(`${E}/emissiveTexture`,t.emissiveTexture,(E=>{E.name=`${z.name} (Emissive)`,z.emissiveTexture=E}))),Promise.all(A).then((()=>{}))}loadMaterialAlphaProperties(E,t,z){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);switch(t.alphaMode||"OPAQUE"){case"OPAQUE":z.transparencyMode=W.b.PBRMATERIAL_OPAQUE,z.alpha=1;break;case"MASK":z.transparencyMode=W.b.PBRMATERIAL_ALPHATEST,z.alphaCutOff=void 0==t.alphaCutoff?.5:t.alphaCutoff,z.albedoTexture&&(z.albedoTexture.pp=!0);break;case"BLEND":z.transparencyMode=W.b.PBRMATERIAL_ALPHABLEND,z.albedoTexture&&(z.albedoTexture.pp=!0,z.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${E}/alphaMode: Invalid value (${t.alphaMode})`)}}loadTextureInfoAsync(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadTextureInfoAsync(E,t,z);if(A)return A;if(this.logOpen(`${E}`),t.texCoord>=6)throw new Error(`${E}/texCoord: Invalid value (${t.texCoord})`);const X=M.Get(`${E}/index`,this._gltf.textures,t.index);X._textureInfo=t;const R=this._loadTextureAsync(`/textures/${t.index}`,X,(A=>{A.coordinatesIndex=t.texCoord||0,n.AddPointerMetadata(A,E),this._parent.onTextureLoadedObservable.notifyObservers(A),z(A)}));return this.logClose(),R}_loadTextureAsync(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadTextureAsync(E,t,z);if(A)return A;this.logOpen(`${E} ${t.name||""}`);const X=void 0==t.sampler?n.DefaultSampler:M.Get(`${E}/sampler`,this._gltf.samplers,t.sampler),R=M.Get(`${E}/source`,this._gltf.images,t.source),u=this._createTextureAsync(E,X,R,z,void 0,!t._textureInfo.nonColorData);return this.logClose(),u}_createTextureAsync(E,t,z){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},R=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0;const p=this._loadSampler(`/samplers/${t.index}`,t),C=new Array,Z=new A;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H={noMipmap:p.noMipMaps,invertY:!1,samplingMode:p.samplingMode,G:()=>{this._disposed||Z.resolve()},onError:(t,z)=>{this._disposed||Z.reject(new Error(`${E}: ${z&&z.message?z.message:t||"Failed to load texture"}`))},mimeType:z.mimeType??(0,J.j)(z.uri??""),loaderOptions:R,useSRGBBuffer:!!u&&this._parent.useSRGBBuffers},h=new I.d(null,this._babylonScene,H);return h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.push(Z.promise),C.push(this.loadImageAsync(`/images/${z.index}`,z).then((E=>{const t=z.uri||`${this._fileName}#image${z.index}`,A=`data:${this._uniqueRootUrl}${t}`;h.updateURL(A,E);const X=h.getInternalTexture();X&&(X.label=z.name)}))),h.wrapU=p.wrapU,h.wrapV=p.wrapV,X(h),this._parent.useGltfTextureNames&&(h.name=z.name||z.uri||`image${z.index}`),Promise.all(C).then((()=>h))}_loadSampler(E,t){return t._data||(t._data={noMipMaps:9728===t.minFilter||9729===t.minFilter,samplingMode:n._GetTextureSamplingMode(E,t),wrapU:n._GetTextureWrapMode(`${E}/wrapS`,t.wrapS),wrapV:n._GetTextureWrapMode(`${E}/wrapT`,t.wrapT)}),t._data}loadImageAsync(E,t){if(!t._data){if(this.logOpen(`${E} ${t.name||""}`),t.uri)t._data=this.loadUriAsync(`${E}/uri`,t,t.uri);else{const z=M.Get(`${E}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${z.index}`,z)}this.logClose()}return t._data}loadUriAsync(E,t,z){const A=this._extensionsLoadUriAsync(E,t,z);if(A)return A;if(!n._ValidateUri(z))throw new Error(`${E}: '${z}' is invalid`);if((0,J.l)(z)){const t=new Uint8Array((0,J.d)(z));return this.log(`${E}: Decoded ${z.substring(0,64)}... (${t.length} bytes)`),Promise.resolve(t)}return this.log(`${E}: Loading ${z}`),this._parent.preprocessUrlAsync(this._rootUrl+z).then((t=>new Promise(((A,X)=>{this._parent._loadFile(this._babylonScene,t,(t=>{this._disposed||(this.log(`${E}: Loaded ${z} (${t.byteLength} bytes)`),A(new Uint8Array(t)))}),!0,(t=>{X(new J.m(`${E}: Failed to load '${z}'${t?": "+t.status+" "+t.statusText:""}`,t))}))}))))}static AddPointerMetadata(E,t){E.metadata=E.metadata||{};const z=E._internalMetadata=E._internalMetadata||{},A=z.zp=z.zp||{};(A.pointers=A.pointers||[]).push(t)}static _GetTextureWrapMode(E,t){switch(t=void 0==t?10497:t){case 33071:return I.d.CLAMP_ADDRESSMODE;case 33648:return I.d.MIRROR_ADDRESSMODE;case 10497:return I.d.WRAP_ADDRESSMODE;default:return c.d.Warn(`${E}: Invalid value (${t})`),I.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(E,t){const z=void 0==t.magFilter?9729:t.magFilter,A=void 0==t.minFilter?9987:t.minFilter;if(9729===z)switch(A){case 9728:return I.d.LINEAR_NEAREST;case 9729:return I.d.LINEAR_LINEAR;case 9984:return I.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return I.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return I.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return I.d.LINEAR_LINEAR_MIPLINEAR;default:return c.d.Warn(`${E}/minFilter: Invalid value (${A})`),I.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==z&&c.d.Warn(`${E}/magFilter: Invalid value (${z})`),A){case 9728:return I.d.NEAREST_NEAREST;case 9729:return I.d.NEAREST_LINEAR;case 9984:return I.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return I.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return I.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return I.d.NEAREST_LINEAR_MIPLINEAR;default:return c.d.Warn(`${E}/minFilter: Invalid value (${A})`),I.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(E,t){try{return(0,q.p)(t)}catch(z){throw new Error(`${E}: ${z.message}`)}}static _GetTypedArray(E,t,z,A,X){const R=z.buffer;A=z.byteOffset+(A||0);const u=n._GetTypedArrayConstructor(`${E}/componentType`,t),p=D.f.GetTypeByteLength(t);return A%p!==0?(c.d.Warn(`${E}: Copying buffer as byte offset (${A}) is not a multiple of component type byte length (${p})`),new u(R.slice(A,A+X*p),0)):new u(R,A,X)}static _GetNumComponents(E,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${E}: Invalid type (${t})`)}static _ValidateUri(E){return u.Tools.IsBase64(E)||-1===E.indexOf("..")}static _GetDrawMode(E,t){switch(void 0==t&&(t=4),t){case 0:return mE.b.PointListDrawMode;case 1:return mE.b.LineListDrawMode;case 2:return mE.b.LineLoopDrawMode;case 3:return mE.b.LineStripDrawMode;case 4:return mE.b.TriangleFillMode;case 5:return mE.b.TriangleStripDrawMode;case 6:return mE.b.TriangleFanDrawMode}throw new Error(`${E}: Invalid mesh primitive mode (${t})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const E=new Array;if(this._gltf.materials)for(const t of this._gltf.materials)if(t._data)for(const z in t._data){const A=t._data[z];for(const t of A.babylonMeshes){t.Hp(!0);const z=A.babylonMaterial;E.push(z.forceCompilationAsync(t)),E.push(z.forceCompilationAsync(t,{useInstances:!0})),this._parent.useClipPlane&&(E.push(z.forceCompilationAsync(t,{clipPlane:!0})),E.push(z.forceCompilationAsync(t,{clipPlane:!0,useInstances:!0})))}}return Promise.all(E).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const E=new Array,t=this._babylonScene.lights;for(const z of t){const t=z.getShadowGenerator();t&&E.push(t.forceCompilationAsync())}return Promise.all(E).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(E){for(const t of this._extensions)t.enabled&&E(t)}_applyExtensions(E,t,z){for(const A of this._extensions)if(A.enabled){const X=`${A.name}.${t}`,R=E;R._activeLoaderExtensionFunctions=R._activeLoaderExtensionFunctions||{};const u=R._activeLoaderExtensionFunctions;if(!u[X]){u[X]=!0;try{const E=z(A);if(E)return E}finally{delete u[X]}}}return null}_extensionsOnLoading(){this._forEachExtensions((E=>E.onLoading&&E.onLoading()))}_extensionsOnReady(){this._forEachExtensions((E=>E.onReady&&E.onReady()))}_extensionsLoadSceneAsync(E,t){return this._applyExtensions(t,"loadScene",(z=>z.loadSceneAsync&&z.loadSceneAsync(E,t)))}_extensionsLoadNodeAsync(E,t,z){return this._applyExtensions(t,"loadNode",(A=>A.loadNodeAsync&&A.loadNodeAsync(E,t,z)))}_extensionsLoadCameraAsync(E,t,z){return this._applyExtensions(t,"loadCamera",(A=>A.loadCameraAsync&&A.loadCameraAsync(E,t,z)))}_extensionsLoadVertexDataAsync(E,t,z){return this._applyExtensions(t,"loadVertexData",(A=>A._loadVertexDataAsync&&A._loadVertexDataAsync(E,t,z)))}_extensionsLoadMeshPrimitiveAsync(E,t,z,A,X,R){return this._applyExtensions(X,"loadMeshPrimitive",(u=>u._loadMeshPrimitiveAsync&&u._loadMeshPrimitiveAsync(E,t,z,A,X,R)))}_extensionsLoadMaterialAsync(E,t,z,A,X){return this._applyExtensions(t,"loadMaterial",(R=>R._loadMaterialAsync&&R._loadMaterialAsync(E,t,z,A,X)))}_extensionsCreateMaterial(E,t,z){return this._applyExtensions(t,"createMaterial",(A=>A.createMaterial&&A.createMaterial(E,t,z)))}_extensionsLoadMaterialPropertiesAsync(E,t,z){return this._applyExtensions(t,"loadMaterialProperties",(A=>A.loadMaterialPropertiesAsync&&A.loadMaterialPropertiesAsync(E,t,z)))}_extensionsLoadTextureInfoAsync(E,t,z){return this._applyExtensions(t,"loadTextureInfo",(A=>A.loadTextureInfoAsync&&A.loadTextureInfoAsync(E,t,z)))}_extensionsLoadTextureAsync(E,t,z){return this._applyExtensions(t,"loadTexture",(A=>A._loadTextureAsync&&A._loadTextureAsync(E,t,z)))}_extensionsLoadAnimationAsync(E,t){return this._applyExtensions(t,"loadAnimation",(z=>z.loadAnimationAsync&&z.loadAnimationAsync(E,t)))}_extensionsLoadAnimationChannelAsync(E,t,z,A,X){return this._applyExtensions(z,"loadAnimationChannel",(R=>R._loadAnimationChannelAsync&&R._loadAnimationChannelAsync(E,t,z,A,X)))}_extensionsLoadSkinAsync(E,t,z){return this._applyExtensions(z,"loadSkin",(A=>A._loadSkinAsync&&A._loadSkinAsync(E,t,z)))}_extensionsLoadUriAsync(E,t,z){return this._applyExtensions(t,"loadUri",(A=>A._loadUriAsync&&A._loadUriAsync(E,t,z)))}_extensionsLoadBufferViewAsync(E,t){return this._applyExtensions(t,"loadBufferView",(z=>z.loadBufferViewAsync&&z.loadBufferViewAsync(E,t)))}_extensionsLoadBufferAsync(E,t,z,A){return this._applyExtensions(t,"loadBuffer",(X=>X.loadBufferAsync&&X.loadBufferAsync(E,t,z,A)))}static LoadExtensionAsync(E,t,z,A){if(!t.extensions)return null;const X=t.extensions[z];return X?A(`${E}/extensions/${z}`,X):null}static LoadExtraAsync(E,t,z,A){if(!t.extras)return null;const X=t.extras[z];return X?A(`${E}/extras/${z}`,X):null}isExtensionUsed(E){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(E)}logOpen(E){this._parent._logOpen(E)}logClose(){this._parent._logClose()}log(E){this._parent._log(E)}startPerformanceCounter(E){this._parent._startPerformanceCounter(E)}endPerformanceCounter(E){this._parent._endPerformanceCounter(E)}}n.DefaultSampler={index:-1},x.d._CreateGLTF2Loader=E=>new n(E);var s=z(13418),j=z(11999),U=z(11849),k=z(13424),v=z(13428);class Y extends v.d{constructor(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",E),this._texture=E.getEngine().createRawCubeTexture(t,z,A,X,R,u,p,C)}update(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,E,t,z,A,X)}updateRGBDAsync(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,k.i)(this._texture,E,t,z,A).then((()=>{}))}clone(){return U.b.Clone((()=>{const E=this.lE(),t=this._texture,z=new Y(E,t._bufferViewArray,t.width,t.format,t.type,t.generateMipMaps,t.invertY,t.samplingMode,t._compression);return 13===t.source&&z.updateRGBDAsync(t._bufferViewArrayArray,t._sphericalPolynomial,t._lodGenerationScale,t._lodGenerationOffset),z}),this)}}const G="EXT_lights_image_based";class N{constructor(E){this.name=G,this._loader=E,this.enabled=this._loader.isExtensionUsed(G)}dispose(){this._loader=null,delete this._lights}onLoading(){const E=this._loader.zp.extensions;if(E&&E[this.name]){const t=E[this.name];this._lights=t.lights}}loadSceneAsync(E,t){return n.LoadExtensionAsync(E,t,this.name,(async(z,A)=>{this._loader._allMaterialsDirtyRequired=!0;const X=new Array;X.push(this._loader.loadSceneAsync(E,t)),this._loader.logOpen(`${z}`);const R=M.Get(`${z}/light`,this._lights,A.tz);return X.push(this._loadLightAsync(`/extensions/${this.name}/lights/${A.tz}`,R).then((E=>{this._loader.babylonScene.environmentTexture=E}))),this._loader.logClose(),await Promise.all(X).then((()=>{}))}))}_loadLightAsync(E,t){if(!t._loaded){const z=new Array;this._loader.logOpen(`${E}`);const A=new Array(t.specularImages.length);for(let X=0;X<t.specularImages.length;X++){const R=t.specularImages[X];A[X]=new Array(R.length);for(let t=0;t<R.length;t++){const u=`${E}/specularImages/${X}/${t}`;this._loader.logOpen(`${u}`);const p=R[t],C=M.Get(u,this._loader.zp.images,p);z.push(this._loader.loadImageAsync(`/images/${p}`,C).then((E=>{A[X][t]=E}))),this._loader.logClose()}}this._loader.logClose(),t._loaded=Promise.all(z).then((async()=>{const z=new Y(this._loader.babylonScene,null,t.specularImageSize);if(z.name=t.name||"environment",t._babylonTexture=z,void 0!=t.Ip&&(z.level=t.Ip),t.rotation){let E=X.Quaternion.St(t.rotation);this._loader.babylonScene.useRightHandedSystem||(E=X.Quaternion.Inverse(E)),X.Matrix.FromQuaternionToRef(E,z.getReflectionTextureMatrix())}if(!t.irradianceCoefficients)throw new Error(`${E}: Irradiance coefficients are missing`);const R=j.e.St(t.irradianceCoefficients);R.scaleInPlace(t.Ip),R.convertIrradianceToLambertianRadiance();const u=j.i.FromHarmonics(R),p=(A.length-1)/Math.log2(t.specularImageSize);return await z.updateRGBDAsync(A,u,p)}))}return t._loaded.then((()=>t._babylonTexture))}}o(G),g(G,!0,(E=>new N(E)));z(12389);const P="EXT_mesh_gpu_instancing";class EE{constructor(E){this.name=P,this._loader=E,this.enabled=this._loader.isExtensionUsed(P)}dispose(){this._loader=null}loadNodeAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(E,A)=>{this._loader._disableInstancedMesh++;const R=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,z);if(this._loader._disableInstancedMesh--,!t._primitiveBabylonMeshes)return await R;const u=new Array;let p=0;const C=t=>{if(void 0==A.attributes[t])return void u.push(Promise.resolve(null));const z=M.Get(`${E}/attributes/${t}`,this._loader.zp.accessors,A.attributes[t]);if(u.push(this._loader._loadFloatAccessorAsync(`/accessors/${z.bufferView}`,z)),0===p)p=z.count;else if(p!==z.count)throw new Error(`${E}/attributes: Instance buffer accessors do not have the same count.`)};return C("TRANSLATION"),C("ROTATION"),C("SCALE"),await R.then((async E=>{const[z,A,R]=await Promise.all(u),C=new Float32Array(16*p);X.TmpVectors.Lt[0].Op(0,0,0),X.TmpVectors.Quaternion[0].Op(0,0,0,1),X.TmpVectors.Lt[1].Op(1,1,1);for(let t=0;t<p;++t)z&&X.Lt.FromArrayToRef(z,3*t,X.TmpVectors.Lt[0]),A&&X.Quaternion.FromArrayToRef(A,4*t,X.TmpVectors.Quaternion[0]),R&&X.Lt.FromArrayToRef(R,3*t,X.TmpVectors.Lt[1]),X.Matrix.ComposeToRef(X.TmpVectors.Lt[1],X.TmpVectors.Quaternion[0],X.TmpVectors.Lt[0],X.TmpVectors.Matrix[0]),X.TmpVectors.Matrix[0].copyToArray(C,16*t);for(const X of t._primitiveBabylonMeshes)X.ah("matrix",C,16,!0);return E}))}))}}o(P),g(P,!0,(E=>new EE(E)));let tE=0,zE=null;class AE{static get Default(){return AE._Default||(AE._Default=new AE),AE._Default}constructor(){const E=AE.Configuration.decoder;this._decoderModulePromise=u.Tools.LoadBabylonScriptAsync(E.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(E,t,z,A,X){await this._decoderModulePromise,0===tE&&(MeshoptDecoder.useWorkers(1),tE=1);const R=await MeshoptDecoder.decodeGltfBufferAsync(t,z,E,A,X);return null!==zE&&clearTimeout(zE),zE=setTimeout((()=>{MeshoptDecoder.useWorkers(0),tE=0,zE=null}),1e3),R}}AE.Configuration={decoder:{url:`${u.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},AE._Default=null;const XE="EXT_meshopt_compression";class RE{constructor(E){this.name=XE,this.enabled=E.isExtensionUsed(XE),this._loader=E}dispose(){this._loader=null}loadBufferViewAsync(E,t){return n.LoadExtensionAsync(E,t,this.name,(async(z,A)=>{const X=t;if(X._meshOptData)return await X._meshOptData;const R=M.Get(`${E}/buffer`,this._loader.zp.buffers,A.buffer);return X._meshOptData=this._loader.loadBufferAsync(`/buffers/${R.index}`,R,A.byteOffset||0,A.byteLength).then((async E=>await AE.Default.decodeGltfBufferAsync(E,A.count,A.byteStride,A.mode,A.filter))),await X._meshOptData}))}}o(XE),g(XE,!0,(E=>new RE(E)));const uE="EXT_texture_webp";class pE{constructor(E){this.name=uE,this._loader=E,this.enabled=E.isExtensionUsed(uE)}dispose(){this._loader=null}_loadTextureAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=void 0==t.sampler?n.DefaultSampler:M.Get(`${E}/sampler`,this._loader.zp.samplers,t.sampler),u=M.Get(`${A}/source`,this._loader.zp.images,X.source);return await this._loader._createTextureAsync(E,R,u,(E=>{z(E)}),void 0,!t._textureInfo.nonColorData)}))}}o(uE),g(uE,!0,(E=>new pE(E)));const CE="EXT_texture_avif";class ZE{constructor(E){this.name=CE,this._loader=E,this.enabled=E.isExtensionUsed(CE)}dispose(){this._loader=null}_loadTextureAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=void 0==t.sampler?n.DefaultSampler:M.Get(`${E}/sampler`,this._loader.zp.samplers,t.sampler),u=M.Get(`${A}/source`,this._loader.zp.images,X.source);return await this._loader._createTextureAsync(E,R,u,(E=>{z(E)}),void 0,!t._textureInfo.nonColorData)}))}}o(CE),g(CE,!0,(E=>new ZE(E)));var HE=z(13411),hE=z(12361);const dE="EXT_lights_ies";class yE{constructor(E){this.name=dE,this._loader=E,this.enabled=this._loader.isExtensionUsed(dE)}dispose(){this._loader=null,delete this._lights}onLoading(){const E=this._loader.zp.extensions;if(E&&E[this.name]){const t=E[this.name];this._lights=t.lights,M.Assign(this._lights)}}loadNodeAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,u)=>{let p,C;this._loader._allMaterialsDirtyRequired=!0;const Z=await this._loader.loadNodeAsync(E,t,(E=>{C=M.Get(A,this._lights,u.tz);const t=C.name||E.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,p=new HE.b(t,X.Lt.Zero(),X.Lt.Backward(),0,1,this._loader.babylonScene),p.angle=Math.PI/2,p.innerAngle=0,p._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,C._babylonLight=p,p.falloffType=hE.d.FALLOFF_GLTF,p.ep=u.color?R.Dt.St(u.color):R.Dt.White(),p.Ip=u.multiplier||1,p.range=Number.MAX_VALUE,p.parent=E,this._loader._babylonLights.push(p),n.AddPointerMetadata(p,A),z(E)}));let H;if(C.uri)H=await this._loader.loadUriAsync(E,C,C.uri);else{const t=M.Get(`${E}/bufferView`,this._loader.zp.bufferViews,C.bufferView);H=await this._loader.loadBufferViewAsync(`/bufferViews/${t.index}`,t)}return p.iesProfileTexture=new I.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,H,!0,void 0,void 0,void 0,void 0,".ies"),Z}))}}o(dE),g(dE,!0,(E=>new yE(E)));var OE=z(13437);const cE="KHR_draco_mesh_compression";class aE{constructor(E){this.name=cE,this.useNormalizedFlagFromAccessor=!0,this._loader=E,this.enabled=OE.c.DefaultAvailable&&this._loader.isExtensionUsed(cE)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{if(void 0!=t.mode&&4!==t.mode&&5!==t.mode)throw new Error(`${E}: Unsupported mode ${t.mode}`);const R={},u={},p=(E,A)=>{const p=X.attributes[E];if(void 0!=p&&(z._delayInfo=z._delayInfo||[],-1===z._delayInfo.indexOf(A)&&z._delayInfo.push(A),R[A]=p,this.useNormalizedFlagFromAccessor)){const z=M.TryGet(this._loader.zp.accessors,t.attributes[E]);z&&(u[A]=z.normalized||!1)}};p("POSITION",D.f.PositionKind),p("NORMAL",D.f.NormalKind),p("TANGENT",D.f.TangentKind),p("TEXCOORD_0",D.f.UVKind),p("TEXCOORD_1",D.f.UV2Kind),p("TEXCOORD_2",D.f.UV3Kind),p("TEXCOORD_3",D.f.UV4Kind),p("TEXCOORD_4",D.f.UV5Kind),p("TEXCOORD_5",D.f.UV6Kind),p("JOINTS_0",D.f.MatricesIndicesKind),p("WEIGHTS_0",D.f.MatricesWeightsKind),p("COLOR_0",D.f.ColorKind);const C=M.Get(A,this._loader.zp.bufferViews,X.bufferView);return C._dracoBabylonGeometry||(C._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((async A=>{const X=this.dracoDecoder||OE.c.Default,p=M.TryGet(this._loader.zp.accessors,t.attributes.POSITION),C=this._loader.parent.alwaysComputeBoundingBox||z.skeleton||!p?null:w(p);return await X._decodeMeshToGeometryForGltfAsync(z.name,this._loader.babylonScene,A,R,u,C).catch((t=>{throw new Error(`${E}: ${t.message}`)}))}))),await C._dracoBabylonGeometry}))}}o(cE),g(cE,!0,(E=>new aE(E)));var LE=z(13443),mt=z(11792),WE=z(11801),IE=z(12227),eE=z(12424),DE=z(11766);IE.b.AddNodeConstructor("Light_Type_0",((E,t)=>()=>new SE(E,X.Lt.Zero(),t)));class SE extends eE.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(E){this._shadowAngle=E,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(E){const t=this.needCube();if(this._direction=E,this.needCube()!==t&&this._shadowGenerators){const E=this._shadowGenerators.values();for(let t=E.next();!0!==t.done;t=E.next()){t.value.recreateShadowMap()}}}constructor(E,t,z){super(E,z),this._shadowAngle=Math.PI/2,this.position=t}getClassName(){return"PointLight"}getTypeID(){return hE.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(E){if(this.direction)return super.getShadowDirection(E);switch(E){case 0:return new X.Lt(1,0,0);case 1:return new X.Lt(-1,0,0);case 2:return new X.Lt(0,-1,0);case 3:return new X.Lt(0,1,0);case 4:return new X.Lt(0,0,1);case 5:return new X.Lt(0,0,-1)}return X.Lt.Zero()}_setDefaultShadowProjectionMatrix(E,t,z){const A=this.lE().activeCamera;if(!A)return;const R=void 0!==this.shadowMinZ?this.shadowMinZ:A.Cp,u=void 0!==this.shadowMaxZ?this.shadowMaxZ:A.maxZ,p=this.lE().getEngine().useReverseDepthBuffer;X.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,p?u:R,p?R:u,E,!0,this._scene.getEngine().isNDCHalfZRange,void 0,p)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(E,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this}transferToNodeMaterialEffect(E,t){return this.computeTransformedInformation()?E.setFloat3(t,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):E.setFloat3(t,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(E,t){E["POINTLIGHT"+t]=!0}}(0,mt.b)([(0,WE.K)()],SE.prototype,"shadowAngle",null),(0,DE.f)("BABYLON.PointLight",SE);const lE="KHR_lights_punctual";class fE{constructor(E){this.name=lE,this._loader=E,this.enabled=this._loader.isExtensionUsed(lE)}dispose(){this._loader=null,delete this._lights}onLoading(){const E=this._loader.zp.extensions;if(E&&E[this.name]){const t=E[this.name];this._lights=t.lights,M.Assign(this._lights)}}loadNodeAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,u)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(E,t,(E=>{let t;const p=M.Get(A,this._lights,u.tz),C=p.name||E.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,p.type){case"directional":{const E=new LE.c(C,X.Lt.Backward(),this._loader.babylonScene);E.position.ap(0),t=E;break}case"point":t=new SE(C,X.Lt.Zero(),this._loader.babylonScene);break;case"spot":{const E=new HE.b(C,X.Lt.Zero(),X.Lt.Backward(),0,1,this._loader.babylonScene);E.angle=2*(p.spot&&p.spot.outerConeAngle||Math.PI/4),E.innerAngle=2*(p.spot&&p.spot.innerConeAngle||0),t=E;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${A}: Invalid light type (${p.type})`)}t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,p._babylonLight=t,t.falloffType=hE.d.FALLOFF_GLTF,t.ep=p.color?R.Dt.St(p.color):R.Dt.White(),t.Ip=void 0==p.Ip?1:p.Ip,t.range=void 0==p.range?Number.MAX_VALUE:p.range,t.parent=E,this._loader._babylonLights.push(t),n.AddPointerMetadata(t,A),z(E)})))))}}o(lE),g(lE,!0,(E=>new fE(E)));const KE="KHR_materials_pbrSpecularGlossiness";class FE{constructor(E){this.name=KE,this.order=200,this._loader=E,this.enabled=this._loader.isExtensionUsed(KE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=new Array;return R.push(this._loader.loadMaterialBasePropertiesAsync(E,t,z)),R.push(this._loadSpecularGlossinessPropertiesAsync(A,X,z)),this._loader.loadMaterialAlphaProperties(E,t,z),await Promise.all(R).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(E,t,z){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);const A=new Array;return z.metallic=null,z.roughness=null,t.diffuseFactor?(z.albedoColor=R.Dt.St(t.diffuseFactor),z.alpha=t.diffuseFactor[3]):z.albedoColor=R.Dt.White(),z.reflectivityColor=t.specularFactor?R.Dt.St(t.specularFactor):R.Dt.White(),z.microSurface=void 0==t.glossinessFactor?1:t.glossinessFactor,t.diffuseTexture&&A.push(this._loader.loadTextureInfoAsync(`${E}/diffuseTexture`,t.diffuseTexture,(E=>{E.name=`${z.name} (Diffuse)`,z.albedoTexture=E}))),t.specularGlossinessTexture&&(A.push(this._loader.loadTextureInfoAsync(`${E}/specularGlossinessTexture`,t.specularGlossinessTexture,(E=>{E.name=`${z.name} (Specular Glossiness)`,z.reflectivityTexture=E,z.reflectivityTexture.pp=!0}))),z.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(A).then((()=>{}))}}o(KE),g(KE,!0,(E=>new FE(E)));const BE="KHR_materials_unlit";class bE{constructor(E){this.name=BE,this.order=210,this._loader=E,this.enabled=this._loader.isExtensionUsed(BE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async()=>await this._loadUnlitPropertiesAsync(E,t,z)))}_loadUnlitPropertiesAsync(E,t,z){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);const A=new Array;z.unlit=!0;const X=t.pbrMetallicRoughness;return X&&(X.baseColorFactor?(z.albedoColor=R.Dt.St(X.baseColorFactor),z.alpha=X.baseColorFactor[3]):z.albedoColor=R.Dt.White(),X.baseColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${E}/baseColorTexture`,X.baseColorTexture,(E=>{E.name=`${z.name} (Base Color)`,z.albedoTexture=E})))),t.doubleSided&&(z.yp=!1,z.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(E,t,z),Promise.all(A).then((()=>{}))}}o(BE),g(BE,!0,(E=>new bE(E)));const xE="KHR_materials_clearcoat";class JE{constructor(E){this.name=xE,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(xE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=new Array;R.push(this._loader.loadMaterialPropertiesAsync(E,t,z)),R.push(this._loadClearCoatPropertiesAsync(A,X,z)),await Promise.all(R)}))}_loadClearCoatPropertiesAsync(E,t,z){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);const A=new Array;return z.clearCoat.isEnabled=!0,z.clearCoat.useRoughnessFromMainTexture=!1,z.clearCoat.remapF0OnInterfaceChange=!1,void 0!=t.clearcoatFactor?z.clearCoat.Ip=t.clearcoatFactor:z.clearCoat.Ip=0,t.clearcoatTexture&&A.push(this._loader.loadTextureInfoAsync(`${E}/clearcoatTexture`,t.clearcoatTexture,(E=>{E.name=`${z.name} (ClearCoat)`,z.clearCoat.texture=E}))),void 0!=t.clearcoatRoughnessFactor?z.clearCoat.roughness=t.clearcoatRoughnessFactor:z.clearCoat.roughness=0,t.clearcoatRoughnessTexture&&(t.clearcoatRoughnessTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${E}/clearcoatRoughnessTexture`,t.clearcoatRoughnessTexture,(E=>{E.name=`${z.name} (ClearCoat Roughness)`,z.clearCoat.textureRoughness=E})))),t.clearcoatNormalTexture&&(t.clearcoatNormalTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${E}/clearcoatNormalTexture`,t.clearcoatNormalTexture,(E=>{E.name=`${z.name} (ClearCoat Normal)`,z.clearCoat.bumpTexture=E}))),z.invertNormalMapX=!z.lE().useRightHandedSystem,z.invertNormalMapY=z.lE().useRightHandedSystem,void 0!=t.clearcoatNormalTexture.scale&&(z.clearCoat.bumpTexture.level=t.clearcoatNormalTexture.scale)),Promise.all(A).then((()=>{}))}}o(xE),g(xE,!0,(E=>new JE(E)));const VE="KHR_materials_iridescence";class rE{constructor(E){this.name=VE,this.order=195,this._loader=E,this.enabled=this._loader.isExtensionUsed(VE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(E,t,z)),R.push(this._loadIridescencePropertiesAsync(A,X,z)),await Promise.all(R).then((()=>{}))}))}_loadIridescencePropertiesAsync(E,t,z){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);const A=new Array;return z.iridescence.isEnabled=!0,z.iridescence.Ip=t.iridescenceFactor??0,z.iridescence.indexOfRefraction=t.iridescenceIor??t.iridescenceIOR??1.3,z.iridescence.minimumThickness=t.iridescenceThicknessMinimum??100,z.iridescence.maximumThickness=t.iridescenceThicknessMaximum??400,t.iridescenceTexture&&A.push(this._loader.loadTextureInfoAsync(`${E}/iridescenceTexture`,t.iridescenceTexture,(E=>{E.name=`${z.name} (Iridescence)`,z.iridescence.texture=E}))),t.iridescenceThicknessTexture&&A.push(this._loader.loadTextureInfoAsync(`${E}/iridescenceThicknessTexture`,t.iridescenceThicknessTexture,(E=>{E.name=`${z.name} (Iridescence Thickness)`,z.iridescence.thicknessTexture=E}))),Promise.all(A).then((()=>{}))}}o(VE),g(VE,!0,(E=>new rE(E)));const iE="KHR_materials_anisotropy";class gE{constructor(E){this.name=iE,this.order=195,this._loader=E,this.enabled=this._loader.isExtensionUsed(iE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=new Array;R.push(this._loader.loadMaterialPropertiesAsync(E,t,z)),R.push(this._loadIridescencePropertiesAsync(A,X,z)),await Promise.all(R)}))}async _loadIridescencePropertiesAsync(E,t,z){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);const A=new Array;z.anisotropy.isEnabled=!0,z.anisotropy.Ip=t.anisotropyStrength??0,z.anisotropy.angle=t.anisotropyRotation??0,t.anisotropyTexture&&(t.anisotropyTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${E}/anisotropyTexture`,t.anisotropyTexture,(E=>{E.name=`${z.name} (Anisotropy Intensity)`,z.anisotropy.texture=E})))),await Promise.all(A)}}o(iE),g(iE,!0,(E=>new gE(E)));const oE="KHR_materials_emissive_strength";class QE{constructor(E){this.name=oE,this.order=170,this._loader=E,this.enabled=this._loader.isExtensionUsed(oE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>await this._loader.loadMaterialPropertiesAsync(E,t,z).then((()=>{this._loadEmissiveProperties(A,X,z)}))))}_loadEmissiveProperties(E,t,z){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);void 0!==t.emissiveStrength&&(z.emissiveIntensity=t.emissiveStrength)}}o(oE),g(oE,!0,(E=>new QE(E)));const TE="KHR_materials_sheen";class qE{constructor(E){this.name=TE,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(TE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(E,t,z)),R.push(this._loadSheenPropertiesAsync(A,X,z)),await Promise.all(R).then((()=>{}))}))}_loadSheenPropertiesAsync(E,t,z){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);const A=new Array;return z.sheen.isEnabled=!0,z.sheen.Ip=1,void 0!=t.sheenColorFactor?z.sheen.color=R.Dt.St(t.sheenColorFactor):z.sheen.color=R.Dt.Black(),t.sheenColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${E}/sheenColorTexture`,t.sheenColorTexture,(E=>{E.name=`${z.name} (Sheen Color)`,z.sheen.texture=E}))),void 0!==t.sheenRoughnessFactor?z.sheen.roughness=t.sheenRoughnessFactor:z.sheen.roughness=0,t.sheenRoughnessTexture&&(t.sheenRoughnessTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${E}/sheenRoughnessTexture`,t.sheenRoughnessTexture,(E=>{E.name=`${z.name} (Sheen Roughness)`,z.sheen.textureRoughness=E})))),z.sheen.albedoScaling=!0,z.sheen.useRoughnessFromMainTexture=!1,Promise.all(A).then((()=>{}))}}o(TE),g(TE,!0,(E=>new qE(E)));var ME=z(12286);const wE="KHR_materials_specular";class nE{constructor(E){this.name=wE,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(wE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=new Array;if(R.push(this._loader.loadMaterialPropertiesAsync(E,t,z)),R.push(this._loadSpecularPropertiesAsync(A,X,z)),X.extensions&&X.extensions.EXT_materials_specular_edge_color&&z instanceof W.b){X.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(z.brdf.dielectricSpecularModel=ME.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,z.brdf.conductorSpecularModel=ME.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(R).then((()=>{}))}))}_loadSpecularPropertiesAsync(E,t,z){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);const A=new Array;return void 0!==t.specularFactor&&(z.metallicF0Factor=t.specularFactor),void 0!==t.specularColorFactor&&(z.metallicReflectanceColor=R.Dt.St(t.specularColorFactor)),t.specularTexture&&(t.specularTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${E}/specularTexture`,t.specularTexture,(E=>{E.name=`${z.name} (Specular)`,z.metallicReflectanceTexture=E,z.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),t.specularColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${E}/specularColorTexture`,t.specularColorTexture,(E=>{E.name=`${z.name} (Specular Color)`,z.reflectanceTexture=E}))),Promise.all(A).then((()=>{}))}}o(wE),g(wE,!0,(E=>new nE(E)));const sE="KHR_materials_ior";class jE{constructor(E){this.name=sE,this.order=180,this._loader=E,this.enabled=this._loader.isExtensionUsed(sE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(E,t,z)),R.push(this._loadIorPropertiesAsync(A,X,z)),await Promise.all(R).then((()=>{}))}))}_loadIorPropertiesAsync(E,t,z){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);return void 0!==t.ior?z.indexOfRefraction=t.ior:z.indexOfRefraction=jE._DEFAULT_IOR,Promise.resolve()}}jE._DEFAULT_IOR=1.5,o(sE),g(sE,!0,(E=>new jE(E)));const UE="KHR_materials_variants";class kE{constructor(E){this.name=UE,this._loader=E,this.enabled=this._loader.isExtensionUsed(UE)}dispose(){this._loader=null}static GetAvailableVariants(E){const t=this._GetExtensionMetadata(E);return t?Object.keys(t.variants):[]}getAvailableVariants(E){return kE.GetAvailableVariants(E)}static SelectVariant(E,t){const z=this._GetExtensionMetadata(E);if(!z)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${UE} extension`);const A=E=>{const t=z.variants[E];if(t)for(const z of t)z.mesh.material=z.material};if(t instanceof Array)for(const X of t)A(X);else A(t);z.lastSelected=t}selectVariant(E,t){kE.SelectVariant(E,t)}static Reset(E){const t=this._GetExtensionMetadata(E);if(!t)throw new Error(`Cannot reset on a glTF mesh that does not have the ${UE} extension`);for(const z of t.original)z.mesh.material=z.material;t.lastSelected=null}reset(E){kE.Reset(E)}static GetLastSelectedVariant(E){const t=this._GetExtensionMetadata(E);if(!t)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${UE} extension`);return t.lastSelected}getLastSelectedVariant(E){return kE.GetLastSelectedVariant(E)}static _GetExtensionMetadata(E){var t,z;return(null===E||void 0===E||null===(t=E._internalMetadata)||void 0===t||null===(z=t.zp)||void 0===z?void 0:z[UE])||null}onLoading(){const E=this._loader.zp.extensions;if(E&&E[this.name]){const t=E[this.name];this._variants=t.variants}}onReady(){const E=this._loader.rootBabylonMesh;if(E){var t;const z=this._loader.parent.extensionOptions[UE];null!==z&&void 0!==z&&z.defaultVariant&&kE.SelectVariant(E,z.defaultVariant),null===z||void 0===z||null===(t=z.onLoaded)||void 0===t||t.call(z,{get variants(){return kE.GetAvailableVariants(E)},get selectedVariant(){const t=kE.GetLastSelectedVariant(E);return t?Array.isArray(t)?t[0]:t:kE.GetAvailableVariants(E)[0]},set selectedVariant(t){kE.SelectVariant(E,t)}})}}_loadMeshPrimitiveAsync(E,t,z,A,X,R){return n.LoadExtensionAsync(E,X,this.name,(async(u,p)=>{const C=new Array;return C.push(this._loader._loadMeshPrimitiveAsync(E,t,z,A,X,(t=>{if(R(t),t instanceof f.e){const z=n._GetDrawMode(E,X.mode),A=this._loader.rootBabylonMesh,R=A?A._internalMetadata=A._internalMetadata||{}:{},Z=R.zp=R.zp||{},H=Z[UE]=Z[UE]||{lastSelected:null,original:[],variants:{}};H.original.push({mesh:t,material:t.material});for(let E=0;E<p.mappings.length;++E){const X=p.mappings[E],R=M.Get(`${u}/mappings/${E}/material`,this._loader.zp.materials,X.material);C.push(this._loader._loadMaterialAsync(`#/materials/${X.material}`,R,t,z,(E=>{for(let z=0;z<X.variants.length;++z){const R=X.variants[z],u=M.Get(`/extensions/${UE}/variants/${R}`,this._variants,R);H.variants[u.name]=H.variants[u.name]||[],H.variants[u.name].push({mesh:t,material:E}),t.onClonedObservable.add((E=>{const z=E;let X=null,R=z;do{if(R=R.parent,!R)return;X=kE._GetExtensionMetadata(R)}while(null===X);if(A&&X===kE._GetExtensionMetadata(A)){R._internalMetadata={};for(const E in A._internalMetadata)R._internalMetadata[E]=A._internalMetadata[E];R._internalMetadata.zp=[];for(const E in A._internalMetadata.zp)R._internalMetadata.zp[E]=A._internalMetadata.zp[E];R._internalMetadata.zp[UE]={lastSelected:null,original:[],variants:{}};for(const E of X.original)R._internalMetadata.zp[UE].original.push({mesh:E.mesh,material:E.material});for(const E in X.variants)if(Object.prototype.hasOwnProperty.call(X.variants,E)){R._internalMetadata.zp[UE].variants[E]=[];for(const t of X.variants[E])R._internalMetadata.zp[UE].variants[E].push({mesh:t.mesh,material:t.material})}X=R._internalMetadata.zp[UE]}for(const A of X.original)A.mesh===t&&(A.mesh=z);for(const A of X.variants[u.name])A.mesh===t&&(A.mesh=z)}))}})))}}}))),await Promise.all(C).then((E=>{let[t]=E;return t}))}))}}o(UE),g(UE,!0,(E=>new kE(E)));var vE=z(11879);class YE{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:ME.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(E,t){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...YE._GetDefaultOptions(),...E},this._scene=t,this._scene._transmissionHelper=this,this.onErrorObservable=new H.b,this._scene.IX.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(E){if(!Object.keys(E).filter((t=>this._options[t]!==E[t])).length)return;const t={...this._options,...E},z=this._options;this._options=t,t.renderSize===z.renderSize&&t.renderTargetTextureType===z.renderTargetTextureType&&t.generateMipmaps===z.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=t.samples,this._opaqueRenderTarget.lodGenerationScale=t.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=t.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(E){return!!E&&!!(E instanceof W.b&&E.subSurface.isRefractionEnabled)}_addMesh(E){this._materialObservers[E.uniqueId]=E.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),u.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(E.material)?(E.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(E)&&this._transparentMeshesCache.push(E)):-1===this._opaqueMeshesCache.indexOf(E)&&this._opaqueMeshesCache.push(E)}))}_removeMesh(E){E.onMaterialChangedObservable.remove(this._materialObservers[E.uniqueId]),delete this._materialObservers[E.uniqueId];let t=this._transparentMeshesCache.indexOf(E);-1!==t&&this._transparentMeshesCache.splice(t,1),t=this._opaqueMeshesCache.indexOf(E),-1!==t&&this._opaqueMeshesCache.splice(t,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(E){const t=this._transparentMeshesCache.indexOf(E),z=this._opaqueMeshesCache.indexOf(E);this._shouldRenderAsTransmission(E.material)?(E.material instanceof W.b&&(E.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==z?(this._opaqueMeshesCache.splice(z,1),this._transparentMeshesCache.push(E)):-1===t&&this._transparentMeshesCache.push(E)):-1!==t?(this._transparentMeshesCache.splice(t,1),this._opaqueMeshesCache.push(E)):-1===z&&this._opaqueMeshesCache.push(E)}_isRenderTargetValid(){var E;return null!==(null===(E=this._opaqueRenderTarget)||void 0===E?void 0:E.getInternalTexture())}_setupRenderTargets(){var E;let t;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new vE.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(E=this._options.clearColor)||void 0===E?void 0:E.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((E=>{t=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?E.clearColor.R(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(E.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=t}));for(const z of this._transparentMeshesCache)this._shouldRenderAsTransmission(z.material)&&(z.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const GE="KHR_materials_transmission";class NE{constructor(E){this.name=GE,this.order=175,this._loader=E,this.enabled=this._loader.isExtensionUsed(GE),this.enabled&&(E.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(E,t,z)),R.push(this._loadTransparentPropertiesAsync(A,t,z,X)),await Promise.all(R).then((()=>{}))}))}_loadTransparentPropertiesAsync(E,t,z,A){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);const X=z;if(X.subSurface.isRefractionEnabled=!0,X.subSurface.volumeIndexOfRefraction=1,X.subSurface.useAlbedoToTintRefraction=!0,void 0===A.transmissionFactor)return X.subSurface.refractionIntensity=0,X.subSurface.isRefractionEnabled=!1,Promise.resolve();{var R;X.subSurface.refractionIntensity=A.transmissionFactor;const E=X.lE();if(X.subSurface.refractionIntensity&&!E._transmissionHelper)new YE({},X.lE());else if(X.subSurface.refractionIntensity&&(null===(R=E._transmissionHelper)||void 0===R||!R._isRenderTargetValid())){var u;null===(u=E._transmissionHelper)||void 0===u||u._setupRenderTargets()}}return X.subSurface.minimumThickness=0,X.subSurface.maximumThickness=0,A.transmissionTexture?(A.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${E}/transmissionTexture`,A.transmissionTexture,void 0).then((E=>{E.name=`${z.name} (Transmission)`,X.subSurface.refractionIntensityTexture=E,X.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}o(GE),g(GE,!0,(E=>new NE(E)));const PE="KHR_materials_diffuse_transmission";class Et{constructor(E){this.name=PE,this.order=174,this._loader=E,this.enabled=this._loader.isExtensionUsed(PE),this.enabled&&(E.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(E,t,z)),R.push(this._loadTranslucentPropertiesAsync(A,t,z,X)),await Promise.all(R).then((()=>{}))}))}_loadTranslucentPropertiesAsync(E,t,z,A){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);const X=z;if(X.subSurface.isTranslucencyEnabled=!0,X.subSurface.volumeIndexOfRefraction=1,X.subSurface.minimumThickness=0,X.subSurface.maximumThickness=0,X.subSurface.useAlbedoToTintTranslucency=!1,void 0===A.diffuseTransmissionFactor)return X.subSurface.translucencyIntensity=0,X.subSurface.isTranslucencyEnabled=!1,Promise.resolve();X.subSurface.translucencyIntensity=A.diffuseTransmissionFactor;const u=new Array;return X.subSurface.useGltfStyleTextures=!0,A.diffuseTransmissionTexture&&(A.diffuseTransmissionTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${E}/diffuseTransmissionTexture`,A.diffuseTransmissionTexture).then((E=>{E.name=`${z.name} (Diffuse Transmission)`,X.subSurface.translucencyIntensityTexture=E})))),void 0!==A.diffuseTransmissionColorFactor?X.subSurface.translucencyColor=R.Dt.St(A.diffuseTransmissionColorFactor):X.subSurface.translucencyColor=R.Dt.White(),A.diffuseTransmissionColorTexture&&u.push(this._loader.loadTextureInfoAsync(`${E}/diffuseTransmissionColorTexture`,A.diffuseTransmissionColorTexture).then((E=>{E.name=`${z.name} (Diffuse Transmission Color)`,X.subSurface.translucencyColorTexture=E}))),Promise.all(u).then((()=>{}))}}o(PE),g(PE,!0,(E=>new Et(E)));const tt="KHR_materials_volume";class zt{constructor(E){this.name=tt,this.order=173,this._loader=E,this.enabled=this._loader.isExtensionUsed(tt),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(E,t,z)),R.push(this._loadVolumePropertiesAsync(A,t,z,X)),await Promise.all(R).then((()=>{}))}))}_loadVolumePropertiesAsync(E,t,z,A){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);if(!z.subSurface.isRefractionEnabled&&!z.subSurface.isTranslucencyEnabled||!A.thicknessFactor)return Promise.resolve();z.subSurface.volumeIndexOfRefraction=z.indexOfRefraction;const X=void 0!==A.attenuationDistance?A.attenuationDistance:Number.MAX_VALUE;return z.subSurface.tintColorAtDistance=X,void 0!==A.attenuationColor&&3==A.attenuationColor.length&&z.subSurface.tintColor.Op(A.attenuationColor[0],A.attenuationColor[1],A.attenuationColor[2]),z.subSurface.minimumThickness=0,z.subSurface.maximumThickness=A.thicknessFactor,z.subSurface.useThicknessAsDepth=!0,A.thicknessTexture?(A.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${E}/thicknessTexture`,A.thicknessTexture).then((E=>{E.name=`${z.name} (Thickness)`,z.subSurface.thicknessTexture=E,z.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}o(tt),g(tt,!0,(E=>new zt(E)));const At="KHR_materials_dispersion";class Xt{constructor(E){this.name=At,this.order=174,this._loader=E,this.enabled=this._loader.isExtensionUsed(At)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(E,t,z)),R.push(this._loadDispersionPropertiesAsync(A,t,z,X)),await Promise.all(R).then((()=>{}))}))}_loadDispersionPropertiesAsync(E,t,z,A){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);return z.subSurface.isRefractionEnabled&&A.dispersion?(z.subSurface.isDispersionEnabled=!0,z.subSurface.dispersion=A.dispersion,Promise.resolve()):Promise.resolve()}}o(At),g(At,!0,(E=>new Xt(E)));const Rt="EXT_materials_diffuse_roughness";class ut{constructor(E){this.name=Rt,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(Rt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(E,t,z)),R.push(this._loadDiffuseRoughnessPropertiesAsync(A,X,z)),await Promise.all(R).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(E,t,z){if(!(z instanceof W.b))throw new Error(`${E}: Material type not supported`);const A=new Array;return z.brdf.baseDiffuseModel=ME.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=t.diffuseRoughnessFactor?z.baseDiffuseRoughness=t.diffuseRoughnessFactor:z.baseDiffuseRoughness=0,t.diffuseRoughnessTexture&&A.push(this._loader.loadTextureInfoAsync(`${E}/diffuseRoughnessTexture`,t.diffuseRoughnessTexture,(E=>{E.name=`${z.name} (Diffuse Roughness)`,z.baseDiffuseRoughnessTexture=E}))),Promise.all(A).then((()=>{}))}}o(Rt),g(Rt,!0,(E=>new ut(E)));const pt="KHR_mesh_quantization";class Ct{constructor(E){this.name=pt,this.enabled=E.isExtensionUsed(pt)}dispose(){}}o(pt),g(pt,!0,(E=>new Ct(E)));const Zt="KHR_texture_basisu";class Ht{constructor(E){this.name=Zt,this._loader=E,this.enabled=E.isExtensionUsed(Zt)}dispose(){this._loader=null}_loadTextureAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>{const R=void 0==t.sampler?n.DefaultSampler:M.Get(`${E}/sampler`,this._loader.zp.samplers,t.sampler),u=M.Get(`${A}/source`,this._loader.zp.images,X.source);return await this._loader._createTextureAsync(E,R,u,(E=>{z(E)}),t._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!t._textureInfo.nonColorData)}))}}o(Zt),g(Zt,!0,(E=>new Ht(E)));const ht="KHR_texture_transform";class dt{constructor(E){this.name=ht,this._loader=E,this.enabled=this._loader.isExtensionUsed(ht)}dispose(){this._loader=null}loadTextureInfoAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(A,X)=>await this._loader.loadTextureInfoAsync(E,t,(E=>{if(!(E instanceof I.d))throw new Error(`${A}: Texture type not supported`);X.offset&&(E.uOffset=X.offset[0],E.vOffset=X.offset[1]),E.uRotationCenter=0,E.vRotationCenter=0,X.rotation&&(E.wAng=-X.rotation),X.scale&&(E.uScale=X.scale[0],E.vScale=X.scale[1]),void 0!=X.texCoord&&(E.coordinatesIndex=X.texCoord),z(E)}))))}}o(ht),g(ht,!0,(E=>new dt(E)));const yt="KHR_xmp_json_ld";class Ot{constructor(E){this.name=yt,this.order=100,this._loader=E,this.enabled=this._loader.isExtensionUsed(yt)}dispose(){this._loader=null}onLoading(){var E,t,z;if(null===this._loader.rootBabylonMesh)return;const A=null===(E=this._loader.zp.extensions)||void 0===E?void 0:E.KHR_xmp_json_ld,X=null===(t=this._loader.zp.asset)||void 0===t||null===(z=t.extensions)||void 0===z?void 0:z.KHR_xmp_json_ld;if(A&&X){const E=+X.packet;A.packets&&E<A.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=A.packets[E])}}}function ct(E,t,z,A){return R.Dt.St(t,z).scale(A)}function at(E,t,z,A){return t[z]*A}function Lt(E,t,z,A){return-t[z]*A}function mz(E,t,z,A){return t[z+1]*A}function Wt(E,t,z,A){return t[z]*A*2}function It(E){return{scale:[new Dt(d.c.ANIMATIONTYPE_FLOAT,`${E}.uScale`,at,(()=>2)),new Dt(d.c.ANIMATIONTYPE_FLOAT,`${E}.vScale`,mz,(()=>2))],offset:[new Dt(d.c.ANIMATIONTYPE_FLOAT,`${E}.uOffset`,at,(()=>2)),new Dt(d.c.ANIMATIONTYPE_FLOAT,`${E}.vOffset`,mz,(()=>2))],rotation:[new Dt(d.c.ANIMATIONTYPE_FLOAT,`${E}.wAng`,Lt,(()=>1))]}}o(yt),g(yt,!0,(E=>new Ot(E)));class et extends s.AnimationPropertyInfo{buildAnimations(E,t,z,A){return[{babylonAnimatable:E._babylonCamera,babylonAnimation:this._buildAnimation(t,z,A)}]}}class Dt extends s.AnimationPropertyInfo{buildAnimations(E,t,z,A){const X=[];for(const R in E._data)X.push({babylonAnimatable:E._data[R].babylonMaterial,babylonAnimation:this._buildAnimation(t,z,A)});return X}}class St extends s.AnimationPropertyInfo{buildAnimations(E,t,z,A){return[{babylonAnimatable:E._babylonLight,babylonAnimation:this._buildAnimation(t,z,A)}]}}(0,Q.f)("/cameras/{}/orthographic/xmag",[new et(d.c.ANIMATIONTYPE_FLOAT,"orthoLeft",Lt,(()=>1)),new et(d.c.ANIMATIONTYPE_FLOAT,"orthoRight",mz,(()=>1))]),(0,Q.f)("/cameras/{}/orthographic/ymag",[new et(d.c.ANIMATIONTYPE_FLOAT,"orthoBottom",Lt,(()=>1)),new et(d.c.ANIMATIONTYPE_FLOAT,"orthoTop",mz,(()=>1))]),(0,Q.f)("/cameras/{}/orthographic/zfar",[new et(d.c.ANIMATIONTYPE_FLOAT,"maxZ",at,(()=>1))]),(0,Q.f)("/cameras/{}/orthographic/znear",[new et(d.c.ANIMATIONTYPE_FLOAT,"Cp",at,(()=>1))]),(0,Q.f)("/cameras/{}/perspective/yfov",[new et(d.c.ANIMATIONTYPE_FLOAT,"fov",at,(()=>1))]),(0,Q.f)("/cameras/{}/perspective/zfar",[new et(d.c.ANIMATIONTYPE_FLOAT,"maxZ",at,(()=>1))]),(0,Q.f)("/cameras/{}/perspective/znear",[new et(d.c.ANIMATIONTYPE_FLOAT,"Cp",at,(()=>1))]),(0,Q.f)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Dt(d.c.ANIMATIONTYPE_COLOR3,"albedoColor",ct,(()=>4)),new Dt(d.c.ANIMATIONTYPE_FLOAT,"alpha",(function(E,t,z,A){return t[z+3]*A}),(()=>4))]),(0,Q.f)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"metallic",at,(()=>1))]),(0,Q.f)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"roughness",at,(()=>1))]);const lt=It("albedoTexture");(0,Q.f)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",lt.scale),(0,Q.f)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",lt.offset),(0,Q.f)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",lt.rotation);const ft=It("metallicTexture");(0,Q.f)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",ft.scale),(0,Q.f)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",ft.offset),(0,Q.f)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",ft.rotation),(0,Q.f)("/materials/{}/emissiveFactor",[new Dt(d.c.ANIMATIONTYPE_COLOR3,"emissiveColor",ct,(()=>3))]);const Kt=It("bumpTexture");(0,Q.f)("/materials/{}/normalTexture/scale",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",at,(()=>1))]),(0,Q.f)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Kt.scale),(0,Q.f)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Kt.offset),(0,Q.f)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Kt.rotation),(0,Q.f)("/materials/{}/occlusionTexture/strength",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",at,(()=>1))]);const Ft=It("ambientTexture");(0,Q.f)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Ft.scale),(0,Q.f)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Ft.offset),(0,Q.f)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Ft.rotation);const Bt=It("emissiveTexture");(0,Q.f)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Bt.scale),(0,Q.f)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Bt.offset),(0,Q.f)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Bt.rotation),(0,Q.f)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",at,(()=>1))]),(0,Q.f)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",at,(()=>1))]);const bt=It("anisotropy.texture");(0,Q.f)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",bt.scale),(0,Q.f)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",bt.offset),(0,Q.f)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",bt.rotation),(0,Q.f)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",at,(()=>1))]),(0,Q.f)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",at,(()=>1))]);const xt=It("clearCoat.texture");(0,Q.f)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",xt.scale),(0,Q.f)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",xt.offset),(0,Q.f)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",xt.rotation);const Jt=It("clearCoat.bumpTexture");(0,Q.f)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",at,(()=>1))]),(0,Q.f)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Jt.scale),(0,Q.f)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Jt.offset),(0,Q.f)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Jt.rotation);const Vt=It("clearCoat.textureRoughness");(0,Q.f)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Vt.scale),(0,Q.f)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Vt.offset),(0,Q.f)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Vt.rotation),(0,Q.f)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",at,(()=>1))]),(0,Q.f)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",at,(()=>1))]),(0,Q.f)("/materials/{}/extensions/KHR_materials_ior/ior",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",at,(()=>1))]),(0,Q.f)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",at,(()=>1))]),(0,Q.f)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",at,(()=>1))]),(0,Q.f)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",at,(()=>1))]),(0,Q.f)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",at,(()=>1))]);const rt=It("iridescence.texture");(0,Q.f)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",rt.scale),(0,Q.f)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",rt.offset),(0,Q.f)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",rt.rotation);const it=It("iridescence.thicknessTexture");(0,Q.f)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",it.scale),(0,Q.f)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",it.offset),(0,Q.f)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",it.rotation),(0,Q.f)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Dt(d.c.ANIMATIONTYPE_COLOR3,"sheen.color",ct,(()=>3))]),(0,Q.f)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",at,(()=>1))]);const gt=It("sheen.texture");(0,Q.f)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",gt.scale),(0,Q.f)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",gt.offset),(0,Q.f)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",gt.rotation);const ot=It("sheen.textureRoughness");(0,Q.f)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",ot.scale),(0,Q.f)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",ot.offset),(0,Q.f)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",ot.rotation),(0,Q.f)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",at,(()=>1))]),(0,Q.f)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Dt(d.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",ct,(()=>3))]);const Qt=It("metallicReflectanceTexture");(0,Q.f)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Qt.scale),(0,Q.f)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Qt.offset),(0,Q.f)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Qt.rotation);const Tt=It("reflectanceTexture");(0,Q.f)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Tt.scale),(0,Q.f)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Tt.offset),(0,Q.f)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Tt.rotation),(0,Q.f)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",at,(()=>1))]);const qt=It("subSurface.refractionIntensityTexture");(0,Q.f)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",qt.scale),(0,Q.f)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",qt.offset),(0,Q.f)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",qt.rotation),(0,Q.f)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Dt(d.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",ct,(()=>3))]),(0,Q.f)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",at,(()=>1))]),(0,Q.f)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",at,(()=>1))]);const Mt=It("subSurface.thicknessTexture");(0,Q.f)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Mt.scale),(0,Q.f)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Mt.offset),(0,Q.f)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Mt.rotation),(0,Q.f)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Dt(d.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",at,(()=>1))]);const wt=It("subSurface.translucencyIntensityTexture");(0,Q.f)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",wt.scale),(0,Q.f)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",wt.offset),(0,Q.f)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",wt.rotation),(0,Q.f)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Dt(d.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",ct,(()=>3))]);const nt=It("subSurface.translucencyColorTexture");(0,Q.f)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",nt.scale),(0,Q.f)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",nt.offset),(0,Q.f)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",nt.rotation),(0,Q.f)("/extensions/KHR_lights_punctual/lights/{}/color",[new St(d.c.ANIMATIONTYPE_COLOR3,"diffuse",ct,(()=>3))]),(0,Q.f)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new St(d.c.ANIMATIONTYPE_FLOAT,"intensity",at,(()=>1))]),(0,Q.f)("/extensions/KHR_lights_punctual/lights/{}/range",[new St(d.c.ANIMATIONTYPE_FLOAT,"range",at,(()=>1))]),(0,Q.f)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new St(d.c.ANIMATIONTYPE_FLOAT,"innerAngle",Wt,(()=>1))]),(0,Q.f)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new St(d.c.ANIMATIONTYPE_FLOAT,"angle",Wt,(()=>1))]),(0,Q.f)("/nodes/{}/extensions/EXT_lights_ies/color",[new St(d.c.ANIMATIONTYPE_COLOR3,"diffuse",ct,(()=>3))]),(0,Q.f)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new St(d.c.ANIMATIONTYPE_FLOAT,"intensity",at,(()=>1))]);const st="KHR_animation_pointer";class jt{constructor(E){this.name=st,this._loader=E,this._pathToObjectConverter=(0,Q.e)(this._loader.zp)}get enabled(){return this._loader.isExtensionUsed(st)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(E,t,z,A,X){var R;const u=null===(R=A.target.extensions)||void 0===R?void 0:R.KHR_animation_pointer;if(!u||!this._pathToObjectConverter)return null;"pointer"!==A.target.path&&c.d.Warn(`${E}/target/path: Value (${A.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=A.target.node&&c.d.Warn(`${E}/target/node: Value (${A.target.node}) must not be present when using the ${this.name} extension`);const p=`${E}/extensions/${this.name}`,C=u.pointer;if(!C)throw new Error(`${p}: Pointer is missing`);try{const R=this._pathToObjectConverter.convert(C);if(!R.info.interpolation)throw new Error(`${p}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(E,t,z,A,{object:R.object,info:R.info.interpolation},X)}catch(Z){return c.d.Warn(`${p}/pointer: Invalid pointer (${C}) skipped`),null}}}o(st),g(st,!0,(E=>new jt(E)));class Ut{constructor(E,t,z){this.frame=E,this.action=t,this.onlyOnce=z,this.isDone=!1}_clone(){return new Ut(this.frame,this.action,this.onlyOnce)}}var kt=z(11657),vt=z(11712),Yt=z(11707);class Gt{get loop(){return this._loop}set loop(E){E!==this._loop&&(this._loop=E,this.updateOptions({loop:E}))}get currentTime(){var E;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(E=vt.b.audioEngine)&&void 0!==E&&E.audioContext&&(this.isPlaying||this.isPaused)){const E=this.isPaused?0:vt.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+E}return 0}get spatialSound(){return this._spatialSound}set spatialSound(E){if(E==this._spatialSound)return;const t=this.isPlaying;this.pause(),E?(this._spatialSound=E,this._updateSpatialParameters()):this._disableSpatialSound(),t&&this.play()}constructor(E,t,z){var A;let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new H.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=X.Lt.Zero(),this._localDirection=new X.Lt(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=E,z=z||O.d.LastCreatedScene)if(this._scene=z,Gt._SceneComponentInitialization(z),this._readyToPlayCallback=R,this._customAttenuationFunction=(E,t,z,A,X)=>t<z?E*(1-t/z):0,p&&(this.autoplay=p.autoplay||!1,this._loop=p.loop||!1,void 0!==p.volume&&(this._volume=p.volume),this._spatialSound=p.spatialSound??!1,this.maxDistance=p.maxDistance??100,this.useCustomAttenuation=p.useCustomAttenuation??!1,this.rolloffFactor=p.rolloffFactor||1,this.refDistance=p.refDistance||1,this.distanceModel=p.distanceModel||"linear",this._playbackRate=p.playbackRate||1,this._streaming=p.streaming??!1,this._length=p.length,this._offset=p.offset),null!==(A=vt.b.audioEngine)&&void 0!==A&&A.canUseWebAudio&&vt.b.audioEngine.audioContext){this._soundGain=vt.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let E=!0;if(t)try{"string"===typeof t?(this._urlType="String",this._url=t):t instanceof ArrayBuffer?this._urlType="ArrayBuffer":t instanceof HTMLMediaElement?this._urlType="MediaElement":t instanceof MediaStream?this._urlType="MediaStream":t instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(t)&&(this._urlType="Array");let z=[],A=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=vt.b.audioEngine.audioContext.createMediaElementSource(t),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=vt.b.audioEngine.audioContext.createMediaStreamSource(t),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":t.byteLength>0&&(A=!0,this._soundLoaded(t));break;case"AudioBuffer":this._audioBufferLoaded(t);break;case"String":z.push(t);case"Array":0===z.length&&(z=t);for(let E=0;E<z.length;E++){const t=z[E];if(A=p&&p.skipCodecCheck||-1!==t.indexOf(".mp3",t.length-4)&&vt.b.audioEngine.isMP3supported||-1!==t.indexOf(".ogg",t.length-4)&&vt.b.audioEngine.isOGGsupported||-1!==t.indexOf(".wav",t.length-4)||-1!==t.indexOf(".m4a",t.length-4)||-1!==t.indexOf(".mp4",t.length-4)||-1!==t.indexOf("blob:"),A){this._streaming?(this._htmlAudioElement=new Audio(t),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,u.Tools.SetCorsBehavior(t,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(t,(E=>{this._soundLoaded(E)}),void 0,!0,!0,(E=>{E&&c.d.Error("XHR "+E.status+" error on: "+t+"."),c.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:E=!1}E?A||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):c.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(C){c.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),vt.b.audioEngine&&!vt.b.audioEngine.WarnedWebAudioUnsupported&&(c.d.Error("Web Audio is not supported by your browser."),vt.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var E;null!==(E=vt.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(E){var t;null!==(t=vt.b.audioEngine)&&void 0!==t&&t.audioContext&&(this._audioBuffer=E,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(E){var t;null!==(t=vt.b.audioEngine)&&void 0!==t&&t.audioContext&&vt.b.audioEngine.audioContext.decodeAudioData(E,(E=>{this._audioBufferLoaded(E)}),(E=>{c.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+E)}))}setAudioBuffer(E){var t;null!==(t=vt.b.audioEngine)&&void 0!==t&&t.canUseWebAudio&&(this._audioBuffer=E,this._isReadyToPlay=!0)}updateOptions(E){E&&(this.loop=E.loop??this.loop,this.maxDistance=E.maxDistance??this.maxDistance,this.useCustomAttenuation=E.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=E.rolloffFactor??this.rolloffFactor,this.refDistance=E.refDistance??this.refDistance,this.distanceModel=E.distanceModel??this.distanceModel,this._playbackRate=E.playbackRate??this._playbackRate,this._length=E.length??void 0,this.spatialSound=E.spatialSound??this._spatialSound,this._setOffset(E.offset??void 0),this.setVolume(E.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var E;null!==(E=vt.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&vt.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??vt.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var E;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(E=this._soundPanner)||void 0===E||E.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var E;null!==(E=vt.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(E){var t;null!==(t=vt.b.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(E),this._isOutputConnected=!0)}setDirectionalCone(E,t,z){t<E?c.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=E,this._coneOuterAngle=t,this._coneOuterGain=z,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(E){if(E!=this._coneInnerAngle){var t;if(this._coneOuterAngle<E)return void c.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=E,null!==(t=vt.b.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(E){if(E!=this._coneOuterAngle){var t;if(E<this._coneInnerAngle)return void c.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=E,null!==(t=vt.b.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(E){var t;E.equals(this._position)||(this._position.R(E),null!==(t=vt.b.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(E){var t;this._localDirection=E,null!==(t=vt.b.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const E=this._connectedTransformNode.getWorldMatrix(),t=X.Lt.TransformNormal(this._localDirection,E);t.normalize(),this._soundPanner.orientationX.value=t.x,this._soundPanner.orientationY.value=t.y,this._soundPanner.orientationZ.value=t.z}updateDistanceFromListener(){var E;if(null!==(E=vt.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const E=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Wt(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,E,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(E){this._customAttenuationFunction=E}play(E,t,z){var A;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(A=vt.b.audioEngine)&&void 0!==A&&A.audioContext)try{var X,R;this._clearTimeoutsAndObservers();let A=E?(null===(X=vt.b.audioEngine)||void 0===X?void 0:X.audioContext.currentTime)+E:null===(R=vt.b.audioEngine)||void 0===R?void 0:R.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=vt.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const E=()=>{var z;if(null!==(z=vt.b.audioEngine)&&void 0!==z&&z.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=t??0;const z=this._htmlAudioElement.play();void 0!==z&&z.catch((()=>{var t,z;(null===(t=vt.b.audioEngine)||void 0===t||t.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(z=vt.b.audioEngine)||void 0===z?void 0:z.onAudioUnlockedObservable.addOnce((()=>{E()})))}))}else{var A;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(A=vt.b.audioEngine)||void 0===A?void 0:A.onAudioUnlockedObservable.addOnce((()=>{E()}))}};E()}}else{var u;const X=()=>{var X;if(null!==(X=vt.b.audioEngine)&&void 0!==X&&X.audioContext){var R;if(z=z||this._length,void 0!==t&&this._setOffset(t),this._soundSource){const E=this._soundSource;E.onended=()=>{E.disconnect()}}if(this._soundSource=null===(R=vt.b.audioEngine)||void 0===R?void 0:R.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var u;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==t&&(this._soundSource.loopStart=t),void 0!==z&&(this._soundSource.loopEnd=(0|t)+z),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},A=E?(null===(u=vt.b.audioEngine)||void 0===u?void 0:u.audioContext.currentTime)+E:vt.b.audioEngine.audioContext.currentTime;const X=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(A,X,this.loop?void 0:z)}}};"suspended"===(null===(u=vt.b.audioEngine)||void 0===u?void 0:u.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var E;"suspended"===(null===(E=vt.b.audioEngine)||void 0===E?void 0:E.audioContext.state)?(vt.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=vt.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{X()})))):X()}),500):X()}this._startTime=A,this.isPlaying=!0,this.isPaused=!1}catch(p){c.d.Error("Error while trying to play audio: "+this.name+", "+p.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(E){var t;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var z;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(z=this._streamingSource)||void 0===z||z.disconnect();this.isPlaying=!1}else if(null!==(t=vt.b.audioEngine)&&void 0!==t&&t.audioContext&&this._soundSource){const t=E?vt.b.audioEngine.audioContext.currentTime+E:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(t)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var E;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var t;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(t=this._streamingSource)||void 0===t||t.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(E=vt.b.audioEngine)&&void 0!==E&&E.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=vt.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(E,t){var z;null!==(z=vt.b.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._soundGain&&(t&&vt.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(vt.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,vt.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(E,vt.b.audioEngine.audioContext.currentTime+t)):this._soundGain.gain.value=E),this._volume=E}setPlaybackRate(E){this._playbackRate=E,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(E){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=E,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=E=>this._onRegisterAfterWorldMatrixUpdate(E),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(E){var t;if(E.getBoundingInfo){const t=E.getBoundingInfo();this.setPosition(t.boundingSphere.centerWorld)}else this.setPosition(E.absolutePosition);null!==(t=vt.b.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const E=()=>{(0,Yt.e)((()=>this._isReadyToPlay),(()=>{z._audioBuffer=this.getAudioBuffer(),z._isReadyToPlay=!0,z.autoplay&&z.play(0,this._offset,this._length)}),void 0,300)},t={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},z=new Gt(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,t);return this.useCustomAttenuation&&z.setAttenuationFunction(this._customAttenuationFunction),z.setPosition(this._position),z.setPlaybackRate(this._playbackRate),E(),z}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const E={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(E.connectedMeshId=this._connectedTransformNode.id),E.position=this._position.upE(),E.refDistance=this.refDistance,E.distanceModel=this.distanceModel,E.isDirectional=this._isDirectional,E.localDirectionToMesh=this._localDirection.upE(),E.coneInnerAngle=this._coneInnerAngle,E.coneOuterAngle=this._coneOuterAngle,E.coneOuterGain=this._coneOuterGain),E}static Parse(E,t,z,A){const R=E.name;let u;u=E.url?z+E.url:z+R;const p={autoplay:E.autoplay,loop:E.loop,volume:E.volume,spatialSound:E.spatialSound,maxDistance:E.maxDistance,rolloffFactor:E.rolloffFactor,refDistance:E.refDistance,distanceModel:E.distanceModel,playbackRate:E.playbackRate};let C;if(A){const E=()=>{(0,Yt.e)((()=>A._isReadyToPlay),(()=>{C._audioBuffer=A.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,C._offset,C._length)}),void 0,300)};C=new Gt(R,new ArrayBuffer(0),t,null,p),E()}else C=new Gt(R,u,t,(()=>{t.removePendingData(C)}),p),t.addPendingData(C);if(E.position){const t=X.Lt.St(E.position);C.setPosition(t)}if(E.isDirectional&&(C.setDirectionalCone(E.coneInnerAngle||360,E.coneOuterAngle||360,E.coneOuterGain||0),E.localDirectionToMesh)){const t=X.Lt.St(E.localDirectionToMesh);C.setLocalDirectionToMesh(t)}if(E.connectedMeshId){const z=t.getMeshById(E.connectedMeshId);z&&C.attachToMesh(z)}return E.metadata&&(C.metadata=E.metadata),C}_setOffset(E){this._offset!==E&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=E)}_clearTimeoutsAndObservers(){var E;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(E=vt.b.audioEngine)||void 0===E||E.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Gt._SceneComponentInitialization=E=>{throw(0,kt.b)("AudioSceneComponent")},(0,DE.f)("BABYLON.Sound",Gt);class Nt{constructor(E,t,z){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],t.length!==z.length)throw new Error("Sounds length does not equal weights length");this.loop=E,this._weights=z;let A=0;for(const R of z)A+=R;const X=A>0?1/A:0;for(let R=0;R<this._weights.length;R++)this._weights[R]*=X;this._sounds=t;for(const R of this._sounds)R.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(E){if(E!==this._coneInnerAngle){if(this._coneOuterAngle<E)return void c.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=E;for(const t of this._sounds)t.directionalConeInnerAngle=E}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(E){if(E!==this._coneOuterAngle){if(E<this._coneInnerAngle)return void c.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=E;for(const t of this._sounds)t.directionalConeOuterAngle=E}}get volume(){return this._volume}set volume(E){if(E!==this._volume)for(const t of this._sounds)t.setVolume(E)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(E){if(!this.isPaused){this.stop();const E=Math.random();let t=0;for(let z=0;z<this._weights.length;z++)if(t+=this._weights[z],E<=t){this._currentIndex=z;break}}const t=this._sounds[this._currentIndex??0];t.isReady()?t.play(0,this.isPaused?void 0:E):t.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Pt{constructor(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(E=E||O.d.LastCreatedScene)&&(this._scene=E,this.soundCollection=[],this._options=t,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var E;null!==(E=vt.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&vt.b.audioEngine.audioContext&&(this._outputAudioNode=vt.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(vt.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(vt.b.audioEngine&&vt.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(E){var t;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(t=vt.b.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._outputAudioNode&&E.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==E.soundTrackId&&(-1===E.soundTrackId?this._scene.mainSoundTrack.removeSound(E):this._scene.soundTracks&&this._scene.soundTracks[E.soundTrackId].removeSound(E)),this.soundCollection.push(E),E.soundTrackId=this.id}removeSound(E){const t=this.soundCollection.indexOf(E);-1!==t&&this.soundCollection.splice(t,1)}setVolume(E){var t;null!==(t=vt.b.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=E)}switchPanningModelToHRTF(){var E;if(null!==(E=vt.b.audioEngine)&&void 0!==E&&E.canUseWebAudio)for(let t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var E;if(null!==(E=vt.b.audioEngine)&&void 0!==E&&E.canUseWebAudio)for(let t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()}connectToAnalyser(E){var t;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=E,null!==(t=vt.b.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,vt.b.audioEngine.masterGain))}}var Ez=z(12085),tz=z(12051),zz=z(11634);vt.b.AudioEngineFactory=(E,t,z)=>new Az(E,t,z);class Az{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new H.b,this.onAudioLockedObservable=new H.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,zz.m)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const A=document.createElement("audio");this._hostElement=E,this._audioContext=t,this._audioDestination=z;try{A&&A.canPlayType&&(A.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||A.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(X){}try{A&&A.canPlayType&&A.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(X){}}lock(){this._triggerSuspendedState()}unlock(){var E,t;if("running"===(null===(E=this._audioContext)||void 0===E?void 0:E.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(t=this._audioContext)||void 0===t||t.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{c.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var E;null===(E=this._audioContext)||void 0===E||E.addEventListener("statechange",(()=>{var E;this.unlocked&&"running"!==(null===(E=this._audioContext)||void 0===E?void 0:E.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var E;return null!==(E=this._audioContext)&&void 0!==E&&E.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(E){this.canUseWebAudio=!1,c.d.Error("Web Audio: "+E.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(E){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const E=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",t=document.createElement("style");t.appendChild(document.createTextNode(E)),document.getElementsByTagName("head")[0].appendChild(t),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var E;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(E=this._audioContext)||void 0===E||E.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(E){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=E)}connectToAnalyser(E){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=E,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Xz=z(11649);(0,z(13154).d)(Ez.c.NAME_AUDIO,((E,t,z,A)=>{let X,R=[];if(z.ey=z.ey||[],void 0!==E.ey&&null!==E.ey)for(let p=0,C=E.ey.length;p<C;p++){var u;const C=E.ey[p];null!==(u=vt.b.audioEngine)&&void 0!==u&&u.canUseWebAudio?(C.url||(C.url=C.name),R[C.url]?z.ey.push(Gt.Parse(C,t,A,R[C.url])):(X=Gt.Parse(C,t,A),R[C.url]=X,z.ey.push(X))):z.ey.push(new Gt(C.name,null,t))}R=[]})),Object.defineProperty(tz.c.prototype,"mainSoundTrack",{get:function(){let E=this._getComponent(Ez.c.NAME_AUDIO);return E||(E=new Rz(this),this.o(E)),this._mainSoundTrack||(this._mainSoundTrack=new Pt(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),tz.c.prototype.getSoundByName=function(E){let t;for(t=0;t<this.mainSoundTrack.soundCollection.length;t++)if(this.mainSoundTrack.soundCollection[t].name===E)return this.mainSoundTrack.soundCollection[t];if(this.soundTracks)for(let z=0;z<this.soundTracks.length;z++)for(t=0;t<this.soundTracks[z].soundCollection.length;t++)if(this.soundTracks[z].soundCollection[t].name===E)return this.soundTracks[z].soundCollection[t];return null},Object.defineProperty(tz.c.prototype,"audioEnabled",{get:function(){let E=this._getComponent(Ez.c.NAME_AUDIO);return E||(E=new Rz(this),this.o(E)),E.audioEnabled},set:function(E){let t=this._getComponent(Ez.c.NAME_AUDIO);t||(t=new Rz(this),this.o(t)),E?t.enableAudio():t.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(tz.c.prototype,"headphone",{get:function(){let E=this._getComponent(Ez.c.NAME_AUDIO);return E||(E=new Rz(this),this.o(E)),E.headphone},set:function(E){let t=this._getComponent(Ez.c.NAME_AUDIO);t||(t=new Rz(this),this.o(t)),E?t.switchAudioModeForHeadphones():t.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(tz.c.prototype,"audioListenerPositionProvider",{get:function(){let E=this._getComponent(Ez.c.NAME_AUDIO);return E||(E=new Rz(this),this.o(E)),E.audioListenerPositionProvider},set:function(E){let t=this._getComponent(Ez.c.NAME_AUDIO);if(t||(t=new Rz(this),this.o(t)),E&&"function"!==typeof E)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");t.audioListenerPositionProvider=E},enumerable:!0,configurable:!0}),Object.defineProperty(tz.c.prototype,"audioListenerRotationProvider",{get:function(){let E=this._getComponent(Ez.c.NAME_AUDIO);return E||(E=new Rz(this),this.o(E)),E.audioListenerRotationProvider},set:function(E){let t=this._getComponent(Ez.c.NAME_AUDIO);if(t||(t=new Rz(this),this.o(t)),E&&"function"!==typeof E)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");t.audioListenerRotationProvider=E},enumerable:!0,configurable:!0}),Object.defineProperty(tz.c.prototype,"audioPositioningRefreshRate",{get:function(){let E=this._getComponent(Ez.c.NAME_AUDIO);return E||(E=new Rz(this),this.o(E)),E.audioPositioningRefreshRate},set:function(E){let t=this._getComponent(Ez.c.NAME_AUDIO);t||(t=new Rz(this),this.o(t)),t.audioPositioningRefreshRate=E},enumerable:!0,configurable:!0});class Rz{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(E){this.name=Ez.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new X.Lt,this._cachedCameraPosition=new X.Lt,this._lastCheck=0,this._invertMatrixTemp=new X.Matrix,this._cameraDirectionTemp=new X.Lt,(E=E||O.d.LastCreatedScene)&&(this.It=E,E.soundTracks=[],E.ey=[])}register(){this.It._afterRenderStage.registerStep(Ez.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(E){if(E.ey=[],this.It.soundTracks)for(let t=0;t<this.It.soundTracks.length;t++){const z=this.It.soundTracks[t];for(let t=0;t<z.soundCollection.length;t++)E.ey.push(z.soundCollection[t].serialize())}}addFromContainer(E){if(E.ey)for(const t of E.ey)t.play(),t.autoplay=!0,this.It.mainSoundTrack.addSound(t)}removeFromContainer(E){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(E.ey)for(const z of E.ey)z.stop(),z.autoplay=!1,this.It.mainSoundTrack.removeSound(z),t&&z.dispose()}dispose(){const E=this.It;if(E._mainSoundTrack&&E.mainSoundTrack.dispose(),E.soundTracks)for(let t=0;t<E.soundTracks.length;t++)E.soundTracks[t].dispose()}disableAudio(){const E=this.It;let t;for(this._audioEnabled=!1,vt.b.audioEngine&&vt.b.audioEngine.audioContext&&vt.b.audioEngine.audioContext.suspend(),t=0;t<E.mainSoundTrack.soundCollection.length;t++)E.mainSoundTrack.soundCollection[t].pause();if(E.soundTracks)for(t=0;t<E.soundTracks.length;t++)for(let z=0;z<E.soundTracks[t].soundCollection.length;z++)E.soundTracks[t].soundCollection[z].pause()}enableAudio(){const E=this.It;let t;for(this._audioEnabled=!0,vt.b.audioEngine&&vt.b.audioEngine.audioContext&&vt.b.audioEngine.audioContext.resume(),t=0;t<E.mainSoundTrack.soundCollection.length;t++)E.mainSoundTrack.soundCollection[t].isPaused&&E.mainSoundTrack.soundCollection[t].play();if(E.soundTracks)for(t=0;t<E.soundTracks.length;t++)for(let z=0;z<E.soundTracks[t].soundCollection.length;z++)E.soundTracks[t].soundCollection[z].isPaused&&E.soundTracks[t].soundCollection[z].play()}switchAudioModeForHeadphones(){const E=this.It;if(this._headphone=!0,E.mainSoundTrack.switchPanningModelToHRTF(),E.soundTracks)for(let t=0;t<E.soundTracks.length;t++)E.soundTracks[t].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const E=this.It;if(this._headphone=!1,E.mainSoundTrack.switchPanningModelToEqualPower(),E.soundTracks)for(let t=0;t<E.soundTracks.length;t++)E.soundTracks[t].switchPanningModelToEqualPower()}_afterRender(){const E=Xz.c.Now;if(this._lastCheck&&E-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=E;const t=this.It;if(!this._audioEnabled||!t._mainSoundTrack||!t.soundTracks||0===t._mainSoundTrack.soundCollection.length&&1===t.soundTracks.length)return;const z=vt.b.audioEngine;if(z&&z.audioContext){let E,A=t.activeCamera;if(t.activeCameras&&t.activeCameras.length>0&&(A=t.activeCameras[0]),this.audioListenerPositionProvider){const E=this.audioListenerPositionProvider();z.audioContext.listener.setPosition(E.x||0,E.y||0,E.z||0)}else A?this._cachedCameraPosition.equals(A.globalPosition)||(this._cachedCameraPosition.R(A.globalPosition),z.audioContext.listener.setPosition(A.globalPosition.x,A.globalPosition.y,A.globalPosition.z)):z.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const E=this.audioListenerRotationProvider();z.audioContext.listener.setOrientation(E.x||0,E.y||0,E.z||0,0,1,0)}else A?(A.rigCameras&&A.rigCameras.length>0&&(A=A.rigCameras[0]),A.getViewMatrix().invertToRef(this._invertMatrixTemp),X.Lt.TransformNormalToRef(Rz._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.R(this._cameraDirectionTemp),z.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):z.audioContext.listener.setOrientation(0,0,0,0,1,0);for(E=0;E<t.mainSoundTrack.soundCollection.length;E++){const z=t.mainSoundTrack.soundCollection[E];z.useCustomAttenuation&&z.updateDistanceFromListener()}if(t.soundTracks)for(E=0;E<t.soundTracks.length;E++)for(let z=0;z<t.soundTracks[E].soundCollection.length;z++){const A=t.soundTracks[E].soundCollection[z];A.useCustomAttenuation&&A.updateDistanceFromListener()}}}}Rz._CameraDirection=new X.Lt(0,0,-1),Gt._SceneComponentInitialization=E=>{let t=E._getComponent(Ez.c.NAME_AUDIO);t||(t=new Rz(E),E.o(t))};const uz="MSFT_audio_emitter";class pz{constructor(E){this.name=uz,this._loader=E,this.enabled=this._loader.isExtensionUsed(uz)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const E=this._loader.zp.extensions;if(E&&E[this.name]){const t=E[this.name];this._clips=t.clips,this._emitters=t.emitters,M.Assign(this._clips),M.Assign(this._emitters)}}loadSceneAsync(E,t){return n.LoadExtensionAsync(E,t,this.name,(async(z,A)=>{const X=new Array;X.push(this._loader.loadSceneAsync(E,t));for(const E of A.emitters){const t=M.Get(`${z}/emitters`,this._emitters,E);if(void 0!=t.refDistance||void 0!=t.maxDistance||void 0!=t.rolloffFactor||void 0!=t.distanceModel||void 0!=t.innerAngle||void 0!=t.outerAngle)throw new Error(`${z}: Direction or Distance properties are not allowed on emitters attached to a scene`);X.push(this._loadEmitterAsync(`${z}/emitters/${t.index}`,t))}await Promise.all(X)}))}loadNodeAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(E,A)=>{const R=new Array,p=await this._loader.loadNodeAsync(E,t,(t=>{for(const z of A.emitters){const A=M.Get(`${E}/emitters`,this._emitters,z);R.push(this._loadEmitterAsync(`${E}/emitters/${A.index}`,A).then((()=>{for(const E of A._babylonSounds)E.attachToMesh(t),void 0==A.innerAngle&&void 0==A.outerAngle||(E.setLocalDirectionToMesh(X.Lt.Forward()),E.setDirectionalCone(2*u.Tools.ToDegrees(void 0==A.innerAngle?Math.PI:A.innerAngle),2*u.Tools.ToDegrees(void 0==A.outerAngle?Math.PI:A.outerAngle),0))})))}z(t)}));return await Promise.all(R),p}))}loadAnimationAsync(E,t){return n.LoadExtensionAsync(E,t,this.name,(async(z,A)=>{const X=await this._loader.loadAnimationAsync(E,t),R=new Array;M.Assign(A.events);for(const u of A.events)R.push(this._loadAnimationEventAsync(`${z}/events/${u.index}`,E,t,u,X));return await Promise.all(R),X}))}_loadClipAsync(E,t){if(t._objectURL)return t._objectURL;let z;if(t.uri)z=this._loader.loadUriAsync(E,t,t.uri);else{const A=M.Get(`${E}/bufferView`,this._loader.zp.bufferViews,t.bufferView);z=this._loader.loadBufferViewAsync(`/bufferViews/${A.index}`,A)}return t._objectURL=z.then((E=>URL.createObjectURL(new Blob([E],{type:t.mimeType})))),t._objectURL}_loadEmitterAsync(E,t){if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){const E=new Array,z=t.name||`emitter${t.index}`,A={loop:!1,autoplay:!1,volume:void 0==t.volume?1:t.volume};for(let R=0;R<t.clips.length;R++){const X=`/extensions/${this.name}/clips`,u=M.Get(X,this._clips,t.clips[R].clip);E.push(this._loadClipAsync(`${X}/${t.clips[R].clip}`,u).then((E=>{const X=t._babylonSounds[R]=new Gt(z,E,this._loader.babylonScene,null,A);X.refDistance=t.refDistance||1,X.maxDistance=t.maxDistance||256,X.rolloffFactor=t.rolloffFactor||1,X.distanceModel=t.distanceModel||"exponential"})))}const X=Promise.all(E).then((()=>{const E=t.clips.map((E=>E.weight||1)),z=new Nt(t.loop||!1,t._babylonSounds,E);t.innerAngle&&(z.directionalConeInnerAngle=2*u.Tools.ToDegrees(t.innerAngle)),t.outerAngle&&(z.directionalConeOuterAngle=2*u.Tools.ToDegrees(t.outerAngle)),t.volume&&(z.volume=t.volume),t._babylonData.sound=z}));t._babylonData={loaded:X}}return t._babylonData.loaded}_getEventAction(E,t,z,A,X){switch(z){case"play":return E=>{const z=(X||0)+(E-A);t.play(z)};case"stop":return()=>{t.stop()};case"pause":return()=>{t.pause()};default:throw new Error(`${E}: Unsupported action ${z}`)}}_loadAnimationEventAsync(E,t,z,A,X){if(0==X.targetedAnimations.length)return Promise.resolve();const R=X.targetedAnimations[0],u=A.Xt,p=M.Get(`/extensions/${this.name}/emitters`,this._emitters,u);return this._loadEmitterAsync(E,p).then((()=>{const t=p._babylonData.sound;if(t){const z=new Ut(A.time,this._getEventAction(E,t,A.action,A.time,A.startOffset));R.animation.addEvent(z),X.onAnimationGroupEndObservable.add((()=>{t.stop()})),X.onAnimationGroupPauseObservable.add((()=>{t.pause()}))}}))}}o(uz),g(uz,!0,(E=>new pz(E)));const Cz="MSFT_lod";class Zz{constructor(E){var t;this.name=Cz,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new H.b,this.onMaterialLODsLoadedObservable=new H.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=E,this.maxLODsToLoad=(null===(t=this._loader.parent.extensionOptions[Cz])||void 0===t?void 0:t.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Cz)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let E=0;E<this._nodePromiseLODs.length;E++){const t=Promise.all(this._nodePromiseLODs[E]).then((()=>{0!==E&&(this._loader.endPerformanceCounter(`Node LOD ${E}`),this._loader.log(`Loaded node LOD ${E}`)),this.onNodeLODsLoadedObservable.notifyObservers(E),E!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${E+1}`),this._loadBufferLOD(this._nodeBufferLODs,E+1),this._nodeSignalLODs[E]&&this._nodeSignalLODs[E].resolve())}));this._loader._completePromises.push(t)}for(let E=0;E<this._materialPromiseLODs.length;E++){const t=Promise.all(this._materialPromiseLODs[E]).then((()=>{0!==E&&(this._loader.endPerformanceCounter(`Material LOD ${E}`),this._loader.log(`Loaded material LOD ${E}`)),this.onMaterialLODsLoadedObservable.notifyObservers(E),E!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${E+1}`),this._loadBufferLOD(this._materialBufferLODs,E+1),this._materialSignalLODs[E]&&this._materialSignalLODs[E].resolve())}));this._loader._completePromises.push(t)}}loadSceneAsync(E,t){const z=this._loader.loadSceneAsync(E,t);return this._loadBufferLOD(this._bufferLODs,0),z}loadNodeAsync(E,t,z){return n.LoadExtensionAsync(E,t,this.name,(async(E,X)=>{let R;const u=this._getLODs(E,t,this._loader.zp.nodes,X.ids);this._loader.logOpen(`${E}`);for(let t=0;t<u.length;t++){const E=u[t];0!==t&&(this._nodeIndexLOD=t,this._nodeSignalLODs[t]=this._nodeSignalLODs[t]||new A);const X=E=>{z(E),E.Tp(!1)},p=this._loader.loadNodeAsync(`/nodes/${E.index}`,E,X).then((E=>{if(0!==t){const E=u[t-1];E._babylonTransformNode&&(this._disposeTransformNode(E._babylonTransformNode),delete E._babylonTransformNode)}return E.Tp(!0),E}));this._nodePromiseLODs[t]=this._nodePromiseLODs[t]||[],0===t?R=p:(this._nodeIndexLOD=null,this._nodePromiseLODs[t].push(p))}return this._loader.logClose(),await R}))}_loadMaterialAsync(E,t,z,A,X){return this._nodeIndexLOD?null:n.LoadExtensionAsync(E,t,this.name,(async(E,R)=>{let u;const p=this._getLODs(E,t,this._loader.zp.materials,R.ids);this._loader.logOpen(`${E}`);for(let t=0;t<p.length;t++){const E=p[t];0!==t&&(this._materialIndexLOD=t);const R=this._loader._loadMaterialAsync(`/materials/${E.index}`,E,z,A,(E=>{0===t&&X(E)})).then((E=>{if(0!==t){X(E);const z=p[t-1]._data;z[A]&&(this._disposeMaterials([z[A].babylonMaterial]),delete z[A])}return E}));this._materialPromiseLODs[t]=this._materialPromiseLODs[t]||[],0===t?u=R:(this._materialIndexLOD=null,this._materialPromiseLODs[t].push(R))}return this._loader.logClose(),await u}))}_loadUriAsync(E,t,z){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const X=this._nodeIndexLOD-1;return this._nodeSignalLODs[X]=this._nodeSignalLODs[X]||new A,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(E,t,z)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const X=this._materialIndexLOD-1;return this._materialSignalLODs[X]=this._materialSignalLODs[X]||new A,this._materialSignalLODs[X].promise.then((async()=>await this._loader.loadUriAsync(E,t,z)))}return null}loadBufferAsync(E,t,z,X){if(this._loader.parent.useRangeRequests&&!t.uri){if(!this._loader.bin)throw new Error(`${E}: Uri is missing or the binary glTF is missing its binary chunk`);const t=async(E,t)=>{const R=z,u=R+X-1;let p=E[t];return p?(p.start=Math.min(p.start,R),p.end=Math.max(p.end,u)):(p={start:R,end:u,loaded:new A},E[t]=p),await p.loaded.promise.then((E=>new Uint8Array(E.buffer,E.byteOffset+z-p.start,X)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?t(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?t(this._materialBufferLODs,this._materialIndexLOD):t(this._bufferLODs,0)}return null}_loadBufferLOD(E,t){const z=E[t];z&&(this._loader.log(`Loading buffer range [${z.start}-${z.end}]`),this._loader.bin.readAsync(z.start,z.end-z.start+1).then((E=>{z.loaded.resolve(E)}),(E=>{z.loaded.reject(E)})))}_getLODs(E,t,z,A){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const X=[];for(let R=A.length-1;R>=0;R--)if(X.push(M.Get(`${E}/ids/${A[R]}`,z,A[R])),X.length===this.maxLODsToLoad)return X;return X.push(t),X}_disposeTransformNode(E){const t=[],z=E.material;z&&t.push(z);for(const X of E.getChildMeshes())X.material&&t.push(X.material);E.dispose();const A=t.filter((E=>this._loader.babylonScene.meshes.every((t=>t.material!=E))));this._disposeMaterials(A)}_disposeMaterials(E){const t={};for(const z of E){for(const E of z.getActiveTextures())t[E.uniqueId]=E;z.dispose()}for(const z in t)for(const E of this._loader.babylonScene.materials)E.hasTexture(t[z])&&delete t[z];for(const z in t)t[z].dispose()}}o(Cz),g(Cz,!0,(E=>new Zz(E)));const Hz="MSFT_minecraftMesh";class hz{constructor(E){this.name=Hz,this._loader=E,this.enabled=this._loader.isExtensionUsed(Hz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtraAsync(E,t,this.name,(async(A,X)=>{if(X){if(!(z instanceof W.b))throw new Error(`${A}: Material type not supported`);const X=this._loader.loadMaterialPropertiesAsync(E,t,z);return z.needAlphaBlending()&&(z.forceDepthWrite=!0,z.separateCullingPass=!0),z.yp=z.forceDepthWrite,z.twoSidedLighting=!0,await X}}))}}o(Hz),g(Hz,!0,(E=>new hz(E)));const dz="MSFT_sRGBFactors";class yz{constructor(E){this.name=dz,this._loader=E,this.enabled=this._loader.isExtensionUsed(dz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,t,z){return n.LoadExtraAsync(E,t,this.name,(async(A,X)=>{if(X){if(!(z instanceof W.b))throw new Error(`${A}: Material type not supported`);const X=this._loader.loadMaterialPropertiesAsync(E,t,z),R=z.lE().getEngine().useExactSrgbConversions;return z.albedoTexture||z.albedoColor.toLinearSpaceToRef(z.albedoColor,R),z.reflectivityTexture||z.reflectivityColor.toLinearSpaceToRef(z.reflectivityColor,R),await X}}))}}o(dz),g(dz,!0,(E=>new yz(E)));var Oz=z(13450);const cz={};var az=z(13503),Lz=z(13476),mA=z(13453),Wz=z(13458);function Iz(E,t){for(const z of E)for(const E of z.dataOutputs)if(E.uniqueId===t)return E;throw new Error("Could not find data out connection with unique id "+t)}function ez(E,t){for(const z of E)if(z instanceof Lz.b)for(const E of z.signalInputs)if(E.uniqueId===t)return E;throw new Error("Could not find signal in connection with unique id "+t)}async function Dz(E,t){const A=await Promise.all(E.allBlocks.map((async E=>{const t=function(E){switch(E){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([z.e(78),z.e(79)]).then(z.bind(z,14911))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await z.e(80).then(z.bind(z,14917))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await z.e(81).then(z.bind(z,14923))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await z.e(82).then(z.bind(z,14932))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await z.e(83).then(z.bind(z,14934))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await z.e(84).then(z.bind(z,14942))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await z.e(85).then(z.bind(z,14946))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await z.e(86).then(z.bind(z,14953))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await z.e(87).then(z.bind(z,14961))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await z.e(89).then(z.bind(z,14988))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await z.e(89).then(z.bind(z,14988))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await z.e(89).then(z.bind(z,14988))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await z.e(89).then(z.bind(z,14988))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await z.e(89).then(z.bind(z,14988))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await z.e(89).then(z.bind(z,14988))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await z.e(90).then(z.bind(z,14996))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await z.e(90).then(z.bind(z,14996))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await z.e(90).then(z.bind(z,14996))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await z.e(90).then(z.bind(z,14996))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await z.e(95).then(z.bind(z,14999))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await z.e(96).then(z.bind(z,15003))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await z.e(97).then(z.bind(z,15007))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await z.e(98).then(z.bind(z,15014))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await z.e(99).then(z.bind(z,15023))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await z.e(100).then(z.bind(z,15031))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await z.e(101).then(z.bind(z,15040))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await z.e(102).then(z.bind(z,15045))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await z.e(103).then(z.bind(z,15052))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await z.e(104).then(z.bind(z,15061))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await z.e(105).then(z.bind(z,15066))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await z.e(106).then(z.bind(z,15072))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await z.e(107).then(z.bind(z,15079))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await z.e(108).then(z.bind(z,15085))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await z.e(109).then(z.bind(z,15088))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await z.e(110).then(z.bind(z,15092))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await z.e(111).then(z.bind(z,15094))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await z.e(112).then(z.bind(z,15103))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await z.e(113).then(z.bind(z,15105))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await z.e(92).then(z.bind(z,15107))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await z.e(114).then(z.bind(z,15109))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await z.e(115).then(z.bind(z,15113))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await z.e(116).then(z.bind(z,15118))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await z.e(93).then(z.bind(z,15124))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await z.e(88).then(z.bind(z,14966))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await z.e(94).then(z.bind(z,15129))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await z.e(94).then(z.bind(z,15129))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await z.e(94).then(z.bind(z,15129))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await z.e(94).then(z.bind(z,15129))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await z.e(94).then(z.bind(z,15129))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await z.e(94).then(z.bind(z,15129))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await z.e(94).then(z.bind(z,15129))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await z.e(94).then(z.bind(z,15129))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await z.e(89).then(z.bind(z,14988))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await z.e(89).then(z.bind(z,14988))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await z.e(89).then(z.bind(z,14988))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await z.e(89).then(z.bind(z,14988))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await z.e(89).then(z.bind(z,14988))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await z.e(89).then(z.bind(z,14988))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await z.e(89).then(z.bind(z,14988))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await z.e(90).then(z.bind(z,14996))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await z.e(90).then(z.bind(z,14996))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await z.e(91).then(z.bind(z,15133))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await z.e(91).then(z.bind(z,15133))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await z.e(91).then(z.bind(z,15133))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await z.e(91).then(z.bind(z,15133))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await z.e(91).then(z.bind(z,15133))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await z.e(91).then(z.bind(z,15133))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await z.e(117).then(z.bind(z,15137))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await z.e(118).then(z.bind(z,15139))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await z.e(119).then(z.bind(z,15146))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await z.e(120).then(z.bind(z,15151))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await z.e(121).then(z.bind(z,15154))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await z.e(122).then(z.bind(z,15161))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await z.e(123).then(z.bind(z,15164))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await z.e(124).then(z.bind(z,15171))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await z.e(125).then(z.bind(z,15173))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await z.e(126).then(z.bind(z,15179))).FlowGraphDataSwitchBlock;default:if(cz[E])return cz[E];throw new Error(`Unknown block name ${E}`)}}(E.className);return await t()})));return function(E,t,z){const A=t.coordinator.createGraph(),X=[],R=t.valueParseFunction??mA.b;for(let u=0;u<E.allBlocks.length;u++){const p=lz(E.allBlocks[u],{It:t.coordinator.config.It,pathConverter:t.pathConverter,assetsContainer:t.coordinator.config.It,valueParseFunction:R},z[u]);X.push(p),p instanceof az.e&&A.addEventBlock(p)}for(const u of X){for(const E of u.dataInputs)for(const t of E.connectedPointIds){const z=Iz(X,t);E.connectTo(z)}if(u instanceof Lz.b)for(const E of u.signalOutputs)for(const t of E.connectedPointIds){const z=ez(X,t);E.connectTo(z)}}for(const u of E.executionContexts)Sz(u,{graph:A,valueParseFunction:R},E.rightHanded);return A}(E,t,A)}function Sz(E,t,z){const A=t.graph.createContext();E.enableLogging&&(A.enableLogging=!0),A.treatDataAsRightHanded=z||!1;const X=t.valueParseFunction??mA.b;A.uniqueId=E.uniqueId;const R=A.lE();if(E._assetsContext){var u,p,C,Z,H,h,d,y,O,c;const t=E._assetsContext,z={meshes:null===(u=t.meshes)||void 0===u?void 0:u.map((E=>R.getMeshById(E))),lights:null===(p=t.lights)||void 0===p?void 0:p.map((E=>R.getLightByName(E))),cameras:null===(C=t.cameras)||void 0===C?void 0:C.map((E=>R.getCameraByName(E))),materials:null===(Z=t.materials)||void 0===Z?void 0:Z.map((E=>R.getMaterialById(E))),textures:null===(H=t.textures)||void 0===H?void 0:H.map((E=>R.getTextureByName(E))),animations:null===(h=t.animations)||void 0===h?void 0:h.map((E=>R.animations.find((t=>t.name===E)))),skeletons:null===(d=t.skeletons)||void 0===d?void 0:d.map((E=>R.getSkeletonByName(E))),Kd:null===(y=t.Kd)||void 0===y?void 0:y.map((E=>R.getParticleSystemById(E))),animationGroups:null===(O=t.animationGroups)||void 0===O?void 0:O.map((E=>R.getAnimationGroupByName(E))),transformNodes:null===(c=t.transformNodes)||void 0===c?void 0:c.map((E=>R.getTransformNodeById(E))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],ey:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};A.assetsContext=z}for(const a in E._userVariables){const t=X(a,E._userVariables,A.assetsContext,R);A.userVariables[a]=t}for(const a in E._connectionValues){const t=X(a,E._connectionValues,A.assetsContext,R);A._setConnectionValueByKey(a,t)}return A}function lz(E,t,z){const A={},X=t.valueParseFunction??mA.b;if(E.config)for(const u in E.config)A[u]=X(u,E.config,t.assetsContainer||t.It,t.It);if((0,mA.g)(E.className)){if(!t.pathConverter)throw new Error("Path converter is required for this block");A.pathConverter=t.pathConverter}const R=new z(A);R.uniqueId=E.uniqueId;for(let u=0;u<E.dataInputs.length;u++){const t=R.getDataInput(E.dataInputs[u].name);if(!t)throw new Error("Could not find data input with name "+E.dataInputs[u].name+" in block "+E.className);t.deserialize(E.dataInputs[u])}for(let u=0;u<E.dataOutputs.length;u++){const t=R.getDataOutput(E.dataOutputs[u].name);if(!t)throw new Error("Could not find data output with name "+E.dataOutputs[u].name+" in block "+E.className);t.deserialize(E.dataOutputs[u])}return R.metadata=E.metadata,R.deserialize&&R.deserialize(E),R}function fz(E){const[t,z]=E.split(":");return Kz({op:t,extension:z})}function Kz(E){var t;let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=E.extension?null===(t=Bz[E.extension])||void 0===t?void 0:t[E.op]:bz[E.op];if(!A&&(c.d.Warn(`No mapping found for operation ${E.op} and extension ${E.extension||"KHR_interactivity"}`),z)){const t={},z={flows:{}};if(E.inputValueSockets){t.values={};for(const z in E.inputValueSockets)t.values[z]={name:z}}return E.outputValueSockets&&(z.values={},Object.keys(E.outputValueSockets).forEach((E=>{z.values[E]={name:E}}))),{ZH:[],inputs:t,outputs:z}}return A}function Fz(E,t,z){Bz[t]||(Bz[t]={}),Bz[t][E]=z}const Bz={BABYLON:{"flow/log":{ZH:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},bz={"event/onStart":{ZH:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{ZH:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{ZH:["FlowGraphSendCustomEventBlock"],extraProcessor(E,t,z,A,X){if("event/send"!==t.op||!E.configuration||1!==Object.keys(E.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const R=E.configuration.event.value[0];if("number"!==typeof R)throw new Error("Event id should be a number");const u=A.arrays.events[R],p=X[0];return p.config||(p.config={}),p.config.eventId=u.eventId,p.config.eventData=u.eventData,X}},"event/receive":{ZH:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(E,t){var z;if(!E.configuration)return c.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const A=E.configuration.event;if(!A)return c.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const X=A.value[0];if("number"!==typeof X)return c.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(z=t.events)||void 0===z?void 0:z[X])?{valid:!0}:(c.d.Error(`Event with id ${X} not found`),{valid:!1,error:`Event with id ${X} not found`})},extraProcessor(E,t,z,A,X){if("event/receive"!==t.op||!E.configuration||1!==Object.keys(E.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const R=E.configuration.event.value[0];if("number"!==typeof R)throw new Error("Event id should be a number");const u=A.arrays.events[R],p=X[0];return p.config||(p.config={}),p.config.eventId=u.eventId,p.config.eventData=u.eventData,X}},"math/e":xz("FlowGraphEBlock"),"math/pi":xz("FlowGraphPIBlock"),"math/inf":xz("FlowGraphInfBlock"),"math/nan":xz("FlowGraphNaNBlock"),"math/abs":xz("FlowGraphAbsBlock"),"math/sign":xz("FlowGraphSignBlock"),"math/trunc":xz("FlowGraphTruncBlock"),"math/floor":xz("FlowGraphFloorBlock"),"math/ceil":xz("FlowGraphCeilBlock"),"math/round":{ZH:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,t,z,A,X){var R;return(R=X[0]).config||(R.config={}),X[0].config.roundHalfAwayFromZero=!0,X}},"math/fract":xz("FlowGraphFractBlock"),"math/neg":xz("FlowGraphNegationBlock"),"math/add":xz("FlowGraphAddBlock",["a","b"],!0),"math/sub":xz("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{ZH:["FlowGraphMultiplyBlock"],extraProcessor(E,t,z,A,X){var R;(R=X[0]).config||(R.config={}),X[0].config.useMatrixPerComponent=!0,X[0].config.preventIntegerFloatArithmetic=!0;let u=-1;return Object.keys(E.values||{}).find((t=>{var z;return void 0!==(null===(z=E.values)||void 0===z?void 0:z[t].type)&&(u=E.values[t].type,!0)})),-1!==u&&(X[0].config.type=A.arrays.types[u].flowGraphType),X},validation:E=>E.values?Jz(E):{valid:!0}},"math/div":xz("FlowGraphDivideBlock",["a","b"],!0),"math/rem":xz("FlowGraphModuloBlock",["a","b"]),"math/min":xz("FlowGraphMinBlock",["a","b"]),"math/max":xz("FlowGraphMaxBlock",["a","b"]),"math/clamp":xz("FlowGraphClampBlock",["a","b","c"]),"math/saturate":xz("FlowGraphSaturateBlock"),"math/mix":xz("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":xz("FlowGraphEqualityBlock",["a","b"]),"math/lt":xz("FlowGraphLessThanBlock",["a","b"]),"math/le":xz("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":xz("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":xz("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":xz("FlowGraphIsNaNBlock"),"math/isinf":xz("FlowGraphIsInfBlock"),"math/select":{ZH:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{ZH:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":xz("FlowGraphSinBlock"),"math/cos":xz("FlowGraphCosBlock"),"math/tan":xz("FlowGraphTanBlock"),"math/asin":xz("FlowGraphASinBlock"),"math/acos":xz("FlowGraphACosBlock"),"math/atan":xz("FlowGraphATanBlock"),"math/atan2":xz("FlowGraphATan2Block",["a","b"]),"math/sinh":xz("FlowGraphSinhBlock"),"math/cosh":xz("FlowGraphCoshBlock"),"math/tanh":xz("FlowGraphTanhBlock"),"math/asinh":xz("FlowGraphASinhBlock"),"math/acosh":xz("FlowGraphACoshBlock"),"math/atanh":xz("FlowGraphATanhBlock"),"math/exp":xz("FlowGraphExponentialBlock"),"math/log":xz("FlowGraphLogBlock"),"math/log2":xz("FlowGraphLog2Block"),"math/log10":xz("FlowGraphLog10Block"),"math/sqrt":xz("FlowGraphSquareRootBlock"),"math/cbrt":xz("FlowGraphCubeRootBlock"),"math/pow":xz("FlowGraphPowerBlock",["a","b"]),"math/length":xz("FlowGraphLengthBlock"),"math/normalize":xz("FlowGraphNormalizeBlock"),"math/dot":xz("FlowGraphDotBlock",["a","b"]),"math/cross":xz("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":xz("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":xz("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{ZH:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{ZH:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{ZH:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{ZH:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{ZH:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{ZH:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{ZH:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":xz("FlowGraphTransposeBlock"),"math/determinant":xz("FlowGraphDeterminantBlock"),"math/inverse":xz("FlowGraphInvertMatrixBlock"),"math/matmul":xz("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{ZH:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"cp",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,t,z,A,X,R){const u=X[0].dataInputs.find((E=>"rotationQuaternion"===E.name));if(!u)throw new Error("Rotation quaternion input not found");return R._connectionValues[u.uniqueId]&&(R._connectionValues[u.uniqueId].type="Quaternion"),X}},"math/matDecompose":{ZH:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"cp"}}}},"math/quatConjugate":xz("FlowGraphConjugateBlock",["a"]),"math/quatMul":{ZH:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,t,z,A,X){var R;return(R=X[0]).config||(R.config={}),X[0].config.type="Quaternion",X}},"math/quatAngleBetween":xz("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{ZH:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":xz("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":xz("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{ZH:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,t,z,A,X){var R;return(R=X[0]).config||(R.config={}),X[0].config.inputIsColumnMajor=!0,X}},"math/extract2x2":{ZH:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{ZH:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,t,z,A,X){var R;return(R=X[0]).config||(R.config={}),X[0].config.inputIsColumnMajor=!0,X}},"math/extract3x3":{ZH:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{ZH:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,t,z,A,X){var R;return(R=X[0]).config||(R.config={}),X[0].config.inputIsColumnMajor=!0,X}},"math/extract4x4":{ZH:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{ZH:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,t,z,A,X,R){var u,p;(p=X[0]).config||(p.config={});const C=X[0].dataInputs[0];return X[0].config.valueType=(null===(u=R._connectionValues[C.uniqueId])||void 0===u?void 0:u.type)??"FlowGraphInteger",X}},"math/and":{ZH:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,t,z,A,X,R){var u,p,C;(C=X[0]).config||(C.config={});const Z=X[0].dataInputs[0],H=X[0].dataInputs[1];return X[0].config.valueType=(null===(u=R._connectionValues[Z.uniqueId])||void 0===u?void 0:u.type)??(null===(p=R._connectionValues[H.uniqueId])||void 0===p?void 0:p.type)??"FlowGraphInteger",X}},"math/or":{ZH:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,t,z,A,X,R){var u,p,C;(C=X[0]).config||(C.config={});const Z=X[0].dataInputs[0],H=X[0].dataInputs[1];return X[0].config.valueType=(null===(u=R._connectionValues[Z.uniqueId])||void 0===u?void 0:u.type)??(null===(p=R._connectionValues[H.uniqueId])||void 0===p?void 0:p.type)??"FlowGraphInteger",X}},"math/xor":{ZH:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,t,z,A,X,R){var u,p,C;(C=X[0]).config||(C.config={});const Z=X[0].dataInputs[0],H=X[0].dataInputs[1];return X[0].config.valueType=(null===(u=R._connectionValues[Z.uniqueId])||void 0===u?void 0:u.type)??(null===(p=R._connectionValues[H.uniqueId])||void 0===p?void 0:p.type)??"FlowGraphInteger",X}},"math/asr":xz("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":xz("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":xz("FlowGraphLeadingZerosBlock"),"math/ctz":xz("FlowGraphTrailingZerosBlock"),"math/popcnt":xz("FlowGraphOneBitsCounterBlock"),"math/rad":xz("FlowGraphDegToRadBlock"),"math/deg":xz("FlowGraphRadToDegBlock"),"type/boolToInt":xz("FlowGraphBooleanToInt"),"type/boolToFloat":xz("FlowGraphBooleanToFloat"),"type/intToBool":xz("FlowGraphIntToBoolean"),"type/intToFloat":xz("FlowGraphIntToFloat"),"type/floatToInt":xz("FlowGraphFloatToInt"),"type/floatToBool":xz("FlowGraphFloatToBoolean"),"flow/sequence":{ZH:["FlowGraphSequenceBlock"],extraProcessor(E,t,z,A,X){const R=X[0];return R.config||(R.config={}),R.config.outputSignalCount=Object.keys(E.flows||[]).length,R.signalOutputs.forEach(((E,t)=>{E.name="out_"+t})),X}},"flow/branch":{ZH:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{ZH:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(E){if(E.configuration&&E.configuration.cases){const t=E.configuration.cases.value;if(!t.every((E=>"number"===typeof E&&/^-?\d+$/.test(E.toString()))))return c.d.Warn("Switch cases should be integers. Using empty array instead."),E.configuration.cases.value=[],{valid:!0};const z=new Set(t);E.configuration.cases.value=Array.from(z)}return{valid:!0}},extraProcessor(E,t,z,A,X){if("flow/switch"!==t.op||!E.flows||0===Object.keys(E.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return X[0].signalOutputs.forEach((E=>{"default"!==E.name&&(E.name="out_"+E.name)})),X}},"flow/while":{ZH:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{ZH:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(E,t,z,A,X){const R=X[0];return R.config||(R.config={}),R.config.incrementIndexWhenLoopDone=!0,X}},"flow/doN":{ZH:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{ZH:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(E,t,z,A,X){if("flow/multiGate"!==t.op||!E.flows||0===Object.keys(E.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const R=X[0];return R.config||(R.config={}),R.config.outputSignalCount=Object.keys(E.flows).length,R.signalOutputs.forEach(((E,t)=>{E.name="out_"+t})),X}},"flow/waitAll":{ZH:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(E){var t,z;return"number"!==typeof(null===(t=E.configuration)||void 0===t||null===(z=t.inputFlows)||void 0===z?void 0:z.value[0])&&(E.configuration=E.configuration||{inputFlows:{value:[0]}},E.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{ZH:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{ZH:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{ZH:["FlowGraphCancelDelayBlock"]},"variable/get":{ZH:["FlowGraphGetVariableBlock"],validation(E){var t,z;return null!==(t=E.configuration)&&void 0!==t&&null!==(z=t.variable)&&void 0!==z&&z.value?{valid:!0}:(c.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(E,t)=>[t.getVariableName(E[0])]}}},"variable/set":{ZH:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(E,t)=>[t.getVariableName(E[0])]}}},"variable/setMultiple":{ZH:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(E,t)=>[E[0].map((E=>t.getVariableName(E)))]}},extraProcessor:(E,t,z,A,X)=>(X[0].dataInputs.forEach((E=>{E.name=A.getVariableName(+E.name)})),X)},"variable/interpolate":{ZH:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(E,t)=>[t.getVariableName(E[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:E=>!0===E[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",xz:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",xz:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",xz:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",xz:"FlowGraphPlayAnimationBlock"},out:{name:"out",xz:"FlowGraphPlayAnimationBlock"},done:{name:"done",xz:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(E,t,z,A,X){var R,u,p;const C=X[0],Z=null===(R=E.configuration)||void 0===R?void 0:R.variable.value[0];if("number"!==typeof Z)throw c.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const H=A.arrays.staticVariables[Z];"undefined"===typeof C.config.animationType.value&&(A.arrays.staticVariables,C.config.animationType.value=(0,Wz.C)(H.type));const h=X[4];return h.config||(h.config={}),(u=h.config).variable||(u.variable={}),h.config.variable.value=A.getVariableName(Z),(p=X[3]).config||(p.config={}),X}},"pointer/get":{ZH:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",xz:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",xz:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(E,t,z,A,X)=>(X.forEach((E=>{"FlowGraphJsonPointerParserBlock"===E.className&&(E.config||(E.config={}),E.config.outputValue=!0)})),X)},"pointer/set":{ZH:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",xz:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",xz:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(E,t,z,A,X)=>(X.forEach((E=>{"FlowGraphJsonPointerParserBlock"===E.className&&(E.config||(E.config={}),E.config.outputValue=!0)})),X)},"pointer/interpolate":{ZH:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",xz:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",xz:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",xz:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",xz:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",xz:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",xz:"FlowGraphPlayAnimationBlock"},out:{name:"out",xz:"FlowGraphPlayAnimationBlock"},done:{name:"done",xz:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(E,t,z,A,X)=>(X.forEach((t=>{"FlowGraphJsonPointerParserBlock"===t.className?(t.config||(t.config={}),t.config.outputValue=!0):"FlowGraphInterpolationBlock"===t.className&&(t.config||(t.config={}),Object.keys(E.values||[]).forEach((z=>{var X;const R=null===(X=E.values)||void 0===X?void 0:X[z];if("value"===z&&R){const E=R.type;void 0!==E&&(t.config.animationType=A.arrays.types[E].flowGraphType)}})))})),X)},"animation/start":{ZH:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",xz:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(E,t)=>[E[0]*t._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(E,t)=>[E[0]*t._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(E,t,z,A,X,R,u){const p=X[X.length-1];return p.config||(p.config={}),p.config.glTF=u,X}},"animation/stop":{ZH:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",xz:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(E,t,z,A,X,R,u){const p=X[X.length-1];return p.config||(p.config={}),p.config.glTF=u,X}},"animation/stopAt":{ZH:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",xz:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(E,t)=>[E[0]*t._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(E,t,z,A,X,R,u){const p=X[X.length-1];return p.config||(p.config={}),p.config.glTF=u,X}},"math/switch":{ZH:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(E){if(E.configuration&&E.configuration.cases){const t=E.configuration.cases.value;if(!t.every((E=>"number"===typeof E&&/^-?\d+$/.test(E.toString()))))return c.d.Warn("Switch cases should be integers. Using empty array instead."),E.configuration.cases.value=[],{valid:!0};const z=new Set(t);E.configuration.cases.value=Array.from(z)}return{valid:!0}},extraProcessor(E,t,z,A,X){const R=X[0];return R.dataInputs.forEach((E=>{"default"!==E.name&&"case"!==E.name&&(E.name="in_"+E.name)})),R.config||(R.config={}),R.config.treatCasesAsIntegers=!0,X}},"debug/log":{ZH:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function xz(E){let t=arguments.length>2?arguments[2]:void 0;return{ZH:[E],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((E,t)=>(E[t]={name:t},E)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(E,z,A,X,R){var u;if(t){(u=R[0]).config||(u.config={}),R[0].config.preventIntegerFloatArithmetic=!0;let t=-1;Object.keys(E.values||{}).find((z=>{var A;return void 0!==(null===(A=E.values)||void 0===A?void 0:A[z].type)&&(t=E.values[z].type,!0)})),-1!==t&&(R[0].config.type=X.arrays.types[t].flowGraphType)}return R},validation:E=>t?Jz(E):{valid:!0}}}function Jz(E){if(E.values){const t=Object.keys(E.values).map((t=>E.values[t].type)).filter((E=>void 0!==E));if(!t.every((E=>E===t[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}bz["math/compose"]=bz["math/matCompose"],bz["math/decompose"]=bz["math/matDecompose"];var Vz=z(11772);const rz={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Lt",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class iz{constructor(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=E,this._gltf=t,this._animationTargetFps=z,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const E of this._interactivityGraph.types)this._types.push(rz[E.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const E of this._interactivityGraph.declarations){const t=Kz(E);if(!t)throw c.d.Error(["No mapping found for declaration",E]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:t,fullOperationName:E.extension?E.op+":"+E.extension:E.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const E of this._interactivityGraph.variables){const t=this._parseVariable(E);this._staticVariables.push(t)}}_parseVariable(E,t){const z=this._types[E.type];if(!z)throw c.d.Error(["No type found for variable",E]),new Error("Error parsing variables");if(E.value&&E.value.length!==z.length)throw c.d.Error(["Invalid value length for variable",E,z]),new Error("Error parsing variables");const A=E.value||[];if(!A.length)switch(z.flowGraphType){case"boolean":A.push(!1);break;case"FlowGraphInteger":A.push(0);break;case"number":A.push(NaN);break;case"Vector2":A.push(NaN,NaN);break;case"Lt":A.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":A.fill(NaN,0,4);break;case"Matrix":A.fill(NaN,0,16);break;case"Matrix3D":A.fill(NaN,0,9)}return"number"===z.elementType&&"string"===typeof A[0]&&(A[0]=parseFloat(A[0])),{type:z.flowGraphType,value:t?t(A,this):A}}_parseEvents(){if(this._interactivityGraph.events)for(const E of this._interactivityGraph.events){const t={eventId:E.id||"internalEvent_"+this._internalEventsCounter++};E.values&&(t.eventData=Object.keys(E.values).map((t=>{var z;const A=null===(z=E.values)||void 0===z?void 0:z[t];if(!A)throw c.d.Error(["No value found for event key",t]),new Error("Error parsing events");const X=this._types[A.type];if(!X)throw c.d.Error(["No type found for event value",A]),new Error("Error parsing events");const R="undefined"!==typeof A.value?this._parseVariable(A):void 0;return{id:t,type:X.flowGraphType,eventData:!0,value:R}}))),this._events.push(t)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const t of this._interactivityGraph.nodes){if("number"!==typeof t.declaration)throw c.d.Error(["No declaration found for node",t]),new Error("Error parsing nodes");const z=this._mappings[t.declaration];if(!z)throw c.d.Error(["No mapping found for node",t]),new Error("Error parsing nodes");if(z.flowGraphMapping.validation){const A=z.flowGraphMapping.validation(t,this._interactivityGraph,this._gltf);var E;if(!A.valid)throw new Error(`Error validating interactivity node ${null===(E=this._interactivityGraph.declarations)||void 0===E?void 0:E[t.declaration].op} - ${A.error}`)}const A=[];for(const E of z.flowGraphMapping.ZH){const X=this._getEmptyBlock(E,z.fullOperationName);this._parseNodeConfiguration(t,X,z.flowGraphMapping,E),A.push(X)}this._nodes.push({ZH:A,fullOperationName:z.fullOperationName})}}_getEmptyBlock(E,t){return{uniqueId:(0,Vz.d)(),className:E,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:t,metadata:{}}}_parseNodeConfiguration(E,t,z,A){const X=t.config;if(E.configuration){const t=Object.keys(E.configuration);for(const p of t){var R,u;const t=null===(R=E.configuration)||void 0===R?void 0:R[p];if(!t)throw c.d.Error(["No value found for node configuration",p]),new Error("Error parsing node configuration");const C=null===(u=z.configuration)||void 0===u?void 0:u[p];if(C&&C.xz?C.xz===A:0===z.ZH.indexOf(A)){const E=(null===C||void 0===C?void 0:C.name)||p;t&&"undefined"!==typeof t.value||"undefined"===typeof(null===C||void 0===C?void 0:C.defaultValue)?t.value.length>=0?X[E]={value:1===t.value.length?t.value[0]:t.value}:c.d.Warn(["Invalid value for node configuration",t]):X[E]={value:C.defaultValue},C&&C.dataTransformer&&(X[E].value=C.dataTransformer([X[E].value],this)[0])}}}}_parseNodeConnections(E){for(let D=0;D<this._nodes.length;D++){var t;const S=null===(t=this._interactivityGraph.nodes)||void 0===t?void 0:t[D];if(!S)throw c.d.Error(["No node found for interactivity node",this._nodes[D]]),new Error("Error parsing node connections");const l=this._nodes[D],f=this._mappings[S.declaration];if(!f)throw c.d.Error(["No mapping found for node",S]),new Error("Error parsing node connections");const K=S.flows||{},F=Object.keys(K).sort();for(const E of F){var z,A,X,R;const t=K[E],Z=null===(z=f.flowGraphMapping.outputs)||void 0===z||null===(A=z.flows)||void 0===A?void 0:A[E],H=(null===Z||void 0===Z?void 0:Z.name)||E,h=this._createNewSocketConnection(H,!0);(Z&&Z.xz&&l.ZH.find((E=>E.className===Z.xz))||l.ZH[0]).signalOutputs.push(h);const d=t.node,y=this._nodes[d];if(!y)throw c.d.Error(["No node found for input node id",d]),new Error("Error parsing node connections");const O=fz(y.fullOperationName);if(!O)throw c.d.Error(["No mapping found for input node",y]),new Error("Error parsing node connections");let a=null===(X=O.inputs)||void 0===X||null===(R=X.flows)||void 0===R?void 0:R[t.socket||"in"],L=!1;if(!a)for(const E in null===(u=O.inputs)||void 0===u?void 0:u.flows){var u,p,C;if(E.startsWith("[")&&E.endsWith("]"))L=!0,a=null===(p=O.inputs)||void 0===p||null===(C=p.flows)||void 0===C?void 0:C[E]}const mE=a?L?a.name.replace("$1",t.socket||""):a.name:t.socket||"in",W=a&&a.xz&&y.ZH.find((E=>E.className===a.xz))||y.ZH[0];let I=W.signalInputs.find((E=>E.name===mE));I||(I=this._createNewSocketConnection(mE),W.signalInputs.push(I)),I.connectedPointIds.push(h.uniqueId),h.connectedPointIds.push(I.uniqueId)}const B=S.values||{},b=Object.keys(B);for(const t of b){var Z,H;const z=B[t];let A=null===(Z=f.flowGraphMapping.inputs)||void 0===Z||null===(H=Z.values)||void 0===H?void 0:H[t],X=!1;if(!A)for(const E in null===(h=f.flowGraphMapping.inputs)||void 0===h?void 0:h.values){var h,d,y;if(E.startsWith("[")&&E.endsWith("]"))X=!0,A=null===(d=f.flowGraphMapping.inputs)||void 0===d||null===(y=d.values)||void 0===y?void 0:y[E]}const R=A?X?A.name.replace("$1",t):A.name:t,u=this._createNewSocketConnection(R);if((A&&A.xz&&l.ZH.find((E=>E.className===A.xz))||l.ZH[0]).dataInputs.push(u),void 0!==z.value){const t=this._parseVariable(z,A&&A.dataTransformer);E._connectionValues[u.uniqueId]=t}else{if("undefined"===typeof z.node)throw c.d.Error(["Invalid value for value connection",z]),new Error("Error parsing node connections");{var O,a,L;const E=z.node,t=z.socket||"value",A=this._nodes[E];if(!A)throw c.d.Error(["No node found for output socket reference",z]),new Error("Error parsing node connections");const X=fz(A.fullOperationName);if(!X)throw c.d.Error(["No mapping found for output socket reference",z]),new Error("Error parsing node connections");let R=null===(O=X.outputs)||void 0===O||null===(a=O.values)||void 0===a?void 0:a[t],p=!1;if(!R)for(const z in null===(mE=X.outputs)||void 0===mE?void 0:mE.values){var mE,W,I;if(z.startsWith("[")&&z.endsWith("]"))p=!0,R=null===(W=X.outputs)||void 0===W||null===(I=W.values)||void 0===I?void 0:I[z]}const C=R?p?R.name.replace("$1",t):null===(L=R)||void 0===L?void 0:L.name:t,Z=R&&R.xz&&A.ZH.find((E=>E.className===R.xz))||A.ZH[0];let H=Z.dataOutputs.find((E=>E.name===C));H||(H=this._createNewSocketConnection(C,!0),Z.dataOutputs.push(H)),u.connectedPointIds.push(H.uniqueId),H.connectedPointIds.push(u.uniqueId)}}}if(f.flowGraphMapping.interBlockConnectors)for(const E of f.flowGraphMapping.interBlockConnectors){const t=E.input,z=E.output,A=E.isVariable;this._connectFlowGraphNodes(t,z,l.ZH[E.inputBlockIndex],l.ZH[E.outputBlockIndex],A)}if(f.flowGraphMapping.extraProcessor){var e;const t=null===(e=this._interactivityGraph.declarations)||void 0===e?void 0:e[S.declaration];if(!t)throw c.d.Error(["No declaration found for extra processor",S]),new Error("Error parsing node connections");l.ZH=f.flowGraphMapping.extraProcessor(S,t,f.flowGraphMapping,this,l.ZH,E,this._gltf)}}}_createNewSocketConnection(E,t){return{uniqueId:(0,Vz.d)(),name:E,_connectionType:t?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(E,t,z,A,X){const R=X?z.dataInputs:z.signalInputs,u=X?A.dataOutputs:A.signalOutputs,p=R.find((t=>t.name===E))||this._createNewSocketConnection(E),C=u.find((E=>E.name===t))||this._createNewSocketConnection(t,!0);R.find((t=>t.name===E))||R.push(p),u.find((E=>E.name===t))||u.push(C),p.connectedPointIds.push(C.uniqueId),C.connectedPointIds.push(p.uniqueId)}getVariableName(E){return"staticVariable_"+E}serializeToFlowGraph(){const E={uniqueId:(0,Vz.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(E);for(let t=0;t<this._staticVariables.length;t++){const z=this._staticVariables[t];E._userVariables[this.getVariableName(t)]=z}return{rightHanded:!0,allBlocks:this._nodes.reduce(((E,t)=>E.concat(t.ZH)),[]),executionContexts:[E]}}}const gz="KHR_interactivity";class oz{constructor(E){this._loader=E,this.name=gz,this.enabled=this._loader.isExtensionUsed(gz),this._pathConverter=(0,Q.e)(this._loader.zp),E._skipStartAnimationStep=!0;const t=E.babylonScene;t&&function(E){(0,Q.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!E.activeCamera)return new X.Quaternion(NaN,NaN,NaN,NaN);const t=X.Quaternion.FromRotationMatrix(E.activeCamera.getWorldMatrix()).normalize();return E.useRightHandedSystem||(t.w*=-1,t.x*=-1),t},type:"Quaternion",getTarget:()=>E.activeCamera}),(0,Q.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!E.activeCamera)return new X.Lt(NaN,NaN,NaN);const t=E.activeCamera.getWorldMatrix().getTranslation();return E.useRightHandedSystem||(t.x*=-1),t},type:"Lt",getTarget:()=>E.activeCamera}),(0,Q.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:E=>{var t;return(null===(t=E._babylonAnimationGroup)||void 0===t?void 0:t.isPlaying)??!1},type:"boolean",getTarget:E=>E._babylonAnimationGroup}),(0,Q.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:E=>{var t;return((null===(t=E._babylonAnimationGroup)||void 0===t?void 0:t.from)??0)/60},type:"number",getTarget:E=>E._babylonAnimationGroup}),(0,Q.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:E=>{var t;return((null===(t=E._babylonAnimationGroup)||void 0===t?void 0:t.to)??0)/60},type:"number",getTarget:E=>E._babylonAnimationGroup}),(0,Q.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:E=>{var t;return((null===(t=E._babylonAnimationGroup)||void 0===t?void 0:t.getCurrentFrame())??0)/60},type:"number",getTarget:E=>E._babylonAnimationGroup}),(0,Q.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:E=>{var t;return((null===(t=E._babylonAnimationGroup)||void 0===t?void 0:t.getCurrentFrame())??0)/60},type:"number",getTarget:E=>E._babylonAnimationGroup})}(t)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var E;if(!this._loader.babylonScene||!this._pathConverter)return;const t=this._loader.babylonScene,z=null===(E=this._loader.zp.extensions)||void 0===E?void 0:E.KHR_interactivity;if(!z)return;const A=new Oz.e({It:t});A.dispatchEventsSynchronously=!1;const X=z.graphs.map((E=>new iz(E,this._loader.zp,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(X.map((async E=>await Dz(E,{coordinator:A,pathConverter:this._pathConverter})))),A.start()}}var Qz;Qz=async()=>(await Promise.resolve().then(z.bind(z,13521))).FlowGraphGLTFDataProvider,cz[`${gz}/${"FlowGraphGLTFDataProvider"}`]=Qz,o(gz),g(gz,!0,(E=>new oz(E)));const Tz="KHR_node_visibility";(0,Q.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:E=>{const t=E._babylonTransformNode;return!t||void 0===t.isVisible||t.isVisible},set:(E,t)=>{var z,A;null===(z=t._primitiveBabylonMeshes)||void 0===z||z.forEach((E=>{E.inheritVisibility=!0})),t._babylonTransformNode&&(t._babylonTransformNode.isVisible=E),null===(A=t._primitiveBabylonMeshes)||void 0===A||A.forEach((t=>{t.isVisible=E}))},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class qz{constructor(E){this.name=Tz,this._loader=E,this.enabled=E.isExtensionUsed(Tz)}async onReady(){var E;null===(E=this._loader.zp.nodes)||void 0===E||E.forEach((E=>{var t,z,A,X;(null===(t=E._primitiveBabylonMeshes)||void 0===t||t.forEach((E=>{E.inheritVisibility=!0})),null!==(z=E.extensions)&&void 0!==z&&z.KHR_node_visibility)&&(!1===(null===(A=E.extensions)||void 0===A?void 0:A.KHR_node_visibility.visible)&&(E._babylonTransformNode&&(E._babylonTransformNode.isVisible=!1),null===(X=E._primitiveBabylonMeshes)||void 0===X||X.forEach((E=>{E.isVisible=!1}))))}))}dispose(){this._loader=null}}o(Tz),g(Tz,!0,(E=>new qz(E)));const Mz="KHR_node_selectability";Fz("event/onSelect",Mz,{ZH:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xz:"FlowGraphGetVariableBlock",dataTransformer:E=>["pickedMesh_"+E[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",xz:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(E,t,z,A,X,R,u){var p,C,Z,H,h,d;const y=X[X.length-1];y.config=y.config||{},y.config.glTF=u;const O=null===(p=E.configuration)||void 0===p||null===(C=p.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===O||"number"!==typeof O)throw new Error("nodeIndex not found in configuration");const c="pickedMesh_"+O;return X[1].config.variable=c,R._userVariables[c]={className:"Mesh",id:null===u||void 0===u||null===(Z=u.nodes)||void 0===Z||null===(H=Z[O]._babylonTransformNode)||void 0===H?void 0:H.id,uniqueId:null===u||void 0===u||null===(h=u.nodes)||void 0===h||null===(d=h[O]._babylonTransformNode)||void 0===d?void 0:d.uniqueId},X}}),(0,Q.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:E=>{const t=E._babylonTransformNode;return!t||void 0===t.VC||t.VC},set:(E,t)=>{var z;null===(z=t._primitiveBabylonMeshes)||void 0===z||z.forEach((t=>{t.VC=E}))},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"VC"],type:"boolean"});class wz{constructor(E){this.name=Mz,this._loader=E,this.enabled=E.isExtensionUsed(Mz)}async onReady(){var E;null===(E=this._loader.zp.nodes)||void 0===E||E.forEach((E=>{var t,z,A;null!==(t=E.extensions)&&void 0!==t&&t.KHR_node_selectability&&!1===(null===(z=E.extensions)||void 0===z?void 0:z.KHR_node_selectability.selectable)&&(null===(A=E._babylonTransformNode)||void 0===A||A.getChildMeshes().forEach((E=>{E.VC=!1})))}))}dispose(){this._loader=null}}o(Mz),g(Mz,!0,(E=>new wz(E)));const nz="KHR_node_hoverability",sz="targetMeshPointerOver_";Fz("event/onHoverIn",nz,{ZH:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xz:"FlowGraphGetVariableBlock",dataTransformer:E=>[sz+E[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",xz:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(E,t,z,A,X,R,u){var p,C,Z,H,h,d;const y=X[X.length-1];y.config=y.config||{},y.config.glTF=u;const O=null===(p=E.configuration)||void 0===p||null===(C=p.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===O||"number"!==typeof O)throw new Error("nodeIndex not found in configuration");const c=sz+O;return X[1].config.variable=c,R._userVariables[c]={className:"Mesh",id:null===u||void 0===u||null===(Z=u.nodes)||void 0===Z||null===(H=Z[O]._babylonTransformNode)||void 0===H?void 0:H.id,uniqueId:null===u||void 0===u||null===(h=u.nodes)||void 0===h||null===(d=h[O]._babylonTransformNode)||void 0===d?void 0:d.uniqueId},X}});const jz="targetMeshPointerOut_";Fz("event/onHoverOut",nz,{ZH:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xz:"FlowGraphGetVariableBlock",dataTransformer:E=>[jz+E[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",xz:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(E,t,z,A,X,R,u){var p,C,Z,H,h,d;const y=X[X.length-1];y.config=y.config||{},y.config.glTF=u;const O=null===(p=E.configuration)||void 0===p||null===(C=p.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===O||"number"!==typeof O)throw new Error("nodeIndex not found in configuration");const c=jz+O;return X[1].config.variable=c,R._userVariables[c]={className:"Mesh",id:null===u||void 0===u||null===(Z=u.nodes)||void 0===Z||null===(H=Z[O]._babylonTransformNode)||void 0===H?void 0:H.id,uniqueId:null===u||void 0===u||null===(h=u.nodes)||void 0===h||null===(d=h[O]._babylonTransformNode)||void 0===d?void 0:d.uniqueId},X}}),(0,Q.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:E=>{const t=E._babylonTransformNode;return!t||void 0===t.pointerOverDisableMeshTesting||t.pointerOverDisableMeshTesting},set:(E,t)=>{var z;null===(z=t._primitiveBabylonMeshes)||void 0===z||z.forEach((t=>{t.pointerOverDisableMeshTesting=!E}))},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Uz{constructor(E){this.name=nz,this._loader=E,this.enabled=E.isExtensionUsed(nz)}async onReady(){var E;null===(E=this._loader.zp.nodes)||void 0===E||E.forEach((E=>{var t,z,A;null!==(t=E.extensions)&&void 0!==t&&t.KHR_node_hoverability&&!1===(null===(z=E.extensions)||void 0===z?void 0:z.KHR_node_hoverability.hoverable)&&(null===(A=E._babylonTransformNode)||void 0===A||A.getChildMeshes().forEach((E=>{E.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}o(nz),g(nz,!0,(E=>new Uz(E)));const kz="ExtrasAsMetadata";class vz{_assignExtras(E,t){if(t.extras&&Object.keys(t.extras).length>0){const z=E.metadata=E.metadata||{};(z.zp=z.zp||{}).extras=t.extras}}constructor(E){this.name=kz,this.enabled=!0,this._loader=E}dispose(){this._loader=null}loadNodeAsync(E,t,z){return this._loader.loadNodeAsync(E,t,(E=>{this._assignExtras(E,t),z(E)}))}loadCameraAsync(E,t,z){return this._loader.loadCameraAsync(E,t,(E=>{this._assignExtras(E,t),z(E)}))}createMaterial(E,t,z){const A=this._loader.createMaterial(E,t,z);return this._assignExtras(A,t),A}}o(kz),g(kz,!1,(E=>new vz(E)));z(13521)},13399:(E,t,z)=>{"use strict";z.d(t,{d:()=>J,e:()=>f,i:()=>l,k:()=>K});var A=z(11632),X=z(11630),R=z(13060),u=z(12250),p=z(12224),C=z(12231),Z=z(11640),H=z(11667),h=z(12247),d=z(12361),y=z(12256),O=z(11852);class c{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Kd=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.ey=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(E){this._environmentTexture=E}getNodes(){let E=[];E=E.concat(this.meshes),E=E.concat(this.lights),E=E.concat(this.cameras),E=E.concat(this.transformNodes);for(const t of this.skeletons)E=E.concat(t.bones);return E}}class a extends c{}class L{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const E=this.rootNodes;for(const A of E)A.dispose();E.length=0;const t=this.skeletons;for(const A of t)A.dispose();t.length=0;const z=this.animationGroups;for(const A of z)A.dispose();z.length=0}}class mE extends c{constructor(E){super(),this._wasAddedToScene=!1,(E=E||H.d.LastCreatedScene)&&(this.It=E,this.proceduralTextures=[],E.IX.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=E.getEngine().onContextRestoredObservable.add((()=>{for(const E of this.geometries)E._rebuild();for(const E of this.meshes)E._rebuild();for(const E of this.Kd)E.rebuild();for(const E of this.textures)E._rebuild()})))}_topologicalSort(E){const t=new Map;for(const u of E)t.set(u.uniqueId,u);const z={dependsOn:new Map,dependedBy:new Map};for(const u of E){const E=u.uniqueId;z.dependsOn.set(E,new Set),z.dependedBy.set(E,new Set)}for(const u of E){const E=u.uniqueId,A=z.dependsOn.get(E);if(u instanceof h.c){const X=u.sourceMesh;t.has(X.uniqueId)&&(A.add(X.uniqueId),z.dependedBy.get(X.uniqueId).add(E))}const X=z.dependedBy.get(E);for(const R of u.getDescendants()){const A=R.uniqueId;if(t.has(A)){X.add(A);z.dependsOn.get(A).add(E)}}}const A=[],X=[];for(const u of E){const E=u.uniqueId;0===z.dependsOn.get(E).size&&(X.push(u),t.delete(E))}const R=X;for(;R.length>0;){const E=R.shift();A.push(E);const X=z.dependedBy.get(E.uniqueId);for(const A of Array.from(X.values())){const X=z.dependsOn.get(A);X.delete(E.uniqueId),0===X.size&&t.get(A)&&(R.push(t.get(A)),t.delete(A))}}return t.size>0&&(Z.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),t.forEach((E=>{Z.d.Error(E.name)}))),A}_addNodeAndDescendantsToList(E,t,z,A){if(z&&(!A||A(z))&&!t.has(z.uniqueId)){E.push(z),t.add(z.uniqueId);for(const X of z.getDescendants(!0))this._addNodeAndDescendantsToList(E,t,X,A)}}_isNodeInContainer(E){return E instanceof C.d&&-1!==this.meshes.indexOf(E)||(E instanceof p.d&&-1!==this.transformNodes.indexOf(E)||(E instanceof d.d&&-1!==this.lights.indexOf(E)||E instanceof y.d&&-1!==this.cameras.indexOf(E)))}_isValidHierarchy(){for(const E of this.meshes)if(E.parent&&!this._isNodeInContainer(E.parent))return Z.d.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;for(const E of this.transformNodes)if(E.parent&&!this._isNodeInContainer(E.parent))return Z.d.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;for(const E of this.lights)if(E.parent&&!this._isNodeInContainer(E.parent))return Z.d.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;for(const E of this.cameras)if(E.parent&&!this._isNodeInContainer(E.parent))return Z.d.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(E){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||X.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const A={},R={},p=new L,C=[],Z=[],H={doNotInstantiate:!0,...z},h=[],d=new Set;for(const X of this.transformNodes)null===X.parent&&this._addNodeAndDescendantsToList(h,d,X,H.predicate);for(const X of this.meshes)null===X.parent&&this._addNodeAndDescendantsToList(h,d,X,H.predicate);const y=this._topologicalSort(h),O=(z,X)=>{if(((t,z)=>{if(A[t.uniqueId]=z.uniqueId,R[z.uniqueId]=z,E&&(z.name=E(t.name)),z instanceof u.e){const E=z;if(E.morphTargetManager){const z=t.morphTargetManager;E.morphTargetManager=z.clone();for(let t=0;t<z.numTargets;t++){const X=z.getTarget(t),u=E.morphTargetManager.getTarget(t);A[X.uniqueId]=u.uniqueId,R[u.uniqueId]=u}}}})(z,X),z.parent){const E=A[z.parent.uniqueId],t=R[E];X.parent=t||z.parent}if(X.position&&z.position&&X.position.R(z.position),X.rotationQuaternion&&z.rotationQuaternion&&X.rotationQuaternion.R(z.rotationQuaternion),X.rotation&&z.rotation&&X.rotation.R(z.rotation),X.cp&&z.cp&&X.cp.R(z.cp),X.material){const u=X;if(u.material)if(t){const t=z.material;if(-1===Z.indexOf(t)){let z=t.clone(E?E(t.name):"Clone of "+t.name);if(Z.push(t),A[t.uniqueId]=z.uniqueId,R[z.uniqueId]=z,"MultiMaterial"===t.getClassName()){const X=t;for(const t of X.mC)t&&(z=t.clone(E?E(t.name):"Clone of "+t.name),Z.push(t),A[t.uniqueId]=z.uniqueId,R[z.uniqueId]=z);X.mC=X.mC.map((E=>E&&R[A[E.uniqueId]]))}}"InstancedMesh"!==u.getClassName()&&(u.material=R[A[t.uniqueId]])}else"MultiMaterial"===u.material.getClassName()?-1===this.It.multiMaterials.indexOf(u.material)&&this.It.addMultiMaterial(u.material):-1===this.It.materials.indexOf(u.material)&&this.It.addMaterial(u.material)}null===X.parent&&p.rootNodes.push(X)};for(const X of y)if("InstancedMesh"===X.getClassName()){const E=X,t=E.sourceMesh,z=A[t.uniqueId];O(E,("number"===typeof z?R[z]:t).createInstance(E.name))}else{let E=!0;"th"===X.getClassName()||"Node"===X.getClassName()||X.skeleton||!X.getTotalVertices||0===X.getTotalVertices()?E=!1:H.doNotInstantiate&&(E="function"===typeof H.doNotInstantiate?!H.doNotInstantiate(X):!H.doNotInstantiate);const t=E?X.createInstance(`instance of ${X.name}`):X.clone(`Clone of ${X.name}`,null,!0);if(!t)throw new Error(`Could not clone or instantiate node on Asset Container ${X.name}`);O(X,t)}for(const X of this.skeletons){if(H.predicate&&!H.predicate(X))continue;const t=X.clone(E?E(X.name):"Clone of "+X.name);for(const E of this.meshes)if(E.skeleton===X&&!E.isAnInstance){const z=R[A[E.uniqueId]];if(!z||z.isAnInstance)continue;if(z.skeleton=t,-1!==C.indexOf(t))continue;C.push(t);for(const E of t.bones)E._linkedTransformNode&&(E._linkedTransformNode=R[A[E._linkedTransformNode.uniqueId]])}p.skeletons.push(t)}for(const X of this.animationGroups){if(H.predicate&&!H.predicate(X))continue;const t=X.clone(E?E(X.name):"Clone of "+X.name,(E=>R[A[E.uniqueId]]||E));p.animationGroups.push(t)}return p}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||X.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.It.environmentTexture=this.environmentTexture);for(const E of this.It._serializableComponents)E.addFromContainer(this);this.It.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=[];for(const z of this.cameras)E&&!E(z)||(this.It.addCamera(z),t.push(z));for(const z of this.lights)E&&!E(z)||(this.It.addLight(z),t.push(z));for(const z of this.meshes)E&&!E(z)||(this.It.GZ(z),t.push(z));for(const z of this.skeletons)E&&!E(z)||this.It.addSkeleton(z);for(const z of this.animations)E&&!E(z)||this.It.addAnimation(z);for(const z of this.animationGroups)E&&!E(z)||this.It.addAnimationGroup(z);for(const z of this.multiMaterials)E&&!E(z)||this.It.addMultiMaterial(z);for(const z of this.materials)E&&!E(z)||this.It.addMaterial(z);for(const z of this.morphTargetManagers)E&&!E(z)||this.It.addMorphTargetManager(z);for(const z of this.geometries)E&&!E(z)||this.It.addGeometry(z);for(const z of this.transformNodes)E&&!E(z)||(this.It.addTransformNode(z),t.push(z));for(const z of this.actionManagers)E&&!E(z)||this.It.addActionManager(z);for(const z of this.textures)E&&!E(z)||this.It.addTexture(z);for(const z of this.reflectionProbes)E&&!E(z)||this.It.addReflectionProbe(z);for(const z of t)z.parent&&-1===this.It.getNodes().indexOf(z.parent)&&(z.setParent?z.setParent(null):z.parent=null)}removeAllFromScene(){this._isValidHierarchy()||X.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.It.environmentTexture&&(this.It.environmentTexture=null);for(const E of this.It._serializableComponents)E.removeFromContainer(this)}removeFromScene(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const t of this.cameras)E&&!E(t)||this.It.removeCamera(t);for(const t of this.lights)E&&!E(t)||this.It.removeLight(t);for(const t of this.meshes)E&&!E(t)||this.It.YZ(t,!0);for(const t of this.skeletons)E&&!E(t)||this.It.removeSkeleton(t);for(const t of this.animations)E&&!E(t)||this.It.removeAnimation(t);for(const t of this.animationGroups)E&&!E(t)||this.It.removeAnimationGroup(t);for(const t of this.multiMaterials)E&&!E(t)||this.It.removeMultiMaterial(t);for(const t of this.materials)E&&!E(t)||this.It.removeMaterial(t);for(const t of this.morphTargetManagers)E&&!E(t)||this.It.removeMorphTargetManager(t);for(const t of this.geometries)E&&!E(t)||this.It.removeGeometry(t);for(const t of this.transformNodes)E&&!E(t)||this.It.removeTransformNode(t);for(const t of this.actionManagers)E&&!E(t)||this.It.removeActionManager(t);for(const t of this.textures)E&&!E(t)||this.It.removeTexture(t);for(const t of this.reflectionProbes)E&&!E(t)||this.It.removeReflectionProbe(t)}dispose(){const E=this.cameras.slice(0);for(const y of E)y.dispose();this.cameras.length=0;const t=this.lights.slice(0);for(const y of t)y.dispose();this.lights.length=0;const z=this.meshes.slice(0);for(const y of z)y.dispose();this.meshes.length=0;const A=this.skeletons.slice(0);for(const y of A)y.dispose();this.skeletons.length=0;const X=this.animationGroups.slice(0);for(const y of X)y.dispose();this.animationGroups.length=0;const R=this.multiMaterials.slice(0);for(const y of R)y.dispose();this.multiMaterials.length=0;const u=this.materials.slice(0);for(const y of u)y.dispose();this.materials.length=0;const p=this.geometries.slice(0);for(const y of p)y.dispose();this.geometries.length=0;const C=this.transformNodes.slice(0);for(const y of C)y.dispose();this.transformNodes.length=0;const Z=this.actionManagers.slice(0);for(const y of Z)y.dispose();this.actionManagers.length=0;const H=this.textures.slice(0);for(const y of H)y.dispose();this.textures.length=0;const h=this.reflectionProbes.slice(0);for(const y of h)y.dispose();this.reflectionProbes.length=0;const d=this.morphTargetManagers.slice(0);for(const y of d)y.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const y of this.It._serializableComponents)y.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.It.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(E,t,z){if(E&&t)for(const A of E){let E=!0;if(z)for(const t of z)if(A===t){E=!1;break}E&&(t.push(A),A._parentContainer=this)}}moveAllFromScene(E){this._wasAddedToScene=!1,void 0===E&&(E=new a);for(const t in this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=this[t]||("_environmentTexture"===t?null:[]),this._moveAssets(this.It[t],this[t],E[t]));this.environmentTexture=this.It.environmentTexture,this.removeAllFromScene()}createRootMesh(){const E=new u.e("assetContainerRootMesh",this.It);for(const t of this.meshes)t.parent||E.addChild(t);return this.meshes.unshift(E),E}mergeAnimationsTo(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H.d.LastCreatedScene,t=arguments.length>1?arguments[1]:void 0,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!E)return Z.d.Error("No scene available to merge animations to"),[];const A=z||(t=>{let z=null;const A=t.animations.length?t.animations[0].targetProperty:"",X=t.name.split(".").join("").split("_primitive")[0];switch(A){case"position":case"rotationQuaternion":z=E.getTransformNodeByName(t.name)||E.getTransformNodeByName(X);break;case"influence":z=E.getMorphTargetByName(t.name)||E.getMorphTargetByName(X);break;default:z=E.getNodeByName(t.name)||E.getNodeByName(X)}return z}),X=this.getNodes();for(const p of X){const E=A(p);if(null!==E){for(const t of p.animations){const z=E.animations.filter((E=>E.targetProperty===t.targetProperty));for(const t of z){const z=E.animations.indexOf(t,0);z>-1&&E.animations.splice(z,1)}}E.animations=E.animations.concat(p.animations)}}const R=[],u=this.animationGroups.slice();for(const p of u){R.push(p.clone(p.name,A));for(const E of p.animatables)E.stop()}for(const p of t){const t=A(p.target);t&&(E.beginAnimation(t,p.fromFrame,p.toFrame,p.loopAnimation,p.speedRatio,p.onAnimationEnd?p.onAnimationEnd:void 0,void 0,!0,void 0,p.onAnimationLoop?p.onAnimationLoop:void 0),E.stopAnimation(p.target))}return R}populateRootNodes(){this.rootNodes.length=0;for(const E of this.meshes)E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E);for(const E of this.transformNodes)E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E);for(const E of this.lights)E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E);for(const E of this.cameras)E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E)}addAllAssetsToContainer(E){if(!E)return;const t=[],z=new Set;for(t.push(E);t.length>0;){const E=t.pop();if(E instanceof u.e?(E.hp&&-1===this.geometries.indexOf(E.hp)&&this.geometries.push(E.hp),this.meshes.push(E)):E instanceof h.c?this.meshes.push(E):E instanceof p.d?this.transformNodes.push(E):E instanceof d.d?this.lights.push(E):E instanceof y.d&&this.cameras.push(E),E instanceof C.d){if(E.material&&-1===this.materials.indexOf(E.material)){this.materials.push(E.material);for(const t of E.material.getActiveTextures())-1===this.textures.indexOf(t)&&this.textures.push(t)}E.skeleton&&-1===this.skeletons.indexOf(E.skeleton)&&this.skeletons.push(E.skeleton),E.morphTargetManager&&-1===this.morphTargetManagers.indexOf(E.morphTargetManager)&&this.morphTargetManagers.push(E.morphTargetManager)}for(const A of E.getChildren())z.has(A)||t.push(A);z.add(E)}this.populateRootNodes()}_getByTags(E,t,z){if(void 0===t)return E;const A=[];for(const X in E){const R=E[X];O.d&&O.d.MatchesQuery(R,t)&&(!z||z(R))&&A.push(R)}return A}getMeshesByTags(E,t){return this._getByTags(this.meshes,E,t)}getCamerasByTags(E,t){return this._getByTags(this.cameras,E,t)}getLightsByTags(E,t){return this._getByTags(this.lights,E,t)}getMaterialsByTags(E,t){return this._getByTags(this.materials,E,t).concat(this._getByTags(this.multiMaterials,E,t))}getTransformNodesByTags(E,t){return this._getByTags(this.transformNodes,E,t)}}var W=z(11689);class I{constructor(E){this.byteOffset=0,this.buffer=E}async loadAsync(E){const t=await this.buffer.readAsync(this.byteOffset,E);this._dataView=new DataView(t.buffer,t.byteOffset,t.byteLength),this._dataByteOffset=0}readUint32(){const E=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,E}readUint8Array(E){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,E);return this._dataByteOffset+=E,this.byteOffset+=E,t}readString(E){return(0,W.h)(this.readUint8Array(E))}skipBytes(E){this._dataByteOffset+=E,this.byteOffset+=E}}var e=z(13401);const D="Z2xURg",S={name:"zp",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:E=>-1!==E.indexOf("asset")&&-1!==E.indexOf("version")||E.startsWith("data:base64,"+D)||E.startsWith("data:;base64,"+D)||E.startsWith("data:application/octet-stream;base64,"+D)||E.startsWith("data:model/gltf-binary;base64,"+D)};var l,f,K,F=z(11674),B=z(11681);function b(E,t,z){try{return Promise.resolve(new Uint8Array(E,t,z))}catch(A){return Promise.reject(A)}}!function(E){E[E.AUTO=0]="AUTO",E[E.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(l||(l={})),function(E){E[E.NONE=0]="NONE",E[E.FIRST=1]="FIRST",E[E.ALL=2]="ALL"}(f||(f={})),function(E){E[E.LOADING=0]="LOADING",E[E.READY=1]="READY",E[E.COMPLETE=2]="COMPLETE"}(K||(K={}));class x{constructor(){this.coordinateSystemMode=l.AUTO,this.animationStartMode=f.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=E=>Promise.resolve(E),this.extensionOptions={}}R(E){E&&(this.onParsed=E.onParsed,this.coordinateSystemMode=E.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=E.animationStartMode??this.animationStartMode,this.loadNodeAnimations=E.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=E.loadSkins??this.loadSkins,this.loadMorphTargets=E.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=E.compileMaterials??this.compileMaterials,this.useClipPlane=E.useClipPlane??this.useClipPlane,this.compileShadowGenerators=E.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=E.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=E.useRangeRequests??this.useRangeRequests,this.createInstances=E.createInstances??this.createInstances,this.alwaysComputeBoundingBox=E.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=E.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=E.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=E.skipMaterials??this.skipMaterials,this.useSRGBBuffers=E.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=E.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=E.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=E.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=E.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=E.customRootNode,this.onMeshLoaded=E.onMeshLoaded,this.onSkinLoaded=E.onSkinLoaded,this.onTextureLoaded=E.onTextureLoaded,this.onMaterialLoaded=E.onMaterialLoaded,this.onCameraLoaded=E.onCameraLoaded,this.extensionOptions=E.extensionOptions??this.extensionOptions)}}class J extends x{constructor(E){super(),this.onParsedObservable=new A.b,this.onMeshLoadedObservable=new A.b,this.onSkinLoadedObservable=new A.b,this.onTextureLoadedObservable=new A.b,this.onMaterialLoadedObservable=new A.b,this.onCameraLoadedObservable=new A.b,this.onCompleteObservable=new A.b,this.onErrorObservable=new A.b,this.IX=new A.b,this.onExtensionLoadedObservable=new A.b,this.validate=!1,this.onValidatedObservable=new A.b,this._loader=null,this._state=null,this._requests=new Array,this.name=S.name,this.extensions=S.extensions,this.onLoaderStateChangedObservable=new A.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.R(E)}set onParsed(E){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),E&&(this._onParsedObserver=this.onParsedObservable.add(E))}set onMeshLoaded(E){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),E&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(E))}set onSkinLoaded(E){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),E&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((t=>E(t.node,t.skinnedNode))))}set onTextureLoaded(E){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),E&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(E))}set onMaterialLoaded(E){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),E&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(E))}set onCameraLoaded(E){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),E&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(E))}set onComplete(E){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(E)}set onError(E){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(E)}set onDispose(E){this._onDisposeObserver&&this.IX.remove(this._onDisposeObserver),this._onDisposeObserver=this.IX.add(E)}set onExtensionLoaded(E){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(E)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(E){this._loggingEnabled!==E&&(this._loggingEnabled=E,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(E){this._capturePerformanceCounters!==E&&(this._capturePerformanceCounters=E,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(E){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(E)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const E of this._requests)E.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=E=>Promise.resolve(E),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.IX.notifyObservers(void 0),this.IX.clear()}loadFile(E,t,z,R,u,p,C,H){if(ArrayBuffer.isView(t))return this._loadBinary(E,t,z,R,C,H),null;this._progressCallback=u;const h=t.name||X.Tools.GetFilename(t);if(p){if(this.useRangeRequests){this.validate&&Z.d.Warn("glTF validation is not supported when range requests are enabled");const z={abort:()=>{},onCompleteObservable:new A.b},X={readAsync:(z,A)=>new Promise(((X,R)=>{this._loadFile(E,t,(E=>{X(new Uint8Array(E))}),!0,(E=>{R(E)}),(E=>{E.setRequestHeader("Range",`bytes=${z}-${z+A-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new I(X)).then((E=>{z.onCompleteObservable.notifyObservers(z),R(E)}),C?E=>C(void 0,E):void 0),z}return this._loadFile(E,t,(t=>{this._validate(E,new Uint8Array(t,0,t.byteLength),z,h),this._unpackBinaryAsync(new I({readAsync:(E,z)=>b(t,E,z),byteLength:t.byteLength})).then((E=>{R(E)}),C?E=>C(void 0,E):void 0)}),!0,C)}return this._loadFile(E,t,(t=>{try{this._validate(E,t,z,h),R({json:this._parseJson(t)})}catch{C&&C()}}),!1,C)}_loadBinary(E,t,z,A,X,R){this._validate(E,new Uint8Array(t.buffer,t.byteOffset,t.byteLength),z,R),this._unpackBinaryAsync(new I({readAsync:(E,z)=>function(E,t,z){try{if(t<0||t>=E.byteLength)throw new RangeError("Offset is out of range.");if(t+z>E.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(E.buffer,E.byteOffset+t,z))}catch(A){return Promise.reject(A)}}(t,E,z),byteLength:t.byteLength})).then((E=>{A(E)}),X?E=>X(void 0,E):void 0)}importMeshAsync(E,t,z,A,X,R){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(z),this.onParsedObservable.clear(),this._log(`Loading ${R||""}`),this._loader=this._getLoader(z),this._loader.importMeshAsync(E,t,null,z,A,X,R))))}loadAsync(E,t,z,A,X){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${X||""}`),this._loader=this._getLoader(t),this._loader.loadAsync(E,t,z,A,X))))}loadAssetContainerAsync(E,t,z,A,X){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${X||""}`),this._loader=this._getLoader(t);const R=new mE(E),u=[];this.onMaterialLoadedObservable.add((E=>{u.push(E)}));const p=[];this.onTextureLoadedObservable.add((E=>{p.push(E)}));const C=[];this.onCameraLoadedObservable.add((E=>{C.push(E)}));const Z=[];return this.onMeshLoadedObservable.add((E=>{E.morphTargetManager&&Z.push(E.morphTargetManager)})),this._loader.importMeshAsync(null,E,R,t,z,A,X).then((E=>(Array.prototype.push.apply(R.geometries,E.geometries),Array.prototype.push.apply(R.meshes,E.meshes),Array.prototype.push.apply(R.Kd,E.Kd),Array.prototype.push.apply(R.skeletons,E.skeletons),Array.prototype.push.apply(R.animationGroups,E.animationGroups),Array.prototype.push.apply(R.materials,u),Array.prototype.push.apply(R.textures,p),Array.prototype.push.apply(R.lights,E.lights),Array.prototype.push.apply(R.transformNodes,E.transformNodes),Array.prototype.push.apply(R.cameras,C),Array.prototype.push.apply(R.morphTargetManagers,Z),R)))}))}canDirectLoad(E){return S.canDirectLoad(E)}directLoad(E,t){if(t.startsWith("base64,"+D)||t.startsWith(";base64,"+D)||t.startsWith("application/octet-stream;base64,"+D)||t.startsWith("model/gltf-binary;base64,"+D)){const z=(0,F.d)(t);return this._validate(E,new Uint8Array(z,0,z.byteLength)),this._unpackBinaryAsync(new I({readAsync:(E,t)=>b(z,E,t),byteLength:z.byteLength}))}return this._validate(E,t),Promise.resolve({json:this._parseJson(t)})}createPlugin(E){return new J(E[S.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((E,t)=>{this.onCompleteObservable.addOnce((()=>{E()})),this.onErrorObservable.addOnce((E=>{t(E)}))}))}_setState(E){this._state!==E&&(this._state=E,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(K[this._state]))}_loadFile(E,t,z,A,X,R){const u=E._loadFile(t,z,(E=>{this._onProgress(E,u)}),!0,A,X,R);return u.onCompleteObservable.add((()=>{u._lengthComputable=!0,u._total=u._loaded})),this._requests.push(u),u}_onProgress(E,t){if(!this._progressCallback)return;t._lengthComputable=E.lengthComputable,t._loaded=E.loaded,t._total=E.total;let z=!0,A=0,X=0;for(const R of this._requests){if(void 0===R._lengthComputable||void 0===R._loaded||void 0===R._total)return;z=z&&R._lengthComputable,A+=R._loaded,X+=R._total}this._progressCallback({lengthComputable:z,loaded:A,total:z?X:0})}_validate(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),e.d.ValidateAsync(t,z,A,(t=>this.preprocessUrlAsync(z+t).then((t=>E._loadFileAsync(t,void 0,!0,!0).then((E=>new Uint8Array(E,0,E.byteLength))))))).then((E=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(E),this.onValidatedObservable.clear()}),(E=>{this._endPerformanceCounter("Validate JSON"),X.Tools.Warn(`Failed to validate: ${E.message}`),this.onValidatedObservable.clear()})))}_getLoader(E){const t=E.json.asset||{};this._log(`Asset version: ${t.version}`),t.minVersion&&this._log(`Asset minimum version: ${t.minVersion}`),t.generator&&this._log(`Asset generator: ${t.generator}`);const z=J._parseVersion(t.version);if(!z)throw new Error("Invalid version: "+t.version);if(void 0!==t.minVersion){const E=J._parseVersion(t.minVersion);if(!E)throw new Error("Invalid minimum version: "+t.minVersion);if(J._compareVersion(E,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+t.minVersion)}const A={1:J._CreateGLTF1Loader,2:J._CreateGLTF2Loader}[z.major];if(!A)throw new Error("Unsupported version: "+t.version);return A(this)}_parseJson(E){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${E.length}`);const t=JSON.parse(E);return this._endPerformanceCounter("Parse JSON"),t}_unpackBinaryAsync(E){return this._startPerformanceCounter("Unpack Binary"),E.loadAsync(20).then((()=>{const t=E.readUint32();if(1179937895!==t)throw new B.g("Unexpected magic: "+t,B.d.GLTFLoaderUnexpectedMagicError);const z=E.readUint32();this.loggingEnabled&&this._log(`Binary version: ${z}`);const A=E.readUint32();let X;switch(this.useRangeRequests||A===E.buffer.byteLength||Z.d.Warn(`Length in header does not match actual data length: ${A} != ${E.buffer.byteLength}`),z){case 1:X=this._unpackBinaryV1Async(E,A);break;case 2:X=this._unpackBinaryV2Async(E,A);break;default:throw new Error("Unsupported version: "+z)}return this._endPerformanceCounter("Unpack Binary"),X}))}_unpackBinaryV1Async(E,t){const z=E.readUint32(),A=E.readUint32();if(0!==A)throw new Error(`Unexpected content format: ${A}`);const X=t-E.byteOffset,R={json:this._parseJson(E.readString(z)),bin:null};if(0!==X){const t=E.byteOffset;R.bin={readAsync:(z,A)=>E.buffer.readAsync(t+z,A),byteLength:X}}return Promise.resolve(R)}_unpackBinaryV2Async(E,t){const z=1313821514,A=5130562,X=E.readUint32();if(E.readUint32()!==z)throw new Error("First chunk format is not JSON");return E.byteOffset+X===t?E.loadAsync(X).then((()=>({json:this._parseJson(E.readString(X)),bin:null}))):E.loadAsync(X+8).then((()=>{const R={json:this._parseJson(E.readString(X)),bin:null},u=()=>{const X=E.readUint32();switch(E.readUint32()){case z:throw new Error("Unexpected JSON chunk");case A:{const t=E.byteOffset;R.bin={readAsync:(z,A)=>E.buffer.readAsync(t+z,A),byteLength:X},E.skipBytes(X);break}default:E.skipBytes(X)}return E.byteOffset!==t?E.loadAsync(8).then(u):Promise.resolve(R)};return u()}))}static _parseVersion(E){if("1.0"===E||"1.0.1"===E)return{major:1,minor:0};const t=(E+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null}static _compareVersion(E,t){return E.major>t.major?1:E.major<t.major?-1:E.minor>t.minor?1:E.minor<t.minor?-1:0}_logOpen(E){this._log(E),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(E){const t=J._logSpaces.substring(0,2*this._logIndentLevel);Z.d.Log(`${t}${E}`)}_logDisabled(E){}_startPerformanceCounterEnabled(E){X.Tools.StartPerformanceCounter(E)}_startPerformanceCounterDisabled(E){}_endPerformanceCounterEnabled(E){X.Tools.EndPerformanceCounter(E)}_endPerformanceCounterDisabled(E){}}J.IncrementalLoading=!0,J.HomogeneousCoordinates=!1,J._logSpaces="                                ",(0,R.b)(new J)},13401:(E,t,z)=>{"use strict";z.d(t,{d:()=>u});var A=z(11630);function X(E,t,z,A){const X={externalResourceFunction:A};return z&&(X.uri="file:"===t?z:t+z),ArrayBuffer.isView(E)?GLTFValidator.validateBytes(E,X):GLTFValidator.validateString(E,X)}function R(){const E=[];onmessage=t=>{const z=t.data;switch(z.id){case"init":importScripts(z.url);break;case"validate":X(z.data,z.rootUrl,z.fileName,(t=>new Promise(((z,A)=>{const X=E.length;E.push({resolve:z,reject:A}),postMessage({id:"getExternalResource",index:X,uri:t})})))).then((E=>{postMessage({id:"validate.resolve",value:E})}),(E=>{postMessage({id:"validate.reject",reason:E})}));break;case"getExternalResource.resolve":E[z.index].resolve(z.value);break;case"getExternalResource.reject":E[z.index].reject(z.reason)}}}class u{static ValidateAsync(E,t,z,u){return"function"===typeof Worker?new Promise(((p,C)=>{const Z=`${X}(${R})()`,H=URL.createObjectURL(new Blob([Z],{type:"application/javascript"})),h=new Worker(H),d=E=>{h.removeEventListener("error",d),h.removeEventListener("message",y),C(E)},y=E=>{const t=E.data;switch(t.id){case"getExternalResource":u(t.uri).then((E=>{h.postMessage({id:"getExternalResource.resolve",index:t.index,value:E},[E.buffer])}),(E=>{h.postMessage({id:"getExternalResource.reject",index:t.index,reason:E})}));break;case"validate.resolve":h.removeEventListener("error",d),h.removeEventListener("message",y),p(t.value),h.terminate();break;case"validate.reject":h.removeEventListener("error",d),h.removeEventListener("message",y),C(t.reason),h.terminate()}};if(h.addEventListener("error",d),h.addEventListener("message",y),h.postMessage({id:"init",url:A.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(E)){const A=E.slice();h.postMessage({id:"validate",data:A,rootUrl:t,fileName:z},[A.buffer])}else h.postMessage({id:"validate",data:E,rootUrl:t,fileName:z})})):(this._LoadScriptPromise||(this._LoadScriptPromise=A.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>X(E,t,z,u))))}}u.Configuration={url:`${A.Tools._DefaultCdnUrl}/gltf_validator.js`}},13936:(E,t,z)=>{"use strict";z.d(t,{c:()=>S});var A=z(11792),X=z(11801),R=z(11849),u=z(11812),p=z(12190),C=z(12116),Z=z(11894),H=z(12051),h=z(11766),d=z(11726);z(13188),z(13084),z(13102),z(13093),z(13106),z(13114),z(13123);const y="imageProcessingCompatibility",O="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";d.d.IncludesShadersStore[y]||(d.d.IncludesShadersStore[y]=O);const c="skyPixelShader",a="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";d.d.ShadersStore[c]||(d.d.ShadersStore[c]=a);z(13204),z(13128),z(13134),z(13145),z(13141);const L="skyVertexShader",mE="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";d.d.ShadersStore[L]||(d.d.ShadersStore[L]=mE);var W=z(12110),I=z(12168),e=z(12162);class D extends p.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class S extends C.c{constructor(E,t){super(E,t),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new u.Lt(0,100,0),this.useSunPosition=!1,this.cameraOffset=u.Lt.Zero(),this.up=u.Lt.Up(),this.dithering=!1,this._cameraPosition=u.Lt.Zero(),this._skyOrientation=new u.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(E,t){const z=t._drawWrapper;if(this.isFrozen&&z.effect&&z._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new D);const A=t.materialDefines,X=this.lE();if(this._isReadyForSubMesh(t))return!0;if((0,e.V)(E,X,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,A),(0,e.I)(E,A,!0,!1),A.IMAGEPROCESSINGPOSTPROCESS!==X.imageProcessingConfiguration.applyByPostProcess&&A.markAsMiscDirty(),A.DITHER!==this.dithering&&A.markAsMiscDirty(),A.isDirty){A.markAsProcessed(),X.resetCachedMaterial();const E=new W.d;A.FOG&&E.addFallback(1,"FOG"),A.IMAGEPROCESSINGPOSTPROCESS=X.imageProcessingConfiguration.applyByPostProcess,A.DITHER=this.dithering;const z=[Z.f.PositionKind];A.VERTEXCOLOR&&z.push(Z.f.ColorKind);const R="sky",u=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,I.d)(u);const p=A.toString();t.setEffect(X.getEngine().createEffect(R,z,u,[],p,E,this.onCompiled,this.onError),A,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(A._renderId=X.getRenderId(),z._wasPreviouslyReady=!0,!0)}bindForSubMesh(E,t,z){const A=this.lE(),X=z.materialDefines;if(!X)return;const R=z.effect;if(!R)return;this._activeEffect=R,this.bindOnlyWorldMatrix(E),this._activeEffect.setMatrix("viewProjection",A.getTransformMatrix()),this._mustRebind(A,R,z)&&((0,I.g)(R,this,A),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,e.o)(X,R,A)),A.fogEnabled&&t.applyFog&&A.fogMode!==H.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",A.getViewMatrix()),(0,e.i)(A,t,this._activeEffect);const p=A.activeCamera;if(p){const E=p.getWorldMatrix();this._cameraPosition.x=E.m[12],this._cameraPosition.y=E.m[13],this._cameraPosition.z=E.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const E=Math.PI*(this.inclination-.5),t=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(t)*Math.cos(E),this.sunPosition.y=this.distance*Math.sin(-E),this.sunPosition.z=this.distance*Math.sin(t)*Math.cos(E),u.Quaternion.FromUnitVectorsToRef(u.Lt.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(t,this._activeEffect,z)}getAnimatables(){return[]}dispose(E){super.dispose(E)}clone(E){return R.b.Clone((()=>new S(E,this.lE())),this)}serialize(){const E=super.serialize();return E.customType="BABYLON.SkyMaterial",E}getClassName(){return"SkyMaterial"}static Parse(E,t,z){return R.b.Parse((()=>new S(E.name,t)),E,t,z)}}(0,A.b)([(0,X.K)()],S.prototype,"luminance",void 0),(0,A.b)([(0,X.K)()],S.prototype,"turbidity",void 0),(0,A.b)([(0,X.K)()],S.prototype,"rayleigh",void 0),(0,A.b)([(0,X.K)()],S.prototype,"mieCoefficient",void 0),(0,A.b)([(0,X.K)()],S.prototype,"mieDirectionalG",void 0),(0,A.b)([(0,X.K)()],S.prototype,"distance",void 0),(0,A.b)([(0,X.K)()],S.prototype,"inclination",void 0),(0,A.b)([(0,X.K)()],S.prototype,"azimuth",void 0),(0,A.b)([(0,X.G)()],S.prototype,"sunPosition",void 0),(0,A.b)([(0,X.K)()],S.prototype,"useSunPosition",void 0),(0,A.b)([(0,X.G)()],S.prototype,"cameraOffset",void 0),(0,A.b)([(0,X.G)()],S.prototype,"up",void 0),(0,A.b)([(0,X.K)()],S.prototype,"dithering",void 0),(0,h.f)("BABYLON.SkyMaterial",S)},12507:(E,t,z)=>{"use strict";function A(E,t){t.headers=E.headers||{},t.statusMessage=E.statusText,t.statusCode=E.status,t.data=E.response}function X(E,t,z){return new Promise((function(X,R){z=z||{};var u,p,C,Z=new XMLHttpRequest,H=z.body,h=z.headers||{};for(u in z.timeout&&(Z.timeout=z.timeout),Z.ontimeout=Z.onerror=function(E){E.timeout="timeout"==E.type,R(E)},Z.open(E,t.href||t),Z.onload=function(){for(C=Z.getAllResponseHeaders().trim().split(/[\r\n]+/),A(Z,Z);p=C.shift();)p=p.split(": "),Z.headers[p.shift().toLowerCase()]=p.join(": ");if((p=Z.headers["content-type"])&&~p.indexOf("application/json"))try{Z.data=JSON.parse(Z.data,z.reviver)}catch(E){return A(Z,E),R(E)}(Z.status>=400?R:X)(Z)},typeof FormData<"u"&&H instanceof FormData||H&&"object"==typeof H&&(h["content-type"]="application/json",H=JSON.stringify(H)),Z.withCredentials=!!z.withCredentials,h)Z.setRequestHeader(u,h[u]);Z.send(H)}))}z.r(t),z.d(t,{del:()=>C,get:()=>R,patch:()=>p,post:()=>u,put:()=>Z,send:()=>X});var R=X.bind(X,"GET"),u=X.bind(X,"POST"),p=X.bind(X,"PATCH"),C=X.bind(X,"DELETE"),Z=X.bind(X,"PUT")},14052:(E,t,z)=>{"use strict";z.d(t,{e:()=>h});const A=.5*(Math.sqrt(3)-1),X=(3-Math.sqrt(3))/6,R=1/3,u=1/6,p=(Math.sqrt(5)-1)/4,C=(5-Math.sqrt(5))/20,Z=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),H=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const h=class{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const t="function"==typeof E?E:function(E){let t=0,z=0,A=0,X=1;const R=function(){let E=4022871197;return function(t){t=t.toString();for(let z=0;z<t.length;z++){E+=t.charCodeAt(z);let A=.02519603282416938*E;E=A>>>0,A-=E,A*=E,E=A>>>0,A-=E,E+=4294967296*A}return 2.3283064365386963e-10*(E>>>0)}}();t=R(" "),z=R(" "),A=R(" "),t-=R(E),t<0&&(t+=1);z-=R(E),z<0&&(z+=1);A-=R(E),A<0&&(A+=1);return function(){const E=2091639*t+2.3283064365386963e-10*X;return t=z,z=A,A=E-(X=0|E)}}(E);this.p=function(E){const t=new Uint8Array(256);for(let z=0;z<256;z++)t[z]=z;for(let z=0;z<255;z++){const A=z+~~(E()*(256-z)),X=t[z];t[z]=t[A],t[A]=X}return t}(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let z=0;z<512;z++)this.perm[z]=this.p[255&z],this.permMod12[z]=this.perm[z]%12}noise2D(E,t){const z=this.permMod12,R=this.perm;let u=0,p=0,C=0;const H=(E+t)*A,h=Math.floor(E+H),d=Math.floor(t+H),y=(h+d)*X,O=E-(h-y),c=t-(d-y);let a,L;O>c?(a=1,L=0):(a=0,L=1);const mE=O-a+X,W=c-L+X,I=O-1+2*X,e=c-1+2*X,D=255&h,S=255&d;let l=.5-O*O-c*c;if(l>=0){const E=3*z[D+R[S]];l*=l,u=l*l*(Z[E]*O+Z[E+1]*c)}let f=.5-mE*mE-W*W;if(f>=0){const E=3*z[D+a+R[S+L]];f*=f,p=f*f*(Z[E]*mE+Z[E+1]*W)}let K=.5-I*I-e*e;if(K>=0){const E=3*z[D+1+R[S+1]];K*=K,C=K*K*(Z[E]*I+Z[E+1]*e)}return 70*(u+p+C)}noise3D(E,t,z){const A=this.permMod12,X=this.perm;let p,C,H,h;const d=(E+t+z)*R,y=Math.floor(E+d),O=Math.floor(t+d),c=Math.floor(z+d),a=(y+O+c)*u,L=E-(y-a),mE=t-(O-a),W=z-(c-a);let I,e,D,S,l,f;L>=mE?mE>=W?(I=1,e=0,D=0,S=1,l=1,f=0):L>=W?(I=1,e=0,D=0,S=1,l=0,f=1):(I=0,e=0,D=1,S=1,l=0,f=1):mE<W?(I=0,e=0,D=1,S=0,l=1,f=1):L<W?(I=0,e=1,D=0,S=0,l=1,f=1):(I=0,e=1,D=0,S=1,l=1,f=0);const K=L-I+u,F=mE-e+u,B=W-D+u,b=L-S+2*u,x=mE-l+2*u,J=W-f+2*u,V=L-1+.5,r=mE-1+.5,i=W-1+.5,g=255&y,o=255&O,Q=255&c;let T=.6-L*L-mE*mE-W*W;if(T<0)p=0;else{const E=3*A[g+X[o+X[Q]]];T*=T,p=T*T*(Z[E]*L+Z[E+1]*mE+Z[E+2]*W)}let q=.6-K*K-F*F-B*B;if(q<0)C=0;else{const E=3*A[g+I+X[o+e+X[Q+D]]];q*=q,C=q*q*(Z[E]*K+Z[E+1]*F+Z[E+2]*B)}let M=.6-b*b-x*x-J*J;if(M<0)H=0;else{const E=3*A[g+S+X[o+l+X[Q+f]]];M*=M,H=M*M*(Z[E]*b+Z[E+1]*x+Z[E+2]*J)}let w=.6-V*V-r*r-i*i;if(w<0)h=0;else{const E=3*A[g+1+X[o+1+X[Q+1]]];w*=w,h=w*w*(Z[E]*V+Z[E+1]*r+Z[E+2]*i)}return 32*(p+C+H+h)}noise4D(E,t,z,A){const X=this.perm;let R,u,Z,h,d;const y=(E+t+z+A)*p,O=Math.floor(E+y),c=Math.floor(t+y),a=Math.floor(z+y),L=Math.floor(A+y),mE=(O+c+a+L)*C,W=E-(O-mE),I=t-(c-mE),e=z-(a-mE),D=A-(L-mE);let S=0,l=0,f=0,K=0;W>I?S++:l++,W>e?S++:f++,W>D?S++:K++,I>e?l++:f++,I>D?l++:K++,e>D?f++:K++;const F=S>=3?1:0,B=l>=3?1:0,b=f>=3?1:0,x=K>=3?1:0,J=S>=2?1:0,V=l>=2?1:0,r=f>=2?1:0,i=K>=2?1:0,g=S>=1?1:0,o=l>=1?1:0,Q=f>=1?1:0,T=K>=1?1:0,q=W-F+C,M=I-B+C,w=e-b+C,n=D-x+C,s=W-J+2*C,j=I-V+2*C,U=e-r+2*C,k=D-i+2*C,v=W-g+3*C,Y=I-o+3*C,G=e-Q+3*C,N=D-T+3*C,P=W-1+4*C,EE=I-1+4*C,tE=e-1+4*C,zE=D-1+4*C,AE=255&O,XE=255&c,RE=255&a,uE=255&L;let pE=.6-W*W-I*I-e*e-D*D;if(pE<0)R=0;else{const E=X[AE+X[XE+X[RE+X[uE]]]]%32*4;pE*=pE,R=pE*pE*(H[E]*W+H[E+1]*I+H[E+2]*e+H[E+3]*D)}let CE=.6-q*q-M*M-w*w-n*n;if(CE<0)u=0;else{const E=X[AE+F+X[XE+B+X[RE+b+X[uE+x]]]]%32*4;CE*=CE,u=CE*CE*(H[E]*q+H[E+1]*M+H[E+2]*w+H[E+3]*n)}let ZE=.6-s*s-j*j-U*U-k*k;if(ZE<0)Z=0;else{const E=X[AE+J+X[XE+V+X[RE+r+X[uE+i]]]]%32*4;ZE*=ZE,Z=ZE*ZE*(H[E]*s+H[E+1]*j+H[E+2]*U+H[E+3]*k)}let HE=.6-v*v-Y*Y-G*G-N*N;if(HE<0)h=0;else{const E=X[AE+g+X[XE+o+X[RE+Q+X[uE+T]]]]%32*4;HE*=HE,h=HE*HE*(H[E]*v+H[E+1]*Y+H[E+2]*G+H[E+3]*N)}let hE=.6-P*P-EE*EE-tE*tE-zE*zE;if(hE<0)d=0;else{const E=X[AE+1+X[XE+1+X[RE+1+X[uE+1]]]]%32*4;hE*=hE,d=hE*hE*(H[E]*P+H[E+1]*EE+H[E+2]*tE+H[E+3]*zE)}return 27*(R+u+Z+h+d)}}}}]);