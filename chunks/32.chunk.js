/*! For license information please see 02hlnj.32.1d41ae70.chunk.js.LICENSE.txt */
(self["1xyrlsr8vb9"]=self["1xyrlsr8vb9"]||[]).push([[32],{14178:(I,O,C)=>{"use strict";var j=C(14184),K=C(14186),i=C(14194);C.g.__TYPEDARRAY_POOL||(C.g.__TYPEDARRAY_POOL={UINT8:K([32,0]),UINT16:K([32,0]),UINT32:K([32,0]),INT8:K([32,0]),INT16:K([32,0]),INT32:K([32,0]),FLOAT:K([32,0]),DOUBLE:K([32,0]),DATA:K([32,0]),UINT8C:K([32,0]),BUFFER:K([32,0])});var y="undefined"!==typeof Uint8ClampedArray,S=C.g.__TYPEDARRAY_POOL;S.UINT8C||(S.UINT8C=K([32,0])),S.BUFFER||(S.BUFFER=K([32,0]));var U=S.DATA,p=S.BUFFER;function N(I){if(I){var O=I.length||I.byteLength,C=j.log2(O);U[C].push(I)}}function Q(I){I=j.nextPow2(I);var O=j.log2(I),C=U[O];return C.length>0?C.pop():new ArrayBuffer(I)}function s(I){return new Uint8Array(Q(I),0,I)}function Z(I){return new Uint16Array(Q(2*I),0,I)}function q(I){return new Uint32Array(Q(4*I),0,I)}function mI(I){return new Int8Array(Q(I),0,I)}function E(I){return new Int16Array(Q(2*I),0,I)}function h(I){return new Int32Array(Q(4*I),0,I)}function r(I){return new Float32Array(Q(4*I),0,I)}function W(I){return new Float64Array(Q(8*I),0,I)}function Y(I){return y?new Uint8ClampedArray(Q(I),0,I):s(I)}function o(I){return new DataView(Q(I),0,I)}O.free=function(I){if(i(I))p[j.log2(I.length)].push(I);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(I)&&(I=I.buffer),!I)return;var O=I.length||I.byteLength,C=0|j.log2(O);U[C].push(I)}},O.freeUint8=O.freeUint16=O.freeUint32=O.freeInt8=O.freeInt16=O.freeInt32=O.freeFloat32=O.freeFloat=O.freeFloat64=O.freeDouble=O.freeUint8Clamped=O.freeDataView=function(I){N(I.buffer)},O.freeArrayBuffer=N,O.freeBuffer=function(I){p[j.log2(I.length)].push(I)},O.malloc=function(I,O){if(void 0===O||"arraybuffer"===O)return Q(I);switch(O){case"uint8":return s(I);case"uint16":return Z(I);case"uint32":return q(I);case"int8":return mI(I);case"int16":return E(I);case"int32":return h(I);case"float":case"float32":return r(I);case"double":case"float64":return W(I);case"uint8_clamped":return Y(I);case"buffer":throw"Buffer not supported";case"data":case"dataview":return o(I);default:return null}return null},O.mallocArrayBuffer=Q,O.mallocUint8=s,O.mallocUint16=Z,O.mallocUint32=q,O.mallocInt8=mI,O.mallocInt16=E,O.mallocInt32=h,O.mallocFloat32=O.mallocFloat=r,O.mallocFloat64=O.mallocDouble=W,O.mallocUint8Clamped=Y,O.mallocDataView=o,O.clearCache=function(){for(var I=0;I<32;++I)S.UINT8[I].length=0,S.UINT16[I].length=0,S.UINT32[I].length=0,S.INT8[I].length=0,S.INT16[I].length=0,S.INT32[I].length=0,S.FLOAT[I].length=0,S.DOUBLE[I].length=0,S.UINT8C[I].length=0,U[I].length=0,p[I].length=0}},14274:(I,O,C)=>{I.exports=K;var j=C(13035);function K(I,O){if(!(this instanceof K))return new K(I,O);var C=j.create();j.add(C,I,O),this.base=j.min(j.create(),I,C),this.Gp=j.clone(O),this.max=j.max(j.create(),I,C),this.mag=j.length(this.Gp)}var i=K.prototype;i.width=function(){return this.Gp[0]},i.height=function(){return this.Gp[1]},i.depth=function(){return this.Gp[2]},i.x0=function(){return this.base[0]},i.y0=function(){return this.base[1]},i.z0=function(){return this.base[2]},i.x1=function(){return this.max[0]},i.y1=function(){return this.max[1]},i.z1=function(){return this.max[2]},i.translate=function(I){return j.add(this.max,this.max,I),j.add(this.base,this.base,I),this},i.setPosition=function(I){return j.add(this.max,I,this.Gp),j.k(this.base,I),this},i.expand=function(I){var O=j.create(),C=j.create();return j.max(O,I.max,this.max),j.min(C,I.base,this.base),j.EO(O,O,C),new K(C,O)},i.intersects=function(I){return!(I.base[0]>this.max[0])&&(!(I.base[1]>this.max[1])&&(!(I.base[2]>this.max[2])&&(!(I.max[0]<this.base[0])&&(!(I.max[1]<this.base[1])&&!(I.max[2]<this.base[2])))))},i.touches=function(I){var O=this.union(I);return null!==O&&(0==O.width()||0==O.height()||0==O.depth())},i.union=function(I){if(!this.intersects(I))return null;var O=Math.max(I.base[0],this.base[0]),C=Math.max(I.base[1],this.base[1]),j=Math.max(I.base[2],this.base[2]);return new K([O,C,j],[Math.min(I.max[0],this.max[0])-O,Math.min(I.max[1],this.max[1])-C,Math.min(I.max[2],this.max[2])-j])}},14184:(I,O)=>{"use strict";function C(I){var O=32;return(I&=-I)&&O--,65535&I&&(O-=16),16711935&I&&(O-=8),252645135&I&&(O-=4),858993459&I&&(O-=2),1431655765&I&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(I){return(I>0)-(I<0)},O.abs=function(I){var O=I>>31;return(I^O)-O},O.min=function(I,O){return O^(I^O)&-(I<O)},O.max=function(I,O){return I^(I^O)&-(I<O)},O.isPow2=function(I){return!(I&I-1)&&!!I},O.log2=function(I){var O,C;return O=(I>65535)<<4,O|=C=((I>>>=O)>255)<<3,O|=C=((I>>>=C)>15)<<2,(O|=C=((I>>>=C)>3)<<1)|(I>>>=C)>>1},O.log10=function(I){return I>=1e9?9:I>=1e8?8:I>=1e7?7:I>=1e6?6:I>=1e5?5:I>=1e4?4:I>=1e3?3:I>=100?2:I>=10?1:0},O.popCount=function(I){return 16843009*((I=(858993459&(I-=I>>>1&1431655765))+(I>>>2&858993459))+(I>>>4)&252645135)>>>24},O.countTrailingZeros=C,O.nextPow2=function(I){return I+=0===I,--I,I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)+1},O.prevPow2=function(I){return I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)-(I>>>1)},O.parity=function(I){return I^=I>>>16,I^=I>>>8,I^=I>>>4,27030>>>(I&=15)&1};var j=new Array(256);!function(I){for(var O=0;O<256;++O){var C=O,j=O,K=7;for(C>>>=1;C;C>>>=1)j<<=1,j|=1&C,--K;I[O]=j<<K&255}}(j),O.reverse=function(I){return j[255&I]<<24|j[I>>>8&255]<<16|j[I>>>16&255]<<8|j[I>>>24&255]},O.interleave2=function(I,O){return(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(I,O){return(I=65535&((I=16711935&((I=252645135&((I=858993459&((I=I>>>O&1431655765)|I>>>1))|I>>>2))|I>>>4))|I>>>16))<<16>>16},O.interleave3=function(I,O,C){return I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2),(I|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2))<<2},O.deinterleave3=function(I,O){return(I=1023&((I=4278190335&((I=251719695&((I=3272356035&((I=I>>>O&1227133513)|I>>>2))|I>>>4))|I>>>8))|I>>>16))<<22>>22},O.nextCombination=function(I){var O=I|I-1;return O+1|(~O&-~O)-1>>>C(I)+1}},14170:(I,O,C)=>{"use strict";I.exports=function(I,O,C){switch(arguments.length){case 1:return j=[],p(K=I,K,N,!0),j;case 2:return"function"===typeof O?p(I,I,O,!0):function(I,O){return j=[],p(I,O,N,!1),j}(I,O);case 3:return p(I,O,C,!1);default:throw new Error("box-intersect: Invalid arguments")}var K};var j,K=C(14178),i=C(14201),y=C(14211);function S(I,O){for(var C=0;C<I;++C)if(!(O[C]<=O[C+I]))return!0;return!1}function U(I,O,C,j){for(var K=0,i=0,y=0,U=I.length;y<U;++y){var p=I[y];if(!S(O,p)){for(var N=0;N<2*O;++N)C[K++]=p[N];j[i++]=y}}return i}function p(I,O,C,j){var S=I.length,p=O.length;if(!(S<=0||p<=0)){var N=I[0].length>>>1;if(!(N<=0)){var Q,s=K.mallocDouble(2*N*S),Z=K.mallocInt32(S);if((S=U(I,N,s,Z))>0){if(1===N&&j)i.init(S),Q=i.sweepComplete(N,C,0,S,s,Z,0,S,s,Z);else{var q=K.mallocDouble(2*N*p),mI=K.mallocInt32(p);(p=U(O,N,q,mI))>0&&(i.init(S+p),Q=1===N?i.sweepBipartite(N,C,0,S,s,Z,0,p,q,mI):y(N,C,j,S,s,Z,p,q,mI),K.free(q),K.free(mI))}K.free(s),K.free(Z)}return Q}}}function N(I,O){j.push([I,O])}},14218:(I,O)=>{"use strict";var C="d",j="ax",K="fp",i="es",y="rs",S="re",U="rb",p="bs",N="be",Q="bb",s=[C,j,"vv",y,S,U,"ri",p,N,Q,"bi"];function Z(I){var O="bruteForce"+(I?"Full":"Partial"),j=[],y=s.slice();I||y.splice(3,0,K);var S=["function "+O+"("+y.join()+"){"];function U(O,K){var y=function(I,O,j){var K="bruteForce"+(I?"Red":"Blue")+(O?"Flip":"")+(j?"Full":""),y=["function ",K,"(",s.join(),"){","var ",i,"=2*",C,";"],S="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",U="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(j?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return I?y.push(S,"Q",":",U):y.push(U,"Q",":",S),j?y.push("if(y1<x0||x1<y0)continue;"):O?y.push("if(y0<=x0||x1<y0)continue;"):y.push("if(y0<x0||x1<y0)continue;"),y.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),O?y.push("yi,xi"):y.push("xi,yi"),y.push(");if(rv!==void 0)return rv;}}}"),{name:K,code:y.join("")}}(O,K,I);j.push(y.code),S.push("return "+y.name+"("+s.join()+");")}S.push("if(re-rs>be-bs){"),I?(U(!0,!1),S.push("}else{"),U(!1,!1)):(S.push("if(fp){"),U(!0,!0),S.push("}else{"),U(!0,!1),S.push("}}else{if(fp){"),U(!1,!0),S.push("}else{"),U(!1,!1),S.push("}")),S.push("}}return "+O);var p=j.join("")+S.join("");return new Function(p)()}O.partial=Z(!1),O.full=Z(!0)},14211:(I,O,C)=>{"use strict";I.exports=function(I,O,C,i,N,b,a,M,u){!function(I,O){var C=8*K.log2(O+1)*(I+1)|0,i=K.nextPow2(Y*C);c.length<i&&(j.free(c),c=j.mallocInt32(i));var y=K.nextPow2(o*C);n.length<y&&(j.free(n),n=j.mallocDouble(y))}(I,i+a);var J,f=0,l=2*I;X(f++,0,0,i,0,a,C?16:0,-1/0,1/0),C||X(f++,0,0,a,0,i,1,-1/0,1/0);for(;f>0;){var x=(f-=1)*Y,D=c[x],t=c[x+1],d=c[x+2],w=c[x+3],g=c[x+4],V=c[x+5],e=f*o,L=n[e],z=n[e+1],k=1&V,A=!!(16&V),P=N,v=b,B=M,F=u;if(k&&(P=M,v=u,B=N,F=b),!(2&V&&t>=(d=E(I,D,t,d,P,v,z)))&&!(4&V&&(t=h(I,D,t,d,P,v,L))>=d)){var R=d-t,G=g-w;if(A){if(I*R*(R+G)<Z){if(void 0!==(J=U.scanComplete(I,D,O,t,d,P,v,w,g,B,F)))return J;continue}}else{if(I*Math.min(R,G)<Q){if(void 0!==(J=y(I,D,O,k,t,d,P,v,w,g,B,F)))return J;continue}if(I*R*G<s){if(void 0!==(J=U.scanBipartite(I,D,O,k,t,d,P,v,w,g,B,F)))return J;continue}}var II=q(I,D,t,d,P,v,L,z);if(t<II)if(I*(II-t)<Q){if(void 0!==(J=S(I,D+1,O,t,II,P,v,w,g,B,F)))return J}else if(D===I-2){if(void 0!==(J=k?U.sweepBipartite(I,O,w,g,B,F,t,II,P,v):U.sweepBipartite(I,O,t,II,P,v,w,g,B,F)))return J}else X(f++,D+1,t,II,w,g,k,-1/0,1/0),X(f++,D+1,w,g,t,II,1^k,-1/0,1/0);if(II<d){var OI=p(I,D,w,g,B,F),CI=B[l*OI+D],jI=mI(I,D,OI,g,B,F,CI);if(jI<g&&X(f++,D,II,d,jI,g,(4|k)+(A?16:0),CI,z),w<OI&&X(f++,D,II,d,w,OI,(2|k)+(A?16:0),L,CI),OI+1===jI){if(void 0!==(J=A?H(I,D,O,II,d,P,v,OI,B,F[OI]):T(I,D,O,k,II,d,P,v,OI,B,F[OI])))return J}else if(OI<jI){var KI;if(A){if(II<(KI=r(I,D,II,d,P,v,CI))){var iI=mI(I,D,II,KI,P,v,CI);if(D===I-2){if(II<iI&&void 0!==(J=U.sweepComplete(I,O,II,iI,P,v,OI,jI,B,F)))return J;if(iI<KI&&void 0!==(J=U.sweepBipartite(I,O,iI,KI,P,v,OI,jI,B,F)))return J}else II<iI&&X(f++,D+1,II,iI,OI,jI,16,-1/0,1/0),iI<KI&&(X(f++,D+1,iI,KI,OI,jI,0,-1/0,1/0),X(f++,D+1,OI,jI,iI,KI,1,-1/0,1/0))}}else II<(KI=k?W(I,D,II,d,P,v,CI):r(I,D,II,d,P,v,CI))&&(D===I-2?J=k?U.sweepBipartite(I,O,OI,jI,B,F,II,KI,P,v):U.sweepBipartite(I,O,II,KI,P,v,OI,jI,B,F):(X(f++,D+1,II,KI,OI,jI,k,-1/0,1/0),X(f++,D+1,OI,jI,II,KI,1^k,-1/0,1/0)))}}}}};var j=C(14178),K=C(14184),i=C(14218),y=i.partial,S=i.full,U=C(14201),p=C(14220),N=C(14228),Q=128,s=1<<22,Z=1<<22,q=N("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),mI=N("lo===p0",["p0"]),E=N("lo<p0",["p0"]),h=N("hi<=p0",["p0"]),r=N("lo<=p0&&p0<=hi",["p0"]),W=N("lo<p0&&p0<=hi",["p0"]),Y=6,o=2,c=j.mallocInt32(1024),n=j.mallocDouble(1024);function X(I,O,C,j,K,i,y,S,U){var p=Y*I;c[p]=O,c[p+1]=C,c[p+2]=j,c[p+3]=K,c[p+4]=i,c[p+5]=y;var N=o*I;n[N]=S,n[N+1]=U}function T(I,O,C,j,K,i,y,S,U,p,N){var Q=2*I,s=U*Q,Z=p[s+O];I:for(var q=K,mI=K*Q;q<i;++q,mI+=Q){var E=y[mI+O],h=y[mI+O+I];if(!(Z<E||h<Z)&&(!j||Z!==E)){for(var r,W=S[q],Y=O+1;Y<I;++Y){E=y[mI+Y],h=y[mI+Y+I];var o=p[s+Y],c=p[s+Y+I];if(h<o||c<E)continue I}if(void 0!==(r=j?C(N,W):C(W,N)))return r}}}function H(I,O,C,j,K,i,y,S,U,p){var N=2*I,Q=S*N,s=U[Q+O];I:for(var Z=j,q=j*N;Z<K;++Z,q+=N){var mI=y[Z];if(mI!==p){var E=i[q+O],h=i[q+O+I];if(!(s<E||h<s)){for(var r=O+1;r<I;++r){E=i[q+r],h=i[q+r+I];var W=U[Q+r],Y=U[Q+r+I];if(h<W||Y<E)continue I}var o=C(mI,p);if(void 0!==o)return o}}}}},14220:(I,O,C)=>{"use strict";I.exports=function(I,O,C,y,S,U){if(y<=C+1)return C;var p=C,N=y,Q=y+C>>>1,s=2*I,Z=Q,q=S[s*Q+O];for(;p<N;){if(N-p<K){i(I,O,p,N,S,U),q=S[s*Q+O];break}var mI=N-p,E=Math.random()*mI+p|0,h=S[s*E+O],r=Math.random()*mI+p|0,W=S[s*r+O],Y=Math.random()*mI+p|0,o=S[s*Y+O];h<=W?o>=W?(Z=r,q=W):h>=o?(Z=E,q=h):(Z=Y,q=o):W>=o?(Z=r,q=W):o>=h?(Z=E,q=h):(Z=Y,q=o);for(var c=s*(N-1),n=s*Z,X=0;X<s;++X,++c,++n){var T=S[c];S[c]=S[n],S[n]=T}var H=U[N-1];U[N-1]=U[Z],U[Z]=H;for(c=s*(N-1),n=s*(Z=j(I,O,p,N-1,S,U,q)),X=0;X<s;++X,++c,++n){T=S[c];S[c]=S[n],S[n]=T}H=U[N-1];if(U[N-1]=U[Z],U[Z]=H,Q<Z){for(N=Z-1;p<N&&S[s*(N-1)+O]===q;)N-=1;N+=1}else{if(!(Z<Q))break;for(p=Z+1;p<N&&S[s*p+O]===q;)p+=1}}return j(I,O,C,Q,S,U,S[s*Q+O])};var j=C(14228)("lo<p0",["p0"]),K=8;function i(I,O,C,j,K,i){for(var y=2*I,S=y*(C+1)+O,U=C+1;U<j;++U,S+=y)for(var p=K[S],N=U,Q=y*(U-1);N>C&&K[Q+O]>p;--N,Q-=y){for(var s=Q,Z=Q+y,q=0;q<y;++q,++s,++Z){var mI=K[s];K[s]=K[Z],K[Z]=mI}var E=i[N];i[N]=i[N-1],i[N-1]=E}}},14228:I=>{"use strict";I.exports=function(I,C){var j="abcdef".split("").concat(C),K=[];I.indexOf("lo")>=0&&K.push("lo=e[k+n]");I.indexOf("hi")>=0&&K.push("hi=e[k+o]");return j.push(O.replace("_",K.join()).replace("$",I)),Function.apply(void 0,j)};var O="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14207:I=>{"use strict";I.exports=function(I,j){j<=4*O?C(0,j-1,I):p(0,j-1,I)};var O=32;function C(I,O,C){for(var j=2*(I+1),K=I+1;K<=O;++K){for(var i=C[j++],y=C[j++],S=K,U=j-2;S-- >I;){var p=C[U-2],N=C[U-1];if(p<i)break;if(p===i&&N<y)break;C[U]=p,C[U+1]=N,U-=2}C[U]=i,C[U+1]=y}}function j(I,O,C){O*=2;var j=C[I*=2],K=C[I+1];C[I]=C[O],C[I+1]=C[O+1],C[O]=j,C[O+1]=K}function K(I,O,C){O*=2,C[I*=2]=C[O],C[I+1]=C[O+1]}function i(I,O,C,j){O*=2,C*=2;var K=j[I*=2],i=j[I+1];j[I]=j[O],j[I+1]=j[O+1],j[O]=j[C],j[O+1]=j[C+1],j[C]=K,j[C+1]=i}function y(I,O,C,j,K){O*=2,K[I*=2]=K[O],K[O]=C,K[I+1]=K[O+1],K[O+1]=j}function S(I,O,C){O*=2;var j=C[I*=2],K=C[O];return!(j<K)&&(j!==K||C[I+1]>C[O+1])}function U(I,O,C,j){var K=j[I*=2];return K<O||K===O&&j[I+1]<C}function p(I,N,Q){var s=(N-I+1)/6|0,Z=I+s,q=N-s,mI=I+N>>1,E=mI-s,h=mI+s,r=Z,W=E,Y=mI,o=h,c=q,n=I+1,X=N-1,T=0;S(r,W,Q)&&(T=r,r=W,W=T),S(o,c,Q)&&(T=o,o=c,c=T),S(r,Y,Q)&&(T=r,r=Y,Y=T),S(W,Y,Q)&&(T=W,W=Y,Y=T),S(r,o,Q)&&(T=r,r=o,o=T),S(Y,o,Q)&&(T=Y,Y=o,o=T),S(W,c,Q)&&(T=W,W=c,c=T),S(W,Y,Q)&&(T=W,W=Y,Y=T),S(o,c,Q)&&(T=o,o=c,c=T);for(var H=Q[2*W],b=Q[2*W+1],a=Q[2*o],M=Q[2*o+1],u=2*r,J=2*Y,f=2*c,l=2*Z,x=2*mI,D=2*q,t=0;t<2;++t){var d=Q[u+t],w=Q[J+t],g=Q[f+t];Q[l+t]=d,Q[x+t]=w,Q[D+t]=g}K(E,I,Q),K(h,N,Q);for(var V=n;V<=X;++V)if(U(V,H,b,Q))V!==n&&j(V,n,Q),++n;else if(!U(V,a,M,Q))for(;;){if(U(X,a,M,Q)){U(X,H,b,Q)?(i(V,n,X,Q),++n,--X):(j(V,X,Q),--X);break}if(--X<V)break}y(I,n-1,H,b,Q),y(N,X+1,a,M,Q),n-2-I<=O?C(I,n-2,Q):p(I,n-2,Q),N-(X+2)<=O?C(X+2,N,Q):p(X+2,N,Q),X-n<=O?C(n,X,Q):p(n,X,Q)}},14201:(I,O,C)=>{"use strict";I.exports={init:function(I){var O=K.nextPow2(I);U.length<O&&(j.free(U),U=j.mallocInt32(O));p.length<O&&(j.free(p),p=j.mallocInt32(O));N.length<O&&(j.free(N),N=j.mallocInt32(O));Q.length<O&&(j.free(Q),Q=j.mallocInt32(O));s.length<O&&(j.free(s),s=j.mallocInt32(O));Z.length<O&&(j.free(Z),Z=j.mallocInt32(O));var C=8*O;q.length<C&&(j.free(q),q=j.mallocDouble(C))},sweepBipartite:function(I,O,C,j,K,S,s,Z,h,r){for(var W=0,Y=2*I,o=I-1,c=Y-1,n=C;n<j;++n){var X=S[n],T=Y*n;q[W++]=K[T+o],q[W++]=-(X+1),q[W++]=K[T+c],q[W++]=X}for(n=s;n<Z;++n){X=r[n]+y;var H=Y*n;q[W++]=h[H+o],q[W++]=-X,q[W++]=h[H+c],q[W++]=X}var b=W>>>1;i(q,b);var a=0,M=0;for(n=0;n<b;++n){var u=0|q[2*n+1];if(u>=y)mI(N,Q,M--,u=u-y|0);else if(u>=0)mI(U,p,a--,u);else if(u<=-y){u=-u-y|0;for(var J=0;J<a;++J){if(void 0!==(f=O(U[J],u)))return f}E(N,Q,M++,u)}else{u=-u-1|0;for(J=0;J<M;++J){var f;if(void 0!==(f=O(u,N[J])))return f}E(U,p,a++,u)}}},sweepComplete:function(I,O,C,j,K,y,S,h,r,W){for(var Y=0,o=2*I,c=I-1,n=o-1,X=C;X<j;++X){var T=y[X]+1<<1,H=o*X;q[Y++]=K[H+c],q[Y++]=-T,q[Y++]=K[H+n],q[Y++]=T}for(X=S;X<h;++X){T=W[X]+1<<1;var b=o*X;q[Y++]=r[b+c],q[Y++]=1|-T,q[Y++]=r[b+n],q[Y++]=1|T}var a=Y>>>1;i(q,a);var M=0,u=0,J=0;for(X=0;X<a;++X){var f=0|q[2*X+1],l=1&f;if(X<a-1&&f>>1===q[2*X+3]>>1&&(l=2,X+=1),f<0){for(var x=-(f>>1)-1,D=0;D<J;++D){if(void 0!==(t=O(s[D],x)))return t}if(0!==l)for(D=0;D<M;++D){if(void 0!==(t=O(U[D],x)))return t}if(1!==l)for(D=0;D<u;++D){var t;if(void 0!==(t=O(N[D],x)))return t}0===l?E(U,p,M++,x):1===l?E(N,Q,u++,x):2===l&&E(s,Z,J++,x)}else{x=(f>>1)-1;0===l?mI(U,p,M--,x):1===l?mI(N,Q,u--,x):2===l&&mI(s,Z,J--,x)}}},scanBipartite:function(I,O,C,j,K,S,N,Q,s,Z,h,r){var W=0,Y=2*I,o=O,c=O+I,n=1,X=1;j?X=y:n=y;for(var T=K;T<S;++T){var H=T+n,b=Y*T;q[W++]=N[b+o],q[W++]=-H,q[W++]=N[b+c],q[W++]=H}for(T=s;T<Z;++T){H=T+X;var a=Y*T;q[W++]=h[a+o],q[W++]=-H}var M=W>>>1;i(q,M);var u=0;for(T=0;T<M;++T){var J=0|q[2*T+1];if(J<0){var f=!1;if((H=-J)>=y?(f=!j,H-=y):(f=!!j,H-=1),f)E(U,p,u++,H);else{var l=r[H],x=Y*H,D=h[x+O+1],t=h[x+O+1+I];I:for(var d=0;d<u;++d){var w=U[d],g=Y*w;if(!(t<N[g+O+1]||N[g+O+1+I]<D)){for(var V=O+2;V<I;++V)if(h[x+V+I]<N[g+V]||N[g+V+I]<h[x+V])continue I;var e,L=Q[w];if(void 0!==(e=j?C(l,L):C(L,l)))return e}}}}else mI(U,p,u--,J-n)}},scanComplete:function(I,O,C,j,K,S,p,N,Q,s,Z){for(var mI=0,E=2*I,h=O,r=O+I,W=j;W<K;++W){var Y=W+y,o=E*W;q[mI++]=S[o+h],q[mI++]=-Y,q[mI++]=S[o+r],q[mI++]=Y}for(W=N;W<Q;++W){Y=W+1;var c=E*W;q[mI++]=s[c+h],q[mI++]=-Y}var n=mI>>>1;i(q,n);var X=0;for(W=0;W<n;++W){var T=0|q[2*W+1];if(T<0){if((Y=-T)>=y)U[X++]=Y-y;else{var H=Z[Y-=1],b=E*Y,a=s[b+O+1],M=s[b+O+1+I];I:for(var u=0;u<X;++u){var J=U[u],f=p[J];if(f===H)break;var l=E*J;if(!(M<S[l+O+1]||S[l+O+1+I]<a)){for(var x=O+2;x<I;++x)if(s[b+x+I]<S[l+x]||S[l+x+I]<s[b+x])continue I;var D=C(f,H);if(void 0!==D)return D}}}}else{for(Y=T-y,u=X-1;u>=0;--u)if(U[u]===Y){for(x=u+1;x<X;++x)U[x-1]=U[x];break}--X}}}};var j=C(14178),K=C(14184),i=C(14207),y=1<<28,S=1024,U=j.mallocInt32(S),p=j.mallocInt32(S),N=j.mallocInt32(S),Q=j.mallocInt32(S),s=j.mallocInt32(S),Z=j.mallocInt32(S),q=j.mallocDouble(8192);function mI(I,O,C,j){var K=O[j],i=I[C-1];I[K]=i,O[i]=K}function E(I,O,C,j){I[C]=j,O[j]=C}},14186:I=>{"use strict";function O(I,C,j){var K=0|I[j];if(K<=0)return[];var i,y=new Array(K);if(j===I.length-1)for(i=0;i<K;++i)y[i]=C;else for(i=0;i<K;++i)y[i]=O(I,C,j+1);return y}I.exports=function(I,C){switch("undefined"===typeof C&&(C=0),typeof I){case"number":if(I>0)return function(I,O){var C,j;for(C=new Array(I),j=0;j<I;++j)C[j]=O;return C}(0|I,C);break;case"object":if("number"===typeof I.length)return O(I,C,0)}return[]}},14151:(I,O,C)=>{I.exports=function(){var I=this;this.components={},this.comps=this.components;var O=this.components,C=1,K={},i=[],y=[],S={timeout:!1,removals:[],multiComps:[]};function U(I,C){var j=O[C],i=K[C],y=i.hash[I];y&&(i.remove(I),j.XC&&(j.multi?(y.forEach((O=>{O&&j.XC(I,O)})),y.length=0):j.XC(I,y)),S.removals.push(i),p())}function p(){S.timeout||(S.timeout=!0,setTimeout(N,1))}function N(){S.timeout=!1,Q()}function Q(){S.multiComps.length&&function(I){for(var O=0;O<I.length;O++){var{entID:C,data:j}=I[O],K=j.hash[C];if(K){for(var i=0;i<K.length;i++)K[i]||(K.splice(i,1),i--);0===K.length&&(j.remove(C),S.removals.push(j))}}I.length=0}(S.multiComps),S.removals.length&&function(I){for(var O=0;O<I.length;O++){I[O].flush()}I.length=0}(S.removals)}this.ZQ=K,this._systems=i,this._renderSystems=y,this.CN=function(O){var j=C++;return Array.isArray(O)&&O.forEach((O=>I.dU(j,O))),j},this.deleteEntity=function(O){return Object.keys(K).forEach((I=>{K[I].hash[O]&&U(O,I)})),I},this.hN=function(I){if(!I)throw new Error("Missing component definition");var C=I.name;if(!C)throw new Error("Component definition must have a name property.");if("string"!==typeof C)throw new Error("Component name must be a string.");if(""===C)throw new Error("Component name must be a non-empty string.");if(K[C])throw new Error(`Component ${C} already exists.`);var S={};return S.name=C,S.multi=!!I.multi,S.order=isNaN(I.order)?99:I.order,S.stateConstructor=I.stateConstructor||null,S.state=I.state||{},S.DS=I.DS||null,S.XC=I.XC||null,S.system=I.system||null,S.eS=I.eS||null,O[C]=S,K[C]=new j,K[C]._pendingMultiCleanup=!1,K[C]._multiCleanupIDs=S.multi?[]:null,S.system&&(i.push(C),i.sort(((I,C)=>O[I].order-O[C].order))),S.eS&&(y.push(C),y.sort(((I,C)=>O[I].order-O[C].order))),C},this.overwriteComponent=function(I,C){var j=O[I];if(!j)throw new Error(`Unknown component: ${I}`);if(!C)throw new Error("Missing component definition");if(j.name!==C.name)throw new Error("Overwriting component must use the same name property.");var S={};S.name=I,S.multi=!!C.multi,S.order=isNaN(C.order)?99:C.order,S.state=C.state||{},S.DS=C.DS||null,S.XC=C.XC||null,S.system=C.system||null,S.eS=C.eS||null,O[I]=S,K[I]._pendingMultiCleanup=!1,K[I]._multiCleanupIDs=S.multi?[]:null;var U=i.indexOf(I);S.system&&U<0&&i.push(I),!S.system&&U>=0&&i.splice(U,1),i.sort(((I,C)=>O[I].order-O[C].order));var p=y.indexOf(I);S.eS&&p<0&&y.push(I),!S.eS&&p>=0&&y.splice(p,1),y.sort(((I,C)=>O[I].order-O[C].order));var N=S.state;return this.tp(I).forEach((I=>{for(var O in N)O in I||(I[O]=N[O]);S.DS&&S.DS(I.gS,I)})),I},this.deleteComponent=function(C){var j=K[C];if(!j)throw new Error(`Unknown component: ${C}`);j.flush(),j.list.forEach((I=>{I&&U(I.gS||I[0].gS,C)}));var S=i.indexOf(C),p=y.indexOf(C);return S>-1&&i.splice(S,1),p>-1&&y.splice(p,1),K[C].dispose(),delete K[C],delete O[C],I},this.dU=function(I,C,j){var i,y=O[C],S=K[C];if(!S)throw new Error(`Unknown component: ${C}.`);if(S.hash[I]&&!y.multi)throw new Error(`Entity ${I} already has component: ${C}.`);if(y.stateConstructor){if(!(i=new y.stateConstructor).hasOwnProperty("gS"))throw new Error(`Component ${y.name} stateConstructor type does not have property __id`)}else i=Object.assign({},{gS:I},y.state,j);if(i.gS=I,y.multi){var U=S.hash[I];U||(U=[],S.add(I,U)),U.push(i)}else S.add(I,i);return y.DS&&y.DS(I,i),this},this.vU=function(I,O){var C=K[O];if(!C)throw new Error(`Unknown component: ${O}.`);return!!C.hash[I]},this.eU=function(O,C){if(!K[C])throw new Error(`Unknown component: ${C}.`);return U(O,C),I},this.getState=function(I,O){var C=K[O];if(!C)throw new Error(`Unknown component: ${O}.`);return C.hash[I]},this.tp=function(I){var O=K[I];if(!O)throw new Error(`Unknown component: ${I}.`);return Q(),O.list},this.KZ=function(I){if(!K[I])throw new Error(`Unknown component: ${I}.`);var O=K[I].hash;return I=>O[I]},this.SZ=function(I){if(!K[I])throw new Error(`Unknown component: ${I}.`);var O=K[I].hash;return I=>!!O[I]},this.OS=function(C){Q();for(var j=0;j<i.length;j++){var y=i[j],S=O[y],U=K[y];S.system(C,U.list),Q()}return I},this.render=function(C){Q();for(var j=0;j<y.length;j++){var i=y[j],S=O[i],U=K[i];S.eS(C,U.list),Q()}return I},this.removeMultiComponent=function(C,j,i){var y=O[j],U=K[j];if(!U)throw new Error(`Unknown component: ${j}.`);if(!y.multi)throw new Error("removeMultiComponent called on non-multi component");return function(I,O,C,j){var K=C.hash[I];if(K){var i=K[j];i&&(K[j]=null,O.XC&&O.XC(I,i),S.multiComps.push({entID:I,data:C}),p())}}(C,y,U,i),I}};var j=C(14154)},14154:I=>{function O(I,O){var C=I._map[O];if(delete I.hash[O],delete I._map[O],C===I.list.length-1)I.list.pop();else{var j=I.list.pop();if(I.list[C]=j,null===j||null===j[0]){var K=I.list.length;for(var i in I._map)if(I._map[i]===K)return void(I._map[i]=C)}else{var y=j.gS||j[0].gS;I._map[y]=C}}}I.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(I,O){if("number"===typeof this._map[I]){var C=this._map[I];this.hash[I]=O,this.list[C]=O}else this._map[I]=this.list.length,this.hash[I]=O,this.list.push(O)}remove(I){var O=this._map[I];this.hash[I]=null,this.list[O]=null,this._pendingRemovals.push(I)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var I=0;I<this._pendingRemovals.length;I++){var C=this._pendingRemovals[I];null===this.hash[C]&&O(this,C)}this._pendingRemovals.length=0}}},14108:I=>{"use strict";var O,C="object"===typeof Reflect?Reflect:null,j=function(I,O,C){return Function.prototype.apply.call(I,O,C)};O=C&&"function"===typeof C.ownKeys?C.ownKeys:Object.getOwnPropertySymbols?function(I){return Object.getOwnPropertyNames(I).concat(Object.getOwnPropertySymbols(I))}:function(I){return Object.getOwnPropertyNames(I)};var K=Number.isNaN||function(I){return I!==I};function i(){i.init.call(this)}I.exports=i,I.exports.once=function(I,O){return new Promise((function(C,j){function K(C){I.removeListener(O,i),j(C)}function i(){"function"===typeof I.removeListener&&I.removeListener("error",K),C([].slice.call(arguments))}mI(I,O,i,{once:!0}),"error"!==O&&function(I,O,C){"function"===typeof I.on&&mI(I,"error",O,C)}(I,K,{once:!0})}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var y=10;function S(I){if("function"!==typeof I)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof I)}function U(I){return void 0===I._maxListeners?i.defaultMaxListeners:I._maxListeners}function p(I,O,C,j){var K,i,y,p;if(S(C),void 0===(i=I._events)?(i=I._events=Object.create(null),I._eventsCount=0):(void 0!==i.newListener&&(I.emit("newListener",O,C.listener?C.listener:C),i=I._events),y=i[O]),void 0===y)y=i[O]=C,++I._eventsCount;else if("function"===typeof y?y=i[O]=j?[C,y]:[y,C]:j?y.unshift(C):y.push(C),(K=U(I))>0&&y.length>K&&!y.warned){y.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+y.length+" "+String(O)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.KO=I,N.type=O,N.count=y.length,p=N,console&&console.warn&&console.warn(p)}return I}function N(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Q(I,O,C){var j={fired:!1,wrapFn:void 0,target:I,type:O,listener:C},K=N.bind(j);return K.listener=C,j.wrapFn=K,K}function s(I,O,C){var j=I._events;if(void 0===j)return[];var K=j[O];return void 0===K?[]:"function"===typeof K?C?[K.listener||K]:[K]:C?function(I){for(var O=new Array(I.length),C=0;C<O.length;++C)O[C]=I[C].listener||I[C];return O}(K):q(K,K.length)}function Z(I){var O=this._events;if(void 0!==O){var C=O[I];if("function"===typeof C)return 1;if(void 0!==C)return C.length}return 0}function q(I,O){for(var C=new Array(O),j=0;j<O;++j)C[j]=I[j];return C}function mI(I,O,C,j){if("function"===typeof I.on)j.once?I.once(O,C):I.on(O,C);else{if("function"!==typeof I.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof I);I.addEventListener(O,(function K(i){j.once&&I.removeEventListener(O,K),C(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return y},set:function(I){if("number"!==typeof I||I<0||K(I))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+I+".");y=I}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(I){if("number"!==typeof I||I<0||K(I))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+I+".");return this._maxListeners=I,this},i.prototype.getMaxListeners=function(){return U(this)},i.prototype.emit=function(I){for(var O=[],C=1;C<arguments.length;C++)O.push(arguments[C]);var K="error"===I,i=this._events;if(void 0!==i)K=K&&void 0===i.error;else if(!K)return!1;if(K){var y;if(O.length>0&&(y=O[0]),y instanceof Error)throw y;var S=new Error("Unhandled error."+(y?" ("+y.message+")":""));throw S.context=y,S}var U=i[I];if(void 0===U)return!1;if("function"===typeof U)j(U,this,O);else{var p=U.length,N=q(U,p);for(C=0;C<p;++C)j(N[C],this,O)}return!0},i.prototype.addListener=function(I,O){return p(this,I,O,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(I,O){return p(this,I,O,!0)},i.prototype.once=function(I,O){return S(O),this.on(I,Q(this,I,O)),this},i.prototype.prependOnceListener=function(I,O){return S(O),this.prependListener(I,Q(this,I,O)),this},i.prototype.removeListener=function(I,O){var C,j,K,i,y;if(S(O),void 0===(j=this._events))return this;if(void 0===(C=j[I]))return this;if(C===O||C.listener===O)0===--this._eventsCount?this._events=Object.create(null):(delete j[I],j.removeListener&&this.emit("removeListener",I,C.listener||O));else if("function"!==typeof C){for(K=-1,i=C.length-1;i>=0;i--)if(C[i]===O||C[i].listener===O){y=C[i].listener,K=i;break}if(K<0)return this;0===K?C.shift():function(I,O){for(;O+1<I.length;O++)I[O]=I[O+1];I.pop()}(C,K),1===C.length&&(j[I]=C[0]),void 0!==j.removeListener&&this.emit("removeListener",I,y||O)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.iO=function(I){var O,C,j;if(void 0===(C=this._events))return this;if(void 0===C.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==C[I]&&(0===--this._eventsCount?this._events=Object.create(null):delete C[I]),this;if(0===arguments.length){var K,i=Object.keys(C);for(j=0;j<i.length;++j)"removeListener"!==(K=i[j])&&this.iO(K);return this.iO("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(O=C[I]))this.removeListener(I,O);else if(void 0!==O)for(j=O.length-1;j>=0;j--)this.removeListener(I,O[j]);return this},i.prototype.listeners=function(I){return s(this,I,!0)},i.prototype.rawListeners=function(I){return s(this,I,!1)},i.listenerCount=function(I,O){return"function"===typeof I.listenerCount?I.listenerCount(O):Z.call(I,O)},i.prototype.listenerCount=Z,i.prototype.eventNames=function(){return this._eventsCount>0?O(this._events):[]}},14389:I=>{"use strict";I.exports=function(I,O,C,j,K,i){var y=+O[0],S=+O[1],U=+O[2],p=+C[0],N=+C[1],Q=+C[2],s=Math.sqrt(p*p+N*N+Q*Q);if(0===s)throw new Error("Can't raycast along a zero vector");return function(I,O,C,j,K,i,y,S,U,p){for(var N=0,Q=Math.floor,s=0|Q(O),Z=0|Q(C),q=0|Q(j),mI=K>0?1:-1,E=i>0?1:-1,h=y>0?1:-1,r=Math.abs(1/K),W=Math.abs(1/i),Y=Math.abs(1/y),o=r<1/0?r*(mI>0?s+1-O:O-s):1/0,c=W<1/0?W*(E>0?Z+1-C:C-Z):1/0,n=Y<1/0?Y*(h>0?q+1-j:j-q):1/0,X=-1;N<=S;){var T=I(s,Z,q);if(T)return U&&(U[0]=O+N*K,U[1]=C+N*i,U[2]=j+N*y),p&&(p[0]=p[1]=p[2]=0,0===X&&(p[0]=-mI),1===X&&(p[1]=-E),2===X&&(p[2]=-h)),T;o<c?o<n?(s+=mI,N=o,o+=r,X=0):(q+=h,N=n,n+=Y,X=2):c<n?(Z+=E,N=c,c+=W,X=1):(q+=h,N=n,n+=Y,X=2)}return U&&(U[0]=O+N*K,U[1]=C+N*i,U[2]=j+N*y),p&&(p[0]=p[1]=p[2]=0),0}(I,y,S,U,p/=s,N/=s,Q/=s,j="undefined"===typeof j?64:+j,K,i)}},14428:(I,O,C)=>{"use strict";C.d(O,{e:()=>i});var j=C(14108);function K(){this.js=!1,this.stopPropagation=!1,this.Ks=!1,this.disabled=!1}class i{constructor(I,O){this.version="0.7.0";var C=Object.assign({},new K,O||{});this.element=I||document,this.js=!!C.js,this.stopPropagation=!!C.stopPropagation,this.Ks=!!C.Ks,this.disabled=!!C.disabled,this.filterEvents=(I,O)=>!0,this.down=new j.EventEmitter,this.up=new j.EventEmitter,this.state={},this.upI={dx:0,dy:0,vs:0,Mp:0,Bs:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?S(this):document.addEventListener("DOMContentLoaded",(I=>{S(this)}),{once:!0})}bind(I){for(var O=arguments.length,C=new Array(O>1?O-1:0),j=1;j<O;j++)C[j-1]=arguments[j];C.forEach((O=>{var C=this._keyBindmap[O]||[];C.includes(I)||(C.push(I),this._keyBindmap[O]=C)})),this.state[I]=!!this.state[I],this.pressCount[I]=this.pressCount[I]||0,this.releaseCount[I]=this.releaseCount[I]||0}unbind(I){for(var O in this._keyBindmap){var C=this._keyBindmap[O],j=C.indexOf(I);j>-1&&C.splice(j,1)}}getBindings(){var I={};for(var O in this._keyBindmap){this._keyBindmap[O].forEach((C=>{I[C]=I[C]||[],I[C].push(O)}))}return I}OS(){y(this.upI),y(this.pressCount),y(this.releaseCount)}}function y(I){for(var O in I)I[O]=0}function S(I){window.addEventListener("keydown",q.bind(null,I,!0),!1),window.addEventListener("keyup",q.bind(null,I,!1),!1);var O={passive:!0};I.element.addEventListener("touchstart",Q.bind(void 0,I),{passive:!1}),I.element.addEventListener("touchend",Z.bind(void 0,I),O),I.element.addEventListener("mousedown",mI.bind(null,I,!0),O),window.document.addEventListener("mouseup",mI.bind(null,I,!1),O),I.element.addEventListener("touchmove",E.bind(null,I),O),I.element.addEventListener("mousemove",E.bind(null,I),O),window.PointerEvent,I.element.addEventListener("wheel",h.bind(null,I),O),I.element.addEventListener("contextmenu",r.bind(null,I),!1),window.addEventListener("blur",W.bind(null,I),!1)}var U=0,p=0,N=null;function Q(I,O){O.preventDefault(),s(O)}function s(I){let O=!1;for(let C=0;C<I.touches.length;++C)if(I.touches[C].identifier===N){O=!0;break}if(!O){const O=I.changedTouches[0];U=O.clientX,p=O.clientY,N=O.identifier}}function Z(I,O){for(var C=O.changedTouches,j=0;j<C.length;++j)C[j].identifier===N&&(N=null)}function q(I,O,C){Y(C.code,O,I,C)}function mI(I,O,C){if("pointerId"in C)if(O){if(null!==I._touches.currID)return;I._touches.currID=C.pointerId}else{if(I._touches.currID!==C.pointerId)return;I._touches.currID=null}return Y("Mouse"+("button"in C?C.button+1:1),O,I,C),!1}function E(I,O){var C=O.movementX||O.mozMovementX||0,j=O.movementY||O.mozMovementY||0;if(O.touches&&0===(C|j)){var K=function(I){s(I);for(let O=0;O<I.changedTouches.length;++O)if(I.changedTouches[O].identifier==N){const C=I.changedTouches[O],j=[C.clientX-U,C.clientY-p];return U=C.clientX,p=C.clientY,j}return console.error(`Did not find touch id ${N}`),[0,0]}(O);C=K[0],j=K[1]}I.upI.dx+=C,I.upI.dy+=j}function h(I,O){var C=1;switch(O.deltaMode){case 0:C=1;break;case 1:C=12;break;case 2:C=I.element.clientHeight||window.innerHeight}I.upI.vs+=(O.deltaX||0)*C,I.upI.Mp+=(O.deltaY||0)*C,I.upI.Bs+=(O.deltaZ||0)*C}function r(I,O){if(!I.Ks)return O.preventDefault(),!1}function W(I){for(var O in I._keyStates)I._keyStates[O]&&(/^Mouse\d/.test(O)||Y(O,!1,I,{code:O,note:"ugu0haz10mq",preventDefault:()=>{},stopPropagation:()=>{}}))}function Y(I,O,C,j){var K=C._keyBindmap[I];K&&(o(C._keyStates[I],O)&&(C._keyStates[I]=O,K.forEach((I=>{(!C.filterEvents||C.filterEvents(j,I))&&function(I,O,C,j){var K=O?C.pressCount:C.releaseCount;K[I]=(K[I]||0)+1;var i=C._bindPressCount[I]||0;(i+=O?1:-1)<0&&(i=0);C._bindPressCount[I]=i;var y=C.state[I];if(o(y,i)){C.state[I]=i>0;var S=O?C.down:C.up;C.disabled||S.emit(I,j)}}(I,O,C,j)}))),"button"in j||(C.js&&!j.defaultPrevented&&j.preventDefault(),C.stopPropagation&&j.stopPropagation()))}function o(I,O){return I?!O:O}},13095:I=>{I.exports=function(I,O,C){return I[0]=O[0]+C[0],I[1]=O[1]+C[1],I[2]=O[2]+C[2],I}},13057:(I,O,C)=>{I.exports=function(I,O){var C=j(I[0],I[1],I[2]),y=j(O[0],O[1],O[2]);K(C,C),K(y,y);var S=i(C,y);return S>1?0:Math.acos(S)};var j=C(13060),K=C(13065),i=C(13072)},13141:I=>{I.exports=function(I,O){return I[0]=Math.ceil(O[0]),I[1]=Math.ceil(O[1]),I[2]=Math.ceil(O[2]),I}},13053:I=>{I.exports=function(I){var O=new Float32Array(3);return O[0]=I[0],O[1]=I[1],O[2]=I[2],O}},13074:I=>{I.exports=function(I,O){return I[0]=O[0],I[1]=O[1],I[2]=O[2],I}},13045:I=>{I.exports=function(){var I=new Float32Array(3);return I[0]=0,I[1]=0,I[2]=0,I}},13205:I=>{I.exports=function(I,O,C){var j=O[0],K=O[1],i=O[2],y=C[0],S=C[1],U=C[2];return I[0]=K*U-i*S,I[1]=i*y-j*U,I[2]=j*S-K*y,I}},13157:(I,O,C)=>{I.exports=C(13154)},13154:I=>{I.exports=function(I,O){var C=O[0]-I[0],j=O[1]-I[1],K=O[2]-I[2];return Math.sqrt(C*C+j*j+K*K)}},13124:(I,O,C)=>{I.exports=C(13118)},13118:I=>{I.exports=function(I,O,C){return I[0]=O[0]/C[0],I[1]=O[1]/C[1],I[2]=O[2]/C[2],I}},13072:I=>{I.exports=function(I,O){return I[0]*O[0]+I[1]*O[1]+I[2]*O[2]}},13039:I=>{I.exports=1e-6},13085:(I,O,C)=>{I.exports=function(I,O){var C=I[0],K=I[1],i=I[2],y=O[0],S=O[1],U=O[2];return Math.abs(C-y)<=j*Math.max(1,Math.abs(C),Math.abs(y))&&Math.abs(K-S)<=j*Math.max(1,Math.abs(K),Math.abs(S))&&Math.abs(i-U)<=j*Math.max(1,Math.abs(i),Math.abs(U))};var j=C(13039)},13090:I=>{I.exports=function(I,O){return I[0]===O[0]&&I[1]===O[1]&&I[2]===O[2]}},13133:I=>{I.exports=function(I,O){return I[0]=Math.floor(O[0]),I[1]=Math.floor(O[1]),I[2]=Math.floor(O[2]),I}},13240:(I,O,C)=>{I.exports=function(I,O,C,K,i,y){var S,U;O||(O=3);C||(C=0);U=K?Math.min(K*O+C,I.length):I.length;for(S=C;S<U;S+=O)j[0]=I[S],j[1]=I[S+1],j[2]=I[S+2],i(j,j,y),I[S]=j[0],I[S+1]=j[1],I[S+2]=j[2];return I};var j=C(13045)()},13060:I=>{I.exports=function(I,O,C){var j=new Float32Array(3);return j[0]=I,j[1]=O,j[2]=C,j}},13035:(I,O,C)=>{I.exports={EPSILON:C(13039),create:C(13045),clone:C(13053),angle:C(13057),ky:C(13060),k:C(13074),set:C(13083),equals:C(13085),exactEquals:C(13090),add:C(13095),EO:C(13103),sub:C(13105),multiply:C(13108),mul:C(13113),divide:C(13118),div:C(13124),min:C(13126),max:C(13130),floor:C(13133),ceil:C(13141),round:C(13145),scale:C(13148),Ay:C(13152),distance:C(13154),j:C(13157),squaredDistance:C(13163),sqrDist:C(13169),length:C(13174),len:C(13176),squaredLength:C(13184),Py:C(13190),negate:C(13196),inverse:C(13199),normalize:C(13065),dot:C(13072),cross:C(13205),ey:C(13211),random:C(13213),transformMat4:C(13215),transformMat3:C(13217),transformQuat:C(13226),vy:C(13234),By:C(13236),Fy:C(13238),forEach:C(13240)}},13199:I=>{I.exports=function(I,O){return I[0]=1/O[0],I[1]=1/O[1],I[2]=1/O[2],I}},13176:(I,O,C)=>{I.exports=C(13174)},13174:I=>{I.exports=function(I){var O=I[0],C=I[1],j=I[2];return Math.sqrt(O*O+C*C+j*j)}},13211:I=>{I.exports=function(I,O,C,j){var K=O[0],i=O[1],y=O[2];return I[0]=K+j*(C[0]-K),I[1]=i+j*(C[1]-i),I[2]=y+j*(C[2]-y),I}},13130:I=>{I.exports=function(I,O,C){return I[0]=Math.max(O[0],C[0]),I[1]=Math.max(O[1],C[1]),I[2]=Math.max(O[2],C[2]),I}},13126:I=>{I.exports=function(I,O,C){return I[0]=Math.min(O[0],C[0]),I[1]=Math.min(O[1],C[1]),I[2]=Math.min(O[2],C[2]),I}},13113:(I,O,C)=>{I.exports=C(13108)},13108:I=>{I.exports=function(I,O,C){return I[0]=O[0]*C[0],I[1]=O[1]*C[1],I[2]=O[2]*C[2],I}},13196:I=>{I.exports=function(I,O){return I[0]=-O[0],I[1]=-O[1],I[2]=-O[2],I}},13065:I=>{I.exports=function(I,O){var C=O[0],j=O[1],K=O[2],i=C*C+j*j+K*K;i>0&&(i=1/Math.sqrt(i),I[0]=O[0]*i,I[1]=O[1]*i,I[2]=O[2]*i);return I}},13213:I=>{I.exports=function(I,O){O=O||1;var C=2*Math.random()*Math.PI,j=2*Math.random()-1,K=Math.sqrt(1-j*j)*O;return I[0]=Math.cos(C)*K,I[1]=Math.sin(C)*K,I[2]=j*O,I}},13234:I=>{I.exports=function(I,O,C,j){var K=C[1],i=C[2],y=O[1]-K,S=O[2]-i,U=Math.sin(j),p=Math.cos(j);return I[0]=O[0],I[1]=K+y*p-S*U,I[2]=i+y*U+S*p,I}},13236:I=>{I.exports=function(I,O,C,j){var K=C[0],i=C[2],y=O[0]-K,S=O[2]-i,U=Math.sin(j),p=Math.cos(j);return I[0]=K+S*U+y*p,I[1]=O[1],I[2]=i+S*p-y*U,I}},13238:I=>{I.exports=function(I,O,C,j){var K=C[0],i=C[1],y=O[0]-K,S=O[1]-i,U=Math.sin(j),p=Math.cos(j);return I[0]=K+y*p-S*U,I[1]=i+y*U+S*p,I[2]=O[2],I}},13145:I=>{I.exports=function(I,O){return I[0]=Math.round(O[0]),I[1]=Math.round(O[1]),I[2]=Math.round(O[2]),I}},13148:I=>{I.exports=function(I,O,C){return I[0]=O[0]*C,I[1]=O[1]*C,I[2]=O[2]*C,I}},13152:I=>{I.exports=function(I,O,C,j){return I[0]=O[0]+C[0]*j,I[1]=O[1]+C[1]*j,I[2]=O[2]+C[2]*j,I}},13083:I=>{I.exports=function(I,O,C,j){return I[0]=O,I[1]=C,I[2]=j,I}},13169:(I,O,C)=>{I.exports=C(13163)},13190:(I,O,C)=>{I.exports=C(13184)},13163:I=>{I.exports=function(I,O){var C=O[0]-I[0],j=O[1]-I[1],K=O[2]-I[2];return C*C+j*j+K*K}},13184:I=>{I.exports=function(I){var O=I[0],C=I[1],j=I[2];return O*O+C*C+j*j}},13105:(I,O,C)=>{I.exports=C(13103)},13103:I=>{I.exports=function(I,O,C){return I[0]=O[0]-C[0],I[1]=O[1]-C[1],I[2]=O[2]-C[2],I}},13217:I=>{I.exports=function(I,O,C){var j=O[0],K=O[1],i=O[2];return I[0]=j*C[0]+K*C[3]+i*C[6],I[1]=j*C[1]+K*C[4]+i*C[7],I[2]=j*C[2]+K*C[5]+i*C[8],I}},13215:I=>{I.exports=function(I,O,C){var j=O[0],K=O[1],i=O[2],y=C[3]*j+C[7]*K+C[11]*i+C[15];return y=y||1,I[0]=(C[0]*j+C[4]*K+C[8]*i+C[12])/y,I[1]=(C[1]*j+C[5]*K+C[9]*i+C[13])/y,I[2]=(C[2]*j+C[6]*K+C[10]*i+C[14])/y,I}},13226:I=>{I.exports=function(I,O,C){var j=O[0],K=O[1],i=O[2],y=C[0],S=C[1],U=C[2],p=C[3],N=p*j+S*i-U*K,Q=p*K+U*j-y*i,s=p*i+y*K-S*j,Z=-y*j-S*K-U*i;return I[0]=N*p+Z*-y+Q*-U-s*-S,I[1]=Q*p+Z*-S+s*-y-N*-U,I[2]=s*p+Z*-U+N*-S-Q*-y,I}},14132:I=>{"use strict";I.exports=function(I){for(var O=new Array(I),C=0;C<I;++C)O[C]=C;return O}},14194:I=>{I.exports=function(I){return null!=I&&null!=I.constructor&&"function"===typeof I.constructor.isBuffer&&I.constructor.isBuffer(I)}},14397:(I,O,C)=>{"use strict";C.d(O,{b:()=>j});class j{constructor(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.dN=!1,this.wN=!1,this.DN=30,this.tN=0,this.PN=!1,this.fullscreen=!1,this.VN=function(I){},this.eN=function(){},this.kN=function(){},this.py=function(){},this.LN=function(I){},this.onFullscreenChanged=function(I){},p((()=>{!function(I,O){I._nowObject=performance||Date,I._lastTick=0,I._renderAccum=0,I._rt=0,I._frameCB=S.bind(null,I),requestAnimationFrame(I._frameCB),O>0&&(I._intervalCB=y.bind(null,I),I._interval=setInterval(I._intervalCB,Math.max(O,1e3/I.DN/2)))}(this,O),function(I,O){if(!O)return;var C=!1,j=!1;document.addEventListener("pointerlockchange",(j=>{C=document.pointerLockElement===O,I.LN(C)})),document.addEventListener("fullscreenchange",(C=>{j=document.fullscreenElement===O,I.onFullscreenChanged(j)})),Object.defineProperty(I,"PN",{get:()=>C,set:I=>{I&&!C?U(O):C&&!I&&function(I){I.exitPointerLock&&I.exitPointerLock()}(document)}}),Object.defineProperty(I,"fullscreen",{get:()=>j,set:I=>{I&&!j?O.requestFullscreen():j&&!I&&document.exitFullscreen()}}),O.addEventListener("click",(K=>{I.dN&&!C&&U(O),I.wN&&!j&&O.requestFullscreen()}));var K=()=>I.py();if(window.ResizeObserver){new ResizeObserver(K).observe(O)}else window.addEventListener("resize",K)}(this,I),this.kN()}))}}var K=3,i=20;function y(I){for(var O=1e3/I.DN,C=I._nowObject.now()+i,j=0;I._nowObject.now()>=I._lastTick+O&&I._nowObject.now()<C&&++j<=K;)I.VN(O),I._lastTick+=O;var y=5*(O+5),S=I._nowObject.now();if(S-I._lastTick>y)for(;S>=I._lastTick+O;)I._lastTick+=O}function S(I){requestAnimationFrame(I._frameCB),y(I);var O=I._nowObject.now(),C=O-I._rt;if(I._rt=O,I.tN>0){I._renderAccum+=C;var j=1e3/I.tN;if(I._renderAccum<j)return;I._renderAccum=Math.min(I._renderAccum-j,j)}var K=1e3/I.DN,i=(O-I._lastTick)/K;I.eN(C,i,K)}function U(I){I.requestPointerLock&&I.requestPointerLock()}var p=I=>{if("loading"===document.readyState){var O=()=>{document.removeEventListener("readystatechange",O),I()};document.addEventListener("readystatechange",O)}else setTimeout(I,1)}},14125:(I,O,C)=>{var j=C(14132),K=C(14140),i="undefined"!==typeof Float64Array;function y(I,O){return I[0]-O[0]}function S(){var I,O=this.stride,C=new Array(O.length);for(I=0;I<C.length;++I)C[I]=[Math.abs(O[I]),I];C.sort(y);var j=new Array(C.length);for(I=0;I<j.length;++I)j[I]=C[I][1];return j}function U(I,O){var C=["View",O,"d",I].join("");O<0&&(C="View_Nil"+I);var K="generic"===I;if(-1===O){var i="function "+C+"(a){this.data=a;};var proto="+C+".prototype;proto.dtype='"+I+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+C+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+C+"(a){return new "+C+"(a);}";return new Function(i)()}if(0===O){i="function "+C+"(a,d) {this.data = a;this.offset = d};var proto="+C+".prototype;proto.dtype='"+I+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+C+"_copy() {return new "+C+"(this.data,this.offset)};proto.pick=function "+C+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+C+"_get(){return "+(K?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+C+"_set(v){return "+(K?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+C+"(a,b,c,d){return new "+C+"(a,d)}";return new Function("TrivialArray",i)(p[I][0])}i=["'use strict'"];var y=j(O),U=y.map((function(I){return"i"+I})),N="this.offset+"+y.map((function(I){return"this.stride["+I+"]*i"+I})).join("+"),Q=y.map((function(I){return"b"+I})).join(","),s=y.map((function(I){return"c"+I})).join(",");i.push("function "+C+"(a,"+Q+","+s+",d){this.data=a","this.shape=["+Q+"]","this.stride=["+s+"]","this.offset=d|0}","var proto="+C+".prototype","proto.dtype='"+I+"'","proto.dimension="+O),i.push("Object.defineProperty(proto,'size',{get:function "+C+"_size(){return "+y.map((function(I){return"this.shape["+I+"]"})).join("*"),"}})"),1===O?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),O<4?(i.push("function "+C+"_order(){"),2===O?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===O&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+C+"_set("+U.join(",")+",v){"),K?i.push("return this.data.set("+N+",v)}"):i.push("return this.data["+N+"]=v}"),i.push("proto.get=function "+C+"_get("+U.join(",")+"){"),K?i.push("return this.data.get("+N+")}"):i.push("return this.data["+N+"]}"),i.push("proto.index=function "+C+"_index(",U.join(),"){return "+N+"}"),i.push("proto.hi=function "+C+"_hi("+U.join(",")+"){return new "+C+"(this.data,"+y.map((function(I){return["(typeof i",I,"!=='number'||i",I,"<0)?this.shape[",I,"]:i",I,"|0"].join("")})).join(",")+","+y.map((function(I){return"this.stride["+I+"]"})).join(",")+",this.offset)}");var Z=y.map((function(I){return"a"+I+"=this.shape["+I+"]"})),q=y.map((function(I){return"c"+I+"=this.stride["+I+"]"}));i.push("proto.lo=function "+C+"_lo("+U.join(",")+"){var b=this.offset,d=0,"+Z.join(",")+","+q.join(","));for(var mI=0;mI<O;++mI)i.push("if(typeof i"+mI+"==='number'&&i"+mI+">=0){d=i"+mI+"|0;b+=c"+mI+"*d;a"+mI+"-=d}");i.push("return new "+C+"(this.data,"+y.map((function(I){return"a"+I})).join(",")+","+y.map((function(I){return"c"+I})).join(",")+",b)}"),i.push("proto.step=function "+C+"_step("+U.join(",")+"){var "+y.map((function(I){return"a"+I+"=this.shape["+I+"]"})).join(",")+","+y.map((function(I){return"b"+I+"=this.stride["+I+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(mI=0;mI<O;++mI)i.push("if(typeof i"+mI+"==='number'){d=i"+mI+"|0;if(d<0){c+=b"+mI+"*(a"+mI+"-1);a"+mI+"=ceil(-a"+mI+"/d)}else{a"+mI+"=ceil(a"+mI+"/d)}b"+mI+"*=d}");i.push("return new "+C+"(this.data,"+y.map((function(I){return"a"+I})).join(",")+","+y.map((function(I){return"b"+I})).join(",")+",c)}");var E=new Array(O),h=new Array(O);for(mI=0;mI<O;++mI)E[mI]="a[i"+mI+"]",h[mI]="b[i"+mI+"]";i.push("proto.transpose=function "+C+"_transpose("+U+"){"+U.map((function(I,O){return I+"=("+I+"===undefined?"+O+":"+I+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+C+"(this.data,"+E.join(",")+","+h.join(",")+",this.offset)}"),i.push("proto.pick=function "+C+"_pick("+U+"){var a=[],b=[],c=this.offset");for(mI=0;mI<O;++mI)i.push("if(typeof i"+mI+"==='number'&&i"+mI+">=0){c=(c+this.stride["+mI+"]*i"+mI+")|0}else{a.push(this.shape["+mI+"]);b.push(this.stride["+mI+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+C+"(data,shape,stride,offset){return new "+C+"(data,"+y.map((function(I){return"shape["+I+"]"})).join(",")+","+y.map((function(I){return"stride["+I+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(p[I],S)}var p={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};I.exports=function(I,O,C,j){if(void 0===I)return(0,p.array[0])([]);"number"===typeof I&&(I=[I]),void 0===O&&(O=[I.length]);var y=O.length;if(void 0===C){C=new Array(y);for(var S=y-1,N=1;S>=0;--S)C[S]=N,N*=O[S]}if(void 0===j){j=0;for(S=0;S<y;++S)C[S]<0&&(j-=(O[S]-1)*C[S])}for(var Q=function(I){if(K(I))return"buffer";if(i)switch(Object.prototype.toString.call(I)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(I)?"array":"generic"}(I),s=p[Q];s.length<=y+1;)s.push(U(Q,s.length-1));return(0,s[y+1])(I,O,C,j)}},14140:I=>{function O(I){return!!I.constructor&&"function"===typeof I.constructor.isBuffer&&I.constructor.isBuffer(I)}I.exports=function(I){return null!=I&&(O(I)||function(I){return"function"===typeof I.readFloatLE&&"function"===typeof I.slice&&O(I.slice(0,0))}(I)||!!I._isBuffer)}},14280:I=>{"use strict";var O=[],C=[],j=[],K=[],i=[],y=[],S=[],U=[],p=[],N=[],Q=[],s=[];I.exports=function(I,Z,q,mI,E,h){for(var r=S,W=p,Y=N,o=s,c=0;c<3;c++)r[c]=+q[c],Y[c]=+Z.max[c],W[c]=+Z.base[c];h||(h=1e-10);var n=function(I,S,p,N,s,Z){var q=O,mI=C,E=j,h=K,r=i,W=y,Y=U,o=Math.floor,c=0,n=0,X=0,T=0,H=0;if(b(),0===X)return 0;for(T=u();n<=X;){if(a(T)&&M())return c;T=u()}for(c+=X,H=0;H<3;H++)N[H]+=p[H],s[H]+=p[H];return c;function b(){if(n=0,0!==(X=Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])))for(var I=0;I<3;I++){var O=p[I]>=0;h[I]=O?1:-1;var C=O?s[I]:N[I];q[I]=O?N[I]:s[I],mI[I]=J(C,h[I]),E[I]=f(q[I],h[I]),Y[I]=p[I]/X,r[I]=Math.abs(1/Y[I]);var j=O?mI[I]+1-C:C-mI[I];W[I]=r[I]<1/0?r[I]*j:1/0}}function a(O){for(var C=h[0],j=0===O?mI[0]:E[0],K=mI[0]+C,i=h[1],y=1===O?mI[1]:E[1],S=mI[1]+i,U=h[2],p=2===O?mI[2]:E[2],N=mI[2]+U,Q=j;Q!=K;Q+=C)for(var s=y;s!=S;s+=i)for(var Z=p;Z!=N;Z+=U)if(I(Q,s,Z))return!0;return!1}function M(){c+=n;var I=h[T],O=n/X,C=Q;for(H=0;H<3;H++){var j=p[H]*O;N[H]+=j,s[H]+=j,C[H]=p[H]-j}if(I>0?s[T]=Math.round(s[T]):N[T]=Math.round(N[T]),S(c,T,I,C))return!0;for(H=0;H<3;H++)p[H]=C[H];return b(),0===X}function u(){var I=W[0]<W[1]?W[0]<W[2]?0:2:W[1]<W[2]?1:2,O=W[I]-n;for(n=W[I],mI[I]+=h[I],W[I]+=r[I],H=0;H<3;H++)q[H]+=O*Y[H],E[H]=f(q[H],h[H]);return I}function J(I,O){return o(I-O*Z)}function f(I,O){return o(I+O*Z)}}(I,mI,r,W,Y,h);if(!E){for(c=0;c<3;c++)o[c]=q[c]>0?Y[c]-Z.max[c]:W[c]-Z.base[c];Z.translate(o)}return n}},14434:(I,O,C)=>{"use strict";C.d(O,{c:()=>Q});var j=C(14274),K=C(13035);class i{constructor(I,O,C,i,y,S,U){this.Dp=new j(I.base,I.Gp),this.Xj=O,this.friction=C,this.restitution=i,this.ly=y,this.mq=S,this.xy=!!U,this.Rp=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.jq=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Qp=K.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=K.create(),this._impulses=K.create(),this._sleepFrameCount=10}loadFromCopy(I){K.k(this.Dp.base,I.Dp.base),K.k(this.Dp.Gp,I.Dp.Gp),K.k(this.Dp.max,I.Dp.max),this.Dp.mag=I.Dp.mag,this.Xj=I.Xj,this.friction=I.friction,this.restitution=I.restitution,this.ly=I.ly,this.mq=I.mq,this.xy=I.xy,this.Rp=I.Rp,this.fluidDrag=I.fluidDrag,this.jq=I.jq,this.preventFallOffEdge=I.preventFallOffEdge,this.rolledBackLastTick=I.rolledBackLastTick,K.k(this.Qp,I.Qp),K.k(this.resting,I.resting),this.inFluid=I.inFluid,this._ratioInFluid=I._ratioInFluid,K.k(this._forces,I._forces),K.k(this._impulses,I._impulses),this._sleepFrameCount=I._sleepFrameCount}setPosition(I){y(I),K.EO(I,I,this.Dp.base),this.Dp.translate(I),this.qp()}ny(){return K.clone(this.Dp.base)}applyForce(I){y(I),K.add(this._forces,this._forces,I),this.qp()}applyImpulse(I){y(I),K.add(this._impulses,this._impulses,I),this.qp()}qp(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var y=I=>{};var S=C(14274),U=C(13035),p=C(14280);function N(){this.Rp=.1,this.fluidDrag=.4,this.Vy=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function Q(I,O,C){I=Object.assign(new N,I),this.gravity=I.gravity||[0,-10,0],this.Rp=I.Rp||.1,this.Vy=I.Vy||2,this.fluidDrag=I.fluidDrag||.4,this.minBounceImpulse=I.minBounceImpulse,this.bodies=[],this.ds=I.ds,this.testSolid=O,this.testFluid=C}Q.prototype.cZ=function(I,O,C,j,K,y){I=I||new S([0,0,0],[1,1,1]),"undefined"==typeof O&&(O=1),"undefined"==typeof C&&(C=1),"undefined"==typeof j&&(j=0),"undefined"==typeof K&&(K=1);var U=new i(I,O,C,j,K,y);return this.bodies.push(U),U},Q.prototype.nZ=function(I){var O=this.bodies.indexOf(I);O<0||(this.bodies.splice(O,1),I.Dp=I.mq=null)};var s=U.create(),Z=U.create(),q=U.create(),mI=U.create(),E=U.create(),h=U.create(),r=U.create(),W=new S([0,0,0],[1,1,1]),Y=new i(W,1,1,0,1,(()=>{}),!1);function o(I,O,C){return O=C,O*=1-(1-I.ratioInFluid)**2}Q.prototype.OS=function(I){I/=1e3;var O=d(0,U.squaredLength(this.gravity));this.bodies.forEach((C=>function(I,O,C,j){U.k(E,O.resting),I.ds&&Y.loadFromCopy(O);if(O.Xj<=0)return U.set(O.Qp,0,0,0),U.set(O._forces,0,0,0),void U.set(O._impulses,0,0,0);var K=j||0===O.ly;if(function(I,O,C,j){if(O._sleepFrameCount>0)return!1;if(j)return!0;var K=!1,i=.5*C*C*O.ly;return U.scale(t,I.gravity,i),p(I.testSolid,O.Dp,t,(function(){return K=!0,!0}),!0),K}(I,O,C,K))return;O._sleepFrameCount--,function(I,O){var C=O.Dp,j=Math.floor(C.base[0]),K=Math.floor(C.base[2]),i=Math.floor(C.base[1]),y=Math.floor(C.max[1]);if(!I.testFluid(j,i,K))return O.inFluid=!1,void(O.ratioInFluid=0);var S=1,p=i+1;for(;p<=y&&I.testFluid(j,p,K);)S++,p++;var N=(i+S-C.base[1])/C.Gp[1];N>1&&(N=1);var Q=C.Gp[0]*C.Gp[1]*C.Gp[2]*N,s=n;U.scale(s,I.gravity,-I.Vy*Q*O.ly),O.applyForce(s),O.inFluid=!0,O.ratioInFluid=N}(I,O),g(O._forces),g(O._impulses),g(O.Qp),g(O.resting),U.scale(s,O._forces,1/O.Xj),U.Ay(s,s,I.gravity,O.ly),U.scale(Z,O._impulses,1/O.Xj),U.Ay(Z,Z,s,C),U.add(O.Qp,O.Qp,Z),O.friction&&(X(I,0,O,Z,C),X(I,1,O,Z,C),X(I,2,O,Z,C));var i=O.fluidDrag>=0?O.fluidDrag:I.fluidDrag,y=O.Rp>=0?O.Rp:I.Rp,S=y,N=y;O.inFluid&&(S=o(O,S,O.fluidDragHoriz>=0?O.fluidDragHoriz:i),N=o(O,N,O.fluidDragVert>=0?O.fluidDragVert:i));S=Math.max(1-S*C/O.Xj,0),N=Math.max(1-N*C/O.Xj,0),U.set(c,S,N,S),U.multiply(O.Qp,O.Qp,c),U.scale(q,O.Qp,C),U.set(O._forces,0,0,0),U.set(O._impulses,0,0,0),O.xy&&w(b,O.Dp);U.k(h,q),U.set(r,0,0,0),O.preventFallOffEdge&&function(I,O,C,j){if(!O.resting[1]||C[1]>0)return;var K=l;w(K,O.Dp);for(var i=0;i<3;i+=2){U.set(f,0,0,0),f[i]=C[i];var y=!0;(y=(y=(y=(y=y&&!D(I,K.base[0]+f[0]+1e-5,K.base[1],K.base[2]+f[2]+1e-5))&&!D(I,K.max[0]+f[0]-1e-5,K.base[1],K.base[2]+f[2]+1e-5))&&!D(I,K.base[0]+f[0]+1e-5,K.base[1],K.max[2]+f[2]-1e-5))&&!D(I,K.max[0]+f[0]-1e-5,K.base[1],K.max[2]+f[2]-1e-5))?(j[i]=C[i]>0?1:-1,C[i]=0):0===i&&(U.set(x,C[0],0,0),H(I,K,x,j,O.slideOnCollision))}}(I,O,q,r);H(I,O.Dp,q,O.resting,O.slideOnCollision),O.xy&&function(I,O,C,j){if(O.resting[1]>=0&&!O.inFluid)return;var K=0!==O.resting[0],i=0!==O.resting[2];if(!K&&!i)return;var y=Math.abs(j[0]/j[2]),S=4;if(!K&&y>S)return;if(!i&&y<1/S)return;U.add(M,C.base,j);var N=I.testSolid;p(N,C,j,(function(I,O,C,j){if(1!==O)return!0;j[O]=0}));var Q=C.base[1],s=O.inFluid?1.951:1.001,Z=Math.floor(Q+s)-Q;U.set(u,0,Z,0);var q=!1;if(p(N,C,u,(function(I,O,C,j){return q=!0,!0})),q)return;U.EO(J,M,C.base),J[1]=0,H(I,C,J,a,!0);var mI=d(C.base[0],M[0]),E=d(C.base[2],M[2]);if(K&&!mI&&(!E||!i))return;if(i&&(!mI||!K)&&!E)return;var h=!0;if(h=h&&!D(I,C.base[0]+1e-5,C.base[1],C.base[2]+1e-5),h=h&&!D(I,C.max[0]-1e-5,C.base[1],C.base[2]+1e-5),h=h&&!D(I,C.base[0]+1e-5,C.base[1],C.max[2]-1e-5),h=h&&!D(I,C.max[0]-1e-5,C.base[1],C.max[2]-1e-5),h)return;w(O.Dp,C),O.resting[0]=a[0],O.resting[2]=a[2],O.jq&&O.jq()}(I,O,b,h);for(var Q=0;Q<3;++Q)O.resting[Q]=O.resting[Q]||r[Q],mI[Q]=0,O.resting[Q]&&(E[Q]||(mI[Q]=-O.Qp[Q]),O.Qp[Q]=0);var W=U.length(mI);W>.001&&(U.scale(mI,mI,O.Xj),O.mq&&O.mq(mI),O.restitution>0&&W>I.minBounceImpulse&&(U.scale(mI,mI,O.restitution),O.applyImpulse(mI)));var T=U.squaredLength(O.Qp);T>1e-5&&O.qp();I.ds&&I.ds(O)?(O.loadFromCopy(Y),O.rolledBackLastTick=!0):O.rolledBackLastTick=!1}(this,C,I,O)))};var c=U.create([0,0,0]);var n=U.create();function X(I,O,C,j,K){var i=C.resting[O],y=j[O];if(!C.alwaysApplyHorizFriction||1!==O){if(0===i)return;if(i*y<=0)return}U.k(T,C.Qp),T[O]=0;var S=U.length(T);if(!d(S,0)){var p=Math.abs(C.friction*I.gravity[O]*K),N=S>p?(S-p)/S:0;C.Qp[(O+1)%3]*=N,C.Qp[(O+2)%3]*=N}}var T=U.create();function H(I,O,C,j,K){return U.set(j,0,0,0),p(I.testSolid,O,C,(function(I,O,C,i){j[O]=C,i[O]=0,K||(i[0]=0,i[1]=0,i[2]=0)}))}var b=new S([],[]),a=U.create(),M=U.create(),u=U.create(),J=U.create();var f=U.create(),l=new S([],[]),x=U.create();function D(I,O,C,j){return I.testSolid(Math.floor(O),Math.floor(C-1),Math.floor(j))}var t=U.create();function d(I,O){return Math.abs(I-O)<1e-5}function w(I,O){for(var C=0;C<3;C++)I.base[C]=O.base[C],I.max[C]=O.max[C],I.Gp[C]=O.Gp[C]}var g=function(I){}},12902:function(I,O){!function(I){"use strict";var O=function(I,C){return O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,O){I.__proto__=O}||function(I,O){for(var C in O)Object.prototype.hasOwnProperty.call(O,C)&&(I[C]=O[C])},O(I,C)};function C(I,C){if("function"!==typeof C&&null!==C)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function j(){this.constructor=I}O(I,C),I.prototype=null===C?Object.create(C):(j.prototype=C.prototype,new j)}function j(I,O,C,j){var K,i=arguments.length,y=i<3?O:null===j?j=Object.getOwnPropertyDescriptor(O,C):j;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)y=Reflect.decorate(I,O,C,j);else for(var S=I.length-1;S>=0;S--)(K=I[S])&&(y=(i<3?K(y):i>3?K(O,C,y):K(O,C))||y);return i>3&&y&&Object.defineProperty(O,C,y),y}function K(I,O,C){if(C||2===arguments.length)for(var j,K=0,i=O.length;K<i;K++)!j&&K in O||(j||(j=Array.prototype.slice.call(O,0,K)),j[K]=O[K]);return I.concat(j||Array.prototype.slice.call(O))}var i,y=255,S=213;I.OPERATION=void 0,(i=I.OPERATION||(I.OPERATION={}))[i.ADD=128]="ADD",i[i.REPLACE=0]="REPLACE",i[i.DELETE=64]="DELETE",i[i.DELETE_AND_ADD=192]="DELETE_AND_ADD",i[i.TOUCH=1]="TOUCH",i[i.CLEAR=10]="CLEAR";var U=function(){function O(I,O,C){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=I,this.setParent(O,C)}return O.prototype.setParent=function(I,O,C){var j=this;if(this.indexes||(this.indexes=this.ref instanceof JI?this.ref._definition.indexes:{}),this.parent=I,this.parentIndex=C,O)if(this.root=O,this.ref instanceof JI){var K=this.ref._definition;for(var i in K.schema){var y=this.ref[i];if(y&&y.$changes){var S=K.indexes[i];y.$changes.setParent(this.ref,O,S)}}}else"object"===typeof this.ref&&this.ref.forEach((function(I,O){if(I instanceof JI){var C=I.$changes,K=j.ref.$changes.indexes[O];C.setParent(j.ref,j.root,K)}}))},O.prototype.operation=function(I){this.changes.set(--this.currentCustomOperation,I)},O.prototype.change=function(O,C){void 0===C&&(C=I.OPERATION.ADD);var j="number"===typeof O?O:this.indexes[O];this.assertValidIndex(j,O);var K=this.changes.get(j);K&&K.op!==I.OPERATION.DELETE&&K.op!==I.OPERATION.TOUCH||this.changes.set(j,{op:K&&K.op===I.OPERATION.DELETE?I.OPERATION.DELETE_AND_ADD:C,index:j}),this.allChanges.add(j),this.changed=!0,this.touchParents()},O.prototype.touch=function(O){var C="number"===typeof O?O:this.indexes[O];this.assertValidIndex(C,O),this.changes.has(C)||this.changes.set(C,{op:I.OPERATION.TOUCH,index:C}),this.allChanges.add(C),this.touchParents()},O.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},O.prototype.getType=function(I){if(this.ref._definition)return(O=this.ref._definition).schema[O.fieldsByIndex[I]];var O,C=(O=this.parent._definition).schema[O.fieldsByIndex[this.parentIndex]];return Object.values(C)[0]},O.prototype.getChildrenFilter=function(){var I=this.parent._definition.childFilters;return I&&I[this.parentIndex]},O.prototype.getValue=function(I){return this.ref.getByIndex(I)},O.prototype.delete=function(O){var C="number"===typeof O?O:this.indexes[O];if(void 0!==C){var j=this.getValue(C);this.changes.set(C,{op:I.OPERATION.DELETE,index:C}),this.allChanges.delete(C),delete this.caches[C],j&&j.$changes&&(j.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(O," (").concat(C,")"))},O.prototype.discard=function(O,C){var j=this;void 0===O&&(O=!1),void 0===C&&(C=!1),this.ref instanceof JI||this.changes.forEach((function(O){if(O.op===I.OPERATION.DELETE){var C=j.ref.getIndex(O.index);delete j.indexes[C]}})),this.changes.clear(),this.changed=O,C&&this.allChanges.clear(),this.currentCustomOperation=0},O.prototype.discardAll=function(){var I=this;this.changes.forEach((function(O){var C=I.getValue(O.index);C&&C.$changes&&C.$changes.discardAll()})),this.discard()},O.prototype.cache=function(I,O){this.caches[I]=O},O.prototype.clone=function(){return new O(this.ref,this.parent,this.root)},O.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},O.prototype.assertValidIndex=function(I,O){if(void 0===I)throw new Error('ChangeTree: missing index for field "'.concat(O,'"'))},O}();function p(I,O,C,j){return I[O]||(I[O]=[]),I[O].push(C),null===j||void 0===j||j.forEach((function(I,O){return C(I,O)})),function(){return Q(I[O],I[O].indexOf(C))}}function N(O){var C=this,j="string"!==typeof this.$changes.getType();this.$items.forEach((function(K,i){O.push({refId:C.$changes.refId,op:I.OPERATION.DELETE,field:i,value:void 0,previousValue:K}),j&&C.$changes.root.removeRef(K.$changes.refId)}))}function Q(I,O){if(-1===O||O>=I.length)return!1;for(var C=I.length-1,j=O;j<C;j++)I[j]=I[j+1];return I.length=C,!0}var s=function(I,O){var C=I.toString(),j=O.toString();return C<j?-1:C>j?1:0};function Z(I){return I.$proxy=!0,I=new Proxy(I,{get:function(I,O){return"symbol"===typeof O||isNaN(O)?I[O]:I.at(O)},set:function(I,O,C){if("symbol"===typeof O||isNaN(O))I[O]=C;else{var j=Array.from(I.$items.keys()),K=parseInt(j[O]||O);void 0===C||null===C?I.deleteAt(K):I.setAt(K,C)}return!0},deleteProperty:function(I,O){return"number"===typeof O?I.deleteAt(O):delete I[O],!0}})}var q=function(){function O(){for(var I=[],O=0;O<arguments.length;O++)I[O]=arguments[O];this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,I)}return O.prototype.DS=function(O,C){return void 0===C&&(C=!0),p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,O,C?this.$items:void 0)},O.prototype.XC=function(O){return p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,O)},O.is=function(I){return Array.isArray(I)||void 0!==I.array},Object.defineProperty(O.prototype,"length",{get:function(){return this.$items.size},set:function(I){0===I?this.clear():this.splice(I,this.length-I)},enumerable:!1,configurable:!0}),O.prototype.push=function(){for(var I,O=this,C=[],j=0;j<arguments.length;j++)C[j]=arguments[j];return C.forEach((function(C){I=O.$refId++,O.setAt(I,C)})),I},O.prototype.pop=function(){var I=Array.from(this.$indexes.values()).pop();if(void 0!==I){this.$changes.delete(I),this.$indexes.delete(I);var O=this.$items.get(I);return this.$items.delete(I),O}},O.prototype.at=function(I){var O=Array.from(this.$items.keys())[I];return this.$items.get(O)},O.prototype.setAt=function(O,C){var j,K;if(void 0!==C&&null!==C){if(this.$items.get(O)!==C){void 0!==C.$changes&&C.$changes.setParent(this,this.$changes.root,O);var i=null!==(K=null===(j=this.$changes.indexes[O])||void 0===j?void 0:j.op)&&void 0!==K?K:I.OPERATION.ADD;this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,C),this.$changes.change(O,i)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},O.prototype.deleteAt=function(I){var O=Array.from(this.$items.keys())[I];return void 0!==O&&this.$deleteAt(O)},O.prototype.$deleteAt=function(I){return this.$changes.delete(I),this.$indexes.delete(I),this.$items.delete(I)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&N.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.concat=function(){for(var I,C=[],j=0;j<arguments.length;j++)C[j]=arguments[j];return new(O.bind.apply(O,K([void 0],(I=Array.from(this.$items.values())).concat.apply(I,C),!1)))},O.prototype.join=function(I){return Array.from(this.$items.values()).join(I)},O.prototype.reverse=function(){var I=this,O=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(C,j){I.setAt(O[j],C)})),this},O.prototype.shift=function(){var I=Array.from(this.$items.keys()).shift();if(void 0!==I){var O=this.$items.get(I);return this.$deleteAt(I),O}},O.prototype.slice=function(I,C){var j=new O;return j.push.apply(j,Array.from(this.$items.values()).slice(I,C)),j},O.prototype.sort=function(I){var O=this;void 0===I&&(I=s);var C=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(I).forEach((function(I,j){O.setAt(C[j],I)})),this},O.prototype.splice=function(I,O){void 0===O&&(O=this.length-I);for(var C=Array.from(this.$items.keys()),j=[],K=I;K<I+O;K++)j.push(this.$items.get(C[K])),this.$deleteAt(C[K]);return j},O.prototype.unshift=function(){for(var I=this,O=[],C=0;C<arguments.length;C++)O[C]=arguments[C];var j=this.length,K=O.length,i=Array.from(this.$items.values());return O.forEach((function(O,C){I.setAt(C,O)})),i.forEach((function(O,C){I.setAt(K+C,O)})),j+K},O.prototype.indexOf=function(I,O){return Array.from(this.$items.values()).indexOf(I,O)},O.prototype.lastIndexOf=function(I,O){return void 0===O&&(O=this.length-1),Array.from(this.$items.values()).lastIndexOf(I,O)},O.prototype.every=function(I,O){return Array.from(this.$items.values()).every(I,O)},O.prototype.some=function(I,O){return Array.from(this.$items.values()).some(I,O)},O.prototype.forEach=function(I,O){Array.from(this.$items.values()).forEach(I,O)},O.prototype.map=function(I,O){return Array.from(this.$items.values()).map(I,O)},O.prototype.filter=function(I,O){return Array.from(this.$items.values()).filter(I,O)},O.prototype.reduce=function(I,O){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},O.prototype.reduceRight=function(I,O){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},O.prototype.find=function(I,O){return Array.from(this.$items.values()).find(I,O)},O.prototype.findIndex=function(I,O){return Array.from(this.$items.values()).findIndex(I,O)},O.prototype.fill=function(I,O,C){throw new Error("ArraySchema#fill() not implemented")},O.prototype.copyWithin=function(I,O,C){throw new Error("ArraySchema#copyWithin() not implemented")},O.prototype.toString=function(){return this.$items.toString()},O.prototype.toLocaleString=function(){return this.$items.toLocaleString()},O.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},O.prototype.includes=function(I,O){return Array.from(this.$items.values()).includes(I,O)},O.prototype.flatMap=function(I,O){throw new Error("ArraySchema#flatMap() is not supported.")},O.prototype.flat=function(I){throw new Error("ArraySchema#flat() is not supported.")},O.prototype.findLast=function(){var I=Array.from(this.$items.values());return I.findLast.apply(I,arguments)},O.prototype.findLastIndex=function(){var I=Array.from(this.$items.values());return I.findLastIndex.apply(I,arguments)},O.prototype.setIndex=function(I,O){this.$indexes.set(I,O)},O.prototype.getIndex=function(I){return this.$indexes.get(I)},O.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},O.prototype.deleteByIndex=function(I){var O=this.$indexes.get(I);this.$items.delete(O),this.$indexes.delete(I)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){return this.toArray().map((function(I){return"function"===typeof I.toJSON?I.toJSON():I}))},O.prototype.clone=function(I){return I?new(O.bind.apply(O,K([void 0],Array.from(this.$items.values()),!1))):new(O.bind.apply(O,K([void 0],this.map((function(I){return I.$changes?I.clone():I})),!1)))},O}();function mI(I){return I.$proxy=!0,I=new Proxy(I,{get:function(I,O){return"symbol"!==typeof O&&"undefined"===typeof I[O]?I.get(O):I[O]},set:function(I,O,C){return"symbol"!==typeof O&&-1===O.indexOf("$")&&"DS"!==O&&"XC"!==O&&"onChange"!==O?I.set(O,C):I[O]=C,!0},deleteProperty:function(I,O){return I.delete(O),!0}})}var E=function(){function O(I){var C=this;if(this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,I)if(I instanceof Map||I instanceof O)I.forEach((function(I,O){return C.set(O,I)}));else for(var j in I)this.set(j,I[j])}return O.prototype.DS=function(O,C){return void 0===C&&(C=!0),p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,O,C?this.$items:void 0)},O.prototype.XC=function(O){return p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,O)},O.is=function(I){return void 0!==I.map},O.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(O.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.set=function(O,C){if(void 0===C||null===C)throw new Error("MapSchema#set('".concat(O,"', ").concat(C,"): trying to set ").concat(C," value on '").concat(O,"'."));O=O.toString();var j="undefined"!==typeof this.$changes.indexes[O],K=j?this.$changes.indexes[O]:this.$refId++,i=j?I.OPERATION.REPLACE:I.OPERATION.ADD,y=void 0!==C.$changes;if(y&&C.$changes.setParent(this,this.$changes.root,K),j){if(!y&&this.$items.get(O)===C)return;y&&this.$items.get(O)!==C&&(i=I.OPERATION.ADD)}else this.$changes.indexes[O]=K,this.$indexes.set(K,O);return this.$items.set(O,C),this.$changes.change(O,i),this},O.prototype.get=function(I){return this.$items.get(I)},O.prototype.delete=function(I){return this.$changes.delete(I),this.$items.delete(I)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&N.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(I){return this.$items.has(I)},O.prototype.forEach=function(I){this.$items.forEach(I)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(I,O){this.$indexes.set(I,O)},O.prototype.getIndex=function(I){return this.$indexes.get(I)},O.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},O.prototype.deleteByIndex=function(I){var O=this.$indexes.get(I);this.$items.delete(O),this.$indexes.delete(I)},O.prototype.toJSON=function(){var I={};return this.forEach((function(O,C){I[C]="function"===typeof O.toJSON?O.toJSON():O})),I},O.prototype.clone=function(I){var C;return I?C=Object.assign(new O,this):(C=new O,this.forEach((function(I,O){I.$changes?C.set(O,I.clone()):C.set(O,I)}))),C},O}(),h={};function r(I,O){h[I]=O}function W(I){return h[I]}var Y=function(){function I(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return I.create=function(O){var C=new I;return C.schema=Object.assign({},O&&O.schema||{}),C.indexes=Object.assign({},O&&O.indexes||{}),C.fieldsByIndex=Object.assign({},O&&O.fieldsByIndex||{}),C.descriptors=Object.assign({},O&&O.descriptors||{}),C.deprecated=Object.assign({},O&&O.deprecated||{}),C},I.prototype.addField=function(I,O){var C=this.getNextFieldIndex();this.fieldsByIndex[C]=I,this.indexes[I]=C,this.schema[I]=Array.isArray(O)?{array:O[0]}:O},I.prototype.hasField=function(I){return void 0!==this.indexes[I]},I.prototype.addFilter=function(I,O){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[I]]=O,this.indexesWithFilters.push(this.indexes[I]),!0},I.prototype.addChildrenFilter=function(I,O){var C=this.indexes[I],j=this.schema[I];if(W(Object.keys(j)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[C]=O,!0;console.warn("@filterChildren: field '".concat(I,"' can't have children. Ignoring filter."))},I.prototype.getChildrenFilter=function(I){return this.childFilters&&this.childFilters[this.indexes[I]]},I.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},I}();function o(I){return I._context&&I._context.useFilters}var c=function(){function I(){this.types={},this.schemas=new Map,this.useFilters=!1}return I.prototype.has=function(I){return this.schemas.has(I)},I.prototype.get=function(I){return this.types[I]},I.prototype.add=function(I,O){void 0===O&&(O=this.schemas.size),I._definition=Y.create(I._definition),I._typeid=O,this.types[O]=I,this.schemas.set(I,O)},I.create=function(O){return void 0===O&&(O={}),function(C){return O.context||(O.context=new I),X(C,O)}},I}(),n=new c;function X(I,O){return void 0===O&&(O={}),function(C,j){var i=O.context||n,y=C.constructor;if(y._context=i,!I)throw new Error("".concat(y.name,': @type() reference provided for "').concat(j,"\" is undefined. Make sure you don't have any circular dependencies."));i.has(y)||i.add(y);var S=y._definition;if(S.addField(j,I),S.descriptors[j]){if(S.deprecated[j])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(j,"' definition on '").concat(y.name,"'.\nCheck @type() annotation"))}catch(h){var U=h.stack.split("\n")[4].trim();throw new Error("".concat(h.message," ").concat(U))}}var p=q.is(I),N=!p&&E.is(I);if("string"!==typeof I&&!JI.is(I)){var Q=Object.values(I)[0];"string"===typeof Q||i.has(Q)||i.add(Q)}if(O.manual)S.descriptors[j]={enumerable:!0,configurable:!0,writable:!0};else{var s="_".concat(j);S.descriptors[s]={enumerable:!1,configurable:!1,writable:!0},S.descriptors[j]={get:function(){return this[s]},set:function(I){I!==this[s]&&(void 0!==I&&null!==I?(!p||I instanceof q||(I=new(q.bind.apply(q,K([void 0],I,!1)))),!N||I instanceof E||(I=new E(I)),void 0===I.$proxy&&(N?I=mI(I):p&&(I=Z(I))),this.$changes.change(j),I.$changes&&I.$changes.setParent(this,this.$changes.root,this._definition.indexes[j])):this[s]&&this.$changes.delete(j),this[s]=I)},enumerable:!0,configurable:!0}}}}function T(I){return function(O,C){var j=O.constructor;j._definition.addFilter(C,I)&&(j._context.useFilters=!0)}}function H(I){return function(O,C){var j=O.constructor;j._definition.addChildrenFilter(C,I)&&(j._context.useFilters=!0)}}function b(I){return void 0===I&&(I=!0),function(O,C){var j=O.constructor._definition;j.deprecated[C]=!0,I&&(j.descriptors[C]={get:function(){throw new Error("".concat(C," is deprecated."))},set:function(I){},enumerable:!1,configurable:!0})}}function a(I,O,C){for(var j in void 0===C&&(C={}),C.context||(C.context=I._context||C.context||n),O)X(O[j],C)(I.prototype,j);return I}function M(I){for(var O=0,C=0,j=0,K=I.length;j<K;j++)(O=I.charCodeAt(j))<128?C+=1:O<2048?C+=2:O<55296||O>=57344?C+=3:(j++,C+=4);return C}function u(I,O,C){for(var j=0,K=0,i=C.length;K<i;K++)(j=C.charCodeAt(K))<128?I[O++]=j:j<2048?(I[O++]=192|j>>6,I[O++]=128|63&j):j<55296||j>=57344?(I[O++]=224|j>>12,I[O++]=128|j>>6&63,I[O++]=128|63&j):(K++,j=65536+((1023&j)<<10|1023&C.charCodeAt(K)),I[O++]=240|j>>18,I[O++]=128|j>>12&63,I[O++]=128|j>>6&63,I[O++]=128|63&j)}function J(I,O){I.push(255&O)}function f(I,O){I.push(255&O)}function l(I,O){I.push(255&O),I.push(O>>8&255)}function x(I,O){I.push(255&O),I.push(O>>8&255)}function D(I,O){I.push(255&O),I.push(O>>8&255),I.push(O>>16&255),I.push(O>>24&255)}function t(I,O){var C=O>>24,j=O>>16,K=O>>8,i=O;I.push(255&i),I.push(255&K),I.push(255&j),I.push(255&C)}function d(I,O){var C=Math.floor(O/Math.pow(2,32));t(I,O>>>0),t(I,C)}function w(I,O){var C=O/Math.pow(2,32)|0;t(I,O>>>0),t(I,C)}function g(I,O){k(I,O)}function V(I,O){A(I,O)}var e=new Int32Array(2),L=new Float32Array(e.buffer),z=new Float64Array(e.buffer);function k(I,O){L[0]=O,D(I,e[0])}function A(I,O){z[0]=O,D(I,e[0]),D(I,e[1])}function P(I,O){return f(I,O?1:0)}function v(I,O){O||(O="");var C=M(O),j=0;if(C<32)I.push(160|C),j=1;else if(C<256)I.push(217),f(I,C),j=2;else if(C<65536)I.push(218),x(I,C),j=3;else{if(!(C<4294967296))throw new Error("String too long");I.push(219),t(I,C),j=5}return u(I,I.length,O),j+C}function B(I,O){return isNaN(O)?B(I,0):isFinite(O)?O!==(0|O)?(I.push(203),A(I,O),9):O>=0?O<128?(f(I,O),1):O<256?(I.push(204),f(I,O),2):O<65536?(I.push(205),x(I,O),3):O<4294967296?(I.push(206),t(I,O),5):(I.push(207),w(I,O),9):O>=-32?(I.push(224|O+32),1):O>=-128?(I.push(208),J(I,O),2):O>=-32768?(I.push(209),l(I,O),3):O>=-2147483648?(I.push(210),D(I,O),5):(I.push(211),d(I,O),9):B(I,O>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var F=Object.freeze({__proto__:null,utf8Write:u,int8:J,uint8:f,int16:l,uint16:x,int32:D,uint32:t,int64:d,uint64:w,float32:g,float64:V,writeFloat32:k,writeFloat64:A,boolean:P,string:v,number:B});function R(I,O,C){for(var j="",K=0,i=O,y=O+C;i<y;i++){var S=I[i];0!==(128&S)?192!==(224&S)?224!==(240&S)?240!==(248&S)?console.error("Invalid byte "+S.toString(16)):(K=(7&S)<<18|(63&I[++i])<<12|(63&I[++i])<<6|63&I[++i])>=65536?(K-=65536,j+=String.fromCharCode(55296+(K>>>10),56320+(1023&K))):j+=String.fromCharCode(K):j+=String.fromCharCode((15&S)<<12|(63&I[++i])<<6|63&I[++i]):j+=String.fromCharCode((31&S)<<6|63&I[++i]):j+=String.fromCharCode(S)}return j}function G(I,O){return II(I,O)<<24>>24}function II(I,O){return I[O.offset++]}function OI(I,O){return CI(I,O)<<16>>16}function CI(I,O){return I[O.offset++]|I[O.offset++]<<8}function jI(I,O){return I[O.offset++]|I[O.offset++]<<8|I[O.offset++]<<16|I[O.offset++]<<24}function KI(I,O){return jI(I,O)>>>0}function iI(I,O){return sI(I,O)}function yI(I,O){return ZI(I,O)}function SI(I,O){var C=KI(I,O);return jI(I,O)*Math.pow(2,32)+C}function UI(I,O){var C=KI(I,O);return KI(I,O)*Math.pow(2,32)+C}var pI=new Int32Array(2),NI=new Float32Array(pI.buffer),QI=new Float64Array(pI.buffer);function sI(I,O){return pI[0]=jI(I,O),NI[0]}function ZI(I,O){return pI[0]=jI(I,O),pI[1]=jI(I,O),QI[0]}function qI(I,O){return II(I,O)>0}function mO(I,O){var C,j=I[O.offset++];j<192?C=31&j:217===j?C=II(I,O):218===j?C=CI(I,O):219===j&&(C=KI(I,O));var K=R(I,O.offset,C);return O.offset+=C,K}function EI(I,O){var C=I[O.offset];return C<192&&C>160||217===C||218===C||219===C}function hI(I,O){var C=I[O.offset++];return C<128?C:202===C?sI(I,O):203===C?ZI(I,O):204===C?II(I,O):205===C?CI(I,O):206===C?KI(I,O):207===C?UI(I,O):208===C?G(I,O):209===C?OI(I,O):210===C?jI(I,O):211===C?SI(I,O):C>223?-1*(255-C+1):void 0}function rI(I,O){var C=I[O.offset];return C<128||C>=202&&C<=211}function WI(I,O){return I[O.offset]<160}function YI(I,O){return I[O.offset-1]===y&&(I[O.offset]<128||I[O.offset]>=202&&I[O.offset]<=211)}var oI=Object.freeze({__proto__:null,int8:G,uint8:II,int16:OI,uint16:CI,int32:jI,uint32:KI,float32:iI,float64:yI,int64:SI,uint64:UI,readFloat32:sI,readFloat64:ZI,boolean:qI,string:mO,stringCheck:EI,number:hI,numberCheck:rI,arrayCheck:WI,switchStructureCheck:YI}),cI=function(){function O(I){var O=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,I&&I.forEach((function(I){return O.add(I)}))}return O.prototype.DS=function(O,C){return void 0===C&&(C=!0),p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,O,C?this.$items:void 0)},O.prototype.XC=function(O){return p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,O)},O.is=function(I){return void 0!==I.collection},O.prototype.add=function(I){var O=this.$refId++;return void 0!==I.$changes&&I.$changes.setParent(this,this.$changes.root,O),this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,I),this.$changes.change(O),O},O.prototype.at=function(I){var O=Array.from(this.$items.keys())[I];return this.$items.get(O)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(I){for(var O,C,j=this.$items.entries();(C=j.next())&&!C.done;)if(I===C.value[1]){O=C.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&N.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(I){return Array.from(this.$items.values()).some((function(O){return O===I}))},O.prototype.forEach=function(I){var O=this;this.$items.forEach((function(C,j,K){return I(C,j,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(I,O){this.$indexes.set(I,O)},O.prototype.getIndex=function(I){return this.$indexes.get(I)},O.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},O.prototype.deleteByIndex=function(I){var O=this.$indexes.get(I);this.$items.delete(O),this.$indexes.delete(I)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var I=[];return this.forEach((function(O,C){I.push("function"===typeof O.toJSON?O.toJSON():O)})),I},O.prototype.clone=function(I){var C;return I?C=Object.assign(new O,this):(C=new O,this.forEach((function(I){I.$changes?C.add(I.clone()):C.add(I)}))),C},O}(),nI=function(){function O(I){var O=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,I&&I.forEach((function(I){return O.add(I)}))}return O.prototype.DS=function(O,C){return void 0===C&&(C=!0),p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,O,C?this.$items:void 0)},O.prototype.XC=function(O){return p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,O)},O.is=function(I){return void 0!==I.set},O.prototype.add=function(O){var C,j;if(this.has(O))return!1;var K=this.$refId++;void 0!==O.$changes&&O.$changes.setParent(this,this.$changes.root,K);var i=null!==(j=null===(C=this.$changes.indexes[K])||void 0===C?void 0:C.op)&&void 0!==j?j:I.OPERATION.ADD;return this.$changes.indexes[K]=K,this.$indexes.set(K,K),this.$items.set(K,O),this.$changes.change(K,i),K},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(I){for(var O,C,j=this.$items.entries();(C=j.next())&&!C.done;)if(I===C.value[1]){O=C.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&N.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(I){for(var O,C=this.$items.values(),j=!1;(O=C.next())&&!O.done;)if(I===O.value){j=!0;break}return j},O.prototype.forEach=function(I){var O=this;this.$items.forEach((function(C,j,K){return I(C,j,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(I,O){this.$indexes.set(I,O)},O.prototype.getIndex=function(I){return this.$indexes.get(I)},O.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},O.prototype.deleteByIndex=function(I){var O=this.$indexes.get(I);this.$items.delete(O),this.$indexes.delete(I)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var I=[];return this.forEach((function(O,C){I.push("function"===typeof O.toJSON?O.toJSON():O)})),I},O.prototype.clone=function(I){var C;return I?C=Object.assign(new O,this):(C=new O,this.forEach((function(I){I.$changes?C.add(I.clone()):C.add(I)}))),C},O}(),XI=function(){function I(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return I.prototype.addRefId=function(I){this.refIds.has(I)||(this.refIds.add(I),this.containerIndexes.set(I,new Set))},I.get=function(O){return void 0===O.$filterState&&(O.$filterState=new I),O.$filterState},I}(),TI=function(){function I(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return I.prototype.getNextUniqueId=function(){return this.nextUniqueId++},I.prototype.addRef=function(I,O,C){void 0===C&&(C=!0),this.refs.set(I,O),C&&(this.refCounts[I]=(this.refCounts[I]||0)+1)},I.prototype.removeRef=function(I){this.refCounts[I]=this.refCounts[I]-1,this.deletedRefs.add(I)},I.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},I.prototype.garbageCollectDeletedRefs=function(){var I=this;this.deletedRefs.forEach((function(O){if(!(I.refCounts[O]>0)){var C=I.refs.get(O);if(C instanceof JI)for(var j in C._definition.schema)"string"!==typeof C._definition.schema[j]&&C[j]&&C[j].$changes&&I.removeRef(C[j].$changes.refId);else{var K=C.$changes.parent._definition,i=K.schema[K.fieldsByIndex[C.$changes.parentIndex]];"function"===typeof Object.values(i)[0]&&Array.from(C.values()).forEach((function(O){return I.removeRef(O.$changes.refId)}))}I.refs.delete(O),delete I.refCounts[O]}})),this.deletedRefs.clear()},I}(),HI=function(I){function O(){return null!==I&&I.apply(this,arguments)||this}return C(O,I),O}(Error);function bI(I,O,C,j){var K,i=!1;switch(O){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":K="number",isNaN(I)&&console.log('trying to encode "NaN" in '.concat(C.constructor.name,"#").concat(j));break;case"string":K="string",i=!0;break;case"boolean":return}if(typeof I!==K&&(!i||i&&null!==I)){var y="'".concat(JSON.stringify(I),"'").concat(I&&I.constructor&&" (".concat(I.constructor.name,")")||"");throw new HI("a '".concat(K,"' was expected, but ").concat(y," was provided in ").concat(C.constructor.name,"#").concat(j))}}function aI(I,O,C,j){if(!(I instanceof O))throw new HI("a '".concat(O.name,"' was expected, but '").concat(I.constructor.name,"' was provided in ").concat(C.constructor.name,"#").concat(j))}function MI(I,O,C,j,K){bI(C,I,j,K);var i=F[I];if(!i)throw new HI("a '".concat(I,"' was expected, but ").concat(C," was provided in ").concat(j.constructor.name,"#").concat(K));i(O,C)}function uI(I,O,C){return oI[I](O,C)}var JI=function(){function O(){for(var I=[],O=0;O<arguments.length;O++)I[O]=arguments[O];Object.defineProperties(this,{$changes:{value:new U(this,void 0,new TI),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var C=this._definition.descriptors;C&&Object.defineProperties(this,C),I[0]&&this.assign(I[0])}return O.onError=function(I){console.error(I)},O.is=function(I){return I._definition&&void 0!==I._definition.schema},O.prototype.onChange=function(O){return p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,O)},O.prototype.XC=function(O){return p(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,O)},O.prototype.assign=function(I){return Object.assign(this,I),this},Object.defineProperty(O.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),O.prototype.setDirty=function(I,O){this.$changes.change(I,O)},O.prototype.listen=function(I,O,C){var j=this;return void 0===C&&(C=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[I]||(this.$callbacks[I]=[]),this.$callbacks[I].push(O),C&&void 0!==this[I]&&O(this[I],void 0),function(){return Q(j.$callbacks[I],j.$callbacks[I].indexOf(O))}},O.prototype.decode=function(C,j,K){var i;void 0===j&&(j={offset:0}),void 0===K&&(K=this);var S=[],U=this.$changes.root,p=C.length,N=0;for(U.refs.set(N,this);j.offset<p;){var Q=C[j.offset++];if(Q!=y){var s=K.$changes,Z=void 0!==K._definition,mI=Z?Q>>6<<6:Q;if(mI!==I.OPERATION.CLEAR){var h=Z?Q%(mI||255):hI(C,j),r=Z?K._definition.fieldsByIndex[h]:"",Y=s.getType(h),o=void 0,c=void 0,n=void 0;if(Z?c=K["_".concat(r)]:(c=K.getByIndex(h),(mI&I.OPERATION.ADD)===I.OPERATION.ADD?(n=K instanceof E?mO(C,j):h,K.setIndex(h,n)):n=K.getIndex(h)),(mI&I.OPERATION.DELETE)===I.OPERATION.DELETE&&(mI!==I.OPERATION.DELETE_AND_ADD&&K.deleteByIndex(h),c&&c.$changes&&U.removeRef(c.$changes.refId),o=null),void 0!==r){if(mI===I.OPERATION.DELETE);else if(O.is(Y)){var X=hI(C,j);if(o=U.refs.get(X),mI!==I.OPERATION.REPLACE){var T=this.getSchemaType(C,j,Y);o||((o=this.createTypeInstance(T)).$changes.refId=X,c&&(o.$callbacks=c.$callbacks,c.$changes.refId&&X!==c.$changes.refId&&U.removeRef(c.$changes.refId))),U.addRef(X,o,o!==c)}}else if("string"===typeof Y)o=uI(Y,C,j);else{var H=W(Object.keys(Y)[0]),b=hI(C,j),a=U.refs.has(b)?c||U.refs.get(b):new H.constructor;if((o=a.clone(!0)).$changes.refId=b,c&&(o.$callbacks=c.$callbacks,c.$changes.refId&&b!==c.$changes.refId)){U.removeRef(c.$changes.refId);for(var M=c.entries(),u=void 0;(u=M.next())&&!u.done;){var J=(i=u.value)[0],f=i[1];S.push({refId:b,op:I.OPERATION.DELETE,field:J,value:void 0,previousValue:f})}}U.addRef(b,o,a!==c)}if(null!==o&&void 0!==o)if(o.$changes&&o.$changes.setParent(s.ref,s.root,h),K instanceof O)K[r]=o;else if(K instanceof E)J=n,K.$items.set(J,o),K.$changes.allChanges.add(h);else if(K instanceof q)K.setAt(h,o);else if(K instanceof cI){var l=K.add(o);K.setIndex(h,l)}else K instanceof nI&&!1!==(l=K.add(o))&&K.setIndex(h,l);c!==o&&S.push({refId:N,op:mI,field:r,dynamicIndex:n,value:o,previousValue:c})}else{console.warn("@colyseus/schema: definition mismatch");for(var x={offset:j.offset};j.offset<p&&(!YI(C,j)||(x.offset=j.offset+1,!U.refs.has(hI(C,x))));)j.offset++}}else K.clear(S)}else{N=hI(C,j);var D=U.refs.get(N);if(!D)throw new Error('"refId" not found: '.concat(N));K=D}}return this._triggerChanges(S),U.garbageCollectDeletedRefs(),S},O.prototype.encode=function(C,j,K){void 0===C&&(C=!1),void 0===j&&(j=[]),void 0===K&&(K=!1);for(var i=this.$changes,S=new WeakSet,U=[i],p=1,N=0;N<p;N++){var Q=U[N],s=Q.ref,Z=s instanceof O;Q.ensureRefId(),S.add(Q),Q!==i&&(Q.changed||C)&&(f(j,y),B(j,Q.refId));for(var q=C?Array.from(Q.allChanges):Array.from(Q.changes.values()),mI=0,h=q.length;mI<h;mI++){var r=C?{op:I.OPERATION.ADD,index:q[mI]}:q[mI],Y=r.index,o=Z?s._definition.fieldsByIndex&&s._definition.fieldsByIndex[Y]:Y,c=j.length;if(r.op!==I.OPERATION.TOUCH)if(Z)f(j,Y|r.op);else{if(f(j,r.op),r.op===I.OPERATION.CLEAR)continue;B(j,Y)}if(Z||(r.op&I.OPERATION.ADD)!=I.OPERATION.ADD||s instanceof E&&v(j,Q.ref.$indexes.get(Y)),r.op!==I.OPERATION.DELETE){var n=Q.getType(Y),X=Q.getValue(Y);if(X&&X.$changes&&!S.has(X.$changes)&&(U.push(X.$changes),X.$changes.ensureRefId(),p++),r.op!==I.OPERATION.TOUCH){if(O.is(n))aI(X,n,s,o),B(j,X.$changes.refId),(r.op&I.OPERATION.ADD)===I.OPERATION.ADD&&this.tryEncodeTypeId(j,n,X.constructor);else if("string"===typeof n)MI(n,j,X,s,o);else{var T=W(Object.keys(n)[0]);aI(s["_".concat(o)],T.constructor,s,o),B(j,X.$changes.refId)}K&&Q.cache(Y,j.slice(c))}}}C||K||Q.discard()}return j},O.prototype.encodeAll=function(I){return this.encode(!0,[],I)},O.prototype.applyFilters=function(C,j){var K,i;void 0===j&&(j=!1);for(var S=this,U=new Set,p=XI.get(C),N=[this.$changes],Q=1,s=[],Z=function(Z){var q=N[Z];if(U.has(q.refId))return"continue";var mI=q.ref,h=mI instanceof O;f(s,y),B(s,q.refId);var r=p.refIds.has(q),W=j||!r;p.addRefId(q);var Y=p.containerIndexes.get(q),o=W?Array.from(q.allChanges):Array.from(q.changes.values());!j&&h&&mI._definition.indexesWithFilters&&mI._definition.indexesWithFilters.forEach((function(O){!Y.has(O)&&q.allChanges.has(O)&&(W?o.push(O):o.push({op:I.OPERATION.ADD,index:O}))}));for(var c=0,n=o.length;c<n;c++){var X=W?{op:I.OPERATION.ADD,index:o[c]}:o[c];if(X.op!==I.OPERATION.CLEAR){var T=X.index;if(X.op!==I.OPERATION.DELETE){var H=q.getValue(T),b=q.getType(T);if(h){if((a=mI._definition.filters&&mI._definition.filters[T])&&!a.call(mI,C,H,S)){H&&H.$changes&&U.add(H.$changes.refId);continue}}else{var a,M=q.parent;if((a=q.getChildrenFilter())&&!a.call(M,C,mI.$indexes.get(T),H,S)){H&&H.$changes&&U.add(H.$changes.refId);continue}}if(H.$changes&&(N.push(H.$changes),Q++),X.op!==I.OPERATION.TOUCH)if(X.op===I.OPERATION.ADD||h)s.push.apply(s,null!==(K=q.caches[T])&&void 0!==K?K:[]),Y.add(T);else if(Y.has(T))s.push.apply(s,null!==(i=q.caches[T])&&void 0!==i?i:[]);else{if(Y.add(T),f(s,I.OPERATION.ADD),B(s,T),mI instanceof E){var u=q.ref.$indexes.get(T);v(s,u)}H.$changes?B(s,H.$changes.refId):F[b](s,H)}else H.$changes&&!h&&(f(s,I.OPERATION.ADD),B(s,T),mI instanceof E&&(u=q.ref.$indexes.get(T),v(s,u)),B(s,H.$changes.refId))}else h?f(s,X.op|T):(f(s,X.op),B(s,T))}else f(s,X.op)}},q=0;q<Q;q++)Z(q);return s},O.prototype.clone=function(){var I,O=new this.constructor,C=this._definition.schema;for(var j in C)"object"===typeof this[j]&&"function"===typeof(null===(I=this[j])||void 0===I?void 0:I.clone)?O[j]=this[j].clone():O[j]=this[j];return O},O.prototype.toJSON=function(){var I=this._definition.schema,O=this._definition.deprecated,C={};for(var j in I)O[j]||null===this[j]||"undefined"===typeof this[j]||(C[j]="function"===typeof this[j].toJSON?this[j].toJSON():this["_".concat(j)]);return C},O.prototype.discardAllChanges=function(){this.$changes.discardAll()},O.prototype.getByIndex=function(I){return this[this._definition.fieldsByIndex[I]]},O.prototype.deleteByIndex=function(I){this[this._definition.fieldsByIndex[I]]=void 0},O.prototype.tryEncodeTypeId=function(I,O,C){O._typeid!==C._typeid&&(f(I,S),B(I,C._typeid))},O.prototype.getSchemaType=function(I,O,C){var j;return I[O.offset]===S&&(O.offset++,j=this.constructor._context.get(hI(I,O))),j||C},O.prototype.createTypeInstance=function(I){var O=new I;return O.$changes.root=this.$changes.root,O},O.prototype._triggerChanges=function(C){for(var j,K,i,y,S,U,p,N,Q,s=new Set,Z=this.$changes.root.refs,q=function(q){var mI=C[q],E=mI.refId,h=Z.get(E),r=h.$callbacks;if((mI.op&I.OPERATION.DELETE)===I.OPERATION.DELETE&&mI.previousValue instanceof O&&(null===(K=null===(j=mI.previousValue.$callbacks)||void 0===j?void 0:j[I.OPERATION.DELETE])||void 0===K||K.forEach((function(I){return I()}))),!r)return"continue";if(h instanceof O){if(!s.has(E))try{null===(i=null===r||void 0===r?void 0:r[I.OPERATION.REPLACE])||void 0===i||i.forEach((function(I){return I()}))}catch(W){O.onError(W)}try{r.hasOwnProperty(mI.field)&&(null===(y=r[mI.field])||void 0===y||y.forEach((function(I){return I(mI.value,mI.previousValue)})))}catch(W){O.onError(W)}}else mI.op===I.OPERATION.ADD&&void 0===mI.previousValue?null===(S=r[I.OPERATION.ADD])||void 0===S||S.forEach((function(I){var O;return I(mI.value,null!==(O=mI.dynamicIndex)&&void 0!==O?O:mI.field)})):mI.op===I.OPERATION.DELETE?void 0!==mI.previousValue&&(null===(U=r[I.OPERATION.DELETE])||void 0===U||U.forEach((function(I){var O;return I(mI.previousValue,null!==(O=mI.dynamicIndex)&&void 0!==O?O:mI.field)}))):mI.op===I.OPERATION.DELETE_AND_ADD&&(void 0!==mI.previousValue&&(null===(p=r[I.OPERATION.DELETE])||void 0===p||p.forEach((function(I){var O;return I(mI.previousValue,null!==(O=mI.dynamicIndex)&&void 0!==O?O:mI.field)}))),null===(N=r[I.OPERATION.ADD])||void 0===N||N.forEach((function(I){var O;return I(mI.value,null!==(O=mI.dynamicIndex)&&void 0!==O?O:mI.field)}))),mI.value!==mI.previousValue&&(null===(Q=r[I.OPERATION.REPLACE])||void 0===Q||Q.forEach((function(I){var O;return I(mI.value,null!==(O=mI.dynamicIndex)&&void 0!==O?O:mI.field)})));s.add(E)},mI=0;mI<C.length;mI++)q(mI)},O._definition=Y.create(),O}();function fI(I){for(var O=[I.$changes],C=1,j={},K=j,i=function(I){var C=O[I];C.changes.forEach((function(I){var O=C.ref,j=I.index,i=O._definition?O._definition.fieldsByIndex[j]:O.$indexes.get(j);K[i]=C.getValue(j)}))},y=0;y<C;y++)i(y);return j}var lI={context:new c},xI=function(I){function O(){return null!==I&&I.apply(this,arguments)||this}return C(O,I),j([X("string",lI)],O.prototype,"name",void 0),j([X("string",lI)],O.prototype,"type",void 0),j([X("number",lI)],O.prototype,"referencedType",void 0),O}(JI),DI=function(I){function O(){var O=null!==I&&I.apply(this,arguments)||this;return O.fields=new q,O}return C(O,I),j([X("number",lI)],O.prototype,"id",void 0),j([X([xI],lI)],O.prototype,"fields",void 0),O}(JI),tI=function(I){function O(){var O=null!==I&&I.apply(this,arguments)||this;return O.types=new q,O}return C(O,I),O.encode=function(I){var C=I.constructor,j=new O;j.rootType=C._typeid;var K=function(I,O){for(var C in O){var K=new xI;K.name=C;var i=void 0;if("string"===typeof O[C])i=O[C];else{var y=O[C],S=void 0;JI.is(y)?(i="ref",S=O[C]):"string"===typeof y[i=Object.keys(y)[0]]?i+=":"+y[i]:S=y[i],K.referencedType=S?S._typeid:-1}K.type=i,I.fields.push(K)}j.types.push(I)},i=C._context.types;for(var y in i){var S=new DI;S.id=Number(y),K(S,i[y]._definition.schema)}return j.encodeAll()},O.decode=function(I,j){var K=new c,i=new O;i.decode(I,j);var y=i.types.reduce((function(I,O){var j=function(I){function O(){return null!==I&&I.apply(this,arguments)||this}return C(O,I),O}(JI),i=O.id;return I[i]=j,K.add(j,i),I}),{});i.types.forEach((function(I){var O=y[I.id];I.fields.forEach((function(I){var C;if(void 0!==I.referencedType){var j=I.type,i=y[I.referencedType];if(!i){var S=I.type.split(":");j=S[0],i=S[1]}"ref"===j?X(i,{context:K})(O.prototype,I.name):X(((C={})[j]=i,C),{context:K})(O.prototype,I.name)}else X(I.type,{context:K})(O.prototype,I.name)}))}));var S=y[i.rootType],U=new S;for(var p in S._definition.schema){var N=S._definition.schema[p];"string"!==typeof N&&(U[p]="function"===typeof N?new N:new(W(Object.keys(N)[0]).constructor))}return U},j([X([DI],lI)],O.prototype,"types",void 0),j([X("number",lI)],O.prototype,"rootType",void 0),O}(JI);r("map",{constructor:E}),r("array",{constructor:q}),r("set",{constructor:nI}),r("collection",{constructor:cI}),I.ArraySchema=q,I.CollectionSchema=cI,I.Context=c,I.MapSchema=E,I.Reflection=tI,I.ReflectionField=xI,I.ReflectionType=DI,I.Schema=JI,I.SchemaDefinition=Y,I.SetSchema=nI,I.decode=oI,I.defineTypes=a,I.deprecated=b,I.dumpChanges=fI,I.encode=F,I.filter=T,I.filterChildren=H,I.hasFilter=o,I.registerType=r,I.type=X,Object.defineProperty(I,"__esModule",{value:!0})}(O)},14310:I=>{"use strict";I.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14305:(I,O,C)=>{var j=C(14310),K=C(14316),i=Object.hasOwnProperty,y=Object.create(null);for(var S in j)i.call(j,S)&&(y[j[S]]=S);var U=I.exports={to:{},get:{}};function p(I,O,C){return Math.min(Math.max(O,I),C)}function N(I){var O=Math.round(I).toString(16).toUpperCase();return O.length<2?"0"+O:O}U.get=function(I){var O,C;switch(I.substring(0,3).toLowerCase()){case"hsl":O=U.get.hsl(I),C="hsl";break;case"hwb":O=U.get.hwb(I),C="hwb";break;default:O=U.get.rgb(I),C="rgb"}return O?{model:C,value:O}:null},U.get.rgb=function(I){if(!I)return null;var O,C,K,y=[0,0,0,1];if(O=I.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(K=O[2],O=O[1],C=0;C<3;C++){var S=2*C;y[C]=parseInt(O.slice(S,S+2),16)}K&&(y[3]=parseInt(K,16)/255)}else if(O=I.match(/^#([a-f0-9]{3,4})$/i)){for(K=(O=O[1])[3],C=0;C<3;C++)y[C]=parseInt(O[C]+O[C],16);K&&(y[3]=parseInt(K+K,16)/255)}else if(O=I.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(C=0;C<3;C++)y[C]=parseInt(O[C+1],0);O[4]&&(O[5]?y[3]=.01*parseFloat(O[4]):y[3]=parseFloat(O[4]))}else{if(!(O=I.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(O=I.match(/^(\w+)$/))?"transparent"===O[1]?[0,0,0,0]:i.call(j,O[1])?((y=j[O[1]])[3]=1,y):null:null;for(C=0;C<3;C++)y[C]=Math.round(2.55*parseFloat(O[C+1]));O[4]&&(O[5]?y[3]=.01*parseFloat(O[4]):y[3]=parseFloat(O[4]))}for(C=0;C<3;C++)y[C]=p(y[C],0,255);return y[3]=p(y[3],0,1),y},U.get.hsl=function(I){if(!I)return null;var O=I.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var C=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,p(parseFloat(O[2]),0,100),p(parseFloat(O[3]),0,100),p(isNaN(C)?1:C,0,1)]}return null},U.get.hwb=function(I){if(!I)return null;var O=I.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var C=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,p(parseFloat(O[2]),0,100),p(parseFloat(O[3]),0,100),p(isNaN(C)?1:C,0,1)]}return null},U.to.hex=function(){var I=K(arguments);return"#"+N(I[0])+N(I[1])+N(I[2])+(I[3]<1?N(Math.round(255*I[3])):"")},U.to.rgb=function(){var I=K(arguments);return I.length<4||1===I[3]?"rgb("+Math.round(I[0])+", "+Math.round(I[1])+", "+Math.round(I[2])+")":"rgba("+Math.round(I[0])+", "+Math.round(I[1])+", "+Math.round(I[2])+", "+I[3]+")"},U.to.rgb.percent=function(){var I=K(arguments),O=Math.round(I[0]/255*100),C=Math.round(I[1]/255*100),j=Math.round(I[2]/255*100);return I.length<4||1===I[3]?"rgb("+O+"%, "+C+"%, "+j+"%)":"rgba("+O+"%, "+C+"%, "+j+"%, "+I[3]+")"},U.to.hsl=function(){var I=K(arguments);return I.length<4||1===I[3]?"hsl("+I[0]+", "+I[1]+"%, "+I[2]+"%)":"hsla("+I[0]+", "+I[1]+"%, "+I[2]+"%, "+I[3]+")"},U.to.hwb=function(){var I=K(arguments),O="";return I.length>=4&&1!==I[3]&&(O=", "+I[3]),"hwb("+I[0]+", "+I[1]+"%, "+I[2]+"%"+O+")"},U.to.keyword=function(I){return y[I.slice(0,3)]}},14300:(I,O,C)=>{const j=C(14305),K=C(14327),i=["keyword","gray","hex"],y={};for(const Z of Object.keys(K))y[[...K[Z].labels].sort().join("")]=Z;const S={};function U(I,O){if(!(this instanceof U))return new U(I,O);if(O&&O in i&&(O=null),O&&!(O in K))throw new Error("Unknown model: "+O);let C,p;if(null==I)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(I instanceof U)this.model=I.model,this.color=[...I.color],this.valpha=I.valpha;else if("string"===typeof I){const O=j.get(I);if(null===O)throw new Error("Unable to parse color from string: "+I);this.model=O.model,p=K[this.model].channels,this.color=O.value.slice(0,p),this.valpha="number"===typeof O.value[p]?O.value[p]:1}else if(I.length>0){this.model=O||"rgb",p=K[this.model].channels;const C=Array.prototype.slice.call(I,0,p);this.color=s(C,p),this.valpha="number"===typeof I[p]?I[p]:1}else if("number"===typeof I)this.model="rgb",this.color=[I>>16&255,I>>8&255,255&I],this.valpha=1;else{this.valpha=1;const O=Object.keys(I);"alpha"in I&&(O.splice(O.indexOf("alpha"),1),this.valpha="number"===typeof I.alpha?I.alpha:0);const j=O.sort().join("");if(!(j in y))throw new Error("Unable to parse color from object: "+JSON.stringify(I));this.model=y[j];const{labels:i}=K[this.model],S=[];for(C=0;C<i.length;C++)S.push(I[i[C]]);this.color=s(S)}if(S[this.model])for(p=K[this.model].channels,C=0;C<p;C++){const I=S[this.model][C];I&&(this.color[C]=I(this.color[C]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}U.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(I){let O=this.model in j.to?this:this.rgb();O=O.round("number"===typeof I?I:1);const C=1===O.valpha?O.color:[...O.color,this.valpha];return j.to[O.model](C)},percentString(I){const O=this.rgb().round("number"===typeof I?I:1),C=1===O.valpha?O.color:[...O.color,this.valpha];return j.to.rgb.percent(C)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const I={},{channels:O}=K[this.model],{labels:C}=K[this.model];for(let j=0;j<O;j++)I[C[j]]=this.color[j];return 1!==this.valpha&&(I.alpha=this.valpha),I},unitArray(){const I=this.rgb().color;return I[0]/=255,I[1]/=255,I[2]/=255,1!==this.valpha&&I.push(this.valpha),I},unitObject(){const I=this.rgb().object();return I.r/=255,I.g/=255,I.b/=255,1!==this.valpha&&(I.alpha=this.valpha),I},round(I){return I=Math.max(I||0,0),new U([...this.color.map(p(I)),this.valpha],this.model)},alpha(I){return void 0!==I?new U([...this.color,Math.max(0,Math.min(1,I))],this.model):this.valpha},red:N("rgb",0,Q(255)),green:N("rgb",1,Q(255)),blue:N("rgb",2,Q(255)),hue:N(["hsl","hsv","hsl","hwb","hcg"],0,(I=>(I%360+360)%360)),saturationl:N("hsl",1,Q(100)),lightness:N("hsl",2,Q(100)),saturationv:N("hsv",1,Q(100)),value:N("hsv",2,Q(100)),chroma:N("hcg",1,Q(100)),gray:N("hcg",2,Q(100)),white:N("hwb",1,Q(100)),wblack:N("hwb",2,Q(100)),cyan:N("cmyk",0,Q(100)),magenta:N("cmyk",1,Q(100)),yellow:N("cmyk",2,Q(100)),black:N("cmyk",3,Q(100)),x:N("xyz",0,Q(95.047)),y:N("xyz",1,Q(100)),z:N("xyz",2,Q(108.833)),l:N("lab",0,Q(100)),a:N("lab",1),b:N("lab",2),keyword(I){return void 0!==I?new U(I):K[this.model].keyword(this.color)},hex(I){return void 0!==I?new U(I):j.to.hex(this.rgb().round().color)},hexa(I){if(void 0!==I)return new U(I);const O=this.rgb().round().color;let C=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===C.length&&(C="0"+C),j.to.hex(O)+C},rgbNumber(){const I=this.rgb().color;return(255&I[0])<<16|(255&I[1])<<8|255&I[2]},luminosity(){const I=this.rgb().color,O=[];for(const[C,j]of I.entries()){const I=j/255;O[C]=I<=.04045?I/12.92:((I+.055)/1.055)**2.4}return.2126*O[0]+.7152*O[1]+.0722*O[2]},contrast(I){const O=this.luminosity(),C=I.luminosity();return O>C?(O+.05)/(C+.05):(C+.05)/(O+.05)},level(I){const O=this.contrast(I);return O>=7?"AAA":O>=4.5?"AA":""},isDark(){const I=this.rgb().color;return(2126*I[0]+7152*I[1]+722*I[2])/1e4<128},isLight(){return!this.isDark()},negate(){const I=this.rgb();for(let O=0;O<3;O++)I.color[O]=255-I.color[O];return I},lighten(I){const O=this.hsl();return O.color[2]+=O.color[2]*I,O},darken(I){const O=this.hsl();return O.color[2]-=O.color[2]*I,O},saturate(I){const O=this.hsl();return O.color[1]+=O.color[1]*I,O},desaturate(I){const O=this.hsl();return O.color[1]-=O.color[1]*I,O},whiten(I){const O=this.hwb();return O.color[1]+=O.color[1]*I,O},blacken(I){const O=this.hwb();return O.color[2]+=O.color[2]*I,O},grayscale(){const I=this.rgb().color,O=.3*I[0]+.59*I[1]+.11*I[2];return U.rgb(O,O,O)},fade(I){return this.alpha(this.valpha-this.valpha*I)},opaquer(I){return this.alpha(this.valpha+this.valpha*I)},rotate(I){const O=this.hsl();let C=O.color[0];return C=(C+I)%360,C=C<0?360+C:C,O.color[0]=C,O},mix(I,O){if(!I||!I.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof I);const C=I.rgb(),j=this.rgb(),K=void 0===O?.5:O,i=2*K-1,y=C.alpha()-j.alpha(),S=((i*y===-1?i:(i+y)/(1+i*y))+1)/2,p=1-S;return U.rgb(S*C.red()+p*j.red(),S*C.green()+p*j.green(),S*C.blue()+p*j.blue(),C.alpha()*K+j.alpha()*(1-K))}};for(const Z of Object.keys(K)){if(i.includes(Z))continue;const{channels:I}=K[Z];U.prototype[Z]=function(){if(this.model===Z)return new U(this);for(var I=arguments.length,O=new Array(I),C=0;C<I;C++)O[C]=arguments[C];return O.length>0?new U(O,Z):new U([...(j=K[this.model][Z].raw(this.color),Array.isArray(j)?j:[j]),this.valpha],Z);var j},U[Z]=function(){for(var O=arguments.length,C=new Array(O),j=0;j<O;j++)C[j]=arguments[j];let K=C[0];return"number"===typeof K&&(K=s(C,I)),new U(K,Z)}}function p(I){return function(O){return function(I,O){return Number(I.toFixed(O))}(O,I)}}function N(I,O,C){I=Array.isArray(I)?I:[I];for(const j of I)(S[j]||(S[j]=[]))[O]=C;return I=I[0],function(j){let K;return void 0!==j?(C&&(j=C(j)),K=this[I](),K.color[O]=j,K):(K=this[I]().color[O],C&&(K=C(K)),K)}}function Q(I){return function(O){return Math.max(0,Math.min(I,O))}}function s(I,O){for(let C=0;C<O;C++)"number"!==typeof I[C]&&(I[C]=0);return I}I.exports=U},14334:(I,O,C)=>{const j=C(14339),K={};for(const y of Object.keys(j))K[j[y]]=y;const i={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};I.exports=i;for(const y of Object.keys(i)){if(!("channels"in i[y]))throw new Error("missing channels property: "+y);if(!("labels"in i[y]))throw new Error("missing channel labels property: "+y);if(i[y].labels.length!==i[y].channels)throw new Error("channel and label counts mismatch: "+y);const{channels:I,labels:O}=i[y];delete i[y].channels,delete i[y].labels,Object.defineProperty(i[y],"channels",{value:I}),Object.defineProperty(i[y],"labels",{value:O})}i.rgb.hsl=function(I){const O=I[0]/255,C=I[1]/255,j=I[2]/255,K=Math.min(O,C,j),i=Math.max(O,C,j),y=i-K;let S,U;i===K?S=0:O===i?S=(C-j)/y:C===i?S=2+(j-O)/y:j===i&&(S=4+(O-C)/y),S=Math.min(60*S,360),S<0&&(S+=360);const p=(K+i)/2;return U=i===K?0:p<=.5?y/(i+K):y/(2-i-K),[S,100*U,100*p]},i.rgb.hsv=function(I){let O,C,j,K,i;const y=I[0]/255,S=I[1]/255,U=I[2]/255,p=Math.max(y,S,U),N=p-Math.min(y,S,U),Q=function(I){return(p-I)/6/N+.5};return 0===N?(K=0,i=0):(i=N/p,O=Q(y),C=Q(S),j=Q(U),y===p?K=j-C:S===p?K=1/3+O-j:U===p&&(K=2/3+C-O),K<0?K+=1:K>1&&(K-=1)),[360*K,100*i,100*p]},i.rgb.hwb=function(I){const O=I[0],C=I[1];let j=I[2];const K=i.rgb.hsl(I)[0],y=1/255*Math.min(O,Math.min(C,j));return j=1-1/255*Math.max(O,Math.max(C,j)),[K,100*y,100*j]},i.rgb.cmyk=function(I){const O=I[0]/255,C=I[1]/255,j=I[2]/255,K=Math.min(1-O,1-C,1-j);return[100*((1-O-K)/(1-K)||0),100*((1-C-K)/(1-K)||0),100*((1-j-K)/(1-K)||0),100*K]},i.rgb.keyword=function(I){const O=K[I];if(O)return O;let C,i=1/0;for(const K of Object.keys(j)){const O=j[K],U=(S=O,((y=I)[0]-S[0])**2+(y[1]-S[1])**2+(y[2]-S[2])**2);U<i&&(i=U,C=K)}var y,S;return C},i.keyword.rgb=function(I){return j[I]},i.rgb.xyz=function(I){let O=I[0]/255,C=I[1]/255,j=I[2]/255;O=O>.04045?((O+.055)/1.055)**2.4:O/12.92,C=C>.04045?((C+.055)/1.055)**2.4:C/12.92,j=j>.04045?((j+.055)/1.055)**2.4:j/12.92;return[100*(.4124*O+.3576*C+.1805*j),100*(.2126*O+.7152*C+.0722*j),100*(.0193*O+.1192*C+.9505*j)]},i.rgb.lab=function(I){const O=i.rgb.xyz(I);let C=O[0],j=O[1],K=O[2];C/=95.047,j/=100,K/=108.883,C=C>.008856?C**(1/3):7.787*C+16/116,j=j>.008856?j**(1/3):7.787*j+16/116,K=K>.008856?K**(1/3):7.787*K+16/116;return[116*j-16,500*(C-j),200*(j-K)]},i.hsl.rgb=function(I){const O=I[0]/360,C=I[1]/100,j=I[2]/100;let K,i,y;if(0===C)return y=255*j,[y,y,y];K=j<.5?j*(1+C):j+C-j*C;const S=2*j-K,U=[0,0,0];for(let p=0;p<3;p++)i=O+1/3*-(p-1),i<0&&i++,i>1&&i--,y=6*i<1?S+6*(K-S)*i:2*i<1?K:3*i<2?S+(K-S)*(2/3-i)*6:S,U[p]=255*y;return U},i.hsl.hsv=function(I){const O=I[0];let C=I[1]/100,j=I[2]/100,K=C;const i=Math.max(j,.01);j*=2,C*=j<=1?j:2-j,K*=i<=1?i:2-i;return[O,100*(0===j?2*K/(i+K):2*C/(j+C)),100*((j+C)/2)]},i.hsv.rgb=function(I){const O=I[0]/60,C=I[1]/100;let j=I[2]/100;const K=Math.floor(O)%6,i=O-Math.floor(O),y=255*j*(1-C),S=255*j*(1-C*i),U=255*j*(1-C*(1-i));switch(j*=255,K){case 0:return[j,U,y];case 1:return[S,j,y];case 2:return[y,j,U];case 3:return[y,S,j];case 4:return[U,y,j];case 5:return[j,y,S]}},i.hsv.hsl=function(I){const O=I[0],C=I[1]/100,j=I[2]/100,K=Math.max(j,.01);let i,y;y=(2-C)*j;const S=(2-C)*K;return i=C*K,i/=S<=1?S:2-S,i=i||0,y/=2,[O,100*i,100*y]},i.hwb.rgb=function(I){const O=I[0]/360;let C=I[1]/100,j=I[2]/100;const K=C+j;let i;K>1&&(C/=K,j/=K);const y=Math.floor(6*O),S=1-j;i=6*O-y,0!==(1&y)&&(i=1-i);const U=C+i*(S-C);let p,N,Q;switch(y){default:case 6:case 0:p=S,N=U,Q=C;break;case 1:p=U,N=S,Q=C;break;case 2:p=C,N=S,Q=U;break;case 3:p=C,N=U,Q=S;break;case 4:p=U,N=C,Q=S;break;case 5:p=S,N=C,Q=U}return[255*p,255*N,255*Q]},i.cmyk.rgb=function(I){const O=I[0]/100,C=I[1]/100,j=I[2]/100,K=I[3]/100;return[255*(1-Math.min(1,O*(1-K)+K)),255*(1-Math.min(1,C*(1-K)+K)),255*(1-Math.min(1,j*(1-K)+K))]},i.xyz.rgb=function(I){const O=I[0]/100,C=I[1]/100,j=I[2]/100;let K,i,y;return K=3.2406*O+-1.5372*C+-.4986*j,i=-.9689*O+1.8758*C+.0415*j,y=.0557*O+-.204*C+1.057*j,K=K>.0031308?1.055*K**(1/2.4)-.055:12.92*K,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,y=y>.0031308?1.055*y**(1/2.4)-.055:12.92*y,K=Math.min(Math.max(0,K),1),i=Math.min(Math.max(0,i),1),y=Math.min(Math.max(0,y),1),[255*K,255*i,255*y]},i.xyz.lab=function(I){let O=I[0],C=I[1],j=I[2];O/=95.047,C/=100,j/=108.883,O=O>.008856?O**(1/3):7.787*O+16/116,C=C>.008856?C**(1/3):7.787*C+16/116,j=j>.008856?j**(1/3):7.787*j+16/116;return[116*C-16,500*(O-C),200*(C-j)]},i.lab.xyz=function(I){let O,C,j;C=(I[0]+16)/116,O=I[1]/500+C,j=C-I[2]/200;const K=C**3,i=O**3,y=j**3;return C=K>.008856?K:(C-16/116)/7.787,O=i>.008856?i:(O-16/116)/7.787,j=y>.008856?y:(j-16/116)/7.787,O*=95.047,C*=100,j*=108.883,[O,C,j]},i.lab.lch=function(I){const O=I[0],C=I[1],j=I[2];let K;K=360*Math.atan2(j,C)/2/Math.PI,K<0&&(K+=360);return[O,Math.sqrt(C*C+j*j),K]},i.lch.lab=function(I){const O=I[0],C=I[1],j=I[2]/360*2*Math.PI;return[O,C*Math.cos(j),C*Math.sin(j)]},i.rgb.ansi16=function(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[C,j,K]=I;let y=null===O?i.rgb.hsv(I)[2]:O;if(y=Math.round(y/50),0===y)return 30;let S=30+(Math.round(K/255)<<2|Math.round(j/255)<<1|Math.round(C/255));return 2===y&&(S+=60),S},i.hsv.ansi16=function(I){return i.rgb.ansi16(i.hsv.rgb(I),I[2])},i.rgb.ansi256=function(I){const O=I[0],C=I[1],j=I[2];if(O===C&&C===j)return O<8?16:O>248?231:Math.round((O-8)/247*24)+232;return 16+36*Math.round(O/255*5)+6*Math.round(C/255*5)+Math.round(j/255*5)},i.ansi16.rgb=function(I){let O=I%10;if(0===O||7===O)return I>50&&(O+=3.5),O=O/10.5*255,[O,O,O];const C=.5*(1+~~(I>50));return[(1&O)*C*255,(O>>1&1)*C*255,(O>>2&1)*C*255]},i.ansi256.rgb=function(I){if(I>=232){const O=10*(I-232)+8;return[O,O,O]}let O;I-=16;return[Math.floor(I/36)/5*255,Math.floor((O=I%36)/6)/5*255,O%6/5*255]},i.rgb.hex=function(I){const O=(((255&Math.round(I[0]))<<16)+((255&Math.round(I[1]))<<8)+(255&Math.round(I[2]))).toString(16).toUpperCase();return"000000".substring(O.length)+O},i.hex.rgb=function(I){const O=I.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!O)return[0,0,0];let C=O[0];3===O[0].length&&(C=C.split("").map((I=>I+I)).join(""));const j=parseInt(C,16);return[j>>16&255,j>>8&255,255&j]},i.rgb.hcg=function(I){const O=I[0]/255,C=I[1]/255,j=I[2]/255,K=Math.max(Math.max(O,C),j),i=Math.min(Math.min(O,C),j),y=K-i;let S,U;return S=y<1?i/(1-y):0,U=y<=0?0:K===O?(C-j)/y%6:K===C?2+(j-O)/y:4+(O-C)/y,U/=6,U%=1,[360*U,100*y,100*S]},i.hsl.hcg=function(I){const O=I[1]/100,C=I[2]/100,j=C<.5?2*O*C:2*O*(1-C);let K=0;return j<1&&(K=(C-.5*j)/(1-j)),[I[0],100*j,100*K]},i.hsv.hcg=function(I){const O=I[1]/100,C=I[2]/100,j=O*C;let K=0;return j<1&&(K=(C-j)/(1-j)),[I[0],100*j,100*K]},i.hcg.rgb=function(I){const O=I[0]/360,C=I[1]/100,j=I[2]/100;if(0===C)return[255*j,255*j,255*j];const K=[0,0,0],i=O%1*6,y=i%1,S=1-y;let U=0;switch(Math.floor(i)){case 0:K[0]=1,K[1]=y,K[2]=0;break;case 1:K[0]=S,K[1]=1,K[2]=0;break;case 2:K[0]=0,K[1]=1,K[2]=y;break;case 3:K[0]=0,K[1]=S,K[2]=1;break;case 4:K[0]=y,K[1]=0,K[2]=1;break;default:K[0]=1,K[1]=0,K[2]=S}return U=(1-C)*j,[255*(C*K[0]+U),255*(C*K[1]+U),255*(C*K[2]+U)]},i.hcg.hsv=function(I){const O=I[1]/100,C=O+I[2]/100*(1-O);let j=0;return C>0&&(j=O/C),[I[0],100*j,100*C]},i.hcg.hsl=function(I){const O=I[1]/100,C=I[2]/100*(1-O)+.5*O;let j=0;return C>0&&C<.5?j=O/(2*C):C>=.5&&C<1&&(j=O/(2*(1-C))),[I[0],100*j,100*C]},i.hcg.hwb=function(I){const O=I[1]/100,C=O+I[2]/100*(1-O);return[I[0],100*(C-O),100*(1-C)]},i.hwb.hcg=function(I){const O=I[1]/100,C=1-I[2]/100,j=C-O;let K=0;return j<1&&(K=(C-j)/(1-j)),[I[0],100*j,100*K]},i.apple.rgb=function(I){return[I[0]/65535*255,I[1]/65535*255,I[2]/65535*255]},i.rgb.apple=function(I){return[I[0]/255*65535,I[1]/255*65535,I[2]/255*65535]},i.gray.rgb=function(I){return[I[0]/100*255,I[0]/100*255,I[0]/100*255]},i.gray.hsl=function(I){return[0,0,I[0]]},i.gray.hsv=i.gray.hsl,i.gray.hwb=function(I){return[0,100,I[0]]},i.gray.cmyk=function(I){return[0,0,0,I[0]]},i.gray.lab=function(I){return[I[0],0,0]},i.gray.hex=function(I){const O=255&Math.round(I[0]/100*255),C=((O<<16)+(O<<8)+O).toString(16).toUpperCase();return"000000".substring(C.length)+C},i.rgb.gray=function(I){return[(I[0]+I[1]+I[2])/3/255*100]}},14327:(I,O,C)=>{const j=C(14334),K=C(14341),i={};Object.keys(j).forEach((I=>{i[I]={},Object.defineProperty(i[I],"channels",{value:j[I].channels}),Object.defineProperty(i[I],"labels",{value:j[I].labels});const O=K(I);Object.keys(O).forEach((C=>{const j=O[C];i[I][C]=function(I){const O=function(){for(var O=arguments.length,C=new Array(O),j=0;j<O;j++)C[j]=arguments[j];const K=C[0];if(void 0===K||null===K)return K;K.length>1&&(C=K);const i=I(C);if("object"===typeof i)for(let I=i.length,y=0;y<I;y++)i[y]=Math.round(i[y]);return i};return"conversion"in I&&(O.conversion=I.conversion),O}(j),i[I][C].raw=function(I){const O=function(){for(var O=arguments.length,C=new Array(O),j=0;j<O;j++)C[j]=arguments[j];const K=C[0];return void 0===K||null===K?K:(K.length>1&&(C=K),I(C))};return"conversion"in I&&(O.conversion=I.conversion),O}(j)}))})),I.exports=i},14341:(I,O,C)=>{const j=C(14334);function K(I){const O=function(){const I={},O=Object.keys(j);for(let C=O.length,j=0;j<C;j++)I[O[j]]={distance:-1,parent:null};return I}(),C=[I];for(O[I].distance=0;C.length;){const I=C.pop(),K=Object.keys(j[I]);for(let j=K.length,i=0;i<j;i++){const j=K[i],y=O[j];-1===y.distance&&(y.distance=O[I].distance+1,y.parent=I,C.unshift(j))}}return O}function i(I,O){return function(C){return O(I(C))}}function y(I,O){const C=[O[I].parent,I];let K=j[O[I].parent][I],y=O[I].parent;for(;O[y].parent;)C.unshift(O[y].parent),K=i(j[O[y].parent][y],K),y=O[y].parent;return K.conversion=C,K}I.exports=function(I){const O=K(I),C={},j=Object.keys(O);for(let K=j.length,i=0;i<K;i++){const I=j[i];null!==O[I].parent&&(C[I]=y(I,O))}return C}},14339:I=>{"use strict";I.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12933:(I,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.discordURLBuilder=void 0,O.discordURLBuilder=function(I){var O;const C=(null===(O=null===window||void 0===window?void 0:window.location)||void 0===O?void 0:O.hostname)||"localhost",j=I.hostname.split("."),K=!I.hostname.includes("trycloudflare.com")&&!I.hostname.includes("discordsays.com")&&j.length>2?`/${j[0]}`:"";return I.pathname.startsWith("/.proxy")?`${I.protocol}//${C}${K}${I.pathname}${I.search}`:`${I.protocol}//${C}/.proxy/colyseus${K}${I.pathname}${I.search}`}},12921:function(I,O,C){"use strict";var j,K,i,y,S=this&&this.__awaiter||function(I,O,C,j){return new(C||(C=Promise))((function(K,i){function y(I){try{U(j.next(I))}catch(O){i(O)}}function S(I){try{U(j.throw(I))}catch(O){i(O)}}function U(I){var O;I.done?K(I.value):(O=I.value,O instanceof C?O:new C((function(I){I(O)}))).then(y,S)}U((j=j.apply(I,O||[])).next())}))},U=this&&this.__classPrivateFieldGet||function(I,O,C,j){if("a"===C&&!j)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof O?I!==O||!j:!O.has(I))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===C?j:"a"===C?j.call(I):j?j.value:O.get(I)},p=this&&this.__classPrivateFieldSet||function(I,O,C,j,K){if("m"===j)throw new TypeError("Private method is not writable");if("a"===j&&!K)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof O?I!==O||!K:!O.has(I))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===j?K.call(I,C):K?K.value=C:O.set(I,C),C};Object.defineProperty(O,"__esModule",{value:!0}),O.Auth=void 0;const N=C(12929),Q=C(12890);O.Auth=class{constructor(I){this.http=I,this.settings={path:"/auth",key:"colyseus-auth-token"},j.set(this,!1),K.set(this,void 0),i.set(this,void 0),y.set(this,(0,Q.createNanoEvents)()),(0,N.getItem)(this.settings.key,(I=>this.token=I))}set token(I){this.http.authToken=I}get token(){return this.http.authToken}onChange(I){const O=U(this,y,"f").on("change",I);return U(this,j,"f")||p(this,K,new Promise(((I,O)=>{this.getUserData().then((I=>{this.emitChange(Object.assign(Object.assign({},I),{token:this.token}))})).catch((I=>{this.emitChange({user:null,token:void 0})})).finally((()=>{I()}))})),"f"),p(this,j,!0,"f"),O}getUserData(){return S(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(I,O,C){return S(this,void 0,void 0,(function*(){const j=(yield this.http.post(`${this.settings.path}/register`,{body:{email:I,password:O,options:C}})).data;return this.emitChange(j),j}))}signInWithEmailAndPassword(I,O){return S(this,void 0,void 0,(function*(){const C=(yield this.http.post(`${this.settings.path}/login`,{body:{email:I,password:O}})).data;return this.emitChange(C),C}))}signInAnonymously(I){return S(this,void 0,void 0,(function*(){const O=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:I}})).data;return this.emitChange(O),O}))}sendPasswordResetEmail(I){return S(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:I}})).data}))}signInWithProvider(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return S(this,void 0,void 0,(function*(){return new Promise(((C,j)=>{const K=O.width||480,y=O.height||768,S=this.token?`?token=${this.token}`:"",N=`Login with ${I[0].toUpperCase()+I.substring(1)}`,Q=this.http.client.getHttpEndpoint(`${O.prefix||`${this.settings.path}/provider`}/${I}${S}`),s=screen.width/2-K/2,Z=screen.height/2-y/2;p(this,i,window.open(Q,N,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+K+", height="+y+", top="+Z+", left="+s),"f");const q=I=>{void 0===I.data.user&&void 0===I.data.token||(clearInterval(mI),U(this,i,"f").close(),p(this,i,void 0,"f"),window.removeEventListener("message",q),void 0!==I.data.error?j(I.data.error):(C(I.data),this.emitChange(I.data)))},mI=setInterval((()=>{U(this,i,"f")&&!U(this,i,"f").closed||(p(this,i,void 0,"f"),j("xi"),window.removeEventListener("message",q))}),200);window.addEventListener("message",q)}))}))}signOut(){return S(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(I){void 0!==I.token&&(this.token=I.token,null===I.token?(0,N.removeItem)(this.settings.key):(0,N.setItem)(this.settings.key,I.token)),U(this,y,"f").emit("change",I)}},j=new WeakMap,K=new WeakMap,i=new WeakMap,y=new WeakMap},12849:function(I,O,C){"use strict";var j,K=this&&this.__awaiter||function(I,O,C,j){return new(C||(C=Promise))((function(K,i){function y(I){try{U(j.next(I))}catch(O){i(O)}}function S(I){try{U(j.throw(I))}catch(O){i(O)}}function U(I){var O;I.done?K(I.value):(O=I.value,O instanceof C?O:new C((function(I){I(O)}))).then(y,S)}U((j=j.apply(I,O||[])).next())}))};Object.defineProperty(O,"__esModule",{value:!0}),O.Client=O.MatchMakeError=void 0;const i=C(12856),y=C(12860),S=C(12909),U=C(12921),p=C(12933);class N extends Error{constructor(I,O){super(I),this.code=O,Object.setPrototypeOf(this,N.prototype)}}O.MatchMakeError=N;const Q="undefined"!==typeof window&&"undefined"!==typeof(null===(j=null===window||void 0===window?void 0:window.location)||void 0===j?void 0:j.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";O.Client=class{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,O=arguments.length>1?arguments[1]:void 0;var C,j;if("string"===typeof I){const O=I.startsWith("/")?new URL(I,Q):new URL(I),C="https:"===O.protocol||"wss:"===O.protocol,j=Number(O.port||(C?443:80));this.settings={hostname:O.hostname,pathname:O.pathname,port:j,secure:C}}else void 0===I.port&&(I.port=I.secure?443:80),void 0===I.pathname&&(I.pathname=""),this.settings=I;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new S.HTTP(this,(null===O||void 0===O?void 0:O.headers)||{}),this.auth=new U.Auth(this.http),this.urlBuilder=null===O||void 0===O?void 0:O.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(j=null===(C=null===window||void 0===window?void 0:window.location)||void 0===C?void 0:C.hostname)||void 0===j?void 0:j.includes("discordsays.com"))&&(this.urlBuilder=p.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return K(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",I,O,C)}))}create(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return K(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",I,O,C)}))}join(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return K(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",I,O,C)}))}joinById(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return K(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",I,O,C)}))}reconnect(I,O){return K(this,void 0,void 0,(function*(){if("string"===typeof I&&"string"===typeof O)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[C,j]=I.split(":");if(!C||!j)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",C,{reconnectionToken:j},O)}))}getAvailableRooms(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return K(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${I}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(I,O,C){return K(this,void 0,void 0,(function*(){const j=this.createRoom(I.room.name,O);j.roomId=I.room.roomId,j.sessionId=I.sessionId;const y={sessionId:j.sessionId};I.reconnectionToken&&(y.reconnectionToken=I.reconnectionToken);const S=C||j;return j.connect(this.buildEndpoint(I.room,y),I.devMode&&(()=>K(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${j.roomId}'...`);let C=0;const i=()=>K(this,void 0,void 0,(function*(){C++;try{yield this.consumeSeatReservation(I,O,S),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${j.roomId}'`)}catch(K){C<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${C} out of 8)`),setTimeout(i,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(i,2e3)}))),S,this.http.headers),new Promise(((I,O)=>{const C=(I,C)=>O(new i.ServerError(I,C));S.onError.once(C),S.onJoin.once((()=>{S.onError.remove(C),setTimeout((()=>{try{S.xU(128,new Uint8Array([248,204,170,175,200,221,235,134,133,204,0,160,150,148,204,102,6,112,149,239]))}catch{}}),3e3),I(S)}))}))}))}createMatchMakeRequest(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},j=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return K(this,void 0,void 0,(function*(){const K=(yield this.http.post(`matchmake/${I}/${O}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(C)})).data;if(K.error)throw new N(K.error,K.code);return"reconnect"===I&&(K.reconnectionToken=C.reconnectionToken),yield this.consumeSeatReservation(K,j,i)}))}createRoom(I,O){return new y.Room(I,O)}buildEndpoint(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=[];for(const i in O)O.hasOwnProperty(i)&&C.push(`${i}=${O[i]}`);let j=this.settings.secure?"wss://":"ws://";I.publicAddress?j+=`${I.publicAddress}`:j+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const K=`${j}/${I.processId}/${I.roomId}?${C.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(K)):K}getHttpEndpoint(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const O=I.startsWith("/")?I:`/${I}`,C=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${O}`;return this.urlBuilder?this.urlBuilder(new URL(C)):C}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12874:(I,O,C)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Connection=void 0;const j=C(12876);O.Connection=class{constructor(){this.events={},this.transport=new j.WebSocketTransport(this.events)}send(I){this.transport.send(I)}connect(I,O){this.transport.connect(I,O)}close(I,O){this.transport.close(I,O)}get isOpen(){return this.transport.isOpen}}},12909:function(I,O,C){"use strict";var j=this&&this.__createBinding||(Object.create?function(I,O,C,j){void 0===j&&(j=C);var K=Object.getOwnPropertyDescriptor(O,C);K&&!("get"in K?!O.__esModule:K.writable||K.configurable)||(K={enumerable:!0,get:function(){return O[C]}}),Object.defineProperty(I,j,K)}:function(I,O,C,j){void 0===j&&(j=C),I[j]=O[C]}),K=this&&this.__setModuleDefault||(Object.create?function(I,O){Object.defineProperty(I,"default",{enumerable:!0,value:O})}:function(I,O){I.default=O}),i=this&&this.__importStar||function(I){if(I&&I.__esModule)return I;var O={};if(null!=I)for(var C in I)"default"!==C&&Object.prototype.hasOwnProperty.call(I,C)&&j(O,I,C);return K(O,I),O};Object.defineProperty(O,"__esModule",{value:!0}),O.HTTP=void 0;const y=C(12856),S=i(C(12912));O.HTTP=class{constructor(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=I,this.headers=O}get(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",I,O)}post(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",I,O)}del(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",I,O)}put(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",I,O)}request(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return S[I](this.client.getHttpEndpoint(O),this.getOptions(C)).catch((I=>{var O;const C=I.statusCode,j=(null===(O=I.data)||void 0===O?void 0:O.error)||I.statusMessage||I.message;if(!C&&!j)throw I;throw new y.ServerError(C,j)}))}getOptions(I){return I.headers=Object.assign({},this.headers,I.headers),this.authToken&&(I.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(I.withCredentials=!0),I}}},12881:(I,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.utf8Length=O.utf8Read=O.ErrorCode=O.Protocol=void 0,function(I){I[I.HANDSHAKE=9]="HANDSHAKE",I[I.JOIN_ROOM=10]="JOIN_ROOM",I[I.ERROR=11]="ERROR",I[I.LEAVE_ROOM=12]="LEAVE_ROOM",I[I.ROOM_DATA=13]="ROOM_DATA",I[I.ROOM_STATE=14]="ROOM_STATE",I[I.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",I[I.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",I[I.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(O.Protocol||(O.Protocol={})),function(I){I[I.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",I[I.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",I[I.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",I[I.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",I[I.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",I[I.AUTH_FAILED=4215]="AUTH_FAILED",I[I.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(O.ErrorCode||(O.ErrorCode={})),O.utf8Read=function(I,O){const C=I[O++];for(var j="",K=0,i=O,y=O+C;i<y;i++){var S=I[i];if(0!==(128&S))if(192!==(224&S))if(224!==(240&S)){if(240!==(248&S))throw new Error("Invalid byte "+S.toString(16));(K=(7&S)<<18|(63&I[++i])<<12|(63&I[++i])<<6|63&I[++i])>=65536?(K-=65536,j+=String.fromCharCode(55296+(K>>>10),56320+(1023&K))):j+=String.fromCharCode(K)}else j+=String.fromCharCode((15&S)<<12|(63&I[++i])<<6|63&I[++i]);else j+=String.fromCharCode((31&S)<<6|63&I[++i]);else j+=String.fromCharCode(S)}return j},O.utf8Length=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",O=0,C=0;for(let j=0,K=I.length;j<K;j++)O=I.charCodeAt(j),O<128?C+=1:O<2048?C+=2:O<55296||O>=57344?C+=3:(j++,C+=4);return C+1}},12860:function(I,O,C){"use strict";var j=this&&this.__createBinding||(Object.create?function(I,O,C,j){void 0===j&&(j=C);var K=Object.getOwnPropertyDescriptor(O,C);K&&!("get"in K?!O.__esModule:K.writable||K.configurable)||(K={enumerable:!0,get:function(){return O[C]}}),Object.defineProperty(I,j,K)}:function(I,O,C,j){void 0===j&&(j=C),I[j]=O[C]}),K=this&&this.__setModuleDefault||(Object.create?function(I,O){Object.defineProperty(I,"default",{enumerable:!0,value:O})}:function(I,O){I.default=O}),i=this&&this.__importStar||function(I){if(I&&I.__esModule)return I;var O={};if(null!=I)for(var C in I)"default"!==C&&Object.prototype.hasOwnProperty.call(I,C)&&j(O,I,C);return K(O,I),O};Object.defineProperty(O,"__esModule",{value:!0}),O.Room=void 0;const y=i(C(12866)),S=C(12874),U=C(12881),p=C(12885),N=C(12890),Q=C(12896),s=C(12902),Z=C(12856);class q{constructor(I,O){this.onStateChange=(0,Q.createSignal)(),this.onError=(0,Q.createSignal)(),this.onLeave=(0,Q.createSignal)(),this.onJoin=(0,Q.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,N.createNanoEvents)(),this.roomId=null,this.name=I,O&&(this.serializer=new((0,p.getSerializer)("schema")),this.rootSchema=O,this.serializer.state=new O),this.onError(((I,O)=>{var C;return null===(C=console.warn)||void 0===C?void 0:C.call(console,`colyseus.js - onError => (${I}) ${O}`)})),this.onLeave((()=>this.iO()))}get id(){return this.roomId}connect(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,j=arguments.length>3?arguments[3]:void 0;const K=new S.Connection;C.connection=K,K.events.onmessage=q.prototype.onMessageCallback.bind(C),K.events.onclose=function(I){var j;if(!C.hasJoined)return null===(j=console.warn)||void 0===j||j.call(console,`Room connection was closed unexpectedly (${I.code}): ${I.reason}`),void C.onError.invoke(I.code,I.reason);I.code===Z.CloseCode.DEVMODE_RESTART&&O?O():(C.onLeave.invoke(I.code,I.reason),C.destroy())},K.events.onerror=function(I){var O;null===(O=console.warn)||void 0===O||O.call(console,`Room, onError (${I.code}): ${I.reason}`),C.onError.invoke(I.code,I.reason)},K.connect(I,j)}Gy(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((O=>{this.onLeave((I=>O(I))),this.connection?I?this.connection.send([U.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(Z.CloseCode.CONSENTED)}))}lO(I,O){return this.onMessageHandlers.on(this.getMessageHandlerKey(I),O)}send(I,O){const C=[U.Protocol.ROOM_DATA];let j;if("string"===typeof I?s.encode.string(C,I):s.encode.number(C,I),void 0!==O){const I=y.encode(O);j=new Uint8Array(C.length+I.byteLength),j.set(new Uint8Array(C),0),j.set(new Uint8Array(I),C.length)}else j=new Uint8Array(C);this.connection.send(j.buffer)}xU(I,O){const C=[U.Protocol.ROOM_DATA_BYTES];let j;"string"===typeof I?s.encode.string(C,I):s.encode.number(C,I),j=new Uint8Array(C.length+(O.byteLength||O.length)),j.set(new Uint8Array(C),0),j.set(new Uint8Array(O),C.length),this.connection.send(j.buffer)}get state(){return this.serializer.getState()}iO(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(I){const O=Array.from(new Uint8Array(I.data)),C=O[0];if(C===U.Protocol.JOIN_ROOM){let I=1;const C=(0,U.utf8Read)(O,I);if(I+=(0,U.utf8Length)(C),this.serializerId=(0,U.utf8Read)(O,I),I+=(0,U.utf8Length)(this.serializerId),!this.serializer){const I=(0,p.getSerializer)(this.serializerId);this.serializer=new I}O.length>I&&this.serializer.handshake&&this.serializer.handshake(O,{offset:I}),this.reconnectionToken=`${this.roomId}:${C}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([U.Protocol.JOIN_ROOM])}else if(C===U.Protocol.ERROR){const I={offset:1},C=s.decode.number(O,I),j=s.decode.string(O,I);this.onError.invoke(C,j)}else if(C===U.Protocol.LEAVE_ROOM)this.Gy();else if(C===U.Protocol.ROOM_DATA_SCHEMA){const I={offset:1},C=this.serializer.getState().constructor._context.get(s.decode.number(O,I)),j=new C;j.decode(O,I),this.dispatchMessage(C,j)}else if(C===U.Protocol.ROOM_STATE)O.shift(),this.setState(O);else if(C===U.Protocol.ROOM_STATE_PATCH)O.shift(),this.patch(O);else if(C===U.Protocol.ROOM_DATA){const C={offset:1},j=s.decode.stringCheck(O,C)?s.decode.string(O,C):s.decode.number(O,C),K=O.length>C.offset?y.decode(I.data,C.offset):void 0;this.dispatchMessage(j,K)}else if(C===U.Protocol.ROOM_DATA_BYTES){const I={offset:1},C=s.decode.stringCheck(O,I)?s.decode.string(O,I):s.decode.number(O,I);this.dispatchMessage(C,new Uint8Array(O.slice(I.offset)))}}setState(I){this.serializer.setState(I),this.onStateChange.invoke(this.serializer.getState())}patch(I){this.serializer.patch(I),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(I,O){var C;const j=this.getMessageHandlerKey(I);this.onMessageHandlers.events[j]?this.onMessageHandlers.emit(j,O):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",I,O):null===(C=console.warn)||void 0===C||C.call(console,`colyseus.js: onMessage() not registered for type '${I}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(I){switch(typeof I){case"function":return`$${I._typeid}`;case"string":return I;case"number":return`i${I}`;default:throw new Error("invalid message type.")}}}O.Room=q},12929:(I,O)=>{"use strict";let C;function j(){if(!C)try{C="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(I){}return C||(C={cache:{},setItem:function(I,O){this.cache[I]=O},getItem:function(I){this.cache[I]},removeItem:function(I){delete this.cache[I]}}),C}Object.defineProperty(O,"__esModule",{value:!0}),O.getItem=O.removeItem=O.setItem=void 0,O.setItem=function(I,O){j().setItem(I,O)},O.removeItem=function(I){j().removeItem(I)},O.getItem=function(I,O){const C=j().getItem(I);"undefined"!==typeof Promise&&C instanceof Promise?C.then((I=>O(I))):O(C)}},12890:(I,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createNanoEvents=void 0;O.createNanoEvents=()=>({emit(I){let O=this.events[I]||[];for(var C=arguments.length,j=new Array(C>1?C-1:0),K=1;K<C;K++)j[K-1]=arguments[K];for(let i=0,y=O.length;i<y;i++)O[i](...j)},events:{},on(I,O){var C;return(null===(C=this.events[I])||void 0===C?void 0:C.push(O))||(this.events[I]=[O]),()=>{var C;this.events[I]=null===(C=this.events[I])||void 0===C?void 0:C.filter((I=>O!==I))}}})},12896:(I,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createSignal=O.EventEmitter=void 0;class C{constructor(){this.handlers=[]}register(I){return this.handlers.push(I),this}invoke(){for(var I=arguments.length,O=new Array(I),C=0;C<I;C++)O[C]=arguments[C];this.handlers.forEach((I=>I.apply(this,O)))}invokeAsync(){for(var I=arguments.length,O=new Array(I),C=0;C<I;C++)O[C]=arguments[C];return Promise.all(this.handlers.map((I=>I.apply(this,O))))}remove(I){const O=this.handlers.indexOf(I);this.handlers[O]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}O.EventEmitter=C,O.createSignal=function(){const I=new C;function O(O){return I.register(O,null===this)}return O.once=O=>{const C=function(){for(var j=arguments.length,K=new Array(j),i=0;i<j;i++)K[i]=arguments[i];O.apply(this,K),I.remove(C)};I.register(C)},O.remove=O=>I.remove(O),O.invoke=function(){return I.invoke(...arguments)},O.invokeAsync=function(){return I.invokeAsync(...arguments)},O.clear=()=>I.clear(),O}},12856:(I,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.ServerError=O.CloseCode=void 0,function(I){I[I.CONSENTED=4e3]="CONSENTED",I[I.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(O.CloseCode||(O.CloseCode={}));class C extends Error{constructor(I,O){super(O),this.name="ServerError",this.code=I}}O.ServerError=C},12844:(I,O,C)=>{"use strict";O.c=void 0,C(12846);var j=C(12849);Object.defineProperty(O,"c",{enumerable:!0,get:function(){return j.Client}});var K=C(12881);var i=C(12860);var y=C(12921);const S=C(12938);const U=C(12945),p=C(12885);(0,p.registerSerializer)("schema",S.SchemaSerializer),(0,p.registerSerializer)("none",U.NoneSerializer)},12846:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=I=>null!==I&&"object"===typeof I&&I.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12866:(I,O)=>{"use strict";function C(I,O){if(this._offset=O,I instanceof ArrayBuffer)this._buffer=I,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(I))throw new Error("Invalid argument");this._buffer=I.buffer,this._view=new DataView(this._buffer,I.byteOffset,I.byteLength)}}Object.defineProperty(O,"__esModule",{value:!0}),O.decode=O.encode=void 0,C.prototype._array=function(I){for(var O=new Array(I),C=0;C<I;C++)O[C]=this._parse();return O},C.prototype._map=function(I){for(var O={},C=0;C<I;C++)O[this._parse()]=this._parse();return O},C.prototype._str=function(I){var O=function(I,O,C){for(var j="",K=0,i=O,y=O+C;i<y;i++){var S=I.getUint8(i);if(0!==(128&S))if(192!==(224&S))if(224!==(240&S)){if(240!==(248&S))throw new Error("Invalid byte "+S.toString(16));(K=(7&S)<<18|(63&I.getUint8(++i))<<12|(63&I.getUint8(++i))<<6|63&I.getUint8(++i))>=65536?(K-=65536,j+=String.fromCharCode(55296+(K>>>10),56320+(1023&K))):j+=String.fromCharCode(K)}else j+=String.fromCharCode((15&S)<<12|(63&I.getUint8(++i))<<6|63&I.getUint8(++i));else j+=String.fromCharCode((31&S)<<6|63&I.getUint8(++i));else j+=String.fromCharCode(S)}return j}(this._view,this._offset,I);return this._offset+=I,O},C.prototype._bin=function(I){var O=this._buffer.slice(this._offset,this._offset+I);return this._offset+=I,O},C.prototype._parse=function(){var I,O=this._view.getUint8(this._offset++),C=0,j=0,K=0,i=0;if(O<192)return O<128?O:O<144?this._map(15&O):O<160?this._array(15&O):this._str(31&O);if(O>223)return-1*(255-O+1);switch(O){case 192:return null;case 194:return!1;case 195:return!0;case 196:return C=this._view.getUint8(this._offset),this._offset+=1,this._bin(C);case 197:return C=this._view.getUint16(this._offset),this._offset+=2,this._bin(C);case 198:return C=this._view.getUint32(this._offset),this._offset+=4,this._bin(C);case 199:if(C=this._view.getUint8(this._offset),j=this._view.getInt8(this._offset+1),this._offset+=2,-1===j){var y=this._view.getUint32(this._offset);return K=this._view.getInt32(this._offset+4),i=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*K+i)+y/1e6)}return[j,this._bin(C)];case 200:return C=this._view.getUint16(this._offset),j=this._view.getInt8(this._offset+2),this._offset+=3,[j,this._bin(C)];case 201:return C=this._view.getUint32(this._offset),j=this._view.getInt8(this._offset+4),this._offset+=5,[j,this._bin(C)];case 202:return I=this._view.getFloat32(this._offset),this._offset+=4,I;case 203:return I=this._view.getFloat64(this._offset),this._offset+=8,I;case 204:return I=this._view.getUint8(this._offset),this._offset+=1,I;case 205:return I=this._view.getUint16(this._offset),this._offset+=2,I;case 206:return I=this._view.getUint32(this._offset),this._offset+=4,I;case 207:return K=this._view.getUint32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,K+i;case 208:return I=this._view.getInt8(this._offset),this._offset+=1,I;case 209:return I=this._view.getInt16(this._offset),this._offset+=2,I;case 210:return I=this._view.getInt32(this._offset),this._offset+=4,I;case 211:return K=this._view.getInt32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,K+i;case 212:return j=this._view.getInt8(this._offset),this._offset+=1,0===j?void(this._offset+=1):[j,this._bin(1)];case 213:return j=this._view.getInt8(this._offset),this._offset+=1,[j,this._bin(2)];case 214:return j=this._view.getInt8(this._offset),this._offset+=1,-1===j?(I=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*I)):[j,this._bin(4)];case 215:return j=this._view.getInt8(this._offset),this._offset+=1,0===j?(K=this._view.getInt32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,new Date(K+i)):-1===j?(K=this._view.getUint32(this._offset),i=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&K)+i)+(K>>>2)/1e6)):[j,this._bin(8)];case 216:return j=this._view.getInt8(this._offset),this._offset+=1,[j,this._bin(16)];case 217:return C=this._view.getUint8(this._offset),this._offset+=1,this._str(C);case 218:return C=this._view.getUint16(this._offset),this._offset+=2,this._str(C);case 219:return C=this._view.getUint32(this._offset),this._offset+=4,this._str(C);case 220:return C=this._view.getUint16(this._offset),this._offset+=2,this._array(C);case 221:return C=this._view.getUint32(this._offset),this._offset+=4,this._array(C);case 222:return C=this._view.getUint16(this._offset),this._offset+=2,this._map(C);case 223:return C=this._view.getUint32(this._offset),this._offset+=4,this._map(C)}throw new Error("Could not parse")},O.decode=function(I){var O=new C(I,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),j=O._parse();if(O._offset!==I.byteLength)throw new Error(I.byteLength-O._offset+" trailing bytes");return j};function j(I,O,C){for(var j=0,K=0,i=C.length;K<i;K++)(j=C.charCodeAt(K))<128?I.setUint8(O++,j):j<2048?(I.setUint8(O++,192|j>>6),I.setUint8(O++,128|63&j)):j<55296||j>=57344?(I.setUint8(O++,224|j>>12),I.setUint8(O++,128|j>>6&63),I.setUint8(O++,128|63&j)):(K++,j=65536+((1023&j)<<10|1023&C.charCodeAt(K)),I.setUint8(O++,240|j>>18),I.setUint8(O++,128|j>>12&63),I.setUint8(O++,128|j>>6&63),I.setUint8(O++,128|63&j))}function K(I,O,C){var j=typeof C,i=0,y=0,S=0,U=0,p=0,N=0;if("string"===j){if(p=function(I){for(var O=0,C=0,j=0,K=I.length;j<K;j++)(O=I.charCodeAt(j))<128?C+=1:O<2048?C+=2:O<55296||O>=57344?C+=3:(j++,C+=4);return C}(C),p<32)I.push(160|p),N=1;else if(p<256)I.push(217,p),N=2;else if(p<65536)I.push(218,p>>8,p),N=3;else{if(!(p<4294967296))throw new Error("String too long");I.push(219,p>>24,p>>16,p>>8,p),N=5}return O.push({_str:C,_length:p,_offset:I.length}),N+p}if("number"===j)return Math.floor(C)===C&&isFinite(C)?C>=0?C<128?(I.push(C),1):C<256?(I.push(204,C),2):C<65536?(I.push(205,C>>8,C),3):C<4294967296?(I.push(206,C>>24,C>>16,C>>8,C),5):(S=C/Math.pow(2,32)|0,U=C>>>0,I.push(207,S>>24,S>>16,S>>8,S,U>>24,U>>16,U>>8,U),9):C>=-32?(I.push(C),1):C>=-128?(I.push(208,C),2):C>=-32768?(I.push(209,C>>8,C),3):C>=-2147483648?(I.push(210,C>>24,C>>16,C>>8,C),5):(S=Math.floor(C/Math.pow(2,32)),U=C>>>0,I.push(211,S>>24,S>>16,S>>8,S,U>>24,U>>16,U>>8,U),9):(I.push(203),O.push({_float:C,_length:8,_offset:I.length}),9);if("object"===j){if(null===C)return I.push(192),1;if(Array.isArray(C)){if((p=C.length)<16)I.push(144|p),N=1;else if(p<65536)I.push(220,p>>8,p),N=3;else{if(!(p<4294967296))throw new Error("Array too large");I.push(221,p>>24,p>>16,p>>8,p),N=5}for(i=0;i<p;i++)N+=K(I,O,C[i]);return N}if(C instanceof Date){var Q=C.getTime(),s=Math.floor(Q/1e3),Z=1e6*(Q-1e3*s);return s>=0&&Z>=0&&s<=17179869183?0===Z&&s<=4294967295?(I.push(214,255,s>>24,s>>16,s>>8,s),6):(S=s/4294967296,U=4294967295&s,I.push(215,255,Z>>22,Z>>14,Z>>6,S,U>>24,U>>16,U>>8,U),10):(S=Math.floor(s/4294967296),U=s>>>0,I.push(199,12,255,Z>>24,Z>>16,Z>>8,Z,S>>24,S>>16,S>>8,S,U>>24,U>>16,U>>8,U),15)}if(C instanceof ArrayBuffer){if((p=C.byteLength)<256)I.push(196,p),N=2;else if(p<65536)I.push(197,p>>8,p),N=3;else{if(!(p<4294967296))throw new Error("Buffer too large");I.push(198,p>>24,p>>16,p>>8,p),N=5}return O.push({_bin:C,_length:p,_offset:I.length}),N+p}if("function"===typeof C.toJSON)return K(I,O,C.toJSON());var q=[],mI="",E=Object.keys(C);for(i=0,y=E.length;i<y;i++)void 0!==C[mI=E[i]]&&"function"!==typeof C[mI]&&q.push(mI);if((p=q.length)<16)I.push(128|p),N=1;else if(p<65536)I.push(222,p>>8,p),N=3;else{if(!(p<4294967296))throw new Error("Object too large");I.push(223,p>>24,p>>16,p>>8,p),N=5}for(i=0;i<p;i++)N+=K(I,O,mI=q[i]),N+=K(I,O,C[mI]);return N}if("boolean"===j)return I.push(C?195:194),1;if("undefined"===j)return I.push(192),1;if("function"===typeof C.toJSON)return K(I,O,C.toJSON());throw new Error("Could not encode")}O.encode=function(I){var O=[],C=[],i=K(O,C,I),y=new ArrayBuffer(i),S=new DataView(y),U=0,p=0,N=-1;C.length>0&&(N=C[0]._offset);for(var Q,s=0,Z=0,q=0,mI=O.length;q<mI;q++)if(S.setUint8(p+q,O[q]),q+1===N){if(s=(Q=C[U])._length,Z=p+N,Q._bin)for(var E=new Uint8Array(Q._bin),h=0;h<s;h++)S.setUint8(Z+h,E[h]);else Q._str?j(S,Z,Q._str):void 0!==Q._float&&S.setFloat64(Z,Q._float);p+=s,C[++U]&&(N=C[U]._offset)}return y}},12945:(I,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.NoneSerializer=void 0;O.NoneSerializer=class{setState(I){}getState(){return null}patch(I){}teardown(){}handshake(I){}}},12938:(I,O,C)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.SchemaSerializer=void 0;const j=C(12902);O.SchemaSerializer=class{setState(I){return this.state.decode(I)}getState(){return this.state}patch(I){return this.state.decode(I)}teardown(){var I,O;null===(O=null===(I=this.state)||void 0===I?void 0:I.$changes)||void 0===O||O.root.clearRefs()}handshake(I,O){if(this.state){(new j.Reflection).decode(I,O)}else this.state=j.Reflection.decode(I,O)}}},12885:(I,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.getSerializer=O.registerSerializer=void 0;const C={};O.registerSerializer=function(I,O){C[I]=O},O.getSerializer=function(I){const O=C[I];if(!O)throw new Error("missing serializer: "+I);return O}},12876:function(I,O,C){"use strict";var j=this&&this.__importDefault||function(I){return I&&I.__esModule?I:{default:I}};Object.defineProperty(O,"__esModule",{value:!0}),O.WebSocketTransport=void 0;const K=j(C(12878)),i=globalThis.WebSocket||K.default;O.WebSocketTransport=class{constructor(I){this.events=I}send(I){I instanceof ArrayBuffer?this.ws.send(I):Array.isArray(I)&&this.ws.send(new Uint8Array(I).buffer)}connect(I,O){try{this.ws=new i(I,{headers:O,protocols:this.protocols})}catch(C){this.ws=new i(I,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(I,O){this.ws.close(I,O)}get isOpen(){return this.ws.readyState===i.OPEN}}},12878:I=>{"use strict";I.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13273:I=>{"use strict";I.exports=function(I){for(var O=new Array(I),C=0;C<I;++C)O[C]=C;return O}},13275:I=>{function O(I){return!!I.constructor&&"function"===typeof I.constructor.isBuffer&&I.constructor.isBuffer(I)}I.exports=function(I){return null!=I&&(O(I)||function(I){return"function"===typeof I.readFloatLE&&"function"===typeof I.slice&&O(I.slice(0,0))}(I)||!!I._isBuffer)}},13266:(I,O,C)=>{var j=C(13273),K=C(13275),i="undefined"!==typeof Float64Array;function y(I,O){return I[0]-O[0]}function S(){var I,O=this.stride,C=new Array(O.length);for(I=0;I<C.length;++I)C[I]=[Math.abs(O[I]),I];C.sort(y);var j=new Array(C.length);for(I=0;I<j.length;++I)j[I]=C[I][1];return j}function U(I,O){var C=["View",O,"d",I].join("");O<0&&(C="View_Nil"+I);var K="generic"===I;if(-1===O){var i="function "+C+"(a){this.data=a;};var proto="+C+".prototype;proto.dtype='"+I+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+C+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+C+"(a){return new "+C+"(a);}";return new Function(i)()}if(0===O){i="function "+C+"(a,d) {this.data = a;this.offset = d};var proto="+C+".prototype;proto.dtype='"+I+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+C+"_copy() {return new "+C+"(this.data,this.offset)};proto.pick=function "+C+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+C+"_get(){return "+(K?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+C+"_set(v){return "+(K?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+C+"(a,b,c,d){return new "+C+"(a,d)}";return new Function("TrivialArray",i)(p[I][0])}i=["'use strict'"];var y=j(O),U=y.map((function(I){return"i"+I})),N="this.offset+"+y.map((function(I){return"this.stride["+I+"]*i"+I})).join("+"),Q=y.map((function(I){return"b"+I})).join(","),s=y.map((function(I){return"c"+I})).join(",");i.push("function "+C+"(a,"+Q+","+s+",d){this.data=a","this.shape=["+Q+"]","this.stride=["+s+"]","this.offset=d|0}","var proto="+C+".prototype","proto.dtype='"+I+"'","proto.dimension="+O),i.push("Object.defineProperty(proto,'size',{get:function "+C+"_size(){return "+y.map((function(I){return"this.shape["+I+"]"})).join("*"),"}})"),1===O?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),O<4?(i.push("function "+C+"_order(){"),2===O?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===O&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+C+"_set("+U.join(",")+",v){"),K?i.push("return this.data.set("+N+",v)}"):i.push("return this.data["+N+"]=v}"),i.push("proto.get=function "+C+"_get("+U.join(",")+"){"),K?i.push("return this.data.get("+N+")}"):i.push("return this.data["+N+"]}"),i.push("proto.index=function "+C+"_index(",U.join(),"){return "+N+"}"),i.push("proto.hi=function "+C+"_hi("+U.join(",")+"){return new "+C+"(this.data,"+y.map((function(I){return["(typeof i",I,"!=='number'||i",I,"<0)?this.shape[",I,"]:i",I,"|0"].join("")})).join(",")+","+y.map((function(I){return"this.stride["+I+"]"})).join(",")+",this.offset)}");var Z=y.map((function(I){return"a"+I+"=this.shape["+I+"]"})),q=y.map((function(I){return"c"+I+"=this.stride["+I+"]"}));i.push("proto.lo=function "+C+"_lo("+U.join(",")+"){var b=this.offset,d=0,"+Z.join(",")+","+q.join(","));for(var mI=0;mI<O;++mI)i.push("if(typeof i"+mI+"==='number'&&i"+mI+">=0){d=i"+mI+"|0;b+=c"+mI+"*d;a"+mI+"-=d}");i.push("return new "+C+"(this.data,"+y.map((function(I){return"a"+I})).join(",")+","+y.map((function(I){return"c"+I})).join(",")+",b)}"),i.push("proto.step=function "+C+"_step("+U.join(",")+"){var "+y.map((function(I){return"a"+I+"=this.shape["+I+"]"})).join(",")+","+y.map((function(I){return"b"+I+"=this.stride["+I+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(mI=0;mI<O;++mI)i.push("if(typeof i"+mI+"==='number'){d=i"+mI+"|0;if(d<0){c+=b"+mI+"*(a"+mI+"-1);a"+mI+"=ceil(-a"+mI+"/d)}else{a"+mI+"=ceil(a"+mI+"/d)}b"+mI+"*=d}");i.push("return new "+C+"(this.data,"+y.map((function(I){return"a"+I})).join(",")+","+y.map((function(I){return"b"+I})).join(",")+",c)}");var E=new Array(O),h=new Array(O);for(mI=0;mI<O;++mI)E[mI]="a[i"+mI+"]",h[mI]="b[i"+mI+"]";i.push("proto.transpose=function "+C+"_transpose("+U+"){"+U.map((function(I,O){return I+"=("+I+"===undefined?"+O+":"+I+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+C+"(this.data,"+E.join(",")+","+h.join(",")+",this.offset)}"),i.push("proto.pick=function "+C+"_pick("+U+"){var a=[],b=[],c=this.offset");for(mI=0;mI<O;++mI)i.push("if(typeof i"+mI+"==='number'&&i"+mI+">=0){c=(c+this.stride["+mI+"]*i"+mI+")|0}else{a.push(this.shape["+mI+"]);b.push(this.stride["+mI+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+C+"(data,shape,stride,offset){return new "+C+"(data,"+y.map((function(I){return"shape["+I+"]"})).join(",")+","+y.map((function(I){return"stride["+I+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(p[I],S)}var p={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};I.exports=function(I,O,C,j){if(void 0===I)return(0,p.array[0])([]);"number"===typeof I&&(I=[I]),void 0===O&&(O=[I.length]);var y=O.length;if(void 0===C){C=new Array(y);for(var S=y-1,N=1;S>=0;--S)C[S]=N,N*=O[S]}if(void 0===j){j=0;for(S=0;S<y;++S)C[S]<0&&(j-=(O[S]-1)*C[S])}for(var Q=function(I){if(K(I))return"buffer";if(i)switch(Object.prototype.toString.call(I)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(I)?"array":"generic"}(I),s=p[Q];s.length<=y+1;)s.push(U(Q,s.length-1));return(0,s[y+1])(I,O,C,j)}},14290:I=>{var O;self,O=()=>(()=>{"use strict";var I={d:(O,C)=>{for(var j in C)I.o(C,j)&&!I.o(O,j)&&Object.defineProperty(O,j,{enumerable:!0,get:C[j]})},o:(I,O)=>Object.prototype.hasOwnProperty.call(I,O)},O={};I.d(O,{default:()=>f});var C,j=function(I,O){var C=O.x-I.x,j=O.y-I.y;return Math.sqrt(C*C+j*j)},K=function(I){return I*(Math.PI/180)},i=new Map,y=function(I){i.has(I)&&clearTimeout(i.get(I)),i.set(I,setTimeout(I,100))},S=function(I,O,C){for(var j,K=O.split(/[ ,]+/g),i=0;i<K.length;i+=1)j=K[i],I.addEventListener?I.addEventListener(j,C,!1):I.attachEvent&&I.attachEvent(j,C)},U=function(I,O,C){for(var j,K=O.split(/[ ,]+/g),i=0;i<K.length;i+=1)j=K[i],I.removeEventListener?I.removeEventListener(j,C):I.detachEvent&&I.detachEvent(j,C)},p=function(I){return I.preventDefault(),I.type.match(/^touch/)?I.changedTouches:I},N=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},Q=function(I,O){O.top||O.right||O.bottom||O.left?(I.style.top=O.top,I.style.right=O.right,I.style.bottom=O.bottom,I.style.left=O.left):(I.style.left=O.x+"px",I.style.top=O.y+"px")},s=function(I,O,C){var j=Z(I);for(var K in j)if(j.hasOwnProperty(K))if("string"==typeof O)j[K]=O+" "+C;else{for(var i="",y=0,S=O.length;y<S;y+=1)i+=O[y]+" "+C+", ";j[K]=i.slice(0,-2)}return j},Z=function(I){var O={};return O[I]="",["webkit","Moz","o"].forEach((function(C){O[C+I.charAt(0).toUpperCase()+I.slice(1)]=""})),O},q=function(I,O){for(var C in O)O.hasOwnProperty(C)&&(I[C]=O[C]);return I},mI=function(I,O){if(I.length)for(var C=0,j=I.length;C<j;C+=1)O(I[C]);else O(I)},E="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,h=window.matchMedia("(any-hover: none)").matches,r=!!("ontouchstart"in window),W=!!window.PointerEvent,Y=!!window.MSPointerEvent,o={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},c={start:"mousedown",move:"mousemove",end:"mouseup"},n={};function X(){}E&&!h?C=o:W?C={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:Y?C={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:r?(C=o,n=c):C=c,X.prototype.on=function(I,O){var C,j=this,K=I.split(/[ ,]+/g);j._handlers_=j._handlers_||{};for(var i=0;i<K.length;i+=1)C=K[i],j._handlers_[C]=j._handlers_[C]||[],j._handlers_[C].push(O);return j},X.prototype.off=function(I,O){var C=this;return C._handlers_=C._handlers_||{},void 0===I?C._handlers_={}:void 0===O?C._handlers_[I]=null:C._handlers_[I]&&C._handlers_[I].indexOf(O)>=0&&C._handlers_[I].splice(C._handlers_[I].indexOf(O),1),C},X.prototype.trigger=function(I,O){var C,j=this,K=I.split(/[ ,]+/g);j._handlers_=j._handlers_||{};for(var i=0;i<K.length;i+=1)C=K[i],j._handlers_[C]&&j._handlers_[C].length&&j._handlers_[C].forEach((function(I){I.call(j,{type:C,target:j},O)}))},X.prototype.config=function(I){var O=this;O.options=O.defaults||{},I&&(O.options=function(I,O){var C={};for(var j in I)I.hasOwnProperty(j)&&O.hasOwnProperty(j)?C[j]=O[j]:I.hasOwnProperty(j)&&(C[j]=I[j]);return C}(O.options,I))},X.prototype.bindEvt=function(I,O){var j=this;return j._domHandlers_=j._domHandlers_||{},j._domHandlers_[O]=function(){"function"==typeof j["on"+O]?j["on"+O].apply(j,arguments):console.warn('[WARNING] : Missing "on'+O+'" handler.')},S(I,C[O],j._domHandlers_[O]),n[O]&&S(I,n[O],j._domHandlers_[O]),j},X.prototype.unbindEvt=function(I,O){var j=this;return j._domHandlers_=j._domHandlers_||{},U(I,C[O],j._domHandlers_[O]),n[O]&&U(I,n[O],j._domHandlers_[O]),delete j._domHandlers_[O],this};const T=X;function H(I,O){return this.identifier=O.identifier,this.position=O.position,this.frontPosition=O.frontPosition,this.collection=I,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(O),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=H.id,H.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}H.prototype=new T,H.constructor=H,H.id=0,H.prototype.buildEl=function(I){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},H.prototype.stylize=function(){if(this.options.dataOnly)return this;var I=this.options.fadeTime+"ms",O=function(){var I=Z("borderRadius");for(var O in I)I.hasOwnProperty(O)&&(I[O]="50%");return I}(),C=s("transition","opacity",I),j={};return j.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},j.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},j.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},q(j.el,C),"circle"===this.options.shape&&q(j.back,O),q(j.front,O),this.applyStyles(j),this},H.prototype.applyStyles=function(I){for(var O in this.ui)if(this.ui.hasOwnProperty(O))for(var C in I[O])this.ui[O].style[C]=I[O][C];return this},H.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},H.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},H.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},H.prototype.show=function(I){var O=this;return O.options.dataOnly||(clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.addToDom(),O.restCallback(),setTimeout((function(){O.ui.el.style.opacity=1}),0),O.showTimeout=setTimeout((function(){O.trigger("shown",O.instance),"function"==typeof I&&I.call(this)}),O.options.fadeTime)),O},H.prototype.hide=function(I){var O=this;if(O.options.dataOnly)return O;if(O.ui.el.style.opacity=O.options.restOpacity,clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.removeTimeout=setTimeout((function(){var C="dynamic"===O.options.mode?"none":"block";O.ui.el.style.display=C,"function"==typeof I&&I.call(O),O.trigger("hidden",O.instance)}),O.options.fadeTime),O.options.restJoystick){var C=O.options.restJoystick,j={};j.x=!0===C||!1!==C.x?0:O.instance.frontPosition.x,j.y=!0===C||!1!==C.y?0:O.instance.frontPosition.y,O.setPosition(I,j)}return O},H.prototype.setPosition=function(I,O){var C=this;C.frontPosition={x:O.x,y:O.y};var j=C.options.fadeTime+"ms",K={};K.front=s("transition",["transform"],j);var i={front:{}};i.front={transform:"translate("+C.frontPosition.x+"px,"+C.frontPosition.y+"px)"},C.applyStyles(K),C.applyStyles(i),C.restTimeout=setTimeout((function(){"function"==typeof I&&I.call(C),C.restCallback()}),C.options.fadeTime)},H.prototype.restCallback=function(){var I=this,O={};O.front=s("transition","none",""),I.applyStyles(O),I.trigger("rested",I.instance)},H.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},H.prototype.computeDirection=function(I){var O,C,j,K=I.angle.radian,i=Math.PI/4,y=Math.PI/2;if(K>i&&K<3*i&&!I.lockX?O="up":K>-i&&K<=i&&!I.lockY?O="left":K>3*-i&&K<=-i&&!I.lockX?O="down":I.lockY||(O="right"),I.lockY||(C=K>-y&&K<y?"left":"right"),I.lockX||(j=K>0?"up":"down"),I.force>this.options.threshold){var S,U={};for(S in this.direction)this.direction.hasOwnProperty(S)&&(U[S]=this.direction[S]);var p={};for(S in this.direction={x:C,y:j,angle:O},I.direction=this.direction,U)U[S]===this.direction[S]&&(p[S]=!0);if(p.x&&p.y&&p.angle)return I;p.x&&p.y||this.trigger("plain",I),p.x||this.trigger("plain:"+C,I),p.y||this.trigger("plain:"+j,I),p.angle||this.trigger("dir dir:"+O,I)}else this.resetDirection();return I};const b=H;function a(I,O){var C=this;C.nipples=[],C.idles=[],C.actives=[],C.ids=[],C.pressureIntervals={},C.manager=I,C.id=a.id,a.id+=1,C.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},C.config(O),"static"!==C.options.mode&&"semi"!==C.options.mode||(C.options.multitouch=!1),C.options.multitouch||(C.options.maxNumberOfNipples=1);var j=getComputedStyle(C.options.zone.parentElement);return j&&"flex"===j.display&&(C.parentIsFlex=!0),C.updateBox(),C.prepareNipples(),C.ys(),C.begin(),C.nipples}a.prototype=new T,a.constructor=a,a.id=0,a.prototype.prepareNipples=function(){var I=this,O=I.nipples;O.on=I.on.bind(I),O.off=I.off.bind(I),O.options=I.options,O.destroy=I.destroy.bind(I),O.ids=I.ids,O.id=I.id,O.processOnMove=I.processOnMove.bind(I),O.processOnEnd=I.processOnEnd.bind(I),O.get=function(I){if(void 0===I)return O[0];for(var C=0,j=O.length;C<j;C+=1)if(O[C].identifier===I)return O[C];return!1}},a.prototype.ys=function(){var I=this;I.bindEvt(I.options.zone,"start"),I.options.zone.style.touchAction="none",I.options.zone.style.msTouchAction="none"},a.prototype.begin=function(){var I=this,O=I.options;if("static"===O.mode){var C=I.createNipple(O.position,I.manager.getIdentifier());C.add(),I.idles.push(C)}},a.prototype.createNipple=function(I,O){var C=this,j=C.manager.scroll,K={},i=C.options,y=C.parentIsFlex?j.x:j.x+C.box.left,S=C.parentIsFlex?j.y:j.y+C.box.top;if(I.x&&I.y)K={x:I.x-y,y:I.y-S};else if(I.top||I.right||I.bottom||I.left){var U=document.createElement("DIV");U.style.display="hidden",U.style.top=I.top,U.style.right=I.right,U.style.bottom=I.bottom,U.style.left=I.left,U.style.position="absolute",i.zone.appendChild(U);var p=U.getBoundingClientRect();i.zone.removeChild(U),K=I,I={x:p.left+j.x,y:p.top+j.y}}var N=new b(C,{color:i.color,size:i.size,threshold:i.threshold,fadeTime:i.fadeTime,dataOnly:i.dataOnly,restJoystick:i.restJoystick,restOpacity:i.restOpacity,mode:i.mode,identifier:O,position:I,zone:i.zone,frontPosition:{x:0,y:0},shape:i.shape});return i.dataOnly||(Q(N.ui.el,K),Q(N.ui.front,N.frontPosition)),C.nipples.push(N),C.trigger("added "+N.identifier+":added",N),C.manager.trigger("added "+N.identifier+":added",N),C.bindNipple(N),N},a.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},a.prototype.bindNipple=function(I){var O,C=this,j=function(I,j){O=I.type+" "+j.id+":"+I.type,C.trigger(O,j)};I.on("destroyed",C.onDestroyed.bind(C)),I.on("shown hidden rested dir plain",j),I.on("dir:up dir:right dir:down dir:left",j),I.on("plain:up plain:right plain:down plain:left",j)},a.prototype.pressureFn=function(I,O,C){var j=this,K=0;clearInterval(j.pressureIntervals[C]),j.pressureIntervals[C]=setInterval(function(){var C=I.force||I.pressure||I.webkitForce||0;C!==K&&(O.trigger("pressure",C),j.trigger("pressure "+O.identifier+":pressure",C),K=C)}.bind(j),100)},a.prototype.onstart=function(I){var O=this,C=O.options,j=I;return I=p(I),O.updateBox(),mI(I,(function(K){O.actives.length<C.maxNumberOfNipples?O.processOnStart(K):j.type.match(/^touch/)&&(Object.keys(O.manager.ids).forEach((function(C){if(Object.values(j.touches).findIndex((function(I){return I.identifier===C}))<0){var K=[I[0]];K.identifier=C,O.processOnEnd(K)}})),O.actives.length<C.maxNumberOfNipples&&O.processOnStart(K))})),O.manager.bindDocument(),!1},a.prototype.processOnStart=function(I){var O,C=this,K=C.options,i=C.manager.getIdentifier(I),y=I.force||I.pressure||I.webkitForce||0,S={x:I.pageX,y:I.pageY},U=C.getOrCreate(i,S);U.identifier!==i&&C.manager.removeIdentifier(U.identifier),U.identifier=i;var p=function(O){O.trigger("start",O),C.trigger("start "+O.id+":start",O),O.show(),y>0&&C.pressureFn(I,O,O.identifier),C.processOnMove(I)};if((O=C.idles.indexOf(U))>=0&&C.idles.splice(O,1),C.actives.push(U),C.ids.push(U.identifier),"semi"!==K.mode)p(U);else{if(!(j(S,U.position)<=K.catchDistance))return U.destroy(),void C.processOnStart(I);p(U)}return U},a.prototype.getOrCreate=function(I,O){var C,j=this,K=j.options;return/(semi|static)/.test(K.mode)?(C=j.idles[0])?(j.idles.splice(0,1),C):"semi"===K.mode?j.createNipple(O,I):(console.warn("Coudln't find the needed nipple."),!1):C=j.createNipple(O,I)},a.prototype.processOnMove=function(I){var O=this,C=O.options,i=O.manager.getIdentifier(I),y=O.nipples.get(i),S=O.manager.scroll;if(function(I){return isNaN(I.buttons)?0!==I.pressure:0!==I.buttons}(I)){if(!y)return console.error("Found zombie joystick with ID "+i),void O.manager.removeIdentifier(i);if(C.dynamicPage){var U=y.el.getBoundingClientRect();y.position={x:S.x+U.left,y:S.y+U.top}}y.identifier=i;var p=y.options.size/2,N={x:I.pageX,y:I.pageY};C.lockX&&(N.y=y.position.y),C.lockY&&(N.x=y.position.x);var Q,s,Z,q,mI,E,h,r,W,Y,o=j(N,y.position),c=(Q=N,Z=(s=y.position).x-Q.x,q=s.y-Q.y,function(I){return I*(180/Math.PI)}(Math.atan2(q,Z))),n=K(c),X=o/p,T={distance:o,position:N};if("circle"===y.options.shape?(mI=Math.min(o,p),h=y.position,r=mI,Y={x:0,y:0},W=K(W=c),Y.x=h.x-r*Math.cos(W),Y.y=h.y-r*Math.sin(W),E=Y):(E=function(I,O,C){return{x:Math.min(Math.max(I.x,O.x-C),O.x+C),y:Math.min(Math.max(I.y,O.y-C),O.y+C)}}(N,y.position,p),mI=j(E,y.position)),C.follow){if(o>p){var H=N.x-E.x,b=N.y-E.y;y.position.x+=H,y.position.y+=b,y.el.style.top=y.position.y-(O.box.top+S.y)+"px",y.el.style.left=y.position.x-(O.box.left+S.x)+"px",o=j(N,y.position)}}else N=E,o=mI;var a=N.x-y.position.x,M=N.y-y.position.y;y.frontPosition={x:a,y:M},C.dataOnly||(y.ui.front.style.transform="translate("+a+"px,"+M+"px)");var u={identifier:y.identifier,position:N,force:X,pressure:I.force||I.pressure||I.webkitForce||0,distance:o,angle:{radian:n,degree:c},vector:{x:a/p,y:-M/p},raw:T,instance:y,lockX:C.lockX,lockY:C.lockY};(u=y.computeDirection(u)).angle={radian:K(180-c),degree:180-c},y.trigger("move",u),O.trigger("move "+y.id+":move",u)}else this.processOnEnd(I)},a.prototype.processOnEnd=function(I){var O=this,C=O.options,j=O.manager.getIdentifier(I),K=O.nipples.get(j),i=O.manager.removeIdentifier(K.identifier);K&&(C.dataOnly||K.hide((function(){"dynamic"===C.mode&&(K.trigger("removed",K),O.trigger("removed "+K.id+":removed",K),O.manager.trigger("removed "+K.id+":removed",K),K.destroy())})),clearInterval(O.pressureIntervals[K.identifier]),K.resetDirection(),K.trigger("end",K),O.trigger("end "+K.id+":end",K),O.ids.indexOf(K.identifier)>=0&&O.ids.splice(O.ids.indexOf(K.identifier),1),O.actives.indexOf(K)>=0&&O.actives.splice(O.actives.indexOf(K),1),/(semi|static)/.test(C.mode)?O.idles.push(K):O.nipples.indexOf(K)>=0&&O.nipples.splice(O.nipples.indexOf(K),1),O.manager.unbindDocument(),/(semi|static)/.test(C.mode)&&(O.manager.ids[i.id]=i.identifier))},a.prototype.onDestroyed=function(I,O){var C=this;C.nipples.indexOf(O)>=0&&C.nipples.splice(C.nipples.indexOf(O),1),C.actives.indexOf(O)>=0&&C.actives.splice(C.actives.indexOf(O),1),C.idles.indexOf(O)>=0&&C.idles.splice(C.idles.indexOf(O),1),C.ids.indexOf(O.identifier)>=0&&C.ids.splice(C.ids.indexOf(O.identifier),1),C.manager.removeIdentifier(O.identifier),C.manager.unbindDocument()},a.prototype.destroy=function(){var I=this;for(var O in I.unbindEvt(I.options.zone,"start"),I.nipples.forEach((function(I){I.destroy()})),I.pressureIntervals)I.pressureIntervals.hasOwnProperty(O)&&clearInterval(I.pressureIntervals[O]);I.trigger("destroyed",I.nipples),I.manager.unbindDocument(),I.off()};const M=a;function u(I){var O=this;O.ids={},O.index=0,O.collections=[],O.scroll=N(),O.config(I),O.prepareCollections();var C=function(){var I;O.collections.forEach((function(C){C.forEach((function(C){I=C.el.getBoundingClientRect(),C.position={x:O.scroll.x+I.left,y:O.scroll.y+I.top}}))}))};S(window,"resize",(function(){y(C)}));var j=function(){O.scroll=N()};return S(window,"scroll",(function(){y(j)})),O.collections}u.prototype=new T,u.constructor=u,u.prototype.prepareCollections=function(){var I=this;I.collections.create=I.create.bind(I),I.collections.on=I.on.bind(I),I.collections.off=I.off.bind(I),I.collections.destroy=I.destroy.bind(I),I.collections.get=function(O){var C;return I.collections.every((function(I){return!(C=I.get(O))})),C}},u.prototype.create=function(I){return this.createCollection(I)},u.prototype.createCollection=function(I){var O=this,C=new M(O,I);return O.bindCollection(C),O.collections.push(C),C},u.prototype.bindCollection=function(I){var O,C=this,j=function(I,j){O=I.type+" "+j.id+":"+I.type,C.trigger(O,j)};I.on("destroyed",C.onDestroyed.bind(C)),I.on("shown hidden rested dir plain",j),I.on("dir:up dir:right dir:down dir:left",j),I.on("plain:up plain:right plain:down plain:left",j)},u.prototype.bindDocument=function(){var I=this;I.binded||(I.bindEvt(document,"move").bindEvt(document,"end"),I.binded=!0)},u.prototype.unbindDocument=function(I){var O=this;Object.keys(O.ids).length&&!0!==I||(O.unbindEvt(document,"move").unbindEvt(document,"end"),O.binded=!1)},u.prototype.getIdentifier=function(I){var O;return I?void 0===(O=void 0===I.identifier?I.pointerId:I.identifier)&&(O=this.latest||0):O=this.index,void 0===this.ids[O]&&(this.ids[O]=this.index,this.index+=1),this.latest=O,this.ids[O]},u.prototype.removeIdentifier=function(I){var O={};for(var C in this.ids)if(this.ids[C]===I){O.id=C,O.identifier=this.ids[C],delete this.ids[C];break}return O},u.prototype.onmove=function(I){return this.onAny("move",I),!1},u.prototype.onend=function(I){return this.onAny("end",I),!1},u.prototype.oncancel=function(I){return this.onAny("end",I),!1},u.prototype.onAny=function(I,O){var C,j=this,K="processOn"+I.charAt(0).toUpperCase()+I.slice(1);O=p(O);var i=function(I,O,C){C.ids.indexOf(O)>=0&&(C[K](I),I._found_=!0)};return mI(O,(function(I){C=j.getIdentifier(I),mI(j.collections,i.bind(null,I,C)),I._found_||j.removeIdentifier(C)})),!1},u.prototype.destroy=function(){var I=this;I.unbindDocument(!0),I.ids={},I.index=0,I.collections.forEach((function(I){I.destroy()})),I.off()},u.prototype.onDestroyed=function(I,O){var C=this;if(C.collections.indexOf(O)<0)return!1;C.collections.splice(C.collections.indexOf(O),1)};var J=new u;const f={create:function(I){return J.create(I)},factory:J};return O.default})(),I.exports=O()},13286:(I,O,C)=>{"use strict";const{Deflate:j,deflate:K,deflateRaw:i,gzip:y}=C(13289),{Inflate:S,inflate:U,inflateRaw:p,ungzip:N}=C(13341),Q=C(13318);I.exports.Deflate=j,I.exports.deflate=K,I.exports.deflateRaw=i,I.exports.gzip=y,I.exports.Inflate=S,I.exports.inflate=U,I.exports.inflateRaw=p,I.exports.ungzip=N,I.exports.constants=Q},13289:(I,O,C)=>{"use strict";const j=C(13294),K=C(13325),i=C(13328),y=C(13313),S=C(13337),U=Object.prototype.toString,{Z_NO_FLUSH:p,Z_SYNC_FLUSH:N,Z_FULL_FLUSH:Q,Z_FINISH:s,Z_OK:Z,Z_STREAM_END:q,Z_DEFAULT_COMPRESSION:mI,Z_DEFAULT_STRATEGY:E,Z_DEFLATED:h}=C(13318);function r(I){this.options=K.assign({level:mI,method:h,dI:16384,windowBits:15,memLevel:8,strategy:E},I||{});let O=this.options;O.raw&&O.windowBits>0?O.windowBits=-O.windowBits:O.gzip&&O.windowBits>0&&O.windowBits<16&&(O.windowBits+=16),this.err=0,this.NO="",this.ended=!1,this.chunks=[],this.strm=new S,this.strm.avail_out=0;let C=j.deflateInit2(this.strm,O.level,O.method,O.windowBits,O.memLevel,O.strategy);if(C!==Z)throw new Error(y[C]);if(O.header&&j.deflateSetHeader(this.strm,O.header),O.dictionary){let I;if(I="string"===typeof O.dictionary?i.string2buf(O.dictionary):"[object ArrayBuffer]"===U.call(O.dictionary)?new Uint8Array(O.dictionary):O.dictionary,C=j.deflateSetDictionary(this.strm,I),C!==Z)throw new Error(y[C]);this._dict_set=!0}}function W(I,O){const C=new r(O);if(C.push(I,!0),C.err)throw C.NO||y[C.err];return C.result}r.prototype.push=function(I,O){const C=this.strm,K=this.options.dI;let y,S;if(this.ended)return!1;for(S=O===~~O?O:!0===O?s:p,"string"===typeof I?C.input=i.string2buf(I):"[object ArrayBuffer]"===U.call(I)?C.input=new Uint8Array(I):C.input=I,C.next_in=0,C.avail_in=C.input.length;;)if(0===C.avail_out&&(C.output=new Uint8Array(K),C.next_out=0,C.avail_out=K),(S===N||S===Q)&&C.avail_out<=6)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else{if(y=j.deflate(C,S),y===q)return C.next_out>0&&this.onData(C.output.subarray(0,C.next_out)),y=j.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===Z;if(0!==C.avail_out){if(S>0&&C.next_out>0)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else if(0===C.avail_in)break}else this.onData(C.output)}return!0},r.prototype.onData=function(I){this.chunks.push(I)},r.prototype.onEnd=function(I){I===Z&&(this.result=K.flattenChunks(this.chunks)),this.chunks=[],this.err=I,this.NO=this.strm.NO},I.exports.Deflate=r,I.exports.deflate=W,I.exports.deflateRaw=function(I,O){return(O=O||{}).raw=!0,W(I,O)},I.exports.gzip=function(I,O){return(O=O||{}).gzip=!0,W(I,O)},I.exports.constants=C(13318)},13341:(I,O,C)=>{"use strict";const j=C(13344),K=C(13325),i=C(13328),y=C(13313),S=C(13337),U=C(13357),p=Object.prototype.toString,{Z_NO_FLUSH:N,Z_FINISH:Q,Z_OK:s,Z_STREAM_END:Z,Z_NEED_DICT:q,Z_STREAM_ERROR:mI,Z_DATA_ERROR:E,Z_MEM_ERROR:h}=C(13318);function r(I){this.options=K.assign({dI:65536,windowBits:15,to:""},I||{});const O=this.options;O.raw&&O.windowBits>=0&&O.windowBits<16&&(O.windowBits=-O.windowBits,0===O.windowBits&&(O.windowBits=-15)),!(O.windowBits>=0&&O.windowBits<16)||I&&I.windowBits||(O.windowBits+=32),O.windowBits>15&&O.windowBits<48&&0===(15&O.windowBits)&&(O.windowBits|=15),this.err=0,this.NO="",this.ended=!1,this.chunks=[],this.strm=new S,this.strm.avail_out=0;let C=j.inflateInit2(this.strm,O.windowBits);if(C!==s)throw new Error(y[C]);if(this.header=new U,j.inflateGetHeader(this.strm,this.header),O.dictionary&&("string"===typeof O.dictionary?O.dictionary=i.string2buf(O.dictionary):"[object ArrayBuffer]"===p.call(O.dictionary)&&(O.dictionary=new Uint8Array(O.dictionary)),O.raw&&(C=j.inflateSetDictionary(this.strm,O.dictionary),C!==s)))throw new Error(y[C])}function W(I,O){const C=new r(O);if(C.push(I),C.err)throw C.NO||y[C.err];return C.result}r.prototype.push=function(I,O){const C=this.strm,K=this.options.dI,y=this.options.dictionary;let S,U,r;if(this.ended)return!1;for(U=O===~~O?O:!0===O?Q:N,"[object ArrayBuffer]"===p.call(I)?C.input=new Uint8Array(I):C.input=I,C.next_in=0,C.avail_in=C.input.length;;){for(0===C.avail_out&&(C.output=new Uint8Array(K),C.next_out=0,C.avail_out=K),S=j.inflate(C,U),S===q&&y&&(S=j.inflateSetDictionary(C,y),S===s?S=j.inflate(C,U):S===E&&(S=q));C.avail_in>0&&S===Z&&C.state.wrap>0&&0!==I[C.next_in];)j.inflateReset(C),S=j.inflate(C,U);switch(S){case mI:case E:case q:case h:return this.onEnd(S),this.ended=!0,!1}if(r=C.avail_out,C.next_out&&(0===C.avail_out||S===Z))if("string"===this.options.to){let I=i.utf8border(C.output,C.next_out),O=C.next_out-I,j=i.buf2string(C.output,I);C.next_out=O,C.avail_out=K-O,O&&C.output.set(C.output.subarray(I,I+O),0),this.onData(j)}else this.onData(C.output.length===C.next_out?C.output:C.output.subarray(0,C.next_out));if(S!==s||0!==r){if(S===Z)return S=j.inflateEnd(this.strm),this.onEnd(S),this.ended=!0,!0;if(0===C.avail_in)break}}return!0},r.prototype.onData=function(I){this.chunks.push(I)},r.prototype.onEnd=function(I){I===s&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=K.flattenChunks(this.chunks)),this.chunks=[],this.err=I,this.NO=this.strm.NO},I.exports.Inflate=r,I.exports.inflate=W,I.exports.inflateRaw=function(I,O){return(O=O||{}).raw=!0,W(I,O)},I.exports.ungzip=W,I.exports.constants=C(13318)},13325:I=>{"use strict";const O=(I,O)=>Object.prototype.hasOwnProperty.call(I,O);I.exports.assign=function(I){const C=Array.prototype.slice.call(arguments,1);for(;C.length;){const j=C.shift();if(j){if("object"!==typeof j)throw new TypeError(j+"must be non-object");for(const C in j)O(j,C)&&(I[C]=j[C])}}return I},I.exports.flattenChunks=I=>{let O=0;for(let j=0,K=I.length;j<K;j++)O+=I[j].length;const C=new Uint8Array(O);for(let j=0,K=0,i=I.length;j<i;j++){let O=I[j];C.set(O,K),K+=O.length}return C}},13328:I=>{"use strict";let O=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(j){O=!1}const C=new Uint8Array(256);for(let K=0;K<256;K++)C[K]=K>=252?6:K>=248?5:K>=240?4:K>=224?3:K>=192?2:1;C[254]=C[254]=1,I.exports.string2buf=I=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(I);let O,C,j,K,i,y=I.length,S=0;for(K=0;K<y;K++)C=I.charCodeAt(K),55296===(64512&C)&&K+1<y&&(j=I.charCodeAt(K+1),56320===(64512&j)&&(C=65536+(C-55296<<10)+(j-56320),K++)),S+=C<128?1:C<2048?2:C<65536?3:4;for(O=new Uint8Array(S),i=0,K=0;i<S;K++)C=I.charCodeAt(K),55296===(64512&C)&&K+1<y&&(j=I.charCodeAt(K+1),56320===(64512&j)&&(C=65536+(C-55296<<10)+(j-56320),K++)),C<128?O[i++]=C:C<2048?(O[i++]=192|C>>>6,O[i++]=128|63&C):C<65536?(O[i++]=224|C>>>12,O[i++]=128|C>>>6&63,O[i++]=128|63&C):(O[i++]=240|C>>>18,O[i++]=128|C>>>12&63,O[i++]=128|C>>>6&63,O[i++]=128|63&C);return O};I.exports.buf2string=(I,j)=>{const K=j||I.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(I.subarray(0,j));let i,y;const S=new Array(2*K);for(y=0,i=0;i<K;){let O=I[i++];if(O<128){S[y++]=O;continue}let j=C[O];if(j>4)S[y++]=65533,i+=j-1;else{for(O&=2===j?31:3===j?15:7;j>1&&i<K;)O=O<<6|63&I[i++],j--;j>1?S[y++]=65533:O<65536?S[y++]=O:(O-=65536,S[y++]=55296|O>>10&1023,S[y++]=56320|1023&O)}}return((I,C)=>{if(C<65534&&I.subarray&&O)return String.fromCharCode.apply(null,I.length===C?I:I.subarray(0,C));let j="";for(let O=0;O<C;O++)j+=String.fromCharCode(I[O]);return j})(S,y)},I.exports.utf8border=(I,O)=>{(O=O||I.length)>I.length&&(O=I.length);let j=O-1;for(;j>=0&&128===(192&I[j]);)j--;return j<0||0===j?O:j+C[I[j]]>O?j:O}},13302:I=>{"use strict";I.exports=(I,O,C,j)=>{let K=65535&I,i=I>>>16&65535,y=0;for(;0!==C;){y=C>2e3?2e3:C,C-=y;do{K=K+O[j++]|0,i=i+K|0}while(--y);K%=65521,i%=65521}return K|i<<16}},13318:I=>{"use strict";I.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13309:I=>{"use strict";const O=new Uint32Array((()=>{let I,O=[];for(var C=0;C<256;C++){I=C;for(var j=0;j<8;j++)I=1&I?3988292384^I>>>1:I>>>1;O[C]=I}return O})());I.exports=(I,C,j,K)=>{const i=O,y=K+j;I^=-1;for(let O=K;O<y;O++)I=I>>>8^i[255&(I^C[O])];return~I}},13294:(I,O,C)=>{"use strict";const{_tr_init:j,_tr_stored_block:K,_tr_flush_block:i,_tr_tally:y,_tr_align:S}=C(13298),U=C(13302),p=C(13309),N=C(13313),{Z_NO_FLUSH:Q,Z_PARTIAL_FLUSH:s,Z_FULL_FLUSH:Z,Z_FINISH:q,Z_BLOCK:mI,Z_OK:E,Z_STREAM_END:h,Z_STREAM_ERROR:r,Z_DATA_ERROR:W,Z_BUF_ERROR:Y,Z_DEFAULT_COMPRESSION:o,Z_FILTERED:c,Z_HUFFMAN_ONLY:n,Z_RLE:X,Z_FIXED:T,Z_DEFAULT_STRATEGY:H,Z_UNKNOWN:b,Z_DEFLATED:a}=C(13318),M=258,u=262,J=103,f=113,l=666,x=(I,O)=>(I.NO=N[O],O),D=I=>(I<<1)-(I>4?9:0),t=I=>{let O=I.length;for(;--O>=0;)I[O]=0};let d=(I,O,C)=>(O<<I.hash_shift^C)&I.hash_mask;const w=I=>{const O=I.state;let C=O.pending;C>I.avail_out&&(C=I.avail_out),0!==C&&(I.output.set(O.pending_buf.subarray(O.pending_out,O.pending_out+C),I.next_out),I.next_out+=C,O.pending_out+=C,I.total_out+=C,I.avail_out-=C,O.pending-=C,0===O.pending&&(O.pending_out=0))},g=(I,O)=>{i(I,I.block_start>=0?I.block_start:-1,I.strstart-I.block_start,O),I.block_start=I.strstart,w(I.strm)},V=(I,O)=>{I.pending_buf[I.pending++]=O},e=(I,O)=>{I.pending_buf[I.pending++]=O>>>8&255,I.pending_buf[I.pending++]=255&O},L=(I,O,C,j)=>{let K=I.avail_in;return K>j&&(K=j),0===K?0:(I.avail_in-=K,O.set(I.input.subarray(I.next_in,I.next_in+K),C),1===I.state.wrap?I.adler=U(I.adler,O,K,C):2===I.state.wrap&&(I.adler=p(I.adler,O,K,C)),I.next_in+=K,I.total_in+=K,K)},z=(I,O)=>{let C,j,K=I.max_chain_length,i=I.strstart,y=I.prev_length,S=I.nice_match;const U=I.strstart>I.w_size-u?I.strstart-(I.w_size-u):0,p=I.window,N=I.w_mask,Q=I.prev,s=I.strstart+M;let Z=p[i+y-1],q=p[i+y];I.prev_length>=I.good_match&&(K>>=2),S>I.lookahead&&(S=I.lookahead);do{if(C=O,p[C+y]===q&&p[C+y-1]===Z&&p[C]===p[i]&&p[++C]===p[i+1]){i+=2,C++;do{}while(p[++i]===p[++C]&&p[++i]===p[++C]&&p[++i]===p[++C]&&p[++i]===p[++C]&&p[++i]===p[++C]&&p[++i]===p[++C]&&p[++i]===p[++C]&&p[++i]===p[++C]&&i<s);if(j=M-(s-i),i=s-M,j>y){if(I.match_start=O,y=j,j>=S)break;Z=p[i+y-1],q=p[i+y]}}}while((O=Q[O&N])>U&&0!==--K);return y<=I.lookahead?y:I.lookahead},k=I=>{const O=I.w_size;let C,j,K,i,y;do{if(i=I.window_size-I.lookahead-I.strstart,I.strstart>=O+(O-u)){I.window.set(I.window.subarray(O,O+O),0),I.match_start-=O,I.strstart-=O,I.block_start-=O,j=I.hash_size,C=j;do{K=I.head[--C],I.head[C]=K>=O?K-O:0}while(--j);j=O,C=j;do{K=I.prev[--C],I.prev[C]=K>=O?K-O:0}while(--j);i+=O}if(0===I.strm.avail_in)break;if(j=L(I.strm,I.window,I.strstart+I.lookahead,i),I.lookahead+=j,I.lookahead+I.insert>=3)for(y=I.strstart-I.insert,I.ins_h=I.window[y],I.ins_h=d(I,I.ins_h,I.window[y+1]);I.insert&&(I.ins_h=d(I,I.ins_h,I.window[y+3-1]),I.prev[y&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=y,y++,I.insert--,!(I.lookahead+I.insert<3)););}while(I.lookahead<u&&0!==I.strm.avail_in)},A=(I,O)=>{let C,j;for(;;){if(I.lookahead<u){if(k(I),I.lookahead<u&&O===Q)return 1;if(0===I.lookahead)break}if(C=0,I.lookahead>=3&&(I.ins_h=d(I,I.ins_h,I.window[I.strstart+3-1]),C=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),0!==C&&I.strstart-C<=I.w_size-u&&(I.match_length=z(I,C)),I.match_length>=3)if(j=y(I,I.strstart-I.match_start,I.match_length-3),I.lookahead-=I.match_length,I.match_length<=I.max_lazy_match&&I.lookahead>=3){I.match_length--;do{I.strstart++,I.ins_h=d(I,I.ins_h,I.window[I.strstart+3-1]),C=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart}while(0!==--I.match_length);I.strstart++}else I.strstart+=I.match_length,I.match_length=0,I.ins_h=I.window[I.strstart],I.ins_h=d(I,I.ins_h,I.window[I.strstart+1]);else j=y(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++;if(j&&(g(I,!1),0===I.strm.avail_out))return 1}return I.insert=I.strstart<2?I.strstart:2,O===q?(g(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(g(I,!1),0===I.strm.avail_out)?1:2},P=(I,O)=>{let C,j,K;for(;;){if(I.lookahead<u){if(k(I),I.lookahead<u&&O===Q)return 1;if(0===I.lookahead)break}if(C=0,I.lookahead>=3&&(I.ins_h=d(I,I.ins_h,I.window[I.strstart+3-1]),C=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),I.prev_length=I.match_length,I.prev_match=I.match_start,I.match_length=2,0!==C&&I.prev_length<I.max_lazy_match&&I.strstart-C<=I.w_size-u&&(I.match_length=z(I,C),I.match_length<=5&&(I.strategy===c||3===I.match_length&&I.strstart-I.match_start>4096)&&(I.match_length=2)),I.prev_length>=3&&I.match_length<=I.prev_length){K=I.strstart+I.lookahead-3,j=y(I,I.strstart-1-I.prev_match,I.prev_length-3),I.lookahead-=I.prev_length-1,I.prev_length-=2;do{++I.strstart<=K&&(I.ins_h=d(I,I.ins_h,I.window[I.strstart+3-1]),C=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart)}while(0!==--I.prev_length);if(I.match_available=0,I.match_length=2,I.strstart++,j&&(g(I,!1),0===I.strm.avail_out))return 1}else if(I.match_available){if(j=y(I,0,I.window[I.strstart-1]),j&&g(I,!1),I.strstart++,I.lookahead--,0===I.strm.avail_out)return 1}else I.match_available=1,I.strstart++,I.lookahead--}return I.match_available&&(j=y(I,0,I.window[I.strstart-1]),I.match_available=0),I.insert=I.strstart<2?I.strstart:2,O===q?(g(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(g(I,!1),0===I.strm.avail_out)?1:2};function v(I,O,C,j,K){this.good_length=I,this.max_lazy=O,this.nice_length=C,this.max_chain=j,this.func=K}const B=[new v(0,0,0,0,((I,O)=>{let C=65535;for(C>I.pending_buf_size-5&&(C=I.pending_buf_size-5);;){if(I.lookahead<=1){if(k(I),0===I.lookahead&&O===Q)return 1;if(0===I.lookahead)break}I.strstart+=I.lookahead,I.lookahead=0;const j=I.block_start+C;if((0===I.strstart||I.strstart>=j)&&(I.lookahead=I.strstart-j,I.strstart=j,g(I,!1),0===I.strm.avail_out))return 1;if(I.strstart-I.block_start>=I.w_size-u&&(g(I,!1),0===I.strm.avail_out))return 1}return I.insert=0,O===q?(g(I,!0),0===I.strm.avail_out?3:4):(I.strstart>I.block_start&&(g(I,!1),I.strm.avail_out),1)})),new v(4,4,8,4,A),new v(4,5,16,8,A),new v(4,6,32,32,A),new v(4,4,16,16,P),new v(8,16,32,32,P),new v(8,16,128,128,P),new v(8,32,128,256,P),new v(32,128,258,1024,P),new v(32,258,258,4096,P)];function F(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=a,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),t(this.dyn_ltree),t(this.dyn_dtree),t(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),t(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),t(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const R=I=>{if(!I||!I.state)return x(I,r);I.total_in=I.total_out=0,I.data_type=b;const O=I.state;return O.pending=0,O.pending_out=0,O.wrap<0&&(O.wrap=-O.wrap),O.status=O.wrap?42:f,I.adler=2===O.wrap?0:1,O.last_flush=Q,j(O),E},G=I=>{const O=R(I);var C;return O===E&&((C=I.state).window_size=2*C.w_size,t(C.head),C.max_lazy_match=B[C.level].max_lazy,C.good_match=B[C.level].good_length,C.nice_match=B[C.level].nice_length,C.max_chain_length=B[C.level].max_chain,C.strstart=0,C.block_start=0,C.lookahead=0,C.insert=0,C.match_length=C.prev_length=2,C.match_available=0,C.ins_h=0),O},II=(I,O,C,j,K,i)=>{if(!I)return r;let y=1;if(O===o&&(O=6),j<0?(y=0,j=-j):j>15&&(y=2,j-=16),K<1||K>9||C!==a||j<8||j>15||O<0||O>9||i<0||i>T)return x(I,r);8===j&&(j=9);const S=new F;return I.state=S,S.strm=I,S.wrap=y,S.gzhead=null,S.w_bits=j,S.w_size=1<<S.w_bits,S.w_mask=S.w_size-1,S.hash_bits=K+7,S.hash_size=1<<S.hash_bits,S.hash_mask=S.hash_size-1,S.hash_shift=~~((S.hash_bits+3-1)/3),S.window=new Uint8Array(2*S.w_size),S.head=new Uint16Array(S.hash_size),S.prev=new Uint16Array(S.w_size),S.lit_bufsize=1<<K+6,S.pending_buf_size=4*S.lit_bufsize,S.pending_buf=new Uint8Array(S.pending_buf_size),S.d_buf=1*S.lit_bufsize,S.l_buf=3*S.lit_bufsize,S.level=O,S.strategy=i,S.method=C,G(I)};I.exports.deflateInit=(I,O)=>II(I,O,a,15,8,H),I.exports.deflateInit2=II,I.exports.deflateReset=G,I.exports.deflateResetKeep=R,I.exports.deflateSetHeader=(I,O)=>I&&I.state?2!==I.state.wrap?r:(I.state.gzhead=O,E):r,I.exports.deflate=(I,O)=>{let C,j;if(!I||!I.state||O>mI||O<0)return I?x(I,r):r;const i=I.state;if(!I.output||!I.input&&0!==I.avail_in||i.status===l&&O!==q)return x(I,0===I.avail_out?Y:r);i.strm=I;const U=i.last_flush;if(i.last_flush=O,42===i.status)if(2===i.wrap)I.adler=0,V(i,31),V(i,139),V(i,8),i.gzhead?(V(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),V(i,255&i.gzhead.time),V(i,i.gzhead.time>>8&255),V(i,i.gzhead.time>>16&255),V(i,i.gzhead.time>>24&255),V(i,9===i.level?2:i.strategy>=n||i.level<2?4:0),V(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(V(i,255&i.gzhead.extra.length),V(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(I.adler=p(I.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(V(i,0),V(i,0),V(i,0),V(i,0),V(i,0),V(i,9===i.level?2:i.strategy>=n||i.level<2?4:0),V(i,3),i.status=f);else{let O=a+(i.w_bits-8<<4)<<8,C=-1;C=i.strategy>=n||i.level<2?0:i.level<6?1:6===i.level?2:3,O|=C<<6,0!==i.strstart&&(O|=32),O+=31-O%31,i.status=f,e(i,O),0!==i.strstart&&(e(i,I.adler>>>16),e(i,65535&I.adler)),I.adler=1}if(69===i.status)if(i.gzhead.extra){for(C=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>C&&(I.adler=p(I.adler,i.pending_buf,i.pending-C,C)),w(I),C=i.pending,i.pending!==i.pending_buf_size));)V(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>C&&(I.adler=p(I.adler,i.pending_buf,i.pending-C,C)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){C=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>C&&(I.adler=p(I.adler,i.pending_buf,i.pending-C,C)),w(I),C=i.pending,i.pending===i.pending_buf_size)){j=1;break}j=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,V(i,j)}while(0!==j);i.gzhead.hcrc&&i.pending>C&&(I.adler=p(I.adler,i.pending_buf,i.pending-C,C)),0===j&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){C=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>C&&(I.adler=p(I.adler,i.pending_buf,i.pending-C,C)),w(I),C=i.pending,i.pending===i.pending_buf_size)){j=1;break}j=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,V(i,j)}while(0!==j);i.gzhead.hcrc&&i.pending>C&&(I.adler=p(I.adler,i.pending_buf,i.pending-C,C)),0===j&&(i.status=J)}else i.status=J;if(i.status===J&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&w(I),i.pending+2<=i.pending_buf_size&&(V(i,255&I.adler),V(i,I.adler>>8&255),I.adler=0,i.status=f)):i.status=f),0!==i.pending){if(w(I),0===I.avail_out)return i.last_flush=-1,E}else if(0===I.avail_in&&D(O)<=D(U)&&O!==q)return x(I,Y);if(i.status===l&&0!==I.avail_in)return x(I,Y);if(0!==I.avail_in||0!==i.lookahead||O!==Q&&i.status!==l){let C=i.strategy===n?((I,O)=>{let C;for(;;){if(0===I.lookahead&&(k(I),0===I.lookahead)){if(O===Q)return 1;break}if(I.match_length=0,C=y(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++,C&&(g(I,!1),0===I.strm.avail_out))return 1}return I.insert=0,O===q?(g(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(g(I,!1),0===I.strm.avail_out)?1:2})(i,O):i.strategy===X?((I,O)=>{let C,j,K,i;const S=I.window;for(;;){if(I.lookahead<=M){if(k(I),I.lookahead<=M&&O===Q)return 1;if(0===I.lookahead)break}if(I.match_length=0,I.lookahead>=3&&I.strstart>0&&(K=I.strstart-1,j=S[K],j===S[++K]&&j===S[++K]&&j===S[++K])){i=I.strstart+M;do{}while(j===S[++K]&&j===S[++K]&&j===S[++K]&&j===S[++K]&&j===S[++K]&&j===S[++K]&&j===S[++K]&&j===S[++K]&&K<i);I.match_length=M-(i-K),I.match_length>I.lookahead&&(I.match_length=I.lookahead)}if(I.match_length>=3?(C=y(I,1,I.match_length-3),I.lookahead-=I.match_length,I.strstart+=I.match_length,I.match_length=0):(C=y(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++),C&&(g(I,!1),0===I.strm.avail_out))return 1}return I.insert=0,O===q?(g(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(g(I,!1),0===I.strm.avail_out)?1:2})(i,O):B[i.level].func(i,O);if(3!==C&&4!==C||(i.status=l),1===C||3===C)return 0===I.avail_out&&(i.last_flush=-1),E;if(2===C&&(O===s?S(i):O!==mI&&(K(i,0,0,!1),O===Z&&(t(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),w(I),0===I.avail_out))return i.last_flush=-1,E}return O!==q?E:i.wrap<=0?h:(2===i.wrap?(V(i,255&I.adler),V(i,I.adler>>8&255),V(i,I.adler>>16&255),V(i,I.adler>>24&255),V(i,255&I.total_in),V(i,I.total_in>>8&255),V(i,I.total_in>>16&255),V(i,I.total_in>>24&255)):(e(i,I.adler>>>16),e(i,65535&I.adler)),w(I),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?E:h)},I.exports.deflateEnd=I=>{if(!I||!I.state)return r;const O=I.state.status;return 42!==O&&69!==O&&73!==O&&91!==O&&O!==J&&O!==f&&O!==l?x(I,r):(I.state=null,O===f?x(I,W):E)},I.exports.deflateSetDictionary=(I,O)=>{let C=O.length;if(!I||!I.state)return r;const j=I.state,K=j.wrap;if(2===K||1===K&&42!==j.status||j.lookahead)return r;if(1===K&&(I.adler=U(I.adler,O,C,0)),j.wrap=0,C>=j.w_size){0===K&&(t(j.head),j.strstart=0,j.block_start=0,j.insert=0);let I=new Uint8Array(j.w_size);I.set(O.subarray(C-j.w_size,C),0),O=I,C=j.w_size}const i=I.avail_in,y=I.next_in,S=I.input;for(I.avail_in=C,I.next_in=0,I.input=O,k(j);j.lookahead>=3;){let I=j.strstart,O=j.lookahead-2;do{j.ins_h=d(j,j.ins_h,j.window[I+3-1]),j.prev[I&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=I,I++}while(--O);j.strstart=I,j.lookahead=2,k(j)}return j.strstart+=j.lookahead,j.block_start=j.strstart,j.insert=j.lookahead,j.lookahead=0,j.match_length=j.prev_length=2,j.match_available=0,I.next_in=y,I.input=S,I.avail_in=i,j.wrap=K,E},I.exports.deflateInfo="pako deflate (from Nodeca project)"},13357:I=>{"use strict";I.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13348:I=>{"use strict";I.exports=function(I,O){let C,j,K,i,y,S,U,p,N,Q,s,Z,q,mI,E,h,r,W,Y,o,c,n,X,T;const H=I.state;C=I.next_in,X=I.input,j=C+(I.avail_in-5),K=I.next_out,T=I.output,i=K-(O-I.avail_out),y=K+(I.avail_out-257),S=H.dmax,U=H.wsize,p=H.whave,N=H.wnext,Q=H.window,s=H.hold,Z=H.bits,q=H.lencode,mI=H.distcode,E=(1<<H.lenbits)-1,h=(1<<H.distbits)-1;I:do{Z<15&&(s+=X[C++]<<Z,Z+=8,s+=X[C++]<<Z,Z+=8),r=q[s&E];O:for(;;){if(W=r>>>24,s>>>=W,Z-=W,W=r>>>16&255,0===W)T[K++]=65535&r;else{if(!(16&W)){if(0===(64&W)){r=q[(65535&r)+(s&(1<<W)-1)];continue O}if(32&W){H.mode=12;break I}I.NO="invalid literal/length code",H.mode=30;break I}Y=65535&r,W&=15,W&&(Z<W&&(s+=X[C++]<<Z,Z+=8),Y+=s&(1<<W)-1,s>>>=W,Z-=W),Z<15&&(s+=X[C++]<<Z,Z+=8,s+=X[C++]<<Z,Z+=8),r=mI[s&h];C:for(;;){if(W=r>>>24,s>>>=W,Z-=W,W=r>>>16&255,!(16&W)){if(0===(64&W)){r=mI[(65535&r)+(s&(1<<W)-1)];continue C}I.NO="invalid distance code",H.mode=30;break I}if(o=65535&r,W&=15,Z<W&&(s+=X[C++]<<Z,Z+=8,Z<W&&(s+=X[C++]<<Z,Z+=8)),o+=s&(1<<W)-1,o>S){I.NO="invalid distance too far back",H.mode=30;break I}if(s>>>=W,Z-=W,W=K-i,o>W){if(W=o-W,W>p&&H.sane){I.NO="invalid distance too far back",H.mode=30;break I}if(c=0,n=Q,0===N){if(c+=U-W,W<Y){Y-=W;do{T[K++]=Q[c++]}while(--W);c=K-o,n=T}}else if(N<W){if(c+=U+N-W,W-=N,W<Y){Y-=W;do{T[K++]=Q[c++]}while(--W);if(c=0,N<Y){W=N,Y-=W;do{T[K++]=Q[c++]}while(--W);c=K-o,n=T}}}else if(c+=N-W,W<Y){Y-=W;do{T[K++]=Q[c++]}while(--W);c=K-o,n=T}for(;Y>2;)T[K++]=n[c++],T[K++]=n[c++],T[K++]=n[c++],Y-=3;Y&&(T[K++]=n[c++],Y>1&&(T[K++]=n[c++]))}else{c=K-o;do{T[K++]=T[c++],T[K++]=T[c++],T[K++]=T[c++],Y-=3}while(Y>2);Y&&(T[K++]=T[c++],Y>1&&(T[K++]=T[c++]))}break}}break}}while(C<j&&K<y);Y=Z>>3,C-=Y,Z-=Y<<3,s&=(1<<Z)-1,I.next_in=C,I.next_out=K,I.avail_in=C<j?j-C+5:5-(C-j),I.avail_out=K<y?y-K+257:257-(K-y),H.hold=s,H.bits=Z}},13344:(I,O,C)=>{"use strict";const j=C(13302),K=C(13309),i=C(13348),y=C(13355),{Z_FINISH:S,Z_BLOCK:U,Z_TREES:p,Z_OK:N,Z_STREAM_END:Q,Z_NEED_DICT:s,Z_STREAM_ERROR:Z,Z_DATA_ERROR:q,Z_MEM_ERROR:mI,Z_BUF_ERROR:E,Z_DEFLATED:h}=C(13318),r=12,W=30,Y=I=>(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24);function o(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const c=I=>{if(!I||!I.state)return Z;const O=I.state;return I.total_in=I.total_out=O.total=0,I.NO="",O.wrap&&(I.adler=1&O.wrap),O.mode=1,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new Int32Array(852),O.distcode=O.distdyn=new Int32Array(592),O.sane=1,O.back=-1,N},n=I=>{if(!I||!I.state)return Z;const O=I.state;return O.wsize=0,O.whave=0,O.wnext=0,c(I)},X=(I,O)=>{let C;if(!I||!I.state)return Z;const j=I.state;return O<0?(C=0,O=-O):(C=1+(O>>4),O<48&&(O&=15)),O&&(O<8||O>15)?Z:(null!==j.window&&j.wbits!==O&&(j.window=null),j.wrap=C,j.wbits=O,n(I))},T=(I,O)=>{if(!I)return Z;const C=new o;I.state=C,C.window=null;const j=X(I,O);return j!==N&&(I.state=null),j};let H,b,a=!0;const M=I=>{if(a){H=new Int32Array(512),b=new Int32Array(32);let O=0;for(;O<144;)I.lens[O++]=8;for(;O<256;)I.lens[O++]=9;for(;O<280;)I.lens[O++]=7;for(;O<288;)I.lens[O++]=8;for(y(1,I.lens,0,288,H,0,I.work,{bits:9}),O=0;O<32;)I.lens[O++]=5;y(2,I.lens,0,32,b,0,I.work,{bits:5}),a=!1}I.lencode=H,I.lenbits=9,I.distcode=b,I.distbits=5},u=(I,O,C,j)=>{let K;const i=I.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),j>=i.wsize?(i.window.set(O.subarray(C-i.wsize,C),0),i.wnext=0,i.whave=i.wsize):(K=i.wsize-i.wnext,K>j&&(K=j),i.window.set(O.subarray(C-j,C-j+K),i.wnext),(j-=K)?(i.window.set(O.subarray(C-j,C),0),i.wnext=j,i.whave=i.wsize):(i.wnext+=K,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=K))),0};I.exports.inflateReset=n,I.exports.inflateReset2=X,I.exports.inflateResetKeep=c,I.exports.inflateInit=I=>T(I,15),I.exports.inflateInit2=T,I.exports.inflate=(I,O)=>{let C,o,c,n,X,T,H,b,a,J,f,l,x,D,t,d,w,g,V,e,L,z,k=0;const A=new Uint8Array(4);let P,v;const B=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!I||!I.state||!I.output||!I.input&&0!==I.avail_in)return Z;C=I.state,C.mode===r&&(C.mode=13),X=I.next_out,c=I.output,H=I.avail_out,n=I.next_in,o=I.input,T=I.avail_in,b=C.hold,a=C.bits,J=T,f=H,z=N;I:for(;;)switch(C.mode){case 1:if(0===C.wrap){C.mode=13;break}for(;a<16;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}if(2&C.wrap&&35615===b){C.check=0,A[0]=255&b,A[1]=b>>>8&255,C.check=K(C.check,A,2,0),b=0,a=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&b)<<8)+(b>>8))%31){I.NO="incorrect header check",C.mode=W;break}if((15&b)!==h){I.NO="unknown compression method",C.mode=W;break}if(b>>>=4,a-=4,L=8+(15&b),0===C.wbits)C.wbits=L;else if(L>C.wbits){I.NO="invalid window size",C.mode=W;break}C.dmax=1<<C.wbits,I.adler=C.check=1,C.mode=512&b?10:r,b=0,a=0;break;case 2:for(;a<16;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}if(C.flags=b,(255&C.flags)!==h){I.NO="unknown compression method",C.mode=W;break}if(57344&C.flags){I.NO="unknown header flags set",C.mode=W;break}C.head&&(C.head.text=b>>8&1),512&C.flags&&(A[0]=255&b,A[1]=b>>>8&255,C.check=K(C.check,A,2,0)),b=0,a=0,C.mode=3;case 3:for(;a<32;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}C.head&&(C.head.time=b),512&C.flags&&(A[0]=255&b,A[1]=b>>>8&255,A[2]=b>>>16&255,A[3]=b>>>24&255,C.check=K(C.check,A,4,0)),b=0,a=0,C.mode=4;case 4:for(;a<16;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}C.head&&(C.head.xflags=255&b,C.head.os=b>>8),512&C.flags&&(A[0]=255&b,A[1]=b>>>8&255,C.check=K(C.check,A,2,0)),b=0,a=0,C.mode=5;case 5:if(1024&C.flags){for(;a<16;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}C.length=b,C.head&&(C.head.extra_len=b),512&C.flags&&(A[0]=255&b,A[1]=b>>>8&255,C.check=K(C.check,A,2,0)),b=0,a=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(l=C.length,l>T&&(l=T),l&&(C.head&&(L=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Uint8Array(C.head.extra_len)),C.head.extra.set(o.subarray(n,n+l),L)),512&C.flags&&(C.check=K(C.check,o,l,n)),T-=l,n+=l,C.length-=l),C.length))break I;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(0===T)break I;l=0;do{L=o[n+l++],C.head&&L&&C.length<65536&&(C.head.name+=String.fromCharCode(L))}while(L&&l<T);if(512&C.flags&&(C.check=K(C.check,o,l,n)),T-=l,n+=l,L)break I}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(0===T)break I;l=0;do{L=o[n+l++],C.head&&L&&C.length<65536&&(C.head.comment+=String.fromCharCode(L))}while(L&&l<T);if(512&C.flags&&(C.check=K(C.check,o,l,n)),T-=l,n+=l,L)break I}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;a<16;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}if(b!==(65535&C.check)){I.NO="header crc mismatch",C.mode=W;break}b=0,a=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),I.adler=C.check=0,C.mode=r;break;case 10:for(;a<32;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}I.adler=C.check=Y(b),b=0,a=0,C.mode=11;case 11:if(0===C.havedict)return I.next_out=X,I.avail_out=H,I.next_in=n,I.avail_in=T,C.hold=b,C.bits=a,s;I.adler=C.check=1,C.mode=r;case r:if(O===U||O===p)break I;case 13:if(C.last){b>>>=7&a,a-=7&a,C.mode=27;break}for(;a<3;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}switch(C.last=1&b,b>>>=1,a-=1,3&b){case 0:C.mode=14;break;case 1:if(M(C),C.mode=20,O===p){b>>>=2,a-=2;break I}break;case 2:C.mode=17;break;case 3:I.NO="invalid block type",C.mode=W}b>>>=2,a-=2;break;case 14:for(b>>>=7&a,a-=7&a;a<32;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}if((65535&b)!==(b>>>16^65535)){I.NO="invalid stored block lengths",C.mode=W;break}if(C.length=65535&b,b=0,a=0,C.mode=15,O===p)break I;case 15:C.mode=16;case 16:if(l=C.length,l){if(l>T&&(l=T),l>H&&(l=H),0===l)break I;c.set(o.subarray(n,n+l),X),T-=l,n+=l,H-=l,X+=l,C.length-=l;break}C.mode=r;break;case 17:for(;a<14;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}if(C.nlen=257+(31&b),b>>>=5,a-=5,C.ndist=1+(31&b),b>>>=5,a-=5,C.ncode=4+(15&b),b>>>=4,a-=4,C.nlen>286||C.ndist>30){I.NO="too many length or distance symbols",C.mode=W;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;a<3;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}C.lens[B[C.have++]]=7&b,b>>>=3,a-=3}for(;C.have<19;)C.lens[B[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,P={bits:C.lenbits},z=y(0,C.lens,0,19,C.lencode,0,C.work,P),C.lenbits=P.bits,z){I.NO="invalid code lengths set",C.mode=W;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;k=C.lencode[b&(1<<C.lenbits)-1],t=k>>>24,d=k>>>16&255,w=65535&k,!(t<=a);){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}if(w<16)b>>>=t,a-=t,C.lens[C.have++]=w;else{if(16===w){for(v=t+2;a<v;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}if(b>>>=t,a-=t,0===C.have){I.NO="invalid bit length repeat",C.mode=W;break}L=C.lens[C.have-1],l=3+(3&b),b>>>=2,a-=2}else if(17===w){for(v=t+3;a<v;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}b>>>=t,a-=t,L=0,l=3+(7&b),b>>>=3,a-=3}else{for(v=t+7;a<v;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}b>>>=t,a-=t,L=0,l=11+(127&b),b>>>=7,a-=7}if(C.have+l>C.nlen+C.ndist){I.NO="invalid bit length repeat",C.mode=W;break}for(;l--;)C.lens[C.have++]=L}}if(C.mode===W)break;if(0===C.lens[256]){I.NO="invalid code -- missing end-of-block",C.mode=W;break}if(C.lenbits=9,P={bits:C.lenbits},z=y(1,C.lens,0,C.nlen,C.lencode,0,C.work,P),C.lenbits=P.bits,z){I.NO="invalid literal/lengths set",C.mode=W;break}if(C.distbits=6,C.distcode=C.distdyn,P={bits:C.distbits},z=y(2,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,P),C.distbits=P.bits,z){I.NO="invalid distances set",C.mode=W;break}if(C.mode=20,O===p)break I;case 20:C.mode=21;case 21:if(T>=6&&H>=258){I.next_out=X,I.avail_out=H,I.next_in=n,I.avail_in=T,C.hold=b,C.bits=a,i(I,f),X=I.next_out,c=I.output,H=I.avail_out,n=I.next_in,o=I.input,T=I.avail_in,b=C.hold,a=C.bits,C.mode===r&&(C.back=-1);break}for(C.back=0;k=C.lencode[b&(1<<C.lenbits)-1],t=k>>>24,d=k>>>16&255,w=65535&k,!(t<=a);){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}if(d&&0===(240&d)){for(g=t,V=d,e=w;k=C.lencode[e+((b&(1<<g+V)-1)>>g)],t=k>>>24,d=k>>>16&255,w=65535&k,!(g+t<=a);){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}b>>>=g,a-=g,C.back+=g}if(b>>>=t,a-=t,C.back+=t,C.length=w,0===d){C.mode=26;break}if(32&d){C.back=-1,C.mode=r;break}if(64&d){I.NO="invalid literal/length code",C.mode=W;break}C.extra=15&d,C.mode=22;case 22:if(C.extra){for(v=C.extra;a<v;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}C.length+=b&(1<<C.extra)-1,b>>>=C.extra,a-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;k=C.distcode[b&(1<<C.distbits)-1],t=k>>>24,d=k>>>16&255,w=65535&k,!(t<=a);){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}if(0===(240&d)){for(g=t,V=d,e=w;k=C.distcode[e+((b&(1<<g+V)-1)>>g)],t=k>>>24,d=k>>>16&255,w=65535&k,!(g+t<=a);){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}b>>>=g,a-=g,C.back+=g}if(b>>>=t,a-=t,C.back+=t,64&d){I.NO="invalid distance code",C.mode=W;break}C.offset=w,C.extra=15&d,C.mode=24;case 24:if(C.extra){for(v=C.extra;a<v;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}C.offset+=b&(1<<C.extra)-1,b>>>=C.extra,a-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){I.NO="invalid distance too far back",C.mode=W;break}C.mode=25;case 25:if(0===H)break I;if(l=f-H,C.offset>l){if(l=C.offset-l,l>C.whave&&C.sane){I.NO="invalid distance too far back",C.mode=W;break}l>C.wnext?(l-=C.wnext,x=C.wsize-l):x=C.wnext-l,l>C.length&&(l=C.length),D=C.window}else D=c,x=X-C.offset,l=C.length;l>H&&(l=H),H-=l,C.length-=l;do{c[X++]=D[x++]}while(--l);0===C.length&&(C.mode=21);break;case 26:if(0===H)break I;c[X++]=C.length,H--,C.mode=21;break;case 27:if(C.wrap){for(;a<32;){if(0===T)break I;T--,b|=o[n++]<<a,a+=8}if(f-=H,I.total_out+=f,C.total+=f,f&&(I.adler=C.check=C.flags?K(C.check,c,f,X-f):j(C.check,c,f,X-f)),f=H,(C.flags?b:Y(b))!==C.check){I.NO="incorrect data check",C.mode=W;break}b=0,a=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;a<32;){if(0===T)break I;T--,b+=o[n++]<<a,a+=8}if(b!==(4294967295&C.total)){I.NO="incorrect length check",C.mode=W;break}b=0,a=0}C.mode=29;case 29:z=Q;break I;case W:z=q;break I;case 31:return mI;default:return Z}return I.next_out=X,I.avail_out=H,I.next_in=n,I.avail_in=T,C.hold=b,C.bits=a,(C.wsize||f!==I.avail_out&&C.mode<W&&(C.mode<27||O!==S))&&u(I,I.output,I.next_out,f-I.avail_out)?(C.mode=31,mI):(J-=I.avail_in,f-=I.avail_out,I.total_in+=J,I.total_out+=f,C.total+=f,C.wrap&&f&&(I.adler=C.check=C.flags?K(C.check,c,f,I.next_out-f):j(C.check,c,f,I.next_out-f)),I.data_type=C.bits+(C.last?64:0)+(C.mode===r?128:0)+(20===C.mode||15===C.mode?256:0),(0===J&&0===f||O===S)&&z===N&&(z=E),z)},I.exports.inflateEnd=I=>{if(!I||!I.state)return Z;let O=I.state;return O.window&&(O.window=null),I.state=null,N},I.exports.inflateGetHeader=(I,O)=>{if(!I||!I.state)return Z;const C=I.state;return 0===(2&C.wrap)?Z:(C.head=O,O.done=!1,N)},I.exports.inflateSetDictionary=(I,O)=>{const C=O.length;let K,i,y;return I&&I.state?(K=I.state,0!==K.wrap&&11!==K.mode?Z:11===K.mode&&(i=1,i=j(i,O,C,0),i!==K.check)?q:(y=u(I,O,C,C),y?(K.mode=31,mI):(K.havedict=1,N))):Z},I.exports.inflateInfo="pako inflate (from Nodeca project)"},13355:I=>{"use strict";const O=15,C=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),j=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),K=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),i=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);I.exports=(I,y,S,U,p,N,Q,s)=>{const Z=s.bits;let q,mI,E,h,r,W,Y=0,o=0,c=0,n=0,X=0,T=0,H=0,b=0,a=0,M=0,u=null,J=0;const f=new Uint16Array(16),l=new Uint16Array(16);let x,D,t,d=null,w=0;for(Y=0;Y<=O;Y++)f[Y]=0;for(o=0;o<U;o++)f[y[S+o]]++;for(X=Z,n=O;n>=1&&0===f[n];n--);if(X>n&&(X=n),0===n)return p[N++]=20971520,p[N++]=20971520,s.bits=1,0;for(c=1;c<n&&0===f[c];c++);for(X<c&&(X=c),b=1,Y=1;Y<=O;Y++)if(b<<=1,b-=f[Y],b<0)return-1;if(b>0&&(0===I||1!==n))return-1;for(l[1]=0,Y=1;Y<O;Y++)l[Y+1]=l[Y]+f[Y];for(o=0;o<U;o++)0!==y[S+o]&&(Q[l[y[S+o]]++]=o);if(0===I?(u=d=Q,W=19):1===I?(u=C,J-=257,d=j,w-=257,W=256):(u=K,d=i,W=-1),M=0,o=0,Y=c,r=N,T=X,H=0,E=-1,a=1<<X,h=a-1,1===I&&a>852||2===I&&a>592)return 1;for(;;){x=Y-H,Q[o]<W?(D=0,t=Q[o]):Q[o]>W?(D=d[w+Q[o]],t=u[J+Q[o]]):(D=96,t=0),q=1<<Y-H,mI=1<<T,c=mI;do{mI-=q,p[r+(M>>H)+mI]=x<<24|D<<16|t}while(0!==mI);for(q=1<<Y-1;M&q;)q>>=1;if(0!==q?(M&=q-1,M+=q):M=0,o++,0===--f[Y]){if(Y===n)break;Y=y[S+Q[o]]}if(Y>X&&(M&h)!==E){for(0===H&&(H=X),r+=c,T=Y-H,b=1<<T;T+H<n&&(b-=f[T+H],!(b<=0));)T++,b<<=1;if(a+=1<<T,1===I&&a>852||2===I&&a>592)return 1;E=M&h,p[E]=X<<24|T<<16|r-N}}return 0!==M&&(p[r+M]=Y-H<<24|64<<16),s.bits=X,0}},13313:I=>{"use strict";I.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13298:I=>{"use strict";function O(I){let O=I.length;for(;--O>=0;)I[O]=0}const C=256,j=286,K=30,i=15,y=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),S=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),U=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),p=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),N=new Array(576);O(N);const Q=new Array(60);O(Q);const s=new Array(512);O(s);const Z=new Array(256);O(Z);const q=new Array(29);O(q);const mI=new Array(K);function E(I,O,C,j,K){this.static_tree=I,this.extra_bits=O,this.extra_base=C,this.elems=j,this.max_length=K,this.has_stree=I&&I.length}let h,r,W;function Y(I,O){this.dyn_tree=I,this.max_code=0,this.stat_desc=O}O(mI);const o=I=>I<256?s[I]:s[256+(I>>>7)],c=(I,O)=>{I.pending_buf[I.pending++]=255&O,I.pending_buf[I.pending++]=O>>>8&255},n=(I,O,C)=>{I.bi_valid>16-C?(I.bi_buf|=O<<I.bi_valid&65535,c(I,I.bi_buf),I.bi_buf=O>>16-I.bi_valid,I.bi_valid+=C-16):(I.bi_buf|=O<<I.bi_valid&65535,I.bi_valid+=C)},X=(I,O,C)=>{n(I,C[2*O],C[2*O+1])},T=(I,O)=>{let C=0;do{C|=1&I,I>>>=1,C<<=1}while(--O>0);return C>>>1},H=(I,O,C)=>{const j=new Array(16);let K,y,S=0;for(K=1;K<=i;K++)j[K]=S=S+C[K-1]<<1;for(y=0;y<=O;y++){let O=I[2*y+1];0!==O&&(I[2*y]=T(j[O]++,O))}},b=I=>{let O;for(O=0;O<j;O++)I.dyn_ltree[2*O]=0;for(O=0;O<K;O++)I.dyn_dtree[2*O]=0;for(O=0;O<19;O++)I.bl_tree[2*O]=0;I.dyn_ltree[512]=1,I.opt_len=I.static_len=0,I.last_lit=I.matches=0},a=I=>{I.bi_valid>8?c(I,I.bi_buf):I.bi_valid>0&&(I.pending_buf[I.pending++]=I.bi_buf),I.bi_buf=0,I.bi_valid=0},M=(I,O,C,j)=>{const K=2*O,i=2*C;return I[K]<I[i]||I[K]===I[i]&&j[O]<=j[C]},u=(I,O,C)=>{const j=I.heap[C];let K=C<<1;for(;K<=I.heap_len&&(K<I.heap_len&&M(O,I.heap[K+1],I.heap[K],I.depth)&&K++,!M(O,j,I.heap[K],I.depth));)I.heap[C]=I.heap[K],C=K,K<<=1;I.heap[C]=j},J=(I,O,j)=>{let K,i,U,p,N=0;if(0!==I.last_lit)do{K=I.pending_buf[I.d_buf+2*N]<<8|I.pending_buf[I.d_buf+2*N+1],i=I.pending_buf[I.l_buf+N],N++,0===K?X(I,i,O):(U=Z[i],X(I,U+C+1,O),p=y[U],0!==p&&(i-=q[U],n(I,i,p)),K--,U=o(K),X(I,U,j),p=S[U],0!==p&&(K-=mI[U],n(I,K,p)))}while(N<I.last_lit);X(I,256,O)},f=(I,O)=>{const C=O.dyn_tree,j=O.stat_desc.static_tree,K=O.stat_desc.has_stree,y=O.stat_desc.elems;let S,U,p,N=-1;for(I.heap_len=0,I.heap_max=573,S=0;S<y;S++)0!==C[2*S]?(I.heap[++I.heap_len]=N=S,I.depth[S]=0):C[2*S+1]=0;for(;I.heap_len<2;)p=I.heap[++I.heap_len]=N<2?++N:0,C[2*p]=1,I.depth[p]=0,I.opt_len--,K&&(I.static_len-=j[2*p+1]);for(O.max_code=N,S=I.heap_len>>1;S>=1;S--)u(I,C,S);p=y;do{S=I.heap[1],I.heap[1]=I.heap[I.heap_len--],u(I,C,1),U=I.heap[1],I.heap[--I.heap_max]=S,I.heap[--I.heap_max]=U,C[2*p]=C[2*S]+C[2*U],I.depth[p]=(I.depth[S]>=I.depth[U]?I.depth[S]:I.depth[U])+1,C[2*S+1]=C[2*U+1]=p,I.heap[1]=p++,u(I,C,1)}while(I.heap_len>=2);I.heap[--I.heap_max]=I.heap[1],((I,O)=>{const C=O.dyn_tree,j=O.max_code,K=O.stat_desc.static_tree,y=O.stat_desc.has_stree,S=O.stat_desc.extra_bits,U=O.stat_desc.extra_base,p=O.stat_desc.max_length;let N,Q,s,Z,q,mI,E=0;for(Z=0;Z<=i;Z++)I.bl_count[Z]=0;for(C[2*I.heap[I.heap_max]+1]=0,N=I.heap_max+1;N<573;N++)Q=I.heap[N],Z=C[2*C[2*Q+1]+1]+1,Z>p&&(Z=p,E++),C[2*Q+1]=Z,Q>j||(I.bl_count[Z]++,q=0,Q>=U&&(q=S[Q-U]),mI=C[2*Q],I.opt_len+=mI*(Z+q),y&&(I.static_len+=mI*(K[2*Q+1]+q)));if(0!==E){do{for(Z=p-1;0===I.bl_count[Z];)Z--;I.bl_count[Z]--,I.bl_count[Z+1]+=2,I.bl_count[p]--,E-=2}while(E>0);for(Z=p;0!==Z;Z--)for(Q=I.bl_count[Z];0!==Q;)s=I.heap[--N],s>j||(C[2*s+1]!==Z&&(I.opt_len+=(Z-C[2*s+1])*C[2*s],C[2*s+1]=Z),Q--)}})(I,O),H(C,N,I.bl_count)},l=(I,O,C)=>{let j,K,i=-1,y=O[1],S=0,U=7,p=4;for(0===y&&(U=138,p=3),O[2*(C+1)+1]=65535,j=0;j<=C;j++)K=y,y=O[2*(j+1)+1],++S<U&&K===y||(S<p?I.bl_tree[2*K]+=S:0!==K?(K!==i&&I.bl_tree[2*K]++,I.bl_tree[32]++):S<=10?I.bl_tree[34]++:I.bl_tree[36]++,S=0,i=K,0===y?(U=138,p=3):K===y?(U=6,p=3):(U=7,p=4))},x=(I,O,C)=>{let j,K,i=-1,y=O[1],S=0,U=7,p=4;for(0===y&&(U=138,p=3),j=0;j<=C;j++)if(K=y,y=O[2*(j+1)+1],!(++S<U&&K===y)){if(S<p)do{X(I,K,I.bl_tree)}while(0!==--S);else 0!==K?(K!==i&&(X(I,K,I.bl_tree),S--),X(I,16,I.bl_tree),n(I,S-3,2)):S<=10?(X(I,17,I.bl_tree),n(I,S-3,3)):(X(I,18,I.bl_tree),n(I,S-11,7));S=0,i=K,0===y?(U=138,p=3):K===y?(U=6,p=3):(U=7,p=4)}};let D=!1;const t=(I,O,C,j)=>{n(I,0+(j?1:0),3),((I,O,C,j)=>{a(I),j&&(c(I,C),c(I,~C)),I.pending_buf.set(I.window.subarray(O,O+C),I.pending),I.pending+=C})(I,O,C,!0)};I.exports._tr_init=I=>{D||((()=>{let I,O,C,p,Y;const o=new Array(16);for(C=0,p=0;p<28;p++)for(q[p]=C,I=0;I<1<<y[p];I++)Z[C++]=p;for(Z[C-1]=p,Y=0,p=0;p<16;p++)for(mI[p]=Y,I=0;I<1<<S[p];I++)s[Y++]=p;for(Y>>=7;p<K;p++)for(mI[p]=Y<<7,I=0;I<1<<S[p]-7;I++)s[256+Y++]=p;for(O=0;O<=i;O++)o[O]=0;for(I=0;I<=143;)N[2*I+1]=8,I++,o[8]++;for(;I<=255;)N[2*I+1]=9,I++,o[9]++;for(;I<=279;)N[2*I+1]=7,I++,o[7]++;for(;I<=287;)N[2*I+1]=8,I++,o[8]++;for(H(N,287,o),I=0;I<K;I++)Q[2*I+1]=5,Q[2*I]=T(I,5);h=new E(N,y,257,j,i),r=new E(Q,S,0,K,i),W=new E(new Array(0),U,0,19,7)})(),D=!0),I.l_desc=new Y(I.dyn_ltree,h),I.d_desc=new Y(I.dyn_dtree,r),I.bl_desc=new Y(I.bl_tree,W),I.bi_buf=0,I.bi_valid=0,b(I)},I.exports._tr_stored_block=t,I.exports._tr_flush_block=(I,O,j,K)=>{let i,y,S=0;I.level>0?(2===I.strm.data_type&&(I.strm.data_type=(I=>{let O,j=4093624447;for(O=0;O<=31;O++,j>>>=1)if(1&j&&0!==I.dyn_ltree[2*O])return 0;if(0!==I.dyn_ltree[18]||0!==I.dyn_ltree[20]||0!==I.dyn_ltree[26])return 1;for(O=32;O<C;O++)if(0!==I.dyn_ltree[2*O])return 1;return 0})(I)),f(I,I.l_desc),f(I,I.d_desc),S=(I=>{let O;for(l(I,I.dyn_ltree,I.l_desc.max_code),l(I,I.dyn_dtree,I.d_desc.max_code),f(I,I.bl_desc),O=18;O>=3&&0===I.bl_tree[2*p[O]+1];O--);return I.opt_len+=3*(O+1)+5+5+4,O})(I),i=I.opt_len+3+7>>>3,y=I.static_len+3+7>>>3,y<=i&&(i=y)):i=y=j+5,j+4<=i&&-1!==O?t(I,O,j,K):4===I.strategy||y===i?(n(I,2+(K?1:0),3),J(I,N,Q)):(n(I,4+(K?1:0),3),((I,O,C,j)=>{let K;for(n(I,O-257,5),n(I,C-1,5),n(I,j-4,4),K=0;K<j;K++)n(I,I.bl_tree[2*p[K]+1],3);x(I,I.dyn_ltree,O-1),x(I,I.dyn_dtree,C-1)})(I,I.l_desc.max_code+1,I.d_desc.max_code+1,S+1),J(I,I.dyn_ltree,I.dyn_dtree)),b(I),K&&a(I)},I.exports._tr_tally=(I,O,j)=>(I.pending_buf[I.d_buf+2*I.last_lit]=O>>>8&255,I.pending_buf[I.d_buf+2*I.last_lit+1]=255&O,I.pending_buf[I.l_buf+I.last_lit]=255&j,I.last_lit++,0===O?I.dyn_ltree[2*j]++:(I.matches++,O--,I.dyn_ltree[2*(Z[j]+C+1)]++,I.dyn_dtree[2*o(O)]++),I.last_lit===I.lit_bufsize-1),I.exports._tr_align=I=>{n(I,2,3),X(I,256,N),(I=>{16===I.bi_valid?(c(I,I.bi_buf),I.bi_buf=0,I.bi_valid=0):I.bi_valid>=8&&(I.pending_buf[I.pending++]=255&I.bi_buf,I.bi_buf>>=8,I.bi_valid-=8)})(I)}},13337:I=>{"use strict";I.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.NO="",this.state=null,this.data_type=2,this.adler=0}},13018:I=>{function O(I,O,C){for(var j=I.length,K=-1/0,i=1/0,y=0;y<j;y++){var S=(C[0][y]-I[y])/O[y],U=(C[1][y]-I[y])/O[y];if(S>U){var p=S;S=U,U=p}if(U<K||S>i)return 1/0;S>K&&(K=S),U<i&&(i=U)}return K>i?1/0:K}I.exports=function(I,C,j,K){var i=O(C,j,K);if(i===1/0)I=null;else{I=I||[];for(var y=0;y<C.length;y++)I[y]=C[y]+j[y]*i}return I},I.exports.distance=O},14353:(I,O,C)=>{"use strict";C.d(O,{c:()=>y});var j=C(36);const K=j.useLayoutEffect;const i=function(I){var O=(0,j.useRef)(I);return K((function(){O.current=I})),O};var y=function(I){var O=i(I);(0,j.SO)((function(){var I=function(I){var C;if(null!=O.current&&(C=O.current(I)),I.defaultPrevented&&(I.returnValue=""),"string"===typeof C)return I.returnValue=C,C};return window.addEventListener("beforeunload",I),function(){window.removeEventListener("beforeunload",I)}}),[])}},14316:(I,O,C)=>{"use strict";var j=C(14322),K=Array.prototype.concat,i=Array.prototype.slice,y=I.exports=function(I){for(var O=[],C=0,y=I.length;C<y;C++){var S=I[C];j(S)?O=K.call(O,i.call(S)):O.push(S)}return O};y.wrap=function(I){return function(){return I(y(arguments))}}},14322:I=>{I.exports=function(I){return!(!I||"string"===typeof I)&&(I instanceof Array||Array.isArray(I)||I.length>=0&&(I.splice instanceof Function||Object.getOwnPropertyDescriptor(I,I.length-1)&&"String"!==I.constructor.name))}},13252:(I,O,C)=>{var j=C(13258);function K(I){for(var O,C,K=0,i=I.length,y=0;y<I.length;){for(O=I[y],C=0;y<i&&I[y]===O;)++y,++C;K+=j.log2(C)/7|0,K+=j.log2(O>>>0)/7|0,K+=2}return K}O.size=K,O.encode=function(I,O){O||(O=new Uint8Array(K(I)));for(var C,j,i=0,y=O.length,S=0;S<I.length;){for(C=I[S],j=0;S<I.length&&I[S]===C;)++S,++j;for(;i<y&&j>=128;)O[i++]=128+(127&j),j>>>=7;if(i>=y)throw new Error("RLE buffer overflow");for(O[i++]=j,C>>>=0;i<y&&C>=128;)O[i++]=128+(127&C),C>>>=7;if(i>=y)throw new Error("RLE buffer overflow");O[i++]=C}return O},O.decode=function(I,O){for(var C,j,K,i,y=O.length,S=I.length,U=0,p=0;p<S;){for(C=0,j=0;p<S&&I[p]>=128;)C+=(127&I[p++])<<j,j+=7;if(C+=I[p++]<<j,p>=S)throw new Error("RLE buffer underrun");if(U+C>y)throw new Error("Chunk buffer overflow");for(K=0,j=0;p<S&&I[p]>=128;)K+=(127&I[p++])<<j,j+=7;if(p>=S)throw new Error("RLE buffer underrun");for(K+=I[p++]<<j,i=0;i<C;++i)O[U++]=K}return O}},13258:(I,O)=>{"use strict";function C(I){var O=32;return(I&=-I)&&O--,65535&I&&(O-=16),16711935&I&&(O-=8),252645135&I&&(O-=4),858993459&I&&(O-=2),1431655765&I&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(I){return(I>0)-(I<0)},O.abs=function(I){var O=I>>31;return(I^O)-O},O.min=function(I,O){return O^(I^O)&-(I<O)},O.max=function(I,O){return I^(I^O)&-(I<O)},O.isPow2=function(I){return!(I&I-1)&&!!I},O.log2=function(I){var O,C;return O=(I>65535)<<4,O|=C=((I>>>=O)>255)<<3,O|=C=((I>>>=C)>15)<<2,(O|=C=((I>>>=C)>3)<<1)|(I>>>=C)>>1},O.log10=function(I){return I>=1e9?9:I>=1e8?8:I>=1e7?7:I>=1e6?6:I>=1e5?5:I>=1e4?4:I>=1e3?3:I>=100?2:I>=10?1:0},O.popCount=function(I){return 16843009*((I=(858993459&(I-=I>>>1&1431655765))+(I>>>2&858993459))+(I>>>4)&252645135)>>>24},O.countTrailingZeros=C,O.nextPow2=function(I){return I+=0===I,--I,I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)+1},O.prevPow2=function(I){return I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)-(I>>>1)},O.parity=function(I){return I^=I>>>16,I^=I>>>8,I^=I>>>4,27030>>>(I&=15)&1};var j=new Array(256);!function(I){for(var O=0;O<256;++O){var C=O,j=O,K=7;for(C>>>=1;C;C>>>=1)j<<=1,j|=1&C,--K;I[O]=j<<K&255}}(j),O.reverse=function(I){return j[255&I]<<24|j[I>>>8&255]<<16|j[I>>>16&255]<<8|j[I>>>24&255]},O.interleave2=function(I,O){return(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(I,O){return(I=65535&((I=16711935&((I=252645135&((I=858993459&((I=I>>>O&1431655765)|I>>>1))|I>>>2))|I>>>4))|I>>>16))<<16>>16},O.interleave3=function(I,O,C){return I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2),(I|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2))<<2},O.deinterleave3=function(I,O){return(I=1023&((I=4278190335&((I=251719695&((I=3272356035&((I=I>>>O&1227133513)|I>>>2))|I>>>4))|I>>>8))|I>>>16))<<22>>22},O.nextCombination=function(I){var O=I|I-1;return O+1|(~O&-~O)-1>>>C(I)+1}},13281:I=>{"use strict";I.exports=function(I,O,C,j){var K=self||window;try{try{var i;try{i=new K.Blob([I])}catch(p){(i=new(K.BlobBuilder||K.WebKitBlobBuilder||K.MozBlobBuilder||K.MSBlobBuilder)).append(I),i=i.getBlob()}var y=K.URL||K.webkitURL,S=y.createObjectURL(i),U=new K[O](S,C);return y.revokeObjectURL(S),U}catch(p){return new K[O]("data:application/javascript,".concat(encodeURIComponent(I)),C)}}catch(p){if(!j)throw Error("Inline worker is not supported");return new K[O](j,C)}}},13005:(I,O,C)=>{"use strict";function j(I,O,C,j,K){var i={};return Object.keys(j).forEach((function(I){i[I]=j[I]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=C.slice().reverse().reduce((function(C,j){return j(I,O,C)||C}),i),K&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(K):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(I,O,i),i=null),i}C.d(O,{d:()=>j})},13e3:(I,O,C)=>{"use strict";function j(I,O,C,j){C&&Object.defineProperty(I,O,{enumerable:C.enumerable,configurable:C.configurable,writable:C.writable,value:C.initializer?C.initializer.call(j):void 0})}C.d(O,{e:()=>j})},14348:(I,O,C)=>{"use strict";C.d(O,{b:()=>y,d:()=>Q,e:()=>S,f:()=>i,g:()=>U,i:()=>K,l:()=>p,n:()=>N});var j=C(12460);class K{constructor(){this._easingMode=K.EASINGMODE_EASEIN}setEasingMode(I){const O=Math.min(Math.max(I,0),2);this._easingMode=O}getEasingMode(){return this._easingMode}easeInCore(I){throw new Error("You must implement this method")}ease(I){switch(this._easingMode){case K.EASINGMODE_EASEIN:return this.easeInCore(I);case K.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-I)}return I>=.5?.5*(1-this.easeInCore(2*(1-I)))+.5:.5*this.easeInCore(2*I)}}K.EASINGMODE_EASEIN=0,K.EASINGMODE_EASEOUT=1,K.EASINGMODE_EASEINOUT=2;class i extends K{easeInCore(I){return I=Math.max(0,Math.min(1,I)),1-Math.sqrt(1-I*I)}}class y extends K{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=I}easeInCore(I){const O=Math.max(0,this.amplitude);return Math.pow(I,3)-I*O*Math.sin(3.141592653589793*I)}}class S extends K{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=I,this.bounciness=O}easeInCore(I){const O=Math.max(0,this.bounces);let C=this.bounciness;C<=1&&(C=1.001);const j=Math.pow(C,O),K=1-C,i=(1-j)/K+.5*j,y=I*i,S=Math.log(-y*(1-C)+1)/Math.log(C),U=Math.floor(S),p=U+1,N=(1-Math.pow(C,U))/(K*i),Q=.5*(N+(1-Math.pow(C,p))/(K*i)),s=I-Q,Z=Q-N;return-Math.pow(1/C,O-U)/(Z*Z)*(s-Z)*(s+Z)}}class U extends K{easeInCore(I){return I*I*I}}class p extends K{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=I,this.springiness=O}easeInCore(I){let O;const C=Math.max(0,this.oscillations),j=Math.max(0,this.springiness);return O=0==j?I:(Math.exp(j*I)-1)/(Math.exp(j)-1),O*Math.sin((6.283185307179586*C+1.5707963267948966)*I)}}class N extends K{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=I}easeInCore(I){return this.exponent<=0?I:(Math.exp(this.exponent*I)-1)/(Math.exp(this.exponent)-1)}}class Q extends K{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=I,this.y1=O,this.x2=C,this.y2=j}easeInCore(I){return j.c.Interpolate(I,this.x1,this.y1,this.x2,this.y2)}}},13806:(I,O,C)=>{"use strict";C.d(O,{b:()=>y});var j=C(12272),K=C(12276),i=C(12654);class y extends i.b{get _matrix(){return this._compose(),this.os}set _matrix(I){(I.updateFlag!==this.os.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.os.K(I),this._markAsDirtyAndDecompose())}constructor(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(I,O.nI(),!1),this.name=I,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=O,this.os=(null===K||void 0===K?void 0:K.clone())??j.Matrix.Identity(),this._restMatrix=i??this.os.clone(),this._bindMatrix=y??this.os.clone(),this._index=S,this._absoluteMatrix=new j.Matrix,this._absoluteBindMatrix=new j.Matrix,this._absoluteInverseBindMatrix=new j.Matrix,this._finalMatrix=new j.Matrix,O.bones.push(this),this.setParent(C,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(I){this.setParent(I)}setParent(I){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==I){if(this.parent){const I=this.parent.children.indexOf(this);-1!==I&&this.parent.children.splice(I,1)}this._parentNode=I,this.parent&&this.parent.children.push(this),O&&this._updateAbsoluteBindMatrices(),this.zp()}}getLocalMatrix(){return this._compose(),this.os}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(I){this._restMatrix.K(I)}setRestPose(I){this.setRestMatrix(I)}getBindPose(){return this.getBindMatrix()}setBindMatrix(I){this.hS(I)}setBindPose(I){this.setBindMatrix(I)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const I=j.TmpVectors.mC[0],O=j.TmpVectors.Quaternion[0],C=j.TmpVectors.mC[1];this.getRestMatrix().decompose(I,O,C),this._linkedTransformNode.position.K(C),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??j.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.K(O),this._linkedTransformNode.nS.K(I)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(I){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=I,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.vS}set position(I){this._decompose(),this.vS.K(I),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(I){this.setRotation(I)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(I){this.setRotationQuaternion(I)}get nS(){return this.getScale()}set nS(I){this.setScale(I)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=j.mC.Zero(),this._localRotation=j.Quaternion.Zero(),this.vS=j.mC.Zero()),this.os.decompose(this._localScaling,this._localRotation,this.vS))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,j.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.vS,this.os)):this._needToCompose=!1)}hS(I){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.K(I),O&&this._updateAbsoluteBindMatrices(),C?this._matrix=I:this.zp()}_updateAbsoluteBindMatrices(I){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(I||(I=this._bindMatrix),this.parent?I.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.K(I),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),O)for(let C=0;C<this.children.length;C++)this.children[C]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}zp(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.zp(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.zp(),this._needToDecompose=!0}_updatePosition(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0,K=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=this.getLocalMatrix();if(0==O)K?(i.addAtIndex(12,I.x),i.addAtIndex(13,I.y),i.addAtIndex(14,I.z)):i.setTranslationFromFloats(I.x,I.y,I.z);else{let O=null;C&&(O=C.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const S=y._TmpMats[0],U=y._TmpVecs[0];this.parent?C&&O?(S.K(this.parent.getAbsoluteMatrix()),S.multiplyToRef(O,S)):S.K(this.parent.getAbsoluteMatrix()):j.Matrix.IdentityToRef(S),K&&S.setTranslationFromFloats(0,0,0),S.invert(),j.mC.TransformCoordinatesToRef(I,S,U),K?(i.addAtIndex(12,U.x),i.addAtIndex(13,U.y),i.addAtIndex(14,U.z)):i.setTranslationFromFloats(U.x,U.y,U.z)}this._markAsDirtyAndDecompose()}translate(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(I,O,C,!0)}setPosition(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(I,O,C,!1)}setAbsolutePosition(I,O){this.setPosition(I,1,O)}scale(I,O,C){let K=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=this.getLocalMatrix(),S=y._TmpMats[0];j.Matrix.ScalingToRef(I,O,C,S),S.multiplyToRef(i,i),S.invert();for(const j of this.children){const K=j.getLocalMatrix();K.multiplyToRef(S,K),K.multiplyAtIndex(12,I),K.multiplyAtIndex(13,O),K.multiplyAtIndex(14,C),j._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),K)for(const j of this.children)j.scale(I,O,C,K)}setScale(I){this._decompose(),this._localScaling.K(I),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(I){this._decompose(),I.K(this._localScaling)}setYawPitchRoll(I,O,C){let K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;if(0===K){const S=y._TmpQuat;return j.Quaternion.RotationYawPitchRollToRef(I,O,C,S),void this.setRotationQuaternion(S,K,i)}const S=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(S,i))return;const U=y._TmpMats[1];j.Matrix.RotationYawPitchRollToRef(I,O,C,U),S.multiplyToRef(U,U),this._rotateWithMatrix(U,K,i)}rotate(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,K=arguments.length>3?arguments[3]:void 0;const i=y._TmpMats[0];i.setTranslationFromFloats(0,0,0),j.Matrix.RotationAxisToRef(I,O,i),this._rotateWithMatrix(i,C,K)}setAxisAngle(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,K=arguments.length>3?arguments[3]:void 0;if(0===C){const i=y._TmpQuat;return j.Quaternion.RotationAxisToRef(I,O,i),void this.setRotationQuaternion(i,C,K)}const i=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(i,K))return;const S=y._TmpMats[1];j.Matrix.RotationAxisToRef(I,O,S),i.multiplyToRef(S,S),this._rotateWithMatrix(S,C,K)}setRotation(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(I.y,I.x,I.z,O,C)}setRotationQuaternion(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===O)return this._decompose(),this._localRotation.K(I),void this._markAsDirtyAndCompose();const K=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(K,C))return;const i=y._TmpMats[1];j.Matrix.FromQuaternionToRef(I,i),K.multiplyToRef(i,i),this._rotateWithMatrix(i,O,C)}setRotationMatrix(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===O){const K=y._TmpQuat;return j.Quaternion.FromRotationMatrixToRef(I,K),void this.setRotationQuaternion(K,O,C)}const K=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(K,C))return;const i=y._TmpMats[1];i.K(I),K.multiplyToRef(I,i),this._rotateWithMatrix(i,O,C)}_rotateWithMatrix(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const j=this.getLocalMatrix(),K=j.m[12],i=j.m[13],S=j.m[14],U=this.getParent(),p=y._TmpMats[3],N=y._TmpMats[4];U&&1==O?(C?(p.K(C.getWorldMatrix()),U.getAbsoluteMatrix().multiplyToRef(p,p)):p.K(U.getAbsoluteMatrix()),N.K(p),N.invert(),j.multiplyToRef(p,j),j.multiplyToRef(I,j),j.multiplyToRef(N,j)):1==O&&C?(p.K(C.getWorldMatrix()),N.K(p),N.invert(),j.multiplyToRef(p,j),j.multiplyToRef(I,j),j.multiplyToRef(N,j)):j.multiplyToRef(I,j),j.setTranslationFromFloats(K,i,S),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(I,O){const C=y._TmpMats[2];return I.K(this.getAbsoluteMatrix()),O?(I.multiplyToRef(O.getWorldMatrix(),I),j.Matrix.ScalingToRef(O.nS.x,O.nS.y,O.nS.z,C)):j.Matrix.IdentityToRef(C),I.invert(),!isNaN(I.m[0])&&(C.multiplyAtIndex(0,this._scalingDeterminant),I.multiplyToRef(C,I),!0)}ny(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=j.mC.Zero();return this.getPositionToRef(I,O,C),C}getPositionToRef(){let I=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const I=this.getLocalMatrix();O.x=I.m[12],O.y=I.m[13],O.z=I.m[14]}else{let C=null;I&&(C=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let j=y._TmpMats[0];I&&C?(j.K(this.getAbsoluteMatrix()),j.multiplyToRef(C,j)):j=this.getAbsoluteMatrix(),O.x=j.m[12],O.y=j.m[13],O.z=j.m[14]}}getAbsolutePosition(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=j.mC.Zero();return this.getPositionToRef(1,I,O),O}getAbsolutePositionToRef(I,O){this.getPositionToRef(1,I,O)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.os.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.K(this.os);const I=this._skeleton.getPoseMatrix();I&&this._absoluteMatrix.multiplyToRef(I,this._absoluteMatrix)}const I=this.children,O=I.length;for(let C=0;C<O;C++)I[C].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}cU(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=j.mC.Zero();return this.getDirectionToRef(I,O,C),C}getDirectionToRef(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,K=null;O&&(K=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const i=y._TmpMats[0];i.K(this.getAbsoluteMatrix()),O&&K&&i.multiplyToRef(K,i),j.mC.TransformNormalToRef(I,i,C),C.normalize()}getRotation(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=j.mC.Zero();return this.getRotationToRef(I,O,C),C}getRotationToRef(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0;const j=y._TmpQuat;this.getRotationQuaternionToRef(I,O,j),j.toEulerAnglesToRef(C)}getRotationQuaternion(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=j.Quaternion.Identity();return this.getRotationQuaternionToRef(I,O,C),C}getRotationQuaternionToRef(){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),O.K(this._localRotation);else{const C=y._TmpMats[0],j=this.getAbsoluteMatrix();I?j.multiplyToRef(I.getWorldMatrix(),C):C.K(j),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.decompose(void 0,O,void 0)}}getRotationMatrix(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1?arguments[1]:void 0;const C=j.Matrix.Identity();return this.getRotationMatrixToRef(I,O,C),C}getRotationMatrixToRef(){let I=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(O);else{const C=y._TmpMats[0],j=this.getAbsoluteMatrix();I?j.multiplyToRef(I.getWorldMatrix(),C):C.K(j),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.getRotationMatrixToRef(O)}}getAbsolutePositionFromLocal(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=j.mC.Zero();return this.getAbsolutePositionFromLocalToRef(I,O,C),C}getAbsolutePositionFromLocalToRef(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,K=null;O&&(K=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const i=y._TmpMats[0];i.K(this.getAbsoluteMatrix()),O&&K&&i.multiplyToRef(K,i),j.mC.TransformCoordinatesToRef(I,i,C)}getLocalPositionFromAbsolute(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=j.mC.Zero();return this.getLocalPositionFromAbsoluteToRef(I,O,C),C}getLocalPositionFromAbsoluteToRef(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,K=null;O&&(K=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const i=y._TmpMats[0];i.K(this.getAbsoluteMatrix()),O&&K&&i.multiplyToRef(K,i),i.invert(),j.mC.TransformCoordinatesToRef(I,i,C)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const I=this._skeleton.bones.indexOf(this);if(-1!==I&&this._skeleton.bones.splice(I,1),this._parentNode&&this._parentNode.children){const I=this._parentNode.children,O=I.indexOf(this);-1!==O&&I.splice(O,1)}super.dispose()}}y._TmpVecs=(0,K.e)(2,j.mC.Zero),y._TmpQuat=j.Quaternion.Identity(),y._TmpMats=(0,K.e)(5,j.Matrix.Identity)},14344:(I,O,C)=>{"use strict";C.d(O,{b:()=>f});var j=C(12250),K=C(12257),i=C(12088),y=C(12272),S=C(12282),U=C(12654),p=C(12671),N=C(12525),Q=C(12118),s=C(12274);class Z{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(I){this._zoomStopsAnimation=I}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(I){this._idleRotationSpeed=I}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(I){this._idleRotationWaitTime=I}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(I){this._idleRotationSpinupTime=I}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(I){this._attachedCamera=I;const O=this._attachedCamera.nI();this._onPrePointerObservableObserver=O.onPrePointerObservable.add((I=>{I.type!==N.e.POINTERDOWN?I.type===N.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=I.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const I=Q.c.Now;let O=0;null!=this._lastFrameTime&&(O=I-this._lastFrameTime),this._lastFrameTime=I,this._applyUserInteraction();const C=I-this._lastInteractionTime-this._idleRotationWaitTime,j=Math.max(Math.min(C/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*j,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(O/1e3))}))}detach(){if(!this._attachedCamera)return;const I=this._attachedCamera.nI();this._onPrePointerObservableObserver&&I.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(I){this._lastInteractionTime=I??Q.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<s.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let I=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(I=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?I:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Q.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var q=C(14348),mI=C(12759);class E{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(I){if(this._autoTransitionRange===I)return;this._autoTransitionRange=I;const O=this._attachedCamera;O&&(I?this._onMeshTargetChangedObserver=O.onMeshTargetChangedObservable.add((I=>{if(I&&(I.rS(!0),I.getBoundingInfo)){const O=I.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*O,this.upperRadiusTransitionRange=.05*O}})):this._onMeshTargetChangedObserver&&O.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(I){this._attachedCamera=I,this._onAfterCheckInputsObserver=I.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(I){return!!this._attachedCamera&&(this._attachedCamera.radius===I&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(I){if(!this._attachedCamera)return;this._radiusBounceTransition||(E.EasingFunction.setEasingMode(E.EasingMode),this._radiusBounceTransition=mI.d.CreateAnimation("radius",mI.d.ANIMATIONTYPE_FLOAT,60,E.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const O=mI.d.TransitionTo("radius",this._attachedCamera.radius+I,this._attachedCamera,this._attachedCamera.nI(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));O&&this._animatables.push(O)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}E.EasingFunction=new q.b(.3),E.EasingMode=q.i.EASINGMODE_EASEOUT;class h{constructor(){this.onTargetFramingAnimationEndObservable=new i.c,this._mode=h.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(I){this._mode=I}get mode(){return this._mode}set radiusScale(I){this._radiusScale=I}get radiusScale(){return this._radiusScale}set positionScale(I){this._positionScale=I}get positionScale(){return this._positionScale}set defaultElevation(I){this._defaultElevation=I}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(I){this._elevationReturnTime=I}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(I){this._elevationReturnWaitTime=I}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(I){this._zoomStopsAnimation=I}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(I){this._framingTime=I}get framingTime(){return this._framingTime}init(){}attach(I){this._attachedCamera=I;const O=this._attachedCamera.nI();h.EasingFunction.setEasingMode(h.EasingMode),this._onPrePointerObservableObserver=O.onPrePointerObservable.add((I=>{I.type!==N.e.POINTERDOWN?I.type===N.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=I.onMeshTargetChangedObservable.add((I=>{I&&I.getBoundingInfo&&this.zoomOnMesh(I,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=I.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const I=this._attachedCamera.nI();this._onPrePointerObservableObserver&&I.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(I){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;I.rS(!0);const j=I.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(j.minimumWorld,j.maximumWorld,O,C)}zoomOnMeshHierarchy(I){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;I.rS(!0);const j=I.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(j.min,j.max,O,C)}zoomOnMeshesHierarchy(I){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new y.mC(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),K=new y.mC(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<I.length;i++){const O=I[i].getHierarchyBoundingVectors(!0);y.mC.CheckExtends(O.min,j,K),y.mC.CheckExtends(O.max,j,K)}this.zoomOnBoundingInfo(j,K,O,C)}zoomOnBoundingInfo(I,O){let C,j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const i=I.y,S=i+(O.y-i)*this._positionScale,U=O.EO(I).scale(.5);if(!isFinite(S))return!1;if(j)C=new y.mC(0,S,0);else{const O=I.add(U);C=new y.mC(O.x,S,O.z)}this._vectorTransition||(this._vectorTransition=mI.d.CreateAnimation("target",mI.d.ANIMATIONTYPE_VECTOR3,60,h.EasingFunction)),this._betaIsAnimating=!0;let p=mI.d.TransitionTo("target",C,this._attachedCamera,this._attachedCamera.nI(),60,this._vectorTransition,this._framingTime);p&&this._animatables.push(p);let N=0;if(this._mode===h.FitFrustumSidesMode){const C=this._calculateLowerRadiusFromModelBoundingSphere(I,O);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=U.length()+this._attachedCamera.ES),N=C}else this._mode===h.IgnoreBoundsSizeMode&&(N=this._calculateLowerRadiusFromModelBoundingSphere(I,O),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ES));if(this.autoCorrectCameraLimitsAndSensibility){const C=O.EO(I).length();this._attachedCamera.panningSensibility=5e3/C,this._attachedCamera.wheelPrecision=100/N}return this._radiusTransition||(this._radiusTransition=mI.d.CreateAnimation("radius",mI.d.ANIMATIONTYPE_FLOAT,60,h.EasingFunction)),p=mI.d.TransitionTo("radius",N,this._attachedCamera,this._attachedCamera.nI(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),K&&K(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),p&&this._animatables.push(p),!0}_calculateLowerRadiusFromModelBoundingSphere(I,O){const C=this._attachedCamera;if(!C)return 0;let j=C._calculateLowerRadiusFromModelBoundingSphere(I,O,this._radiusScale);return C.lowerRadiusLimit&&this._mode===h.IgnoreBoundsSizeMode&&(j=j<C.lowerRadiusLimit?C.lowerRadiusLimit:j),C.upperRadiusLimit&&(j=j>C.upperRadiusLimit?C.upperRadiusLimit:j),j}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const I=Q.c.Now-this._lastInteractionTime,O=.5*Math.PI-this._defaultElevation,C=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>C&&I>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=mI.d.CreateAnimation("beta",mI.d.ANIMATIONTYPE_FLOAT,60,h.EasingFunction));const I=mI.d.TransitionTo("beta",O,this._attachedCamera,this._attachedCamera.nI(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));I&&this._animatables.push(I)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=Q.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}h.EasingFunction=new q.n,h.EasingMode=q.i.EASINGMODE_EASEINOUT,h.IgnoreBoundsSizeMode=0,h.FitFrustumSidesMode=1;var r=C(12677),W=C(12712),Y=C(13798),o=C(12083);class c{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(I){I=o.Tools.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),C=O.getInputElement();let j=0,K=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=i=>{var y,S;const U=i.event,p="touch"===U.pointerType;if(i.type!==N.e.POINTERMOVE&&-1===this.buttons.indexOf(U.button))return;const Q=U.target;if(this._altKey=U.altKey,this._ctrlKey=U.ctrlKey,this._metaKey=U.metaKey,this._shiftKey=U.shiftKey,this._buttonsPressed=U.buttons,O.isPointerLock){const I=U.movementX,O=U.movementY;this.onTouch(null,I,O),this._pointA=null,this._pointB=null}else{if(i.type!==N.e.POINTERDOWN&&i.type!==N.e.POINTERDOUBLETAP&&p&&(null===(y=this._pointA)||void 0===y?void 0:y.pointerId)!==U.pointerId&&(null===(S=this._pointB)||void 0===S?void 0:S.pointerId)!==U.pointerId)return;if(i.type!==N.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!p)if(i.type===N.e.POINTERDOUBLETAP)this.onDoubleTap(U.pointerType);else if(i.type!==N.e.POINTERUP||this._currentMousePointerIdDown!==U.pointerId&&!p){if(i.type===N.e.POINTERMOVE)if(I||U.preventDefault(),this._pointA&&null===this._pointB){const I=U.clientX-this._pointA.x,O=U.clientY-this._pointA.y;this._pointA.x=U.clientX,this._pointA.y=U.clientY,this.onTouch(this._pointA,I,O)}else if(this._pointA&&this._pointB){const I=this._pointA.pointerId===U.pointerId?this._pointA:this._pointB;I.x=U.clientX,I.y=U.clientY;const O=this._pointA.x-this._pointB.x,C=this._pointA.y-this._pointB.y,y=O*O+C*C,S={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:U.pointerId,type:i.type};this.onMultiTouch(this._pointA,this._pointB,j,y,K,S),K=S,j=y}}else{try{null===Q||void 0===Q||Q.releasePointerCapture(U.pointerId)}catch(s){}p||(this._pointB=null),O._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==U.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==U.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==j||K)&&(this.onMultiTouch(this._pointA,this._pointB,j,0,K,null),j=0,K=null),this._currentMousePointerIdDown=-1,this.onButtonUp(U),I||U.preventDefault()}else{try{null===Q||void 0===Q||Q.setPointerCapture(U.pointerId)}catch(s){}if(null===this._pointA)this._pointA={x:U.clientX,y:U.clientY,pointerId:U.pointerId,type:U.pointerType};else{if(null!==this._pointB)return;this._pointB={x:U.clientX,y:U.clientY,pointerId:U.pointerId,type:U.pointerType}}-1!==this._currentMousePointerIdDown||p||(this._currentMousePointerIdDown=U.pointerId),this.onButtonDown(U),I||(U.preventDefault(),C&&C.focus())}}},this._observer=this.camera.nI()._inputManager._addCameraPointerObserver(this._pointerInput,N.e.POINTERDOWN|N.e.POINTERUP|N.e.POINTERMOVE|N.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,j=0,K=null,this.onLostFocus()},this._contextMenuBind=I=>this.onContextMenu(I),C&&C.addEventListener("contextmenu",this._contextMenuBind,!1);const i=this.camera.nI().getEngine().getHostWindow();i&&o.Tools.RegisterTopRootEvents(i,[{name:"blur",handler:this._onLostFocus}])}JQ(){if(this._onLostFocus){const I=this.camera.nI().getEngine().getHostWindow();I&&o.Tools.UnregisterTopRootEvents(I,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.nI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const I=this.camera.nI().getEngine().getInputElement();I&&I.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(I){}onTouch(I,O,C){}onMultiTouch(I,O,C,j,K,i){}onContextMenu(I){I.preventDefault()}onButtonDown(I){}onButtonUp(I){}onLostFocus(){}}(0,j.e)([(0,K.E)()],c.prototype,"buttons",void 0);class n extends c{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(I,O){if(0!==this.panningSensibility&&I&&O){const C=O.x-I.x,j=O.y-I.y;this.camera.inertialPanningX+=-C/this.panningSensibility,this.camera.inertialPanningY+=j/this.panningSensibility}}_computePinchZoom(I,O){const C=this.camera.radius||n.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=C*Math.sqrt(I)/Math.sqrt(O):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(O-I)*C*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(O-I)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(I,O,C){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-O/this.panningSensibility,this.camera.inertialPanningY+=C/this.panningSensibility):(this.camera.inertialAlphaOffset-=O/this.angularSensibilityX,this.camera.inertialBetaOffset-=C/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(I,O,C,j,K,i){0===C&&null===K||0===j&&null===i||(this.multiTouchPanAndZoom?(this._computePinchZoom(C,j),this._computeMultiTouchPanning(K,i)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(j)-Math.sqrt(C))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(C,j),this._isPinching=!0):this._computeMultiTouchPanning(K,i)):this.multiTouchPanning?this._computeMultiTouchPanning(K,i):this.pinchZoom&&this._computePinchZoom(C,j))}onButtonDown(I){this._isPanClick=I.button===this.camera._panningMouseButton}onButtonUp(I){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}n.MinimumRadiusForPinch=.001,(0,j.e)([(0,K.E)()],n.prototype,"buttons",void 0),(0,j.e)([(0,K.E)()],n.prototype,"angularSensibilityX",void 0),(0,j.e)([(0,K.E)()],n.prototype,"angularSensibilityY",void 0),(0,j.e)([(0,K.E)()],n.prototype,"pinchPrecision",void 0),(0,j.e)([(0,K.E)()],n.prototype,"pinchDeltaPercentage",void 0),(0,j.e)([(0,K.E)()],n.prototype,"useNaturalPinchZoom",void 0),(0,j.e)([(0,K.E)()],n.prototype,"pinchZoom",void 0),(0,j.e)([(0,K.E)()],n.prototype,"panningSensibility",void 0),(0,j.e)([(0,K.E)()],n.prototype,"multiTouchPanning",void 0),(0,j.e)([(0,K.E)()],n.prototype,"multiTouchPanAndZoom",void 0),Y.d.ArcRotateCameraPointersInput=n;var X=C(12532);class T{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(I){I=o.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.nI(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const C=O.event;if(!C.metaKey)if(O.type===X.c.KEYDOWN){if(this._ctrlPressed=C.ctrlKey,this._altPressed=C.altKey,-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),C.preventDefault&&(I||C.preventDefault())}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){const O=this._keys.indexOf(C.keyCode);O>=0&&this._keys.splice(O,1),C.preventDefault&&(I||C.preventDefault())}})))}JQ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const I=this.camera;for(let O=0;O<this._keys.length;O++){const C=this._keys[O];-1!==this.keysLeft.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningX-=1/this.panningSensibility:I.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?I.inertialRadiusOffset+=1/this.zoomingSensibility:I.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningX+=1/this.panningSensibility:I.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?I.inertialRadiusOffset-=1/this.zoomingSensibility:I.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(C)&&I.useInputToRestoreState&&I.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,j.e)([(0,K.E)()],T.prototype,"keysUp",void 0),(0,j.e)([(0,K.E)()],T.prototype,"keysDown",void 0),(0,j.e)([(0,K.E)()],T.prototype,"keysLeft",void 0),(0,j.e)([(0,K.E)()],T.prototype,"keysRight",void 0),(0,j.e)([(0,K.E)()],T.prototype,"keysReset",void 0),(0,j.e)([(0,K.E)()],T.prototype,"panningSensibility",void 0),(0,j.e)([(0,K.E)()],T.prototype,"zoomingSensibility",void 0),(0,j.e)([(0,K.E)()],T.prototype,"useAltToZoom",void 0),(0,j.e)([(0,K.E)()],T.prototype,"angularSpeed",void 0),Y.d.ArcRotateCameraKeyboardMoveInput=T;var H=C(12310),b=C(12539);class a{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new y.mC(0,0,0),this._globalOffset=new y.mC(0,0,0),this._inertialPanning=y.mC.Zero()}_computeDeltaFromMouseWheelLegacyEvent(I,O){let C=0;const j=.01*I*this.wheelDeltaPercentage*O;return C=I>0?j/(1+this.wheelDeltaPercentage):j*(1+this.wheelDeltaPercentage),C}attachControl(I){I=o.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==N.e.POINTERWHEEL)return;const C=O.event;let j=0;const K=C.deltaMode===b.c.DOM_DELTA_LINE?40:1,i=-C.deltaY*K;if(this.customComputeDeltaFromMouseWheel)j=this.customComputeDeltaFromMouseWheel(i,this,C);else if(this.wheelDeltaPercentage){if(j=this._computeDeltaFromMouseWheelLegacyEvent(i,this.camera.radius),j>0){let I=this.camera.radius,O=this.camera.inertialRadiusOffset+j;for(let C=0;C<20&&!(I<=O)&&!(Math.abs(O*this.camera.inertia)<.001);C++)I-=O,O*=this.camera.inertia;I=(0,S.Clamp)(I,0,Number.MAX_VALUE),j=this._computeDeltaFromMouseWheelLegacyEvent(i,I)}}else j=i/(40*this.wheelPrecision);j&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(j)):this.camera.inertialRadiusOffset+=j),C.preventDefault&&(I||C.preventDefault())},this._observer=this.camera.nI()._inputManager._addCameraPointerObserver(this._wheel,N.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.XS(0)}JQ(){this._observer&&(this.camera.nI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const I=this.camera;0+I.inertialAlphaOffset+I.inertialBetaOffset+I.inertialRadiusOffset&&(this._updateHitPlane(),I.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(I.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const I=this.camera,O=I.target.EO(I.position);this._hitPlane=H.e.FromPositionAndNormal(I.target,O)}_getPosition(){const I=this.camera,O=I.nI(),C=O.createPickingRay(O.pointerX,O.pointerY,y.Matrix.Identity(),I,!1);0===I.targetScreenOffset.x&&0===I.targetScreenOffset.y||(this._viewOffset.set(I.targetScreenOffset.x,I.targetScreenOffset.y,0),I.getViewMatrix().invertToRef(I._cameraTransformMatrix),this._globalOffset=y.mC.TransformNormal(this._viewOffset,I._cameraTransformMatrix),C.origin.addInPlace(this._globalOffset));let j=0;return this._hitPlane&&(j=C.intersectsPlane(this._hitPlane)??0),C.origin.addInPlace(C.direction.scaleInPlace(j))}_zoomToMouse(I){const O=this.camera,C=1-O.inertia;if(O.lowerRadiusLimit){const j=O.lowerRadiusLimit??0;O.radius-(O.inertialRadiusOffset+I)/C<j&&(I=(O.radius-j)*C-O.inertialRadiusOffset)}if(O.upperRadiusLimit){const j=O.upperRadiusLimit??0;O.radius-(O.inertialRadiusOffset+I)/C>j&&(I=(O.radius-j)*C-O.inertialRadiusOffset)}const j=I/C/O.radius,K=this._getPosition(),i=y.TmpVectors.mC[6];K.subtractToRef(O.target,i),i.scaleInPlace(j),i.scaleInPlace(C),this._inertialPanning.addInPlace(i),O.inertialRadiusOffset+=I}_zeroIfClose(I){Math.abs(I.x)<s.d&&(I.x=0),Math.abs(I.y)<s.d&&(I.y=0),Math.abs(I.z)<s.d&&(I.z=0)}}(0,j.e)([(0,K.E)()],a.prototype,"wheelPrecision",void 0),(0,j.e)([(0,K.E)()],a.prototype,"zoomToMouseLocation",void 0),(0,j.e)([(0,K.E)()],a.prototype,"wheelDeltaPercentage",void 0),Y.d.ArcRotateCameraMouseWheelInput=a;class M extends Y.g{constructor(I){super(I)}addMouseWheel(){return this.add(new a),this}addPointers(){return this.add(new n),this}addKeyboard(){return this.add(new T),this}}var u=C(12226);function J(I,O){return isNaN(I)?O:I}U.b.AddNodeConstructor("ArcRotateCamera",((I,O)=>()=>new f(I,0,0,1,y.mC.Zero(),O)));class f extends W.d{get target(){return this._target}set target(I){this.setTarget(I)}get targetHost(){return this._targetHost}set targetHost(I){I&&this.setTarget(I)}getTarget(){return this.target}get position(){return this._position}set position(I){this.setPosition(I)}set upVector(I){this._upToYMatrix||(this._yToUpMatrix=new y.Matrix,this._upToYMatrix=new y.Matrix,this._upVector=y.mC.Zero()),I.normalize(),this._upVector.K(I),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){y.Matrix.RotationAlignToRef(y.mC.UpReadOnly,this._upVector,this._yToUpMatrix),y.Matrix.RotationAlignToRef(this._upVector,y.mC.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const I=this.inputs.attached.pointers;return I?I.angularSensibilityX:0}set angularSensibilityX(I){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityX=I)}get angularSensibilityY(){const I=this.inputs.attached.pointers;return I?I.angularSensibilityY:0}set angularSensibilityY(I){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityY=I)}get pinchPrecision(){const I=this.inputs.attached.pointers;return I?I.pinchPrecision:0}set pinchPrecision(I){const O=this.inputs.attached.pointers;O&&(O.pinchPrecision=I)}get pinchDeltaPercentage(){const I=this.inputs.attached.pointers;return I?I.pinchDeltaPercentage:0}set pinchDeltaPercentage(I){const O=this.inputs.attached.pointers;O&&(O.pinchDeltaPercentage=I)}get useNaturalPinchZoom(){const I=this.inputs.attached.pointers;return!!I&&I.useNaturalPinchZoom}set useNaturalPinchZoom(I){const O=this.inputs.attached.pointers;O&&(O.useNaturalPinchZoom=I)}get panningSensibility(){const I=this.inputs.attached.pointers;return I?I.panningSensibility:0}set panningSensibility(I){const O=this.inputs.attached.pointers;O&&(O.panningSensibility=I)}get keysUp(){const I=this.inputs.attached.keyboard;return I?I.keysUp:[]}set keysUp(I){const O=this.inputs.attached.keyboard;O&&(O.keysUp=I)}get keysDown(){const I=this.inputs.attached.keyboard;return I?I.keysDown:[]}set keysDown(I){const O=this.inputs.attached.keyboard;O&&(O.keysDown=I)}get keysLeft(){const I=this.inputs.attached.keyboard;return I?I.keysLeft:[]}set keysLeft(I){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=I)}get keysRight(){const I=this.inputs.attached.keyboard;return I?I.keysRight:[]}set keysRight(I){const O=this.inputs.attached.keyboard;O&&(O.keysRight=I)}get wheelPrecision(){const I=this.inputs.attached.mousewheel;return I?I.wheelPrecision:0}set wheelPrecision(I){const O=this.inputs.attached.mousewheel;O&&(O.wheelPrecision=I)}get zoomToMouseLocation(){const I=this.inputs.attached.mousewheel;return!!I&&I.zoomToMouseLocation}set zoomToMouseLocation(I){const O=this.inputs.attached.mousewheel;O&&(O.zoomToMouseLocation=I)}get wheelDeltaPercentage(){const I=this.inputs.attached.mousewheel;return I?I.wheelDeltaPercentage:0}set wheelDeltaPercentage(I){const O=this.inputs.attached.mousewheel;O&&(O.wheelDeltaPercentage=I)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(I){I!==this.useBouncingBehavior&&(I?(this._bouncingBehavior=new E,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(I){I!==this.useFramingBehavior&&(I?(this._framingBehavior=new h,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(I){I!==this.useAutoRotationBehavior&&(I?(this._autoRotationBehavior=new Z,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(I,O,C,j,K,S){var U;let p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(I,y.mC.Zero(),S,p),U=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=y.mC.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=y.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new y.Matrix,this.panningAxis=new y.mC(1,1,0),this._transformedDirection=new y.mC,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new i.c,this.checkCollisions=!1,this.collisionRadius=new y.mC(.5,.5,.5),this._previousPosition=y.mC.Zero(),this._collisionVelocity=y.mC.Zero(),this._newPosition=y.mC.Zero(),this._computationVector=y.mC.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new y.mC(NaN,NaN,NaN),this._goalTargetScreenOffset=new y.Vector2(NaN,NaN),this._onCollisionPositionChange=function(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C?(U.setPosition(O),U.mq&&U.mq(C)):U._previousPosition.K(U._position);const j=Math.cos(U.alpha),K=Math.sin(U.alpha),i=Math.cos(U.beta);let y=Math.sin(U.beta);0===y&&(y=1e-4);const S=U._getTargetPosition();U._computationVector.cS(U.radius*j*y,U.radius*i,U.radius*K*y),S.addToRef(U._computationVector,U._newPosition),U._position.K(U._newPosition);let p=U.upVector;U.allowUpsideDown&&U.beta<0&&(p=p.clone(),p=p.negate()),U._computeViewMatrix(U._position,S,p),U._viewMatrix.addAtIndex(12,U.targetScreenOffset.x),U._viewMatrix.addAtIndex(13,U.targetScreenOffset.y),U._collisionTriggered=!1},this._target=y.mC.Zero(),K&&this.setTarget(K),this.alpha=O,this.beta=C,this.radius=j,this.getViewMatrix(),this.inputs=new M(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new y.mC(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=y.Vector2.Zero()}_updateCache(I){I||super._updateCache(),this._cache._target.K(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.K(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const I=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?I.addToRef(this._targetBoundingCenter,this._target):this._target.K(I)}const I=this._getLockedTargetPosition();return I||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>s.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,i=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=i?this._currentInterpolationFactor=i:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=J(I,this._goalAlpha),this._goalBeta=J(O,this._goalBeta),this._goalRadius=J(C,this._goalRadius),this._goalTarget.set(J(j.x,this._goalTarget.x),J(j.y,this._goalTarget.y),J(j.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(J(K.x,this._goalTargetScreenOffset.x),J(K.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,S.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,S.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,S.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,S.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(I,O){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const K=arguments;O=o.Tools.BackCompatCameraNoPreventDefault(K),this._useCtrlForPanning=C,this._panningMouseButton=j,"boolean"===typeof K[0]&&(K.length>1&&(this._useCtrlForPanning=K[1]),K.length>2&&(this._panningMouseButton=K[2])),this.inputs.attachElement(O),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}JQ(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let I=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){I=!0;const O=this.invertRotation?-1:1,C=this._calculateHandednessMultiplier();let j=this.inertialAlphaOffset*C;this.beta<0&&(j*=-1),this.alpha+=j*O,this.beta+=this.inertialBetaOffset*O,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<s.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<s.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*s.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){I=!0;const O=new y.mC(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),O.multiplyInPlace(this.panningAxis),y.mC.TransformNormalToRef(O,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const I=this.upVector,O=y.mC.CrossToRef(this._transformedDirection,I,this._transformedDirection);y.mC.CrossToRef(I,O,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);y.mC.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.K(this._transformedDirection)}else{if(this.parent){const I=y.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(I),I.transposeToRef(I),y.mC.TransformCoordinatesToRef(this._transformedDirection,I,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*s.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*s.d&&(this.inertialPanningY=0)}if(I)this.stopInterpolation();else if(this._isInterpolating){let I=!1;const O=this._scene.getEngine().getDeltaTime()/1e3,C=1-Math.pow(2,-O/this._currentInterpolationFactor),j=J(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const O=y.TmpVectors.mC[0].set(J(this._goalTarget.x,this._target.x),J(this._goalTarget.y,this._target.y),J(this._goalTarget.z,this._target.z));y.mC.LerpToRef(this.target,O,C,this._target),10*y.mC.Distance(this.target,O)/j<s.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.K(O),this.setTarget(this.target,!1,!0,!0)):I=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const O=y.Quaternion.RotationAlphaBetaGammaToRef(J(this._goalAlpha,this.alpha),J(this._goalBeta,this.beta),0,y.TmpVectors.Quaternion[0]),j=y.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,y.TmpVectors.Quaternion[1]),K=y.Quaternion.SlerpToRef(j,O,C,y.TmpVectors.Quaternion[2]);K.normalize();const i=K.toAlphaBetaGammaToRef(y.TmpVectors.mC[0]);if(this.alpha=i.x,this.beta=i.y,K.isApprox(O,s.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const I=O.toAlphaBetaGammaToRef(y.TmpVectors.mC[0]);this.alpha=I.x,this.beta=I.y}else I=!0}if(isNaN(this._goalRadius)||(this.radius+=(j-this.radius)*C,Math.abs(j/this.radius-1)<s.d?(this._goalRadius=NaN,this.radius=j):I=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const O=y.TmpVectors.Vector2[0].set(J(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),J(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));y.Vector2.LerpToRef(this.targetScreenOffset,O,C,this.targetScreenOffset),y.Vector2.Distance(this.targetScreenOffset,O)<s.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.K(O)):I=!0}this._isInterpolating=I}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||y.mC.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const I=this.alpha;var O,C;this.alpha=function(I){let O=Math.PI/2;return 0===I.x&&0===I.z||(O=Math.acos(I.x/Math.sqrt(Math.pow(I.x,2)+Math.pow(I.z,2)))),I.z<0&&(O=2*Math.PI-O),O}(this._computationVector),this.beta=(O=this._computationVector.y,C=this.radius,Math.acos(O/C));const j=Math.round((I-this.alpha)/(2*Math.PI));this.alpha+=2*j*Math.PI,this._checkLimits()}setPosition(I){this._position.equals(I)||(this._position.K(I),this.rebuildAnglesAndRadius())}setTarget(I){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(j=this.overrideCloneAlphaBetaRadius??j,I.rS)O&&I.getBoundingInfo?this._targetBoundingCenter=I.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,I.rS(),this._targetHost=I,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const O=I,j=this._getTargetPosition();if(j&&!C&&j.equals(O))return;this._targetHost=null,this._target=O,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}j||this.rebuildAnglesAndRadius()}_getViewMatrix(){const I=Math.cos(this.alpha),O=Math.sin(this.alpha),C=Math.cos(this.beta);let j=Math.sin(this.beta);0===j&&(j=1e-4),0===this.radius&&(this.radius=1e-4);const K=this._getTargetPosition();if(this._computationVector.cS(this.radius*I*j,this.radius*C,this.radius*O*j),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||y.mC.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),K.addToRef(this._computationVector,this._newPosition),this.nI().collisionsEnabled&&this.checkCollisions){const I=this.nI().collisionCoordinator;this._collider||(this._collider=I.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,I.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.K(this._newPosition);let I=this.upVector;this.allowUpsideDown&&j<0&&(I=I.negate()),this._computeViewMatrix(this._position,K,I),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.K(K),this._viewMatrix}zoomOn(I){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I=I||this.nI().meshes;const C=p.c.MinMax(I);let j=this._calculateLowerRadiusFromModelBoundingSphere(C.min,C.max);if(j=Math.max(Math.min(j,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=j*this.zoomOnFactor,this.mode===r.e.ORTHOGRAPHIC_CAMERA){const I=this.nI().getEngine().getAspectRatio(this),O=j*this.zoomOnFactor/2;this.orthoLeft=-O*I,this.orthoRight=O*I,this.orthoBottom=-O,this.orthoTop=O}this.focusOn({min:C.min,max:C.max,distance:j},O)}focusOn(I){let O,C,j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===I.min){const j=I||this.nI().meshes;O=p.c.MinMax(j),C=y.mC.Distance(O.min,O.max)}else{O=I,C=I.distance}this._target=p.c.Center(O),j||(this.maxZ=2*C)}createRigCamera(I,O){let C=0;switch(this.cameraRigMode){case r.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case r.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case r.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case r.e.RIG_MODE_VR:C=this._cameraRigParams.stereoHalfAngle*(0===O?1:-1);break;case r.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:C=this._cameraRigParams.stereoHalfAngle*(0===O?-1:1)}const j=new f(I,this.alpha+C,this.beta,this.radius,this._target,this.nI());return j._cameraRigParams={},j.isRigCamera=!0,j.rigParent=this,j.upVector=this.upVector,j.mode=this.mode,j.orthoLeft=this.orthoLeft,j.orthoRight=this.orthoRight,j.orthoBottom=this.orthoBottom,j.orthoTop=this.orthoTop,j}_updateRigCameras(){const I=this._rigCameras[0],O=this._rigCameras[1];switch(I.beta=O.beta=this.beta,this.cameraRigMode){case r.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case r.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case r.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case r.e.RIG_MODE_VR:I.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case r.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:I.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const j=y.mC.Distance(I,O),K=this.nI().getEngine().getAspectRatio(this),i=Math.tan(this.fov/2),S=i*K,U=.5*j*C,p=U*Math.sqrt(1+1/(S*S)),N=U*Math.sqrt(1+1/(i*i));return Math.max(p,N)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,j.e)([(0,K.E)()],f.prototype,"alpha",void 0),(0,j.e)([(0,K.E)()],f.prototype,"beta",void 0),(0,j.e)([(0,K.E)()],f.prototype,"radius",void 0),(0,j.e)([(0,K.E)()],f.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,j.e)([(0,K.B)("target")],f.prototype,"_target",void 0),(0,j.e)([(0,K.t)("targetHost")],f.prototype,"_targetHost",void 0),(0,j.e)([(0,K.E)()],f.prototype,"inertialAlphaOffset",void 0),(0,j.e)([(0,K.E)()],f.prototype,"inertialBetaOffset",void 0),(0,j.e)([(0,K.E)()],f.prototype,"inertialRadiusOffset",void 0),(0,j.e)([(0,K.E)()],f.prototype,"lowerAlphaLimit",void 0),(0,j.e)([(0,K.E)()],f.prototype,"upperAlphaLimit",void 0),(0,j.e)([(0,K.E)()],f.prototype,"lowerBetaLimit",void 0),(0,j.e)([(0,K.E)()],f.prototype,"upperBetaLimit",void 0),(0,j.e)([(0,K.E)()],f.prototype,"lowerRadiusLimit",void 0),(0,j.e)([(0,K.E)()],f.prototype,"upperRadiusLimit",void 0),(0,j.e)([(0,K.E)()],f.prototype,"lowerTargetYLimit",void 0),(0,j.e)([(0,K.E)()],f.prototype,"inertialPanningX",void 0),(0,j.e)([(0,K.E)()],f.prototype,"inertialPanningY",void 0),(0,j.e)([(0,K.E)()],f.prototype,"pinchToPanMaxDistance",void 0),(0,j.e)([(0,K.E)()],f.prototype,"panningDistanceLimit",void 0),(0,j.e)([(0,K.B)()],f.prototype,"panningOriginTarget",void 0),(0,j.e)([(0,K.E)()],f.prototype,"panningInertia",void 0),(0,j.e)([(0,K.E)()],f.prototype,"zoomToMouseLocation",null),(0,j.e)([(0,K.E)()],f.prototype,"zoomOnFactor",void 0),(0,j.e)([(0,K.z)()],f.prototype,"targetScreenOffset",void 0),(0,j.e)([(0,K.E)()],f.prototype,"allowUpsideDown",void 0),(0,j.e)([(0,K.E)()],f.prototype,"useInputToRestoreState",void 0),(0,j.e)([(0,K.E)()],f.prototype,"restoreStateInterpolationFactor",void 0),(0,u.e)("BABYLON.ArcRotateCamera",f)},13798:(I,O,C)=>{"use strict";C.d(O,{d:()=>y,g:()=>S});var j=C(12103),K=C(12296),i=C(12677),y={};class S{constructor(I){this.attachedToElement=!1,this.attached={},this.camera=I,this.checkInputs=()=>{}}add(I){const O=I.getSimpleName();this.attached[O]?j.c.Warn("camera input of type "+O+" already exists on camera"):(this.attached[O]=I,I.camera=this.camera,I.checkInputs&&(this.checkInputs=this._addCheckInputs(I.checkInputs.bind(I))),this.attachedToElement&&I.attachControl(this.noPreventDefault))}remove(I){for(const O in this.attached){const C=this.attached[O];if(C===I)return C.JQ(),C.camera=null,delete this.attached[O],void this.rebuildInputCheck()}}removeByType(I){for(const O in this.attached){const C=this.attached[O];C.getClassName()===I&&(C.JQ(),C.camera=null,delete this.attached[O],this.rebuildInputCheck())}}_addCheckInputs(I){const O=this.checkInputs;return()=>{O(),I()}}attachInput(I){this.attachedToElement&&I.attachControl(this.noPreventDefault)}attachElement(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){I=!i.e.ForceAttachControlToAlwaysPreventDefault&&I,this.attachedToElement=!0,this.noPreventDefault=I;for(const O in this.attached)this.attached[O].attachControl(I)}}detachElement(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const O in this.attached)this.attached[O].JQ(),I&&(this.attached[O].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const I in this.attached){const O=this.attached[I];O.checkInputs&&(this.checkInputs=this._addCheckInputs(O.checkInputs.bind(O)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(I){const O={};for(const C in this.attached){const I=this.attached[C],j=K.e.Serialize(I);O[I.getClassName()]=j}I.inputsmgr=O}parse(I){const O=I.inputsmgr;if(O){this.clear();for(const I in O){const C=y[I];if(C){const j=O[I],i=K.e.Parse((()=>new C),j,null);this.add(i)}}}else for(const C in this.attached){const O=y[this.attached[C].getClassName()];if(O){const j=K.e.Parse((()=>new O),I,null);this.remove(this.attached[C]),this.add(j)}}}}},13793:(I,O,C)=>{"use strict";C.d(O,{e:()=>c});var j=C(12250),K=C(12257),i=C(12272),y=C(12712),S=C(13798),U=C(12532),p=C(12083);class N{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(I){I=p.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.nI(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const C=O.event;if(!C.metaKey)if(O.type===U.c.KEYDOWN){if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),I||C.preventDefault()}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){const O=this._keys.indexOf(C.keyCode);O>=0&&this._keys.splice(O,1),I||C.preventDefault()}})))}JQ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const I=this.camera;for(let O=0;O<this._keys.length;O++){const C=this._keys[O],j=I._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(C)?I._localDirection.cS(-j,0,0):-1!==this.keysUp.indexOf(C)?I._localDirection.cS(0,0,j):-1!==this.keysRight.indexOf(C)?I._localDirection.cS(j,0,0):-1!==this.keysDown.indexOf(C)?I._localDirection.cS(0,0,-j):-1!==this.keysUpward.indexOf(C)?I._localDirection.cS(0,j,0):-1!==this.keysDownward.indexOf(C)?I._localDirection.cS(0,-j,0):-1!==this.keysRotateLeft.indexOf(C)?(I._localDirection.cS(0,0,0),I.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(C)?(I._localDirection.cS(0,0,0),I.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(C)?(I._localDirection.cS(0,0,0),I.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(C)&&(I._localDirection.cS(0,0,0),I.cameraRotation.x+=this._getLocalRotation()),I.nI().useRightHandedSystem&&(I._localDirection.z*=-1),I.getViewMatrix().invertToRef(I._cameraTransformMatrix),i.mC.TransformNormalToRef(I._localDirection,I._cameraTransformMatrix,I._transformedDirection),I.cameraDirection.addInPlace(I._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const I=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*I}}(0,j.e)([(0,K.E)()],N.prototype,"keysUp",void 0),(0,j.e)([(0,K.E)()],N.prototype,"keysUpward",void 0),(0,j.e)([(0,K.E)()],N.prototype,"keysDown",void 0),(0,j.e)([(0,K.E)()],N.prototype,"keysDownward",void 0),(0,j.e)([(0,K.E)()],N.prototype,"keysLeft",void 0),(0,j.e)([(0,K.E)()],N.prototype,"keysRight",void 0),(0,j.e)([(0,K.E)()],N.prototype,"rotationSpeed",void 0),(0,j.e)([(0,K.E)()],N.prototype,"keysRotateLeft",void 0),(0,j.e)([(0,K.E)()],N.prototype,"keysRotateRight",void 0),(0,j.e)([(0,K.E)()],N.prototype,"keysRotateUp",void 0),(0,j.e)([(0,K.E)()],N.prototype,"keysRotateDown",void 0),S.d.FreeCameraKeyboardMoveInput=N;var Q=C(12088),s=C(12525);class Z{constructor(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=I,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new Q.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(I){I=p.Tools.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),C=O.getInputElement();this._pointerInput||(this._pointerInput=j=>{const K=j.event,i="touch"===K.pointerType;if(!this.touchEnabled&&i)return;if(j.type!==s.e.POINTERMOVE&&-1===this.buttons.indexOf(K.button))return;const y=K.target;if(j.type===s.e.POINTERDOWN){if(i&&-1!==this._activePointerId||!i&&-1!==this._currentActiveButton)return;this._activePointerId=K.pointerId;try{null===y||void 0===y||y.setPointerCapture(K.pointerId)}catch(S){}-1===this._currentActiveButton&&(this._currentActiveButton=K.button),this._previousPosition={x:K.clientX,y:K.clientY},I||(K.preventDefault(),C&&C.focus()),O.isPointerLock&&this._onMouseMove&&this._onMouseMove(j.event)}else if(j.type===s.e.POINTERUP){if(i&&this._activePointerId!==K.pointerId||!i&&this._currentActiveButton!==K.button)return;try{null===y||void 0===y||y.releasePointerCapture(K.pointerId)}catch(S){}this._currentActiveButton=-1,this._previousPosition=null,I||K.preventDefault(),this._activePointerId=-1}else if(j.type===s.e.POINTERMOVE&&(this._activePointerId===K.pointerId||!i))if(O.isPointerLock&&this._onMouseMove)this._onMouseMove(j.event);else if(this._previousPosition){const O=this.camera._calculateHandednessMultiplier(),C=(K.clientX-this._previousPosition.x)*O,j=K.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=C/this.angularSensibility,this.camera.cameraRotation.x+=j/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:C,offsetY:j}),this._previousPosition={x:K.clientX,y:K.clientY},I||K.preventDefault()}}),this._onMouseMove=C=>{if(!O.isPointerLock)return;const j=this.camera._calculateHandednessMultiplier(),K=C.movementX*j;this.camera.cameraRotation.y+=K/this.angularSensibility;const i=C.movementY;this.camera.cameraRotation.x+=i/this.angularSensibility,this._previousPosition=null,I||C.preventDefault()},this._observer=this.camera.nI()._inputManager._addCameraPointerObserver(this._pointerInput,s.e.POINTERDOWN|s.e.POINTERUP|s.e.POINTERMOVE),C&&(this._contextMenuBind=I=>this.onContextMenu(I),C.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(I){I.preventDefault()}JQ(){if(this._observer){if(this.camera.nI()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const I=this.camera.getEngine().getInputElement();I&&I.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,j.e)([(0,K.E)()],Z.prototype,"buttons",void 0),(0,j.e)([(0,K.E)()],Z.prototype,"angularSensibility",void 0),S.d.FreeCameraMouseInput=Z;var q,mI=C(12539);class E{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new Q.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(I){I=p.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==s.e.POINTERWHEEL)return;const C=O.event,j=C.deltaMode===mI.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*j*C.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*j*C.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*j*C.deltaZ/this._normalize,C.preventDefault&&(I||C.preventDefault())},this._observer=this.camera.nI()._inputManager._addCameraPointerObserver(this._wheel,s.e.POINTERWHEEL)}JQ(){this._observer&&(this.camera.nI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,j.e)([(0,K.E)()],E.prototype,"wheelPrecisionX",void 0),(0,j.e)([(0,K.E)()],E.prototype,"wheelPrecisionY",void 0),(0,j.e)([(0,K.E)()],E.prototype,"wheelPrecisionZ",void 0),function(I){I[I.MoveRelative=0]="MoveRelative",I[I.RotateRelative=1]="RotateRelative",I[I.MoveScene=2]="MoveScene"}(q||(q={}));class h extends E{constructor(){super(...arguments),this._moveRelative=i.mC.Zero(),this._rotateRelative=i.mC.Zero(),this._moveScene=i.mC.Zero(),this._wheelXAction=q.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=q.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(I){null===I&&this._wheelXAction!==q.MoveRelative||(this._wheelXAction=q.MoveRelative,this._wheelXActionCoordinate=I)}get wheelXMoveRelative(){return this._wheelXAction!==q.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(I){null===I&&this._wheelYAction!==q.MoveRelative||(this._wheelYAction=q.MoveRelative,this._wheelYActionCoordinate=I)}get wheelYMoveRelative(){return this._wheelYAction!==q.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(I){null===I&&this._wheelZAction!==q.MoveRelative||(this._wheelZAction=q.MoveRelative,this._wheelZActionCoordinate=I)}get wheelZMoveRelative(){return this._wheelZAction!==q.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(I){null===I&&this._wheelXAction!==q.RotateRelative||(this._wheelXAction=q.RotateRelative,this._wheelXActionCoordinate=I)}get wheelXRotateRelative(){return this._wheelXAction!==q.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(I){null===I&&this._wheelYAction!==q.RotateRelative||(this._wheelYAction=q.RotateRelative,this._wheelYActionCoordinate=I)}get wheelYRotateRelative(){return this._wheelYAction!==q.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(I){null===I&&this._wheelZAction!==q.RotateRelative||(this._wheelZAction=q.RotateRelative,this._wheelZActionCoordinate=I)}get wheelZRotateRelative(){return this._wheelZAction!==q.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(I){null===I&&this._wheelXAction!==q.MoveScene||(this._wheelXAction=q.MoveScene,this._wheelXActionCoordinate=I)}get wheelXMoveScene(){return this._wheelXAction!==q.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(I){null===I&&this._wheelYAction!==q.MoveScene||(this._wheelYAction=q.MoveScene,this._wheelYActionCoordinate=I)}get wheelYMoveScene(){return this._wheelYAction!==q.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(I){null===I&&this._wheelZAction!==q.MoveScene||(this._wheelZAction=q.MoveScene,this._wheelZActionCoordinate=I)}get wheelZMoveScene(){return this._wheelZAction!==q.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.XS(0),this._rotateRelative.XS(0),this._moveScene.XS(0),this._updateCamera(),this.camera.nI().useRightHandedSystem&&(this._moveRelative.z*=-1);const I=i.Matrix.Zero();this.camera.getViewMatrix().invertToRef(I);const O=i.mC.Zero();i.mC.TransformNormalToRef(this._moveRelative,I,O),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(O),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(I,O,C){if(0===I)return;if(null===O||null===C)return;let j=null;switch(O){case q.MoveRelative:j=this._moveRelative;break;case q.RotateRelative:j=this._rotateRelative;break;case q.MoveScene:j=this._moveScene}switch(C){case 0:j.set(I,0,0);break;case 1:j.set(0,I,0);break;case 2:j.set(0,0,I)}}}(0,j.e)([(0,K.E)()],h.prototype,"wheelXMoveRelative",null),(0,j.e)([(0,K.E)()],h.prototype,"wheelYMoveRelative",null),(0,j.e)([(0,K.E)()],h.prototype,"wheelZMoveRelative",null),(0,j.e)([(0,K.E)()],h.prototype,"wheelXRotateRelative",null),(0,j.e)([(0,K.E)()],h.prototype,"wheelYRotateRelative",null),(0,j.e)([(0,K.E)()],h.prototype,"wheelZRotateRelative",null),(0,j.e)([(0,K.E)()],h.prototype,"wheelXMoveScene",null),(0,j.e)([(0,K.E)()],h.prototype,"wheelYMoveScene",null),(0,j.e)([(0,K.E)()],h.prototype,"wheelZMoveScene",null),S.d.FreeCameraMouseWheelInput=h;class r{constructor(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=I,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=p.Tools.IsSafari()}attachControl(I){I=p.Tools.BackCompatCameraNoPreventDefault(arguments);let O=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=C=>{const j=C.event,K="mouse"===j.pointerType||this._isSafari&&"undefined"===typeof j.pointerType;if(this.allowMouse||!K)if(C.type===s.e.POINTERDOWN){if(I||j.preventDefault(),this._pointerPressed.push(j.pointerId),1!==this._pointerPressed.length)return;O={x:j.clientX,y:j.clientY}}else if(C.type===s.e.POINTERUP){I||j.preventDefault();const C=this._pointerPressed.indexOf(j.pointerId);if(-1===C)return;if(this._pointerPressed.splice(C,1),0!=C)return;O=null,this._offsetX=null,this._offsetY=null}else if(C.type===s.e.POINTERMOVE){if(I||j.preventDefault(),!O)return;if(0!=this._pointerPressed.indexOf(j.pointerId))return;this._offsetX=j.clientX-O.x,this._offsetY=-(j.clientY-O.y)}}),this._observer=this.camera.nI()._inputManager._addCameraPointerObserver(this._pointerInput,s.e.POINTERDOWN|s.e.POINTERUP|s.e.POINTERMOVE),this._onLostFocus){const I=this.camera.getEngine().getInputElement();I&&I.addEventListener("blur",this._onLostFocus)}}JQ(){if(this._pointerInput){if(this._observer&&(this.camera.nI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const I=this.camera.getEngine().getInputElement();I&&I.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const I=this.camera,O=I._calculateHandednessMultiplier();I.cameraRotation.y=O*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)I.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const O=I._computeLocalCameraSpeed(),C=new i.mC(0,0,0!==this.touchMoveSensibility?O*this._offsetY/this.touchMoveSensibility:0);i.Matrix.RotationYawPitchRollToRef(I.rotation.y,I.rotation.x,0,I._cameraRotationMatrix),I.cameraDirection.addInPlace(i.mC.TransformCoordinates(C,I._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,j.e)([(0,K.E)()],r.prototype,"touchAngularSensibility",void 0),(0,j.e)([(0,K.E)()],r.prototype,"touchMoveSensibility",void 0),S.d.FreeCameraTouchInput=r;class W extends S.g{constructor(I){super(I),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new N),this}addMouse(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new Z(I),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new h,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new r),this}clear(){super.clear(),this._mouseInput=null}}var Y=C(12226),o=C(12167);class c extends y.d{get angularSensibility(){const I=this.inputs.attached.mouse;return I?I.angularSensibility:0}set angularSensibility(I){const O=this.inputs.attached.mouse;O&&(O.angularSensibility=I)}get keysUp(){const I=this.inputs.attached.keyboard;return I?I.keysUp:[]}set keysUp(I){const O=this.inputs.attached.keyboard;O&&(O.keysUp=I)}get keysUpward(){const I=this.inputs.attached.keyboard;return I?I.keysUpward:[]}set keysUpward(I){const O=this.inputs.attached.keyboard;O&&(O.keysUpward=I)}get keysDown(){const I=this.inputs.attached.keyboard;return I?I.keysDown:[]}set keysDown(I){const O=this.inputs.attached.keyboard;O&&(O.keysDown=I)}get keysDownward(){const I=this.inputs.attached.keyboard;return I?I.keysDownward:[]}set keysDownward(I){const O=this.inputs.attached.keyboard;O&&(O.keysDownward=I)}get keysLeft(){const I=this.inputs.attached.keyboard;return I?I.keysLeft:[]}set keysLeft(I){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=I)}get keysRight(){const I=this.inputs.attached.keyboard;return I?I.keysRight:[]}set keysRight(I){const O=this.inputs.attached.keyboard;O&&(O.keysRight=I)}get keysRotateLeft(){const I=this.inputs.attached.keyboard;return I?I.keysRotateLeft:[]}set keysRotateLeft(I){const O=this.inputs.attached.keyboard;O&&(O.keysRotateLeft=I)}get keysRotateRight(){const I=this.inputs.attached.keyboard;return I?I.keysRotateRight:[]}set keysRotateRight(I){const O=this.inputs.attached.keyboard;O&&(O.keysRotateRight=I)}get keysRotateUp(){const I=this.inputs.attached.keyboard;return I?I.keysRotateUp:[]}set keysRotateUp(I){const O=this.inputs.attached.keyboard;O&&(O.keysRotateUp=I)}get keysRotateDown(){const I=this.inputs.attached.keyboard;return I?I.keysRotateDown:[]}set keysRotateDown(I){const O=this.inputs.attached.keyboard;O&&(O.keysRotateDown=I)}constructor(I,O,C){var j;super(I,O,C,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),j=this,this.ellipsoid=new i.mC(.5,1,.5),this.ellipsoidOffset=new i.mC(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=i.mC.Zero(),this._diffPosition=i.mC.Zero(),this._newPosition=i.mC.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;j._newPosition.K(O),j._newPosition.subtractToRef(j._oldPosition,j._diffPosition),j._diffPosition.length()>o.b.CollisionsEpsilon&&(j.position.addToRef(j._diffPosition,j._deferredPositionUpdate),j._deferOnly?j._deferredUpdated=!0:j.position.K(j._deferredPositionUpdate),j.mq&&C&&j.mq(C))},this.inputs=new W(this),this.inputs.addKeyboard().addMouse()}attachControl(I,O){O=p.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(O)}JQ(){this.inputs.detachElement(),this.cameraDirection=new i.mC(0,0,0),this.cameraRotation=new i.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(I){this._collisionMask=isNaN(I)?-1:I}_collideWithWorld(I){let O;O=this.parent?i.mC.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,O.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const C=this.nI().collisionCoordinator;this._collider||(this._collider=C.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let j=I;this.applyGravity&&(j=I.add(this.nI().gravity)),C.getNewPosition(this._oldPosition,j,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=i.mC.Zero(),this._transformedDirection=i.mC.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(I){this._needMoveForGravity=I}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.nI().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Pq"}}(0,j.e)([(0,K.B)()],c.prototype,"ellipsoid",void 0),(0,j.e)([(0,K.B)()],c.prototype,"ellipsoidOffset",void 0),(0,j.e)([(0,K.E)()],c.prototype,"checkCollisions",void 0),(0,j.e)([(0,K.E)()],c.prototype,"applyGravity",void 0),(0,Y.e)("BABYLON.FreeCamera",c)},14400:(I,O,C)=>{"use strict";C.d(O,{c:()=>i});var j=C(12354),K=C(14408);class i{constructor(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=C,this.FN=[],this._maxBlockCapacity=O||64,this._selectionContent=new j.d(1024),this._creationFunc=I}update(I,O,C){K.e._CreateBlocks(I,O,C,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}KN(I){for(let O=0;O<this.EN.length;O++){this.EN[O].addEntry(I)}}jN(I){for(let O=0;O<this.EN.length;O++){this.EN[O].removeEntry(I)}}select(I,O){this._selectionContent.reset();for(let C=0;C<this.EN.length;C++){this.EN[C].select(I,this._selectionContent,O)}return O?this._selectionContent.concat(this.FN):this._selectionContent.concatWithNoDuplicate(this.FN),this._selectionContent}intersects(I,O,C){this._selectionContent.reset();for(let j=0;j<this.EN.length;j++){this.EN[j].intersects(I,O,this._selectionContent,C)}return C?this._selectionContent.concat(this.FN):this._selectionContent.concatWithNoDuplicate(this.FN),this._selectionContent}intersectsRay(I){this._selectionContent.reset();for(let O=0;O<this.EN.length;O++){this.EN[O].intersectsRay(I,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.FN),this._selectionContent}}i.CreationFuncForMeshes=(I,O)=>{const C=I.getBoundingInfo();!I.isBlocked&&C.boundingBox.intersectsMinMax(O.CQ,O.jQ)&&O.entries.push(I)},i.CreationFuncForSubMeshes=(I,O)=>{I.getBoundingInfo().boundingBox.intersectsMinMax(O.CQ,O.jQ)&&O.entries.push(I)}},14408:(I,O,C)=>{"use strict";C.d(O,{e:()=>i});var j=C(12272),K=C(12582);class i{constructor(I,O,C,j,K,i){this.entries=[],this.KQ=new Array,this._capacity=C,this._depth=j,this._maxDepth=K,this._creationFunc=i,this._minPoint=I,this._maxPoint=O,this.KQ.push(I.clone()),this.KQ.push(O.clone()),this.KQ.push(I.clone()),this.KQ[2].x=O.x,this.KQ.push(I.clone()),this.KQ[3].y=O.y,this.KQ.push(I.clone()),this.KQ[4].z=O.z,this.KQ.push(O.clone()),this.KQ[5].z=I.z,this.KQ.push(O.clone()),this.KQ[6].x=I.x,this.KQ.push(O.clone()),this.KQ[7].y=I.y}get tO(){return this._capacity}get CQ(){return this._minPoint}get jQ(){return this._maxPoint}addEntry(I){if(this.EN)for(let O=0;O<this.EN.length;O++){this.EN[O].addEntry(I)}else this._creationFunc(I,this),this.entries.length>this.tO&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(I){if(this.EN){for(let O=0;O<this.EN.length;O++){this.EN[O].removeEntry(I)}return}const O=this.entries.indexOf(I);O>-1&&this.entries.splice(O,1)}addEntries(I){for(let O=0;O<I.length;O++){const C=I[O];this.addEntry(C)}}select(I,O,C){if(K.e.IsInFrustum(this.KQ,I)){if(this.EN){for(let j=0;j<this.EN.length;j++){this.EN[j].select(I,O,C)}return}C?O.concat(this.entries):O.concatWithNoDuplicate(this.entries)}}intersects(I,O,C,j){if(K.e.IntersectsSphere(this._minPoint,this._maxPoint,I,O)){if(this.EN){for(let K=0;K<this.EN.length;K++){this.EN[K].intersects(I,O,C,j)}return}j?C.concat(this.entries):C.concatWithNoDuplicate(this.entries)}}intersectsRay(I,O){if(I.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.EN){for(let C=0;C<this.EN.length;C++){this.EN[C].intersectsRay(I,O)}return}O.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){i._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(I,O,C,K,y,S,U,p){U.EN=new Array;const N=new j.mC((O.x-I.x)/2,(O.y-I.y)/2,(O.z-I.z)/2);for(let j=0;j<2;j++)for(let O=0;O<2;O++)for(let Q=0;Q<2;Q++){const s=I.add(N.multiplyByFloats(j,O,Q)),Z=I.add(N.multiplyByFloats(j+1,O+1,Q+1)),q=new i(s,Z,K,y+1,S,p);q.addEntries(C),U.EN.push(q)}}}},14417:(I,O,C)=>{"use strict";C.d(O,{c:()=>N});var j=C(12487),K=C(12272),i=C(12660),y=C(13544),S=C(12523),U=C(14400),p=C(12132);j.b.prototype.createOrUpdateSelectionOctree=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,C=this._getComponent(S.d.NAME_OCTREE);C||(C=new N(this),this.o(C)),this.vN||(this.vN=new U.c(U.c.CreationFuncForMeshes,I,O));const j=this.getWorldExtends();return this.vN.update(j.min,j.max,this.meshes),this.vN},Object.defineProperty(j.b.prototype,"selectionOctree",{get:function(){return this.vN},enumerable:!0,configurable:!0}),i.e.prototype.createOrUpdateSubmeshesOctree=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const C=this.nI();let j=C._getComponent(S.d.NAME_OCTREE);j||(j=new N(C),C.o(j)),this._submeshesOctree||(this._submeshesOctree=new U.c(U.c.CreationFuncForSubMeshes,I,O)),this.rS(!0);const K=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(K.minimumWorld,K.maximumWorld,this.ZS),this._submeshesOctree};class N{constructor(I){this.name=S.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new y.e(K.mC.Zero(),new K.mC(1,1,1)),(I=I||p.e.LastCreatedScene)&&(this.hO=I,this.hO.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.hO.getActiveSubMeshCandidates=I=>this.getActiveSubMeshCandidates(I),this.hO.getCollidingSubMeshCandidates=(I,O)=>this.getCollidingSubMeshCandidates(I,O),this.hO.getIntersectingSubMeshCandidates=(I,O)=>this.getIntersectingSubMeshCandidates(I,O))}register(){this.hO.onMeshRemovedObservable.add((I=>{const O=this.hO.selectionOctree;if(void 0!==O&&null!==O){const C=O.FN.indexOf(I);-1!==C&&O.FN.splice(C,1)}})),this.hO.onMeshImportedObservable.add((I=>{const O=this.hO.selectionOctree;void 0!==O&&null!==O&&O.KN(I)}))}getActiveMeshCandidates(){var I;return(null===(I=this.hO.vN)||void 0===I?void 0:I.select(this.hO.frustumPlanes))||this.hO._getDefaultMeshCandidates()}getActiveSubMeshCandidates(I){if(I._submeshesOctree&&I.useOctreeForRenderingSelection){return I._submeshesOctree.select(this.hO.frustumPlanes)}return this.hO._getDefaultSubMeshCandidates(I)}getIntersectingSubMeshCandidates(I,O){if(I._submeshesOctree&&I.useOctreeForPicking){y.e.TransformToRef(O,I.getWorldMatrix(),this._tempRay);return I._submeshesOctree.intersectsRay(this._tempRay)}return this.hO._getDefaultSubMeshCandidates(I)}getCollidingSubMeshCandidates(I,O){if(I._submeshesOctree&&I.useOctreeForCollisions){const C=O._velocityWorldLength+Math.max(O._radius.x,O._radius.y,O._radius.z);return I._submeshesOctree.intersects(O._basePointWorld,C)}return this.hO._getDefaultSubMeshCandidates(I)}rebuild(){}dispose(){}}},13544:(I,O,C)=>{"use strict";C.d(O,{e:()=>Z});var j=C(12487),K=C(12677),i=C(12274),y=C(12272),S=C(12276),U=C(12577),p=C(12517),N=C(12132),Q=C(12544);const s={internalPickerForMesh:void 0};class Z{constructor(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.d;this.origin=I,this.direction=O,this.length=C,this.epsilon=j}clone(){return new Z(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const j=Z._TmpVector3[0].cS(I.x-C,I.y-C,I.z-C),K=Z._TmpVector3[1].cS(O.x+C,O.y+C,O.z+C);let i,y,S,U,p=0,N=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<j.x||this.origin.x>K.x)return!1}else if(i=1/this.direction.x,y=(j.x-this.origin.x)*i,S=(K.x-this.origin.x)*i,S===-1/0&&(S=1/0),y>S&&(U=y,y=S,S=U),p=Math.max(y,p),N=Math.min(S,N),p>N)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<j.y||this.origin.y>K.y)return!1}else if(i=1/this.direction.y,y=(j.y-this.origin.y)*i,S=(K.y-this.origin.y)*i,S===-1/0&&(S=1/0),y>S&&(U=y,y=S,S=U),p=Math.max(y,p),N=Math.min(S,N),p>N)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<j.z||this.origin.z>K.z)return!1}else if(i=1/this.direction.z,y=(j.z-this.origin.z)*i,S=(K.z-this.origin.z)*i,S===-1/0&&(S=1/0),y>S&&(U=y,y=S,S=U),p=Math.max(y,p),N=Math.min(S,N),p>N)return!1;return!0}intersectsBox(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(I.minimum,I.maximum,O)}intersectsSphere(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=I.center.x-this.origin.x,j=I.center.y-this.origin.y,K=I.center.z-this.origin.z,i=C*C+j*j+K*K,y=I.radius+O,S=y*y;if(i<=S)return!0;const U=C*this.direction.x+j*this.direction.y+K*this.direction.z;if(U<0)return!1;return i-U*U<=S}intersectsTriangle(I,O,C){const j=Z._TmpVector3[0],K=Z._TmpVector3[1],i=Z._TmpVector3[2],S=Z._TmpVector3[3],p=Z._TmpVector3[4];O.subtractToRef(I,j),C.subtractToRef(I,K),y.mC.CrossToRef(this.direction,K,i);const N=y.mC.Dot(j,i);if(0===N)return null;const Q=1/N;this.origin.subtractToRef(I,S);const s=y.mC.Dot(S,i)*Q;if(s<-this.epsilon||s>1+this.epsilon)return null;y.mC.CrossToRef(S,j,p);const q=y.mC.Dot(this.direction,p)*Q;if(q<-this.epsilon||s+q>1+this.epsilon)return null;const mI=y.mC.Dot(K,p)*Q;return mI>this.length?null:new U.e(1-s-q,s,mI)}intersectsPlane(I){let O;const C=y.mC.Dot(I.normal,this.direction);if(Math.abs(C)<9.99999997475243e-7)return null;{const j=y.mC.Dot(I.normal,this.origin);return O=(-I.d-j)/C,O<0?O<-9.99999997475243e-7?null:0:O}}intersectsAxis(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(I){case"y":{const I=(this.origin.y-O)/this.direction.y;return I>0?null:new y.mC(this.origin.x+this.direction.x*-I,O,this.origin.z+this.direction.z*-I)}case"x":{const I=(this.origin.x-O)/this.direction.x;return I>0?null:new y.mC(O,this.origin.y+this.direction.y*-I,this.origin.z+this.direction.z*-I)}case"z":{const I=(this.origin.z-O)/this.direction.z;return I>0?null:new y.mC(this.origin.x+this.direction.x*-I,this.origin.y+this.direction.y*-I,O)}default:return null}}intersectsMesh(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=y.TmpVectors.Matrix[0];return I.getWorldMatrix().invertToRef(S),this._tmpRay?Z.TransformToRef(this,S,this._tmpRay):this._tmpRay=Z.Transform(this,S),I.intersects(this._tmpRay,O,C,j,K,i)}intersectsMeshes(I,O,C){C?C.length=0:C=[];for(let j=0;j<I.length;j++){const K=this.intersectsMesh(I[j],O);K.hit&&C.push(K)}return C.sort(this._comparePickingInfo),C}_comparePickingInfo(I,O){return I.distance<O.distance?-1:I.distance>O.distance?1:0}intersectionSegment(I,O,C){const j=this.origin,K=y.TmpVectors.mC[0],i=y.TmpVectors.mC[1],S=y.TmpVectors.mC[2],U=y.TmpVectors.mC[3];O.subtractToRef(I,K),this.direction.scaleToRef(Z._Rayl,S),j.addToRef(S,i),I.subtractToRef(j,U);const p=y.mC.Dot(K,K),N=y.mC.Dot(K,S),Q=y.mC.Dot(S,S),s=y.mC.Dot(K,U),q=y.mC.Dot(S,U),mI=p*Q-N*N;let E,h,r=mI,W=mI;mI<Z._Smallnum?(E=0,r=1,h=q,W=Q):(E=N*q-Q*s,h=p*q-N*s,E<0?(E=0,h=q,W=Q):E>r&&(E=r,h=q+N,W=Q)),h<0?(h=0,-s<0?E=0:-s>p?E=r:(E=-s,r=p)):h>W&&(h=W,-s+N<0?E=0:-s+N>p?E=r:(E=-s+N,r=p));const Y=Math.abs(E)<Z._Smallnum?0:E/r,o=Math.abs(h)<Z._Smallnum?0:h/W,c=y.TmpVectors.mC[4];S.scaleToRef(o,c);const n=y.TmpVectors.mC[5];K.scaleToRef(Y,n),n.addInPlace(U);const X=y.TmpVectors.mC[6];n.subtractToRef(c,X);return o>0&&o<=this.length&&X.lengthSquared()<C*C?n.length():-1}update(I,O,C,j,K,i,S){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){Z._RayDistant||(Z._RayDistant=Z.Zero()),Z._RayDistant.unprojectRayToRef(I,O,C,j,y.Matrix.IdentityReadOnly,i,S);const U=y.TmpVectors.Matrix[0];K.invertToRef(U),Z.TransformToRef(Z._RayDistant,U,this)}else this.unprojectRayToRef(I,O,C,j,K,i,S);return this}static Zero(){return new Z(y.mC.Zero(),y.mC.Zero())}static CreateNew(I,O,C,j,K,i,y){return Z.Zero().update(I,O,C,j,K,i,y)}static CreateNewFromTo(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.Matrix.IdentityReadOnly;const j=new Z(new y.mC(0,0,0),new y.mC(0,0,0));return Z.CreateFromToToRef(I,O,j,C)}static CreateFromToToRef(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.Matrix.IdentityReadOnly;C.origin.K(I);const K=O.subtractToRef(I,C.direction),i=Math.sqrt(K.x*K.x+K.y*K.y+K.z*K.z);return C.length=i,C.direction.normalize(),Z.TransformToRef(C,j,C)}static Transform(I,O){const C=new Z(new y.mC(0,0,0),new y.mC(0,0,0));return Z.TransformToRef(I,O,C),C}static TransformToRef(I,O,C){y.mC.TransformCoordinatesToRef(I.origin,O,C.origin),y.mC.TransformNormalToRef(I.direction,O,C.direction),C.length=I.length,C.epsilon=I.epsilon;const j=C.direction,K=j.length();if(0!==K&&1!==K){const I=1/K;j.x*=I,j.y*=I,j.z*=I,C.length*=K}return C}unprojectRayToRef(I,O,C,j,K,i,S){const U=y.TmpVectors.Matrix[0];K.multiplyToRef(i,U),U.multiplyToRef(S,U),U.invert();const p=N.e.LastCreatedEngine,Q=y.TmpVectors.mC[0];Q.x=I/C*2-1,Q.y=-(O/j*2-1),Q.z=null!==p&&void 0!==p&&p.jS?1:null!==p&&void 0!==p&&p.isNDCHalfZRange?0:-1;const s=y.TmpVectors.mC[1].cS(Q.x,Q.y,1-1e-8),Z=y.TmpVectors.mC[2],q=y.TmpVectors.mC[3];y.mC._UnprojectFromInvertedMatrixToRef(Q,U,Z),y.mC._UnprojectFromInvertedMatrixToRef(s,U,q),this.origin.K(Z),q.subtractToRef(Z,this.direction),this.direction.normalize()}}function q(I,O,C,j,K){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const y=Z.Zero();return mI(I,O,C,j,y,K,i),y}function mI(I,O,C,j,K,i){let S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const p=I.getEngine();if(!i&&!(i=I.activeCamera))return I;const N=i.viewport,Q=p.getRenderHeight(),{x:s,y:Z,width:q,height:mI}=N.toGlobal(p.getRenderWidth(),Q),E=1/p.getHardwareScalingLevel();return O=O*E-s,C=C*E-(Q-Z-mI),K.update(O,C,q,mI,j||y.Matrix.IdentityReadOnly,S?y.Matrix.IdentityReadOnly:i.getViewMatrix(),i.getProjectionMatrix(),U),I}function E(I,O,C,j,K){if(!p.e)return I;const i=I.getEngine();if(!K&&!(K=I.activeCamera))throw new Error("Active camera not set");const S=K.viewport,U=i.getRenderHeight(),{x:N,y:Q,width:s,height:Z}=S.toGlobal(i.getRenderWidth(),U),q=y.Matrix.Identity(),mI=1/i.getHardwareScalingLevel();return O=O*mI-N,C=C*mI-(U-Q-Z),j.update(O,C,s,Z,q,q,K.getProjectionMatrix()),I}function h(I,O,C,j,K,i,y,S){const U=O(j,C.enableDistantPicking),p=C.intersects(U,K,y,i,j,S);return p&&p.hit?!K&&null!=I&&p.distance>=I.distance?null:p:null}function r(I,O,C,j,K,i){let S=null;const U=!!(I.activeCameras&&I.activeCameras.length>1&&I.cameraToUseForPointers!==I.activeCamera),N=I.cameraToUseForPointers||I.activeCamera,Q=s.internalPickerForMesh||h;for(let p=0;p<I.meshes.length;p++){const s=I.meshes[p];if(C){if(!C(s,-1))continue}else if(!s.isEnabled()||!s.isVisible||!s.gU)continue;const Z=U&&s.isWorldMatrixCameraDependent(),q=s.rS(Z,N);if(s.hasThinInstances&&s.Yp){const I=Q(S,O,s,q,!0,!0,i);if(I){if(K)return I;const U=y.TmpVectors.Matrix[1],p=s.thinInstanceGetWorldMatrices();for(let I=0;I<p.length;I++){if(C&&!C(s,I))continue;p[I].multiplyToRef(q,U);const y=Q(S,O,s,U,j,K,i,!0);if(y&&(S=y,S.thinInstanceIndex=I,j))return S}}}else{const I=Q(S,O,s,q,j,K,i);if(I&&(S=I,j))return S}}return S||new p.e}function W(I,O,C,j){if(!p.e)return null;const K=[],i=!!(I.activeCameras&&I.activeCameras.length>1&&I.cameraToUseForPointers!==I.activeCamera),S=I.cameraToUseForPointers||I.activeCamera,U=s.internalPickerForMesh||h;for(let p=0;p<I.meshes.length;p++){const N=I.meshes[p];if(C){if(!C(N,-1))continue}else if(!N.isEnabled()||!N.isVisible||!N.gU)continue;const Q=i&&N.isWorldMatrixCameraDependent(),s=N.rS(Q,S);if(N.hasThinInstances&&N.Yp){if(U(null,O,N,s,!0,!0,j)){const I=y.TmpVectors.Matrix[1],i=N.thinInstanceGetWorldMatrices();for(let y=0;y<i.length;y++){if(C&&!C(N,y))continue;i[y].multiplyToRef(s,I);const S=U(null,O,N,I,!1,!1,j,!0);S&&(S.thinInstanceIndex=y,K.push(S))}}}else{const I=U(null,O,N,s,!1,!1,j);I&&K.push(I)}}return K}function Y(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,j=arguments.length>3?arguments[3]:void 0,K=arguments.length>4?arguments[4]:void 0;j||(j=I.getWorldMatrix()),O.length=C,K?O.origin.K(K):O.origin.K(I.position);const i=y.TmpVectors.mC[2];i.set(0,0,I._scene.useRightHandedSystem?-1:1);const S=y.TmpVectors.mC[3];return y.mC.TransformNormalToRef(i,j,S),y.mC.NormalizeToRef(S,O.direction),O}var o,c;Z._TmpVector3=(0,S.e)(6,y.mC.Zero),Z._RayDistant=Z.Zero(),Z._Smallnum=1e-8,Z._Rayl=1e9,o=j.b,(c=K.e)&&(c.prototype.getForwardRay=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,O=arguments.length>1?arguments[1]:void 0,C=arguments.length>2?arguments[2]:void 0;return Y(this,new Z(y.mC.Zero(),y.mC.Zero(),I),I,O,C)},c.prototype.getForwardRayToRef=function(I){return Y(this,I,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),o&&(Q.b._IsPickingAvailable=!0,o.prototype.createPickingRay=function(I,O,C,j){return q(this,I,O,C,j,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),j.b.prototype.createPickingRayToRef=function(I,O,C,j,K){return mI(this,I,O,C,j,K,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},j.b.prototype.createPickingRayInCameraSpace=function(I,O,C){return function(I,O,C,j){const K=Z.Zero();return E(I,O,C,K,j),K}(this,I,O,C)},j.b.prototype.createPickingRayInCameraSpaceToRef=function(I,O,C,j){return E(this,I,O,C,j)},j.b.prototype.pickWithBoundingInfo=function(I,O,C,j,K){return function(I,O,C,j,K,i){if(!p.e)return null;const S=r(I,(j=>(I._tempPickingRay||(I._tempPickingRay=Z.Zero()),mI(I,O,C,j,I._tempPickingRay,i||null),I._tempPickingRay)),j,K,!0);return S&&(S.ray=q(I,O,C,y.Matrix.Identity(),i||null)),S}(this,I,O,C,j,K)},j.b.prototype.ZC=function(I,O,C,j,K,i){return function(I,O,C,j,K,i,S){const U=r(I,((j,K)=>(I._tempPickingRay||(I._tempPickingRay=Z.Zero()),mI(I,O,C,j,I._tempPickingRay,i||null,!1,K),I._tempPickingRay)),j,K,!1,S);return U&&(U.ray=q(I,O,C,y.Matrix.Identity(),i||null)),U}(this,I,O,C,j,K,i)},j.b.prototype.pickWithRay=function(I,O,C,j){return function(I,O,C,j,K){const i=r(I,(C=>(I._pickWithRayInverseMatrix||(I._pickWithRayInverseMatrix=y.Matrix.Identity()),C.invertToRef(I._pickWithRayInverseMatrix),I._cachedRayForTransform||(I._cachedRayForTransform=Z.Zero()),Z.TransformToRef(O,I._pickWithRayInverseMatrix,I._cachedRayForTransform),I._cachedRayForTransform)),C,j,!1,K);return i&&(i.ray=O),i}(this,I,O,C,j)},j.b.prototype.multiPick=function(I,O,C,j,K){return function(I,O,C,j,K,i){return W(I,(j=>q(I,O,C,j,K||null)),j,i)}(this,I,O,C,j,K)},j.b.prototype.multiPickWithRay=function(I,O,C){return function(I,O,C,j){return W(I,(C=>(I._pickWithRayInverseMatrix||(I._pickWithRayInverseMatrix=y.Matrix.Identity()),C.invertToRef(I._pickWithRayInverseMatrix),I._cachedRayForTransform||(I._cachedRayForTransform=Z.Zero()),Z.TransformToRef(O,I._pickWithRayInverseMatrix,I._cachedRayForTransform),I._cachedRayForTransform)),C,j)}(this,I,O,C)}},13841:(I,O,C)=>{"use strict";var j=C(12201),K=C(12103),i=C(12139),y=C(12234),S=C(12167),U=C(12213);S.b.prototype._partialLoadFile=function(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(I,(I=>{C[O]=I,C._internalCount++,6===C._internalCount&&j(C)}),void 0,void 0,!0,((I,O)=>{K&&I&&K(I.status+" "+I.statusText,O)}))},S.b.prototype._cascadeLoadFiles=function(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const K=[];K._internalCount=0;for(let i=0;i<6;i++)this._partialLoadFile(C[i],i,K,O,j)},S.b.prototype._cascadeLoadImgs=function(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5?arguments[5]:void 0;const y=[];y._internalCount=0;for(let S=0;S<6;S++)this._partialLoadImg(j[S],S,y,I,O,C,K,i)},S.b.prototype._partialLoadImg=function(I,O,C,j,K,S){let U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7?arguments[7]:void 0;const N=(0,y.c)();(0,i.t)(I,(I=>{C[O]=I,C._internalCount++,j&&j.removePendingData(N),6===C._internalCount&&S&&S(K,C)}),((I,O)=>{j&&j.removePendingData(N),U&&U(I,O)}),j?j.offlineProvider:null,p),j&&j.addPendingData(N)},S.b.prototype.createCubeTextureBase=function(I,O,C,i){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6?arguments[6]:void 0,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,mI=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,E=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,h=arguments.length>14&&void 0!==arguments[14]&&arguments[14],r=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const W=q||new j.c(this,7);W.isCube=!0,W.url=I,W.generateMipMaps=!i,W._lodGenerationScale=s,W._lodGenerationOffset=Z,W._useSRGBBuffer=!!h&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!i),W!==q&&(W.label=I.substring(0,60)),this._doNotHandleContextLost||(W._extension=N,W._files=C,W._buffer=r);const Y=I;this._transformTextureUrl&&!q&&(I=this._transformTextureUrl(I));const o=N??function(I){const O=I.split("?")[0],C=O.lastIndexOf(".");return C>-1?O.substring(C).toLowerCase():""}(I),c=(0,U.c)(o),n=(I,O)=>{W.dispose(),S?S(I,O):I&&K.c.Warn(I)},X=(j,S)=>{I===Y?j&&n(j.status+" "+j.statusText,S):(K.c.Warn(`Failed to load ${I}, falling back to the ${Y}`),this.createCubeTextureBase(Y,O,C,!!i,y,n,p,N,Q,s,Z,W,mI,E,h,r))};if(c)c.then((j=>{const K=I=>{mI&&mI(W,I),j.loadCubeData(I,W,Q,y,((I,O)=>{n(I,O)}))};r?K(r):C&&6===C.length?j.supportCascades?this._cascadeLoadFiles(O,(I=>K(I.map((I=>new Uint8Array(I))))),C,n):n("Textures type does not support cascades."):this._loadFile(I,(I=>K(new Uint8Array(I))),void 0,void 0,!0,X)}));else{if(!C||0===C.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(O,W,((I,O)=>{E&&E(I,O)}),C,n)}return this._internalTexturesCache.push(W),W}},14421:(I,O,C)=>{"use strict";C(12103);var j=C(12396);C(12201),C(12333),C(12197),C(12443),C(12407);j.c},13878:(I,O,C)=>{"use strict";C.d(O,{e:()=>K});var j=C(12226);class K{constructor(I){this.value=this._toInt(I)}_toInt(I){return 0|I}add(I){return new K(this.value+I.value)}EO(I){return new K(this.value-I.value)}multiply(I){return new K(Math.imul(this.value,I.value))}divide(I){return new K(this.value/I.value)}getClassName(){return K.ClassName}equals(I){return this.value===I.value}static FromValue(I){return new K(I)}toString(){return this.value.toString()}}K.ClassName="FlowGraphInteger",(0,j.e)("FlowGraphInteger",K)},13888:(I,O,C)=>{"use strict";C.d(O,{d:()=>K,f:()=>i});var j=C(12272);class K{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.US=I}get m(){return this.US}transformVector(I){return this.transformVectorToRef(I,new j.Vector2)}transformVectorToRef(I,O){return O.x=I.x*this.US[0]+I.y*this.US[1],O.y=I.x*this.US[2]+I.y*this.US[3],O}qS(){return this.toArray()}toArray(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let O=0;O<4;O++)I[O]=this.US[O];return I}qC(I){for(let O=0;O<4;O++)this.US[O]=I[O];return this}multiplyToRef(I,O){const C=I.US,j=this.US,K=O.US;return K[0]=C[0]*j[0]+C[1]*j[2],K[1]=C[0]*j[1]+C[1]*j[3],K[2]=C[2]*j[0]+C[3]*j[2],K[3]=C[2]*j[1]+C[3]*j[3],O}multiply(I){return this.multiplyToRef(I,new K)}divideToRef(I,O){const C=this.US,j=I.US,K=O.US;return K[0]=C[0]/j[0],K[1]=C[1]/j[1],K[2]=C[2]/j[2],K[3]=C[3]/j[3],O}divide(I){return this.divideToRef(I,new K)}addToRef(I,O){const C=this.US,j=I.m,K=O.m;return K[0]=C[0]+j[0],K[1]=C[1]+j[1],K[2]=C[2]+j[2],K[3]=C[3]+j[3],O}add(I){return this.addToRef(I,new K)}subtractToRef(I,O){const C=this.US,j=I.m,K=O.m;return K[0]=C[0]-j[0],K[1]=C[1]-j[1],K[2]=C[2]-j[2],K[3]=C[3]-j[3],O}EO(I){return this.subtractToRef(I,new K)}transpose(){const I=this.US;return new K([I[0],I[2],I[1],I[3]])}determinant(){const I=this.US;return I[0]*I[3]-I[1]*I[2]}inverse(){const I=this.determinant();if(0===I)throw new Error("Matrix is not invertible");const O=this.US,C=1/I;return new K([O[3]*C,-O[1]*C,-O[2]*C,O[0]*C])}equals(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.US,j=I.m;return 0===O?C[0]===j[0]&&C[1]===j[1]&&C[2]===j[2]&&C[3]===j[3]:Math.abs(C[0]-j[0])<O&&Math.abs(C[1]-j[1])<O&&Math.abs(C[2]-j[2])<O&&Math.abs(C[3]-j[3])<O}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.US.join(", ")})`}}class i{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.US=I}get m(){return this.US}transformVector(I){return this.transformVectorToRef(I,new j.mC)}transformVectorToRef(I,O){const C=this.US;return O.x=I.x*C[0]+I.y*C[1]+I.z*C[2],O.y=I.x*C[3]+I.y*C[4]+I.z*C[5],O.z=I.x*C[6]+I.y*C[7]+I.z*C[8],O}multiplyToRef(I,O){const C=I.US,j=this.US,K=O.m;return K[0]=C[0]*j[0]+C[1]*j[3]+C[2]*j[6],K[1]=C[0]*j[1]+C[1]*j[4]+C[2]*j[7],K[2]=C[0]*j[2]+C[1]*j[5]+C[2]*j[8],K[3]=C[3]*j[0]+C[4]*j[3]+C[5]*j[6],K[4]=C[3]*j[1]+C[4]*j[4]+C[5]*j[7],K[5]=C[3]*j[2]+C[4]*j[5]+C[5]*j[8],K[6]=C[6]*j[0]+C[7]*j[3]+C[8]*j[6],K[7]=C[6]*j[1]+C[7]*j[4]+C[8]*j[7],K[8]=C[6]*j[2]+C[7]*j[5]+C[8]*j[8],O}multiply(I){return this.multiplyToRef(I,new i)}divideToRef(I,O){const C=this.US,j=I.m,K=O.m;return K[0]=C[0]/j[0],K[1]=C[1]/j[1],K[2]=C[2]/j[2],K[3]=C[3]/j[3],K[4]=C[4]/j[4],K[5]=C[5]/j[5],K[6]=C[6]/j[6],K[7]=C[7]/j[7],K[8]=C[8]/j[8],O}divide(I){return this.divideToRef(I,new i)}addToRef(I,O){const C=this.US,j=I.m,K=O.m;return K[0]=C[0]+j[0],K[1]=C[1]+j[1],K[2]=C[2]+j[2],K[3]=C[3]+j[3],K[4]=C[4]+j[4],K[5]=C[5]+j[5],K[6]=C[6]+j[6],K[7]=C[7]+j[7],K[8]=C[8]+j[8],O}add(I){return this.addToRef(I,new i)}subtractToRef(I,O){const C=this.US,j=I.m,K=O.m;return K[0]=C[0]-j[0],K[1]=C[1]-j[1],K[2]=C[2]-j[2],K[3]=C[3]-j[3],K[4]=C[4]-j[4],K[5]=C[5]-j[5],K[6]=C[6]-j[6],K[7]=C[7]-j[7],K[8]=C[8]-j[8],O}EO(I){return this.subtractToRef(I,new i)}toArray(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let O=0;O<9;O++)I[O]=this.US[O];return I}qS(){return this.toArray()}qC(I){for(let O=0;O<9;O++)this.US[O]=I[O];return this}transpose(){const I=this.US;return new i([I[0],I[3],I[6],I[1],I[4],I[7],I[2],I[5],I[8]])}determinant(){const I=this.US;return I[0]*(I[4]*I[8]-I[5]*I[7])-I[1]*(I[3]*I[8]-I[5]*I[6])+I[2]*(I[3]*I[7]-I[4]*I[6])}inverse(){const I=this.determinant();if(0===I)throw new Error("Matrix is not invertible");const O=this.US,C=1/I;return new i([(O[4]*O[8]-O[5]*O[7])*C,(O[2]*O[7]-O[1]*O[8])*C,(O[1]*O[5]-O[2]*O[4])*C,(O[5]*O[6]-O[3]*O[8])*C,(O[0]*O[8]-O[2]*O[6])*C,(O[2]*O[3]-O[0]*O[5])*C,(O[3]*O[7]-O[4]*O[6])*C,(O[1]*O[6]-O[0]*O[7])*C,(O[0]*O[4]-O[1]*O[3])*C])}equals(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.US,j=I.m;return 0===O?C[0]===j[0]&&C[1]===j[1]&&C[2]===j[2]&&C[3]===j[3]&&C[4]===j[4]&&C[5]===j[5]&&C[6]===j[6]&&C[7]===j[7]&&C[8]===j[8]:Math.abs(C[0]-j[0])<O&&Math.abs(C[1]-j[1])<O&&Math.abs(C[2]-j[2])<O&&Math.abs(C[3]-j[3])<O&&Math.abs(C[4]-j[4])<O&&Math.abs(C[5]-j[5])<O&&Math.abs(C[6]-j[6])<O&&Math.abs(C[7]-j[7])<O&&Math.abs(C[8]-j[8])<O}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.US.join(", ")})`}}},13896:(I,O,C)=>{"use strict";var j;function K(I,O,C,j){switch(O){case"Animation":return j?I.animations.find((I=>I.uniqueId===C))??null:I.animations[C]??null;case"AnimationGroup":return j?I.animationGroups.find((I=>I.uniqueId===C))??null:I.animationGroups[C]??null;case"Mesh":return j?I.meshes.find((I=>I.uniqueId===C))??null:I.meshes[C]??null;case"Material":return j?I.materials.find((I=>I.uniqueId===C))??null:I.materials[C]??null;case"sN":return j?I.cameras.find((I=>I.uniqueId===C))??null:I.cameras[C]??null;case"Light":return j?I.lights.find((I=>I.uniqueId===C))??null:I.lights[C]??null;default:return null}}C.d(O,{d:()=>K}),function(I){I.Animation="Animation",I.AnimationGroup="AnimationGroup",I.Mesh="Mesh",I.Material="Material",I.sN="sN",I.Light="Light"}(j||(j={}))},13938:(I,O,C)=>{"use strict";C.d(O,{b:()=>K});var j=C(13944);class K extends j.e{constructor(I,O){if(super(I),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),O)for(const C of O)this._eventsSignalOutputs[C]=this._registerSignalOutput(C+"Event")}_executeOnTick(I){}_startPendingTasks(I){I._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(I),this._resetAfterCanceled(I)),this._preparePendingTasks(I),I._addPendingBlock(this),this.out._activateSignal(I),I._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(I){I._deleteExecutionVariable(this,"_initialized"),I._removePendingBlock(this)}}},13906:(I,O,C)=>{"use strict";C.d(O,{d:()=>p});var j=C(12234),K=C(12226),i=C(13915),y=C(12088),S=C(13869);class U extends i.c{constructor(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:j.defaultValue,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(I,O,C),this.richType=j,this._defaultValue=K,this._optional=i,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new y.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(I){this._isDisabled!==I&&(this._isDisabled=I,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(I,O){O._getConnectionValue(this)!==I&&(O._setConnectionValue(this,I),this.onValueChangedObservable.notifyObservers(I))}resetToDefaultValue(I){I._setConnectionValue(this,this._defaultValue)}connectTo(I){this._isDisabled||super.connectTo(I)}_getValueOrDefault(I){const O=I._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(O):O}getValue(I){if(1===this.connectionType){I._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(I);const O=this._getValueOrDefault(I);return this._lastValue=O,this.richType.typeTransformer?this.richType.typeTransformer(O):O}const O=this.isConnected()?this._connectedPoint[0].getValue(I):this._getValueOrDefault(I);return this._lastValue=O,this.richType.typeTransformer?this.richType.typeTransformer(O):O}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(I),I.richType={},this.richType.serialize(I.richType),I.optional=this._optional,(0,S.g)("defaultValue",this._defaultValue,I)}}(0,K.e)("FlowGraphDataConnection",U);class p{constructor(I){var O;this.config=I,this.uniqueId=(0,j.c)(),this.name=(null===(O=this.config)||void 0===O?void 0:O.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(I){}registerDataInput(I,O,C){const j=new U(I,0,this,O,C);return this.dataInputs.push(j),j}registerDataOutput(I,O,C){const j=new U(I,1,this,O,C);return this.dataOutputs.push(j),j}getDataInput(I){return this.dataInputs.find((O=>O.name===I))}getDataOutput(I){return this.dataOutputs.find((O=>O.name===I))}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.g;if(I.uniqueId=this.uniqueId,I.config={},this.config){const C=this.config,j=Object.keys(C);for(const K of j)O(K,C[K],I.config)}I.dataInputs=[],I.dataOutputs=[],I.className=this.getClassName();for(const C of this.dataInputs){const O={};C.serialize(O),I.dataInputs.push(O)}for(const C of this.dataOutputs){const O={};C.serialize(O),I.dataOutputs.push(O)}}deserialize(I){}_log(I,O,C){var j;null===(j=I.logger)||void 0===j||j.addLogItem({action:O,mj:C,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13915:(I,O,C)=>{"use strict";C.d(O,{c:()=>i});var j,K=C(12234);!function(I){I[I.Input=0]="Input",I[I.Output=1]="Output"}(j||(j={}));class i{constructor(I,O,C){this._ownerBlock=C,this._connectedPoint=[],this.uniqueId=(0,K.c)(),this.connectedPointIds=[],this.name=I,this._connectionType=O}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(I){if(this._connectionType===I._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||I._isSingularConnection()&&I._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(I),I._connectedPoint.push(this)}disconnectFrom(I){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const C=this._connectedPoint.indexOf(I),j=I._connectedPoint.indexOf(this);-1!==C&&-1!==j&&(O&&this._connectedPoint.splice(C,1),I._connectedPoint.splice(j,1))}disconnectFromAll(){for(const I of this._connectedPoint)this.disconnectFrom(I,!1);this._connectedPoint.length=0}dispose(){for(const I of this._connectedPoint)this.disconnectFrom(I)}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};I.uniqueId=this.uniqueId,I.name=this.name,I._connectionType=this._connectionType,I.connectedPointIds=[],I.className=this.getClassName();for(const O of this._connectedPoint)I.connectedPointIds.push(O.uniqueId)}getClassName(){return"FGConnection"}deserialize(I){this.uniqueId=I.uniqueId,this.name=I.name,this._connectionType=I._connectionType,this.connectedPointIds=I.connectedPointIds}}},13866:(I,O,C)=>{"use strict";C.d(O,{e:()=>W});var j,K=C(12088),i=C(12250),y=C(12257),S=C(12234),U=C(13869),p=C(13896),N=C(12103);!function(I){I.ExecuteBlock="ExecuteBlock",I.ExecuteEvent="ExecuteEvent",I.TriggerConnection="TriggerConnection",I.ContextVariableSet="ContextVariableSet",I.GlobalVariableSet="GlobalVariableSet",I.GlobalVariableDelete="GlobalVariableDelete",I.GlobalVariableGet="GlobalVariableGet",I.AddConnection="AddConnection",I.GetConnectionValue="GetConnectionValue",I.SetConnectionValue="SetConnectionValue",I.ActivateSignal="ActivateSignal",I.ContextVariableGet="ContextVariableGet"}(j||(j={}));class Q{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(I){if(I.time||(I.time=Date.now()),this.log.push(I),this.logToConsole){var O;const C=null===(O=I.mj)||void 0===O?void 0:O.value;"object"===typeof C&&C.getClassName?N.c.Log(`[FGLog] ${I.className}:${I.uniqueId.split("-")[0]} ${I.action} - ${JSON.stringify(C.getClassName())}: ${C.toString()}`):N.c.Log(`[FGLog] ${I.className}:${I.uniqueId.split("-")[0]} ${I.action} - ${JSON.stringify(I.mj)}`)}}getItemsOfType(I){return this.log.filter((O=>O.action===I))}}class s{get enableLogging(){return this._enableLogging}set enableLogging(I){this._enableLogging!==I&&(this._enableLogging=I,this._enableLogging?(this.logger=new Q,this.logger.logToConsole=!0):this.logger=null)}constructor(I){this.uniqueId=(0,S.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new K.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=I,this.assetsContext=I.assetsContext??I.hO}hasVariable(I){return I in this._userVariables}setVariable(I,O){var C;this._userVariables[I]=O,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",mj:{name:I,value:O}})}getAsset(I,O){return(0,p.d)(this.assetsContext,I,O)}getVariable(I){var O;return null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",mj:{name:I,value:this._userVariables[I]}}),this._userVariables[I]}get userVariables(){return this._userVariables}nI(){return this._configuration.hO}_getUniqueIdPrefixedName(I,O){return`${I.uniqueId}_${O}`}_getGlobalContextVariable(I,O){var C;return null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",mj:{name:I,defaultValue:O,possibleValue:this._globalContextVariables[I]}}),this._hasGlobalContextVariable(I)?this._globalContextVariables[I]:O}_setGlobalContextVariable(I,O){var C;null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",mj:{name:I,value:O}}),this._globalContextVariables[I]=O}_deleteGlobalContextVariable(I){var O;null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",mj:{name:I}}),delete this._globalContextVariables[I]}_hasGlobalContextVariable(I){return I in this._globalContextVariables}_setExecutionVariable(I,O,C){this._executionVariables[this._getUniqueIdPrefixedName(I,O)]=C}_getExecutionVariable(I,O,C){return this._hasExecutionVariable(I,O)?this._executionVariables[this._getUniqueIdPrefixedName(I,O)]:C}_deleteExecutionVariable(I,O){delete this._executionVariables[this._getUniqueIdPrefixedName(I,O)]}_hasExecutionVariable(I,O){return this._getUniqueIdPrefixedName(I,O)in this._executionVariables}_hasConnectionValue(I){return I.uniqueId in this._connectionValues}_setConnectionValue(I,O){var C;this._connectionValues[I.uniqueId]=O,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",mj:{connectionPointId:I.uniqueId,value:O}})}_setConnectionValueByKey(I,O){this._connectionValues[I]=O}_getConnectionValue(I){var O;return null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",mj:{connectionPointId:I.uniqueId,value:this._connectionValues[I.uniqueId]}}),this._connectionValues[I.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(I){this._pendingBlocks.includes(I)||(this._pendingBlocks.push(I),this._pendingBlocks.sort(((I,O)=>I.priority-O.priority)))}_removePendingBlock(I){const O=this._pendingBlocks.indexOf(I);-1!==O&&this._pendingBlocks.splice(O,1)}_clearPendingBlocks(){for(const I of this._pendingBlocks)I._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(I){var O;this.onNodeExecutedObservable.notifyObservers(I),null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:I.getClassName(),uniqueId:I.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(I){this._setGlobalContextVariable("timeSinceStart",I.timeSinceStart),this._setGlobalContextVariable("deltaTime",I.deltaTime);for(const C of this._pendingBlocks){var O;null===(O=C._executeOnTick)||void 0===O||O.call(C,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.g;I.uniqueId=this.uniqueId,I._userVariables={};for(const j in this._userVariables)O(j,this._userVariables[j],I._userVariables);I._connectionValues={};for(const j in this._connectionValues)O(j,this._connectionValues[j],I._connectionValues);var C;this.assetsContext!==this.nI()&&(I._assetsContext={meshes:this.assetsContext.meshes.map((I=>I.id)),materials:this.assetsContext.materials.map((I=>I.id)),textures:this.assetsContext.textures.map((I=>I.name)),animations:this.assetsContext.animations.map((I=>I.name)),lights:this.assetsContext.lights.map((I=>I.id)),cameras:this.assetsContext.cameras.map((I=>I.id)),ls:null===(C=this.assetsContext.ls)||void 0===C?void 0:C.map((I=>I.name)),skeletons:this.assetsContext.skeletons.map((I=>I.id)),RQ:this.assetsContext.RQ.map((I=>I.name)),geometries:this.assetsContext.geometries.map((I=>I.id)),multiMaterials:this.assetsContext.multiMaterials.map((I=>I.id)),transformNodes:this.assetsContext.transformNodes.map((I=>I.id))})}getClassName(){return"FlowGraphContext"}}(0,i.e)([(0,y.E)()],s.prototype,"uniqueId",void 0);var Z=C(13901),q=C(12525);class mI{constructor(I){this.onEventTriggeredObservable=new K.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=I,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.yS.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const I=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",mj:{timeSinceStart:this._startingTime,deltaTime:I}}),this._startingTime+=I})),this._meshPickedObserver=this._scene.onPointerObservable.add((I=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",mj:I})}),q.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((I=>{const O=I.pointerId,C=I.mesh,j=this._pointerUnderMeshState[O];!j&&C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",mj:{pointerId:O,mesh:C}}):j&&!C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",mj:{pointerId:O,mesh:j}}):j&&C&&j!==C&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",mj:{pointerId:O,mesh:j,over:C}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",mj:{pointerId:O,mesh:C,out:j}})),this._pointerUnderMeshState[O]=C}),q.e.POINTERMOVE)}dispose(){var I,O,C,j,K;null===(I=this._sceneDisposeObserver)||void 0===I||I.remove(),null===(O=this._sceneReadyObserver)||void 0===O||O.remove(),null===(C=this._sceneOnBeforeRenderObserver)||void 0===C||C.remove(),null===(j=this._meshPickedObserver)||void 0===j||j.remove(),null===(K=this._meshUnderPointerObserver)||void 0===K||K.remove(),this.onEventTriggeredObservable.clear()}}var E,h=C(13922);!function(I){I[I.Stopped=0]="Stopped",I[I.Started=1]="Started"}(E||(E={}));class r{get state(){return this._state}set state(I){this._state=I,this.onStateChangedObservable.notifyObservers(I)}constructor(I){this.onStateChangedObservable=new K.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=I.hO,this._sceneEventCoordinator=new mI(this._scene),this._coordinator=I.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((I=>{for(const O of this._executionContexts){const C=this._getContextualOrder(I.type,O);for(const j of C)if(!j._executeEvent(O,I.mj))break}switch(I.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const O of this._executionContexts)O._notifyOnTick(I.mj);break;case"SceneDispose":this.dispose()}}))}createContext(){const I=new s({hO:this._scene,coordinator:this._coordinator});return this._executionContexts.push(I),I}getContext(I){return this._executionContexts[I]}addEventBlock(I){if("PointerOver"!==I.type&&"PointerOut"!==I.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==I.type&&this._eventBlocks[I.type].push(I),1===this.state)for(const O of this._executionContexts)I._startPendingTasks(O);else this.onStateChangedObservable.addOnce((O=>{if(1===O)for(const C of this._executionContexts)I._startPendingTasks(C)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((I=>{1===I&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const I of this._executionContexts)for(const O in this._eventBlocks){const C=this._getContextualOrder(O,I);for(const O of C)O._startPendingTasks(I)}}_getContextualOrder(I,O){const C=this._eventBlocks[I].sort(((I,O)=>O.initPriority-I.initPriority));if("MeshPick"===I){const I=[];for(const j of C){const K=j.asset.getValue(O);let i=0;for(;i<C.length;i++){const I=C[i].asset.getValue(O);if(K&&I&&(0,h.o)(K,I))break}I.splice(i,0,j)}return I}return C}dispose(){var I;if(0!==this.state){this.state=0;for(const I of this._executionContexts)I._clearPendingBlocks();this._executionContexts.length=0;for(const I in this._eventBlocks)this._eventBlocks[I].length=0;null===(I=this._eventObserver)||void 0===I||I.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(I){const O=[],C=new Set;for(const j in this._eventBlocks)for(const I of this._eventBlocks[j])O.push(I),C.add(I.uniqueId);for(;O.length>0;){const j=O.pop();I(j);for(const I of j.dataInputs)for(const j of I._connectedPoint)C.has(j._ownerBlock.uniqueId)||(O.push(j._ownerBlock),C.add(j._ownerBlock.uniqueId));if(j instanceof Z.b)for(const I of j.signalOutputs)for(const j of I._connectedPoint)C.has(j._ownerBlock.uniqueId)||(O.push(j._ownerBlock),C.add(j._ownerBlock.uniqueId))}}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1?arguments[1]:void 0;I.allBlocks=[],this.visitAllBlocks((O=>{const C={};O.serialize(C),I.allBlocks.push(C)})),I.executionContexts=[];for(const C of this._executionContexts){const j={};C.serialize(j,O),I.executionContexts.push(j)}}}class W{constructor(I){this.config=I,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.hO.yS.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.hO.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const I=this._executeOnNextFrame.slice(0);if(I.length)for(const O of I){this.notifyCustomEvent(O.id,O.data,!1);const I=this._executeOnNextFrame.findIndex((I=>I.uniqueId===O.uniqueId));-1!==I&&this._executeOnNextFrame.splice(I,1)}}));(W.SceneCoordinators.get(this.config.hO)??[]).push(this)}createGraph(){const I=new r({hO:this.config.hO,coordinator:this});return this._flowGraphs.push(I),I}removeGraph(I){const O=this._flowGraphs.indexOf(I);-1!==O&&(I.dispose(),this._flowGraphs.splice(O,1))}start(){for(const I of this._flowGraphs)I.start()}dispose(){var I,O;for(const K of this._flowGraphs)K.dispose();this._flowGraphs.length=0,null===(I=this._disposeObserver)||void 0===I||I.remove(),null===(O=this._onBeforeRenderObserver)||void 0===O||O.remove();const C=W.SceneCoordinators.get(this.config.hO)??[],j=C.indexOf(this);-1!==j&&C.splice(j,1)}serialize(I,O){I._flowGraphs=[];for(const C of this._flowGraphs){const j={};C.serialize(j,O),I._flowGraphs.push(j)}I.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(I){let O=this._customEventsMap.get(I);return O||(O=new K.c,this._customEventsMap.set(I,O)),O}notifyCustomEvent(I,O){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:I,data:O,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(I)){const O=this._eventExecutionCounter.get(I);if(this._eventExecutionCounter.set(I,O+1),O>=W.MaxEventTypeExecutionPerFrame)return void(O===W.MaxEventTypeExecutionPerFrame&&N.c.Warn(`FlowGraphCoordinator: Too many executions of event "${I}".`))}else this._eventExecutionCounter.set(I,1);const C=this._customEventsMap.get(I);C&&C.notifyObservers(O)}}W.MaxEventsPerType=30,W.MaxEventTypeExecutionPerFrame=30,W.SceneCoordinators=new Map},13931:(I,O,C)=>{"use strict";C.d(O,{b:()=>K});var j=C(13938);class K extends j.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(I){I._notifyExecuteNode(this),this.done._activateSignal(I)}}},13901:(I,O,C)=>{"use strict";C.d(O,{b:()=>S});var j=C(13906),K=C(13915),i=C(12226);class y extends K.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(I){super.connectTo(I),this._connectedPoint.sort(((I,O)=>O.priority-I.priority))}_activateSignal(I){var O;if(null===(O=I.logger)||void 0===O||O.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,mj:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)I._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(I,this),I._increaseExecutionId();else for(const C of this._connectedPoint)C._activateSignal(I)}}(0,i.e)("FlowGraphSignalConnection",y);class S extends j.d{constructor(I){super(I),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(I){const O=new y(I,0,this);return this.signalInputs.push(O),O}_registerSignalOutput(I){const O=new y(I,1,this);return this.signalOutputs.push(O),O}_unregisterSignalInput(I){const O=this.signalInputs.findIndex((O=>O.name===I));-1!==O&&(this.signalInputs[O].dispose(),this.signalInputs.splice(O,1))}_unregisterSignalOutput(I){const O=this.signalOutputs.findIndex((O=>O.name===I));-1!==O&&(this.signalOutputs[O].dispose(),this.signalOutputs.splice(O,1))}_reportError(I,O){this.error.mj="string"===typeof O?new Error(O):O,this.error._activateSignal(I)}getSignalInput(I){return this.signalInputs.find((O=>O.name===I))}getSignalOutput(I){return this.signalOutputs.find((O=>O.name===I))}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(I),I.signalInputs=[],I.signalOutputs=[];for(const O of this.signalInputs){const C={};O.serialize(C),I.signalInputs.push(C)}for(const O of this.signalOutputs){const C={};O.serialize(C),I.signalOutputs.push(C)}}deserialize(I){for(let O=0;O<I.signalInputs.length;O++){const C=this.getSignalInput(I.signalInputs[O].name);if(!C)throw new Error("Could not find signal input with name "+I.signalInputs[O].name+" in block "+I.className);C.deserialize(I.signalInputs[O])}for(let O=0;O<I.signalOutputs.length;O++){const C=this.getSignalOutput(I.signalOutputs[O].name);if(!C)throw new Error("Could not find signal output with name "+I.signalOutputs[O].name+" in block "+I.className);C.deserialize(I.signalOutputs[O])}}getClassName(){return"FlowGraphExecutionBlock"}}},13944:(I,O,C)=>{"use strict";C.d(O,{e:()=>K});var j=C(13901);class K extends j.b{constructor(I){super(I),this.out=this._registerSignalOutput("out")}}},13886:(I,O,C)=>{"use strict";C.d(O,{A:()=>Z,E:()=>q,F:()=>mI,J:()=>T,N:()=>H,O:()=>X,R:()=>n,d:()=>p,g:()=>s,h:()=>c,i:()=>E,m:()=>h,q:()=>r,u:()=>Q,x:()=>o,y:()=>N});var j,K=C(12272),i=C(12307),y=C(13878),S=C(13888);!function(I){I.Any="any",I.String="string",I.Number="number",I.Boolean="boolean",I.Object="object",I.Integer="FlowGraphInteger",I.Vector2="Vector2",I.mC="mC",I.Vector4="Vector4",I.Quaternion="Quaternion",I.Matrix="Matrix",I.Matrix2D="Matrix2D",I.Matrix3D="Matrix3D",I.WO="WO",I.TS="TS"}(j||(j={}));class U{constructor(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=I,this.defaultValue=O,this.animationType=C}serialize(I){I.typeName=this.typeName,I.defaultValue=this.defaultValue}}const p=new U("any",void 0),N=new U("string",""),Q=new U("number",0,0),s=new U("boolean",!1),Z=new U("Vector2",K.Vector2.Zero(),5),q=new U("mC",K.mC.Zero(),1),mI=new U("Vector4",K.Vector4.Zero()),E=new U("Matrix",K.Matrix.Identity(),3),h=new U("Matrix2D",new S.d),r=new U("Matrix3D",new S.f),W=new U("WO",i.WO.Black(),4),Y=new U("TS",new i.TS(0,0,0,0),7),o=new U("Quaternion",K.Quaternion.Identity(),2);o.typeTransformer=I=>{if(I.getClassName){if("Vector4"===I.getClassName())return K.Quaternion.YO(I.qS());if("mC"===I.getClassName())return K.Quaternion.FromEulerVector(I);if("Matrix"===I.getClassName())return K.Quaternion.FromRotationMatrix(I)}return I};const c=new U("FlowGraphInteger",new y.e(0),0);function n(I){const O=I;switch(typeof I){case"string":return N;case"number":return Q;case"boolean":return s;case"object":if(O.getClassName)switch(O.getClassName()){case"Vector2":return Z;case"mC":return q;case"Vector4":return mI;case"Matrix":return E;case"WO":return W;case"TS":return Y;case"Quaternion":return o;case"FlowGraphInteger":return c;case"Matrix2D":return h;case"Matrix3D":return r}return p;default:return p}}function X(I){switch(I){case"string":return N;case"number":return Q;case"boolean":return s;case"Vector2":return Z;case"mC":return q;case"Vector4":return mI;case"Matrix":return E;case"WO":return W;case"TS":return Y;case"Quaternion":return o;case"FlowGraphInteger":return c;case"Matrix2D":return h;case"Matrix3D":return r;default:return p}}function T(I){switch(I){case"number":default:return 0;case"Vector2":return 5;case"mC":return 1;case"Matrix":return 3;case"WO":return 4;case"TS":return 7;case"Quaternion":return 2}}function H(I){switch(I){case 0:return Q;case 5:return Z;case 1:return q;case 3:return E;case 4:return W;case 7:return Y;case 2:return o;default:return p}}},13869:(I,O,C)=>{"use strict";C.d(O,{e:()=>N,g:()=>p,i:()=>Q});var j=C(12307),K=C(12272),i=C(13878),y=C(13886),S=C(13888);function U(I){return"Vector2"===I||"mC"===I||"Vector4"===I||"Quaternion"===I||"WO"===I||"TS"===I}function p(I,O,C){var j;const K=(null===O||void 0===O||null===(j=O.getClassName)||void 0===j?void 0:j.call(O))??"";if(U(K)||function(I){return"Matrix"===I||"Matrix2D"===I||"Matrix3D"===I}(K))C[I]={value:O.qS(),className:K};else if("FlowGraphInteger"===K)C[I]={value:O.value,className:K};else if(K&&(O.id||O.name))C[I]={id:O.id,name:O.name,className:K};else{if("object"===typeof O)throw new Error(`Could not serialize value ${O}`);C[I]=O}}function N(I,O,C,p){const Q=O[I];let s;const Z=(null===Q||void 0===Q?void 0:Q.type)??(null===Q||void 0===Q?void 0:Q.className);if(function(I){return"Mesh"===I||"AbstractMesh"===I||"GroundMesh"===I||"InstanceMesh"===I||"LinesMesh"===I||"GoldbergMesh"===I||"GreasedLineMesh"===I||"TrailMesh"===I}(Z)){let I=p.meshes.filter((I=>Q.id?I.id===Q.id:I.name===Q.name));0===I.length&&(I=p.transformNodes.filter((I=>Q.id?I.id===Q.id:I.name===Q.name))),s=Q.uniqueId?I.find((I=>I.uniqueId===Q.uniqueId)):I[0]}else if(U(Z))s=function(I,O){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===I)return K.Vector2.YO(O);if("mC"===I)return C&&(O[2]*=-1),K.mC.YO(O);if("Vector4"===I)return K.Vector4.YO(O);if("Quaternion"===I)return C&&(O[2]*=-1,O[3]*=-1),K.Quaternion.YO(O);if("WO"===I)return new j.WO(O[0],O[1],O[2]);if("TS"===I)return new j.TS(O[0],O[1],O[2],O[3]);throw new Error(`Unknown vector class name ${I}`)}(Z,Q.value);else if(function(I){return"AnimationGroup"===I}(Z)){const I=p.animationGroups.filter((I=>I.name===Q.name));s=1===I.length?I[0]:I.find((I=>I.uniqueId===Q.uniqueId))}else s="Matrix"===Z?K.Matrix.YO(Q.value):"Matrix2D"===Z?new S.d(Q.value):"Matrix3D"===Z?new S.f(Q.value):"FlowGraphInteger"===Z?i.e.FromValue(Q.value):"number"===Z||"string"===Z||"boolean"===Z?Q.value[0]:Q&&void 0!==Q.value?Q.value:Array.isArray(Q)?Q.reduce(((I,O)=>O.eventData?(I[O.id]={type:(0,y.O)(O.type)},"undefined"!==typeof O.value&&(I[O.id].value=N("value",O,C,p)),I):I),{}):Q;return s}function Q(I){return"FlowGraphJsonPointerParserBlock"===I}},13922:(I,O,C)=>{"use strict";function j(I,O){return!(!I.parent||I.parent!==O&&!j(I.parent,O))}function K(I){if(I.getClassName)return I.getClassName()}function i(I,O){return I===O&&("Vector2"===I||"mC"===I||"Vector4"===I||"Quaternion"===I)}function y(I,O){return I===O&&("Matrix"===I||"Matrix2D"===I||"Matrix3D"===I)}function S(I,O){return"FlowGraphInteger"===I&&"FlowGraphInteger"===O}function U(I,O){const C="number"===typeof I||"number"===typeof(null===I||void 0===I?void 0:I.value);return C&&!O?!isNaN(p(I)):C}function p(I){return"number"===typeof I?I:I.value}C.d(O,{c:()=>S,g:()=>y,i:()=>i,m:()=>K,o:()=>j,r:()=>p,t:()=>U})},13279:(I,O,C)=>{"use strict";C.r(O),C.d(O,{SceneInstrumentation:()=>i});var j=C(12083),K=C(12465);class i{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(I){I!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=I,I?(this._onBeforeActiveMeshesEvaluationObserver=this.hO.onBeforeActiveMeshesEvaluationObservable.add((()=>{j.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.hO.onAfterActiveMeshesEvaluationObservable.add((()=>{j.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.hO.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.hO.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(I){I!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=I,I?(this._onBeforeRenderTargetsRenderObserver=this.hO.onBeforeRenderTargetsRenderObservable.add((()=>{j.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.hO.onAfterRenderTargetsRenderObservable.add((()=>{j.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.hO.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.hO.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(I){I!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=I,I?(this._onBeforeParticlesRenderingObserver=this.hO.onBeforeParticlesRenderingObservable.add((()=>{j.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.hO.onAfterParticlesRenderingObservable.add((()=>{j.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.hO.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.hO.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(I){I!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=I,this.hO.spriteManagers&&(I?(this._onBeforeSpritesRenderingObserver=this.hO.onBeforeSpritesRenderingObservable.add((()=>{j.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.hO.onAfterSpritesRenderingObservable.add((()=>{j.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.hO.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.hO.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(I){I!==this._capturePhysicsTime&&this.hO.onBeforePhysicsObservable&&(this._capturePhysicsTime=I,I?(this._onBeforePhysicsObserver=this.hO.onBeforePhysicsObservable.add((()=>{j.Tools.StartPerformanceCounter("vq"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.hO.onAfterPhysicsObservable.add((()=>{j.Tools.EndPerformanceCounter("vq"),this._physicsTime.endMonitoring()}))):(this.hO.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.hO.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(I){I!==this._captureAnimationsTime&&(this._captureAnimationsTime=I,I?this._onAfterAnimationsObserver=this.hO.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.hO.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(I){this._captureFrameTime=I}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(I){this._captureInterFrameTime=I}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(I){I!==this._captureRenderTime&&(this._captureRenderTime=I,I?(this._onBeforeDrawPhaseObserver=this.hO.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),j.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.hO.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),j.Tools.EndPerformanceCounter("Main render")}))):(this.hO.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.hO.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(I){I!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=I,I?(this._onBeforeCameraRenderObserver=this.hO.onBeforeCameraRenderObservable.add((I=>{this._cameraRenderTime.beginMonitoring(),j.Tools.StartPerformanceCounter(`Rendering camera ${I.name}`)})),this._onAfterCameraRenderObserver=this.hO.onAfterCameraRenderObservable.add((I=>{this._cameraRenderTime.endMonitoring(!1),j.Tools.EndPerformanceCounter(`Rendering camera ${I.name}`)}))):(this.hO.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.hO.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.hO.getEngine()._drawCalls}constructor(I){this.hO=I,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new K.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new K.c,this._captureFrameTime=!1,this._frameTime=new K.c,this._captureRenderTime=!1,this._renderTime=new K.c,this._captureInterFrameTime=!1,this._interFrameTime=new K.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new K.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new K.c,this._capturePhysicsTime=!1,this._physicsTime=new K.c,this._captureAnimationsTime=!1,this._animationsTime=new K.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new K.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=I.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(j.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.hO.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=I.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(j.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.iS(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.iS(),this._captureParticlesRenderTime&&this._particlesRenderTime.iS(),this._captureSpritesRenderTime&&this._spritesRenderTime.iS(),this._captureRenderTime&&this._renderTime.iS(),this._captureCameraRenderTime&&this._cameraRenderTime.iS()}))}dispose(){this._disposed||(this.hO.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.hO.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.hO.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.hO.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.hO.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.hO.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.hO.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.hO.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.hO.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.hO.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.hO.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.hO.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.hO.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.hO.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.hO.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.hO.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.hO.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.hO=null,this._disposed=!0)}}},13857:(I,O,C)=>{"use strict";C.d(O,{c:()=>N});var j=C(12250),K=C(12257),i=C(12272),y=C(12654),S=C(12772),U=C(12833),p=C(12226);y.b.AddNodeConstructor("Light_Type_1",((I,O)=>()=>new N(I,i.mC.Zero(),O)));class N extends U.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(I){this._shadowFrustumSize=I,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(I){this._shadowOrthoScale=I,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(I){this._orthoLeft=I}get orthoRight(){return this._orthoRight}set orthoRight(I){this._orthoRight=I}get orthoTop(){return this._orthoTop}set orthoTop(I){this._orthoTop=I}get orthoBottom(){return this._orthoBottom}set orthoBottom(I){this._orthoBottom=I}constructor(I,O,C){super(I,C),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=O.scale(-1),this.direction=O}getClassName(){return"Bq"}getTypeID(){return S.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(I,O,C){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(I):this._setDefaultAutoExtendShadowProjectionMatrix(I,O,C)}_setDefaultFixedFrustumShadowProjectionMatrix(I){const O=this.nI().activeCamera;O&&i.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:O.ES,void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ,I,this.nI().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(I,O,C){const j=this.nI().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const I=i.mC.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let j=Number.MAX_VALUE,K=-Number.MAX_VALUE;for(let y=0;y<C.length;y++){const S=C[y];if(!S)continue;const U=S.getBoundingInfo().boundingBox;for(let C=0;C<U.vectorsWorld.length;C++)i.mC.TransformCoordinatesToRef(U.vectorsWorld[C],O,I),I.x<this._orthoLeft&&(this._orthoLeft=I.x),I.y<this._orthoBottom&&(this._orthoBottom=I.y),I.x>this._orthoRight&&(this._orthoRight=I.x),I.y>this._orthoTop&&(this._orthoTop=I.y),this.autoCalcShadowZBounds&&(I.z<j&&(j=I.z),I.z>K&&(K=I.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=j,this._shadowMaxZ=K)}const K=this._orthoRight-this._orthoLeft,y=this._orthoTop-this._orthoBottom,S=void 0!==this.shadowMinZ?this.shadowMinZ:(null===j||void 0===j?void 0:j.ES)||0,U=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===j||void 0===j?void 0:j.maxZ)||1e4,p=this.nI().getEngine().jS;i.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-K*this.shadowOrthoScale,this._orthoRight+K*this.shadowOrthoScale,this._orthoBottom-y*this.shadowOrthoScale,this._orthoTop+y*this.shadowOrthoScale,p?U:S,p?S:U,I,this.nI().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(I,O){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,O),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,O),this)}transferToNodeMaterialEffect(I,O){return this.computeTransformedInformation()?(I.setFloat3(O,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(I.setFloat3(O,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(I){const O=this._scene.getEngine();return!O.jS&&O.isNDCHalfZRange?0:1}getDepthMaxZ(I){const O=this._scene.getEngine();return O.jS&&O.isNDCHalfZRange?0:1}prepareLightSpecificDefines(I,O){I["DIRLIGHT"+O]=!0}}(0,j.e)([(0,K.E)()],N.prototype,"shadowFrustumSize",null),(0,j.e)([(0,K.E)()],N.prototype,"shadowOrthoScale",null),(0,j.e)([(0,K.E)()],N.prototype,"autoUpdateExtends",void 0),(0,j.e)([(0,K.E)()],N.prototype,"autoCalcShadowZBounds",void 0),(0,j.e)([(0,K.E)("orthoLeft")],N.prototype,"_orthoLeft",void 0),(0,j.e)([(0,K.E)("orthoRight")],N.prototype,"_orthoRight",void 0),(0,j.e)([(0,K.E)("orthoTop")],N.prototype,"_orthoTop",void 0),(0,j.e)([(0,K.E)("orthoBottom")],N.prototype,"_orthoBottom",void 0),(0,p.e)("BABYLON.DirectionalLight",N)},14350:(I,O,C)=>{"use strict";C.d(O,{e:()=>N});var j=C(12250),K=C(12257),i=C(12272),y=C(12307),S=C(12654),U=C(12772),p=C(12226);S.b.AddNodeConstructor("Light_Type_3",((I,O)=>()=>new N(I,i.mC.Zero(),O)));class N extends U.d{constructor(I,O,C){super(I,C),this.groundColor=new y.WO(0,0,0),this.direction=O||i.mC.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Fq"}setDirectionToTarget(I){return this.direction=i.mC.Normalize(I.EO(i.mC.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(I,O){const C=i.mC.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",C.x,C.y,C.z,0,O),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.aS),O),this}transferToNodeMaterialEffect(I,O){const C=i.mC.Normalize(this.direction);return I.setFloat3(O,C.x,C.y,C.z),this}rS(){return this._worldMatrix||(this._worldMatrix=i.Matrix.Identity()),this._worldMatrix}getTypeID(){return U.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(I,O){I["HEMILIGHT"+O]=!0}}(0,j.e)([(0,K.k)()],N.prototype,"groundColor",void 0),(0,j.e)([(0,K.B)()],N.prototype,"direction",void 0),(0,p.e)("BABYLON.HemisphericLight",N)},13821:(I,O,C)=>{"use strict";C.d(O,{b:()=>Q});var j=C(12250),K=C(12257),i=C(12272),y=C(12654),S=C(12772),U=C(12833),p=C(12245),N=C(12226);y.b.AddNodeConstructor("Light_Type_2",((I,O)=>()=>new Q(I,i.mC.Zero(),i.mC.Zero(),0,0,O)));class Q extends U.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(I){this._iesProfileTexture!==I&&(this._iesProfileTexture=I,this._iesProfileTexture&&Q._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(I){this._angle=I,this._cosHalfAngle=Math.cos(.5*I),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(I){this._innerAngle=I,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(I){this._shadowAngleScale=I,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(I){this._projectionTextureLightNear=I,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(I){this._projectionTextureLightFar=I,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(I){this._projectionTextureUpDirection=I,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(I){this._projectionTexture!==I&&(this._projectionTexture=I,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Q._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Q._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(I){return void 0!==I.onGeneratedObservable}static _IsTexture(I){return void 0!==I.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(I){this._projectionTextureProjectionLightMatrix=I,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(I,O,C,j,K,y){super(I,y),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=i.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=i.mC.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=i.mC.Zero(),this._projectionTextureViewLightMatrix=i.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=i.Matrix.Zero(),this._projectionTextureScalingMatrix=i.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=O,this.direction=C,this.angle=j,this.exponent=K}getClassName(){return"SpotLight"}getTypeID(){return S.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(I){super._setDirection(I),this._projectionTextureViewLightDirty=!0}_setPosition(I){super._setPosition(I),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(I,O,C){const j=this.nI().activeCamera;if(!j)return;this._shadowAngleScale=this._shadowAngleScale||1;const K=this._shadowAngleScale*this._angle,y=void 0!==this.shadowMinZ?this.shadowMinZ:j.ES,S=void 0!==this.shadowMaxZ?this.shadowMaxZ:j.maxZ,U=this.nI().getEngine().jS;i.Matrix.PerspectiveFovLHToRef(K,1,U?S:y,U?y:S,I,!0,this._scene.getEngine().isNDCHalfZRange,void 0,U)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),i.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const I=this.projectionTextureLightFar,O=this.projectionTextureLightNear,C=I/(I-O),j=-C*O,K=1/Math.tan(this._angle/2);i.Matrix.FromValuesToRef(K/1,0,0,0,0,K,0,0,0,0,C,1,0,0,j,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof p.e){const I=this._projectionTexture.uScale/2,O=this._projectionTexture.vScale/2;i.Matrix.FromValuesToRef(I,0,0,0,0,O,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(I,O){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),I.setMatrix("textureProjectionMatrix"+O,this._projectionTextureMatrix),I.setTexture("projectionLightTexture"+O,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&I.setTexture("iesLightTexture"+O,this._iesProfileTexture),this}transferToEffect(I,O){let C;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,O),C=i.mC.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,O),C=i.mC.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",C.x,C.y,C.z,this._cosHalfAngle,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,O),this}transferToNodeMaterialEffect(I,O){let C;return C=this.computeTransformedInformation()?i.mC.Normalize(this.transformedDirection):i.mC.Normalize(this.direction),this.nI().useRightHandedSystem?I.setFloat3(O,-C.x,-C.y,-C.z):I.setFloat3(O,C.x,C.y,C.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(I){const O=this._scene.getEngine(),C=void 0!==this.shadowMinZ?this.shadowMinZ:(null===I||void 0===I?void 0:I.ES)??0;return O.jS&&O.isNDCHalfZRange?C:this._scene.getEngine().isNDCHalfZRange?0:C}getDepthMaxZ(I){const O=this._scene.getEngine(),C=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===I||void 0===I?void 0:I.maxZ)??1e4;return O.jS&&O.isNDCHalfZRange?0:C}prepareLightSpecificDefines(I,O){I["SPOTLIGHT"+O]=!0,I["PROJECTEDLIGHTTEXTURE"+O]=!(!this.projectionTexture||!this.projectionTexture.isReady()),I["IESLIGHTTEXTURE"+O]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,j.e)([(0,K.E)()],Q.prototype,"angle",null),(0,j.e)([(0,K.E)()],Q.prototype,"innerAngle",null),(0,j.e)([(0,K.E)()],Q.prototype,"shadowAngleScale",null),(0,j.e)([(0,K.E)()],Q.prototype,"exponent",void 0),(0,j.e)([(0,K.E)()],Q.prototype,"projectionTextureLightNear",null),(0,j.e)([(0,K.E)()],Q.prototype,"projectionTextureLightFar",null),(0,j.e)([(0,K.E)()],Q.prototype,"projectionTextureUpDirection",null),(0,j.e)([(0,K.v)("projectedLightTexture")],Q.prototype,"_projectionTexture",void 0),(0,N.e)("BABYLON.SpotLight",Q)},13533:(I,O,C)=>{"use strict";C.d(O,{e:()=>y,g:()=>i,k:()=>S});const j={},K={};function i(I,O){j[I]=O}function y(I,O){K[I]=O}function S(I){return K[I]?K[I]:null}},13426:(I,O,C)=>{"use strict";C.d(O,{c:()=>n,f:()=>x});var j,K=C(12083),i=C(12088),y=C(12487),S=C(12132),U=C(12103),p=C(12689),N=C(12139),Q=C(12148),s=C(12234),Z=C(12167),q=C(12130);!function(I){I[I.Clean=0]="Clean",I[I.Stop=1]="Stop",I[I.Sync=2]="Sync",I[I.NoSync=3]="NoSync"}(j||(j={}));const mI=new i.c,E={};let h=!1;function r(){return E[".babylon"]}function W(I,O){const C=E[I];return C||(U.c.Warn("Unable to find a plugin to load "+I+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),O?r():void 0)}function Y(I,O,C){let j="Unable to load from "+(I.rawData?"binary data":I.url);return O?j+=`: ${O}`:C&&(j+=`: ${C}`),j}async function o(I,O,C,j,K,i,y,S,U){var p;const Q="data:"===(s=I.url).substring(0,5)?s.substring(5):null;var s;if(I.rawData&&!y)throw"When using ArrayBufferView to load data the file extension must be provided.";const h=Q||y?"":function(I){const O=I.indexOf("?");-1!==O&&(I=I.substring(0,O));const C=I.lastIndexOf(".");return I.substring(C,I.length).toLowerCase()}(I.url);let Y=y?W(y,!0):Q?function(I){for(const O in E){const C=E[O].plugin;if(C.canDirectLoad&&C.canDirectLoad(I))return E[O]}return r()}(I.url):W(h,!1);if(!Y&&h){if(I.url&&!I.url.startsWith("blob:")){const O=await async function(I,O){const C=O.method||"GET";return await new Promise(((j,K)=>{const i=new q.d;i.addEventListener("readystatechange",(()=>{if(4==i.readyState)if(200==i.status){const I={};if(O.responseHeaders)for(const C of O.responseHeaders)I[C]=i.getResponseHeader(C)||"";j({response:i.response,headerValues:I})}else K(`Unable to fetch data from ${I}. Error code: ${i.status}`)})),i.open(C,I),i.send()}))}(I.url,{method:"HEAD",responseHeaders:["Content-Type"]}),C=O.headerValues?O.headerValues["Content-Type"]:"";C&&(Y=function(I){for(const O in E){const C=E[O];if(C.mimeType===I)return C}}(C))}Y||(Y=r())}if(!Y)throw new Error(`No plugin or fallback for ${y??I.url}`);if(!1===(null===U||void 0===U||null===(p=U[Y.plugin.name])||void 0===p?void 0:p.enabled))throw new Error(`The '${Y.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(I.rawData&&!Y.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(I=>{if(Y.plugin.createPlugin){const O=Y.plugin.createPlugin(U??{});return O instanceof Promise?(O.then(I).catch((I=>{K("Error instantiating plugin.",I)})),null):(I(O),O)}return I(Y.plugin),Y.plugin})((U=>{var p;if(!U)throw`The loader plugin corresponding to the '${y}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(mI.notifyObservers(U),Q&&(U.canDirectLoad&&U.canDirectLoad(I.url)||!(0,N.m)(I.url))){if(U.directLoad){const I=U.directLoad(O,Q);I instanceof Promise?I.then((I=>{C(U,I)})).catch((I=>{K("Error in directLoad of _loadData: "+I,I)})):C(U,I)}else C(U,Q);return}const s=Y.isBinary,q=(I,j)=>{O.p?K("Scene has been disposed"):C(U,I,j)};let E=null,h=!1;null===(p=U.yS)||void 0===p||p.add((()=>{h=!0,E&&(E.abort(),E=null),i()}));const r=()=>{if(h)return;const C=(I,O)=>{K(null===I||void 0===I?void 0:I.statusText,O)};if(!U.loadFile&&I.rawData)throw"Plugin does not support loading ArrayBufferView.";E=U.loadFile?U.loadFile(O,I.rawData||I.file||I.url,I.rootUrl,q,j,s,C,S):O._loadFile(I.file||I.url,q,j,!0,s,C)},W=O.getEngine();let o=W.enableOfflineSupport;if(o){let C=!1;for(const j of O.disableOfflineSupportExceptionRules)if(j.test(I.url)){C=!0;break}o=!C}o&&Z.b.OfflineProviderFactory?O.offlineProvider=Z.b.OfflineProviderFactory(I.url,r,W.disableManifestCheck):r()}))}function c(I,O){let C,j,i=null,y=null;if(O)if(O.name)C=`file:${O.name}`,j=O.name,i=O;else if(ArrayBuffer.isView(O))C="",j=(0,s.c)(),y=O;else if(O.startsWith("data:"))C=O,j="";else if(I){const i=O;if("/"===i.substring(0,1))return K.Tools.Error("Wrong sceneFilename parameter"),null;C=I+i,j=i}else C=O,j=K.Tools.GetFilename(O),I=K.Tools.GetFolderPath(O);else C=I,j=K.Tools.GetFilename(I),I=K.Tools.GetFolderPath(I);return{url:C,rootUrl:I,name:j,file:i,rawData:y}}function n(I){if("string"===typeof I.extensions){const O=I.extensions;E[O.toLowerCase()]={plugin:I,isBinary:!1}}else{const O=I.extensions,C=Object.keys(O);for(const j of C)E[j.toLowerCase()]={plugin:I,isBinary:O[j].isBinary,mimeType:O[j].mimeType}}}async function X(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.e.LastCreatedScene,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!j)return U.c.Error("No scene available to import mesh to"),null;const Z=c(O,C);if(!Z)return null;const q={};j.addPendingData(q);const mI=()=>{j.removePendingData(q)},E=(I,O)=>{const C=Y(Z,I,O);y?y(j,C,new Q.g(C,Q.e.SceneLoaderError,O)):U.c.Error(C),mI()},h=i?I=>{try{i(I)}catch(O){E("Error in onProgress callback: "+O,O)}}:void 0,r=(I,O,C,i,y,S,U,p)=>{if(j.importedMeshesFiles.push(Z.url),K)try{K(I,O,C,i,y,S,U,p)}catch(N){E("Error in onSuccess callback: "+N,N)}j.removePendingData(q)};return await o(Z,j,((O,C,K)=>{if(O.rewriteRootURL&&(Z.rootUrl=O.rewriteRootURL(Z.rootUrl,K)),O.importMesh){const K=[],i=[],y=[];if(!O.importMesh(I,j,C,Z.rootUrl,K,i,y,E))return;j.loadingPluginName=O.name,r(K,i,y,[],[],[],[],[])}else{O.importMeshAsync(I,j,C,Z.rootUrl,h,Z.name).then((I=>{j.loadingPluginName=O.name,r(I.meshes,I.RQ,I.skeletons,I.animationGroups,I.transformNodes,I.geometries,I.lights,I.spriteManagers)})).catch((I=>{E(I.message,I)}))}}),h,E,mI,p,N,s)}async function T(I,O,C,j,K,i,y,S){return await new Promise(((U,p)=>{try{X(I,O,C,j,((I,O,C,j,K,i,y,S)=>{U({meshes:I,RQ:O,skeletons:C,animationGroups:j,transformNodes:K,geometries:i,lights:y,spriteManagers:S})}),K,((I,O,C)=>{p(C||new Error(O))}),i,y,S).catch(p)}catch(Q){p(Q)}}))}async function H(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.e.LastCreatedEngine,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};C?await a(I,O,new y.b(C),j,i,U,p,N,Q):K.Tools.Error("No engine available")}async function b(I,O,C,j,K,i,y){return await new Promise(((S,U)=>{H(I,O,C,(I=>{S(I)}),j,((I,O,C)=>{U(C||new Error(O))}),K,i,y)}))}async function a(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.e.LastCreatedScene,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return U.c.Error("No scene available to append to"),null;const Z=c(I,O);if(!Z)return null;const q={};C.addPendingData(q);const mI=()=>{C.removePendingData(q)};p.d.ShowLoadingScreen&&!h&&(h=!0,C.getEngine().displayLoadingUI(),C.executeWhenReady((()=>{C.getEngine().hideLoadingUI(),h=!1})));const E=(I,O)=>{const j=Y(Z,I,O);i?i(C,j,new Q.g(j,Q.e.SceneLoaderError,O)):U.c.Error(j),mI()},r=K?I=>{try{K(I)}catch(O){E("Error in onProgress callback",O)}}:void 0,W=()=>{if(j)try{j(C)}catch(I){E("Error in onSuccess callback",I)}C.removePendingData(q)};return await o(Z,C,((I,O)=>{if(I.load){if(!I.load(C,O,Z.rootUrl,E))return;C.loadingPluginName=I.name,W()}else{I.loadAsync(C,O,Z.rootUrl,r,Z.name).then((()=>{C.loadingPluginName=I.name,W()})).catch((I=>{E(I.message,I)}))}}),r,E,mI,y,N,s)}async function M(I,O,C,j,K,i,y){return await new Promise(((S,U)=>{try{a(I,O,C,(I=>{S(I)}),j,((I,O,C)=>{U(C||new Error(O))}),K,i,y).catch(U)}catch(Q){U(Q)}}))}async function u(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.e.LastCreatedScene,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return U.c.Error("No scene available to load asset container to"),null;const s=c(I,O);if(!s)return null;const Z={};C.addPendingData(Z);const q=()=>{C.removePendingData(Z)},mI=(I,O)=>{const j=Y(s,I,O);i?i(C,j,new Q.g(j,Q.e.SceneLoaderError,O)):U.c.Error(j),q()},E=K?I=>{try{K(I)}catch(O){mI("Error in onProgress callback",O)}}:void 0,h=I=>{if(j)try{j(I)}catch(O){mI("Error in onSuccess callback",O)}C.removePendingData(Z)};return await o(s,C,((I,O)=>{if(I.loadAssetContainer){const j=I.loadAssetContainer(C,O,s.rootUrl,mI);if(!j)return;j.populateRootNodes(),C.loadingPluginName=I.name,h(j)}else if(I.loadAssetContainerAsync){I.loadAssetContainerAsync(C,O,s.rootUrl,E,s.name).then((O=>{O.populateRootNodes(),C.loadingPluginName=I.name,h(O)})).catch((I=>{mI(I.message,I)}))}else mI("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),E,mI,q,y,p,N)}async function J(I,O,C,j,K,i,y){return await new Promise(((S,U)=>{try{u(I,O,C,(I=>{S(I)}),j,((I,O,C)=>{U(C||new Error(O))}),K,i,y).catch(U)}catch(Q){U(Q)}}))}async function f(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.e.LastCreatedScene,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,s=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",Z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!C)return void U.c.Error("No scene available to load animations to");if(j){for(const j of C.animatables)j.reset();C.stopAllAnimations();const I=C.animationGroups.slice();for(const C of I)C.dispose();const O=C.getNodes();for(const C of O)C.animations&&(C.animations=[])}else switch(K){case 0:const I=C.animationGroups.slice();for(const O of I)O.dispose();break;case 1:for(const O of C.animationGroups)O.stop();break;case 2:for(const O of C.animationGroups)O.reset(),O.restart();break;case 3:break;default:return void U.c.Error("Unknown animation group loading mode value '"+K+"'")}const q=C.animatables.length;await u(I,O,C,(I=>{I.mergeAnimationsTo(C,C.animatables.slice(q),i),I.dispose(),C.onAnimationFileImportedObservable.notifyObservers(C),y&&y(C)}),p,N,Q,s,Z)}async function l(I,O,C,j,K,i,y,S,U,p){return await new Promise(((N,s)=>{try{f(I,O,C,j,K,i,(I=>{N(I)}),y,((I,O,C)=>{s(C||new Error(O))}),S,U,p).catch(s)}catch(Q){s(Q)}}))}class x{static get ForceFullSceneLoadingForIncremental(){return p.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(I){p.d.ForceFullSceneLoadingForIncremental=I}static get ShowLoadingScreen(){return p.d.ShowLoadingScreen}static set ShowLoadingScreen(I){p.d.ShowLoadingScreen=I}static get loggingLevel(){return p.d.loggingLevel}static set loggingLevel(I){p.d.loggingLevel=I}static get CleanBoneMatrixWeights(){return p.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(I){p.d.CleanBoneMatrixWeights=I}static GetDefaultPlugin(){return r()}static GetPluginForExtension(I){var O;return null===(O=W(I,!0))||void 0===O?void 0:O.plugin}static IsPluginForExtensionAvailable(I){return function(I){return!!E[I]}(I)}static RegisterPlugin(I){n(I)}static ImportMesh(I,O,C,j,K,i,y,U,p){X(I,O,C,j,K,i,y,U,p).catch((I=>null===y||void 0===y?void 0:y(S.e.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async ImportMeshAsync(I,O,C,j,K,i,y){return await T(I,O,C,j,K,i,y)}static Load(I,O,C,j,K,i,y,U){H(I,O,C,j,K,i,y,U).catch((I=>null===i||void 0===i?void 0:i(S.e.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async LoadAsync(I,O,C,j,K,i){return await b(I,O,C,j,K,i)}static Append(I,O,C,j,K,i,y,U){a(I,O,C,j,K,i,y,U).catch((I=>null===i||void 0===i?void 0:i(C??S.e.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async AppendAsync(I,O,C,j,K,i){return await M(I,O,C,j,K,i)}static LoadAssetContainer(I,O,C,j,K,i,y,U){u(I,O,C,j,K,i,y,U).catch((I=>null===i||void 0===i?void 0:i(C??S.e.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async LoadAssetContainerAsync(I,O,C,j,K,i){return await J(I,O,C,j,K,i)}static ImportAnimations(I,O,C,j,K,i,y,U,p,N,Q){f(I,O,C,j,K,i,y,U,p,N,Q).catch((I=>null===p||void 0===p?void 0:p(C??S.e.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async ImportAnimationsAsync(I,O,C,j,K,i,y,S,U,p,N){return await l(I,O,C,j,K,i,S,p,N)}}x.NO_LOGGING=0,x.MINIMAL_LOGGING=1,x.SUMMARY_LOGGING=2,x.DETAILED_LOGGING=3,x.OnPluginActivatedObservable=mI},13838:(I,O,C)=>{"use strict";C.d(O,{c:()=>s});var j=C(12250),K=C(12257),i=C(12083),y=C(12272),S=C(12284),U=C(12245),p=C(12226),N=C(12088),Q=C(12296);C(13841);class s extends S.c{set boundingBoxSize(I){if(this._boundingBoxSize&&this._boundingBoxSize.equals(I))return;this._boundingBoxSize=I;const O=this.nI();O&&O.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(I){this._rotationY=I,this.setReflectionTextureMatrix(y.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(I,O,C){let j="";for(const K of I)j+=K;return new s(j,O,null,C,I)}static CreateFromPrefilteredData(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const K=O.useDelayedTextureLoading;O.useDelayedTextureLoading=!1;const i=new s(I,O,null,!1,null,null,null,void 0,!0,C,j);return O.useDelayedTextureLoading=K,i}constructor(I,O){var C;let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,K=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,s=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,q=arguments.length>10&&void 0!==arguments[10]&&arguments[10],mI=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,h=arguments.length>13?arguments[13]:void 0,r=arguments.length>14?arguments[14]:void 0;super(O),this.onLoadObservable=new N.c,this.boundingBoxPosition=y.mC.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new y.Matrix,this._buffer=null,this.name=I,this.url=I,this._noMipmap=K,this.mU=!1,this.isCube=!0,this._textureMatrix=y.Matrix.Identity(),this.coordinatesMode=U.e.CUBIC_MODE;let W=null,Y=null;null===j||Array.isArray(j)?(this._noMipmap=K,this._format=Q,this._createPolynomials=q,W=j,this._loaderOptions=h,this._useSRGBBuffer=r,this._lodScale=mI,this._lodOffset=E):(W=j.extensions??null,this._noMipmap=j.noMipmap??!1,i=j.files??null,Y=j.buffer??null,this._format=j.format??5,s=j.prefiltered??!1,Z=j.forcedExtension??null,this._createPolynomials=j.createPolynomials??!1,this._lodScale=j.lodScale??.8,this._lodOffset=j.lodOffset??0,this._loaderOptions=j.loaderOptions,this._useSRGBBuffer=j.useSRGBBuffer,S=j.F??null,p=j.onError??null),(I||i)&&this.updateURL(I,Z,S,s,p,W,null===(C=this.nI())||void 0===C?void 0:C.useDelayedTextureLoading,i,Y)}getClassName(){return"CubeTexture"}updateURL(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=I),this.url=I,O&&(this._forcedExtension=O);const p=I.lastIndexOf("."),N=O||(p>-1?I.substring(p).toLowerCase():""),Q=0===N.indexOf(".dds"),s=0===N.indexOf(".env"),Z=0===N.indexOf(".basis");if(s?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=j,j&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),S)this._files=S;else if(Z||s||Q||i||(i=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,i){for(let O=0;O<i.length;O++)this._files.push(I+i[O]);this._extensions=i}this._buffer=U,y?(this.delayLoadState=4,this._delayedOnLoad=C,this._delayedOnError=K):this._loadTexture(C,K)}delayLoad(I){4===this.delayLoadState&&(I&&(this._forcedExtension=I),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(I){var O,C;if(I.updateFlag===this._textureMatrix.updateFlag)return;I.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(C=this.nI())||void 0===C||C.markAllMaterialsAsDirty(1,(I=>-1!==I.getActiveTextures().indexOf(this))));if(this._textureMatrix=I,null===(O=this.nI())||void 0===O||!O.useRightHandedSystem)return;const j=y.TmpVectors.mC[0],K=y.TmpVectors.Quaternion[0],i=y.TmpVectors.mC[1];this._textureMatrix.decompose(j,K,i),K.z*=-1,K.w*=-1,y.Matrix.ComposeToRef(j,K,i,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var I;return null!==(I=this.nI())&&void 0!==I&&I.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this.nI(),j=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const K=()=>{var O;(this.onLoadObservable.notifyObservers(this),j)&&(j.dispose(),null===(O=this.nI())||void 0===O||O.markAllMaterialsAsDirty(1));I&&I()},y=(I,C)=>{this._loadingError=!0,this._errorObject={message:I,exception:C},O&&O(I,C),U.e.OnTextureLoadErrorObservable.notifyObservers(this)};var S;this._texture?this._texture.isReady?i.Tools.SetImmediate((()=>K())):this._texture.onLoadedObservable.add((()=>K())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,C,this._lodScale,this._lodOffset,I,y,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,C,this._files,this._noMipmap,I,y,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(S=this._texture)||void 0===S||S.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(I,O,C){const j=Q.e.Parse((()=>{let j=!1;return I.prefiltered&&(j=I.prefiltered),new s(C+(I.url??I.name),O,I.extensions,!1,I.files||null,null,null,void 0,j,I.forcedExtension)}),I,O);if(I.boundingBoxPosition&&(j.boundingBoxPosition=y.mC.YO(I.boundingBoxPosition)),I.boundingBoxSize&&(j.boundingBoxSize=y.mC.YO(I.boundingBoxSize)),I.animations)for(let K=0;K<I.animations.length;K++){const O=I.animations[K],C=(0,p.c)("BABYLON.Animation");C&&j.animations.push(C.Parse(O))}return j}clone(){let I=0;const O=Q.e.Clone((()=>{const O=new s(this.url,this.nI()||this._getEngine(),this._extensions,this._noMipmap,this._files);return I=O.uniqueId,O}),this);return O.uniqueId=I,O}}(0,j.e)([(0,K.E)()],s.prototype,"url",void 0),(0,j.e)([(0,K.B)()],s.prototype,"boundingBoxPosition",void 0),(0,j.e)([(0,K.B)()],s.prototype,"boundingBoxSize",null),(0,j.e)([(0,K.E)("rotationY")],s.prototype,"rotationY",null),(0,j.e)([(0,K.E)("files")],s.prototype,"_files",void 0),(0,j.e)([(0,K.E)("forcedExtension")],s.prototype,"_forcedExtension",void 0),(0,j.e)([(0,K.E)("extensions")],s.prototype,"_extensions",void 0),(0,j.e)([(0,K.q)("textureMatrix")],s.prototype,"_textureMatrix",void 0),(0,j.e)([(0,K.q)("textureMatrixRefraction")],s.prototype,"_textureMatrixRefraction",void 0),U.e._CubeTextureParser=s.Parse,(0,p.e)("BABYLON.CubeTexture",s)},14362:(I,O,C)=>{"use strict";C.d(O,{b:()=>U});var j=C(12103),K=C(12245),i=C(12240),y=C(12398),S=C(12201);y.ThinEngine.prototype.createDynamicTexture=function(I,O,C,j){const K=new S.c(this,4);return K.baseWidth=I,K.baseHeight=O,C&&(I=this.needPOTTextures?(0,i.d)(I,this._caps.maxTextureSize):I,O=this.needPOTTextures?(0,i.d)(O,this._caps.maxTextureSize):O),K.width=I,K.height=O,K.isReady=!1,K.generateMipMaps=C,K.samplingMode=j,this.updateTextureSamplingMode(j,K),this._internalTexturesCache.push(K),K},y.ThinEngine.prototype.updateDynamicTexture=function(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!I)return;const y=this._gl,S=y.TEXTURE_2D,U=this._bindTextureDirectly(S,I,!0,i);this._unpackFlipY(void 0===C?I.invertY:C),j&&y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const p=this._getWebGLTextureType(I.type),N=this._getInternalFormat(K||I.format),Q=this._getRGBABufferInternalSizedFormat(I.type,N);y.texImage2D(S,0,Q,N,p,O),I.generateMipMaps&&y.generateMipmap(S),U||this._bindTextureDirectly(S,null),j&&y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),K&&(I.format=K),I._dynamicTextureSource=O,I._premulAlpha=j,I.invertY=C||!1,I.isReady=!0};class U extends K.e{constructor(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,S=arguments.length>6?arguments[6]:void 0;const U=!C||C._isScene;super(null,U?C:null===C||void 0===C?void 0:C.hO,U?!j:C,S,i,void 0,void 0,void 0,void 0,y),this.name=I,this.wrapU=K.e.CLAMP_ADDRESSMODE,this.wrapV=K.e.CLAMP_ADDRESSMODE,this._generateMipMaps=j;const p=this._getEngine();if(!p)return;if(O.getContext)this._canvas=O,this._ownCanvas=!1,this._texture=p.createDynamicTexture(this._canvas.width,this._canvas.height,j,i);else{this._canvas=p.createCanvas(1,1),this._ownCanvas=!0;const I=O;I.width||0===I.width?this._texture=p.createDynamicTexture(I.width,I.height,j,i):this._texture=p.createDynamicTexture(O,O,j,i)}const N=this.getSize();this._canvas.width!==N.width&&(this._canvas.width=N.width),this._canvas.height!==N.height&&(this._canvas.height=N.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(I){this._canvas.width=I.width,this._canvas.height=I.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(I.width,I.height,this._generateMipMaps,this.samplingMode)}scale(I){const O=this.getSize();O.width*=I,O.height*=I,this._recreate(O)}scaleTo(I,O){const C=this.getSize();C.width=I,C.height=O,this._recreate(C)}getContext(){return this._context}clear(I){const O=this.getSize();I&&(this._context.fillStyle=I),this._context.clearRect(0,0,O.width,O.height)}update(I){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===I||I,O,this._format||void 0,void 0,C)}drawText(I,O,C,j,K,i,y){let S=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const U=this.getSize();if(i&&(this._context.fillStyle=i,this._context.fillRect(0,0,U.width,U.height)),this._context.font=j,null===O||void 0===O){const C=this._context.measureText(I);O=(U.width-C.width)/2}if(null===C||void 0===C){const I=parseInt(j.replace(/\D/g,""));C=U.height/2+I/3.65}this._context.fillStyle=K||"",this._context.fillText(I,O,C),S&&this.update(y)}dispose(){var I,O;(super.dispose(),this._ownCanvas)&&(null===(I=this._canvas)||void 0===I||null===(O=I.remove)||void 0===O||O.call(I));this._canvas=null,this._context=null}clone(){const I=this.nI();if(!I)return this;const O=this.getSize(),C=new U(this.name,O,I,this._generateMipMaps);return C.mU=this.mU,C.level=this.level,C.wrapU=this.wrapU,C.wrapV=this.wrapV,C}serialize(){const I=this.nI();I&&!I.isReady()&&j.c.Warn("The scene must be ready before serializing the dynamic texture");const O=super.serialize();return U._IsCanvasElement(this._canvas)&&(O.base64String=this._canvas.toDataURL()),O.invertY=this._invertY,O.samplingMode=this.samplingMode,O}static _IsCanvasElement(I){return void 0!==I.toDataURL}_rebuild(){this.update()}}},13752:(I,O,C)=>{"use strict";C.d(O,{d:()=>K});var j=C(12245);class K extends j.e{get depth(){return this._depth}constructor(I,O,C,K,i,y){let S=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7],p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:j.e.TRILINEAR_SAMPLINGMODE,N=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Q=arguments.length>10?arguments[10]:void 0;super(null,y,!S,U),this.format=i,this._texture=y.getEngine().createRawTexture2DArray(I,O,C,K,i,S,U,p,null,N,Q),this._depth=K,this.is2DArray=!0}update(I){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,I,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(I,O,C,j,i){return new K(I,O,C,j,5,i,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13552:(I,O,C)=>{"use strict";C.d(O,{b:()=>S,c:()=>U,f:()=>i,j:()=>y});var j=C(12282),K=C(12272);function i(I,O){return`{X: ${I.x.toFixed(O)} Y: ${I.y.toFixed(O)}}`}function y(I,O){return`{X: ${I._x.toFixed(O)} Y: ${I._y.toFixed(O)} Z: ${I._z.toFixed(O)}}`}function S(I,O){return 2*Math.acos((0,j.Clamp)(K.Quaternion.Dot(I,O)))}function U(I,O){const C=new K.Quaternion;return function(I,O,C){const i=K.mC.Cross(I,O),y=Math.acos((0,j.Clamp)(K.mC.Dot(I,O),-1,1));K.Quaternion.RotationAxisToRef(i,y,C)}(I,O,C),C}},13381:(I,O,C)=>{"use strict";C.d(O,{d:()=>p});var j=C(12272),K=C(12307),i=C(12671),y=C(12665),S=C(12318);C(13389);function U(I){let O=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const C=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],i=[];let U=[];const p=I.width||I.size||1,N=I.height||I.size||1,Q=I.depth||I.size||1,s=I.wrap||!1;let Z=void 0===I.topBaseAt?1:I.topBaseAt,q=void 0===I.bottomBaseAt?0:I.bottomBaseAt;Z=(Z+4)%4,q=(q+4)%4;let mI=[2,0,3,1][Z],E=[2,0,1,3][q],h=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(s){O=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],h=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let I=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],C=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const j=[17,18,19,16],K=[22,23,20,21];for(;mI>0;)I.unshift(I.pop()),j.unshift(j.pop()),mI--;for(;E>0;)C.unshift(C.pop()),K.unshift(K.pop()),E--;I=I.flat(),C=C.flat(),h=h.concat(I).concat(C),O.push(j[0],j[2],j[3],j[0],j[1],j[2]),O.push(K[0],K[2],K[3],K[0],K[1],K[2])}const r=[p/2,N/2,Q/2];U=h.reduce(((I,O,C)=>I.concat(O*r[C%3])),[]);const W=0===I.sideOrientation?0:I.sideOrientation||y.e.DEFAULTSIDE,Y=I.faceUV||new Array(6),o=I.faceColors,c=[];for(let y=0;y<6;y++)void 0===Y[y]&&(Y[y]=new j.Vector4(0,0,1,1)),o&&void 0===o[y]&&(o[y]=new K.TS(1,1,1,1));for(let j=0;j<6;j++)if(i.push(Y[j].z,S.b?1-Y[j].w:Y[j].w),i.push(Y[j].x,S.b?1-Y[j].w:Y[j].w),i.push(Y[j].x,S.b?1-Y[j].y:Y[j].y),i.push(Y[j].z,S.b?1-Y[j].y:Y[j].y),o)for(let I=0;I<4;I++)c.push(o[j].r,o[j].g,o[j].b,o[j].a);y.e._ComputeSides(W,U,O,C,i,I.frontUVs,I.backUVs);const n=new y.e;if(n.indices=O,n.TI=U,n.HI=C,n.aI=i,o){const I=W===y.e.DOUBLESIDE?c.concat(c):c;n.bI=I}return n}function p(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new i.c(I,C);O.sideOrientation=i.c._GetDefaultSideOrientation(O.sideOrientation),j._originalBuilderSideOrientation=O.sideOrientation;return U(O).uI(j,O.updatable),j}y.e.CreateBox=U,i.c.CreateBox=function(I,O){return p(I,{size:O,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13535:(I,O,C)=>{"use strict";C.d(O,{d:()=>S});var j=C(12671),K=C(12665),i=C(12318);function y(I){const O=[],C=[],j=[],y=[],S=I.radius||.5,U=I.tessellation||64,p=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1,N=0===I.sideOrientation?0:I.sideOrientation||K.e.DEFAULTSIDE;O.push(0,0,0),y.push(.5,.5);const Q=2*Math.PI*p,s=1===p?Q/U:Q/(U-1);let Z=0;for(let K=0;K<U;K++){const I=Math.cos(Z),C=Math.sin(Z),j=(I+1)/2,K=(1-C)/2;O.push(S*I,S*C,0),y.push(j,i.b?1-K:K),Z+=s}1===p&&(O.push(O[3],O[4],O[5]),y.push(y[2],i.b?1-y[3]:y[3]));const q=O.length/3;for(let K=1;K<q-1;K++)C.push(K+1,0,K);K.e.ComputeNormals(O,C,j),K.e._ComputeSides(N,O,C,j,y,I.frontUVs,I.backUVs);const mI=new K.e;return mI.indices=C,mI.TI=O,mI.HI=j,mI.aI=y,mI}function S(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=new j.c(I,C);O.sideOrientation=j.c._GetDefaultSideOrientation(O.sideOrientation),K._originalBuilderSideOrientation=O.sideOrientation;return y(O).uI(K,O.updatable),K}K.e.CreateDisc=y,j.c.CreateDisc=function(I,O,C){return S(I,{radius:O,tessellation:C,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13389:(I,O,C)=>{"use strict";C.d(O,{f:()=>E,d:()=>r,j:()=>h});var j=C(12272),K=C(12307),i=C(12671),y=C(12665),S=C(12329);i.c._GroundMeshParser=(I,O)=>U.Parse(I,O);class U extends i.c{constructor(I,O){super(I,O),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=I,this._subdivisionsY=I,this.subdivide(I);const C=this;C.createOrUpdateSubmeshesOctree&&C.createOrUpdateSubmeshesOctree(O)}getHeightAtCoordinates(I,O){const C=this.getWorldMatrix(),K=j.TmpVectors.Matrix[5];C.invertToRef(K);const i=j.TmpVectors.mC[8];if(j.mC.TransformCoordinatesFromFloatsToRef(I,0,O,K,i),I=i.x,O=i.z,I<this._minX||I>=this._maxX||O<=this._minZ||O>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const y=this._getFacetAt(I,O),S=-(y.x*I+y.z*O+y.w)/y.y;return j.mC.TransformCoordinatesFromFloatsToRef(0,S,0,C,i),i.y}getNormalAtCoordinates(I,O){const C=new j.mC(0,1,0);return this.getNormalAtCoordinatesToRef(I,O,C),C}getNormalAtCoordinatesToRef(I,O,C){const K=this.getWorldMatrix(),i=j.TmpVectors.Matrix[5];K.invertToRef(i);const y=j.TmpVectors.mC[8];if(j.mC.TransformCoordinatesFromFloatsToRef(I,0,O,i,y),I=y.x,O=y.z,I<this._minX||I>this._maxX||O<this._minZ||O>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const S=this._getFacetAt(I,O);return j.mC.TransformNormalFromFloatsToRef(S.x,S.y,S.z,K,C),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(I,O){const C=Math.floor((I+this._maxX)*this._subdivisionsX/this._width),j=Math.floor(-(O+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),K=this._heightQuads[j*this._subdivisionsX+C];let i;return i=O<K.slope.x*I+K.slope.y?K.facet1:K.facet2,i}_initHeightQuads(){const I=this._subdivisionsX,O=this._subdivisionsY;this._heightQuads=[];for(let C=0;C<O;C++)for(let O=0;O<I;O++){const K={slope:j.Vector2.Zero(),facet1:new j.Vector4(0,0,0,0),facet2:new j.Vector4(0,0,0,0)};this._heightQuads[C*I+O]=K}return this}_computeHeightQuads(){const I=this.getVerticesData(S.e.PositionKind);if(!I)return this;const O=j.TmpVectors.mC[3],C=j.TmpVectors.mC[2],K=j.TmpVectors.mC[1],i=j.TmpVectors.mC[0],y=j.TmpVectors.mC[4],U=j.TmpVectors.mC[5],p=j.TmpVectors.mC[6],N=j.TmpVectors.mC[7],Q=j.TmpVectors.mC[8];let s=0,Z=0,q=0,mI=0,E=0,h=0,r=0;const W=this._subdivisionsX,Y=this._subdivisionsY;for(let S=0;S<Y;S++)for(let Y=0;Y<W;Y++){s=3*Y,Z=S*(W+1)*3,q=(S+1)*(W+1)*3,O.x=I[Z+s],O.y=I[Z+s+1],O.z=I[Z+s+2],C.x=I[Z+s+3],C.y=I[Z+s+4],C.z=I[Z+s+5],K.x=I[q+s],K.y=I[q+s+1],K.z=I[q+s+2],i.x=I[q+s+3],i.y=I[q+s+4],i.z=I[q+s+5],mI=(i.z-O.z)/(i.x-O.x),E=O.z-mI*O.x,C.subtractToRef(O,y),K.subtractToRef(O,U),i.subtractToRef(O,p),j.mC.CrossToRef(p,U,N),j.mC.CrossToRef(y,p,Q),N.normalize(),Q.normalize(),h=-(N.x*O.x+N.y*O.y+N.z*O.z),r=-(Q.x*C.x+Q.y*C.y+Q.z*C.z);const o=this._heightQuads[S*W+Y];o.slope.cS(mI,E),o.facet1.cS(N.x,N.y,N.z,h),o.facet2.cS(Q.x,Q.y,Q.z,r)}return this}serialize(I){super.serialize(I),I.subdivisionsX=this._subdivisionsX,I.subdivisionsY=this._subdivisionsY,I.minX=this._minX,I.maxX=this._maxX,I.ES=this._minZ,I.maxZ=this._maxZ,I.width=this._width,I.height=this._height}static Parse(I,O){const C=new U(I.name,O);return C._subdivisionsX=I.subdivisionsX||1,C._subdivisionsY=I.subdivisionsY||1,C._minX=I.minX,C._maxX=I.maxX,C._minZ=I.ES,C._maxZ=I.maxZ,C._width=I.width,C._height=I.height,C}}var p=C(12083),N=C(12132),Q=C(12274),s=C(12318);function Z(I){const O=[],C=[],K=[],i=[];let S,U;const p=I.width||I.size||1,N=I.height||I.size||1,Q=0|(I.subdivisionsX||I.subdivisions||1),Z=0|(I.subdivisionsY||I.subdivisions||1);for(S=0;S<=Z;S++)for(U=0;U<=Q;U++){const I=new j.mC(U*p/Q-p/2,0,(Z-S)*N/Z-N/2),O=new j.mC(0,1,0);C.push(I.x,I.y,I.z),K.push(O.x,O.y,O.z),i.push(U/Q,s.b?S/Z:1-S/Z)}for(S=0;S<Z;S++)for(U=0;U<Q;U++)O.push(U+1+(S+1)*(Q+1)),O.push(U+1+S*(Q+1)),O.push(U+S*(Q+1)),O.push(U+(S+1)*(Q+1)),O.push(U+1+(S+1)*(Q+1)),O.push(U+S*(Q+1));const q=new y.e;return q.indices=O,q.TI=C,q.HI=K,q.aI=i,q}function q(I){const O=void 0!==I.xmin&&null!==I.xmin?I.xmin:-1,C=void 0!==I.zmin&&null!==I.zmin?I.zmin:-1,K=void 0!==I.xmax&&null!==I.xmax?I.xmax:1,i=void 0!==I.zmax&&null!==I.zmax?I.zmax:1,S=I.subdivisions||{w:1,h:1},U=I.precision||{w:1,h:1},p=[],N=[],Q=[],s=[];let Z,q,mI,E;S.h=S.h<1?1:S.h,S.w=S.w<1?1:S.w,U.w=U.w<1?1:U.w,U.h=U.h<1?1:U.h;const h=(K-O)/S.w,r=(i-C)/S.h;function W(I,O,C,K){const i=N.length/3,y=U.w+1;for(Z=0;Z<U.h;Z++)for(q=0;q<U.w;q++){const I=[i+q+Z*y,i+(q+1)+Z*y,i+(q+1)+(Z+1)*y,i+q+(Z+1)*y];p.push(I[1]),p.push(I[2]),p.push(I[3]),p.push(I[0]),p.push(I[1]),p.push(I[3])}const S=j.mC.Zero(),mI=new j.mC(0,1,0);for(Z=0;Z<=U.h;Z++)for(S.z=Z*(K-O)/U.h+O,q=0;q<=U.w;q++)S.x=q*(C-I)/U.w+I,S.y=0,N.push(S.x,S.y,S.z),Q.push(mI.x,mI.y,mI.z),s.push(q/U.w,Z/U.h)}for(mI=0;mI<S.h;mI++)for(E=0;E<S.w;E++)W(O+E*h,C+mI*r,O+(E+1)*h,C+(mI+1)*r);const Y=new y.e;return Y.indices=p,Y.TI=N,Y.HI=Q,Y.aI=s,Y}function mI(I){const O=[],C=[],i=[],S=[];let U,p;const N=I.colorFilter||new K.WO(.3,.59,.11),s=I.alphaFilter||0;let Z=!1;if(I.minHeight>I.maxHeight){Z=!0;const O=I.maxHeight;I.maxHeight=I.minHeight,I.minHeight=O}for(U=0;U<=I.subdivisions;U++)for(p=0;p<=I.subdivisions;p++){const O=new j.mC(p*I.width/I.subdivisions-I.width/2,0,(I.subdivisions-U)*I.height/I.subdivisions-I.height/2),K=4*(((O.x+I.width/2)/I.width*(I.bufferWidth-1)|0)+((1-(O.z+I.height/2)/I.height)*(I.bufferHeight-1)|0)*I.bufferWidth);let y=I.buffer[K]/255,q=I.buffer[K+1]/255,mI=I.buffer[K+2]/255;const E=I.buffer[K+3]/255;Z&&(y=1-y,q=1-q,mI=1-mI);const h=y*N.r+q*N.g+mI*N.b;O.y=E>=s?I.minHeight+(I.maxHeight-I.minHeight)*h:I.minHeight-Q.d,I.heightBuffer&&(I.heightBuffer[U*(I.subdivisions+1)+p]=O.y),C.push(O.x,O.y,O.z),i.push(0,0,0),S.push(p/I.subdivisions,1-U/I.subdivisions)}for(U=0;U<I.subdivisions;U++)for(p=0;p<I.subdivisions;p++){const j=p+1+(U+1)*(I.subdivisions+1),K=p+1+U*(I.subdivisions+1),i=p+U*(I.subdivisions+1),y=p+(U+1)*(I.subdivisions+1),S=C[3*j+1]>=I.minHeight,N=C[3*K+1]>=I.minHeight,Q=C[3*i+1]>=I.minHeight;S&&N&&Q&&(O.push(j),O.push(K),O.push(i));C[3*y+1]>=I.minHeight&&S&&Q&&(O.push(y),O.push(j),O.push(i))}y.e.ComputeNormals(C,O,i);const q=new y.e;return q.indices=O,q.TI=C,q.HI=i,q.aI=S,q}function E(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=new U(I,arguments.length>2?arguments[2]:void 0);C._setReady(!1),C._subdivisionsX=O.subdivisionsX||O.subdivisions||1,C._subdivisionsY=O.subdivisionsY||O.subdivisions||1,C._width=O.width||1,C._height=O.height||1,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ;return Z(O).uI(C,O.updatable),C._setReady(!0),C}function h(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new i.c(I,C);return q(O).uI(j,O.updatable),j}function r(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=C.width||10,y=C.height||10,S=C.subdivisions||1,Q=C.minHeight||0,s=C.maxHeight||1,Z=C.colorFilter||new K.WO(.3,.59,.11),q=C.alphaFilter||0,E=C.updatable,h=C.onReady;j=j||N.e.LastCreatedScene;const r=new U(I,j);let W;r._subdivisionsX=S,r._subdivisionsY=S,r._width=i,r._height=y,r._maxX=r._width/2,r._maxZ=r._height/2,r._minX=-r._maxX,r._minZ=-r._maxZ,r._setReady(!1),C.passHeightBufferInCallback&&(W=new Float32Array((S+1)*(S+1)));const Y=(I,O,C)=>{mI({width:i,height:y,subdivisions:S,minHeight:Q,maxHeight:s,colorFilter:Z,buffer:I,bufferWidth:O,bufferHeight:C,alphaFilter:q,heightBuffer:W}).uI(r,E),h&&h(r,W),r._setReady(!0)};if("string"===typeof O){const I=I=>{var O;const C=I.width,K=I.height;if(j.p)return;const i=null===(O=j)||void 0===O?void 0:O.getEngine().resizeImageBitmap(I,C,K);Y(i,C,K)};p.Tools.LoadImage(O,I,C.onError?C.onError:()=>{},j.offlineProvider)}else Y(O.data,O.width,O.height);return r}y.e.CreateGround=Z,y.e.CreateTiledGround=q,y.e.CreateGroundFromHeightMap=mI,i.c.CreateGround=(I,O,C,j,K,i)=>E(I,{width:O,height:C,subdivisions:j,updatable:i},K),i.c.CreateTiledGround=(I,O,C,j,K,i,y,S,U)=>h(I,{xmin:O,zmin:C,xmax:j,zmax:K,subdivisions:i,precision:y,updatable:U},S),i.c.CreateGroundFromHeightMap=(I,O,C,j,K,i,y,S,U,p,N)=>r(I,O,{width:C,height:j,subdivisions:K,minHeight:i,maxHeight:y,updatable:U,onReady:p,alphaFilter:N},S)},14082:(I,O,C)=>{"use strict";C.d(O,{b:()=>Z,d:()=>Q,g:()=>s});var j=C(12272),K=C(12671),i=C(12665),y=C(12781),S=C(12329),U=C(12103);function p(I){const O=[],C=[],j=I.lines,K=I.bI,y=[];let S=0;for(let i=0;i<j.length;i++){const I=j[i];for(let j=0;j<I.length;j++){const{x:U,y:p,z:N}=I[j];if(C.push(U,p,N),K){const I=K[i],{r:O,g:C,b:S,a:U}=I[j];y.push(O,C,S,U)}j>0&&(O.push(S-1),O.push(S)),S++}}const U=new i.e;return U.indices=O,U.TI=C,K&&(U.bI=y),U}function N(I){const O=I.dashSize||3,C=I.gapSize||1,K=I.dashNb||200,y=I.points,S=[],U=[],p=j.mC.Zero();let N=0,Q=0,s=0,Z=0,q=0,mI=0,E=0;for(E=0;E<y.length-1;E++)y[E+1].subtractToRef(y[E],p),N+=p.length();for(s=N/K,Z=O*s/(O+C),E=0;E<y.length-1;E++){y[E+1].subtractToRef(y[E],p),Q=Math.floor(p.length()/s),p.normalize();for(let I=0;I<Q;I++)q=s*I,S.push(y[E].x+q*p.x,y[E].y+q*p.y,y[E].z+q*p.z),S.push(y[E].x+(q+Z)*p.x,y[E].y+(q+Z)*p.y,y[E].z+(q+Z)*p.z),U.push(mI,mI+1),mI+=2}const h=new i.e;return h.TI=S,h.indices=U,h}function Q(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=O.instance,K=O.lines,i=O.bI;if(j){const I=j.getVerticesData(S.e.PositionKind);let O,C;i&&(O=j.getVerticesData(S.e.ColorKind));let y=0,U=0;for(let j=0;j<K.length;j++){const S=K[j];for(let K=0;K<S.length;K++)I[y]=S[K].x,I[y+1]=S[K].y,I[y+2]=S[K].z,i&&O&&(C=i[j],O[U]=C[K].r,O[U+1]=C[K].g,O[U+2]=C[K].b,O[U+3]=C[K].a,U+=4),y+=3}return j.updateVerticesData(S.e.PositionKind,I,!1,!1),i&&O&&j.updateVerticesData(S.e.ColorKind,O,!1,!1),j.refreshBoundingInfo(),j}const U=!!i,N=new y.c(I,C,null,void 0,void 0,U,O.useVertexAlpha,O.material);return p(O).uI(N,O.updatable),N}function s(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=O.bI?[O.bI]:null;return Q(I,{lines:[O.points],updatable:O.updatable,instance:O.instance,bI:j,useVertexAlpha:O.useVertexAlpha,material:O.material},C)}function Z(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=O.points,S=O.instance,p=O.gapSize||1,Q=O.dashSize||3;if(S){const I=I=>{const O=j.mC.Zero(),C=I.length/6;let K=0,y=0,U=0,p=0,N=0,Q=0,s=0,Z=0;for(s=0;s<i.length-1;s++)i[s+1].subtractToRef(i[s],O),K+=O.length();U=K/C;const q=S._creationDataStorage.dashSize;for(p=q*U/(q+S._creationDataStorage.gapSize),s=0;s<i.length-1;s++)for(i[s+1].subtractToRef(i[s],O),y=Math.floor(O.length()/U),O.normalize(),Z=0;Z<y&&Q<I.length;)N=U*Z,I[Q]=i[s].x+N*O.x,I[Q+1]=i[s].y+N*O.y,I[Q+2]=i[s].z+N*O.z,I[Q+3]=i[s].x+(N+p)*O.x,I[Q+4]=i[s].y+(N+p)*O.y,I[Q+5]=i[s].z+(N+p)*O.z,Q+=6,Z++;for(;Q<I.length;)I[Q]=i[s].x,I[Q+1]=i[s].y,I[Q+2]=i[s].z,Q+=3};return(O.dashNb||O.dashSize||O.gapSize||O.useVertexAlpha||O.material)&&U.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),S.updateMeshPositions(I,!1),S}const s=new y.c(I,C,null,void 0,void 0,void 0,O.useVertexAlpha,O.material);return N(O).uI(s,O.updatable),s._creationDataStorage=new K.g,s._creationDataStorage.dashSize=Q,s._creationDataStorage.gapSize=p,s}i.e.CreateLineSystem=p,i.e.CreateDashedLines=N,K.c.Wp=function(I,O){return s(I,{points:O,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},K.c.CreateDashedLines=function(I,O,C,j,K){return Z(I,{points:O,dashSize:C,gapSize:j,dashNb:K,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13433:(I,O,C)=>{"use strict";C.d(O,{d:()=>S,g:()=>U});var j=C(12671),K=C(12665),i=C(12318);function y(I){const O=[],C=[],j=[],y=[],S=void 0!==I.width?I.width:void 0!==I.size?I.size:1,U=void 0!==I.height?I.height:void 0!==I.size?I.size:1,p=0===I.sideOrientation?0:I.sideOrientation||K.e.DEFAULTSIDE,N=S/2,Q=U/2;C.push(-N,-Q,0),j.push(0,0,-1),y.push(0,i.b?1:0),C.push(N,-Q,0),j.push(0,0,-1),y.push(1,i.b?1:0),C.push(N,Q,0),j.push(0,0,-1),y.push(1,i.b?0:1),C.push(-N,Q,0),j.push(0,0,-1),y.push(0,i.b?0:1),O.push(0),O.push(1),O.push(2),O.push(0),O.push(2),O.push(3),K.e._ComputeSides(p,C,O,j,y,I.frontUVs,I.backUVs);const s=new K.e;return s.indices=O,s.TI=C,s.HI=j,s.aI=y,s}function S(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=new j.c(I,C);O.sideOrientation=j.c._GetDefaultSideOrientation(O.sideOrientation),K._originalBuilderSideOrientation=O.sideOrientation;return y(O).uI(K,O.updatable),O.sourcePlane&&(K.translate(O.sourcePlane.normal,-O.sourcePlane.d),K.setDirection(O.sourcePlane.normal.scale(-1))),K}const U={cp:S};K.e.cp=y,j.c.cp=(I,O,C,j,K)=>S(I,{size:O,width:O,height:O,sideOrientation:K,updatable:j},C)},13525:(I,O,C)=>{"use strict";C.d(O,{c:()=>U});var j=C(12272),K=C(12671),i=C(12665),y=C(12318);function S(I){const O=0|(I.segments||32),C=I.diameterX||I.diameter||1,K=I.diameterY||I.diameter||1,S=I.diameterZ||I.diameter||1,U=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1,p=I.slice&&I.slice<=0?1:I.slice||1,N=0===I.sideOrientation?0:I.sideOrientation||i.e.DEFAULTSIDE,Q=!!I.dedupTopBottomIndices,s=new j.mC(C/2,K/2,S/2),Z=2+O,q=2*Z,mI=[],E=[],h=[],r=[];for(let i=0;i<=Z;i++){const I=i/Z,O=I*Math.PI*p;for(let C=0;C<=q;C++){const K=C/q,i=K*Math.PI*2*U,S=j.Matrix.RotationZ(-O),p=j.Matrix.RotationY(i),N=j.mC.TransformCoordinates(j.mC.Up(),S),Q=j.mC.TransformCoordinates(N,p),Z=Q.multiply(s),mI=Q.divide(s).normalize();E.push(Z.x,Z.y,Z.z),h.push(mI.x,mI.y,mI.z),r.push(K,y.b?1-I:I)}if(i>0){const I=E.length/3;for(let O=I-2*(q+1);O+q+2<I;O++)Q?(i>1&&(mI.push(O),mI.push(O+1),mI.push(O+q+1)),(i<Z||p<1)&&(mI.push(O+q+1),mI.push(O+1),mI.push(O+q+2))):(mI.push(O),mI.push(O+1),mI.push(O+q+1),mI.push(O+q+1),mI.push(O+1),mI.push(O+q+2))}}i.e._ComputeSides(N,E,mI,h,r,I.frontUVs,I.backUVs);const W=new i.e;return W.indices=mI,W.TI=E,W.HI=h,W.aI=r,W}function U(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new K.c(I,C);O.sideOrientation=K.c._GetDefaultSideOrientation(O.sideOrientation),j._originalBuilderSideOrientation=O.sideOrientation;return S(O).uI(j,O.updatable),j}i.e.CreateSphere=S,K.c.CreateSphere=(I,O,C,j,K,i)=>U(I,{segments:O,diameterX:C,diameterY:C,diameterZ:C,sideOrientation:i,updatable:K},j)},14376:(I,O,C)=>{"use strict";C.d(O,{b:()=>S});var j=C(12805),K=C(13850),i=C(12819),y=C(12665);class S{static get Configuration(){return{get decoder(){return K.b.DefaultConfiguration},set decoder(I){K.b.DefaultConfiguration=I}}}static set Configuration(I){K.b.DefaultConfiguration=I.decoder}static get DecoderAvailable(){return(0,j.g)(K.b.DefaultConfiguration)}static get Default(){return S._Default??(S._Default=new S),S._Default}static ResetDefault(I){S._Default&&(I||S._Default.dispose(),S._Default=null)}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.DefaultNumWorkers;const O="number"===typeof I?{...K.b.DefaultConfiguration,numWorkers:I}:{...K.b.DefaultConfiguration,...I};this._decoder=new K.b(O)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(I,O,C){return this._decoder.decodeMeshToMeshDataAsync(I,O,C)}async decodeMeshToGeometryAsync(I,O,C,j){return await this._decoder.decodeMeshToGeometryAsync(I,O,C,j)}async _decodeMeshToGeometryForGltfAsync(I,O,C,j,K,i){return await this._decoder._decodeMeshToGeometryForGltfAsync(I,O,C,j,K,i)}async decodeMeshAsync(I,O){const C=await this._decoder.decodeMeshToMeshDataAsync(I,O),j=new y.e;C.indices&&(j.indices=C.indices);for(const K of C.attributes){const I=i.d.GetFloatData(K.data,K.size,i.d.GetDataType(K.data),K.byteOffset,K.byteStride,K.normalized,C.totalVertices);j.set(I,K.kind)}return j}}S.DefaultNumWorkers=(0,j.e)(),S._Default=null},13850:(I,O,C)=>{"use strict";C.d(O,{b:()=>p});var j=C(12805),K=C(12083),i=C(12682),y=C(12819),S=C(12103),U=C(12816);class p extends j.d{static get DefaultAvailable(){return(0,j.g)(p.DefaultConfiguration)}static get Default(){return p._Default??(p._Default=new p),p._Default}static ResetDefault(I){p._Default&&(I||p._Default.dispose(),p._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(I,O){return{module:await(O||DracoDecoderModule)({wasmBinary:I})}}_getWorkerContent(){return`${U.b}(${U.d})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.DefaultConfiguration)}decodeMeshToMeshDataAsync(I,O,C){const j=I instanceof ArrayBuffer?new Int8Array(I):new Int8Array(I.buffer,I.byteOffset,I.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async I=>await new Promise(((K,i)=>{I.push(((I,y)=>{let U=null;const p=[],N=O=>{I.removeEventListener("error",N),I.removeEventListener("message",Q),i(O),y()},Q=O=>{const j=O.data;switch(j.id){case"indices":U=j.data;break;case"attribute":p.push({kind:j.kind,data:j.data,size:j.size,byteOffset:j.byteOffset,byteStride:j.byteStride,normalized:(i=j.kind,s=j.normalized,C&&void 0!==C[i]?(s!==C[i]&&S.c.Warn(`Normalized flag from Draco data (${s}) does not match normalized flag from glTF accessor (${C[i]}). Using flag from glTF accessor.`),C[i]):s)});break;case"decodeMeshDone":I.removeEventListener("error",N),I.removeEventListener("message",Q),K({indices:U,attributes:p,totalVertices:j.totalVertices}),y()}var i,s};I.addEventListener("error",N),I.addEventListener("message",Q);const s=j.slice();I.postMessage({id:"decodeMesh",dataView:s,attributes:O},[s.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((I=>{let C=null;const K=[],i=(0,U.b)(I.module,j,O,(I=>{C=I}),((I,O,C,j,i,y)=>{K.push({kind:I,data:O,size:C,byteOffset:j,byteStride:i,normalized:y})}));return{indices:C,attributes:K,totalVertices:i}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(I,O,C,j){const K=await this.decodeMeshToMeshDataAsync(C,j),S=new i.b(I,O);K.indices&&S.setIndices(K.indices);for(const i of K.attributes)S.setVerticesBuffer(new y.d(O.getEngine(),i.data,i.kind,!1,void 0,i.byteStride,void 0,i.byteOffset,i.size,void 0,i.normalized,!0),K.totalVertices);return S}async _decodeMeshToGeometryForGltfAsync(I,O,C,j,K,S){const U=await this.decodeMeshToMeshDataAsync(C,j,K),p=new i.b(I,O);S&&(p._boundingInfo=S,p.useBoundingInfoFromGeometry=!0),U.indices&&p.setIndices(U.indices);for(const i of U.attributes)p.setVerticesBuffer(new y.d(O.getEngine(),i.data,i.kind,!1,void 0,i.byteStride,void 0,i.byteOffset,i.size,void 0,i.normalized,!0),U.totalVertices);return p}}p.DefaultConfiguration={wasmUrl:`${K.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${K.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${K.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},p._Default=null},14075:(I,O,C)=>{"use strict";C.d(O,{e:()=>SI});var j=C(12272),K=C(12671),i=C(12329),y=C(12665),S=C(12318);function U(I){let O=I.pathArray;const C=I.closeArray||!1,j=I.closePath||!1,K=I.invertUV||!1,U=Math.floor(O[0].length/2);let p=I.offset||U;p=p>U?U:Math.floor(p);const N=0===I.sideOrientation?0:I.sideOrientation||y.e.DEFAULTSIDE,Q=I.aI,s=I.bI,Z=[],q=[],mI=[],E=[],h=[],r=[],W=[],Y=[];let o;const c=[],n=[];let X,T,H;if(O.length<2){const I=[],C=[];for(T=0;T<O[0].length-p;T++)I.push(O[0][T]),C.push(O[0][T+p]);O=[I,C]}let b=0;const a=j?1:0,M=C?1:0;let u,J,f,l,x,D;for(o=O[0].length,X=0;X<O.length+M;X++){for(W[X]=0,h[X]=[0],u=X===O.length?O[0]:O[X],J=u.length,o=o<J?o:J,H=0;H<J;)Z.push(u[H].x,u[H].y,u[H].z),H>0&&(f=u[H].EO(u[H-1]).length(),l=f+W[X],h[X].push(l),W[X]=l),H++;j&&(H--,Z.push(u[0].x,u[0].y,u[0].z),f=u[H].EO(u[0]).length(),l=f+W[X],h[X].push(l),W[X]=l),c[X]=J+a,n[X]=b,b+=J+a}let t,d,w=null,g=null;for(T=0;T<o+a;T++)for(Y[T]=0,r[T]=[0],X=0;X<O.length-1+M;X++)x=O[X],D=X===O.length-1?O[0]:O[X+1],T===o?(w=x[0],g=D[0]):(w=x[T],g=D[T]),f=g.EO(w).length(),l=f+Y[T],r[T].push(l),Y[T]=l;if(Q)for(X=0;X<Q.length;X++)E.push(Q[X].x,S.b?1-Q[X].y:Q[X].y);else for(X=0;X<O.length+M;X++)for(T=0;T<o+a;T++)t=0!=W[X]?h[X][T]/W[X]:0,d=0!=Y[T]?r[T][X]/Y[T]:0,K?E.push(d,t):E.push(t,S.b?1-d:d);X=0;let V=0,e=c[X]-1,L=c[X+1]-1,z=e<L?e:L,k=n[1]-n[0];const A=c.length-1;for(;V<=z&&X<A;)q.push(V,V+k,V+1),q.push(V+k+1,V+1,V+k),V+=1,V===z&&(X++,k=n[X+1]-n[X],e=c[X]-1,L=c[X+1]-1,V=n[X],z=e<L?e+V:L+V);if(y.e.ComputeNormals(Z,q,mI),j){let I=0,C=0;for(X=0;X<O.length;X++){I=3*n[X],C=X+1<O.length?3*(n[X+1]-1):mI.length-3,mI[I]=.5*(mI[I]+mI[C]),mI[I+1]=.5*(mI[I+1]+mI[C+1]),mI[I+2]=.5*(mI[I+2]+mI[C+2]);const j=Math.sqrt(mI[I]*mI[I]+mI[I+1]*mI[I+1]+mI[I+2]*mI[I+2]);mI[I]/=j,mI[I+1]/=j,mI[I+2]/=j,mI[C]=mI[I],mI[C+1]=mI[I+1],mI[C+2]=mI[I+2]}}if(C){let I=3*n[0],C=3*n[O.length];for(T=0;T<o+a;T++){mI[I]=.5*(mI[I]+mI[C]),mI[I+1]=.5*(mI[I+1]+mI[C+1]),mI[I+2]=.5*(mI[I+2]+mI[C+2]);const O=Math.sqrt(mI[I]*mI[I]+mI[I+1]*mI[I+1]+mI[I+2]*mI[I+2]);mI[I]/=O,mI[I+1]/=O,mI[I+2]/=O,mI[C]=mI[I],mI[C+1]=mI[I+1],mI[C+2]=mI[I+2],I+=3,C+=3}}y.e._ComputeSides(N,Z,q,mI,E,I.frontUVs,I.backUVs);let P=null;if(s){P=new Float32Array(4*s.length);for(let I=0;I<s.length;I++)P[4*I]=s[I].r,P[4*I+1]=s[I].g,P[4*I+2]=s[I].b,P[4*I+3]=s[I].a}const v=new y.e,B=new Float32Array(Z),F=new Float32Array(mI),R=new Float32Array(E);return v.indices=q,v.TI=B,v.HI=F,v.aI=R,P&&v.set(P,i.e.ColorKind),j&&(v._idx=n),v}function p(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=O.pathArray,N=O.closeArray,Q=O.closePath,s=K.c._GetDefaultSideOrientation(O.sideOrientation),Z=O.instance,q=O.updatable;if(Z){const I=j.TmpVectors.mC[0].XS(Number.MAX_VALUE),C=j.TmpVectors.mC[1].XS(-Number.MAX_VALUE),U=O=>{let j=p[0].length;const i=Z;let y=0;const S=i._originalBuilderSideOrientation===K.c.DOUBLESIDE?2:1;for(let K=1;K<=S;++K)for(let S=0;S<p.length;++S){const K=p[S],U=K.length;j=j<U?j:U;for(let i=0;i<j;++i){const j=K[i];O[y]=j.x,O[y+1]=j.y,O[y+2]=j.z,I.minimizeInPlaceFromFloats(j.x,j.y,j.z),C.maximizeInPlaceFromFloats(j.x,j.y,j.z),y+=3}if(i._creationDataStorage&&i._creationDataStorage.closePath){const I=K[0];O[y]=I.x,O[y+1]=I.y,O[y+2]=I.z,y+=3}}},N=Z.getVerticesData(i.e.PositionKind);if(U(N),Z.hasBoundingInfo?Z.getBoundingInfo().reConstruct(I,C,Z._worldMatrix):Z.buildBoundingInfo(I,C,Z._worldMatrix),Z.updateVerticesData(i.e.PositionKind,N,!1,!1),O.bI){const I=Z.getVerticesData(i.e.ColorKind);for(let C=0,j=0;C<O.bI.length;C++,j+=4){const K=O.bI[C];I[j]=K.r,I[j+1]=K.g,I[j+2]=K.b,I[j+3]=K.a}Z.updateVerticesData(i.e.ColorKind,I,!1,!1)}if(O.aI){const I=Z.getVerticesData(i.e.UVKind);for(let C=0;C<O.aI.length;C++)I[2*C]=O.aI[C].x,I[2*C+1]=S.b?1-O.aI[C].y:O.aI[C].y;Z.updateVerticesData(i.e.UVKind,I,!1,!1)}if(!Z.areNormalsFrozen||Z.isFacetDataEnabled){const I=Z.YS(),O=Z.getVerticesData(i.e.NormalKind),C=Z.isFacetDataEnabled?Z.getFacetDataParameters():null;if(y.e.ComputeNormals(N,I,O,C),Z._creationDataStorage&&Z._creationDataStorage.closePath){let I=0,C=0;for(let j=0;j<p.length;j++)I=3*Z._creationDataStorage.idx[j],C=j+1<p.length?3*(Z._creationDataStorage.idx[j+1]-1):O.length-3,O[I]=.5*(O[I]+O[C]),O[I+1]=.5*(O[I+1]+O[C+1]),O[I+2]=.5*(O[I+2]+O[C+2]),O[C]=O[I],O[C+1]=O[I+1],O[C+2]=O[I+2]}Z.areNormalsFrozen||Z.updateVerticesData(i.e.NormalKind,O,!1,!1)}return Z}{const j=new K.c(I,C);j._originalBuilderSideOrientation=s,j._creationDataStorage=new K.g;const i=U(O);return Q&&(j._creationDataStorage.idx=i._idx),j._creationDataStorage.closePath=Q,j._creationDataStorage.closeArray=N,i.uI(j,q),j}}y.e.CreateRibbon=U,K.c.CreateRibbon=function(I,O){return p(I,{pathArray:O,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var N=C(13535),Q=C(13381),s=C(12307);function Z(I){const O=I.pattern||K.c.NO_FLIP,C=I.tileWidth||I.tileSize||1,j=I.tileHeight||I.tileSize||1,i=I.alignHorizontal||0,S=I.alignVertical||0,U=I.width||I.size||1,p=Math.floor(U/C);let N=U-p*C;const Q=I.height||I.size||1,s=Math.floor(Q/j);let Z=Q-s*j;const q=C*p/2,mI=j*s/2;let E=0,h=0,r=0,W=0,Y=0,o=0;if(N>0||Z>0){switch(r=-q,W=-mI,Y=q,o=mI,i){case K.c.CENTER:N/=2,r-=N,Y+=N;break;case K.c.LEFT:Y+=N,E=-N/2;break;case K.c.RIGHT:r-=N,E=N/2}switch(S){case K.c.CENTER:Z/=2,W-=Z,o+=Z;break;case K.c.BOTTOM:o+=Z,h=-Z/2;break;case K.c.TOP:W-=Z,h=Z/2}}const c=[],n=[],X=[];X[0]=[0,0,1,0,1,1,0,1],X[1]=[0,0,1,0,1,1,0,1],O!==K.c.ROTATE_TILE&&O!==K.c.ROTATE_ROW||(X[1]=[1,1,0,1,0,0,1,0]),O!==K.c.FLIP_TILE&&O!==K.c.FLIP_ROW||(X[1]=[1,0,0,0,0,1,1,1]),O!==K.c.FLIP_N_ROTATE_TILE&&O!==K.c.FLIP_N_ROTATE_ROW||(X[1]=[0,1,1,1,1,0,0,0]);let T=[];const H=[],b=[];let a=0;for(let y=0;y<s;y++)for(let I=0;I<p;I++)c.push(I*C-q+E,y*j-mI+h,0),c.push((I+1)*C-q+E,y*j-mI+h,0),c.push((I+1)*C-q+E,(y+1)*j-mI+h,0),c.push(I*C-q+E,(y+1)*j-mI+h,0),b.push(a,a+1,a+3,a+1,a+2,a+3),T=O===K.c.FLIP_TILE||O===K.c.ROTATE_TILE||O===K.c.FLIP_N_ROTATE_TILE?T.concat(X[(I%2+y%2)%2]):O===K.c.FLIP_ROW||O===K.c.ROTATE_ROW||O===K.c.FLIP_N_ROTATE_ROW?T.concat(X[y%2]):T.concat(X[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),a+=4;if(N>0||Z>0){const I=Z>0&&(S===K.c.CENTER||S===K.c.TOP),y=Z>0&&(S===K.c.CENTER||S===K.c.BOTTOM),U=N>0&&(i===K.c.CENTER||i===K.c.RIGHT),Q=N>0&&(i===K.c.CENTER||i===K.c.LEFT);let X,M,u,J,f=[];if(I&&U&&(c.push(r+E,W+h,0),c.push(-q+E,W+h,0),c.push(-q+E,W+Z+h,0),c.push(r+E,W+Z+h,0),b.push(a,a+1,a+3,a+1,a+2,a+3),a+=4,X=1-N/C,M=1-Z/j,u=1,J=1,f=[X,M,u,M,u,J,X,J],O===K.c.ROTATE_ROW&&(f=[1-X,1-M,1-u,1-M,1-u,1-J,1-X,1-J]),O===K.c.FLIP_ROW&&(f=[1-X,M,1-u,M,1-u,J,1-X,J]),O===K.c.FLIP_N_ROTATE_ROW&&(f=[X,1-M,u,1-M,u,1-J,X,1-J]),T=T.concat(f),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),I&&Q&&(c.push(q+E,W+h,0),c.push(Y+E,W+h,0),c.push(Y+E,W+Z+h,0),c.push(q+E,W+Z+h,0),b.push(a,a+1,a+3,a+1,a+2,a+3),a+=4,X=0,M=1-Z/j,u=N/C,J=1,f=[X,M,u,M,u,J,X,J],(O===K.c.ROTATE_ROW||O===K.c.ROTATE_TILE&&p%2===0)&&(f=[1-X,1-M,1-u,1-M,1-u,1-J,1-X,1-J]),(O===K.c.FLIP_ROW||O===K.c.FLIP_TILE&&p%2===0)&&(f=[1-X,M,1-u,M,1-u,J,1-X,J]),(O===K.c.FLIP_N_ROTATE_ROW||O===K.c.FLIP_N_ROTATE_TILE&&p%2===0)&&(f=[X,1-M,u,1-M,u,1-J,X,1-J]),T=T.concat(f),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y&&U&&(c.push(r+E,mI+h,0),c.push(-q+E,mI+h,0),c.push(-q+E,o+h,0),c.push(r+E,o+h,0),b.push(a,a+1,a+3,a+1,a+2,a+3),a+=4,X=1-N/C,M=0,u=1,J=Z/j,f=[X,M,u,M,u,J,X,J],(O===K.c.ROTATE_ROW&&s%2===1||O===K.c.ROTATE_TILE&&s%1===0)&&(f=[1-X,1-M,1-u,1-M,1-u,1-J,1-X,1-J]),(O===K.c.FLIP_ROW&&s%2===1||O===K.c.FLIP_TILE&&s%2===0)&&(f=[1-X,M,1-u,M,1-u,J,1-X,J]),(O===K.c.FLIP_N_ROTATE_ROW&&s%2===1||O===K.c.FLIP_N_ROTATE_TILE&&s%2===0)&&(f=[X,1-M,u,1-M,u,1-J,X,1-J]),T=T.concat(f),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y&&Q&&(c.push(q+E,mI+h,0),c.push(Y+E,mI+h,0),c.push(Y+E,o+h,0),c.push(q+E,o+h,0),b.push(a,a+1,a+3,a+1,a+2,a+3),a+=4,X=0,M=0,u=N/C,J=Z/j,f=[X,M,u,M,u,J,X,J],(O===K.c.ROTATE_ROW&&s%2===1||O===K.c.ROTATE_TILE&&(s+p)%2===1)&&(f=[1-X,1-M,1-u,1-M,1-u,1-J,1-X,1-J]),(O===K.c.FLIP_ROW&&s%2===1||O===K.c.FLIP_TILE&&(s+p)%2===1)&&(f=[1-X,M,1-u,M,1-u,J,1-X,J]),(O===K.c.FLIP_N_ROTATE_ROW&&s%2===1||O===K.c.FLIP_N_ROTATE_TILE&&(s+p)%2===1)&&(f=[X,1-M,u,1-M,u,1-J,X,1-J]),T=T.concat(f),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),I){const I=[];X=0,M=1-Z/j,u=1,J=1,I[0]=[X,M,u,M,u,J,X,J],I[1]=[X,M,u,M,u,J,X,J],O!==K.c.ROTATE_TILE&&O!==K.c.ROTATE_ROW||(I[1]=[1-X,1-M,1-u,1-M,1-u,1-J,1-X,1-J]),O!==K.c.FLIP_TILE&&O!==K.c.FLIP_ROW||(I[1]=[1-X,M,1-u,M,1-u,J,1-X,J]),O!==K.c.FLIP_N_ROTATE_TILE&&O!==K.c.FLIP_N_ROTATE_ROW||(I[1]=[X,1-M,u,1-M,u,1-J,X,1-J]);for(let j=0;j<p;j++)c.push(j*C-q+E,W+h,0),c.push((j+1)*C-q+E,W+h,0),c.push((j+1)*C-q+E,W+Z+h,0),c.push(j*C-q+E,W+Z+h,0),b.push(a,a+1,a+3,a+1,a+2,a+3),a+=4,T=O===K.c.FLIP_TILE||O===K.c.ROTATE_TILE||O===K.c.FLIP_N_ROTATE_TILE?T.concat(I[(j+1)%2]):O===K.c.FLIP_ROW||O===K.c.ROTATE_ROW||O===K.c.FLIP_N_ROTATE_ROW?T.concat(I[1]):T.concat(I[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(y){const I=[];X=0,M=0,u=1,J=Z/j,I[0]=[X,M,u,M,u,J,X,J],I[1]=[X,M,u,M,u,J,X,J],O!==K.c.ROTATE_TILE&&O!==K.c.ROTATE_ROW||(I[1]=[1-X,1-M,1-u,1-M,1-u,1-J,1-X,1-J]),O!==K.c.FLIP_TILE&&O!==K.c.FLIP_ROW||(I[1]=[1-X,M,1-u,M,1-u,J,1-X,J]),O!==K.c.FLIP_N_ROTATE_TILE&&O!==K.c.FLIP_N_ROTATE_ROW||(I[1]=[X,1-M,u,1-M,u,1-J,X,1-J]);for(let j=0;j<p;j++)c.push(j*C-q+E,o-Z+h,0),c.push((j+1)*C-q+E,o-Z+h,0),c.push((j+1)*C-q+E,o+h,0),c.push(j*C-q+E,o+h,0),b.push(a,a+1,a+3,a+1,a+2,a+3),a+=4,T=O===K.c.FLIP_TILE||O===K.c.ROTATE_TILE||O===K.c.FLIP_N_ROTATE_TILE?T.concat(I[(j+s)%2]):O===K.c.FLIP_ROW||O===K.c.ROTATE_ROW||O===K.c.FLIP_N_ROTATE_ROW?T.concat(I[s%2]):T.concat(I[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(U){const I=[];X=1-N/C,M=0,u=1,J=1,I[0]=[X,M,u,M,u,J,X,J],I[1]=[X,M,u,M,u,J,X,J],O!==K.c.ROTATE_TILE&&O!==K.c.ROTATE_ROW||(I[1]=[1-X,1-M,1-u,1-M,1-u,1-J,1-X,1-J]),O!==K.c.FLIP_TILE&&O!==K.c.FLIP_ROW||(I[1]=[1-X,M,1-u,M,1-u,J,1-X,J]),O!==K.c.FLIP_N_ROTATE_TILE&&O!==K.c.FLIP_N_ROTATE_ROW||(I[1]=[X,1-M,u,1-M,u,1-J,X,1-J]);for(let C=0;C<s;C++)c.push(r+E,C*j-mI+h,0),c.push(r+N+E,C*j-mI+h,0),c.push(r+N+E,(C+1)*j-mI+h,0),c.push(r+E,(C+1)*j-mI+h,0),b.push(a,a+1,a+3,a+1,a+2,a+3),a+=4,T=O===K.c.FLIP_TILE||O===K.c.ROTATE_TILE||O===K.c.FLIP_N_ROTATE_TILE?T.concat(I[(C+1)%2]):O===K.c.FLIP_ROW||O===K.c.ROTATE_ROW||O===K.c.FLIP_N_ROTATE_ROW?T.concat(I[C%2]):T.concat(I[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Q){const I=[];X=0,M=0,u=N/j,J=1,I[0]=[X,M,u,M,u,J,X,J],I[1]=[X,M,u,M,u,J,X,J],O!==K.c.ROTATE_TILE&&O!==K.c.ROTATE_ROW||(I[1]=[1-X,1-M,1-u,1-M,1-u,1-J,1-X,1-J]),O!==K.c.FLIP_TILE&&O!==K.c.FLIP_ROW||(I[1]=[1-X,M,1-u,M,1-u,J,1-X,J]),O!==K.c.FLIP_N_ROTATE_TILE&&O!==K.c.FLIP_N_ROTATE_ROW||(I[1]=[X,1-M,u,1-M,u,1-J,X,1-J]);for(let C=0;C<s;C++)c.push(Y-N+E,C*j-mI+h,0),c.push(Y+E,C*j-mI+h,0),c.push(Y+E,(C+1)*j-mI+h,0),c.push(Y-N+E,(C+1)*j-mI+h,0),b.push(a,a+1,a+3,a+1,a+2,a+3),a+=4,T=O===K.c.FLIP_TILE||O===K.c.ROTATE_TILE||O===K.c.FLIP_N_ROTATE_TILE?T.concat(I[(C+p)%2]):O===K.c.FLIP_ROW||O===K.c.ROTATE_ROW||O===K.c.FLIP_N_ROTATE_ROW?T.concat(I[C%2]):T.concat(I[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const M=0===I.sideOrientation?0:I.sideOrientation||y.e.DEFAULTSIDE;y.e._ComputeSides(M,c,b,n,T,I.frontUVs,I.backUVs);const u=new y.e;u.indices=b,u.TI=c,u.HI=n,u.aI=T;const J=M===y.e.DOUBLESIDE?H.concat(H):H;return u.bI=J,u}function q(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new K.c(I,C);O.sideOrientation=K.c._GetDefaultSideOrientation(O.sideOrientation),j._originalBuilderSideOrientation=O.sideOrientation;return Z(O).uI(j,O.updatable),j}function mI(I){const O=I.faceUV||new Array(6),C=I.faceColors,i=I.pattern||K.c.NO_FLIP,U=I.width||I.size||1,p=I.height||I.size||1,N=I.depth||I.size||1,Q=I.tileWidth||I.tileSize||1,q=I.tileHeight||I.tileSize||1,mI=I.alignHorizontal||0,E=I.alignVertical||0,h=0===I.sideOrientation?0:I.sideOrientation||y.e.DEFAULTSIDE;for(let K=0;K<6;K++)void 0===O[K]&&(O[K]=new j.Vector4(0,0,1,1)),C&&void 0===C[K]&&(C[K]=new s.TS(1,1,1,1));const r=U/2,W=p/2,Y=N/2,o=[];for(let j=0;j<2;j++)o[j]=Z({pattern:i,tileWidth:Q,tileHeight:q,width:U,height:p,alignVertical:E,alignHorizontal:mI,sideOrientation:h});for(let j=2;j<4;j++)o[j]=Z({pattern:i,tileWidth:Q,tileHeight:q,width:N,height:p,alignVertical:E,alignHorizontal:mI,sideOrientation:h});let c=E;E===K.c.BOTTOM?c=K.c.TOP:E===K.c.TOP&&(c=K.c.BOTTOM);for(let j=4;j<6;j++)o[j]=Z({pattern:i,tileWidth:Q,tileHeight:q,width:U,height:N,alignVertical:c,alignHorizontal:mI,sideOrientation:h});let n=[],X=[],T=[],H=[];const b=[],a=[],M=[],u=[];let J=0,f=0;for(let K=0;K<6;K++){const I=o[K].TI.length;a[K]=[],M[K]=[];for(let O=0;O<I/3;O++)a[K].push(new j.mC(o[K].TI[3*O],o[K].TI[3*O+1],o[K].TI[3*O+2])),M[K].push(new j.mC(o[K].HI[3*O],o[K].HI[3*O+1],o[K].HI[3*O+2]));J=o[K].aI.length,u[K]=[];for(let C=0;C<J;C+=2)u[K][C]=O[K].x+(O[K].z-O[K].x)*o[K].aI[C],u[K][C+1]=O[K].y+(O[K].w-O[K].y)*o[K].aI[C+1],S.b&&(u[K][C+1]=1-u[K][C+1]);if(T=T.concat(u[K]),H=H.concat(o[K].indices.map((I=>I+f))),f+=a[K].length,C)for(let O=0;O<4;O++)b.push(C[K].r,C[K].g,C[K].b,C[K].a)}const l=new j.mC(0,0,Y),x=j.Matrix.RotationY(Math.PI);n=a[0].map((I=>j.mC.TransformNormal(I,x).add(l))).map((I=>[I.x,I.y,I.z])).reduce(((I,O)=>I.concat(O)),[]),X=M[0].map((I=>j.mC.TransformNormal(I,x))).map((I=>[I.x,I.y,I.z])).reduce(((I,O)=>I.concat(O)),[]),n=n.concat(a[1].map((I=>I.EO(l))).map((I=>[I.x,I.y,I.z])).reduce(((I,O)=>I.concat(O)),[])),X=X.concat(M[1].map((I=>[I.x,I.y,I.z])).reduce(((I,O)=>I.concat(O)),[]));const D=new j.mC(r,0,0),t=j.Matrix.RotationY(-Math.PI/2);n=n.concat(a[2].map((I=>j.mC.TransformNormal(I,t).add(D))).map((I=>[I.x,I.y,I.z])).reduce(((I,O)=>I.concat(O)),[])),X=X.concat(M[2].map((I=>j.mC.TransformNormal(I,t))).map((I=>[I.x,I.y,I.z])).reduce(((I,O)=>I.concat(O)),[]));const d=j.Matrix.RotationY(Math.PI/2);n=n.concat(a[3].map((I=>j.mC.TransformNormal(I,d).EO(D))).map((I=>[I.x,I.y,I.z])).reduce(((I,O)=>I.concat(O)),[])),X=X.concat(M[3].map((I=>j.mC.TransformNormal(I,d))).map((I=>[I.x,I.y,I.z])).reduce(((I,O)=>I.concat(O)),[]));const w=new j.mC(0,W,0),g=j.Matrix.RotationX(Math.PI/2);n=n.concat(a[4].map((I=>j.mC.TransformNormal(I,g).add(w))).map((I=>[I.x,I.y,I.z])).reduce(((I,O)=>I.concat(O)),[])),X=X.concat(M[4].map((I=>j.mC.TransformNormal(I,g))).map((I=>[I.x,I.y,I.z])).reduce(((I,O)=>I.concat(O)),[]));const V=j.Matrix.RotationX(-Math.PI/2);n=n.concat(a[5].map((I=>j.mC.TransformNormal(I,V).EO(w))).map((I=>[I.x,I.y,I.z])).reduce(((I,O)=>I.concat(O)),[])),X=X.concat(M[5].map((I=>j.mC.TransformNormal(I,V))).map((I=>[I.x,I.y,I.z])).reduce(((I,O)=>I.concat(O)),[])),y.e._ComputeSides(h,n,H,X,T);const e=new y.e;if(e.indices=H,e.TI=n,e.HI=X,e.aI=T,C){const I=h===y.e.DOUBLESIDE?b.concat(b):b;e.bI=I}return e}function E(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new K.c(I,C);O.sideOrientation=K.c._GetDefaultSideOrientation(O.sideOrientation),j._originalBuilderSideOrientation=O.sideOrientation;return mI(O).uI(j,O.updatable),j}y.e.CreateTiledPlane=Z;y.e.CreateTiledBox=mI;var h=C(13525),r=C(12487),W=C(12453);function Y(I){const O=I.height||2;let C=0===I.diameterTop?0:I.diameterTop||I.diameter||1,i=0===I.diameterBottom?0:I.diameterBottom||I.diameter||1;C=C||1e-5,i=i||1e-5;const U=0|(I.tessellation||24),p=0|(I.subdivisions||1),N=!!I.hasRings,Q=!!I.enclose,Z=0===I.cap?0:I.cap||K.c.CAP_ALL,q=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1,mI=0===I.sideOrientation?0:I.sideOrientation||y.e.DEFAULTSIDE,E=I.faceUV||new Array(3),h=I.faceColors,r=2+(1+(1!==q&&Q?2:0))*(N?p:1);let Y;for(Y=0;Y<r;Y++)h&&void 0===h[Y]&&(h[Y]=new s.TS(1,1,1,1));for(Y=0;Y<r;Y++)E&&void 0===E[Y]&&(E[Y]=new j.Vector4(0,0,1,1));const o=[],c=[],n=[],X=[],T=[],H=2*Math.PI*q/U;let b,a,M;const u=(i-C)/2/O,J=j.mC.Zero(),f=j.mC.Zero(),l=j.mC.Zero(),x=j.mC.Zero(),D=j.mC.Zero(),t=W.b.Y;let d,w,g,V=1,e=1,L=0,z=0;for(d=0;d<=p;d++)for(a=d/p,M=(a*(C-i)+i)/2,V=N&&0!==d&&d!==p?2:1,g=0;g<V;g++){for(N&&(e+=g),Q&&(e+=2*g),w=0;w<=U;w++)b=w*H,J.x=Math.cos(-b)*M,J.y=-O/2+a*O,J.z=Math.sin(-b)*M,0===C&&d===p?(f.x=n[n.length-3*(U+1)],f.y=n[n.length-3*(U+1)+1],f.z=n[n.length-3*(U+1)+2]):(f.x=J.x,f.z=J.z,f.y=Math.sqrt(f.x*f.x+f.z*f.z)*u,f.normalize()),0===w&&(l.K(J),x.K(f)),c.push(J.x,J.y,J.z),n.push(f.x,f.y,f.z),z=N?L!==e?E[e].y:E[e].w:E[e].y+(E[e].w-E[e].y)*a,X.push(E[e].x+(E[e].z-E[e].x)*w/U,S.b?1-z:z),h&&T.push(h[e].r,h[e].g,h[e].b,h[e].a);1!==q&&Q&&(c.push(J.x,J.y,J.z),c.push(0,J.y,0),c.push(0,J.y,0),c.push(l.x,l.y,l.z),j.mC.CrossToRef(t,f,D),D.normalize(),n.push(D.x,D.y,D.z,D.x,D.y,D.z),j.mC.CrossToRef(x,t,D),D.normalize(),n.push(D.x,D.y,D.z,D.x,D.y,D.z),z=N?L!==e?E[e+1].y:E[e+1].w:E[e+1].y+(E[e+1].w-E[e+1].y)*a,X.push(E[e+1].x,S.b?1-z:z),X.push(E[e+1].z,S.b?1-z:z),z=N?L!==e?E[e+2].y:E[e+2].w:E[e+2].y+(E[e+2].w-E[e+2].y)*a,X.push(E[e+2].x,S.b?1-z:z),X.push(E[e+2].z,S.b?1-z:z),h&&(T.push(h[e+1].r,h[e+1].g,h[e+1].b,h[e+1].a),T.push(h[e+1].r,h[e+1].g,h[e+1].b,h[e+1].a),T.push(h[e+2].r,h[e+2].g,h[e+2].b,h[e+2].a),T.push(h[e+2].r,h[e+2].g,h[e+2].b,h[e+2].a))),L!==e&&(L=e)}const k=1!==q&&Q?U+4:U;for(d=0,e=0;e<p;e++){let I=0,O=0,C=0,j=0;for(w=0;w<U;w++)I=d*(k+1)+w,O=(d+1)*(k+1)+w,C=d*(k+1)+(w+1),j=(d+1)*(k+1)+(w+1),o.push(I,O,C),o.push(j,C,O);1!==q&&Q&&(o.push(I+2,O+2,C+2),o.push(j+2,C+2,O+2),o.push(I+4,O+4,C+4),o.push(j+4,C+4,O+4)),d=N?d+2:d+1}const A=I=>{const K=I?C/2:i/2;if(0===K)return;let y,p,N;const Q=I?E[r-1]:E[0];let s=null;h&&(s=I?h[r-1]:h[0]);const Z=c.length/3,mI=I?O/2:-O/2,W=new j.mC(0,mI,0);c.push(W.x,W.y,W.z),n.push(0,I?1:-1,0);const Y=Q.y+.5*(Q.w-Q.y);X.push(Q.x+.5*(Q.z-Q.x),S.b?1-Y:Y),s&&T.push(s.r,s.g,s.b,s.a);const H=new j.Vector2(.5,.5);for(N=0;N<=U;N++){y=2*Math.PI*N*q/U;const O=Math.cos(-y),C=Math.sin(-y);p=new j.mC(O*K,mI,C*K);const i=new j.Vector2(O*H.x+.5,C*H.y+.5);c.push(p.x,p.y,p.z),n.push(0,I?1:-1,0);const Z=Q.y+(Q.w-Q.y)*i.y;X.push(Q.x+(Q.z-Q.x)*i.x,S.b?1-Z:Z),s&&T.push(s.r,s.g,s.b,s.a)}for(N=0;N<U;N++)I?(o.push(Z),o.push(Z+(N+2)),o.push(Z+(N+1))):(o.push(Z),o.push(Z+(N+1)),o.push(Z+(N+2)))};Z!==K.c.CAP_START&&Z!==K.c.CAP_ALL||A(!1),Z!==K.c.CAP_END&&Z!==K.c.CAP_ALL||A(!0),y.e._ComputeSides(mI,c,o,n,X,I.frontUVs,I.backUVs);const P=new y.e;return P.indices=o,P.TI=c,P.HI=n,P.aI=X,h&&(P.bI=T),P}function o(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const j=new K.c(I,C);O.sideOrientation=K.c._GetDefaultSideOrientation(O.sideOrientation),j._originalBuilderSideOrientation=O.sideOrientation;return Y(O).uI(j,O.updatable),j}function c(I){const O=[],C=[],K=[],i=[],U=I.diameter||1,p=I.thickness||.5,N=0|(I.tessellation||16),Q=0===I.sideOrientation?0:I.sideOrientation||y.e.DEFAULTSIDE,s=N+1;for(let y=0;y<=N;y++){const I=y/N,Q=y*Math.PI*2/N-Math.PI/2,Z=j.Matrix.Translation(U/2,0,0).multiply(j.Matrix.RotationY(Q));for(let U=0;U<=N;U++){const Q=1-U/N,q=U*Math.PI*2/N+Math.PI,mI=Math.cos(q),E=Math.sin(q);let h=new j.mC(mI,E,0),r=h.scale(p/2);const W=new j.Vector2(I,Q);r=j.mC.TransformCoordinates(r,Z),h=j.mC.TransformNormal(h,Z),C.push(r.x,r.y,r.z),K.push(h.x,h.y,h.z),i.push(W.x,S.b?1-W.y:W.y);const Y=(y+1)%s,o=(U+1)%s;O.push(y*s+U),O.push(y*s+o),O.push(Y*s+U),O.push(y*s+o),O.push(Y*s+o),O.push(Y*s+U)}}y.e._ComputeSides(Q,C,O,K,i,I.frontUVs,I.backUVs);const Z=new y.e;return Z.indices=O,Z.TI=C,Z.HI=K,Z.aI=i,Z}function n(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const j=new K.c(I,C);O.sideOrientation=K.c._GetDefaultSideOrientation(O.sideOrientation),j._originalBuilderSideOrientation=O.sideOrientation;return c(O).uI(j,O.updatable),j}y.e.CreateCylinder=Y,K.c.CreateCylinder=(I,O,C,j,i,y,S,U,p)=>{void 0!==S&&S instanceof r.b||(void 0!==S&&(p=U||K.c.DEFAULTSIDE,U=S),S=y,y=1);return o(I,{height:O,diameterTop:C,diameterBottom:j,tessellation:i,subdivisions:y,sideOrientation:p,updatable:U},S)};function X(I){const O=[],C=[],K=[],i=[],U=I.radius||2,p=I.tube||.5,N=I.radialSegments||32,Q=I.tubularSegments||32,s=I.p||2,Z=I.q||3,q=0===I.sideOrientation?0:I.sideOrientation||y.e.DEFAULTSIDE,mI=I=>{const O=Math.cos(I),C=Math.sin(I),K=Z/s*I,i=Math.cos(K),y=U*(2+i)*.5*O,S=U*(2+i)*C*.5,p=U*Math.sin(K)*.5;return new j.mC(y,S,p)};let E,h;for(E=0;E<=N;E++){const I=E%N/N*2*s*Math.PI,O=mI(I),K=mI(I+.01),y=K.EO(O);let U=K.add(O);const Z=j.mC.Cross(y,U);for(U=j.mC.Cross(Z,y),Z.normalize(),U.normalize(),h=0;h<Q;h++){const I=h%Q/Q*2*Math.PI,j=-p*Math.cos(I),K=p*Math.sin(I);C.push(O.x+j*U.x+K*Z.x),C.push(O.y+j*U.y+K*Z.y),C.push(O.z+j*U.z+K*Z.z),i.push(E/N),i.push(S.b?1-h/Q:h/Q)}}for(E=0;E<N;E++)for(h=0;h<Q;h++){const I=(h+1)%Q,C=E*Q+h,j=(E+1)*Q+h,K=(E+1)*Q+I,i=E*Q+I;O.push(i),O.push(j),O.push(C),O.push(i),O.push(K),O.push(j)}y.e.ComputeNormals(C,O,K),y.e._ComputeSides(q,C,O,K,i,I.frontUVs,I.backUVs);const r=new y.e;return r.indices=O,r.TI=C,r.HI=K,r.aI=i,r}function T(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const j=new K.c(I,C);O.sideOrientation=K.c._GetDefaultSideOrientation(O.sideOrientation),j._originalBuilderSideOrientation=O.sideOrientation;return X(O).uI(j,O.updatable),j}y.e.CreateTorus=c,K.c.CreateTorus=(I,O,C,j,K,i,y)=>n(I,{diameter:O,thickness:C,tessellation:j,sideOrientation:y,updatable:i},K);y.e.CreateTorusKnot=X,K.c.CreateTorusKnot=(I,O,C,j,K,i,y,S,U,p)=>T(I,{radius:O,tube:C,radialSegments:j,tubularSegments:K,p:i,q:y,sideOrientation:p,updatable:U},S);var H=C(14082),b=C(12788),a=C(12460);function M(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=O.path,i=O.shape,y=O.scale||1,S=O.rotation||0,U=0===O.cap?0:O.cap||K.c.NO_CAP,p=O.updatable,N=K.c._GetDefaultSideOrientation(O.sideOrientation),Q=O.instance||null,s=O.invertUV||!1,Z=O.closeShape||!1,q=O.closePath||!1,mI=O.capFunction||null;return J(I,i,j,y,S,null,null,q,Z,U,!1,C,!!p,N,Q,s,O.frontUVs||null,O.backUVs||null,O.firstNormal||null,!!O.adjustFrame,mI)}function u(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=O.path,i=O.shape,y=O.scaleFunction||(()=>1),S=O.rotationFunction||(()=>0),U=O.closePath||O.ribbonCloseArray||!1,p=O.closeShape||O.ribbonClosePath||!1,N=0===O.cap?0:O.cap||K.c.NO_CAP,Q=O.updatable,s=O.firstNormal||null,Z=O.adjustFrame||!1,q=K.c._GetDefaultSideOrientation(O.sideOrientation),mI=O.instance,E=O.invertUV||!1,h=O.capFunction||null;return J(I,i,j,null,null,y,S,U,p,N,!0,C,!!Q,q,mI||null,E,O.frontUVs||null,O.backUVs||null,s,Z,h||null)}function J(I,O,C,i,y,S,U,N,Q,s,Z,q,mI,E,h,r,W,Y,o,c,n){const X=(I,O,C,i,y,S,U,p,N,Q,s)=>{const Z=C.getTangents(),q=C.getNormals(),mI=C.getBinormals(),E=C.getDistances();if(s)for(let K=0;K<Z.length;K++)if(0==Z[K].x&&0==Z[K].y&&0==Z[K].z&&Z[K].K(Z[K-1]),0==q[K].x&&0==q[K].y&&0==q[K].z&&q[K].K(q[K-1]),0==mI[K].x&&0==mI[K].y&&0==mI[K].z&&mI[K].K(mI[K-1]),K>0){let I=Z[K-1];j.mC.Dot(I,Z[K])<0&&Z[K].scaleInPlace(-1),I=q[K-1],j.mC.Dot(I,q[K])<0&&q[K].scaleInPlace(-1),I=mI[K-1],j.mC.Dot(I,mI[K])<0&&mI[K].scaleInPlace(-1)}let h=0;const r=Q&&p?p:()=>null!==S?S:0,W=Q&&U?U:()=>null!==y?y:1;let Y=N===K.c.NO_CAP||N===K.c.CAP_END?0:2;const o=j.TmpVectors.Matrix[0];for(let K=0;K<O.length;K++){const C=[],y=r(K,E[K]),S=W(K,E[K]);j.Matrix.RotationAxisToRef(Z[K],h,o);for(let i=0;i<I.length;i++){const y=Z[K].scale(I[i].z).add(q[K].scale(I[i].x)).add(mI[K].scale(I[i].y)),U=j.mC.Zero();j.mC.TransformCoordinatesToRef(y,o,U),U.scaleInPlace(S).addInPlace(O[K]),C[i]=U}i[Y]=C,h+=y,Y++}const c=n||(I=>{const O=Array(),C=j.mC.Zero();let K;for(K=0;K<I.length;K++)C.addInPlace(I[K]);for(C.scaleInPlace(1/I.length),K=0;K<I.length;K++)O.push(C);return O});switch(N){case K.c.NO_CAP:break;case K.c.CAP_START:i[0]=c(i[2]),i[1]=i[2];break;case K.c.CAP_END:i[Y]=i[Y-1],i[Y+1]=c(i[Y-1]);break;case K.c.CAP_ALL:i[0]=c(i[2]),i[1]=i[2],i[Y]=i[Y-1],i[Y+1]=c(i[Y-1])}return i};let T,H;if(h){const I=h._creationDataStorage;return T=o?I.path3D.update(C,o):I.path3D.update(C),H=X(O,C,I.path3D,I.pathArray,i,y,S,U,I.cap,Z,c),h=p("",{pathArray:H,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:h},q||void 0)}T=o?new a.m(C,o):new a.m(C);H=X(O,C,T,new Array,i,y,S,U,s=s<0||s>3?0:s,Z,c);const b=p(I,{pathArray:H,closeArray:N,closePath:Q,updatable:mI,sideOrientation:E,invertUV:r,frontUVs:W||void 0,backUVs:Y||void 0},q);return b._creationDataStorage.pathArray=H,b._creationDataStorage.path3D=T,b._creationDataStorage.cap=s,b}function f(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=O.arc?O.arc<=0||O.arc>1?1:O.arc:1,y=void 0===O.closed||O.closed,S=O.shape,U=O.radius||1,N=O.tessellation||64,Q=O.clip||0,s=O.updatable,Z=K.c._GetDefaultSideOrientation(O.sideOrientation),q=O.cap||K.c.NO_CAP,mI=2*Math.PI,E=[],h=O.invertUV||!1;let r=0,W=0;const Y=mI/N*i;let o,c;for(r=0;r<=N-Q;r++){for(c=[],q!=K.c.CAP_START&&q!=K.c.CAP_ALL||(c.push(new j.mC(0,S[0].y,0)),c.push(new j.mC(Math.cos(r*Y)*S[0].x*U,S[0].y,Math.sin(r*Y)*S[0].x*U))),W=0;W<S.length;W++)o=new j.mC(Math.cos(r*Y)*S[W].x*U,S[W].y,Math.sin(r*Y)*S[W].x*U),c.push(o);q!=K.c.CAP_END&&q!=K.c.CAP_ALL||(c.push(new j.mC(Math.cos(r*Y)*S[S.length-1].x*U,S[S.length-1].y,Math.sin(r*Y)*S[S.length-1].x*U)),c.push(new j.mC(0,S[S.length-1].y,0))),E.push(c)}return p(I,{pathArray:E,closeArray:y,sideOrientation:Z,updatable:s,invertUV:h,frontUVs:O.frontUVs,backUVs:O.backUVs},C)}K.c.ExtrudeShape=function(I,O,C,j,i,y){let S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7?arguments[7]:void 0,p=arguments.length>8?arguments[8]:void 0,N=arguments.length>9?arguments[9]:void 0;return M(I,{shape:O,path:C,scale:j,rotation:i,cap:0===y?0:y||K.c.NO_CAP,sideOrientation:p,instance:N,updatable:U},S)},K.c.ExtrudeShapeCustom=(I,O,C,j,i,y,S,U,p,N,Q,s)=>u(I,{shape:O,path:C,scaleFunction:j,rotationFunction:i,ribbonCloseArray:y,ribbonClosePath:S,cap:0===U?0:U||K.c.NO_CAP,sideOrientation:Q,instance:s,updatable:N},p);K.c.CreateLathe=(I,O,C,j,K,i,y)=>f(I,{shape:O,radius:C,tessellation:j,sideOrientation:y,updatable:i},K);var l=C(13433),x=C(13389);function D(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=O.path;let y=O.instance,S=1;void 0!==O.radius?S=O.radius:y&&(S=y._creationDataStorage.radius);const U=O.tessellation||64,N=O.radiusFunction||null;let Q=O.cap||K.c.NO_CAP;const s=O.invertUV||!1,Z=O.updatable,q=K.c._GetDefaultSideOrientation(O.sideOrientation);O.arc=O.arc&&(O.arc<=0||O.arc>1)?1:O.arc||1;const mI=(I,O,C,i,y,S,U,p)=>{const N=O.getTangents(),Q=O.getNormals(),s=O.getDistances(),Z=2*Math.PI/y*p,q=S||(()=>i);let mI,E,h,r;const W=j.TmpVectors.Matrix[0];let Y=U===K.c.NO_CAP||U===K.c.CAP_END?0:2;for(let K=0;K<I.length;K++){E=q(K,s[K]),mI=Array(),h=Q[K];for(let O=0;O<y;O++)j.Matrix.RotationAxisToRef(N[K],Z*O,W),r=mI[O]?mI[O]:j.mC.Zero(),j.mC.TransformCoordinatesToRef(h,W,r),r.scaleInPlace(E).addInPlace(I[K]),mI[O]=r;C[Y]=mI,Y++}const o=(O,C)=>{const j=Array();for(let K=0;K<O;K++)j.push(I[C]);return j};switch(U){case K.c.NO_CAP:break;case K.c.CAP_START:C[0]=o(y,0),C[1]=C[2].slice(0);break;case K.c.CAP_END:C[Y]=C[Y-1].slice(0),C[Y+1]=o(y,I.length-1);break;case K.c.CAP_ALL:C[0]=o(y,0),C[1]=C[2].slice(0),C[Y]=C[Y-1].slice(0),C[Y+1]=o(y,I.length-1)}return C};let E,h;if(y){const I=y._creationDataStorage,C=O.arc||I.arc;return E=I.path3D.update(i),h=mI(i,E,I.pathArray,S,I.tessellation,N,I.cap,C),y=p("",{pathArray:h,instance:y}),I.path3D=E,I.pathArray=h,I.arc=C,I.radius=S,y}E=new a.m(i);Q=Q<0||Q>3?0:Q,h=mI(i,E,new Array,S,U,N,Q,O.arc);const r=p(I,{pathArray:h,closePath:!0,closeArray:!1,updatable:Z,sideOrientation:q,invertUV:s,frontUVs:O.frontUVs,backUVs:O.backUVs},C);return r._creationDataStorage.pathArray=h,r._creationDataStorage.path3D=E,r._creationDataStorage.tessellation=U,r._creationDataStorage.cap=Q,r._creationDataStorage.arc=O.arc,r._creationDataStorage.radius=S,r}function t(I){const O=[];O[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},O[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},O[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},O[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},O[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},O[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},O[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},O[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},O[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},O[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},O[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},O[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},O[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},O[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},O[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const C=I.type&&(I.type<0||I.type>=O.length)?0:I.type||0,K=I.size,i=I.sizeX||K||1,U=I.sizeY||K||1,p=I.sizeZ||K||1,N=I.custom||O[C],Q=N.face.length,Z=I.faceUV||new Array(Q),q=I.faceColors,mI=void 0===I.flat||I.flat,E=0===I.sideOrientation?0:I.sideOrientation||y.e.DEFAULTSIDE,h=[],r=[],W=[],Y=[],o=[];let c=0,n=0;const X=[];let T,H,b,a,M,u,J=0,f=0;if(mI)for(f=0;f<Q;f++)q&&void 0===q[f]&&(q[f]=new s.TS(1,1,1,1)),Z&&void 0===Z[f]&&(Z[f]=new j.Vector4(0,0,1,1));if(mI)for(f=0;f<Q;f++){const I=N.face[f].length;for(b=2*Math.PI/I,a=.5*Math.tan(b/2),M=.5,J=0;J<I;J++)h.push(N.vertex[N.face[f][J]][0]*i,N.vertex[N.face[f][J]][1]*U,N.vertex[N.face[f][J]][2]*p),X.push(c),c++,T=Z[f].x+(Z[f].z-Z[f].x)*(.5+a),H=Z[f].y+(Z[f].w-Z[f].y)*(M-.5),Y.push(T,S.b?1-H:H),u=a*Math.cos(b)-M*Math.sin(b),M=a*Math.sin(b)+M*Math.cos(b),a=u,q&&o.push(q[f].r,q[f].g,q[f].b,q[f].a);for(J=0;J<I-2;J++)r.push(X[0+n],X[J+2+n],X[J+1+n]);n+=I}else{for(J=0;J<N.vertex.length;J++)h.push(N.vertex[J][0]*i,N.vertex[J][1]*U,N.vertex[J][2]*p),Y.push(0,S.b?1:0);for(f=0;f<Q;f++)for(J=0;J<N.face[f].length-2;J++)r.push(N.face[f][0],N.face[f][J+2],N.face[f][J+1])}y.e.ComputeNormals(h,r,W),y.e._ComputeSides(E,h,r,W,Y,I.frontUVs,I.backUVs);const l=new y.e;return l.TI=h,l.indices=r,l.HI=W,l.aI=Y,q&&mI&&(l.bI=o),l}function d(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new K.c(I,C);O.sideOrientation=K.c._GetDefaultSideOrientation(O.sideOrientation),j._originalBuilderSideOrientation=O.sideOrientation;return t(O).uI(j,O.updatable),j}K.c.CreateTube=(I,O,C,j,K,i,y,S,U,p)=>D(I,{path:O,radius:C,tessellation:j,radiusFunction:K,arc:1,cap:i,updatable:S,sideOrientation:U,instance:p},y);function w(I){const O=I.sideOrientation||y.e.DEFAULTSIDE,C=I.radius||1,K=void 0===I.flat||I.flat,i=0|(I.subdivisions||4),U=I.radiusX||C,p=I.radiusY||C,N=I.radiusZ||C,Q=(1+Math.sqrt(5))/2,s=[-1,Q,-0,1,Q,0,-1,-Q,0,1,-Q,0,0,-1,-Q,0,1,-Q,0,-1,Q,0,1,Q,Q,0,1,Q,0,-1,-Q,0,1,-Q,0,-1],Z=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],q=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],mI=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],E=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],h=[],r=[],W=[],Y=[];let o=0;const c=new Array(3),n=new Array(3);let X;for(X=0;X<3;X++)c[X]=j.mC.Zero(),n[X]=j.Vector2.Zero();for(let y=0;y<20;y++){for(X=0;X<3;X++){const I=Z[3*y+X];c[X].cS(s[3*q[I]],s[3*q[I]+1],s[3*q[I]+2]),c[X].normalize(),n[X].cS(.134765625*mI[2*I]+.05859375+-.0390625*E[y],.2333984375*mI[2*I+1]+.025390625+.01953125*E[y])}const I=(I,O,C,y)=>{const Q=j.mC.Lerp(c[0],c[2],O/i),s=j.mC.Lerp(c[1],c[2],O/i),Z=i===O?c[2]:j.mC.Lerp(Q,s,I/(i-O));let q;if(Z.normalize(),K){const I=j.mC.Lerp(c[0],c[2],y/i),O=j.mC.Lerp(c[1],c[2],y/i);q=j.mC.Lerp(I,O,C/(i-y))}else q=new j.mC(Z.x,Z.y,Z.z);q.x/=U,q.y/=p,q.z/=N,q.normalize();const mI=j.Vector2.Lerp(n[0],n[2],O/i),E=j.Vector2.Lerp(n[1],n[2],O/i),X=i===O?n[2]:j.Vector2.Lerp(mI,E,I/(i-O));r.push(Z.x*U,Z.y*p,Z.z*N),W.push(q.x,q.y,q.z),Y.push(X.x,S.b?1-X.y:X.y),h.push(o),o++};for(let O=0;O<i;O++)for(let C=0;C+O<i;C++)I(C,O,C+1/3,O+1/3),I(C+1,O,C+1/3,O+1/3),I(C,O+1,C+1/3,O+1/3),C+O+1<i&&(I(C+1,O,C+2/3,O+2/3),I(C+1,O+1,C+2/3,O+2/3),I(C,O+1,C+2/3,O+2/3))}y.e._ComputeSides(O,r,h,W,Y,I.frontUVs,I.backUVs);const T=new y.e;return T.indices=h,T.TI=r,T.HI=W,T.aI=Y,T}function g(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new K.c(I,C);O.sideOrientation=K.c._GetDefaultSideOrientation(O.sideOrientation),j._originalBuilderSideOrientation=O.sideOrientation;return w(O).uI(j,O.updatable),j}y.e.CreatePolyhedron=t,K.c.CreatePolyhedron=(I,O,C)=>d(I,O,C);y.e.CreateIcoSphere=w,K.c.CreateIcoSphere=(I,O,C)=>g(I,O,C);var V=C(12282);const e=new j.mC(1,0,0),L=new j.mC(-1,0,0),z=new j.mC(0,1,0),k=new j.mC(0,-1,0),A=new j.mC(0,0,1),P=new j.mC(0,0,-1);class v{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.mC.Zero(),O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.mC.Up(),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.Vector2.Zero(),K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=I,this.normal=O,this.uv=C,this.vertexIdx=K,this.vertexIdxForBones=i,this.localPositionOverride=y,this.localNormalOverride=S,this.matrixIndicesOverride=U,this.matrixWeightsOverride=p}clone(){var I,O,C,j;return new v(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(I=this.localPositionOverride)||void 0===I?void 0:I.slice(),null===(O=this.localNormalOverride)||void 0===O?void 0:O.slice(),null===(C=this.matrixIndicesOverride)||void 0===C?void 0:C.slice(),null===(j=this.matrixWeightsOverride)||void 0===j?void 0:j.slice())}}function B(I,O,C){var U,p,N,Q,s;const Z=!!O.skeleton,q=!(null===(U=O.morphTargetManager)||void 0===U||!U.numTargets),mI=C.localMode||Z,E=O.YS(),h=Z||q?O.dS(!0,!0):O.getVerticesData(i.e.PositionKind),r=Z||q?O.getNormalsData(!0,!0):O.getVerticesData(i.e.NormalKind),W=mI?Z?O.getVerticesData(i.e.PositionKind):h:null,Y=mI?Z?O.getVerticesData(i.e.NormalKind):r:null,o=O.getVerticesData(i.e.UVKind),c=Z?O.getVerticesData(i.e.MatricesIndicesKind):null,n=Z?O.getVerticesData(i.e.MatricesWeightsKind):null,X=Z?O.getVerticesData(i.e.MatricesIndicesExtraKind):null,T=Z?O.getVerticesData(i.e.MatricesWeightsExtraKind):null,H=C.position||j.mC.Zero();let b=C.normal||j.mC.Up();const a=C.size||j.mC.One(),M=C.angle||0;if(!b){const I=new j.mC(0,0,1),C=O.nI().activeCamera,K=j.mC.TransformCoordinates(I,C.getWorldMatrix());b=C.globalPosition.EO(K)}const u=-Math.atan2(b.z,b.x)-Math.PI/2,J=Math.sqrt(b.x*b.x+b.z*b.z),f=Math.atan2(b.y,J),l=new y.e;l.indices=[],l.TI=[],l.HI=[],l.aI=[],l.matricesIndices=Z?[]:null,l.matricesWeights=Z?[]:null,l.matricesIndicesExtra=X?[]:null,l.matricesWeightsExtra=T?[]:null;let x=0;const D=(I,O)=>{const K=new v;if(!E||!h||!r)return K;const i=E[I];if(K.vertexIdx=3*i,K.vertexIdxForBones=4*i,K.position=new j.mC(h[3*i],h[3*i+1],h[3*i+2]),j.mC.TransformCoordinatesToRef(K.position,O,K.position),K.normal=new j.mC(r[3*i],r[3*i+1],r[3*i+2]),j.mC.TransformNormalToRef(K.normal,O,K.normal),C.captureUVS&&o){const I=o[2*i+1];K.uv=new j.Vector2(o[2*i],S.b?1-I:I)}return K},t=[0,0,0,0],d=(I,O)=>{if(0===I.length)return I;const C=.5*Math.abs(j.mC.Dot(a,O)),K=(I,O,C,j)=>{for(let K=0;K<j;++K)if(I[C+K]===O)return C+K;return-1},i=(I,i)=>{const y=j.mC.GetClipFactor(I.position,i.position,O,C);let S=t,U=t;if(c&&n){const O=I.matrixIndicesOverride?0:I.vertexIdxForBones,C=I.matrixIndicesOverride??c,j=I.matrixWeightsOverride??n,p=i.matrixIndicesOverride?0:i.vertexIdxForBones,N=i.matrixIndicesOverride??c,Q=i.matrixWeightsOverride??n;S=[0,0,0,0],U=[0,0,0,0];let s=0;for(let I=0;I<4;++I)if(j[O+I]>0){const i=K(N,C[O+I],p,4);S[s]=C[O+I],U[s]=(0,V.Lerp)(j[O+I],i>=0?Q[i]:0,y),s++}for(let I=0;I<4&&s<4;++I){const j=N[p+I];-1===K(C,j,O,4)&&(S[s]=j,U[s]=(0,V.Lerp)(0,Q[p+I],y),s++)}const Z=U[0]+U[1]+U[2]+U[3];U[0]/=Z,U[1]/=Z,U[2]/=Z,U[3]/=Z}const p=I.localPositionOverride?I.localPositionOverride[0]:(null===W||void 0===W?void 0:W[I.vertexIdx])??0,N=I.localPositionOverride?I.localPositionOverride[1]:(null===W||void 0===W?void 0:W[I.vertexIdx+1])??0,Q=I.localPositionOverride?I.localPositionOverride[2]:(null===W||void 0===W?void 0:W[I.vertexIdx+2])??0,s=i.localPositionOverride?i.localPositionOverride[0]:(null===W||void 0===W?void 0:W[i.vertexIdx])??0,Z=i.localPositionOverride?i.localPositionOverride[1]:(null===W||void 0===W?void 0:W[i.vertexIdx+1])??0,q=i.localPositionOverride?i.localPositionOverride[2]:(null===W||void 0===W?void 0:W[i.vertexIdx+2])??0,mI=I.localNormalOverride?I.localNormalOverride[0]:(null===Y||void 0===Y?void 0:Y[I.vertexIdx])??0,E=I.localNormalOverride?I.localNormalOverride[1]:(null===Y||void 0===Y?void 0:Y[I.vertexIdx+1])??0,h=I.localNormalOverride?I.localNormalOverride[2]:(null===Y||void 0===Y?void 0:Y[I.vertexIdx+2])??0,r=mI+((i.localNormalOverride?i.localNormalOverride[0]:(null===Y||void 0===Y?void 0:Y[i.vertexIdx])??0)-mI)*y,o=E+((i.localNormalOverride?i.localNormalOverride[1]:(null===Y||void 0===Y?void 0:Y[i.vertexIdx+1])??0)-E)*y,X=h+((i.localNormalOverride?i.localNormalOverride[2]:(null===Y||void 0===Y?void 0:Y[i.vertexIdx+2])??0)-h)*y,T=Math.sqrt(r*r+o*o+X*X);return new v(j.mC.Lerp(I.position,i.position,y),j.mC.Lerp(I.normal,i.normal,y).normalize(),j.Vector2.Lerp(I.uv,i.uv,y),-1,-1,W?[p+(s-p)*y,N+(Z-N)*y,Q+(q-Q)*y]:null,Y?[r/T,o/T,X/T]:null,S,U)};let y=null;I.length>3&&(y=[]);for(let S=0;S<I.length;S+=3){let K=0,U=null,p=null,N=null,Q=null;const s=j.mC.Dot(I[S].position,O)-C>0,Z=j.mC.Dot(I[S+1].position,O)-C>0,q=j.mC.Dot(I[S+2].position,O)-C>0;switch(K=(s?1:0)+(Z?1:0)+(q?1:0),K){case 0:I.length>3?(y.push(I[S]),y.push(I[S+1]),y.push(I[S+2])):y=I;break;case 1:if(y=y??new Array,s&&(U=I[S+1],p=I[S+2],N=i(I[S],U),Q=i(I[S],p)),Z){U=I[S],p=I[S+2],N=i(I[S+1],U),Q=i(I[S+1],p),y.push(N),y.push(p.clone()),y.push(U.clone()),y.push(p.clone()),y.push(N.clone()),y.push(Q);break}q&&(U=I[S],p=I[S+1],N=i(I[S+2],U),Q=i(I[S+2],p)),U&&p&&N&&Q&&(y.push(U.clone()),y.push(p.clone()),y.push(N),y.push(Q),y.push(N.clone()),y.push(p.clone()));break;case 2:y=y??new Array,s||(U=I[S].clone(),p=i(U,I[S+1]),N=i(U,I[S+2]),y.push(U),y.push(p),y.push(N)),Z||(U=I[S+1].clone(),p=i(U,I[S+2]),N=i(U,I[S]),y.push(U),y.push(p),y.push(N)),q||(U=I[S+2].clone(),p=i(U,I[S]),N=i(U,I[S+1]),y.push(U),y.push(p),y.push(N))}}return y},w=O instanceof K.c?O:null,g=null===w||void 0===w?void 0:w._thinInstanceDataStorage.matrixData,B=(null===w||void 0===w?void 0:w.bS)||1,F=j.TmpVectors.Matrix[0];F.K(j.Matrix.IdentityReadOnly);for(let K=0;K<B;++K){if(null!==w&&void 0!==w&&w.hasThinInstances&&g){const I=16*K;F.setRowFromFloats(0,g[I+0],g[I+1],g[I+2],g[I+3]),F.setRowFromFloats(1,g[I+4],g[I+5],g[I+6],g[I+7]),F.setRowFromFloats(2,g[I+8],g[I+9],g[I+10],g[I+11]),F.setRowFromFloats(3,g[I+12],g[I+13],g[I+14],g[I+15])}const I=j.Matrix.RotationYawPitchRoll(u,f,M).multiply(j.Matrix.Translation(H.x,H.y,H.z)),i=j.Matrix.Invert(I),y=O.getWorldMatrix(),U=F.multiply(y).multiply(i),p=new Array(3);for(let O=0;O<E.length;O+=3){let I=p;if(I[0]=D(O,U),I[1]=D(O+1,U),I[2]=D(O+2,U),!(C.cullBackFaces&&-I[0].normal.z<=0&&-I[1].normal.z<=0&&-I[2].normal.z<=0)&&(I=d(I,e),I&&(I=d(I,L),I&&(I=d(I,z),I&&(I=d(I,k),I&&(I=d(I,A),I&&(I=d(I,P),I)))))))for(let O=0;O<I.length;O++){const j=I[O];if(l.indices.push(x),mI?(j.localPositionOverride?(l.TI[3*x]=j.localPositionOverride[0],l.TI[3*x+1]=j.localPositionOverride[1],l.TI[3*x+2]=j.localPositionOverride[2]):W&&(l.TI[3*x]=W[j.vertexIdx],l.TI[3*x+1]=W[j.vertexIdx+1],l.TI[3*x+2]=W[j.vertexIdx+2]),j.localNormalOverride?(l.HI[3*x]=j.localNormalOverride[0],l.HI[3*x+1]=j.localNormalOverride[1],l.HI[3*x+2]=j.localNormalOverride[2]):Y&&(l.HI[3*x]=Y[j.vertexIdx],l.HI[3*x+1]=Y[j.vertexIdx+1],l.HI[3*x+2]=Y[j.vertexIdx+2])):(j.position.toArray(l.TI,3*x),j.normal.toArray(l.HI,3*x)),l.matricesIndices&&l.matricesWeights&&(j.matrixIndicesOverride?(l.matricesIndices[4*x]=j.matrixIndicesOverride[0],l.matricesIndices[4*x+1]=j.matrixIndicesOverride[1],l.matricesIndices[4*x+2]=j.matrixIndicesOverride[2],l.matricesIndices[4*x+3]=j.matrixIndicesOverride[3]):(c&&(l.matricesIndices[4*x]=c[j.vertexIdxForBones],l.matricesIndices[4*x+1]=c[j.vertexIdxForBones+1],l.matricesIndices[4*x+2]=c[j.vertexIdxForBones+2],l.matricesIndices[4*x+3]=c[j.vertexIdxForBones+3]),X&&l.matricesIndicesExtra&&(l.matricesIndicesExtra[4*x]=X[j.vertexIdxForBones],l.matricesIndicesExtra[4*x+1]=X[j.vertexIdxForBones+1],l.matricesIndicesExtra[4*x+2]=X[j.vertexIdxForBones+2],l.matricesIndicesExtra[4*x+3]=X[j.vertexIdxForBones+3])),j.matrixWeightsOverride?(l.matricesWeights[4*x]=j.matrixWeightsOverride[0],l.matricesWeights[4*x+1]=j.matrixWeightsOverride[1],l.matricesWeights[4*x+2]=j.matrixWeightsOverride[2],l.matricesWeights[4*x+3]=j.matrixWeightsOverride[3]):(n&&(l.matricesWeights[4*x]=n[j.vertexIdxForBones],l.matricesWeights[4*x+1]=n[j.vertexIdxForBones+1],l.matricesWeights[4*x+2]=n[j.vertexIdxForBones+2],l.matricesWeights[4*x+3]=n[j.vertexIdxForBones+3]),T&&l.matricesWeightsExtra&&(l.matricesWeightsExtra[4*x]=T[j.vertexIdxForBones],l.matricesWeightsExtra[4*x+1]=T[j.vertexIdxForBones+1],l.matricesWeightsExtra[4*x+2]=T[j.vertexIdxForBones+2],l.matricesWeightsExtra[4*x+3]=T[j.vertexIdxForBones+3]))),C.captureUVS)j.uv.toArray(l.aI,2*x);else{l.aI.push(.5+j.position.x/a.x);const I=.5+j.position.y/a.y;l.aI.push(S.b?1-I:I)}x++}}}0===l.indices.length&&(l.indices=null),0===l.TI.length&&(l.TI=null),0===l.HI.length&&(l.HI=null),0===l.aI.length&&(l.aI=null),0===(null===(p=l.matricesIndices)||void 0===p?void 0:p.length)&&(l.matricesIndices=null),0===(null===(N=l.matricesWeights)||void 0===N?void 0:N.length)&&(l.matricesWeights=null),0===(null===(Q=l.matricesIndicesExtra)||void 0===Q?void 0:Q.length)&&(l.matricesIndicesExtra=null),0===(null===(s=l.matricesWeightsExtra)||void 0===s?void 0:s.length)&&(l.matricesWeightsExtra=null);const R=new K.c(I,O.nI());return l.uI(R),mI?(R.skeleton=O.skeleton,R.parent=O):(R.position=H.clone(),R.rotation=new j.mC(f,u,M)),R.rS(!0),R.refreshBoundingInfo(!0,!0),R}function F(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const O=0|Math.max(I.subdivisions?I.subdivisions:2,1),C=0|Math.max(I.tessellation?I.tessellation:16,3),K=Math.max(I.height?I.height:1,0),i=Math.max(I.radius?I.radius:.25,0),U=0|Math.max(I.capSubdivisions?I.capSubdivisions:6,1),p=C,N=O,Q=Math.max(I.radiusTop?I.radiusTop:i,0),s=Math.max(I.radiusBottom?I.radiusBottom:i,0),Z=K-(Q+s),q=2*Math.PI,mI=Math.max(I.topCapSubdivisions?I.topCapSubdivisions:U,1),E=Math.max(I.bottomCapSubdivisions?I.bottomCapSubdivisions:U,1),h=Math.acos((s-Q)/K);let r=[];const W=[],Y=[],o=[];let c=0;const n=[],X=.5*Z,T=.5*Math.PI;let H,b;const a=j.mC.Zero(),M=j.mC.Zero(),u=Math.cos(h),J=Math.sin(h),f=new j.Vector2(Q*J,X+Q*u).EO(new j.Vector2(s*J,s*u-X)).length(),l=Q*h+f+s*(T-h);let x=0;for(b=0;b<=mI;b++){const I=[],O=T-h*(b/mI);x+=Q*h/mI;const C=Math.cos(O),j=Math.sin(O),K=C*Q;for(H=0;H<=p;H++){const O=H/p,i=O*q+0,y=Math.sin(i),U=Math.cos(i);M.x=K*y,M.y=X+j*Q,M.z=K*U,W.push(M.x,M.y,M.z),a.set(C*y,j,C*U),Y.push(a.x,a.y,a.z),o.push(O,S.b?x/l:1-x/l),I.push(c),c++}n.push(I)}const D=K-Q-s+u*Q-u*s,t=J*(s-Q)/D;for(b=1;b<=N;b++){const I=[];x+=f/N;const O=J*(b*(s-Q)/N+Q);for(H=0;H<=p;H++){const C=H/p,j=C*q+0,K=Math.sin(j),i=Math.cos(j);M.x=O*K,M.y=X+u*Q-b*D/N,M.z=O*i,W.push(M.x,M.y,M.z),a.set(K,t,i).normalize(),Y.push(a.x,a.y,a.z),o.push(C,S.b?x/l:1-x/l),I.push(c),c++}n.push(I)}for(b=1;b<=E;b++){const I=[],O=T-h-(Math.PI-h)*(b/E);x+=s*h/E;const C=Math.cos(O),j=Math.sin(O),K=C*s;for(H=0;H<=p;H++){const O=H/p,i=O*q+0,y=Math.sin(i),U=Math.cos(i);M.x=K*y,M.y=j*s-X,M.z=K*U,W.push(M.x,M.y,M.z),a.set(C*y,j,C*U),Y.push(a.x,a.y,a.z),o.push(O,S.b?x/l:1-x/l),I.push(c),c++}n.push(I)}for(H=0;H<p;H++)for(b=0;b<mI+N+E;b++){const I=n[b][H],O=n[b+1][H],C=n[b+1][H+1],j=n[b][H+1];r.push(I),r.push(O),r.push(j),r.push(O),r.push(C),r.push(j)}if(r=r.reverse(),I.orientation&&!I.orientation.equals(j.mC.Up())){const O=new j.Matrix;I.orientation.clone().scale(.5*Math.PI).cross(j.mC.Up()).toQuaternion().toRotationMatrix(O);const C=j.mC.Zero();for(let I=0;I<W.length;I+=3)C.set(W[I],W[I+1],W[I+2]),j.mC.TransformCoordinatesToRef(C.clone(),O,C),W[I]=C.x,W[I+1]=C.y,W[I+2]=C.z}const d=new y.e;return d.TI=W,d.HI=Y,d.aI=o,d.indices=r,d}function R(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:j.mC.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new K.c(I,C);return F(O).uI(i,O.updatable),i}K.c.CreateDecal=(I,O,C,j,K,i)=>B(I,O,{position:C,normal:j,size:K,angle:i});K.c.CreateCapsule=(I,O,C)=>R(I,O,C),y.e.CreateCapsule=F;var G=C(12103),II=C(12274);class OI{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=I,this.y=O,I!==Math.floor(I)&&(I=Math.floor(I),G.c.Warn("x is not an integer, floor(x) used")),O!==Math.floor(O)&&(O=Math.floor(O),G.c.Warn("y is not an integer, floor(y) used"))}clone(){return new OI(this.x,this.y)}rotate60About(I){const O=this.x;return this.x=I.x+I.y-this.y,this.y=O+this.y-I.x,this}rotateNeg60About(I){const O=this.x;return this.x=O+this.y-I.y,this.y=I.x+I.y-O,this}rotate120(I,O){I!==Math.floor(I)&&(I=Math.floor(I),G.c.Warn("m not an integer only floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),G.c.Warn("n not an integer only floor(n) used"));const C=this.x;return this.x=I-C-this.y,this.y=O+C,this}rotateNeg120(I,O){I!==Math.floor(I)&&(I=Math.floor(I),G.c.Warn("m is not an integer, floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),G.c.Warn("n is not an integer,   floor(n) used"));const C=this.x;return this.x=this.y-O,this.y=I+O-C-this.y,this}toCartesianOrigin(I,O){const C=j.mC.Zero();return C.x=I.x+2*this.x*O+this.y*O,C.y=I.y+Math.sqrt(3)*this.y*O,C}static Zero(){return new OI(0,0)}}class CI{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new jI("icosahedron","Regular",[[0,II.h,-1],[-II.h,1,0],[-1,0,-II.h],[1,0,-II.h],[II.h,1,0],[0,II.h,1],[-1,0,II.h],[-II.h,-1,0],[0,-II.h,-1],[II.h,-1,0],[1,0,II.h],[0,-II.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let I=12;const O={},C=this.m,j=this.n;let K,i,y,S,U,p=C,N=1,Q=0;0!==j&&(p=(0,V.HighestCommonFactor)(C,j)),N=C/p,Q=j/p;const s=OI.Zero(),Z=new OI(C,j),q=new OI(-j,C+j),mI=OI.Zero(),E=OI.Zero(),h=OI.Zero();let r,W,Y,o,c=[];const n=[],X=this.vertByDist,T=(C,j,K,i)=>{r=C+"|"+K,W=j+"|"+i,r in O||W in O?r in O&&!(W in O)?O[W]=O[r]:W in O&&!(r in O)&&(O[r]=O[W]):(O[r]=I,O[W]=I,I++),X[K][0]>2?n[O[r]]=[-X[K][0],X[K][1],O[r]]:n[O[r]]=[c[X[K][0]],X[K][1],O[r]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let H=0;H<20;H++){if(c=this.IDATA.face[H],y=c[2],S=c[1],U=c[0],Y=s.x+"|"+s.y,r=H+"|"+Y,r in O||(O[r]=y,n[y]=[c[X[Y][0]],X[Y][1]]),Y=Z.x+"|"+Z.y,r=H+"|"+Y,r in O||(O[r]=S,n[S]=[c[X[Y][0]],X[Y][1]]),Y=q.x+"|"+q.y,r=H+"|"+Y,r in O||(O[r]=U,n[U]=[c[X[Y][0]],X[Y][1]]),K=this.IDATA.edgematch[H][0],i=this.IDATA.edgematch[H][1],"B"===i)for(let I=1;I<p;I++)E.x=C-I*(N+Q),E.y=j+I*N,h.x=-I*Q,h.y=I*(N+Q),Y=E.x+"|"+E.y,o=h.x+"|"+h.y,T(H,K,Y,o);if("O"===i)for(let I=1;I<p;I++)h.x=-I*Q,h.y=I*(N+Q),mI.x=I*N,mI.y=I*Q,Y=h.x+"|"+h.y,o=mI.x+"|"+mI.y,T(H,K,Y,o);if(K=this.IDATA.edgematch[H][2],i=this.IDATA.edgematch[H][3],i&&"A"===i)for(let I=1;I<p;I++)mI.x=I*N,mI.y=I*Q,E.x=C-(p-I)*(N+Q),E.y=j+(p-I)*N,Y=mI.x+"|"+mI.y,o=E.x+"|"+E.y,T(H,K,Y,o);for(let C=0;C<this.vertices.length;C++)Y=this.vertices[C].x+"|"+this.vertices[C].y,r=H+"|"+Y,r in O||(O[r]=I++,X[Y][0]>2?n[O[r]]=[-X[Y][0],X[Y][1],O[r]]:n[O[r]]=[c[X[Y][0]],X[Y][1],O[r]])}this.closestTo=n,this.vecToidx=O}calcCoeffs(){const I=this.m,O=this.n,C=Math.sqrt(3)/3,j=I*I+O*O+I*O;this.coau=(I+O)/j,this.cobu=-O/j,this.coav=-C*(I-O)/j,this.cobv=C*(2*I+O)/j}createInnerFacets(){const I=this.m,O=this.n;for(let C=0;C<O+I+1;C++)for(let I=this.min[C];I<this.max[C]+1;I++)I<this.max[C]&&I<this.max[C+1]+1&&this.innerFacets.push(["|"+I+"|"+C,"|"+I+"|"+(C+1),"|"+(I+1)+"|"+C]),C>0&&I<this.max[C-1]&&I+1<this.max[C]+1&&this.innerFacets.push(["|"+I+"|"+C,"|"+(I+1)+"|"+C,"|"+(I+1)+"|"+(C-1)])}edgeVecsABOB(){const I=this.m,O=this.n,C=new OI(-O,I+O);for(let j=1;j<I+O;j++){const I=new OI(this.min[j],j),O=new OI(this.min[j-1],j-1),K=new OI(this.min[j+1],j+1),i=I.clone(),y=O.clone(),S=K.clone();i.rotate60About(C),y.rotate60About(C),S.rotate60About(C);const U=new OI(this.max[i.y],i.y),p=new OI(this.max[i.y-1],i.y-1),N=new OI(this.max[i.y-1]-1,i.y-1);i.x===U.x&&i.y===U.y||(i.x!==p.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([I,p,N]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([I,N,U])):i.y===S.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([I,O,p]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([I,p,K])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([I,O,p]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([I,p,U])))}}mapABOBtoOBOA(){const I=new OI(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const C=[];for(let j=0;j<3;j++)I.x=this.isoVecsABOB[O][j].x,I.y=this.isoVecsABOB[O][j].y,0===this.vertexTypes[O][j]&&I.rotateNeg120(this.m,this.n),C.push(I.clone());this.isoVecsOBOA.push(C)}}mapABOBtoBAOA(){const I=new OI(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const C=[];for(let j=0;j<3;j++)I.x=this.isoVecsABOB[O][j].x,I.y=this.isoVecsABOB[O][j].y,1===this.vertexTypes[O][j]&&I.rotate120(this.m,this.n),C.push(I.clone());this.isoVecsBAOA.push(C)}}MapToFace(I,O){const C=this.IDATA.face[I],K=C[2],i=C[1],y=C[0],S=j.mC.YO(this.IDATA.vertex[K]),U=j.mC.YO(this.IDATA.vertex[i]),p=j.mC.YO(this.IDATA.vertex[y]),N=U.EO(S),Q=p.EO(S),s=N.scale(this.coau).add(Q.scale(this.cobu)),Z=N.scale(this.coav).add(Q.scale(this.cobv)),q=[];let mI,E=j.TmpVectors.mC[0];for(let j=0;j<this.cartesian.length;j++)E=s.scale(this.cartesian[j].x).add(Z.scale(this.cartesian[j].y)).add(S),q[j]=[E.x,E.y,E.z],mI=I+"|"+this.vertices[j].x+"|"+this.vertices[j].y,O.vertex[this.vecToidx[mI]]=[E.x,E.y,E.z]}build(I,O){const C=[],j=OI.Zero(),K=new OI(I,O),i=new OI(-O,I+O);C.push(j,K,i);for(let Y=O;Y<I+1;Y++)for(let O=0;O<I+1-Y;O++)C.push(new OI(O,Y));if(O>0){const j=(0,V.HighestCommonFactor)(I,O),K=I/j,i=O/j;for(let S=1;S<j;S++)C.push(new OI(S*K,S*i)),C.push(new OI(-S*i,S*(K+i))),C.push(new OI(I-S*(K+i),O+S*K));const y=I/O;for(let S=1;S<O;S++)for(let j=0;j<S*y;j++)C.push(new OI(j,S)),C.push(new OI(j,S).rotate120(I,O)),C.push(new OI(j,S).rotateNeg120(I,O))}C.sort(((I,O)=>I.x-O.x)),C.sort(((I,O)=>I.y-O.y));const y=new Array(I+O+1),S=new Array(I+O+1);for(let Y=0;Y<y.length;Y++)y[Y]=1/0,S[Y]=-1/0;let U=0,p=0;const N=C.length;for(let Y=0;Y<N;Y++)p=C[Y].x,U=C[Y].y,y[U]=Math.min(p,y[U]),S[U]=Math.max(p,S[U]);const Q=(C,j)=>{const K=C.clone();return"A"===j&&K.rotateNeg120(I,O),"B"===j&&K.rotate120(I,O),K.x<0?K.y:K.x+K.y},s=[],Z=[],q=[],mI=[],E={},h=[];let r=-1,W=-1;for(let Y=0;Y<N;Y++)s[Y]=C[Y].toCartesianOrigin(new OI(0,0),.5),Z[Y]=Q(C[Y],"O"),q[Y]=Q(C[Y],"A"),mI[Y]=Q(C[Y],"B"),Z[Y]===q[Y]&&q[Y]===mI[Y]?(r=3,W=Z[Y]):Z[Y]===q[Y]?(r=4,W=Z[Y]):q[Y]===mI[Y]?(r=5,W=q[Y]):mI[Y]===Z[Y]&&(r=6,W=Z[Y]),Z[Y]<q[Y]&&Z[Y]<mI[Y]&&(r=2,W=Z[Y]),q[Y]<Z[Y]&&q[Y]<mI[Y]&&(r=1,W=q[Y]),mI[Y]<q[Y]&&mI[Y]<Z[Y]&&(r=0,W=mI[Y]),h.push([r,W,C[Y].x,C[Y].y]);h.sort(((I,O)=>I[2]-O[2])),h.sort(((I,O)=>I[3]-O[3])),h.sort(((I,O)=>I[1]-O[1])),h.sort(((I,O)=>I[0]-O[0]));for(let Y=0;Y<h.length;Y++)E[h[Y][2]+"|"+h[Y][3]]=[h[Y][0],h[Y][1],Y];return this.m=I,this.n=O,this.vertices=C,this.vertByDist=E,this.cartesian=s,this.min=y,this.max=S,this}}class jI{constructor(I,O,C,j){this.name=I,this.category=O,this.vertex=C,this.face=j}}class KI extends jI{innerToData(I,O){for(let C=0;C<O.innerFacets.length;C++)this.face.push(O.innerFacets[C].map((C=>O.vecToidx[I+C])))}mapABOBtoDATA(I,O){const C=O.IDATA.edgematch[I][0];for(let j=0;j<O.isoVecsABOB.length;j++){const K=[];for(let i=0;i<3;i++)0===O.vertexTypes[j][i]?K.push(I+"|"+O.isoVecsABOB[j][i].x+"|"+O.isoVecsABOB[j][i].y):K.push(C+"|"+O.isoVecsABOB[j][i].x+"|"+O.isoVecsABOB[j][i].y);this.face.push([O.vecToidx[K[0]],O.vecToidx[K[1]],O.vecToidx[K[2]]])}}mapOBOAtoDATA(I,O){const C=O.IDATA.edgematch[I][0];for(let j=0;j<O.isoVecsOBOA.length;j++){const K=[];for(let i=0;i<3;i++)1===O.vertexTypes[j][i]?K.push(I+"|"+O.isoVecsOBOA[j][i].x+"|"+O.isoVecsOBOA[j][i].y):K.push(C+"|"+O.isoVecsOBOA[j][i].x+"|"+O.isoVecsOBOA[j][i].y);this.face.push([O.vecToidx[K[0]],O.vecToidx[K[1]],O.vecToidx[K[2]]])}}mapBAOAtoDATA(I,O){const C=O.IDATA.edgematch[I][2];for(let j=0;j<O.isoVecsBAOA.length;j++){const K=[];for(let i=0;i<3;i++)1===O.vertexTypes[j][i]?K.push(I+"|"+O.isoVecsBAOA[j][i].x+"|"+O.isoVecsBAOA[j][i].y):K.push(C+"|"+O.isoVecsBAOA[j][i].x+"|"+O.isoVecsBAOA[j][i].y);this.face.push([O.vecToidx[K[0]],O.vecToidx[K[1]],O.vecToidx[K[2]]])}}orderData(I){const O=[];for(let i=0;i<13;i++)O[i]=[];const C=I.closestTo;for(let i=0;i<C.length;i++)C[i][0]>-1?C[i][1]>0&&O[C[i][0]].push([i,C[i][1]]):O[12].push([i,C[i][0]]);const j=[];for(let i=0;i<12;i++)j[i]=i;let K=12;for(let i=0;i<12;i++){O[i].sort(((I,O)=>I[1]-O[1]));for(let I=0;I<O[i].length;I++)j[O[i][I][0]]=K++}for(let i=0;i<O[12].length;i++)j[O[12][i][0]]=K++;for(let i=0;i<this.vertex.length;i++)this.vertex[i].push(j[i]);this.vertex.sort(((I,O)=>I[3]-O[3]));for(let i=0;i<this.vertex.length;i++)this.vertex[i].pop();for(let i=0;i<this.face.length;i++)for(let I=0;I<this.face[i].length;I++)this.face[i][I]=j[this.face[i][I]];this.sharedNodes=O[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(I,O){const C=[],j=[];let K=O.pop();j.push(K);let i=this.face[K].indexOf(I);i=(i+2)%3;let y=this.face[K][i];C.push(y);let S=0;for(;O.length>0;)K=O[S],this.face[K].indexOf(y)>-1?(i=(this.face[K].indexOf(y)+1)%3,y=this.face[K][i],C.push(y),j.push(K),O.splice(S,1),S=0):S++;return this.adjacentFaces.push(C),j}toGoldbergPolyhedronData(){const I=new jI("GeoDual","Goldberg",[],[]);I.name="GD dual";const O=this.vertex.length,C=new Array(O);for(let U=0;U<O;U++)C[U]=[];for(let U=0;U<this.face.length;U++)for(let I=0;I<3;I++)C[this.face[U][I]].push(U);let j=0,K=0,i=0,y=[],S=[];this.adjacentFaces=[];for(let U=0;U<C.length;U++){I.face[U]=this.setOrder(U,C[U].concat([]));for(const O of C[U]){j=0,K=0,i=0,y=this.face[O];for(let I=0;I<3;I++)S=this.vertex[y[I]],j+=S[0],K+=S[1],i+=S[2];I.vertex[O]=[j/3,K/3,i/3]}}return I}static BuildGeodesicData(I){const O=new KI("Geodesic-m-n","Geodesic",[[0,II.h,-1],[-II.h,1,0],[-1,0,-II.h],[1,0,-II.h],[II.h,1,0],[0,II.h,1],[-1,0,II.h],[-II.h,-1,0],[0,-II.h,-1],[II.h,-1,0],[1,0,II.h],[0,-II.h,1]],[]);I.setIndices(),I.calcCoeffs(),I.createInnerFacets(),I.edgeVecsABOB(),I.mapABOBtoOBOA(),I.mapABOBtoBAOA();for(let C=0;C<I.IDATA.face.length;C++)I.MapToFace(C,O),O.innerToData(C,I),"B"===I.IDATA.edgematch[C][1]&&O.mapABOBtoDATA(C,I),"O"===I.IDATA.edgematch[C][1]&&O.mapOBOAtoDATA(C,I),"A"===I.IDATA.edgematch[C][3]&&O.mapBAOAtoDATA(C,I);O.orderData(I);return O.vertex=O.vertex.map((function(I){const O=I[0],C=I[1],j=I[2],K=Math.sqrt(O*O+C*C+j*j);return I[0]*=1/K,I[1]*=1/K,I[2]*=1/K,I})),O}}K.c._GoldbergMeshParser=(I,O)=>iI.Parse(I,O);class iI extends K.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(I,O){return void 0===O?(I>this.goldbergData.nbUnsharedFaces-1&&(G.c.Warn("Maximum number of unshared faces used"),I=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+I):(I>11&&(G.c.Warn("Last pole used"),I=11),O>this.goldbergData.nbFacesAtPole-1&&(G.c.Warn("Maximum number of faces at a pole used"),O=this.goldbergData.nbFacesAtPole-1),12+I*this.goldbergData.nbFacesAtPole+O)}_changeGoldbergFaceColors(I){for(let C=0;C<I.length;C++){const O=I[C][0],j=I[C][1],K=I[C][2];for(let I=O;I<j+1;I++)this.goldbergData.faceColors[I]=K}const O=[];for(let C=0;C<12;C++)for(let I=0;I<5;I++)O.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);for(let C=12;C<this.goldbergData.faceColors.length;C++)for(let I=0;I<6;I++)O.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);return O}setGoldbergFaceColors(I){const O=this._changeGoldbergFaceColors(I);this.xI(i.e.ColorKind,O)}updateGoldbergFaceColors(I){const O=this._changeGoldbergFaceColors(I);this.updateVerticesData(i.e.ColorKind,O)}_changeGoldbergFaceUVs(I){const O=this.getVerticesData(i.e.UVKind);for(let C=0;C<I.length;C++){const j=I[C][0],K=I[C][1],i=I[C][2],y=I[C][3],S=I[C][4],U=[],p=[];let N,Q;for(let I=0;I<5;I++)N=i.x+y*Math.cos(S+I*Math.PI/2.5),Q=i.y+y*Math.sin(S+I*Math.PI/2.5),N<0&&(N=0),N>1&&(N=1),U.push(N,Q);for(let I=0;I<6;I++)N=i.x+y*Math.cos(S+I*Math.PI/3),Q=i.y+y*Math.sin(S+I*Math.PI/3),N<0&&(N=0),N>1&&(N=1),p.push(N,Q);for(let I=j;I<Math.min(12,K+1);I++)for(let C=0;C<5;C++)O[10*I+2*C]=U[2*C],O[10*I+2*C+1]=U[2*C+1];for(let I=Math.max(12,j);I<K+1;I++)for(let C=0;C<6;C++)O[12*I-24+2*C]=p[2*C],O[12*I-23+2*C]=p[2*C+1]}return O}setGoldbergFaceUVs(I){const O=this._changeGoldbergFaceUVs(I);this.xI(i.e.UVKind,O)}updateGoldbergFaceUVs(I){const O=this._changeGoldbergFaceUVs(I);this.updateVerticesData(i.e.UVKind,O)}placeOnGoldbergFaceAt(I,O,C){const K=j.mC.RotationFromAxis(this.goldbergData.faceXaxis[O],this.goldbergData.faceYaxis[O],this.goldbergData.faceZaxis[O]);I.rotation=K,I.position=this.goldbergData.faceCenters[O].add(this.goldbergData.faceXaxis[O].scale(C.x)).add(this.goldbergData.faceYaxis[O].scale(C.y)).add(this.goldbergData.faceZaxis[O].scale(C.z))}serialize(I){super.serialize(I),I.type="GoldbergMesh";const O={};if(O.adjacentFaces=this.goldbergData.adjacentFaces,O.nbSharedFaces=this.goldbergData.nbSharedFaces,O.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,O.nbFaces=this.goldbergData.nbFaces,O.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){O.faceColors=[];for(const I of this.goldbergData.faceColors)O.faceColors.push(I.qS())}if(this.goldbergData.faceCenters){O.faceCenters=[];for(const I of this.goldbergData.faceCenters)O.faceCenters.push(I.qS())}if(this.goldbergData.faceZaxis){O.faceZaxis=[];for(const I of this.goldbergData.faceZaxis)O.faceZaxis.push(I.qS())}if(this.goldbergData.faceYaxis){O.faceYaxis=[];for(const I of this.goldbergData.faceYaxis)O.faceYaxis.push(I.qS())}if(this.goldbergData.faceXaxis){O.faceXaxis=[];for(const I of this.goldbergData.faceXaxis)O.faceXaxis.push(I.qS())}I.goldbergData=O}static Parse(I,O){const C=I.goldbergData;C.faceColors=C.faceColors.map((I=>s.TS.YO(I))),C.faceCenters=C.faceCenters.map((I=>j.mC.YO(I))),C.faceZaxis=C.faceZaxis.map((I=>j.mC.YO(I))),C.faceXaxis=C.faceXaxis.map((I=>j.mC.YO(I))),C.faceYaxis=C.faceYaxis.map((I=>j.mC.YO(I)));const K=new iI(I.name,O);return K.goldbergData=C,K}}var yI=C(12786);const SI={CreateBox:Q.d,CreateTiledBox:E,CreateSphere:h.c,CreateDisc:N.d,CreateIcoSphere:g,CreateRibbon:p,CreateCylinder:o,CreateTorus:n,CreateTorusKnot:T,CreateLineSystem:H.d,Wp:H.g,CreateDashedLines:H.b,ExtrudeShape:M,ExtrudeShapeCustom:u,CreateLathe:f,CreateTiledPlane:q,cp:l.d,CreateGround:x.f,CreateTiledGround:x.j,CreateGroundFromHeightMap:x.d,CreatePolygon:b.e,ExtrudePolygon:b.f,CreateTube:D,CreatePolyhedron:d,CreateGeodesic:function(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=O.m||1;j!==Math.floor(j)&&(j=Math.floor(j),G.c.Warn("m not an integer only floor(m) used"));let K=O.n||0;if(K!==Math.floor(K)&&(K=Math.floor(K),G.c.Warn("n not an integer only floor(n) used")),K>j){const I=K;K=j,j=I,G.c.Warn("n > m therefore m and n swapped")}const i=new CI;return i.build(j,K),d(I,{custom:KI.BuildGeodesicData(i),size:O.size,sizeX:O.sizeX,sizeY:O.sizeY,sizeZ:O.sizeZ,faceUV:O.faceUV,faceColors:O.faceColors,flat:O.flat,updatable:O.updatable,sideOrientation:O.sideOrientation,frontUVs:O.frontUVs,backUVs:O.backUVs},C)},CreateGoldberg:function(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=O.size,U=O.sizeX||i||1,p=O.sizeY||i||1,N=O.sizeZ||i||1;let Q=O.m||1;Q!==Math.floor(Q)&&(Q=Math.floor(Q),G.c.Warn("m not an integer only floor(m) used"));let Z=O.n||0;if(Z!==Math.floor(Z)&&(Z=Math.floor(Z),G.c.Warn("n not an integer only floor(n) used")),Z>Q){const I=Z;Z=Q,Q=I,G.c.Warn("n > m therefore m and n swapped")}const q=new CI;q.build(Q,Z);const mI=KI.BuildGeodesicData(q),E=mI.toGoldbergPolyhedronData(),h=new iI(I,C);O.sideOrientation=K.c._GetDefaultSideOrientation(O.sideOrientation),h._originalBuilderSideOrientation=O.sideOrientation;(function(I,O){const C=I.size,K=I.sizeX||C||1,i=I.sizeY||C||1,U=I.sizeZ||C||1,p=0===I.sideOrientation?0:I.sideOrientation||y.e.DEFAULTSIDE,N=[],Q=[],s=[],Z=[];let q=1/0,mI=-1/0,E=1/0,h=-1/0;for(let j=0;j<O.vertex.length;j++)q=Math.min(q,O.vertex[j][0]*K),mI=Math.max(mI,O.vertex[j][0]*K),E=Math.min(E,O.vertex[j][1]*i),h=Math.max(h,O.vertex[j][1]*i);let r=0;for(let y=0;y<O.face.length;y++){const I=O.face[y],C=j.mC.YO(O.vertex[I[0]]),p=j.mC.YO(O.vertex[I[2]]),W=j.mC.YO(O.vertex[I[1]]),Y=p.EO(C),o=W.EO(C),c=j.mC.Cross(o,Y).normalize();for(let j=0;j<I.length;j++){s.push(c.x,c.y,c.z);const C=O.vertex[I[j]];N.push(C[0]*K,C[1]*i,C[2]*U);const y=(C[1]*i-E)/(h-E);Z.push((C[0]*K-q)/(mI-q),S.b?1-y:y)}for(let O=0;O<I.length-2;O++)Q.push(r,r+O+2,r+O+1);r+=I.length}y.e._ComputeSides(p,N,Q,s,Z);const W=new y.e;return W.TI=N,W.indices=Q,W.HI=s,W.aI=Z,W})(O,E).uI(h,O.updatable),h.goldbergData.nbSharedFaces=mI.sharedNodes,h.goldbergData.nbUnsharedFaces=mI.poleNodes,h.goldbergData.adjacentFaces=mI.adjacentFaces,h.goldbergData.nbFaces=h.goldbergData.nbSharedFaces+h.goldbergData.nbUnsharedFaces,h.goldbergData.nbFacesAtPole=(h.goldbergData.nbUnsharedFaces-12)/12;for(let K=0;K<mI.vertex.length;K++)h.goldbergData.faceCenters.push(j.mC.YO(mI.vertex[K])),h.goldbergData.faceCenters[K].x*=U,h.goldbergData.faceCenters[K].y*=p,h.goldbergData.faceCenters[K].z*=N,h.goldbergData.faceColors.push(new s.TS(1,1,1,1));for(let K=0;K<E.face.length;K++){const I=E.face[K],O=j.mC.YO(E.vertex[I[0]]),C=j.mC.YO(E.vertex[I[2]]),i=j.mC.YO(E.vertex[I[1]]),y=C.EO(O),S=i.EO(O),U=j.mC.Cross(S,y).normalize(),p=j.mC.Cross(S,U).normalize();h.goldbergData.faceXaxis.push(S.normalize()),h.goldbergData.faceYaxis.push(U),h.goldbergData.faceZaxis.push(p)}return h},CreateDecal:B,CreateCapsule:R,CreateText:yI.d}},13453:(I,O,C)=>{"use strict";C.d(O,{e:()=>SO});var j=C(12272),K=C(12612);class i extends K.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var y=C(12307),S=(C(12430),C(12226));class U{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(I){this._targetStopDuration!==I&&(this._targetStopDuration=I)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(I){this._noiseTexture!==I&&(this._noiseTexture=I,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(I){this._animationSheetEnabled!==I&&(this._animationSheetEnabled=I)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(I){this._isAnimationSheetEnabled!=I&&(this._isAnimationSheetEnabled=I,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(I){this._useLogarithmicDepth=I&&this.nI().getEngine().getCaps().fragmentDepthSupported}nI(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(I){switch(I){case U.BLENDMODE_MULTIPLYADD:return;case U.BLENDMODE_ADD:I=1;break;case U.BLENDMODE_ONEONE:I=6;break;case U.BLENDMODE_STANDARD:I=2;break;case U.BLENDMODE_MULTIPLY:I=4;break;case U.BLENDMODE_SUBTRACT:I=3}this._engine.setAlphaMode(I)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:j.mC.Zero()}set direction1(I){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=I)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:j.mC.Zero()}set direction2(I){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=I)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:j.mC.Zero()}set minEmitBox(I){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=I)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:j.mC.Zero()}set maxEmitBox(I){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=I)}get billboardMode(){return this._billboardMode}set billboardMode(I){this._billboardMode!==I&&(this._billboardMode=I,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(I){this._isBillboardBased!==I&&(this._isBillboardBased=I,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(I){this._attachImageProcessingConfiguration(I)}_attachImageProcessingConfiguration(I){I!==this._imageProcessingConfiguration&&(!I&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=I)}_reset(){}_removeGradientAndTexture(I,O,C){if(!O)return this;let j=0;for(const K of O){if(K.gradient===I){O.splice(j,1);break}j++}return C&&C.dispose(),this}constructor(I){this.animations=[],this.renderingGroupId=0,this.KO=j.mC.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new j.mC(10,10,10),this.onAnimationEnd=null,this.blendMode=U.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new j.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Ep=new j.mC(0,0,0),this._useLogarithmicDepth=!1,this.gravity=j.mC.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new y.TS(1,1,1,1),this.color2=new y.TS(1,1,1,1),this.colorDead=new y.TS(0,0,0,1),this.textureMask=new y.TS(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new i,this.id=I,this.name=I}createPointEmitter(I,O){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new j.mC(0,1,0),arguments.length>2&&void 0!==arguments[2]||new j.mC(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new j.mC(0,1,0),arguments.length>4&&void 0!==arguments[4]||new j.mC(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new j.mC(0,1,0),arguments.length>3&&void 0!==arguments[3]||new j.mC(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(I,O,C,j){throw new Error("Method not implemented.")}}U.BLENDMODE_ONEONE=0,U.BLENDMODE_STANDARD=1,U.BLENDMODE_ADD=2,U.BLENDMODE_MULTIPLY=3,U.BLENDMODE_MULTIPLYADD=4,U.BLENDMODE_SUBTRACT=-1,(0,S.e)("BABYLON.BaseParticleSystem",U);var p=C(12282),N=C(12112);class Q{constructor(){this.direction1=new j.mC(0,1,0),this.direction2=new j.mC(0,1,0),this.minEmitBox=new j.mC(-.5,-.5,-.5),this.maxEmitBox=new j.mC(.5,.5,.5)}startDirectionFunction(I,O,C,K){const i=(0,p.RandomRange)(this.direction1.x,this.direction2.x),y=(0,p.RandomRange)(this.direction1.y,this.direction2.y),S=(0,p.RandomRange)(this.direction1.z,this.direction2.z);if(K)return O.x=i,O.y=y,void(O.z=S);j.mC.TransformNormalFromFloatsToRef(i,y,S,I,O)}startPositionFunction(I,O,C,K){const i=(0,p.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),y=(0,p.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),S=(0,p.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(K)return O.x=i,O.y=y,void(O.z=S);j.mC.TransformCoordinatesFromFloatsToRef(i,y,S,I,O)}clone(){const I=new Q;return N.b.DeepCopy(this,I),I}applyToShader(I){I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2),I.setVector3("minEmitBox",this.minEmitBox),I.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(I){I.addUniform("direction1",3),I.addUniform("direction2",3),I.addUniform("minEmitBox",3),I.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.direction1=this.direction1.qS(),I.direction2=this.direction2.qS(),I.minEmitBox=this.minEmitBox.qS(),I.maxEmitBox=this.maxEmitBox.qS(),I}parse(I){j.mC.FromArrayToRef(I.direction1,0,this.direction1),j.mC.FromArrayToRef(I.direction2,0,this.direction2),j.mC.FromArrayToRef(I.minEmitBox,0,this.minEmitBox),j.mC.FromArrayToRef(I.maxEmitBox,0,this.maxEmitBox)}}class s{get radius(){return this._radius}set radius(I){this._radius=I,this._buildHeight()}get angle(){return this._angle}set angle(I){this._angle=I,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=C,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=O,this.radius=I}startDirectionFunction(I,O,C,K){K?j.TmpVectors.mC[0].K(C.vS).normalize():C.position.subtractToRef(I.getTranslation(),j.TmpVectors.mC[0]).normalize();const i=(0,p.RandomRange)(0,this.directionRandomizer),y=(0,p.RandomRange)(0,this.directionRandomizer),S=(0,p.RandomRange)(0,this.directionRandomizer);O.x=j.TmpVectors.mC[0].x+i,O.y=j.TmpVectors.mC[0].y+y,O.z=j.TmpVectors.mC[0].z+S,O.normalize()}startPositionFunction(I,O,C,K){const i=(0,p.RandomRange)(0,2*Math.PI);let y;this.emitFromSpawnPointOnly?y=1e-4:(y=(0,p.RandomRange)(0,this.heightRange),y=1-y*y);let S=this._radius-(0,p.RandomRange)(0,this._radius*this.radiusRange);S*=y;const U=S*Math.sin(i),N=S*Math.cos(i),Q=y*this._height;if(K)return O.x=U,O.y=Q,void(O.z=N);j.mC.TransformCoordinatesFromFloatsToRef(U,Q,N,I,O)}clone(){const I=new s(this._radius,this._angle,this.directionRandomizer);return N.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat2("radius",this._radius,this.radiusRange),I.setFloat("coneAngle",this._angle),I.setFloat2("height",this._height,this.heightRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",2),I.addUniform("coneAngle",1),I.addUniform("height",2),I.addUniform("directionRandomizer",1)}getEffectDefines(){let I="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(I+="\n#define CONEEMITTERSPAWNPOINT"),I}getClassName(){return"ConeParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this._radius,I.angle=this._angle,I.directionRandomizer=this.directionRandomizer,I.radiusRange=this.radiusRange,I.heightRange=this.heightRange,I.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,I}parse(I){this.radius=I.radius,this.angle=I.angle,this.directionRandomizer=I.directionRandomizer,this.radiusRange=void 0!==I.radiusRange?I.radiusRange:1,this.heightRange=void 0!==I.radiusRange?I.heightRange:1,this.emitFromSpawnPointOnly=void 0!==I.emitFromSpawnPointOnly&&I.emitFromSpawnPointOnly}}class Z extends s{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.mC(0,1,0),K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.mC(0,1,0);super(I,O),this.direction1=C,this.direction2=K}startDirectionFunction(I,O){const C=(0,p.RandomRange)(this.direction1.x,this.direction2.x),K=(0,p.RandomRange)(this.direction1.y,this.direction2.y),i=(0,p.RandomRange)(this.direction1.z,this.direction2.z);j.mC.TransformNormalFromFloatsToRef(C,K,i,I,O)}clone(){const I=new Z(this.radius,this.angle,this.direction1,this.direction2);return N.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const I=super.serialize();return I.direction1=this.direction1.qS(),I.direction2=this.direction2.qS(),I}parse(I){super.parse(I),this.direction1.K(I.direction1),this.direction2.K(I.direction2)}}class q{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=I,this.height=O,this.radiusRange=C,this.directionRandomizer=K,this._tempVector=j.mC.Zero()}startDirectionFunction(I,O,C,K,i){C.position.subtractToRef(I.getTranslation(),this._tempVector),this._tempVector.normalize(),j.mC.TransformNormalToRef(this._tempVector,i,this._tempVector);const y=(0,p.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let S=Math.atan2(this._tempVector.x,this._tempVector.z);S+=(0,p.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=y,this._tempVector.x=Math.sin(S),this._tempVector.z=Math.cos(S),this._tempVector.normalize(),K?O.K(this._tempVector):j.mC.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,I,O)}startPositionFunction(I,O,C,K){const i=(0,p.RandomRange)(-this.height/2,this.height/2),y=(0,p.RandomRange)(0,2*Math.PI),S=(0,p.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),U=Math.sqrt(S)*this.radius,N=U*Math.cos(y),Q=U*Math.sin(y);K?O.cS(N,i,Q):j.mC.TransformCoordinatesFromFloatsToRef(N,i,Q,I,O)}clone(){const I=new q(this.radius,this.directionRandomizer);return N.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("height",this.height),I.setFloat("radiusRange",this.radiusRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("height",1),I.addUniform("radiusRange",1),I.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this.radius,I.height=this.height,I.radiusRange=this.radiusRange,I.directionRandomizer=this.directionRandomizer,I}parse(I){this.radius=I.radius,this.height=I.height,this.radiusRange=I.radiusRange,this.directionRandomizer=I.directionRandomizer}}class mI extends q{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.mC(0,1,0),i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.mC(0,1,0);super(I,O,C),this.direction1=K,this.direction2=i}startDirectionFunction(I,O,C,K){const i=(0,p.RandomRange)(this.direction1.x,this.direction2.x),y=(0,p.RandomRange)(this.direction1.y,this.direction2.y),S=(0,p.RandomRange)(this.direction1.z,this.direction2.z);K?O.cS(i,y,S):j.mC.TransformNormalFromFloatsToRef(i,y,S,I,O)}clone(){const I=new mI(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return N.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("height",this.height),I.setFloat("radiusRange",this.radiusRange),I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("height",1),I.addUniform("radiusRange",1),I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const I=super.serialize();return I.direction1=this.direction1.qS(),I.direction2=this.direction2.qS(),I}parse(I){super.parse(I),j.mC.FromArrayToRef(I.direction1,0,this.direction1),j.mC.FromArrayToRef(I.direction2,0,this.direction2)}}class E{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=I,this.radiusRange=O,this.directionRandomizer=C}startDirectionFunction(I,O,C,K){const i=C.position.EO(I.getTranslation()).normalize(),y=(0,p.RandomRange)(0,this.directionRandomizer),S=(0,p.RandomRange)(0,this.directionRandomizer),U=(0,p.RandomRange)(0,this.directionRandomizer);i.x+=y,i.y+=S,i.z+=U,i.normalize(),K?O.K(i):j.mC.TransformNormalFromFloatsToRef(i.x,i.y,i.z,I,O)}startPositionFunction(I,O,C,K){const i=this.radius-(0,p.RandomRange)(0,this.radius*this.radiusRange),y=(0,p.RandomRange)(0,1),S=(0,p.RandomRange)(0,2*Math.PI),U=Math.acos(2*y-1),N=i*Math.cos(S)*Math.sin(U),Q=i*Math.cos(U),s=i*Math.sin(S)*Math.sin(U);K?O.cS(N,Math.abs(Q),s):j.mC.TransformCoordinatesFromFloatsToRef(N,Math.abs(Q),s,I,O)}clone(){const I=new E(this.radius,this.directionRandomizer);return N.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this.radius,I.radiusRange=this.radiusRange,I.directionRandomizer=this.directionRandomizer,I}parse(I){this.radius=I.radius,this.radiusRange=I.radiusRange,this.directionRandomizer=I.directionRandomizer}}class h{constructor(){this.direction1=new j.mC(0,1,0),this.direction2=new j.mC(0,1,0)}startDirectionFunction(I,O,C,K){const i=(0,p.RandomRange)(this.direction1.x,this.direction2.x),y=(0,p.RandomRange)(this.direction1.y,this.direction2.y),S=(0,p.RandomRange)(this.direction1.z,this.direction2.z);K?O.cS(i,y,S):j.mC.TransformNormalFromFloatsToRef(i,y,S,I,O)}startPositionFunction(I,O,C,K){K?O.cS(0,0,0):j.mC.TransformCoordinatesFromFloatsToRef(0,0,0,I,O)}clone(){const I=new h;return N.b.DeepCopy(this,I),I}applyToShader(I){I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.direction1=this.direction1.qS(),I.direction2=this.direction2.qS(),I}parse(I){j.mC.FromArrayToRef(I.direction1,0,this.direction1),j.mC.FromArrayToRef(I.direction2,0,this.direction2)}}class r{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=I,this.radiusRange=O,this.directionRandomizer=C}startDirectionFunction(I,O,C,K){const i=C.position.EO(I.getTranslation()).normalize(),y=(0,p.RandomRange)(0,this.directionRandomizer),S=(0,p.RandomRange)(0,this.directionRandomizer),U=(0,p.RandomRange)(0,this.directionRandomizer);i.x+=y,i.y+=S,i.z+=U,i.normalize(),K?O.K(i):j.mC.TransformNormalFromFloatsToRef(i.x,i.y,i.z,I,O)}startPositionFunction(I,O,C,K){const i=this.radius-(0,p.RandomRange)(0,this.radius*this.radiusRange),y=(0,p.RandomRange)(0,1),S=(0,p.RandomRange)(0,2*Math.PI),U=Math.acos(2*y-1),N=i*Math.cos(S)*Math.sin(U),Q=i*Math.cos(U),s=i*Math.sin(S)*Math.sin(U);K?O.cS(N,Q,s):j.mC.TransformCoordinatesFromFloatsToRef(N,Q,s,I,O)}clone(){const I=new r(this.radius,this.directionRandomizer);return N.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this.radius,I.radiusRange=this.radiusRange,I.directionRandomizer=this.directionRandomizer,I}parse(I){this.radius=I.radius,this.radiusRange=I.radiusRange,this.directionRandomizer=I.directionRandomizer}}class W extends r{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.mC(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.mC(0,1,0);super(I),this.direction1=O,this.direction2=C}startDirectionFunction(I,O){const C=(0,p.RandomRange)(this.direction1.x,this.direction2.x),K=(0,p.RandomRange)(this.direction1.y,this.direction2.y),i=(0,p.RandomRange)(this.direction1.z,this.direction2.z);j.mC.TransformNormalFromFloatsToRef(C,K,i,I,O)}clone(){const I=new W(this.radius,this.direction1,this.direction2);return N.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const I=super.serialize();return I.direction1=this.direction1.qS(),I.direction2=this.direction2.qS(),I}parse(I){super.parse(I),this.direction1.K(I.direction1),this.direction2.K(I.direction2)}}class Y{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(I,O,C,K){const i=j.TmpVectors.mC[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,C,i);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,C,i);const I=j.TmpVectors.mC[1];i.subtractToRef(C.position,I),I.scaleToRef(1/C.lifeTime,i)}else i.set(0,0,0);K?O.K(i):j.mC.TransformNormalToRef(i,I,O)}startPositionFunction(I,O,C,K){const i=j.TmpVectors.mC[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,C,i):i.set(0,0,0),K?O.K(i):j.mC.TransformCoordinatesToRef(i,I,O)}clone(){const I=new Y;return N.b.DeepCopy(this,I),I}applyToShader(I){}buildUniformLayout(I){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.particlePositionGenerator=this.particlePositionGenerator,I.particleDestinationGenerator=this.particleDestinationGenerator,I}parse(I){I.particlePositionGenerator&&(this.particlePositionGenerator=I.particlePositionGenerator),I.particleDestinationGenerator&&(this.particleDestinationGenerator=I.particleDestinationGenerator)}}var o=C(12329);class c{get mesh(){return this._mesh}set mesh(I){this._mesh!==I&&(this._mesh=I,I?(this._indices=I.YS(),this._positions=I.getVerticesData(o.e.PositionKind),this._normals=I.getVerticesData(o.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=j.mC.Zero(),this._mesh=null,this.direction1=new j.mC(0,1,0),this.direction2=new j.mC(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=I}startDirectionFunction(I,O,C,K){if(this.useMeshNormalsForDirection&&this._normals)return void j.mC.TransformNormalToRef(this._storedNormal,I,O);const i=(0,p.RandomRange)(this.direction1.x,this.direction2.x),y=(0,p.RandomRange)(this.direction1.y,this.direction2.y),S=(0,p.RandomRange)(this.direction1.z,this.direction2.z);K?O.cS(i,y,S):j.mC.TransformNormalFromFloatsToRef(i,y,S,I,O)}startPositionFunction(I,O,C,K){if(!this._indices||!this._positions)return;const i=3*(Math.random()*(this._indices.length/3)|0),y=Math.random(),S=Math.random()*(1-y),U=1-y-S,p=this._indices[i],N=this._indices[i+1],Q=this._indices[i+2],s=j.TmpVectors.mC[0],Z=j.TmpVectors.mC[1],q=j.TmpVectors.mC[2],mI=j.TmpVectors.mC[3];j.mC.FromArrayToRef(this._positions,3*p,s),j.mC.FromArrayToRef(this._positions,3*N,Z),j.mC.FromArrayToRef(this._positions,3*Q,q),mI.x=y*s.x+S*Z.x+U*q.x,mI.y=y*s.y+S*Z.y+U*q.y,mI.z=y*s.z+S*Z.z+U*q.z,K?O.cS(mI.x,mI.y,mI.z):j.mC.TransformCoordinatesFromFloatsToRef(mI.x,mI.y,mI.z,I,O),this.useMeshNormalsForDirection&&this._normals&&(j.mC.FromArrayToRef(this._normals,3*p,s),j.mC.FromArrayToRef(this._normals,3*N,Z),j.mC.FromArrayToRef(this._normals,3*Q,q),this._storedNormal.x=y*s.x+S*Z.x+U*q.x,this._storedNormal.y=y*s.y+S*Z.y+U*q.y,this._storedNormal.z=y*s.z+S*Z.z+U*q.z)}clone(){const I=new c(this.mesh);return N.b.DeepCopy(this,I),I}applyToShader(I){I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var I;const O={};return O.type=this.getClassName(),O.direction1=this.direction1.qS(),O.direction2=this.direction2.qS(),O.meshId=null===(I=this.mesh)||void 0===I?void 0:I.id,O.useMeshNormalsForDirection=this.useMeshNormalsForDirection,O}parse(I,O){j.mC.FromArrayToRef(I.direction1,0,this.direction1),j.mC.FromArrayToRef(I.direction2,0,this.direction2),I.meshId&&O&&(this.mesh=O.getLastMeshById(I.meshId)),this.useMeshNormalsForDirection=I.useMeshNormalsForDirection}}class n{_isUbo(I){return void 0!==I.addUniform}constructor(I){this._isUbo(I)?(this.setMatrix3x3=I.updateMatrix3x3.bind(I),this.setMatrix2x2=I.updateMatrix2x2.bind(I),this.setFloat=I.updateFloat.bind(I),this.setFloat2=I.updateFloat2.bind(I),this.setFloat3=I.updateFloat3.bind(I),this.setFloat4=I.updateFloat4.bind(I),this.setFloatArray=I.updateFloatArray.bind(I),this.setArray=I.updateArray.bind(I),this.setIntArray=I.updateIntArray.bind(I),this.setMatrix=I.hS.bind(I),this.setMatrices=I.updateMatrices.bind(I),this.setVector3=I.updateVector3.bind(I),this.setVector4=I.updateVector4.bind(I),this.setColor3=I.updateColor3.bind(I),this.setColor4=I.updateColor4.bind(I),this.setDirectColor4=I.updateDirectColor4.bind(I),this.setInt=I.updateInt.bind(I),this.setInt2=I.updateInt2.bind(I),this.setInt3=I.updateInt3.bind(I),this.setInt4=I.updateInt4.bind(I)):(this.setMatrix3x3=I.setMatrix3x3.bind(I),this.setMatrix2x2=I.setMatrix2x2.bind(I),this.setFloat=I.setFloat.bind(I),this.setFloat2=I.setFloat2.bind(I),this.setFloat3=I.setFloat3.bind(I),this.setFloat4=I.setFloat4.bind(I),this.setFloatArray=I.setFloatArray.bind(I),this.setArray=I.setArray.bind(I),this.setIntArray=I.setIntArray.bind(I),this.setMatrix=I.setMatrix.bind(I),this.setMatrices=I.setMatrices.bind(I),this.setVector3=I.setVector3.bind(I),this.setVector4=I.setVector4.bind(I),this.setColor3=I.setColor3.bind(I),this.setColor4=I.setColor4.bind(I),this.setDirectColor4=I.setDirectColor4.bind(I),this.setInt=I.setInt.bind(I),this.setInt2=I.setInt2.bind(I),this.setInt3=I.setInt3.bind(I),this.setInt4=I.setInt4.bind(I))}}var X=C(12179);const T="gpuUpdateParticlesPixelShader",H="#version 300 es\nvoid main() {discard;}\n";X.b.ShadersStore[T]||(X.b.ShadersStore[T]=H);const b="gpuUpdateParticlesVertexShader",a="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";X.b.ShadersStore[b]||(X.b.ShadersStore[b]=a);(0,S.e)("BABYLON.WebGL2ParticleSystem",class{constructor(I,O){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=I,this._engine=O,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var I;return(null===(I=this._updateEffect)||void 0===I?void 0:I.isReady())??!1}createUpdateBuffer(I){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof Y&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=I,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new n(this._updateEffect)}createVertexBuffers(I,O){this._updateVAO.push(this._createUpdateVAO(I)),this._renderVAO.push(this._engine.recordVertexArrayObject(O,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=O}createParticleBuffer(I){return I}bindDrawBuffers(I,O,C){C?this._engine.bindBuffers(this._renderVertexBuffers,C,O):this._engine.bindVertexArrayObject(this._renderVAO[I],null)}preUpdateParticleBuffer(){const I=this._engine;if(this._engine.enableEffect(this._updateEffect),!I.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(I,O,C){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[I],null);const j=this._engine;j.bindTransformFeedbackBuffer(O.getBuffer()),j.setRasterizerState(!1),j.beginTransformFeedback(!0),j.drawArraysType(3,0,C),j.endTransformFeedback(),j.setRasterizerState(!0),j.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let I=0;I<this._updateVAO.length;I++)this._engine.releaseVertexArrayObject(this._updateVAO[I]);this._updateVAO.length=0;for(let I=0;I<this._renderVAO.length;I++)this._engine.releaseVertexArrayObject(this._renderVAO[I]);this._renderVAO.length=0}_createUpdateVAO(I){const O={};O.position=I.createVertexBuffer("position",0,3);let C=3;O.age=I.createVertexBuffer("age",C,1),C+=1,O.size=I.createVertexBuffer("size",C,3),C+=3,O.life=I.createVertexBuffer("life",C,1),C+=1,O.seed=I.createVertexBuffer("seed",C,4),C+=4,O.direction=I.createVertexBuffer("direction",C,3),C+=3,this._parent.particleEmitterType instanceof Y&&(O.initialPosition=I.createVertexBuffer("initialPosition",C,3),C+=3),this._parent._colorGradientsTexture||(O.color=I.createVertexBuffer("color",C,4),C+=4),this._parent._isBillboardBased||(O.initialDirection=I.createVertexBuffer("initialDirection",C,3),C+=3),this._parent.noiseTexture&&(O.noiseCoordinates1=I.createVertexBuffer("noiseCoordinates1",C,3),C+=3,O.noiseCoordinates2=I.createVertexBuffer("noiseCoordinates2",C,3),C+=3),this._parent._angularSpeedGradientsTexture?(O.angle=I.createVertexBuffer("angle",C,1),C+=1):(O.angle=I.createVertexBuffer("angle",C,2),C+=2),this._parent._isAnimationSheetEnabled&&(O.cellIndex=I.createVertexBuffer("cellIndex",C,1),C+=1,this._parent.spriteRandomStartCell&&(O.cellStartOffset=I.createVertexBuffer("cellStartOffset",C,1),C+=1));const j=this._engine.recordVertexArrayObject(O,null,this._updateEffect);return this._engine.bindArrayBuffer(null),j}});class M{constructor(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,j=arguments.length>3?arguments[3]:void 0;this._engine=I,this._label=j,this._engine._storageBuffers.push(this),this._create(O,C)}_create(I,O){this._bufferSize=I,this._creationFlags=O,this._buffer=this._engine.createStorageBuffer(I,O,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(I,O,C){this._buffer&&this._engine.updateStorageBuffer(this._buffer,I,O,C)}async read(I,O,C,j){return await this._engine.readFromStorageBuffer(this._buffer,I,O,C,j)}dispose(){const I=this._engine._storageBuffers,O=I.indexOf(this);-1!==O&&(I[O]=I[I.length-1],I.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var u=C(12250),J=C(12257),f=C(12296),l=C(12245),x=C(12547),D=C(12103),t=C(12208),d=C(12465);class w{constructor(){this._gpuTimeInFrameId=-1,this.counter=new d.c}_addDuration(I,O){I<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==I?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(O,!1),this._gpuTimeInFrameId=I):this.counter.addCount(O,!1))}}var g=C(12163);class V{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=I,this._engine=O,this.uniqueId=x.c.UniqueId,O.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new w),this._engine.getCaps().supportComputeShaders?j.bindingsMapping?(this._context=O.createComputeContext(),this._shaderPath=C,this._options={bindingsMapping:{},defines:[],...j}):D.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):D.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(I,O){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const j=this._bindings[I];this._bindings[I]={type:C?0:4,object:O,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!j||j.object!==O||j.type!==this._bindings[I].type)}setStorageTexture(I,O){const C=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==O),this._bindings[I]={type:1,object:O,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setExternalTexture(I,O){const C=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==O),this._bindings[I]={type:6,object:O,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setVideoTexture(I,O){return!!O.externalTexture&&(this.setExternalTexture(I,O.externalTexture),!0)}setUniformBuffer(I,O){const C=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==O),this._bindings[I]={type:V._BufferIsDataBuffer(O)?7:2,object:O,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setStorageBuffer(I,O){const C=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==O),this._bindings[I]={type:V._BufferIsDataBuffer(O)?7:3,object:O,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setTextureSampler(I,O){const C=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!C||!O.compareSampler(C.object)),this._bindings[I]={type:5,object:O,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}isReady(){let I=this._effect;for(const K in this._bindings){const I=this._bindings[K],O=I.type,C=I.object;switch(O){case 0:case 4:case 1:if(!C.isReady())return!1;break;case 6:if(!C.isReady())return!1;break}}const O=[],C=this._shaderPath;if(this._options.defines)for(let K=0;K<this._options.defines.length;K++)O.push(this._options.defines[K]);const j=O.join("\n");return this._cachedDefines!==j&&(this._cachedDefines=j,I=this._engine.createComputeEffect(C,{defines:j,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=I),!!I.isReady()}dispatch(I,O,C){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,I,O,C,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const C=V._BufferIsDataBuffer(I)?I:I.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,C,O,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const O in this._bindings){const C=this._bindings[O];if(!this._options.bindingsMapping[O])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+O+"'");switch(C.type){case 0:{const j=this._samplers[O],K=C.object;var I;if(!j||!K._texture||!j.compareSampler(K._texture))this._samplers[O]=(new t.c).setParameters(K.wrapU,K.wrapV,K.wrapR,K.anisotropicFilteringLevel,K._texture.samplingMode,null===(I=K._texture)||void 0===I?void 0:I._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const I=C.object;I.getBuffer()!==C.buffer&&(C.buffer=I.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((K=>{(0,g.f)((()=>this.dispatch(I,O,C)),K,void 0,j)}))}serialize(){const I=f.e.Serialize(this);I.options=this._options,I.shaderPath=this._shaderPath,I.ys={},I.textures={};for(const O in this._bindings){const C=this._bindings[O],j=C.object;switch(C.type){case 0:case 4:case 1:{const K=j.serialize();K&&(I.textures[O]=K,I.ys[O]={type:C.type});break}}}return I}static Parse(I,O,C){const j=f.e.Parse((()=>new V(I.name,O.getEngine(),I.shaderPath,I.options)),I,O,C);for(const K in I.textures){const i=I.ys[K],y=l.e.Parse(I.textures[K],O,C);0===i.type?j.setTexture(K,y):4===i.type?j.setTexture(K,y,!1):j.setStorageTexture(K,y)}return j}static _BufferIsDataBuffer(I){return void 0!==I.underlyingResource}}(0,u.e)([(0,J.E)()],V.prototype,"name",void 0),(0,u.e)([(0,J.E)()],V.prototype,"fastMode",void 0),(0,S.e)("BABYLON.ComputeShader",V);var e=C(12511);const L="gpuUpdateParticlesComputeShader",z="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";X.b.ShadersStoreWGSL[L]||(X.b.ShadersStoreWGSL[L]=z);(0,S.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(I,O){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=I,this._engine=O}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var I;return(null===(I=this._updateComputeShader)||void 0===I?void 0:I.isReady())??!1}createUpdateBuffer(I){var O;const C={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(C.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(C.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(C.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(C.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(C.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(C.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(C.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new V("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:C,defines:I.split("\n")}),null===(O=this._simParamsComputeShader)||void 0===O||O.dispose(),this._simParamsComputeShader=new e.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new n(this._simParamsComputeShader)}createVertexBuffers(I,O){this._renderVertexBuffers.push(O)}createParticleBuffer(I){const O=new M(this._engine,4*I.length,11,"ComputeShaderParticleSystemBuffer");return O.update(I),this._bufferComputeShader.push(O),O.getBuffer()}bindDrawBuffers(I,O,C){this._engine.bindBuffers(this._renderVertexBuffers[I],C,O)}preUpdateParticleBuffer(){}updateParticleBuffer(I,O,C){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[I]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^I]),this._updateComputeShader.dispatch(Math.ceil(C/64))}releaseBuffers(){var I;for(let O=0;O<this._bufferComputeShader.length;++O)this._bufferComputeShader[O].dispose();this._bufferComputeShader.length=0,null===(I=this._simParamsComputeShader)||void 0===I||I.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class k{constructor(I,O,C){this.gradient=I,this.color1=O,this.color2=C}getColorToRef(I){this.color2?y.TS.LerpToRef(this.color1,this.color2,Math.random(),I):I.K(this.color1)}}class A{constructor(I,O){this.gradient=I,this.color=O}}class P{constructor(I,O,C){this.gradient=I,this.factor1=O,this.factor2=C}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class v{static GetCurrentGradient(I,O,C){if(O[0].gradient>I)return void C(O[0],O[0],1);for(let K=0;K<O.length-1;K++){const j=O[K],i=O[K+1];if(I>=j.gradient&&I<=i.gradient){return void C(j,i,(I-j.gradient)/(i.gradient-j.gradient))}}const j=O.length-1;C(O[j],O[j],1)}}var B=C(12088),F=C(12703),R=C(12132);class G{constructor(I){this.particleSystem=I,this.position=j.mC.Zero(),this.direction=j.mC.Zero(),this.color=new y.TS(0,0,0,0),this.colorStep=new y.TS(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new j.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new y.TS(0,0,0,0),this._currentColor2=new y.TS(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=G._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let I=this.age,O=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===O?(O=1,I=this._randomCellOffset):I+=this._randomCellOffset);const C=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let j;j=this._initialSpriteCellLoop?(0,p.Clamp)(I*O%this.lifeTime/this.lifeTime):(0,p.Clamp)(I*O/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+j*C|0}_inheritParticleInfoToSubEmitter(I){if(I.particleSystem.KO.position){const O=I.particleSystem.KO;if(O.position.K(this.position),I.inheritDirection){const I=j.TmpVectors.mC[0];this.direction.normalizeToRef(I),O.setDirection(I,0,Math.PI/2)}}else{I.particleSystem.KO.K(this.position)}this.direction.scaleToRef(I.inheritedVelocityAmount/2,j.TmpVectors.mC[0]),I.particleSystem._inheritedVelocityOffset.K(j.TmpVectors.mC[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const I of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(I)}_reset(){this.age=0,this.id=G._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(I){I.position.K(this.position),this._initialDirection?I._initialDirection?I._initialDirection.K(this._initialDirection):I._initialDirection=this._initialDirection.clone():I._initialDirection=null,I.direction.K(this.direction),this.vS&&(I.vS?I.vS.K(this.vS):I.vS=this.vS.clone()),I.color.K(this.color),I.colorStep.K(this.colorStep),I.lifeTime=this.lifeTime,I.age=this.age,I._randomCellOffset=this._randomCellOffset,I.size=this.size,I.scale.K(this.scale),I.angle=this.angle,I.angularSpeed=this.angularSpeed,I.particleSystem=this.particleSystem,I.cellIndex=this.cellIndex,I.id=this.id,I._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(I._currentColorGradient=this._currentColorGradient,I._currentColor1.K(this._currentColor1),I._currentColor2.K(this._currentColor2)),this._currentSizeGradient&&(I._currentSizeGradient=this._currentSizeGradient,I._currentSize1=this._currentSize1,I._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(I._currentAngularSpeedGradient=this._currentAngularSpeedGradient,I._currentAngularSpeed1=this._currentAngularSpeed1,I._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(I._currentVelocityGradient=this._currentVelocityGradient,I._currentVelocity1=this._currentVelocity1,I._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(I._currentLimitVelocityGradient=this._currentLimitVelocityGradient,I._currentLimitVelocity1=this._currentLimitVelocity1,I._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(I._currentDragGradient=this._currentDragGradient,I._currentDrag1=this._currentDrag1,I._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(I._initialStartSpriteCellId=this._initialStartSpriteCellId,I._initialEndSpriteCellId=this._initialEndSpriteCellId,I._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(I.remapData&&this.remapData?I.remapData.K(this.remapData):I.remapData=new j.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(I._randomNoiseCoordinates1?(I._randomNoiseCoordinates1.K(this._randomNoiseCoordinates1),I._randomNoiseCoordinates2.K(this._randomNoiseCoordinates2)):(I._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),I._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}G._Count=0;var II=C(12380),OI=(C(12427),C(12599)),CI=C(12596),jI=C(12504);function KI(I,O){const C=(0,p.RandomRange)(0,1);y.TS.LerpToRef(O.color1,O.color2,C,I.color),O.colorDead.subtractToRef(I.color,O._colorDiff),O._colorDiff.scaleToRef(1/I.lifeTime,I.colorStep)}function iI(I,O){I._currentColorGradient=O._colorGradients[0],I._currentColorGradient.getColorToRef(I.color),I._currentColor1.K(I.color),O._colorGradients.length>1?O._colorGradients[1].getColorToRef(I._currentColor2):I._currentColor2.K(I.color)}function yI(I,O){const C=O._colorGradients;v.GetCurrentGradient(O._ratio,C,((O,C,j)=>{O!==I._currentColorGradient&&(I._currentColor1.K(I._currentColor2),C.getColorToRef(I._currentColor2),I._currentColorGradient=O),y.TS.LerpToRef(I._currentColor1,I._currentColor2,j,I.color)}))}function SI(I,O){I.colorStep.scaleToRef(O._scaledUpdateSpeed,O._scaledColorStep),I.color.addInPlace(O._scaledColorStep),I.color.a<0&&(I.color.a=0)}function UI(I,O){v.GetCurrentGradient(O._ratio,O._angularSpeedGradients,((O,C,j)=>{O!==I._currentAngularSpeedGradient&&(I._currentAngularSpeed1=I._currentAngularSpeed2,I._currentAngularSpeed2=C.getFactor(),I._currentAngularSpeedGradient=O),I.angularSpeed=(0,p.Lerp)(I._currentAngularSpeed1,I._currentAngularSpeed2,j)}))}function pI(I,O){I.angle+=I.angularSpeed*O._scaledUpdateSpeed}function NI(I,O){O.particleEmitterType.startDirectionFunction(O._emitterWorldMatrix,I.direction,I,O.isLocal,O._emitterInverseWorldMatrix)}function QI(I,O){O.startDirectionFunction(O._emitterWorldMatrix,I.direction,I,O.isLocal)}function sI(I,O){I._currentVelocityGradient=O._velocityGradients[0],I._currentVelocity1=I._currentVelocityGradient.getFactor(),O._velocityGradients.length>1?I._currentVelocity2=O._velocityGradients[1].getFactor():I._currentVelocity2=I._currentVelocity1}function ZI(I,O){I._currentLimitVelocityGradient=O._limitVelocityGradients[0],I._currentLimitVelocity1=I._currentLimitVelocityGradient.getFactor(),O._limitVelocityGradients.length>1?I._currentLimitVelocity2=O._limitVelocityGradients[1].getFactor():I._currentLimitVelocity2=I._currentLimitVelocity1}function qI(I,O){v.GetCurrentGradient(O._ratio,O._velocityGradients,((C,j,K)=>{C!==I._currentVelocityGradient&&(I._currentVelocity1=I._currentVelocity2,I._currentVelocity2=j.getFactor(),I._currentVelocityGradient=C),O._directionScale*=(0,p.Lerp)(I._currentVelocity1,I._currentVelocity2,K)}))}function mO(I,O){v.GetCurrentGradient(O._ratio,O._limitVelocityGradients,((C,j,K)=>{C!==I._currentLimitVelocityGradient&&(I._currentLimitVelocity1=I._currentLimitVelocity2,I._currentLimitVelocity2=j.getFactor(),I._currentLimitVelocityGradient=C);const i=(0,p.Lerp)(I._currentLimitVelocity1,I._currentLimitVelocity2,K);I.direction.length()>i&&I.direction.scaleInPlace(O.limitVelocityDamping)}))}function EI(I,O){I.direction.scaleToRef(O._directionScale,O._scaledDirection)}function hI(I,O){O.particleEmitterType.startPositionFunction(O._emitterWorldMatrix,I.position,I,O.isLocal)}function rI(I,O){O.startPositionFunction(O._emitterWorldMatrix,I.position,I,O.isLocal)}function WI(I,O){I.vS?I.vS.K(I.position):I.vS=I.position.clone(),j.mC.TransformCoordinatesToRef(I.vS,O._emitterWorldMatrix,I.position)}function YI(I,O){O.isLocal&&I.vS?(I.vS.addInPlace(O._scaledDirection),j.mC.TransformCoordinatesToRef(I.vS,O._emitterWorldMatrix,I.position)):I.position.addInPlace(O._scaledDirection)}function oI(I,O){I._currentDragGradient=O._dragGradients[0],I._currentDrag1=I._currentDragGradient.getFactor(),O._dragGradients.length>1?I._currentDrag2=O._dragGradients[1].getFactor():I._currentDrag2=I._currentDrag1}function cI(I,O){v.GetCurrentGradient(O._ratio,O._dragGradients,((C,j,K)=>{C!==I._currentDragGradient&&(I._currentDrag1=I._currentDrag2,I._currentDrag2=j.getFactor(),I._currentDragGradient=C);const i=(0,p.Lerp)(I._currentDrag1,I._currentDrag2,K);O._scaledDirection.scaleInPlace(1-i)}))}function nI(I,O){I._randomNoiseCoordinates1?(I._randomNoiseCoordinates1.cS(Math.random(),Math.random(),Math.random()),I._randomNoiseCoordinates2.cS(Math.random(),Math.random(),Math.random())):(I._randomNoiseCoordinates1=new j.mC(Math.random(),Math.random(),Math.random()),I._randomNoiseCoordinates2=new j.mC(Math.random(),Math.random(),Math.random()))}function XI(I,O){const C=O._noiseTextureData,K=O._noiseTextureSize;if(C&&K&&I._randomNoiseCoordinates1){const i=O._fetchR(I._randomNoiseCoordinates1.x,I._randomNoiseCoordinates1.y,K.width,K.height,C),y=O._fetchR(I._randomNoiseCoordinates1.z,I._randomNoiseCoordinates2.x,K.width,K.height,C),S=O._fetchR(I._randomNoiseCoordinates2.y,I._randomNoiseCoordinates2.z,K.width,K.height,C),U=j.TmpVectors.mC[0],p=j.TmpVectors.mC[1];U.cS((2*i-1)*O.noiseStrength.x,(2*y-1)*O.noiseStrength.y,(2*S-1)*O.noiseStrength.z),U.scaleToRef(O._tempScaledUpdateSpeed,p),I.direction.addInPlace(p)}}function TI(I,O){O.gravity.scaleToRef(O._tempScaledUpdateSpeed,O._scaledGravity),I.direction.addInPlace(O._scaledGravity)}function HI(I,O){I.size=(0,p.RandomRange)(O.minSize,O.maxSize),I.scale.cS((0,p.RandomRange)(O.minScaleX,O.maxScaleX),(0,p.RandomRange)(O.minScaleY,O.maxScaleY))}function bI(I,O){I._currentSizeGradient=O._sizeGradients[0],I._currentSize1=I._currentSizeGradient.getFactor(),I.size=I._currentSize1,O._sizeGradients.length>1?I._currentSize2=O._sizeGradients[1].getFactor():I._currentSize2=I._currentSize1,I.scale.cS((0,p.RandomRange)(O.minScaleX,O.maxScaleX),(0,p.RandomRange)(O.minScaleY,O.maxScaleY))}function aI(I,O){const C=O._actualFrame/O.targetStopDuration;v.GetCurrentGradient(C,O._startSizeGradients,((C,j,K)=>{C!==O._currentStartSizeGradient&&(O._currentStartSize1=O._currentStartSize2,O._currentStartSize2=j.getFactor(),O._currentStartSizeGradient=C);const i=(0,p.Lerp)(O._currentStartSize1,O._currentStartSize2,K);I.scale.scaleInPlace(i)}))}function MI(I,O){v.GetCurrentGradient(O._ratio,O._sizeGradients,((O,C,j)=>{O!==I._currentSizeGradient&&(I._currentSize1=I._currentSize2,I._currentSize2=C.getFactor(),I._currentSizeGradient=O),I.size=(0,p.Lerp)(I._currentSize1,I._currentSize2,j)}))}function uI(I,O){I.remapData=new j.Vector4(0,1,0,1)}function JI(I,O){O._colorRemapGradients&&O._colorRemapGradients.length>0&&v.GetCurrentGradient(O._ratio,O._colorRemapGradients,((O,C,j)=>{const K=(0,p.Lerp)(O.factor1,C.factor1,j),i=(0,p.Lerp)(O.factor2,C.factor2,j);I.remapData.x=K,I.remapData.y=i-K})),O._alphaRemapGradients&&O._alphaRemapGradients.length>0&&v.GetCurrentGradient(O._ratio,O._alphaRemapGradients,((O,C,j)=>{const K=(0,p.Lerp)(O.factor1,C.factor1,j),i=(0,p.Lerp)(O.factor2,C.factor2,j);I.remapData.z=K,I.remapData.w=i-K}))}function fI(I,O){const C=(0,p.Clamp)(O._actualFrame/O.targetStopDuration);v.GetCurrentGradient(C,O._lifeTimeGradients,((O,j)=>{const K=O,i=j,y=K.getFactor(),S=i.getFactor(),U=(C-K.gradient)/(i.gradient-K.gradient);I.lifeTime=(0,p.Lerp)(y,S,U)})),O._emitPower=(0,p.RandomRange)(O.minEmitPower,O.maxEmitPower)}function lI(I,O){I.lifeTime=(0,p.RandomRange)(O.minLifeTime,O.maxLifeTime),O._emitPower=(0,p.RandomRange)(O.minEmitPower,O.maxEmitPower)}function xI(I,O){0===O._emitPower?(I._initialDirection?I._initialDirection.K(I.direction):I._initialDirection=I.direction.clone(),I.direction.set(0,0,0)):(I._initialDirection=null,I.direction.scaleInPlace(O._emitPower)),I.direction.addInPlace(O._inheritedVelocityOffset)}function DI(I,O){I.angularSpeed=(0,p.RandomRange)(O.minAngularSpeed,O.maxAngularSpeed),I.angle=(0,p.RandomRange)(O.minInitialRotation,O.maxInitialRotation)}function tI(I,O){I._currentAngularSpeedGradient=O._angularSpeedGradients[0],I.angularSpeed=I._currentAngularSpeedGradient.getFactor(),I._currentAngularSpeed1=I.angularSpeed,O._angularSpeedGradients.length>1?I._currentAngularSpeed2=O._angularSpeedGradients[1].getFactor():I._currentAngularSpeed2=I._currentAngularSpeed1,I.angle=(0,p.RandomRange)(O.minInitialRotation,O.maxInitialRotation)}function dI(I,O){I._initialStartSpriteCellId=O.startSpriteCellID,I._initialEndSpriteCellId=O.endSpriteCellID,I._initialSpriteCellLoop=O.spriteCellLoop}function wI(I,O){I.previousItem=O.previousItem,I.nextItem=O,O.previousItem&&(O.previousItem.nextItem=I),O.previousItem=I}function gI(I,O){I.previousItem=O,I.nextItem=O.nextItem,O.nextItem&&(O.nextItem.previousItem=I),O.nextItem=I}function VI(I,O){let C=O;for(;C.nextItem;)C=C.nextItem;I.previousItem=C,I.nextItem=C.nextItem,C.nextItem=I}function eI(I){I.previousItem&&(I.previousItem.nextItem=I.nextItem),I.nextItem&&(I.nextItem.previousItem=I.previousItem)}class LI extends U{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(I){this._startDirectionFunction!==I&&(this._startDirectionFunction=I,this._directionProcessing.process=I?QI:NI)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(I){this._startPositionFunction!==I&&(this._startPositionFunction=I,this._positionCreation.process=I?rI:hI)}set onDispose(I){this._onDisposeObserver&&this.yS.remove(this._onDisposeObserver),this._onDisposeObserver=this.yS.add(I)}get p(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(I){this._useRampGradients!==I&&(this._useRampGradients=I,this._resetEffect(),I?(this._rampCreation={process:uI,previousItem:null,nextItem:null},gI(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:JI,previousItem:null,nextItem:null},gI(this._remapGradientProcessing,this._gravityProcessing)):(eI(this._rampCreation),eI(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(I){this._isLocal!==I&&(this._isLocal=I,I?(this._isLocalCreation={process:WI,previousItem:null,nextItem:null},gI(this._isLocalCreation,this._positionCreation)):eI(this._isLocalCreation))}get particles(){return this.Is}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(I){this._animationSheetEnabled!==I&&(this._animationSheetEnabled=I,I?(this._sheetCreation={process:dI,previousItem:null,nextItem:null},gI(this._sheetCreation,this._colorCreation)):eI(this._sheetCreation),this._reset())}getActiveCount(){return this.Is.length}getClassName(){return"ip"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var I;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(I=this._customWrappers[O])||void 0===I?void 0:I.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[I]??this._customWrappers[0]}setCustomEffect(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new II.d(this._engine),this._customWrappers[O].effect=I,this._customWrappers[O].drawContext&&(this._customWrappers[O].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new B.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(I){if(this.noiseTexture!==I){if(this._noiseTexture=I,!I)return eI(this._noiseCreation),void eI(this._noiseProcessing);this._noiseCreation={process:nI,previousItem:null,nextItem:null},gI(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:XI,previousItem:null,nextItem:null},gI(this._noiseProcessing,this._positionProcessing)}}constructor(I,O,C){let K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(I),this._emitterInverseWorldMatrix=j.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new j.mC,this.yS=new B.c,this.onStoppedObservable=new B.c,this.onStartedObservable=new B.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.Is=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new y.TS(0,0,0,0),this._colorDiff=new y.TS(0,0,0,0),this._scaledDirection=j.mC.Zero(),this._scaledGravity=j.mC.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=I=>{},this.recycleParticle=I=>{const O=this.Is.pop();O!==I&&O.copyTo(I),this._stockParticles.push(O)},this._createParticle=()=>{let I;return 0!==this._stockParticles.length?(I=this._stockParticles.pop(),I._reset()):I=new G(this),this._prepareParticle(I),I},this.paused=!1,this._shadersLoaded=!1,this._capacity=O,this._epsilon=S,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=j.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||R.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.RQ.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:lI,previousItem:null,nextItem:null},this._positionCreation={process:hI,previousItem:null,nextItem:null},gI(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:NI,previousItem:null,nextItem:null},gI(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:xI,previousItem:null,nextItem:null},gI(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:HI,previousItem:null,nextItem:null},gI(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:DI,previousItem:null,nextItem:null},gI(this._angleCreation,this._sizeCreation),this._colorCreation={process:KI,previousItem:null,nextItem:null},gI(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,U||(this._colorProcessing={process:SI,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:pI,previousItem:null,nextItem:null},gI(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:EI,previousItem:null,nextItem:null},gI(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:YI,previousItem:null,nextItem:null},gI(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:TI,previousItem:null,nextItem:null},gI(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=i,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new II.d(this._engine)},this._customWrappers[0].effect=K,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new Q,this.updateFunction=I=>{var O;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(O=this.noiseTexture.getContent())||void 0===O||O.then((I=>{this._noiseTextureData=I})));const C=I===this.Is;for(let j=0;j<I.length;j++){const O=I[j];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const K=O.age;if(O.age+=this._tempScaledUpdateSpeed,O.age>O.lifeTime){const I=O.age-K,C=O.lifeTime-K;this._tempScaledUpdateSpeed=C*this._tempScaledUpdateSpeed/I,O.age=O.lifeTime}this._ratio=O.age/O.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let i=this._updateQueueStart;for(;i;)i.process(O,this),i=i.nextItem;if(this._isAnimationSheetEnabled&&!U&&O.updateCellIndex(),O._inheritParticleInfoToSubEmitters(),O.age>=O.lifeTime){if(this._emitFromParticle(O),O._attachedSubEmitters){for(const I of O._attachedSubEmitters)I.particleSystem.disposeOnStop=!0,I.particleSystem.stop();O._attachedSubEmitters=null}this.recycleParticle(O),C&&j--}else;}}}serialize(I){throw new Error("Method not implemented.")}clone(I,O){throw new Error("Method not implemented.")}_addFactorGradient(I,O,C,j){const K=new P(O,C,j);I.push(K),I.sort(((I,O)=>I.gradient<O.gradient?-1:I.gradient>O.gradient?1:0))}_removeFactorGradient(I,O){if(!I)return;let C=0;for(const j of I){if(j.gradient===O){I.splice(C,1);break}C++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=fI:this._lifeTimeCreation.process=lI}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:aI,previousItem:null,nextItem:null},gI(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(eI(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(I){this.targetStopDuration!==I&&(this._targetStopDuration=I,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(I,O,C){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,I,O,C),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(I){return this._removeFactorGradient(this._lifeTimeGradients,I),this._syncLifeTimeCreation(),this}addSizeGradient(I,O,C){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=bI,this._sizeGradientProcessing={process:MI,previousItem:null,nextItem:null},wI(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,I,O,C),this}removeSizeGradient(I){var O;return this._removeFactorGradient(this._sizeGradients,I),0===(null===(O=this._sizeGradients)||void 0===O?void 0:O.length)&&(eI(this._sizeGradientProcessing),this._sizeCreation.process=HI),this}addColorRemapGradient(I,O,C){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,I,O,C),this}removeColorRemapGradient(I){return this._removeFactorGradient(this._colorRemapGradients,I),this}addAlphaRemapGradient(I,O,C){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,I,O,C),this}removeAlphaRemapGradient(I){return this._removeFactorGradient(this._alphaRemapGradients,I),this}addAngularSpeedGradient(I,O,C){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=tI,this._angularSpeedGradientProcessing={process:UI,previousItem:null,nextItem:null},wI(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,I,O,C),this}removeAngularSpeedGradient(I){var O;return this._removeFactorGradient(this._angularSpeedGradients,I),0===(null===(O=this._angularSpeedGradients)||void 0===O?void 0:O.length)&&(this._angleCreation.process=DI,eI(this._angularSpeedGradientProcessing)),this}addVelocityGradient(I,O,C){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:sI,previousItem:null,nextItem:null},gI(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:qI,previousItem:null,nextItem:null},wI(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,I,O,C),this}removeVelocityGradient(I){var O;return this._removeFactorGradient(this._velocityGradients,I),0===(null===(O=this._velocityGradients)||void 0===O?void 0:O.length)&&(eI(this._velocityCreation),eI(this._velocityGradientProcessing)),this}addLimitVelocityGradient(I,O,C){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:ZI,previousItem:null,nextItem:null},gI(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:mO,previousItem:null,nextItem:null},gI(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,I,O,C),this}removeLimitVelocityGradient(I){var O;return this._removeFactorGradient(this._limitVelocityGradients,I),0===(null===(O=this._limitVelocityGradients)||void 0===O?void 0:O.length)&&(eI(this._limitVelocityCreation),eI(this._limitVelocityGradientProcessing)),this}addDragGradient(I,O,C){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:oI,previousItem:null,nextItem:null},wI(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:cI,previousItem:null,nextItem:null},wI(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,I,O,C),this}removeDragGradient(I){var O;return this._removeFactorGradient(this._dragGradients,I),0===(null===(O=this._dragGradients)||void 0===O?void 0:O.length)&&(eI(this._dragCreation),eI(this._dragGradientProcessing)),this}addEmitRateGradient(I,O,C){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,I,O,C),this}removeEmitRateGradient(I){return this._removeFactorGradient(this._emitRateGradients,I),this}addStartSizeGradient(I,O,C){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,I,O,C),this._syncStartSizeCreation(),this}removeStartSizeGradient(I){return this._removeFactorGradient(this._startSizeGradients,I),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const I=new Uint8Array(4*this._rawTextureWidth),O=y.TmpColors.WO[0];for(let C=0;C<this._rawTextureWidth;C++){const j=C/this._rawTextureWidth;v.GetCurrentGradient(j,this._rampGradients,((j,K,i)=>{y.WO.LerpToRef(j.color,K.color,i,O),I[4*C]=255*O.r,I[4*C+1]=255*O.g,I[4*C+2]=255*O.b,I[4*C+3]=255}))}this._rampGradientsTexture=F.d.CreateRGBATexture(I,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((I,O)=>I.gradient<O.gradient?-1:I.gradient>O.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(I,O){this._rampGradients||(this._rampGradients=[]);const C=new A(I,O);return this._rampGradients.push(C),this._syncRampGradientTexture(),this}removeRampGradient(I){return this._removeGradientAndTexture(I,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(I,O,C){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=iI,this._colorProcessing.process=yI);const j=new k(I,O,C);return this._colorGradients.push(j),this._colorGradients.sort(((I,O)=>I.gradient<O.gradient?-1:I.gradient>O.gradient?1:0)),this}removeColorGradient(I){if(!this._colorGradients)return this;let O=0;for(const C of this._colorGradients){if(C.gradient===I){this._colorGradients.splice(O,1);break}O++}return 0===this._colorGradients.length&&(this._colorCreation.process=KI,this._colorProcessing.process=SI),this}resetDrawCache(){if(this._drawWrappers){for(const I of this._drawWrappers)if(I)for(const O of I)null===O||void 0===O||O.dispose();this._drawWrappers=[]}}_fetchR(I,O,C,j,K){return K[4*(((I=.5*Math.abs(I)+.5)*C%C|0)+((O=.5*Math.abs(O)+.5)*j%j|0)*C)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const I=this._engine,O=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*O),this._vertexBuffer=new o.c(I,this._vertexData,!0,O);let C=0;const j=this._vertexBuffer.createVertexBuffer(o.e.PositionKind,C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[o.e.PositionKind]=j,C+=3;const K=this._vertexBuffer.createVertexBuffer(o.e.ColorKind,C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[o.e.ColorKind]=K,C+=4;const i=this._vertexBuffer.createVertexBuffer("angle",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=i,C+=1;const y=this._vertexBuffer.createVertexBuffer("size",C,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=y,C+=2,this._isAnimationSheetEnabled){const I=this._vertexBuffer.createVertexBuffer("cellIndex",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=I,C+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const I=this._vertexBuffer.createVertexBuffer("direction",C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=I,C+=3}if(this._useRampGradients){const I=this._vertexBuffer.createVertexBuffer("remapData",C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=I,C+=4}let S;if(this._useInstancing){const O=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new o.c(I,O,!1,2),S=this._spriteBuffer.createVertexBuffer("offset",0,2)}else S=this._vertexBuffer.createVertexBuffer("offset",C,2,this._vertexBufferSize,this._useInstancing),C+=2;this._vertexBuffers.offset=S,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const I=[],O=[];let C=0;for(let j=0;j<this._capacity;j++)I.push(C),I.push(C+1),I.push(C+2),I.push(C),I.push(C+2),I.push(C+3),O.push(C,C+1,C+1,C+2,C+2,C+3,C+3,C,C,C+3),C+=4;this._indexBuffer=this._engine.createIndexBuffer(I),this._linesIndexBuffer=this._engine.createIndexBuffer(O)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(I)setTimeout((()=>{this.start(0)}),I);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var O;-1!==(null===(O=this.KO)||void 0===O?void 0:O.getClassName().indexOf("Mesh"))&&this.KO.rS(!0);const I=this.noiseTexture;if(I&&I.onGeneratedObservable)I.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let O=0;O<this.preWarmCycles;O++)this.animate(!0),I.render()}))}));else for(let O=0;O<this.preWarmCycles;O++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(I))}_postStop(I){}reset(){this._stockParticles.length=0,this.Is.length=0}_appendParticleVertex(I,O,C,K){let i=I*this._vertexBufferSize;if(this._vertexData[i++]=O.position.x+this.Ep.x,this._vertexData[i++]=O.position.y+this.Ep.y,this._vertexData[i++]=O.position.z+this.Ep.z,this._vertexData[i++]=O.color.r,this._vertexData[i++]=O.color.g,this._vertexData[i++]=O.color.b,this._vertexData[i++]=O.color.a,this._vertexData[i++]=O.angle,this._vertexData[i++]=O.scale.x*O.size,this._vertexData[i++]=O.scale.y*O.size,this._isAnimationSheetEnabled&&(this._vertexData[i++]=O.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[i++]=O.direction.x,this._vertexData[i++]=O.direction.y,this._vertexData[i++]=O.direction.z);else if(O._initialDirection){let I=O._initialDirection;this.isLocal&&(j.mC.TransformNormalToRef(I,this._emitterWorldMatrix,j.TmpVectors.mC[0]),I=j.TmpVectors.mC[0]),0===I.x&&0===I.z&&(I.x=.001),this._vertexData[i++]=I.x,this._vertexData[i++]=I.y,this._vertexData[i++]=I.z}else{let I=O.direction;this.isLocal&&(j.mC.TransformNormalToRef(I,this._emitterWorldMatrix,j.TmpVectors.mC[0]),I=j.TmpVectors.mC[0]),0===I.x&&0===I.z&&(I.x=.001),this._vertexData[i++]=I.x,this._vertexData[i++]=I.y,this._vertexData[i++]=I.z}this._useRampGradients&&O.remapData&&(this._vertexData[i++]=O.remapData.x,this._vertexData[i++]=O.remapData.y,this._vertexData[i++]=O.remapData.z,this._vertexData[i++]=O.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===C?C=this._epsilon:1===C&&(C=1-this._epsilon),0===K?K=this._epsilon:1===K&&(K=1-this._epsilon)),this._vertexData[i++]=C,this._vertexData[i++]=K)}_prepareParticle(I){}_createNewOnes(I){let O;for(let C=0;C<I&&this.Is.length!==this._capacity;C++){O=this._createParticle(),this.Is.push(O);let I=this._createQueueStart;for(;I;)I.process(O,this),I=I.nextItem;O._inheritParticleInfoToSubEmitters()}}_update(I){if(this._alive=this.Is.length>0,this.KO.position){const I=this.KO;this._emitterWorldMatrix=I.getWorldMatrix()}else{const I=this.KO;this._emitterWorldMatrix=j.Matrix.Translation(I.x,I.y,I.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Is),this._createNewOnes(I)}static _GetAttributeNamesOrOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=[o.e.PositionKind,o.e.ColorKind,"angle","offset","size"];return I&&j.push("cellIndex"),O||j.push("direction"),C&&j.push("remapData"),j}static _GetEffectCreationOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,OI.d)(j),I&&j.push("particlesInfos"),O&&j.push("logarithmicDepthConstant"),C&&(j.push("vFogInfos"),j.push("vFogColor")),j}fillDefines(I,O){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,OI.j)(this,this._scene,I),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&I.push("#define FOG")),this._isAnimationSheetEnabled&&I.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&I.push("#define LOGARITHMICDEPTH"),O===U.BLENDMODE_MULTIPLY&&I.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&I.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(I.push("#define BILLBOARD"),this.billboardMode){case 2:I.push("#define BILLBOARDY");break;case 8:case 9:I.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&I.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:I.push("#define BILLBOARDMODE_ALL")}C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),I.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(I,O,C){O.push(...LI._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),I.push(...LI._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,jI.e)(I,this._imageProcessingConfigurationDefines),(0,jI.c)(C,this._imageProcessingConfigurationDefines))}_getWrapper(I){const O=this._getCustomDrawWrapper(I);if(null!==O&&void 0!==O&&O.effect)return O;const C=[];this.fillDefines(C,I);const j=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let K=this._drawWrappers[j];K||(K=this._drawWrappers[j]=[]);let i=K[I];i||(i=new II.d(this._engine),i.drawContext&&(i.drawContext.useInstancing=this._useInstancing),K[I]=i);const y=C.join("\n");if(i.defines!==y){const I=[],O=[],C=[];this.fillUniformsAttributesAndSamplerNames(O,I,C),i.setEffect(this._engine.createEffect("particles",I,O,C,y,void 0,void 0,void 0,void 0,this._shaderLanguage),y)}return i}animate(){var I;let O,C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!C&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(C?this.preWarmStepOffset:(null===(I=this._scene)||void 0===I?void 0:I.getAnimationRatio())||1),this.manualEmitCount>-1)O=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let I=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const O=this._actualFrame/this.targetStopDuration;v.GetCurrentGradient(O,this._emitRateGradients,((O,C,j)=>{O!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=C.getFactor(),this._currentEmitRateGradient=O),I=(0,p.Lerp)(this._currentEmitRate1,this._currentEmitRate2,j)}))}O=I*this._scaledUpdateSpeed|0,this._newPartsExcess+=I*this._scaledUpdateSpeed-O}if(this._newPartsExcess>1&&(O+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?O=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(O),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!C){let I=0;for(let O=0;O<this.Is.length;O++){const C=this.Is[O];this._appendParticleVertices(I,C),I+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Is.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(I,O){this._appendParticleVertex(I++,O,0,0),this._useInstancing||(this._appendParticleVertex(I++,O,1,0),this._appendParticleVertex(I++,O,1,1),this._appendParticleVertex(I++,O,0,1))}rebuild(){var I;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(I=this._spriteBuffer)||void 0===I||I._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!LI.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(C.bind(C,13630)),Promise.resolve().then(C.bind(C,13583))])):await Promise.all([Promise.resolve().then(C.bind(C,13567)),Promise.resolve().then(C.bind(C,13555))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.KO||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==U.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(U.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(U.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(I){const O=this._getWrapper(I),C=O.effect,K=this._engine;K.enableEffect(O);const i=this.defaultViewMatrix??this._scene.getViewMatrix();if(C.setTexture("diffuseSampler",this.particleTexture),C.setMatrix("view",i),C.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const I=this.particleTexture.getBaseSize();C.setFloat3("particlesInfos",this.spriteCellWidth/I.width,this.spriteCellHeight/I.height,this.spriteCellWidth/I.width)}if(C.setVector2("translationPivot",this.translationPivot),C.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const I=this._scene.activeCamera;C.setVector3("eyePosition",I.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),C.setTexture("rampSampler",this._rampGradientsTexture));const y=C.defines;var S,U,p,N,Q,s;(this._scene&&((0,OI.g)(C,this,this._scene),this.applyFog&&(0,CI.h)(this._scene,void 0,C)),y.indexOf("#define BILLBOARDMODE_ALL")>=0&&(i.invertToRef(j.TmpVectors.Matrix[0]),C.setMatrix("invView",j.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?K.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,C):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,C)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?K.bindBuffers(this._vertexBuffers,null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?this._linesIndexBuffer:this._indexBuffer,C):K.bindBuffers(this._vertexBuffers,null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?this._linesIndexBufferUseInstancing:null,C);(this.useLogarithmicDepth&&this._scene&&(0,CI.o)(y,C,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(C),this._setEngineBasedOnBlendMode(I),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(C),this._useInstancing)?null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?K.drawElementsType(6,0,10,this.Is.length):K.drawArraysType(7,0,4,this.Is.length):null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?K.drawElementsType(1,0,10*this.Is.length):K.drawElementsType(0,0,6*this.Is.length);return this.Is.length}render(){if(!this.isReady()||!this.Is.length)return 0;const I=this._engine;I.setState&&(I.setState(!1),this.forceDepthWrite&&I.setDepthWrite(!0));let O=0;return O=this.blendMode===U.BLENDMODE_MULTIPLYADD?this._render(U.BLENDMODE_MULTIPLY)+this._render(U.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),O}_onDispose(){}dispose(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),I&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),I&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(O,C),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const I=this._scene.RQ.indexOf(this);I>-1&&this._scene.RQ.splice(I,1),this._scene._activeParticleSystems.dispose()}this.yS.notifyObservers(this),this.yS.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}LI.ForceGLSL=!1;var zI,kI=C(12126);!function(I){I[I.ATTACHED=0]="ATTACHED",I[I.END=1]="END"}(zI||(zI={}));class AI{constructor(I){if(this.particleSystem=I,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!I.KO||!I.KO.dispose){const O=(0,S.c)("BABYLON.AbstractMesh");I.KO=new O("SubemitterSystemEmitter",I.nI()),I._disposeEmitterOnDispose=!0}}clone(){let I=this.particleSystem.KO;if(I){if(I instanceof j.mC)I=I.clone();else if(-1!==I.getClassName().indexOf("Mesh")){I=new((0,S.c)("BABYLON.Mesh"))("",I.nI()),I.isVisible=!1}}else I=new j.mC;const O=new AI(this.particleSystem.clone(this.particleSystem.name,I));return O.particleSystem.name+="Clone",O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem._disposeEmitterOnDispose=!0,O.particleSystem.disposeOnStop=!0,O}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem=this.particleSystem.serialize(I),O}static _ParseParticleSystem(I,O,C){throw(0,kI.b)("ParseParticle")}static Parse(I,O,C){const j=I.particleSystem,K=new AI(AI._ParseParticleSystem(j,O,C,!0));return K.type=I.type,K.inheritDirection=I.inheritDirection,K.inheritedVelocityAmount=I.inheritedVelocityAmount,K.particleSystem._isSubEmitter=!0,K}dispose(){this.particleSystem.dispose()}}var PI=C(12167);function vI(I,O){const C=new h;return C.direction1=I,C.direction2=O,C}function BI(){return new E(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function FI(){return new r(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function RI(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.mC(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.mC(0,1,0);return new W(I,O,C)}function GI(){return new q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function IO(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.mC(0,1,0),i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.mC(0,1,0);return new mI(I,O,C,K,i)}function OO(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new s(I,O)}function CO(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.mC(0,1,0),K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.mC(0,1,0);return new Z(I,O,C,K)}const jO=j.mC.Zero(),KO=j.mC.Zero(),iO=j.mC.Zero();class yO{constructor(){this.strength=0,this.position=j.mC.Zero()}_processParticle(I,O){this.position.subtractToRef(I.position,jO);const C=jO.lengthSquared()+1;jO.normalize().scaleToRef(this.strength/C,KO),KO.scaleToRef(O._tempScaledUpdateSpeed,iO),I.direction.addInPlace(iO)}serialize(){return{position:this.position.qS(),strength:this.strength}}}class SO extends LI{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=I=>{if(!this._subEmitters||0===this._subEmitters.length)return;const O=Math.floor(Math.random()*this._subEmitters.length);for(const C of this._subEmitters[O])if(1===C.type){const O=C.clone();I._inheritParticleInfoToSubEmitter(O),O.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(O.particleSystem),O.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(I,O){const C=vI(I,O);return this.particleEmitterType=C,C}get flowMap(){return this._flowMap}set flowMap(I){this._flowMap!==I&&(this._flowMap=I,this._flowMapUpdate&&(eI(this._flowMapUpdate),this._flowMapUpdate=null),I&&(this._flowMapUpdate={process:I=>{var O;const C=null===(O=this.nI())||void 0===O?void 0:O.getTransformMatrix();this._flowMap._processParticle(I,this.flowMapStrength*this._tempScaledUpdateSpeed,C)},previousItem:null,nextItem:null},gI(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(I){this._attractors.push(I),1===this._attractors.length&&(this._attractorUpdate={process:I=>{for(const O of this._attractors)O._processParticle(I,this)},previousItem:null,nextItem:null},gI(this._attractorUpdate,this._directionProcessing))}removeAttractor(I){const O=this._attractors.indexOf(I);-1!==O&&this._attractors.splice(O,1),0===this._attractors.length&&eI(this._attractorUpdate)}start(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(I)}createHemisphericEmitter(){const I=BI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createSphereEmitter(){const I=FI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createDirectedSphereEmitter(){const I=RI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.mC(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.mC(0,1,0));return this.particleEmitterType=I,I}createCylinderEmitter(){const I=GI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=I,I}createDirectedCylinderEmitter(){const I=IO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.mC(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.mC(0,1,0));return this.particleEmitterType=I,I}createConeEmitter(){const I=OO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=I,I}createDirectedConeEmitter(){const I=CO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.mC(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.mC(0,1,0));return this.particleEmitterType=I,I}createBoxEmitter(I,O,C,j){const K=new Q;return this.particleEmitterType=K,this.direction1=I,this.direction2=O,this.minEmitBox=C,this.maxEmitBox=j,K}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const I of this.subEmitters)I instanceof SO?this._subEmitters.push([new AI(I)]):I instanceof AI?this._subEmitters.push([I]):I instanceof Array&&this._subEmitters.push(I)}_stopSubEmitters(){if(this.activeSubSystems){for(const I of this.activeSubSystems)I.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const I=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==I&&this._rootParticleSystem.activeSubSystems.splice(I,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(I){I&&this._stopSubEmitters()}_prepareParticle(I){if(this._subEmitters&&this._subEmitters.length>0){const O=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];I._attachedSubEmitters=[];for(const C of O)if(0===C.type){const O=C.clone();I._attachedSubEmitters.push(O),O.particleSystem.start()}}}_onDispose(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),I&&this.particles)for(const C of this.particles)if(C._attachedSubEmitters)for(let I=C._attachedSubEmitters.length-1;I>=0;I-=1)C._attachedSubEmitters[I].dispose();if(O&&this.activeSubSystems)for(let C=this.activeSubSystems.length-1;C>=0;C-=1)this.activeSubSystems[C].dispose();if(this._subEmitters&&this._subEmitters.length){for(let I=0;I<this._subEmitters.length;I++)for(const O of this._subEmitters[I])O.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.KO&&this.KO.dispose&&this.KO.dispose(!0)}static _Parse(I,O,C,K){let i;i=C instanceof PI.b?null:C;const U=(0,S.c)("BABYLON.Texture");if(U&&i&&(I.texture?O.particleTexture=U.Parse(I.texture,i,K):I.textureName&&(O.particleTexture=new U(K+I.textureName,i,!1,void 0===I.invertY||I.invertY),O.particleTexture.name=I.textureName)),I.emitterId||0===I.emitterId||void 0!==I.KO?I.emitterId&&i?O.KO=i.getLastMeshById(I.emitterId):O.KO=j.mC.YO(I.KO):O.KO=j.mC.Zero(),O.isLocal=!!I.isLocal,void 0!==I.renderingGroupId&&(O.renderingGroupId=I.renderingGroupId),void 0!==I.isBillboardBased&&(O.isBillboardBased=I.isBillboardBased),void 0!==I.billboardMode&&(O.billboardMode=I.billboardMode),void 0!==I.useLogarithmicDepth&&(O.useLogarithmicDepth=I.useLogarithmicDepth),I.animations){for(let C=0;C<I.animations.length;C++){const j=I.animations[C],K=(0,S.c)("BABYLON.Animation");K&&O.animations.push(K.Parse(j))}O.beginAnimationOnStart=I.beginAnimationOnStart,O.beginAnimationFrom=I.beginAnimationFrom,O.beginAnimationTo=I.beginAnimationTo,O.beginAnimationLoop=I.beginAnimationLoop}if(I.autoAnimate&&i&&i.beginAnimation(O,I.autoAnimateFrom,I.autoAnimateTo,I.autoAnimateLoop,I.autoAnimateSpeed||1),O.startDelay=0|I.startDelay,O.minAngularSpeed=I.minAngularSpeed,O.maxAngularSpeed=I.maxAngularSpeed,O.minSize=I.minSize,O.maxSize=I.maxSize,I.minScaleX&&(O.minScaleX=I.minScaleX,O.maxScaleX=I.maxScaleX,O.minScaleY=I.minScaleY,O.maxScaleY=I.maxScaleY),void 0!==I.preWarmCycles&&(O.preWarmCycles=I.preWarmCycles,O.preWarmStepOffset=I.preWarmStepOffset),void 0!==I.minInitialRotation&&(O.minInitialRotation=I.minInitialRotation,O.maxInitialRotation=I.maxInitialRotation),O.minLifeTime=I.minLifeTime,O.maxLifeTime=I.maxLifeTime,O.minEmitPower=I.minEmitPower,O.maxEmitPower=I.maxEmitPower,O.emitRate=I.emitRate,O.gravity=j.mC.YO(I.gravity),I.noiseStrength&&(O.noiseStrength=j.mC.YO(I.noiseStrength)),O.color1=y.TS.YO(I.color1),O.color2=y.TS.YO(I.color2),O.colorDead=y.TS.YO(I.colorDead),O.updateSpeed=I.updateSpeed,O.targetStopDuration=I.targetStopDuration,O.blendMode=I.blendMode,I.colorGradients)for(const j of I.colorGradients)O.addColorGradient(j.gradient,y.TS.YO(j.color1),j.color2?y.TS.YO(j.color2):void 0);if(I.rampGradients){for(const C of I.rampGradients)O.addRampGradient(C.gradient,y.WO.YO(C.color));O.useRampGradients=I.useRampGradients}if(I.colorRemapGradients)for(const j of I.colorRemapGradients)O.addColorRemapGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(I.alphaRemapGradients)for(const j of I.alphaRemapGradients)O.addAlphaRemapGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(I.sizeGradients)for(const j of I.sizeGradients)O.addSizeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(I.angularSpeedGradients)for(const j of I.angularSpeedGradients)O.addAngularSpeedGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(I.velocityGradients)for(const j of I.velocityGradients)O.addVelocityGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(I.dragGradients)for(const j of I.dragGradients)O.addDragGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(I.emitRateGradients)for(const j of I.emitRateGradients)O.addEmitRateGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(I.startSizeGradients)for(const j of I.startSizeGradients)O.addStartSizeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(I.lifeTimeGradients)for(const j of I.lifeTimeGradients)O.addLifeTimeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(I.limitVelocityGradients){for(const C of I.limitVelocityGradients)O.addLimitVelocityGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);O.limitVelocityDamping=I.limitVelocityDamping}if(I.noiseTexture&&i){const C=(0,S.c)("BABYLON.ProceduralTexture");O.noiseTexture=C.Parse(I.noiseTexture,i,K)}let p;if(I.particleEmitterType){switch(I.particleEmitterType.type){case"SphereParticleEmitter":p=new r;break;case"SphereDirectedParticleEmitter":p=new W;break;case"ConeEmitter":case"ConeParticleEmitter":p=new s;break;case"ConeDirectedParticleEmitter":p=new Z;break;case"CylinderParticleEmitter":p=new q;break;case"CylinderDirectedParticleEmitter":p=new mI;break;case"HemisphericParticleEmitter":p=new E;break;case"PointParticleEmitter":p=new h;break;case"MeshParticleEmitter":p=new c;break;case"CustomParticleEmitter":p=new Y;break;default:p=new Q}p.parse(I.particleEmitterType,i)}else p=new Q,p.parse(I,i);O.particleEmitterType=p,O.startSpriteCellID=I.startSpriteCellID,O.endSpriteCellID=I.endSpriteCellID,O.spriteCellLoop=I.spriteCellLoop??!0,O.spriteCellWidth=I.spriteCellWidth,O.spriteCellHeight=I.spriteCellHeight,O.spriteCellChangeSpeed=I.spriteCellChangeSpeed,O.spriteRandomStartCell=I.spriteRandomStartCell,O.disposeOnStop=I.disposeOnStop??!1,O.manualEmitCount=I.manualEmitCount??-1}static Parse(I,O,C){let K=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0;const S=I.name;let U,p,N=null,Q=null;if(O instanceof PI.b?U=O:(p=O,U=p.getEngine()),I.customShader&&U.createEffectForParticles){Q=I.customShader;const O=Q.shaderOptions.defines.length>0?Q.shaderOptions.defines.join("\n"):"";N=U.createEffectForParticles(Q.shaderPath.fragmentElement,Q.shaderOptions.uniforms,Q.shaderOptions.samplers,O)}const s=new SO(S,i||I.tO,O,N,I.isAnimationSheetEnabled);if(s.customShader=Q,s._rootUrl=C,I.id&&(s.id=I.id),I.subEmitters){s.subEmitters=[];for(const j of I.subEmitters){const I=[];for(const K of j)I.push(AI.Parse(K,O,C));s.subEmitters.push(I)}}if(I.attractors)for(const y of I.attractors){const I=new yO;I.position=j.mC.YO(y.position),I.strength=y.strength,s.addAttractor(I)}return SO._Parse(I,s,O,C),I.textureMask&&(s.textureMask=y.TS.YO(I.textureMask)),I.Ep&&(s.Ep=j.mC.YO(I.Ep)),I.preventAutoStart&&(s.preventAutoStart=I.preventAutoStart),K||s.preventAutoStart||s.start(),s}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};if(SO._Serialize(O,this,I),O.textureMask=this.textureMask.qS(),O.customShader=this.customShader,O.preventAutoStart=this.preventAutoStart,O.Ep=this.Ep.qS(),this.subEmitters){O.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const C of this._subEmitters){const j=[];for(const O of C)j.push(O.serialize(I));O.subEmitters.push(j)}}if(this._attractors&&this._attractors.length){O.attractors=[];for(const I of this._attractors)O.attractors.push(I.serialize())}return O}static _Serialize(I,O,C){if(I.name=O.name,I.id=O.id,I.tO=O.getCapacity(),I.disposeOnStop=O.disposeOnStop,I.manualEmitCount=O.manualEmitCount,O.KO.position){const C=O.KO;I.emitterId=C.id}else{const C=O.KO;I.KO=C.qS()}O.particleEmitterType&&(I.particleEmitterType=O.particleEmitterType.serialize()),O.particleTexture&&(C?I.texture=O.particleTexture.serialize():(I.textureName=O.particleTexture.name,I.invertY=!!O.particleTexture._invertY)),I.isLocal=O.isLocal,f.e.AppendSerializedAnimations(O,I),I.beginAnimationOnStart=O.beginAnimationOnStart,I.beginAnimationFrom=O.beginAnimationFrom,I.beginAnimationTo=O.beginAnimationTo,I.beginAnimationLoop=O.beginAnimationLoop,I.startDelay=O.startDelay,I.renderingGroupId=O.renderingGroupId,I.isBillboardBased=O.isBillboardBased,I.billboardMode=O.billboardMode,I.minAngularSpeed=O.minAngularSpeed,I.maxAngularSpeed=O.maxAngularSpeed,I.minSize=O.minSize,I.maxSize=O.maxSize,I.minScaleX=O.minScaleX,I.maxScaleX=O.maxScaleX,I.minScaleY=O.minScaleY,I.maxScaleY=O.maxScaleY,I.minEmitPower=O.minEmitPower,I.maxEmitPower=O.maxEmitPower,I.minLifeTime=O.minLifeTime,I.maxLifeTime=O.maxLifeTime,I.emitRate=O.emitRate,I.gravity=O.gravity.qS(),I.noiseStrength=O.noiseStrength.qS(),I.color1=O.color1.qS(),I.color2=O.color2.qS(),I.colorDead=O.colorDead.qS(),I.updateSpeed=O.updateSpeed,I.targetStopDuration=O.targetStopDuration,I.blendMode=O.blendMode,I.preWarmCycles=O.preWarmCycles,I.preWarmStepOffset=O.preWarmStepOffset,I.minInitialRotation=O.minInitialRotation,I.maxInitialRotation=O.maxInitialRotation,I.startSpriteCellID=O.startSpriteCellID,I.spriteCellLoop=O.spriteCellLoop,I.endSpriteCellID=O.endSpriteCellID,I.spriteCellChangeSpeed=O.spriteCellChangeSpeed,I.spriteCellWidth=O.spriteCellWidth,I.spriteCellHeight=O.spriteCellHeight,I.spriteRandomStartCell=O.spriteRandomStartCell,I.isAnimationSheetEnabled=O.isAnimationSheetEnabled,I.useLogarithmicDepth=O.useLogarithmicDepth;const j=O.getColorGradients();if(j){I.colorGradients=[];for(const O of j){const C={gradient:O.gradient,color1:O.color1.qS()};O.color2?C.color2=O.color2.qS():C.color2=O.color1.qS(),I.colorGradients.push(C)}}const K=O.getRampGradients();if(K){I.rampGradients=[];for(const O of K){const C={gradient:O.gradient,color:O.color.qS()};I.rampGradients.push(C)}I.useRampGradients=O.useRampGradients}const i=O.getColorRemapGradients();if(i){I.colorRemapGradients=[];for(const O of i){const C={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?C.factor2=O.factor2:C.factor2=O.factor1,I.colorRemapGradients.push(C)}}const y=O.getAlphaRemapGradients();if(y){I.alphaRemapGradients=[];for(const O of y){const C={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?C.factor2=O.factor2:C.factor2=O.factor1,I.alphaRemapGradients.push(C)}}const S=O.getSizeGradients();if(S){I.sizeGradients=[];for(const O of S){const C={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?C.factor2=O.factor2:C.factor2=O.factor1,I.sizeGradients.push(C)}}const U=O.getAngularSpeedGradients();if(U){I.angularSpeedGradients=[];for(const O of U){const C={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?C.factor2=O.factor2:C.factor2=O.factor1,I.angularSpeedGradients.push(C)}}const p=O.getVelocityGradients();if(p){I.velocityGradients=[];for(const O of p){const C={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?C.factor2=O.factor2:C.factor2=O.factor1,I.velocityGradients.push(C)}}const N=O.getDragGradients();if(N){I.dragGradients=[];for(const O of N){const C={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?C.factor2=O.factor2:C.factor2=O.factor1,I.dragGradients.push(C)}}const Q=O.getEmitRateGradients();if(Q){I.emitRateGradients=[];for(const O of Q){const C={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?C.factor2=O.factor2:C.factor2=O.factor1,I.emitRateGradients.push(C)}}const s=O.getStartSizeGradients();if(s){I.startSizeGradients=[];for(const O of s){const C={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?C.factor2=O.factor2:C.factor2=O.factor1,I.startSizeGradients.push(C)}}const Z=O.getLifeTimeGradients();if(Z){I.lifeTimeGradients=[];for(const O of Z){const C={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?C.factor2=O.factor2:C.factor2=O.factor1,I.lifeTimeGradients.push(C)}}const q=O.getLimitVelocityGradients();if(q){I.limitVelocityGradients=[];for(const O of q){const C={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?C.factor2=O.factor2:C.factor2=O.factor1,I.limitVelocityGradients.push(C)}I.limitVelocityDamping=O.limitVelocityDamping}O.noiseTexture&&(I.noiseTexture=O.noiseTexture.serialize())}clone(I,O){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j={...this._customWrappers};let K=null;const i=this._engine;if(i.createEffectForParticles&&null!=this.customShader){K=this.customShader;const I=K.shaderOptions.defines.length>0?K.shaderOptions.defines.join("\n"):"",O=i.createEffectForParticles(K.shaderPath.fragmentElement,K.shaderOptions.uniforms,K.shaderOptions.samplers,I);j[0]?j[0].effect=O:this.setCustomEffect(O,0)}const y=this.serialize(C),S=SO.Parse(y,this._scene||this._engine,this._rootUrl);return S.name=I,S.customShader=K,S._customWrappers=j,void 0===O&&(O=this.KO),this.noiseTexture&&(S.noiseTexture=this.noiseTexture.clone()),S.KO=O,this.preventAutoStart||S.start(),S}}SO.BILLBOARDMODE_Y=2,SO.BILLBOARDMODE_ALL=7,SO.BILLBOARDMODE_STRETCHED=8,SO.BILLBOARDMODE_STRETCHED_LOCAL=9,AI._ParseParticleSystem=SO.Parse;var UO=C(12490),pO=C(12487),NO=C(12396);NO.c.prototype.createTransformFeedback=function(){const I=this._gl.createTransformFeedback();if(!I)throw new Error("Unable to create Transform Feedback");return I},NO.c.prototype.deleteTransformFeedback=function(I){this._gl.deleteTransformFeedback(I)},NO.c.prototype.bindTransformFeedback=function(I){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,I)},NO.c.prototype.beginTransformFeedback=function(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(I?this._gl.POINTS:this._gl.TRIANGLES)},NO.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},NO.c.prototype.setTranformFeedbackVaryings=function(I,O){this._gl.transformFeedbackVaryings(I,O,this._gl.INTERLEAVED_ATTRIBS)},NO.c.prototype.bindTransformFeedbackBuffer=function(I){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,I?I.underlyingResource:null)},NO.c.prototype.readTransformFeedbackBuffer=function(I){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,I)};const QO="clipPlaneFragmentDeclaration2",sO="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";X.b.IncludesShadersStore[QO]||(X.b.IncludesShadersStore[QO]=sO);C(13462),C(13466),C(13474),C(13479),C(13485),C(13490),C(13498),C(13500);const ZO="gpuRenderParticlesPixelShader",qO="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";X.b.ShadersStore[ZO]||(X.b.ShadersStore[ZO]=qO);const mC="clipPlaneVertexDeclaration2",EO="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";X.b.IncludesShadersStore[mC]||(X.b.IncludesShadersStore[mC]=EO);C(13502),C(13511),C(13516),C(13520);const hO="gpuRenderParticlesVertexShader",rO="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";X.b.ShadersStore[hO]||(X.b.ShadersStore[hO]=rO);class WO extends U{static get IsSupported(){if(!R.e.LastCreatedEngine)return!1;const I=R.e.LastCreatedEngine.getCaps();return I.supportTransformFeedbacks||I.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(I){this._maxActiveParticleCount=Math.min(I,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(I){this.maxActiveParticleCount=I}createPointEmitter(I,O){const C=vI(I,O);return this.particleEmitterType=C,C}createHemisphericEmitter(){const I=BI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createSphereEmitter(){const I=FI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createDirectedSphereEmitter(){const I=RI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.mC(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.mC(0,1,0));return this.particleEmitterType=I,I}createCylinderEmitter(){const I=GI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=I,I}createDirectedCylinderEmitter(){const I=IO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.mC(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.mC(0,1,0));return this.particleEmitterType=I,I}createConeEmitter(){const I=OO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=I,I}createDirectedConeEmitter(){const I=CO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.mC(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.mC(0,1,0));return this.particleEmitterType=I,I}createBoxEmitter(I,O,C,j){const K=new Q;return this.particleEmitterType=K,this.direction1=I,this.direction2=O,this.minEmitBox=C,this.maxEmitBox=j,K}get flowMap(){return this._flowMap}set flowMap(I){this._flowMap!==I&&(this._flowMap=I)}isReady(){if(!this.KO||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==SO.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(SO.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(SO.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";I?setTimeout((()=>{this.start(0)}),I):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var I;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(I=this._customWrappers[O])||void 0===I?void 0:I.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[I]??this._customWrappers[0]}setCustomEffect(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new II.d(this._engine),this._customWrappers[O].effect=I}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new B.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(I,O,C){return super._removeGradientAndTexture(I,O,C),this._releaseBuffers(),this}addColorGradient(I,O){this._colorGradients||(this._colorGradients=[]);const C=new k(I,O);return this._colorGradients.push(C),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(I&&this._colorGradients.sort(((I,O)=>I.gradient<O.gradient?-1:I.gradient>O.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(I){return this._removeGradientAndTexture(I,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const O in this._drawWrappers){var I;null===(I=this._drawWrappers[O].drawContext)||void 0===I||I.reset()}}_addFactorGradient(I,O,C){const j=new P(O,C);I.push(j),this._releaseBuffers()}addSizeGradient(I,O){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,I,O),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(I){return this._removeGradientAndTexture(I,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(I,O){if(!I)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&I.sort(((I,O)=>I.gradient<O.gradient?-1:I.gradient>O.gradient?1:0));const C=this;C[O]&&(C[O].dispose(),C[O]=null)}addAngularSpeedGradient(I,O){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,I,O),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(I){return this._removeGradientAndTexture(I,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(I,O){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,I,O),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(I){return this._removeGradientAndTexture(I,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(I,O){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,I,O),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(I){return this._removeGradientAndTexture(I,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(I,O){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,I,O),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(I){return this._removeGradientAndTexture(I,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(I){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(I,O,C){let K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(I),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.yS=new B.c,this.onStoppedObservable=new B.c,this.onStartedObservable=new B.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=j.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||R.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.RQ.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,S.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,S.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,S.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,S.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new II.d(this._engine)},this._customWrappers[0].effect=K,this._drawWrappers={0:new II.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(O=O??{}).randomTextureSize||delete O.randomTextureSize;const y={tO:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...O},U=O;isFinite(U)&&(y.tO=U),this._capacity=y.tO,this._maxActiveParticleCount=y.tO,this._currentActiveCount=0,this._isAnimationSheetEnabled=i,this.particleEmitterType=new Q;const p=Math.min(this._engine.getCaps().maxTextureSize,y.randomTextureSize);let N=[];for(let j=0;j<p;++j)N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),N.push(Math.random());this._randomTexture=new F.d(new Float32Array(N),p,1,5,C,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,N=[];for(let j=0;j<p;++j)N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),N.push(Math.random());this._randomTexture2=new F.d(new Float32Array(N),p,1,5,C,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=p}_reset(){this._releaseBuffers()}_createVertexBuffers(I,O,C){const j={};j.position=O.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let K=3;j.age=O.createVertexBuffer("age",K,1,this._attributesStrideSize,!0),K+=1,j.size=O.createVertexBuffer("size",K,3,this._attributesStrideSize,!0),K+=3,j.life=O.createVertexBuffer("life",K,1,this._attributesStrideSize,!0),K+=1,K+=4,this.billboardMode===SO.BILLBOARDMODE_STRETCHED&&(j.direction=O.createVertexBuffer("direction",K,3,this._attributesStrideSize,!0)),K+=3,this._platform.alignDataInBuffer&&(K+=1),this.particleEmitterType instanceof Y&&(K+=3,this._platform.alignDataInBuffer&&(K+=1)),this._colorGradientsTexture||(j.color=O.createVertexBuffer("color",K,4,this._attributesStrideSize,!0),K+=4),this._isBillboardBased||(j.initialDirection=O.createVertexBuffer("initialDirection",K,3,this._attributesStrideSize,!0),K+=3,this._platform.alignDataInBuffer&&(K+=1)),this.noiseTexture&&(j.noiseCoordinates1=O.createVertexBuffer("noiseCoordinates1",K,3,this._attributesStrideSize,!0),K+=3,this._platform.alignDataInBuffer&&(K+=1),j.noiseCoordinates2=O.createVertexBuffer("noiseCoordinates2",K,3,this._attributesStrideSize,!0),K+=3,this._platform.alignDataInBuffer&&(K+=1)),j.angle=O.createVertexBuffer("angle",K,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?K++:K+=2,this._isAnimationSheetEnabled&&(j.cellIndex=O.createVertexBuffer("cellIndex",K,1,this._attributesStrideSize,!0),K+=1,this.spriteRandomStartCell&&(j.cellStartOffset=O.createVertexBuffer("cellStartOffset",K,1,this._attributesStrideSize,!0),K+=1)),j.offset=C.createVertexBuffer("offset",0,2),j.uv=C.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(j),this._platform.createVertexBuffers(I,j),this.resetDrawCache()}_initialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!I)return;const O=this._engine,C=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof Y&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const K=this.particleEmitterType instanceof Y,i=j.TmpVectors.mC[0];let y=0;for(let j=0;j<this._capacity;j++)if(C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),K?(this.particleEmitterType.particleDestinationGenerator(j,null,i),C.push(i.x),C.push(i.y),C.push(i.z)):(C.push(0),C.push(0),C.push(0)),this._platform.alignDataInBuffer&&C.push(0),y+=16,K&&(this.particleEmitterType.particlePositionGenerator(j,null,i),C.push(i.x),C.push(i.y),C.push(i.z),this._platform.alignDataInBuffer&&C.push(0),y+=4),this._colorGradientsTexture||(C.push(0),C.push(0),C.push(0),C.push(0),y+=4),this.isBillboardBased||(C.push(0),C.push(0),C.push(0),this._platform.alignDataInBuffer&&C.push(0),y+=4),this.noiseTexture&&(C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),y+=8),C.push(0),y+=1,this._angularSpeedGradientsTexture||(C.push(0),y+=1),this._isAnimationSheetEnabled&&(C.push(0),y+=1,this.spriteRandomStartCell&&(C.push(0),y+=1)),this._platform.alignDataInBuffer){let I=3-(y+3&3);for(y+=I;I-- >0;)C.push(0)}const S=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),U=this._platform.createParticleBuffer(C),p=this._platform.createParticleBuffer(C);this._buffer0=new o.c(O,U,!1,this._attributesStrideSize),this._buffer1=new o.c(O,p,!1,this._attributesStrideSize),this._spriteBuffer=new o.c(O,S,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let I=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(I+="\n#define BILLBOARD"),this._colorGradientsTexture&&(I+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(I+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(I+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(I+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(I+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(I+="\n#define DRAGGRADIENTS"),this._flowMap&&(I+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(I+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(I+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(I+="\n#define NOISE"),this.isLocal&&(I+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===I||(this._cachedUpdateDefines=I,this._updateBuffer=this._platform.createUpdateBuffer(I)),this._platform.isUpdateBufferReady()}_getWrapper(I){const O=this._getCustomDrawWrapper(I);if(null!==O&&void 0!==O&&O.effect)return O;const C=[];this.fillDefines(C,I);let j=this._drawWrappers[I];j||(j=new II.d(this._engine),j.drawContext&&(j.drawContext.useInstancing=!0),this._drawWrappers[I]=j);const K=C.join("\n");if(j.defines!==K){const I=[],O=[],C=[];this.fillUniformsAttributesAndSamplerNames(O,I,C),j.setEffect(this._engine.createEffect("gpuRenderParticles",I,O,C,K),K)}return j}static _GetAttributeNamesOrOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const K=[o.e.PositionKind,"age","life","size","angle"];return I||K.push(o.e.ColorKind),O&&K.push("cellIndex"),C||K.push("initialDirection"),j&&K.push("direction"),K.push("offset",o.e.UVKind),K}static _GetEffectCreationOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=["emitterWM","Ep","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,OI.d)(j),I&&j.push("sheetInfos"),O&&j.push("logarithmicDepthConstant"),C&&(j.push("vFogInfos"),j.push("vFogColor")),j}fillDefines(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,OI.j)(this,this._scene,I),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==pO.b.FOGMODE_NONE&&I.push("#define FOG")),O===SO.BLENDMODE_MULTIPLY&&I.push("#define BLENDMULTIPLYMODE"),this.isLocal&&I.push("#define LOCAL"),this.useLogarithmicDepth&&I.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(I.push("#define BILLBOARD"),this.billboardMode){case SO.BILLBOARDMODE_Y:I.push("#define BILLBOARDY");break;case SO.BILLBOARDMODE_STRETCHED:I.push("#define BILLBOARDSTRETCHED");break;case SO.BILLBOARDMODE_ALL:I.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&I.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&I.push("#define ANIMATESHEET"),C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),I.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(I,O,C){O.push(...WO._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===SO.BILLBOARDMODE_STRETCHED)),I.push(...WO._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(UO.e.PrepareUniforms(I,this._imageProcessingConfigurationDefines),UO.e.PrepareSamplers(C,this._imageProcessingConfigurationDefines))}animate(){var I;let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(O?this.preWarmStepOffset:(null===(I=this._scene)||void 0===I?void 0:I.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(I,O){const C=this[O];if(!I||!I.length||C)return;const j=new Float32Array(this._rawTextureWidth);for(let K=0;K<this._rawTextureWidth;K++){const O=K/this._rawTextureWidth;v.GetCurrentGradient(O,I,((I,O,C)=>{j[K]=(0,p.Lerp)(I.factor1,O.factor1,C)}))}this[O]=F.d.CreateRTexture(j,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[O].name=O.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const I=new Uint8Array(4*this._rawTextureWidth),O=y.TmpColors.TS[0];for(let C=0;C<this._rawTextureWidth;C++){const j=C/this._rawTextureWidth;v.GetCurrentGradient(j,this._colorGradients,((j,K,i)=>{y.TS.LerpToRef(j.color1,K.color1,i,O),I[4*C]=255*O.r,I[4*C+1]=255*O.g,I[4*C+2]=255*O.b,I[4*C+3]=255*O.a}))}this._colorGradientsTexture=F.d.CreateRGBATexture(I,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(I,O){var C,K,i,y;const S=this._getWrapper(I),U=S.effect;this._engine.enableEffect(S);const p=(null===(C=this._scene)||void 0===C?void 0:C.getViewMatrix())||j.Matrix.IdentityReadOnly;if(U.setMatrix("view",p),U.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),U.setTexture("diffuseSampler",this.particleTexture),U.setVector2("translationPivot",this.translationPivot),U.setVector3("Ep",this.Ep),this.isLocal&&U.setMatrix("emitterWM",O),this._colorGradientsTexture?U.setTexture("colorGradientSampler",this._colorGradientsTexture):U.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const I=this.particleTexture.getBaseSize();U.setFloat3("sheetInfos",this.spriteCellWidth/I.width,this.spriteCellHeight/I.height,I.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const I=this._scene.activeCamera;U.setVector3("eyePosition",I.globalPosition)}const N=U.defines;if(this._scene&&((0,OI.g)(U,this,this._scene),this.applyFog&&(0,CI.h)(this._scene,void 0,U)),N.indexOf("#define BILLBOARDMODE_ALL")>=0){const I=p.clone();I.invert(),U.setMatrix("invView",I)}return this.useLogarithmicDepth&&this._scene&&(0,CI.o)(N,U,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(U),this._setEngineBasedOnBlendMode(I),this._platform.bindDrawBuffers(this._targetIndex,U,null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(U),null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(y=this._scene)&&void 0!==y&&y.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(I){if(!this.KO||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!I)if(this.KO.position){I=this.KO.getWorldMatrix()}else{const O=this.KO;I=j.TmpVectors.Matrix[0],j.Matrix.TranslationToRef(O.x,O.y,O.z,I)}const O=this._engine,C=O.getDepthWrite();if(O.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const I=this.nI();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",I.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",I),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const K=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=K,O.setDepthWrite(C)}render(){let I,O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],C=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!O&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let I=0;I<this.preWarmCycles;I++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const I=0|this._accumulatedCount;this._accumulatedCount-=I,this._currentActiveCount+=I}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.KO.position){I=this.KO.getWorldMatrix()}else{const O=this.KO;I=j.TmpVectors.Matrix[0],j.Matrix.TranslationToRef(O.x,O.y,O.z,I)}const K=this._engine;this.updateInAnimate||this._update(I);let i=0;return O||C||(K.setState(!1),this.forceDepthWrite&&K.setDepthWrite(!0),i=this.blendMode===SO.BLENDMODE_MULTIPLYADD?this._render(SO.BLENDMODE_MULTIPLY,I)+this._render(SO.BLENDMODE_ADD,I):this._render(this.blendMode,I),this._engine.setAlphaMode(0)),i}rebuild(){const I=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(I,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,I()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const O in this._drawWrappers){this._drawWrappers[O].dispose()}if(this._drawWrappers={},this._scene){const I=this._scene.RQ.indexOf(this);I>-1&&this._scene.RQ.splice(I,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let O=0;O<this._renderVertexBuffers.length;++O){const I=this._renderVertexBuffers[O];for(const O in I)I[O].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),I&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),I&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.yS.notifyObservers(this),this.yS.clear()}clone(I,O){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j={...this._customWrappers};let K=null;const i=this._engine;if(i.createEffectForParticles&&null!=this.customShader){K=this.customShader;const I=K.shaderOptions.defines.length>0?K.shaderOptions.defines.join("\n"):"";j[0]=i.createEffectForParticles(K.shaderPath.fragmentElement,K.shaderOptions.uniforms,K.shaderOptions.samplers,I,void 0,void 0,void 0,this)}const y=this.serialize(C),S=WO.Parse(y,this._scene||this._engine,this._rootUrl);return S.name=I,S.customShader=K,S._customWrappers=j,void 0===O&&(O=this.KO),this.noiseTexture&&(S.noiseTexture=this.noiseTexture.clone()),S.KO=O,S}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return SO._Serialize(O,this,I),O.activeParticleCount=this.activeParticleCount,O.randomTextureSize=this._randomTextureSize,O.customShader=this.customShader,O}static Parse(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4?arguments[4]:void 0;const i=I.name;let y,S;O instanceof PI.b?y=O:(S=O,y=S.getEngine());const U=new WO(i,{tO:K||I.tO,randomTextureSize:I.randomTextureSize},O,null,I.isAnimationSheetEnabled);if(U._rootUrl=C,I.customShader&&y.createEffectForParticles){const O=I.customShader,C=O.shaderOptions.defines.length>0?O.shaderOptions.defines.join("\n"):"",j=y.createEffectForParticles(O.shaderPath.fragmentElement,O.shaderOptions.uniforms,O.shaderOptions.samplers,C,void 0,void 0,void 0,U);U.setCustomEffect(j,0),U.customShader=O}return I.id&&(U.id=I.id),I.activeParticleCount&&(U.activeParticleCount=I.activeParticleCount),SO._Parse(I,U,O,C),I.preventAutoStart&&(U.preventAutoStart=I.preventAutoStart),j||U.preventAutoStart||U.start(),U}}var YO=C(12083),oO=C(13525),cO=C(12604);class nO{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(I){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const O of this.systems)O.KO=I;this._emitterNode=I}setEmitterAsSphere(I,O,C){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:I,renderingGroupId:O};const j=(0,oO.c)("emitterSphere",{diameter:I.diameter,segments:I.segments},C);j.renderingGroupId=O;const K=new cO.rO("emitterSphereMaterial",C);K.emissiveColor=I.color,j.material=K;for(const i of this.systems)i.KO=j;this._emitterNode=j}start(I){for(const O of this.systems)I&&(O.KO=I),O.start()}dispose(){for(const I of this.systems)I.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={systems:[]};for(const C of this.systems)O.systems.push(C.serialize(I));return this._emitterNode&&(O.KO=this._emitterCreationOptions),O}static Parse(I,O){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0;const K=new nO,i=this.BaseAssetsUrl+"/textures/";O=O||R.e.LastCreatedScene;for(const y of I.systems)K.systems.push(C?WO.Parse(y,O,i,!0,j):SO.Parse(y,O,i,!0,j));if(I.KO){const C=I.KO.options;if("Sphere"===I.KO.kind)K.setEmitterAsSphere({diameter:C.diameter,segments:C.segments,color:y.WO.YO(C.color)},I.KO.renderingGroupId,O)}return K}}nO.BaseAssetsUrl="https://assets.babylonjs.com/particles";var XO=C(12130);class TO{static CreateDefault(I){let O,C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,j=arguments.length>2?arguments[2]:void 0;O=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new WO("default system",{tO:C},j):new SO("default system",C,j),O.KO=I;const K=YO.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return O.particleTexture=new l.e(K,O.nI()),O.createConeEmitter(.1,Math.PI/4),O.color1=new y.TS(1,1,1,1),O.color2=new y.TS(1,1,1,1),O.colorDead=new y.TS(1,1,1,0),O.minSize=.1,O.maxSize=.1,O.minEmitPower=2,O.maxEmitPower=2,O.updateSpeed=1/60,O.emitRate=30,O}static CreateAsync(I,O){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0;O||(O=R.e.LastCreatedScene);const K={};return O.addPendingData(K),new Promise(((i,y)=>{if(C&&!WO.IsSupported)return O.removePendingData(K),y("Particle system with GPU is not supported.");YO.Tools.LoadFile(`${TO.BaseAssetsUrl}/systems/${I}.json`,(I=>{O.removePendingData(K);const y=JSON.parse(I.toString());return i(nO.Parse(y,O,C,j))}),void 0,void 0,void 0,(()=>(O.removePendingData(K),y(`An error occurred with the creation of your particle system. Check if your type '${I}' exists.`))))}))}static ExportSet(I){const O=new nO;for(const C of I)O.systems.push(C);return O}static ParseFromFileAsync(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=arguments.length>5?arguments[5]:void 0;return new Promise(((y,S)=>{const U=new XO.d;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const O=JSON.parse(U.responseText);let S;S=j?WO.Parse(O,C,K,!1,i):SO.Parse(O,C,K,!1,i),I&&(S.name=I),y(S)}else S("Unable to load the particle system")})),U.open("GET",O),U.send()}))}static ParseFromSnippetAsync(I,O){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",K=arguments.length>4?arguments[4]:void 0;if("_BLANK"===I){const I=this.CreateDefault(null);return I.start(),Promise.resolve(I)}return new Promise(((i,y)=>{const S=new XO.d;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const y=JSON.parse(JSON.parse(S.responseText).jsonPayload),U=JSON.parse(y.particleSystem);let p;p=C?WO.Parse(U,O,j,!1,K):SO.Parse(U,O,j,!1,K),p.snippetId=I,i(p)}else y("Unable to load the snippet "+I)})),S.open("GET",this.SnippetUrl+"/"+I.replace(/#/g,"/")),S.send()}))}}TO.BaseAssetsUrl=nO.BaseAssetsUrl,TO.SnippetUrl="https://snippet.babylonjs.com",TO.CreateFromSnippetAsync=TO.ParseFromSnippetAsync;var HO=C(12671),bO=C(12523),aO=C(13533);(0,aO.g)(bO.d.NAME_PARTICLESYSTEM,((I,O,C,j)=>{const K=(0,aO.k)(bO.d.NAME_PARTICLESYSTEM);if(K&&void 0!==I.RQ&&null!==I.RQ)for(let i=0,y=I.RQ.length;i<y;i++){const y=I.RQ[i];C.RQ.push(K(y,O,j))}})),(0,aO.e)(bO.d.NAME_PARTICLESYSTEM,((I,O,C)=>{if(I.activeParticleCount){return WO.Parse(I,O,C)}return SO.Parse(I,O,C)})),PI.b.prototype.createEffectForParticles=function(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0,U=arguments.length>7?arguments[7]:void 0,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,N=arguments.length>9?arguments[9]:void 0,Q=[],s=[];const Z=[];return U?U.fillUniformsAttributesAndSamplerNames(s,Q,Z):(Q=SO._GetAttributeNamesOrOptions(),s=SO._GetEffectCreationOptions()),-1===K.indexOf(" BILLBOARD")&&(K+="\n#define BILLBOARD\n"),null!==U&&void 0!==U&&U.isAnimationSheetEnabled&&-1===K.indexOf(" ANIMATESHEET")&&(K+="\n#define ANIMATESHEET\n"),-1===j.indexOf("diffuseSampler")&&j.push("diffuseSampler"),this.createEffect({vertex:N??(null===U||void 0===U?void 0:U.vertexShaderName)??"particles",fragmentElement:I},Q,s.concat(O),Z.concat(j),K,i,y,S,void 0,p,(async()=>{0===p?await Promise.resolve().then(C.bind(C,13567)):await Promise.resolve().then(C.bind(C,13630))}))},HO.c.prototype.getEmittedParticleSystems=function(){const I=[];for(let O=0;O<this.nI().RQ.length;O++){const C=this.nI().RQ[O];C.KO===this&&I.push(C)}return I},HO.c.prototype.getHierarchyEmittedParticleSystems=function(){const I=[],O=this.getDescendants();O.push(this);for(let C=0;C<this.nI().RQ.length;C++){const j=this.nI().RQ[C],K=j.KO;K.position&&-1!==O.indexOf(K)&&I.push(j)}return I};C(12580),C(12590),C(12660);C(12665),C(13535),C(12453),C(12571),C(12697);C(12449);var MO;C(13544),C(12284);!function(I){I[I.Color=2]="Color",I[I.UV=1]="UV",I[I.Random=0]="Random",I[I.Stated=3]="Stated"}(MO||(MO={}));var uO=C(12476);const JO=new j.mC(0,0,0),fO=new j.mC(0,0,0),lO=new j.mC(0,0,0);class xO{constructor(I,O,C){this.width=I,this.height=O,this.data=C}processFlowable(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;if(!C)return;C instanceof j.Matrix?j.mC.TransformCoordinatesToRef(I.position,C,lO):(lO.x=C.x,lO.y=C.y,lO.z=C.z);const K=.5*lO.x+.5,i=1-(.5*lO.y+.5),y=Math.floor(K*this.width),S=Math.floor(i*this.height);if(y<0||y>=this.width||S<0||S>=this.height)return;const U=4*(S*this.width+y),p=this.data[U]/255*2-1,N=this.data[U+1]/255*2-1,Q=this.data[U+2]/255*2-1,s=this.data[U+3]/255;JO.set(p,N,Q),JO.scaleToRef(O*s,fO),I.direction.addInPlace(fO)}_processParticle(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;this.processFlowable(I,O,C)}static async FromUrlAsync(I){return await new Promise(((O,C)=>{const j=document.createElement("canvas"),K=j.getContext("2d");let i=null;const y=new Image;y.crossOrigin="anonymous",y.src=I,y.onerror=O=>{C(new Error(`Failed to load image: ${I} : ${O}`))},y.onload=()=>{j.width=y.width,j.height=y.height,K.drawImage(y,0,0),i=K.getImageData(0,0,j.width,j.height),O(new xO(j.width,j.height,i.data))}}))}static async ExtractFromTextureAsync(I){return await new Promise(((O,C)=>{if(!I.isReady())return void I.onLoadObservable.addOnce((async()=>{try{const C=await this.ExtractFromTextureAsync(I);O(C)}catch(j){C(j)}}));const j=I.getSize();uO.k.GetTextureDataAsync(I,j.width,j.height).then((I=>{O(new xO(j.width,j.height,new Uint8ClampedArray(I)))})).catch(C)}))}}var DO,tO,dO,wO,gO,VO,eO,LO,zO;!function(I){I[I.Int=1]="Int",I[I.Float=2]="Float",I[I.Vector2=4]="Vector2",I[I.mC=8]="mC",I[I.Matrix=16]="Matrix",I[I.Particle=32]="Particle",I[I.Texture=64]="Texture",I[I.TS=128]="TS",I[I.FloatGradient=256]="FloatGradient",I[I.Vector2Gradient=512]="Vector2Gradient",I[I.Vector3Gradient=1024]="Vector3Gradient",I[I.Color4Gradient=2048]="Color4Gradient",I[I.System=4096]="System",I[I.AutoDetect=8192]="AutoDetect",I[I.BasedOnInput=16384]="BasedOnInput",I[I.Undefined=32768]="Undefined",I[I.All=65535]="All"}(DO||(DO={})),function(I){I[I.Compatible=0]="Compatible",I[I.TypeIncompatible=1]="TypeIncompatible",I[I.HierarchyIssue=2]="HierarchyIssue"}(tO||(tO={})),function(I){I[I.Input=0]="Input",I[I.Output=1]="Output"}(dO||(dO={}));class kO{get direction(){return this._direction}get type(){if(this._type===DO.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===DO.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(I){this._type=I}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((I=>I.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(I,O,C){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=DO.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new B.c,this.onDisconnectionObservable=new B.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=O,this.name=I,this._direction=C}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(I){var O;return this.isConnected?null!==(O=this._connectedPoint)&&void 0!==O&&O._storedFunction?this._connectedPoint._storedFunction(I):this._connectedPoint._storedValue:this.value}canConnectTo(I){return 0===this.checkCompatibilityState(I)}checkCompatibilityState(I){const O=this._ownerBlock,C=I.ownerBlock;if(this.type!==I.type&&I.innerType!==DO.AutoDetect)return I.acceptedConnectionPointTypes&&-1!==I.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(I.excludedConnectionPointTypes&&-1!==I.excludedConnectionPointTypes.indexOf(this.type))return 1;let j=C,K=O;return 0===this.direction&&(j=O,K=C),j.isAnAncestorOf(K)?2:0}connectTo(I){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(I))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${I.ownerBlock.name}".${I.name}`;return this._endpoints.push(I),I._connectedPoint=this,this.onConnectionObservable.notifyObservers(I),I.onConnectionObservable.notifyObservers(this),this}disconnectFrom(I){const O=this._endpoints.indexOf(I);return-1===O||(this._endpoints.splice(O,1),I._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(I),I.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(I){let O=1;for(;O<DO.All;)I&O||this.excludedConnectionPointTypes.push(O),O<<=1}serialize(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const O={};return O.name=this.name,O.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.qS?(O.valueType="BABYLON."+this.value.getClassName(),O.value=this.value.qS()):(O.valueType="number",O.value=this.value)),I&&this.connectedPoint&&(O.inputName=this.name,O.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,O.targetConnectionName=this.connectedPoint.name,O.isExposedOnFrame=!0,O.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(O.isExposedOnFrame=!0,O.exposedPortPosition=this.exposedPortPosition),O}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class AO{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(I){this._name=I}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(I){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new B.c,this.yS=new B.c,this.onInputChangedObservable=new B.c,this.visibleOnFrame=!1,this._name=I,this.uniqueId=x.c.UniqueId}_inputRename(I){return I}_outputRename(I){return I}isAnAncestorOf(I){for(const O of this._outputs)if(O.hasEndpoints)for(const C of O.endpoints){if(C.ownerBlock===I)return!0;if(C.ownerBlock.isAnAncestorOf(I))return!0}return!1}isAnAncestorOfType(I){if(this.getClassName()===I)return!0;for(const O of this._outputs)if(O.hasEndpoints)for(const C of O.endpoints)if(C.ownerBlock.isAnAncestorOfType(I))return!0;return!1}getInputByName(I){const O=this._inputs.filter((O=>O.name===I));return O.length?O[0]:null}_linkConnectionTypes(I,O){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[O]._acceptedConnectionPointType=this._inputs[I]:(this._inputs[I]._linkedConnectionSource=this._inputs[O],this._inputs[I]._isMainLinkSource=!0),this._inputs[O]._linkedConnectionSource=this._inputs[I]}registerInput(I,O){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0,K=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;const y=new kO(I,this,0);return y.type=O,y.isOptional=C,y.defaultValue=j,y.value=j,y.valueMin=K,y.valueMax=i,this._inputs.push(y),this.onInputChangedObservable.notifyObservers(y),this}registerOutput(I,O,C){return(C=C??new kO(I,this,1)).type=O,this._outputs.push(C),this}_build(I){}_customBuildStep(I){}build(I){if(this._buildId===I.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((I=>I.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=I.buildId;for(const O of this._inputs){if(!O.connectedPoint){O.isOptional||I.notConnectedNonOptionalInputs.push(O);continue}const C=O.connectedPoint.ownerBlock;C&&C!==this&&!C.isSystem&&C.build(I)}return this._customBuildStep(I),I.verbose&&D.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(I),this.onBuildObservable.notifyObservers(this),!1}serialize(){const I={};I.customType="BABYLON."+this.getClassName(),I.id=this.uniqueId,I.name=this.name,I.visibleOnFrame=this.visibleOnFrame,I.inputs=[],I.outputs=[];for(const O of this.inputs)I.inputs.push(O.serialize());for(const O of this.outputs)I.outputs.push(O.serialize(!1));return I}_deserialize(I){this._name=I.name,this.comments=I.comments,this.visibleOnFrame=!!I.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(I)}_deserializePortDisplayNamesAndExposedOnFrame(I){const O=I.inputs,C=I.outputs;if(O)for(const j of O){const I=this.inputs.find((I=>I.name===j.name));if(!I)return;if(j.displayName&&(I.displayName=j.displayName),j.isExposedOnFrame&&(I.isExposedOnFrame=j.isExposedOnFrame,I.exposedPortPosition=j.exposedPortPosition),void 0!==j.value&&null!==j.value)if("number"===j.valueType)I.value=j.value;else{const O=(0,S.c)(j.valueType);O&&(I.value=O.YO(j.value))}}if(C)for(let j=0;j<C.length;j++){const I=C[j];I.displayName&&(this.outputs[j].displayName=I.displayName),I.isExposedOnFrame&&(this.outputs[j].isExposedOnFrame=I.isExposedOnFrame,this.outputs[j].exposedPortPosition=I.exposedPortPosition)}}clone(){const I=this.serialize(),O=(0,S.c)(I.customType);if(O){const C=new O;return C._deserialize(I),C}return null}dispose(){this.yS.notifyObservers(this),this.yS.clear();for(const I of this.inputs)I.dispose();for(const I of this.outputs)I.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function PO(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",j=arguments.length>3?arguments[3]:void 0;return(K,i)=>{let y=K._propStore;y||(y=[],K._propStore=y),y.push({propertyName:i,displayName:I,type:O,groupName:C,options:j??{},className:K.getClassName()})}}(0,u.e)([(0,J.E)("comment")],AO.prototype,"comments",void 0),function(I){I[I.Boolean=0]="Boolean",I[I.Float=1]="Float",I[I.Int=2]="Int",I[I.Vector2=3]="Vector2",I[I.List=4]="List",I[I.TS=5]="TS",I[I.SamplingMode=6]="SamplingMode",I[I.TextureFormat=7]="TextureFormat",I[I.TextureType=8]="TextureType"}(wO||(wO={})),function(I){I[I.None=0]="None",I[I.Position=1]="Position",I[I.Direction=2]="Direction",I[I.Age=3]="Age",I[I.Lifetime=4]="Lifetime",I[I.Color=5]="Color",I[I.ScaledDirection=6]="ScaledDirection",I[I.Scale=7]="Scale",I[I.AgeGradient=8]="AgeGradient",I[I.Angle=9]="Angle",I[I.SpriteCellIndex=16]="SpriteCellIndex",I[I.SpriteCellStart=17]="SpriteCellStart",I[I.SpriteCellEnd=18]="SpriteCellEnd"}(gO||(gO={})),function(I){I[I.None=0]="None",I[I.Time=1]="Time",I[I.Delta=2]="Delta",I[I.Emitter=3]="Emitter"}(VO||(VO={}));class vO{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let I="";for(const O of this.notConnectedNonOptionalInputs)I+=`input ${O.name} from block ${O.ownerBlock.name}[${O.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(I)throw"Build of Node Particle System Set failed:\n"+I}adapt(I,O){const C=I.getConnectedValue(this)||0;if(I.type===O)return C;switch(O){case DO.Vector2:return new j.Vector2(C,C);case DO.mC:return new j.mC(C,C,C);case DO.TS:return new y.TS(C,C,C,C)}return null}getContextualValue(I){if(!this.particleContext||!this.systemContext)return null;switch(I){case gO.Position:return this.particleContext.position;case gO.Direction:return this.particleContext.direction;case gO.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case gO.Color:return this.particleContext.color;case gO.Age:return this.particleContext.age;case gO.Lifetime:return this.particleContext.lifeTime;case gO.Angle:return this.particleContext.angle;case gO.Scale:return this.particleContext.scale;case gO.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case gO.SpriteCellEnd:return this.systemContext.endSpriteCellID;case gO.SpriteCellIndex:return this.particleContext.cellIndex;case gO.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.KO.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.KO.absolutePosition:this.systemContext.KO:null}getSystemValue(I){if(!this.particleContext||!this.systemContext)return null;switch(I){case VO.Time:return this.systemContext._actualFrame;case VO.Delta:return this.systemContext._scaledUpdateSpeed;case VO.Emitter:if(this.isEmitterTransformNode){return this.systemContext.KO.absolutePosition}return this.systemContext.KO}return null}}function BO(I,O,C){const j=new vO;j.hO=O;const K=I.createSystem(j);return K.canStart=()=>!0,K.KO=C.clone(),K.disposeOnStop=!0,K.start(),K}class FO extends AO{constructor(I){super(I),this.blendMode=U.BLENDMODE_ONEONE,this.tO=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",DO.Particle),this.registerInput("texture",DO.Texture),this.registerInput("onStart",DO.System,!0),this.registerInput("onEnd",DO.System,!0),this.registerOutput("system",DO.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(I){I.tO=this.tO,I.buildId=this._buildId++,this.build(I);const O=this.particle.getConnectedValue(I);return O.particleTexture=this.texture.getConnectedValue(I),O.emitRate=this.emitRate,O.blendMode=this.blendMode,O.name=this.name,O._nodeGenerated=!0,O._targetStopDuration=this.targetStopDuration,O.startDelay=this.startDelay,this.system._storedValue=this,O.canStart=()=>!this.doNoStart,O.onStartedObservable.add((C=>{const j=this.onStart.getConnectedValue(I);j&&C.onStartedObservable.addOnce((()=>{I.systemContext=O;const C=BO(j,I.hO,I.emitterPosition);this.yS.addOnce((()=>{C.dispose()}))}));const K=this.onEnd.getConnectedValue(I);K&&C.onStoppedObservable.addOnce((()=>{I.systemContext=O;const C=BO(K,I.hO,I.emitterPosition);this.yS.addOnce((()=>{C.dispose()}))}))})),this.yS.addOnce((()=>{O.dispose()})),O}serialize(){const I=super.serialize();return I.tO=this.tO,I.emitRate=this.emitRate,I.blendMode=this.blendMode,I.doNoStart=this.doNoStart,I.targetStopDuration=this.targetStopDuration,I.startDelay=this.startDelay,I}_deserialize(I){super._deserialize(I),this.tO=I.tO,this.emitRate=I.emitRate,this.doNoStart=!!I.doNoStart,void 0!==I.blendMode&&(this.blendMode=I.blendMode),void 0!==I.targetStopDuration&&(this.targetStopDuration=I.targetStopDuration),void 0!==I.startDelay&&(this.startDelay=I.startDelay)}}(0,u.e)([PO("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:U.BLENDMODE_ONEONE},{label:"Standard",value:U.BLENDMODE_STANDARD},{label:"Add",value:U.BLENDMODE_ADD},{label:"Multiply",value:U.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:U.BLENDMODE_MULTIPLYADD}]})],FO.prototype,"blendMode",void 0),(0,u.e)([PO("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],FO.prototype,"tO",void 0),(0,u.e)([PO("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FO.prototype,"emitRate",void 0),(0,u.e)([PO("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FO.prototype,"targetStopDuration",void 0),(0,u.e)([PO("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FO.prototype,"startDelay",void 0),(0,u.e)([PO("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],FO.prototype,"doNoStart",void 0),(0,S.e)("BABYLON.SystemBlock",FO);class RO extends AO{get type(){if(this._type===DO.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=DO.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=DO.Vector2,this._type;case"mC":return this._type=DO.mC,this._type;case"TS":return this._type=DO.TS,this._type;case"Matrix":return this._type=DO.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===gO.None&&this._systemSource!==VO.None}get systemSource(){return this._systemSource}set systemSource(I){if(this._systemSource=I,I!==VO.None){switch(this._contextualSource=gO.None,this._type=DO.Float,I){case VO.Time:case VO.Delta:this._type=DO.Float;break;case VO.Emitter:this._type=DO.mC}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==gO.None}get contextualValue(){return this._contextualSource}set contextualValue(I){if(this._contextualSource=I,I!==gO.None){switch(this._systemSource=VO.None,I){case gO.Scale:this._type=DO.Vector2;break;case gO.Position:case gO.Direction:case gO.ScaledDirection:this._type=DO.mC;break;case gO.Color:this._type=DO.TS;break;case gO.Age:case gO.Lifetime:case gO.Angle:case gO.AgeGradient:this._type=DO.Float;break;case gO.SpriteCellEnd:case gO.SpriteCellStart:case gO.SpriteCellIndex:this._type=DO.Int}this.output&&(this.output.type=this._type)}}constructor(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DO.AutoDetect;super(I),this._type=DO.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new B.c,this._systemSource=VO.None,this._contextualSource=gO.None,this._type=O,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",O)}get value(){return this._storedValue}set value(I){this.type===DO.Float&&this.min!==this.max&&(I=Math.max(this.min,I),I=Math.min(this.max,I)),this._storedValue=I,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(I){this._valueCallback=I}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case DO.Int:case DO.Float:this.value=0;break;case DO.Vector2:this.value=j.Vector2.Zero();break;case DO.mC:this.value=j.mC.Zero();break;case DO.TS:this.value=new y.TS(1,1,1,1);break;case DO.Matrix:this.value=j.Matrix.Identity()}}_build(I){super._build(I),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=I=>I.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=I=>I.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const I=super.serialize();return I.type=this.type,I.contextualValue=this.contextualValue,I.systemSource=this.systemSource,I.min=this.min,I.max=this.max,I.groupInInspector=this.groupInInspector,I.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.qS?(I.valueType="BABYLON."+this._storedValue.getClassName(),I.value=this._storedValue.qS()):(I.valueType="number",I.value=this._storedValue)),I}_deserialize(I){if(super._deserialize(I),this._type=I.type,this.contextualValue=I.contextualValue,this.systemSource=I.systemSource||VO.None,this.min=I.min||0,this.max=I.max||0,this.groupInInspector=I.groupInInspector||"",void 0!==I.displayInInspector&&(this.displayInInspector=I.displayInInspector),I.valueType)if("number"===I.valueType)this._storedValue=I.value;else{const O=(0,S.c)(I.valueType);O&&(this._storedValue=O.YO(I.value))}}}(0,S.e)("BABYLON.ParticleInputBlock",RO);class GO extends AO{get url(){return this._url}set url(I){this._url!==I&&(this._cachedData=null,this._url=I,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(I){this._textureDataUrl!==I&&(this._cachedData=null,this._textureDataUrl=I,this._url="",this._sourceTexture=null)}set sourceTexture(I){this._sourceTexture!==I&&(this._cachedData=null,this._sourceTexture=I,this._url="",this._textureDataUrl="")}constructor(I){super(I),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",DO.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const I=this.texture._storedValue;return await new Promise(((O,C)=>{if(!I.isReady())return void I.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),O(this._cachedData)}catch(I){C(I)}}));const j=I.getSize();uO.k.GetTextureDataAsync(I,j.width,j.height).then((C=>{this._cachedData={width:j.width,height:j.height,data:new Uint8ClampedArray(C)},I.dispose(),O(this._cachedData)})).catch(C)}))}_build(I){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new l.e(this._textureDataUrl,I.hO):this.texture._storedValue=new l.e(this._url,I.hO):this.texture._storedValue=null}serialize(){const I=super.serialize();return I.url=this.url,I.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(I.textureDataUrl=this.textureDataUrl),I}_deserialize(I){super._deserialize(I),this.url=I.url,this.serializedCachedData=!!I.serializedCachedData,I.textureDataUrl&&(this.textureDataUrl=I.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,S.e)("BABYLON.ParticleTextureSourceBlock",GO);class IC extends AO{constructor(I){super(I),this.registerInput("particle",DO.Particle),this.registerInput("position",DO.mC),this.registerOutput("output",DO.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(I){const O=this.particle.getConnectedValue(I);if(this.output._storedValue=O,!this.position.isConnected)return;const C={process:C=>{I.particleContext=C,I.systemContext=O,C.position.K(this.position.getConnectedValue(I))},previousItem:null,nextItem:null};O._updateQueueStart?VI(C,O._updateQueueStart):O._updateQueueStart=C}}(0,S.e)("BABYLON.UpdatePositionBlock",IC),function(I){I[I.Add=0]="Add",I[I.Subtract=1]="Subtract",I[I.Multiply=2]="Multiply",I[I.Divide=3]="Divide",I[I.Max=4]="Max",I[I.Min=5]="Min"}(eO||(eO={}));class OC extends AO{constructor(I){super(I),this.operation=eO.Add,this.registerInput("left",DO.AutoDetect),this.registerInput("right",DO.AutoDetect),this.registerOutput("output",DO.BasedOnInput),this.output._typeConnectionSource=this.left;const O=[DO.Matrix,DO.Particle,DO.Texture,DO.System,DO.FloatGradient,DO.Color4Gradient,DO.Vector2Gradient,DO.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...O),this.right.excludedConnectionPointTypes.push(...O),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(I){let O;const C=this.left,K=this.right;if(!C.isConnected||!K.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const i=C.type===DO.Float||C.type===DO.Int,S=K.type===DO.Float||K.type===DO.Int,U=i&&S;switch(this.operation){case eO.Add:O=U?I=>C.getConnectedValue(I)+K.getConnectedValue(I):i?I=>I.adapt(C,K.type).add(K.getConnectedValue(I)):I=>C.getConnectedValue(I).add(I.adapt(K,C.type));break;case eO.Subtract:O=U?I=>C.getConnectedValue(I)-K.getConnectedValue(I):i?I=>I.adapt(C,K.type).EO(K.getConnectedValue(I)):I=>C.getConnectedValue(I).EO(I.adapt(K,C.type));break;case eO.Multiply:O=U?I=>C.getConnectedValue(I)*K.getConnectedValue(I):i?I=>I.adapt(C,K.type).multiply(K.getConnectedValue(I)):I=>C.getConnectedValue(I).multiply(I.adapt(K,C.type));break;case eO.Divide:O=U?I=>C.getConnectedValue(I)/K.getConnectedValue(I):i?I=>I.adapt(C,K.type).divide(K.getConnectedValue(I)):I=>C.getConnectedValue(I).divide(I.adapt(K,C.type));break;case eO.Min:if(U)O=I=>Math.min(C.getConnectedValue(I),K.getConnectedValue(I));else{const[I,S]=i?[K,C]:[C,K];switch(I.type){case DO.Vector2:O=O=>j.Vector2.Minimize(I.getConnectedValue(O),O.adapt(S,I.type));break;case DO.mC:O=O=>j.mC.Minimize(I.getConnectedValue(O),O.adapt(S,I.type));break;case DO.TS:O=O=>{const C=I.getConnectedValue(O),{r:j,g:K,b:i,a:U}=O.adapt(S,I.type);return new y.TS(Math.min(C.r,j),Math.min(C.g,K),Math.min(C.b,i),Math.min(C.a,U))}}}break;case eO.Max:if(!U){const[I,S]=i?[K,C]:[C,K];switch(I.type){case DO.Vector2:O=O=>j.Vector2.Maximize(I.getConnectedValue(O),O.adapt(S,I.type));break;case DO.mC:O=O=>j.mC.Maximize(I.getConnectedValue(O),O.adapt(S,I.type));break;case DO.TS:O=O=>{const C=I.getConnectedValue(O),{r:j,g:K,b:i,a:U}=O.adapt(S,I.type);return new y.TS(Math.max(C.r,j),Math.min(C.g,K),Math.min(C.b,i),Math.min(C.a,U))}}break}O=I=>Math.max(C.getConnectedValue(I),K.getConnectedValue(I))}this.output._storedFunction=I=>C.type===DO.Int?0|O(I):O(I)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===DO.Int||this.left.type===DO.Float&&this.right.type!==DO.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[I,O]of[[this.left,this.right],[this.right,this.left]])I.acceptedConnectionPointTypes=[DO.Int,DO.Float],O.isConnected&&(I.acceptedConnectionPointTypes.push(O.type),O.type!==DO.Int&&O.type!==DO.Float||I.acceptedConnectionPointTypes.push(DO.Vector2,DO.mC,DO.TS))}dispose(){super.dispose();for(const I of this._connectionObservers)I.remove();this._connectionObservers.length=0}serialize(){const I=super.serialize();return I.operation=this.operation,I}_deserialize(I){super._deserialize(I),this.operation=I.operation}}(0,u.e)([PO("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:eO.Add},{label:"Subtract",value:eO.Subtract},{label:"Multiply",value:eO.Multiply},{label:"Divide",value:eO.Divide},{label:"Max",value:eO.Max},{label:"Min",value:eO.Min}]})],OC.prototype,"operation",void 0),(0,S.e)("BABYLON.ParticleMathBlock",OC);class CC extends AO{constructor(I){super(I),this.registerInput("particle",DO.Particle),this.registerInput("direction1",DO.mC,!0,new j.mC(0,1,0)),this.registerInput("direction2",DO.mC,!0,new j.mC(0,1,0)),this.registerInput("minEmitBox",DO.mC,!0,new j.mC(-.5,-.5,-.5)),this.registerInput("maxEmitBox",DO.mC,!0,new j.mC(.5,.5,.5)),this.registerOutput("output",DO.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(I){const O=this.particle.getConnectedValue(I);O._directionCreation.process=C=>{I.particleContext=C,I.systemContext=O;const K=this.direction1.getConnectedValue(I),i=this.direction2.getConnectedValue(I),y=(0,p.RandomRange)(K.x,i.x),S=(0,p.RandomRange)(K.y,i.y),U=(0,p.RandomRange)(K.z,i.z);I.isEmitterTransformNode?j.mC.TransformNormalFromFloatsToRef(y,S,U,I.emitterWorldMatrix,C.direction):C.direction.cS(y,S,U)},O._positionCreation.process=C=>{I.particleContext=C,I.systemContext=O;const K=this.minEmitBox.getConnectedValue(I),i=this.maxEmitBox.getConnectedValue(I),y=(0,p.RandomRange)(K.x,i.x),S=(0,p.RandomRange)(K.y,i.y),U=(0,p.RandomRange)(K.z,i.z);I.isEmitterTransformNode?j.mC.TransformCoordinatesFromFloatsToRef(y,S,U,I.emitterWorldMatrix,C.position):(C.position.cS(y,S,U),C.position.addInPlace(I.emitterPosition))},this.output._storedValue=O}}(0,S.e)("BABYLON.BoxShapeBlock",CC);class jC extends AO{constructor(I){super(I),this.registerInput("emitPower",DO.Float,!0,1),this.registerInput("lifeTime",DO.Float,!0,1),this.registerInput("color",DO.TS,!0,new y.TS(1,1,1,1)),this.registerInput("scale",DO.Vector2,!0,new j.Vector2(1,1)),this.registerInput("angle",DO.Float,!0,0),this.registerOutput("particle",DO.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(I){const O=new SO(this.name,I.tO,I.hO,null,!1,void 0,!0);O.particleEmitterType=new h,O._lifeTimeCreation.process=(O,C)=>{I.particleContext=O,O.lifeTime=this.lifeTime.getConnectedValue(I),C._emitPower=this.emitPower.getConnectedValue(I)},O._colorCreation.process=O=>{I.particleContext=O,O.color.K(this.color.getConnectedValue(I))},O._sizeCreation.process=O=>{I.particleContext=O,O.size=1,O.scale.K(this.scale.getConnectedValue(I))},O._angleCreation.process=O=>{I.particleContext=O,O.angle=this.angle.getConnectedValue(I)},this.particle._storedValue=O}}(0,S.e)("BABYLON.CreateParticleBlock",jC);class KC{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const I=[];for(const O of this.attachedBlocks)O.isInput&&I.push(O);return I}constructor(I){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new B.c,this.name=I}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(I){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(I)&&this.attachedBlocks.push(I);for(const C of I.inputs){const j=C.connectedPoint;if(j){const C=j.ownerBlock;C!==I&&this._initializeBlock(C,O)}}}async buildAsync(I){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((C=>{const j=new nO;for(const I of this._systemBlocks)this._initializeBlock(I);for(const K of this.systemBlocks){const C=new vO;C.buildId=this._buildId++,C.hO=I,C.verbose=O;const i=K.createSystem(C);C.emitErrors(),j.systems.push(i)}this.onBuildObservable.notifyObservers(this),C(j)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const I=new FO("Particle system"),O=new IC("Update position");O.output.connectTo(I.particle);const C=new RO("Position");C.contextualValue=gO.Position;const j=new RO("Scaled direction");j.contextualValue=gO.ScaledDirection;const K=new OC("Add");K.operation=eO.Add,C.output.connectTo(K.left),j.output.connectTo(K.right),K.output.connectTo(O.position);const i=new jC("Create particle"),y=new CC("Box shape");i.particle.connectTo(y.particle),y.output.connectTo(O.particle);const S=new GO("Texture");S.texture.connectTo(I.texture),S.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(I)}removeBlock(I){const O=this.attachedBlocks.indexOf(I);if(O>-1&&this.attachedBlocks.splice(O,1),I.isSystem){const O=this._systemBlocks.indexOf(I);O>-1&&this._systemBlocks.splice(O,1)}}parseSerializedObject(I){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];O||this.clear();const C={};for(const j of I.EN){const I=(0,S.c)(j.customType);if(I){const O=new I;O._deserialize(j),C[j.id]=O,this.attachedBlocks.push(O),O.isSystem&&this._systemBlocks.push(O)}}for(const j of this.attachedBlocks)if(j.isTeleportOut){const I=j,O=I._tempEntryPointUniqueId;if(O){const j=C[O];j&&j.attachToEndpoint(I)}}for(let j=0;j<I.EN.length;j++){const K=I.EN[j],i=C[K.id];i&&(i.inputs.length&&K.inputs.some((I=>I.targetConnectionName))&&!O||this._restoreConnections(i,I,C))}if(I.locations||I.editorData&&I.editorData.locations){const j=I.locations||I.editorData.locations;for(const I of j)C[I.RC]&&(I.RC=C[I.RC].uniqueId);O&&this.editorData&&this.editorData.locations&&j.concat(this.editorData.locations),I.locations?this.editorData={locations:j}:(this.editorData=I.editorData,this.editorData.locations=j);const K=[];for(const I in C)K[I]=C[I].uniqueId;this.editorData.map=K}this.comment=I.comment}_restoreConnections(I,O,C){for(const j of I.outputs)for(const K of O.EN){const i=C[K.id];if(i)for(const y of K.inputs)if(C[y.targetBlockId]!==I||y.targetConnectionName!==j.name);else{const I=i.getInputByName(y.inputName);if(!I||I.isConnected)continue;j.connectTo(I,!0),this._restoreConnections(i,O,C)}}}serialize(I){const O=I?{}:f.e.Serialize(this);O.editorData=JSON.parse(JSON.stringify(this.editorData));let C=[];I?C=I:O.customType="BABYLON.NodeParticleSystemSet",O.EN=[];for(const j of C)O.EN.push(j.serialize());if(!I)for(const j of this.attachedBlocks)-1===C.indexOf(j)&&O.EN.push(j.serialize());return O}dispose(){for(const I of this.attachedBlocks)I.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(I){const O=new KC(I);return O.setToDefault(),O}static Parse(I){const O=f.e.Parse((()=>new KC(I.name)),I,null);return O.parseSerializedObject(I),O}static ParseFromSnippetAsync(I,O){return"_BLANK"===I?Promise.resolve(KC.CreateDefault("blank")):new Promise(((C,j)=>{const K=new XO.d;K.addEventListener("readystatechange",(()=>{if(4==K.readyState)if(200==K.status){const y=JSON.parse(JSON.parse(K.responseText).jsonPayload),S=JSON.parse(y.nodeParticle);O||(O=f.e.Parse((()=>new KC(I)),S,null)),O.parseSerializedObject(S),O.snippetId=I;try{C(O)}catch(i){j(i)}}else j("Unable to load the snippet "+I)})),K.open("GET",this.SnippetUrl+"/"+I.replace(/#/g,"/")),K.send()}))}}KC.EditorURL=`${YO.Tools._DefaultCdnUrl}/v${PI.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,KC.SnippetUrl="https://snippet.babylonjs.com",(0,u.e)([(0,J.E)()],KC.prototype,"name",void 0),(0,u.e)([(0,J.E)("comment")],KC.prototype,"comment",void 0),function(I){I[I.None=0]="None",I[I.PerParticle=1]="PerParticle",I[I.PerSystem=2]="PerSystem"}(LO||(LO={}));class iC extends AO{constructor(I){super(I),this._currentLockId=-2,this.lockMode=LO.PerParticle,this.registerInput("min",DO.AutoDetect,!0,0),this.registerInput("max",DO.AutoDetect,!0,1),this.registerOutput("output",DO.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(DO.Float|DO.Int|DO.Vector2|DO.mC|DO.TS),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(DO.Float|DO.Int|DO.Vector2|DO.mC|DO.TS),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=DO.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let I=null;switch(this._currentLockId=-2,this.min.type){case DO.AutoDetect:case DO.Int:case DO.Float:I=I=>{const O=this.min.getConnectedValue(I)||0,C=this.max.getConnectedValue(I)||1;return O+Math.random()*(C-O)};break;case DO.Vector2:I=I=>{const O=this.min.getConnectedValue(I)||j.Vector2.Zero(),C=this.max.getConnectedValue(I)||j.Vector2.One();return new j.Vector2(O.x+Math.random()*(C.x-O.x),O.y+Math.random()*(C.y-O.y))};break;case DO.mC:I=I=>{const O=this.min.getConnectedValue(I)||j.mC.Zero(),C=this.max.getConnectedValue(I)||j.mC.One();return new j.mC(O.x+Math.random()*(C.x-O.x),O.y+Math.random()*(C.y-O.y),O.z+Math.random()*(C.z-O.z))};break;case DO.TS:I=I=>{const O=this.min.getConnectedValue(I)||new y.TS(0,0,0,0),C=this.max.getConnectedValue(I)||new y.TS(1,1,1,1);return new y.TS(O.x+Math.random()*(C.x-O.x),O.y+Math.random()*(C.y-O.y),O.z+Math.random()*(C.z-O.z),O.w+Math.random()*(C.w-O.w))}}this.output._storedFunction=O=>{var C;let j=0;switch(this.lockMode){case LO.PerParticle:j=(null===(C=O.particleContext)||void 0===C?void 0:C.id)||-1;break;case LO.PerSystem:j=O.buildId||0}return this._currentLockId!==j&&(this.lockMode!==LO.None&&(this._currentLockId=j),this.output._storedValue=I(O)),this.output._storedValue}}serialize(){const I=super.serialize();return I.lockMode=this.lockMode,I}_deserialize(I){super._deserialize(I),this.lockMode=I.lockMode}}(0,u.e)([PO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:LO.None},{label:"Per particle",value:LO.PerParticle},{label:"Per system",value:LO.PerSystem}]})],iC.prototype,"lockMode",void 0),(0,S.e)("BABYLON.ParticleRandomBlock",iC);class yC extends AO{constructor(I){super(I),this._currentLockId=-2,this.lockMode=LO.PerParticle,this.registerInput("min",DO.AutoDetect),this.registerInput("max",DO.AutoDetect),this.registerOutput("output",DO.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const O=[DO.Matrix,DO.Particle,DO.Texture,DO.System,DO.FloatGradient,DO.Color4Gradient,DO.Vector2Gradient,DO.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...O),this.max.excludedConnectionPointTypes.push(...O)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let I=null;switch(this._currentLockId=-2,this.min.type){case DO.Float:case DO.Int:I=I=>{const O=this.min.getConnectedValue(I),C=this.max.getConnectedValue(I);return Math.random()*(C-O)+O};break;case DO.Vector2:I=I=>{const O=this.min.getConnectedValue(I),C=this.max.getConnectedValue(I);return new j.Vector2(Math.random()*(C.x-O.x)+O.x,Math.random()*(C.y-O.y)+O.y)};break;case DO.mC:I=I=>{const O=this.min.getConnectedValue(I),C=this.max.getConnectedValue(I);return new j.mC(Math.random()*(C.x-O.x)+O.x,Math.random()*(C.y-O.y)+O.y,Math.random()*(C.z-O.z)+O.z)};break;case DO.TS:I=I=>{const O=this.min.getConnectedValue(I),C=this.max.getConnectedValue(I);return new y.TS(Math.random()*(C.r-O.r)+O.r,Math.random()*(C.g-O.g)+O.g,Math.random()*(C.b-O.b)+O.b,Math.random()*(C.a-O.a)+O.a)}}this.output._storedFunction=O=>{var C;let j=0;switch(this.lockMode){case LO.PerParticle:j=(null===(C=O.particleContext)||void 0===C?void 0:C.id)||-1;break;case LO.PerSystem:j=O.buildId||0}return this._currentLockId!==j&&(this.lockMode!==LO.None&&(this._currentLockId=j),this.output._storedValue=I(O)),this.output._storedValue}}serialize(){const I=super.serialize();return I.lockMode=this.lockMode,I}_deserialize(I){super._deserialize(I),void 0!==I.lockMode&&(this.lockMode=I.lockMode)}}(0,u.e)([PO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:LO.None},{label:"Per particle",value:LO.PerParticle},{label:"Per system",value:LO.PerSystem}]})],yC.prototype,"lockMode",void 0),(0,S.e)("BABYLON.RandomRangeBlock",yC);(0,S.e)("BABYLON.ParticleLerpBlock",class extends AO{constructor(I){super(I),this.registerInput("left",DO.AutoDetect),this.registerInput("right",DO.AutoDetect),this.registerInput("gradient",DO.Float,!0,0,0,1),this.registerOutput("output",DO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(DO.Float|DO.Int|DO.Vector2|DO.mC|DO.TS)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const I=(I,O,C)=>(1-I)*O+I*C;this.output._storedFunction=O=>{const C=this.left.getConnectedValue(O),K=this.right.getConnectedValue(O),i=this.gradient.getConnectedValue(O);switch(this.left.type){case DO.Int:case DO.Float:return I(i,C,K);case DO.Vector2:return new j.Vector2(I(i,C.x,K.x),I(i,C.y,K.y));case DO.mC:return new j.mC(I(i,C.x,K.x),I(i,C.y,K.y),I(i,C.z,K.z));case DO.TS:return new y.TS(I(i,C.r,K.r),I(i,C.g,K.g),I(i,C.b,K.b),I(i,C.a,K.a))}return 0}}});(0,S.e)("BABYLON.UpdateDirectionBlock",class extends AO{constructor(I){super(I),this.registerInput("particle",DO.Particle),this.registerInput("direction",DO.mC),this.registerOutput("output",DO.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(I){const O=this.particle.getConnectedValue(I);if(this.output._storedValue=O,!this.direction.isConnected)return;const C={process:C=>{I.particleContext=C,I.systemContext=O,C.direction.K(this.direction.getConnectedValue(I))},previousItem:null,nextItem:null};O._updateQueueStart?VI(C,O._updateQueueStart):O._updateQueueStart=C}});(0,S.e)("BABYLON.UpdateColorBlock",class extends AO{constructor(I){super(I),this.registerInput("particle",DO.Particle),this.registerInput("color",DO.TS),this.registerOutput("output",DO.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(I){const O=this.particle.getConnectedValue(I);if(this.output._storedValue=O,!this.color.isConnected)return;const C={process:C=>{I.particleContext=C,I.systemContext=O,C.color.K(this.color.getConnectedValue(I))},previousItem:null,nextItem:null};O._updateQueueStart?VI(C,O._updateQueueStart):O._updateQueueStart=C}});(0,S.e)("BABYLON.UpdateScaleBlock",class extends AO{constructor(I){super(I),this.registerInput("particle",DO.Particle),this.registerInput("scale",DO.Vector2),this.registerOutput("output",DO.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(I){const O=this.particle.getConnectedValue(I);if(this.output._storedValue=O,!this.scale.isConnected)return;const C={process:C=>{I.particleContext=C,I.systemContext=O,C.scale.K(this.scale.getConnectedValue(I))},previousItem:null,nextItem:null};O._updateQueueStart?VI(C,O._updateQueueStart):O._updateQueueStart=C}});(0,S.e)("BABYLON.UpdateAngleBlock",class extends AO{constructor(I){super(I),this.registerInput("particle",DO.Particle),this.registerInput("angle",DO.Float),this.registerOutput("output",DO.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(I){const O=this.particle.getConnectedValue(I);if(this.output._storedValue=O,!this.angle.isConnected)return;const C={process:C=>{I.particleContext=C,I.systemContext=O,C.angle=this.angle.getConnectedValue(I)},previousItem:null,nextItem:null};O._updateQueueStart?VI(C,O._updateQueueStart):O._updateQueueStart=C}});(0,S.e)("BABYLON.BasicPositionUpdateBlock",class extends AO{constructor(I){super(I),this.registerInput("particle",DO.Particle),this.registerOutput("output",DO.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(I){const O=this.particle.getConnectedValue(I),C={process:C=>{I.particleContext=C,I.systemContext=O,C.direction.scaleToRef(O._directionScale,O._scaledDirection),C.position.addInPlace(O._scaledDirection)},previousItem:null,nextItem:null};O._updateQueueStart?VI(C,O._updateQueueStart):O._updateQueueStart=C,this.output._storedValue=O}});(0,S.e)("BABYLON.BasicSpriteUpdateBlock",class extends AO{constructor(I){super(I),this.registerInput("particle",DO.Particle),this.registerOutput("output",DO.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(I){const O=this.particle.getConnectedValue(I),C={process:C=>{I.particleContext=C,I.systemContext=O,C.updateCellIndex()},previousItem:null,nextItem:null};O._updateQueueStart?VI(C,O._updateQueueStart):O._updateQueueStart=C,this.output._storedValue=O}});(0,S.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends AO{constructor(I){super(I),this.registerInput("particle",DO.Particle),this.registerInput("cellIndex",DO.Int),this.registerOutput("output",DO.Particle),this.cellIndex.acceptedConnectionPointTypes=[DO.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(I){const O=this.particle.getConnectedValue(I);if(this.output._storedValue=O,!this.cellIndex.isConnected)return;const C={process:C=>{I.particleContext=C,I.systemContext=O,C.cellIndex=Math.floor(this.cellIndex.getConnectedValue(I))},previousItem:null,nextItem:null};O._updateQueueStart?VI(C,O._updateQueueStart):O._updateQueueStart=C}});class SC extends AO{constructor(I){super(I),this.strength=1,this.registerInput("particle",DO.Particle),this.registerInput("flowMap",DO.Texture),this.registerOutput("output",DO.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(I){var O;const C=this.particle.getConnectedValue(I),j=I.hO;let K;(null===(O=this.flowMap.connectedPoint)||void 0===O?void 0:O.ownerBlock).extractTextureContentAsync().then((I=>{I&&(K=new xO(I.width,I.height,I.data))}));const i={process:I=>{const O=j.getTransformMatrix();K&&K._processParticle(I,this.strength*C._tempScaledUpdateSpeed,O)},previousItem:null,nextItem:null};C._updateQueueStart?VI(i,C._updateQueueStart):C._updateQueueStart=i,this.output._storedValue=C}serialize(){const I=super.serialize();return I.strength=this.strength,I}_deserialize(I){super._deserialize(I),this.strength=I.strength}}(0,u.e)([PO("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],SC.prototype,"strength",void 0),(0,S.e)("BABYLON.UpdateFlowMapBlock",SC);(0,S.e)("BABYLON.SphereShapeBlock",class extends AO{constructor(I){super(I),this.registerInput("input",DO.Particle),this.registerInput("radius",DO.Float,!0,1),this.registerInput("radiusRange",DO.Float,!0,1,0,1),this.registerInput("directionRandomizer",DO.Float,!0,0,0,1),this.registerOutput("output",DO.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(I){const O=this.input.getConnectedValue(I);O._directionCreation.process=C=>{I.particleContext=C,I.systemContext=O;const K=this.directionRandomizer.getConnectedValue(I),i=C.position.EO(I.emitterPosition).normalize(),y=(0,p.RandomRange)(0,K),S=(0,p.RandomRange)(0,K),U=(0,p.RandomRange)(0,K);i.x+=y,i.y+=S,i.z+=U,i.normalize(),I.isEmitterTransformNode?j.mC.TransformNormalFromFloatsToRef(y,S,U,I.emitterWorldMatrix,C.direction):C.direction.cS(y,S,U)},O._positionCreation.process=C=>{I.particleContext=C,I.systemContext=O;const K=this.radius.getConnectedValue(I),i=this.radiusRange.getConnectedValue(I),y=K-(0,p.RandomRange)(0,K*i),S=(0,p.RandomRange)(0,1),U=(0,p.RandomRange)(0,2*Math.PI),N=Math.acos(2*S-1),Q=y*Math.cos(U)*Math.sin(N),s=y*Math.cos(N),Z=y*Math.sin(U)*Math.sin(N);I.isEmitterTransformNode?j.mC.TransformCoordinatesFromFloatsToRef(Q,s,Z,I.emitterWorldMatrix,C.position):(C.position.cS(Q,s,Z),C.position.addInPlace(I.emitterPosition))},this.output._storedValue=O}});(0,S.e)("BABYLON.PointShapeBlock",class extends AO{constructor(I){super(I),this.registerInput("particle",DO.Particle),this.registerInput("direction1",DO.mC,!0,new j.mC(0,1,0)),this.registerInput("direction2",DO.mC,!0,new j.mC(0,1,0)),this.registerOutput("output",DO.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(I){const O=this.particle.getConnectedValue(I);O._directionCreation.process=C=>{I.particleContext=C,I.systemContext=O;const K=this.direction1.getConnectedValue(I),i=this.direction2.getConnectedValue(I),y=(0,p.RandomRange)(K.x,i.x),S=(0,p.RandomRange)(K.y,i.y),U=(0,p.RandomRange)(K.z,i.z);I.isEmitterTransformNode?j.mC.TransformNormalFromFloatsToRef(y,S,U,I.emitterWorldMatrix,C.direction):C.direction.cS(y,S,U)},O._positionCreation.process=C=>{I.systemContext=O,I.isEmitterTransformNode?j.mC.TransformCoordinatesFromFloatsToRef(0,0,0,I.emitterWorldMatrix,C.position):C.position.K(I.emitterPosition)},this.output._storedValue=O}});(0,S.e)("BABYLON.CustomShapeBlock",class extends AO{constructor(I){super(I),this.registerInput("particle",DO.Particle),this.registerInput("position",DO.mC,!0,new j.mC(0,0,0)),this.registerInput("direction",DO.mC,!0,new j.mC(0,1,0)),this.registerOutput("output",DO.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(I){const O=this.particle.getConnectedValue(I);O._directionCreation.process=C=>{I.particleContext=C,I.systemContext=O;const K=this.direction.getConnectedValue(I);I.isEmitterTransformNode?j.mC.TransformNormalToRef(K,I.emitterWorldMatrix,C.direction):C.direction.K(K)},O._positionCreation.process=C=>{I.particleContext=C,I.systemContext=O;const K=this.position.getConnectedValue(I);I.isEmitterTransformNode?j.mC.TransformCoordinatesToRef(K,I.emitterWorldMatrix,C.position):(C.position.K(K),C.position.addInPlace(I.emitterPosition))},this.output._storedValue=O}});(0,S.e)("BABYLON.CylinderShapeBlock",class extends AO{constructor(I){super(I),this._tempVector=j.mC.Zero(),this.registerInput("particle",DO.Particle),this.registerInput("radius",DO.Float,!0,1),this.registerInput("height",DO.Float,!0,1,0),this.registerInput("radiusRange",DO.Float,!0,1,0,1),this.registerInput("directionRandomizer",DO.Float,!0,0,0,1),this.registerOutput("output",DO.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(I){const O=this.particle.getConnectedValue(I);O._directionCreation.process=C=>{I.particleContext=C,I.systemContext=O;const K=this.directionRandomizer.getConnectedValue(I);C.position.subtractToRef(I.emitterPosition,this._tempVector),this._tempVector.normalize(),I.isEmitterTransformNode&&j.mC.TransformNormalToRef(this._tempVector,I.emitterInverseWorldMatrix,this._tempVector);const i=(0,p.RandomRange)(-K/2,K/2);let y=Math.atan2(this._tempVector.x,this._tempVector.z);y+=(0,p.RandomRange)(-Math.PI/2,Math.PI/2)*K,this._tempVector.y=i,this._tempVector.x=Math.sin(y),this._tempVector.z=Math.cos(y),this._tempVector.normalize(),I.isEmitterTransformNode?j.mC.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,I.emitterWorldMatrix,C.direction):C.direction.K(this._tempVector)},O._positionCreation.process=C=>{I.particleContext=C,I.systemContext=O;const K=this.height.getConnectedValue(I),i=this.radiusRange.getConnectedValue(I),y=this.radius.getConnectedValue(I),S=(0,p.RandomRange)(-K/2,K/2),U=(0,p.RandomRange)(0,2*Math.PI),N=(0,p.RandomRange)((1-i)*(1-i),1),Q=Math.sqrt(N)*y,s=Q*Math.cos(U),Z=Q*Math.sin(U);I.isEmitterTransformNode?j.mC.TransformCoordinatesFromFloatsToRef(s,S,Z,I.emitterWorldMatrix,C.position):(C.position.cS(s,S,Z),C.position.addInPlace(I.emitterPosition))},this.output._storedValue=O}});class UC extends AO{constructor(I){super(I),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",DO.Particle),this.registerOutput("output",DO.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){super._build(I);const O=this.particle.getConnectedValue(I);O._isAnimationSheetEnabled=!0,O.spriteCellWidth=this.width,O.spriteCellHeight=this.height,O.startSpriteCellID=this.start,O.endSpriteCellID=this.end,O.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=O}serialize(){const I=super.serialize();return I.width=this.width,I.height=this.height,I.start=this.start,I.end=this.end,I.randomStartCell=this.randomStartCell,I}_deserialize(I){super._deserialize(I),this.width=I.width,this.height=I.height,this.start=I.start,this.end=I.end,this.randomStartCell=I.randomStartCell}}(0,u.e)([PO("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UC.prototype,"start",void 0),(0,u.e)([PO("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UC.prototype,"end",void 0),(0,u.e)([PO("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UC.prototype,"width",void 0),(0,u.e)([PO("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UC.prototype,"height",void 0),(0,u.e)([PO("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],UC.prototype,"loop",void 0),(0,u.e)([PO("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],UC.prototype,"randomStartCell",void 0),(0,S.e)("BABYLON.SetupSpriteSheetBlock",UC);class pC extends AO{constructor(I){super(I),this.reference=0,this.registerInput("value",DO.AutoDetect),this.registerOutput("output",DO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=I=>{switch(I){case DO.Float:return DO.FloatGradient;case DO.Vector2:return DO.Vector2Gradient;case DO.mC:return DO.Vector3Gradient;case DO.TS:return DO.Color4Gradient}return I},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(DO.Float|DO.Vector2|DO.mC|DO.TS)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=I=>null}serialize(){const I=super.serialize();return I.reference=this.reference,I}_deserialize(I){super._deserialize(I),this.reference=I.reference}}(0,u.e)([PO("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],pC.prototype,"reference",void 0),(0,S.e)("BABYLON.ParticleGradientValueBlock",pC);(0,S.e)("BABYLON.ParticleGradientBlock",class extends AO{constructor(I){super(I),this._entryCount=1,this.registerInput("gradient",DO.Float,!0,1,0,1),this.registerInput("value0",DO.AutoDetect),this.registerOutput("output",DO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=I=>{switch(I){case DO.FloatGradient:return DO.Float;case DO.Vector2Gradient:return DO.Vector2;case DO.Vector3Gradient:return DO.mC;case DO.Color4Gradient:return DO.TS}return I},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(DO.FloatGradient|DO.Vector2Gradient|DO.Vector3Gradient|DO.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(I){this._inputs[I].onConnectionObservable.add((()=>{this._entryCount>I||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),DO.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const I=[];for(let C=1;C<this._inputs.length;C++){var O;if(this._inputs[C].isConnected)I.push(null===(O=this._inputs[C].connectedPoint)||void 0===O?void 0:O.ownerBlock)}I.sort(((I,O)=>I.reference-O.reference)),this.output._storedFunction=O=>{const C=this.gradient.getConnectedValue(O);if(1===I.length)return I[0].value.getConnectedValue(O);let K=null;for(let i=I.length-1;i>=0;i--){const S=I[i];if(S.reference<=C){const I=S.value.getConnectedValue(O);if(K){const i=K.value.getConnectedValue(O),U=K.reference,N=S.reference,Q=Math.max(0,Math.min(1,(C-N)/(U-N)));switch(this.output.type){case DO.Float:return(0,p.Lerp)(I,i,Q);case DO.Vector2:return j.Vector2.Lerp(I,i,Q);case DO.mC:return j.mC.Lerp(I,i,Q);case DO.TS:return y.TS.Lerp(I,i,Q)}}return I}K=S}return 0}}});(0,S.e)("BABYLON.ParticleConverterBlock",class extends AO{constructor(I){super(I),this.registerInput("color ",DO.TS,!0),this.registerInput("xyz ",DO.mC,!0),this.registerInput("xy ",DO.Vector2,!0),this.registerInput("zw ",DO.Vector2,!0),this.registerInput("x ",DO.Float,!0),this.registerInput("y ",DO.Float,!0),this.registerInput("z ",DO.Float,!0),this.registerInput("w ",DO.Float,!0),this.registerOutput("color",DO.TS),this.registerOutput("xyz",DO.mC),this.registerOutput("xy",DO.Vector2),this.registerOutput("zw",DO.Vector2),this.registerOutput("x",DO.Float),this.registerOutput("y",DO.Float),this.registerOutput("z",DO.Float),this.registerOutput("w",DO.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(I){return"color "===I?"colorIn":"xyz "===I?"xyzIn":"xy "===I?"xyIn":"zw "===I?"zwIn":"x "===I?"xIn":"y "===I?"yIn":"z "===I?"zIn":"w "===I?"wIn":I}_outputRename(I){switch(I){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return I}}_build(I){super._build(I);const O=this.xIn,C=this.yIn,K=this.zIn,i=this.wIn,S=this.xyIn,U=this.zwIn,p=this.xyzIn,N=this.colorIn,Q=this.colorOut,s=this.xyzOut,Z=this.xyOut,q=this.zwOut,mI=this.xOut,E=this.yOut,h=this.zOut,r=this.wOut,W=I=>{if(N.isConnected)return N.getConnectedValue(I);let j=0,Q=0,s=0,Z=0;if(O.isConnected&&(j=O.getConnectedValue(I)),C.isConnected&&(Q=C.getConnectedValue(I)),K.isConnected&&(s=K.getConnectedValue(I)),i.isConnected&&(Z=i.getConnectedValue(I)),S.isConnected){const O=S.getConnectedValue(I);O&&(j=O.x,Q=O.y)}if(U.isConnected){const O=U.getConnectedValue(I);O&&(s=O.x,Z=O.y)}if(p.isConnected){const O=p.getConnectedValue(I);O&&(j=O.x,Q=O.y,s=O.z)}return new y.TS(j,Q,s,Z)};Q._storedFunction=I=>W(I),s._storedFunction=I=>{const O=W(I);return new j.mC(O.r,O.g,O.b)},Z._storedFunction=I=>{const O=W(I);return new j.Vector2(O.r,O.g)},q._storedFunction=I=>{const O=W(I);return new j.Vector2(O.b,O.a)},mI._storedFunction=I=>W(I).r,E._storedFunction=I=>W(I).g,h._storedFunction=I=>W(I).b,r._storedFunction=I=>W(I).a}}),function(I){I[I.Cos=0]="Cos",I[I.Sin=1]="Sin",I[I.Abs=2]="Abs",I[I.Exp=3]="Exp",I[I.Exp2=4]="Exp2",I[I.Round=5]="Round",I[I.Floor=6]="Floor",I[I.Ceiling=7]="Ceiling",I[I.Sqrt=8]="Sqrt",I[I.Log=9]="Log",I[I.Tan=10]="Tan",I[I.ArcTan=11]="ArcTan",I[I.ArcCos=12]="ArcCos",I[I.ArcSin=13]="ArcSin",I[I.Sign=14]="Sign",I[I.Negate=15]="Negate",I[I.OneMinus=16]="OneMinus",I[I.Reciprocal=17]="Reciprocal",I[I.ToDegrees=18]="ToDegrees",I[I.ToRadians=19]="ToRadians",I[I.Fract=20]="Fract"}(zO||(zO={}));class NC extends AO{constructor(I){super(I),this.operation=zO.Cos,this.registerInput("input",DO.AutoDetect),this.registerOutput("output",DO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(DO.Float|DO.Int|DO.Vector2|DO.mC|DO.TS)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){super._build(I);let O=null;switch(this.operation){case zO.Cos:O=I=>Math.cos(I);break;case zO.Sin:O=I=>Math.sin(I);break;case zO.Abs:O=I=>Math.abs(I);break;case zO.Exp:O=I=>Math.exp(I);break;case zO.Exp2:O=I=>Math.pow(2,I);break;case zO.Round:O=I=>Math.round(I);break;case zO.Floor:O=I=>Math.floor(I);break;case zO.Ceiling:O=I=>Math.ceil(I);break;case zO.Sqrt:O=I=>Math.sqrt(I);break;case zO.Log:O=I=>Math.log(I);break;case zO.Tan:O=I=>Math.tan(I);break;case zO.ArcTan:O=I=>Math.atan(I);break;case zO.ArcCos:O=I=>Math.acos(I);break;case zO.ArcSin:O=I=>Math.asin(I);break;case zO.Sign:O=I=>Math.sign(I);break;case zO.Negate:O=I=>-I;break;case zO.OneMinus:O=I=>1-I;break;case zO.Reciprocal:O=I=>1/I;break;case zO.ToRadians:O=I=>I*Math.PI/180;break;case zO.ToDegrees:O=I=>180*I/Math.PI;break;case zO.Fract:O=I=>I>=0?I-Math.floor(I):I-Math.ceil(I)}if(!O)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case DO.Int:case DO.Float:this.output._storedFunction=I=>{const C=this.input.getConnectedValue(I);return O(C)};break;case DO.Vector2:this.output._storedFunction=I=>{const C=this.input.getConnectedValue(I);return new j.Vector2(O(C.x),O(C.y))};break;case DO.mC:this.output._storedFunction=I=>{const C=this.input.getConnectedValue(I);return new j.mC(O(C.x),O(C.y),O(C.z))};break;case DO.TS:this.output._storedFunction=I=>{const C=this.input.getConnectedValue(I);return new y.TS(O(C.r),O(C.g),O(C.b),O(C.a))}}return this}serialize(){const I=super.serialize();return I.operation=this.operation,I}_deserialize(I){super._deserialize(I),this.operation=I.operation}}(0,u.e)([PO("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:zO.Cos},{label:"Sin",value:zO.Sin},{label:"Abs",value:zO.Abs},{label:"Exp",value:zO.Exp},{label:"Exp2",value:zO.Exp2},{label:"Round",value:zO.Round},{label:"Floor",value:zO.Floor},{label:"Ceiling",value:zO.Ceiling},{label:"Sqrt",value:zO.Sqrt},{label:"Log",value:zO.Log},{label:"Tan",value:zO.Tan},{label:"ArcTan",value:zO.ArcTan},{label:"ArcCos",value:zO.ArcCos},{label:"ArcSin",value:zO.ArcSin},{label:"Sign",value:zO.Sign},{label:"Negate",value:zO.Negate},{label:"OneMinus",value:zO.OneMinus},{label:"Reciprocal",value:zO.Reciprocal},{label:"ToDegrees",value:zO.ToDegrees},{label:"ToRadians",value:zO.ToRadians},{label:"Fract",value:zO.Fract}]})],NC.prototype,"operation",void 0),(0,S.e)("BABYLON.ParticleTrigonometryBlock",NC);var QC,sC=C(13552);class ZC extends AO{constructor(I){super(I),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",DO.AutoDetect),this.registerOutput("output",DO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(DO.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(DO.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(DO.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(DO.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(DO.System),this._inputs[0].excludedConnectionPointTypes.push(DO.Particle),this._inputs[0].excludedConnectionPointTypes.push(DO.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const O=I=>{const O=this.input.getConnectedValue(I);if(this.log.length>=this.stackSize)return O;if(null===O||void 0===O)return this.log.push(["null",""]),O;switch(this.input.type){case DO.Vector2:this.log.push([(0,sC.f)(O,4),O.toString()]);break;case DO.mC:this.log.push([(0,sC.j)(O,4),O.toString()]);break;case DO.TS:this.log.push([`{R: ${O.r.toFixed(4)} G: ${O.g.toFixed(4)} B: ${O.b.toFixed(4)} A: ${O.a.toFixed(4)}}`,O.toString()]);break;default:this.log.push([O.toString(),O.toString()])}return O};this.output.isConnected?this.output._storedFunction=O:this.output._storedValue=O(I)}serialize(){const I=super.serialize();return I.stackSize=this.stackSize,I}_deserialize(I){super._deserialize(I),this.stackSize=I.stackSize}}(0,u.e)([PO("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],ZC.prototype,"stackSize",void 0),(0,S.e)("BABYLON.ParticleDebugBlock",ZC);(0,S.e)("BABYLON.ParticleElbowBlock",class extends AO{constructor(I){super(I),this.registerInput("input",DO.AutoDetect),this.registerOutput("output",DO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){super._build(I);const O=this._outputs[0],C=this._inputs[0];O._storedFunction=I=>C.getConnectedValue(I)}});(0,S.e)("BABYLON.ParticleTeleportInBlock",class extends AO{get endpoints(){return this._endpoints}constructor(I){super(I),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",DO.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(I){if(this.getClassName()===I)return!0;for(const O of this.endpoints)if(O.isAnAncestorOfType(I))return!0;return!1}isAnAncestorOf(I){for(const O of this.endpoints){if(O===I)return!0;if(O.isAnAncestorOf(I))return!0}return!1}attachToEndpoint(I){I.detach(),this._endpoints.push(I),I._entryPoint=this,I._outputs[0]._typeConnectionSource=this._inputs[0],I._tempEntryPointUniqueId=null,I.name="> "+this.name}detachFromEndpoint(I){const O=this._endpoints.indexOf(I);-1!==O&&(this._endpoints.splice(O,1),I._outputs[0]._typeConnectionSource=null,I._entryPoint=null)}_build(){for(const I of this._endpoints)I.output._storedFunction=I=>this.input.getConnectedValue(I)}});(0,S.e)("BABYLON.ParticleTeleportOutBlock",class extends AO{constructor(I){super(I),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",DO.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(I){this.entryPoint&&this.entryPoint.build(I)}clone(){const I=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(I),I}serialize(){var I;const O=super.serialize();return O.entryPoint=(null===(I=this.entryPoint)||void 0===I?void 0:I.uniqueId)??"",O}_deserialize(I){super._deserialize(I),this._tempEntryPointUniqueId=I.entryPoint}}),function(I){I[I.Equal=0]="Equal",I[I.NotEqual=1]="NotEqual",I[I.LessThan=2]="LessThan",I[I.GreaterThan=3]="GreaterThan",I[I.LessOrEqual=4]="LessOrEqual",I[I.GreaterOrEqual=5]="GreaterOrEqual",I[I.Xor=6]="Xor",I[I.Or=7]="Or",I[I.And=8]="And"}(QC||(QC={}));class qC extends AO{constructor(I){super(I),this.test=QC.Equal,this.epsilon=0,this.registerInput("left",DO.Float),this.registerInput("right",DO.Float,!0,0),this.registerInput("ifTrue",DO.AutoDetect,!0,1),this.registerInput("ifFalse",DO.AutoDetect,!0,0),this.registerOutput("output",DO.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=DO.Float,this._inputs[0].acceptedConnectionPointTypes.push(DO.Int),this._inputs[1].acceptedConnectionPointTypes.push(DO.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const I=I=>{const O=this.left.getConnectedValue(I),C=this.right.getConnectedValue(I);let j=!1;switch(this.test){case QC.Equal:j=(0,p.WithinEpsilon)(O,C,this.epsilon);break;case QC.NotEqual:j=!(0,p.WithinEpsilon)(O,C,this.epsilon);break;case QC.LessThan:j=O<C+this.epsilon;break;case QC.GreaterThan:j=O>C-this.epsilon;break;case QC.LessOrEqual:j=O<=C+this.epsilon;break;case QC.GreaterOrEqual:j=O>=C-this.epsilon;break;case QC.Xor:j=!!O&&!C||!O&&!!C;break;case QC.Or:j=!!O||!!C;break;case QC.And:j=!!O&&!!C}return j};this.output._storedFunction=O=>I(O)?this.ifTrue.getConnectedValue(O):this.ifFalse.getConnectedValue(O)}serialize(){const I=super.serialize();return I.test=this.test,I.epsilon=this.epsilon,I}_deserialize(I){super._deserialize(I),this.test=I.test,void 0!==I.epsilon&&(this.epsilon=I.epsilon)}}(0,u.e)([PO("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:QC.Equal},{label:"NotEqual",value:QC.NotEqual},{label:"LessThan",value:QC.LessThan},{label:"GreaterThan",value:QC.GreaterThan},{label:"LessOrEqual",value:QC.LessOrEqual},{label:"GreaterOrEqual",value:QC.GreaterOrEqual},{label:"Xor",value:QC.Xor},{label:"Or",value:QC.Or},{label:"And",value:QC.And}]})],qC.prototype,"test",void 0),(0,u.e)([PO("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],qC.prototype,"epsilon",void 0),(0,S.e)("BABYLON.ParticleConditionBlock",qC);class mj extends AO{constructor(I){super(I),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",DO.Particle),this.registerInput("condition",DO.Float,!0,0),this.registerInput("system",DO.System),this.registerOutput("output",DO.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(I){this._triggerCount=0;const O=this.input.getConnectedValue(I),C={process:C=>{if(I.particleContext=C,I.systemContext=O,0!==this.condition.getConnectedValue(I)&&(0===this.limit||this._triggerCount<this.limit)){const j=(new Date).getTime();if(this._previousOne&&j-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=j;const K=this.system.getConnectedValue(I);if(K){const j=BO(K,I.hO,C.position);j.yS.addOnce((()=>{this._triggerCount--})),O.yS.addOnce((()=>{j.dispose()}))}}},previousItem:null,nextItem:null};O._updateQueueStart?VI(C,O._updateQueueStart):O._updateQueueStart=C,this.output._storedValue=O}serialize(){const I=super.serialize();return I.limit=this.limit,I.delay=this.delay,I}_deserialize(I){super._deserialize(I),void 0!==I.limit&&(this.limit=I.limit),void 0!==I.delay&&(this.delay=I.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,u.e)([PO("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mj.prototype,"limit",void 0),(0,u.e)([PO("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mj.prototype,"delay",void 0),(0,S.e)("BABYLON.ParticleTriggerBlock",mj);C(13555),C(13567),C(13583),C(13630)},13611:(I,O,C)=>{"use strict";var j=C(12179);const K="clipPlaneFragment",i="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13586:(I,O,C)=>{"use strict";var j=C(12179);const K="clipPlaneFragmentDeclaration",i="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13652:(I,O,C)=>{"use strict";var j=C(12179);const K="clipPlaneVertex",i="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13639:(I,O,C)=>{"use strict";var j=C(12179);const K="clipPlaneVertexDeclaration",i="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13626:(I,O,C)=>{"use strict";var j=C(12179);const K="fogFragment",i="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13607:(I,O,C)=>{"use strict";var j=C(12179);const K="fogFragmentDeclaration",i="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13657:(I,O,C)=>{"use strict";var j=C(12179);const K="fogVertex",i="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13644:(I,O,C)=>{"use strict";var j=C(12179);const K="fogVertexDeclaration",i="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13599:(I,O,C)=>{"use strict";var j=C(12179);const K="helperFunctions",i="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13590:(I,O,C)=>{"use strict";var j=C(12179);const K="imageProcessingDeclaration",i="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13602:(I,O,C)=>{"use strict";var j=C(12179);const K="imageProcessingFunctions",i="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13593:(I,O,C)=>{"use strict";var j=C(12179);const K="logDepthDeclaration",i="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13617:(I,O,C)=>{"use strict";var j=C(12179);const K="logDepthFragment",i="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13660:(I,O,C)=>{"use strict";var j=C(12179);const K="logDepthVertex",i="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";j.b.IncludesShadersStoreWGSL[K]||(j.b.IncludesShadersStoreWGSL[K]=i)},13583:(I,O,C)=>{"use strict";C.r(O),C.d(O,{particlesPixelShaderWGSL:()=>y});var j=C(12179);C(13586),C(13590),C(13593),C(13599),C(13602),C(13607),C(13611),C(13617),C(13626);const K="particlesPixelShader",i="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";j.b.ShadersStoreWGSL[K]||(j.b.ShadersStoreWGSL[K]=i);const y={name:K,shader:i}},13630:(I,O,C)=>{"use strict";C.r(O),C.d(O,{particlesVertexShaderWGSL:()=>y});var j=C(12179);C(13639),C(13644),C(13593),C(13652),C(13657),C(13660);const K="particlesVertexShader",i="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";j.b.ShadersStoreWGSL[K]||(j.b.ShadersStoreWGSL[K]=i);const y={name:K,shader:i}},13490:(I,O,C)=>{"use strict";var j=C(12179);const K="clipPlaneFragment",i="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13563:(I,O,C)=>{"use strict";var j=C(12179);const K="clipPlaneFragmentDeclaration",i="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13511:(I,O,C)=>{"use strict";var j=C(12179);const K="clipPlaneVertex",i="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13576:(I,O,C)=>{"use strict";var j=C(12179);const K="clipPlaneVertexDeclaration",i="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13500:(I,O,C)=>{"use strict";var j=C(12179);const K="fogFragment",i="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13485:(I,O,C)=>{"use strict";var j=C(12179);const K="fogFragmentDeclaration",i="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13516:(I,O,C)=>{"use strict";var j=C(12179);const K="fogVertex",i="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13502:(I,O,C)=>{"use strict";var j=C(12179);const K="fogVertexDeclaration",i="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13474:(I,O,C)=>{"use strict";var j=C(12179);const K="helperFunctions",i="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13462:(I,O,C)=>{"use strict";var j=C(12179);const K="imageProcessingDeclaration",i="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13479:(I,O,C)=>{"use strict";var j=C(12179);const K="imageProcessingFunctions",i="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13466:(I,O,C)=>{"use strict";var j=C(12179);const K="logDepthDeclaration",i="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13498:(I,O,C)=>{"use strict";var j=C(12179);const K="logDepthFragment",i="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13520:(I,O,C)=>{"use strict";var j=C(12179);const K="logDepthVertex",i="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";j.b.IncludesShadersStore[K]||(j.b.IncludesShadersStore[K]=i)},13555:(I,O,C)=>{"use strict";C.r(O),C.d(O,{particlesPixelShader:()=>y});var j=C(12179);C(13563),C(13462),C(13466),C(13474),C(13479),C(13485),C(13490),C(13498),C(13500);const K="particlesPixelShader",i="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";j.b.ShadersStore[K]||(j.b.ShadersStore[K]=i);const y={name:K,shader:i}},13567:(I,O,C)=>{"use strict";C.r(O),C.d(O,{particlesVertexShader:()=>y});var j=C(12179);C(13576),C(13502),C(13466),C(13511),C(13516),C(13520);const K="particlesVertexShader",i="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";j.b.ShadersStore[K]||(j.b.ShadersStore[K]=i);const y={name:K,shader:i}},13950:(I,O,C)=>{"use strict";C.r(O),C.d(O,{FlowGraphGLTFDataProvider:()=>i});var j=C(13906),K=C(13886);class i extends j.d{constructor(I){var O,C;super();const j=I.glTF,i=(null===(O=j.animations)||void 0===O?void 0:O.map((I=>I._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",K.d,i);const y=(null===(C=j.nodes)||void 0===C?void 0:C.map((I=>I._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",K.d,y)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13819:(I,O,C)=>{"use strict";C.d(O,{d:()=>E,f:()=>q,g:()=>Z,h:()=>mI});var j=C(12272),K=C(12708),i=C(12307),y=C(13821);const S=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class U{constructor(I,O){this._gltf=I,this._infoTree=O}convert(I){let O,C=this._gltf,j=this._infoTree;if(!I.startsWith("/"))throw new Error("Path must start with a /");const K=I.split("/");if(K.shift(),K[K.length-1].includes(".length")){const I=K[K.length-1].split(".");K.pop(),K.push(...I)}let i=!1;for(const U of K){const K="length"===U;if(K&&!j.__array__)throw new Error(`Path ${I} is invalid`);if(j.__ignoreObjectTree__&&(i=!0),j.__array__&&!K)j=j.__array__;else if(j=j[U],!j)throw new Error(`Path ${I} is invalid`);if(!i)if(void 0===C){if(!S.find((O=>O.regex.test(I))))throw new Error(`Path ${I} is invalid`)}else if(!K){var y;C=null===(y=C)||void 0===y?void 0:y[U]}(j.__target__||K)&&(O=C)}return{object:O,info:j}}}function p(I,O,C,j){const K=N(I,O);return j?K[C][j]:K[C]}function N(I,O,C){var j,i;return null===(j=I._data)||void 0===j||null===(i=j[(null===C||void 0===C?void 0:C.fillMode)??K.e.MATERIAL_TriangleFillMode])||void 0===i?void 0:i.babylonMaterial}function Q(I,O){return{offset:{componentsCount:2,type:"Vector2",get:(C,K,i)=>{const y=p(C,i,I,O);return new j.Vector2(null===y||void 0===y?void 0:y.uOffset,null===y||void 0===y?void 0:y.vOffset)},getTarget:N,set:(C,j,K,i)=>{const y=p(j,i,I,O);y.uOffset=C.x,y.vOffset=C.y},getPropertyName:[()=>`${I}${O?"."+O:""}.uOffset`,()=>`${I}${O?"."+O:""}.vOffset`]},rotation:{type:"number",get:(C,j,K)=>{var i;return null===(i=p(C,K,I,O))||void 0===i?void 0:i.wAng},getTarget:N,set:(C,j,K,i)=>p(j,i,I,O).wAng=C,getPropertyName:[()=>`${I}${O?"."+O:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(C,K,i)=>{const y=p(C,i,I,O);return new j.Vector2(null===y||void 0===y?void 0:y.uScale,null===y||void 0===y?void 0:y.vScale)},getTarget:N,set:(C,j,K,i)=>{const y=p(j,i,I,O);y.uScale=C.x,y.vScale=C.y},getPropertyName:[()=>`${I}${O?"."+O:""}.uScale`,()=>`${I}${O?"."+O:""}.vScale`]}}}const s={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:I=>{var O,C;return new j.Vector2((null===(O=I._babylonCamera)||void 0===O?void 0:O.orthoLeft)??0,(null===(C=I._babylonCamera)||void 0===C?void 0:C.orthoRight)??0)},set:(I,O)=>{O._babylonCamera&&(O._babylonCamera.orthoLeft=I.x,O._babylonCamera.orthoRight=I.y)},getTarget:I=>I,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:I=>{var O,C;return new j.Vector2((null===(O=I._babylonCamera)||void 0===O?void 0:O.orthoBottom)??0,(null===(C=I._babylonCamera)||void 0===C?void 0:C.orthoTop)??0)},set:(I,O)=>{O._babylonCamera&&(O._babylonCamera.orthoBottom=I.x,O._babylonCamera.orthoTop=I.y)},getTarget:I=>I,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:I=>{var O;return null===(O=I._babylonCamera)||void 0===O?void 0:O.maxZ},set:(I,O)=>{O._babylonCamera&&(O._babylonCamera.maxZ=I)},getTarget:I=>I,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:I=>{var O;return null===(O=I._babylonCamera)||void 0===O?void 0:O.ES},set:(I,O)=>{O._babylonCamera&&(O._babylonCamera.ES=I)},getTarget:I=>I,getPropertyName:[()=>"ES"]}},perspective:{aspectRatio:{type:"number",get:I=>{var O;return null===(O=I._babylonCamera)||void 0===O?void 0:O.getEngine().getAspectRatio(I._babylonCamera)},getTarget:I=>I,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:I=>{var O;return null===(O=I._babylonCamera)||void 0===O?void 0:O.fov},set:(I,O)=>{O._babylonCamera&&(O._babylonCamera.fov=I)},getTarget:I=>I,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:I=>{var O;return null===(O=I._babylonCamera)||void 0===O?void 0:O.maxZ},set:(I,O)=>{O._babylonCamera&&(O._babylonCamera.maxZ=I)},getTarget:I=>I,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:I=>{var O;return null===(O=I._babylonCamera)||void 0===O?void 0:O.ES},set:(I,O)=>{O._babylonCamera&&(O._babylonCamera.ES=I)},getTarget:I=>I,getPropertyName:[()=>"ES"]}}}},nodes:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"mC",get:I=>{var O;return null===(O=I._babylonTransformNode)||void 0===O?void 0:O.position},set:(I,O)=>{var C;return null===(C=O._babylonTransformNode)||void 0===C?void 0:C.position.K(I)},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:I=>{var O;return null===(O=I._babylonTransformNode)||void 0===O?void 0:O.rotationQuaternion},set:(I,O)=>{var C,j;return null===(C=O._babylonTransformNode)||void 0===C||null===(j=C.rotationQuaternion)||void 0===j?void 0:j.K(I)},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"mC",get:I=>{var O;return null===(O=I._babylonTransformNode)||void 0===O?void 0:O.nS},set:(I,O)=>{var C;return null===(C=O._babylonTransformNode)||void 0===C?void 0:C.nS.K(I)},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"nS"]},weights:{length:{type:"number",get:I=>I._numMorphTargets,getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(I,O)=>{var C,j;return void 0!==O?null===(C=I._primitiveBabylonMeshes)||void 0===C||null===(j=C[0].morphTargetManager)||void 0===j?void 0:j.getTarget(O).influence:void 0},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(I,O)=>[0],getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:I=>{var O,C,K;return j.Matrix.Compose(null===(O=I._babylonTransformNode)||void 0===O?void 0:O.nS,null===(C=I._babylonTransformNode)||void 0===C?void 0:C.rotationQuaternion,null===(K=I._babylonTransformNode)||void 0===K?void 0:K.position)},getTarget:I=>I._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:I=>{var O,C,K,i;const y=j.Matrix.Identity();let S=I.parent;for(;S&&S.parent;)S=S.parent;const U=(null===(O=I._babylonTransformNode)||void 0===O?void 0:O.position._isDirty)||(null===(C=I._babylonTransformNode)||void 0===C||null===(K=C.rotationQuaternion)||void 0===K?void 0:K._isDirty)||(null===(i=I._babylonTransformNode)||void 0===i?void 0:i.nS._isDirty);if(S){var p;const O=null===(p=S._babylonTransformNode)||void 0===p?void 0:p.rS(!0).invert();var N,Q;if(O)null===(N=I._babylonTransformNode)||void 0===N||null===(Q=N.rS(U))||void 0===Q||Q.multiplyToRef(O,y)}else I._babylonTransformNode&&y.K(I._babylonTransformNode.rS(U));return y},getTarget:I=>I._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:I=>{var O,C;return null===(O=I._babylonTransformNode)||void 0===O||null===(C=O.getChildren((I=>I instanceof y.b),!0)[0])||void 0===C?void 0:C.aS},getTarget:I=>{var O;return null===(O=I._babylonTransformNode)||void 0===O?void 0:O.getChildren((I=>I instanceof y.b),!0)[0]},set:(I,O)=>{if(O._babylonTransformNode){const C=O._babylonTransformNode.getChildren((I=>I instanceof y.b),!0)[0];C&&(C.aS=I)}}},color:{type:"WO",get:I=>{var O,C;return null===(O=I._babylonTransformNode)||void 0===O||null===(C=O.getChildren((I=>I instanceof y.b),!0)[0])||void 0===C?void 0:C.MS},getTarget:I=>{var O;return null===(O=I._babylonTransformNode)||void 0===O?void 0:O.getChildren((I=>I instanceof y.b),!0)[0]},set:(I,O)=>{if(O._babylonTransformNode){const C=O._babylonTransformNode.getChildren((I=>I instanceof y.b),!0)[0];C&&(C.MS=I)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"WO",get:(I,O,C)=>N(I,O,C).emissiveColor,set:(I,O,C,j)=>N(O,C,j).emissiveColor.K(I),getTarget:(I,O,C)=>N(I,O,C),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:Q("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(I,O,C)=>{var j;return null===(j=p(I,C,"bumpTexture"))||void 0===j?void 0:j.level},set:(I,O,C,j)=>{const K=p(O,j,"bumpTexture");K&&(K.level=I)},getTarget:(I,O,C)=>N(I,O,C),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:Q("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(I,O,C)=>N(I,O,C).ambientTextureStrength,set:(I,O,C,j)=>{const K=N(O,C,j);K&&(K.ambientTextureStrength=I)},getTarget:(I,O,C)=>N(I,O,C),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:Q("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"TS",get:(I,O,C)=>{const j=N(I,O,C);return i.TS.FromColor3(j.albedoColor,j.alpha)},set:(I,O,C,j)=>{const K=N(O,C,j);K.albedoColor.set(I.r,I.g,I.b),K.alpha=I.a},getTarget:(I,O,C)=>N(I,O,C),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:Q("albedoTexture")}},metallicFactor:{type:"number",get:(I,O,C)=>N(I,O,C).metallic,set:(I,O,C,j)=>{const K=N(O,C,j);K&&(K.metallic=I)},getTarget:(I,O,C)=>N(I,O,C),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(I,O,C)=>N(I,O,C).roughness,set:(I,O,C,j)=>{const K=N(O,C,j);K&&(K.roughness=I)},getTarget:(I,O,C)=>N(I,O,C),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Q("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(I,O,C)=>N(I,O,C).anisotropy.aS,set:(I,O,C,j)=>{N(O,C,j).anisotropy.aS=I},getTarget:(I,O,C)=>N(I,O,C),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(I,O,C)=>N(I,O,C).anisotropy.angle,set:(I,O,C,j)=>{N(O,C,j).anisotropy.angle=I},getTarget:(I,O,C)=>N(I,O,C),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:Q("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(I,O,C)=>N(I,O,C).clearCoat.aS,set:(I,O,C,j)=>{N(O,C,j).clearCoat.aS=I},getTarget:(I,O,C)=>N(I,O,C),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(I,O,C)=>N(I,O,C).clearCoat.roughness,set:(I,O,C,j)=>{N(O,C,j).clearCoat.roughness=I},getTarget:(I,O,C)=>N(I,O,C),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:Q("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(I,O,C)=>{var j;return null===(j=N(I,O,C).clearCoat.bumpTexture)||void 0===j?void 0:j.level},getTarget:N,set:(I,O,C,j)=>N(O,C,j).clearCoat.bumpTexture.level=I},extensions:{KHR_texture_transform:Q("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Q("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(I,O,C)=>N(I,O,C).subSurface.dispersion,getTarget:N,set:(I,O,C,j)=>N(O,C,j).subSurface.dispersion=I}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(I,O,C)=>N(I,O,C).emissiveIntensity,getTarget:N,set:(I,O,C,j)=>N(O,C,j).emissiveIntensity=I}},KHR_materials_ior:{ior:{type:"number",get:(I,O,C)=>N(I,O,C).indexOfRefraction,getTarget:N,set:(I,O,C,j)=>N(O,C,j).indexOfRefraction=I}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(I,O,C)=>N(I,O,C).iridescence.aS,getTarget:N,set:(I,O,C,j)=>N(O,C,j).iridescence.aS=I},iridescenceIor:{type:"number",get:(I,O,C)=>N(I,O,C).iridescence.indexOfRefraction,getTarget:N,set:(I,O,C,j)=>N(O,C,j).iridescence.indexOfRefraction=I},iridescenceTexture:{extensions:{KHR_texture_transform:Q("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(I,O,C)=>N(I,O,C).iridescence.maximumThickness,getTarget:N,set:(I,O,C,j)=>N(O,C,j).iridescence.maximumThickness=I},iridescenceThicknessMinimum:{type:"number",get:(I,O,C)=>N(I,O,C).iridescence.minimumThickness,getTarget:N,set:(I,O,C,j)=>N(O,C,j).iridescence.minimumThickness=I},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Q("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"WO",get:(I,O,C)=>N(I,O,C).sheen.color,getTarget:N,set:(I,O,C,j)=>N(O,C,j).sheen.color.K(I)},sheenColorTexture:{extensions:{KHR_texture_transform:Q("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(I,O,C)=>N(I,O,C).sheen.aS,getTarget:N,set:(I,O,C,j)=>N(O,C,j).sheen.aS=I},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Q("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(I,O,C)=>N(I,O,C).metallicF0Factor,getTarget:N,set:(I,O,C,j)=>N(O,C,j).metallicF0Factor=I,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"WO",get:(I,O,C)=>N(I,O,C).metallicReflectanceColor,getTarget:N,set:(I,O,C,j)=>N(O,C,j).metallicReflectanceColor.K(I),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:Q("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Q("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(I,O,C)=>N(I,O,C).subSurface.refractionIntensity,getTarget:N,set:(I,O,C,j)=>N(O,C,j).subSurface.refractionIntensity=I,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:Q("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(I,O,C)=>N(I,O,C).subSurface.translucencyIntensity,getTarget:N,set:(I,O,C,j)=>N(O,C,j).subSurface.translucencyIntensity=I},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Q("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"WO",get:(I,O,C)=>N(I,O,C).subSurface.translucencyColor,getTarget:N,set:(I,O,C,j)=>{var K;return I&&(null===(K=N(O,C,j).subSurface.translucencyColor)||void 0===K?void 0:K.K(I))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Q("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"WO",get:(I,O,C)=>N(I,O,C).subSurface.tintColor,getTarget:N,set:(I,O,C,j)=>N(O,C,j).subSurface.tintColor.K(I)},attenuationDistance:{type:"number",get:(I,O,C)=>N(I,O,C).subSurface.tintColorAtDistance,getTarget:N,set:(I,O,C,j)=>N(O,C,j).subSurface.tintColorAtDistance=I},thicknessFactor:{type:"number",get:(I,O,C)=>N(I,O,C).subSurface.maximumThickness,getTarget:N,set:(I,O,C,j)=>N(O,C,j).subSurface.maximumThickness=I},thicknessTexture:{extensions:{KHR_texture_transform:Q("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonLight)),getPropertyName:[I=>"length"]},__array__:{__target__:!0,color:{type:"WO",get:I=>{var O;return null===(O=I._babylonLight)||void 0===O?void 0:O.MS},set:(I,O)=>{var C;return null===(C=O._babylonLight)||void 0===C?void 0:C.MS.K(I)},getTarget:I=>I._babylonLight,getPropertyName:[I=>"diffuse"]},aS:{type:"number",get:I=>{var O;return null===(O=I._babylonLight)||void 0===O?void 0:O.aS},set:(I,O)=>O._babylonLight?O._babylonLight.aS=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"intensity"]},range:{type:"number",get:I=>{var O;return null===(O=I._babylonLight)||void 0===O?void 0:O.range},set:(I,O)=>O._babylonLight?O._babylonLight.range=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"range"]},spot:{innerConeAngle:{type:"number",get:I=>{var O;return null===(O=I._babylonLight)||void 0===O?void 0:O.innerAngle},set:(I,O)=>O._babylonLight?O._babylonLight.innerAngle=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"innerConeAngle"]},outerConeAngle:{type:"number",get:I=>{var O;return null===(O=I._babylonLight)||void 0===O?void 0:O.angle},set:(I,O)=>O._babylonLight?O._babylonLight.angle=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonLight)),getPropertyName:[I=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonTexture)),getPropertyName:[I=>"length"]},__array__:{__target__:!0,aS:{type:"number",get:I=>{var O;return null===(O=I._babylonTexture)||void 0===O?void 0:O.level},set:(I,O)=>{O._babylonTexture&&(O._babylonTexture.level=I)},getTarget:I=>I._babylonTexture},rotation:{type:"Quaternion",get:I=>{var O;return I._babylonTexture&&j.Quaternion.FromRotationMatrix(null===(O=I._babylonTexture)||void 0===O?void 0:O.getReflectionTextureMatrix())},set:(I,O)=>{var C;O._babylonTexture&&(null!==(C=O._babylonTexture.nI())&&void 0!==C&&C.useRightHandedSystem||(I=j.Quaternion.Inverse(I)),j.Matrix.FromQuaternionToRef(I,O._babylonTexture.getReflectionTextureMatrix()))},getTarget:I=>I._babylonTexture}}}}},animations:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>{var O;return null===(O=I.primitives[0]._instanceData)||void 0===O?void 0:O.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function Z(I){return new U(I,s)}function q(I){const O=I.split("/").map((I=>I.replace(/{}/g,"__array__")));let C=s;for(const j of O)j&&(C=C[j]);if(C&&C.type&&C.get)return C}function mI(I,O){const C=I.split("/").map((I=>I.replace(/{}/g,"__array__")));let j=s;for(const K of C)K&&(j=j[K]);j&&j.type&&j.get&&(j.interpolation=O)}function E(I,O){const C=I.split("/").map((I=>I.replace(/{}/g,"__array__")));let j=s;for(const K of C)if(K){if(!j[K]){if("?"===K){j.__ignoreObjectTree__=!0;continue}j[K]={},"__array__"===K&&(j[K].__target__=!0)}j=j[K]}Object.assign(j,O)}},13827:(I,O,C)=>{"use strict";C.r(O),C.d(O,{AnimationPropertyInfo:()=>p,TransformNodeAnimationPropertyInfo:()=>N,WeightAnimationPropertyInfo:()=>Q,getQuaternion:()=>S,getVector3:()=>y,getWeights:()=>U});var j=C(12759),K=C(12272),i=C(13819);function y(I,O,C,j){return K.mC.YO(O,C).scaleInPlace(j)}function S(I,O,C,j){return K.Quaternion.YO(O,C).scaleInPlace(j)}function U(I,O,C,j){const K=new Array(I._numMorphTargets);for(let i=0;i<K.length;i++)K[i]=O[C++]*j;return K}class p{constructor(I,O,C,j){this.type=I,this.name=O,this.getValue=C,this.getStride=j}_buildAnimation(I,O,C){const K=new j.d(I,this.name,O,this.type);return K.setKeys(C),K}}class N extends p{buildAnimations(I,O,C,j){const K=[];return K.push({babylonAnimatable:I._babylonTransformNode,babylonAnimation:this._buildAnimation(O,C,j)}),K}}class Q extends p{buildAnimations(I,O,C,K){const i=[];if(I._numMorphTargets)for(let y=0;y<I._numMorphTargets;y++){const S=new j.d(`${O}_${y}`,this.name,C,this.type);if(S.setKeys(K.map((I=>({frame:I.frame,inTangent:I.inTangent?I.inTangent[y]:void 0,value:I.value[y],outTangent:I.outTangent?I.outTangent[y]:void 0,interpolation:I.interpolation})))),I._primitiveBabylonMeshes)for(const O of I._primitiveBabylonMeshes)if(O.morphTargetManager){const I=O.morphTargetManager.getTarget(y),C=S.clone();I.animations.push(C),i.push({babylonAnimatable:I,babylonAnimation:C})}}return i}}(0,i.h)("/nodes/{}/translation",[new N(j.d.ANIMATIONTYPE_VECTOR3,"position",y,(()=>3))]),(0,i.h)("/nodes/{}/rotation",[new N(j.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",S,(()=>4))]),(0,i.h)("/nodes/{}/scale",[new N(j.d.ANIMATIONTYPE_VECTOR3,"nS",y,(()=>3))]),(0,i.h)("/nodes/{}/weights",[new Q(j.d.ANIMATIONTYPE_FLOAT,"influence",U,(I=>I._numMorphTargets))])},13788:(I,O,C)=>{"use strict";class j{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((I,O)=>{this._resolve=I,this._reject=O}))}}var K=C(12272),i=C(12307),y=C(12083),S=C(12677),U=C(13793),p=C(13806),N=C(12088),Q=C(12703),s=C(12759),Z=C(12762),q=C(12132),mI=C(12103),E=C(12112);class h{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(I){this._useTextureToStoreBoneMatrices=I,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(I){this._animationPropertiesOverride=I}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(I,O,C){this.name=I,this.id=O,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=K.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new N.c,this.bones=[],this._scene=C||q.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const j=this._scene.getEngine().getCaps();this._canUseTextureForBones=j.textureFloat&&j.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((I=>!I.getParent()))}getTransformMatrices(I){if(this.needInitialSkinMatrix){if(!I)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return I._bonesTransformMatrices||this.prepare(!0),I._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(I){return this.needInitialSkinMatrix&&I._transformMatrixTexture?I._transformMatrixTexture:this._transformMatrixTexture}nI(){return this._scene}toString(I){let O=`Name: ${this.name}, nBones: ${this.bones.length}`;if(O+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,I){O+=", Ranges: {";let I=!0;for(const C in this._ranges)I&&(O+=", ",I=!1),O+=C;O+="}"}return O}getBoneIndexByName(I){for(let O=0,C=this.bones.length;O<C;O++)if(this.bones[O].name===I)return O;return-1}createAnimationRange(I,O,C){if(!this._ranges[I]){this._ranges[I]=new Z.c(I,O,C);for(let j=0,K=this.bones.length;j<K;j++)this.bones[j].animations[0]&&this.bones[j].animations[0].createRange(I,O,C)}}deleteAnimationRange(I){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let C=0,j=this.bones.length;C<j;C++)this.bones[C].animations[0]&&this.bones[C].animations[0].deleteRange(I,O);this._ranges[I]=null}getAnimationRange(I){return this._ranges[I]||null}getAnimationRanges(){const I=[];let O;for(O in this._ranges)I.push(this._ranges[O]);return I}copyAnimationRange(I,O){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[O]||!I.getAnimationRange(O))return!1;let j=!0;const K=this._getHighestAnimationFrame()+1,i={},y=I.bones;let S,U;for(U=0,S=y.length;U<S;U++)i[y[U].name]=y[U];this.bones.length!==y.length&&(mI.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${y.length}`),j=!1);const p=C&&this.dimensionsAtRest&&I.dimensionsAtRest?this.dimensionsAtRest.divide(I.dimensionsAtRest):null;for(U=0,S=this.bones.length;U<S;U++){const I=this.bones[U].name,y=i[I];y?j=j&&this.bones[U].copyAnimationRange(y,O,K,C,p):(mI.c.Warn("copyAnimationRange: not same rig, missing source bone "+I),j=!1)}const N=I.getAnimationRange(O);return N&&(this._ranges[O]=new Z.c(O,N.from+K,N.to+K)),j}returnToRest(){for(const I of this.bones)-1!==I._index&&I.returnToRest()}_getHighestAnimationFrame(){let I=0;for(let O=0,C=this.bones.length;O<C;O++)if(this.bones[O].animations[0]){const C=this.bones[O].animations[0].getHighestFrame();I<C&&(I=C)}return I}beginAnimation(I,O,C,j){const K=this.getAnimationRange(I);return K?this._scene.beginAnimation(this,K.from,K.to,O,C,j):null}static MakeAnimationAdditive(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const j=I.getAnimationRange(C);if(!j)return null;const K=I._scene.getAllAnimatablesByTarget(I);let i=null;for(let S=0;S<K.length;S++){const I=K[S];if(I.fromFrame===(null===j||void 0===j?void 0:j.from)&&I.toFrame===(null===j||void 0===j?void 0:j.to)){i=I;break}}const y=I.getAnimatables();for(let S=0;S<y.length;S++){const I=y[S].animations;if(I)for(let j=0;j<I.length;j++)s.d.MakeAnimationAdditive(I[j],O,C)}return i&&(i.isAdditive=!0),I}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(I){this._meshesWithPoseMatrix.push(I)}_unregisterMeshWithPoseMatrix(I){const O=this._meshesWithPoseMatrix.indexOf(I);O>-1&&this._meshesWithPoseMatrix.splice(O,1)}_computeTransformMatrices(I,O){this.onBeforeComputeObservable.notifyObservers(this);for(let C=0;C<this.bones.length;C++){const j=this.bones[C];j._childUpdateId++;const K=j.getParent();if(K?j.getLocalMatrix().multiplyToRef(K.getFinalMatrix(),j.getFinalMatrix()):O?j.getLocalMatrix().multiplyToRef(O,j.getFinalMatrix()):j.getFinalMatrix().K(j.getLocalMatrix()),-1!==j._index){const O=null===j._index?C:j._index;j.getAbsoluteInverseBindMatrix().multiplyToArray(j.getFinalMatrix(),I,16*O)}}this._identity.copyToArray(I,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const I=this.nI().getRenderId();if(this._currentRenderId===I)return;this._currentRenderId=I}if(this._numBonesWithLinkedTransformNode>0)for(const I of this.bones)if(I._linkedTransformNode){const O=I._linkedTransformNode;I.position=O.position,O.rotationQuaternion?I.rotationQuaternion=O.rotationQuaternion:I.rotation=O.rotation,I.nS=O.nS}if(this.needInitialSkinMatrix)for(const I of this._meshesWithPoseMatrix){const O=I.getPoseMatrix();let C=this._isDirty;if(I._bonesTransformMatrices&&I._bonesTransformMatrices.length===16*(this.bones.length+1)||(I._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),C=!0),C){if(this._synchronizedWithMesh!==I){this._synchronizedWithMesh=I;for(const I of this.bones)if(!I.getParent()){I.getBindMatrix().multiplyToRef(O,K.TmpVectors.Matrix[1]),I._updateAbsoluteBindMatrices(K.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const O=4*(this.bones.length+1);I._transformMatrixTexture&&I._transformMatrixTexture.getSize().width===O||(I._transformMatrixTexture&&I._transformMatrixTexture.dispose(),I._transformMatrixTexture=Q.d.CreateRGBATexture(I._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(I._bonesTransformMatrices,O),this.isUsingTextureForMatrices&&I._transformMatrixTexture&&I._transformMatrixTexture.update(I._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=Q.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let I=0;I<this.bones.length;I++)this._animatables.push(this.bones[I])}return this._animatables}clone(I,O){const C=new h(I,O||I,this._scene);C.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let j=0;j<this.bones.length;j++){const I=this.bones[j];let O=null;const K=I.getParent();if(K){const I=this.bones.indexOf(K);O=C.bones[I]}const i=new p.b(I.name,C,O,I.getBindMatrix().clone(),I.getRestMatrix().clone());i._index=I._index,I._linkedTransformNode&&i.linkTransformNode(I._linkedTransformNode),E.b.DeepCopy(I.animations,i.animations)}if(this._ranges){C._ranges={};for(const I in this._ranges){const O=this._ranges[I];O&&(C._ranges[I]=O.clone())}}return this._isDirty=!0,C.prepare(!0),C}enableBlending(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const O of this.bones)for(const C of O.animations)C.enableBlending=!0,C.blendingSpeed=I}dispose(){if(this._meshesWithPoseMatrix.length=0,this.nI().stopAnimation(this),this.nI().removeSkeleton(this),this._parentContainer){const I=this._parentContainer.skeletons.indexOf(this);I>-1&&this._parentContainer.skeletons.splice(I,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const I={};I.name=this.name,I.id=this.id,this.dimensionsAtRest&&(I.dimensionsAtRest=this.dimensionsAtRest.qS()),I.bones=[],I.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let C=0;C<this.bones.length;C++){var O;const j=this.bones[C],K=j.getParent(),i={parentBoneIndex:K?this.bones.indexOf(K):-1,index:j.getIndex(),name:j.name,id:j.id,matrix:j.getBindMatrix().qS(),rest:j.getRestMatrix().qS(),linkedTransformNodeId:null===(O=j.getTransformNode())||void 0===O?void 0:O.id};I.bones.push(i),j.length&&(i.length=j.length),j.metadata&&(i.metadata=j.metadata),j.animations&&j.animations.length>0&&(i.animation=j.animations[0].serialize()),I.ranges=[];for(const O in this._ranges){const C=this._ranges[O];if(!C)continue;const j={};j.name=O,j.from=C.from,j.to=C.to,I.ranges.push(j)}}return I}static Parse(I,O){const C=new h(I.name,I.id,O);let j;for(I.dimensionsAtRest&&(C.dimensionsAtRest=K.mC.YO(I.dimensionsAtRest)),C.needInitialSkinMatrix=I.needInitialSkinMatrix,j=0;j<I.bones.length;j++){const O=I.bones[j],i=I.bones[j].index;let y=null;O.parentBoneIndex>-1&&(y=C.bones[O.parentBoneIndex]);const S=O.rest?K.Matrix.YO(O.rest):null,U=new p.b(O.name,C,y,K.Matrix.YO(O.matrix),S,null,i);void 0!==O.id&&null!==O.id&&(U.id=O.id),O.length&&(U.length=O.length),O.metadata&&(U.metadata=O.metadata),O.animation&&U.animations.push(s.d.Parse(O.animation)),void 0!==O.linkedTransformNodeId&&null!==O.linkedTransformNodeId&&(C._hasWaitingData=!0,U._waitingTransformNodeId=O.linkedTransformNodeId)}if(I.ranges)for(j=0;j<I.ranges.length;j++){const O=I.ranges[j];C.createAnimationRange(O.name,O.from,O.to)}return C}computeAbsoluteMatrices(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||I)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(I)}getPoseMatrix(){let I=null;return this._meshesWithPoseMatrix.length>0&&(I=this._meshesWithPoseMatrix[0].getPoseMatrix()),I}sortBones(){const I=[],O=new Array(this.bones.length);for(let C=0;C<this.bones.length;C++)this._sortBones(C,I,O);this.bones=I}_sortBones(I,O,C){if(C[I])return;C[I]=!0;const j=this.bones[I];if(!j)return;void 0===j._index&&(j._index=I);const K=j.getParent();K&&this._sortBones(this.bones.indexOf(K),O,C),O.push(j)}setCurrentPoseAsRest(){for(const I of this.bones)I.setCurrentPoseAsRest()}}var r=C(12568),W=C(12720),Y=C(12245),o=C(12645),c=C(12329),n=C(12682),X=C(12660),T=C(12671),H=C(12766),b=C(12354),a=C(13752);class M{set areUpdatesFrozen(I){I?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new b.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,I||(I=q.e.LastCreatedScene),this._scene=I,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const I=this._scene.getEngine().getCaps();this._canUseTextureForTargets=I.canUseGLVertexID&&I.textureFloat&&I.maxVertexTextureImageUnits>0&&I.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return M.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?M.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(I){this._numMaxInfluencers!==I&&(this._numMaxInfluencers=I,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(I){this._useTextureToStoreTargets!==I&&(this._useTextureToStoreTargets=I,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var I;return M.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(I=this._scene)&&void 0!==I&&I.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(I){return this._activeTargets.data[I]}getTarget(I){return this._targets[I]}getTargetByName(I){for(const O of this._targets)if(O.name===I)return O;return null}addTarget(I){this._targets.push(I),this._targetInfluenceChangedObservers.push(I.onInfluenceChanged.add((I=>{this.areUpdatesFrozen&&I&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(I)}))),this._targetDataLayoutChangedObservers.push(I._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(I){const O=this._targets.indexOf(I);O>=0&&(this._targets.splice(O,1),I.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(O,1)[0]),I._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(O,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(I)}_bind(I){I.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),I.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),I.setTexture("morphTargets",this._targetStoreTexture),I.setInt("morphTargetCount",this.numInfluencers)}clone(){const I=new M(this._scene);for(const O of this._targets)I.addTarget(O.clone());return I.enablePositionMorphing=this.enablePositionMorphing,I.enableNormalMorphing=this.enableNormalMorphing,I.enableTangentMorphing=this.enableTangentMorphing,I.enableUVMorphing=this.enableUVMorphing,I.enableUV2Morphing=this.enableUV2Morphing,I.enableColorMorphing=this.enableColorMorphing,I}serialize(){const I={};I.id=this.uniqueId,I.targets=[];for(const O of this._targets)I.targets.push(O.serialize());return I}_syncActiveTargets(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const O=!!this._targetStoreTexture,C=this.isUsingTextureForTargets;(this._mustSynchronize||O!==C)&&(this._mustSynchronize=!1,this.synchronize());let j=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let K=-1;for(const i of this._targets)if(K++,0!==i.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=M.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(i),this._morphTargetTextureIndices[j]=K,this._tempInfluences[j++]=i.influence}this._morphTargetTextureIndices.length!==j&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,j)),this._influences&&this._influences.length===j||(this._influences=new Float32Array(j));for(let i=0;i<j;i++)this._influences[i]=this._tempInfluences[i];if(I&&this._scene)for(const i of this._scene.meshes)i.morphTargetManager===this&&(C?i._markSubMeshesAsAttributesDirty():i._syncGeometryWithMorphTargetManager())}synchronize(){var I;if(!this._scene||this.areUpdatesFrozen)return;const O=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(I=this._targetStoreTexture)||void 0===I||I.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>O.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const C of this._targets){this._supportsPositions=this._supportsPositions&&C.hasPositions,this._supportsNormals=this._supportsNormals&&C.hasNormals,this._supportsTangents=this._supportsTangents&&C.hasTangents,this._supportsUVs=this._supportsUVs&&C.hasUVs,this._supportsUV2s=this._supportsUV2s&&C.hasUV2s,this._supportsColors=this._supportsColors&&C.hasColors;const I=C.vertexCount;if(0===this._vertexCount)this._vertexCount=I;else if(this._vertexCount!==I)return void mI.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${C.name}": ${I}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const I=O.getCaps().maxTextureSize;this._textureWidth>I&&(this._textureHeight=Math.ceil(this._textureWidth/I),this._textureWidth=I);const C=this._targets.length,j=new Float32Array(C*this._textureWidth*this._textureHeight*4);let K=0;for(let O=0;O<C;O++){const I=this._targets[O],C=I.getPositions(),i=I.getNormals(),y=I.getUVs(),S=I.getTangents(),U=I.getUV2s(),p=I.getColors();K=O*this._textureWidth*this._textureHeight*4;for(let O=0;O<this._vertexCount;O++)this._supportsPositions&&C&&(j[K]=C[3*O],j[K+1]=C[3*O+1],j[K+2]=C[3*O+2],K+=4),this._supportsNormals&&i&&(j[K]=i[3*O],j[K+1]=i[3*O+1],j[K+2]=i[3*O+2],K+=4),this._supportsUVs&&y&&(j[K]=y[2*O],j[K+1]=y[2*O+1],K+=4),this._supportsTangents&&S&&(j[K]=S[3*O],j[K+1]=S[3*O+1],j[K+2]=S[3*O+2],K+=4),this._supportsUV2s&&U&&(j[K]=U[2*O],j[K+1]=U[2*O+1],K+=4),this._supportsColors&&p&&(j[K]=p[4*O],j[K+1]=p[4*O+1],j[K+2]=p[4*O+2],j[K+3]=p[4*O+3],K+=4)}this._targetStoreTexture=a.d.CreateRGBATexture(j,this._textureWidth,this._textureHeight,C,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const C of this._scene.meshes)C.morphTargetManager===this&&C._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const I=this._parentContainer.morphTargetManagers.indexOf(this);I>-1&&this._parentContainer.morphTargetManagers.splice(I,1),this._parentContainer=null}for(const I of this._targets)this._scene.stopAnimation(I)}}static Parse(I,O){const C=new M(O);for(const j of I.targets)C.addTarget(H.e.Parse(j,O));return C}}M.EnableTextureStorage=!0,M.MaxActiveMorphTargetsInVertexAttributeMode=8,M.ConstantTargetCountForTextureMode=0;var u=C(13808),J=C(12139),f=C(12580);const l=new Map,x=l;function D(I,O,C){t(I)&&mI.c.Warn(`Extension with the name '${I}' already exists`),l.set(I,{isGLTFExtension:O,factory:C})}function t(I){return l.delete(I)}var d=C(13819),w=C(12824),g=C(12340);class V{static Get(I,O,C){if(!O||void 0==C||!O[C])throw new Error(`${I}: Failed to find index (${C})`);return O[C]}static TryGet(I,O){return I&&void 0!=O&&I[O]?I[O]:null}static Assign(I){if(I)for(let O=0;O<I.length;O++)I[O].index=O}}function e(I){if(I.min&&I.max){const O=I.min,C=I.max,j=K.TmpVectors.mC[0].cS(O[0],O[1],O[2]),i=K.TmpVectors.mC[1].cS(C[0],C[1],C[2]);if(I.normalized&&5126!==I.componentType){let O=1;switch(I.componentType){case 5120:O=127;break;case 5121:O=255;break;case 5122:O=32767;break;case 5123:O=65535}const C=1/O;j.scaleInPlace(C),i.scaleInPlace(C)}return new f.e(j,i)}return null}class L{static RegisterExtension(I,O){D(I,!1,O)}static UnregisterExtension(I){return t(I)}get NS(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(I){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=I}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((I=>I.dispose&&I.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(I,O,C,j,K,i){let y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=O,this._assetContainer=C,this._loadData(j);let i=null;if(I){const O={};if(this._gltf.nodes)for(const I of this._gltf.nodes)I.name&&(O[I.name]=I.index);i=(I instanceof Array?I:[I]).map((I=>{const C=O[I];if(void 0===C)throw new Error(`Failed to find node '${I}'`);return C}))}return await this._loadAsync(K,y,i,(()=>({meshes:this._getMeshes(),RQ:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=I,this._loadData(O),await this._loadAsync(C,K,null,(()=>{}))}async _loadAsync(I,O,C,j){return await Promise.resolve().then((async()=>{this._rootUrl=I,this._uniqueRootUrl=!I.startsWith("file:")&&O?I:`${I}${Date.now()}/`,this._fileName=O,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const K=`${u.m[u.m.LOADING]} => ${u.m[u.m.READY]}`,i=`${u.m[u.m.LOADING]} => ${u.m[u.m.COMPLETE]}`;this._parent._startPerformanceCounter(K),this._parent._startPerformanceCounter(i),this._parent._setState(u.m.LOADING),this._extensionsOnLoading();const S=new Array;if(!this.parent.loadOnlyMaterials)if(C)S.push(this.loadSceneAsync("/nodes",{nodes:C,index:-1}));else if(void 0!=this._gltf.hO||this._gltf.scenes&&this._gltf.scenes[0]){const I=V.Get("/scene",this._gltf.scenes,this._gltf.hO||0);S.push(this.loadSceneAsync(`/scenes/${I.index}`,I))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let I=0;I<this._gltf.materials.length;++I){const O=this._gltf.materials[I],C="/materials/"+I,j=r.e.TriangleFillMode;S.push(this._loadMaterialAsync(C,O,null,j,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&S.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&S.push(this._compileShadowGeneratorsAsync());const U=Promise.all(S).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.AS(!0);for(const I of this._babylonScene.materials){const O=I;void 0!==O.maxSimultaneousLights&&(O.maxSimultaneousLights=Math.max(O.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(u.m.READY),this._skipStartAnimationStep||this._startAnimations(),j()}));return await U.then((I=>(this._parent._endPerformanceCounter(K),y.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(i),this._parent._setState(u.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(I=>{this._parent.onErrorObservable.notifyObservers(I),this._parent.onErrorObservable.clear(),this.dispose()}))})),I)))})).catch((I=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(I),this._parent.onErrorObservable.clear(),this.dispose()),I}))}_loadData(I){if(this._gltf=I.json,this._setupData(),I.bin){const O=this._gltf.buffers;if(O&&O[0]&&!O[0].uri){const C=O[0];(C.byteLength<I.bin.byteLength-3||C.byteLength>I.bin.byteLength)&&mI.c.Warn(`Binary buffer length (${C.byteLength}) from JSON does not match chunk length (${I.bin.byteLength})`),this._bin=I.bin}else mI.c.Warn("Unexpected BIN chunk")}}_setupData(){if(V.Assign(this._gltf.accessors),V.Assign(this._gltf.animations),V.Assign(this._gltf.buffers),V.Assign(this._gltf.bufferViews),V.Assign(this._gltf.cameras),V.Assign(this._gltf.images),V.Assign(this._gltf.materials),V.Assign(this._gltf.meshes),V.Assign(this._gltf.nodes),V.Assign(this._gltf.samplers),V.Assign(this._gltf.scenes),V.Assign(this._gltf.skins),V.Assign(this._gltf.textures),this._gltf.nodes){const I={};for(const C of this._gltf.nodes)if(C.children)for(const O of C.children)I[O]=C.index;const O=this._createRootNode();for(const C of this._gltf.nodes){const j=I[C.index];C.parent=void 0===j?O:this._gltf.nodes[j]}}}async _loadExtensionsAsync(){const I=[];if(x.forEach(((O,C)=>{var j;!1===(null===(j=this.parent.extensionOptions[C])||void 0===j?void 0:j.enabled)?O.isGLTFExtension&&this.isExtensionUsed(C)&&mI.c.Warn(`Extension ${C} is used but has been explicitly disabled.`):O.isGLTFExtension&&!this.isExtensionUsed(C)||I.push((async()=>{const I=await O.factory(this);return I.name!==C&&mI.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${I.name} !== ${C}`),this._parent.onExtensionLoadedObservable.notifyObservers(I),I})())})),this._extensions.push(...await Promise.all(I)),this._extensions.sort(((I,O)=>(I.order||Number.MAX_VALUE)-(O.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const C of this._gltf.extensionsRequired){if(!this._extensions.some((I=>I.name===C&&I.enabled))){var O;if(!1===(null===(O=this.parent.extensionOptions[C])||void 0===O?void 0:O.enabled))throw new Error(`Required extension ${C} is disabled`);throw new Error(`Required extension ${C} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const I=new T.c("__root__",this._babylonScene);this._rootBabylonMesh=I,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.AS(!1);const O={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case u.i.AUTO:this._babylonScene.useRightHandedSystem||(O.rotation=[0,1,0,0],O.scale=[1,1,-1],L._LoadTransform(O,this._rootBabylonMesh));break;case u.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(I),O}loadSceneAsync(I,O){const C=this._extensionsLoadSceneAsync(I,O);if(C)return C;const j=new Array;if(this.logOpen(`${I} ${O.name||""}`),O.nodes)for(const K of O.nodes){const O=V.Get(`${I}/nodes/${K}`,this._gltf.nodes,K);j.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(I=>{I.parent=this._rootBabylonMesh})))}for(const K of this._postSceneLoadActions)K();return j.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(j).then((()=>{}))}_forEachPrimitive(I,O){if(I._primitiveBabylonMeshes)for(const C of I._primitiveBabylonMeshes)O(C)}_getGeometries(){const I=[],O=this._gltf.nodes;if(O)for(const C of O)this._forEachPrimitive(C,(O=>{const C=O.WS;C&&-1===I.indexOf(C)&&I.push(C)}));return I}_getMeshes(){const I=[];this._rootBabylonMesh instanceof X.e&&I.push(this._rootBabylonMesh);const O=this._gltf.nodes;if(O)for(const C of O)this._forEachPrimitive(C,(O=>{I.push(O)}));return I}_getTransformNodes(){const I=[],O=this._gltf.nodes;if(O)for(const C of O)C._babylonTransformNode&&"Aq"===C._babylonTransformNode.getClassName()&&I.push(C._babylonTransformNode),C._babylonTransformNodeForSkin&&I.push(C._babylonTransformNodeForSkin);return I}_getSkeletons(){const I=[],O=this._gltf.skins;if(O)for(const C of O)C._data&&I.push(C._data.babylonSkeleton);return I}_getAnimationGroups(){const I=[],O=this._gltf.animations;if(O)for(const C of O)C._babylonAnimationGroup&&I.push(C._babylonAnimationGroup);return I}_startAnimations(){switch(this._parent.animationStartMode){case u.g.NONE:break;case u.g.FIRST:{const I=this._getAnimationGroups();0!==I.length&&I[0].start(!0);break}case u.g.ALL:{const I=this._getAnimationGroups();for(const O of I)O.start(!0);break}default:return void mI.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadNodeAsync(I,O,C);if(j)return j;if(O._babylonTransformNode)throw new Error(`${I}: Invalid recursive node hierarchy`);const K=new Array;this.logOpen(`${I} ${O.name||""}`);const i=j=>{if(L.AddPointerMetadata(j,I),L._LoadTransform(O,j),void 0!=O.camera){const C=V.Get(`${I}/camera`,this._gltf.cameras,O.camera);K.push(this.loadCameraAsync(`/cameras/${C.index}`,C,(I=>{I.parent=j,this._babylonScene.useRightHandedSystem||(j.nS.x=-1)})))}if(O.children)for(const C of O.children){const O=V.Get(`${I}/children/${C}`,this._gltf.nodes,C);K.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(I=>{I.parent=j})))}C(j)},y=void 0!=O.mesh,S=this._parent.loadSkins&&void 0!=O.skin;if(!y||S){const I=O.name||`node${O.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new o.d(I,this._babylonScene);C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==O.mesh?O._babylonTransformNode=C:O._babylonTransformNodeForSkin=C,i(C)}if(y)if(S){const C=V.Get(`${I}/mesh`,this._gltf.meshes,O.mesh);K.push(this._loadMeshAsync(`/meshes/${C.index}`,O,C,(C=>{const j=O._babylonTransformNodeForSkin;C.metadata=(0,w.e)(j.metadata,C.metadata||{});const i=V.Get(`${I}/skin`,this._gltf.skins,O.skin);K.push(this._loadSkinAsync(`/skins/${i.index}`,O,i,(I=>{this._forEachPrimitive(O,(O=>{O.skeleton=I})),this._postSceneLoadActions.push((()=>{if(void 0!=i.skeleton){const I=V.Get(`/skins/${i.index}/skeleton`,this._gltf.nodes,i.skeleton).parent;O.index===I.index?C.parent=j.parent:C.parent=I._babylonTransformNode}else C.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:j,skinnedNode:C})}))})))})))}else{const C=V.Get(`${I}/mesh`,this._gltf.meshes,O.mesh);K.push(this._loadMeshAsync(`/meshes/${C.index}`,O,C,i))}return this.logClose(),Promise.all(K).then((()=>(this._forEachPrimitive(O,(I=>{const O=I;!O.isAnInstance&&O.WS&&O.WS.useBoundingInfoFromGeometry?I.fI():I.refreshBoundingInfo(!0,!0)})),O._babylonTransformNode)))}_loadMeshAsync(I,O,C,j){const K=C.primitives;if(!K||!K.length)throw new Error(`${I}: Primitives are missing`);void 0==K[0].index&&V.Assign(K);const i=new Array;this.logOpen(`${I} ${C.name||""}`);const y=O.name||`node${O.index}`;if(1===K.length){const j=C.primitives[0];i.push(this._loadMeshPrimitiveAsync(`${I}/primitives/${j.index}`,y,O,C,j,(I=>{O._babylonTransformNode=I,O._primitiveBabylonMeshes=[I]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,O._babylonTransformNode=new o.d(y,this._babylonScene),O._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._primitiveBabylonMeshes=[];for(const j of K)i.push(this._loadMeshPrimitiveAsync(`${I}/primitives/${j.index}`,`${y}_primitive${j.index}`,O,C,j,(I=>{I.parent=O._babylonTransformNode,O._primitiveBabylonMeshes.push(I)})))}return j(O._babylonTransformNode),this.logClose(),Promise.all(i).then((()=>O._babylonTransformNode))}_loadMeshPrimitiveAsync(I,O,C,j,K,i){const y=this._extensionsLoadMeshPrimitiveAsync(I,O,C,j,K,i);if(y)return y;this.logOpen(`${I}`);const S=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==C.skin&&!j.primitives[0].targets;let U,p;if(S&&K._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,U=K._instanceData.babylonSourceMesh.createInstance(O),U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p=K._instanceData.promise;else{const i=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new T.c(O,this._babylonScene);y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y.sideOrientation=this._babylonScene.useRightHandedSystem?r.e.CounterClockWiseSideOrientation:r.e.ClockWiseSideOrientation,this._createMorphTargets(I,C,j,K,y),i.push(this._loadVertexDataAsync(I,K,y).then((async O=>await this._loadMorphTargetsAsync(I,K,y,O).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,O.uI(y),O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const N=L._GetDrawMode(I,K.mode);if(void 0==K.material){let I=this._defaultBabylonMaterialData[N];I||(I=this._createDefaultMaterial("__GLTFLoader._default",N),this._parent.onMaterialLoadedObservable.notifyObservers(I),this._defaultBabylonMaterialData[N]=I),y.material=I}else if(!this.parent.skipMaterials){const O=V.Get(`${I}/material`,this._gltf.materials,K.material);i.push(this._loadMaterialAsync(`/materials/${O.index}`,O,y,N,(I=>{y.material=I})))}p=Promise.all(i),S&&(K._instanceData={babylonSourceMesh:y,promise:p}),U=y}return L.AddPointerMetadata(U,I),this._parent.onMeshLoadedObservable.notifyObservers(U),i(U),this.logClose(),p.then((()=>U))}_loadVertexDataAsync(I,O,C){const j=this._extensionsLoadVertexDataAsync(I,O,C);if(j)return j;const K=O.attributes;if(!K)throw new Error(`${I}: Attributes are missing`);const i=new Array,y=new n.b(C.name,this._babylonScene);if(void 0==O.indices)C.isUnIndexed=!0;else{const C=V.Get(`${I}/indices`,this._gltf.accessors,O.indices);i.push(this._loadIndicesAccessorAsync(`/accessors/${C.index}`,C).then((I=>{y.setIndices(I)})))}const S=(O,j,S)=>{if(void 0==K[O])return;C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(j)&&C._delayInfo.push(j);const U=V.Get(`${I}/attributes/${O}`,this._gltf.accessors,K[O]);i.push(this._loadVertexAccessorAsync(`/accessors/${U.index}`,U,j).then((I=>{if(I.getKind()===c.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!C.skeleton){const I=e(U);I&&(y._boundingInfo=I,y.useBoundingInfoFromGeometry=!0)}y.setVerticesBuffer(I,U.count)}))),j==c.e.MatricesIndicesExtraKind&&(C.numBoneInfluencers=8),S&&S(U)};return S("POSITION",c.e.PositionKind),S("NORMAL",c.e.NormalKind),S("TANGENT",c.e.TangentKind),S("TEXCOORD_0",c.e.UVKind),S("TEXCOORD_1",c.e.UV2Kind),S("TEXCOORD_2",c.e.UV3Kind),S("TEXCOORD_3",c.e.UV4Kind),S("TEXCOORD_4",c.e.UV5Kind),S("TEXCOORD_5",c.e.UV6Kind),S("JOINTS_0",c.e.MatricesIndicesKind),S("WEIGHTS_0",c.e.MatricesWeightsKind),S("JOINTS_1",c.e.MatricesIndicesExtraKind),S("WEIGHTS_1",c.e.MatricesWeightsExtraKind),S("COLOR_0",c.e.ColorKind,(I=>{"VEC4"===I.type&&(C.hasVertexAlpha=!0)})),Promise.all(i).then((()=>y))}_createMorphTargets(I,O,C,j,K){if(!j.targets||!this._parent.loadMorphTargets)return;if(void 0==O._numMorphTargets)O._numMorphTargets=j.targets.length;else if(j.targets.length!==O._numMorphTargets)throw new Error(`${I}: Primitives do not have the same number of targets`);const i=C.extras?C.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,K.morphTargetManager=new M(this._babylonScene),K.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,K.morphTargetManager.areUpdatesFrozen=!0;for(let y=0;y<j.targets.length;y++){const I=O.weights?O.weights[y]:C.weights?C.weights[y]:0,j=i?i[y]:`morphTarget${y}`;K.morphTargetManager.addTarget(new H.e(j,I,K.nI()))}}_loadMorphTargetsAsync(I,O,C,j){if(!O.targets||!this._parent.loadMorphTargets)return Promise.resolve();const K=new Array,i=C.morphTargetManager;for(let y=0;y<i.numTargets;y++){const C=i.getTarget(y);K.push(this._loadMorphTargetVertexDataAsync(`${I}/targets/${y}`,j,O.targets[y],C))}return Promise.all(K).then((()=>{i.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(I,O,C,j){const K=new Array,i=(j,i,y)=>{if(void 0==C[j])return;const S=O.getVertexBuffer(i);if(!S)return;const U=V.Get(`${I}/${j}`,this._gltf.accessors,C[j]);K.push(this._loadFloatAccessorAsync(`/accessors/${U.index}`,U).then((I=>{y(S,I)})))};return i("POSITION",c.e.PositionKind,((I,O)=>{const C=new Float32Array(O.length);I.forEach(O.length,((I,j)=>{C[j]=O[j]+I})),j.setPositions(C)})),i("NORMAL",c.e.NormalKind,((I,O)=>{const C=new Float32Array(O.length);I.forEach(C.length,((I,j)=>{C[j]=O[j]+I})),j.setNormals(C)})),i("TANGENT",c.e.TangentKind,((I,O)=>{const C=new Float32Array(O.length/3*4);let K=0;I.forEach(O.length/3*4,((I,j)=>{(j+1)%4!==0&&(C[K]=O[K]+I,K++)})),j.setTangents(C)})),i("TEXCOORD_0",c.e.UVKind,((I,O)=>{const C=new Float32Array(O.length);I.forEach(O.length,((I,j)=>{C[j]=O[j]+I})),j.setUVs(C)})),i("TEXCOORD_1",c.e.UV2Kind,((I,O)=>{const C=new Float32Array(O.length);I.forEach(O.length,((I,j)=>{C[j]=O[j]+I})),j.setUV2s(C)})),i("COLOR_0",c.e.ColorKind,((O,C)=>{let K=null;const i=O.getSize();if(3===i){K=new Float32Array(C.length/3*4),O.forEach(C.length,((I,O)=>{const j=Math.floor(O/3),i=O%3;K[4*j+i]=C[3*j+i]+I}));for(let I=0;I<C.length/3;++I)K[4*I+3]=1}else{if(4!==i)throw new Error(`${I}: Invalid number of components (${i}) for COLOR_0 attribute`);K=new Float32Array(C.length),O.forEach(C.length,((I,O)=>{K[O]=C[O]+I}))}j.setColors(K)})),await Promise.all(K).then((()=>{}))}static _LoadTransform(I,O){if(void 0!=I.skin)return;let C=K.mC.Zero(),j=K.Quaternion.Identity(),i=K.mC.One();if(I.matrix){K.Matrix.YO(I.matrix).decompose(i,j,C)}else I.translation&&(C=K.mC.YO(I.translation)),I.rotation&&(j=K.Quaternion.YO(I.rotation)),I.scale&&(i=K.mC.YO(I.scale));O.position=C,O.rotationQuaternion=j,O.nS=i}_loadSkinAsync(I,O,C,j){if(!this._parent.loadSkins)return Promise.resolve();const K=this._extensionsLoadSkinAsync(I,O,C);if(K)return K;if(C._data)return j(C._data.babylonSkeleton),C._data.promise;const i=`skeleton${C.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new h(C.name||i,i,this._babylonScene);y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(I,C,y);const S=this._loadSkinInverseBindMatricesDataAsync(I,C).then((I=>{this._updateBoneMatrices(y,I)}));return C._data={babylonSkeleton:y,promise:S},j(y),S}_loadBones(I,O,C){if(void 0==O.skeleton||this._parent.alwaysComputeSkeletonRootNode){const C=this._findSkeletonRootNode(`${I}/joints`,O.joints);if(C)if(void 0===O.skeleton)O.skeleton=C.index;else{const j=(I,O)=>{for(;O.parent;O=O.parent)if(O.parent===I)return!0;return!1},K=V.Get(`${I}/skeleton`,this._gltf.nodes,O.skeleton);K===C||j(K,C)||(mI.c.Warn(`${I}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),O.skeleton=C.index)}else mI.c.Warn(`${I}: Failed to find common root`)}const j={};for(const K of O.joints){const i=V.Get(`${I}/joints/${K}`,this._gltf.nodes,K);this._loadBone(i,O,C,j)}}_findSkeletonRootNode(I,O){if(0===O.length)return null;const C={};for(const K of O){const O=[];let j=V.Get(`${I}/${K}`,this._gltf.nodes,K);for(;-1!==j.index;)O.unshift(j),j=j.parent;C[K]=O}let j=null;for(let K=0;;++K){let I=C[O[0]];if(K>=I.length)return j;const i=I[K];for(let y=1;y<O.length;++y)if(I=C[O[y]],K>=I.length||i!==I[K])return j;j=i}}_loadBone(I,O,C,j){I._isJoint=!0;let K=j[I.index];if(K)return K;let i=null;I.index!==O.skeleton&&(I.parent&&-1!==I.parent.index?i=this._loadBone(I.parent,O,C,j):void 0!==O.skeleton&&mI.c.Warn(`/skins/${O.index}/skeleton: Skeleton node is not a common root`));const y=O.joints.indexOf(I.index);return K=new p.b(I.name||`joint${I.index}`,C,i,this._getNodeMatrix(I),null,null,y),j[I.index]=K,this._postSceneLoadActions.push((()=>{K.linkTransformNode(I._babylonTransformNode)})),K}_loadSkinInverseBindMatricesDataAsync(I,O){if(void 0==O.inverseBindMatrices)return Promise.resolve(null);const C=V.Get(`${I}/inverseBindMatrices`,this._gltf.accessors,O.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${C.index}`,C)}_updateBoneMatrices(I,O){for(const C of I.bones){const I=K.Matrix.Identity(),j=C._index;O&&-1!==j&&(K.Matrix.FromArrayToRef(O,16*j,I),I.invertToRef(I));const i=C.getParent();i&&I.multiplyToRef(i.getAbsoluteInverseBindMatrix(),I),C.hS(I,!1,!1),C._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(I){return I.matrix?K.Matrix.YO(I.matrix):K.Matrix.Compose(I.scale?K.mC.YO(I.scale):K.mC.One(),I.rotation?K.Quaternion.YO(I.rotation):K.Quaternion.Identity(),I.translation?K.mC.YO(I.translation):K.mC.Zero())}loadCameraAsync(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadCameraAsync(I,O,C);if(j)return j;const i=new Array;this.logOpen(`${I} ${O.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new U.e(O.name||`camera${O.index}`,K.mC.Zero(),this._babylonScene,!1);switch(y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._babylonCamera=y,y.setTarget(new K.mC(0,0,-1)),O.type){case"perspective":{const C=O.perspective;if(!C)throw new Error(`${I}: Camera perspective properties are missing`);y.fov=C.yfov,y.ES=C.znear,y.maxZ=C.zfar||0;break}case"orthographic":if(!O.orthographic)throw new Error(`${I}: Camera orthographic properties are missing`);y.mode=S.e.ORTHOGRAPHIC_CAMERA,y.orthoLeft=-O.orthographic.xmag,y.orthoRight=O.orthographic.xmag,y.orthoBottom=-O.orthographic.ymag,y.orthoTop=O.orthographic.ymag,y.ES=O.orthographic.znear,y.maxZ=O.orthographic.zfar;break;default:throw new Error(`${I}: Invalid camera type (${O.type})`)}return L.AddPointerMetadata(y,I),this._parent.onCameraLoadedObservable.notifyObservers(y),C(y),this.logClose(),Promise.all(i).then((()=>y))}_loadAnimationsAsync(){const I=this._gltf.animations;if(!I)return Promise.resolve();const O=new Array;for(let C=0;C<I.length;C++){const j=I[C];O.push(this.loadAnimationAsync(`/animations/${j.index}`,j).then((I=>{0===I.targetedAnimations.length&&I.dispose()})))}return Promise.all(O).then((()=>{}))}loadAnimationAsync(I,O){const j=this._extensionsLoadAnimationAsync(I,O);return j||C.e(78).then(C.bind(C,15305)).then((C=>{let{AnimationGroup:j}=C;this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new j(O.name||`animation${O.index}`,this._babylonScene);K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._babylonAnimationGroup=K;const i=new Array;V.Assign(O.channels),V.Assign(O.samplers);for(const y of O.channels)i.push(this._loadAnimationChannelAsync(`${I}/channels/${y.index}`,I,O,y,((I,O)=>{I.animations=I.animations||[],I.animations.push(O),K.addTargetedAnimation(O,I)})));return Promise.all(i).then((()=>(K.normalize(0),K)))}))}async _loadAnimationChannelAsync(I,O,j,K,i){const y=this._extensionsLoadAnimationChannelAsync(I,O,j,K,i);if(y)return await y;if(void 0==K.target.node)return await Promise.resolve();const S=V.Get(`${I}/target/node`,this._gltf.nodes,K.target.node),U=K.target.path,p="weights"===U;if(p&&!S._numMorphTargets||!p&&!S._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!p&&!S._isJoint)return await Promise.resolve();let N;switch(await Promise.resolve().then(C.bind(C,13827)),U){case"translation":var Q;N=null===(Q=(0,d.f)("/nodes/{}/translation"))||void 0===Q?void 0:Q.interpolation;break;case"rotation":var s;N=null===(s=(0,d.f)("/nodes/{}/rotation"))||void 0===s?void 0:s.interpolation;break;case"scale":var Z;N=null===(Z=(0,d.f)("/nodes/{}/scale"))||void 0===Z?void 0:Z.interpolation;break;case"weights":var q;N=null===(q=(0,d.f)("/nodes/{}/weights"))||void 0===q?void 0:q.interpolation;break;default:throw new Error(`${I}/target/path: Invalid value (${K.target.path})`)}if(!N)throw new Error(`${I}/target/path: Could not find interpolation properties for target path (${K.target.path})`);const mI={object:S,info:N};return await this._loadAnimationChannelFromTargetInfoAsync(I,O,j,K,mI,i)}_loadAnimationChannelFromTargetInfoAsync(I,O,C,j,K,i){const y=this.parent.targetFps,S=1/y,U=V.Get(`${I}/sampler`,C.samplers,j.sampler);return this._loadAnimationSamplerAsync(`${O}/samplers/${j.sampler}`,U).then((I=>{let O=0;const U=K.object,p=K.info;for(const K of p){const p=K.getStride(U),N=I.input,Q=I.output,s=new Array(N.length);let Z=0;switch(I.interpolation){case"STEP":for(let I=0;I<N.length;I++){const O=K.getValue(U,Q,Z,1);Z+=p,s[I]={frame:N[I]*y,value:O,interpolation:1}}break;case"CUBICSPLINE":for(let I=0;I<N.length;I++){const O=K.getValue(U,Q,Z,S);Z+=p;const C=K.getValue(U,Q,Z,1);Z+=p;const j=K.getValue(U,Q,Z,S);Z+=p,s[I]={frame:N[I]*y,inTangent:O,value:C,outTangent:j}}break;case"LINEAR":for(let I=0;I<N.length;I++){const O=K.getValue(U,Q,Z,1);Z+=p,s[I]={frame:N[I]*y,value:O}}}if(Z>0){const I=`${C.name||`animation${C.index}`}_channel${j.index}_${O}`,S=K.buildAnimations(U,I,y,s);for(const C of S)O++,i(C.babylonAnimatable,C.babylonAnimation)}}}))}_loadAnimationSamplerAsync(I,O){if(O._data)return O._data;const C=O.interpolation||"LINEAR";switch(C){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${I}/interpolation: Invalid value (${O.interpolation})`)}const j=V.Get(`${I}/input`,this._gltf.accessors,O.input),K=V.Get(`${I}/output`,this._gltf.accessors,O.output);return O._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${j.index}`,j),this._loadFloatAccessorAsync(`/accessors/${K.index}`,K)]).then((I=>{let[O,j]=I;return{input:O,interpolation:C,output:j}})),O._data}loadBufferAsync(I,O,C,j){const K=this._extensionsLoadBufferAsync(I,O,C,j);if(K)return K;if(!O._data)if(O.uri)O._data=this.loadUriAsync(`${I}/uri`,O,O.uri);else{if(!this._bin)throw new Error(`${I}: Uri is missing or the binary glTF is missing its binary chunk`);O._data=this._bin.readAsync(0,O.byteLength)}return O._data.then((O=>{try{return new Uint8Array(O.buffer,O.byteOffset+C,j)}catch(K){throw new Error(`${I}: ${K.message}`)}}))}loadBufferViewAsync(I,O){const C=this._extensionsLoadBufferViewAsync(I,O);if(C)return C;if(O._data)return O._data;const j=V.Get(`${I}/buffer`,this._gltf.buffers,O.buffer);return O._data=this.loadBufferAsync(`/buffers/${j.index}`,j,O.byteOffset||0,O.byteLength),O._data}_loadAccessorAsync(I,O,C){if(O._data)return O._data;const j=L._GetNumComponents(I,O.type),K=j*c.e.GetTypeByteLength(O.componentType),i=j*O.count;if(void 0==O.bufferView)O._data=Promise.resolve(new C(i));else{const y=V.Get(`${I}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${y.index}`,y).then((S=>{if(5126!==O.componentType||O.normalized||y.byteStride&&y.byteStride!==K){const I=new C(i);return c.e.ForEach(S,O.byteOffset||0,y.byteStride||K,j,O.componentType,I.length,O.normalized||!1,((O,C)=>{I[C]=O})),I}return L._GetTypedArray(I,O.componentType,S,O.byteOffset,i)}))}if(O.sparse){const i=O.sparse;O._data=O._data.then((y=>{const S=y,U=V.Get(`${I}/sparse/indices/bufferView`,this._gltf.bufferViews,i.indices.bufferView),p=V.Get(`${I}/sparse/values/bufferView`,this._gltf.bufferViews,i.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${U.index}`,U),this.loadBufferViewAsync(`/bufferViews/${p.index}`,p)]).then((y=>{let[U,p]=y;const N=L._GetTypedArray(`${I}/sparse/indices`,i.indices.componentType,U,i.indices.byteOffset,i.count),Q=j*i.count;let s;if(5126!==O.componentType||O.normalized){const y=L._GetTypedArray(`${I}/sparse/values`,O.componentType,p,i.values.byteOffset,Q);s=new C(Q),c.e.ForEach(y,0,K,j,O.componentType,s.length,O.normalized||!1,((I,O)=>{s[O]=I}))}else s=L._GetTypedArray(`${I}/sparse/values`,O.componentType,p,i.values.byteOffset,Q);let Z=0;for(let I=0;I<N.length;I++){let O=N[I]*j;for(let I=0;I<j;I++)S[O++]=s[Z++]}return S}))}))}return O._data}_loadFloatAccessorAsync(I,O){return this._loadAccessorAsync(I,O,Float32Array)}_loadIndicesAccessorAsync(I,O){if("SCALAR"!==O.type)throw new Error(`${I}/type: Invalid value ${O.type}`);if(5121!==O.componentType&&5123!==O.componentType&&5125!==O.componentType)throw new Error(`${I}/componentType: Invalid value ${O.componentType}`);if(O._data)return O._data;if(O.sparse){const C=L._GetTypedArrayConstructor(`${I}/componentType`,O.componentType);O._data=this._loadAccessorAsync(I,O,C)}else{const C=V.Get(`${I}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((C=>L._GetTypedArray(I,O.componentType,C,O.byteOffset,O.count)))}return O._data}_loadVertexBufferViewAsync(I){if(I._babylonBuffer)return I._babylonBuffer;const O=this._babylonScene.getEngine();return I._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${I.index}`,I).then((I=>new c.c(O,I,!1))),I._babylonBuffer}_loadVertexAccessorAsync(I,O,C){var j;if(null!==(j=O._babylonVertexBuffer)&&void 0!==j&&j[C])return O._babylonVertexBuffer[C];O._babylonVertexBuffer||(O._babylonVertexBuffer={});const K=this._babylonScene.getEngine();if(O.sparse||void 0==O.bufferView)O._babylonVertexBuffer[C]=this._loadFloatAccessorAsync(I,O).then((I=>new c.e(K,I,C,!1)));else{const j=V.Get(`${I}/bufferView`,this._gltf.bufferViews,O.bufferView);O._babylonVertexBuffer[C]=this._loadVertexBufferViewAsync(j).then((i=>{const y=L._GetNumComponents(I,O.type);return new c.e(K,i,C,!1,void 0,j.byteStride,void 0,O.byteOffset,y,O.componentType,O.normalized,!0,void 0,!0)}))}return O._babylonVertexBuffer[C]}_loadMaterialMetallicRoughnessPropertiesAsync(I,O,C){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);const j=new Array;return O&&(O.baseColorFactor?(C.albedoColor=i.WO.YO(O.baseColorFactor),C.alpha=O.baseColorFactor[3]):C.albedoColor=i.WO.White(),C.metallic=void 0==O.metallicFactor?1:O.metallicFactor,C.roughness=void 0==O.roughnessFactor?1:O.roughnessFactor,O.baseColorTexture&&j.push(this.loadTextureInfoAsync(`${I}/baseColorTexture`,O.baseColorTexture,(I=>{I.name=`${C.name} (Base Color)`,C.albedoTexture=I}))),O.metallicRoughnessTexture&&(O.metallicRoughnessTexture.nonColorData=!0,j.push(this.loadTextureInfoAsync(`${I}/metallicRoughnessTexture`,O.metallicRoughnessTexture,(I=>{I.name=`${C.name} (Metallic Roughness)`,C.metallicTexture=I}))),C.useMetallnessFromMetallicTextureBlue=!0,C.useRoughnessFromMetallicTextureGreen=!0,C.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(j).then((()=>{}))}_loadMaterialAsync(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const i=this._extensionsLoadMaterialAsync(I,O,C,j,K);if(i)return i;O._data=O._data||{};let y=O._data[j];if(!y){this.logOpen(`${I} ${O.name||""}`);const C=this.createMaterial(I,O,j);y={babylonMaterial:C,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(I,O,C)},O._data[j]=y,L.AddPointerMetadata(C,I),this._parent.onMaterialLoadedObservable.notifyObservers(C),this.logClose()}return C&&(y.babylonMeshes.push(C),C.yS.addOnce((()=>{const I=y.babylonMeshes.indexOf(C);-1!==I&&y.babylonMeshes.splice(I,1)}))),K(y.babylonMaterial),y.promise.then((()=>y.babylonMaterial))}_createDefaultMaterial(I,O){this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new W.c(I,this._babylonScene);return C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.fillMode=O,C.enableSpecularAntiAliasing=!0,C.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,C.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,C.transparencyMode=W.c.PBRMATERIAL_OPAQUE,C.metallic=1,C.roughness=1,C}createMaterial(I,O,C){const j=this._extensionsCreateMaterial(I,O,C);if(j)return j;const K=O.name||`material${O.index}`;return this._createDefaultMaterial(K,C)}loadMaterialPropertiesAsync(I,O,C){const j=this._extensionsLoadMaterialPropertiesAsync(I,O,C);if(j)return j;const K=new Array;return K.push(this.loadMaterialBasePropertiesAsync(I,O,C)),O.pbrMetallicRoughness&&K.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${I}/pbrMetallicRoughness`,O.pbrMetallicRoughness,C)),this.loadMaterialAlphaProperties(I,O,C),Promise.all(K).then((()=>{}))}loadMaterialBasePropertiesAsync(I,O,C){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);const j=new Array;return C.emissiveColor=O.emissiveFactor?i.WO.YO(O.emissiveFactor):new i.WO(0,0,0),O.doubleSided&&(C.oS=!1,C.twoSidedLighting=!0),O.normalTexture&&(O.normalTexture.nonColorData=!0,j.push(this.loadTextureInfoAsync(`${I}/normalTexture`,O.normalTexture,(I=>{I.name=`${C.name} (Normal)`,C.bumpTexture=I}))),C.invertNormalMapX=!this._babylonScene.useRightHandedSystem,C.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=O.normalTexture.scale&&C.bumpTexture&&(C.bumpTexture.level=O.normalTexture.scale),C.forceIrradianceInFragment=!0),O.occlusionTexture&&(O.occlusionTexture.nonColorData=!0,j.push(this.loadTextureInfoAsync(`${I}/occlusionTexture`,O.occlusionTexture,(I=>{I.name=`${C.name} (Occlusion)`,C.ambientTexture=I}))),C.useAmbientInGrayScale=!0,void 0!=O.occlusionTexture.strength&&(C.ambientTextureStrength=O.occlusionTexture.strength)),O.emissiveTexture&&j.push(this.loadTextureInfoAsync(`${I}/emissiveTexture`,O.emissiveTexture,(I=>{I.name=`${C.name} (Emissive)`,C.emissiveTexture=I}))),Promise.all(j).then((()=>{}))}loadMaterialAlphaProperties(I,O,C){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);switch(O.alphaMode||"OPAQUE"){case"OPAQUE":C.transparencyMode=W.c.PBRMATERIAL_OPAQUE,C.alpha=1;break;case"MASK":C.transparencyMode=W.c.PBRMATERIAL_ALPHATEST,C.alphaCutOff=void 0==O.alphaCutoff?.5:O.alphaCutoff,C.albedoTexture&&(C.albedoTexture.mU=!0);break;case"BLEND":C.transparencyMode=W.c.PBRMATERIAL_ALPHABLEND,C.albedoTexture&&(C.albedoTexture.mU=!0,C.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${I}/alphaMode: Invalid value (${O.alphaMode})`)}}loadTextureInfoAsync(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadTextureInfoAsync(I,O,C);if(j)return j;if(this.logOpen(`${I}`),O.texCoord>=6)throw new Error(`${I}/texCoord: Invalid value (${O.texCoord})`);const K=V.Get(`${I}/index`,this._gltf.textures,O.index);K._textureInfo=O;const i=this._loadTextureAsync(`/textures/${O.index}`,K,(j=>{j.coordinatesIndex=O.texCoord||0,L.AddPointerMetadata(j,I),this._parent.onTextureLoadedObservable.notifyObservers(j),C(j)}));return this.logClose(),i}_loadTextureAsync(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadTextureAsync(I,O,C);if(j)return j;this.logOpen(`${I} ${O.name||""}`);const K=void 0==O.sampler?L.DefaultSampler:V.Get(`${I}/sampler`,this._gltf.samplers,O.sampler),i=V.Get(`${I}/source`,this._gltf.images,O.source),y=this._createTextureAsync(I,K,i,C,void 0,!O._textureInfo.nonColorData);return this.logClose(),y}_createTextureAsync(I,O,C){let K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},i=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0;const S=this._loadSampler(`/samplers/${O.index}`,O),U=new Array,p=new j;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N={noMipmap:S.noMipMaps,invertY:!1,samplingMode:S.samplingMode,F:()=>{this._disposed||p.resolve()},onError:(O,C)=>{this._disposed||p.reject(new Error(`${I}: ${C&&C.message?C.message:O||"Failed to load texture"}`))},mimeType:C.mimeType??(0,J.i)(C.uri??""),loaderOptions:i,useSRGBBuffer:!!y&&this._parent.useSRGBBuffers},Q=new Y.e(null,this._babylonScene,N);return Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.push(p.promise),U.push(this.loadImageAsync(`/images/${C.index}`,C).then((I=>{const O=C.uri||`${this._fileName}#image${C.index}`,j=`data:${this._uniqueRootUrl}${O}`;Q.updateURL(j,I);const K=Q.getInternalTexture();K&&(K.label=C.name)}))),Q.wrapU=S.wrapU,Q.wrapV=S.wrapV,K(Q),this._parent.useGltfTextureNames&&(Q.name=C.name||C.uri||`image${C.index}`),Promise.all(U).then((()=>Q))}_loadSampler(I,O){return O._data||(O._data={noMipMaps:9728===O.minFilter||9729===O.minFilter,samplingMode:L._GetTextureSamplingMode(I,O),wrapU:L._GetTextureWrapMode(`${I}/wrapS`,O.wrapS),wrapV:L._GetTextureWrapMode(`${I}/wrapT`,O.wrapT)}),O._data}loadImageAsync(I,O){if(!O._data){if(this.logOpen(`${I} ${O.name||""}`),O.uri)O._data=this.loadUriAsync(`${I}/uri`,O,O.uri);else{const C=V.Get(`${I}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C)}this.logClose()}return O._data}loadUriAsync(I,O,C){const j=this._extensionsLoadUriAsync(I,O,C);if(j)return j;if(!L._ValidateUri(C))throw new Error(`${I}: '${C}' is invalid`);if((0,J.m)(C)){const O=new Uint8Array((0,J.e)(C));return this.log(`${I}: Decoded ${C.substring(0,64)}... (${O.length} bytes)`),Promise.resolve(O)}return this.log(`${I}: Loading ${C}`),this._parent.preprocessUrlAsync(this._rootUrl+C).then((O=>new Promise(((j,K)=>{this._parent._loadFile(this._babylonScene,O,(O=>{this._disposed||(this.log(`${I}: Loaded ${C} (${O.byteLength} bytes)`),j(new Uint8Array(O)))}),!0,(O=>{K(new J.p(`${I}: Failed to load '${C}'${O?": "+O.status+" "+O.statusText:""}`,O))}))}))))}static AddPointerMetadata(I,O){I.metadata=I.metadata||{};const C=I._internalMetadata=I._internalMetadata||{},j=C.NS=C.NS||{};(j.pointers=j.pointers||[]).push(O)}static _GetTextureWrapMode(I,O){switch(O=void 0==O?10497:O){case 33071:return Y.e.CLAMP_ADDRESSMODE;case 33648:return Y.e.MIRROR_ADDRESSMODE;case 10497:return Y.e.WRAP_ADDRESSMODE;default:return mI.c.Warn(`${I}: Invalid value (${O})`),Y.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(I,O){const C=void 0==O.magFilter?9729:O.magFilter,j=void 0==O.minFilter?9987:O.minFilter;if(9729===C)switch(j){case 9728:return Y.e.LINEAR_NEAREST;case 9729:return Y.e.LINEAR_LINEAR;case 9984:return Y.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return Y.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return Y.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return Y.e.LINEAR_LINEAR_MIPLINEAR;default:return mI.c.Warn(`${I}/minFilter: Invalid value (${j})`),Y.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==C&&mI.c.Warn(`${I}/magFilter: Invalid value (${C})`),j){case 9728:return Y.e.NEAREST_NEAREST;case 9729:return Y.e.NEAREST_LINEAR;case 9984:return Y.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return Y.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return Y.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return Y.e.NEAREST_LINEAR_MIPLINEAR;default:return mI.c.Warn(`${I}/minFilter: Invalid value (${j})`),Y.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(I,O){try{return(0,g.m)(O)}catch(C){throw new Error(`${I}: ${C.message}`)}}static _GetTypedArray(I,O,C,j,K){const i=C.buffer;j=C.byteOffset+(j||0);const y=L._GetTypedArrayConstructor(`${I}/componentType`,O),S=c.e.GetTypeByteLength(O);return j%S!==0?(mI.c.Warn(`${I}: Copying buffer as byte offset (${j}) is not a multiple of component type byte length (${S})`),new y(i.slice(j,j+K*S),0)):new y(i,j,K)}static _GetNumComponents(I,O){switch(O){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${I}: Invalid type (${O})`)}static _ValidateUri(I){return y.Tools.IsBase64(I)||-1===I.indexOf("..")}static _GetDrawMode(I,O){switch(void 0==O&&(O=4),O){case 0:return r.e.PointListDrawMode;case 1:return r.e.LineListDrawMode;case 2:return r.e.LineLoopDrawMode;case 3:return r.e.LineStripDrawMode;case 4:return r.e.TriangleFillMode;case 5:return r.e.TriangleStripDrawMode;case 6:return r.e.TriangleFanDrawMode}throw new Error(`${I}: Invalid mesh primitive mode (${O})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const I=new Array;if(this._gltf.materials)for(const O of this._gltf.materials)if(O._data)for(const C in O._data){const j=O._data[C];for(const O of j.babylonMeshes){O.rS(!0);const C=j.babylonMaterial;I.push(C.forceCompilationAsync(O)),I.push(C.forceCompilationAsync(O,{useInstances:!0})),this._parent.useClipPlane&&(I.push(C.forceCompilationAsync(O,{clipPlane:!0})),I.push(C.forceCompilationAsync(O,{clipPlane:!0,useInstances:!0})))}}return Promise.all(I).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const I=new Array,O=this._babylonScene.lights;for(const C of O){const O=C.getShadowGenerator();O&&I.push(O.forceCompilationAsync())}return Promise.all(I).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(I){for(const O of this._extensions)O.enabled&&I(O)}_applyExtensions(I,O,C){for(const j of this._extensions)if(j.enabled){const K=`${j.name}.${O}`,i=I;i._activeLoaderExtensionFunctions=i._activeLoaderExtensionFunctions||{};const y=i._activeLoaderExtensionFunctions;if(!y[K]){y[K]=!0;try{const I=C(j);if(I)return I}finally{delete y[K]}}}return null}_extensionsOnLoading(){this._forEachExtensions((I=>I.onLoading&&I.onLoading()))}_extensionsOnReady(){this._forEachExtensions((I=>I.onReady&&I.onReady()))}_extensionsLoadSceneAsync(I,O){return this._applyExtensions(O,"loadScene",(C=>C.loadSceneAsync&&C.loadSceneAsync(I,O)))}_extensionsLoadNodeAsync(I,O,C){return this._applyExtensions(O,"loadNode",(j=>j.loadNodeAsync&&j.loadNodeAsync(I,O,C)))}_extensionsLoadCameraAsync(I,O,C){return this._applyExtensions(O,"loadCamera",(j=>j.loadCameraAsync&&j.loadCameraAsync(I,O,C)))}_extensionsLoadVertexDataAsync(I,O,C){return this._applyExtensions(O,"loadVertexData",(j=>j._loadVertexDataAsync&&j._loadVertexDataAsync(I,O,C)))}_extensionsLoadMeshPrimitiveAsync(I,O,C,j,K,i){return this._applyExtensions(K,"loadMeshPrimitive",(y=>y._loadMeshPrimitiveAsync&&y._loadMeshPrimitiveAsync(I,O,C,j,K,i)))}_extensionsLoadMaterialAsync(I,O,C,j,K){return this._applyExtensions(O,"loadMaterial",(i=>i._loadMaterialAsync&&i._loadMaterialAsync(I,O,C,j,K)))}_extensionsCreateMaterial(I,O,C){return this._applyExtensions(O,"createMaterial",(j=>j.createMaterial&&j.createMaterial(I,O,C)))}_extensionsLoadMaterialPropertiesAsync(I,O,C){return this._applyExtensions(O,"loadMaterialProperties",(j=>j.loadMaterialPropertiesAsync&&j.loadMaterialPropertiesAsync(I,O,C)))}_extensionsLoadTextureInfoAsync(I,O,C){return this._applyExtensions(O,"loadTextureInfo",(j=>j.loadTextureInfoAsync&&j.loadTextureInfoAsync(I,O,C)))}_extensionsLoadTextureAsync(I,O,C){return this._applyExtensions(O,"loadTexture",(j=>j._loadTextureAsync&&j._loadTextureAsync(I,O,C)))}_extensionsLoadAnimationAsync(I,O){return this._applyExtensions(O,"loadAnimation",(C=>C.loadAnimationAsync&&C.loadAnimationAsync(I,O)))}_extensionsLoadAnimationChannelAsync(I,O,C,j,K){return this._applyExtensions(C,"loadAnimationChannel",(i=>i._loadAnimationChannelAsync&&i._loadAnimationChannelAsync(I,O,C,j,K)))}_extensionsLoadSkinAsync(I,O,C){return this._applyExtensions(C,"loadSkin",(j=>j._loadSkinAsync&&j._loadSkinAsync(I,O,C)))}_extensionsLoadUriAsync(I,O,C){return this._applyExtensions(O,"loadUri",(j=>j._loadUriAsync&&j._loadUriAsync(I,O,C)))}_extensionsLoadBufferViewAsync(I,O){return this._applyExtensions(O,"loadBufferView",(C=>C.loadBufferViewAsync&&C.loadBufferViewAsync(I,O)))}_extensionsLoadBufferAsync(I,O,C,j){return this._applyExtensions(O,"loadBuffer",(K=>K.loadBufferAsync&&K.loadBufferAsync(I,O,C,j)))}static LoadExtensionAsync(I,O,C,j){if(!O.extensions)return null;const K=O.extensions[C];return K?j(`${I}/extensions/${C}`,K):null}static LoadExtraAsync(I,O,C,j){if(!O.extras)return null;const K=O.extras[C];return K?j(`${I}/extras/${C}`,K):null}isExtensionUsed(I){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(I)}logOpen(I){this._parent._logOpen(I)}logClose(){this._parent._logClose()}log(I){this._parent._log(I)}startPerformanceCounter(I){this._parent._startPerformanceCounter(I)}endPerformanceCounter(I){this._parent._endPerformanceCounter(I)}}L.DefaultSampler={index:-1},u.d._CreateGLTF2Loader=I=>new L(I);var z=C(13827),k=C(12447),A=C(12296),P=C(13831),v=C(13838);class B extends v.c{constructor(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",I),this._texture=I.getEngine().createRawCubeTexture(O,C,j,K,i,y,S,U)}update(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,I,O,C,j,K)}updateRGBDAsync(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,P.l)(this._texture,I,O,C,j).then((()=>{}))}clone(){return A.e.Clone((()=>{const I=this.nI(),O=this._texture,C=new B(I,O._bufferViewArray,O.width,O.format,O.type,O.generateMipMaps,O.invertY,O.samplingMode,O._compression);return 13===O.source&&C.updateRGBDAsync(O._bufferViewArrayArray,O._sphericalPolynomial,O._lodGenerationScale,O._lodGenerationOffset),C}),this)}}const F="EXT_lights_image_based";class R{constructor(I){this.name=F,this._loader=I,this.enabled=this._loader.isExtensionUsed(F)}dispose(){this._loader=null,delete this._lights}onLoading(){const I=this._loader.NS.extensions;if(I&&I[this.name]){const O=I[this.name];this._lights=O.lights}}loadSceneAsync(I,O){return L.LoadExtensionAsync(I,O,this.name,(async(C,j)=>{this._loader._allMaterialsDirtyRequired=!0;const K=new Array;K.push(this._loader.loadSceneAsync(I,O)),this._loader.logOpen(`${C}`);const i=V.Get(`${C}/light`,this._lights,j.CS);return K.push(this._loadLightAsync(`/extensions/${this.name}/lights/${j.CS}`,i).then((I=>{this._loader.babylonScene.environmentTexture=I}))),this._loader.logClose(),await Promise.all(K).then((()=>{}))}))}_loadLightAsync(I,O){if(!O._loaded){const C=new Array;this._loader.logOpen(`${I}`);const j=new Array(O.specularImages.length);for(let K=0;K<O.specularImages.length;K++){const i=O.specularImages[K];j[K]=new Array(i.length);for(let O=0;O<i.length;O++){const y=`${I}/specularImages/${K}/${O}`;this._loader.logOpen(`${y}`);const S=i[O],U=V.Get(y,this._loader.NS.images,S);C.push(this._loader.loadImageAsync(`/images/${S}`,U).then((I=>{j[K][O]=I}))),this._loader.logClose()}}this._loader.logClose(),O._loaded=Promise.all(C).then((async()=>{const C=new B(this._loader.babylonScene,null,O.specularImageSize);if(C.name=O.name||"environment",O._babylonTexture=C,void 0!=O.aS&&(C.level=O.aS),O.rotation){let I=K.Quaternion.YO(O.rotation);this._loader.babylonScene.useRightHandedSystem||(I=K.Quaternion.Inverse(I)),K.Matrix.FromQuaternionToRef(I,C.getReflectionTextureMatrix())}if(!O.irradianceCoefficients)throw new Error(`${I}: Irradiance coefficients are missing`);const i=k.b.YO(O.irradianceCoefficients);i.scaleInPlace(O.aS),i.convertIrradianceToLambertianRadiance();const y=k.f.FromHarmonics(i),S=(j.length-1)/Math.log2(O.specularImageSize);return await C.updateRGBDAsync(j,y,S)}))}return O._loaded.then((()=>O._babylonTexture))}}t(F),D(F,!0,(I=>new R(I)));C(12797);const G="EXT_mesh_gpu_instancing";class II{constructor(I){this.name=G,this._loader=I,this.enabled=this._loader.isExtensionUsed(G)}dispose(){this._loader=null}loadNodeAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(I,j)=>{this._loader._disableInstancedMesh++;const i=this._loader.loadNodeAsync(`/nodes/${O.index}`,O,C);if(this._loader._disableInstancedMesh--,!O._primitiveBabylonMeshes)return await i;const y=new Array;let S=0;const U=O=>{if(void 0==j.attributes[O])return void y.push(Promise.resolve(null));const C=V.Get(`${I}/attributes/${O}`,this._loader.NS.accessors,j.attributes[O]);if(y.push(this._loader._loadFloatAccessorAsync(`/accessors/${C.bufferView}`,C)),0===S)S=C.count;else if(S!==C.count)throw new Error(`${I}/attributes: Instance buffer accessors do not have the same count.`)};return U("TRANSLATION"),U("ROTATION"),U("SCALE"),await i.then((async I=>{const[C,j,i]=await Promise.all(y),U=new Float32Array(16*S);K.TmpVectors.mC[0].cS(0,0,0),K.TmpVectors.Quaternion[0].cS(0,0,0,1),K.TmpVectors.mC[1].cS(1,1,1);for(let O=0;O<S;++O)C&&K.mC.FromArrayToRef(C,3*O,K.TmpVectors.mC[0]),j&&K.Quaternion.FromArrayToRef(j,4*O,K.TmpVectors.Quaternion[0]),i&&K.mC.FromArrayToRef(i,3*O,K.TmpVectors.mC[1]),K.Matrix.ComposeToRef(K.TmpVectors.mC[1],K.TmpVectors.Quaternion[0],K.TmpVectors.mC[0],K.TmpVectors.Matrix[0]),K.TmpVectors.Matrix[0].copyToArray(U,16*O);for(const K of O._primitiveBabylonMeshes)K.rQ("matrix",U,16,!0);return I}))}))}}t(G),D(G,!0,(I=>new II(I)));let OI=0,CI=null;class jI{static get Default(){return jI._Default||(jI._Default=new jI),jI._Default}constructor(){const I=jI.Configuration.decoder;this._decoderModulePromise=y.Tools.LoadBabylonScriptAsync(I.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(I,O,C,j,K){await this._decoderModulePromise,0===OI&&(MeshoptDecoder.useWorkers(1),OI=1);const i=await MeshoptDecoder.decodeGltfBufferAsync(O,C,I,j,K);return null!==CI&&clearTimeout(CI),CI=setTimeout((()=>{MeshoptDecoder.useWorkers(0),OI=0,CI=null}),1e3),i}}jI.Configuration={decoder:{url:`${y.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},jI._Default=null;const KI="EXT_meshopt_compression";class iI{constructor(I){this.name=KI,this.enabled=I.isExtensionUsed(KI),this._loader=I}dispose(){this._loader=null}loadBufferViewAsync(I,O){return L.LoadExtensionAsync(I,O,this.name,(async(C,j)=>{const K=O;if(K._meshOptData)return await K._meshOptData;const i=V.Get(`${I}/buffer`,this._loader.NS.buffers,j.buffer);return K._meshOptData=this._loader.loadBufferAsync(`/buffers/${i.index}`,i,j.byteOffset||0,j.byteLength).then((async I=>await jI.Default.decodeGltfBufferAsync(I,j.count,j.byteStride,j.mode,j.filter))),await K._meshOptData}))}}t(KI),D(KI,!0,(I=>new iI(I)));const yI="EXT_texture_webp";class SI{constructor(I){this.name=yI,this._loader=I,this.enabled=I.isExtensionUsed(yI)}dispose(){this._loader=null}_loadTextureAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=void 0==O.sampler?L.DefaultSampler:V.Get(`${I}/sampler`,this._loader.NS.samplers,O.sampler),y=V.Get(`${j}/source`,this._loader.NS.images,K.source);return await this._loader._createTextureAsync(I,i,y,(I=>{C(I)}),void 0,!O._textureInfo.nonColorData)}))}}t(yI),D(yI,!0,(I=>new SI(I)));const UI="EXT_texture_avif";class pI{constructor(I){this.name=UI,this._loader=I,this.enabled=I.isExtensionUsed(UI)}dispose(){this._loader=null}_loadTextureAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=void 0==O.sampler?L.DefaultSampler:V.Get(`${I}/sampler`,this._loader.NS.samplers,O.sampler),y=V.Get(`${j}/source`,this._loader.NS.images,K.source);return await this._loader._createTextureAsync(I,i,y,(I=>{C(I)}),void 0,!O._textureInfo.nonColorData)}))}}t(UI),D(UI,!0,(I=>new pI(I)));var NI=C(13821),QI=C(12772);const sI="EXT_lights_ies";class ZI{constructor(I){this.name=sI,this._loader=I,this.enabled=this._loader.isExtensionUsed(sI)}dispose(){this._loader=null,delete this._lights}onLoading(){const I=this._loader.NS.extensions;if(I&&I[this.name]){const O=I[this.name];this._lights=O.lights,V.Assign(this._lights)}}loadNodeAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,y)=>{let S,U;this._loader._allMaterialsDirtyRequired=!0;const p=await this._loader.loadNodeAsync(I,O,(I=>{U=V.Get(j,this._lights,y.CS);const O=U.name||I.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,S=new NI.b(O,K.mC.Zero(),K.mC.Backward(),0,1,this._loader.babylonScene),S.angle=Math.PI/2,S.innerAngle=0,S._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,U._babylonLight=S,S.falloffType=QI.d.FALLOFF_GLTF,S.MS=y.color?i.WO.YO(y.color):i.WO.White(),S.aS=y.multiplier||1,S.range=Number.MAX_VALUE,S.parent=I,this._loader._babylonLights.push(S),L.AddPointerMetadata(S,j),C(I)}));let N;if(U.uri)N=await this._loader.loadUriAsync(I,U,U.uri);else{const O=V.Get(`${I}/bufferView`,this._loader.NS.bufferViews,U.bufferView);N=await this._loader.loadBufferViewAsync(`/bufferViews/${O.index}`,O)}return S.iesProfileTexture=new Y.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,N,!0,void 0,void 0,void 0,void 0,".ies"),p}))}}t(sI),D(sI,!0,(I=>new ZI(I)));var qI=C(13850);const mO="KHR_draco_mesh_compression";class EI{constructor(I){this.name=mO,this.useNormalizedFlagFromAccessor=!0,this._loader=I,this.enabled=qI.b.DefaultAvailable&&this._loader.isExtensionUsed(mO)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{if(void 0!=O.mode&&4!==O.mode&&5!==O.mode)throw new Error(`${I}: Unsupported mode ${O.mode}`);const i={},y={},S=(I,j)=>{const S=K.attributes[I];if(void 0!=S&&(C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(j)&&C._delayInfo.push(j),i[j]=S,this.useNormalizedFlagFromAccessor)){const C=V.TryGet(this._loader.NS.accessors,O.attributes[I]);C&&(y[j]=C.normalized||!1)}};S("POSITION",c.e.PositionKind),S("NORMAL",c.e.NormalKind),S("TANGENT",c.e.TangentKind),S("TEXCOORD_0",c.e.UVKind),S("TEXCOORD_1",c.e.UV2Kind),S("TEXCOORD_2",c.e.UV3Kind),S("TEXCOORD_3",c.e.UV4Kind),S("TEXCOORD_4",c.e.UV5Kind),S("TEXCOORD_5",c.e.UV6Kind),S("JOINTS_0",c.e.MatricesIndicesKind),S("WEIGHTS_0",c.e.MatricesWeightsKind),S("COLOR_0",c.e.ColorKind);const U=V.Get(j,this._loader.NS.bufferViews,K.bufferView);return U._dracoBabylonGeometry||(U._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((async j=>{const K=this.dracoDecoder||qI.b.Default,S=V.TryGet(this._loader.NS.accessors,O.attributes.POSITION),U=this._loader.parent.alwaysComputeBoundingBox||C.skeleton||!S?null:e(S);return await K._decodeMeshToGeometryForGltfAsync(C.name,this._loader.babylonScene,j,i,y,U).catch((O=>{throw new Error(`${I}: ${O.message}`)}))}))),await U._dracoBabylonGeometry}))}}t(mO),D(mO,!0,(I=>new EI(I)));var hI=C(13857),rI=C(12250),WI=C(12257),YI=C(12654),oI=C(12833),cI=C(12226);YI.b.AddNodeConstructor("Light_Type_0",((I,O)=>()=>new nI(I,K.mC.Zero(),O)));class nI extends oI.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(I){this._shadowAngle=I,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(I){const O=this.needCube();if(this._direction=I,this.needCube()!==O&&this._shadowGenerators){const I=this._shadowGenerators.values();for(let O=I.next();!0!==O.done;O=I.next()){O.value.recreateShadowMap()}}}constructor(I,O,C){super(I,C),this._shadowAngle=Math.PI/2,this.position=O}getClassName(){return"PointLight"}getTypeID(){return QI.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(I){if(this.direction)return super.getShadowDirection(I);switch(I){case 0:return new K.mC(1,0,0);case 1:return new K.mC(-1,0,0);case 2:return new K.mC(0,-1,0);case 3:return new K.mC(0,1,0);case 4:return new K.mC(0,0,1);case 5:return new K.mC(0,0,-1)}return K.mC.Zero()}_setDefaultShadowProjectionMatrix(I,O,C){const j=this.nI().activeCamera;if(!j)return;const i=void 0!==this.shadowMinZ?this.shadowMinZ:j.ES,y=void 0!==this.shadowMaxZ?this.shadowMaxZ:j.maxZ,S=this.nI().getEngine().jS;K.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,S?y:i,S?i:y,I,!0,this._scene.getEngine().isNDCHalfZRange,void 0,S)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(I,O){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,O):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,O),this}transferToNodeMaterialEffect(I,O){return this.computeTransformedInformation()?I.setFloat3(O,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):I.setFloat3(O,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(I,O){I["POINTLIGHT"+O]=!0}}(0,rI.e)([(0,WI.E)()],nI.prototype,"shadowAngle",null),(0,cI.e)("BABYLON.PointLight",nI);const XI="KHR_lights_punctual";class TI{constructor(I){this.name=XI,this._loader=I,this.enabled=this._loader.isExtensionUsed(XI)}dispose(){this._loader=null,delete this._lights}onLoading(){const I=this._loader.NS.extensions;if(I&&I[this.name]){const O=I[this.name];this._lights=O.lights,V.Assign(this._lights)}}loadNodeAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,y)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(I,O,(I=>{let O;const S=V.Get(j,this._lights,y.CS),U=S.name||I.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,S.type){case"directional":{const I=new hI.c(U,K.mC.Backward(),this._loader.babylonScene);I.position.XS(0),O=I;break}case"point":O=new nI(U,K.mC.Zero(),this._loader.babylonScene);break;case"spot":{const I=new NI.b(U,K.mC.Zero(),K.mC.Backward(),0,1,this._loader.babylonScene);I.angle=2*(S.spot&&S.spot.outerConeAngle||Math.PI/4),I.innerAngle=2*(S.spot&&S.spot.innerConeAngle||0),O=I;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${j}: Invalid light type (${S.type})`)}O._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,S._babylonLight=O,O.falloffType=QI.d.FALLOFF_GLTF,O.MS=S.color?i.WO.YO(S.color):i.WO.White(),O.aS=void 0==S.aS?1:S.aS,O.range=void 0==S.range?Number.MAX_VALUE:S.range,O.parent=I,this._loader._babylonLights.push(O),L.AddPointerMetadata(O,j),C(I)})))))}}t(XI),D(XI,!0,(I=>new TI(I)));const HI="KHR_materials_pbrSpecularGlossiness";class bI{constructor(I){this.name=HI,this.order=200,this._loader=I,this.enabled=this._loader.isExtensionUsed(HI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=new Array;return i.push(this._loader.loadMaterialBasePropertiesAsync(I,O,C)),i.push(this._loadSpecularGlossinessPropertiesAsync(j,K,C)),this._loader.loadMaterialAlphaProperties(I,O,C),await Promise.all(i).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(I,O,C){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);const j=new Array;return C.metallic=null,C.roughness=null,O.diffuseFactor?(C.albedoColor=i.WO.YO(O.diffuseFactor),C.alpha=O.diffuseFactor[3]):C.albedoColor=i.WO.White(),C.reflectivityColor=O.specularFactor?i.WO.YO(O.specularFactor):i.WO.White(),C.microSurface=void 0==O.glossinessFactor?1:O.glossinessFactor,O.diffuseTexture&&j.push(this._loader.loadTextureInfoAsync(`${I}/diffuseTexture`,O.diffuseTexture,(I=>{I.name=`${C.name} (Diffuse)`,C.albedoTexture=I}))),O.specularGlossinessTexture&&(j.push(this._loader.loadTextureInfoAsync(`${I}/specularGlossinessTexture`,O.specularGlossinessTexture,(I=>{I.name=`${C.name} (Specular Glossiness)`,C.reflectivityTexture=I,C.reflectivityTexture.mU=!0}))),C.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(j).then((()=>{}))}}t(HI),D(HI,!0,(I=>new bI(I)));const aI="KHR_materials_unlit";class MI{constructor(I){this.name=aI,this.order=210,this._loader=I,this.enabled=this._loader.isExtensionUsed(aI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async()=>await this._loadUnlitPropertiesAsync(I,O,C)))}_loadUnlitPropertiesAsync(I,O,C){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);const j=new Array;C.unlit=!0;const K=O.pbrMetallicRoughness;return K&&(K.baseColorFactor?(C.albedoColor=i.WO.YO(K.baseColorFactor),C.alpha=K.baseColorFactor[3]):C.albedoColor=i.WO.White(),K.baseColorTexture&&j.push(this._loader.loadTextureInfoAsync(`${I}/baseColorTexture`,K.baseColorTexture,(I=>{I.name=`${C.name} (Base Color)`,C.albedoTexture=I})))),O.doubleSided&&(C.oS=!1,C.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(I,O,C),Promise.all(j).then((()=>{}))}}t(aI),D(aI,!0,(I=>new MI(I)));const uI="KHR_materials_clearcoat";class JI{constructor(I){this.name=uI,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(uI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=new Array;i.push(this._loader.loadMaterialPropertiesAsync(I,O,C)),i.push(this._loadClearCoatPropertiesAsync(j,K,C)),await Promise.all(i)}))}_loadClearCoatPropertiesAsync(I,O,C){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);const j=new Array;return C.clearCoat.isEnabled=!0,C.clearCoat.useRoughnessFromMainTexture=!1,C.clearCoat.remapF0OnInterfaceChange=!1,void 0!=O.clearcoatFactor?C.clearCoat.aS=O.clearcoatFactor:C.clearCoat.aS=0,O.clearcoatTexture&&j.push(this._loader.loadTextureInfoAsync(`${I}/clearcoatTexture`,O.clearcoatTexture,(I=>{I.name=`${C.name} (ClearCoat)`,C.clearCoat.texture=I}))),void 0!=O.clearcoatRoughnessFactor?C.clearCoat.roughness=O.clearcoatRoughnessFactor:C.clearCoat.roughness=0,O.clearcoatRoughnessTexture&&(O.clearcoatRoughnessTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${I}/clearcoatRoughnessTexture`,O.clearcoatRoughnessTexture,(I=>{I.name=`${C.name} (ClearCoat Roughness)`,C.clearCoat.textureRoughness=I})))),O.clearcoatNormalTexture&&(O.clearcoatNormalTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${I}/clearcoatNormalTexture`,O.clearcoatNormalTexture,(I=>{I.name=`${C.name} (ClearCoat Normal)`,C.clearCoat.bumpTexture=I}))),C.invertNormalMapX=!C.nI().useRightHandedSystem,C.invertNormalMapY=C.nI().useRightHandedSystem,void 0!=O.clearcoatNormalTexture.scale&&(C.clearCoat.bumpTexture.level=O.clearcoatNormalTexture.scale)),Promise.all(j).then((()=>{}))}}t(uI),D(uI,!0,(I=>new JI(I)));const fI="KHR_materials_iridescence";class lI{constructor(I){this.name=fI,this.order=195,this._loader=I,this.enabled=this._loader.isExtensionUsed(fI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(I,O,C)),i.push(this._loadIridescencePropertiesAsync(j,K,C)),await Promise.all(i).then((()=>{}))}))}_loadIridescencePropertiesAsync(I,O,C){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);const j=new Array;return C.iridescence.isEnabled=!0,C.iridescence.aS=O.iridescenceFactor??0,C.iridescence.indexOfRefraction=O.iridescenceIor??O.iridescenceIOR??1.3,C.iridescence.minimumThickness=O.iridescenceThicknessMinimum??100,C.iridescence.maximumThickness=O.iridescenceThicknessMaximum??400,O.iridescenceTexture&&j.push(this._loader.loadTextureInfoAsync(`${I}/iridescenceTexture`,O.iridescenceTexture,(I=>{I.name=`${C.name} (Iridescence)`,C.iridescence.texture=I}))),O.iridescenceThicknessTexture&&j.push(this._loader.loadTextureInfoAsync(`${I}/iridescenceThicknessTexture`,O.iridescenceThicknessTexture,(I=>{I.name=`${C.name} (Iridescence Thickness)`,C.iridescence.thicknessTexture=I}))),Promise.all(j).then((()=>{}))}}t(fI),D(fI,!0,(I=>new lI(I)));const xI="KHR_materials_anisotropy";class DI{constructor(I){this.name=xI,this.order=195,this._loader=I,this.enabled=this._loader.isExtensionUsed(xI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=new Array;i.push(this._loader.loadMaterialPropertiesAsync(I,O,C)),i.push(this._loadIridescencePropertiesAsync(j,K,C)),await Promise.all(i)}))}async _loadIridescencePropertiesAsync(I,O,C){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);const j=new Array;C.anisotropy.isEnabled=!0,C.anisotropy.aS=O.anisotropyStrength??0,C.anisotropy.angle=O.anisotropyRotation??0,O.anisotropyTexture&&(O.anisotropyTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${I}/anisotropyTexture`,O.anisotropyTexture,(I=>{I.name=`${C.name} (Anisotropy Intensity)`,C.anisotropy.texture=I})))),await Promise.all(j)}}t(xI),D(xI,!0,(I=>new DI(I)));const tI="KHR_materials_emissive_strength";class dI{constructor(I){this.name=tI,this.order=170,this._loader=I,this.enabled=this._loader.isExtensionUsed(tI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>await this._loader.loadMaterialPropertiesAsync(I,O,C).then((()=>{this._loadEmissiveProperties(j,K,C)}))))}_loadEmissiveProperties(I,O,C){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);void 0!==O.emissiveStrength&&(C.emissiveIntensity=O.emissiveStrength)}}t(tI),D(tI,!0,(I=>new dI(I)));const wI="KHR_materials_sheen";class gI{constructor(I){this.name=wI,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(wI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(I,O,C)),i.push(this._loadSheenPropertiesAsync(j,K,C)),await Promise.all(i).then((()=>{}))}))}_loadSheenPropertiesAsync(I,O,C){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);const j=new Array;return C.sheen.isEnabled=!0,C.sheen.aS=1,void 0!=O.sheenColorFactor?C.sheen.color=i.WO.YO(O.sheenColorFactor):C.sheen.color=i.WO.Black(),O.sheenColorTexture&&j.push(this._loader.loadTextureInfoAsync(`${I}/sheenColorTexture`,O.sheenColorTexture,(I=>{I.name=`${C.name} (Sheen Color)`,C.sheen.texture=I}))),void 0!==O.sheenRoughnessFactor?C.sheen.roughness=O.sheenRoughnessFactor:C.sheen.roughness=0,O.sheenRoughnessTexture&&(O.sheenRoughnessTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${I}/sheenRoughnessTexture`,O.sheenRoughnessTexture,(I=>{I.name=`${C.name} (Sheen Roughness)`,C.sheen.textureRoughness=I})))),C.sheen.albedoScaling=!0,C.sheen.useRoughnessFromMainTexture=!1,Promise.all(j).then((()=>{}))}}t(wI),D(wI,!0,(I=>new gI(I)));var VI=C(12708);const eI="KHR_materials_specular";class LI{constructor(I){this.name=eI,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(eI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=new Array;if(i.push(this._loader.loadMaterialPropertiesAsync(I,O,C)),i.push(this._loadSpecularPropertiesAsync(j,K,C)),K.extensions&&K.extensions.EXT_materials_specular_edge_color&&C instanceof W.c){K.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(C.brdf.dielectricSpecularModel=VI.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,C.brdf.conductorSpecularModel=VI.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(i).then((()=>{}))}))}_loadSpecularPropertiesAsync(I,O,C){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);const j=new Array;return void 0!==O.specularFactor&&(C.metallicF0Factor=O.specularFactor),void 0!==O.specularColorFactor&&(C.metallicReflectanceColor=i.WO.YO(O.specularColorFactor)),O.specularTexture&&(O.specularTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${I}/specularTexture`,O.specularTexture,(I=>{I.name=`${C.name} (Specular)`,C.metallicReflectanceTexture=I,C.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),O.specularColorTexture&&j.push(this._loader.loadTextureInfoAsync(`${I}/specularColorTexture`,O.specularColorTexture,(I=>{I.name=`${C.name} (Specular Color)`,C.reflectanceTexture=I}))),Promise.all(j).then((()=>{}))}}t(eI),D(eI,!0,(I=>new LI(I)));const zI="KHR_materials_ior";class kI{constructor(I){this.name=zI,this.order=180,this._loader=I,this.enabled=this._loader.isExtensionUsed(zI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(I,O,C)),i.push(this._loadIorPropertiesAsync(j,K,C)),await Promise.all(i).then((()=>{}))}))}_loadIorPropertiesAsync(I,O,C){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);return void 0!==O.ior?C.indexOfRefraction=O.ior:C.indexOfRefraction=kI._DEFAULT_IOR,Promise.resolve()}}kI._DEFAULT_IOR=1.5,t(zI),D(zI,!0,(I=>new kI(I)));const AI="KHR_materials_variants";class PI{constructor(I){this.name=AI,this._loader=I,this.enabled=this._loader.isExtensionUsed(AI)}dispose(){this._loader=null}static GetAvailableVariants(I){const O=this._GetExtensionMetadata(I);return O?Object.keys(O.variants):[]}getAvailableVariants(I){return PI.GetAvailableVariants(I)}static SelectVariant(I,O){const C=this._GetExtensionMetadata(I);if(!C)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${AI} extension`);const j=I=>{const O=C.variants[I];if(O)for(const C of O)C.mesh.material=C.material};if(O instanceof Array)for(const K of O)j(K);else j(O);C.lastSelected=O}selectVariant(I,O){PI.SelectVariant(I,O)}static Reset(I){const O=this._GetExtensionMetadata(I);if(!O)throw new Error(`Cannot reset on a glTF mesh that does not have the ${AI} extension`);for(const C of O.original)C.mesh.material=C.material;O.lastSelected=null}reset(I){PI.Reset(I)}static GetLastSelectedVariant(I){const O=this._GetExtensionMetadata(I);if(!O)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${AI} extension`);return O.lastSelected}getLastSelectedVariant(I){return PI.GetLastSelectedVariant(I)}static _GetExtensionMetadata(I){var O,C;return(null===I||void 0===I||null===(O=I._internalMetadata)||void 0===O||null===(C=O.NS)||void 0===C?void 0:C[AI])||null}onLoading(){const I=this._loader.NS.extensions;if(I&&I[this.name]){const O=I[this.name];this._variants=O.variants}}onReady(){const I=this._loader.rootBabylonMesh;if(I){var O;const C=this._loader.parent.extensionOptions[AI];null!==C&&void 0!==C&&C.defaultVariant&&PI.SelectVariant(I,C.defaultVariant),null===C||void 0===C||null===(O=C.onLoaded)||void 0===O||O.call(C,{get variants(){return PI.GetAvailableVariants(I)},get selectedVariant(){const O=PI.GetLastSelectedVariant(I);return O?Array.isArray(O)?O[0]:O:PI.GetAvailableVariants(I)[0]},set selectedVariant(O){PI.SelectVariant(I,O)}})}}_loadMeshPrimitiveAsync(I,O,C,j,K,i){return L.LoadExtensionAsync(I,K,this.name,(async(y,S)=>{const U=new Array;return U.push(this._loader._loadMeshPrimitiveAsync(I,O,C,j,K,(O=>{if(i(O),O instanceof T.c){const C=L._GetDrawMode(I,K.mode),j=this._loader.rootBabylonMesh,i=j?j._internalMetadata=j._internalMetadata||{}:{},p=i.NS=i.NS||{},N=p[AI]=p[AI]||{lastSelected:null,original:[],variants:{}};N.original.push({mesh:O,material:O.material});for(let I=0;I<S.mappings.length;++I){const K=S.mappings[I],i=V.Get(`${y}/mappings/${I}/material`,this._loader.NS.materials,K.material);U.push(this._loader._loadMaterialAsync(`#/materials/${K.material}`,i,O,C,(I=>{for(let C=0;C<K.variants.length;++C){const i=K.variants[C],y=V.Get(`/extensions/${AI}/variants/${i}`,this._variants,i);N.variants[y.name]=N.variants[y.name]||[],N.variants[y.name].push({mesh:O,material:I}),O.onClonedObservable.add((I=>{const C=I;let K=null,i=C;do{if(i=i.parent,!i)return;K=PI._GetExtensionMetadata(i)}while(null===K);if(j&&K===PI._GetExtensionMetadata(j)){i._internalMetadata={};for(const I in j._internalMetadata)i._internalMetadata[I]=j._internalMetadata[I];i._internalMetadata.NS=[];for(const I in j._internalMetadata.NS)i._internalMetadata.NS[I]=j._internalMetadata.NS[I];i._internalMetadata.NS[AI]={lastSelected:null,original:[],variants:{}};for(const I of K.original)i._internalMetadata.NS[AI].original.push({mesh:I.mesh,material:I.material});for(const I in K.variants)if(Object.prototype.hasOwnProperty.call(K.variants,I)){i._internalMetadata.NS[AI].variants[I]=[];for(const O of K.variants[I])i._internalMetadata.NS[AI].variants[I].push({mesh:O.mesh,material:O.material})}K=i._internalMetadata.NS[AI]}for(const j of K.original)j.mesh===O&&(j.mesh=C);for(const j of K.variants[y.name])j.mesh===O&&(j.mesh=C)}))}})))}}}))),await Promise.all(U).then((I=>{let[O]=I;return O}))}))}}t(AI),D(AI,!0,(I=>new PI(I)));var vI=C(12320);class BI{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:VI.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(I,O){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...BI._GetDefaultOptions(),...I},this._scene=O,this._scene._transmissionHelper=this,this.onErrorObservable=new N.c,this._scene.yS.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(I){if(!Object.keys(I).filter((O=>this._options[O]!==I[O])).length)return;const O={...this._options,...I},C=this._options;this._options=O,O.renderSize===C.renderSize&&O.renderTargetTextureType===C.renderTargetTextureType&&O.generateMipmaps===C.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=O.samples,this._opaqueRenderTarget.lodGenerationScale=O.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=O.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(I){return!!I&&!!(I instanceof W.c&&I.subSurface.isRefractionEnabled)}_addMesh(I){this._materialObservers[I.uniqueId]=I.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),y.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(I.material)?(I.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(I)&&this._transparentMeshesCache.push(I)):-1===this._opaqueMeshesCache.indexOf(I)&&this._opaqueMeshesCache.push(I)}))}_removeMesh(I){I.onMaterialChangedObservable.remove(this._materialObservers[I.uniqueId]),delete this._materialObservers[I.uniqueId];let O=this._transparentMeshesCache.indexOf(I);-1!==O&&this._transparentMeshesCache.splice(O,1),O=this._opaqueMeshesCache.indexOf(I),-1!==O&&this._opaqueMeshesCache.splice(O,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(I){const O=this._transparentMeshesCache.indexOf(I),C=this._opaqueMeshesCache.indexOf(I);this._shouldRenderAsTransmission(I.material)?(I.material instanceof W.c&&(I.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==C?(this._opaqueMeshesCache.splice(C,1),this._transparentMeshesCache.push(I)):-1===O&&this._transparentMeshesCache.push(I)):-1!==O?(this._transparentMeshesCache.splice(O,1),this._opaqueMeshesCache.push(I)):-1===C&&this._opaqueMeshesCache.push(I)}_isRenderTargetValid(){var I;return null!==(null===(I=this._opaqueRenderTarget)||void 0===I?void 0:I.getInternalTexture())}_setupRenderTargets(){var I;let O;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new vI.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(I=this._options.clearColor)||void 0===I?void 0:I.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((I=>{O=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?I.clearColor.K(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(I.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=O}));for(const C of this._transparentMeshesCache)this._shouldRenderAsTransmission(C.material)&&(C.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const FI="KHR_materials_transmission";class RI{constructor(I){this.name=FI,this.order=175,this._loader=I,this.enabled=this._loader.isExtensionUsed(FI),this.enabled&&(I.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(I,O,C)),i.push(this._loadTransparentPropertiesAsync(j,O,C,K)),await Promise.all(i).then((()=>{}))}))}_loadTransparentPropertiesAsync(I,O,C,j){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);const K=C;if(K.subSurface.isRefractionEnabled=!0,K.subSurface.volumeIndexOfRefraction=1,K.subSurface.useAlbedoToTintRefraction=!0,void 0===j.transmissionFactor)return K.subSurface.refractionIntensity=0,K.subSurface.isRefractionEnabled=!1,Promise.resolve();{var i;K.subSurface.refractionIntensity=j.transmissionFactor;const I=K.nI();if(K.subSurface.refractionIntensity&&!I._transmissionHelper)new BI({},K.nI());else if(K.subSurface.refractionIntensity&&(null===(i=I._transmissionHelper)||void 0===i||!i._isRenderTargetValid())){var y;null===(y=I._transmissionHelper)||void 0===y||y._setupRenderTargets()}}return K.subSurface.minimumThickness=0,K.subSurface.maximumThickness=0,j.transmissionTexture?(j.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${I}/transmissionTexture`,j.transmissionTexture,void 0).then((I=>{I.name=`${C.name} (Transmission)`,K.subSurface.refractionIntensityTexture=I,K.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}t(FI),D(FI,!0,(I=>new RI(I)));const GI="KHR_materials_diffuse_transmission";class IO{constructor(I){this.name=GI,this.order=174,this._loader=I,this.enabled=this._loader.isExtensionUsed(GI),this.enabled&&(I.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(I,O,C)),i.push(this._loadTranslucentPropertiesAsync(j,O,C,K)),await Promise.all(i).then((()=>{}))}))}_loadTranslucentPropertiesAsync(I,O,C,j){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);const K=C;if(K.subSurface.isTranslucencyEnabled=!0,K.subSurface.volumeIndexOfRefraction=1,K.subSurface.minimumThickness=0,K.subSurface.maximumThickness=0,K.subSurface.useAlbedoToTintTranslucency=!1,void 0===j.diffuseTransmissionFactor)return K.subSurface.translucencyIntensity=0,K.subSurface.isTranslucencyEnabled=!1,Promise.resolve();K.subSurface.translucencyIntensity=j.diffuseTransmissionFactor;const y=new Array;return K.subSurface.useGltfStyleTextures=!0,j.diffuseTransmissionTexture&&(j.diffuseTransmissionTexture.nonColorData=!0,y.push(this._loader.loadTextureInfoAsync(`${I}/diffuseTransmissionTexture`,j.diffuseTransmissionTexture).then((I=>{I.name=`${C.name} (Diffuse Transmission)`,K.subSurface.translucencyIntensityTexture=I})))),void 0!==j.diffuseTransmissionColorFactor?K.subSurface.translucencyColor=i.WO.YO(j.diffuseTransmissionColorFactor):K.subSurface.translucencyColor=i.WO.White(),j.diffuseTransmissionColorTexture&&y.push(this._loader.loadTextureInfoAsync(`${I}/diffuseTransmissionColorTexture`,j.diffuseTransmissionColorTexture).then((I=>{I.name=`${C.name} (Diffuse Transmission Color)`,K.subSurface.translucencyColorTexture=I}))),Promise.all(y).then((()=>{}))}}t(GI),D(GI,!0,(I=>new IO(I)));const OO="KHR_materials_volume";class CO{constructor(I){this.name=OO,this.order=173,this._loader=I,this.enabled=this._loader.isExtensionUsed(OO),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(I,O,C)),i.push(this._loadVolumePropertiesAsync(j,O,C,K)),await Promise.all(i).then((()=>{}))}))}_loadVolumePropertiesAsync(I,O,C,j){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);if(!C.subSurface.isRefractionEnabled&&!C.subSurface.isTranslucencyEnabled||!j.thicknessFactor)return Promise.resolve();C.subSurface.volumeIndexOfRefraction=C.indexOfRefraction;const K=void 0!==j.attenuationDistance?j.attenuationDistance:Number.MAX_VALUE;return C.subSurface.tintColorAtDistance=K,void 0!==j.attenuationColor&&3==j.attenuationColor.length&&C.subSurface.tintColor.cS(j.attenuationColor[0],j.attenuationColor[1],j.attenuationColor[2]),C.subSurface.minimumThickness=0,C.subSurface.maximumThickness=j.thicknessFactor,C.subSurface.useThicknessAsDepth=!0,j.thicknessTexture?(j.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${I}/thicknessTexture`,j.thicknessTexture).then((I=>{I.name=`${C.name} (Thickness)`,C.subSurface.thicknessTexture=I,C.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}t(OO),D(OO,!0,(I=>new CO(I)));const jO="KHR_materials_dispersion";class KO{constructor(I){this.name=jO,this.order=174,this._loader=I,this.enabled=this._loader.isExtensionUsed(jO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(I,O,C)),i.push(this._loadDispersionPropertiesAsync(j,O,C,K)),await Promise.all(i).then((()=>{}))}))}_loadDispersionPropertiesAsync(I,O,C,j){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);return C.subSurface.isRefractionEnabled&&j.dispersion?(C.subSurface.isDispersionEnabled=!0,C.subSurface.dispersion=j.dispersion,Promise.resolve()):Promise.resolve()}}t(jO),D(jO,!0,(I=>new KO(I)));const iO="EXT_materials_diffuse_roughness";class yO{constructor(I){this.name=iO,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(iO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(I,O,C)),i.push(this._loadDiffuseRoughnessPropertiesAsync(j,K,C)),await Promise.all(i).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(I,O,C){if(!(C instanceof W.c))throw new Error(`${I}: Material type not supported`);const j=new Array;return C.brdf.baseDiffuseModel=VI.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=O.diffuseRoughnessFactor?C.baseDiffuseRoughness=O.diffuseRoughnessFactor:C.baseDiffuseRoughness=0,O.diffuseRoughnessTexture&&j.push(this._loader.loadTextureInfoAsync(`${I}/diffuseRoughnessTexture`,O.diffuseRoughnessTexture,(I=>{I.name=`${C.name} (Diffuse Roughness)`,C.baseDiffuseRoughnessTexture=I}))),Promise.all(j).then((()=>{}))}}t(iO),D(iO,!0,(I=>new yO(I)));const SO="KHR_mesh_quantization";class UO{constructor(I){this.name=SO,this.enabled=I.isExtensionUsed(SO)}dispose(){}}t(SO),D(SO,!0,(I=>new UO(I)));const pO="KHR_texture_basisu";class NO{constructor(I){this.name=pO,this._loader=I,this.enabled=I.isExtensionUsed(pO)}dispose(){this._loader=null}_loadTextureAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>{const i=void 0==O.sampler?L.DefaultSampler:V.Get(`${I}/sampler`,this._loader.NS.samplers,O.sampler),y=V.Get(`${j}/source`,this._loader.NS.images,K.source);return await this._loader._createTextureAsync(I,i,y,(I=>{C(I)}),O._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!O._textureInfo.nonColorData)}))}}t(pO),D(pO,!0,(I=>new NO(I)));const QO="KHR_texture_transform";class sO{constructor(I){this.name=QO,this._loader=I,this.enabled=this._loader.isExtensionUsed(QO)}dispose(){this._loader=null}loadTextureInfoAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(j,K)=>await this._loader.loadTextureInfoAsync(I,O,(I=>{if(!(I instanceof Y.e))throw new Error(`${j}: Texture type not supported`);K.offset&&(I.uOffset=K.offset[0],I.vOffset=K.offset[1]),I.uRotationCenter=0,I.vRotationCenter=0,K.rotation&&(I.wAng=-K.rotation),K.scale&&(I.uScale=K.scale[0],I.vScale=K.scale[1]),void 0!=K.texCoord&&(I.coordinatesIndex=K.texCoord),C(I)}))))}}t(QO),D(QO,!0,(I=>new sO(I)));const ZO="KHR_xmp_json_ld";class qO{constructor(I){this.name=ZO,this.order=100,this._loader=I,this.enabled=this._loader.isExtensionUsed(ZO)}dispose(){this._loader=null}onLoading(){var I,O,C;if(null===this._loader.rootBabylonMesh)return;const j=null===(I=this._loader.NS.extensions)||void 0===I?void 0:I.KHR_xmp_json_ld,K=null===(O=this._loader.NS.asset)||void 0===O||null===(C=O.extensions)||void 0===C?void 0:C.KHR_xmp_json_ld;if(j&&K){const I=+K.packet;j.packets&&I<j.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=j.packets[I])}}}function mC(I,O,C,j){return i.WO.YO(O,C).scale(j)}function EO(I,O,C,j){return O[C]*j}function hO(I,O,C,j){return-O[C]*j}function rO(I,O,C,j){return O[C+1]*j}function WO(I,O,C,j){return O[C]*j*2}function YO(I){return{scale:[new cO(s.d.ANIMATIONTYPE_FLOAT,`${I}.uScale`,EO,(()=>2)),new cO(s.d.ANIMATIONTYPE_FLOAT,`${I}.vScale`,rO,(()=>2))],offset:[new cO(s.d.ANIMATIONTYPE_FLOAT,`${I}.uOffset`,EO,(()=>2)),new cO(s.d.ANIMATIONTYPE_FLOAT,`${I}.vOffset`,rO,(()=>2))],rotation:[new cO(s.d.ANIMATIONTYPE_FLOAT,`${I}.wAng`,hO,(()=>1))]}}t(ZO),D(ZO,!0,(I=>new qO(I)));class oO extends z.AnimationPropertyInfo{buildAnimations(I,O,C,j){return[{babylonAnimatable:I._babylonCamera,babylonAnimation:this._buildAnimation(O,C,j)}]}}class cO extends z.AnimationPropertyInfo{buildAnimations(I,O,C,j){const K=[];for(const i in I._data)K.push({babylonAnimatable:I._data[i].babylonMaterial,babylonAnimation:this._buildAnimation(O,C,j)});return K}}class nO extends z.AnimationPropertyInfo{buildAnimations(I,O,C,j){return[{babylonAnimatable:I._babylonLight,babylonAnimation:this._buildAnimation(O,C,j)}]}}(0,d.h)("/cameras/{}/orthographic/xmag",[new oO(s.d.ANIMATIONTYPE_FLOAT,"orthoLeft",hO,(()=>1)),new oO(s.d.ANIMATIONTYPE_FLOAT,"orthoRight",rO,(()=>1))]),(0,d.h)("/cameras/{}/orthographic/ymag",[new oO(s.d.ANIMATIONTYPE_FLOAT,"orthoBottom",hO,(()=>1)),new oO(s.d.ANIMATIONTYPE_FLOAT,"orthoTop",rO,(()=>1))]),(0,d.h)("/cameras/{}/orthographic/zfar",[new oO(s.d.ANIMATIONTYPE_FLOAT,"maxZ",EO,(()=>1))]),(0,d.h)("/cameras/{}/orthographic/znear",[new oO(s.d.ANIMATIONTYPE_FLOAT,"ES",EO,(()=>1))]),(0,d.h)("/cameras/{}/perspective/yfov",[new oO(s.d.ANIMATIONTYPE_FLOAT,"fov",EO,(()=>1))]),(0,d.h)("/cameras/{}/perspective/zfar",[new oO(s.d.ANIMATIONTYPE_FLOAT,"maxZ",EO,(()=>1))]),(0,d.h)("/cameras/{}/perspective/znear",[new oO(s.d.ANIMATIONTYPE_FLOAT,"ES",EO,(()=>1))]),(0,d.h)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new cO(s.d.ANIMATIONTYPE_COLOR3,"albedoColor",mC,(()=>4)),new cO(s.d.ANIMATIONTYPE_FLOAT,"alpha",(function(I,O,C,j){return O[C+3]*j}),(()=>4))]),(0,d.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new cO(s.d.ANIMATIONTYPE_FLOAT,"metallic",EO,(()=>1))]),(0,d.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new cO(s.d.ANIMATIONTYPE_FLOAT,"roughness",EO,(()=>1))]);const XO=YO("albedoTexture");(0,d.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",XO.scale),(0,d.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",XO.offset),(0,d.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",XO.rotation);const TO=YO("metallicTexture");(0,d.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",TO.scale),(0,d.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",TO.offset),(0,d.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",TO.rotation),(0,d.h)("/materials/{}/emissiveFactor",[new cO(s.d.ANIMATIONTYPE_COLOR3,"emissiveColor",mC,(()=>3))]);const HO=YO("bumpTexture");(0,d.h)("/materials/{}/normalTexture/scale",[new cO(s.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",EO,(()=>1))]),(0,d.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",HO.scale),(0,d.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",HO.offset),(0,d.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",HO.rotation),(0,d.h)("/materials/{}/occlusionTexture/strength",[new cO(s.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",EO,(()=>1))]);const bO=YO("ambientTexture");(0,d.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",bO.scale),(0,d.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",bO.offset),(0,d.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",bO.rotation);const aO=YO("emissiveTexture");(0,d.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",aO.scale),(0,d.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",aO.offset),(0,d.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",aO.rotation),(0,d.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new cO(s.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",EO,(()=>1))]),(0,d.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new cO(s.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",EO,(()=>1))]);const MO=YO("anisotropy.texture");(0,d.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",MO.scale),(0,d.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",MO.offset),(0,d.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",MO.rotation),(0,d.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new cO(s.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",EO,(()=>1))]),(0,d.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new cO(s.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",EO,(()=>1))]);const uO=YO("clearCoat.texture");(0,d.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",uO.scale),(0,d.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",uO.offset),(0,d.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",uO.rotation);const JO=YO("clearCoat.bumpTexture");(0,d.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new cO(s.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",EO,(()=>1))]),(0,d.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",JO.scale),(0,d.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",JO.offset),(0,d.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",JO.rotation);const fO=YO("clearCoat.textureRoughness");(0,d.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",fO.scale),(0,d.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",fO.offset),(0,d.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",fO.rotation),(0,d.h)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new cO(s.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",EO,(()=>1))]),(0,d.h)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new cO(s.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",EO,(()=>1))]),(0,d.h)("/materials/{}/extensions/KHR_materials_ior/ior",[new cO(s.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",EO,(()=>1))]),(0,d.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new cO(s.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",EO,(()=>1))]),(0,d.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new cO(s.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",EO,(()=>1))]),(0,d.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new cO(s.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",EO,(()=>1))]),(0,d.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new cO(s.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",EO,(()=>1))]);const lO=YO("iridescence.texture");(0,d.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",lO.scale),(0,d.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",lO.offset),(0,d.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",lO.rotation);const xO=YO("iridescence.thicknessTexture");(0,d.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",xO.scale),(0,d.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",xO.offset),(0,d.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",xO.rotation),(0,d.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new cO(s.d.ANIMATIONTYPE_COLOR3,"sheen.color",mC,(()=>3))]),(0,d.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new cO(s.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",EO,(()=>1))]);const DO=YO("sheen.texture");(0,d.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",DO.scale),(0,d.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",DO.offset),(0,d.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",DO.rotation);const tO=YO("sheen.textureRoughness");(0,d.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",tO.scale),(0,d.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",tO.offset),(0,d.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",tO.rotation),(0,d.h)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new cO(s.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",EO,(()=>1))]),(0,d.h)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new cO(s.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",mC,(()=>3))]);const dO=YO("metallicReflectanceTexture");(0,d.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",dO.scale),(0,d.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",dO.offset),(0,d.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",dO.rotation);const wO=YO("reflectanceTexture");(0,d.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",wO.scale),(0,d.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",wO.offset),(0,d.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",wO.rotation),(0,d.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new cO(s.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",EO,(()=>1))]);const gO=YO("subSurface.refractionIntensityTexture");(0,d.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",gO.scale),(0,d.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",gO.offset),(0,d.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",gO.rotation),(0,d.h)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new cO(s.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",mC,(()=>3))]),(0,d.h)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new cO(s.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",EO,(()=>1))]),(0,d.h)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new cO(s.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",EO,(()=>1))]);const VO=YO("subSurface.thicknessTexture");(0,d.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",VO.scale),(0,d.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",VO.offset),(0,d.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",VO.rotation),(0,d.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new cO(s.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",EO,(()=>1))]);const eO=YO("subSurface.translucencyIntensityTexture");(0,d.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",eO.scale),(0,d.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",eO.offset),(0,d.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",eO.rotation),(0,d.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new cO(s.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",mC,(()=>3))]);const LO=YO("subSurface.translucencyColorTexture");(0,d.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",LO.scale),(0,d.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",LO.offset),(0,d.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",LO.rotation),(0,d.h)("/extensions/KHR_lights_punctual/lights/{}/color",[new nO(s.d.ANIMATIONTYPE_COLOR3,"diffuse",mC,(()=>3))]),(0,d.h)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new nO(s.d.ANIMATIONTYPE_FLOAT,"intensity",EO,(()=>1))]),(0,d.h)("/extensions/KHR_lights_punctual/lights/{}/range",[new nO(s.d.ANIMATIONTYPE_FLOAT,"range",EO,(()=>1))]),(0,d.h)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new nO(s.d.ANIMATIONTYPE_FLOAT,"innerAngle",WO,(()=>1))]),(0,d.h)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new nO(s.d.ANIMATIONTYPE_FLOAT,"angle",WO,(()=>1))]),(0,d.h)("/nodes/{}/extensions/EXT_lights_ies/color",[new nO(s.d.ANIMATIONTYPE_COLOR3,"diffuse",mC,(()=>3))]),(0,d.h)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new nO(s.d.ANIMATIONTYPE_FLOAT,"intensity",EO,(()=>1))]);const zO="KHR_animation_pointer";class kO{constructor(I){this.name=zO,this._loader=I,this._pathToObjectConverter=(0,d.g)(this._loader.NS)}get enabled(){return this._loader.isExtensionUsed(zO)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(I,O,C,j,K){var i;const y=null===(i=j.target.extensions)||void 0===i?void 0:i.KHR_animation_pointer;if(!y||!this._pathToObjectConverter)return null;"pointer"!==j.target.path&&mI.c.Warn(`${I}/target/path: Value (${j.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=j.target.node&&mI.c.Warn(`${I}/target/node: Value (${j.target.node}) must not be present when using the ${this.name} extension`);const S=`${I}/extensions/${this.name}`,U=y.pointer;if(!U)throw new Error(`${S}: Pointer is missing`);try{const i=this._pathToObjectConverter.convert(U);if(!i.info.interpolation)throw new Error(`${S}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(I,O,C,j,{object:i.object,info:i.info.interpolation},K)}catch(p){return mI.c.Warn(`${S}/pointer: Invalid pointer (${U}) skipped`),null}}}t(zO),D(zO,!0,(I=>new kO(I)));class AO{constructor(I,O,C){this.frame=I,this.action=O,this.onlyOnce=C,this.isDone=!1}_clone(){return new AO(this.frame,this.action,this.onlyOnce)}}var PO=C(12126),vO=C(12167),BO=C(12163);class FO{get loop(){return this._loop}set loop(I){I!==this._loop&&(this._loop=I,this.updateOptions({loop:I}))}get currentTime(){var I;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(I=vO.b.audioEngine)&&void 0!==I&&I.audioContext&&(this.isPlaying||this.isPaused)){const I=this.isPaused?0:vO.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+I}return 0}get spatialSound(){return this._spatialSound}set spatialSound(I){if(I==this._spatialSound)return;const O=this.isPlaying;this.pause(),I?(this._spatialSound=I,this._updateSpatialParameters()):this._disableSpatialSound(),O&&this.play()}constructor(I,O,C){var j;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new N.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=K.mC.Zero(),this._localDirection=new K.mC(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=I,C=C||q.e.LastCreatedScene)if(this._scene=C,FO._SceneComponentInitialization(C),this._readyToPlayCallback=i,this._customAttenuationFunction=(I,O,C,j,K)=>O<C?I*(1-O/C):0,S&&(this.autoplay=S.autoplay||!1,this._loop=S.loop||!1,void 0!==S.volume&&(this._volume=S.volume),this._spatialSound=S.spatialSound??!1,this.maxDistance=S.maxDistance??100,this.useCustomAttenuation=S.useCustomAttenuation??!1,this.rolloffFactor=S.rolloffFactor||1,this.refDistance=S.refDistance||1,this.distanceModel=S.distanceModel||"linear",this._playbackRate=S.playbackRate||1,this._streaming=S.streaming??!1,this._length=S.length,this._offset=S.offset),null!==(j=vO.b.audioEngine)&&void 0!==j&&j.canUseWebAudio&&vO.b.audioEngine.audioContext){this._soundGain=vO.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let I=!0;if(O)try{"string"===typeof O?(this._urlType="String",this._url=O):O instanceof ArrayBuffer?this._urlType="ArrayBuffer":O instanceof HTMLMediaElement?this._urlType="MediaElement":O instanceof MediaStream?this._urlType="MediaStream":O instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(O)&&(this._urlType="Array");let C=[],j=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=vO.b.audioEngine.audioContext.createMediaElementSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=vO.b.audioEngine.audioContext.createMediaStreamSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":O.byteLength>0&&(j=!0,this._soundLoaded(O));break;case"AudioBuffer":this._audioBufferLoaded(O);break;case"String":C.push(O);case"Array":0===C.length&&(C=O);for(let I=0;I<C.length;I++){const O=C[I];if(j=S&&S.skipCodecCheck||-1!==O.indexOf(".mp3",O.length-4)&&vO.b.audioEngine.isMP3supported||-1!==O.indexOf(".ogg",O.length-4)&&vO.b.audioEngine.isOGGsupported||-1!==O.indexOf(".wav",O.length-4)||-1!==O.indexOf(".m4a",O.length-4)||-1!==O.indexOf(".mp4",O.length-4)||-1!==O.indexOf("blob:"),j){this._streaming?(this._htmlAudioElement=new Audio(O),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,y.Tools.SetCorsBehavior(O,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(O,(I=>{this._soundLoaded(I)}),void 0,!0,!0,(I=>{I&&mI.c.Error("XHR "+I.status+" error on: "+O+"."),mI.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:I=!1}I?j||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):mI.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(U){mI.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),vO.b.audioEngine&&!vO.b.audioEngine.WarnedWebAudioUnsupported&&(mI.c.Error("Web Audio is not supported by your browser."),vO.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var I;null!==(I=vO.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(I){var O;null!==(O=vO.b.audioEngine)&&void 0!==O&&O.audioContext&&(this._audioBuffer=I,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(I){var O;null!==(O=vO.b.audioEngine)&&void 0!==O&&O.audioContext&&vO.b.audioEngine.audioContext.decodeAudioData(I,(I=>{this._audioBufferLoaded(I)}),(I=>{mI.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+I)}))}setAudioBuffer(I){var O;null!==(O=vO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&(this._audioBuffer=I,this._isReadyToPlay=!0)}updateOptions(I){I&&(this.loop=I.loop??this.loop,this.maxDistance=I.maxDistance??this.maxDistance,this.useCustomAttenuation=I.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=I.rolloffFactor??this.rolloffFactor,this.refDistance=I.refDistance??this.refDistance,this.distanceModel=I.distanceModel??this.distanceModel,this._playbackRate=I.playbackRate??this._playbackRate,this._length=I.length??void 0,this.spatialSound=I.spatialSound??this._spatialSound,this._setOffset(I.offset??void 0),this.setVolume(I.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var I;null!==(I=vO.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&vO.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??vO.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var I;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(I=this._soundPanner)||void 0===I||I.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var I;null!==(I=vO.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(I){var O;null!==(O=vO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(I),this._isOutputConnected=!0)}setDirectionalCone(I,O,C){O<I?mI.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=I,this._coneOuterAngle=O,this._coneOuterGain=C,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(I){if(I!=this._coneInnerAngle){var O;if(this._coneOuterAngle<I)return void mI.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=I,null!==(O=vO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(I){if(I!=this._coneOuterAngle){var O;if(I<this._coneInnerAngle)return void mI.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=I,null!==(O=vO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(I){var O;I.equals(this._position)||(this._position.K(I),null!==(O=vO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(I){var O;this._localDirection=I,null!==(O=vO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const I=this._connectedTransformNode.getWorldMatrix(),O=K.mC.TransformNormal(this._localDirection,I);O.normalize(),this._soundPanner.orientationX.value=O.x,this._soundPanner.orientationY.value=O.y,this._soundPanner.orientationZ.value=O.z}updateDistanceFromListener(){var I;if(null!==(I=vO.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const I=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.EO(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,I,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(I){this._customAttenuationFunction=I}play(I,O,C){var j;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(j=vO.b.audioEngine)&&void 0!==j&&j.audioContext)try{var K,i;this._clearTimeoutsAndObservers();let j=I?(null===(K=vO.b.audioEngine)||void 0===K?void 0:K.audioContext.currentTime)+I:null===(i=vO.b.audioEngine)||void 0===i?void 0:i.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=vO.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const I=()=>{var C;if(null!==(C=vO.b.audioEngine)&&void 0!==C&&C.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=O??0;const C=this._htmlAudioElement.play();void 0!==C&&C.catch((()=>{var O,C;(null===(O=vO.b.audioEngine)||void 0===O||O.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(C=vO.b.audioEngine)||void 0===C?void 0:C.onAudioUnlockedObservable.addOnce((()=>{I()})))}))}else{var j;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(j=vO.b.audioEngine)||void 0===j?void 0:j.onAudioUnlockedObservable.addOnce((()=>{I()}))}};I()}}else{var y;const K=()=>{var K;if(null!==(K=vO.b.audioEngine)&&void 0!==K&&K.audioContext){var i;if(C=C||this._length,void 0!==O&&this._setOffset(O),this._soundSource){const I=this._soundSource;I.onended=()=>{I.disconnect()}}if(this._soundSource=null===(i=vO.b.audioEngine)||void 0===i?void 0:i.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var y;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==O&&(this._soundSource.loopStart=O),void 0!==C&&(this._soundSource.loopEnd=(0|O)+C),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},j=I?(null===(y=vO.b.audioEngine)||void 0===y?void 0:y.audioContext.currentTime)+I:vO.b.audioEngine.audioContext.currentTime;const K=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(j,K,this.loop?void 0:C)}}};"suspended"===(null===(y=vO.b.audioEngine)||void 0===y?void 0:y.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var I;"suspended"===(null===(I=vO.b.audioEngine)||void 0===I?void 0:I.audioContext.state)?(vO.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=vO.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{K()})))):K()}),500):K()}this._startTime=j,this.isPlaying=!0,this.isPaused=!1}catch(S){mI.c.Error("Error while trying to play audio: "+this.name+", "+S.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(I){var O;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var C;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(C=this._streamingSource)||void 0===C||C.disconnect();this.isPlaying=!1}else if(null!==(O=vO.b.audioEngine)&&void 0!==O&&O.audioContext&&this._soundSource){const O=I?vO.b.audioEngine.audioContext.currentTime+I:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(O)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var I;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var O;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(O=this._streamingSource)||void 0===O||O.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(I=vO.b.audioEngine)&&void 0!==I&&I.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=vO.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(I,O){var C;null!==(C=vO.b.audioEngine)&&void 0!==C&&C.canUseWebAudio&&this._soundGain&&(O&&vO.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(vO.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,vO.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(I,vO.b.audioEngine.audioContext.currentTime+O)):this._soundGain.gain.value=I),this._volume=I}setPlaybackRate(I){this._playbackRate=I,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(I){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=I,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=I=>this._onRegisterAfterWorldMatrixUpdate(I),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(I){var O;if(I.getBoundingInfo){const O=I.getBoundingInfo();this.setPosition(O.boundingSphere.centerWorld)}else this.setPosition(I.absolutePosition);null!==(O=vO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const I=()=>{(0,BO.f)((()=>this._isReadyToPlay),(()=>{C._audioBuffer=this.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,this._offset,this._length)}),void 0,300)},O={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},C=new FO(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,O);return this.useCustomAttenuation&&C.setAttenuationFunction(this._customAttenuationFunction),C.setPosition(this._position),C.setPlaybackRate(this._playbackRate),I(),C}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const I={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(I.connectedMeshId=this._connectedTransformNode.id),I.position=this._position.qS(),I.refDistance=this.refDistance,I.distanceModel=this.distanceModel,I.isDirectional=this._isDirectional,I.localDirectionToMesh=this._localDirection.qS(),I.coneInnerAngle=this._coneInnerAngle,I.coneOuterAngle=this._coneOuterAngle,I.coneOuterGain=this._coneOuterGain),I}static Parse(I,O,C,j){const i=I.name;let y;y=I.url?C+I.url:C+i;const S={autoplay:I.autoplay,loop:I.loop,volume:I.volume,spatialSound:I.spatialSound,maxDistance:I.maxDistance,rolloffFactor:I.rolloffFactor,refDistance:I.refDistance,distanceModel:I.distanceModel,playbackRate:I.playbackRate};let U;if(j){const I=()=>{(0,BO.f)((()=>j._isReadyToPlay),(()=>{U._audioBuffer=j.getAudioBuffer(),U._isReadyToPlay=!0,U.autoplay&&U.play(0,U._offset,U._length)}),void 0,300)};U=new FO(i,new ArrayBuffer(0),O,null,S),I()}else U=new FO(i,y,O,(()=>{O.removePendingData(U)}),S),O.addPendingData(U);if(I.position){const O=K.mC.YO(I.position);U.setPosition(O)}if(I.isDirectional&&(U.setDirectionalCone(I.coneInnerAngle||360,I.coneOuterAngle||360,I.coneOuterGain||0),I.localDirectionToMesh)){const O=K.mC.YO(I.localDirectionToMesh);U.setLocalDirectionToMesh(O)}if(I.connectedMeshId){const C=O.getMeshById(I.connectedMeshId);C&&U.attachToMesh(C)}return I.metadata&&(U.metadata=I.metadata),U}_setOffset(I){this._offset!==I&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=I)}_clearTimeoutsAndObservers(){var I;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(I=vO.b.audioEngine)||void 0===I||I.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}FO._SceneComponentInitialization=I=>{throw(0,PO.b)("AudioSceneComponent")},(0,cI.e)("BABYLON.Sound",FO);class RO{constructor(I,O,C){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],O.length!==C.length)throw new Error("Sounds length does not equal weights length");this.loop=I,this._weights=C;let j=0;for(const i of C)j+=i;const K=j>0?1/j:0;for(let i=0;i<this._weights.length;i++)this._weights[i]*=K;this._sounds=O;for(const i of this._sounds)i.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(I){if(I!==this._coneInnerAngle){if(this._coneOuterAngle<I)return void mI.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=I;for(const O of this._sounds)O.directionalConeInnerAngle=I}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(I){if(I!==this._coneOuterAngle){if(I<this._coneInnerAngle)return void mI.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=I;for(const O of this._sounds)O.directionalConeOuterAngle=I}}get volume(){return this._volume}set volume(I){if(I!==this._volume)for(const O of this._sounds)O.setVolume(I)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(I){if(!this.isPaused){this.stop();const I=Math.random();let O=0;for(let C=0;C<this._weights.length;C++)if(O+=this._weights[C],I<=O){this._currentIndex=C;break}}const O=this._sounds[this._currentIndex??0];O.isReady()?O.play(0,this.isPaused?void 0:I):O.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class GO{constructor(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(I=I||q.e.LastCreatedScene)&&(this._scene=I,this.soundCollection=[],this._options=O,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var I;null!==(I=vO.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&vO.b.audioEngine.audioContext&&(this._outputAudioNode=vO.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(vO.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(vO.b.audioEngine&&vO.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(I){var O;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(O=vO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&I.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==I.soundTrackId&&(-1===I.soundTrackId?this._scene.mainSoundTrack.removeSound(I):this._scene.soundTracks&&this._scene.soundTracks[I.soundTrackId].removeSound(I)),this.soundCollection.push(I),I.soundTrackId=this.id}removeSound(I){const O=this.soundCollection.indexOf(I);-1!==O&&this.soundCollection.splice(O,1)}setVolume(I){var O;null!==(O=vO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=I)}switchPanningModelToHRTF(){var I;if(null!==(I=vO.b.audioEngine)&&void 0!==I&&I.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var I;if(null!==(I=vO.b.audioEngine)&&void 0!==I&&I.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToEqualPower()}connectToAnalyser(I){var O;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=I,null!==(O=vO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,vO.b.audioEngine.masterGain))}}var IC=C(12523),OC=C(12487),CC=C(12095);vO.b.AudioEngineFactory=(I,O,C)=>new jC(I,O,C);class jC{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new N.c,this.onAudioLockedObservable=new N.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,CC.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const j=document.createElement("audio");this._hostElement=I,this._audioContext=O,this._audioDestination=C;try{j&&j.canPlayType&&(j.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||j.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(K){}try{j&&j.canPlayType&&j.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(K){}}lock(){this._triggerSuspendedState()}unlock(){var I,O;if("running"===(null===(I=this._audioContext)||void 0===I?void 0:I.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(O=this._audioContext)||void 0===O||O.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{mI.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var I;null===(I=this._audioContext)||void 0===I||I.addEventListener("statechange",(()=>{var I;this.unlocked&&"running"!==(null===(I=this._audioContext)||void 0===I?void 0:I.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var I;return null!==(I=this._audioContext)&&void 0!==I&&I.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(I){this.canUseWebAudio=!1,mI.c.Error("Web Audio: "+I.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(I){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const I=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",O=document.createElement("style");O.appendChild(document.createTextNode(I)),document.getElementsByTagName("head")[0].appendChild(O),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var I;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(I=this._audioContext)||void 0===I||I.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(I){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=I)}connectToAnalyser(I){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=I,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var KC=C(12118);(0,C(13533).g)(IC.d.NAME_AUDIO,((I,O,C,j)=>{let K,i=[];if(C.ls=C.ls||[],void 0!==I.ls&&null!==I.ls)for(let S=0,U=I.ls.length;S<U;S++){var y;const U=I.ls[S];null!==(y=vO.b.audioEngine)&&void 0!==y&&y.canUseWebAudio?(U.url||(U.url=U.name),i[U.url]?C.ls.push(FO.Parse(U,O,j,i[U.url])):(K=FO.Parse(U,O,j),i[U.url]=K,C.ls.push(K))):C.ls.push(new FO(U.name,null,O))}i=[]})),Object.defineProperty(OC.b.prototype,"mainSoundTrack",{get:function(){let I=this._getComponent(IC.d.NAME_AUDIO);return I||(I=new iC(this),this.o(I)),this._mainSoundTrack||(this._mainSoundTrack=new GO(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),OC.b.prototype.getSoundByName=function(I){let O;for(O=0;O<this.mainSoundTrack.soundCollection.length;O++)if(this.mainSoundTrack.soundCollection[O].name===I)return this.mainSoundTrack.soundCollection[O];if(this.soundTracks)for(let C=0;C<this.soundTracks.length;C++)for(O=0;O<this.soundTracks[C].soundCollection.length;O++)if(this.soundTracks[C].soundCollection[O].name===I)return this.soundTracks[C].soundCollection[O];return null},Object.defineProperty(OC.b.prototype,"audioEnabled",{get:function(){let I=this._getComponent(IC.d.NAME_AUDIO);return I||(I=new iC(this),this.o(I)),I.audioEnabled},set:function(I){let O=this._getComponent(IC.d.NAME_AUDIO);O||(O=new iC(this),this.o(O)),I?O.enableAudio():O.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(OC.b.prototype,"headphone",{get:function(){let I=this._getComponent(IC.d.NAME_AUDIO);return I||(I=new iC(this),this.o(I)),I.headphone},set:function(I){let O=this._getComponent(IC.d.NAME_AUDIO);O||(O=new iC(this),this.o(O)),I?O.switchAudioModeForHeadphones():O.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(OC.b.prototype,"audioListenerPositionProvider",{get:function(){let I=this._getComponent(IC.d.NAME_AUDIO);return I||(I=new iC(this),this.o(I)),I.audioListenerPositionProvider},set:function(I){let O=this._getComponent(IC.d.NAME_AUDIO);if(O||(O=new iC(this),this.o(O)),I&&"function"!==typeof I)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");O.audioListenerPositionProvider=I},enumerable:!0,configurable:!0}),Object.defineProperty(OC.b.prototype,"audioListenerRotationProvider",{get:function(){let I=this._getComponent(IC.d.NAME_AUDIO);return I||(I=new iC(this),this.o(I)),I.audioListenerRotationProvider},set:function(I){let O=this._getComponent(IC.d.NAME_AUDIO);if(O||(O=new iC(this),this.o(O)),I&&"function"!==typeof I)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");O.audioListenerRotationProvider=I},enumerable:!0,configurable:!0}),Object.defineProperty(OC.b.prototype,"audioPositioningRefreshRate",{get:function(){let I=this._getComponent(IC.d.NAME_AUDIO);return I||(I=new iC(this),this.o(I)),I.audioPositioningRefreshRate},set:function(I){let O=this._getComponent(IC.d.NAME_AUDIO);O||(O=new iC(this),this.o(O)),O.audioPositioningRefreshRate=I},enumerable:!0,configurable:!0});class iC{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(I){this.name=IC.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new K.mC,this._cachedCameraPosition=new K.mC,this._lastCheck=0,this._invertMatrixTemp=new K.Matrix,this._cameraDirectionTemp=new K.mC,(I=I||q.e.LastCreatedScene)&&(this.hO=I,I.soundTracks=[],I.ls=[])}register(){this.hO._afterRenderStage.registerStep(IC.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(I){if(I.ls=[],this.hO.soundTracks)for(let O=0;O<this.hO.soundTracks.length;O++){const C=this.hO.soundTracks[O];for(let O=0;O<C.soundCollection.length;O++)I.ls.push(C.soundCollection[O].serialize())}}addFromContainer(I){if(I.ls)for(const O of I.ls)O.play(),O.autoplay=!0,this.hO.mainSoundTrack.addSound(O)}removeFromContainer(I){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(I.ls)for(const C of I.ls)C.stop(),C.autoplay=!1,this.hO.mainSoundTrack.removeSound(C),O&&C.dispose()}dispose(){const I=this.hO;if(I._mainSoundTrack&&I.mainSoundTrack.dispose(),I.soundTracks)for(let O=0;O<I.soundTracks.length;O++)I.soundTracks[O].dispose()}disableAudio(){const I=this.hO;let O;for(this._audioEnabled=!1,vO.b.audioEngine&&vO.b.audioEngine.audioContext&&vO.b.audioEngine.audioContext.suspend(),O=0;O<I.mainSoundTrack.soundCollection.length;O++)I.mainSoundTrack.soundCollection[O].pause();if(I.soundTracks)for(O=0;O<I.soundTracks.length;O++)for(let C=0;C<I.soundTracks[O].soundCollection.length;C++)I.soundTracks[O].soundCollection[C].pause()}enableAudio(){const I=this.hO;let O;for(this._audioEnabled=!0,vO.b.audioEngine&&vO.b.audioEngine.audioContext&&vO.b.audioEngine.audioContext.resume(),O=0;O<I.mainSoundTrack.soundCollection.length;O++)I.mainSoundTrack.soundCollection[O].isPaused&&I.mainSoundTrack.soundCollection[O].play();if(I.soundTracks)for(O=0;O<I.soundTracks.length;O++)for(let C=0;C<I.soundTracks[O].soundCollection.length;C++)I.soundTracks[O].soundCollection[C].isPaused&&I.soundTracks[O].soundCollection[C].play()}switchAudioModeForHeadphones(){const I=this.hO;if(this._headphone=!0,I.mainSoundTrack.switchPanningModelToHRTF(),I.soundTracks)for(let O=0;O<I.soundTracks.length;O++)I.soundTracks[O].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const I=this.hO;if(this._headphone=!1,I.mainSoundTrack.switchPanningModelToEqualPower(),I.soundTracks)for(let O=0;O<I.soundTracks.length;O++)I.soundTracks[O].switchPanningModelToEqualPower()}_afterRender(){const I=KC.c.Now;if(this._lastCheck&&I-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=I;const O=this.hO;if(!this._audioEnabled||!O._mainSoundTrack||!O.soundTracks||0===O._mainSoundTrack.soundCollection.length&&1===O.soundTracks.length)return;const C=vO.b.audioEngine;if(C&&C.audioContext){let I,j=O.activeCamera;if(O.activeCameras&&O.activeCameras.length>0&&(j=O.activeCameras[0]),this.audioListenerPositionProvider){const I=this.audioListenerPositionProvider();C.audioContext.listener.setPosition(I.x||0,I.y||0,I.z||0)}else j?this._cachedCameraPosition.equals(j.globalPosition)||(this._cachedCameraPosition.K(j.globalPosition),C.audioContext.listener.setPosition(j.globalPosition.x,j.globalPosition.y,j.globalPosition.z)):C.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const I=this.audioListenerRotationProvider();C.audioContext.listener.setOrientation(I.x||0,I.y||0,I.z||0,0,1,0)}else j?(j.rigCameras&&j.rigCameras.length>0&&(j=j.rigCameras[0]),j.getViewMatrix().invertToRef(this._invertMatrixTemp),K.mC.TransformNormalToRef(iC._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.K(this._cameraDirectionTemp),C.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):C.audioContext.listener.setOrientation(0,0,0,0,1,0);for(I=0;I<O.mainSoundTrack.soundCollection.length;I++){const C=O.mainSoundTrack.soundCollection[I];C.useCustomAttenuation&&C.updateDistanceFromListener()}if(O.soundTracks)for(I=0;I<O.soundTracks.length;I++)for(let C=0;C<O.soundTracks[I].soundCollection.length;C++){const j=O.soundTracks[I].soundCollection[C];j.useCustomAttenuation&&j.updateDistanceFromListener()}}}}iC._CameraDirection=new K.mC(0,0,-1),FO._SceneComponentInitialization=I=>{let O=I._getComponent(IC.d.NAME_AUDIO);O||(O=new iC(I),I.o(O))};const yC="MSFT_audio_emitter";class SC{constructor(I){this.name=yC,this._loader=I,this.enabled=this._loader.isExtensionUsed(yC)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const I=this._loader.NS.extensions;if(I&&I[this.name]){const O=I[this.name];this._clips=O.clips,this._emitters=O.emitters,V.Assign(this._clips),V.Assign(this._emitters)}}loadSceneAsync(I,O){return L.LoadExtensionAsync(I,O,this.name,(async(C,j)=>{const K=new Array;K.push(this._loader.loadSceneAsync(I,O));for(const I of j.emitters){const O=V.Get(`${C}/emitters`,this._emitters,I);if(void 0!=O.refDistance||void 0!=O.maxDistance||void 0!=O.rolloffFactor||void 0!=O.distanceModel||void 0!=O.innerAngle||void 0!=O.outerAngle)throw new Error(`${C}: Direction or Distance properties are not allowed on emitters attached to a scene`);K.push(this._loadEmitterAsync(`${C}/emitters/${O.index}`,O))}await Promise.all(K)}))}loadNodeAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(I,j)=>{const i=new Array,S=await this._loader.loadNodeAsync(I,O,(O=>{for(const C of j.emitters){const j=V.Get(`${I}/emitters`,this._emitters,C);i.push(this._loadEmitterAsync(`${I}/emitters/${j.index}`,j).then((()=>{for(const I of j._babylonSounds)I.attachToMesh(O),void 0==j.innerAngle&&void 0==j.outerAngle||(I.setLocalDirectionToMesh(K.mC.Forward()),I.setDirectionalCone(2*y.Tools.ToDegrees(void 0==j.innerAngle?Math.PI:j.innerAngle),2*y.Tools.ToDegrees(void 0==j.outerAngle?Math.PI:j.outerAngle),0))})))}C(O)}));return await Promise.all(i),S}))}loadAnimationAsync(I,O){return L.LoadExtensionAsync(I,O,this.name,(async(C,j)=>{const K=await this._loader.loadAnimationAsync(I,O),i=new Array;V.Assign(j.events);for(const y of j.events)i.push(this._loadAnimationEventAsync(`${C}/events/${y.index}`,I,O,y,K));return await Promise.all(i),K}))}_loadClipAsync(I,O){if(O._objectURL)return O._objectURL;let C;if(O.uri)C=this._loader.loadUriAsync(I,O,O.uri);else{const j=V.Get(`${I}/bufferView`,this._loader.NS.bufferViews,O.bufferView);C=this._loader.loadBufferViewAsync(`/bufferViews/${j.index}`,j)}return O._objectURL=C.then((I=>URL.createObjectURL(new Blob([I],{type:O.mimeType})))),O._objectURL}_loadEmitterAsync(I,O){if(O._babylonSounds=O._babylonSounds||[],!O._babylonData){const I=new Array,C=O.name||`emitter${O.index}`,j={loop:!1,autoplay:!1,volume:void 0==O.volume?1:O.volume};for(let i=0;i<O.clips.length;i++){const K=`/extensions/${this.name}/clips`,y=V.Get(K,this._clips,O.clips[i].clip);I.push(this._loadClipAsync(`${K}/${O.clips[i].clip}`,y).then((I=>{const K=O._babylonSounds[i]=new FO(C,I,this._loader.babylonScene,null,j);K.refDistance=O.refDistance||1,K.maxDistance=O.maxDistance||256,K.rolloffFactor=O.rolloffFactor||1,K.distanceModel=O.distanceModel||"exponential"})))}const K=Promise.all(I).then((()=>{const I=O.clips.map((I=>I.weight||1)),C=new RO(O.loop||!1,O._babylonSounds,I);O.innerAngle&&(C.directionalConeInnerAngle=2*y.Tools.ToDegrees(O.innerAngle)),O.outerAngle&&(C.directionalConeOuterAngle=2*y.Tools.ToDegrees(O.outerAngle)),O.volume&&(C.volume=O.volume),O._babylonData.sound=C}));O._babylonData={loaded:K}}return O._babylonData.loaded}_getEventAction(I,O,C,j,K){switch(C){case"play":return I=>{const C=(K||0)+(I-j);O.play(C)};case"stop":return()=>{O.stop()};case"pause":return()=>{O.pause()};default:throw new Error(`${I}: Unsupported action ${C}`)}}_loadAnimationEventAsync(I,O,C,j,K){if(0==K.targetedAnimations.length)return Promise.resolve();const i=K.targetedAnimations[0],y=j.KO,S=V.Get(`/extensions/${this.name}/emitters`,this._emitters,y);return this._loadEmitterAsync(I,S).then((()=>{const O=S._babylonData.sound;if(O){const C=new AO(j.time,this._getEventAction(I,O,j.action,j.time,j.startOffset));i.animation.addEvent(C),K.onAnimationGroupEndObservable.add((()=>{O.stop()})),K.onAnimationGroupPauseObservable.add((()=>{O.pause()}))}}))}}t(yC),D(yC,!0,(I=>new SC(I)));const UC="MSFT_lod";class pC{constructor(I){var O;this.name=UC,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new N.c,this.onMaterialLODsLoadedObservable=new N.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=I,this.maxLODsToLoad=(null===(O=this._loader.parent.extensionOptions[UC])||void 0===O?void 0:O.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(UC)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let I=0;I<this._nodePromiseLODs.length;I++){const O=Promise.all(this._nodePromiseLODs[I]).then((()=>{0!==I&&(this._loader.endPerformanceCounter(`Node LOD ${I}`),this._loader.log(`Loaded node LOD ${I}`)),this.onNodeLODsLoadedObservable.notifyObservers(I),I!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${I+1}`),this._loadBufferLOD(this._nodeBufferLODs,I+1),this._nodeSignalLODs[I]&&this._nodeSignalLODs[I].resolve())}));this._loader._completePromises.push(O)}for(let I=0;I<this._materialPromiseLODs.length;I++){const O=Promise.all(this._materialPromiseLODs[I]).then((()=>{0!==I&&(this._loader.endPerformanceCounter(`Material LOD ${I}`),this._loader.log(`Loaded material LOD ${I}`)),this.onMaterialLODsLoadedObservable.notifyObservers(I),I!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${I+1}`),this._loadBufferLOD(this._materialBufferLODs,I+1),this._materialSignalLODs[I]&&this._materialSignalLODs[I].resolve())}));this._loader._completePromises.push(O)}}loadSceneAsync(I,O){const C=this._loader.loadSceneAsync(I,O);return this._loadBufferLOD(this._bufferLODs,0),C}loadNodeAsync(I,O,C){return L.LoadExtensionAsync(I,O,this.name,(async(I,K)=>{let i;const y=this._getLODs(I,O,this._loader.NS.nodes,K.ids);this._loader.logOpen(`${I}`);for(let O=0;O<y.length;O++){const I=y[O];0!==O&&(this._nodeIndexLOD=O,this._nodeSignalLODs[O]=this._nodeSignalLODs[O]||new j);const K=I=>{C(I),I.AS(!1)},S=this._loader.loadNodeAsync(`/nodes/${I.index}`,I,K).then((I=>{if(0!==O){const I=y[O-1];I._babylonTransformNode&&(this._disposeTransformNode(I._babylonTransformNode),delete I._babylonTransformNode)}return I.AS(!0),I}));this._nodePromiseLODs[O]=this._nodePromiseLODs[O]||[],0===O?i=S:(this._nodeIndexLOD=null,this._nodePromiseLODs[O].push(S))}return this._loader.logClose(),await i}))}_loadMaterialAsync(I,O,C,j,K){return this._nodeIndexLOD?null:L.LoadExtensionAsync(I,O,this.name,(async(I,i)=>{let y;const S=this._getLODs(I,O,this._loader.NS.materials,i.ids);this._loader.logOpen(`${I}`);for(let O=0;O<S.length;O++){const I=S[O];0!==O&&(this._materialIndexLOD=O);const i=this._loader._loadMaterialAsync(`/materials/${I.index}`,I,C,j,(I=>{0===O&&K(I)})).then((I=>{if(0!==O){K(I);const C=S[O-1]._data;C[j]&&(this._disposeMaterials([C[j].babylonMaterial]),delete C[j])}return I}));this._materialPromiseLODs[O]=this._materialPromiseLODs[O]||[],0===O?y=i:(this._materialIndexLOD=null,this._materialPromiseLODs[O].push(i))}return this._loader.logClose(),await y}))}_loadUriAsync(I,O,C){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const K=this._nodeIndexLOD-1;return this._nodeSignalLODs[K]=this._nodeSignalLODs[K]||new j,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(I,O,C)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const K=this._materialIndexLOD-1;return this._materialSignalLODs[K]=this._materialSignalLODs[K]||new j,this._materialSignalLODs[K].promise.then((async()=>await this._loader.loadUriAsync(I,O,C)))}return null}loadBufferAsync(I,O,C,K){if(this._loader.parent.useRangeRequests&&!O.uri){if(!this._loader.bin)throw new Error(`${I}: Uri is missing or the binary glTF is missing its binary chunk`);const O=async(I,O)=>{const i=C,y=i+K-1;let S=I[O];return S?(S.start=Math.min(S.start,i),S.end=Math.max(S.end,y)):(S={start:i,end:y,loaded:new j},I[O]=S),await S.loaded.promise.then((I=>new Uint8Array(I.buffer,I.byteOffset+C-S.start,K)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?O(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?O(this._materialBufferLODs,this._materialIndexLOD):O(this._bufferLODs,0)}return null}_loadBufferLOD(I,O){const C=I[O];C&&(this._loader.log(`Loading buffer range [${C.start}-${C.end}]`),this._loader.bin.readAsync(C.start,C.end-C.start+1).then((I=>{C.loaded.resolve(I)}),(I=>{C.loaded.reject(I)})))}_getLODs(I,O,C,j){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const K=[];for(let i=j.length-1;i>=0;i--)if(K.push(V.Get(`${I}/ids/${j[i]}`,C,j[i])),K.length===this.maxLODsToLoad)return K;return K.push(O),K}_disposeTransformNode(I){const O=[],C=I.material;C&&O.push(C);for(const K of I.getChildMeshes())K.material&&O.push(K.material);I.dispose();const j=O.filter((I=>this._loader.babylonScene.meshes.every((O=>O.material!=I))));this._disposeMaterials(j)}_disposeMaterials(I){const O={};for(const C of I){for(const I of C.getActiveTextures())O[I.uniqueId]=I;C.dispose()}for(const C in O)for(const I of this._loader.babylonScene.materials)I.hasTexture(O[C])&&delete O[C];for(const C in O)O[C].dispose()}}t(UC),D(UC,!0,(I=>new pC(I)));const NC="MSFT_minecraftMesh";class QC{constructor(I){this.name=NC,this._loader=I,this.enabled=this._loader.isExtensionUsed(NC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtraAsync(I,O,this.name,(async(j,K)=>{if(K){if(!(C instanceof W.c))throw new Error(`${j}: Material type not supported`);const K=this._loader.loadMaterialPropertiesAsync(I,O,C);return C.needAlphaBlending()&&(C.forceDepthWrite=!0,C.separateCullingPass=!0),C.oS=C.forceDepthWrite,C.twoSidedLighting=!0,await K}}))}}t(NC),D(NC,!0,(I=>new QC(I)));const sC="MSFT_sRGBFactors";class ZC{constructor(I){this.name=sC,this._loader=I,this.enabled=this._loader.isExtensionUsed(sC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,O,C){return L.LoadExtraAsync(I,O,this.name,(async(j,K)=>{if(K){if(!(C instanceof W.c))throw new Error(`${j}: Material type not supported`);const K=this._loader.loadMaterialPropertiesAsync(I,O,C),i=C.nI().getEngine().useExactSrgbConversions;return C.albedoTexture||C.albedoColor.toLinearSpaceToRef(C.albedoColor,i),C.reflectivityTexture||C.reflectivityColor.toLinearSpaceToRef(C.reflectivityColor,i),await K}}))}}t(sC),D(sC,!0,(I=>new ZC(I)));var qC=C(13866);const mj={};var EC=C(13931),hC=C(13901),rC=C(13869),WC=C(13886);function YC(I,O){for(const C of I)for(const I of C.dataOutputs)if(I.uniqueId===O)return I;throw new Error("Could not find data out connection with unique id "+O)}function oC(I,O){for(const C of I)if(C instanceof hC.b)for(const I of C.signalInputs)if(I.uniqueId===O)return I;throw new Error("Could not find signal in connection with unique id "+O)}async function cC(I,O){const j=await Promise.all(I.allBlocks.map((async I=>{const O=function(I){switch(I){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([C.e(78),C.e(79)]).then(C.bind(C,15307))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await C.e(80).then(C.bind(C,15310))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await C.e(81).then(C.bind(C,15316))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await C.e(82).then(C.bind(C,15319))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await C.e(83).then(C.bind(C,15327))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await C.e(84).then(C.bind(C,15332))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await C.e(85).then(C.bind(C,15334))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await C.e(86).then(C.bind(C,15340))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await C.e(87).then(C.bind(C,15349))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await C.e(89).then(C.bind(C,15379))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await C.e(89).then(C.bind(C,15379))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await C.e(89).then(C.bind(C,15379))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await C.e(89).then(C.bind(C,15379))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await C.e(89).then(C.bind(C,15379))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await C.e(89).then(C.bind(C,15379))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await C.e(90).then(C.bind(C,15384))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await C.e(90).then(C.bind(C,15384))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await C.e(90).then(C.bind(C,15384))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await C.e(90).then(C.bind(C,15384))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await C.e(95).then(C.bind(C,15393))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await C.e(96).then(C.bind(C,15400))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await C.e(97).then(C.bind(C,15402))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await C.e(98).then(C.bind(C,15408))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await C.e(99).then(C.bind(C,15417))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await C.e(100).then(C.bind(C,15422))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await C.e(101).then(C.bind(C,15424))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await C.e(102).then(C.bind(C,15429))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await C.e(103).then(C.bind(C,15432))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await C.e(104).then(C.bind(C,15436))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await C.e(105).then(C.bind(C,15442))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await C.e(106).then(C.bind(C,15449))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await C.e(107).then(C.bind(C,15458))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await C.e(108).then(C.bind(C,15467))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await C.e(109).then(C.bind(C,15476))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await C.e(110).then(C.bind(C,15484))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await C.e(111).then(C.bind(C,15488))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await C.e(112).then(C.bind(C,15492))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await C.e(113).then(C.bind(C,15496))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await C.e(92).then(C.bind(C,15498))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await C.e(114).then(C.bind(C,15501))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await C.e(115).then(C.bind(C,15505))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await C.e(116).then(C.bind(C,15511))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await C.e(93).then(C.bind(C,15516))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await C.e(88).then(C.bind(C,15357))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await C.e(94).then(C.bind(C,15523))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await C.e(94).then(C.bind(C,15523))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await C.e(94).then(C.bind(C,15523))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await C.e(94).then(C.bind(C,15523))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await C.e(94).then(C.bind(C,15523))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await C.e(94).then(C.bind(C,15523))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await C.e(94).then(C.bind(C,15523))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await C.e(94).then(C.bind(C,15523))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await C.e(89).then(C.bind(C,15379))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await C.e(89).then(C.bind(C,15379))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await C.e(89).then(C.bind(C,15379))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await C.e(89).then(C.bind(C,15379))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await C.e(89).then(C.bind(C,15379))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await C.e(89).then(C.bind(C,15379))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await C.e(89).then(C.bind(C,15379))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await C.e(90).then(C.bind(C,15384))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await C.e(90).then(C.bind(C,15384))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await C.e(91).then(C.bind(C,15529))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await C.e(91).then(C.bind(C,15529))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await C.e(91).then(C.bind(C,15529))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await C.e(91).then(C.bind(C,15529))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await C.e(91).then(C.bind(C,15529))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await C.e(91).then(C.bind(C,15529))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await C.e(117).then(C.bind(C,15532))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await C.e(118).then(C.bind(C,15538))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await C.e(119).then(C.bind(C,15547))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await C.e(120).then(C.bind(C,15552))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await C.e(121).then(C.bind(C,15555))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await C.e(122).then(C.bind(C,15563))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await C.e(123).then(C.bind(C,15570))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await C.e(124).then(C.bind(C,15577))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await C.e(125).then(C.bind(C,15586))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await C.e(126).then(C.bind(C,15590))).FlowGraphDataSwitchBlock;default:if(mj[I])return mj[I];throw new Error(`Unknown block name ${I}`)}}(I.className);return await O()})));return function(I,O,C){const j=O.coordinator.createGraph(),K=[],i=O.valueParseFunction??rC.e;for(let y=0;y<I.allBlocks.length;y++){const S=XC(I.allBlocks[y],{hO:O.coordinator.config.hO,pathConverter:O.pathConverter,assetsContainer:O.coordinator.config.hO,valueParseFunction:i},C[y]);K.push(S),S instanceof EC.b&&j.addEventBlock(S)}for(const y of K){for(const I of y.dataInputs)for(const O of I.connectedPointIds){const C=YC(K,O);I.connectTo(C)}if(y instanceof hC.b)for(const I of y.signalOutputs)for(const O of I.connectedPointIds){const C=oC(K,O);I.connectTo(C)}}for(const y of I.executionContexts)nC(y,{graph:j,valueParseFunction:i},I.rightHanded);return j}(I,O,j)}function nC(I,O,C){const j=O.graph.createContext();I.enableLogging&&(j.enableLogging=!0),j.treatDataAsRightHanded=C||!1;const K=O.valueParseFunction??rC.e;j.uniqueId=I.uniqueId;const i=j.nI();if(I._assetsContext){var y,S,U,p,N,Q,s,Z,q,mI;const O=I._assetsContext,C={meshes:null===(y=O.meshes)||void 0===y?void 0:y.map((I=>i.getMeshById(I))),lights:null===(S=O.lights)||void 0===S?void 0:S.map((I=>i.getLightByName(I))),cameras:null===(U=O.cameras)||void 0===U?void 0:U.map((I=>i.getCameraByName(I))),materials:null===(p=O.materials)||void 0===p?void 0:p.map((I=>i.getMaterialById(I))),textures:null===(N=O.textures)||void 0===N?void 0:N.map((I=>i.getTextureByName(I))),animations:null===(Q=O.animations)||void 0===Q?void 0:Q.map((I=>i.animations.find((O=>O.name===I)))),skeletons:null===(s=O.skeletons)||void 0===s?void 0:s.map((I=>i.getSkeletonByName(I))),RQ:null===(Z=O.RQ)||void 0===Z?void 0:Z.map((I=>i.getParticleSystemById(I))),animationGroups:null===(q=O.animationGroups)||void 0===q?void 0:q.map((I=>i.getAnimationGroupByName(I))),transformNodes:null===(mI=O.transformNodes)||void 0===mI?void 0:mI.map((I=>i.getTransformNodeById(I))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],ls:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};j.assetsContext=C}for(const E in I._userVariables){const O=K(E,I._userVariables,j.assetsContext,i);j.userVariables[E]=O}for(const E in I._connectionValues){const O=K(E,I._connectionValues,j.assetsContext,i);j._setConnectionValueByKey(E,O)}return j}function XC(I,O,C){const j={},K=O.valueParseFunction??rC.e;if(I.config)for(const y in I.config)j[y]=K(y,I.config,O.assetsContainer||O.hO,O.hO);if((0,rC.i)(I.className)){if(!O.pathConverter)throw new Error("Path converter is required for this block");j.pathConverter=O.pathConverter}const i=new C(j);i.uniqueId=I.uniqueId;for(let y=0;y<I.dataInputs.length;y++){const O=i.getDataInput(I.dataInputs[y].name);if(!O)throw new Error("Could not find data input with name "+I.dataInputs[y].name+" in block "+I.className);O.deserialize(I.dataInputs[y])}for(let y=0;y<I.dataOutputs.length;y++){const O=i.getDataOutput(I.dataOutputs[y].name);if(!O)throw new Error("Could not find data output with name "+I.dataOutputs[y].name+" in block "+I.className);O.deserialize(I.dataOutputs[y])}return i.metadata=I.metadata,i.deserialize&&i.deserialize(I),i}function TC(I){const[O,C]=I.split(":");return HC({op:O,extension:C})}function HC(I){var O;let C=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const j=I.extension?null===(O=aC[I.extension])||void 0===O?void 0:O[I.op]:MC[I.op];if(!j&&(mI.c.Warn(`No mapping found for operation ${I.op} and extension ${I.extension||"KHR_interactivity"}`),C)){const O={},C={flows:{}};if(I.inputValueSockets){O.values={};for(const C in I.inputValueSockets)O.values[C]={name:C}}return I.outputValueSockets&&(C.values={},Object.keys(I.outputValueSockets).forEach((I=>{C.values[I]={name:I}}))),{EN:[],inputs:O,outputs:C}}return j}function bC(I,O,C){aC[O]||(aC[O]={}),aC[O][I]=C}const aC={BABYLON:{"flow/log":{EN:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},MC={"event/onStart":{EN:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{EN:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{EN:["FlowGraphSendCustomEventBlock"],extraProcessor(I,O,C,j,K){if("event/send"!==O.op||!I.configuration||1!==Object.keys(I.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const i=I.configuration.event.value[0];if("number"!==typeof i)throw new Error("Event id should be a number");const y=j.arrays.events[i],S=K[0];return S.config||(S.config={}),S.config.eventId=y.eventId,S.config.eventData=y.eventData,K}},"event/receive":{EN:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(I,O){var C;if(!I.configuration)return mI.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const j=I.configuration.event;if(!j)return mI.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const K=j.value[0];if("number"!==typeof K)return mI.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(C=O.events)||void 0===C?void 0:C[K])?{valid:!0}:(mI.c.Error(`Event with id ${K} not found`),{valid:!1,error:`Event with id ${K} not found`})},extraProcessor(I,O,C,j,K){if("event/receive"!==O.op||!I.configuration||1!==Object.keys(I.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const i=I.configuration.event.value[0];if("number"!==typeof i)throw new Error("Event id should be a number");const y=j.arrays.events[i],S=K[0];return S.config||(S.config={}),S.config.eventId=y.eventId,S.config.eventData=y.eventData,K}},"math/e":uC("FlowGraphEBlock"),"math/pi":uC("FlowGraphPIBlock"),"math/inf":uC("FlowGraphInfBlock"),"math/nan":uC("FlowGraphNaNBlock"),"math/abs":uC("FlowGraphAbsBlock"),"math/sign":uC("FlowGraphSignBlock"),"math/trunc":uC("FlowGraphTruncBlock"),"math/floor":uC("FlowGraphFloorBlock"),"math/ceil":uC("FlowGraphCeilBlock"),"math/round":{EN:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,O,C,j,K){var i;return(i=K[0]).config||(i.config={}),K[0].config.roundHalfAwayFromZero=!0,K}},"math/fract":uC("FlowGraphFractBlock"),"math/neg":uC("FlowGraphNegationBlock"),"math/add":uC("FlowGraphAddBlock",["a","b"],!0),"math/sub":uC("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{EN:["FlowGraphMultiplyBlock"],extraProcessor(I,O,C,j,K){var i;(i=K[0]).config||(i.config={}),K[0].config.useMatrixPerComponent=!0,K[0].config.preventIntegerFloatArithmetic=!0;let y=-1;return Object.keys(I.values||{}).find((O=>{var C;return void 0!==(null===(C=I.values)||void 0===C?void 0:C[O].type)&&(y=I.values[O].type,!0)})),-1!==y&&(K[0].config.type=j.arrays.types[y].flowGraphType),K},validation:I=>I.values?JC(I):{valid:!0}},"math/div":uC("FlowGraphDivideBlock",["a","b"],!0),"math/rem":uC("FlowGraphModuloBlock",["a","b"]),"math/min":uC("FlowGraphMinBlock",["a","b"]),"math/max":uC("FlowGraphMaxBlock",["a","b"]),"math/clamp":uC("FlowGraphClampBlock",["a","b","c"]),"math/saturate":uC("FlowGraphSaturateBlock"),"math/mix":uC("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":uC("FlowGraphEqualityBlock",["a","b"]),"math/lt":uC("FlowGraphLessThanBlock",["a","b"]),"math/le":uC("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":uC("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":uC("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":uC("FlowGraphIsNaNBlock"),"math/isinf":uC("FlowGraphIsInfBlock"),"math/select":{EN:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{EN:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":uC("FlowGraphSinBlock"),"math/cos":uC("FlowGraphCosBlock"),"math/tan":uC("FlowGraphTanBlock"),"math/asin":uC("FlowGraphASinBlock"),"math/acos":uC("FlowGraphACosBlock"),"math/atan":uC("FlowGraphATanBlock"),"math/atan2":uC("FlowGraphATan2Block",["a","b"]),"math/sinh":uC("FlowGraphSinhBlock"),"math/cosh":uC("FlowGraphCoshBlock"),"math/tanh":uC("FlowGraphTanhBlock"),"math/asinh":uC("FlowGraphASinhBlock"),"math/acosh":uC("FlowGraphACoshBlock"),"math/atanh":uC("FlowGraphATanhBlock"),"math/exp":uC("FlowGraphExponentialBlock"),"math/log":uC("FlowGraphLogBlock"),"math/log2":uC("FlowGraphLog2Block"),"math/log10":uC("FlowGraphLog10Block"),"math/sqrt":uC("FlowGraphSquareRootBlock"),"math/cbrt":uC("FlowGraphCubeRootBlock"),"math/pow":uC("FlowGraphPowerBlock",["a","b"]),"math/length":uC("FlowGraphLengthBlock"),"math/normalize":uC("FlowGraphNormalizeBlock"),"math/dot":uC("FlowGraphDotBlock",["a","b"]),"math/cross":uC("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":uC("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":uC("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{EN:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{EN:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{EN:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{EN:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{EN:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{EN:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{EN:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":uC("FlowGraphTransposeBlock"),"math/determinant":uC("FlowGraphDeterminantBlock"),"math/inverse":uC("FlowGraphInvertMatrixBlock"),"math/matmul":uC("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{EN:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"nS",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,O,C,j,K,i){const y=K[0].dataInputs.find((I=>"rotationQuaternion"===I.name));if(!y)throw new Error("Rotation quaternion input not found");return i._connectionValues[y.uniqueId]&&(i._connectionValues[y.uniqueId].type="Quaternion"),K}},"math/matDecompose":{EN:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"nS"}}}},"math/quatConjugate":uC("FlowGraphConjugateBlock",["a"]),"math/quatMul":{EN:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,O,C,j,K){var i;return(i=K[0]).config||(i.config={}),K[0].config.type="Quaternion",K}},"math/quatAngleBetween":uC("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{EN:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":uC("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":uC("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{EN:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,O,C,j,K){var i;return(i=K[0]).config||(i.config={}),K[0].config.inputIsColumnMajor=!0,K}},"math/extract2x2":{EN:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{EN:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,O,C,j,K){var i;return(i=K[0]).config||(i.config={}),K[0].config.inputIsColumnMajor=!0,K}},"math/extract3x3":{EN:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{EN:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,O,C,j,K){var i;return(i=K[0]).config||(i.config={}),K[0].config.inputIsColumnMajor=!0,K}},"math/extract4x4":{EN:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{EN:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,O,C,j,K,i){var y,S;(S=K[0]).config||(S.config={});const U=K[0].dataInputs[0];return K[0].config.valueType=(null===(y=i._connectionValues[U.uniqueId])||void 0===y?void 0:y.type)??"FlowGraphInteger",K}},"math/and":{EN:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,O,C,j,K,i){var y,S,U;(U=K[0]).config||(U.config={});const p=K[0].dataInputs[0],N=K[0].dataInputs[1];return K[0].config.valueType=(null===(y=i._connectionValues[p.uniqueId])||void 0===y?void 0:y.type)??(null===(S=i._connectionValues[N.uniqueId])||void 0===S?void 0:S.type)??"FlowGraphInteger",K}},"math/or":{EN:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,O,C,j,K,i){var y,S,U;(U=K[0]).config||(U.config={});const p=K[0].dataInputs[0],N=K[0].dataInputs[1];return K[0].config.valueType=(null===(y=i._connectionValues[p.uniqueId])||void 0===y?void 0:y.type)??(null===(S=i._connectionValues[N.uniqueId])||void 0===S?void 0:S.type)??"FlowGraphInteger",K}},"math/xor":{EN:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,O,C,j,K,i){var y,S,U;(U=K[0]).config||(U.config={});const p=K[0].dataInputs[0],N=K[0].dataInputs[1];return K[0].config.valueType=(null===(y=i._connectionValues[p.uniqueId])||void 0===y?void 0:y.type)??(null===(S=i._connectionValues[N.uniqueId])||void 0===S?void 0:S.type)??"FlowGraphInteger",K}},"math/asr":uC("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":uC("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":uC("FlowGraphLeadingZerosBlock"),"math/ctz":uC("FlowGraphTrailingZerosBlock"),"math/popcnt":uC("FlowGraphOneBitsCounterBlock"),"math/rad":uC("FlowGraphDegToRadBlock"),"math/deg":uC("FlowGraphRadToDegBlock"),"type/boolToInt":uC("FlowGraphBooleanToInt"),"type/boolToFloat":uC("FlowGraphBooleanToFloat"),"type/intToBool":uC("FlowGraphIntToBoolean"),"type/intToFloat":uC("FlowGraphIntToFloat"),"type/floatToInt":uC("FlowGraphFloatToInt"),"type/floatToBool":uC("FlowGraphFloatToBoolean"),"flow/sequence":{EN:["FlowGraphSequenceBlock"],extraProcessor(I,O,C,j,K){const i=K[0];return i.config||(i.config={}),i.config.outputSignalCount=Object.keys(I.flows||[]).length,i.signalOutputs.forEach(((I,O)=>{I.name="out_"+O})),K}},"flow/branch":{EN:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{EN:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(I){if(I.configuration&&I.configuration.cases){const O=I.configuration.cases.value;if(!O.every((I=>"number"===typeof I&&/^-?\d+$/.test(I.toString()))))return mI.c.Warn("Switch cases should be integers. Using empty array instead."),I.configuration.cases.value=[],{valid:!0};const C=new Set(O);I.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(I,O,C,j,K){if("flow/switch"!==O.op||!I.flows||0===Object.keys(I.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return K[0].signalOutputs.forEach((I=>{"default"!==I.name&&(I.name="out_"+I.name)})),K}},"flow/while":{EN:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{EN:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(I,O,C,j,K){const i=K[0];return i.config||(i.config={}),i.config.incrementIndexWhenLoopDone=!0,K}},"flow/doN":{EN:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{EN:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(I,O,C,j,K){if("flow/multiGate"!==O.op||!I.flows||0===Object.keys(I.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const i=K[0];return i.config||(i.config={}),i.config.outputSignalCount=Object.keys(I.flows).length,i.signalOutputs.forEach(((I,O)=>{I.name="out_"+O})),K}},"flow/waitAll":{EN:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(I){var O,C;return"number"!==typeof(null===(O=I.configuration)||void 0===O||null===(C=O.inputFlows)||void 0===C?void 0:C.value[0])&&(I.configuration=I.configuration||{inputFlows:{value:[0]}},I.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{EN:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{EN:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{EN:["FlowGraphCancelDelayBlock"]},"variable/get":{EN:["FlowGraphGetVariableBlock"],validation(I){var O,C;return null!==(O=I.configuration)&&void 0!==O&&null!==(C=O.variable)&&void 0!==C&&C.value?{valid:!0}:(mI.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(I,O)=>[O.getVariableName(I[0])]}}},"variable/set":{EN:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(I,O)=>[O.getVariableName(I[0])]}}},"variable/setMultiple":{EN:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(I,O)=>[I[0].map((I=>O.getVariableName(I)))]}},extraProcessor:(I,O,C,j,K)=>(K[0].dataInputs.forEach((I=>{I.name=j.getVariableName(+I.name)})),K)},"variable/interpolate":{EN:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(I,O)=>[O.getVariableName(I[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:I=>!0===I[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",rC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",rC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",rC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",rC:"FlowGraphPlayAnimationBlock"},out:{name:"out",rC:"FlowGraphPlayAnimationBlock"},done:{name:"done",rC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(I,O,C,j,K){var i,y,S;const U=K[0],p=null===(i=I.configuration)||void 0===i?void 0:i.variable.value[0];if("number"!==typeof p)throw mI.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const N=j.arrays.staticVariables[p];"undefined"===typeof U.config.animationType.value&&(j.arrays.staticVariables,U.config.animationType.value=(0,WC.J)(N.type));const Q=K[4];return Q.config||(Q.config={}),(y=Q.config).variable||(y.variable={}),Q.config.variable.value=j.getVariableName(p),(S=K[3]).config||(S.config={}),K}},"pointer/get":{EN:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",rC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",rC:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(I,O,C,j,K)=>(K.forEach((I=>{"FlowGraphJsonPointerParserBlock"===I.className&&(I.config||(I.config={}),I.config.outputValue=!0)})),K)},"pointer/set":{EN:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",rC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",rC:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(I,O,C,j,K)=>(K.forEach((I=>{"FlowGraphJsonPointerParserBlock"===I.className&&(I.config||(I.config={}),I.config.outputValue=!0)})),K)},"pointer/interpolate":{EN:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",rC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",rC:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",rC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",rC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",rC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",rC:"FlowGraphPlayAnimationBlock"},out:{name:"out",rC:"FlowGraphPlayAnimationBlock"},done:{name:"done",rC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(I,O,C,j,K)=>(K.forEach((O=>{"FlowGraphJsonPointerParserBlock"===O.className?(O.config||(O.config={}),O.config.outputValue=!0):"FlowGraphInterpolationBlock"===O.className&&(O.config||(O.config={}),Object.keys(I.values||[]).forEach((C=>{var K;const i=null===(K=I.values)||void 0===K?void 0:K[C];if("value"===C&&i){const I=i.type;void 0!==I&&(O.config.animationType=j.arrays.types[I].flowGraphType)}})))})),K)},"animation/start":{EN:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",rC:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(I,O)=>[I[0]*O._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(I,O)=>[I[0]*O._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(I,O,C,j,K,i,y){const S=K[K.length-1];return S.config||(S.config={}),S.config.glTF=y,K}},"animation/stop":{EN:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",rC:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(I,O,C,j,K,i,y){const S=K[K.length-1];return S.config||(S.config={}),S.config.glTF=y,K}},"animation/stopAt":{EN:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",rC:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(I,O)=>[I[0]*O._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(I,O,C,j,K,i,y){const S=K[K.length-1];return S.config||(S.config={}),S.config.glTF=y,K}},"math/switch":{EN:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(I){if(I.configuration&&I.configuration.cases){const O=I.configuration.cases.value;if(!O.every((I=>"number"===typeof I&&/^-?\d+$/.test(I.toString()))))return mI.c.Warn("Switch cases should be integers. Using empty array instead."),I.configuration.cases.value=[],{valid:!0};const C=new Set(O);I.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(I,O,C,j,K){const i=K[0];return i.dataInputs.forEach((I=>{"default"!==I.name&&"case"!==I.name&&(I.name="in_"+I.name)})),i.config||(i.config={}),i.config.treatCasesAsIntegers=!0,K}},"debug/log":{EN:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function uC(I){let O=arguments.length>2?arguments[2]:void 0;return{EN:[I],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((I,O)=>(I[O]={name:O},I)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(I,C,j,K,i){var y;if(O){(y=i[0]).config||(y.config={}),i[0].config.preventIntegerFloatArithmetic=!0;let O=-1;Object.keys(I.values||{}).find((C=>{var j;return void 0!==(null===(j=I.values)||void 0===j?void 0:j[C].type)&&(O=I.values[C].type,!0)})),-1!==O&&(i[0].config.type=K.arrays.types[O].flowGraphType)}return i},validation:I=>O?JC(I):{valid:!0}}}function JC(I){if(I.values){const O=Object.keys(I.values).map((O=>I.values[O].type)).filter((I=>void 0!==I));if(!O.every((I=>I===O[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}MC["math/compose"]=MC["math/matCompose"],MC["math/decompose"]=MC["math/matDecompose"];var fC=C(12234);const lC={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"mC",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class xC{constructor(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=I,this._gltf=O,this._animationTargetFps=C,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const I of this._interactivityGraph.types)this._types.push(lC[I.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const I of this._interactivityGraph.declarations){const O=HC(I);if(!O)throw mI.c.Error(["No mapping found for declaration",I]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:O,fullOperationName:I.extension?I.op+":"+I.extension:I.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const I of this._interactivityGraph.variables){const O=this._parseVariable(I);this._staticVariables.push(O)}}_parseVariable(I,O){const C=this._types[I.type];if(!C)throw mI.c.Error(["No type found for variable",I]),new Error("Error parsing variables");if(I.value&&I.value.length!==C.length)throw mI.c.Error(["Invalid value length for variable",I,C]),new Error("Error parsing variables");const j=I.value||[];if(!j.length)switch(C.flowGraphType){case"boolean":j.push(!1);break;case"FlowGraphInteger":j.push(0);break;case"number":j.push(NaN);break;case"Vector2":j.push(NaN,NaN);break;case"mC":j.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":j.fill(NaN,0,4);break;case"Matrix":j.fill(NaN,0,16);break;case"Matrix3D":j.fill(NaN,0,9)}return"number"===C.elementType&&"string"===typeof j[0]&&(j[0]=parseFloat(j[0])),{type:C.flowGraphType,value:O?O(j,this):j}}_parseEvents(){if(this._interactivityGraph.events)for(const I of this._interactivityGraph.events){const O={eventId:I.id||"internalEvent_"+this._internalEventsCounter++};I.values&&(O.eventData=Object.keys(I.values).map((O=>{var C;const j=null===(C=I.values)||void 0===C?void 0:C[O];if(!j)throw mI.c.Error(["No value found for event key",O]),new Error("Error parsing events");const K=this._types[j.type];if(!K)throw mI.c.Error(["No type found for event value",j]),new Error("Error parsing events");const i="undefined"!==typeof j.value?this._parseVariable(j):void 0;return{id:O,type:K.flowGraphType,eventData:!0,value:i}}))),this._events.push(O)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const O of this._interactivityGraph.nodes){if("number"!==typeof O.declaration)throw mI.c.Error(["No declaration found for node",O]),new Error("Error parsing nodes");const C=this._mappings[O.declaration];if(!C)throw mI.c.Error(["No mapping found for node",O]),new Error("Error parsing nodes");if(C.flowGraphMapping.validation){const j=C.flowGraphMapping.validation(O,this._interactivityGraph,this._gltf);var I;if(!j.valid)throw new Error(`Error validating interactivity node ${null===(I=this._interactivityGraph.declarations)||void 0===I?void 0:I[O.declaration].op} - ${j.error}`)}const j=[];for(const I of C.flowGraphMapping.EN){const K=this._getEmptyBlock(I,C.fullOperationName);this._parseNodeConfiguration(O,K,C.flowGraphMapping,I),j.push(K)}this._nodes.push({EN:j,fullOperationName:C.fullOperationName})}}_getEmptyBlock(I,O){return{uniqueId:(0,fC.c)(),className:I,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:O,metadata:{}}}_parseNodeConfiguration(I,O,C,j){const K=O.config;if(I.configuration){const O=Object.keys(I.configuration);for(const S of O){var i,y;const O=null===(i=I.configuration)||void 0===i?void 0:i[S];if(!O)throw mI.c.Error(["No value found for node configuration",S]),new Error("Error parsing node configuration");const U=null===(y=C.configuration)||void 0===y?void 0:y[S];if(U&&U.rC?U.rC===j:0===C.EN.indexOf(j)){const I=(null===U||void 0===U?void 0:U.name)||S;O&&"undefined"!==typeof O.value||"undefined"===typeof(null===U||void 0===U?void 0:U.defaultValue)?O.value.length>=0?K[I]={value:1===O.value.length?O.value[0]:O.value}:mI.c.Warn(["Invalid value for node configuration",O]):K[I]={value:U.defaultValue},U&&U.dataTransformer&&(K[I].value=U.dataTransformer([K[I].value],this)[0])}}}}_parseNodeConnections(I){for(let c=0;c<this._nodes.length;c++){var O;const n=null===(O=this._interactivityGraph.nodes)||void 0===O?void 0:O[c];if(!n)throw mI.c.Error(["No node found for interactivity node",this._nodes[c]]),new Error("Error parsing node connections");const X=this._nodes[c],T=this._mappings[n.declaration];if(!T)throw mI.c.Error(["No mapping found for node",n]),new Error("Error parsing node connections");const H=n.flows||{},b=Object.keys(H).sort();for(const I of b){var C,j,K,i;const O=H[I],p=null===(C=T.flowGraphMapping.outputs)||void 0===C||null===(j=C.flows)||void 0===j?void 0:j[I],N=(null===p||void 0===p?void 0:p.name)||I,Q=this._createNewSocketConnection(N,!0);(p&&p.rC&&X.EN.find((I=>I.className===p.rC))||X.EN[0]).signalOutputs.push(Q);const s=O.node,Z=this._nodes[s];if(!Z)throw mI.c.Error(["No node found for input node id",s]),new Error("Error parsing node connections");const q=TC(Z.fullOperationName);if(!q)throw mI.c.Error(["No mapping found for input node",Z]),new Error("Error parsing node connections");let E=null===(K=q.inputs)||void 0===K||null===(i=K.flows)||void 0===i?void 0:i[O.socket||"in"],h=!1;if(!E)for(const I in null===(y=q.inputs)||void 0===y?void 0:y.flows){var y,S,U;if(I.startsWith("[")&&I.endsWith("]"))h=!0,E=null===(S=q.inputs)||void 0===S||null===(U=S.flows)||void 0===U?void 0:U[I]}const r=E?h?E.name.replace("$1",O.socket||""):E.name:O.socket||"in",W=E&&E.rC&&Z.EN.find((I=>I.className===E.rC))||Z.EN[0];let Y=W.signalInputs.find((I=>I.name===r));Y||(Y=this._createNewSocketConnection(r),W.signalInputs.push(Y)),Y.connectedPointIds.push(Q.uniqueId),Q.connectedPointIds.push(Y.uniqueId)}const a=n.values||{},M=Object.keys(a);for(const O of M){var p,N;const C=a[O];let j=null===(p=T.flowGraphMapping.inputs)||void 0===p||null===(N=p.values)||void 0===N?void 0:N[O],K=!1;if(!j)for(const I in null===(Q=T.flowGraphMapping.inputs)||void 0===Q?void 0:Q.values){var Q,s,Z;if(I.startsWith("[")&&I.endsWith("]"))K=!0,j=null===(s=T.flowGraphMapping.inputs)||void 0===s||null===(Z=s.values)||void 0===Z?void 0:Z[I]}const i=j?K?j.name.replace("$1",O):j.name:O,y=this._createNewSocketConnection(i);if((j&&j.rC&&X.EN.find((I=>I.className===j.rC))||X.EN[0]).dataInputs.push(y),void 0!==C.value){const O=this._parseVariable(C,j&&j.dataTransformer);I._connectionValues[y.uniqueId]=O}else{if("undefined"===typeof C.node)throw mI.c.Error(["Invalid value for value connection",C]),new Error("Error parsing node connections");{var q,E,h;const I=C.node,O=C.socket||"value",j=this._nodes[I];if(!j)throw mI.c.Error(["No node found for output socket reference",C]),new Error("Error parsing node connections");const K=TC(j.fullOperationName);if(!K)throw mI.c.Error(["No mapping found for output socket reference",C]),new Error("Error parsing node connections");let i=null===(q=K.outputs)||void 0===q||null===(E=q.values)||void 0===E?void 0:E[O],S=!1;if(!i)for(const C in null===(r=K.outputs)||void 0===r?void 0:r.values){var r,W,Y;if(C.startsWith("[")&&C.endsWith("]"))S=!0,i=null===(W=K.outputs)||void 0===W||null===(Y=W.values)||void 0===Y?void 0:Y[C]}const U=i?S?i.name.replace("$1",O):null===(h=i)||void 0===h?void 0:h.name:O,p=i&&i.rC&&j.EN.find((I=>I.className===i.rC))||j.EN[0];let N=p.dataOutputs.find((I=>I.name===U));N||(N=this._createNewSocketConnection(U,!0),p.dataOutputs.push(N)),y.connectedPointIds.push(N.uniqueId),N.connectedPointIds.push(y.uniqueId)}}}if(T.flowGraphMapping.interBlockConnectors)for(const I of T.flowGraphMapping.interBlockConnectors){const O=I.input,C=I.output,j=I.isVariable;this._connectFlowGraphNodes(O,C,X.EN[I.inputBlockIndex],X.EN[I.outputBlockIndex],j)}if(T.flowGraphMapping.extraProcessor){var o;const O=null===(o=this._interactivityGraph.declarations)||void 0===o?void 0:o[n.declaration];if(!O)throw mI.c.Error(["No declaration found for extra processor",n]),new Error("Error parsing node connections");X.EN=T.flowGraphMapping.extraProcessor(n,O,T.flowGraphMapping,this,X.EN,I,this._gltf)}}}_createNewSocketConnection(I,O){return{uniqueId:(0,fC.c)(),name:I,_connectionType:O?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(I,O,C,j,K){const i=K?C.dataInputs:C.signalInputs,y=K?j.dataOutputs:j.signalOutputs,S=i.find((O=>O.name===I))||this._createNewSocketConnection(I),U=y.find((I=>I.name===O))||this._createNewSocketConnection(O,!0);i.find((O=>O.name===I))||i.push(S),y.find((I=>I.name===O))||y.push(U),S.connectedPointIds.push(U.uniqueId),U.connectedPointIds.push(S.uniqueId)}getVariableName(I){return"staticVariable_"+I}serializeToFlowGraph(){const I={uniqueId:(0,fC.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(I);for(let O=0;O<this._staticVariables.length;O++){const C=this._staticVariables[O];I._userVariables[this.getVariableName(O)]=C}return{rightHanded:!0,allBlocks:this._nodes.reduce(((I,O)=>I.concat(O.EN)),[]),executionContexts:[I]}}}const DC="KHR_interactivity";class tC{constructor(I){this._loader=I,this.name=DC,this.enabled=this._loader.isExtensionUsed(DC),this._pathConverter=(0,d.g)(this._loader.NS),I._skipStartAnimationStep=!0;const O=I.babylonScene;O&&function(I){(0,d.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!I.activeCamera)return new K.Quaternion(NaN,NaN,NaN,NaN);const O=K.Quaternion.FromRotationMatrix(I.activeCamera.getWorldMatrix()).normalize();return I.useRightHandedSystem||(O.w*=-1,O.x*=-1),O},type:"Quaternion",getTarget:()=>I.activeCamera}),(0,d.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!I.activeCamera)return new K.mC(NaN,NaN,NaN);const O=I.activeCamera.getWorldMatrix().getTranslation();return I.useRightHandedSystem||(O.x*=-1),O},type:"mC",getTarget:()=>I.activeCamera}),(0,d.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:I=>{var O;return(null===(O=I._babylonAnimationGroup)||void 0===O?void 0:O.isPlaying)??!1},type:"boolean",getTarget:I=>I._babylonAnimationGroup}),(0,d.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:I=>{var O;return((null===(O=I._babylonAnimationGroup)||void 0===O?void 0:O.from)??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup}),(0,d.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:I=>{var O;return((null===(O=I._babylonAnimationGroup)||void 0===O?void 0:O.to)??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup}),(0,d.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:I=>{var O;return((null===(O=I._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup}),(0,d.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:I=>{var O;return((null===(O=I._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup})}(O)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var I;if(!this._loader.babylonScene||!this._pathConverter)return;const O=this._loader.babylonScene,C=null===(I=this._loader.NS.extensions)||void 0===I?void 0:I.KHR_interactivity;if(!C)return;const j=new qC.e({hO:O});j.dispatchEventsSynchronously=!1;const K=C.graphs.map((I=>new xC(I,this._loader.NS,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(K.map((async I=>await cC(I,{coordinator:j,pathConverter:this._pathConverter})))),j.start()}}var dC;dC=async()=>(await Promise.resolve().then(C.bind(C,13950))).FlowGraphGLTFDataProvider,mj[`${DC}/${"FlowGraphGLTFDataProvider"}`]=dC,t(DC),D(DC,!0,(I=>new tC(I)));const wC="KHR_node_visibility";(0,d.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:I=>{const O=I._babylonTransformNode;return!O||void 0===O.isVisible||O.isVisible},set:(I,O)=>{var C,j;null===(C=O._primitiveBabylonMeshes)||void 0===C||C.forEach((I=>{I.inheritVisibility=!0})),O._babylonTransformNode&&(O._babylonTransformNode.isVisible=I),null===(j=O._primitiveBabylonMeshes)||void 0===j||j.forEach((O=>{O.isVisible=I}))},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class gC{constructor(I){this.name=wC,this._loader=I,this.enabled=I.isExtensionUsed(wC)}async onReady(){var I;null===(I=this._loader.NS.nodes)||void 0===I||I.forEach((I=>{var O,C,j,K;(null===(O=I._primitiveBabylonMeshes)||void 0===O||O.forEach((I=>{I.inheritVisibility=!0})),null!==(C=I.extensions)&&void 0!==C&&C.KHR_node_visibility)&&(!1===(null===(j=I.extensions)||void 0===j?void 0:j.KHR_node_visibility.visible)&&(I._babylonTransformNode&&(I._babylonTransformNode.isVisible=!1),null===(K=I._primitiveBabylonMeshes)||void 0===K||K.forEach((I=>{I.isVisible=!1}))))}))}dispose(){this._loader=null}}t(wC),D(wC,!0,(I=>new gC(I)));const VC="KHR_node_selectability";bC("event/onSelect",VC,{EN:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",rC:"FlowGraphGetVariableBlock",dataTransformer:I=>["pickedMesh_"+I[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",rC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(I,O,C,j,K,i,y){var S,U,p,N,Q,s;const Z=K[K.length-1];Z.config=Z.config||{},Z.config.glTF=y;const q=null===(S=I.configuration)||void 0===S||null===(U=S.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===q||"number"!==typeof q)throw new Error("nodeIndex not found in configuration");const mI="pickedMesh_"+q;return K[1].config.variable=mI,i._userVariables[mI]={className:"Mesh",id:null===y||void 0===y||null===(p=y.nodes)||void 0===p||null===(N=p[q]._babylonTransformNode)||void 0===N?void 0:N.id,uniqueId:null===y||void 0===y||null===(Q=y.nodes)||void 0===Q||null===(s=Q[q]._babylonTransformNode)||void 0===s?void 0:s.uniqueId},K}}),(0,d.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:I=>{const O=I._babylonTransformNode;return!O||void 0===O.gU||O.gU},set:(I,O)=>{var C;null===(C=O._primitiveBabylonMeshes)||void 0===C||C.forEach((O=>{O.gU=I}))},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"gU"],type:"boolean"});class eC{constructor(I){this.name=VC,this._loader=I,this.enabled=I.isExtensionUsed(VC)}async onReady(){var I;null===(I=this._loader.NS.nodes)||void 0===I||I.forEach((I=>{var O,C,j;null!==(O=I.extensions)&&void 0!==O&&O.KHR_node_selectability&&!1===(null===(C=I.extensions)||void 0===C?void 0:C.KHR_node_selectability.selectable)&&(null===(j=I._babylonTransformNode)||void 0===j||j.getChildMeshes().forEach((I=>{I.gU=!1})))}))}dispose(){this._loader=null}}t(VC),D(VC,!0,(I=>new eC(I)));const LC="KHR_node_hoverability",zC="targetMeshPointerOver_";bC("event/onHoverIn",LC,{EN:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",rC:"FlowGraphGetVariableBlock",dataTransformer:I=>[zC+I[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",rC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(I,O,C,j,K,i,y){var S,U,p,N,Q,s;const Z=K[K.length-1];Z.config=Z.config||{},Z.config.glTF=y;const q=null===(S=I.configuration)||void 0===S||null===(U=S.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===q||"number"!==typeof q)throw new Error("nodeIndex not found in configuration");const mI=zC+q;return K[1].config.variable=mI,i._userVariables[mI]={className:"Mesh",id:null===y||void 0===y||null===(p=y.nodes)||void 0===p||null===(N=p[q]._babylonTransformNode)||void 0===N?void 0:N.id,uniqueId:null===y||void 0===y||null===(Q=y.nodes)||void 0===Q||null===(s=Q[q]._babylonTransformNode)||void 0===s?void 0:s.uniqueId},K}});const kC="targetMeshPointerOut_";bC("event/onHoverOut",LC,{EN:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",rC:"FlowGraphGetVariableBlock",dataTransformer:I=>[kC+I[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",rC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(I,O,C,j,K,i,y){var S,U,p,N,Q,s;const Z=K[K.length-1];Z.config=Z.config||{},Z.config.glTF=y;const q=null===(S=I.configuration)||void 0===S||null===(U=S.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===q||"number"!==typeof q)throw new Error("nodeIndex not found in configuration");const mI=kC+q;return K[1].config.variable=mI,i._userVariables[mI]={className:"Mesh",id:null===y||void 0===y||null===(p=y.nodes)||void 0===p||null===(N=p[q]._babylonTransformNode)||void 0===N?void 0:N.id,uniqueId:null===y||void 0===y||null===(Q=y.nodes)||void 0===Q||null===(s=Q[q]._babylonTransformNode)||void 0===s?void 0:s.uniqueId},K}}),(0,d.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:I=>{const O=I._babylonTransformNode;return!O||void 0===O.pointerOverDisableMeshTesting||O.pointerOverDisableMeshTesting},set:(I,O)=>{var C;null===(C=O._primitiveBabylonMeshes)||void 0===C||C.forEach((O=>{O.pointerOverDisableMeshTesting=!I}))},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class AC{constructor(I){this.name=LC,this._loader=I,this.enabled=I.isExtensionUsed(LC)}async onReady(){var I;null===(I=this._loader.NS.nodes)||void 0===I||I.forEach((I=>{var O,C,j;null!==(O=I.extensions)&&void 0!==O&&O.KHR_node_hoverability&&!1===(null===(C=I.extensions)||void 0===C?void 0:C.KHR_node_hoverability.hoverable)&&(null===(j=I._babylonTransformNode)||void 0===j||j.getChildMeshes().forEach((I=>{I.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}t(LC),D(LC,!0,(I=>new AC(I)));const PC="ExtrasAsMetadata";class vC{_assignExtras(I,O){if(O.extras&&Object.keys(O.extras).length>0){const C=I.metadata=I.metadata||{};(C.NS=C.NS||{}).extras=O.extras}}constructor(I){this.name=PC,this.enabled=!0,this._loader=I}dispose(){this._loader=null}loadNodeAsync(I,O,C){return this._loader.loadNodeAsync(I,O,(I=>{this._assignExtras(I,O),C(I)}))}loadCameraAsync(I,O,C){return this._loader.loadCameraAsync(I,O,(I=>{this._assignExtras(I,O),C(I)}))}createMaterial(I,O,C){const j=this._loader.createMaterial(I,O,C);return this._assignExtras(j,O),j}}t(PC),D(PC,!1,(I=>new vC(I)));C(13950)},13808:(I,O,C)=>{"use strict";C.d(O,{d:()=>J,g:()=>T,i:()=>X,m:()=>H});var j=C(12088),K=C(12083),i=C(13426),y=C(12671),S=C(12645),U=C(12660),p=C(12103),N=C(12132),Q=C(12669),s=C(12772),Z=C(12677),q=C(12300);class mI{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.RQ=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.ls=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(I){this._environmentTexture=I}getNodes(){let I=[];I=I.concat(this.meshes),I=I.concat(this.lights),I=I.concat(this.cameras),I=I.concat(this.transformNodes);for(const O of this.skeletons)I=I.concat(O.bones);return I}}class E extends mI{}class h{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const I=this.rootNodes;for(const j of I)j.dispose();I.length=0;const O=this.skeletons;for(const j of O)j.dispose();O.length=0;const C=this.animationGroups;for(const j of C)j.dispose();C.length=0}}class r extends mI{constructor(I){super(),this._wasAddedToScene=!1,(I=I||N.e.LastCreatedScene)&&(this.hO=I,this.proceduralTextures=[],I.yS.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=I.getEngine().onContextRestoredObservable.add((()=>{for(const I of this.geometries)I._rebuild();for(const I of this.meshes)I._rebuild();for(const I of this.RQ)I.rebuild();for(const I of this.textures)I._rebuild()})))}_topologicalSort(I){const O=new Map;for(const y of I)O.set(y.uniqueId,y);const C={dependsOn:new Map,dependedBy:new Map};for(const y of I){const I=y.uniqueId;C.dependsOn.set(I,new Set),C.dependedBy.set(I,new Set)}for(const y of I){const I=y.uniqueId,j=C.dependsOn.get(I);if(y instanceof Q.e){const K=y.sourceMesh;O.has(K.uniqueId)&&(j.add(K.uniqueId),C.dependedBy.get(K.uniqueId).add(I))}const K=C.dependedBy.get(I);for(const i of y.getDescendants()){const j=i.uniqueId;if(O.has(j)){K.add(j);C.dependsOn.get(j).add(I)}}}const j=[],K=[];for(const y of I){const I=y.uniqueId;0===C.dependsOn.get(I).size&&(K.push(y),O.delete(I))}const i=K;for(;i.length>0;){const I=i.shift();j.push(I);const K=C.dependedBy.get(I.uniqueId);for(const j of Array.from(K.values())){const K=C.dependsOn.get(j);K.delete(I.uniqueId),0===K.size&&O.get(j)&&(i.push(O.get(j)),O.delete(j))}}return O.size>0&&(p.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),O.forEach((I=>{p.c.Error(I.name)}))),j}_addNodeAndDescendantsToList(I,O,C,j){if(C&&(!j||j(C))&&!O.has(C.uniqueId)){I.push(C),O.add(C.uniqueId);for(const K of C.getDescendants(!0))this._addNodeAndDescendantsToList(I,O,K,j)}}_isNodeInContainer(I){return I instanceof U.e&&-1!==this.meshes.indexOf(I)||(I instanceof S.d&&-1!==this.transformNodes.indexOf(I)||(I instanceof s.d&&-1!==this.lights.indexOf(I)||I instanceof Z.e&&-1!==this.cameras.indexOf(I)))}_isValidHierarchy(){for(const I of this.meshes)if(I.parent&&!this._isNodeInContainer(I.parent))return p.c.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;for(const I of this.transformNodes)if(I.parent&&!this._isNodeInContainer(I.parent))return p.c.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;for(const I of this.lights)if(I.parent&&!this._isNodeInContainer(I.parent))return p.c.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;for(const I of this.cameras)if(I.parent&&!this._isNodeInContainer(I.parent))return p.c.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(I){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||K.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const j={},i={},S=new h,U=[],p=[],N={doNotInstantiate:!0,...C},Q=[],s=new Set;for(const K of this.transformNodes)null===K.parent&&this._addNodeAndDescendantsToList(Q,s,K,N.predicate);for(const K of this.meshes)null===K.parent&&this._addNodeAndDescendantsToList(Q,s,K,N.predicate);const Z=this._topologicalSort(Q),q=(C,K)=>{if(((O,C)=>{if(j[O.uniqueId]=C.uniqueId,i[C.uniqueId]=C,I&&(C.name=I(O.name)),C instanceof y.c){const I=C;if(I.morphTargetManager){const C=O.morphTargetManager;I.morphTargetManager=C.clone();for(let O=0;O<C.numTargets;O++){const K=C.getTarget(O),y=I.morphTargetManager.getTarget(O);j[K.uniqueId]=y.uniqueId,i[y.uniqueId]=y}}}})(C,K),C.parent){const I=j[C.parent.uniqueId],O=i[I];K.parent=O||C.parent}if(K.position&&C.position&&K.position.K(C.position),K.rotationQuaternion&&C.rotationQuaternion&&K.rotationQuaternion.K(C.rotationQuaternion),K.rotation&&C.rotation&&K.rotation.K(C.rotation),K.nS&&C.nS&&K.nS.K(C.nS),K.material){const y=K;if(y.material)if(O){const O=C.material;if(-1===p.indexOf(O)){let C=O.clone(I?I(O.name):"Clone of "+O.name);if(p.push(O),j[O.uniqueId]=C.uniqueId,i[C.uniqueId]=C,"MultiMaterial"===O.getClassName()){const K=O;for(const O of K.HS)O&&(C=O.clone(I?I(O.name):"Clone of "+O.name),p.push(O),j[O.uniqueId]=C.uniqueId,i[C.uniqueId]=C);K.HS=K.HS.map((I=>I&&i[j[I.uniqueId]]))}}"InstancedMesh"!==y.getClassName()&&(y.material=i[j[O.uniqueId]])}else"MultiMaterial"===y.material.getClassName()?-1===this.hO.multiMaterials.indexOf(y.material)&&this.hO.addMultiMaterial(y.material):-1===this.hO.materials.indexOf(y.material)&&this.hO.addMaterial(y.material)}null===K.parent&&S.rootNodes.push(K)};for(const K of Z)if("InstancedMesh"===K.getClassName()){const I=K,O=I.sourceMesh,C=j[O.uniqueId];q(I,("number"===typeof C?i[C]:O).createInstance(I.name))}else{let I=!0;"Aq"===K.getClassName()||"Node"===K.getClassName()||K.skeleton||!K.getTotalVertices||0===K.getTotalVertices()?I=!1:N.doNotInstantiate&&(I="function"===typeof N.doNotInstantiate?!N.doNotInstantiate(K):!N.doNotInstantiate);const O=I?K.createInstance(`instance of ${K.name}`):K.clone(`Clone of ${K.name}`,null,!0);if(!O)throw new Error(`Could not clone or instantiate node on Asset Container ${K.name}`);q(K,O)}for(const K of this.skeletons){if(N.predicate&&!N.predicate(K))continue;const O=K.clone(I?I(K.name):"Clone of "+K.name);for(const I of this.meshes)if(I.skeleton===K&&!I.isAnInstance){const C=i[j[I.uniqueId]];if(!C||C.isAnInstance)continue;if(C.skeleton=O,-1!==U.indexOf(O))continue;U.push(O);for(const I of O.bones)I._linkedTransformNode&&(I._linkedTransformNode=i[j[I._linkedTransformNode.uniqueId]])}S.skeletons.push(O)}for(const K of this.animationGroups){if(N.predicate&&!N.predicate(K))continue;const O=K.clone(I?I(K.name):"Clone of "+K.name,(I=>i[j[I.uniqueId]]||I));S.animationGroups.push(O)}return S}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||K.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.hO.environmentTexture=this.environmentTexture);for(const I of this.hO._serializableComponents)I.addFromContainer(this);this.hO.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=[];for(const C of this.cameras)I&&!I(C)||(this.hO.addCamera(C),O.push(C));for(const C of this.lights)I&&!I(C)||(this.hO.addLight(C),O.push(C));for(const C of this.meshes)I&&!I(C)||(this.hO.KN(C),O.push(C));for(const C of this.skeletons)I&&!I(C)||this.hO.addSkeleton(C);for(const C of this.animations)I&&!I(C)||this.hO.addAnimation(C);for(const C of this.animationGroups)I&&!I(C)||this.hO.addAnimationGroup(C);for(const C of this.multiMaterials)I&&!I(C)||this.hO.addMultiMaterial(C);for(const C of this.materials)I&&!I(C)||this.hO.addMaterial(C);for(const C of this.morphTargetManagers)I&&!I(C)||this.hO.addMorphTargetManager(C);for(const C of this.geometries)I&&!I(C)||this.hO.addGeometry(C);for(const C of this.transformNodes)I&&!I(C)||(this.hO.addTransformNode(C),O.push(C));for(const C of this.actionManagers)I&&!I(C)||this.hO.addActionManager(C);for(const C of this.textures)I&&!I(C)||this.hO.addTexture(C);for(const C of this.reflectionProbes)I&&!I(C)||this.hO.addReflectionProbe(C);for(const C of O)C.parent&&-1===this.hO.getNodes().indexOf(C.parent)&&(C.setParent?C.setParent(null):C.parent=null)}removeAllFromScene(){this._isValidHierarchy()||K.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.hO.environmentTexture&&(this.hO.environmentTexture=null);for(const I of this.hO._serializableComponents)I.removeFromContainer(this)}removeFromScene(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const O of this.cameras)I&&!I(O)||this.hO.removeCamera(O);for(const O of this.lights)I&&!I(O)||this.hO.removeLight(O);for(const O of this.meshes)I&&!I(O)||this.hO.jN(O,!0);for(const O of this.skeletons)I&&!I(O)||this.hO.removeSkeleton(O);for(const O of this.animations)I&&!I(O)||this.hO.removeAnimation(O);for(const O of this.animationGroups)I&&!I(O)||this.hO.removeAnimationGroup(O);for(const O of this.multiMaterials)I&&!I(O)||this.hO.removeMultiMaterial(O);for(const O of this.materials)I&&!I(O)||this.hO.removeMaterial(O);for(const O of this.morphTargetManagers)I&&!I(O)||this.hO.removeMorphTargetManager(O);for(const O of this.geometries)I&&!I(O)||this.hO.removeGeometry(O);for(const O of this.transformNodes)I&&!I(O)||this.hO.removeTransformNode(O);for(const O of this.actionManagers)I&&!I(O)||this.hO.removeActionManager(O);for(const O of this.textures)I&&!I(O)||this.hO.removeTexture(O);for(const O of this.reflectionProbes)I&&!I(O)||this.hO.removeReflectionProbe(O)}dispose(){const I=this.cameras.slice(0);for(const Z of I)Z.dispose();this.cameras.length=0;const O=this.lights.slice(0);for(const Z of O)Z.dispose();this.lights.length=0;const C=this.meshes.slice(0);for(const Z of C)Z.dispose();this.meshes.length=0;const j=this.skeletons.slice(0);for(const Z of j)Z.dispose();this.skeletons.length=0;const K=this.animationGroups.slice(0);for(const Z of K)Z.dispose();this.animationGroups.length=0;const i=this.multiMaterials.slice(0);for(const Z of i)Z.dispose();this.multiMaterials.length=0;const y=this.materials.slice(0);for(const Z of y)Z.dispose();this.materials.length=0;const S=this.geometries.slice(0);for(const Z of S)Z.dispose();this.geometries.length=0;const U=this.transformNodes.slice(0);for(const Z of U)Z.dispose();this.transformNodes.length=0;const p=this.actionManagers.slice(0);for(const Z of p)Z.dispose();this.actionManagers.length=0;const N=this.textures.slice(0);for(const Z of N)Z.dispose();this.textures.length=0;const Q=this.reflectionProbes.slice(0);for(const Z of Q)Z.dispose();this.reflectionProbes.length=0;const s=this.morphTargetManagers.slice(0);for(const Z of s)Z.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const Z of this.hO._serializableComponents)Z.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.hO.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(I,O,C){if(I&&O)for(const j of I){let I=!0;if(C)for(const O of C)if(j===O){I=!1;break}I&&(O.push(j),j._parentContainer=this)}}moveAllFromScene(I){this._wasAddedToScene=!1,void 0===I&&(I=new E);for(const O in this)Object.prototype.hasOwnProperty.call(this,O)&&(this[O]=this[O]||("_environmentTexture"===O?null:[]),this._moveAssets(this.hO[O],this[O],I[O]));this.environmentTexture=this.hO.environmentTexture,this.removeAllFromScene()}createRootMesh(){const I=new y.c("assetContainerRootMesh",this.hO);for(const O of this.meshes)O.parent||I.addChild(O);return this.meshes.unshift(I),I}mergeAnimationsTo(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.e.LastCreatedScene,O=arguments.length>1?arguments[1]:void 0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!I)return p.c.Error("No scene available to merge animations to"),[];const j=C||(O=>{let C=null;const j=O.animations.length?O.animations[0].targetProperty:"",K=O.name.split(".").join("").split("_primitive")[0];switch(j){case"position":case"rotationQuaternion":C=I.getTransformNodeByName(O.name)||I.getTransformNodeByName(K);break;case"influence":C=I.getMorphTargetByName(O.name)||I.getMorphTargetByName(K);break;default:C=I.getNodeByName(O.name)||I.getNodeByName(K)}return C}),K=this.getNodes();for(const S of K){const I=j(S);if(null!==I){for(const O of S.animations){const C=I.animations.filter((I=>I.targetProperty===O.targetProperty));for(const O of C){const C=I.animations.indexOf(O,0);C>-1&&I.animations.splice(C,1)}}I.animations=I.animations.concat(S.animations)}}const i=[],y=this.animationGroups.slice();for(const S of y){i.push(S.clone(S.name,j));for(const I of S.animatables)I.stop()}for(const S of O){const O=j(S.target);O&&(I.beginAnimation(O,S.fromFrame,S.toFrame,S.loopAnimation,S.speedRatio,S.onAnimationEnd?S.onAnimationEnd:void 0,void 0,!0,void 0,S.onAnimationLoop?S.onAnimationLoop:void 0),I.stopAnimation(S.target))}return i}populateRootNodes(){this.rootNodes.length=0;for(const I of this.meshes)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I);for(const I of this.transformNodes)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I);for(const I of this.lights)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I);for(const I of this.cameras)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I)}addAllAssetsToContainer(I){if(!I)return;const O=[],C=new Set;for(O.push(I);O.length>0;){const I=O.pop();if(I instanceof y.c?(I.WS&&-1===this.geometries.indexOf(I.WS)&&this.geometries.push(I.WS),this.meshes.push(I)):I instanceof Q.e?this.meshes.push(I):I instanceof S.d?this.transformNodes.push(I):I instanceof s.d?this.lights.push(I):I instanceof Z.e&&this.cameras.push(I),I instanceof U.e){if(I.material&&-1===this.materials.indexOf(I.material)){this.materials.push(I.material);for(const O of I.material.getActiveTextures())-1===this.textures.indexOf(O)&&this.textures.push(O)}I.skeleton&&-1===this.skeletons.indexOf(I.skeleton)&&this.skeletons.push(I.skeleton),I.morphTargetManager&&-1===this.morphTargetManagers.indexOf(I.morphTargetManager)&&this.morphTargetManagers.push(I.morphTargetManager)}for(const j of I.getChildren())C.has(j)||O.push(j);C.add(I)}this.populateRootNodes()}_getByTags(I,O,C){if(void 0===O)return I;const j=[];for(const K in I){const i=I[K];q.d&&q.d.MatchesQuery(i,O)&&(!C||C(i))&&j.push(i)}return j}getMeshesByTags(I,O){return this._getByTags(this.meshes,I,O)}getCamerasByTags(I,O){return this._getByTags(this.cameras,I,O)}getLightsByTags(I,O){return this._getByTags(this.lights,I,O)}getMaterialsByTags(I,O){return this._getByTags(this.materials,I,O).concat(this._getByTags(this.multiMaterials,I,O))}getTransformNodesByTags(I,O){return this._getByTags(this.transformNodes,I,O)}}var W=C(12154);class Y{constructor(I){this.byteOffset=0,this.buffer=I}async loadAsync(I){const O=await this.buffer.readAsync(this.byteOffset,I);this._dataView=new DataView(O.buffer,O.byteOffset,O.byteLength),this._dataByteOffset=0}readUint32(){const I=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,I}readUint8Array(I){const O=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,I);return this._dataByteOffset+=I,this.byteOffset+=I,O}readString(I){return(0,W.g)(this.readUint8Array(I))}skipBytes(I){this._dataByteOffset+=I,this.byteOffset+=I}}var o=C(13811);const c="Z2xURg",n={name:"NS",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:I=>-1!==I.indexOf("asset")&&-1!==I.indexOf("version")||I.startsWith("data:base64,"+c)||I.startsWith("data:;base64,"+c)||I.startsWith("data:application/octet-stream;base64,"+c)||I.startsWith("data:model/gltf-binary;base64,"+c)};var X,T,H,b=C(12139),a=C(12148);function M(I,O,C){try{return Promise.resolve(new Uint8Array(I,O,C))}catch(j){return Promise.reject(j)}}!function(I){I[I.AUTO=0]="AUTO",I[I.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(X||(X={})),function(I){I[I.NONE=0]="NONE",I[I.FIRST=1]="FIRST",I[I.ALL=2]="ALL"}(T||(T={})),function(I){I[I.LOADING=0]="LOADING",I[I.READY=1]="READY",I[I.COMPLETE=2]="COMPLETE"}(H||(H={}));class u{constructor(){this.coordinateSystemMode=X.AUTO,this.animationStartMode=T.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=I=>Promise.resolve(I),this.extensionOptions={}}K(I){I&&(this.onParsed=I.onParsed,this.coordinateSystemMode=I.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=I.animationStartMode??this.animationStartMode,this.loadNodeAnimations=I.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=I.loadSkins??this.loadSkins,this.loadMorphTargets=I.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=I.compileMaterials??this.compileMaterials,this.useClipPlane=I.useClipPlane??this.useClipPlane,this.compileShadowGenerators=I.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=I.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=I.useRangeRequests??this.useRangeRequests,this.createInstances=I.createInstances??this.createInstances,this.alwaysComputeBoundingBox=I.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=I.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=I.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=I.skipMaterials??this.skipMaterials,this.useSRGBBuffers=I.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=I.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=I.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=I.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=I.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=I.customRootNode,this.onMeshLoaded=I.onMeshLoaded,this.onSkinLoaded=I.onSkinLoaded,this.onTextureLoaded=I.onTextureLoaded,this.onMaterialLoaded=I.onMaterialLoaded,this.onCameraLoaded=I.onCameraLoaded,this.extensionOptions=I.extensionOptions??this.extensionOptions)}}class J extends u{constructor(I){super(),this.onParsedObservable=new j.c,this.onMeshLoadedObservable=new j.c,this.onSkinLoadedObservable=new j.c,this.onTextureLoadedObservable=new j.c,this.onMaterialLoadedObservable=new j.c,this.onCameraLoadedObservable=new j.c,this.onCompleteObservable=new j.c,this.onErrorObservable=new j.c,this.yS=new j.c,this.onExtensionLoadedObservable=new j.c,this.validate=!1,this.onValidatedObservable=new j.c,this._loader=null,this._state=null,this._requests=new Array,this.name=n.name,this.extensions=n.extensions,this.onLoaderStateChangedObservable=new j.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.K(I)}set onParsed(I){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),I&&(this._onParsedObserver=this.onParsedObservable.add(I))}set onMeshLoaded(I){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),I&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(I))}set onSkinLoaded(I){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),I&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((O=>I(O.node,O.skinnedNode))))}set onTextureLoaded(I){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),I&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(I))}set onMaterialLoaded(I){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),I&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(I))}set onCameraLoaded(I){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),I&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(I))}set onComplete(I){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(I)}set onError(I){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(I)}set onDispose(I){this._onDisposeObserver&&this.yS.remove(this._onDisposeObserver),this._onDisposeObserver=this.yS.add(I)}set onExtensionLoaded(I){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(I)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(I){this._loggingEnabled!==I&&(this._loggingEnabled=I,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(I){this._capturePerformanceCounters!==I&&(this._capturePerformanceCounters=I,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(I){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(I)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const I of this._requests)I.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=I=>Promise.resolve(I),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.yS.notifyObservers(void 0),this.yS.clear()}loadFile(I,O,C,i,y,S,U,N){if(ArrayBuffer.isView(O))return this._loadBinary(I,O,C,i,U,N),null;this._progressCallback=y;const Q=O.name||K.Tools.GetFilename(O);if(S){if(this.useRangeRequests){this.validate&&p.c.Warn("glTF validation is not supported when range requests are enabled");const C={abort:()=>{},onCompleteObservable:new j.c},K={readAsync:(C,j)=>new Promise(((K,i)=>{this._loadFile(I,O,(I=>{K(new Uint8Array(I))}),!0,(I=>{i(I)}),(I=>{I.setRequestHeader("Range",`bytes=${C}-${C+j-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new Y(K)).then((I=>{C.onCompleteObservable.notifyObservers(C),i(I)}),U?I=>U(void 0,I):void 0),C}return this._loadFile(I,O,(O=>{this._validate(I,new Uint8Array(O,0,O.byteLength),C,Q),this._unpackBinaryAsync(new Y({readAsync:(I,C)=>M(O,I,C),byteLength:O.byteLength})).then((I=>{i(I)}),U?I=>U(void 0,I):void 0)}),!0,U)}return this._loadFile(I,O,(O=>{try{this._validate(I,O,C,Q),i({json:this._parseJson(O)})}catch{U&&U()}}),!1,U)}_loadBinary(I,O,C,j,K,i){this._validate(I,new Uint8Array(O.buffer,O.byteOffset,O.byteLength),C,i),this._unpackBinaryAsync(new Y({readAsync:(I,C)=>function(I,O,C){try{if(O<0||O>=I.byteLength)throw new RangeError("Offset is out of range.");if(O+C>I.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(I.buffer,I.byteOffset+O,C))}catch(j){return Promise.reject(j)}}(O,I,C),byteLength:O.byteLength})).then((I=>{j(I)}),K?I=>K(void 0,I):void 0)}importMeshAsync(I,O,C,j,K,i){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(C),this.onParsedObservable.clear(),this._log(`Loading ${i||""}`),this._loader=this._getLoader(C),this._loader.importMeshAsync(I,O,null,C,j,K,i))))}loadAsync(I,O,C,j,K){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${K||""}`),this._loader=this._getLoader(O),this._loader.loadAsync(I,O,C,j,K))))}loadAssetContainerAsync(I,O,C,j,K){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${K||""}`),this._loader=this._getLoader(O);const i=new r(I),y=[];this.onMaterialLoadedObservable.add((I=>{y.push(I)}));const S=[];this.onTextureLoadedObservable.add((I=>{S.push(I)}));const U=[];this.onCameraLoadedObservable.add((I=>{U.push(I)}));const p=[];return this.onMeshLoadedObservable.add((I=>{I.morphTargetManager&&p.push(I.morphTargetManager)})),this._loader.importMeshAsync(null,I,i,O,C,j,K).then((I=>(Array.prototype.push.apply(i.geometries,I.geometries),Array.prototype.push.apply(i.meshes,I.meshes),Array.prototype.push.apply(i.RQ,I.RQ),Array.prototype.push.apply(i.skeletons,I.skeletons),Array.prototype.push.apply(i.animationGroups,I.animationGroups),Array.prototype.push.apply(i.materials,y),Array.prototype.push.apply(i.textures,S),Array.prototype.push.apply(i.lights,I.lights),Array.prototype.push.apply(i.transformNodes,I.transformNodes),Array.prototype.push.apply(i.cameras,U),Array.prototype.push.apply(i.morphTargetManagers,p),i)))}))}canDirectLoad(I){return n.canDirectLoad(I)}directLoad(I,O){if(O.startsWith("base64,"+c)||O.startsWith(";base64,"+c)||O.startsWith("application/octet-stream;base64,"+c)||O.startsWith("model/gltf-binary;base64,"+c)){const C=(0,b.e)(O);return this._validate(I,new Uint8Array(C,0,C.byteLength)),this._unpackBinaryAsync(new Y({readAsync:(I,O)=>M(C,I,O),byteLength:C.byteLength}))}return this._validate(I,O),Promise.resolve({json:this._parseJson(O)})}createPlugin(I){return new J(I[n.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((I,O)=>{this.onCompleteObservable.addOnce((()=>{I()})),this.onErrorObservable.addOnce((I=>{O(I)}))}))}_setState(I){this._state!==I&&(this._state=I,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(H[this._state]))}_loadFile(I,O,C,j,K,i){const y=I._loadFile(O,C,(I=>{this._onProgress(I,y)}),!0,j,K,i);return y.onCompleteObservable.add((()=>{y._lengthComputable=!0,y._total=y._loaded})),this._requests.push(y),y}_onProgress(I,O){if(!this._progressCallback)return;O._lengthComputable=I.lengthComputable,O._loaded=I.loaded,O._total=I.total;let C=!0,j=0,K=0;for(const i of this._requests){if(void 0===i._lengthComputable||void 0===i._loaded||void 0===i._total)return;C=C&&i._lengthComputable,j+=i._loaded,K+=i._total}this._progressCallback({lengthComputable:C,loaded:j,total:C?K:0})}_validate(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),o.c.ValidateAsync(O,C,j,(O=>this.preprocessUrlAsync(C+O).then((O=>I._loadFileAsync(O,void 0,!0,!0).then((I=>new Uint8Array(I,0,I.byteLength))))))).then((I=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(I),this.onValidatedObservable.clear()}),(I=>{this._endPerformanceCounter("Validate JSON"),K.Tools.Warn(`Failed to validate: ${I.message}`),this.onValidatedObservable.clear()})))}_getLoader(I){const O=I.json.asset||{};this._log(`Asset version: ${O.version}`),O.minVersion&&this._log(`Asset minimum version: ${O.minVersion}`),O.generator&&this._log(`Asset generator: ${O.generator}`);const C=J._parseVersion(O.version);if(!C)throw new Error("Invalid version: "+O.version);if(void 0!==O.minVersion){const I=J._parseVersion(O.minVersion);if(!I)throw new Error("Invalid minimum version: "+O.minVersion);if(J._compareVersion(I,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+O.minVersion)}const j={1:J._CreateGLTF1Loader,2:J._CreateGLTF2Loader}[C.major];if(!j)throw new Error("Unsupported version: "+O.version);return j(this)}_parseJson(I){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${I.length}`);const O=JSON.parse(I);return this._endPerformanceCounter("Parse JSON"),O}_unpackBinaryAsync(I){return this._startPerformanceCounter("Unpack Binary"),I.loadAsync(20).then((()=>{const O=I.readUint32();if(1179937895!==O)throw new a.g("Unexpected magic: "+O,a.e.GLTFLoaderUnexpectedMagicError);const C=I.readUint32();this.loggingEnabled&&this._log(`Binary version: ${C}`);const j=I.readUint32();let K;switch(this.useRangeRequests||j===I.buffer.byteLength||p.c.Warn(`Length in header does not match actual data length: ${j} != ${I.buffer.byteLength}`),C){case 1:K=this._unpackBinaryV1Async(I,j);break;case 2:K=this._unpackBinaryV2Async(I,j);break;default:throw new Error("Unsupported version: "+C)}return this._endPerformanceCounter("Unpack Binary"),K}))}_unpackBinaryV1Async(I,O){const C=I.readUint32(),j=I.readUint32();if(0!==j)throw new Error(`Unexpected content format: ${j}`);const K=O-I.byteOffset,i={json:this._parseJson(I.readString(C)),bin:null};if(0!==K){const O=I.byteOffset;i.bin={readAsync:(C,j)=>I.buffer.readAsync(O+C,j),byteLength:K}}return Promise.resolve(i)}_unpackBinaryV2Async(I,O){const C=1313821514,j=5130562,K=I.readUint32();if(I.readUint32()!==C)throw new Error("First chunk format is not JSON");return I.byteOffset+K===O?I.loadAsync(K).then((()=>({json:this._parseJson(I.readString(K)),bin:null}))):I.loadAsync(K+8).then((()=>{const i={json:this._parseJson(I.readString(K)),bin:null},y=()=>{const K=I.readUint32();switch(I.readUint32()){case C:throw new Error("Unexpected JSON chunk");case j:{const O=I.byteOffset;i.bin={readAsync:(C,j)=>I.buffer.readAsync(O+C,j),byteLength:K},I.skipBytes(K);break}default:I.skipBytes(K)}return I.byteOffset!==O?I.loadAsync(8).then(y):Promise.resolve(i)};return y()}))}static _parseVersion(I){if("1.0"===I||"1.0.1"===I)return{major:1,minor:0};const O=(I+"").match(/^(\d+)\.(\d+)/);return O?{major:parseInt(O[1]),minor:parseInt(O[2])}:null}static _compareVersion(I,O){return I.major>O.major?1:I.major<O.major?-1:I.minor>O.minor?1:I.minor<O.minor?-1:0}_logOpen(I){this._log(I),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(I){const O=J._logSpaces.substring(0,2*this._logIndentLevel);p.c.Log(`${O}${I}`)}_logDisabled(I){}_startPerformanceCounterEnabled(I){K.Tools.StartPerformanceCounter(I)}_startPerformanceCounterDisabled(I){}_endPerformanceCounterEnabled(I){K.Tools.EndPerformanceCounter(I)}_endPerformanceCounterDisabled(I){}}J.IncrementalLoading=!0,J.HomogeneousCoordinates=!1,J._logSpaces="                                ",(0,i.c)(new J)},13811:(I,O,C)=>{"use strict";C.d(O,{c:()=>y});var j=C(12083);function K(I,O,C,j){const K={externalResourceFunction:j};return C&&(K.uri="file:"===O?C:O+C),ArrayBuffer.isView(I)?GLTFValidator.validateBytes(I,K):GLTFValidator.validateString(I,K)}function i(){const I=[];onmessage=O=>{const C=O.data;switch(C.id){case"init":importScripts(C.url);break;case"validate":K(C.data,C.rootUrl,C.fileName,(O=>new Promise(((C,j)=>{const K=I.length;I.push({resolve:C,reject:j}),postMessage({id:"getExternalResource",index:K,uri:O})})))).then((I=>{postMessage({id:"validate.resolve",value:I})}),(I=>{postMessage({id:"validate.reject",reason:I})}));break;case"getExternalResource.resolve":I[C.index].resolve(C.value);break;case"getExternalResource.reject":I[C.index].reject(C.reason)}}}class y{static ValidateAsync(I,O,C,y){return"function"===typeof Worker?new Promise(((S,U)=>{const p=`${K}(${i})()`,N=URL.createObjectURL(new Blob([p],{type:"application/javascript"})),Q=new Worker(N),s=I=>{Q.removeEventListener("error",s),Q.removeEventListener("message",Z),U(I)},Z=I=>{const O=I.data;switch(O.id){case"getExternalResource":y(O.uri).then((I=>{Q.postMessage({id:"getExternalResource.resolve",index:O.index,value:I},[I.buffer])}),(I=>{Q.postMessage({id:"getExternalResource.reject",index:O.index,reason:I})}));break;case"validate.resolve":Q.removeEventListener("error",s),Q.removeEventListener("message",Z),S(O.value),Q.terminate();break;case"validate.reject":Q.removeEventListener("error",s),Q.removeEventListener("message",Z),U(O.reason),Q.terminate()}};if(Q.addEventListener("error",s),Q.addEventListener("message",Z),Q.postMessage({id:"init",url:j.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(I)){const j=I.slice();Q.postMessage({id:"validate",data:j,rootUrl:O,fileName:C},[j.buffer])}else Q.postMessage({id:"validate",data:I,rootUrl:O,fileName:C})})):(this._LoadScriptPromise||(this._LoadScriptPromise=j.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>K(I,O,C,y))))}}y.Configuration={url:`${j.Tools._DefaultCdnUrl}/gltf_validator.js`}},14368:(I,O,C)=>{"use strict";C.d(O,{e:()=>n});var j=C(12250),K=C(12257),i=C(12296),y=C(12272),S=C(12612),U=C(12565),p=C(12329),N=C(12487),Q=C(12226),s=C(12179);C(13563),C(13466),C(13485),C(13474),C(13490),C(13498),C(13500);const Z="imageProcessingCompatibility",q="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";s.b.IncludesShadersStore[Z]||(s.b.IncludesShadersStore[Z]=q);const mI="skyPixelShader",E="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";s.b.ShadersStore[mI]||(s.b.ShadersStore[mI]=E);C(13576),C(13502),C(13511),C(13520),C(13516);const h="skyVertexShader",r="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";s.b.ShadersStore[h]||(s.b.ShadersStore[h]=r);var W=C(12556),Y=C(12599),o=C(12596);class c extends S.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class n extends U.b{constructor(I,O){super(I,O),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new y.mC(0,100,0),this.useSunPosition=!1,this.cameraOffset=y.mC.Zero(),this.up=y.mC.Up(),this.dithering=!1,this._cameraPosition=y.mC.Zero(),this._skyOrientation=new y.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(I,O){const C=O._drawWrapper;if(this.isFrozen&&C.effect&&C._wasPreviouslyReady)return!0;O.materialDefines||(O.materialDefines=new c);const j=O.materialDefines,K=this.nI();if(this._isReadyForSubMesh(O))return!0;if((0,o.gb)(I,K,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,j),(0,o.U)(I,j,!0,!1),j.IMAGEPROCESSINGPOSTPROCESS!==K.imageProcessingConfiguration.applyByPostProcess&&j.markAsMiscDirty(),j.DITHER!==this.dithering&&j.markAsMiscDirty(),j.isDirty){j.markAsProcessed(),K.resetCachedMaterial();const I=new W.e;j.FOG&&I.addFallback(1,"FOG"),j.IMAGEPROCESSINGPOSTPROCESS=K.imageProcessingConfiguration.applyByPostProcess,j.DITHER=this.dithering;const C=[p.e.PositionKind];j.VERTEXCOLOR&&C.push(p.e.ColorKind);const i="sky",y=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,Y.d)(y);const S=j.toString();O.setEffect(K.getEngine().createEffect(i,C,y,[],S,I,this.onCompiled,this.onError),j,this._materialContext)}return!(!O.effect||!O.effect.isReady())&&(j._renderId=K.getRenderId(),C._wasPreviouslyReady=!0,!0)}bindForSubMesh(I,O,C){const j=this.nI(),K=C.materialDefines;if(!K)return;const i=C.effect;if(!i)return;this._activeEffect=i,this.bindOnlyWorldMatrix(I),this._activeEffect.setMatrix("viewProjection",j.getTransformMatrix()),this._mustRebind(j,i,C)&&((0,Y.g)(i,this,j),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,o.o)(K,i,j)),j.fogEnabled&&O.applyFog&&j.fogMode!==N.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",j.getViewMatrix()),(0,o.h)(j,O,this._activeEffect);const S=j.activeCamera;if(S){const I=S.getWorldMatrix();this._cameraPosition.x=I.m[12],this._cameraPosition.y=I.m[13],this._cameraPosition.z=I.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const I=Math.PI*(this.inclination-.5),O=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(O)*Math.cos(I),this.sunPosition.y=this.distance*Math.sin(-I),this.sunPosition.z=this.distance*Math.sin(O)*Math.cos(I),y.Quaternion.FromUnitVectorsToRef(y.mC.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(O,this._activeEffect,C)}getAnimatables(){return[]}dispose(I){super.dispose(I)}clone(I){return i.e.Clone((()=>new n(I,this.nI())),this)}serialize(){const I=super.serialize();return I.customType="BABYLON.SkyMaterial",I}getClassName(){return"SkyMaterial"}static Parse(I,O,C){return i.e.Parse((()=>new n(I.name,O)),I,O,C)}}(0,j.e)([(0,K.E)()],n.prototype,"luminance",void 0),(0,j.e)([(0,K.E)()],n.prototype,"turbidity",void 0),(0,j.e)([(0,K.E)()],n.prototype,"rayleigh",void 0),(0,j.e)([(0,K.E)()],n.prototype,"mieCoefficient",void 0),(0,j.e)([(0,K.E)()],n.prototype,"mieDirectionalG",void 0),(0,j.e)([(0,K.E)()],n.prototype,"distance",void 0),(0,j.e)([(0,K.E)()],n.prototype,"inclination",void 0),(0,j.e)([(0,K.E)()],n.prototype,"azimuth",void 0),(0,j.e)([(0,K.B)()],n.prototype,"sunPosition",void 0),(0,j.e)([(0,K.E)()],n.prototype,"useSunPosition",void 0),(0,j.e)([(0,K.B)()],n.prototype,"cameraOffset",void 0),(0,j.e)([(0,K.B)()],n.prototype,"up",void 0),(0,j.e)([(0,K.E)()],n.prototype,"dithering",void 0),(0,Q.e)("BABYLON.SkyMaterial",n)},12912:(I,O,C)=>{"use strict";function j(I,O){O.headers=I.headers||{},O.statusMessage=I.statusText,O.statusCode=I.status,O.data=I.response}function K(I,O,C){return new Promise((function(K,i){C=C||{};var y,S,U,p=new XMLHttpRequest,N=C.body,Q=C.headers||{};for(y in C.timeout&&(p.timeout=C.timeout),p.ontimeout=p.onerror=function(I){I.timeout="timeout"==I.type,i(I)},p.open(I,O.href||O),p.onload=function(){for(U=p.getAllResponseHeaders().trim().split(/[\r\n]+/),j(p,p);S=U.shift();)S=S.split(": "),p.headers[S.shift().toLowerCase()]=S.join(": ");if((S=p.headers["content-type"])&&~S.indexOf("application/json"))try{p.data=JSON.parse(p.data,C.reviver)}catch(I){return j(p,I),i(I)}(p.status>=400?i:K)(p)},typeof FormData<"u"&&N instanceof FormData||N&&"object"==typeof N&&(Q["content-type"]="application/json",N=JSON.stringify(N)),p.withCredentials=!!C.withCredentials,Q)p.setRequestHeader(y,Q[y]);p.send(N)}))}C.r(O),C.d(O,{del:()=>U,get:()=>i,patch:()=>S,post:()=>y,put:()=>p,send:()=>K});var i=K.bind(K,"GET"),y=K.bind(K,"POST"),S=K.bind(K,"PATCH"),U=K.bind(K,"DELETE"),p=K.bind(K,"PUT")},14488:(I,O,C)=>{"use strict";C.d(O,{c:()=>Q});const j=.5*(Math.sqrt(3)-1),K=(3-Math.sqrt(3))/6,i=1/3,y=1/6,S=(Math.sqrt(5)-1)/4,U=(5-Math.sqrt(5))/20,p=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),N=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const Q=class{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const O="function"==typeof I?I:function(I){let O=0,C=0,j=0,K=1;const i=function(){let I=4022871197;return function(O){O=O.toString();for(let C=0;C<O.length;C++){I+=O.charCodeAt(C);let j=.02519603282416938*I;I=j>>>0,j-=I,j*=I,I=j>>>0,j-=I,I+=4294967296*j}return 2.3283064365386963e-10*(I>>>0)}}();O=i(" "),C=i(" "),j=i(" "),O-=i(I),O<0&&(O+=1);C-=i(I),C<0&&(C+=1);j-=i(I),j<0&&(j+=1);return function(){const I=2091639*O+2.3283064365386963e-10*K;return O=C,C=j,j=I-(K=0|I)}}(I);this.p=function(I){const O=new Uint8Array(256);for(let C=0;C<256;C++)O[C]=C;for(let C=0;C<255;C++){const j=C+~~(I()*(256-C)),K=O[C];O[C]=O[j],O[j]=K}return O}(O),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let C=0;C<512;C++)this.perm[C]=this.p[255&C],this.permMod12[C]=this.perm[C]%12}noise2D(I,O){const C=this.permMod12,i=this.perm;let y=0,S=0,U=0;const N=(I+O)*j,Q=Math.floor(I+N),s=Math.floor(O+N),Z=(Q+s)*K,q=I-(Q-Z),mI=O-(s-Z);let E,h;q>mI?(E=1,h=0):(E=0,h=1);const r=q-E+K,W=mI-h+K,Y=q-1+2*K,o=mI-1+2*K,c=255&Q,n=255&s;let X=.5-q*q-mI*mI;if(X>=0){const I=3*C[c+i[n]];X*=X,y=X*X*(p[I]*q+p[I+1]*mI)}let T=.5-r*r-W*W;if(T>=0){const I=3*C[c+E+i[n+h]];T*=T,S=T*T*(p[I]*r+p[I+1]*W)}let H=.5-Y*Y-o*o;if(H>=0){const I=3*C[c+1+i[n+1]];H*=H,U=H*H*(p[I]*Y+p[I+1]*o)}return 70*(y+S+U)}noise3D(I,O,C){const j=this.permMod12,K=this.perm;let S,U,N,Q;const s=(I+O+C)*i,Z=Math.floor(I+s),q=Math.floor(O+s),mI=Math.floor(C+s),E=(Z+q+mI)*y,h=I-(Z-E),r=O-(q-E),W=C-(mI-E);let Y,o,c,n,X,T;h>=r?r>=W?(Y=1,o=0,c=0,n=1,X=1,T=0):h>=W?(Y=1,o=0,c=0,n=1,X=0,T=1):(Y=0,o=0,c=1,n=1,X=0,T=1):r<W?(Y=0,o=0,c=1,n=0,X=1,T=1):h<W?(Y=0,o=1,c=0,n=0,X=1,T=1):(Y=0,o=1,c=0,n=1,X=1,T=0);const H=h-Y+y,b=r-o+y,a=W-c+y,M=h-n+2*y,u=r-X+2*y,J=W-T+2*y,f=h-1+.5,l=r-1+.5,x=W-1+.5,D=255&Z,t=255&q,d=255&mI;let w=.6-h*h-r*r-W*W;if(w<0)S=0;else{const I=3*j[D+K[t+K[d]]];w*=w,S=w*w*(p[I]*h+p[I+1]*r+p[I+2]*W)}let g=.6-H*H-b*b-a*a;if(g<0)U=0;else{const I=3*j[D+Y+K[t+o+K[d+c]]];g*=g,U=g*g*(p[I]*H+p[I+1]*b+p[I+2]*a)}let V=.6-M*M-u*u-J*J;if(V<0)N=0;else{const I=3*j[D+n+K[t+X+K[d+T]]];V*=V,N=V*V*(p[I]*M+p[I+1]*u+p[I+2]*J)}let e=.6-f*f-l*l-x*x;if(e<0)Q=0;else{const I=3*j[D+1+K[t+1+K[d+1]]];e*=e,Q=e*e*(p[I]*f+p[I+1]*l+p[I+2]*x)}return 32*(S+U+N+Q)}noise4D(I,O,C,j){const K=this.perm;let i,y,p,Q,s;const Z=(I+O+C+j)*S,q=Math.floor(I+Z),mI=Math.floor(O+Z),E=Math.floor(C+Z),h=Math.floor(j+Z),r=(q+mI+E+h)*U,W=I-(q-r),Y=O-(mI-r),o=C-(E-r),c=j-(h-r);let n=0,X=0,T=0,H=0;W>Y?n++:X++,W>o?n++:T++,W>c?n++:H++,Y>o?X++:T++,Y>c?X++:H++,o>c?T++:H++;const b=n>=3?1:0,a=X>=3?1:0,M=T>=3?1:0,u=H>=3?1:0,J=n>=2?1:0,f=X>=2?1:0,l=T>=2?1:0,x=H>=2?1:0,D=n>=1?1:0,t=X>=1?1:0,d=T>=1?1:0,w=H>=1?1:0,g=W-b+U,V=Y-a+U,e=o-M+U,L=c-u+U,z=W-J+2*U,k=Y-f+2*U,A=o-l+2*U,P=c-x+2*U,v=W-D+3*U,B=Y-t+3*U,F=o-d+3*U,R=c-w+3*U,G=W-1+4*U,II=Y-1+4*U,OI=o-1+4*U,CI=c-1+4*U,jI=255&q,KI=255&mI,iI=255&E,yI=255&h;let SI=.6-W*W-Y*Y-o*o-c*c;if(SI<0)i=0;else{const I=K[jI+K[KI+K[iI+K[yI]]]]%32*4;SI*=SI,i=SI*SI*(N[I]*W+N[I+1]*Y+N[I+2]*o+N[I+3]*c)}let UI=.6-g*g-V*V-e*e-L*L;if(UI<0)y=0;else{const I=K[jI+b+K[KI+a+K[iI+M+K[yI+u]]]]%32*4;UI*=UI,y=UI*UI*(N[I]*g+N[I+1]*V+N[I+2]*e+N[I+3]*L)}let pI=.6-z*z-k*k-A*A-P*P;if(pI<0)p=0;else{const I=K[jI+J+K[KI+f+K[iI+l+K[yI+x]]]]%32*4;pI*=pI,p=pI*pI*(N[I]*z+N[I+1]*k+N[I+2]*A+N[I+3]*P)}let NI=.6-v*v-B*B-F*F-R*R;if(NI<0)Q=0;else{const I=K[jI+D+K[KI+t+K[iI+d+K[yI+w]]]]%32*4;NI*=NI,Q=NI*NI*(N[I]*v+N[I+1]*B+N[I+2]*F+N[I+3]*R)}let QI=.6-G*G-II*II-OI*OI-CI*CI;if(QI<0)s=0;else{const I=K[jI+1+K[KI+1+K[iI+1+K[yI+1]]]]%32*4;QI*=QI,s=QI*QI*(N[I]*G+N[I+1]*II+N[I+2]*OI+N[I+3]*CI)}return 27*(i+y+p+Q+s)}}}}]);