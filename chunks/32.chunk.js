/*! For license information please see xuvr8c.32.072f3e7b.chunk.js.LICENSE.txt */
(self.h66iwo8dvgq=self.h66iwo8dvgq||[]).push([[32],{13931:(b,X,P)=>{"use strict";var Q=P(13934),S=P(13940),d=P(13947);P.g.__TYPEDARRAY_POOL||(P.g.__TYPEDARRAY_POOL={UINT8:S([32,0]),UINT16:S([32,0]),UINT32:S([32,0]),INT8:S([32,0]),INT16:S([32,0]),INT32:S([32,0]),FLOAT:S([32,0]),DOUBLE:S([32,0]),DATA:S([32,0]),UINT8C:S([32,0]),BUFFER:S([32,0])});var N="undefined"!==typeof Uint8ClampedArray,a=P.g.__TYPEDARRAY_POOL;a.UINT8C||(a.UINT8C=S([32,0])),a.BUFFER||(a.BUFFER=S([32,0]));var u=a.DATA,w=a.BUFFER;function f(b){if(b){var X=b.length||b.byteLength,P=Q.log2(X);u[P].push(b)}}function O(b){b=Q.nextPow2(b);var X=Q.log2(b),P=u[X];return P.length>0?P.pop():new ArrayBuffer(b)}function e(b){return new Uint8Array(O(b),0,b)}function Y(b){return new Uint16Array(O(2*b),0,b)}function D(b){return new Uint32Array(O(4*b),0,b)}function E(b){return new Int8Array(O(b),0,b)}function t(b){return new Int16Array(O(2*b),0,b)}function B(b){return new Int32Array(O(4*b),0,b)}function W(b){return new Float32Array(O(4*b),0,b)}function n(b){return new Float64Array(O(8*b),0,b)}function y(b){return N?new Uint8ClampedArray(O(b),0,b):e(b)}function h(b){return new DataView(O(b),0,b)}X.free=function(b){if(d(b))w[Q.log2(b.length)].push(b);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(b)&&(b=b.buffer),!b)return;var X=b.length||b.byteLength,P=0|Q.log2(X);u[P].push(b)}},X.freeUint8=X.freeUint16=X.freeUint32=X.freeInt8=X.freeInt16=X.freeInt32=X.freeFloat32=X.freeFloat=X.freeFloat64=X.freeDouble=X.freeUint8Clamped=X.freeDataView=function(b){f(b.buffer)},X.freeArrayBuffer=f,X.freeBuffer=function(b){w[Q.log2(b.length)].push(b)},X.malloc=function(b,X){if(void 0===X||"arraybuffer"===X)return O(b);switch(X){case"uint8":return e(b);case"uint16":return Y(b);case"uint32":return D(b);case"int8":return E(b);case"int16":return t(b);case"int32":return B(b);case"float":case"float32":return W(b);case"double":case"float64":return n(b);case"uint8_clamped":return y(b);case"buffer":throw"Buffer not supported";case"data":case"dataview":return h(b);default:return null}return null},X.mallocArrayBuffer=O,X.mallocUint8=e,X.mallocUint16=Y,X.mallocUint32=D,X.mallocInt8=E,X.mallocInt16=t,X.mallocInt32=B,X.mallocFloat32=X.mallocFloat=W,X.mallocFloat64=X.mallocDouble=n,X.mallocUint8Clamped=y,X.mallocDataView=h,X.clearCache=function(){for(var b=0;b<32;++b)a.UINT8[b].length=0,a.UINT16[b].length=0,a.UINT32[b].length=0,a.INT8[b].length=0,a.INT16[b].length=0,a.INT32[b].length=0,a.FLOAT[b].length=0,a.DOUBLE[b].length=0,a.UINT8C[b].length=0,u[b].length=0,w[b].length=0}},14015:(b,X,P)=>{b.exports=S;var Q=P(12702);function S(b,X){if(!(this instanceof S))return new S(b,X);var P=Q.create();Q.add(P,b,X),this.base=Q.min(Q.create(),b,P),this.cw=Q.clone(X),this.max=Q.max(Q.create(),b,P),this.mag=Q.length(this.cw)}var d=S.prototype;d.width=function(){return this.cw[0]},d.height=function(){return this.cw[1]},d.depth=function(){return this.cw[2]},d.x0=function(){return this.base[0]},d.y0=function(){return this.base[1]},d.z0=function(){return this.base[2]},d.x1=function(){return this.max[0]},d.y1=function(){return this.max[1]},d.z1=function(){return this.max[2]},d.translate=function(b){return Q.add(this.max,this.max,b),Q.add(this.base,this.base,b),this},d.setPosition=function(b){return Q.add(this.max,b,this.cw),Q.j(this.base,b),this},d.expand=function(b){var X=Q.create(),P=Q.create();return Q.max(X,b.max,this.max),Q.min(P,b.base,this.base),Q.BX(X,X,P),new S(P,X)},d.intersects=function(b){return!(b.base[0]>this.max[0])&&(!(b.base[1]>this.max[1])&&(!(b.base[2]>this.max[2])&&(!(b.max[0]<this.base[0])&&(!(b.max[1]<this.base[1])&&!(b.max[2]<this.base[2])))))},d.touches=function(b){var X=this.union(b);return null!==X&&(0==X.width()||0==X.height()||0==X.depth())},d.union=function(b){if(!this.intersects(b))return null;var X=Math.max(b.base[0],this.base[0]),P=Math.max(b.base[1],this.base[1]),Q=Math.max(b.base[2],this.base[2]);return new S([X,P,Q],[Math.min(b.max[0],this.max[0])-X,Math.min(b.max[1],this.max[1])-P,Math.min(b.max[2],this.max[2])-Q])}},13934:(b,X)=>{"use strict";function P(b){var X=32;return(b&=-b)&&X--,65535&b&&(X-=16),16711935&b&&(X-=8),252645135&b&&(X-=4),858993459&b&&(X-=2),1431655765&b&&(X-=1),X}X.INT_BITS=32,X.INT_MAX=2147483647,X.INT_MIN=-1<<31,X.sign=function(b){return(b>0)-(b<0)},X.abs=function(b){var X=b>>31;return(b^X)-X},X.min=function(b,X){return X^(b^X)&-(b<X)},X.max=function(b,X){return b^(b^X)&-(b<X)},X.isPow2=function(b){return!(b&b-1)&&!!b},X.log2=function(b){var X,P;return X=(b>65535)<<4,X|=P=((b>>>=X)>255)<<3,X|=P=((b>>>=P)>15)<<2,(X|=P=((b>>>=P)>3)<<1)|(b>>>=P)>>1},X.log10=function(b){return b>=1e9?9:b>=1e8?8:b>=1e7?7:b>=1e6?6:b>=1e5?5:b>=1e4?4:b>=1e3?3:b>=100?2:b>=10?1:0},X.popCount=function(b){return 16843009*((b=(858993459&(b-=b>>>1&1431655765))+(b>>>2&858993459))+(b>>>4)&252645135)>>>24},X.countTrailingZeros=P,X.nextPow2=function(b){return b+=0===b,--b,b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,(b|=b>>>16)+1},X.prevPow2=function(b){return b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,(b|=b>>>16)-(b>>>1)},X.parity=function(b){return b^=b>>>16,b^=b>>>8,b^=b>>>4,27030>>>(b&=15)&1};var Q=new Array(256);!function(b){for(var X=0;X<256;++X){var P=X,Q=X,S=7;for(P>>>=1;P;P>>>=1)Q<<=1,Q|=1&P,--S;b[X]=Q<<S&255}}(Q),X.reverse=function(b){return Q[255&b]<<24|Q[b>>>8&255]<<16|Q[b>>>16&255]<<8|Q[b>>>24&255]},X.interleave2=function(b,X){return(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))|(X=1431655765&((X=858993459&((X=252645135&((X=16711935&((X&=65535)|X<<8))|X<<4))|X<<2))|X<<1))<<1},X.deinterleave2=function(b,X){return(b=65535&((b=16711935&((b=252645135&((b=858993459&((b=b>>>X&1431655765)|b>>>1))|b>>>2))|b>>>4))|b>>>16))<<16>>16},X.interleave3=function(b,X,P){return b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2),(b|=(X=1227133513&((X=3272356035&((X=251719695&((X=4278190335&((X&=1023)|X<<16))|X<<8))|X<<4))|X<<2))<<1)|(P=1227133513&((P=3272356035&((P=251719695&((P=4278190335&((P&=1023)|P<<16))|P<<8))|P<<4))|P<<2))<<2},X.deinterleave3=function(b,X){return(b=1023&((b=4278190335&((b=251719695&((b=3272356035&((b=b>>>X&1227133513)|b>>>2))|b>>>4))|b>>>8))|b>>>16))<<22>>22},X.nextCombination=function(b){var X=b|b-1;return X+1|(~X&-~X)-1>>>P(b)+1}},13922:(b,X,P)=>{"use strict";b.exports=function(b,X,P){switch(arguments.length){case 1:return Q=[],w(S=b,S,f,!0),Q;case 2:return"function"===typeof X?w(b,b,X,!0):function(b,X){return Q=[],w(b,X,f,!1),Q}(b,X);case 3:return w(b,X,P,!1);default:throw new Error("box-intersect: Invalid arguments")}var S};var Q,S=P(13931),d=P(13949),N=P(13959);function a(b,X){for(var P=0;P<b;++P)if(!(X[P]<=X[P+b]))return!0;return!1}function u(b,X,P,Q){for(var S=0,d=0,N=0,u=b.length;N<u;++N){var w=b[N];if(!a(X,w)){for(var f=0;f<2*X;++f)P[S++]=w[f];Q[d++]=N}}return d}function w(b,X,P,Q){var a=b.length,w=X.length;if(!(a<=0||w<=0)){var f=b[0].length>>>1;if(!(f<=0)){var O,e=S.mallocDouble(2*f*a),Y=S.mallocInt32(a);if((a=u(b,f,e,Y))>0){if(1===f&&Q)d.init(a),O=d.sweepComplete(f,P,0,a,e,Y,0,a,e,Y);else{var D=S.mallocDouble(2*f*w),E=S.mallocInt32(w);(w=u(X,f,D,E))>0&&(d.init(a+w),O=1===f?d.sweepBipartite(f,P,0,a,e,Y,0,w,D,E):N(f,P,Q,a,e,Y,w,D,E),S.free(D),S.free(E))}S.free(e),S.free(Y)}return O}}}function f(b,X){Q.push([b,X])}},13964:(b,X)=>{"use strict";var P="d",Q="ax",S="fp",d="es",N="rs",a="re",u="rb",w="bs",f="be",O="bb",e=[P,Q,"vv",N,a,u,"ri",w,f,O,"bi"];function Y(b){var X="bruteForce"+(b?"Full":"Partial"),Q=[],N=e.slice();b||N.splice(3,0,S);var a=["function "+X+"("+N.join()+"){"];function u(X,S){var N=function(b,X,Q){var S="bruteForce"+(b?"Red":"Blue")+(X?"Flip":"")+(Q?"Full":""),N=["function ",S,"(",e.join(),"){","var ",d,"=2*",P,";"],a="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",u="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(Q?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return b?N.push(a,"Q",":",u):N.push(u,"Q",":",a),Q?N.push("if(y1<x0||x1<y0)continue;"):X?N.push("if(y0<=x0||x1<y0)continue;"):N.push("if(y0<x0||x1<y0)continue;"),N.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),X?N.push("yi,xi"):N.push("xi,yi"),N.push(");if(rv!==void 0)return rv;}}}"),{name:S,code:N.join("")}}(X,S,b);Q.push(N.code),a.push("return "+N.name+"("+e.join()+");")}a.push("if(re-rs>be-bs){"),b?(u(!0,!1),a.push("}else{"),u(!1,!1)):(a.push("if(fp){"),u(!0,!0),a.push("}else{"),u(!0,!1),a.push("}}else{if(fp){"),u(!1,!0),a.push("}else{"),u(!1,!1),a.push("}")),a.push("}}return "+X);var w=Q.join("")+a.join("");return new Function(w)()}X.partial=Y(!1),X.full=Y(!0)},13959:(b,X,P)=>{"use strict";b.exports=function(b,X,P,d,f,K,T,q,V){!function(b,X){var P=8*S.log2(X+1)*(b+1)|0,d=S.nextPow2(y*P);L.length<d&&(Q.free(L),L=Q.mallocInt32(d));var N=S.nextPow2(h*P);Z.length<N&&(Q.free(Z),Z=Q.mallocDouble(N))}(b,d+T);var i,x=0,H=2*b;v(x++,0,0,d,0,T,P?16:0,-1/0,1/0),P||v(x++,0,0,T,0,d,1,-1/0,1/0);for(;x>0;){var C=(x-=1)*y,p=L[C],k=L[C+1],z=L[C+2],U=L[C+3],g=L[C+4],j=L[C+5],l=x*h,J=Z[l],c=Z[l+1],s=1&j,F=!!(16&j),M=f,R=K,r=q,I=V;if(s&&(M=q,R=V,r=f,I=K),!(2&j&&k>=(z=t(b,p,k,z,M,R,c)))&&!(4&j&&(k=B(b,p,k,z,M,R,J))>=z)){var G=z-k,mb=g-U;if(F){if(b*G*(G+mb)<Y){if(void 0!==(i=u.scanComplete(b,p,X,k,z,M,R,U,g,r,I)))return i;continue}}else{if(b*Math.min(G,mb)<O){if(void 0!==(i=N(b,p,X,s,k,z,M,R,U,g,r,I)))return i;continue}if(b*G*mb<e){if(void 0!==(i=u.scanBipartite(b,p,X,s,k,z,M,R,U,g,r,I)))return i;continue}}var bb=D(b,p,k,z,M,R,J,c);if(k<bb)if(b*(bb-k)<O){if(void 0!==(i=a(b,p+1,X,k,bb,M,R,U,g,r,I)))return i}else if(p===b-2){if(void 0!==(i=s?u.sweepBipartite(b,X,U,g,r,I,k,bb,M,R):u.sweepBipartite(b,X,k,bb,M,R,U,g,r,I)))return i}else v(x++,p+1,k,bb,U,g,s,-1/0,1/0),v(x++,p+1,U,g,k,bb,1^s,-1/0,1/0);if(bb<z){var Xb=w(b,p,U,g,r,I),Pb=r[H*Xb+p],Qb=E(b,p,Xb,g,r,I,Pb);if(Qb<g&&v(x++,p,bb,z,Qb,g,(4|s)+(F?16:0),Pb,c),U<Xb&&v(x++,p,bb,z,U,Xb,(2|s)+(F?16:0),J,Pb),Xb+1===Qb){if(void 0!==(i=F?o(b,p,X,bb,z,M,R,Xb,r,I[Xb]):A(b,p,X,s,bb,z,M,R,Xb,r,I[Xb])))return i}else if(Xb<Qb){var Sb;if(F){if(bb<(Sb=W(b,p,bb,z,M,R,Pb))){var db=E(b,p,bb,Sb,M,R,Pb);if(p===b-2){if(bb<db&&void 0!==(i=u.sweepComplete(b,X,bb,db,M,R,Xb,Qb,r,I)))return i;if(db<Sb&&void 0!==(i=u.sweepBipartite(b,X,db,Sb,M,R,Xb,Qb,r,I)))return i}else bb<db&&v(x++,p+1,bb,db,Xb,Qb,16,-1/0,1/0),db<Sb&&(v(x++,p+1,db,Sb,Xb,Qb,0,-1/0,1/0),v(x++,p+1,Xb,Qb,db,Sb,1,-1/0,1/0))}}else bb<(Sb=s?n(b,p,bb,z,M,R,Pb):W(b,p,bb,z,M,R,Pb))&&(p===b-2?i=s?u.sweepBipartite(b,X,Xb,Qb,r,I,bb,Sb,M,R):u.sweepBipartite(b,X,bb,Sb,M,R,Xb,Qb,r,I):(v(x++,p+1,bb,Sb,Xb,Qb,s,-1/0,1/0),v(x++,p+1,Xb,Qb,bb,Sb,1^s,-1/0,1/0)))}}}}};var Q=P(13931),S=P(13934),d=P(13964),N=d.partial,a=d.full,u=P(13949),w=P(13969),f=P(13976),O=128,e=1<<22,Y=1<<22,D=f("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),E=f("lo===p0",["p0"]),t=f("lo<p0",["p0"]),B=f("hi<=p0",["p0"]),W=f("lo<=p0&&p0<=hi",["p0"]),n=f("lo<p0&&p0<=hi",["p0"]),y=6,h=2,L=Q.mallocInt32(1024),Z=Q.mallocDouble(1024);function v(b,X,P,Q,S,d,N,a,u){var w=y*b;L[w]=X,L[w+1]=P,L[w+2]=Q,L[w+3]=S,L[w+4]=d,L[w+5]=N;var f=h*b;Z[f]=a,Z[f+1]=u}function A(b,X,P,Q,S,d,N,a,u,w,f){var O=2*b,e=u*O,Y=w[e+X];b:for(var D=S,E=S*O;D<d;++D,E+=O){var t=N[E+X],B=N[E+X+b];if(!(Y<t||B<Y)&&(!Q||Y!==t)){for(var W,n=a[D],y=X+1;y<b;++y){t=N[E+y],B=N[E+y+b];var h=w[e+y],L=w[e+y+b];if(B<h||L<t)continue b}if(void 0!==(W=Q?P(f,n):P(n,f)))return W}}}function o(b,X,P,Q,S,d,N,a,u,w){var f=2*b,O=a*f,e=u[O+X];b:for(var Y=Q,D=Q*f;Y<S;++Y,D+=f){var E=N[Y];if(E!==w){var t=d[D+X],B=d[D+X+b];if(!(e<t||B<e)){for(var W=X+1;W<b;++W){t=d[D+W],B=d[D+W+b];var n=u[O+W],y=u[O+W+b];if(B<n||y<t)continue b}var h=P(E,w);if(void 0!==h)return h}}}}},13969:(b,X,P)=>{"use strict";b.exports=function(b,X,P,N,a,u){if(N<=P+1)return P;var w=P,f=N,O=N+P>>>1,e=2*b,Y=O,D=a[e*O+X];for(;w<f;){if(f-w<S){d(b,X,w,f,a,u),D=a[e*O+X];break}var E=f-w,t=Math.random()*E+w|0,B=a[e*t+X],W=Math.random()*E+w|0,n=a[e*W+X],y=Math.random()*E+w|0,h=a[e*y+X];B<=n?h>=n?(Y=W,D=n):B>=h?(Y=t,D=B):(Y=y,D=h):n>=h?(Y=W,D=n):h>=B?(Y=t,D=B):(Y=y,D=h);for(var L=e*(f-1),Z=e*Y,v=0;v<e;++v,++L,++Z){var A=a[L];a[L]=a[Z],a[Z]=A}var o=u[f-1];u[f-1]=u[Y],u[Y]=o;for(L=e*(f-1),Z=e*(Y=Q(b,X,w,f-1,a,u,D)),v=0;v<e;++v,++L,++Z){A=a[L];a[L]=a[Z],a[Z]=A}o=u[f-1];if(u[f-1]=u[Y],u[Y]=o,O<Y){for(f=Y-1;w<f&&a[e*(f-1)+X]===D;)f-=1;f+=1}else{if(!(Y<O))break;for(w=Y+1;w<f&&a[e*w+X]===D;)w+=1}}return Q(b,X,P,O,a,u,a[e*O+X])};var Q=P(13976)("lo<p0",["p0"]),S=8;function d(b,X,P,Q,S,d){for(var N=2*b,a=N*(P+1)+X,u=P+1;u<Q;++u,a+=N)for(var w=S[a],f=u,O=N*(u-1);f>P&&S[O+X]>w;--f,O-=N){for(var e=O,Y=O+N,D=0;D<N;++D,++e,++Y){var E=S[e];S[e]=S[Y],S[Y]=E}var t=d[f];d[f]=d[f-1],d[f-1]=t}}},13976:b=>{"use strict";b.exports=function(b,P){var Q="abcdef".split("").concat(P),S=[];b.indexOf("lo")>=0&&S.push("lo=e[k+n]");b.indexOf("hi")>=0&&S.push("hi=e[k+o]");return Q.push(X.replace("_",S.join()).replace("$",b)),Function.apply(void 0,Q)};var X="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13952:b=>{"use strict";b.exports=function(b,Q){Q<=4*X?P(0,Q-1,b):w(0,Q-1,b)};var X=32;function P(b,X,P){for(var Q=2*(b+1),S=b+1;S<=X;++S){for(var d=P[Q++],N=P[Q++],a=S,u=Q-2;a-- >b;){var w=P[u-2],f=P[u-1];if(w<d)break;if(w===d&&f<N)break;P[u]=w,P[u+1]=f,u-=2}P[u]=d,P[u+1]=N}}function Q(b,X,P){X*=2;var Q=P[b*=2],S=P[b+1];P[b]=P[X],P[b+1]=P[X+1],P[X]=Q,P[X+1]=S}function S(b,X,P){X*=2,P[b*=2]=P[X],P[b+1]=P[X+1]}function d(b,X,P,Q){X*=2,P*=2;var S=Q[b*=2],d=Q[b+1];Q[b]=Q[X],Q[b+1]=Q[X+1],Q[X]=Q[P],Q[X+1]=Q[P+1],Q[P]=S,Q[P+1]=d}function N(b,X,P,Q,S){X*=2,S[b*=2]=S[X],S[X]=P,S[b+1]=S[X+1],S[X+1]=Q}function a(b,X,P){X*=2;var Q=P[b*=2],S=P[X];return!(Q<S)&&(Q!==S||P[b+1]>P[X+1])}function u(b,X,P,Q){var S=Q[b*=2];return S<X||S===X&&Q[b+1]<P}function w(b,f,O){var e=(f-b+1)/6|0,Y=b+e,D=f-e,E=b+f>>1,t=E-e,B=E+e,W=Y,n=t,y=E,h=B,L=D,Z=b+1,v=f-1,A=0;a(W,n,O)&&(A=W,W=n,n=A),a(h,L,O)&&(A=h,h=L,L=A),a(W,y,O)&&(A=W,W=y,y=A),a(n,y,O)&&(A=n,n=y,y=A),a(W,h,O)&&(A=W,W=h,h=A),a(y,h,O)&&(A=y,y=h,h=A),a(n,L,O)&&(A=n,n=L,L=A),a(n,y,O)&&(A=n,n=y,y=A),a(h,L,O)&&(A=h,h=L,L=A);for(var o=O[2*n],K=O[2*n+1],T=O[2*h],q=O[2*h+1],V=2*W,i=2*y,x=2*L,H=2*Y,C=2*E,p=2*D,k=0;k<2;++k){var z=O[V+k],U=O[i+k],g=O[x+k];O[H+k]=z,O[C+k]=U,O[p+k]=g}S(t,b,O),S(B,f,O);for(var j=Z;j<=v;++j)if(u(j,o,K,O))j!==Z&&Q(j,Z,O),++Z;else if(!u(j,T,q,O))for(;;){if(u(v,T,q,O)){u(v,o,K,O)?(d(j,Z,v,O),++Z,--v):(Q(j,v,O),--v);break}if(--v<j)break}N(b,Z-1,o,K,O),N(f,v+1,T,q,O),Z-2-b<=X?P(b,Z-2,O):w(b,Z-2,O),f-(v+2)<=X?P(v+2,f,O):w(v+2,f,O),v-Z<=X?P(Z,v,O):w(Z,v,O)}},13949:(b,X,P)=>{"use strict";b.exports={init:function(b){var X=S.nextPow2(b);u.length<X&&(Q.free(u),u=Q.mallocInt32(X));w.length<X&&(Q.free(w),w=Q.mallocInt32(X));f.length<X&&(Q.free(f),f=Q.mallocInt32(X));O.length<X&&(Q.free(O),O=Q.mallocInt32(X));e.length<X&&(Q.free(e),e=Q.mallocInt32(X));Y.length<X&&(Q.free(Y),Y=Q.mallocInt32(X));var P=8*X;D.length<P&&(Q.free(D),D=Q.mallocDouble(P))},sweepBipartite:function(b,X,P,Q,S,a,e,Y,B,W){for(var n=0,y=2*b,h=b-1,L=y-1,Z=P;Z<Q;++Z){var v=a[Z],A=y*Z;D[n++]=S[A+h],D[n++]=-(v+1),D[n++]=S[A+L],D[n++]=v}for(Z=e;Z<Y;++Z){v=W[Z]+N;var o=y*Z;D[n++]=B[o+h],D[n++]=-v,D[n++]=B[o+L],D[n++]=v}var K=n>>>1;d(D,K);var T=0,q=0;for(Z=0;Z<K;++Z){var V=0|D[2*Z+1];if(V>=N)E(f,O,q--,V=V-N|0);else if(V>=0)E(u,w,T--,V);else if(V<=-N){V=-V-N|0;for(var i=0;i<T;++i){if(void 0!==(x=X(u[i],V)))return x}t(f,O,q++,V)}else{V=-V-1|0;for(i=0;i<q;++i){var x;if(void 0!==(x=X(V,f[i])))return x}t(u,w,T++,V)}}},sweepComplete:function(b,X,P,Q,S,N,a,B,W,n){for(var y=0,h=2*b,L=b-1,Z=h-1,v=P;v<Q;++v){var A=N[v]+1<<1,o=h*v;D[y++]=S[o+L],D[y++]=-A,D[y++]=S[o+Z],D[y++]=A}for(v=a;v<B;++v){A=n[v]+1<<1;var K=h*v;D[y++]=W[K+L],D[y++]=1|-A,D[y++]=W[K+Z],D[y++]=1|A}var T=y>>>1;d(D,T);var q=0,V=0,i=0;for(v=0;v<T;++v){var x=0|D[2*v+1],H=1&x;if(v<T-1&&x>>1===D[2*v+3]>>1&&(H=2,v+=1),x<0){for(var C=-(x>>1)-1,p=0;p<i;++p){if(void 0!==(k=X(e[p],C)))return k}if(0!==H)for(p=0;p<q;++p){if(void 0!==(k=X(u[p],C)))return k}if(1!==H)for(p=0;p<V;++p){var k;if(void 0!==(k=X(f[p],C)))return k}0===H?t(u,w,q++,C):1===H?t(f,O,V++,C):2===H&&t(e,Y,i++,C)}else{C=(x>>1)-1;0===H?E(u,w,q--,C):1===H?E(f,O,V--,C):2===H&&E(e,Y,i--,C)}}},scanBipartite:function(b,X,P,Q,S,a,f,O,e,Y,B,W){var n=0,y=2*b,h=X,L=X+b,Z=1,v=1;Q?v=N:Z=N;for(var A=S;A<a;++A){var o=A+Z,K=y*A;D[n++]=f[K+h],D[n++]=-o,D[n++]=f[K+L],D[n++]=o}for(A=e;A<Y;++A){o=A+v;var T=y*A;D[n++]=B[T+h],D[n++]=-o}var q=n>>>1;d(D,q);var V=0;for(A=0;A<q;++A){var i=0|D[2*A+1];if(i<0){var x=!1;if((o=-i)>=N?(x=!Q,o-=N):(x=!!Q,o-=1),x)t(u,w,V++,o);else{var H=W[o],C=y*o,p=B[C+X+1],k=B[C+X+1+b];b:for(var z=0;z<V;++z){var U=u[z],g=y*U;if(!(k<f[g+X+1]||f[g+X+1+b]<p)){for(var j=X+2;j<b;++j)if(B[C+j+b]<f[g+j]||f[g+j+b]<B[C+j])continue b;var l,J=O[U];if(void 0!==(l=Q?P(H,J):P(J,H)))return l}}}}else E(u,w,V--,i-Z)}},scanComplete:function(b,X,P,Q,S,a,w,f,O,e,Y){for(var E=0,t=2*b,B=X,W=X+b,n=Q;n<S;++n){var y=n+N,h=t*n;D[E++]=a[h+B],D[E++]=-y,D[E++]=a[h+W],D[E++]=y}for(n=f;n<O;++n){y=n+1;var L=t*n;D[E++]=e[L+B],D[E++]=-y}var Z=E>>>1;d(D,Z);var v=0;for(n=0;n<Z;++n){var A=0|D[2*n+1];if(A<0){if((y=-A)>=N)u[v++]=y-N;else{var o=Y[y-=1],K=t*y,T=e[K+X+1],q=e[K+X+1+b];b:for(var V=0;V<v;++V){var i=u[V],x=w[i];if(x===o)break;var H=t*i;if(!(q<a[H+X+1]||a[H+X+1+b]<T)){for(var C=X+2;C<b;++C)if(e[K+C+b]<a[H+C]||a[H+C+b]<e[K+C])continue b;var p=P(x,o);if(void 0!==p)return p}}}}else{for(y=A-N,V=v-1;V>=0;--V)if(u[V]===y){for(C=V+1;C<v;++C)u[C-1]=u[C];break}--v}}}};var Q=P(13931),S=P(13934),d=P(13952),N=1<<28,a=1024,u=Q.mallocInt32(a),w=Q.mallocInt32(a),f=Q.mallocInt32(a),O=Q.mallocInt32(a),e=Q.mallocInt32(a),Y=Q.mallocInt32(a),D=Q.mallocDouble(8192);function E(b,X,P,Q){var S=X[Q],d=b[P-1];b[S]=d,X[d]=S}function t(b,X,P,Q){b[P]=Q,X[Q]=P}},13940:b=>{"use strict";function X(b,P,Q){var S=0|b[Q];if(S<=0)return[];var d,N=new Array(S);if(Q===b.length-1)for(d=0;d<S;++d)N[d]=P;else for(d=0;d<S;++d)N[d]=X(b,P,Q+1);return N}b.exports=function(b,P){switch("undefined"===typeof P&&(P=0),typeof b){case"number":if(b>0)return function(b,X){var P,Q;for(P=new Array(b),Q=0;Q<b;++Q)P[Q]=X;return P}(0|b,P);break;case"object":if("number"===typeof b.length)return X(b,P,0)}return[]}},13887:(b,X,P)=>{b.exports=function(){var b=this;this.components={},this.comps=this.components;var X=this.components,P=1,S={},d=[],N=[],a={timeout:!1,removals:[],multiComps:[]};function u(b,P){var Q=X[P],d=S[P],N=d.hash[b];N&&(d.remove(b),Q.IX&&(Q.multi?(N.forEach((X=>{X&&Q.IX(b,X)})),N.length=0):Q.IX(b,N)),a.removals.push(d),w())}function w(){a.timeout||(a.timeout=!0,setTimeout(f,1))}function f(){a.timeout=!1,O()}function O(){a.multiComps.length&&function(b){for(var X=0;X<b.length;X++){var{entID:P,data:Q}=b[X],S=Q.hash[P];if(S){for(var d=0;d<S.length;d++)S[d]||(S.splice(d,1),d--);0===S.length&&(Q.remove(P),a.removals.push(Q))}}b.length=0}(a.multiComps),a.removals.length&&function(b){for(var X=0;X<b.length;X++){b[X].flush()}b.length=0}(a.removals)}this.LO=S,this._systems=d,this._renderSystems=N,this.Mw=function(X){var Q=P++;return Array.isArray(X)&&X.forEach((X=>b.qu(Q,X))),Q},this.deleteEntity=function(X){return Object.keys(S).forEach((b=>{S[b].hash[X]&&u(X,b)})),b},this.ef=function(b){if(!b)throw new Error("Missing component definition");var P=b.name;if(!P)throw new Error("Component definition must have a name property.");if("string"!==typeof P)throw new Error("Component name must be a string.");if(""===P)throw new Error("Component name must be a non-empty string.");if(S[P])throw new Error(`Component ${P} already exists.`);var a={};return a.name=P,a.multi=!!b.multi,a.order=isNaN(b.order)?99:b.order,a.stateConstructor=b.stateConstructor||null,a.state=b.state||{},a.Ka=b.Ka||null,a.IX=b.IX||null,a.system=b.system||null,a.Ha=b.Ha||null,X[P]=a,S[P]=new Q,S[P]._pendingMultiCleanup=!1,S[P]._multiCleanupIDs=a.multi?[]:null,a.system&&(d.push(P),d.sort(((b,P)=>X[b].order-X[P].order))),a.Ha&&(N.push(P),N.sort(((b,P)=>X[b].order-X[P].order))),P},this.overwriteComponent=function(b,P){var Q=X[b];if(!Q)throw new Error(`Unknown component: ${b}`);if(!P)throw new Error("Missing component definition");if(Q.name!==P.name)throw new Error("Overwriting component must use the same name property.");var a={};a.name=b,a.multi=!!P.multi,a.order=isNaN(P.order)?99:P.order,a.state=P.state||{},a.Ka=P.Ka||null,a.IX=P.IX||null,a.system=P.system||null,a.Ha=P.Ha||null,X[b]=a,S[b]._pendingMultiCleanup=!1,S[b]._multiCleanupIDs=a.multi?[]:null;var u=d.indexOf(b);a.system&&u<0&&d.push(b),!a.system&&u>=0&&d.splice(u,1),d.sort(((b,P)=>X[b].order-X[P].order));var w=N.indexOf(b);a.Ha&&w<0&&N.push(b),!a.Ha&&w>=0&&N.splice(w,1),N.sort(((b,P)=>X[b].order-X[P].order));var f=a.state;return this.Tw(b).forEach((b=>{for(var X in f)X in b||(b[X]=f[X]);a.Ka&&a.Ka(b.ia,b)})),b},this.deleteComponent=function(P){var Q=S[P];if(!Q)throw new Error(`Unknown component: ${P}`);Q.flush(),Q.list.forEach((b=>{b&&u(b.ia||b[0].ia,P)}));var a=d.indexOf(P),w=N.indexOf(P);return a>-1&&d.splice(a,1),w>-1&&N.splice(w,1),S[P].dispose(),delete S[P],delete X[P],b},this.qu=function(b,P,Q){var d,N=X[P],a=S[P];if(!a)throw new Error(`Unknown component: ${P}.`);if(a.hash[b]&&!N.multi)throw new Error(`Entity ${b} already has component: ${P}.`);if(N.stateConstructor){if(!(d=new N.stateConstructor).hasOwnProperty("ia"))throw new Error(`Component ${N.name} stateConstructor type does not have property __id`)}else d=Object.assign({},{ia:b},N.state,Q);if(d.ia=b,N.multi){var u=a.hash[b];u||(u=[],a.add(b,u)),u.push(d)}else a.add(b,d);return N.Ka&&N.Ka(b,d),this},this.gu=function(b,X){var P=S[X];if(!P)throw new Error(`Unknown component: ${X}.`);return!!P.hash[b]},this.Hu=function(X,P){if(!S[P])throw new Error(`Unknown component: ${P}.`);return u(X,P),b},this.getState=function(b,X){var P=S[X];if(!P)throw new Error(`Unknown component: ${X}.`);return P.hash[b]},this.Tw=function(b){var X=S[b];if(!X)throw new Error(`Unknown component: ${b}.`);return O(),X.list},this.iY=function(b){if(!S[b])throw new Error(`Unknown component: ${b}.`);var X=S[b].hash;return b=>X[b]},this.CY=function(b){if(!S[b])throw new Error(`Unknown component: ${b}.`);var X=S[b].hash;return b=>!!X[b]},this.ta=function(P){O();for(var Q=0;Q<d.length;Q++){var N=d[Q],a=X[N],u=S[N];a.system(P,u.list),O()}return b},this.render=function(P){O();for(var Q=0;Q<N.length;Q++){var d=N[Q],a=X[d],u=S[d];a.Ha(P,u.list),O()}return b},this.removeMultiComponent=function(P,Q,d){var N=X[Q],u=S[Q];if(!u)throw new Error(`Unknown component: ${Q}.`);if(!N.multi)throw new Error("removeMultiComponent called on non-multi component");return function(b,X,P,Q){var S=P.hash[b];if(S){var d=S[Q];d&&(S[Q]=null,X.IX&&X.IX(b,d),a.multiComps.push({entID:b,data:P}),w())}}(P,N,u,d),b}};var Q=P(13890)},13890:b=>{function X(b,X){var P=b._map[X];if(delete b.hash[X],delete b._map[X],P===b.list.length-1)b.list.pop();else{var Q=b.list.pop();if(b.list[P]=Q,null===Q||null===Q[0]){var S=b.list.length;for(var d in b._map)if(b._map[d]===S)return void(b._map[d]=P)}else{var N=Q.ia||Q[0].ia;b._map[N]=P}}}b.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(b,X){if("number"===typeof this._map[b]){var P=this._map[b];this.hash[b]=X,this.list[P]=X}else this._map[b]=this.list.length,this.hash[b]=X,this.list.push(X)}remove(b){var X=this._map[b];this.hash[b]=null,this.list[X]=null,this._pendingRemovals.push(b)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var b=0;b<this._pendingRemovals.length;b++){var P=this._pendingRemovals[b];null===this.hash[P]&&X(this,P)}this._pendingRemovals.length=0}}},13848:b=>{"use strict";var X,P="object"===typeof Reflect?Reflect:null,Q=function(b,X,P){return Function.prototype.apply.call(b,X,P)};X=P&&"function"===typeof P.ownKeys?P.ownKeys:Object.getOwnPropertySymbols?function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:function(b){return Object.getOwnPropertyNames(b)};var S=Number.isNaN||function(b){return b!==b};function d(){d.init.call(this)}b.exports=d,b.exports.once=function(b,X){return new Promise((function(P,Q){function S(P){b.removeListener(X,d),Q(P)}function d(){"function"===typeof b.removeListener&&b.removeListener("error",S),P([].slice.call(arguments))}E(b,X,d,{once:!0}),"error"!==X&&function(b,X,P){"function"===typeof b.on&&E(b,"error",X,P)}(b,S,{once:!0})}))},d.EventEmitter=d,d.prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var N=10;function a(b){if("function"!==typeof b)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}function u(b){return void 0===b._maxListeners?d.defaultMaxListeners:b._maxListeners}function w(b,X,P,Q){var S,d,N,w;if(a(P),void 0===(d=b._events)?(d=b._events=Object.create(null),b._eventsCount=0):(void 0!==d.newListener&&(b.emit("newListener",X,P.listener?P.listener:P),d=b._events),N=d[X]),void 0===N)N=d[X]=P,++b._eventsCount;else if("function"===typeof N?N=d[X]=Q?[P,N]:[N,P]:Q?N.unshift(P):N.push(P),(S=u(b))>0&&N.length>S&&!N.warned){N.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+N.length+" "+String(X)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.dX=b,f.type=X,f.count=N.length,w=f,console&&console.warn&&console.warn(w)}return b}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function O(b,X,P){var Q={fired:!1,wrapFn:void 0,target:b,type:X,listener:P},S=f.bind(Q);return S.listener=P,Q.wrapFn=S,S}function e(b,X,P){var Q=b._events;if(void 0===Q)return[];var S=Q[X];return void 0===S?[]:"function"===typeof S?P?[S.listener||S]:[S]:P?function(b){for(var X=new Array(b.length),P=0;P<X.length;++P)X[P]=b[P].listener||b[P];return X}(S):D(S,S.length)}function Y(b){var X=this._events;if(void 0!==X){var P=X[b];if("function"===typeof P)return 1;if(void 0!==P)return P.length}return 0}function D(b,X){for(var P=new Array(X),Q=0;Q<X;++Q)P[Q]=b[Q];return P}function E(b,X,P,Q){if("function"===typeof b.on)Q.once?b.once(X,P):b.on(X,P);else{if("function"!==typeof b.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b);b.addEventListener(X,(function S(d){Q.once&&b.removeEventListener(X,S),P(d)}))}}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return N},set:function(b){if("number"!==typeof b||b<0||S(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");N=b}}),d.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(b){if("number"!==typeof b||b<0||S(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this},d.prototype.getMaxListeners=function(){return u(this)},d.prototype.emit=function(b){for(var X=[],P=1;P<arguments.length;P++)X.push(arguments[P]);var S="error"===b,d=this._events;if(void 0!==d)S=S&&void 0===d.error;else if(!S)return!1;if(S){var N;if(X.length>0&&(N=X[0]),N instanceof Error)throw N;var a=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw a.context=N,a}var u=d[b];if(void 0===u)return!1;if("function"===typeof u)Q(u,this,X);else{var w=u.length,f=D(u,w);for(P=0;P<w;++P)Q(f[P],this,X)}return!0},d.prototype.addListener=function(b,X){return w(this,b,X,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(b,X){return w(this,b,X,!0)},d.prototype.once=function(b,X){return a(X),this.on(b,O(this,b,X)),this},d.prototype.prependOnceListener=function(b,X){return a(X),this.prependListener(b,O(this,b,X)),this},d.prototype.removeListener=function(b,X){var P,Q,S,d,N;if(a(X),void 0===(Q=this._events))return this;if(void 0===(P=Q[b]))return this;if(P===X||P.listener===X)0===--this._eventsCount?this._events=Object.create(null):(delete Q[b],Q.removeListener&&this.emit("removeListener",b,P.listener||X));else if("function"!==typeof P){for(S=-1,d=P.length-1;d>=0;d--)if(P[d]===X||P[d].listener===X){N=P[d].listener,S=d;break}if(S<0)return this;0===S?P.shift():function(b,X){for(;X+1<b.length;X++)b[X]=b[X+1];b.pop()}(P,S),1===P.length&&(Q[b]=P[0]),void 0!==Q.removeListener&&this.emit("removeListener",b,N||X)}return this},d.prototype.off=d.prototype.removeListener,d.prototype.NX=function(b){var X,P,Q;if(void 0===(P=this._events))return this;if(void 0===P.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==P[b]&&(0===--this._eventsCount?this._events=Object.create(null):delete P[b]),this;if(0===arguments.length){var S,d=Object.keys(P);for(Q=0;Q<d.length;++Q)"removeListener"!==(S=d[Q])&&this.NX(S);return this.NX("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(X=P[b]))this.removeListener(b,X);else if(void 0!==X)for(Q=X.length-1;Q>=0;Q--)this.removeListener(b,X[Q]);return this},d.prototype.listeners=function(b){return e(this,b,!0)},d.prototype.rawListeners=function(b){return e(this,b,!1)},d.listenerCount=function(b,X){return"function"===typeof b.listenerCount?b.listenerCount(X):Y.call(b,X)},d.prototype.listenerCount=Y,d.prototype.eventNames=function(){return this._eventsCount>0?X(this._events):[]}},14131:b=>{"use strict";b.exports=function(b,X,P,Q,S,d){var N=+X[0],a=+X[1],u=+X[2],w=+P[0],f=+P[1],O=+P[2],e=Math.sqrt(w*w+f*f+O*O);if(0===e)throw new Error("Can't raycast along a zero vector");return function(b,X,P,Q,S,d,N,a,u,w){for(var f=0,O=Math.floor,e=0|O(X),Y=0|O(P),D=0|O(Q),E=S>0?1:-1,t=d>0?1:-1,B=N>0?1:-1,W=Math.abs(1/S),n=Math.abs(1/d),y=Math.abs(1/N),h=W<1/0?W*(E>0?e+1-X:X-e):1/0,L=n<1/0?n*(t>0?Y+1-P:P-Y):1/0,Z=y<1/0?y*(B>0?D+1-Q:Q-D):1/0,v=-1;f<=a;){var A=b(e,Y,D);if(A)return u&&(u[0]=X+f*S,u[1]=P+f*d,u[2]=Q+f*N),w&&(w[0]=w[1]=w[2]=0,0===v&&(w[0]=-E),1===v&&(w[1]=-t),2===v&&(w[2]=-B)),A;h<L?h<Z?(e+=E,f=h,h+=W,v=0):(D+=B,f=Z,Z+=y,v=2):L<Z?(Y+=t,f=L,L+=n,v=1):(D+=B,f=Z,Z+=y,v=2)}return u&&(u[0]=X+f*S,u[1]=P+f*d,u[2]=Q+f*N),w&&(w[0]=w[1]=w[2]=0),0}(b,N,a,u,w/=e,f/=e,O/=e,Q="undefined"===typeof Q?64:+Q,S,d)}},14169:(b,X,P)=>{"use strict";P.d(X,{e:()=>d});var Q=P(13848);function S(){this.Be=!1,this.stopPropagation=!1,this.We=!1,this.disabled=!1}class d{constructor(b,X){this.version="0.7.0";var P=Object.assign({},new S,X||{});this.element=b||document,this.Be=!!P.Be,this.stopPropagation=!!P.stopPropagation,this.We=!!P.We,this.disabled=!!P.disabled,this.filterEvents=(b,X)=>!0,this.down=new Q.EventEmitter,this.up=new Q.EventEmitter,this.state={},this.hw={dx:0,dy:0,LY:0,yw:0,ZY:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?a(this):document.addEventListener("DOMContentLoaded",(b=>{a(this)}),{once:!0})}bind(b){for(var X=arguments.length,P=new Array(X>1?X-1:0),Q=1;Q<X;Q++)P[Q-1]=arguments[Q];P.forEach((X=>{var P=this._keyBindmap[X]||[];P.includes(b)||(P.push(b),this._keyBindmap[X]=P)})),this.state[b]=!!this.state[b],this.pressCount[b]=this.pressCount[b]||0,this.releaseCount[b]=this.releaseCount[b]||0}unbind(b){for(var X in this._keyBindmap){var P=this._keyBindmap[X],Q=P.indexOf(b);Q>-1&&P.splice(Q,1)}}getBindings(){var b={};for(var X in this._keyBindmap){this._keyBindmap[X].forEach((P=>{b[P]=b[P]||[],b[P].push(X)}))}return b}ta(){N(this.hw),N(this.pressCount),N(this.releaseCount)}}function N(b){for(var X in b)b[X]=0}function a(b){window.addEventListener("keydown",D.bind(null,b,!0),!1),window.addEventListener("keyup",D.bind(null,b,!1),!1);var X={passive:!0};b.element.addEventListener("touchstart",O.bind(void 0,b),{passive:!1}),b.element.addEventListener("touchend",Y.bind(void 0,b),X),b.element.addEventListener("mousedown",E.bind(null,b,!0),X),window.document.addEventListener("mouseup",E.bind(null,b,!1),X),b.element.addEventListener("touchmove",t.bind(null,b),X),b.element.addEventListener("mousemove",t.bind(null,b),X),window.PointerEvent,b.element.addEventListener("wheel",B.bind(null,b),X),b.element.addEventListener("contextmenu",W.bind(null,b),!1),window.addEventListener("blur",n.bind(null,b),!1)}var u=0,w=0,f=null;function O(b,X){X.preventDefault(),e(X)}function e(b){let X=!1;for(let P=0;P<b.touches.length;++P)if(b.touches[P].identifier===f){X=!0;break}if(!X){const X=b.changedTouches[0];u=X.clientX,w=X.clientY,f=X.identifier}}function Y(b,X){for(var P=X.changedTouches,Q=0;Q<P.length;++Q)P[Q].identifier===f&&(f=null)}function D(b,X,P){y(P.code,X,b,P)}function E(b,X,P){if("pointerId"in P)if(X){if(null!==b._touches.currID)return;b._touches.currID=P.pointerId}else{if(b._touches.currID!==P.pointerId)return;b._touches.currID=null}return y("Mouse"+("button"in P?P.button+1:1),X,b,P),!1}function t(b,X){var P=X.movementX||X.mozMovementX||0,Q=X.movementY||X.mozMovementY||0;if(X.touches&&0===(P|Q)){var S=function(b){e(b);for(let X=0;X<b.changedTouches.length;++X)if(b.changedTouches[X].identifier==f){const P=b.changedTouches[X],Q=[P.clientX-u,P.clientY-w];return u=P.clientX,w=P.clientY,Q}return console.error(`Did not find touch id ${f}`),[0,0]}(X);P=S[0],Q=S[1]}b.hw.dx+=P,b.hw.dy+=Q}function B(b,X){var P=1;switch(X.deltaMode){case 0:P=1;break;case 1:P=12;break;case 2:P=b.element.clientHeight||window.innerHeight}b.hw.LY+=(X.deltaX||0)*P,b.hw.yw+=(X.deltaY||0)*P,b.hw.ZY+=(X.deltaZ||0)*P}function W(b,X){if(!b.We)return X.preventDefault(),!1}function n(b){for(var X in b._keyStates)b._keyStates[X]&&(/^Mouse\d/.test(X)||y(X,!1,b,{code:X,note:"qxkfwseffgd",preventDefault:()=>{},stopPropagation:()=>{}}))}function y(b,X,P,Q){var S=P._keyBindmap[b];S&&(h(P._keyStates[b],X)&&(P._keyStates[b]=X,S.forEach((b=>{(!P.filterEvents||P.filterEvents(Q,b))&&function(b,X,P,Q){var S=X?P.pressCount:P.releaseCount;S[b]=(S[b]||0)+1;var d=P._bindPressCount[b]||0;(d+=X?1:-1)<0&&(d=0);P._bindPressCount[b]=d;var N=P.state[b];if(h(N,d)){P.state[b]=d>0;var a=X?P.down:P.up;P.disabled||a.emit(b,Q)}}(b,X,P,Q)}))),"button"in Q||(P.Be&&!Q.defaultPrevented&&Q.preventDefault(),P.stopPropagation&&Q.stopPropagation()))}function h(b,X){return b?!X:X}},12779:b=>{b.exports=function(b,X,P){return b[0]=X[0]+P[0],b[1]=X[1]+P[1],b[2]=X[2]+P[2],b}},12728:(b,X,P)=>{b.exports=function(b,X){var P=Q(b[0],b[1],b[2]),N=Q(X[0],X[1],X[2]);S(P,P),S(N,N);var a=d(P,N);return a>1?0:Math.acos(a)};var Q=P(12732),S=P(12739),d=P(12748)},12843:b=>{b.exports=function(b,X){return b[0]=Math.ceil(X[0]),b[1]=Math.ceil(X[1]),b[2]=Math.ceil(X[2]),b}},12720:b=>{b.exports=function(b){var X=new Float32Array(3);return X[0]=b[0],X[1]=b[1],X[2]=b[2],X}},12757:b=>{b.exports=function(b,X){return b[0]=X[0],b[1]=X[1],b[2]=X[2],b}},12712:b=>{b.exports=function(){var b=new Float32Array(3);return b[0]=0,b[1]=0,b[2]=0,b}},12939:b=>{b.exports=function(b,X,P){var Q=X[0],S=X[1],d=X[2],N=P[0],a=P[1],u=P[2];return b[0]=S*u-d*a,b[1]=d*N-Q*u,b[2]=Q*a-S*N,b}},12879:(b,X,P)=>{b.exports=P(12874)},12874:b=>{b.exports=function(b,X){var P=X[0]-b[0],Q=X[1]-b[1],S=X[2]-b[2];return Math.sqrt(P*P+Q*Q+S*S)}},12821:(b,X,P)=>{b.exports=P(12812)},12812:b=>{b.exports=function(b,X,P){return b[0]=X[0]/P[0],b[1]=X[1]/P[1],b[2]=X[2]/P[2],b}},12748:b=>{b.exports=function(b,X){return b[0]*X[0]+b[1]*X[1]+b[2]*X[2]}},12706:b=>{b.exports=1e-6},12769:(b,X,P)=>{b.exports=function(b,X){var P=b[0],S=b[1],d=b[2],N=X[0],a=X[1],u=X[2];return Math.abs(P-N)<=Q*Math.max(1,Math.abs(P),Math.abs(N))&&Math.abs(S-a)<=Q*Math.max(1,Math.abs(S),Math.abs(a))&&Math.abs(d-u)<=Q*Math.max(1,Math.abs(d),Math.abs(u))};var Q=P(12706)},12777:b=>{b.exports=function(b,X){return b[0]===X[0]&&b[1]===X[1]&&b[2]===X[2]}},12837:b=>{b.exports=function(b,X){return b[0]=Math.floor(X[0]),b[1]=Math.floor(X[1]),b[2]=Math.floor(X[2]),b}},12990:(b,X,P)=>{b.exports=function(b,X,P,S,d,N){var a,u;X||(X=3);P||(P=0);u=S?Math.min(S*X+P,b.length):b.length;for(a=P;a<u;a+=X)Q[0]=b[a],Q[1]=b[a+1],Q[2]=b[a+2],d(Q,Q,N),b[a]=Q[0],b[a+1]=Q[1],b[a+2]=Q[2];return b};var Q=P(12712)()},12732:b=>{b.exports=function(b,X,P){var Q=new Float32Array(3);return Q[0]=b,Q[1]=X,Q[2]=P,Q}},12702:(b,X,P)=>{b.exports={EPSILON:P(12706),create:P(12712),clone:P(12720),angle:P(12728),aa:P(12732),j:P(12757),set:P(12766),equals:P(12769),exactEquals:P(12777),add:P(12779),BX:P(12785),sub:P(12791),multiply:P(12795),mul:P(12804),divide:P(12812),div:P(12821),min:P(12830),max:P(12834),floor:P(12837),ceil:P(12843),round:P(12850),scale:P(12859),ua:P(12867),distance:P(12874),i:P(12879),squaredDistance:P(12887),sqrDist:P(12895),length:P(12903),len:P(12912),squaredLength:P(12916),wa:P(12921),negate:P(12923),inverse:P(12931),normalize:P(12739),dot:P(12748),cross:P(12939),Sa:P(12941),random:P(12948),transformMat4:P(12953),transformMat3:P(12956),transformQuat:P(12965),fa:P(12974),Oa:P(12981),ea:P(12984),forEach:P(12990)}},12931:b=>{b.exports=function(b,X){return b[0]=1/X[0],b[1]=1/X[1],b[2]=1/X[2],b}},12912:(b,X,P)=>{b.exports=P(12903)},12903:b=>{b.exports=function(b){var X=b[0],P=b[1],Q=b[2];return Math.sqrt(X*X+P*P+Q*Q)}},12941:b=>{b.exports=function(b,X,P,Q){var S=X[0],d=X[1],N=X[2];return b[0]=S+Q*(P[0]-S),b[1]=d+Q*(P[1]-d),b[2]=N+Q*(P[2]-N),b}},12834:b=>{b.exports=function(b,X,P){return b[0]=Math.max(X[0],P[0]),b[1]=Math.max(X[1],P[1]),b[2]=Math.max(X[2],P[2]),b}},12830:b=>{b.exports=function(b,X,P){return b[0]=Math.min(X[0],P[0]),b[1]=Math.min(X[1],P[1]),b[2]=Math.min(X[2],P[2]),b}},12804:(b,X,P)=>{b.exports=P(12795)},12795:b=>{b.exports=function(b,X,P){return b[0]=X[0]*P[0],b[1]=X[1]*P[1],b[2]=X[2]*P[2],b}},12923:b=>{b.exports=function(b,X){return b[0]=-X[0],b[1]=-X[1],b[2]=-X[2],b}},12739:b=>{b.exports=function(b,X){var P=X[0],Q=X[1],S=X[2],d=P*P+Q*Q+S*S;d>0&&(d=1/Math.sqrt(d),b[0]=X[0]*d,b[1]=X[1]*d,b[2]=X[2]*d);return b}},12948:b=>{b.exports=function(b,X){X=X||1;var P=2*Math.random()*Math.PI,Q=2*Math.random()-1,S=Math.sqrt(1-Q*Q)*X;return b[0]=Math.cos(P)*S,b[1]=Math.sin(P)*S,b[2]=Q*X,b}},12974:b=>{b.exports=function(b,X,P,Q){var S=P[1],d=P[2],N=X[1]-S,a=X[2]-d,u=Math.sin(Q),w=Math.cos(Q);return b[0]=X[0],b[1]=S+N*w-a*u,b[2]=d+N*u+a*w,b}},12981:b=>{b.exports=function(b,X,P,Q){var S=P[0],d=P[2],N=X[0]-S,a=X[2]-d,u=Math.sin(Q),w=Math.cos(Q);return b[0]=S+a*u+N*w,b[1]=X[1],b[2]=d+a*w-N*u,b}},12984:b=>{b.exports=function(b,X,P,Q){var S=P[0],d=P[1],N=X[0]-S,a=X[1]-d,u=Math.sin(Q),w=Math.cos(Q);return b[0]=S+N*w-a*u,b[1]=d+N*u+a*w,b[2]=X[2],b}},12850:b=>{b.exports=function(b,X){return b[0]=Math.round(X[0]),b[1]=Math.round(X[1]),b[2]=Math.round(X[2]),b}},12859:b=>{b.exports=function(b,X,P){return b[0]=X[0]*P,b[1]=X[1]*P,b[2]=X[2]*P,b}},12867:b=>{b.exports=function(b,X,P,Q){return b[0]=X[0]+P[0]*Q,b[1]=X[1]+P[1]*Q,b[2]=X[2]+P[2]*Q,b}},12766:b=>{b.exports=function(b,X,P,Q){return b[0]=X,b[1]=P,b[2]=Q,b}},12895:(b,X,P)=>{b.exports=P(12887)},12921:(b,X,P)=>{b.exports=P(12916)},12887:b=>{b.exports=function(b,X){var P=X[0]-b[0],Q=X[1]-b[1],S=X[2]-b[2];return P*P+Q*Q+S*S}},12916:b=>{b.exports=function(b){var X=b[0],P=b[1],Q=b[2];return X*X+P*P+Q*Q}},12791:(b,X,P)=>{b.exports=P(12785)},12785:b=>{b.exports=function(b,X,P){return b[0]=X[0]-P[0],b[1]=X[1]-P[1],b[2]=X[2]-P[2],b}},12956:b=>{b.exports=function(b,X,P){var Q=X[0],S=X[1],d=X[2];return b[0]=Q*P[0]+S*P[3]+d*P[6],b[1]=Q*P[1]+S*P[4]+d*P[7],b[2]=Q*P[2]+S*P[5]+d*P[8],b}},12953:b=>{b.exports=function(b,X,P){var Q=X[0],S=X[1],d=X[2],N=P[3]*Q+P[7]*S+P[11]*d+P[15];return N=N||1,b[0]=(P[0]*Q+P[4]*S+P[8]*d+P[12])/N,b[1]=(P[1]*Q+P[5]*S+P[9]*d+P[13])/N,b[2]=(P[2]*Q+P[6]*S+P[10]*d+P[14])/N,b}},12965:b=>{b.exports=function(b,X,P){var Q=X[0],S=X[1],d=X[2],N=P[0],a=P[1],u=P[2],w=P[3],f=w*Q+a*d-u*S,O=w*S+u*Q-N*d,e=w*d+N*S-a*Q,Y=-N*Q-a*S-u*d;return b[0]=f*w+Y*-N+O*-u-e*-a,b[1]=O*w+Y*-a+e*-N-f*-u,b[2]=e*w+Y*-u+f*-a-O*-N,b}},13866:b=>{"use strict";b.exports=function(b){for(var X=new Array(b),P=0;P<b;++P)X[P]=P;return X}},13947:b=>{b.exports=function(b){return null!=b&&null!=b.constructor&&"function"===typeof b.constructor.isBuffer&&b.constructor.isBuffer(b)}},14139:(b,X,P)=>{"use strict";P.d(X,{c:()=>Q});class Q{constructor(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.sf=!1,this.Ff=!1,this.lf=30,this.Jf=0,this.QO=!1,this.fullscreen=!1,this.rf=function(b){},this.If=function(){},this.XO=function(){},this.QQ=function(){},this.mO=function(b){},this.onFullscreenChanged=function(b){},w((()=>{!function(b,X){b._nowObject=performance||Date,b._lastTick=0,b._renderAccum=0,b._rt=0,b._frameCB=a.bind(null,b),requestAnimationFrame(b._frameCB),X>0&&(b._intervalCB=N.bind(null,b),b._interval=setInterval(b._intervalCB,Math.max(X,1e3/b.lf/2)))}(this,X),function(b,X){if(!X)return;var P=!1,Q=!1;document.addEventListener("pointerlockchange",(Q=>{P=document.pointerLockElement===X,b.mO(P)})),document.addEventListener("fullscreenchange",(P=>{Q=document.fullscreenElement===X,b.onFullscreenChanged(Q)})),Object.defineProperty(b,"QO",{get:()=>P,set:b=>{b&&!P?u(X):P&&!b&&function(b){b.exitPointerLock&&b.exitPointerLock()}(document)}}),Object.defineProperty(b,"fullscreen",{get:()=>Q,set:b=>{b&&!Q?X.requestFullscreen():Q&&!b&&document.exitFullscreen()}}),X.addEventListener("click",(S=>{b.sf&&!P&&u(X),b.Ff&&!Q&&X.requestFullscreen()}));var S=()=>b.QQ();if(window.ResizeObserver){new ResizeObserver(S).observe(X)}else window.addEventListener("resize",S)}(this,b),this.XO()}))}}var S=3,d=20;function N(b){for(var X=1e3/b.lf,P=b._nowObject.now()+d,Q=0;b._nowObject.now()>=b._lastTick+X&&b._nowObject.now()<P&&++Q<=S;)b.rf(X),b._lastTick+=X;var N=5*(X+5),a=b._nowObject.now();if(a-b._lastTick>N)for(;a>=b._lastTick+X;)b._lastTick+=X}function a(b){requestAnimationFrame(b._frameCB),N(b);var X=b._nowObject.now(),P=X-b._rt;if(b._rt=X,b.Jf>0){b._renderAccum+=P;var Q=1e3/b.Jf;if(b._renderAccum<Q)return;b._renderAccum=Math.min(b._renderAccum-Q,Q)}var S=1e3/b.lf,d=(X-b._lastTick)/S;b.If(P,d,S)}function u(b){b.requestPointerLock&&b.requestPointerLock()}var w=b=>{if("loading"===document.readyState){var X=()=>{document.removeEventListener("readystatechange",X),b()};document.addEventListener("readystatechange",X)}else setTimeout(b,1)}},13864:(b,X,P)=>{var Q=P(13866),S=P(13875),d="undefined"!==typeof Float64Array;function N(b,X){return b[0]-X[0]}function a(){var b,X=this.stride,P=new Array(X.length);for(b=0;b<P.length;++b)P[b]=[Math.abs(X[b]),b];P.sort(N);var Q=new Array(P.length);for(b=0;b<Q.length;++b)Q[b]=P[b][1];return Q}function u(b,X){var P=["View",X,"d",b].join("");X<0&&(P="View_Nil"+b);var S="generic"===b;if(-1===X){var d="function "+P+"(a){this.data=a;};var proto="+P+".prototype;proto.dtype='"+b+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+P+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+P+"(a){return new "+P+"(a);}";return new Function(d)()}if(0===X){d="function "+P+"(a,d) {this.data = a;this.offset = d};var proto="+P+".prototype;proto.dtype='"+b+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+P+"_copy() {return new "+P+"(this.data,this.offset)};proto.pick=function "+P+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+P+"_get(){return "+(S?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+P+"_set(v){return "+(S?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+P+"(a,b,c,d){return new "+P+"(a,d)}";return new Function("TrivialArray",d)(w[b][0])}d=["'use strict'"];var N=Q(X),u=N.map((function(b){return"i"+b})),f="this.offset+"+N.map((function(b){return"this.stride["+b+"]*i"+b})).join("+"),O=N.map((function(b){return"b"+b})).join(","),e=N.map((function(b){return"c"+b})).join(",");d.push("function "+P+"(a,"+O+","+e+",d){this.data=a","this.shape=["+O+"]","this.stride=["+e+"]","this.offset=d|0}","var proto="+P+".prototype","proto.dtype='"+b+"'","proto.dimension="+X),d.push("Object.defineProperty(proto,'size',{get:function "+P+"_size(){return "+N.map((function(b){return"this.shape["+b+"]"})).join("*"),"}})"),1===X?d.push("proto.order=[0]"):(d.push("Object.defineProperty(proto,'order',{get:"),X<4?(d.push("function "+P+"_order(){"),2===X?d.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===X&&d.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):d.push("ORDER})")),d.push("proto.set=function "+P+"_set("+u.join(",")+",v){"),S?d.push("return this.data.set("+f+",v)}"):d.push("return this.data["+f+"]=v}"),d.push("proto.get=function "+P+"_get("+u.join(",")+"){"),S?d.push("return this.data.get("+f+")}"):d.push("return this.data["+f+"]}"),d.push("proto.index=function "+P+"_index(",u.join(),"){return "+f+"}"),d.push("proto.hi=function "+P+"_hi("+u.join(",")+"){return new "+P+"(this.data,"+N.map((function(b){return["(typeof i",b,"!=='number'||i",b,"<0)?this.shape[",b,"]:i",b,"|0"].join("")})).join(",")+","+N.map((function(b){return"this.stride["+b+"]"})).join(",")+",this.offset)}");var Y=N.map((function(b){return"a"+b+"=this.shape["+b+"]"})),D=N.map((function(b){return"c"+b+"=this.stride["+b+"]"}));d.push("proto.lo=function "+P+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+Y.join(",")+","+D.join(","));for(var E=0;E<X;++E)d.push("if(typeof i"+E+"==='number'&&i"+E+">=0){d=i"+E+"|0;b+=c"+E+"*d;a"+E+"-=d}");d.push("return new "+P+"(this.data,"+N.map((function(b){return"a"+b})).join(",")+","+N.map((function(b){return"c"+b})).join(",")+",b)}"),d.push("proto.step=function "+P+"_step("+u.join(",")+"){var "+N.map((function(b){return"a"+b+"=this.shape["+b+"]"})).join(",")+","+N.map((function(b){return"b"+b+"=this.stride["+b+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(E=0;E<X;++E)d.push("if(typeof i"+E+"==='number'){d=i"+E+"|0;if(d<0){c+=b"+E+"*(a"+E+"-1);a"+E+"=ceil(-a"+E+"/d)}else{a"+E+"=ceil(a"+E+"/d)}b"+E+"*=d}");d.push("return new "+P+"(this.data,"+N.map((function(b){return"a"+b})).join(",")+","+N.map((function(b){return"b"+b})).join(",")+",c)}");var t=new Array(X),B=new Array(X);for(E=0;E<X;++E)t[E]="a[i"+E+"]",B[E]="b[i"+E+"]";d.push("proto.transpose=function "+P+"_transpose("+u+"){"+u.map((function(b,X){return b+"=("+b+"===undefined?"+X+":"+b+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+P+"(this.data,"+t.join(",")+","+B.join(",")+",this.offset)}"),d.push("proto.pick=function "+P+"_pick("+u+"){var a=[],b=[],c=this.offset");for(E=0;E<X;++E)d.push("if(typeof i"+E+"==='number'&&i"+E+">=0){c=(c+this.stride["+E+"]*i"+E+")|0}else{a.push(this.shape["+E+"]);b.push(this.stride["+E+"])}");return d.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),d.push("return function construct_"+P+"(data,shape,stride,offset){return new "+P+"(data,"+N.map((function(b){return"shape["+b+"]"})).join(",")+","+N.map((function(b){return"stride["+b+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",d.join("\n"))(w[b],a)}var w={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};b.exports=function(b,X,P,Q){if(void 0===b)return(0,w.array[0])([]);"number"===typeof b&&(b=[b]),void 0===X&&(X=[b.length]);var N=X.length;if(void 0===P){P=new Array(N);for(var a=N-1,f=1;a>=0;--a)P[a]=f,f*=X[a]}if(void 0===Q){Q=0;for(a=0;a<N;++a)P[a]<0&&(Q-=(X[a]-1)*P[a])}for(var O=function(b){if(S(b))return"buffer";if(d)switch(Object.prototype.toString.call(b)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(b)?"array":"generic"}(b),e=w[O];e.length<=N+1;)e.push(u(O,e.length-1));return(0,e[N+1])(b,X,P,Q)}},13875:b=>{function X(b){return!!b.constructor&&"function"===typeof b.constructor.isBuffer&&b.constructor.isBuffer(b)}b.exports=function(b){return null!=b&&(X(b)||function(b){return"function"===typeof b.readFloatLE&&"function"===typeof b.slice&&X(b.slice(0,0))}(b)||!!b._isBuffer)}},14023:b=>{"use strict";var X=[],P=[],Q=[],S=[],d=[],N=[],a=[],u=[],w=[],f=[],O=[],e=[];b.exports=function(b,Y,D,E,t,B){for(var W=a,n=w,y=f,h=e,L=0;L<3;L++)W[L]=+D[L],y[L]=+Y.max[L],n[L]=+Y.base[L];B||(B=1e-10);var Z=function(b,a,w,f,e,Y){var D=X,E=P,t=Q,B=S,W=d,n=N,y=u,h=Math.floor,L=0,Z=0,v=0,A=0,o=0;if(K(),0===v)return 0;for(A=V();Z<=v;){if(T(A)&&q())return L;A=V()}for(L+=v,o=0;o<3;o++)f[o]+=w[o],e[o]+=w[o];return L;function K(){if(Z=0,0!==(v=Math.sqrt(w[0]*w[0]+w[1]*w[1]+w[2]*w[2])))for(var b=0;b<3;b++){var X=w[b]>=0;B[b]=X?1:-1;var P=X?e[b]:f[b];D[b]=X?f[b]:e[b],E[b]=i(P,B[b]),t[b]=x(D[b],B[b]),y[b]=w[b]/v,W[b]=Math.abs(1/y[b]);var Q=X?E[b]+1-P:P-E[b];n[b]=W[b]<1/0?W[b]*Q:1/0}}function T(X){for(var P=B[0],Q=0===X?E[0]:t[0],S=E[0]+P,d=B[1],N=1===X?E[1]:t[1],a=E[1]+d,u=B[2],w=2===X?E[2]:t[2],f=E[2]+u,O=Q;O!=S;O+=P)for(var e=N;e!=a;e+=d)for(var Y=w;Y!=f;Y+=u)if(b(O,e,Y))return!0;return!1}function q(){L+=Z;var b=B[A],X=Z/v,P=O;for(o=0;o<3;o++){var Q=w[o]*X;f[o]+=Q,e[o]+=Q,P[o]=w[o]-Q}if(b>0?e[A]=Math.round(e[A]):f[A]=Math.round(f[A]),a(L,A,b,P))return!0;for(o=0;o<3;o++)w[o]=P[o];return K(),0===v}function V(){var b=n[0]<n[1]?n[0]<n[2]?0:2:n[1]<n[2]?1:2,X=n[b]-Z;for(Z=n[b],E[b]+=B[b],n[b]+=W[b],o=0;o<3;o++)D[o]+=X*y[o],t[o]=x(D[o],B[o]);return b}function i(b,X){return h(b-X*Y)}function x(b,X){return h(b+X*Y)}}(b,E,W,n,y,B);if(!t){for(L=0;L<3;L++)h[L]=D[L]>0?y[L]-Y.max[L]:n[L]-Y.base[L];Y.translate(h)}return Z}},14178:(b,X,P)=>{"use strict";P.d(X,{e:()=>O});var Q=P(14015),S=P(12702);class d{constructor(b,X,P,d,N,a,u){this.Kw=new Q(b.base,b.cw),this.aS=X,this.friction=P,this.restitution=d,this.IN=N,this.JY=a,this.GN=!!u,this.Jw=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.qD=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Pw=S.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=S.create(),this._impulses=S.create(),this._sleepFrameCount=10}loadFromCopy(b){S.j(this.Kw.base,b.Kw.base),S.j(this.Kw.cw,b.Kw.cw),S.j(this.Kw.max,b.Kw.max),this.Kw.mag=b.Kw.mag,this.aS=b.aS,this.friction=b.friction,this.restitution=b.restitution,this.IN=b.IN,this.JY=b.JY,this.GN=b.GN,this.Jw=b.Jw,this.fluidDrag=b.fluidDrag,this.qD=b.qD,this.preventFallOffEdge=b.preventFallOffEdge,this.rolledBackLastTick=b.rolledBackLastTick,S.j(this.Pw,b.Pw),S.j(this.resting,b.resting),this.inFluid=b.inFluid,this._ratioInFluid=b._ratioInFluid,S.j(this._forces,b._forces),S.j(this._impulses,b._impulses),this._sleepFrameCount=b._sleepFrameCount}setPosition(b){N(b),S.BX(b,b,this.Kw.base),this.Kw.translate(b),this.dw()}bd(){return S.clone(this.Kw.base)}applyForce(b){N(b),S.add(this._forces,this._forces,b),this.dw()}applyImpulse(b){N(b),S.add(this._impulses,this._impulses,b),this.dw()}dw(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var N=b=>{};var a=P(14015),u=P(12702),w=P(14023);function f(){this.Jw=.1,this.fluidDrag=.4,this.Qa=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function O(b,X,P){b=Object.assign(new f,b),this.gravity=b.gravity||[0,-10,0],this.Jw=b.Jw||.1,this.Qa=b.Qa||2,this.fluidDrag=b.fluidDrag||.4,this.minBounceImpulse=b.minBounceImpulse,this.bodies=[],this.eY=b.eY,this.testSolid=X,this.testFluid=P}O.prototype.IY=function(b,X,P,Q,S,N){b=b||new a([0,0,0],[1,1,1]),"undefined"==typeof X&&(X=1),"undefined"==typeof P&&(P=1),"undefined"==typeof Q&&(Q=0),"undefined"==typeof S&&(S=1);var u=new d(b,X,P,Q,S,N);return this.bodies.push(u),u},O.prototype.GY=function(b){var X=this.bodies.indexOf(b);X<0||(this.bodies.splice(X,1),b.Kw=b.JY=null)};var e=u.create(),Y=u.create(),D=u.create(),E=u.create(),t=u.create(),B=u.create(),W=u.create(),n=new a([0,0,0],[1,1,1]),y=new d(n,1,1,0,1,(()=>{}),!1);function h(b,X,P){return X=P,X*=1-(1-b.ratioInFluid)**2}O.prototype.ta=function(b){b/=1e3;var X=z(0,u.squaredLength(this.gravity));this.bodies.forEach((P=>function(b,X,P,Q){u.j(t,X.resting),b.eY&&y.loadFromCopy(X);if(X.aS<=0)return u.set(X.Pw,0,0,0),u.set(X._forces,0,0,0),void u.set(X._impulses,0,0,0);var S=Q||0===X.IN;if(function(b,X,P,Q){if(X._sleepFrameCount>0)return!1;if(Q)return!0;var S=!1,d=.5*P*P*X.IN;return u.scale(k,b.gravity,d),w(b.testSolid,X.Kw,k,(function(){return S=!0,!0}),!0),S}(b,X,P,S))return;X._sleepFrameCount--,function(b,X){var P=X.Kw,Q=Math.floor(P.base[0]),S=Math.floor(P.base[2]),d=Math.floor(P.base[1]),N=Math.floor(P.max[1]);if(!b.testFluid(Q,d,S))return X.inFluid=!1,void(X.ratioInFluid=0);var a=1,w=d+1;for(;w<=N&&b.testFluid(Q,w,S);)a++,w++;var f=(d+a-P.base[1])/P.cw[1];f>1&&(f=1);var O=P.cw[0]*P.cw[1]*P.cw[2]*f,e=Z;u.scale(e,b.gravity,-b.Qa*O*X.IN),X.applyForce(e),X.inFluid=!0,X.ratioInFluid=f}(b,X),g(X._forces),g(X._impulses),g(X.Pw),g(X.resting),u.scale(e,X._forces,1/X.aS),u.ua(e,e,b.gravity,X.IN),u.scale(Y,X._impulses,1/X.aS),u.ua(Y,Y,e,P),u.add(X.Pw,X.Pw,Y),X.friction&&(v(b,0,X,Y,P),v(b,1,X,Y,P),v(b,2,X,Y,P));var d=X.fluidDrag>=0?X.fluidDrag:b.fluidDrag,N=X.Jw>=0?X.Jw:b.Jw,a=N,f=N;X.inFluid&&(a=h(X,a,X.fluidDragHoriz>=0?X.fluidDragHoriz:d),f=h(X,f,X.fluidDragVert>=0?X.fluidDragVert:d));a=Math.max(1-a*P/X.aS,0),f=Math.max(1-f*P/X.aS,0),u.set(L,a,f,a),u.multiply(X.Pw,X.Pw,L),u.scale(D,X.Pw,P),u.set(X._forces,0,0,0),u.set(X._impulses,0,0,0),X.GN&&U(K,X.Kw);u.j(B,D),u.set(W,0,0,0),X.preventFallOffEdge&&function(b,X,P,Q){if(!X.resting[1]||P[1]>0)return;var S=H;U(S,X.Kw);for(var d=0;d<3;d+=2){u.set(x,0,0,0),x[d]=P[d];var N=!0;(N=(N=(N=(N=N&&!p(b,S.base[0]+x[0]+1e-5,S.base[1],S.base[2]+x[2]+1e-5))&&!p(b,S.max[0]+x[0]-1e-5,S.base[1],S.base[2]+x[2]+1e-5))&&!p(b,S.base[0]+x[0]+1e-5,S.base[1],S.max[2]+x[2]-1e-5))&&!p(b,S.max[0]+x[0]-1e-5,S.base[1],S.max[2]+x[2]-1e-5))?(Q[d]=P[d]>0?1:-1,P[d]=0):0===d&&(u.set(C,P[0],0,0),o(b,S,C,Q,X.slideOnCollision))}}(b,X,D,W);o(b,X.Kw,D,X.resting,X.slideOnCollision),X.GN&&function(b,X,P,Q){if(X.resting[1]>=0&&!X.inFluid)return;var S=0!==X.resting[0],d=0!==X.resting[2];if(!S&&!d)return;var N=Math.abs(Q[0]/Q[2]),a=4;if(!S&&N>a)return;if(!d&&N<1/a)return;u.add(q,P.base,Q);var f=b.testSolid;w(f,P,Q,(function(b,X,P,Q){if(1!==X)return!0;Q[X]=0}));var O=P.base[1],e=X.inFluid?1.951:1.001,Y=Math.floor(O+e)-O;u.set(V,0,Y,0);var D=!1;if(w(f,P,V,(function(b,X,P,Q){return D=!0,!0})),D)return;u.BX(i,q,P.base),i[1]=0,o(b,P,i,T,!0);var E=z(P.base[0],q[0]),t=z(P.base[2],q[2]);if(S&&!E&&(!t||!d))return;if(d&&(!E||!S)&&!t)return;var B=!0;if(B=B&&!p(b,P.base[0]+1e-5,P.base[1],P.base[2]+1e-5),B=B&&!p(b,P.max[0]-1e-5,P.base[1],P.base[2]+1e-5),B=B&&!p(b,P.base[0]+1e-5,P.base[1],P.max[2]-1e-5),B=B&&!p(b,P.max[0]-1e-5,P.base[1],P.max[2]-1e-5),B)return;U(X.Kw,P),X.resting[0]=T[0],X.resting[2]=T[2],X.qD&&X.qD()}(b,X,K,B);for(var O=0;O<3;++O)X.resting[O]=X.resting[O]||W[O],E[O]=0,X.resting[O]&&(t[O]||(E[O]=-X.Pw[O]),X.Pw[O]=0);var n=u.length(E);n>.001&&(u.scale(E,E,X.aS),X.JY&&X.JY(E),X.restitution>0&&n>b.minBounceImpulse&&(u.scale(E,E,X.restitution),X.applyImpulse(E)));var A=u.squaredLength(X.Pw);A>1e-5&&X.dw();b.eY&&b.eY(X)?(X.loadFromCopy(y),X.rolledBackLastTick=!0):X.rolledBackLastTick=!1}(this,P,b,X)))};var L=u.create([0,0,0]);var Z=u.create();function v(b,X,P,Q,S){var d=P.resting[X],N=Q[X];if(!P.alwaysApplyHorizFriction||1!==X){if(0===d)return;if(d*N<=0)return}u.j(A,P.Pw),A[X]=0;var a=u.length(A);if(!z(a,0)){var w=Math.abs(P.friction*b.gravity[X]*S),f=a>w?(a-w)/a:0;P.Pw[(X+1)%3]*=f,P.Pw[(X+2)%3]*=f}}var A=u.create();function o(b,X,P,Q,S){return u.set(Q,0,0,0),w(b.testSolid,X,P,(function(b,X,P,d){Q[X]=P,d[X]=0,S||(d[0]=0,d[1]=0,d[2]=0)}))}var K=new a([],[]),T=u.create(),q=u.create(),V=u.create(),i=u.create();var x=u.create(),H=new a([],[]),C=u.create();function p(b,X,P,Q){return b.testSolid(Math.floor(X),Math.floor(P-1),Math.floor(Q))}var k=u.create();function z(b,X){return Math.abs(b-X)<1e-5}function U(b,X){for(var P=0;P<3;P++)b.base[P]=X.base[P],b.max[P]=X.max[P],b.cw[P]=X.cw[P]}var g=function(b){}},12540:function(b,X){!function(b){"use strict";var X=function(b,P){return X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,X){b.__proto__=X}||function(b,X){for(var P in X)Object.prototype.hasOwnProperty.call(X,P)&&(b[P]=X[P])},X(b,P)};function P(b,P){if("function"!==typeof P&&null!==P)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");function Q(){this.constructor=b}X(b,P),b.prototype=null===P?Object.create(P):(Q.prototype=P.prototype,new Q)}function Q(b,X,P,Q){var S,d=arguments.length,N=d<3?X:null===Q?Q=Object.getOwnPropertyDescriptor(X,P):Q;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)N=Reflect.decorate(b,X,P,Q);else for(var a=b.length-1;a>=0;a--)(S=b[a])&&(N=(d<3?S(N):d>3?S(X,P,N):S(X,P))||N);return d>3&&N&&Object.defineProperty(X,P,N),N}function S(b,X,P){if(P||2===arguments.length)for(var Q,S=0,d=X.length;S<d;S++)!Q&&S in X||(Q||(Q=Array.prototype.slice.call(X,0,S)),Q[S]=X[S]);return b.concat(Q||Array.prototype.slice.call(X))}var d,N=255,a=213;b.OPERATION=void 0,(d=b.OPERATION||(b.OPERATION={}))[d.ADD=128]="ADD",d[d.REPLACE=0]="REPLACE",d[d.DELETE=64]="DELETE",d[d.DELETE_AND_ADD=192]="DELETE_AND_ADD",d[d.TOUCH=1]="TOUCH",d[d.CLEAR=10]="CLEAR";var u=function(){function X(b,X,P){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=b,this.setParent(X,P)}return X.prototype.setParent=function(b,X,P){var Q=this;if(this.indexes||(this.indexes=this.ref instanceof ib?this.ref._definition.indexes:{}),this.parent=b,this.parentIndex=P,X)if(this.root=X,this.ref instanceof ib){var S=this.ref._definition;for(var d in S.schema){var N=this.ref[d];if(N&&N.$changes){var a=S.indexes[d];N.$changes.setParent(this.ref,X,a)}}}else"object"===typeof this.ref&&this.ref.forEach((function(b,X){if(b instanceof ib){var P=b.$changes,S=Q.ref.$changes.indexes[X];P.setParent(Q.ref,Q.root,S)}}))},X.prototype.operation=function(b){this.changes.set(--this.currentCustomOperation,b)},X.prototype.change=function(X,P){void 0===P&&(P=b.OPERATION.ADD);var Q="number"===typeof X?X:this.indexes[X];this.assertValidIndex(Q,X);var S=this.changes.get(Q);S&&S.op!==b.OPERATION.DELETE&&S.op!==b.OPERATION.TOUCH||this.changes.set(Q,{op:S&&S.op===b.OPERATION.DELETE?b.OPERATION.DELETE_AND_ADD:P,index:Q}),this.allChanges.add(Q),this.changed=!0,this.touchParents()},X.prototype.touch=function(X){var P="number"===typeof X?X:this.indexes[X];this.assertValidIndex(P,X),this.changes.has(P)||this.changes.set(P,{op:b.OPERATION.TOUCH,index:P}),this.allChanges.add(P),this.touchParents()},X.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},X.prototype.getType=function(b){if(this.ref._definition)return(X=this.ref._definition).schema[X.fieldsByIndex[b]];var X,P=(X=this.parent._definition).schema[X.fieldsByIndex[this.parentIndex]];return Object.values(P)[0]},X.prototype.getChildrenFilter=function(){var b=this.parent._definition.childFilters;return b&&b[this.parentIndex]},X.prototype.getValue=function(b){return this.ref.getByIndex(b)},X.prototype.delete=function(X){var P="number"===typeof X?X:this.indexes[X];if(void 0!==P){var Q=this.getValue(P);this.changes.set(P,{op:b.OPERATION.DELETE,index:P}),this.allChanges.delete(P),delete this.caches[P],Q&&Q.$changes&&(Q.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(X," (").concat(P,")"))},X.prototype.discard=function(X,P){var Q=this;void 0===X&&(X=!1),void 0===P&&(P=!1),this.ref instanceof ib||this.changes.forEach((function(X){if(X.op===b.OPERATION.DELETE){var P=Q.ref.getIndex(X.index);delete Q.indexes[P]}})),this.changes.clear(),this.changed=X,P&&this.allChanges.clear(),this.currentCustomOperation=0},X.prototype.discardAll=function(){var b=this;this.changes.forEach((function(X){var P=b.getValue(X.index);P&&P.$changes&&P.$changes.discardAll()})),this.discard()},X.prototype.cache=function(b,X){this.caches[b]=X},X.prototype.clone=function(){return new X(this.ref,this.parent,this.root)},X.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},X.prototype.assertValidIndex=function(b,X){if(void 0===b)throw new Error('ChangeTree: missing index for field "'.concat(X,'"'))},X}();function w(b,X,P,Q){return b[X]||(b[X]=[]),b[X].push(P),null===Q||void 0===Q||Q.forEach((function(b,X){return P(b,X)})),function(){return O(b[X],b[X].indexOf(P))}}function f(X){var P=this,Q="string"!==typeof this.$changes.getType();this.$items.forEach((function(S,d){X.push({refId:P.$changes.refId,op:b.OPERATION.DELETE,field:d,value:void 0,previousValue:S}),Q&&P.$changes.root.removeRef(S.$changes.refId)}))}function O(b,X){if(-1===X||X>=b.length)return!1;for(var P=b.length-1,Q=X;Q<P;Q++)b[Q]=b[Q+1];return b.length=P,!0}var e=function(b,X){var P=b.toString(),Q=X.toString();return P<Q?-1:P>Q?1:0};function Y(b){return b.$proxy=!0,b=new Proxy(b,{get:function(b,X){return"symbol"===typeof X||isNaN(X)?b[X]:b.at(X)},set:function(b,X,P){if("symbol"===typeof X||isNaN(X))b[X]=P;else{var Q=Array.from(b.$items.keys()),S=parseInt(Q[X]||X);void 0===P||null===P?b.deleteAt(S):b.setAt(S,P)}return!0},deleteProperty:function(b,X){return"number"===typeof X?b.deleteAt(X):delete b[X],!0}})}var D=function(){function X(){for(var b=[],X=0;X<arguments.length;X++)b[X]=arguments[X];this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,b)}return X.prototype.Ka=function(X,P){return void 0===P&&(P=!0),w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.ADD,X,P?this.$items:void 0)},X.prototype.IX=function(X){return w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,X)},X.is=function(b){return Array.isArray(b)||void 0!==b.array},Object.defineProperty(X.prototype,"length",{get:function(){return this.$items.size},set:function(b){0===b?this.clear():this.splice(b,this.length-b)},enumerable:!1,configurable:!0}),X.prototype.push=function(){for(var b,X=this,P=[],Q=0;Q<arguments.length;Q++)P[Q]=arguments[Q];return P.forEach((function(P){b=X.$refId++,X.setAt(b,P)})),b},X.prototype.pop=function(){var b=Array.from(this.$indexes.values()).pop();if(void 0!==b){this.$changes.delete(b),this.$indexes.delete(b);var X=this.$items.get(b);return this.$items.delete(b),X}},X.prototype.at=function(b){var X=Array.from(this.$items.keys())[b];return this.$items.get(X)},X.prototype.setAt=function(X,P){var Q,S;if(void 0!==P&&null!==P){if(this.$items.get(X)!==P){void 0!==P.$changes&&P.$changes.setParent(this,this.$changes.root,X);var d=null!==(S=null===(Q=this.$changes.indexes[X])||void 0===Q?void 0:Q.op)&&void 0!==S?S:b.OPERATION.ADD;this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,P),this.$changes.change(X,d)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},X.prototype.deleteAt=function(b){var X=Array.from(this.$items.keys())[b];return void 0!==X&&this.$deleteAt(X)},X.prototype.$deleteAt=function(b){return this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b)},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&f.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:b.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.concat=function(){for(var b,P=[],Q=0;Q<arguments.length;Q++)P[Q]=arguments[Q];return new(X.bind.apply(X,S([void 0],(b=Array.from(this.$items.values())).concat.apply(b,P),!1)))},X.prototype.join=function(b){return Array.from(this.$items.values()).join(b)},X.prototype.reverse=function(){var b=this,X=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(P,Q){b.setAt(X[Q],P)})),this},X.prototype.shift=function(){var b=Array.from(this.$items.keys()).shift();if(void 0!==b){var X=this.$items.get(b);return this.$deleteAt(b),X}},X.prototype.slice=function(b,P){var Q=new X;return Q.push.apply(Q,Array.from(this.$items.values()).slice(b,P)),Q},X.prototype.sort=function(b){var X=this;void 0===b&&(b=e);var P=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(b).forEach((function(b,Q){X.setAt(P[Q],b)})),this},X.prototype.splice=function(b,X){void 0===X&&(X=this.length-b);for(var P=Array.from(this.$items.keys()),Q=[],S=b;S<b+X;S++)Q.push(this.$items.get(P[S])),this.$deleteAt(P[S]);return Q},X.prototype.unshift=function(){for(var b=this,X=[],P=0;P<arguments.length;P++)X[P]=arguments[P];var Q=this.length,S=X.length,d=Array.from(this.$items.values());return X.forEach((function(X,P){b.setAt(P,X)})),d.forEach((function(X,P){b.setAt(S+P,X)})),Q+S},X.prototype.indexOf=function(b,X){return Array.from(this.$items.values()).indexOf(b,X)},X.prototype.lastIndexOf=function(b,X){return void 0===X&&(X=this.length-1),Array.from(this.$items.values()).lastIndexOf(b,X)},X.prototype.every=function(b,X){return Array.from(this.$items.values()).every(b,X)},X.prototype.some=function(b,X){return Array.from(this.$items.values()).some(b,X)},X.prototype.forEach=function(b,X){Array.from(this.$items.values()).forEach(b,X)},X.prototype.map=function(b,X){return Array.from(this.$items.values()).map(b,X)},X.prototype.filter=function(b,X){return Array.from(this.$items.values()).filter(b,X)},X.prototype.reduce=function(b,X){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},X.prototype.reduceRight=function(b,X){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},X.prototype.find=function(b,X){return Array.from(this.$items.values()).find(b,X)},X.prototype.findIndex=function(b,X){return Array.from(this.$items.values()).findIndex(b,X)},X.prototype.fill=function(b,X,P){throw new Error("ArraySchema#fill() not implemented")},X.prototype.copyWithin=function(b,X,P){throw new Error("ArraySchema#copyWithin() not implemented")},X.prototype.toString=function(){return this.$items.toString()},X.prototype.toLocaleString=function(){return this.$items.toLocaleString()},X.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(X,Symbol.species,{get:function(){return X},enumerable:!1,configurable:!0}),X.prototype.entries=function(){return this.$items.entries()},X.prototype.keys=function(){return this.$items.keys()},X.prototype.values=function(){return this.$items.values()},X.prototype.includes=function(b,X){return Array.from(this.$items.values()).includes(b,X)},X.prototype.flatMap=function(b,X){throw new Error("ArraySchema#flatMap() is not supported.")},X.prototype.flat=function(b){throw new Error("ArraySchema#flat() is not supported.")},X.prototype.findLast=function(){var b=Array.from(this.$items.values());return b.findLast.apply(b,arguments)},X.prototype.findLastIndex=function(){var b=Array.from(this.$items.values());return b.findLastIndex.apply(b,arguments)},X.prototype.setIndex=function(b,X){this.$indexes.set(b,X)},X.prototype.getIndex=function(b){return this.$indexes.get(b)},X.prototype.getByIndex=function(b){return this.$items.get(this.$indexes.get(b))},X.prototype.deleteByIndex=function(b){var X=this.$indexes.get(b);this.$items.delete(X),this.$indexes.delete(b)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){return this.toArray().map((function(b){return"function"===typeof b.toJSON?b.toJSON():b}))},X.prototype.clone=function(b){return b?new(X.bind.apply(X,S([void 0],Array.from(this.$items.values()),!1))):new(X.bind.apply(X,S([void 0],this.map((function(b){return b.$changes?b.clone():b})),!1)))},X}();function E(b){return b.$proxy=!0,b=new Proxy(b,{get:function(b,X){return"symbol"!==typeof X&&"undefined"===typeof b[X]?b.get(X):b[X]},set:function(b,X,P){return"symbol"!==typeof X&&-1===X.indexOf("$")&&"Ka"!==X&&"IX"!==X&&"onChange"!==X?b.set(X,P):b[X]=P,!0},deleteProperty:function(b,X){return b.delete(X),!0}})}var t=function(){function X(b){var P=this;if(this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,b)if(b instanceof Map||b instanceof X)b.forEach((function(b,X){return P.set(X,b)}));else for(var Q in b)this.set(Q,b[Q])}return X.prototype.Ka=function(X,P){return void 0===P&&(P=!0),w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.ADD,X,P?this.$items:void 0)},X.prototype.IX=function(X){return w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,X)},X.is=function(b){return void 0!==b.map},X.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(X.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(X,Symbol.species,{get:function(){return X},enumerable:!1,configurable:!0}),X.prototype.set=function(X,P){if(void 0===P||null===P)throw new Error("MapSchema#set('".concat(X,"', ").concat(P,"): trying to set ").concat(P," value on '").concat(X,"'."));X=X.toString();var Q="undefined"!==typeof this.$changes.indexes[X],S=Q?this.$changes.indexes[X]:this.$refId++,d=Q?b.OPERATION.REPLACE:b.OPERATION.ADD,N=void 0!==P.$changes;if(N&&P.$changes.setParent(this,this.$changes.root,S),Q){if(!N&&this.$items.get(X)===P)return;N&&this.$items.get(X)!==P&&(d=b.OPERATION.ADD)}else this.$changes.indexes[X]=S,this.$indexes.set(S,X);return this.$items.set(X,P),this.$changes.change(X,d),this},X.prototype.get=function(b){return this.$items.get(b)},X.prototype.delete=function(b){return this.$changes.delete(b),this.$items.delete(b)},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&f.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:b.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(b){return this.$items.has(b)},X.prototype.forEach=function(b){this.$items.forEach(b)},X.prototype.entries=function(){return this.$items.entries()},X.prototype.keys=function(){return this.$items.keys()},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(b,X){this.$indexes.set(b,X)},X.prototype.getIndex=function(b){return this.$indexes.get(b)},X.prototype.getByIndex=function(b){return this.$items.get(this.$indexes.get(b))},X.prototype.deleteByIndex=function(b){var X=this.$indexes.get(b);this.$items.delete(X),this.$indexes.delete(b)},X.prototype.toJSON=function(){var b={};return this.forEach((function(X,P){b[P]="function"===typeof X.toJSON?X.toJSON():X})),b},X.prototype.clone=function(b){var P;return b?P=Object.assign(new X,this):(P=new X,this.forEach((function(b,X){b.$changes?P.set(X,b.clone()):P.set(X,b)}))),P},X}(),B={};function W(b,X){B[b]=X}function n(b){return B[b]}var y=function(){function b(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return b.create=function(X){var P=new b;return P.schema=Object.assign({},X&&X.schema||{}),P.indexes=Object.assign({},X&&X.indexes||{}),P.fieldsByIndex=Object.assign({},X&&X.fieldsByIndex||{}),P.descriptors=Object.assign({},X&&X.descriptors||{}),P.deprecated=Object.assign({},X&&X.deprecated||{}),P},b.prototype.addField=function(b,X){var P=this.getNextFieldIndex();this.fieldsByIndex[P]=b,this.indexes[b]=P,this.schema[b]=Array.isArray(X)?{array:X[0]}:X},b.prototype.hasField=function(b){return void 0!==this.indexes[b]},b.prototype.addFilter=function(b,X){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[b]]=X,this.indexesWithFilters.push(this.indexes[b]),!0},b.prototype.addChildrenFilter=function(b,X){var P=this.indexes[b],Q=this.schema[b];if(n(Object.keys(Q)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[P]=X,!0;console.warn("@filterChildren: field '".concat(b,"' can't have children. Ignoring filter."))},b.prototype.getChildrenFilter=function(b){return this.childFilters&&this.childFilters[this.indexes[b]]},b.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},b}();function h(b){return b._context&&b._context.useFilters}var L=function(){function b(){this.types={},this.schemas=new Map,this.useFilters=!1}return b.prototype.has=function(b){return this.schemas.has(b)},b.prototype.get=function(b){return this.types[b]},b.prototype.add=function(b,X){void 0===X&&(X=this.schemas.size),b._definition=y.create(b._definition),b._typeid=X,this.types[X]=b,this.schemas.set(b,X)},b.create=function(X){return void 0===X&&(X={}),function(P){return X.context||(X.context=new b),v(P,X)}},b}(),Z=new L;function v(b,X){return void 0===X&&(X={}),function(P,Q){var d=X.context||Z,N=P.constructor;if(N._context=d,!b)throw new Error("".concat(N.name,': @type() reference provided for "').concat(Q,"\" is undefined. Make sure you don't have any circular dependencies."));d.has(N)||d.add(N);var a=N._definition;if(a.addField(Q,b),a.descriptors[Q]){if(a.deprecated[Q])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(Q,"' definition on '").concat(N.name,"'.\nCheck @type() annotation"))}catch(B){var u=B.stack.split("\n")[4].trim();throw new Error("".concat(B.message," ").concat(u))}}var w=D.is(b),f=!w&&t.is(b);if("string"!==typeof b&&!ib.is(b)){var O=Object.values(b)[0];"string"===typeof O||d.has(O)||d.add(O)}if(X.manual)a.descriptors[Q]={enumerable:!0,configurable:!0,writable:!0};else{var e="_".concat(Q);a.descriptors[e]={enumerable:!1,configurable:!1,writable:!0},a.descriptors[Q]={get:function(){return this[e]},set:function(b){b!==this[e]&&(void 0!==b&&null!==b?(!w||b instanceof D||(b=new(D.bind.apply(D,S([void 0],b,!1)))),!f||b instanceof t||(b=new t(b)),void 0===b.$proxy&&(f?b=E(b):w&&(b=Y(b))),this.$changes.change(Q),b.$changes&&b.$changes.setParent(this,this.$changes.root,this._definition.indexes[Q])):this[e]&&this.$changes.delete(Q),this[e]=b)},enumerable:!0,configurable:!0}}}}function A(b){return function(X,P){var Q=X.constructor;Q._definition.addFilter(P,b)&&(Q._context.useFilters=!0)}}function o(b){return function(X,P){var Q=X.constructor;Q._definition.addChildrenFilter(P,b)&&(Q._context.useFilters=!0)}}function K(b){return void 0===b&&(b=!0),function(X,P){var Q=X.constructor._definition;Q.deprecated[P]=!0,b&&(Q.descriptors[P]={get:function(){throw new Error("".concat(P," is deprecated."))},set:function(b){},enumerable:!1,configurable:!0})}}function T(b,X,P){for(var Q in void 0===P&&(P={}),P.context||(P.context=b._context||P.context||Z),X)v(X[Q],P)(b.prototype,Q);return b}function q(b){for(var X=0,P=0,Q=0,S=b.length;Q<S;Q++)(X=b.charCodeAt(Q))<128?P+=1:X<2048?P+=2:X<55296||X>=57344?P+=3:(Q++,P+=4);return P}function V(b,X,P){for(var Q=0,S=0,d=P.length;S<d;S++)(Q=P.charCodeAt(S))<128?b[X++]=Q:Q<2048?(b[X++]=192|Q>>6,b[X++]=128|63&Q):Q<55296||Q>=57344?(b[X++]=224|Q>>12,b[X++]=128|Q>>6&63,b[X++]=128|63&Q):(S++,Q=65536+((1023&Q)<<10|1023&P.charCodeAt(S)),b[X++]=240|Q>>18,b[X++]=128|Q>>12&63,b[X++]=128|Q>>6&63,b[X++]=128|63&Q)}function i(b,X){b.push(255&X)}function x(b,X){b.push(255&X)}function H(b,X){b.push(255&X),b.push(X>>8&255)}function C(b,X){b.push(255&X),b.push(X>>8&255)}function p(b,X){b.push(255&X),b.push(X>>8&255),b.push(X>>16&255),b.push(X>>24&255)}function k(b,X){var P=X>>24,Q=X>>16,S=X>>8,d=X;b.push(255&d),b.push(255&S),b.push(255&Q),b.push(255&P)}function z(b,X){var P=Math.floor(X/Math.pow(2,32));k(b,X>>>0),k(b,P)}function U(b,X){var P=X/Math.pow(2,32)|0;k(b,X>>>0),k(b,P)}function g(b,X){s(b,X)}function j(b,X){F(b,X)}var l=new Int32Array(2),J=new Float32Array(l.buffer),c=new Float64Array(l.buffer);function s(b,X){J[0]=X,p(b,l[0])}function F(b,X){c[0]=X,p(b,l[0]),p(b,l[1])}function M(b,X){return x(b,X?1:0)}function R(b,X){X||(X="");var P=q(X),Q=0;if(P<32)b.push(160|P),Q=1;else if(P<256)b.push(217),x(b,P),Q=2;else if(P<65536)b.push(218),C(b,P),Q=3;else{if(!(P<4294967296))throw new Error("String too long");b.push(219),k(b,P),Q=5}return V(b,b.length,X),Q+P}function r(b,X){return isNaN(X)?r(b,0):isFinite(X)?X!==(0|X)?(b.push(203),F(b,X),9):X>=0?X<128?(x(b,X),1):X<256?(b.push(204),x(b,X),2):X<65536?(b.push(205),C(b,X),3):X<4294967296?(b.push(206),k(b,X),5):(b.push(207),U(b,X),9):X>=-32?(b.push(224|X+32),1):X>=-128?(b.push(208),i(b,X),2):X>=-32768?(b.push(209),H(b,X),3):X>=-2147483648?(b.push(210),p(b,X),5):(b.push(211),z(b,X),9):r(b,X>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var I=Object.freeze({__proto__:null,utf8Write:V,int8:i,uint8:x,int16:H,uint16:C,int32:p,uint32:k,int64:z,uint64:U,float32:g,float64:j,writeFloat32:s,writeFloat64:F,boolean:M,string:R,number:r});function G(b,X,P){for(var Q="",S=0,d=X,N=X+P;d<N;d++){var a=b[d];0!==(128&a)?192!==(224&a)?224!==(240&a)?240!==(248&a)?console.error("Invalid byte "+a.toString(16)):(S=(7&a)<<18|(63&b[++d])<<12|(63&b[++d])<<6|63&b[++d])>=65536?(S-=65536,Q+=String.fromCharCode(55296+(S>>>10),56320+(1023&S))):Q+=String.fromCharCode(S):Q+=String.fromCharCode((15&a)<<12|(63&b[++d])<<6|63&b[++d]):Q+=String.fromCharCode((31&a)<<6|63&b[++d]):Q+=String.fromCharCode(a)}return Q}function mb(b,X){return bb(b,X)<<24>>24}function bb(b,X){return b[X.offset++]}function Xb(b,X){return Pb(b,X)<<16>>16}function Pb(b,X){return b[X.offset++]|b[X.offset++]<<8}function Qb(b,X){return b[X.offset++]|b[X.offset++]<<8|b[X.offset++]<<16|b[X.offset++]<<24}function Sb(b,X){return Qb(b,X)>>>0}function db(b,X){return eb(b,X)}function Nb(b,X){return Yb(b,X)}function ab(b,X){var P=Sb(b,X);return Qb(b,X)*Math.pow(2,32)+P}function ub(b,X){var P=Sb(b,X);return Sb(b,X)*Math.pow(2,32)+P}var wb=new Int32Array(2),fb=new Float32Array(wb.buffer),Ob=new Float64Array(wb.buffer);function eb(b,X){return wb[0]=Qb(b,X),fb[0]}function Yb(b,X){return wb[0]=Qb(b,X),wb[1]=Qb(b,X),Ob[0]}function Db(b,X){return bb(b,X)>0}function Eb(b,X){var P,Q=b[X.offset++];Q<192?P=31&Q:217===Q?P=bb(b,X):218===Q?P=Pb(b,X):219===Q&&(P=Sb(b,X));var S=G(b,X.offset,P);return X.offset+=P,S}function tb(b,X){var P=b[X.offset];return P<192&&P>160||217===P||218===P||219===P}function Bb(b,X){var P=b[X.offset++];return P<128?P:202===P?eb(b,X):203===P?Yb(b,X):204===P?bb(b,X):205===P?Pb(b,X):206===P?Sb(b,X):207===P?ub(b,X):208===P?mb(b,X):209===P?Xb(b,X):210===P?Qb(b,X):211===P?ab(b,X):P>223?-1*(255-P+1):void 0}function Wb(b,X){var P=b[X.offset];return P<128||P>=202&&P<=211}function nb(b,X){return b[X.offset]<160}function yb(b,X){return b[X.offset-1]===N&&(b[X.offset]<128||b[X.offset]>=202&&b[X.offset]<=211)}var hb=Object.freeze({__proto__:null,int8:mb,uint8:bb,int16:Xb,uint16:Pb,int32:Qb,uint32:Sb,float32:db,float64:Nb,int64:ab,uint64:ub,readFloat32:eb,readFloat64:Yb,boolean:Db,string:Eb,stringCheck:tb,number:Bb,numberCheck:Wb,arrayCheck:nb,switchStructureCheck:yb}),Lb=function(){function X(b){var X=this;this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,b&&b.forEach((function(b){return X.add(b)}))}return X.prototype.Ka=function(X,P){return void 0===P&&(P=!0),w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.ADD,X,P?this.$items:void 0)},X.prototype.IX=function(X){return w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,X)},X.is=function(b){return void 0!==b.collection},X.prototype.add=function(b){var X=this.$refId++;return void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,X),this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,b),this.$changes.change(X),X},X.prototype.at=function(b){var X=Array.from(this.$items.keys())[b];return this.$items.get(X)},X.prototype.entries=function(){return this.$items.entries()},X.prototype.delete=function(b){for(var X,P,Q=this.$items.entries();(P=Q.next())&&!P.done;)if(b===P.value[1]){X=P.value[0];break}return void 0!==X&&(this.$changes.delete(X),this.$indexes.delete(X),this.$items.delete(X))},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&f.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:b.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(b){return Array.from(this.$items.values()).some((function(X){return X===b}))},X.prototype.forEach=function(b){var X=this;this.$items.forEach((function(P,Q,S){return b(P,Q,X)}))},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(b,X){this.$indexes.set(b,X)},X.prototype.getIndex=function(b){return this.$indexes.get(b)},X.prototype.getByIndex=function(b){return this.$items.get(this.$indexes.get(b))},X.prototype.deleteByIndex=function(b){var X=this.$indexes.get(b);this.$items.delete(X),this.$indexes.delete(b)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){var b=[];return this.forEach((function(X,P){b.push("function"===typeof X.toJSON?X.toJSON():X)})),b},X.prototype.clone=function(b){var P;return b?P=Object.assign(new X,this):(P=new X,this.forEach((function(b){b.$changes?P.add(b.clone()):P.add(b)}))),P},X}(),Zb=function(){function X(b){var X=this;this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,b&&b.forEach((function(b){return X.add(b)}))}return X.prototype.Ka=function(X,P){return void 0===P&&(P=!0),w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.ADD,X,P?this.$items:void 0)},X.prototype.IX=function(X){return w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,X)},X.is=function(b){return void 0!==b.set},X.prototype.add=function(X){var P,Q;if(this.has(X))return!1;var S=this.$refId++;void 0!==X.$changes&&X.$changes.setParent(this,this.$changes.root,S);var d=null!==(Q=null===(P=this.$changes.indexes[S])||void 0===P?void 0:P.op)&&void 0!==Q?Q:b.OPERATION.ADD;return this.$changes.indexes[S]=S,this.$indexes.set(S,S),this.$items.set(S,X),this.$changes.change(S,d),S},X.prototype.entries=function(){return this.$items.entries()},X.prototype.delete=function(b){for(var X,P,Q=this.$items.entries();(P=Q.next())&&!P.done;)if(b===P.value[1]){X=P.value[0];break}return void 0!==X&&(this.$changes.delete(X),this.$indexes.delete(X),this.$items.delete(X))},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&f.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:b.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(b){for(var X,P=this.$items.values(),Q=!1;(X=P.next())&&!X.done;)if(b===X.value){Q=!0;break}return Q},X.prototype.forEach=function(b){var X=this;this.$items.forEach((function(P,Q,S){return b(P,Q,X)}))},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(b,X){this.$indexes.set(b,X)},X.prototype.getIndex=function(b){return this.$indexes.get(b)},X.prototype.getByIndex=function(b){return this.$items.get(this.$indexes.get(b))},X.prototype.deleteByIndex=function(b){var X=this.$indexes.get(b);this.$items.delete(X),this.$indexes.delete(b)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){var b=[];return this.forEach((function(X,P){b.push("function"===typeof X.toJSON?X.toJSON():X)})),b},X.prototype.clone=function(b){var P;return b?P=Object.assign(new X,this):(P=new X,this.forEach((function(b){b.$changes?P.add(b.clone()):P.add(b)}))),P},X}(),vb=function(){function b(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return b.prototype.addRefId=function(b){this.refIds.has(b)||(this.refIds.add(b),this.containerIndexes.set(b,new Set))},b.get=function(X){return void 0===X.$filterState&&(X.$filterState=new b),X.$filterState},b}(),Ab=function(){function b(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return b.prototype.getNextUniqueId=function(){return this.nextUniqueId++},b.prototype.addRef=function(b,X,P){void 0===P&&(P=!0),this.refs.set(b,X),P&&(this.refCounts[b]=(this.refCounts[b]||0)+1)},b.prototype.removeRef=function(b){this.refCounts[b]=this.refCounts[b]-1,this.deletedRefs.add(b)},b.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},b.prototype.garbageCollectDeletedRefs=function(){var b=this;this.deletedRefs.forEach((function(X){if(!(b.refCounts[X]>0)){var P=b.refs.get(X);if(P instanceof ib)for(var Q in P._definition.schema)"string"!==typeof P._definition.schema[Q]&&P[Q]&&P[Q].$changes&&b.removeRef(P[Q].$changes.refId);else{var S=P.$changes.parent._definition,d=S.schema[S.fieldsByIndex[P.$changes.parentIndex]];"function"===typeof Object.values(d)[0]&&Array.from(P.values()).forEach((function(X){return b.removeRef(X.$changes.refId)}))}b.refs.delete(X),delete b.refCounts[X]}})),this.deletedRefs.clear()},b}(),ob=function(b){function X(){return null!==b&&b.apply(this,arguments)||this}return P(X,b),X}(Error);function Kb(b,X,P,Q){var S,d=!1;switch(X){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":S="number",isNaN(b)&&console.log('trying to encode "NaN" in '.concat(P.constructor.name,"#").concat(Q));break;case"string":S="string",d=!0;break;case"boolean":return}if(typeof b!==S&&(!d||d&&null!==b)){var N="'".concat(JSON.stringify(b),"'").concat(b&&b.constructor&&" (".concat(b.constructor.name,")")||"");throw new ob("a '".concat(S,"' was expected, but ").concat(N," was provided in ").concat(P.constructor.name,"#").concat(Q))}}function Tb(b,X,P,Q){if(!(b instanceof X))throw new ob("a '".concat(X.name,"' was expected, but '").concat(b.constructor.name,"' was provided in ").concat(P.constructor.name,"#").concat(Q))}function qb(b,X,P,Q,S){Kb(P,b,Q,S);var d=I[b];if(!d)throw new ob("a '".concat(b,"' was expected, but ").concat(P," was provided in ").concat(Q.constructor.name,"#").concat(S));d(X,P)}function Vb(b,X,P){return hb[b](X,P)}var ib=function(){function X(){for(var b=[],X=0;X<arguments.length;X++)b[X]=arguments[X];Object.defineProperties(this,{$changes:{value:new u(this,void 0,new Ab),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var P=this._definition.descriptors;P&&Object.defineProperties(this,P),b[0]&&this.assign(b[0])}return X.onError=function(b){console.error(b)},X.is=function(b){return b._definition&&void 0!==b._definition.schema},X.prototype.onChange=function(X){return w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,X)},X.prototype.IX=function(X){return w(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,X)},X.prototype.assign=function(b){return Object.assign(this,b),this},Object.defineProperty(X.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),X.prototype.setDirty=function(b,X){this.$changes.change(b,X)},X.prototype.listen=function(b,X,P){var Q=this;return void 0===P&&(P=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[b]||(this.$callbacks[b]=[]),this.$callbacks[b].push(X),P&&void 0!==this[b]&&X(this[b],void 0),function(){return O(Q.$callbacks[b],Q.$callbacks[b].indexOf(X))}},X.prototype.decode=function(P,Q,S){var d;void 0===Q&&(Q={offset:0}),void 0===S&&(S=this);var a=[],u=this.$changes.root,w=P.length,f=0;for(u.refs.set(f,this);Q.offset<w;){var O=P[Q.offset++];if(O!=N){var e=S.$changes,Y=void 0!==S._definition,E=Y?O>>6<<6:O;if(E!==b.OPERATION.CLEAR){var B=Y?O%(E||255):Bb(P,Q),W=Y?S._definition.fieldsByIndex[B]:"",y=e.getType(B),h=void 0,L=void 0,Z=void 0;if(Y?L=S["_".concat(W)]:(L=S.getByIndex(B),(E&b.OPERATION.ADD)===b.OPERATION.ADD?(Z=S instanceof t?Eb(P,Q):B,S.setIndex(B,Z)):Z=S.getIndex(B)),(E&b.OPERATION.DELETE)===b.OPERATION.DELETE&&(E!==b.OPERATION.DELETE_AND_ADD&&S.deleteByIndex(B),L&&L.$changes&&u.removeRef(L.$changes.refId),h=null),void 0!==W){if(E===b.OPERATION.DELETE);else if(X.is(y)){var v=Bb(P,Q);if(h=u.refs.get(v),E!==b.OPERATION.REPLACE){var A=this.getSchemaType(P,Q,y);h||((h=this.createTypeInstance(A)).$changes.refId=v,L&&(h.$callbacks=L.$callbacks,L.$changes.refId&&v!==L.$changes.refId&&u.removeRef(L.$changes.refId))),u.addRef(v,h,h!==L)}}else if("string"===typeof y)h=Vb(y,P,Q);else{var o=n(Object.keys(y)[0]),K=Bb(P,Q),T=u.refs.has(K)?L||u.refs.get(K):new o.constructor;if((h=T.clone(!0)).$changes.refId=K,L&&(h.$callbacks=L.$callbacks,L.$changes.refId&&K!==L.$changes.refId)){u.removeRef(L.$changes.refId);for(var q=L.entries(),V=void 0;(V=q.next())&&!V.done;){var i=(d=V.value)[0],x=d[1];a.push({refId:K,op:b.OPERATION.DELETE,field:i,value:void 0,previousValue:x})}}u.addRef(K,h,T!==L)}if(null!==h&&void 0!==h)if(h.$changes&&h.$changes.setParent(e.ref,e.root,B),S instanceof X)S[W]=h;else if(S instanceof t)i=Z,S.$items.set(i,h),S.$changes.allChanges.add(B);else if(S instanceof D)S.setAt(B,h);else if(S instanceof Lb){var H=S.add(h);S.setIndex(B,H)}else S instanceof Zb&&!1!==(H=S.add(h))&&S.setIndex(B,H);L!==h&&a.push({refId:f,op:E,field:W,dynamicIndex:Z,value:h,previousValue:L})}else{console.warn("@colyseus/schema: definition mismatch");for(var C={offset:Q.offset};Q.offset<w&&(!yb(P,Q)||(C.offset=Q.offset+1,!u.refs.has(Bb(P,C))));)Q.offset++}}else S.clear(a)}else{f=Bb(P,Q);var p=u.refs.get(f);if(!p)throw new Error('"refId" not found: '.concat(f));S=p}}return this._triggerChanges(a),u.garbageCollectDeletedRefs(),a},X.prototype.encode=function(P,Q,S){void 0===P&&(P=!1),void 0===Q&&(Q=[]),void 0===S&&(S=!1);for(var d=this.$changes,a=new WeakSet,u=[d],w=1,f=0;f<w;f++){var O=u[f],e=O.ref,Y=e instanceof X;O.ensureRefId(),a.add(O),O!==d&&(O.changed||P)&&(x(Q,N),r(Q,O.refId));for(var D=P?Array.from(O.allChanges):Array.from(O.changes.values()),E=0,B=D.length;E<B;E++){var W=P?{op:b.OPERATION.ADD,index:D[E]}:D[E],y=W.index,h=Y?e._definition.fieldsByIndex&&e._definition.fieldsByIndex[y]:y,L=Q.length;if(W.op!==b.OPERATION.TOUCH)if(Y)x(Q,y|W.op);else{if(x(Q,W.op),W.op===b.OPERATION.CLEAR)continue;r(Q,y)}if(Y||(W.op&b.OPERATION.ADD)!=b.OPERATION.ADD||e instanceof t&&R(Q,O.ref.$indexes.get(y)),W.op!==b.OPERATION.DELETE){var Z=O.getType(y),v=O.getValue(y);if(v&&v.$changes&&!a.has(v.$changes)&&(u.push(v.$changes),v.$changes.ensureRefId(),w++),W.op!==b.OPERATION.TOUCH){if(X.is(Z))Tb(v,Z,e,h),r(Q,v.$changes.refId),(W.op&b.OPERATION.ADD)===b.OPERATION.ADD&&this.tryEncodeTypeId(Q,Z,v.constructor);else if("string"===typeof Z)qb(Z,Q,v,e,h);else{var A=n(Object.keys(Z)[0]);Tb(e["_".concat(h)],A.constructor,e,h),r(Q,v.$changes.refId)}S&&O.cache(y,Q.slice(L))}}}P||S||O.discard()}return Q},X.prototype.encodeAll=function(b){return this.encode(!0,[],b)},X.prototype.applyFilters=function(P,Q){var S,d;void 0===Q&&(Q=!1);for(var a=this,u=new Set,w=vb.get(P),f=[this.$changes],O=1,e=[],Y=function(Y){var D=f[Y];if(u.has(D.refId))return"continue";var E=D.ref,B=E instanceof X;x(e,N),r(e,D.refId);var W=w.refIds.has(D),n=Q||!W;w.addRefId(D);var y=w.containerIndexes.get(D),h=n?Array.from(D.allChanges):Array.from(D.changes.values());!Q&&B&&E._definition.indexesWithFilters&&E._definition.indexesWithFilters.forEach((function(X){!y.has(X)&&D.allChanges.has(X)&&(n?h.push(X):h.push({op:b.OPERATION.ADD,index:X}))}));for(var L=0,Z=h.length;L<Z;L++){var v=n?{op:b.OPERATION.ADD,index:h[L]}:h[L];if(v.op!==b.OPERATION.CLEAR){var A=v.index;if(v.op!==b.OPERATION.DELETE){var o=D.getValue(A),K=D.getType(A);if(B){if((T=E._definition.filters&&E._definition.filters[A])&&!T.call(E,P,o,a)){o&&o.$changes&&u.add(o.$changes.refId);continue}}else{var T,q=D.parent;if((T=D.getChildrenFilter())&&!T.call(q,P,E.$indexes.get(A),o,a)){o&&o.$changes&&u.add(o.$changes.refId);continue}}if(o.$changes&&(f.push(o.$changes),O++),v.op!==b.OPERATION.TOUCH)if(v.op===b.OPERATION.ADD||B)e.push.apply(e,null!==(S=D.caches[A])&&void 0!==S?S:[]),y.add(A);else if(y.has(A))e.push.apply(e,null!==(d=D.caches[A])&&void 0!==d?d:[]);else{if(y.add(A),x(e,b.OPERATION.ADD),r(e,A),E instanceof t){var V=D.ref.$indexes.get(A);R(e,V)}o.$changes?r(e,o.$changes.refId):I[K](e,o)}else o.$changes&&!B&&(x(e,b.OPERATION.ADD),r(e,A),E instanceof t&&(V=D.ref.$indexes.get(A),R(e,V)),r(e,o.$changes.refId))}else B?x(e,v.op|A):(x(e,v.op),r(e,A))}else x(e,v.op)}},D=0;D<O;D++)Y(D);return e},X.prototype.clone=function(){var b,X=new this.constructor,P=this._definition.schema;for(var Q in P)"object"===typeof this[Q]&&"function"===typeof(null===(b=this[Q])||void 0===b?void 0:b.clone)?X[Q]=this[Q].clone():X[Q]=this[Q];return X},X.prototype.toJSON=function(){var b=this._definition.schema,X=this._definition.deprecated,P={};for(var Q in b)X[Q]||null===this[Q]||"undefined"===typeof this[Q]||(P[Q]="function"===typeof this[Q].toJSON?this[Q].toJSON():this["_".concat(Q)]);return P},X.prototype.discardAllChanges=function(){this.$changes.discardAll()},X.prototype.getByIndex=function(b){return this[this._definition.fieldsByIndex[b]]},X.prototype.deleteByIndex=function(b){this[this._definition.fieldsByIndex[b]]=void 0},X.prototype.tryEncodeTypeId=function(b,X,P){X._typeid!==P._typeid&&(x(b,a),r(b,P._typeid))},X.prototype.getSchemaType=function(b,X,P){var Q;return b[X.offset]===a&&(X.offset++,Q=this.constructor._context.get(Bb(b,X))),Q||P},X.prototype.createTypeInstance=function(b){var X=new b;return X.$changes.root=this.$changes.root,X},X.prototype._triggerChanges=function(P){for(var Q,S,d,N,a,u,w,f,O,e=new Set,Y=this.$changes.root.refs,D=function(D){var E=P[D],t=E.refId,B=Y.get(t),W=B.$callbacks;if((E.op&b.OPERATION.DELETE)===b.OPERATION.DELETE&&E.previousValue instanceof X&&(null===(S=null===(Q=E.previousValue.$callbacks)||void 0===Q?void 0:Q[b.OPERATION.DELETE])||void 0===S||S.forEach((function(b){return b()}))),!W)return"continue";if(B instanceof X){if(!e.has(t))try{null===(d=null===W||void 0===W?void 0:W[b.OPERATION.REPLACE])||void 0===d||d.forEach((function(b){return b()}))}catch(n){X.onError(n)}try{W.hasOwnProperty(E.field)&&(null===(N=W[E.field])||void 0===N||N.forEach((function(b){return b(E.value,E.previousValue)})))}catch(n){X.onError(n)}}else E.op===b.OPERATION.ADD&&void 0===E.previousValue?null===(a=W[b.OPERATION.ADD])||void 0===a||a.forEach((function(b){var X;return b(E.value,null!==(X=E.dynamicIndex)&&void 0!==X?X:E.field)})):E.op===b.OPERATION.DELETE?void 0!==E.previousValue&&(null===(u=W[b.OPERATION.DELETE])||void 0===u||u.forEach((function(b){var X;return b(E.previousValue,null!==(X=E.dynamicIndex)&&void 0!==X?X:E.field)}))):E.op===b.OPERATION.DELETE_AND_ADD&&(void 0!==E.previousValue&&(null===(w=W[b.OPERATION.DELETE])||void 0===w||w.forEach((function(b){var X;return b(E.previousValue,null!==(X=E.dynamicIndex)&&void 0!==X?X:E.field)}))),null===(f=W[b.OPERATION.ADD])||void 0===f||f.forEach((function(b){var X;return b(E.value,null!==(X=E.dynamicIndex)&&void 0!==X?X:E.field)}))),E.value!==E.previousValue&&(null===(O=W[b.OPERATION.REPLACE])||void 0===O||O.forEach((function(b){var X;return b(E.value,null!==(X=E.dynamicIndex)&&void 0!==X?X:E.field)})));e.add(t)},E=0;E<P.length;E++)D(E)},X._definition=y.create(),X}();function xb(b){for(var X=[b.$changes],P=1,Q={},S=Q,d=function(b){var P=X[b];P.changes.forEach((function(b){var X=P.ref,Q=b.index,d=X._definition?X._definition.fieldsByIndex[Q]:X.$indexes.get(Q);S[d]=P.getValue(Q)}))},N=0;N<P;N++)d(N);return Q}var Hb={context:new L},Cb=function(b){function X(){return null!==b&&b.apply(this,arguments)||this}return P(X,b),Q([v("string",Hb)],X.prototype,"name",void 0),Q([v("string",Hb)],X.prototype,"type",void 0),Q([v("number",Hb)],X.prototype,"referencedType",void 0),X}(ib),pb=function(b){function X(){var X=null!==b&&b.apply(this,arguments)||this;return X.fields=new D,X}return P(X,b),Q([v("number",Hb)],X.prototype,"id",void 0),Q([v([Cb],Hb)],X.prototype,"fields",void 0),X}(ib),kb=function(b){function X(){var X=null!==b&&b.apply(this,arguments)||this;return X.types=new D,X}return P(X,b),X.encode=function(b){var P=b.constructor,Q=new X;Q.rootType=P._typeid;var S=function(b,X){for(var P in X){var S=new Cb;S.name=P;var d=void 0;if("string"===typeof X[P])d=X[P];else{var N=X[P],a=void 0;ib.is(N)?(d="ref",a=X[P]):"string"===typeof N[d=Object.keys(N)[0]]?d+=":"+N[d]:a=N[d],S.referencedType=a?a._typeid:-1}S.type=d,b.fields.push(S)}Q.types.push(b)},d=P._context.types;for(var N in d){var a=new pb;a.id=Number(N),S(a,d[N]._definition.schema)}return Q.encodeAll()},X.decode=function(b,Q){var S=new L,d=new X;d.decode(b,Q);var N=d.types.reduce((function(b,X){var Q=function(b){function X(){return null!==b&&b.apply(this,arguments)||this}return P(X,b),X}(ib),d=X.id;return b[d]=Q,S.add(Q,d),b}),{});d.types.forEach((function(b){var X=N[b.id];b.fields.forEach((function(b){var P;if(void 0!==b.referencedType){var Q=b.type,d=N[b.referencedType];if(!d){var a=b.type.split(":");Q=a[0],d=a[1]}"ref"===Q?v(d,{context:S})(X.prototype,b.name):v(((P={})[Q]=d,P),{context:S})(X.prototype,b.name)}else v(b.type,{context:S})(X.prototype,b.name)}))}));var a=N[d.rootType],u=new a;for(var w in a._definition.schema){var f=a._definition.schema[w];"string"!==typeof f&&(u[w]="function"===typeof f?new f:new(n(Object.keys(f)[0]).constructor))}return u},Q([v([pb],Hb)],X.prototype,"types",void 0),Q([v("number",Hb)],X.prototype,"rootType",void 0),X}(ib);W("map",{constructor:t}),W("array",{constructor:D}),W("set",{constructor:Zb}),W("collection",{constructor:Lb}),b.ArraySchema=D,b.CollectionSchema=Lb,b.Context=L,b.MapSchema=t,b.Reflection=kb,b.ReflectionField=Cb,b.ReflectionType=pb,b.Schema=ib,b.SchemaDefinition=y,b.SetSchema=Zb,b.decode=hb,b.defineTypes=T,b.deprecated=K,b.dumpChanges=xb,b.encode=I,b.filter=A,b.filterChildren=o,b.hasFilter=h,b.registerType=W,b.type=v,Object.defineProperty(b,"__esModule",{value:!0})}(X)},14061:b=>{"use strict";b.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14056:(b,X,P)=>{var Q=P(14061),S=P(14067),d=Object.hasOwnProperty,N=Object.create(null);for(var a in Q)d.call(Q,a)&&(N[Q[a]]=a);var u=b.exports={to:{},get:{}};function w(b,X,P){return Math.min(Math.max(X,b),P)}function f(b){var X=Math.round(b).toString(16).toUpperCase();return X.length<2?"0"+X:X}u.get=function(b){var X,P;switch(b.substring(0,3).toLowerCase()){case"hsl":X=u.get.hsl(b),P="hsl";break;case"hwb":X=u.get.hwb(b),P="hwb";break;default:X=u.get.rgb(b),P="rgb"}return X?{model:P,value:X}:null},u.get.rgb=function(b){if(!b)return null;var X,P,S,N=[0,0,0,1];if(X=b.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(S=X[2],X=X[1],P=0;P<3;P++){var a=2*P;N[P]=parseInt(X.slice(a,a+2),16)}S&&(N[3]=parseInt(S,16)/255)}else if(X=b.match(/^#([a-f0-9]{3,4})$/i)){for(S=(X=X[1])[3],P=0;P<3;P++)N[P]=parseInt(X[P]+X[P],16);S&&(N[3]=parseInt(S+S,16)/255)}else if(X=b.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(P=0;P<3;P++)N[P]=parseInt(X[P+1],0);X[4]&&(X[5]?N[3]=.01*parseFloat(X[4]):N[3]=parseFloat(X[4]))}else{if(!(X=b.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(X=b.match(/^(\w+)$/))?"transparent"===X[1]?[0,0,0,0]:d.call(Q,X[1])?((N=Q[X[1]])[3]=1,N):null:null;for(P=0;P<3;P++)N[P]=Math.round(2.55*parseFloat(X[P+1]));X[4]&&(X[5]?N[3]=.01*parseFloat(X[4]):N[3]=parseFloat(X[4]))}for(P=0;P<3;P++)N[P]=w(N[P],0,255);return N[3]=w(N[3],0,1),N},u.get.hsl=function(b){if(!b)return null;var X=b.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(X){var P=parseFloat(X[4]);return[(parseFloat(X[1])%360+360)%360,w(parseFloat(X[2]),0,100),w(parseFloat(X[3]),0,100),w(isNaN(P)?1:P,0,1)]}return null},u.get.hwb=function(b){if(!b)return null;var X=b.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(X){var P=parseFloat(X[4]);return[(parseFloat(X[1])%360+360)%360,w(parseFloat(X[2]),0,100),w(parseFloat(X[3]),0,100),w(isNaN(P)?1:P,0,1)]}return null},u.to.hex=function(){var b=S(arguments);return"#"+f(b[0])+f(b[1])+f(b[2])+(b[3]<1?f(Math.round(255*b[3])):"")},u.to.rgb=function(){var b=S(arguments);return b.length<4||1===b[3]?"rgb("+Math.round(b[0])+", "+Math.round(b[1])+", "+Math.round(b[2])+")":"rgba("+Math.round(b[0])+", "+Math.round(b[1])+", "+Math.round(b[2])+", "+b[3]+")"},u.to.rgb.percent=function(){var b=S(arguments),X=Math.round(b[0]/255*100),P=Math.round(b[1]/255*100),Q=Math.round(b[2]/255*100);return b.length<4||1===b[3]?"rgb("+X+"%, "+P+"%, "+Q+"%)":"rgba("+X+"%, "+P+"%, "+Q+"%, "+b[3]+")"},u.to.hsl=function(){var b=S(arguments);return b.length<4||1===b[3]?"hsl("+b[0]+", "+b[1]+"%, "+b[2]+"%)":"hsla("+b[0]+", "+b[1]+"%, "+b[2]+"%, "+b[3]+")"},u.to.hwb=function(){var b=S(arguments),X="";return b.length>=4&&1!==b[3]&&(X=", "+b[3]),"hwb("+b[0]+", "+b[1]+"%, "+b[2]+"%"+X+")"},u.to.keyword=function(b){return N[b.slice(0,3)]}},14049:(b,X,P)=>{const Q=P(14056),S=P(14072),d=["keyword","gray","hex"],N={};for(const Y of Object.keys(S))N[[...S[Y].labels].sort().join("")]=Y;const a={};function u(b,X){if(!(this instanceof u))return new u(b,X);if(X&&X in d&&(X=null),X&&!(X in S))throw new Error("Unknown model: "+X);let P,w;if(null==b)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(b instanceof u)this.model=b.model,this.color=[...b.color],this.valpha=b.valpha;else if("string"===typeof b){const X=Q.get(b);if(null===X)throw new Error("Unable to parse color from string: "+b);this.model=X.model,w=S[this.model].channels,this.color=X.value.slice(0,w),this.valpha="number"===typeof X.value[w]?X.value[w]:1}else if(b.length>0){this.model=X||"rgb",w=S[this.model].channels;const P=Array.prototype.slice.call(b,0,w);this.color=e(P,w),this.valpha="number"===typeof b[w]?b[w]:1}else if("number"===typeof b)this.model="rgb",this.color=[b>>16&255,b>>8&255,255&b],this.valpha=1;else{this.valpha=1;const X=Object.keys(b);"alpha"in b&&(X.splice(X.indexOf("alpha"),1),this.valpha="number"===typeof b.alpha?b.alpha:0);const Q=X.sort().join("");if(!(Q in N))throw new Error("Unable to parse color from object: "+JSON.stringify(b));this.model=N[Q];const{labels:d}=S[this.model],a=[];for(P=0;P<d.length;P++)a.push(b[d[P]]);this.color=e(a)}if(a[this.model])for(w=S[this.model].channels,P=0;P<w;P++){const b=a[this.model][P];b&&(this.color[P]=b(this.color[P]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}u.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(b){let X=this.model in Q.to?this:this.rgb();X=X.round("number"===typeof b?b:1);const P=1===X.valpha?X.color:[...X.color,this.valpha];return Q.to[X.model](P)},percentString(b){const X=this.rgb().round("number"===typeof b?b:1),P=1===X.valpha?X.color:[...X.color,this.valpha];return Q.to.rgb.percent(P)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const b={},{channels:X}=S[this.model],{labels:P}=S[this.model];for(let Q=0;Q<X;Q++)b[P[Q]]=this.color[Q];return 1!==this.valpha&&(b.alpha=this.valpha),b},unitArray(){const b=this.rgb().color;return b[0]/=255,b[1]/=255,b[2]/=255,1!==this.valpha&&b.push(this.valpha),b},unitObject(){const b=this.rgb().object();return b.r/=255,b.g/=255,b.b/=255,1!==this.valpha&&(b.alpha=this.valpha),b},round(b){return b=Math.max(b||0,0),new u([...this.color.map(w(b)),this.valpha],this.model)},alpha(b){return void 0!==b?new u([...this.color,Math.max(0,Math.min(1,b))],this.model):this.valpha},red:f("rgb",0,O(255)),green:f("rgb",1,O(255)),blue:f("rgb",2,O(255)),hue:f(["hsl","hsv","hsl","hwb","hcg"],0,(b=>(b%360+360)%360)),saturationl:f("hsl",1,O(100)),lightness:f("hsl",2,O(100)),saturationv:f("hsv",1,O(100)),value:f("hsv",2,O(100)),chroma:f("hcg",1,O(100)),gray:f("hcg",2,O(100)),white:f("hwb",1,O(100)),wblack:f("hwb",2,O(100)),cyan:f("cmyk",0,O(100)),magenta:f("cmyk",1,O(100)),yellow:f("cmyk",2,O(100)),black:f("cmyk",3,O(100)),x:f("xyz",0,O(95.047)),y:f("xyz",1,O(100)),z:f("xyz",2,O(108.833)),l:f("lab",0,O(100)),a:f("lab",1),b:f("lab",2),keyword(b){return void 0!==b?new u(b):S[this.model].keyword(this.color)},hex(b){return void 0!==b?new u(b):Q.to.hex(this.rgb().round().color)},hexa(b){if(void 0!==b)return new u(b);const X=this.rgb().round().color;let P=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===P.length&&(P="0"+P),Q.to.hex(X)+P},rgbNumber(){const b=this.rgb().color;return(255&b[0])<<16|(255&b[1])<<8|255&b[2]},luminosity(){const b=this.rgb().color,X=[];for(const[P,Q]of b.entries()){const b=Q/255;X[P]=b<=.04045?b/12.92:((b+.055)/1.055)**2.4}return.2126*X[0]+.7152*X[1]+.0722*X[2]},contrast(b){const X=this.luminosity(),P=b.luminosity();return X>P?(X+.05)/(P+.05):(P+.05)/(X+.05)},level(b){const X=this.contrast(b);return X>=7?"AAA":X>=4.5?"AA":""},isDark(){const b=this.rgb().color;return(2126*b[0]+7152*b[1]+722*b[2])/1e4<128},isLight(){return!this.isDark()},negate(){const b=this.rgb();for(let X=0;X<3;X++)b.color[X]=255-b.color[X];return b},lighten(b){const X=this.hsl();return X.color[2]+=X.color[2]*b,X},darken(b){const X=this.hsl();return X.color[2]-=X.color[2]*b,X},saturate(b){const X=this.hsl();return X.color[1]+=X.color[1]*b,X},desaturate(b){const X=this.hsl();return X.color[1]-=X.color[1]*b,X},whiten(b){const X=this.hwb();return X.color[1]+=X.color[1]*b,X},blacken(b){const X=this.hwb();return X.color[2]+=X.color[2]*b,X},grayscale(){const b=this.rgb().color,X=.3*b[0]+.59*b[1]+.11*b[2];return u.rgb(X,X,X)},fade(b){return this.alpha(this.valpha-this.valpha*b)},opaquer(b){return this.alpha(this.valpha+this.valpha*b)},rotate(b){const X=this.hsl();let P=X.color[0];return P=(P+b)%360,P=P<0?360+P:P,X.color[0]=P,X},mix(b,X){if(!b||!b.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof b);const P=b.rgb(),Q=this.rgb(),S=void 0===X?.5:X,d=2*S-1,N=P.alpha()-Q.alpha(),a=((d*N===-1?d:(d+N)/(1+d*N))+1)/2,w=1-a;return u.rgb(a*P.red()+w*Q.red(),a*P.green()+w*Q.green(),a*P.blue()+w*Q.blue(),P.alpha()*S+Q.alpha()*(1-S))}};for(const Y of Object.keys(S)){if(d.includes(Y))continue;const{channels:b}=S[Y];u.prototype[Y]=function(){if(this.model===Y)return new u(this);for(var b=arguments.length,X=new Array(b),P=0;P<b;P++)X[P]=arguments[P];return X.length>0?new u(X,Y):new u([...(Q=S[this.model][Y].raw(this.color),Array.isArray(Q)?Q:[Q]),this.valpha],Y);var Q},u[Y]=function(){for(var X=arguments.length,P=new Array(X),Q=0;Q<X;Q++)P[Q]=arguments[Q];let S=P[0];return"number"===typeof S&&(S=e(P,b)),new u(S,Y)}}function w(b){return function(X){return function(b,X){return Number(b.toFixed(X))}(X,b)}}function f(b,X,P){b=Array.isArray(b)?b:[b];for(const Q of b)(a[Q]||(a[Q]=[]))[X]=P;return b=b[0],function(Q){let S;return void 0!==Q?(P&&(Q=P(Q)),S=this[b](),S.color[X]=Q,S):(S=this[b]().color[X],P&&(S=P(S)),S)}}function O(b){return function(X){return Math.max(0,Math.min(b,X))}}function e(b,X){for(let P=0;P<X;P++)"number"!==typeof b[P]&&(b[P]=0);return b}b.exports=u},14075:(b,X,P)=>{const Q=P(14077),S={};for(const N of Object.keys(Q))S[Q[N]]=N;const d={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};b.exports=d;for(const N of Object.keys(d)){if(!("channels"in d[N]))throw new Error("missing channels property: "+N);if(!("labels"in d[N]))throw new Error("missing channel labels property: "+N);if(d[N].labels.length!==d[N].channels)throw new Error("channel and label counts mismatch: "+N);const{channels:b,labels:X}=d[N];delete d[N].channels,delete d[N].labels,Object.defineProperty(d[N],"channels",{value:b}),Object.defineProperty(d[N],"labels",{value:X})}d.rgb.hsl=function(b){const X=b[0]/255,P=b[1]/255,Q=b[2]/255,S=Math.min(X,P,Q),d=Math.max(X,P,Q),N=d-S;let a,u;d===S?a=0:X===d?a=(P-Q)/N:P===d?a=2+(Q-X)/N:Q===d&&(a=4+(X-P)/N),a=Math.min(60*a,360),a<0&&(a+=360);const w=(S+d)/2;return u=d===S?0:w<=.5?N/(d+S):N/(2-d-S),[a,100*u,100*w]},d.rgb.hsv=function(b){let X,P,Q,S,d;const N=b[0]/255,a=b[1]/255,u=b[2]/255,w=Math.max(N,a,u),f=w-Math.min(N,a,u),O=function(b){return(w-b)/6/f+.5};return 0===f?(S=0,d=0):(d=f/w,X=O(N),P=O(a),Q=O(u),N===w?S=Q-P:a===w?S=1/3+X-Q:u===w&&(S=2/3+P-X),S<0?S+=1:S>1&&(S-=1)),[360*S,100*d,100*w]},d.rgb.hwb=function(b){const X=b[0],P=b[1];let Q=b[2];const S=d.rgb.hsl(b)[0],N=1/255*Math.min(X,Math.min(P,Q));return Q=1-1/255*Math.max(X,Math.max(P,Q)),[S,100*N,100*Q]},d.rgb.cmyk=function(b){const X=b[0]/255,P=b[1]/255,Q=b[2]/255,S=Math.min(1-X,1-P,1-Q);return[100*((1-X-S)/(1-S)||0),100*((1-P-S)/(1-S)||0),100*((1-Q-S)/(1-S)||0),100*S]},d.rgb.keyword=function(b){const X=S[b];if(X)return X;let P,d=1/0;for(const S of Object.keys(Q)){const X=Q[S],u=(a=X,((N=b)[0]-a[0])**2+(N[1]-a[1])**2+(N[2]-a[2])**2);u<d&&(d=u,P=S)}var N,a;return P},d.keyword.rgb=function(b){return Q[b]},d.rgb.xyz=function(b){let X=b[0]/255,P=b[1]/255,Q=b[2]/255;X=X>.04045?((X+.055)/1.055)**2.4:X/12.92,P=P>.04045?((P+.055)/1.055)**2.4:P/12.92,Q=Q>.04045?((Q+.055)/1.055)**2.4:Q/12.92;return[100*(.4124*X+.3576*P+.1805*Q),100*(.2126*X+.7152*P+.0722*Q),100*(.0193*X+.1192*P+.9505*Q)]},d.rgb.lab=function(b){const X=d.rgb.xyz(b);let P=X[0],Q=X[1],S=X[2];P/=95.047,Q/=100,S/=108.883,P=P>.008856?P**(1/3):7.787*P+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,S=S>.008856?S**(1/3):7.787*S+16/116;return[116*Q-16,500*(P-Q),200*(Q-S)]},d.hsl.rgb=function(b){const X=b[0]/360,P=b[1]/100,Q=b[2]/100;let S,d,N;if(0===P)return N=255*Q,[N,N,N];S=Q<.5?Q*(1+P):Q+P-Q*P;const a=2*Q-S,u=[0,0,0];for(let w=0;w<3;w++)d=X+1/3*-(w-1),d<0&&d++,d>1&&d--,N=6*d<1?a+6*(S-a)*d:2*d<1?S:3*d<2?a+(S-a)*(2/3-d)*6:a,u[w]=255*N;return u},d.hsl.hsv=function(b){const X=b[0];let P=b[1]/100,Q=b[2]/100,S=P;const d=Math.max(Q,.01);Q*=2,P*=Q<=1?Q:2-Q,S*=d<=1?d:2-d;return[X,100*(0===Q?2*S/(d+S):2*P/(Q+P)),100*((Q+P)/2)]},d.hsv.rgb=function(b){const X=b[0]/60,P=b[1]/100;let Q=b[2]/100;const S=Math.floor(X)%6,d=X-Math.floor(X),N=255*Q*(1-P),a=255*Q*(1-P*d),u=255*Q*(1-P*(1-d));switch(Q*=255,S){case 0:return[Q,u,N];case 1:return[a,Q,N];case 2:return[N,Q,u];case 3:return[N,a,Q];case 4:return[u,N,Q];case 5:return[Q,N,a]}},d.hsv.hsl=function(b){const X=b[0],P=b[1]/100,Q=b[2]/100,S=Math.max(Q,.01);let d,N;N=(2-P)*Q;const a=(2-P)*S;return d=P*S,d/=a<=1?a:2-a,d=d||0,N/=2,[X,100*d,100*N]},d.hwb.rgb=function(b){const X=b[0]/360;let P=b[1]/100,Q=b[2]/100;const S=P+Q;let d;S>1&&(P/=S,Q/=S);const N=Math.floor(6*X),a=1-Q;d=6*X-N,0!==(1&N)&&(d=1-d);const u=P+d*(a-P);let w,f,O;switch(N){default:case 6:case 0:w=a,f=u,O=P;break;case 1:w=u,f=a,O=P;break;case 2:w=P,f=a,O=u;break;case 3:w=P,f=u,O=a;break;case 4:w=u,f=P,O=a;break;case 5:w=a,f=P,O=u}return[255*w,255*f,255*O]},d.cmyk.rgb=function(b){const X=b[0]/100,P=b[1]/100,Q=b[2]/100,S=b[3]/100;return[255*(1-Math.min(1,X*(1-S)+S)),255*(1-Math.min(1,P*(1-S)+S)),255*(1-Math.min(1,Q*(1-S)+S))]},d.xyz.rgb=function(b){const X=b[0]/100,P=b[1]/100,Q=b[2]/100;let S,d,N;return S=3.2406*X+-1.5372*P+-.4986*Q,d=-.9689*X+1.8758*P+.0415*Q,N=.0557*X+-.204*P+1.057*Q,S=S>.0031308?1.055*S**(1/2.4)-.055:12.92*S,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,N=N>.0031308?1.055*N**(1/2.4)-.055:12.92*N,S=Math.min(Math.max(0,S),1),d=Math.min(Math.max(0,d),1),N=Math.min(Math.max(0,N),1),[255*S,255*d,255*N]},d.xyz.lab=function(b){let X=b[0],P=b[1],Q=b[2];X/=95.047,P/=100,Q/=108.883,X=X>.008856?X**(1/3):7.787*X+16/116,P=P>.008856?P**(1/3):7.787*P+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116;return[116*P-16,500*(X-P),200*(P-Q)]},d.lab.xyz=function(b){let X,P,Q;P=(b[0]+16)/116,X=b[1]/500+P,Q=P-b[2]/200;const S=P**3,d=X**3,N=Q**3;return P=S>.008856?S:(P-16/116)/7.787,X=d>.008856?d:(X-16/116)/7.787,Q=N>.008856?N:(Q-16/116)/7.787,X*=95.047,P*=100,Q*=108.883,[X,P,Q]},d.lab.lch=function(b){const X=b[0],P=b[1],Q=b[2];let S;S=360*Math.atan2(Q,P)/2/Math.PI,S<0&&(S+=360);return[X,Math.sqrt(P*P+Q*Q),S]},d.lch.lab=function(b){const X=b[0],P=b[1],Q=b[2]/360*2*Math.PI;return[X,P*Math.cos(Q),P*Math.sin(Q)]},d.rgb.ansi16=function(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[P,Q,S]=b;let N=null===X?d.rgb.hsv(b)[2]:X;if(N=Math.round(N/50),0===N)return 30;let a=30+(Math.round(S/255)<<2|Math.round(Q/255)<<1|Math.round(P/255));return 2===N&&(a+=60),a},d.hsv.ansi16=function(b){return d.rgb.ansi16(d.hsv.rgb(b),b[2])},d.rgb.ansi256=function(b){const X=b[0],P=b[1],Q=b[2];if(X===P&&P===Q)return X<8?16:X>248?231:Math.round((X-8)/247*24)+232;return 16+36*Math.round(X/255*5)+6*Math.round(P/255*5)+Math.round(Q/255*5)},d.ansi16.rgb=function(b){let X=b%10;if(0===X||7===X)return b>50&&(X+=3.5),X=X/10.5*255,[X,X,X];const P=.5*(1+~~(b>50));return[(1&X)*P*255,(X>>1&1)*P*255,(X>>2&1)*P*255]},d.ansi256.rgb=function(b){if(b>=232){const X=10*(b-232)+8;return[X,X,X]}let X;b-=16;return[Math.floor(b/36)/5*255,Math.floor((X=b%36)/6)/5*255,X%6/5*255]},d.rgb.hex=function(b){const X=(((255&Math.round(b[0]))<<16)+((255&Math.round(b[1]))<<8)+(255&Math.round(b[2]))).toString(16).toUpperCase();return"000000".substring(X.length)+X},d.hex.rgb=function(b){const X=b.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!X)return[0,0,0];let P=X[0];3===X[0].length&&(P=P.split("").map((b=>b+b)).join(""));const Q=parseInt(P,16);return[Q>>16&255,Q>>8&255,255&Q]},d.rgb.hcg=function(b){const X=b[0]/255,P=b[1]/255,Q=b[2]/255,S=Math.max(Math.max(X,P),Q),d=Math.min(Math.min(X,P),Q),N=S-d;let a,u;return a=N<1?d/(1-N):0,u=N<=0?0:S===X?(P-Q)/N%6:S===P?2+(Q-X)/N:4+(X-P)/N,u/=6,u%=1,[360*u,100*N,100*a]},d.hsl.hcg=function(b){const X=b[1]/100,P=b[2]/100,Q=P<.5?2*X*P:2*X*(1-P);let S=0;return Q<1&&(S=(P-.5*Q)/(1-Q)),[b[0],100*Q,100*S]},d.hsv.hcg=function(b){const X=b[1]/100,P=b[2]/100,Q=X*P;let S=0;return Q<1&&(S=(P-Q)/(1-Q)),[b[0],100*Q,100*S]},d.hcg.rgb=function(b){const X=b[0]/360,P=b[1]/100,Q=b[2]/100;if(0===P)return[255*Q,255*Q,255*Q];const S=[0,0,0],d=X%1*6,N=d%1,a=1-N;let u=0;switch(Math.floor(d)){case 0:S[0]=1,S[1]=N,S[2]=0;break;case 1:S[0]=a,S[1]=1,S[2]=0;break;case 2:S[0]=0,S[1]=1,S[2]=N;break;case 3:S[0]=0,S[1]=a,S[2]=1;break;case 4:S[0]=N,S[1]=0,S[2]=1;break;default:S[0]=1,S[1]=0,S[2]=a}return u=(1-P)*Q,[255*(P*S[0]+u),255*(P*S[1]+u),255*(P*S[2]+u)]},d.hcg.hsv=function(b){const X=b[1]/100,P=X+b[2]/100*(1-X);let Q=0;return P>0&&(Q=X/P),[b[0],100*Q,100*P]},d.hcg.hsl=function(b){const X=b[1]/100,P=b[2]/100*(1-X)+.5*X;let Q=0;return P>0&&P<.5?Q=X/(2*P):P>=.5&&P<1&&(Q=X/(2*(1-P))),[b[0],100*Q,100*P]},d.hcg.hwb=function(b){const X=b[1]/100,P=X+b[2]/100*(1-X);return[b[0],100*(P-X),100*(1-P)]},d.hwb.hcg=function(b){const X=b[1]/100,P=1-b[2]/100,Q=P-X;let S=0;return Q<1&&(S=(P-Q)/(1-Q)),[b[0],100*Q,100*S]},d.apple.rgb=function(b){return[b[0]/65535*255,b[1]/65535*255,b[2]/65535*255]},d.rgb.apple=function(b){return[b[0]/255*65535,b[1]/255*65535,b[2]/255*65535]},d.gray.rgb=function(b){return[b[0]/100*255,b[0]/100*255,b[0]/100*255]},d.gray.hsl=function(b){return[0,0,b[0]]},d.gray.hsv=d.gray.hsl,d.gray.hwb=function(b){return[0,100,b[0]]},d.gray.cmyk=function(b){return[0,0,0,b[0]]},d.gray.lab=function(b){return[b[0],0,0]},d.gray.hex=function(b){const X=255&Math.round(b[0]/100*255),P=((X<<16)+(X<<8)+X).toString(16).toUpperCase();return"000000".substring(P.length)+P},d.rgb.gray=function(b){return[(b[0]+b[1]+b[2])/3/255*100]}},14072:(b,X,P)=>{const Q=P(14075),S=P(14084),d={};Object.keys(Q).forEach((b=>{d[b]={},Object.defineProperty(d[b],"channels",{value:Q[b].channels}),Object.defineProperty(d[b],"labels",{value:Q[b].labels});const X=S(b);Object.keys(X).forEach((P=>{const Q=X[P];d[b][P]=function(b){const X=function(){for(var X=arguments.length,P=new Array(X),Q=0;Q<X;Q++)P[Q]=arguments[Q];const S=P[0];if(void 0===S||null===S)return S;S.length>1&&(P=S);const d=b(P);if("object"===typeof d)for(let b=d.length,N=0;N<b;N++)d[N]=Math.round(d[N]);return d};return"conversion"in b&&(X.conversion=b.conversion),X}(Q),d[b][P].raw=function(b){const X=function(){for(var X=arguments.length,P=new Array(X),Q=0;Q<X;Q++)P[Q]=arguments[Q];const S=P[0];return void 0===S||null===S?S:(S.length>1&&(P=S),b(P))};return"conversion"in b&&(X.conversion=b.conversion),X}(Q)}))})),b.exports=d},14084:(b,X,P)=>{const Q=P(14075);function S(b){const X=function(){const b={},X=Object.keys(Q);for(let P=X.length,Q=0;Q<P;Q++)b[X[Q]]={distance:-1,parent:null};return b}(),P=[b];for(X[b].distance=0;P.length;){const b=P.pop(),S=Object.keys(Q[b]);for(let Q=S.length,d=0;d<Q;d++){const Q=S[d],N=X[Q];-1===N.distance&&(N.distance=X[b].distance+1,N.parent=b,P.unshift(Q))}}return X}function d(b,X){return function(P){return X(b(P))}}function N(b,X){const P=[X[b].parent,b];let S=Q[X[b].parent][b],N=X[b].parent;for(;X[N].parent;)P.unshift(X[N].parent),S=d(Q[X[N].parent][N],S),N=X[N].parent;return S.conversion=P,S}b.exports=function(b){const X=S(b),P={},Q=Object.keys(X);for(let S=Q.length,d=0;d<S;d++){const b=Q[d];null!==X[b].parent&&(P[b]=N(b,X))}return P}},14077:b=>{"use strict";b.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12571:(b,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.discordURLBuilder=void 0,X.discordURLBuilder=function(b){var X;const P=(null===(X=null===window||void 0===window?void 0:window.location)||void 0===X?void 0:X.hostname)||"localhost",Q=b.hostname.split("."),S=!b.hostname.includes("trycloudflare.com")&&!b.hostname.includes("discordsays.com")&&Q.length>2?`/${Q[0]}`:"";return b.pathname.startsWith("/.proxy")?`${b.protocol}//${P}${S}${b.pathname}${b.search}`:`${b.protocol}//${P}/.proxy/colyseus${S}${b.pathname}${b.search}`}},12562:function(b,X,P){"use strict";var Q,S,d,N,a=this&&this.__awaiter||function(b,X,P,Q){return new(P||(P=Promise))((function(S,d){function N(b){try{u(Q.next(b))}catch(X){d(X)}}function a(b){try{u(Q.throw(b))}catch(X){d(X)}}function u(b){var X;b.done?S(b.value):(X=b.value,X instanceof P?X:new P((function(b){b(X)}))).then(N,a)}u((Q=Q.apply(b,X||[])).next())}))},u=this&&this.__classPrivateFieldGet||function(b,X,P,Q){if("a"===P&&!Q)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof X?b!==X||!Q:!X.has(b))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===P?Q:"a"===P?Q.call(b):Q?Q.value:X.get(b)},w=this&&this.__classPrivateFieldSet||function(b,X,P,Q,S){if("m"===Q)throw new TypeError("Private method is not writable");if("a"===Q&&!S)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof X?b!==X||!S:!X.has(b))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===Q?S.call(b,P):S?S.value=P:X.set(b,P),P};Object.defineProperty(X,"__esModule",{value:!0}),X.Auth=void 0;const f=P(12565),O=P(12523);X.Auth=class{constructor(b){this.http=b,this.settings={path:"/auth",key:"colyseus-auth-token"},Q.set(this,!1),S.set(this,void 0),d.set(this,void 0),N.set(this,(0,O.createNanoEvents)()),(0,f.getItem)(this.settings.key,(b=>this.token=b))}set token(b){this.http.authToken=b}get token(){return this.http.authToken}onChange(b){const X=u(this,N,"f").on("change",b);return u(this,Q,"f")||w(this,S,new Promise(((b,X)=>{this.getUserData().then((b=>{this.emitChange(Object.assign(Object.assign({},b),{token:this.token}))})).catch((b=>{this.emitChange({user:null,token:void 0})})).finally((()=>{b()}))})),"f"),w(this,Q,!0,"f"),X}getUserData(){return a(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(b,X,P){return a(this,void 0,void 0,(function*(){const Q=(yield this.http.post(`${this.settings.path}/register`,{body:{email:b,password:X,options:P}})).data;return this.emitChange(Q),Q}))}signInWithEmailAndPassword(b,X){return a(this,void 0,void 0,(function*(){const P=(yield this.http.post(`${this.settings.path}/login`,{body:{email:b,password:X}})).data;return this.emitChange(P),P}))}signInAnonymously(b){return a(this,void 0,void 0,(function*(){const X=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:b}})).data;return this.emitChange(X),X}))}sendPasswordResetEmail(b){return a(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:b}})).data}))}signInWithProvider(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(this,void 0,void 0,(function*(){return new Promise(((P,Q)=>{const S=X.width||480,N=X.height||768,a=this.token?`?token=${this.token}`:"",f=`Login with ${b[0].toUpperCase()+b.substring(1)}`,O=this.http.client.getHttpEndpoint(`${X.prefix||`${this.settings.path}/provider`}/${b}${a}`),e=screen.width/2-S/2,Y=screen.height/2-N/2;w(this,d,window.open(O,f,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+S+", height="+N+", top="+Y+", left="+e),"f");const D=b=>{void 0===b.data.user&&void 0===b.data.token||(clearInterval(E),u(this,d,"f").close(),w(this,d,void 0,"f"),window.removeEventListener("message",D),void 0!==b.data.error?Q(b.data.error):(P(b.data),this.emitChange(b.data)))},E=setInterval((()=>{u(this,d,"f")&&!u(this,d,"f").closed||(w(this,d,void 0,"f"),Q("sN"),window.removeEventListener("message",D))}),200);window.addEventListener("message",D)}))}))}signOut(){return a(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(b){void 0!==b.token&&(this.token=b.token,null===b.token?(0,f.removeItem)(this.settings.key):(0,f.setItem)(this.settings.key,b.token)),u(this,N,"f").emit("change",b)}},Q=new WeakMap,S=new WeakMap,d=new WeakMap,N=new WeakMap},12474:function(b,X,P){"use strict";var Q,S=this&&this.__awaiter||function(b,X,P,Q){return new(P||(P=Promise))((function(S,d){function N(b){try{u(Q.next(b))}catch(X){d(X)}}function a(b){try{u(Q.throw(b))}catch(X){d(X)}}function u(b){var X;b.done?S(b.value):(X=b.value,X instanceof P?X:new P((function(b){b(X)}))).then(N,a)}u((Q=Q.apply(b,X||[])).next())}))};Object.defineProperty(X,"__esModule",{value:!0}),X.Client=X.MatchMakeError=void 0;const d=P(12483),N=P(12488),a=P(12546),u=P(12562),w=P(12571);class f extends Error{constructor(b,X){super(b),this.code=X,Object.setPrototypeOf(this,f.prototype)}}X.MatchMakeError=f;const O="undefined"!==typeof window&&"undefined"!==typeof(null===(Q=null===window||void 0===window?void 0:window.location)||void 0===Q?void 0:Q.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";X.Client=class{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,X=arguments.length>1?arguments[1]:void 0;var P,Q;if("string"===typeof b){const X=b.startsWith("/")?new URL(b,O):new URL(b),P="https:"===X.protocol||"wss:"===X.protocol,Q=Number(X.port||(P?443:80));this.settings={hostname:X.hostname,pathname:X.pathname,port:Q,secure:P}}else void 0===b.port&&(b.port=b.secure?443:80),void 0===b.pathname&&(b.pathname=""),this.settings=b;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new a.HTTP(this,(null===X||void 0===X?void 0:X.headers)||{}),this.auth=new u.Auth(this.http),this.urlBuilder=null===X||void 0===X?void 0:X.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(Q=null===(P=null===window||void 0===window?void 0:window.location)||void 0===P?void 0:P.hostname)||void 0===Q?void 0:Q.includes("discordsays.com"))&&(this.urlBuilder=w.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return S(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",b,X,P)}))}create(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return S(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",b,X,P)}))}join(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return S(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",b,X,P)}))}joinById(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return S(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",b,X,P)}))}reconnect(b,X){return S(this,void 0,void 0,(function*(){if("string"===typeof b&&"string"===typeof X)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[P,Q]=b.split(":");if(!P||!Q)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",P,{reconnectionToken:Q},X)}))}getAvailableRooms(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return S(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${b}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(b,X,P){return S(this,void 0,void 0,(function*(){const Q=this.createRoom(b.room.name,X);Q.roomId=b.room.roomId,Q.sessionId=b.sessionId;const N={sessionId:Q.sessionId};b.reconnectionToken&&(N.reconnectionToken=b.reconnectionToken);const a=P||Q;return Q.connect(this.buildEndpoint(b.room,N),b.devMode&&(()=>S(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${Q.roomId}'...`);let P=0;const d=()=>S(this,void 0,void 0,(function*(){P++;try{yield this.consumeSeatReservation(b,X,a),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${Q.roomId}'`)}catch(S){P<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${P} out of 8)`),setTimeout(d,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(d,2e3)}))),a,this.http.headers),new Promise(((b,X)=>{const P=(b,P)=>X(new d.ServerError(b,P));a.onError.once(P),a.onJoin.once((()=>{a.onError.remove(P),setTimeout((()=>{try{a.ou(128,new Uint8Array([60,144,84,134,95,45,66,162,37,142,145,210,185,177,84,65,167,99,204,88]))}catch{}}),3e3),b(a)}))}))}))}createMatchMakeRequest(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Q=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0;return S(this,void 0,void 0,(function*(){const S=(yield this.http.post(`matchmake/${b}/${X}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(P)})).data;if(S.error)throw new f(S.error,S.code);return"reconnect"===b&&(S.reconnectionToken=P.reconnectionToken),yield this.consumeSeatReservation(S,Q,d)}))}createRoom(b,X){return new N.Room(b,X)}buildEndpoint(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const P=[];for(const d in X)X.hasOwnProperty(d)&&P.push(`${d}=${X[d]}`);let Q=this.settings.secure?"wss://":"ws://";b.publicAddress?Q+=`${b.publicAddress}`:Q+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const S=`${Q}/${b.processId}/${b.roomId}?${P.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(S)):S}getHttpEndpoint(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const X=b.startsWith("/")?b:`/${b}`,P=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${X}`;return this.urlBuilder?this.urlBuilder(new URL(P)):P}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12502:(b,X,P)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Connection=void 0;const Q=P(12509);X.Connection=class{constructor(){this.events={},this.transport=new Q.WebSocketTransport(this.events)}send(b){this.transport.send(b)}connect(b,X){this.transport.connect(b,X)}close(b,X){this.transport.close(b,X)}get isOpen(){return this.transport.isOpen}}},12546:function(b,X,P){"use strict";var Q=this&&this.__createBinding||(Object.create?function(b,X,P,Q){void 0===Q&&(Q=P);var S=Object.getOwnPropertyDescriptor(X,P);S&&!("get"in S?!X.__esModule:S.writable||S.configurable)||(S={enumerable:!0,get:function(){return X[P]}}),Object.defineProperty(b,Q,S)}:function(b,X,P,Q){void 0===Q&&(Q=P),b[Q]=X[P]}),S=this&&this.__setModuleDefault||(Object.create?function(b,X){Object.defineProperty(b,"default",{enumerable:!0,value:X})}:function(b,X){b.default=X}),d=this&&this.__importStar||function(b){if(b&&b.__esModule)return b;var X={};if(null!=b)for(var P in b)"default"!==P&&Object.prototype.hasOwnProperty.call(b,P)&&Q(X,b,P);return S(X,b),X};Object.defineProperty(X,"__esModule",{value:!0}),X.HTTP=void 0;const N=P(12483),a=d(P(12555));X.HTTP=class{constructor(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=b,this.headers=X}get(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",b,X)}post(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",b,X)}del(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",b,X)}put(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",b,X)}request(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a[b](this.client.getHttpEndpoint(X),this.getOptions(P)).catch((b=>{var X;const P=b.statusCode,Q=(null===(X=b.data)||void 0===X?void 0:X.error)||b.statusMessage||b.message;if(!P&&!Q)throw b;throw new N.ServerError(P,Q)}))}getOptions(b){return b.headers=Object.assign({},this.headers,b.headers),this.authToken&&(b.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(b.withCredentials=!0),b}}},12515:(b,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.utf8Length=X.utf8Read=X.ErrorCode=X.Protocol=void 0,function(b){b[b.HANDSHAKE=9]="HANDSHAKE",b[b.JOIN_ROOM=10]="JOIN_ROOM",b[b.ERROR=11]="ERROR",b[b.LEAVE_ROOM=12]="LEAVE_ROOM",b[b.ROOM_DATA=13]="ROOM_DATA",b[b.ROOM_STATE=14]="ROOM_STATE",b[b.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",b[b.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",b[b.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(X.Protocol||(X.Protocol={})),function(b){b[b.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",b[b.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",b[b.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",b[b.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",b[b.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",b[b.AUTH_FAILED=4215]="AUTH_FAILED",b[b.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(X.ErrorCode||(X.ErrorCode={})),X.utf8Read=function(b,X){const P=b[X++];for(var Q="",S=0,d=X,N=X+P;d<N;d++){var a=b[d];if(0!==(128&a))if(192!==(224&a))if(224!==(240&a)){if(240!==(248&a))throw new Error("Invalid byte "+a.toString(16));(S=(7&a)<<18|(63&b[++d])<<12|(63&b[++d])<<6|63&b[++d])>=65536?(S-=65536,Q+=String.fromCharCode(55296+(S>>>10),56320+(1023&S))):Q+=String.fromCharCode(S)}else Q+=String.fromCharCode((15&a)<<12|(63&b[++d])<<6|63&b[++d]);else Q+=String.fromCharCode((31&a)<<6|63&b[++d]);else Q+=String.fromCharCode(a)}return Q},X.utf8Length=function(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",X=0,P=0;for(let Q=0,S=b.length;Q<S;Q++)X=b.charCodeAt(Q),X<128?P+=1:X<2048?P+=2:X<55296||X>=57344?P+=3:(Q++,P+=4);return P+1}},12488:function(b,X,P){"use strict";var Q=this&&this.__createBinding||(Object.create?function(b,X,P,Q){void 0===Q&&(Q=P);var S=Object.getOwnPropertyDescriptor(X,P);S&&!("get"in S?!X.__esModule:S.writable||S.configurable)||(S={enumerable:!0,get:function(){return X[P]}}),Object.defineProperty(b,Q,S)}:function(b,X,P,Q){void 0===Q&&(Q=P),b[Q]=X[P]}),S=this&&this.__setModuleDefault||(Object.create?function(b,X){Object.defineProperty(b,"default",{enumerable:!0,value:X})}:function(b,X){b.default=X}),d=this&&this.__importStar||function(b){if(b&&b.__esModule)return b;var X={};if(null!=b)for(var P in b)"default"!==P&&Object.prototype.hasOwnProperty.call(b,P)&&Q(X,b,P);return S(X,b),X};Object.defineProperty(X,"__esModule",{value:!0}),X.Room=void 0;const N=d(P(12494)),a=P(12502),u=P(12515),w=P(12519),f=P(12523),O=P(12531),e=P(12540),Y=P(12483);class D{constructor(b,X){this.onStateChange=(0,O.createSignal)(),this.onError=(0,O.createSignal)(),this.onLeave=(0,O.createSignal)(),this.onJoin=(0,O.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,f.createNanoEvents)(),this.roomId=null,this.name=b,X&&(this.serializer=new((0,w.getSerializer)("schema")),this.rootSchema=X,this.serializer.state=new X),this.onError(((b,X)=>{var P;return null===(P=console.warn)||void 0===P?void 0:P.call(console,`colyseus.js - onError => (${b}) ${X}`)})),this.onLeave((()=>this.NX()))}get id(){return this.roomId}connect(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,Q=arguments.length>3?arguments[3]:void 0;const S=new a.Connection;P.connection=S,S.events.onmessage=D.prototype.onMessageCallback.bind(P),S.events.onclose=function(b){var Q;if(!P.hasJoined)return null===(Q=console.warn)||void 0===Q||Q.call(console,`Room connection was closed unexpectedly (${b.code}): ${b.reason}`),void P.onError.invoke(b.code,b.reason);b.code===Y.CloseCode.DEVMODE_RESTART&&X?X():(P.onLeave.invoke(b.code,b.reason),P.destroy())},S.events.onerror=function(b){var X;null===(X=console.warn)||void 0===X||X.call(console,`Room, onError (${b.code}): ${b.reason}`),P.onError.invoke(b.code,b.reason)},S.connect(b,Q)}Da(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((X=>{this.onLeave((b=>X(b))),this.connection?b?this.connection.send([u.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(Y.CloseCode.CONSENTED)}))}CX(b,X){return this.onMessageHandlers.on(this.getMessageHandlerKey(b),X)}send(b,X){const P=[u.Protocol.ROOM_DATA];let Q;if("string"===typeof b?e.encode.string(P,b):e.encode.number(P,b),void 0!==X){const b=N.encode(X);Q=new Uint8Array(P.length+b.byteLength),Q.set(new Uint8Array(P),0),Q.set(new Uint8Array(b),P.length)}else Q=new Uint8Array(P);this.connection.send(Q.buffer)}ou(b,X){const P=[u.Protocol.ROOM_DATA_BYTES];let Q;"string"===typeof b?e.encode.string(P,b):e.encode.number(P,b),Q=new Uint8Array(P.length+(X.byteLength||X.length)),Q.set(new Uint8Array(P),0),Q.set(new Uint8Array(X),P.length),this.connection.send(Q.buffer)}get state(){return this.serializer.getState()}NX(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(b){const X=Array.from(new Uint8Array(b.data)),P=X[0];if(P===u.Protocol.JOIN_ROOM){let b=1;const P=(0,u.utf8Read)(X,b);if(b+=(0,u.utf8Length)(P),this.serializerId=(0,u.utf8Read)(X,b),b+=(0,u.utf8Length)(this.serializerId),!this.serializer){const b=(0,w.getSerializer)(this.serializerId);this.serializer=new b}X.length>b&&this.serializer.handshake&&this.serializer.handshake(X,{offset:b}),this.reconnectionToken=`${this.roomId}:${P}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([u.Protocol.JOIN_ROOM])}else if(P===u.Protocol.ERROR){const b={offset:1},P=e.decode.number(X,b),Q=e.decode.string(X,b);this.onError.invoke(P,Q)}else if(P===u.Protocol.LEAVE_ROOM)this.Da();else if(P===u.Protocol.ROOM_DATA_SCHEMA){const b={offset:1},P=this.serializer.getState().constructor._context.get(e.decode.number(X,b)),Q=new P;Q.decode(X,b),this.dispatchMessage(P,Q)}else if(P===u.Protocol.ROOM_STATE)X.shift(),this.setState(X);else if(P===u.Protocol.ROOM_STATE_PATCH)X.shift(),this.patch(X);else if(P===u.Protocol.ROOM_DATA){const P={offset:1},Q=e.decode.stringCheck(X,P)?e.decode.string(X,P):e.decode.number(X,P),S=X.length>P.offset?N.decode(b.data,P.offset):void 0;this.dispatchMessage(Q,S)}else if(P===u.Protocol.ROOM_DATA_BYTES){const b={offset:1},P=e.decode.stringCheck(X,b)?e.decode.string(X,b):e.decode.number(X,b);this.dispatchMessage(P,new Uint8Array(X.slice(b.offset)))}}setState(b){this.serializer.setState(b),this.onStateChange.invoke(this.serializer.getState())}patch(b){this.serializer.patch(b),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(b,X){var P;const Q=this.getMessageHandlerKey(b);this.onMessageHandlers.events[Q]?this.onMessageHandlers.emit(Q,X):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",b,X):null===(P=console.warn)||void 0===P||P.call(console,`colyseus.js: onMessage() not registered for type '${b}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(b){switch(typeof b){case"function":return`$${b._typeid}`;case"string":return b;case"number":return`i${b}`;default:throw new Error("invalid message type.")}}}X.Room=D},12565:(b,X)=>{"use strict";let P;function Q(){if(!P)try{P="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(b){}return P||(P={cache:{},setItem:function(b,X){this.cache[b]=X},getItem:function(b){this.cache[b]},removeItem:function(b){delete this.cache[b]}}),P}Object.defineProperty(X,"__esModule",{value:!0}),X.getItem=X.removeItem=X.setItem=void 0,X.setItem=function(b,X){Q().setItem(b,X)},X.removeItem=function(b){Q().removeItem(b)},X.getItem=function(b,X){const P=Q().getItem(b);"undefined"!==typeof Promise&&P instanceof Promise?P.then((b=>X(b))):X(P)}},12523:(b,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.createNanoEvents=void 0;X.createNanoEvents=()=>({emit(b){let X=this.events[b]||[];for(var P=arguments.length,Q=new Array(P>1?P-1:0),S=1;S<P;S++)Q[S-1]=arguments[S];for(let d=0,N=X.length;d<N;d++)X[d](...Q)},events:{},on(b,X){var P;return(null===(P=this.events[b])||void 0===P?void 0:P.push(X))||(this.events[b]=[X]),()=>{var P;this.events[b]=null===(P=this.events[b])||void 0===P?void 0:P.filter((b=>X!==b))}}})},12531:(b,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.createSignal=X.EventEmitter=void 0;class P{constructor(){this.handlers=[]}register(b){return this.handlers.push(b),this}invoke(){for(var b=arguments.length,X=new Array(b),P=0;P<b;P++)X[P]=arguments[P];this.handlers.forEach((b=>b.apply(this,X)))}invokeAsync(){for(var b=arguments.length,X=new Array(b),P=0;P<b;P++)X[P]=arguments[P];return Promise.all(this.handlers.map((b=>b.apply(this,X))))}remove(b){const X=this.handlers.indexOf(b);this.handlers[X]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}X.EventEmitter=P,X.createSignal=function(){const b=new P;function X(X){return b.register(X,null===this)}return X.once=X=>{const P=function(){for(var Q=arguments.length,S=new Array(Q),d=0;d<Q;d++)S[d]=arguments[d];X.apply(this,S),b.remove(P)};b.register(P)},X.remove=X=>b.remove(X),X.invoke=function(){return b.invoke(...arguments)},X.invokeAsync=function(){return b.invokeAsync(...arguments)},X.clear=()=>b.clear(),X}},12483:(b,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.ServerError=X.CloseCode=void 0,function(b){b[b.CONSENTED=4e3]="CONSENTED",b[b.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(X.CloseCode||(X.CloseCode={}));class P extends Error{constructor(b,X){super(X),this.name="ServerError",this.code=b}}X.ServerError=P},12463:(b,X,P)=>{"use strict";X.e=void 0,P(12469);var Q=P(12474);Object.defineProperty(X,"e",{enumerable:!0,get:function(){return Q.Client}});var S=P(12515);var d=P(12488);var N=P(12562);const a=P(12579);const u=P(12587),w=P(12519);(0,w.registerSerializer)("schema",a.SchemaSerializer),(0,w.registerSerializer)("none",u.NoneSerializer)},12469:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=b=>null!==b&&"object"===typeof b&&b.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12494:(b,X)=>{"use strict";function P(b,X){if(this._offset=X,b instanceof ArrayBuffer)this._buffer=b,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(b))throw new Error("Invalid argument");this._buffer=b.buffer,this._view=new DataView(this._buffer,b.byteOffset,b.byteLength)}}Object.defineProperty(X,"__esModule",{value:!0}),X.decode=X.encode=void 0,P.prototype._array=function(b){for(var X=new Array(b),P=0;P<b;P++)X[P]=this._parse();return X},P.prototype._map=function(b){for(var X={},P=0;P<b;P++)X[this._parse()]=this._parse();return X},P.prototype._str=function(b){var X=function(b,X,P){for(var Q="",S=0,d=X,N=X+P;d<N;d++){var a=b.getUint8(d);if(0!==(128&a))if(192!==(224&a))if(224!==(240&a)){if(240!==(248&a))throw new Error("Invalid byte "+a.toString(16));(S=(7&a)<<18|(63&b.getUint8(++d))<<12|(63&b.getUint8(++d))<<6|63&b.getUint8(++d))>=65536?(S-=65536,Q+=String.fromCharCode(55296+(S>>>10),56320+(1023&S))):Q+=String.fromCharCode(S)}else Q+=String.fromCharCode((15&a)<<12|(63&b.getUint8(++d))<<6|63&b.getUint8(++d));else Q+=String.fromCharCode((31&a)<<6|63&b.getUint8(++d));else Q+=String.fromCharCode(a)}return Q}(this._view,this._offset,b);return this._offset+=b,X},P.prototype._bin=function(b){var X=this._buffer.slice(this._offset,this._offset+b);return this._offset+=b,X},P.prototype._parse=function(){var b,X=this._view.getUint8(this._offset++),P=0,Q=0,S=0,d=0;if(X<192)return X<128?X:X<144?this._map(15&X):X<160?this._array(15&X):this._str(31&X);if(X>223)return-1*(255-X+1);switch(X){case 192:return null;case 194:return!1;case 195:return!0;case 196:return P=this._view.getUint8(this._offset),this._offset+=1,this._bin(P);case 197:return P=this._view.getUint16(this._offset),this._offset+=2,this._bin(P);case 198:return P=this._view.getUint32(this._offset),this._offset+=4,this._bin(P);case 199:if(P=this._view.getUint8(this._offset),Q=this._view.getInt8(this._offset+1),this._offset+=2,-1===Q){var N=this._view.getUint32(this._offset);return S=this._view.getInt32(this._offset+4),d=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*S+d)+N/1e6)}return[Q,this._bin(P)];case 200:return P=this._view.getUint16(this._offset),Q=this._view.getInt8(this._offset+2),this._offset+=3,[Q,this._bin(P)];case 201:return P=this._view.getUint32(this._offset),Q=this._view.getInt8(this._offset+4),this._offset+=5,[Q,this._bin(P)];case 202:return b=this._view.getFloat32(this._offset),this._offset+=4,b;case 203:return b=this._view.getFloat64(this._offset),this._offset+=8,b;case 204:return b=this._view.getUint8(this._offset),this._offset+=1,b;case 205:return b=this._view.getUint16(this._offset),this._offset+=2,b;case 206:return b=this._view.getUint32(this._offset),this._offset+=4,b;case 207:return S=this._view.getUint32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,S+d;case 208:return b=this._view.getInt8(this._offset),this._offset+=1,b;case 209:return b=this._view.getInt16(this._offset),this._offset+=2,b;case 210:return b=this._view.getInt32(this._offset),this._offset+=4,b;case 211:return S=this._view.getInt32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,S+d;case 212:return Q=this._view.getInt8(this._offset),this._offset+=1,0===Q?void(this._offset+=1):[Q,this._bin(1)];case 213:return Q=this._view.getInt8(this._offset),this._offset+=1,[Q,this._bin(2)];case 214:return Q=this._view.getInt8(this._offset),this._offset+=1,-1===Q?(b=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*b)):[Q,this._bin(4)];case 215:return Q=this._view.getInt8(this._offset),this._offset+=1,0===Q?(S=this._view.getInt32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,new Date(S+d)):-1===Q?(S=this._view.getUint32(this._offset),d=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&S)+d)+(S>>>2)/1e6)):[Q,this._bin(8)];case 216:return Q=this._view.getInt8(this._offset),this._offset+=1,[Q,this._bin(16)];case 217:return P=this._view.getUint8(this._offset),this._offset+=1,this._str(P);case 218:return P=this._view.getUint16(this._offset),this._offset+=2,this._str(P);case 219:return P=this._view.getUint32(this._offset),this._offset+=4,this._str(P);case 220:return P=this._view.getUint16(this._offset),this._offset+=2,this._array(P);case 221:return P=this._view.getUint32(this._offset),this._offset+=4,this._array(P);case 222:return P=this._view.getUint16(this._offset),this._offset+=2,this._map(P);case 223:return P=this._view.getUint32(this._offset),this._offset+=4,this._map(P)}throw new Error("Could not parse")},X.decode=function(b){var X=new P(b,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),Q=X._parse();if(X._offset!==b.byteLength)throw new Error(b.byteLength-X._offset+" trailing bytes");return Q};function Q(b,X,P){for(var Q=0,S=0,d=P.length;S<d;S++)(Q=P.charCodeAt(S))<128?b.setUint8(X++,Q):Q<2048?(b.setUint8(X++,192|Q>>6),b.setUint8(X++,128|63&Q)):Q<55296||Q>=57344?(b.setUint8(X++,224|Q>>12),b.setUint8(X++,128|Q>>6&63),b.setUint8(X++,128|63&Q)):(S++,Q=65536+((1023&Q)<<10|1023&P.charCodeAt(S)),b.setUint8(X++,240|Q>>18),b.setUint8(X++,128|Q>>12&63),b.setUint8(X++,128|Q>>6&63),b.setUint8(X++,128|63&Q))}function S(b,X,P){var Q=typeof P,d=0,N=0,a=0,u=0,w=0,f=0;if("string"===Q){if(w=function(b){for(var X=0,P=0,Q=0,S=b.length;Q<S;Q++)(X=b.charCodeAt(Q))<128?P+=1:X<2048?P+=2:X<55296||X>=57344?P+=3:(Q++,P+=4);return P}(P),w<32)b.push(160|w),f=1;else if(w<256)b.push(217,w),f=2;else if(w<65536)b.push(218,w>>8,w),f=3;else{if(!(w<4294967296))throw new Error("String too long");b.push(219,w>>24,w>>16,w>>8,w),f=5}return X.push({_str:P,_length:w,_offset:b.length}),f+w}if("number"===Q)return Math.floor(P)===P&&isFinite(P)?P>=0?P<128?(b.push(P),1):P<256?(b.push(204,P),2):P<65536?(b.push(205,P>>8,P),3):P<4294967296?(b.push(206,P>>24,P>>16,P>>8,P),5):(a=P/Math.pow(2,32)|0,u=P>>>0,b.push(207,a>>24,a>>16,a>>8,a,u>>24,u>>16,u>>8,u),9):P>=-32?(b.push(P),1):P>=-128?(b.push(208,P),2):P>=-32768?(b.push(209,P>>8,P),3):P>=-2147483648?(b.push(210,P>>24,P>>16,P>>8,P),5):(a=Math.floor(P/Math.pow(2,32)),u=P>>>0,b.push(211,a>>24,a>>16,a>>8,a,u>>24,u>>16,u>>8,u),9):(b.push(203),X.push({_float:P,_length:8,_offset:b.length}),9);if("object"===Q){if(null===P)return b.push(192),1;if(Array.isArray(P)){if((w=P.length)<16)b.push(144|w),f=1;else if(w<65536)b.push(220,w>>8,w),f=3;else{if(!(w<4294967296))throw new Error("Array too large");b.push(221,w>>24,w>>16,w>>8,w),f=5}for(d=0;d<w;d++)f+=S(b,X,P[d]);return f}if(P instanceof Date){var O=P.getTime(),e=Math.floor(O/1e3),Y=1e6*(O-1e3*e);return e>=0&&Y>=0&&e<=17179869183?0===Y&&e<=4294967295?(b.push(214,255,e>>24,e>>16,e>>8,e),6):(a=e/4294967296,u=4294967295&e,b.push(215,255,Y>>22,Y>>14,Y>>6,a,u>>24,u>>16,u>>8,u),10):(a=Math.floor(e/4294967296),u=e>>>0,b.push(199,12,255,Y>>24,Y>>16,Y>>8,Y,a>>24,a>>16,a>>8,a,u>>24,u>>16,u>>8,u),15)}if(P instanceof ArrayBuffer){if((w=P.byteLength)<256)b.push(196,w),f=2;else if(w<65536)b.push(197,w>>8,w),f=3;else{if(!(w<4294967296))throw new Error("Buffer too large");b.push(198,w>>24,w>>16,w>>8,w),f=5}return X.push({_bin:P,_length:w,_offset:b.length}),f+w}if("function"===typeof P.toJSON)return S(b,X,P.toJSON());var D=[],E="",t=Object.keys(P);for(d=0,N=t.length;d<N;d++)void 0!==P[E=t[d]]&&"function"!==typeof P[E]&&D.push(E);if((w=D.length)<16)b.push(128|w),f=1;else if(w<65536)b.push(222,w>>8,w),f=3;else{if(!(w<4294967296))throw new Error("Object too large");b.push(223,w>>24,w>>16,w>>8,w),f=5}for(d=0;d<w;d++)f+=S(b,X,E=D[d]),f+=S(b,X,P[E]);return f}if("boolean"===Q)return b.push(P?195:194),1;if("undefined"===Q)return b.push(192),1;if("function"===typeof P.toJSON)return S(b,X,P.toJSON());throw new Error("Could not encode")}X.encode=function(b){var X=[],P=[],d=S(X,P,b),N=new ArrayBuffer(d),a=new DataView(N),u=0,w=0,f=-1;P.length>0&&(f=P[0]._offset);for(var O,e=0,Y=0,D=0,E=X.length;D<E;D++)if(a.setUint8(w+D,X[D]),D+1===f){if(e=(O=P[u])._length,Y=w+f,O._bin)for(var t=new Uint8Array(O._bin),B=0;B<e;B++)a.setUint8(Y+B,t[B]);else O._str?Q(a,Y,O._str):void 0!==O._float&&a.setFloat64(Y,O._float);w+=e,P[++u]&&(f=P[u]._offset)}return N}},12587:(b,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.NoneSerializer=void 0;X.NoneSerializer=class{setState(b){}getState(){return null}patch(b){}teardown(){}handshake(b){}}},12579:(b,X,P)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.SchemaSerializer=void 0;const Q=P(12540);X.SchemaSerializer=class{setState(b){return this.state.decode(b)}getState(){return this.state}patch(b){return this.state.decode(b)}teardown(){var b,X;null===(X=null===(b=this.state)||void 0===b?void 0:b.$changes)||void 0===X||X.root.clearRefs()}handshake(b,X){if(this.state){(new Q.Reflection).decode(b,X)}else this.state=Q.Reflection.decode(b,X)}}},12519:(b,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.getSerializer=X.registerSerializer=void 0;const P={};X.registerSerializer=function(b,X){P[b]=X},X.getSerializer=function(b){const X=P[b];if(!X)throw new Error("missing serializer: "+b);return X}},12509:function(b,X,P){"use strict";var Q=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(X,"__esModule",{value:!0}),X.WebSocketTransport=void 0;const S=Q(P(12511)),d=globalThis.WebSocket||S.default;X.WebSocketTransport=class{constructor(b){this.events=b}send(b){b instanceof ArrayBuffer?this.ws.send(b):Array.isArray(b)&&this.ws.send(new Uint8Array(b).buffer)}connect(b,X){try{this.ws=new d(b,{headers:X,protocols:this.protocols})}catch(P){this.ws=new d(b,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(b,X){this.ws.close(b,X)}get isOpen(){return this.ws.readyState===d.OPEN}}},12511:b=>{"use strict";b.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13026:b=>{"use strict";b.exports=function(b){for(var X=new Array(b),P=0;P<b;++P)X[P]=P;return X}},13029:b=>{function X(b){return!!b.constructor&&"function"===typeof b.constructor.isBuffer&&b.constructor.isBuffer(b)}b.exports=function(b){return null!=b&&(X(b)||function(b){return"function"===typeof b.readFloatLE&&"function"===typeof b.slice&&X(b.slice(0,0))}(b)||!!b._isBuffer)}},13019:(b,X,P)=>{var Q=P(13026),S=P(13029),d="undefined"!==typeof Float64Array;function N(b,X){return b[0]-X[0]}function a(){var b,X=this.stride,P=new Array(X.length);for(b=0;b<P.length;++b)P[b]=[Math.abs(X[b]),b];P.sort(N);var Q=new Array(P.length);for(b=0;b<Q.length;++b)Q[b]=P[b][1];return Q}function u(b,X){var P=["View",X,"d",b].join("");X<0&&(P="View_Nil"+b);var S="generic"===b;if(-1===X){var d="function "+P+"(a){this.data=a;};var proto="+P+".prototype;proto.dtype='"+b+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+P+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+P+"(a){return new "+P+"(a);}";return new Function(d)()}if(0===X){d="function "+P+"(a,d) {this.data = a;this.offset = d};var proto="+P+".prototype;proto.dtype='"+b+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+P+"_copy() {return new "+P+"(this.data,this.offset)};proto.pick=function "+P+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+P+"_get(){return "+(S?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+P+"_set(v){return "+(S?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+P+"(a,b,c,d){return new "+P+"(a,d)}";return new Function("TrivialArray",d)(w[b][0])}d=["'use strict'"];var N=Q(X),u=N.map((function(b){return"i"+b})),f="this.offset+"+N.map((function(b){return"this.stride["+b+"]*i"+b})).join("+"),O=N.map((function(b){return"b"+b})).join(","),e=N.map((function(b){return"c"+b})).join(",");d.push("function "+P+"(a,"+O+","+e+",d){this.data=a","this.shape=["+O+"]","this.stride=["+e+"]","this.offset=d|0}","var proto="+P+".prototype","proto.dtype='"+b+"'","proto.dimension="+X),d.push("Object.defineProperty(proto,'size',{get:function "+P+"_size(){return "+N.map((function(b){return"this.shape["+b+"]"})).join("*"),"}})"),1===X?d.push("proto.order=[0]"):(d.push("Object.defineProperty(proto,'order',{get:"),X<4?(d.push("function "+P+"_order(){"),2===X?d.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===X&&d.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):d.push("ORDER})")),d.push("proto.set=function "+P+"_set("+u.join(",")+",v){"),S?d.push("return this.data.set("+f+",v)}"):d.push("return this.data["+f+"]=v}"),d.push("proto.get=function "+P+"_get("+u.join(",")+"){"),S?d.push("return this.data.get("+f+")}"):d.push("return this.data["+f+"]}"),d.push("proto.index=function "+P+"_index(",u.join(),"){return "+f+"}"),d.push("proto.hi=function "+P+"_hi("+u.join(",")+"){return new "+P+"(this.data,"+N.map((function(b){return["(typeof i",b,"!=='number'||i",b,"<0)?this.shape[",b,"]:i",b,"|0"].join("")})).join(",")+","+N.map((function(b){return"this.stride["+b+"]"})).join(",")+",this.offset)}");var Y=N.map((function(b){return"a"+b+"=this.shape["+b+"]"})),D=N.map((function(b){return"c"+b+"=this.stride["+b+"]"}));d.push("proto.lo=function "+P+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+Y.join(",")+","+D.join(","));for(var E=0;E<X;++E)d.push("if(typeof i"+E+"==='number'&&i"+E+">=0){d=i"+E+"|0;b+=c"+E+"*d;a"+E+"-=d}");d.push("return new "+P+"(this.data,"+N.map((function(b){return"a"+b})).join(",")+","+N.map((function(b){return"c"+b})).join(",")+",b)}"),d.push("proto.step=function "+P+"_step("+u.join(",")+"){var "+N.map((function(b){return"a"+b+"=this.shape["+b+"]"})).join(",")+","+N.map((function(b){return"b"+b+"=this.stride["+b+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(E=0;E<X;++E)d.push("if(typeof i"+E+"==='number'){d=i"+E+"|0;if(d<0){c+=b"+E+"*(a"+E+"-1);a"+E+"=ceil(-a"+E+"/d)}else{a"+E+"=ceil(a"+E+"/d)}b"+E+"*=d}");d.push("return new "+P+"(this.data,"+N.map((function(b){return"a"+b})).join(",")+","+N.map((function(b){return"b"+b})).join(",")+",c)}");var t=new Array(X),B=new Array(X);for(E=0;E<X;++E)t[E]="a[i"+E+"]",B[E]="b[i"+E+"]";d.push("proto.transpose=function "+P+"_transpose("+u+"){"+u.map((function(b,X){return b+"=("+b+"===undefined?"+X+":"+b+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+P+"(this.data,"+t.join(",")+","+B.join(",")+",this.offset)}"),d.push("proto.pick=function "+P+"_pick("+u+"){var a=[],b=[],c=this.offset");for(E=0;E<X;++E)d.push("if(typeof i"+E+"==='number'&&i"+E+">=0){c=(c+this.stride["+E+"]*i"+E+")|0}else{a.push(this.shape["+E+"]);b.push(this.stride["+E+"])}");return d.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),d.push("return function construct_"+P+"(data,shape,stride,offset){return new "+P+"(data,"+N.map((function(b){return"shape["+b+"]"})).join(",")+","+N.map((function(b){return"stride["+b+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",d.join("\n"))(w[b],a)}var w={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};b.exports=function(b,X,P,Q){if(void 0===b)return(0,w.array[0])([]);"number"===typeof b&&(b=[b]),void 0===X&&(X=[b.length]);var N=X.length;if(void 0===P){P=new Array(N);for(var a=N-1,f=1;a>=0;--a)P[a]=f,f*=X[a]}if(void 0===Q){Q=0;for(a=0;a<N;++a)P[a]<0&&(Q-=(X[a]-1)*P[a])}for(var O=function(b){if(S(b))return"buffer";if(d)switch(Object.prototype.toString.call(b)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(b)?"array":"generic"}(b),e=w[O];e.length<=N+1;)e.push(u(O,e.length-1));return(0,e[N+1])(b,X,P,Q)}},14033:b=>{var X;self,X=()=>(()=>{"use strict";var b={d:(X,P)=>{for(var Q in P)b.o(P,Q)&&!b.o(X,Q)&&Object.defineProperty(X,Q,{enumerable:!0,get:P[Q]})},o:(b,X)=>Object.prototype.hasOwnProperty.call(b,X)},X={};b.d(X,{default:()=>x});var P,Q=function(b,X){var P=X.x-b.x,Q=X.y-b.y;return Math.sqrt(P*P+Q*Q)},S=function(b){return b*(Math.PI/180)},d=new Map,N=function(b){d.has(b)&&clearTimeout(d.get(b)),d.set(b,setTimeout(b,100))},a=function(b,X,P){for(var Q,S=X.split(/[ ,]+/g),d=0;d<S.length;d+=1)Q=S[d],b.addEventListener?b.addEventListener(Q,P,!1):b.attachEvent&&b.attachEvent(Q,P)},u=function(b,X,P){for(var Q,S=X.split(/[ ,]+/g),d=0;d<S.length;d+=1)Q=S[d],b.removeEventListener?b.removeEventListener(Q,P):b.detachEvent&&b.detachEvent(Q,P)},w=function(b){return b.preventDefault(),b.type.match(/^touch/)?b.changedTouches:b},f=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},O=function(b,X){X.top||X.right||X.bottom||X.left?(b.style.top=X.top,b.style.right=X.right,b.style.bottom=X.bottom,b.style.left=X.left):(b.style.left=X.x+"px",b.style.top=X.y+"px")},e=function(b,X,P){var Q=Y(b);for(var S in Q)if(Q.hasOwnProperty(S))if("string"==typeof X)Q[S]=X+" "+P;else{for(var d="",N=0,a=X.length;N<a;N+=1)d+=X[N]+" "+P+", ";Q[S]=d.slice(0,-2)}return Q},Y=function(b){var X={};return X[b]="",["webkit","Moz","o"].forEach((function(P){X[P+b.charAt(0).toUpperCase()+b.slice(1)]=""})),X},D=function(b,X){for(var P in X)X.hasOwnProperty(P)&&(b[P]=X[P]);return b},E=function(b,X){if(b.length)for(var P=0,Q=b.length;P<Q;P+=1)X(b[P]);else X(b)},t="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,B=window.matchMedia("(any-hover: none)").matches,W=!!("ontouchstart"in window),n=!!window.PointerEvent,y=!!window.MSPointerEvent,h={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},L={start:"mousedown",move:"mousemove",end:"mouseup"},Z={};function v(){}t&&!B?P=h:n?P={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:y?P={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:W?(P=h,Z=L):P=L,v.prototype.on=function(b,X){var P,Q=this,S=b.split(/[ ,]+/g);Q._handlers_=Q._handlers_||{};for(var d=0;d<S.length;d+=1)P=S[d],Q._handlers_[P]=Q._handlers_[P]||[],Q._handlers_[P].push(X);return Q},v.prototype.off=function(b,X){var P=this;return P._handlers_=P._handlers_||{},void 0===b?P._handlers_={}:void 0===X?P._handlers_[b]=null:P._handlers_[b]&&P._handlers_[b].indexOf(X)>=0&&P._handlers_[b].splice(P._handlers_[b].indexOf(X),1),P},v.prototype.trigger=function(b,X){var P,Q=this,S=b.split(/[ ,]+/g);Q._handlers_=Q._handlers_||{};for(var d=0;d<S.length;d+=1)P=S[d],Q._handlers_[P]&&Q._handlers_[P].length&&Q._handlers_[P].forEach((function(b){b.call(Q,{type:P,target:Q},X)}))},v.prototype.config=function(b){var X=this;X.options=X.defaults||{},b&&(X.options=function(b,X){var P={};for(var Q in b)b.hasOwnProperty(Q)&&X.hasOwnProperty(Q)?P[Q]=X[Q]:b.hasOwnProperty(Q)&&(P[Q]=b[Q]);return P}(X.options,b))},v.prototype.bindEvt=function(b,X){var Q=this;return Q._domHandlers_=Q._domHandlers_||{},Q._domHandlers_[X]=function(){"function"==typeof Q["on"+X]?Q["on"+X].apply(Q,arguments):console.warn('[WARNING] : Missing "on'+X+'" handler.')},a(b,P[X],Q._domHandlers_[X]),Z[X]&&a(b,Z[X],Q._domHandlers_[X]),Q},v.prototype.unbindEvt=function(b,X){var Q=this;return Q._domHandlers_=Q._domHandlers_||{},u(b,P[X],Q._domHandlers_[X]),Z[X]&&u(b,Z[X],Q._domHandlers_[X]),delete Q._domHandlers_[X],this};const A=v;function o(b,X){return this.identifier=X.identifier,this.position=X.position,this.frontPosition=X.frontPosition,this.collection=b,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(X),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=o.id,o.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}o.prototype=new A,o.constructor=o,o.id=0,o.prototype.buildEl=function(b){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},o.prototype.stylize=function(){if(this.options.dataOnly)return this;var b=this.options.fadeTime+"ms",X=function(){var b=Y("borderRadius");for(var X in b)b.hasOwnProperty(X)&&(b[X]="50%");return b}(),P=e("transition","opacity",b),Q={};return Q.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},Q.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},Q.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},D(Q.el,P),"circle"===this.options.shape&&D(Q.back,X),D(Q.front,X),this.applyStyles(Q),this},o.prototype.applyStyles=function(b){for(var X in this.ui)if(this.ui.hasOwnProperty(X))for(var P in b[X])this.ui[X].style[P]=b[X][P];return this},o.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},o.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},o.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},o.prototype.show=function(b){var X=this;return X.options.dataOnly||(clearTimeout(X.removeTimeout),clearTimeout(X.showTimeout),clearTimeout(X.restTimeout),X.addToDom(),X.restCallback(),setTimeout((function(){X.ui.el.style.opacity=1}),0),X.showTimeout=setTimeout((function(){X.trigger("shown",X.instance),"function"==typeof b&&b.call(this)}),X.options.fadeTime)),X},o.prototype.hide=function(b){var X=this;if(X.options.dataOnly)return X;if(X.ui.el.style.opacity=X.options.restOpacity,clearTimeout(X.removeTimeout),clearTimeout(X.showTimeout),clearTimeout(X.restTimeout),X.removeTimeout=setTimeout((function(){var P="dynamic"===X.options.mode?"none":"block";X.ui.el.style.display=P,"function"==typeof b&&b.call(X),X.trigger("hidden",X.instance)}),X.options.fadeTime),X.options.restJoystick){var P=X.options.restJoystick,Q={};Q.x=!0===P||!1!==P.x?0:X.instance.frontPosition.x,Q.y=!0===P||!1!==P.y?0:X.instance.frontPosition.y,X.setPosition(b,Q)}return X},o.prototype.setPosition=function(b,X){var P=this;P.frontPosition={x:X.x,y:X.y};var Q=P.options.fadeTime+"ms",S={};S.front=e("transition",["transform"],Q);var d={front:{}};d.front={transform:"translate("+P.frontPosition.x+"px,"+P.frontPosition.y+"px)"},P.applyStyles(S),P.applyStyles(d),P.restTimeout=setTimeout((function(){"function"==typeof b&&b.call(P),P.restCallback()}),P.options.fadeTime)},o.prototype.restCallback=function(){var b=this,X={};X.front=e("transition","none",""),b.applyStyles(X),b.trigger("rested",b.instance)},o.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},o.prototype.computeDirection=function(b){var X,P,Q,S=b.angle.radian,d=Math.PI/4,N=Math.PI/2;if(S>d&&S<3*d&&!b.lockX?X="up":S>-d&&S<=d&&!b.lockY?X="left":S>3*-d&&S<=-d&&!b.lockX?X="down":b.lockY||(X="right"),b.lockY||(P=S>-N&&S<N?"left":"right"),b.lockX||(Q=S>0?"up":"down"),b.force>this.options.threshold){var a,u={};for(a in this.direction)this.direction.hasOwnProperty(a)&&(u[a]=this.direction[a]);var w={};for(a in this.direction={x:P,y:Q,angle:X},b.direction=this.direction,u)u[a]===this.direction[a]&&(w[a]=!0);if(w.x&&w.y&&w.angle)return b;w.x&&w.y||this.trigger("plain",b),w.x||this.trigger("plain:"+P,b),w.y||this.trigger("plain:"+Q,b),w.angle||this.trigger("dir dir:"+X,b)}else this.resetDirection();return b};const K=o;function T(b,X){var P=this;P.nipples=[],P.idles=[],P.actives=[],P.ids=[],P.pressureIntervals={},P.manager=b,P.id=T.id,T.id+=1,P.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},P.config(X),"static"!==P.options.mode&&"semi"!==P.options.mode||(P.options.multitouch=!1),P.options.multitouch||(P.options.maxNumberOfNipples=1);var Q=getComputedStyle(P.options.zone.parentElement);return Q&&"flex"===Q.display&&(P.parentIsFlex=!0),P.updateBox(),P.prepareNipples(),P.ye(),P.begin(),P.nipples}T.prototype=new A,T.constructor=T,T.id=0,T.prototype.prepareNipples=function(){var b=this,X=b.nipples;X.on=b.on.bind(b),X.off=b.off.bind(b),X.options=b.options,X.destroy=b.destroy.bind(b),X.ids=b.ids,X.id=b.id,X.processOnMove=b.processOnMove.bind(b),X.processOnEnd=b.processOnEnd.bind(b),X.get=function(b){if(void 0===b)return X[0];for(var P=0,Q=X.length;P<Q;P+=1)if(X[P].identifier===b)return X[P];return!1}},T.prototype.ye=function(){var b=this;b.bindEvt(b.options.zone,"start"),b.options.zone.style.touchAction="none",b.options.zone.style.msTouchAction="none"},T.prototype.begin=function(){var b=this,X=b.options;if("static"===X.mode){var P=b.createNipple(X.position,b.manager.getIdentifier());P.add(),b.idles.push(P)}},T.prototype.createNipple=function(b,X){var P=this,Q=P.manager.scroll,S={},d=P.options,N=P.parentIsFlex?Q.x:Q.x+P.box.left,a=P.parentIsFlex?Q.y:Q.y+P.box.top;if(b.x&&b.y)S={x:b.x-N,y:b.y-a};else if(b.top||b.right||b.bottom||b.left){var u=document.createElement("DIV");u.style.display="hidden",u.style.top=b.top,u.style.right=b.right,u.style.bottom=b.bottom,u.style.left=b.left,u.style.position="absolute",d.zone.appendChild(u);var w=u.getBoundingClientRect();d.zone.removeChild(u),S=b,b={x:w.left+Q.x,y:w.top+Q.y}}var f=new K(P,{color:d.color,size:d.size,threshold:d.threshold,fadeTime:d.fadeTime,dataOnly:d.dataOnly,restJoystick:d.restJoystick,restOpacity:d.restOpacity,mode:d.mode,identifier:X,position:b,zone:d.zone,frontPosition:{x:0,y:0},shape:d.shape});return d.dataOnly||(O(f.ui.el,S),O(f.ui.front,f.frontPosition)),P.nipples.push(f),P.trigger("added "+f.identifier+":added",f),P.manager.trigger("added "+f.identifier+":added",f),P.bindNipple(f),f},T.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},T.prototype.bindNipple=function(b){var X,P=this,Q=function(b,Q){X=b.type+" "+Q.id+":"+b.type,P.trigger(X,Q)};b.on("destroyed",P.onDestroyed.bind(P)),b.on("shown hidden rested dir plain",Q),b.on("dir:up dir:right dir:down dir:left",Q),b.on("plain:up plain:right plain:down plain:left",Q)},T.prototype.pressureFn=function(b,X,P){var Q=this,S=0;clearInterval(Q.pressureIntervals[P]),Q.pressureIntervals[P]=setInterval(function(){var P=b.force||b.pressure||b.webkitForce||0;P!==S&&(X.trigger("pressure",P),Q.trigger("pressure "+X.identifier+":pressure",P),S=P)}.bind(Q),100)},T.prototype.onstart=function(b){var X=this,P=X.options,Q=b;return b=w(b),X.updateBox(),E(b,(function(S){X.actives.length<P.maxNumberOfNipples?X.processOnStart(S):Q.type.match(/^touch/)&&(Object.keys(X.manager.ids).forEach((function(P){if(Object.values(Q.touches).findIndex((function(b){return b.identifier===P}))<0){var S=[b[0]];S.identifier=P,X.processOnEnd(S)}})),X.actives.length<P.maxNumberOfNipples&&X.processOnStart(S))})),X.manager.bindDocument(),!1},T.prototype.processOnStart=function(b){var X,P=this,S=P.options,d=P.manager.getIdentifier(b),N=b.force||b.pressure||b.webkitForce||0,a={x:b.pageX,y:b.pageY},u=P.getOrCreate(d,a);u.identifier!==d&&P.manager.removeIdentifier(u.identifier),u.identifier=d;var w=function(X){X.trigger("start",X),P.trigger("start "+X.id+":start",X),X.show(),N>0&&P.pressureFn(b,X,X.identifier),P.processOnMove(b)};if((X=P.idles.indexOf(u))>=0&&P.idles.splice(X,1),P.actives.push(u),P.ids.push(u.identifier),"semi"!==S.mode)w(u);else{if(!(Q(a,u.position)<=S.catchDistance))return u.destroy(),void P.processOnStart(b);w(u)}return u},T.prototype.getOrCreate=function(b,X){var P,Q=this,S=Q.options;return/(semi|static)/.test(S.mode)?(P=Q.idles[0])?(Q.idles.splice(0,1),P):"semi"===S.mode?Q.createNipple(X,b):(console.warn("Coudln't find the needed nipple."),!1):P=Q.createNipple(X,b)},T.prototype.processOnMove=function(b){var X=this,P=X.options,d=X.manager.getIdentifier(b),N=X.nipples.get(d),a=X.manager.scroll;if(function(b){return isNaN(b.buttons)?0!==b.pressure:0!==b.buttons}(b)){if(!N)return console.error("Found zombie joystick with ID "+d),void X.manager.removeIdentifier(d);if(P.dynamicPage){var u=N.el.getBoundingClientRect();N.position={x:a.x+u.left,y:a.y+u.top}}N.identifier=d;var w=N.options.size/2,f={x:b.pageX,y:b.pageY};P.lockX&&(f.y=N.position.y),P.lockY&&(f.x=N.position.x);var O,e,Y,D,E,t,B,W,n,y,h=Q(f,N.position),L=(O=f,Y=(e=N.position).x-O.x,D=e.y-O.y,function(b){return b*(180/Math.PI)}(Math.atan2(D,Y))),Z=S(L),v=h/w,A={distance:h,position:f};if("circle"===N.options.shape?(E=Math.min(h,w),B=N.position,W=E,y={x:0,y:0},n=S(n=L),y.x=B.x-W*Math.cos(n),y.y=B.y-W*Math.sin(n),t=y):(t=function(b,X,P){return{x:Math.min(Math.max(b.x,X.x-P),X.x+P),y:Math.min(Math.max(b.y,X.y-P),X.y+P)}}(f,N.position,w),E=Q(t,N.position)),P.follow){if(h>w){var o=f.x-t.x,K=f.y-t.y;N.position.x+=o,N.position.y+=K,N.el.style.top=N.position.y-(X.box.top+a.y)+"px",N.el.style.left=N.position.x-(X.box.left+a.x)+"px",h=Q(f,N.position)}}else f=t,h=E;var T=f.x-N.position.x,q=f.y-N.position.y;N.frontPosition={x:T,y:q},P.dataOnly||(N.ui.front.style.transform="translate("+T+"px,"+q+"px)");var V={identifier:N.identifier,position:f,force:v,pressure:b.force||b.pressure||b.webkitForce||0,distance:h,angle:{radian:Z,degree:L},vector:{x:T/w,y:-q/w},raw:A,instance:N,lockX:P.lockX,lockY:P.lockY};(V=N.computeDirection(V)).angle={radian:S(180-L),degree:180-L},N.trigger("move",V),X.trigger("move "+N.id+":move",V)}else this.processOnEnd(b)},T.prototype.processOnEnd=function(b){var X=this,P=X.options,Q=X.manager.getIdentifier(b),S=X.nipples.get(Q),d=X.manager.removeIdentifier(S.identifier);S&&(P.dataOnly||S.hide((function(){"dynamic"===P.mode&&(S.trigger("removed",S),X.trigger("removed "+S.id+":removed",S),X.manager.trigger("removed "+S.id+":removed",S),S.destroy())})),clearInterval(X.pressureIntervals[S.identifier]),S.resetDirection(),S.trigger("end",S),X.trigger("end "+S.id+":end",S),X.ids.indexOf(S.identifier)>=0&&X.ids.splice(X.ids.indexOf(S.identifier),1),X.actives.indexOf(S)>=0&&X.actives.splice(X.actives.indexOf(S),1),/(semi|static)/.test(P.mode)?X.idles.push(S):X.nipples.indexOf(S)>=0&&X.nipples.splice(X.nipples.indexOf(S),1),X.manager.unbindDocument(),/(semi|static)/.test(P.mode)&&(X.manager.ids[d.id]=d.identifier))},T.prototype.onDestroyed=function(b,X){var P=this;P.nipples.indexOf(X)>=0&&P.nipples.splice(P.nipples.indexOf(X),1),P.actives.indexOf(X)>=0&&P.actives.splice(P.actives.indexOf(X),1),P.idles.indexOf(X)>=0&&P.idles.splice(P.idles.indexOf(X),1),P.ids.indexOf(X.identifier)>=0&&P.ids.splice(P.ids.indexOf(X.identifier),1),P.manager.removeIdentifier(X.identifier),P.manager.unbindDocument()},T.prototype.destroy=function(){var b=this;for(var X in b.unbindEvt(b.options.zone,"start"),b.nipples.forEach((function(b){b.destroy()})),b.pressureIntervals)b.pressureIntervals.hasOwnProperty(X)&&clearInterval(b.pressureIntervals[X]);b.trigger("destroyed",b.nipples),b.manager.unbindDocument(),b.off()};const q=T;function V(b){var X=this;X.ids={},X.index=0,X.collections=[],X.scroll=f(),X.config(b),X.prepareCollections();var P=function(){var b;X.collections.forEach((function(P){P.forEach((function(P){b=P.el.getBoundingClientRect(),P.position={x:X.scroll.x+b.left,y:X.scroll.y+b.top}}))}))};a(window,"resize",(function(){N(P)}));var Q=function(){X.scroll=f()};return a(window,"scroll",(function(){N(Q)})),X.collections}V.prototype=new A,V.constructor=V,V.prototype.prepareCollections=function(){var b=this;b.collections.create=b.create.bind(b),b.collections.on=b.on.bind(b),b.collections.off=b.off.bind(b),b.collections.destroy=b.destroy.bind(b),b.collections.get=function(X){var P;return b.collections.every((function(b){return!(P=b.get(X))})),P}},V.prototype.create=function(b){return this.createCollection(b)},V.prototype.createCollection=function(b){var X=this,P=new q(X,b);return X.bindCollection(P),X.collections.push(P),P},V.prototype.bindCollection=function(b){var X,P=this,Q=function(b,Q){X=b.type+" "+Q.id+":"+b.type,P.trigger(X,Q)};b.on("destroyed",P.onDestroyed.bind(P)),b.on("shown hidden rested dir plain",Q),b.on("dir:up dir:right dir:down dir:left",Q),b.on("plain:up plain:right plain:down plain:left",Q)},V.prototype.bindDocument=function(){var b=this;b.binded||(b.bindEvt(document,"move").bindEvt(document,"end"),b.binded=!0)},V.prototype.unbindDocument=function(b){var X=this;Object.keys(X.ids).length&&!0!==b||(X.unbindEvt(document,"move").unbindEvt(document,"end"),X.binded=!1)},V.prototype.getIdentifier=function(b){var X;return b?void 0===(X=void 0===b.identifier?b.pointerId:b.identifier)&&(X=this.latest||0):X=this.index,void 0===this.ids[X]&&(this.ids[X]=this.index,this.index+=1),this.latest=X,this.ids[X]},V.prototype.removeIdentifier=function(b){var X={};for(var P in this.ids)if(this.ids[P]===b){X.id=P,X.identifier=this.ids[P],delete this.ids[P];break}return X},V.prototype.onmove=function(b){return this.onAny("move",b),!1},V.prototype.onend=function(b){return this.onAny("end",b),!1},V.prototype.oncancel=function(b){return this.onAny("end",b),!1},V.prototype.onAny=function(b,X){var P,Q=this,S="processOn"+b.charAt(0).toUpperCase()+b.slice(1);X=w(X);var d=function(b,X,P){P.ids.indexOf(X)>=0&&(P[S](b),b._found_=!0)};return E(X,(function(b){P=Q.getIdentifier(b),E(Q.collections,d.bind(null,b,P)),b._found_||Q.removeIdentifier(P)})),!1},V.prototype.destroy=function(){var b=this;b.unbindDocument(!0),b.ids={},b.index=0,b.collections.forEach((function(b){b.destroy()})),b.off()},V.prototype.onDestroyed=function(b,X){var P=this;if(P.collections.indexOf(X)<0)return!1;P.collections.splice(P.collections.indexOf(X),1)};var i=new V;const x={create:function(b){return i.create(b)},factory:i};return X.default})(),b.exports=X()},13053:(b,X,P)=>{"use strict";const{Deflate:Q,deflate:S,deflateRaw:d,gzip:N}=P(13058),{Inflate:a,inflate:u,inflateRaw:w,ungzip:f}=P(13112),O=P(13091);b.exports.Deflate=Q,b.exports.deflate=S,b.exports.deflateRaw=d,b.exports.gzip=N,b.exports.Inflate=a,b.exports.inflate=u,b.exports.inflateRaw=w,b.exports.ungzip=f,b.exports.constants=O},13058:(b,X,P)=>{"use strict";const Q=P(13063),S=P(13094),d=P(13097),N=P(13086),a=P(13105),u=Object.prototype.toString,{Z_NO_FLUSH:w,Z_SYNC_FLUSH:f,Z_FULL_FLUSH:O,Z_FINISH:e,Z_OK:Y,Z_STREAM_END:D,Z_DEFAULT_COMPRESSION:E,Z_DEFAULT_STRATEGY:t,Z_DEFLATED:B}=P(13091);function W(b){this.options=S.assign({level:E,method:B,gb:16384,windowBits:15,memLevel:8,strategy:t},b||{});let X=this.options;X.raw&&X.windowBits>0?X.windowBits=-X.windowBits:X.gzip&&X.windowBits>0&&X.windowBits<16&&(X.windowBits+=16),this.err=0,this.OX="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let P=Q.deflateInit2(this.strm,X.level,X.method,X.windowBits,X.memLevel,X.strategy);if(P!==Y)throw new Error(N[P]);if(X.header&&Q.deflateSetHeader(this.strm,X.header),X.dictionary){let b;if(b="string"===typeof X.dictionary?d.string2buf(X.dictionary):"[object ArrayBuffer]"===u.call(X.dictionary)?new Uint8Array(X.dictionary):X.dictionary,P=Q.deflateSetDictionary(this.strm,b),P!==Y)throw new Error(N[P]);this._dict_set=!0}}function n(b,X){const P=new W(X);if(P.push(b,!0),P.err)throw P.OX||N[P.err];return P.result}W.prototype.push=function(b,X){const P=this.strm,S=this.options.gb;let N,a;if(this.ended)return!1;for(a=X===~~X?X:!0===X?e:w,"string"===typeof b?P.input=d.string2buf(b):"[object ArrayBuffer]"===u.call(b)?P.input=new Uint8Array(b):P.input=b,P.next_in=0,P.avail_in=P.input.length;;)if(0===P.avail_out&&(P.output=new Uint8Array(S),P.next_out=0,P.avail_out=S),(a===f||a===O)&&P.avail_out<=6)this.onData(P.output.subarray(0,P.next_out)),P.avail_out=0;else{if(N=Q.deflate(P,a),N===D)return P.next_out>0&&this.onData(P.output.subarray(0,P.next_out)),N=Q.deflateEnd(this.strm),this.onEnd(N),this.ended=!0,N===Y;if(0!==P.avail_out){if(a>0&&P.next_out>0)this.onData(P.output.subarray(0,P.next_out)),P.avail_out=0;else if(0===P.avail_in)break}else this.onData(P.output)}return!0},W.prototype.onData=function(b){this.chunks.push(b)},W.prototype.onEnd=function(b){b===Y&&(this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.OX=this.strm.OX},b.exports.Deflate=W,b.exports.deflate=n,b.exports.deflateRaw=function(b,X){return(X=X||{}).raw=!0,n(b,X)},b.exports.gzip=function(b,X){return(X=X||{}).gzip=!0,n(b,X)},b.exports.constants=P(13091)},13112:(b,X,P)=>{"use strict";const Q=P(13116),S=P(13094),d=P(13097),N=P(13086),a=P(13105),u=P(13134),w=Object.prototype.toString,{Z_NO_FLUSH:f,Z_FINISH:O,Z_OK:e,Z_STREAM_END:Y,Z_NEED_DICT:D,Z_STREAM_ERROR:E,Z_DATA_ERROR:t,Z_MEM_ERROR:B}=P(13091);function W(b){this.options=S.assign({gb:65536,windowBits:15,to:""},b||{});const X=this.options;X.raw&&X.windowBits>=0&&X.windowBits<16&&(X.windowBits=-X.windowBits,0===X.windowBits&&(X.windowBits=-15)),!(X.windowBits>=0&&X.windowBits<16)||b&&b.windowBits||(X.windowBits+=32),X.windowBits>15&&X.windowBits<48&&0===(15&X.windowBits)&&(X.windowBits|=15),this.err=0,this.OX="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let P=Q.inflateInit2(this.strm,X.windowBits);if(P!==e)throw new Error(N[P]);if(this.header=new u,Q.inflateGetHeader(this.strm,this.header),X.dictionary&&("string"===typeof X.dictionary?X.dictionary=d.string2buf(X.dictionary):"[object ArrayBuffer]"===w.call(X.dictionary)&&(X.dictionary=new Uint8Array(X.dictionary)),X.raw&&(P=Q.inflateSetDictionary(this.strm,X.dictionary),P!==e)))throw new Error(N[P])}function n(b,X){const P=new W(X);if(P.push(b),P.err)throw P.OX||N[P.err];return P.result}W.prototype.push=function(b,X){const P=this.strm,S=this.options.gb,N=this.options.dictionary;let a,u,W;if(this.ended)return!1;for(u=X===~~X?X:!0===X?O:f,"[object ArrayBuffer]"===w.call(b)?P.input=new Uint8Array(b):P.input=b,P.next_in=0,P.avail_in=P.input.length;;){for(0===P.avail_out&&(P.output=new Uint8Array(S),P.next_out=0,P.avail_out=S),a=Q.inflate(P,u),a===D&&N&&(a=Q.inflateSetDictionary(P,N),a===e?a=Q.inflate(P,u):a===t&&(a=D));P.avail_in>0&&a===Y&&P.state.wrap>0&&0!==b[P.next_in];)Q.inflateReset(P),a=Q.inflate(P,u);switch(a){case E:case t:case D:case B:return this.onEnd(a),this.ended=!0,!1}if(W=P.avail_out,P.next_out&&(0===P.avail_out||a===Y))if("string"===this.options.to){let b=d.utf8border(P.output,P.next_out),X=P.next_out-b,Q=d.buf2string(P.output,b);P.next_out=X,P.avail_out=S-X,X&&P.output.set(P.output.subarray(b,b+X),0),this.onData(Q)}else this.onData(P.output.length===P.next_out?P.output:P.output.subarray(0,P.next_out));if(a!==e||0!==W){if(a===Y)return a=Q.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===P.avail_in)break}}return!0},W.prototype.onData=function(b){this.chunks.push(b)},W.prototype.onEnd=function(b){b===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.OX=this.strm.OX},b.exports.Inflate=W,b.exports.inflate=n,b.exports.inflateRaw=function(b,X){return(X=X||{}).raw=!0,n(b,X)},b.exports.ungzip=n,b.exports.constants=P(13091)},13094:b=>{"use strict";const X=(b,X)=>Object.prototype.hasOwnProperty.call(b,X);b.exports.assign=function(b){const P=Array.prototype.slice.call(arguments,1);for(;P.length;){const Q=P.shift();if(Q){if("object"!==typeof Q)throw new TypeError(Q+"must be non-object");for(const P in Q)X(Q,P)&&(b[P]=Q[P])}}return b},b.exports.flattenChunks=b=>{let X=0;for(let Q=0,S=b.length;Q<S;Q++)X+=b[Q].length;const P=new Uint8Array(X);for(let Q=0,S=0,d=b.length;Q<d;Q++){let X=b[Q];P.set(X,S),S+=X.length}return P}},13097:b=>{"use strict";let X=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Q){X=!1}const P=new Uint8Array(256);for(let S=0;S<256;S++)P[S]=S>=252?6:S>=248?5:S>=240?4:S>=224?3:S>=192?2:1;P[254]=P[254]=1,b.exports.string2buf=b=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(b);let X,P,Q,S,d,N=b.length,a=0;for(S=0;S<N;S++)P=b.charCodeAt(S),55296===(64512&P)&&S+1<N&&(Q=b.charCodeAt(S+1),56320===(64512&Q)&&(P=65536+(P-55296<<10)+(Q-56320),S++)),a+=P<128?1:P<2048?2:P<65536?3:4;for(X=new Uint8Array(a),d=0,S=0;d<a;S++)P=b.charCodeAt(S),55296===(64512&P)&&S+1<N&&(Q=b.charCodeAt(S+1),56320===(64512&Q)&&(P=65536+(P-55296<<10)+(Q-56320),S++)),P<128?X[d++]=P:P<2048?(X[d++]=192|P>>>6,X[d++]=128|63&P):P<65536?(X[d++]=224|P>>>12,X[d++]=128|P>>>6&63,X[d++]=128|63&P):(X[d++]=240|P>>>18,X[d++]=128|P>>>12&63,X[d++]=128|P>>>6&63,X[d++]=128|63&P);return X};b.exports.buf2string=(b,Q)=>{const S=Q||b.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(b.subarray(0,Q));let d,N;const a=new Array(2*S);for(N=0,d=0;d<S;){let X=b[d++];if(X<128){a[N++]=X;continue}let Q=P[X];if(Q>4)a[N++]=65533,d+=Q-1;else{for(X&=2===Q?31:3===Q?15:7;Q>1&&d<S;)X=X<<6|63&b[d++],Q--;Q>1?a[N++]=65533:X<65536?a[N++]=X:(X-=65536,a[N++]=55296|X>>10&1023,a[N++]=56320|1023&X)}}return((b,P)=>{if(P<65534&&b.subarray&&X)return String.fromCharCode.apply(null,b.length===P?b:b.subarray(0,P));let Q="";for(let X=0;X<P;X++)Q+=String.fromCharCode(b[X]);return Q})(a,N)},b.exports.utf8border=(b,X)=>{(X=X||b.length)>b.length&&(X=b.length);let Q=X-1;for(;Q>=0&&128===(192&b[Q]);)Q--;return Q<0||0===Q?X:Q+P[b[Q]]>X?Q:X}},13077:b=>{"use strict";b.exports=(b,X,P,Q)=>{let S=65535&b,d=b>>>16&65535,N=0;for(;0!==P;){N=P>2e3?2e3:P,P-=N;do{S=S+X[Q++]|0,d=d+S|0}while(--N);S%=65521,d%=65521}return S|d<<16}},13091:b=>{"use strict";b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13080:b=>{"use strict";const X=new Uint32Array((()=>{let b,X=[];for(var P=0;P<256;P++){b=P;for(var Q=0;Q<8;Q++)b=1&b?3988292384^b>>>1:b>>>1;X[P]=b}return X})());b.exports=(b,P,Q,S)=>{const d=X,N=S+Q;b^=-1;for(let X=S;X<N;X++)b=b>>>8^d[255&(b^P[X])];return~b}},13063:(b,X,P)=>{"use strict";const{_tr_init:Q,_tr_stored_block:S,_tr_flush_block:d,_tr_tally:N,_tr_align:a}=P(13070),u=P(13077),w=P(13080),f=P(13086),{Z_NO_FLUSH:O,Z_PARTIAL_FLUSH:e,Z_FULL_FLUSH:Y,Z_FINISH:D,Z_BLOCK:E,Z_OK:t,Z_STREAM_END:B,Z_STREAM_ERROR:W,Z_DATA_ERROR:n,Z_BUF_ERROR:y,Z_DEFAULT_COMPRESSION:h,Z_FILTERED:L,Z_HUFFMAN_ONLY:Z,Z_RLE:v,Z_FIXED:A,Z_DEFAULT_STRATEGY:o,Z_UNKNOWN:K,Z_DEFLATED:T}=P(13091),q=258,V=262,i=103,x=113,H=666,C=(b,X)=>(b.OX=f[X],X),p=b=>(b<<1)-(b>4?9:0),k=b=>{let X=b.length;for(;--X>=0;)b[X]=0};let z=(b,X,P)=>(X<<b.hash_shift^P)&b.hash_mask;const U=b=>{const X=b.state;let P=X.pending;P>b.avail_out&&(P=b.avail_out),0!==P&&(b.output.set(X.pending_buf.subarray(X.pending_out,X.pending_out+P),b.next_out),b.next_out+=P,X.pending_out+=P,b.total_out+=P,b.avail_out-=P,X.pending-=P,0===X.pending&&(X.pending_out=0))},g=(b,X)=>{d(b,b.block_start>=0?b.block_start:-1,b.strstart-b.block_start,X),b.block_start=b.strstart,U(b.strm)},j=(b,X)=>{b.pending_buf[b.pending++]=X},l=(b,X)=>{b.pending_buf[b.pending++]=X>>>8&255,b.pending_buf[b.pending++]=255&X},J=(b,X,P,Q)=>{let S=b.avail_in;return S>Q&&(S=Q),0===S?0:(b.avail_in-=S,X.set(b.input.subarray(b.next_in,b.next_in+S),P),1===b.state.wrap?b.adler=u(b.adler,X,S,P):2===b.state.wrap&&(b.adler=w(b.adler,X,S,P)),b.next_in+=S,b.total_in+=S,S)},c=(b,X)=>{let P,Q,S=b.max_chain_length,d=b.strstart,N=b.prev_length,a=b.nice_match;const u=b.strstart>b.w_size-V?b.strstart-(b.w_size-V):0,w=b.window,f=b.w_mask,O=b.prev,e=b.strstart+q;let Y=w[d+N-1],D=w[d+N];b.prev_length>=b.good_match&&(S>>=2),a>b.lookahead&&(a=b.lookahead);do{if(P=X,w[P+N]===D&&w[P+N-1]===Y&&w[P]===w[d]&&w[++P]===w[d+1]){d+=2,P++;do{}while(w[++d]===w[++P]&&w[++d]===w[++P]&&w[++d]===w[++P]&&w[++d]===w[++P]&&w[++d]===w[++P]&&w[++d]===w[++P]&&w[++d]===w[++P]&&w[++d]===w[++P]&&d<e);if(Q=q-(e-d),d=e-q,Q>N){if(b.match_start=X,N=Q,Q>=a)break;Y=w[d+N-1],D=w[d+N]}}}while((X=O[X&f])>u&&0!==--S);return N<=b.lookahead?N:b.lookahead},s=b=>{const X=b.w_size;let P,Q,S,d,N;do{if(d=b.window_size-b.lookahead-b.strstart,b.strstart>=X+(X-V)){b.window.set(b.window.subarray(X,X+X),0),b.match_start-=X,b.strstart-=X,b.block_start-=X,Q=b.hash_size,P=Q;do{S=b.head[--P],b.head[P]=S>=X?S-X:0}while(--Q);Q=X,P=Q;do{S=b.prev[--P],b.prev[P]=S>=X?S-X:0}while(--Q);d+=X}if(0===b.strm.avail_in)break;if(Q=J(b.strm,b.window,b.strstart+b.lookahead,d),b.lookahead+=Q,b.lookahead+b.insert>=3)for(N=b.strstart-b.insert,b.ins_h=b.window[N],b.ins_h=z(b,b.ins_h,b.window[N+1]);b.insert&&(b.ins_h=z(b,b.ins_h,b.window[N+3-1]),b.prev[N&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=N,N++,b.insert--,!(b.lookahead+b.insert<3)););}while(b.lookahead<V&&0!==b.strm.avail_in)},F=(b,X)=>{let P,Q;for(;;){if(b.lookahead<V){if(s(b),b.lookahead<V&&X===O)return 1;if(0===b.lookahead)break}if(P=0,b.lookahead>=3&&(b.ins_h=z(b,b.ins_h,b.window[b.strstart+3-1]),P=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),0!==P&&b.strstart-P<=b.w_size-V&&(b.match_length=c(b,P)),b.match_length>=3)if(Q=N(b,b.strstart-b.match_start,b.match_length-3),b.lookahead-=b.match_length,b.match_length<=b.max_lazy_match&&b.lookahead>=3){b.match_length--;do{b.strstart++,b.ins_h=z(b,b.ins_h,b.window[b.strstart+3-1]),P=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart}while(0!==--b.match_length);b.strstart++}else b.strstart+=b.match_length,b.match_length=0,b.ins_h=b.window[b.strstart],b.ins_h=z(b,b.ins_h,b.window[b.strstart+1]);else Q=N(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++;if(Q&&(g(b,!1),0===b.strm.avail_out))return 1}return b.insert=b.strstart<2?b.strstart:2,X===D?(g(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(g(b,!1),0===b.strm.avail_out)?1:2},M=(b,X)=>{let P,Q,S;for(;;){if(b.lookahead<V){if(s(b),b.lookahead<V&&X===O)return 1;if(0===b.lookahead)break}if(P=0,b.lookahead>=3&&(b.ins_h=z(b,b.ins_h,b.window[b.strstart+3-1]),P=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),b.prev_length=b.match_length,b.prev_match=b.match_start,b.match_length=2,0!==P&&b.prev_length<b.max_lazy_match&&b.strstart-P<=b.w_size-V&&(b.match_length=c(b,P),b.match_length<=5&&(b.strategy===L||3===b.match_length&&b.strstart-b.match_start>4096)&&(b.match_length=2)),b.prev_length>=3&&b.match_length<=b.prev_length){S=b.strstart+b.lookahead-3,Q=N(b,b.strstart-1-b.prev_match,b.prev_length-3),b.lookahead-=b.prev_length-1,b.prev_length-=2;do{++b.strstart<=S&&(b.ins_h=z(b,b.ins_h,b.window[b.strstart+3-1]),P=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart)}while(0!==--b.prev_length);if(b.match_available=0,b.match_length=2,b.strstart++,Q&&(g(b,!1),0===b.strm.avail_out))return 1}else if(b.match_available){if(Q=N(b,0,b.window[b.strstart-1]),Q&&g(b,!1),b.strstart++,b.lookahead--,0===b.strm.avail_out)return 1}else b.match_available=1,b.strstart++,b.lookahead--}return b.match_available&&(Q=N(b,0,b.window[b.strstart-1]),b.match_available=0),b.insert=b.strstart<2?b.strstart:2,X===D?(g(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(g(b,!1),0===b.strm.avail_out)?1:2};function R(b,X,P,Q,S){this.good_length=b,this.max_lazy=X,this.nice_length=P,this.max_chain=Q,this.func=S}const r=[new R(0,0,0,0,((b,X)=>{let P=65535;for(P>b.pending_buf_size-5&&(P=b.pending_buf_size-5);;){if(b.lookahead<=1){if(s(b),0===b.lookahead&&X===O)return 1;if(0===b.lookahead)break}b.strstart+=b.lookahead,b.lookahead=0;const Q=b.block_start+P;if((0===b.strstart||b.strstart>=Q)&&(b.lookahead=b.strstart-Q,b.strstart=Q,g(b,!1),0===b.strm.avail_out))return 1;if(b.strstart-b.block_start>=b.w_size-V&&(g(b,!1),0===b.strm.avail_out))return 1}return b.insert=0,X===D?(g(b,!0),0===b.strm.avail_out?3:4):(b.strstart>b.block_start&&(g(b,!1),b.strm.avail_out),1)})),new R(4,4,8,4,F),new R(4,5,16,8,F),new R(4,6,32,32,F),new R(4,4,16,16,M),new R(8,16,32,32,M),new R(8,16,128,128,M),new R(8,32,128,256,M),new R(32,128,258,1024,M),new R(32,258,258,4096,M)];function I(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),k(this.dyn_ltree),k(this.dyn_dtree),k(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),k(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),k(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const G=b=>{if(!b||!b.state)return C(b,W);b.total_in=b.total_out=0,b.data_type=K;const X=b.state;return X.pending=0,X.pending_out=0,X.wrap<0&&(X.wrap=-X.wrap),X.status=X.wrap?42:x,b.adler=2===X.wrap?0:1,X.last_flush=O,Q(X),t},mb=b=>{const X=G(b);var P;return X===t&&((P=b.state).window_size=2*P.w_size,k(P.head),P.max_lazy_match=r[P.level].max_lazy,P.good_match=r[P.level].good_length,P.nice_match=r[P.level].nice_length,P.max_chain_length=r[P.level].max_chain,P.strstart=0,P.block_start=0,P.lookahead=0,P.insert=0,P.match_length=P.prev_length=2,P.match_available=0,P.ins_h=0),X},bb=(b,X,P,Q,S,d)=>{if(!b)return W;let N=1;if(X===h&&(X=6),Q<0?(N=0,Q=-Q):Q>15&&(N=2,Q-=16),S<1||S>9||P!==T||Q<8||Q>15||X<0||X>9||d<0||d>A)return C(b,W);8===Q&&(Q=9);const a=new I;return b.state=a,a.strm=b,a.wrap=N,a.gzhead=null,a.w_bits=Q,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=S+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<S+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=X,a.strategy=d,a.method=P,mb(b)};b.exports.deflateInit=(b,X)=>bb(b,X,T,15,8,o),b.exports.deflateInit2=bb,b.exports.deflateReset=mb,b.exports.deflateResetKeep=G,b.exports.deflateSetHeader=(b,X)=>b&&b.state?2!==b.state.wrap?W:(b.state.gzhead=X,t):W,b.exports.deflate=(b,X)=>{let P,Q;if(!b||!b.state||X>E||X<0)return b?C(b,W):W;const d=b.state;if(!b.output||!b.input&&0!==b.avail_in||d.status===H&&X!==D)return C(b,0===b.avail_out?y:W);d.strm=b;const u=d.last_flush;if(d.last_flush=X,42===d.status)if(2===d.wrap)b.adler=0,j(d,31),j(d,139),j(d,8),d.gzhead?(j(d,(d.gzhead.text?1:0)+(d.gzhead.hcrc?2:0)+(d.gzhead.extra?4:0)+(d.gzhead.name?8:0)+(d.gzhead.comment?16:0)),j(d,255&d.gzhead.time),j(d,d.gzhead.time>>8&255),j(d,d.gzhead.time>>16&255),j(d,d.gzhead.time>>24&255),j(d,9===d.level?2:d.strategy>=Z||d.level<2?4:0),j(d,255&d.gzhead.os),d.gzhead.extra&&d.gzhead.extra.length&&(j(d,255&d.gzhead.extra.length),j(d,d.gzhead.extra.length>>8&255)),d.gzhead.hcrc&&(b.adler=w(b.adler,d.pending_buf,d.pending,0)),d.gzindex=0,d.status=69):(j(d,0),j(d,0),j(d,0),j(d,0),j(d,0),j(d,9===d.level?2:d.strategy>=Z||d.level<2?4:0),j(d,3),d.status=x);else{let X=T+(d.w_bits-8<<4)<<8,P=-1;P=d.strategy>=Z||d.level<2?0:d.level<6?1:6===d.level?2:3,X|=P<<6,0!==d.strstart&&(X|=32),X+=31-X%31,d.status=x,l(d,X),0!==d.strstart&&(l(d,b.adler>>>16),l(d,65535&b.adler)),b.adler=1}if(69===d.status)if(d.gzhead.extra){for(P=d.pending;d.gzindex<(65535&d.gzhead.extra.length)&&(d.pending!==d.pending_buf_size||(d.gzhead.hcrc&&d.pending>P&&(b.adler=w(b.adler,d.pending_buf,d.pending-P,P)),U(b),P=d.pending,d.pending!==d.pending_buf_size));)j(d,255&d.gzhead.extra[d.gzindex]),d.gzindex++;d.gzhead.hcrc&&d.pending>P&&(b.adler=w(b.adler,d.pending_buf,d.pending-P,P)),d.gzindex===d.gzhead.extra.length&&(d.gzindex=0,d.status=73)}else d.status=73;if(73===d.status)if(d.gzhead.name){P=d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>P&&(b.adler=w(b.adler,d.pending_buf,d.pending-P,P)),U(b),P=d.pending,d.pending===d.pending_buf_size)){Q=1;break}Q=d.gzindex<d.gzhead.name.length?255&d.gzhead.name.charCodeAt(d.gzindex++):0,j(d,Q)}while(0!==Q);d.gzhead.hcrc&&d.pending>P&&(b.adler=w(b.adler,d.pending_buf,d.pending-P,P)),0===Q&&(d.gzindex=0,d.status=91)}else d.status=91;if(91===d.status)if(d.gzhead.comment){P=d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>P&&(b.adler=w(b.adler,d.pending_buf,d.pending-P,P)),U(b),P=d.pending,d.pending===d.pending_buf_size)){Q=1;break}Q=d.gzindex<d.gzhead.comment.length?255&d.gzhead.comment.charCodeAt(d.gzindex++):0,j(d,Q)}while(0!==Q);d.gzhead.hcrc&&d.pending>P&&(b.adler=w(b.adler,d.pending_buf,d.pending-P,P)),0===Q&&(d.status=i)}else d.status=i;if(d.status===i&&(d.gzhead.hcrc?(d.pending+2>d.pending_buf_size&&U(b),d.pending+2<=d.pending_buf_size&&(j(d,255&b.adler),j(d,b.adler>>8&255),b.adler=0,d.status=x)):d.status=x),0!==d.pending){if(U(b),0===b.avail_out)return d.last_flush=-1,t}else if(0===b.avail_in&&p(X)<=p(u)&&X!==D)return C(b,y);if(d.status===H&&0!==b.avail_in)return C(b,y);if(0!==b.avail_in||0!==d.lookahead||X!==O&&d.status!==H){let P=d.strategy===Z?((b,X)=>{let P;for(;;){if(0===b.lookahead&&(s(b),0===b.lookahead)){if(X===O)return 1;break}if(b.match_length=0,P=N(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++,P&&(g(b,!1),0===b.strm.avail_out))return 1}return b.insert=0,X===D?(g(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(g(b,!1),0===b.strm.avail_out)?1:2})(d,X):d.strategy===v?((b,X)=>{let P,Q,S,d;const a=b.window;for(;;){if(b.lookahead<=q){if(s(b),b.lookahead<=q&&X===O)return 1;if(0===b.lookahead)break}if(b.match_length=0,b.lookahead>=3&&b.strstart>0&&(S=b.strstart-1,Q=a[S],Q===a[++S]&&Q===a[++S]&&Q===a[++S])){d=b.strstart+q;do{}while(Q===a[++S]&&Q===a[++S]&&Q===a[++S]&&Q===a[++S]&&Q===a[++S]&&Q===a[++S]&&Q===a[++S]&&Q===a[++S]&&S<d);b.match_length=q-(d-S),b.match_length>b.lookahead&&(b.match_length=b.lookahead)}if(b.match_length>=3?(P=N(b,1,b.match_length-3),b.lookahead-=b.match_length,b.strstart+=b.match_length,b.match_length=0):(P=N(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++),P&&(g(b,!1),0===b.strm.avail_out))return 1}return b.insert=0,X===D?(g(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(g(b,!1),0===b.strm.avail_out)?1:2})(d,X):r[d.level].func(d,X);if(3!==P&&4!==P||(d.status=H),1===P||3===P)return 0===b.avail_out&&(d.last_flush=-1),t;if(2===P&&(X===e?a(d):X!==E&&(S(d,0,0,!1),X===Y&&(k(d.head),0===d.lookahead&&(d.strstart=0,d.block_start=0,d.insert=0))),U(b),0===b.avail_out))return d.last_flush=-1,t}return X!==D?t:d.wrap<=0?B:(2===d.wrap?(j(d,255&b.adler),j(d,b.adler>>8&255),j(d,b.adler>>16&255),j(d,b.adler>>24&255),j(d,255&b.total_in),j(d,b.total_in>>8&255),j(d,b.total_in>>16&255),j(d,b.total_in>>24&255)):(l(d,b.adler>>>16),l(d,65535&b.adler)),U(b),d.wrap>0&&(d.wrap=-d.wrap),0!==d.pending?t:B)},b.exports.deflateEnd=b=>{if(!b||!b.state)return W;const X=b.state.status;return 42!==X&&69!==X&&73!==X&&91!==X&&X!==i&&X!==x&&X!==H?C(b,W):(b.state=null,X===x?C(b,n):t)},b.exports.deflateSetDictionary=(b,X)=>{let P=X.length;if(!b||!b.state)return W;const Q=b.state,S=Q.wrap;if(2===S||1===S&&42!==Q.status||Q.lookahead)return W;if(1===S&&(b.adler=u(b.adler,X,P,0)),Q.wrap=0,P>=Q.w_size){0===S&&(k(Q.head),Q.strstart=0,Q.block_start=0,Q.insert=0);let b=new Uint8Array(Q.w_size);b.set(X.subarray(P-Q.w_size,P),0),X=b,P=Q.w_size}const d=b.avail_in,N=b.next_in,a=b.input;for(b.avail_in=P,b.next_in=0,b.input=X,s(Q);Q.lookahead>=3;){let b=Q.strstart,X=Q.lookahead-2;do{Q.ins_h=z(Q,Q.ins_h,Q.window[b+3-1]),Q.prev[b&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=b,b++}while(--X);Q.strstart=b,Q.lookahead=2,s(Q)}return Q.strstart+=Q.lookahead,Q.block_start=Q.strstart,Q.insert=Q.lookahead,Q.lookahead=0,Q.match_length=Q.prev_length=2,Q.match_available=0,b.next_in=N,b.input=a,b.avail_in=d,Q.wrap=S,t},b.exports.deflateInfo="pako deflate (from Nodeca project)"},13134:b=>{"use strict";b.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13122:b=>{"use strict";b.exports=function(b,X){let P,Q,S,d,N,a,u,w,f,O,e,Y,D,E,t,B,W,n,y,h,L,Z,v,A;const o=b.state;P=b.next_in,v=b.input,Q=P+(b.avail_in-5),S=b.next_out,A=b.output,d=S-(X-b.avail_out),N=S+(b.avail_out-257),a=o.dmax,u=o.wsize,w=o.whave,f=o.wnext,O=o.window,e=o.hold,Y=o.bits,D=o.lencode,E=o.distcode,t=(1<<o.lenbits)-1,B=(1<<o.distbits)-1;b:do{Y<15&&(e+=v[P++]<<Y,Y+=8,e+=v[P++]<<Y,Y+=8),W=D[e&t];X:for(;;){if(n=W>>>24,e>>>=n,Y-=n,n=W>>>16&255,0===n)A[S++]=65535&W;else{if(!(16&n)){if(0===(64&n)){W=D[(65535&W)+(e&(1<<n)-1)];continue X}if(32&n){o.mode=12;break b}b.OX="invalid literal/length code",o.mode=30;break b}y=65535&W,n&=15,n&&(Y<n&&(e+=v[P++]<<Y,Y+=8),y+=e&(1<<n)-1,e>>>=n,Y-=n),Y<15&&(e+=v[P++]<<Y,Y+=8,e+=v[P++]<<Y,Y+=8),W=E[e&B];P:for(;;){if(n=W>>>24,e>>>=n,Y-=n,n=W>>>16&255,!(16&n)){if(0===(64&n)){W=E[(65535&W)+(e&(1<<n)-1)];continue P}b.OX="invalid distance code",o.mode=30;break b}if(h=65535&W,n&=15,Y<n&&(e+=v[P++]<<Y,Y+=8,Y<n&&(e+=v[P++]<<Y,Y+=8)),h+=e&(1<<n)-1,h>a){b.OX="invalid distance too far back",o.mode=30;break b}if(e>>>=n,Y-=n,n=S-d,h>n){if(n=h-n,n>w&&o.sane){b.OX="invalid distance too far back",o.mode=30;break b}if(L=0,Z=O,0===f){if(L+=u-n,n<y){y-=n;do{A[S++]=O[L++]}while(--n);L=S-h,Z=A}}else if(f<n){if(L+=u+f-n,n-=f,n<y){y-=n;do{A[S++]=O[L++]}while(--n);if(L=0,f<y){n=f,y-=n;do{A[S++]=O[L++]}while(--n);L=S-h,Z=A}}}else if(L+=f-n,n<y){y-=n;do{A[S++]=O[L++]}while(--n);L=S-h,Z=A}for(;y>2;)A[S++]=Z[L++],A[S++]=Z[L++],A[S++]=Z[L++],y-=3;y&&(A[S++]=Z[L++],y>1&&(A[S++]=Z[L++]))}else{L=S-h;do{A[S++]=A[L++],A[S++]=A[L++],A[S++]=A[L++],y-=3}while(y>2);y&&(A[S++]=A[L++],y>1&&(A[S++]=A[L++]))}break}}break}}while(P<Q&&S<N);y=Y>>3,P-=y,Y-=y<<3,e&=(1<<Y)-1,b.next_in=P,b.next_out=S,b.avail_in=P<Q?Q-P+5:5-(P-Q),b.avail_out=S<N?N-S+257:257-(S-N),o.hold=e,o.bits=Y}},13116:(b,X,P)=>{"use strict";const Q=P(13077),S=P(13080),d=P(13122),N=P(13125),{Z_FINISH:a,Z_BLOCK:u,Z_TREES:w,Z_OK:f,Z_STREAM_END:O,Z_NEED_DICT:e,Z_STREAM_ERROR:Y,Z_DATA_ERROR:D,Z_MEM_ERROR:E,Z_BUF_ERROR:t,Z_DEFLATED:B}=P(13091),W=12,n=30,y=b=>(b>>>24&255)+(b>>>8&65280)+((65280&b)<<8)+((255&b)<<24);function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const L=b=>{if(!b||!b.state)return Y;const X=b.state;return b.total_in=b.total_out=X.total=0,b.OX="",X.wrap&&(b.adler=1&X.wrap),X.mode=1,X.last=0,X.havedict=0,X.dmax=32768,X.head=null,X.hold=0,X.bits=0,X.lencode=X.lendyn=new Int32Array(852),X.distcode=X.distdyn=new Int32Array(592),X.sane=1,X.back=-1,f},Z=b=>{if(!b||!b.state)return Y;const X=b.state;return X.wsize=0,X.whave=0,X.wnext=0,L(b)},v=(b,X)=>{let P;if(!b||!b.state)return Y;const Q=b.state;return X<0?(P=0,X=-X):(P=1+(X>>4),X<48&&(X&=15)),X&&(X<8||X>15)?Y:(null!==Q.window&&Q.wbits!==X&&(Q.window=null),Q.wrap=P,Q.wbits=X,Z(b))},A=(b,X)=>{if(!b)return Y;const P=new h;b.state=P,P.window=null;const Q=v(b,X);return Q!==f&&(b.state=null),Q};let o,K,T=!0;const q=b=>{if(T){o=new Int32Array(512),K=new Int32Array(32);let X=0;for(;X<144;)b.lens[X++]=8;for(;X<256;)b.lens[X++]=9;for(;X<280;)b.lens[X++]=7;for(;X<288;)b.lens[X++]=8;for(N(1,b.lens,0,288,o,0,b.work,{bits:9}),X=0;X<32;)b.lens[X++]=5;N(2,b.lens,0,32,K,0,b.work,{bits:5}),T=!1}b.lencode=o,b.lenbits=9,b.distcode=K,b.distbits=5},V=(b,X,P,Q)=>{let S;const d=b.state;return null===d.window&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),Q>=d.wsize?(d.window.set(X.subarray(P-d.wsize,P),0),d.wnext=0,d.whave=d.wsize):(S=d.wsize-d.wnext,S>Q&&(S=Q),d.window.set(X.subarray(P-Q,P-Q+S),d.wnext),(Q-=S)?(d.window.set(X.subarray(P-Q,P),0),d.wnext=Q,d.whave=d.wsize):(d.wnext+=S,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=S))),0};b.exports.inflateReset=Z,b.exports.inflateReset2=v,b.exports.inflateResetKeep=L,b.exports.inflateInit=b=>A(b,15),b.exports.inflateInit2=A,b.exports.inflate=(b,X)=>{let P,h,L,Z,v,A,o,K,T,i,x,H,C,p,k,z,U,g,j,l,J,c,s=0;const F=new Uint8Array(4);let M,R;const r=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!b||!b.state||!b.output||!b.input&&0!==b.avail_in)return Y;P=b.state,P.mode===W&&(P.mode=13),v=b.next_out,L=b.output,o=b.avail_out,Z=b.next_in,h=b.input,A=b.avail_in,K=P.hold,T=P.bits,i=A,x=o,c=f;b:for(;;)switch(P.mode){case 1:if(0===P.wrap){P.mode=13;break}for(;T<16;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}if(2&P.wrap&&35615===K){P.check=0,F[0]=255&K,F[1]=K>>>8&255,P.check=S(P.check,F,2,0),K=0,T=0,P.mode=2;break}if(P.flags=0,P.head&&(P.head.done=!1),!(1&P.wrap)||(((255&K)<<8)+(K>>8))%31){b.OX="incorrect header check",P.mode=n;break}if((15&K)!==B){b.OX="unknown compression method",P.mode=n;break}if(K>>>=4,T-=4,J=8+(15&K),0===P.wbits)P.wbits=J;else if(J>P.wbits){b.OX="invalid window size",P.mode=n;break}P.dmax=1<<P.wbits,b.adler=P.check=1,P.mode=512&K?10:W,K=0,T=0;break;case 2:for(;T<16;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}if(P.flags=K,(255&P.flags)!==B){b.OX="unknown compression method",P.mode=n;break}if(57344&P.flags){b.OX="unknown header flags set",P.mode=n;break}P.head&&(P.head.text=K>>8&1),512&P.flags&&(F[0]=255&K,F[1]=K>>>8&255,P.check=S(P.check,F,2,0)),K=0,T=0,P.mode=3;case 3:for(;T<32;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}P.head&&(P.head.time=K),512&P.flags&&(F[0]=255&K,F[1]=K>>>8&255,F[2]=K>>>16&255,F[3]=K>>>24&255,P.check=S(P.check,F,4,0)),K=0,T=0,P.mode=4;case 4:for(;T<16;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}P.head&&(P.head.xflags=255&K,P.head.os=K>>8),512&P.flags&&(F[0]=255&K,F[1]=K>>>8&255,P.check=S(P.check,F,2,0)),K=0,T=0,P.mode=5;case 5:if(1024&P.flags){for(;T<16;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}P.length=K,P.head&&(P.head.extra_len=K),512&P.flags&&(F[0]=255&K,F[1]=K>>>8&255,P.check=S(P.check,F,2,0)),K=0,T=0}else P.head&&(P.head.extra=null);P.mode=6;case 6:if(1024&P.flags&&(H=P.length,H>A&&(H=A),H&&(P.head&&(J=P.head.extra_len-P.length,P.head.extra||(P.head.extra=new Uint8Array(P.head.extra_len)),P.head.extra.set(h.subarray(Z,Z+H),J)),512&P.flags&&(P.check=S(P.check,h,H,Z)),A-=H,Z+=H,P.length-=H),P.length))break b;P.length=0,P.mode=7;case 7:if(2048&P.flags){if(0===A)break b;H=0;do{J=h[Z+H++],P.head&&J&&P.length<65536&&(P.head.name+=String.fromCharCode(J))}while(J&&H<A);if(512&P.flags&&(P.check=S(P.check,h,H,Z)),A-=H,Z+=H,J)break b}else P.head&&(P.head.name=null);P.length=0,P.mode=8;case 8:if(4096&P.flags){if(0===A)break b;H=0;do{J=h[Z+H++],P.head&&J&&P.length<65536&&(P.head.comment+=String.fromCharCode(J))}while(J&&H<A);if(512&P.flags&&(P.check=S(P.check,h,H,Z)),A-=H,Z+=H,J)break b}else P.head&&(P.head.comment=null);P.mode=9;case 9:if(512&P.flags){for(;T<16;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}if(K!==(65535&P.check)){b.OX="header crc mismatch",P.mode=n;break}K=0,T=0}P.head&&(P.head.hcrc=P.flags>>9&1,P.head.done=!0),b.adler=P.check=0,P.mode=W;break;case 10:for(;T<32;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}b.adler=P.check=y(K),K=0,T=0,P.mode=11;case 11:if(0===P.havedict)return b.next_out=v,b.avail_out=o,b.next_in=Z,b.avail_in=A,P.hold=K,P.bits=T,e;b.adler=P.check=1,P.mode=W;case W:if(X===u||X===w)break b;case 13:if(P.last){K>>>=7&T,T-=7&T,P.mode=27;break}for(;T<3;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}switch(P.last=1&K,K>>>=1,T-=1,3&K){case 0:P.mode=14;break;case 1:if(q(P),P.mode=20,X===w){K>>>=2,T-=2;break b}break;case 2:P.mode=17;break;case 3:b.OX="invalid block type",P.mode=n}K>>>=2,T-=2;break;case 14:for(K>>>=7&T,T-=7&T;T<32;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}if((65535&K)!==(K>>>16^65535)){b.OX="invalid stored block lengths",P.mode=n;break}if(P.length=65535&K,K=0,T=0,P.mode=15,X===w)break b;case 15:P.mode=16;case 16:if(H=P.length,H){if(H>A&&(H=A),H>o&&(H=o),0===H)break b;L.set(h.subarray(Z,Z+H),v),A-=H,Z+=H,o-=H,v+=H,P.length-=H;break}P.mode=W;break;case 17:for(;T<14;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}if(P.nlen=257+(31&K),K>>>=5,T-=5,P.ndist=1+(31&K),K>>>=5,T-=5,P.ncode=4+(15&K),K>>>=4,T-=4,P.nlen>286||P.ndist>30){b.OX="too many length or distance symbols",P.mode=n;break}P.have=0,P.mode=18;case 18:for(;P.have<P.ncode;){for(;T<3;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}P.lens[r[P.have++]]=7&K,K>>>=3,T-=3}for(;P.have<19;)P.lens[r[P.have++]]=0;if(P.lencode=P.lendyn,P.lenbits=7,M={bits:P.lenbits},c=N(0,P.lens,0,19,P.lencode,0,P.work,M),P.lenbits=M.bits,c){b.OX="invalid code lengths set",P.mode=n;break}P.have=0,P.mode=19;case 19:for(;P.have<P.nlen+P.ndist;){for(;s=P.lencode[K&(1<<P.lenbits)-1],k=s>>>24,z=s>>>16&255,U=65535&s,!(k<=T);){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}if(U<16)K>>>=k,T-=k,P.lens[P.have++]=U;else{if(16===U){for(R=k+2;T<R;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}if(K>>>=k,T-=k,0===P.have){b.OX="invalid bit length repeat",P.mode=n;break}J=P.lens[P.have-1],H=3+(3&K),K>>>=2,T-=2}else if(17===U){for(R=k+3;T<R;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}K>>>=k,T-=k,J=0,H=3+(7&K),K>>>=3,T-=3}else{for(R=k+7;T<R;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}K>>>=k,T-=k,J=0,H=11+(127&K),K>>>=7,T-=7}if(P.have+H>P.nlen+P.ndist){b.OX="invalid bit length repeat",P.mode=n;break}for(;H--;)P.lens[P.have++]=J}}if(P.mode===n)break;if(0===P.lens[256]){b.OX="invalid code -- missing end-of-block",P.mode=n;break}if(P.lenbits=9,M={bits:P.lenbits},c=N(1,P.lens,0,P.nlen,P.lencode,0,P.work,M),P.lenbits=M.bits,c){b.OX="invalid literal/lengths set",P.mode=n;break}if(P.distbits=6,P.distcode=P.distdyn,M={bits:P.distbits},c=N(2,P.lens,P.nlen,P.ndist,P.distcode,0,P.work,M),P.distbits=M.bits,c){b.OX="invalid distances set",P.mode=n;break}if(P.mode=20,X===w)break b;case 20:P.mode=21;case 21:if(A>=6&&o>=258){b.next_out=v,b.avail_out=o,b.next_in=Z,b.avail_in=A,P.hold=K,P.bits=T,d(b,x),v=b.next_out,L=b.output,o=b.avail_out,Z=b.next_in,h=b.input,A=b.avail_in,K=P.hold,T=P.bits,P.mode===W&&(P.back=-1);break}for(P.back=0;s=P.lencode[K&(1<<P.lenbits)-1],k=s>>>24,z=s>>>16&255,U=65535&s,!(k<=T);){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}if(z&&0===(240&z)){for(g=k,j=z,l=U;s=P.lencode[l+((K&(1<<g+j)-1)>>g)],k=s>>>24,z=s>>>16&255,U=65535&s,!(g+k<=T);){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}K>>>=g,T-=g,P.back+=g}if(K>>>=k,T-=k,P.back+=k,P.length=U,0===z){P.mode=26;break}if(32&z){P.back=-1,P.mode=W;break}if(64&z){b.OX="invalid literal/length code",P.mode=n;break}P.extra=15&z,P.mode=22;case 22:if(P.extra){for(R=P.extra;T<R;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}P.length+=K&(1<<P.extra)-1,K>>>=P.extra,T-=P.extra,P.back+=P.extra}P.was=P.length,P.mode=23;case 23:for(;s=P.distcode[K&(1<<P.distbits)-1],k=s>>>24,z=s>>>16&255,U=65535&s,!(k<=T);){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}if(0===(240&z)){for(g=k,j=z,l=U;s=P.distcode[l+((K&(1<<g+j)-1)>>g)],k=s>>>24,z=s>>>16&255,U=65535&s,!(g+k<=T);){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}K>>>=g,T-=g,P.back+=g}if(K>>>=k,T-=k,P.back+=k,64&z){b.OX="invalid distance code",P.mode=n;break}P.offset=U,P.extra=15&z,P.mode=24;case 24:if(P.extra){for(R=P.extra;T<R;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}P.offset+=K&(1<<P.extra)-1,K>>>=P.extra,T-=P.extra,P.back+=P.extra}if(P.offset>P.dmax){b.OX="invalid distance too far back",P.mode=n;break}P.mode=25;case 25:if(0===o)break b;if(H=x-o,P.offset>H){if(H=P.offset-H,H>P.whave&&P.sane){b.OX="invalid distance too far back",P.mode=n;break}H>P.wnext?(H-=P.wnext,C=P.wsize-H):C=P.wnext-H,H>P.length&&(H=P.length),p=P.window}else p=L,C=v-P.offset,H=P.length;H>o&&(H=o),o-=H,P.length-=H;do{L[v++]=p[C++]}while(--H);0===P.length&&(P.mode=21);break;case 26:if(0===o)break b;L[v++]=P.length,o--,P.mode=21;break;case 27:if(P.wrap){for(;T<32;){if(0===A)break b;A--,K|=h[Z++]<<T,T+=8}if(x-=o,b.total_out+=x,P.total+=x,x&&(b.adler=P.check=P.flags?S(P.check,L,x,v-x):Q(P.check,L,x,v-x)),x=o,(P.flags?K:y(K))!==P.check){b.OX="incorrect data check",P.mode=n;break}K=0,T=0}P.mode=28;case 28:if(P.wrap&&P.flags){for(;T<32;){if(0===A)break b;A--,K+=h[Z++]<<T,T+=8}if(K!==(4294967295&P.total)){b.OX="incorrect length check",P.mode=n;break}K=0,T=0}P.mode=29;case 29:c=O;break b;case n:c=D;break b;case 31:return E;default:return Y}return b.next_out=v,b.avail_out=o,b.next_in=Z,b.avail_in=A,P.hold=K,P.bits=T,(P.wsize||x!==b.avail_out&&P.mode<n&&(P.mode<27||X!==a))&&V(b,b.output,b.next_out,x-b.avail_out)?(P.mode=31,E):(i-=b.avail_in,x-=b.avail_out,b.total_in+=i,b.total_out+=x,P.total+=x,P.wrap&&x&&(b.adler=P.check=P.flags?S(P.check,L,x,b.next_out-x):Q(P.check,L,x,b.next_out-x)),b.data_type=P.bits+(P.last?64:0)+(P.mode===W?128:0)+(20===P.mode||15===P.mode?256:0),(0===i&&0===x||X===a)&&c===f&&(c=t),c)},b.exports.inflateEnd=b=>{if(!b||!b.state)return Y;let X=b.state;return X.window&&(X.window=null),b.state=null,f},b.exports.inflateGetHeader=(b,X)=>{if(!b||!b.state)return Y;const P=b.state;return 0===(2&P.wrap)?Y:(P.head=X,X.done=!1,f)},b.exports.inflateSetDictionary=(b,X)=>{const P=X.length;let S,d,N;return b&&b.state?(S=b.state,0!==S.wrap&&11!==S.mode?Y:11===S.mode&&(d=1,d=Q(d,X,P,0),d!==S.check)?D:(N=V(b,X,P,P),N?(S.mode=31,E):(S.havedict=1,f))):Y},b.exports.inflateInfo="pako inflate (from Nodeca project)"},13125:b=>{"use strict";const X=15,P=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Q=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),S=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),d=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);b.exports=(b,N,a,u,w,f,O,e)=>{const Y=e.bits;let D,E,t,B,W,n,y=0,h=0,L=0,Z=0,v=0,A=0,o=0,K=0,T=0,q=0,V=null,i=0;const x=new Uint16Array(16),H=new Uint16Array(16);let C,p,k,z=null,U=0;for(y=0;y<=X;y++)x[y]=0;for(h=0;h<u;h++)x[N[a+h]]++;for(v=Y,Z=X;Z>=1&&0===x[Z];Z--);if(v>Z&&(v=Z),0===Z)return w[f++]=20971520,w[f++]=20971520,e.bits=1,0;for(L=1;L<Z&&0===x[L];L++);for(v<L&&(v=L),K=1,y=1;y<=X;y++)if(K<<=1,K-=x[y],K<0)return-1;if(K>0&&(0===b||1!==Z))return-1;for(H[1]=0,y=1;y<X;y++)H[y+1]=H[y]+x[y];for(h=0;h<u;h++)0!==N[a+h]&&(O[H[N[a+h]]++]=h);if(0===b?(V=z=O,n=19):1===b?(V=P,i-=257,z=Q,U-=257,n=256):(V=S,z=d,n=-1),q=0,h=0,y=L,W=f,A=v,o=0,t=-1,T=1<<v,B=T-1,1===b&&T>852||2===b&&T>592)return 1;for(;;){C=y-o,O[h]<n?(p=0,k=O[h]):O[h]>n?(p=z[U+O[h]],k=V[i+O[h]]):(p=96,k=0),D=1<<y-o,E=1<<A,L=E;do{E-=D,w[W+(q>>o)+E]=C<<24|p<<16|k}while(0!==E);for(D=1<<y-1;q&D;)D>>=1;if(0!==D?(q&=D-1,q+=D):q=0,h++,0===--x[y]){if(y===Z)break;y=N[a+O[h]]}if(y>v&&(q&B)!==t){for(0===o&&(o=v),W+=L,A=y-o,K=1<<A;A+o<Z&&(K-=x[A+o],!(K<=0));)A++,K<<=1;if(T+=1<<A,1===b&&T>852||2===b&&T>592)return 1;t=q&B,w[t]=v<<24|A<<16|W-f}}return 0!==q&&(w[W+q]=y-o<<24|64<<16),e.bits=v,0}},13086:b=>{"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13070:b=>{"use strict";function X(b){let X=b.length;for(;--X>=0;)b[X]=0}const P=256,Q=286,S=30,d=15,N=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),u=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),w=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=new Array(576);X(f);const O=new Array(60);X(O);const e=new Array(512);X(e);const Y=new Array(256);X(Y);const D=new Array(29);X(D);const E=new Array(S);function t(b,X,P,Q,S){this.static_tree=b,this.extra_bits=X,this.extra_base=P,this.elems=Q,this.max_length=S,this.has_stree=b&&b.length}let B,W,n;function y(b,X){this.dyn_tree=b,this.max_code=0,this.stat_desc=X}X(E);const h=b=>b<256?e[b]:e[256+(b>>>7)],L=(b,X)=>{b.pending_buf[b.pending++]=255&X,b.pending_buf[b.pending++]=X>>>8&255},Z=(b,X,P)=>{b.bi_valid>16-P?(b.bi_buf|=X<<b.bi_valid&65535,L(b,b.bi_buf),b.bi_buf=X>>16-b.bi_valid,b.bi_valid+=P-16):(b.bi_buf|=X<<b.bi_valid&65535,b.bi_valid+=P)},v=(b,X,P)=>{Z(b,P[2*X],P[2*X+1])},A=(b,X)=>{let P=0;do{P|=1&b,b>>>=1,P<<=1}while(--X>0);return P>>>1},o=(b,X,P)=>{const Q=new Array(16);let S,N,a=0;for(S=1;S<=d;S++)Q[S]=a=a+P[S-1]<<1;for(N=0;N<=X;N++){let X=b[2*N+1];0!==X&&(b[2*N]=A(Q[X]++,X))}},K=b=>{let X;for(X=0;X<Q;X++)b.dyn_ltree[2*X]=0;for(X=0;X<S;X++)b.dyn_dtree[2*X]=0;for(X=0;X<19;X++)b.bl_tree[2*X]=0;b.dyn_ltree[512]=1,b.opt_len=b.static_len=0,b.last_lit=b.matches=0},T=b=>{b.bi_valid>8?L(b,b.bi_buf):b.bi_valid>0&&(b.pending_buf[b.pending++]=b.bi_buf),b.bi_buf=0,b.bi_valid=0},q=(b,X,P,Q)=>{const S=2*X,d=2*P;return b[S]<b[d]||b[S]===b[d]&&Q[X]<=Q[P]},V=(b,X,P)=>{const Q=b.heap[P];let S=P<<1;for(;S<=b.heap_len&&(S<b.heap_len&&q(X,b.heap[S+1],b.heap[S],b.depth)&&S++,!q(X,Q,b.heap[S],b.depth));)b.heap[P]=b.heap[S],P=S,S<<=1;b.heap[P]=Q},i=(b,X,Q)=>{let S,d,u,w,f=0;if(0!==b.last_lit)do{S=b.pending_buf[b.d_buf+2*f]<<8|b.pending_buf[b.d_buf+2*f+1],d=b.pending_buf[b.l_buf+f],f++,0===S?v(b,d,X):(u=Y[d],v(b,u+P+1,X),w=N[u],0!==w&&(d-=D[u],Z(b,d,w)),S--,u=h(S),v(b,u,Q),w=a[u],0!==w&&(S-=E[u],Z(b,S,w)))}while(f<b.last_lit);v(b,256,X)},x=(b,X)=>{const P=X.dyn_tree,Q=X.stat_desc.static_tree,S=X.stat_desc.has_stree,N=X.stat_desc.elems;let a,u,w,f=-1;for(b.heap_len=0,b.heap_max=573,a=0;a<N;a++)0!==P[2*a]?(b.heap[++b.heap_len]=f=a,b.depth[a]=0):P[2*a+1]=0;for(;b.heap_len<2;)w=b.heap[++b.heap_len]=f<2?++f:0,P[2*w]=1,b.depth[w]=0,b.opt_len--,S&&(b.static_len-=Q[2*w+1]);for(X.max_code=f,a=b.heap_len>>1;a>=1;a--)V(b,P,a);w=N;do{a=b.heap[1],b.heap[1]=b.heap[b.heap_len--],V(b,P,1),u=b.heap[1],b.heap[--b.heap_max]=a,b.heap[--b.heap_max]=u,P[2*w]=P[2*a]+P[2*u],b.depth[w]=(b.depth[a]>=b.depth[u]?b.depth[a]:b.depth[u])+1,P[2*a+1]=P[2*u+1]=w,b.heap[1]=w++,V(b,P,1)}while(b.heap_len>=2);b.heap[--b.heap_max]=b.heap[1],((b,X)=>{const P=X.dyn_tree,Q=X.max_code,S=X.stat_desc.static_tree,N=X.stat_desc.has_stree,a=X.stat_desc.extra_bits,u=X.stat_desc.extra_base,w=X.stat_desc.max_length;let f,O,e,Y,D,E,t=0;for(Y=0;Y<=d;Y++)b.bl_count[Y]=0;for(P[2*b.heap[b.heap_max]+1]=0,f=b.heap_max+1;f<573;f++)O=b.heap[f],Y=P[2*P[2*O+1]+1]+1,Y>w&&(Y=w,t++),P[2*O+1]=Y,O>Q||(b.bl_count[Y]++,D=0,O>=u&&(D=a[O-u]),E=P[2*O],b.opt_len+=E*(Y+D),N&&(b.static_len+=E*(S[2*O+1]+D)));if(0!==t){do{for(Y=w-1;0===b.bl_count[Y];)Y--;b.bl_count[Y]--,b.bl_count[Y+1]+=2,b.bl_count[w]--,t-=2}while(t>0);for(Y=w;0!==Y;Y--)for(O=b.bl_count[Y];0!==O;)e=b.heap[--f],e>Q||(P[2*e+1]!==Y&&(b.opt_len+=(Y-P[2*e+1])*P[2*e],P[2*e+1]=Y),O--)}})(b,X),o(P,f,b.bl_count)},H=(b,X,P)=>{let Q,S,d=-1,N=X[1],a=0,u=7,w=4;for(0===N&&(u=138,w=3),X[2*(P+1)+1]=65535,Q=0;Q<=P;Q++)S=N,N=X[2*(Q+1)+1],++a<u&&S===N||(a<w?b.bl_tree[2*S]+=a:0!==S?(S!==d&&b.bl_tree[2*S]++,b.bl_tree[32]++):a<=10?b.bl_tree[34]++:b.bl_tree[36]++,a=0,d=S,0===N?(u=138,w=3):S===N?(u=6,w=3):(u=7,w=4))},C=(b,X,P)=>{let Q,S,d=-1,N=X[1],a=0,u=7,w=4;for(0===N&&(u=138,w=3),Q=0;Q<=P;Q++)if(S=N,N=X[2*(Q+1)+1],!(++a<u&&S===N)){if(a<w)do{v(b,S,b.bl_tree)}while(0!==--a);else 0!==S?(S!==d&&(v(b,S,b.bl_tree),a--),v(b,16,b.bl_tree),Z(b,a-3,2)):a<=10?(v(b,17,b.bl_tree),Z(b,a-3,3)):(v(b,18,b.bl_tree),Z(b,a-11,7));a=0,d=S,0===N?(u=138,w=3):S===N?(u=6,w=3):(u=7,w=4)}};let p=!1;const k=(b,X,P,Q)=>{Z(b,0+(Q?1:0),3),((b,X,P,Q)=>{T(b),Q&&(L(b,P),L(b,~P)),b.pending_buf.set(b.window.subarray(X,X+P),b.pending),b.pending+=P})(b,X,P,!0)};b.exports._tr_init=b=>{p||((()=>{let b,X,P,w,y;const h=new Array(16);for(P=0,w=0;w<28;w++)for(D[w]=P,b=0;b<1<<N[w];b++)Y[P++]=w;for(Y[P-1]=w,y=0,w=0;w<16;w++)for(E[w]=y,b=0;b<1<<a[w];b++)e[y++]=w;for(y>>=7;w<S;w++)for(E[w]=y<<7,b=0;b<1<<a[w]-7;b++)e[256+y++]=w;for(X=0;X<=d;X++)h[X]=0;for(b=0;b<=143;)f[2*b+1]=8,b++,h[8]++;for(;b<=255;)f[2*b+1]=9,b++,h[9]++;for(;b<=279;)f[2*b+1]=7,b++,h[7]++;for(;b<=287;)f[2*b+1]=8,b++,h[8]++;for(o(f,287,h),b=0;b<S;b++)O[2*b+1]=5,O[2*b]=A(b,5);B=new t(f,N,257,Q,d),W=new t(O,a,0,S,d),n=new t(new Array(0),u,0,19,7)})(),p=!0),b.l_desc=new y(b.dyn_ltree,B),b.d_desc=new y(b.dyn_dtree,W),b.bl_desc=new y(b.bl_tree,n),b.bi_buf=0,b.bi_valid=0,K(b)},b.exports._tr_stored_block=k,b.exports._tr_flush_block=(b,X,Q,S)=>{let d,N,a=0;b.level>0?(2===b.strm.data_type&&(b.strm.data_type=(b=>{let X,Q=4093624447;for(X=0;X<=31;X++,Q>>>=1)if(1&Q&&0!==b.dyn_ltree[2*X])return 0;if(0!==b.dyn_ltree[18]||0!==b.dyn_ltree[20]||0!==b.dyn_ltree[26])return 1;for(X=32;X<P;X++)if(0!==b.dyn_ltree[2*X])return 1;return 0})(b)),x(b,b.l_desc),x(b,b.d_desc),a=(b=>{let X;for(H(b,b.dyn_ltree,b.l_desc.max_code),H(b,b.dyn_dtree,b.d_desc.max_code),x(b,b.bl_desc),X=18;X>=3&&0===b.bl_tree[2*w[X]+1];X--);return b.opt_len+=3*(X+1)+5+5+4,X})(b),d=b.opt_len+3+7>>>3,N=b.static_len+3+7>>>3,N<=d&&(d=N)):d=N=Q+5,Q+4<=d&&-1!==X?k(b,X,Q,S):4===b.strategy||N===d?(Z(b,2+(S?1:0),3),i(b,f,O)):(Z(b,4+(S?1:0),3),((b,X,P,Q)=>{let S;for(Z(b,X-257,5),Z(b,P-1,5),Z(b,Q-4,4),S=0;S<Q;S++)Z(b,b.bl_tree[2*w[S]+1],3);C(b,b.dyn_ltree,X-1),C(b,b.dyn_dtree,P-1)})(b,b.l_desc.max_code+1,b.d_desc.max_code+1,a+1),i(b,b.dyn_ltree,b.dyn_dtree)),K(b),S&&T(b)},b.exports._tr_tally=(b,X,Q)=>(b.pending_buf[b.d_buf+2*b.last_lit]=X>>>8&255,b.pending_buf[b.d_buf+2*b.last_lit+1]=255&X,b.pending_buf[b.l_buf+b.last_lit]=255&Q,b.last_lit++,0===X?b.dyn_ltree[2*Q]++:(b.matches++,X--,b.dyn_ltree[2*(Y[Q]+P+1)]++,b.dyn_dtree[2*h(X)]++),b.last_lit===b.lit_bufsize-1),b.exports._tr_align=b=>{Z(b,2,3),v(b,256,f),(b=>{16===b.bi_valid?(L(b,b.bi_buf),b.bi_buf=0,b.bi_valid=0):b.bi_valid>=8&&(b.pending_buf[b.pending++]=255&b.bi_buf,b.bi_buf>>=8,b.bi_valid-=8)})(b)}},13105:b=>{"use strict";b.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.OX="",this.state=null,this.data_type=2,this.adler=0}},12687:b=>{function X(b,X,P){for(var Q=b.length,S=-1/0,d=1/0,N=0;N<Q;N++){var a=(P[0][N]-b[N])/X[N],u=(P[1][N]-b[N])/X[N];if(a>u){var w=a;a=u,u=w}if(u<S||a>d)return 1/0;a>S&&(S=a),u<d&&(d=u)}return S>d?1/0:S}b.exports=function(b,P,Q,S){var d=X(P,Q,S);if(d===1/0)b=null;else{b=b||[];for(var N=0;N<P.length;N++)b[N]=P[N]+Q[N]*d}return b},b.exports.distance=X},14106:(b,X,P)=>{"use strict";P.d(X,{b:()=>N});var Q=P(28);const S=Q.useLayoutEffect;const d=function(b){var X=(0,Q.useRef)(b);return S((function(){X.current=b})),X};var N=function(b){var X=d(b);(0,Q.uX)((function(){var b=function(b){var P;if(null!=X.current&&(P=X.current(b)),b.defaultPrevented&&(b.returnValue=""),"string"===typeof P)return b.returnValue=P,P};return window.addEventListener("beforeunload",b),function(){window.removeEventListener("beforeunload",b)}}),[])}},14067:(b,X,P)=>{"use strict";var Q=P(14069),S=Array.prototype.concat,d=Array.prototype.slice,N=b.exports=function(b){for(var X=[],P=0,N=b.length;P<N;P++){var a=b[P];Q(a)?X=S.call(X,d.call(a)):X.push(a)}return X};N.wrap=function(b){return function(){return b(N(arguments))}}},14069:b=>{b.exports=function(b){return!(!b||"string"===typeof b)&&(b instanceof Array||Array.isArray(b)||b.length>=0&&(b.splice instanceof Function||Object.getOwnPropertyDescriptor(b,b.length-1)&&"String"!==b.constructor.name))}},13011:(b,X,P)=>{var Q=P(13013);function S(b){for(var X,P,S=0,d=b.length,N=0;N<b.length;){for(X=b[N],P=0;N<d&&b[N]===X;)++N,++P;S+=Q.log2(P)/7|0,S+=Q.log2(X>>>0)/7|0,S+=2}return S}X.size=S,X.encode=function(b,X){X||(X=new Uint8Array(S(b)));for(var P,Q,d=0,N=X.length,a=0;a<b.length;){for(P=b[a],Q=0;a<b.length&&b[a]===P;)++a,++Q;for(;d<N&&Q>=128;)X[d++]=128+(127&Q),Q>>>=7;if(d>=N)throw new Error("RLE buffer overflow");for(X[d++]=Q,P>>>=0;d<N&&P>=128;)X[d++]=128+(127&P),P>>>=7;if(d>=N)throw new Error("RLE buffer overflow");X[d++]=P}return X},X.decode=function(b,X){for(var P,Q,S,d,N=X.length,a=b.length,u=0,w=0;w<a;){for(P=0,Q=0;w<a&&b[w]>=128;)P+=(127&b[w++])<<Q,Q+=7;if(P+=b[w++]<<Q,w>=a)throw new Error("RLE buffer underrun");if(u+P>N)throw new Error("Chunk buffer overflow");for(S=0,Q=0;w<a&&b[w]>=128;)S+=(127&b[w++])<<Q,Q+=7;if(w>=a)throw new Error("RLE buffer underrun");for(S+=b[w++]<<Q,d=0;d<P;++d)X[u++]=S}return X}},13013:(b,X)=>{"use strict";function P(b){var X=32;return(b&=-b)&&X--,65535&b&&(X-=16),16711935&b&&(X-=8),252645135&b&&(X-=4),858993459&b&&(X-=2),1431655765&b&&(X-=1),X}X.INT_BITS=32,X.INT_MAX=2147483647,X.INT_MIN=-1<<31,X.sign=function(b){return(b>0)-(b<0)},X.abs=function(b){var X=b>>31;return(b^X)-X},X.min=function(b,X){return X^(b^X)&-(b<X)},X.max=function(b,X){return b^(b^X)&-(b<X)},X.isPow2=function(b){return!(b&b-1)&&!!b},X.log2=function(b){var X,P;return X=(b>65535)<<4,X|=P=((b>>>=X)>255)<<3,X|=P=((b>>>=P)>15)<<2,(X|=P=((b>>>=P)>3)<<1)|(b>>>=P)>>1},X.log10=function(b){return b>=1e9?9:b>=1e8?8:b>=1e7?7:b>=1e6?6:b>=1e5?5:b>=1e4?4:b>=1e3?3:b>=100?2:b>=10?1:0},X.popCount=function(b){return 16843009*((b=(858993459&(b-=b>>>1&1431655765))+(b>>>2&858993459))+(b>>>4)&252645135)>>>24},X.countTrailingZeros=P,X.nextPow2=function(b){return b+=0===b,--b,b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,(b|=b>>>16)+1},X.prevPow2=function(b){return b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,(b|=b>>>16)-(b>>>1)},X.parity=function(b){return b^=b>>>16,b^=b>>>8,b^=b>>>4,27030>>>(b&=15)&1};var Q=new Array(256);!function(b){for(var X=0;X<256;++X){var P=X,Q=X,S=7;for(P>>>=1;P;P>>>=1)Q<<=1,Q|=1&P,--S;b[X]=Q<<S&255}}(Q),X.reverse=function(b){return Q[255&b]<<24|Q[b>>>8&255]<<16|Q[b>>>16&255]<<8|Q[b>>>24&255]},X.interleave2=function(b,X){return(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))|(X=1431655765&((X=858993459&((X=252645135&((X=16711935&((X&=65535)|X<<8))|X<<4))|X<<2))|X<<1))<<1},X.deinterleave2=function(b,X){return(b=65535&((b=16711935&((b=252645135&((b=858993459&((b=b>>>X&1431655765)|b>>>1))|b>>>2))|b>>>4))|b>>>16))<<16>>16},X.interleave3=function(b,X,P){return b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2),(b|=(X=1227133513&((X=3272356035&((X=251719695&((X=4278190335&((X&=1023)|X<<16))|X<<8))|X<<4))|X<<2))<<1)|(P=1227133513&((P=3272356035&((P=251719695&((P=4278190335&((P&=1023)|P<<16))|P<<8))|P<<4))|P<<2))<<2},X.deinterleave3=function(b,X){return(b=1023&((b=4278190335&((b=251719695&((b=3272356035&((b=b>>>X&1227133513)|b>>>2))|b>>>4))|b>>>8))|b>>>16))<<22>>22},X.nextCombination=function(b){var X=b|b-1;return X+1|(~X&-~X)-1>>>P(b)+1}},13046:b=>{"use strict";b.exports=function(b,X,P,Q){var S=self||window;try{try{var d;try{d=new S.Blob([b])}catch(w){(d=new(S.BlobBuilder||S.WebKitBlobBuilder||S.MozBlobBuilder||S.MSBlobBuilder)).append(b),d=d.getBlob()}var N=S.URL||S.webkitURL,a=N.createObjectURL(d),u=new S[X](a,P);return N.revokeObjectURL(a),u}catch(w){return new S[X]("data:application/javascript,".concat(encodeURIComponent(b)),P)}}catch(w){if(!Q)throw Error("Inline worker is not supported");return new S[X](Q,P)}}},12668:(b,X,P)=>{"use strict";function Q(b,X,P,Q,S){var d={};return Object.keys(Q).forEach((function(b){d[b]=Q[b]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=P.slice().reverse().reduce((function(P,Q){return Q(b,X,P)||P}),d),S&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(S):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(b,X,d),d=null),d}P.d(X,{b:()=>Q})},12661:(b,X,P)=>{"use strict";function Q(b,X,P,Q){P&&Object.defineProperty(b,X,{enumerable:P.enumerable,configurable:P.configurable,writable:P.writable,value:P.initializer?P.initializer.call(Q):void 0})}P.d(X,{d:()=>Q})},14094:(b,X,P)=>{"use strict";P.d(X,{d:()=>N,h:()=>O,i:()=>a,l:()=>d,m:()=>u,o:()=>S,q:()=>w,u:()=>f});var Q=P(12057);class S{constructor(){this._easingMode=S.EASINGMODE_EASEIN}setEasingMode(b){const X=Math.min(Math.max(b,0),2);this._easingMode=X}getEasingMode(){return this._easingMode}easeInCore(b){throw new Error("You must implement this method")}ease(b){switch(this._easingMode){case S.EASINGMODE_EASEIN:return this.easeInCore(b);case S.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-b)}return b>=.5?.5*(1-this.easeInCore(2*(1-b)))+.5:.5*this.easeInCore(2*b)}}S.EASINGMODE_EASEIN=0,S.EASINGMODE_EASEOUT=1,S.EASINGMODE_EASEINOUT=2;class d extends S{easeInCore(b){return b=Math.max(0,Math.min(1,b)),1-Math.sqrt(1-b*b)}}class N extends S{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=b}easeInCore(b){const X=Math.max(0,this.amplitude);return Math.pow(b,3)-b*X*Math.sin(3.141592653589793*b)}}class a extends S{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=b,this.bounciness=X}easeInCore(b){const X=Math.max(0,this.bounces);let P=this.bounciness;P<=1&&(P=1.001);const Q=Math.pow(P,X),S=1-P,d=(1-Q)/S+.5*Q,N=b*d,a=Math.log(-N*(1-P)+1)/Math.log(P),u=Math.floor(a),w=u+1,f=(1-Math.pow(P,u))/(S*d),O=.5*(f+(1-Math.pow(P,w))/(S*d)),e=b-O,Y=O-f;return-Math.pow(1/P,X-u)/(Y*Y)*(e-Y)*(e+Y)}}class u extends S{easeInCore(b){return b*b*b}}class w extends S{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=b,this.springiness=X}easeInCore(b){let X;const P=Math.max(0,this.oscillations),Q=Math.max(0,this.springiness);return X=0==Q?b:(Math.exp(Q*b)-1)/(Math.exp(Q)-1),X*Math.sin((6.283185307179586*P+1.5707963267948966)*b)}}class f extends S{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=b}easeInCore(b){return this.exponent<=0?b:(Math.exp(this.exponent*b)-1)/(Math.exp(this.exponent)-1)}}class O extends S{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=b,this.y1=X,this.x2=P,this.y2=Q}easeInCore(b){return Q.b.Interpolate(b,this.x1,this.y1,this.x2,this.y2)}}},13555:(b,X,P)=>{"use strict";P.d(X,{d:()=>N});var Q=P(11834),S=P(11841),d=P(12281);class N extends d.c{get _matrix(){return this._compose(),this.re}set _matrix(b){(b.updateFlag!==this.re.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.re.N(b),this._markAsDirtyAndDecompose())}constructor(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(b,X.Ab(),!1),this.name=b,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=X,this.re=(null===S||void 0===S?void 0:S.clone())??Q.Matrix.Identity(),this._restMatrix=d??this.re.clone(),this._bindMatrix=N??this.re.clone(),this._index=a,this._absoluteMatrix=new Q.Matrix,this._absoluteBindMatrix=new Q.Matrix,this._absoluteInverseBindMatrix=new Q.Matrix,this._finalMatrix=new Q.Matrix,X.bones.push(this),this.setParent(P,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(b){this.setParent(b)}setParent(b){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==b){if(this.parent){const b=this.parent.children.indexOf(this);-1!==b&&this.parent.children.splice(b,1)}this._parentNode=b,this.parent&&this.parent.children.push(this),X&&this._updateAbsoluteBindMatrices(),this.pw()}}getLocalMatrix(){return this._compose(),this.re}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(b){this._restMatrix.N(b)}setRestPose(b){this.setRestMatrix(b)}getBindPose(){return this.getBindMatrix()}setBindMatrix(b){this.Cd(b)}setBindPose(b){this.setBindMatrix(b)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const b=Q.TmpVectors.tX[0],X=Q.TmpVectors.Quaternion[0],P=Q.TmpVectors.tX[1];this.getRestMatrix().decompose(b,X,P),this._linkedTransformNode.position.N(P),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??Q.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.N(X),this._linkedTransformNode.Fd.N(b)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(b){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=b,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.ga}set position(b){this._decompose(),this.ga.N(b),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(b){this.setRotation(b)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(b){this.setRotationQuaternion(b)}get Fd(){return this.getScale()}set Fd(b){this.setScale(b)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=Q.tX.Zero(),this._localRotation=Q.Quaternion.Zero(),this.ga=Q.tX.Zero()),this.re.decompose(this._localScaling,this._localRotation,this.ga))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,Q.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.ga,this.re)):this._needToCompose=!1)}Cd(b){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.N(b),X&&this._updateAbsoluteBindMatrices(),P?this._matrix=b:this.pw()}_updateAbsoluteBindMatrices(b){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(b||(b=this._bindMatrix),this.parent?b.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.N(b),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),X)for(let P=0;P<this.children.length;P++)this.children[P]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}pw(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.pw(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.pw(),this._needToDecompose=!0}_updatePosition(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const d=this.getLocalMatrix();if(0==X)S?(d.addAtIndex(12,b.x),d.addAtIndex(13,b.y),d.addAtIndex(14,b.z)):d.setTranslationFromFloats(b.x,b.y,b.z);else{let X=null;P&&(X=P.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const a=N._TmpMats[0],u=N._TmpVecs[0];this.parent?P&&X?(a.N(this.parent.getAbsoluteMatrix()),a.multiplyToRef(X,a)):a.N(this.parent.getAbsoluteMatrix()):Q.Matrix.IdentityToRef(a),S&&a.setTranslationFromFloats(0,0,0),a.invert(),Q.tX.TransformCoordinatesToRef(b,a,u),S?(d.addAtIndex(12,u.x),d.addAtIndex(13,u.y),d.addAtIndex(14,u.z)):d.setTranslationFromFloats(u.x,u.y,u.z)}this._markAsDirtyAndDecompose()}translate(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;this._updatePosition(b,X,P,!0)}setPosition(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;this._updatePosition(b,X,P,!1)}setAbsolutePosition(b,X){this.setPosition(b,1,X)}scale(b,X,P){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=this.getLocalMatrix(),a=N._TmpMats[0];Q.Matrix.ScalingToRef(b,X,P,a),a.multiplyToRef(d,d),a.invert();for(const Q of this.children){const S=Q.getLocalMatrix();S.multiplyToRef(a,S),S.multiplyAtIndex(12,b),S.multiplyAtIndex(13,X),S.multiplyAtIndex(14,P),Q._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),S)for(const Q of this.children)Q.scale(b,X,P,S)}setScale(b){this._decompose(),this._localScaling.N(b),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(b){this._decompose(),b.N(this._localScaling)}setYawPitchRoll(b,X,P){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4?arguments[4]:void 0;if(0===S){const a=N._TmpQuat;return Q.Quaternion.RotationYawPitchRollToRef(b,X,P,a),void this.setRotationQuaternion(a,S,d)}const a=N._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,d))return;const u=N._TmpMats[1];Q.Matrix.RotationYawPitchRollToRef(b,X,P,u),a.multiplyToRef(u,u),this._rotateWithMatrix(u,S,d)}rotate(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3?arguments[3]:void 0;const d=N._TmpMats[0];d.setTranslationFromFloats(0,0,0),Q.Matrix.RotationAxisToRef(b,X,d),this._rotateWithMatrix(d,P,S)}setAxisAngle(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3?arguments[3]:void 0;if(0===P){const d=N._TmpQuat;return Q.Quaternion.RotationAxisToRef(b,X,d),void this.setRotationQuaternion(d,P,S)}const d=N._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(d,S))return;const a=N._TmpMats[1];Q.Matrix.RotationAxisToRef(b,X,a),d.multiplyToRef(a,a),this._rotateWithMatrix(a,P,S)}setRotation(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(b.y,b.x,b.z,X,P)}setRotationQuaternion(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;if(0===X)return this._decompose(),this._localRotation.N(b),void this._markAsDirtyAndCompose();const S=N._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(S,P))return;const d=N._TmpMats[1];Q.Matrix.FromQuaternionToRef(b,d),S.multiplyToRef(d,d),this._rotateWithMatrix(d,X,P)}setRotationMatrix(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;if(0===X){const S=N._TmpQuat;return Q.Quaternion.FromRotationMatrixToRef(b,S),void this.setRotationQuaternion(S,X,P)}const S=N._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(S,P))return;const d=N._TmpMats[1];d.N(b),S.multiplyToRef(b,d),this._rotateWithMatrix(d,X,P)}_rotateWithMatrix(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;const Q=this.getLocalMatrix(),S=Q.m[12],d=Q.m[13],a=Q.m[14],u=this.getParent(),w=N._TmpMats[3],f=N._TmpMats[4];u&&1==X?(P?(w.N(P.getWorldMatrix()),u.getAbsoluteMatrix().multiplyToRef(w,w)):w.N(u.getAbsoluteMatrix()),f.N(w),f.invert(),Q.multiplyToRef(w,Q),Q.multiplyToRef(b,Q),Q.multiplyToRef(f,Q)):1==X&&P?(w.N(P.getWorldMatrix()),f.N(w),f.invert(),Q.multiplyToRef(w,Q),Q.multiplyToRef(b,Q),Q.multiplyToRef(f,Q)):Q.multiplyToRef(b,Q),Q.setTranslationFromFloats(S,d,a),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(b,X){const P=N._TmpMats[2];return b.N(this.getAbsoluteMatrix()),X?(b.multiplyToRef(X.getWorldMatrix(),b),Q.Matrix.ScalingToRef(X.Fd.x,X.Fd.y,X.Fd.z,P)):Q.Matrix.IdentityToRef(P),b.invert(),!isNaN(b.m[0])&&(P.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyToRef(P,b),!0)}bd(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=Q.tX.Zero();return this.getPositionToRef(b,X,P),P}getPositionToRef(){let b=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const b=this.getLocalMatrix();X.x=b.m[12],X.y=b.m[13],X.z=b.m[14]}else{let P=null;b&&(P=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let Q=N._TmpMats[0];b&&P?(Q.N(this.getAbsoluteMatrix()),Q.multiplyToRef(P,Q)):Q=this.getAbsoluteMatrix(),X.x=Q.m[12],X.y=Q.m[13],X.z=Q.m[14]}}getAbsolutePosition(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const X=Q.tX.Zero();return this.getPositionToRef(1,b,X),X}getAbsolutePositionToRef(b,X){this.getPositionToRef(1,b,X)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.re.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.N(this.re);const b=this._skeleton.getPoseMatrix();b&&this._absoluteMatrix.multiplyToRef(b,this._absoluteMatrix)}const b=this.children,X=b.length;for(let P=0;P<X;P++)b[P].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Du(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=Q.tX.Zero();return this.getDirectionToRef(b,X,P),P}getDirectionToRef(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0,S=null;X&&(S=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=N._TmpMats[0];d.N(this.getAbsoluteMatrix()),X&&S&&d.multiplyToRef(S,d),Q.tX.TransformNormalToRef(b,d,P),P.normalize()}getRotation(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=Q.tX.Zero();return this.getRotationToRef(b,X,P),P}getRotationToRef(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0;const Q=N._TmpQuat;this.getRotationQuaternionToRef(b,X,Q),Q.toEulerAnglesToRef(P)}getRotationQuaternion(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=Q.Quaternion.Identity();return this.getRotationQuaternionToRef(b,X,P),P}getRotationQuaternionToRef(){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),X.N(this._localRotation);else{const P=N._TmpMats[0],Q=this.getAbsoluteMatrix();b?Q.multiplyToRef(b.getWorldMatrix(),P):P.N(Q),P.multiplyAtIndex(0,this._scalingDeterminant),P.multiplyAtIndex(1,this._scalingDeterminant),P.multiplyAtIndex(2,this._scalingDeterminant),P.decompose(void 0,X,void 0)}}getRotationMatrix(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1?arguments[1]:void 0;const P=Q.Matrix.Identity();return this.getRotationMatrixToRef(b,X,P),P}getRotationMatrixToRef(){let b=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(X);else{const P=N._TmpMats[0],Q=this.getAbsoluteMatrix();b?Q.multiplyToRef(b.getWorldMatrix(),P):P.N(Q),P.multiplyAtIndex(0,this._scalingDeterminant),P.multiplyAtIndex(1,this._scalingDeterminant),P.multiplyAtIndex(2,this._scalingDeterminant),P.getRotationMatrixToRef(X)}}getAbsolutePositionFromLocal(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=Q.tX.Zero();return this.getAbsolutePositionFromLocalToRef(b,X,P),P}getAbsolutePositionFromLocalToRef(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0,S=null;X&&(S=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=N._TmpMats[0];d.N(this.getAbsoluteMatrix()),X&&S&&d.multiplyToRef(S,d),Q.tX.TransformCoordinatesToRef(b,d,P)}getLocalPositionFromAbsolute(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=Q.tX.Zero();return this.getLocalPositionFromAbsoluteToRef(b,X,P),P}getLocalPositionFromAbsoluteToRef(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0,S=null;X&&(S=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=N._TmpMats[0];d.N(this.getAbsoluteMatrix()),X&&S&&d.multiplyToRef(S,d),d.invert(),Q.tX.TransformCoordinatesToRef(b,d,P)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const b=this._skeleton.bones.indexOf(this);if(-1!==b&&this._skeleton.bones.splice(b,1),this._parentNode&&this._parentNode.children){const b=this._parentNode.children,X=b.indexOf(this);-1!==X&&b.splice(X,1)}super.dispose()}}N._TmpVecs=(0,S.b)(2,Q.tX.Zero),N._TmpQuat=Q.Quaternion.Identity(),N._TmpMats=(0,S.b)(5,Q.Matrix.Identity)},14087:(b,X,P)=>{"use strict";P.d(X,{d:()=>x});var Q=P(11822),S=P(11825),d=P(11694),N=P(11834),a=P(11844),u=P(12281),w=P(12319),f=P(12142),O=P(11713),e=P(11836);class Y{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(b){this._zoomStopsAnimation=b}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(b){this._idleRotationSpeed=b}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(b){this._idleRotationWaitTime=b}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(b){this._idleRotationSpinupTime=b}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(b){this._attachedCamera=b;const X=this._attachedCamera.Ab();this._onPrePointerObservableObserver=X.onPrePointerObservable.add((b=>{b.type!==f.d.POINTERDOWN?b.type===f.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=b.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const b=O.e.Now;let X=0;null!=this._lastFrameTime&&(X=b-this._lastFrameTime),this._lastFrameTime=b,this._applyUserInteraction();const P=b-this._lastInteractionTime-this._idleRotationWaitTime,Q=Math.max(Math.min(P/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*Q,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(X/1e3))}))}detach(){if(!this._attachedCamera)return;const b=this._attachedCamera.Ab();this._onPrePointerObservableObserver&&b.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(b){this._lastInteractionTime=b??O.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<e.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let b=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(b=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?b:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=O.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var D=P(14094),E=P(12386);class t{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(b){if(this._autoTransitionRange===b)return;this._autoTransitionRange=b;const X=this._attachedCamera;X&&(b?this._onMeshTargetChangedObserver=X.onMeshTargetChangedObservable.add((b=>{if(b&&(b.pd(!0),b.getBoundingInfo)){const X=b.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*X,this.upperRadiusTransitionRange=.05*X}})):this._onMeshTargetChangedObserver&&X.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(b){this._attachedCamera=b,this._onAfterCheckInputsObserver=b.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(b){return!!this._attachedCamera&&(this._attachedCamera.radius===b&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(b){if(!this._attachedCamera)return;this._radiusBounceTransition||(t.EasingFunction.setEasingMode(t.EasingMode),this._radiusBounceTransition=E.c.CreateAnimation("radius",E.c.ANIMATIONTYPE_FLOAT,60,t.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const X=E.c.TransitionTo("radius",this._attachedCamera.radius+b,this._attachedCamera,this._attachedCamera.Ab(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));X&&this._animatables.push(X)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}t.EasingFunction=new D.d(.3),t.EasingMode=D.o.EASINGMODE_EASEOUT;class B{constructor(){this.onTargetFramingAnimationEndObservable=new d.d,this._mode=B.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(b){this._mode=b}get mode(){return this._mode}set radiusScale(b){this._radiusScale=b}get radiusScale(){return this._radiusScale}set positionScale(b){this._positionScale=b}get positionScale(){return this._positionScale}set defaultElevation(b){this._defaultElevation=b}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(b){this._elevationReturnTime=b}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(b){this._elevationReturnWaitTime=b}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(b){this._zoomStopsAnimation=b}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(b){this._framingTime=b}get framingTime(){return this._framingTime}init(){}attach(b){this._attachedCamera=b;const X=this._attachedCamera.Ab();B.EasingFunction.setEasingMode(B.EasingMode),this._onPrePointerObservableObserver=X.onPrePointerObservable.add((b=>{b.type!==f.d.POINTERDOWN?b.type===f.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=b.onMeshTargetChangedObservable.add((b=>{b&&b.getBoundingInfo&&this.zoomOnMesh(b,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=b.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const b=this._attachedCamera.Ab();this._onPrePointerObservableObserver&&b.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b.pd(!0);const Q=b.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(Q.minimumWorld,Q.maximumWorld,X,P)}zoomOnMeshHierarchy(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b.pd(!0);const Q=b.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(Q.min,Q.max,X,P)}zoomOnMeshesHierarchy(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new N.tX(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S=new N.tX(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let d=0;d<b.length;d++){const X=b[d].getHierarchyBoundingVectors(!0);N.tX.CheckExtends(X.min,Q,S),N.tX.CheckExtends(X.max,Q,S)}this.zoomOnBoundingInfo(Q,S,X,P)}zoomOnBoundingInfo(b,X){let P,Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const d=b.y,a=d+(X.y-d)*this._positionScale,u=X.BX(b).scale(.5);if(!isFinite(a))return!1;if(Q)P=new N.tX(0,a,0);else{const X=b.add(u);P=new N.tX(X.x,a,X.z)}this._vectorTransition||(this._vectorTransition=E.c.CreateAnimation("target",E.c.ANIMATIONTYPE_VECTOR3,60,B.EasingFunction)),this._betaIsAnimating=!0;let w=E.c.TransitionTo("target",P,this._attachedCamera,this._attachedCamera.Ab(),60,this._vectorTransition,this._framingTime);w&&this._animatables.push(w);let f=0;if(this._mode===B.FitFrustumSidesMode){const P=this._calculateLowerRadiusFromModelBoundingSphere(b,X);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=u.length()+this._attachedCamera.Vd),f=P}else this._mode===B.IgnoreBoundsSizeMode&&(f=this._calculateLowerRadiusFromModelBoundingSphere(b,X),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Vd));if(this.autoCorrectCameraLimitsAndSensibility){const P=X.BX(b).length();this._attachedCamera.panningSensibility=5e3/P,this._attachedCamera.wheelPrecision=100/f}return this._radiusTransition||(this._radiusTransition=E.c.CreateAnimation("radius",E.c.ANIMATIONTYPE_FLOAT,60,B.EasingFunction)),w=E.c.TransitionTo("radius",f,this._attachedCamera,this._attachedCamera.Ab(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),S&&S(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),w&&this._animatables.push(w),!0}_calculateLowerRadiusFromModelBoundingSphere(b,X){const P=this._attachedCamera;if(!P)return 0;let Q=P._calculateLowerRadiusFromModelBoundingSphere(b,X,this._radiusScale);return P.lowerRadiusLimit&&this._mode===B.IgnoreBoundsSizeMode&&(Q=Q<P.lowerRadiusLimit?P.lowerRadiusLimit:Q),P.upperRadiusLimit&&(Q=Q>P.upperRadiusLimit?P.upperRadiusLimit:Q),Q}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const b=O.e.Now-this._lastInteractionTime,X=.5*Math.PI-this._defaultElevation,P=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>P&&b>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=E.c.CreateAnimation("beta",E.c.ANIMATIONTYPE_FLOAT,60,B.EasingFunction));const b=E.c.TransitionTo("beta",X,this._attachedCamera,this._attachedCamera.Ab(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));b&&this._animatables.push(b)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=O.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}B.EasingFunction=new D.u,B.EasingMode=D.o.EASINGMODE_EASEINOUT,B.IgnoreBoundsSizeMode=0,B.FitFrustumSidesMode=1;var W=P(12328),n=P(12352),y=P(13548),h=P(11689);class L{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(b){b=h.Tools.BackCompatCameraNoPreventDefault(arguments);const X=this.camera.getEngine(),P=X.getInputElement();let Q=0,S=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=d=>{var N,a;const u=d.event,w="touch"===u.pointerType;if(d.type!==f.d.POINTERMOVE&&-1===this.buttons.indexOf(u.button))return;const O=u.target;if(this._altKey=u.altKey,this._ctrlKey=u.ctrlKey,this._metaKey=u.metaKey,this._shiftKey=u.shiftKey,this._buttonsPressed=u.buttons,X.isPointerLock){const b=u.movementX,X=u.movementY;this.onTouch(null,b,X),this._pointA=null,this._pointB=null}else{if(d.type!==f.d.POINTERDOWN&&d.type!==f.d.POINTERDOUBLETAP&&w&&(null===(N=this._pointA)||void 0===N?void 0:N.pointerId)!==u.pointerId&&(null===(a=this._pointB)||void 0===a?void 0:a.pointerId)!==u.pointerId)return;if(d.type!==f.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!w)if(d.type===f.d.POINTERDOUBLETAP)this.onDoubleTap(u.pointerType);else if(d.type!==f.d.POINTERUP||this._currentMousePointerIdDown!==u.pointerId&&!w){if(d.type===f.d.POINTERMOVE)if(b||u.preventDefault(),this._pointA&&null===this._pointB){const b=u.clientX-this._pointA.x,X=u.clientY-this._pointA.y;this._pointA.x=u.clientX,this._pointA.y=u.clientY,this.onTouch(this._pointA,b,X)}else if(this._pointA&&this._pointB){const b=this._pointA.pointerId===u.pointerId?this._pointA:this._pointB;b.x=u.clientX,b.y=u.clientY;const X=this._pointA.x-this._pointB.x,P=this._pointA.y-this._pointB.y,N=X*X+P*P,a={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:u.pointerId,type:d.type};this.onMultiTouch(this._pointA,this._pointB,Q,N,S,a),S=a,Q=N}}else{try{null===O||void 0===O||O.releasePointerCapture(u.pointerId)}catch(e){}w||(this._pointB=null),X._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==u.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==u.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==Q||S)&&(this.onMultiTouch(this._pointA,this._pointB,Q,0,S,null),Q=0,S=null),this._currentMousePointerIdDown=-1,this.onButtonUp(u),b||u.preventDefault()}else{try{null===O||void 0===O||O.setPointerCapture(u.pointerId)}catch(e){}if(null===this._pointA)this._pointA={x:u.clientX,y:u.clientY,pointerId:u.pointerId,type:u.pointerType};else{if(null!==this._pointB)return;this._pointB={x:u.clientX,y:u.clientY,pointerId:u.pointerId,type:u.pointerType}}-1!==this._currentMousePointerIdDown||w||(this._currentMousePointerIdDown=u.pointerId),this.onButtonDown(u),b||(u.preventDefault(),P&&P.focus())}}},this._observer=this.camera.Ab()._inputManager._addCameraPointerObserver(this._pointerInput,f.d.POINTERDOWN|f.d.POINTERUP|f.d.POINTERMOVE|f.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,Q=0,S=null,this.onLostFocus()},this._contextMenuBind=b=>this.onContextMenu(b),P&&P.addEventListener("contextmenu",this._contextMenuBind,!1);const d=this.camera.Ab().getEngine().getHostWindow();d&&h.Tools.RegisterTopRootEvents(d,[{name:"blur",handler:this._onLostFocus}])}gO(){if(this._onLostFocus){const b=this.camera.Ab().getEngine().getHostWindow();b&&h.Tools.UnregisterTopRootEvents(b,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Ab()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const b=this.camera.Ab().getEngine().getInputElement();b&&b.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(b){}onTouch(b,X,P){}onMultiTouch(b,X,P,Q,S,d){}onContextMenu(b){b.preventDefault()}onButtonDown(b){}onButtonUp(b){}onLostFocus(){}}(0,Q.b)([(0,S.E)()],L.prototype,"buttons",void 0);class Z extends L{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(b,X){if(0!==this.panningSensibility&&b&&X){const P=X.x-b.x,Q=X.y-b.y;this.camera.inertialPanningX+=-P/this.panningSensibility,this.camera.inertialPanningY+=Q/this.panningSensibility}}_computePinchZoom(b,X){const P=this.camera.radius||Z.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=P*Math.sqrt(b)/Math.sqrt(X):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(X-b)*P*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(X-b)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(b,X,P){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-X/this.panningSensibility,this.camera.inertialPanningY+=P/this.panningSensibility):(this.camera.inertialAlphaOffset-=X/this.angularSensibilityX,this.camera.inertialBetaOffset-=P/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(b,X,P,Q,S,d){0===P&&null===S||0===Q&&null===d||(this.multiTouchPanAndZoom?(this._computePinchZoom(P,Q),this._computeMultiTouchPanning(S,d)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(Q)-Math.sqrt(P))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(P,Q),this._isPinching=!0):this._computeMultiTouchPanning(S,d)):this.multiTouchPanning?this._computeMultiTouchPanning(S,d):this.pinchZoom&&this._computePinchZoom(P,Q))}onButtonDown(b){this._isPanClick=b.button===this.camera._panningMouseButton}onButtonUp(b){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}Z.MinimumRadiusForPinch=.001,(0,Q.b)([(0,S.E)()],Z.prototype,"buttons",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"angularSensibilityX",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"angularSensibilityY",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"pinchPrecision",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"pinchDeltaPercentage",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"useNaturalPinchZoom",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"pinchZoom",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"panningSensibility",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"multiTouchPanning",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"multiTouchPanAndZoom",void 0),y.d.ArcRotateCameraPointersInput=Z;var v=P(12145);class A{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(b){b=h.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ab(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((X=>{const P=X.event;if(!P.metaKey)if(X.type===v.b.KEYDOWN){if(this._ctrlPressed=P.ctrlKey,this._altPressed=P.altKey,-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysReset.indexOf(P.keyCode)){-1===this._keys.indexOf(P.keyCode)&&this._keys.push(P.keyCode),P.preventDefault&&(b||P.preventDefault())}}else if(-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysReset.indexOf(P.keyCode)){const X=this._keys.indexOf(P.keyCode);X>=0&&this._keys.splice(X,1),P.preventDefault&&(b||P.preventDefault())}})))}gO(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const b=this.camera;for(let X=0;X<this._keys.length;X++){const P=this._keys[X];-1!==this.keysLeft.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningX-=1/this.panningSensibility:b.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?b.inertialRadiusOffset+=1/this.zoomingSensibility:b.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningX+=1/this.panningSensibility:b.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?b.inertialRadiusOffset-=1/this.zoomingSensibility:b.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(P)&&b.useInputToRestoreState&&b.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,Q.b)([(0,S.E)()],A.prototype,"keysUp",void 0),(0,Q.b)([(0,S.E)()],A.prototype,"keysDown",void 0),(0,Q.b)([(0,S.E)()],A.prototype,"keysLeft",void 0),(0,Q.b)([(0,S.E)()],A.prototype,"keysRight",void 0),(0,Q.b)([(0,S.E)()],A.prototype,"keysReset",void 0),(0,Q.b)([(0,S.E)()],A.prototype,"panningSensibility",void 0),(0,Q.b)([(0,S.E)()],A.prototype,"zoomingSensibility",void 0),(0,Q.b)([(0,S.E)()],A.prototype,"useAltToZoom",void 0),(0,Q.b)([(0,S.E)()],A.prototype,"angularSpeed",void 0),y.d.ArcRotateCameraKeyboardMoveInput=A;var o=P(11887),K=P(12147);class T{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new N.tX(0,0,0),this._globalOffset=new N.tX(0,0,0),this._inertialPanning=N.tX.Zero()}_computeDeltaFromMouseWheelLegacyEvent(b,X){let P=0;const Q=.01*b*this.wheelDeltaPercentage*X;return P=b>0?Q/(1+this.wheelDeltaPercentage):Q*(1+this.wheelDeltaPercentage),P}attachControl(b){b=h.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=X=>{if(X.type!==f.d.POINTERWHEEL)return;const P=X.event;let Q=0;const S=P.deltaMode===K.b.DOM_DELTA_LINE?40:1,d=-P.deltaY*S;if(this.customComputeDeltaFromMouseWheel)Q=this.customComputeDeltaFromMouseWheel(d,this,P);else if(this.wheelDeltaPercentage){if(Q=this._computeDeltaFromMouseWheelLegacyEvent(d,this.camera.radius),Q>0){let b=this.camera.radius,X=this.camera.inertialRadiusOffset+Q;for(let P=0;P<20&&!(b<=X)&&!(Math.abs(X*this.camera.inertia)<.001);P++)b-=X,X*=this.camera.inertia;b=(0,a.Clamp)(b,0,Number.MAX_VALUE),Q=this._computeDeltaFromMouseWheelLegacyEvent(d,b)}}else Q=d/(40*this.wheelPrecision);Q&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(Q)):this.camera.inertialRadiusOffset+=Q),P.preventDefault&&(b||P.preventDefault())},this._observer=this.camera.Ab()._inputManager._addCameraPointerObserver(this._wheel,f.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Gd(0)}gO(){this._observer&&(this.camera.Ab()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const b=this.camera;0+b.inertialAlphaOffset+b.inertialBetaOffset+b.inertialRadiusOffset&&(this._updateHitPlane(),b.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(b.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const b=this.camera,X=b.target.BX(b.position);this._hitPlane=o.c.FromPositionAndNormal(b.target,X)}_getPosition(){const b=this.camera,X=b.Ab(),P=X.createPickingRay(X.pointerX,X.pointerY,N.Matrix.Identity(),b,!1);0===b.targetScreenOffset.x&&0===b.targetScreenOffset.y||(this._viewOffset.set(b.targetScreenOffset.x,b.targetScreenOffset.y,0),b.getViewMatrix().invertToRef(b._cameraTransformMatrix),this._globalOffset=N.tX.TransformNormal(this._viewOffset,b._cameraTransformMatrix),P.origin.addInPlace(this._globalOffset));let Q=0;return this._hitPlane&&(Q=P.intersectsPlane(this._hitPlane)??0),P.origin.addInPlace(P.direction.scaleInPlace(Q))}_zoomToMouse(b){const X=this.camera,P=1-X.inertia;if(X.lowerRadiusLimit){const Q=X.lowerRadiusLimit??0;X.radius-(X.inertialRadiusOffset+b)/P<Q&&(b=(X.radius-Q)*P-X.inertialRadiusOffset)}if(X.upperRadiusLimit){const Q=X.upperRadiusLimit??0;X.radius-(X.inertialRadiusOffset+b)/P>Q&&(b=(X.radius-Q)*P-X.inertialRadiusOffset)}const Q=b/P/X.radius,S=this._getPosition(),d=N.TmpVectors.tX[6];S.subtractToRef(X.target,d),d.scaleInPlace(Q),d.scaleInPlace(P),this._inertialPanning.addInPlace(d),X.inertialRadiusOffset+=b}_zeroIfClose(b){Math.abs(b.x)<e.c&&(b.x=0),Math.abs(b.y)<e.c&&(b.y=0),Math.abs(b.z)<e.c&&(b.z=0)}}(0,Q.b)([(0,S.E)()],T.prototype,"wheelPrecision",void 0),(0,Q.b)([(0,S.E)()],T.prototype,"zoomToMouseLocation",void 0),(0,Q.b)([(0,S.E)()],T.prototype,"wheelDeltaPercentage",void 0),y.d.ArcRotateCameraMouseWheelInput=T;class q extends y.g{constructor(b){super(b)}addMouseWheel(){return this.add(new T),this}addPointers(){return this.add(new Z),this}addKeyboard(){return this.add(new A),this}}var V=P(11802);function i(b,X){return isNaN(b)?X:b}u.c.AddNodeConstructor("ArcRotateCamera",((b,X)=>()=>new x(b,0,0,1,N.tX.Zero(),X)));class x extends n.e{get target(){return this._target}set target(b){this.setTarget(b)}get targetHost(){return this._targetHost}set targetHost(b){b&&this.setTarget(b)}getTarget(){return this.target}get position(){return this._position}set position(b){this.setPosition(b)}set upVector(b){this._upToYMatrix||(this._yToUpMatrix=new N.Matrix,this._upToYMatrix=new N.Matrix,this._upVector=N.tX.Zero()),b.normalize(),this._upVector.N(b),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){N.Matrix.RotationAlignToRef(N.tX.UpReadOnly,this._upVector,this._yToUpMatrix),N.Matrix.RotationAlignToRef(this._upVector,N.tX.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const b=this.inputs.attached.pointers;return b?b.angularSensibilityX:0}set angularSensibilityX(b){const X=this.inputs.attached.pointers;X&&(X.angularSensibilityX=b)}get angularSensibilityY(){const b=this.inputs.attached.pointers;return b?b.angularSensibilityY:0}set angularSensibilityY(b){const X=this.inputs.attached.pointers;X&&(X.angularSensibilityY=b)}get pinchPrecision(){const b=this.inputs.attached.pointers;return b?b.pinchPrecision:0}set pinchPrecision(b){const X=this.inputs.attached.pointers;X&&(X.pinchPrecision=b)}get pinchDeltaPercentage(){const b=this.inputs.attached.pointers;return b?b.pinchDeltaPercentage:0}set pinchDeltaPercentage(b){const X=this.inputs.attached.pointers;X&&(X.pinchDeltaPercentage=b)}get useNaturalPinchZoom(){const b=this.inputs.attached.pointers;return!!b&&b.useNaturalPinchZoom}set useNaturalPinchZoom(b){const X=this.inputs.attached.pointers;X&&(X.useNaturalPinchZoom=b)}get panningSensibility(){const b=this.inputs.attached.pointers;return b?b.panningSensibility:0}set panningSensibility(b){const X=this.inputs.attached.pointers;X&&(X.panningSensibility=b)}get keysUp(){const b=this.inputs.attached.keyboard;return b?b.keysUp:[]}set keysUp(b){const X=this.inputs.attached.keyboard;X&&(X.keysUp=b)}get keysDown(){const b=this.inputs.attached.keyboard;return b?b.keysDown:[]}set keysDown(b){const X=this.inputs.attached.keyboard;X&&(X.keysDown=b)}get keysLeft(){const b=this.inputs.attached.keyboard;return b?b.keysLeft:[]}set keysLeft(b){const X=this.inputs.attached.keyboard;X&&(X.keysLeft=b)}get keysRight(){const b=this.inputs.attached.keyboard;return b?b.keysRight:[]}set keysRight(b){const X=this.inputs.attached.keyboard;X&&(X.keysRight=b)}get wheelPrecision(){const b=this.inputs.attached.mousewheel;return b?b.wheelPrecision:0}set wheelPrecision(b){const X=this.inputs.attached.mousewheel;X&&(X.wheelPrecision=b)}get zoomToMouseLocation(){const b=this.inputs.attached.mousewheel;return!!b&&b.zoomToMouseLocation}set zoomToMouseLocation(b){const X=this.inputs.attached.mousewheel;X&&(X.zoomToMouseLocation=b)}get wheelDeltaPercentage(){const b=this.inputs.attached.mousewheel;return b?b.wheelDeltaPercentage:0}set wheelDeltaPercentage(b){const X=this.inputs.attached.mousewheel;X&&(X.wheelDeltaPercentage=b)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(b){b!==this.useBouncingBehavior&&(b?(this._bouncingBehavior=new t,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(b){b!==this.useFramingBehavior&&(b?(this._framingBehavior=new B,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(b){b!==this.useAutoRotationBehavior&&(b?(this._autoRotationBehavior=new Y,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(b,X,P,Q,S,a){var u;let w=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(b,N.tX.Zero(),a,w),u=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=N.tX.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=N.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new N.Matrix,this.panningAxis=new N.tX(1,1,0),this._transformedDirection=new N.tX,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new d.d,this.checkCollisions=!1,this.collisionRadius=new N.tX(.5,.5,.5),this._previousPosition=N.tX.Zero(),this._collisionVelocity=N.tX.Zero(),this._newPosition=N.tX.Zero(),this._computationVector=N.tX.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new N.tX(NaN,NaN,NaN),this._goalTargetScreenOffset=new N.Vector2(NaN,NaN),this._onCollisionPositionChange=function(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;P?(u.setPosition(X),u.JY&&u.JY(P)):u._previousPosition.N(u._position);const Q=Math.cos(u.alpha),S=Math.sin(u.alpha),d=Math.cos(u.beta);let N=Math.sin(u.beta);0===N&&(N=1e-4);const a=u._getTargetPosition();u._computationVector.sd(u.radius*Q*N,u.radius*d,u.radius*S*N),a.addToRef(u._computationVector,u._newPosition),u._position.N(u._newPosition);let w=u.upVector;u.allowUpsideDown&&u.beta<0&&(w=w.clone(),w=w.negate()),u._computeViewMatrix(u._position,a,w),u._viewMatrix.addAtIndex(12,u.targetScreenOffset.x),u._viewMatrix.addAtIndex(13,u.targetScreenOffset.y),u._collisionTriggered=!1},this._target=N.tX.Zero(),S&&this.setTarget(S),this.alpha=X,this.beta=P,this.radius=Q,this.getViewMatrix(),this.inputs=new q(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new N.tX(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=N.Vector2.Zero()}_updateCache(b){b||super._updateCache(),this._cache._target.N(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.N(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const b=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?b.addToRef(this._targetBoundingCenter,this._target):this._target.N(b)}const b=this._getLockedTargetPosition();return b||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>e.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,d=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=d?this._currentInterpolationFactor=d:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=i(b,this._goalAlpha),this._goalBeta=i(X,this._goalBeta),this._goalRadius=i(P,this._goalRadius),this._goalTarget.set(i(Q.x,this._goalTarget.x),i(Q.y,this._goalTarget.y),i(Q.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(i(S.x,this._goalTargetScreenOffset.x),i(S.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,a.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,a.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,a.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,a.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(b,X){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const S=arguments;X=h.Tools.BackCompatCameraNoPreventDefault(S),this._useCtrlForPanning=P,this._panningMouseButton=Q,"boolean"===typeof S[0]&&(S.length>1&&(this._useCtrlForPanning=S[1]),S.length>2&&(this._panningMouseButton=S[2])),this.inputs.attachElement(X),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}gO(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let b=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){b=!0;const X=this.invertRotation?-1:1,P=this._calculateHandednessMultiplier();let Q=this.inertialAlphaOffset*P;this.beta<0&&(Q*=-1),this.alpha+=Q*X,this.beta+=this.inertialBetaOffset*X,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<e.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<e.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*e.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){b=!0;const X=new N.tX(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),X.multiplyInPlace(this.panningAxis),N.tX.TransformNormalToRef(X,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const b=this.upVector,X=N.tX.CrossToRef(this._transformedDirection,b,this._transformedDirection);N.tX.CrossToRef(b,X,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);N.tX.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.N(this._transformedDirection)}else{if(this.parent){const b=N.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(b),b.transposeToRef(b),N.tX.TransformCoordinatesToRef(this._transformedDirection,b,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*e.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*e.c&&(this.inertialPanningY=0)}if(b)this.stopInterpolation();else if(this._isInterpolating){let b=!1;const X=this._scene.getEngine().getDeltaTime()/1e3,P=1-Math.pow(2,-X/this._currentInterpolationFactor),Q=i(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const X=N.TmpVectors.tX[0].set(i(this._goalTarget.x,this._target.x),i(this._goalTarget.y,this._target.y),i(this._goalTarget.z,this._target.z));N.tX.LerpToRef(this.target,X,P,this._target),10*N.tX.Distance(this.target,X)/Q<e.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.N(X),this.setTarget(this.target,!1,!0,!0)):b=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const X=N.Quaternion.RotationAlphaBetaGammaToRef(i(this._goalAlpha,this.alpha),i(this._goalBeta,this.beta),0,N.TmpVectors.Quaternion[0]),Q=N.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,N.TmpVectors.Quaternion[1]),S=N.Quaternion.SlerpToRef(Q,X,P,N.TmpVectors.Quaternion[2]);S.normalize();const d=S.toAlphaBetaGammaToRef(N.TmpVectors.tX[0]);if(this.alpha=d.x,this.beta=d.y,S.isApprox(X,e.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const b=X.toAlphaBetaGammaToRef(N.TmpVectors.tX[0]);this.alpha=b.x,this.beta=b.y}else b=!0}if(isNaN(this._goalRadius)||(this.radius+=(Q-this.radius)*P,Math.abs(Q/this.radius-1)<e.c?(this._goalRadius=NaN,this.radius=Q):b=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const X=N.TmpVectors.Vector2[0].set(i(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),i(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));N.Vector2.LerpToRef(this.targetScreenOffset,X,P,this.targetScreenOffset),N.Vector2.Distance(this.targetScreenOffset,X)<e.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.N(X)):b=!0}this._isInterpolating=b}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||N.tX.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const b=this.alpha;var X,P;this.alpha=function(b){let X=Math.PI/2;return 0===b.x&&0===b.z||(X=Math.acos(b.x/Math.sqrt(Math.pow(b.x,2)+Math.pow(b.z,2)))),b.z<0&&(X=2*Math.PI-X),X}(this._computationVector),this.beta=(X=this._computationVector.y,P=this.radius,Math.acos(X/P));const Q=Math.round((b-this.alpha)/(2*Math.PI));this.alpha+=2*Q*Math.PI,this._checkLimits()}setPosition(b){this._position.equals(b)||(this._position.N(b),this.rebuildAnglesAndRadius())}setTarget(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Q=this.overrideCloneAlphaBetaRadius??Q,b.pd)X&&b.getBoundingInfo?this._targetBoundingCenter=b.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,b.pd(),this._targetHost=b,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const X=b,Q=this._getTargetPosition();if(Q&&!P&&Q.equals(X))return;this._targetHost=null,this._target=X,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}Q||this.rebuildAnglesAndRadius()}_getViewMatrix(){const b=Math.cos(this.alpha),X=Math.sin(this.alpha),P=Math.cos(this.beta);let Q=Math.sin(this.beta);0===Q&&(Q=1e-4),0===this.radius&&(this.radius=1e-4);const S=this._getTargetPosition();if(this._computationVector.sd(this.radius*b*Q,this.radius*P,this.radius*X*Q),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||N.tX.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),S.addToRef(this._computationVector,this._newPosition),this.Ab().collisionsEnabled&&this.checkCollisions){const b=this.Ab().collisionCoordinator;this._collider||(this._collider=b.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,b.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.N(this._newPosition);let b=this.upVector;this.allowUpsideDown&&Q<0&&(b=b.negate()),this._computeViewMatrix(this._position,S,b),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.N(S),this._viewMatrix}zoomOn(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b=b||this.Ab().meshes;const P=w.b.MinMax(b);let Q=this._calculateLowerRadiusFromModelBoundingSphere(P.min,P.max);if(Q=Math.max(Math.min(Q,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=Q*this.zoomOnFactor,this.mode===W.c.ORTHOGRAPHIC_CAMERA){const b=this.Ab().getEngine().getAspectRatio(this),X=Q*this.zoomOnFactor/2;this.orthoLeft=-X*b,this.orthoRight=X*b,this.orthoBottom=-X,this.orthoTop=X}this.focusOn({min:P.min,max:P.max,distance:Q},X)}focusOn(b){let X,P,Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===b.min){const Q=b||this.Ab().meshes;X=w.b.MinMax(Q),P=N.tX.Distance(X.min,X.max)}else{X=b,P=b.distance}this._target=w.b.Center(X),Q||(this.maxZ=2*P)}createRigCamera(b,X){let P=0;switch(this.cameraRigMode){case W.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case W.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case W.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case W.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case W.c.RIG_MODE_VR:P=this._cameraRigParams.stereoHalfAngle*(0===X?1:-1);break;case W.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:P=this._cameraRigParams.stereoHalfAngle*(0===X?-1:1)}const Q=new x(b,this.alpha+P,this.beta,this.radius,this._target,this.Ab());return Q._cameraRigParams={},Q.isRigCamera=!0,Q.rigParent=this,Q.upVector=this.upVector,Q.mode=this.mode,Q.orthoLeft=this.orthoLeft,Q.orthoRight=this.orthoRight,Q.orthoBottom=this.orthoBottom,Q.orthoTop=this.orthoTop,Q}_updateRigCameras(){const b=this._rigCameras[0],X=this._rigCameras[1];switch(b.beta=X.beta=this.beta,this.cameraRigMode){case W.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case W.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case W.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case W.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case W.c.RIG_MODE_VR:b.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,X.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case W.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:b.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,X.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const Q=N.tX.Distance(b,X),S=this.Ab().getEngine().getAspectRatio(this),d=Math.tan(this.fov/2),a=d*S,u=.5*Q*P,w=u*Math.sqrt(1+1/(a*a)),f=u*Math.sqrt(1+1/(d*d));return Math.max(w,f)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,Q.b)([(0,S.E)()],x.prototype,"alpha",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"beta",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"radius",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,Q.b)([(0,S.A)("target")],x.prototype,"_target",void 0),(0,Q.b)([(0,S.p)("targetHost")],x.prototype,"_targetHost",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"inertialAlphaOffset",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"inertialBetaOffset",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"inertialRadiusOffset",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"lowerAlphaLimit",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"upperAlphaLimit",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"lowerBetaLimit",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"upperBetaLimit",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"lowerRadiusLimit",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"upperRadiusLimit",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"lowerTargetYLimit",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"inertialPanningX",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"inertialPanningY",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"pinchToPanMaxDistance",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"panningDistanceLimit",void 0),(0,Q.b)([(0,S.A)()],x.prototype,"panningOriginTarget",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"panningInertia",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"zoomToMouseLocation",null),(0,Q.b)([(0,S.E)()],x.prototype,"zoomOnFactor",void 0),(0,Q.b)([(0,S.x)()],x.prototype,"targetScreenOffset",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"allowUpsideDown",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"useInputToRestoreState",void 0),(0,Q.b)([(0,S.E)()],x.prototype,"restoreStateInterpolationFactor",void 0),(0,V.h)("BABYLON.ArcRotateCamera",x)},13548:(b,X,P)=>{"use strict";P.d(X,{d:()=>N,g:()=>a});var Q=P(11700),S=P(11862),d=P(12328),N={};class a{constructor(b){this.attachedToElement=!1,this.attached={},this.camera=b,this.checkInputs=()=>{}}add(b){const X=b.getSimpleName();this.attached[X]?Q.b.Warn("camera input of type "+X+" already exists on camera"):(this.attached[X]=b,b.camera=this.camera,b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b))),this.attachedToElement&&b.attachControl(this.noPreventDefault))}remove(b){for(const X in this.attached){const P=this.attached[X];if(P===b)return P.gO(),P.camera=null,delete this.attached[X],void this.rebuildInputCheck()}}removeByType(b){for(const X in this.attached){const P=this.attached[X];P.getClassName()===b&&(P.gO(),P.camera=null,delete this.attached[X],this.rebuildInputCheck())}}_addCheckInputs(b){const X=this.checkInputs;return()=>{X(),b()}}attachInput(b){this.attachedToElement&&b.attachControl(this.noPreventDefault)}attachElement(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){b=!d.c.ForceAttachControlToAlwaysPreventDefault&&b,this.attachedToElement=!0,this.noPreventDefault=b;for(const X in this.attached)this.attached[X].attachControl(b)}}detachElement(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const X in this.attached)this.attached[X].gO(),b&&(this.attached[X].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const b in this.attached){const X=this.attached[b];X.checkInputs&&(this.checkInputs=this._addCheckInputs(X.checkInputs.bind(X)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(b){const X={};for(const P in this.attached){const b=this.attached[P],Q=S.b.Serialize(b);X[b.getClassName()]=Q}b.inputsmgr=X}parse(b){const X=b.inputsmgr;if(X){this.clear();for(const b in X){const P=N[b];if(P){const Q=X[b],d=S.b.Parse((()=>new P),Q,null);this.add(d)}}}else for(const P in this.attached){const X=N[this.attached[P].getClassName()];if(X){const Q=S.b.Parse((()=>new X),b,null);this.remove(this.attached[P]),this.add(Q)}}}}},13541:(b,X,P)=>{"use strict";P.d(X,{b:()=>L});var Q=P(11822),S=P(11825),d=P(11834),N=P(12352),a=P(13548),u=P(12145),w=P(11689);class f{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(b){b=w.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ab(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((X=>{const P=X.event;if(!P.metaKey)if(X.type===u.b.KEYDOWN){if(-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysUpward.indexOf(P.keyCode)||-1!==this.keysDownward.indexOf(P.keyCode)||-1!==this.keysRotateLeft.indexOf(P.keyCode)||-1!==this.keysRotateRight.indexOf(P.keyCode)||-1!==this.keysRotateUp.indexOf(P.keyCode)||-1!==this.keysRotateDown.indexOf(P.keyCode)){-1===this._keys.indexOf(P.keyCode)&&this._keys.push(P.keyCode),b||P.preventDefault()}}else if(-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysUpward.indexOf(P.keyCode)||-1!==this.keysDownward.indexOf(P.keyCode)||-1!==this.keysRotateLeft.indexOf(P.keyCode)||-1!==this.keysRotateRight.indexOf(P.keyCode)||-1!==this.keysRotateUp.indexOf(P.keyCode)||-1!==this.keysRotateDown.indexOf(P.keyCode)){const X=this._keys.indexOf(P.keyCode);X>=0&&this._keys.splice(X,1),b||P.preventDefault()}})))}gO(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const b=this.camera;for(let X=0;X<this._keys.length;X++){const P=this._keys[X],Q=b._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(P)?b._localDirection.sd(-Q,0,0):-1!==this.keysUp.indexOf(P)?b._localDirection.sd(0,0,Q):-1!==this.keysRight.indexOf(P)?b._localDirection.sd(Q,0,0):-1!==this.keysDown.indexOf(P)?b._localDirection.sd(0,0,-Q):-1!==this.keysUpward.indexOf(P)?b._localDirection.sd(0,Q,0):-1!==this.keysDownward.indexOf(P)?b._localDirection.sd(0,-Q,0):-1!==this.keysRotateLeft.indexOf(P)?(b._localDirection.sd(0,0,0),b.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(P)?(b._localDirection.sd(0,0,0),b.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(P)?(b._localDirection.sd(0,0,0),b.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(P)&&(b._localDirection.sd(0,0,0),b.cameraRotation.x+=this._getLocalRotation()),b.Ab().useRightHandedSystem&&(b._localDirection.z*=-1),b.getViewMatrix().invertToRef(b._cameraTransformMatrix),d.tX.TransformNormalToRef(b._localDirection,b._cameraTransformMatrix,b._transformedDirection),b.cameraDirection.addInPlace(b._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const b=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*b}}(0,Q.b)([(0,S.E)()],f.prototype,"keysUp",void 0),(0,Q.b)([(0,S.E)()],f.prototype,"keysUpward",void 0),(0,Q.b)([(0,S.E)()],f.prototype,"keysDown",void 0),(0,Q.b)([(0,S.E)()],f.prototype,"keysDownward",void 0),(0,Q.b)([(0,S.E)()],f.prototype,"keysLeft",void 0),(0,Q.b)([(0,S.E)()],f.prototype,"keysRight",void 0),(0,Q.b)([(0,S.E)()],f.prototype,"rotationSpeed",void 0),(0,Q.b)([(0,S.E)()],f.prototype,"keysRotateLeft",void 0),(0,Q.b)([(0,S.E)()],f.prototype,"keysRotateRight",void 0),(0,Q.b)([(0,S.E)()],f.prototype,"keysRotateUp",void 0),(0,Q.b)([(0,S.E)()],f.prototype,"keysRotateDown",void 0),a.d.FreeCameraKeyboardMoveInput=f;var O=P(11694),e=P(12142);class Y{constructor(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=b,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new O.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(b){b=w.Tools.BackCompatCameraNoPreventDefault(arguments);const X=this.camera.getEngine(),P=X.getInputElement();this._pointerInput||(this._pointerInput=Q=>{const S=Q.event,d="touch"===S.pointerType;if(!this.touchEnabled&&d)return;if(Q.type!==e.d.POINTERMOVE&&-1===this.buttons.indexOf(S.button))return;const N=S.target;if(Q.type===e.d.POINTERDOWN){if(d&&-1!==this._activePointerId||!d&&-1!==this._currentActiveButton)return;this._activePointerId=S.pointerId;try{null===N||void 0===N||N.setPointerCapture(S.pointerId)}catch(a){}-1===this._currentActiveButton&&(this._currentActiveButton=S.button),this._previousPosition={x:S.clientX,y:S.clientY},b||(S.preventDefault(),P&&P.focus()),X.isPointerLock&&this._onMouseMove&&this._onMouseMove(Q.event)}else if(Q.type===e.d.POINTERUP){if(d&&this._activePointerId!==S.pointerId||!d&&this._currentActiveButton!==S.button)return;try{null===N||void 0===N||N.releasePointerCapture(S.pointerId)}catch(a){}this._currentActiveButton=-1,this._previousPosition=null,b||S.preventDefault(),this._activePointerId=-1}else if(Q.type===e.d.POINTERMOVE&&(this._activePointerId===S.pointerId||!d))if(X.isPointerLock&&this._onMouseMove)this._onMouseMove(Q.event);else if(this._previousPosition){const X=this.camera._calculateHandednessMultiplier(),P=(S.clientX-this._previousPosition.x)*X,Q=S.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=P/this.angularSensibility,this.camera.cameraRotation.x+=Q/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:P,offsetY:Q}),this._previousPosition={x:S.clientX,y:S.clientY},b||S.preventDefault()}}),this._onMouseMove=P=>{if(!X.isPointerLock)return;const Q=this.camera._calculateHandednessMultiplier(),S=P.movementX*Q;this.camera.cameraRotation.y+=S/this.angularSensibility;const d=P.movementY;this.camera.cameraRotation.x+=d/this.angularSensibility,this._previousPosition=null,b||P.preventDefault()},this._observer=this.camera.Ab()._inputManager._addCameraPointerObserver(this._pointerInput,e.d.POINTERDOWN|e.d.POINTERUP|e.d.POINTERMOVE),P&&(this._contextMenuBind=b=>this.onContextMenu(b),P.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(b){b.preventDefault()}gO(){if(this._observer){if(this.camera.Ab()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const b=this.camera.getEngine().getInputElement();b&&b.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,Q.b)([(0,S.E)()],Y.prototype,"buttons",void 0),(0,Q.b)([(0,S.E)()],Y.prototype,"angularSensibility",void 0),a.d.FreeCameraMouseInput=Y;var D,E=P(12147);class t{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new O.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(b){b=w.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=X=>{if(X.type!==e.d.POINTERWHEEL)return;const P=X.event,Q=P.deltaMode===E.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*Q*P.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*Q*P.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*Q*P.deltaZ/this._normalize,P.preventDefault&&(b||P.preventDefault())},this._observer=this.camera.Ab()._inputManager._addCameraPointerObserver(this._wheel,e.d.POINTERWHEEL)}gO(){this._observer&&(this.camera.Ab()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,Q.b)([(0,S.E)()],t.prototype,"wheelPrecisionX",void 0),(0,Q.b)([(0,S.E)()],t.prototype,"wheelPrecisionY",void 0),(0,Q.b)([(0,S.E)()],t.prototype,"wheelPrecisionZ",void 0),function(b){b[b.MoveRelative=0]="MoveRelative",b[b.RotateRelative=1]="RotateRelative",b[b.MoveScene=2]="MoveScene"}(D||(D={}));class B extends t{constructor(){super(...arguments),this._moveRelative=d.tX.Zero(),this._rotateRelative=d.tX.Zero(),this._moveScene=d.tX.Zero(),this._wheelXAction=D.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=D.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(b){null===b&&this._wheelXAction!==D.MoveRelative||(this._wheelXAction=D.MoveRelative,this._wheelXActionCoordinate=b)}get wheelXMoveRelative(){return this._wheelXAction!==D.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(b){null===b&&this._wheelYAction!==D.MoveRelative||(this._wheelYAction=D.MoveRelative,this._wheelYActionCoordinate=b)}get wheelYMoveRelative(){return this._wheelYAction!==D.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(b){null===b&&this._wheelZAction!==D.MoveRelative||(this._wheelZAction=D.MoveRelative,this._wheelZActionCoordinate=b)}get wheelZMoveRelative(){return this._wheelZAction!==D.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(b){null===b&&this._wheelXAction!==D.RotateRelative||(this._wheelXAction=D.RotateRelative,this._wheelXActionCoordinate=b)}get wheelXRotateRelative(){return this._wheelXAction!==D.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(b){null===b&&this._wheelYAction!==D.RotateRelative||(this._wheelYAction=D.RotateRelative,this._wheelYActionCoordinate=b)}get wheelYRotateRelative(){return this._wheelYAction!==D.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(b){null===b&&this._wheelZAction!==D.RotateRelative||(this._wheelZAction=D.RotateRelative,this._wheelZActionCoordinate=b)}get wheelZRotateRelative(){return this._wheelZAction!==D.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(b){null===b&&this._wheelXAction!==D.MoveScene||(this._wheelXAction=D.MoveScene,this._wheelXActionCoordinate=b)}get wheelXMoveScene(){return this._wheelXAction!==D.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(b){null===b&&this._wheelYAction!==D.MoveScene||(this._wheelYAction=D.MoveScene,this._wheelYActionCoordinate=b)}get wheelYMoveScene(){return this._wheelYAction!==D.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(b){null===b&&this._wheelZAction!==D.MoveScene||(this._wheelZAction=D.MoveScene,this._wheelZActionCoordinate=b)}get wheelZMoveScene(){return this._wheelZAction!==D.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Gd(0),this._rotateRelative.Gd(0),this._moveScene.Gd(0),this._updateCamera(),this.camera.Ab().useRightHandedSystem&&(this._moveRelative.z*=-1);const b=d.Matrix.Zero();this.camera.getViewMatrix().invertToRef(b);const X=d.tX.Zero();d.tX.TransformNormalToRef(this._moveRelative,b,X),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(X),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(b,X,P){if(0===b)return;if(null===X||null===P)return;let Q=null;switch(X){case D.MoveRelative:Q=this._moveRelative;break;case D.RotateRelative:Q=this._rotateRelative;break;case D.MoveScene:Q=this._moveScene}switch(P){case 0:Q.set(b,0,0);break;case 1:Q.set(0,b,0);break;case 2:Q.set(0,0,b)}}}(0,Q.b)([(0,S.E)()],B.prototype,"wheelXMoveRelative",null),(0,Q.b)([(0,S.E)()],B.prototype,"wheelYMoveRelative",null),(0,Q.b)([(0,S.E)()],B.prototype,"wheelZMoveRelative",null),(0,Q.b)([(0,S.E)()],B.prototype,"wheelXRotateRelative",null),(0,Q.b)([(0,S.E)()],B.prototype,"wheelYRotateRelative",null),(0,Q.b)([(0,S.E)()],B.prototype,"wheelZRotateRelative",null),(0,Q.b)([(0,S.E)()],B.prototype,"wheelXMoveScene",null),(0,Q.b)([(0,S.E)()],B.prototype,"wheelYMoveScene",null),(0,Q.b)([(0,S.E)()],B.prototype,"wheelZMoveScene",null),a.d.FreeCameraMouseWheelInput=B;class W{constructor(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=b,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=w.Tools.IsSafari()}attachControl(b){b=w.Tools.BackCompatCameraNoPreventDefault(arguments);let X=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=P=>{const Q=P.event,S="mouse"===Q.pointerType||this._isSafari&&"undefined"===typeof Q.pointerType;if(this.allowMouse||!S)if(P.type===e.d.POINTERDOWN){if(b||Q.preventDefault(),this._pointerPressed.push(Q.pointerId),1!==this._pointerPressed.length)return;X={x:Q.clientX,y:Q.clientY}}else if(P.type===e.d.POINTERUP){b||Q.preventDefault();const P=this._pointerPressed.indexOf(Q.pointerId);if(-1===P)return;if(this._pointerPressed.splice(P,1),0!=P)return;X=null,this._offsetX=null,this._offsetY=null}else if(P.type===e.d.POINTERMOVE){if(b||Q.preventDefault(),!X)return;if(0!=this._pointerPressed.indexOf(Q.pointerId))return;this._offsetX=Q.clientX-X.x,this._offsetY=-(Q.clientY-X.y)}}),this._observer=this.camera.Ab()._inputManager._addCameraPointerObserver(this._pointerInput,e.d.POINTERDOWN|e.d.POINTERUP|e.d.POINTERMOVE),this._onLostFocus){const b=this.camera.getEngine().getInputElement();b&&b.addEventListener("blur",this._onLostFocus)}}gO(){if(this._pointerInput){if(this._observer&&(this.camera.Ab()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const b=this.camera.getEngine().getInputElement();b&&b.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const b=this.camera,X=b._calculateHandednessMultiplier();b.cameraRotation.y=X*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)b.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const X=b._computeLocalCameraSpeed(),P=new d.tX(0,0,0!==this.touchMoveSensibility?X*this._offsetY/this.touchMoveSensibility:0);d.Matrix.RotationYawPitchRollToRef(b.rotation.y,b.rotation.x,0,b._cameraRotationMatrix),b.cameraDirection.addInPlace(d.tX.TransformCoordinates(P,b._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,Q.b)([(0,S.E)()],W.prototype,"touchAngularSensibility",void 0),(0,Q.b)([(0,S.E)()],W.prototype,"touchMoveSensibility",void 0),a.d.FreeCameraTouchInput=W;class n extends a.g{constructor(b){super(b),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new f),this}addMouse(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new Y(b),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new B,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new W),this}clear(){super.clear(),this._mouseInput=null}}var y=P(11802),h=P(11760);class L extends N.e{get angularSensibility(){const b=this.inputs.attached.mouse;return b?b.angularSensibility:0}set angularSensibility(b){const X=this.inputs.attached.mouse;X&&(X.angularSensibility=b)}get keysUp(){const b=this.inputs.attached.keyboard;return b?b.keysUp:[]}set keysUp(b){const X=this.inputs.attached.keyboard;X&&(X.keysUp=b)}get keysUpward(){const b=this.inputs.attached.keyboard;return b?b.keysUpward:[]}set keysUpward(b){const X=this.inputs.attached.keyboard;X&&(X.keysUpward=b)}get keysDown(){const b=this.inputs.attached.keyboard;return b?b.keysDown:[]}set keysDown(b){const X=this.inputs.attached.keyboard;X&&(X.keysDown=b)}get keysDownward(){const b=this.inputs.attached.keyboard;return b?b.keysDownward:[]}set keysDownward(b){const X=this.inputs.attached.keyboard;X&&(X.keysDownward=b)}get keysLeft(){const b=this.inputs.attached.keyboard;return b?b.keysLeft:[]}set keysLeft(b){const X=this.inputs.attached.keyboard;X&&(X.keysLeft=b)}get keysRight(){const b=this.inputs.attached.keyboard;return b?b.keysRight:[]}set keysRight(b){const X=this.inputs.attached.keyboard;X&&(X.keysRight=b)}get keysRotateLeft(){const b=this.inputs.attached.keyboard;return b?b.keysRotateLeft:[]}set keysRotateLeft(b){const X=this.inputs.attached.keyboard;X&&(X.keysRotateLeft=b)}get keysRotateRight(){const b=this.inputs.attached.keyboard;return b?b.keysRotateRight:[]}set keysRotateRight(b){const X=this.inputs.attached.keyboard;X&&(X.keysRotateRight=b)}get keysRotateUp(){const b=this.inputs.attached.keyboard;return b?b.keysRotateUp:[]}set keysRotateUp(b){const X=this.inputs.attached.keyboard;X&&(X.keysRotateUp=b)}get keysRotateDown(){const b=this.inputs.attached.keyboard;return b?b.keysRotateDown:[]}set keysRotateDown(b){const X=this.inputs.attached.keyboard;X&&(X.keysRotateDown=b)}constructor(b,X,P){var Q;super(b,X,P,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),Q=this,this.ellipsoid=new d.tX(.5,1,.5),this.ellipsoidOffset=new d.tX(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=d.tX.Zero(),this._diffPosition=d.tX.Zero(),this._newPosition=d.tX.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Q._newPosition.N(X),Q._newPosition.subtractToRef(Q._oldPosition,Q._diffPosition),Q._diffPosition.length()>h.c.CollisionsEpsilon&&(Q.position.addToRef(Q._diffPosition,Q._deferredPositionUpdate),Q._deferOnly?Q._deferredUpdated=!0:Q.position.N(Q._deferredPositionUpdate),Q.JY&&P&&Q.JY(P))},this.inputs=new n(this),this.inputs.addKeyboard().addMouse()}attachControl(b,X){X=w.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(X)}gO(){this.inputs.detachElement(),this.cameraDirection=new d.tX(0,0,0),this.cameraRotation=new d.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(b){this._collisionMask=isNaN(b)?-1:b}_collideWithWorld(b){let X;X=this.parent?d.tX.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,X.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const P=this.Ab().collisionCoordinator;this._collider||(this._collider=P.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let Q=b;this.applyGravity&&(Q=b.add(this.Ab().gravity)),P.getNewPosition(this._oldPosition,Q,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=d.tX.Zero(),this._transformedDirection=d.tX.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(b){this._needMoveForGravity=b}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Ab().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Df"}}(0,Q.b)([(0,S.A)()],L.prototype,"ellipsoid",void 0),(0,Q.b)([(0,S.A)()],L.prototype,"ellipsoidOffset",void 0),(0,Q.b)([(0,S.E)()],L.prototype,"checkCollisions",void 0),(0,Q.b)([(0,S.E)()],L.prototype,"applyGravity",void 0),(0,y.h)("BABYLON.FreeCamera",L)},14147:(b,X,P)=>{"use strict";P.d(X,{b:()=>d});var Q=P(11934),S=P(14155);class d{constructor(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=P,this.NO=[],this._maxBlockCapacity=X||64,this._selectionContent=new Q.e(1024),this._creationFunc=b}update(b,X,P){S.c._CreateBlocks(b,X,P,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}rw(b){for(let X=0;X<this.Of.length;X++){this.Of[X].addEntry(b)}}Rw(b){for(let X=0;X<this.Of.length;X++){this.Of[X].removeEntry(b)}}select(b,X){this._selectionContent.reset();for(let P=0;P<this.Of.length;P++){this.Of[P].select(b,this._selectionContent,X)}return X?this._selectionContent.concat(this.NO):this._selectionContent.concatWithNoDuplicate(this.NO),this._selectionContent}intersects(b,X,P){this._selectionContent.reset();for(let Q=0;Q<this.Of.length;Q++){this.Of[Q].intersects(b,X,this._selectionContent,P)}return P?this._selectionContent.concat(this.NO):this._selectionContent.concatWithNoDuplicate(this.NO),this._selectionContent}intersectsRay(b){this._selectionContent.reset();for(let X=0;X<this.Of.length;X++){this.Of[X].intersectsRay(b,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.NO),this._selectionContent}}d.CreationFuncForMeshes=(b,X)=>{const P=b.getBoundingInfo();!b.isBlocked&&P.boundingBox.intersectsMinMax(X.OO,X.eO)&&X.entries.push(b)},d.CreationFuncForSubMeshes=(b,X)=>{b.getBoundingInfo().boundingBox.intersectsMinMax(X.OO,X.eO)&&X.entries.push(b)}},14155:(b,X,P)=>{"use strict";P.d(X,{c:()=>d});var Q=P(11834),S=P(12198);class d{constructor(b,X,P,Q,S,d){this.entries=[],this.YO=new Array,this._capacity=P,this._depth=Q,this._maxDepth=S,this._creationFunc=d,this._minPoint=b,this._maxPoint=X,this.YO.push(b.clone()),this.YO.push(X.clone()),this.YO.push(b.clone()),this.YO[2].x=X.x,this.YO.push(b.clone()),this.YO[3].y=X.y,this.YO.push(b.clone()),this.YO[4].z=X.z,this.YO.push(X.clone()),this.YO[5].z=b.z,this.YO.push(X.clone()),this.YO[6].x=b.x,this.YO.push(X.clone()),this.YO[7].y=b.y}get zX(){return this._capacity}get OO(){return this._minPoint}get eO(){return this._maxPoint}addEntry(b){if(this.Of)for(let X=0;X<this.Of.length;X++){this.Of[X].addEntry(b)}else this._creationFunc(b,this),this.entries.length>this.zX&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(b){if(this.Of){for(let X=0;X<this.Of.length;X++){this.Of[X].removeEntry(b)}return}const X=this.entries.indexOf(b);X>-1&&this.entries.splice(X,1)}addEntries(b){for(let X=0;X<b.length;X++){const P=b[X];this.addEntry(P)}}select(b,X,P){if(S.c.IsInFrustum(this.YO,b)){if(this.Of){for(let Q=0;Q<this.Of.length;Q++){this.Of[Q].select(b,X,P)}return}P?X.concat(this.entries):X.concatWithNoDuplicate(this.entries)}}intersects(b,X,P,Q){if(S.c.IntersectsSphere(this._minPoint,this._maxPoint,b,X)){if(this.Of){for(let S=0;S<this.Of.length;S++){this.Of[S].intersects(b,X,P,Q)}return}Q?P.concat(this.entries):P.concatWithNoDuplicate(this.entries)}}intersectsRay(b,X){if(b.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Of){for(let P=0;P<this.Of.length;P++){this.Of[P].intersectsRay(b,X)}return}X.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){d._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(b,X,P,S,N,a,u,w){u.Of=new Array;const f=new Q.tX((X.x-b.x)/2,(X.y-b.y)/2,(X.z-b.z)/2);for(let Q=0;Q<2;Q++)for(let X=0;X<2;X++)for(let O=0;O<2;O++){const e=b.add(f.multiplyByFloats(Q,X,O)),Y=b.add(f.multiplyByFloats(Q+1,X+1,O+1)),D=new d(e,Y,S,N+1,a,w);D.addEntries(P),u.Of.push(D)}}}},14160:(b,X,P)=>{"use strict";P.d(X,{e:()=>f});var Q=P(12093),S=P(11834),d=P(12290),N=P(13320),a=P(12134),u=P(14147),w=P(11732);Q.e.prototype.createOrUpdateSelectionOctree=function(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,P=this._getComponent(a.e.NAME_OCTREE);P||(P=new f(this),this.o(P)),this.SO||(this.SO=new u.b(u.b.CreationFuncForMeshes,b,X));const Q=this.getWorldExtends();return this.SO.update(Q.min,Q.max,this.meshes),this.SO},Object.defineProperty(Q.e.prototype,"selectionOctree",{get:function(){return this.SO},enumerable:!0,configurable:!0}),d.e.prototype.createOrUpdateSubmeshesOctree=function(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const P=this.Ab();let Q=P._getComponent(a.e.NAME_OCTREE);Q||(Q=new f(P),P.o(Q)),this._submeshesOctree||(this._submeshesOctree=new u.b(u.b.CreationFuncForSubMeshes,b,X)),this.pd(!0);const S=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(S.minimumWorld,S.maximumWorld,this.hd),this._submeshesOctree};class f{constructor(b){this.name=a.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new N.c(S.tX.Zero(),new S.tX(1,1,1)),(b=b||w.e.LastCreatedScene)&&(this.WX=b,this.WX.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.WX.getActiveSubMeshCandidates=b=>this.getActiveSubMeshCandidates(b),this.WX.getCollidingSubMeshCandidates=(b,X)=>this.getCollidingSubMeshCandidates(b,X),this.WX.getIntersectingSubMeshCandidates=(b,X)=>this.getIntersectingSubMeshCandidates(b,X))}register(){this.WX.onMeshRemovedObservable.add((b=>{const X=this.WX.selectionOctree;if(void 0!==X&&null!==X){const P=X.NO.indexOf(b);-1!==P&&X.NO.splice(P,1)}})),this.WX.onMeshImportedObservable.add((b=>{const X=this.WX.selectionOctree;void 0!==X&&null!==X&&X.rw(b)}))}getActiveMeshCandidates(){var b;return(null===(b=this.WX.SO)||void 0===b?void 0:b.select(this.WX.frustumPlanes))||this.WX._getDefaultMeshCandidates()}getActiveSubMeshCandidates(b){if(b._submeshesOctree&&b.useOctreeForRenderingSelection){return b._submeshesOctree.select(this.WX.frustumPlanes)}return this.WX._getDefaultSubMeshCandidates(b)}getIntersectingSubMeshCandidates(b,X){if(b._submeshesOctree&&b.useOctreeForPicking){N.c.TransformToRef(X,b.getWorldMatrix(),this._tempRay);return b._submeshesOctree.intersectsRay(this._tempRay)}return this.WX._getDefaultSubMeshCandidates(b)}getCollidingSubMeshCandidates(b,X){if(b._submeshesOctree&&b.useOctreeForCollisions){const P=X._velocityWorldLength+Math.max(X._radius.x,X._radius.y,X._radius.z);return b._submeshesOctree.intersects(X._basePointWorld,P)}return this.WX._getDefaultSubMeshCandidates(b)}rebuild(){}dispose(){}}},13320:(b,X,P)=>{"use strict";P.d(X,{c:()=>Y});var Q=P(12093),S=P(12328),d=P(11836),N=P(11834),a=P(11841),u=P(12188),w=P(12130),f=P(11732),O=P(12150);const e={internalPickerForMesh:void 0};class Y{constructor(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.c;this.origin=b,this.direction=X,this.length=P,this.epsilon=Q}clone(){return new Y(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const Q=Y._TmpVector3[0].sd(b.x-P,b.y-P,b.z-P),S=Y._TmpVector3[1].sd(X.x+P,X.y+P,X.z+P);let d,N,a,u,w=0,f=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<Q.x||this.origin.x>S.x)return!1}else if(d=1/this.direction.x,N=(Q.x-this.origin.x)*d,a=(S.x-this.origin.x)*d,a===-1/0&&(a=1/0),N>a&&(u=N,N=a,a=u),w=Math.max(N,w),f=Math.min(a,f),w>f)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<Q.y||this.origin.y>S.y)return!1}else if(d=1/this.direction.y,N=(Q.y-this.origin.y)*d,a=(S.y-this.origin.y)*d,a===-1/0&&(a=1/0),N>a&&(u=N,N=a,a=u),w=Math.max(N,w),f=Math.min(a,f),w>f)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<Q.z||this.origin.z>S.z)return!1}else if(d=1/this.direction.z,N=(Q.z-this.origin.z)*d,a=(S.z-this.origin.z)*d,a===-1/0&&(a=1/0),N>a&&(u=N,N=a,a=u),w=Math.max(N,w),f=Math.min(a,f),w>f)return!1;return!0}intersectsBox(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(b.minimum,b.maximum,X)}intersectsSphere(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const P=b.center.x-this.origin.x,Q=b.center.y-this.origin.y,S=b.center.z-this.origin.z,d=P*P+Q*Q+S*S,N=b.radius+X,a=N*N;if(d<=a)return!0;const u=P*this.direction.x+Q*this.direction.y+S*this.direction.z;if(u<0)return!1;return d-u*u<=a}intersectsTriangle(b,X,P){const Q=Y._TmpVector3[0],S=Y._TmpVector3[1],d=Y._TmpVector3[2],a=Y._TmpVector3[3],w=Y._TmpVector3[4];X.subtractToRef(b,Q),P.subtractToRef(b,S),N.tX.CrossToRef(this.direction,S,d);const f=N.tX.Dot(Q,d);if(0===f)return null;const O=1/f;this.origin.subtractToRef(b,a);const e=N.tX.Dot(a,d)*O;if(e<-this.epsilon||e>1+this.epsilon)return null;N.tX.CrossToRef(a,Q,w);const D=N.tX.Dot(this.direction,w)*O;if(D<-this.epsilon||e+D>1+this.epsilon)return null;const E=N.tX.Dot(S,w)*O;return E>this.length?null:new u.d(1-e-D,e,E)}intersectsPlane(b){let X;const P=N.tX.Dot(b.normal,this.direction);if(Math.abs(P)<9.99999997475243e-7)return null;{const Q=N.tX.Dot(b.normal,this.origin);return X=(-b.d-Q)/P,X<0?X<-9.99999997475243e-7?null:0:X}}intersectsAxis(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(b){case"y":{const b=(this.origin.y-X)/this.direction.y;return b>0?null:new N.tX(this.origin.x+this.direction.x*-b,X,this.origin.z+this.direction.z*-b)}case"x":{const b=(this.origin.x-X)/this.direction.x;return b>0?null:new N.tX(X,this.origin.y+this.direction.y*-b,this.origin.z+this.direction.z*-b)}case"z":{const b=(this.origin.z-X)/this.direction.z;return b>0?null:new N.tX(this.origin.x+this.direction.x*-b,this.origin.y+this.direction.y*-b,X)}default:return null}}intersectsMesh(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=N.TmpVectors.Matrix[0];return b.getWorldMatrix().invertToRef(a),this._tmpRay?Y.TransformToRef(this,a,this._tmpRay):this._tmpRay=Y.Transform(this,a),b.intersects(this._tmpRay,X,P,Q,S,d)}intersectsMeshes(b,X,P){P?P.length=0:P=[];for(let Q=0;Q<b.length;Q++){const S=this.intersectsMesh(b[Q],X);S.hit&&P.push(S)}return P.sort(this._comparePickingInfo),P}_comparePickingInfo(b,X){return b.distance<X.distance?-1:b.distance>X.distance?1:0}intersectionSegment(b,X,P){const Q=this.origin,S=N.TmpVectors.tX[0],d=N.TmpVectors.tX[1],a=N.TmpVectors.tX[2],u=N.TmpVectors.tX[3];X.subtractToRef(b,S),this.direction.scaleToRef(Y._Rayl,a),Q.addToRef(a,d),b.subtractToRef(Q,u);const w=N.tX.Dot(S,S),f=N.tX.Dot(S,a),O=N.tX.Dot(a,a),e=N.tX.Dot(S,u),D=N.tX.Dot(a,u),E=w*O-f*f;let t,B,W=E,n=E;E<Y._Smallnum?(t=0,W=1,B=D,n=O):(t=f*D-O*e,B=w*D-f*e,t<0?(t=0,B=D,n=O):t>W&&(t=W,B=D+f,n=O)),B<0?(B=0,-e<0?t=0:-e>w?t=W:(t=-e,W=w)):B>n&&(B=n,-e+f<0?t=0:-e+f>w?t=W:(t=-e+f,W=w));const y=Math.abs(t)<Y._Smallnum?0:t/W,h=Math.abs(B)<Y._Smallnum?0:B/n,L=N.TmpVectors.tX[4];a.scaleToRef(h,L);const Z=N.TmpVectors.tX[5];S.scaleToRef(y,Z),Z.addInPlace(u);const v=N.TmpVectors.tX[6];Z.subtractToRef(L,v);return h>0&&h<=this.length&&v.lengthSquared()<P*P?Z.length():-1}update(b,X,P,Q,S,d,a){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){Y._RayDistant||(Y._RayDistant=Y.Zero()),Y._RayDistant.unprojectRayToRef(b,X,P,Q,N.Matrix.IdentityReadOnly,d,a);const u=N.TmpVectors.Matrix[0];S.invertToRef(u),Y.TransformToRef(Y._RayDistant,u,this)}else this.unprojectRayToRef(b,X,P,Q,S,d,a);return this}static Zero(){return new Y(N.tX.Zero(),N.tX.Zero())}static CreateNew(b,X,P,Q,S,d,N){return Y.Zero().update(b,X,P,Q,S,d,N)}static CreateNewFromTo(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N.Matrix.IdentityReadOnly;const Q=new Y(new N.tX(0,0,0),new N.tX(0,0,0));return Y.CreateFromToToRef(b,X,Q,P)}static CreateFromToToRef(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N.Matrix.IdentityReadOnly;P.origin.N(b);const S=X.subtractToRef(b,P.direction),d=Math.sqrt(S.x*S.x+S.y*S.y+S.z*S.z);return P.length=d,P.direction.normalize(),Y.TransformToRef(P,Q,P)}static Transform(b,X){const P=new Y(new N.tX(0,0,0),new N.tX(0,0,0));return Y.TransformToRef(b,X,P),P}static TransformToRef(b,X,P){N.tX.TransformCoordinatesToRef(b.origin,X,P.origin),N.tX.TransformNormalToRef(b.direction,X,P.direction),P.length=b.length,P.epsilon=b.epsilon;const Q=P.direction,S=Q.length();if(0!==S&&1!==S){const b=1/S;Q.x*=b,Q.y*=b,Q.z*=b,P.length*=S}return P}unprojectRayToRef(b,X,P,Q,S,d,a){const u=N.TmpVectors.Matrix[0];S.multiplyToRef(d,u),u.multiplyToRef(a,u),u.invert();const w=f.e.LastCreatedEngine,O=N.TmpVectors.tX[0];O.x=b/P*2-1,O.y=-(X/Q*2-1),O.z=null!==w&&void 0!==w&&w.useReverseDepthBuffer?1:null!==w&&void 0!==w&&w.isNDCHalfZRange?0:-1;const e=N.TmpVectors.tX[1].sd(O.x,O.y,1-1e-8),Y=N.TmpVectors.tX[2],D=N.TmpVectors.tX[3];N.tX._UnprojectFromInvertedMatrixToRef(O,u,Y),N.tX._UnprojectFromInvertedMatrixToRef(e,u,D),this.origin.N(Y),D.subtractToRef(Y,this.direction),this.direction.normalize()}}function D(b,X,P,Q,S){let d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const N=Y.Zero();return E(b,X,P,Q,N,S,d),N}function E(b,X,P,Q,S,d){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const w=b.getEngine();if(!d&&!(d=b.activeCamera))return b;const f=d.viewport,O=w.getRenderHeight(),{x:e,y:Y,width:D,height:E}=f.toGlobal(w.getRenderWidth(),O),t=1/w.getHardwareScalingLevel();return X=X*t-e,P=P*t-(O-Y-E),S.update(X,P,D,E,Q||N.Matrix.IdentityReadOnly,a?N.Matrix.IdentityReadOnly:d.getViewMatrix(),d.getProjectionMatrix(),u),b}function t(b,X,P,Q,S){if(!w.d)return b;const d=b.getEngine();if(!S&&!(S=b.activeCamera))throw new Error("Active camera not set");const a=S.viewport,u=d.getRenderHeight(),{x:f,y:O,width:e,height:Y}=a.toGlobal(d.getRenderWidth(),u),D=N.Matrix.Identity(),E=1/d.getHardwareScalingLevel();return X=X*E-f,P=P*E-(u-O-Y),Q.update(X,P,e,Y,D,D,S.getProjectionMatrix()),b}function B(b,X,P,Q,S,d,N,a){const u=X(Q,P.enableDistantPicking),w=P.intersects(u,S,N,d,Q,a);return w&&w.hit?!S&&null!=b&&w.distance>=b.distance?null:w:null}function W(b,X,P,Q,S,d){let a=null;const u=!!(b.activeCameras&&b.activeCameras.length>1&&b.cameraToUseForPointers!==b.activeCamera),f=b.cameraToUseForPointers||b.activeCamera,O=e.internalPickerForMesh||B;for(let w=0;w<b.meshes.length;w++){const e=b.meshes[w];if(P){if(!P(e,-1))continue}else if(!e.isEnabled()||!e.isVisible||!e.iu)continue;const Y=u&&e.isWorldMatrixCameraDependent(),D=e.pd(Y,f);if(e.hasThinInstances&&e.Ow){const b=O(a,X,e,D,!0,!0,d);if(b){if(S)return b;const u=N.TmpVectors.Matrix[1],w=e.thinInstanceGetWorldMatrices();for(let b=0;b<w.length;b++){if(P&&!P(e,b))continue;w[b].multiplyToRef(D,u);const N=O(a,X,e,u,Q,S,d,!0);if(N&&(a=N,a.thinInstanceIndex=b,Q))return a}}}else{const b=O(a,X,e,D,Q,S,d);if(b&&(a=b,Q))return a}}return a||new w.d}function n(b,X,P,Q){if(!w.d)return null;const S=[],d=!!(b.activeCameras&&b.activeCameras.length>1&&b.cameraToUseForPointers!==b.activeCamera),a=b.cameraToUseForPointers||b.activeCamera,u=e.internalPickerForMesh||B;for(let w=0;w<b.meshes.length;w++){const f=b.meshes[w];if(P){if(!P(f,-1))continue}else if(!f.isEnabled()||!f.isVisible||!f.iu)continue;const O=d&&f.isWorldMatrixCameraDependent(),e=f.pd(O,a);if(f.hasThinInstances&&f.Ow){if(u(null,X,f,e,!0,!0,Q)){const b=N.TmpVectors.Matrix[1],d=f.thinInstanceGetWorldMatrices();for(let N=0;N<d.length;N++){if(P&&!P(f,N))continue;d[N].multiplyToRef(e,b);const a=u(null,X,f,b,!1,!1,Q,!0);a&&(a.thinInstanceIndex=N,S.push(a))}}}else{const b=u(null,X,f,e,!1,!1,Q);b&&S.push(b)}}return S}function y(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,Q=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0;Q||(Q=b.getWorldMatrix()),X.length=P,S?X.origin.N(S):X.origin.N(b.position);const d=N.TmpVectors.tX[2];d.set(0,0,b._scene.useRightHandedSystem?-1:1);const a=N.TmpVectors.tX[3];return N.tX.TransformNormalToRef(d,Q,a),N.tX.NormalizeToRef(a,X.direction),X}var h,L;Y._TmpVector3=(0,a.b)(6,N.tX.Zero),Y._RayDistant=Y.Zero(),Y._Smallnum=1e-8,Y._Rayl=1e9,h=Q.e,(L=S.c)&&(L.prototype.getForwardRay=function(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,X=arguments.length>1?arguments[1]:void 0,P=arguments.length>2?arguments[2]:void 0;return y(this,new Y(N.tX.Zero(),N.tX.Zero(),b),b,X,P)},L.prototype.getForwardRayToRef=function(b){return y(this,b,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),h&&(O.e._IsPickingAvailable=!0,h.prototype.createPickingRay=function(b,X,P,Q){return D(this,b,X,P,Q,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),Q.e.prototype.createPickingRayToRef=function(b,X,P,Q,S){return E(this,b,X,P,Q,S,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},Q.e.prototype.createPickingRayInCameraSpace=function(b,X,P){return function(b,X,P,Q){const S=Y.Zero();return t(b,X,P,S,Q),S}(this,b,X,P)},Q.e.prototype.createPickingRayInCameraSpaceToRef=function(b,X,P,Q){return t(this,b,X,P,Q)},Q.e.prototype.pickWithBoundingInfo=function(b,X,P,Q,S){return function(b,X,P,Q,S,d){if(!w.d)return null;const a=W(b,(Q=>(b._tempPickingRay||(b._tempPickingRay=Y.Zero()),E(b,X,P,Q,b._tempPickingRay,d||null),b._tempPickingRay)),Q,S,!0);return a&&(a.ray=D(b,X,P,N.Matrix.Identity(),d||null)),a}(this,b,X,P,Q,S)},Q.e.prototype.EP=function(b,X,P,Q,S,d){return function(b,X,P,Q,S,d,a){const u=W(b,((Q,S)=>(b._tempPickingRay||(b._tempPickingRay=Y.Zero()),E(b,X,P,Q,b._tempPickingRay,d||null,!1,S),b._tempPickingRay)),Q,S,!1,a);return u&&(u.ray=D(b,X,P,N.Matrix.Identity(),d||null)),u}(this,b,X,P,Q,S,d)},Q.e.prototype.pickWithRay=function(b,X,P,Q){return function(b,X,P,Q,S){const d=W(b,(P=>(b._pickWithRayInverseMatrix||(b._pickWithRayInverseMatrix=N.Matrix.Identity()),P.invertToRef(b._pickWithRayInverseMatrix),b._cachedRayForTransform||(b._cachedRayForTransform=Y.Zero()),Y.TransformToRef(X,b._pickWithRayInverseMatrix,b._cachedRayForTransform),b._cachedRayForTransform)),P,Q,!1,S);return d&&(d.ray=X),d}(this,b,X,P,Q)},Q.e.prototype.multiPick=function(b,X,P,Q,S){return function(b,X,P,Q,S,d){return n(b,(Q=>D(b,X,P,Q,S||null)),Q,d)}(this,b,X,P,Q,S)},Q.e.prototype.multiPickWithRay=function(b,X,P){return function(b,X,P,Q){return n(b,(P=>(b._pickWithRayInverseMatrix||(b._pickWithRayInverseMatrix=N.Matrix.Identity()),P.invertToRef(b._pickWithRayInverseMatrix),b._cachedRayForTransform||(b._cachedRayForTransform=Y.Zero()),Y.TransformToRef(X,b._pickWithRayInverseMatrix,b._cachedRayForTransform),b._cachedRayForTransform)),P,Q)}(this,b,X,P)}},13595:(b,X,P)=>{"use strict";var Q=P(11787),S=P(11700),d=P(11738),N=P(11804),a=P(11760),u=P(11792);a.c.prototype._partialLoadFile=function(b,X,P,Q){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(b,(b=>{P[X]=b,P._internalCount++,6===P._internalCount&&Q(P)}),void 0,void 0,!0,((b,X)=>{S&&b&&S(b.status+" "+b.statusText,X)}))},a.c.prototype._cascadeLoadFiles=function(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const S=[];S._internalCount=0;for(let d=0;d<6;d++)this._partialLoadFile(P[d],d,S,X,Q)},a.c.prototype._cascadeLoadImgs=function(b,X,P,Q){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5?arguments[5]:void 0;const N=[];N._internalCount=0;for(let a=0;a<6;a++)this._partialLoadImg(Q[a],a,N,b,X,P,S,d)},a.c.prototype._partialLoadImg=function(b,X,P,Q,S,a){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7?arguments[7]:void 0;const f=(0,N.b)();(0,d.p)(b,(b=>{P[X]=b,P._internalCount++,Q&&Q.removePendingData(f),6===P._internalCount&&a&&a(S,P)}),((b,X)=>{Q&&Q.removePendingData(f),u&&u(b,X)}),Q?Q.offlineProvider:null,w),Q&&Q.addPendingData(f)},a.c.prototype.createCubeTextureBase=function(b,X,P,d){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6?arguments[6]:void 0,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8],e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,t=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,B=arguments.length>14&&void 0!==arguments[14]&&arguments[14],W=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const n=D||new Q.e(this,7);n.isCube=!0,n.url=b,n.generateMipMaps=!d,n._lodGenerationScale=e,n._lodGenerationOffset=Y,n._useSRGBBuffer=!!B&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!d),n!==D&&(n.label=b.substring(0,60)),this._doNotHandleContextLost||(n._extension=f,n._files=P,n._buffer=W);const y=b;this._transformTextureUrl&&!D&&(b=this._transformTextureUrl(b));const h=f??function(b){const X=b.split("?")[0],P=X.lastIndexOf(".");return P>-1?X.substring(P).toLowerCase():""}(b),L=(0,u.e)(h),Z=(b,X)=>{n.dispose(),a?a(b,X):b&&S.b.Warn(b)},v=(Q,a)=>{b===y?Q&&Z(Q.status+" "+Q.statusText,a):(S.b.Warn(`Failed to load ${b}, falling back to the ${y}`),this.createCubeTextureBase(y,X,P,!!d,N,Z,w,f,O,e,Y,n,E,t,B,W))};if(L)L.then((Q=>{const S=b=>{E&&E(n,b),Q.loadCubeData(b,n,O,N,((b,X)=>{Z(b,X)}))};W?S(W):P&&6===P.length?Q.supportCascades?this._cascadeLoadFiles(X,(b=>S(b.map((b=>new Uint8Array(b))))),P,Z):Z("Textures type does not support cascades."):this._loadFile(b,(b=>S(new Uint8Array(b))),void 0,void 0,!0,v)}));else{if(!P||0===P.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(X,n,((b,X)=>{t&&t(b,X)}),P,Z)}return this._internalTexturesCache.push(n),n}},14167:(b,X,P)=>{"use strict";P(11700);var Q=P(11973);P(11787),P(11916),P(11784),P(12017),P(11978);Q.b},13623:(b,X,P)=>{"use strict";P.d(X,{c:()=>S});var Q=P(11802);class S{constructor(b){this.value=this._toInt(b)}_toInt(b){return 0|b}add(b){return new S(this.value+b.value)}BX(b){return new S(this.value-b.value)}multiply(b){return new S(Math.imul(this.value,b.value))}divide(b){return new S(this.value/b.value)}getClassName(){return S.ClassName}equals(b){return this.value===b.value}static FromValue(b){return new S(b)}toString(){return this.value.toString()}}S.ClassName="FlowGraphInteger",(0,Q.h)("FlowGraphInteger",S)},13633:(b,X,P)=>{"use strict";P.d(X,{d:()=>S,e:()=>d});var Q=P(11834);class S{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.wd=b}get m(){return this.wd}transformVector(b){return this.transformVectorToRef(b,new Q.Vector2)}transformVectorToRef(b,X){return X.x=b.x*this.wd[0]+b.y*this.wd[1],X.y=b.x*this.wd[2]+b.y*this.wd[3],X}Zd(){return this.toArray()}toArray(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let X=0;X<4;X++)b[X]=this.wd[X];return b}tP(b){for(let X=0;X<4;X++)this.wd[X]=b[X];return this}multiplyToRef(b,X){const P=b.wd,Q=this.wd,S=X.wd;return S[0]=P[0]*Q[0]+P[1]*Q[2],S[1]=P[0]*Q[1]+P[1]*Q[3],S[2]=P[2]*Q[0]+P[3]*Q[2],S[3]=P[2]*Q[1]+P[3]*Q[3],X}multiply(b){return this.multiplyToRef(b,new S)}divideToRef(b,X){const P=this.wd,Q=b.wd,S=X.wd;return S[0]=P[0]/Q[0],S[1]=P[1]/Q[1],S[2]=P[2]/Q[2],S[3]=P[3]/Q[3],X}divide(b){return this.divideToRef(b,new S)}addToRef(b,X){const P=this.wd,Q=b.m,S=X.m;return S[0]=P[0]+Q[0],S[1]=P[1]+Q[1],S[2]=P[2]+Q[2],S[3]=P[3]+Q[3],X}add(b){return this.addToRef(b,new S)}subtractToRef(b,X){const P=this.wd,Q=b.m,S=X.m;return S[0]=P[0]-Q[0],S[1]=P[1]-Q[1],S[2]=P[2]-Q[2],S[3]=P[3]-Q[3],X}BX(b){return this.subtractToRef(b,new S)}transpose(){const b=this.wd;return new S([b[0],b[2],b[1],b[3]])}determinant(){const b=this.wd;return b[0]*b[3]-b[1]*b[2]}inverse(){const b=this.determinant();if(0===b)throw new Error("Matrix is not invertible");const X=this.wd,P=1/b;return new S([X[3]*P,-X[1]*P,-X[2]*P,X[0]*P])}equals(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const P=this.wd,Q=b.m;return 0===X?P[0]===Q[0]&&P[1]===Q[1]&&P[2]===Q[2]&&P[3]===Q[3]:Math.abs(P[0]-Q[0])<X&&Math.abs(P[1]-Q[1])<X&&Math.abs(P[2]-Q[2])<X&&Math.abs(P[3]-Q[3])<X}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.wd.join(", ")})`}}class d{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.wd=b}get m(){return this.wd}transformVector(b){return this.transformVectorToRef(b,new Q.tX)}transformVectorToRef(b,X){const P=this.wd;return X.x=b.x*P[0]+b.y*P[1]+b.z*P[2],X.y=b.x*P[3]+b.y*P[4]+b.z*P[5],X.z=b.x*P[6]+b.y*P[7]+b.z*P[8],X}multiplyToRef(b,X){const P=b.wd,Q=this.wd,S=X.m;return S[0]=P[0]*Q[0]+P[1]*Q[3]+P[2]*Q[6],S[1]=P[0]*Q[1]+P[1]*Q[4]+P[2]*Q[7],S[2]=P[0]*Q[2]+P[1]*Q[5]+P[2]*Q[8],S[3]=P[3]*Q[0]+P[4]*Q[3]+P[5]*Q[6],S[4]=P[3]*Q[1]+P[4]*Q[4]+P[5]*Q[7],S[5]=P[3]*Q[2]+P[4]*Q[5]+P[5]*Q[8],S[6]=P[6]*Q[0]+P[7]*Q[3]+P[8]*Q[6],S[7]=P[6]*Q[1]+P[7]*Q[4]+P[8]*Q[7],S[8]=P[6]*Q[2]+P[7]*Q[5]+P[8]*Q[8],X}multiply(b){return this.multiplyToRef(b,new d)}divideToRef(b,X){const P=this.wd,Q=b.m,S=X.m;return S[0]=P[0]/Q[0],S[1]=P[1]/Q[1],S[2]=P[2]/Q[2],S[3]=P[3]/Q[3],S[4]=P[4]/Q[4],S[5]=P[5]/Q[5],S[6]=P[6]/Q[6],S[7]=P[7]/Q[7],S[8]=P[8]/Q[8],X}divide(b){return this.divideToRef(b,new d)}addToRef(b,X){const P=this.wd,Q=b.m,S=X.m;return S[0]=P[0]+Q[0],S[1]=P[1]+Q[1],S[2]=P[2]+Q[2],S[3]=P[3]+Q[3],S[4]=P[4]+Q[4],S[5]=P[5]+Q[5],S[6]=P[6]+Q[6],S[7]=P[7]+Q[7],S[8]=P[8]+Q[8],X}add(b){return this.addToRef(b,new d)}subtractToRef(b,X){const P=this.wd,Q=b.m,S=X.m;return S[0]=P[0]-Q[0],S[1]=P[1]-Q[1],S[2]=P[2]-Q[2],S[3]=P[3]-Q[3],S[4]=P[4]-Q[4],S[5]=P[5]-Q[5],S[6]=P[6]-Q[6],S[7]=P[7]-Q[7],S[8]=P[8]-Q[8],X}BX(b){return this.subtractToRef(b,new d)}toArray(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let X=0;X<9;X++)b[X]=this.wd[X];return b}Zd(){return this.toArray()}tP(b){for(let X=0;X<9;X++)this.wd[X]=b[X];return this}transpose(){const b=this.wd;return new d([b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]])}determinant(){const b=this.wd;return b[0]*(b[4]*b[8]-b[5]*b[7])-b[1]*(b[3]*b[8]-b[5]*b[6])+b[2]*(b[3]*b[7]-b[4]*b[6])}inverse(){const b=this.determinant();if(0===b)throw new Error("Matrix is not invertible");const X=this.wd,P=1/b;return new d([(X[4]*X[8]-X[5]*X[7])*P,(X[2]*X[7]-X[1]*X[8])*P,(X[1]*X[5]-X[2]*X[4])*P,(X[5]*X[6]-X[3]*X[8])*P,(X[0]*X[8]-X[2]*X[6])*P,(X[2]*X[3]-X[0]*X[5])*P,(X[3]*X[7]-X[4]*X[6])*P,(X[1]*X[6]-X[0]*X[7])*P,(X[0]*X[4]-X[1]*X[3])*P])}equals(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const P=this.wd,Q=b.m;return 0===X?P[0]===Q[0]&&P[1]===Q[1]&&P[2]===Q[2]&&P[3]===Q[3]&&P[4]===Q[4]&&P[5]===Q[5]&&P[6]===Q[6]&&P[7]===Q[7]&&P[8]===Q[8]:Math.abs(P[0]-Q[0])<X&&Math.abs(P[1]-Q[1])<X&&Math.abs(P[2]-Q[2])<X&&Math.abs(P[3]-Q[3])<X&&Math.abs(P[4]-Q[4])<X&&Math.abs(P[5]-Q[5])<X&&Math.abs(P[6]-Q[6])<X&&Math.abs(P[7]-Q[7])<X&&Math.abs(P[8]-Q[8])<X}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.wd.join(", ")})`}}},13636:(b,X,P)=>{"use strict";var Q;function S(b,X,P,Q){switch(X){case"Animation":return Q?b.animations.find((b=>b.uniqueId===P))??null:b.animations[P]??null;case"AnimationGroup":return Q?b.animationGroups.find((b=>b.uniqueId===P))??null:b.animationGroups[P]??null;case"Mesh":return Q?b.meshes.find((b=>b.uniqueId===P))??null:b.meshes[P]??null;case"Material":return Q?b.materials.find((b=>b.uniqueId===P))??null:b.materials[P]??null;case"Nf":return Q?b.cameras.find((b=>b.uniqueId===P))??null:b.cameras[P]??null;case"Light":return Q?b.lights.find((b=>b.uniqueId===P))??null:b.lights[P]??null;default:return null}}P.d(X,{c:()=>S}),function(b){b.Animation="Animation",b.AnimationGroup="AnimationGroup",b.Mesh="Mesh",b.Material="Material",b.Nf="Nf",b.Light="Light"}(Q||(Q={}))},13670:(b,X,P)=>{"use strict";P.d(X,{b:()=>S});var Q=P(13678);class S extends Q.b{constructor(b,X){if(super(b),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),X)for(const P of X)this._eventsSignalOutputs[P]=this._registerSignalOutput(P+"Event")}_executeOnTick(b){}_startPendingTasks(b){b._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(b),this._resetAfterCanceled(b)),this._preparePendingTasks(b),b._addPendingBlock(this),this.out._activateSignal(b),b._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(b){b._deleteExecutionVariable(this,"_initialized"),b._removePendingBlock(this)}}},13647:(b,X,P)=>{"use strict";P.d(X,{c:()=>w});var Q=P(11804),S=P(11802),d=P(13651),N=P(11694),a=P(13617);class u extends d.c{constructor(b,X,P,Q){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Q.defaultValue,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(b,X,P),this.richType=Q,this._defaultValue=S,this._optional=d,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new N.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(b){this._isDisabled!==b&&(this._isDisabled=b,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(b,X){X._getConnectionValue(this)!==b&&(X._setConnectionValue(this,b),this.onValueChangedObservable.notifyObservers(b))}resetToDefaultValue(b){b._setConnectionValue(this,this._defaultValue)}connectTo(b){this._isDisabled||super.connectTo(b)}_getValueOrDefault(b){const X=b._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(X):X}getValue(b){if(1===this.connectionType){b._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(b);const X=this._getValueOrDefault(b);return this._lastValue=X,this.richType.typeTransformer?this.richType.typeTransformer(X):X}const X=this.isConnected()?this._connectedPoint[0].getValue(b):this._getValueOrDefault(b);return this._lastValue=X,this.richType.typeTransformer?this.richType.typeTransformer(X):X}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(b),b.richType={},this.richType.serialize(b.richType),b.optional=this._optional,(0,a.d)("defaultValue",this._defaultValue,b)}}(0,S.h)("FlowGraphDataConnection",u);class w{constructor(b){var X;this.config=b,this.uniqueId=(0,Q.b)(),this.name=(null===(X=this.config)||void 0===X?void 0:X.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(b){}registerDataInput(b,X,P){const Q=new u(b,0,this,X,P);return this.dataInputs.push(Q),Q}registerDataOutput(b,X,P){const Q=new u(b,1,this,X,P);return this.dataOutputs.push(Q),Q}getDataInput(b){return this.dataInputs.find((X=>X.name===b))}getDataOutput(b){return this.dataOutputs.find((X=>X.name===b))}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.d;if(b.uniqueId=this.uniqueId,b.config={},this.config){const P=this.config,Q=Object.keys(P);for(const S of Q)X(S,P[S],b.config)}b.dataInputs=[],b.dataOutputs=[],b.className=this.getClassName();for(const P of this.dataInputs){const X={};P.serialize(X),b.dataInputs.push(X)}for(const P of this.dataOutputs){const X={};P.serialize(X),b.dataOutputs.push(X)}}deserialize(b){}_log(b,X,P){var Q;null===(Q=b.logger)||void 0===Q||Q.addLogItem({action:X,BP:P,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13651:(b,X,P)=>{"use strict";P.d(X,{c:()=>d});var Q,S=P(11804);!function(b){b[b.Input=0]="Input",b[b.Output=1]="Output"}(Q||(Q={}));class d{constructor(b,X,P){this._ownerBlock=P,this._connectedPoint=[],this.uniqueId=(0,S.b)(),this.connectedPointIds=[],this.name=b,this._connectionType=X}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(b){if(this._connectionType===b._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||b._isSingularConnection()&&b._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(b),b._connectedPoint.push(this)}disconnectFrom(b){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const P=this._connectedPoint.indexOf(b),Q=b._connectedPoint.indexOf(this);-1!==P&&-1!==Q&&(X&&this._connectedPoint.splice(P,1),b._connectedPoint.splice(Q,1))}disconnectFromAll(){for(const b of this._connectedPoint)this.disconnectFrom(b,!1);this._connectedPoint.length=0}dispose(){for(const b of this._connectedPoint)this.disconnectFrom(b)}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b.uniqueId=this.uniqueId,b.name=this.name,b._connectionType=this._connectionType,b.connectedPointIds=[],b.className=this.getClassName();for(const X of this._connectedPoint)b.connectedPointIds.push(X.uniqueId)}getClassName(){return"FGConnection"}deserialize(b){this.uniqueId=b.uniqueId,this.name=b.name,this._connectionType=b._connectionType,this.connectedPointIds=b.connectedPointIds}}},13612:(b,X,P)=>{"use strict";P.d(X,{c:()=>n});var Q,S=P(11694),d=P(11822),N=P(11825),a=P(11804),u=P(13617),w=P(13636),f=P(11700);!function(b){b.ExecuteBlock="ExecuteBlock",b.ExecuteEvent="ExecuteEvent",b.TriggerConnection="TriggerConnection",b.ContextVariableSet="ContextVariableSet",b.GlobalVariableSet="GlobalVariableSet",b.GlobalVariableDelete="GlobalVariableDelete",b.GlobalVariableGet="GlobalVariableGet",b.AddConnection="AddConnection",b.GetConnectionValue="GetConnectionValue",b.SetConnectionValue="SetConnectionValue",b.ActivateSignal="ActivateSignal",b.ContextVariableGet="ContextVariableGet"}(Q||(Q={}));class O{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(b){if(b.time||(b.time=Date.now()),this.log.push(b),this.logToConsole){var X;const P=null===(X=b.BP)||void 0===X?void 0:X.value;"object"===typeof P&&P.getClassName?f.b.Log(`[FGLog] ${b.className}:${b.uniqueId.split("-")[0]} ${b.action} - ${JSON.stringify(P.getClassName())}: ${P.toString()}`):f.b.Log(`[FGLog] ${b.className}:${b.uniqueId.split("-")[0]} ${b.action} - ${JSON.stringify(b.BP)}`)}}getItemsOfType(b){return this.log.filter((X=>X.action===b))}}class e{get enableLogging(){return this._enableLogging}set enableLogging(b){this._enableLogging!==b&&(this._enableLogging=b,this._enableLogging?(this.logger=new O,this.logger.logToConsole=!0):this.logger=null)}constructor(b){this.uniqueId=(0,a.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new S.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=b,this.assetsContext=b.assetsContext??b.WX}hasVariable(b){return b in this._userVariables}setVariable(b,X){var P;this._userVariables[b]=X,null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",BP:{name:b,value:X}})}getAsset(b,X){return(0,w.c)(this.assetsContext,b,X)}getVariable(b){var X;return null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",BP:{name:b,value:this._userVariables[b]}}),this._userVariables[b]}get userVariables(){return this._userVariables}Ab(){return this._configuration.WX}_getUniqueIdPrefixedName(b,X){return`${b.uniqueId}_${X}`}_getGlobalContextVariable(b,X){var P;return null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",BP:{name:b,defaultValue:X,possibleValue:this._globalContextVariables[b]}}),this._hasGlobalContextVariable(b)?this._globalContextVariables[b]:X}_setGlobalContextVariable(b,X){var P;null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",BP:{name:b,value:X}}),this._globalContextVariables[b]=X}_deleteGlobalContextVariable(b){var X;null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",BP:{name:b}}),delete this._globalContextVariables[b]}_hasGlobalContextVariable(b){return b in this._globalContextVariables}_setExecutionVariable(b,X,P){this._executionVariables[this._getUniqueIdPrefixedName(b,X)]=P}_getExecutionVariable(b,X,P){return this._hasExecutionVariable(b,X)?this._executionVariables[this._getUniqueIdPrefixedName(b,X)]:P}_deleteExecutionVariable(b,X){delete this._executionVariables[this._getUniqueIdPrefixedName(b,X)]}_hasExecutionVariable(b,X){return this._getUniqueIdPrefixedName(b,X)in this._executionVariables}_hasConnectionValue(b){return b.uniqueId in this._connectionValues}_setConnectionValue(b,X){var P;this._connectionValues[b.uniqueId]=X,null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",BP:{connectionPointId:b.uniqueId,value:X}})}_setConnectionValueByKey(b,X){this._connectionValues[b]=X}_getConnectionValue(b){var X;return null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",BP:{connectionPointId:b.uniqueId,value:this._connectionValues[b.uniqueId]}}),this._connectionValues[b.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(b){this._pendingBlocks.includes(b)||(this._pendingBlocks.push(b),this._pendingBlocks.sort(((b,X)=>b.priority-X.priority)))}_removePendingBlock(b){const X=this._pendingBlocks.indexOf(b);-1!==X&&this._pendingBlocks.splice(X,1)}_clearPendingBlocks(){for(const b of this._pendingBlocks)b._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(b){var X;this.onNodeExecutedObservable.notifyObservers(b),null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:b.getClassName(),uniqueId:b.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(b){this._setGlobalContextVariable("timeSinceStart",b.timeSinceStart),this._setGlobalContextVariable("deltaTime",b.deltaTime);for(const P of this._pendingBlocks){var X;null===(X=P._executeOnTick)||void 0===X||X.call(P,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.d;b.uniqueId=this.uniqueId,b._userVariables={};for(const Q in this._userVariables)X(Q,this._userVariables[Q],b._userVariables);b._connectionValues={};for(const Q in this._connectionValues)X(Q,this._connectionValues[Q],b._connectionValues);var P;this.assetsContext!==this.Ab()&&(b._assetsContext={meshes:this.assetsContext.meshes.map((b=>b.id)),materials:this.assetsContext.materials.map((b=>b.id)),textures:this.assetsContext.textures.map((b=>b.name)),animations:this.assetsContext.animations.map((b=>b.name)),lights:this.assetsContext.lights.map((b=>b.id)),cameras:this.assetsContext.cameras.map((b=>b.id)),uY:null===(P=this.assetsContext.uY)||void 0===P?void 0:P.map((b=>b.name)),skeletons:this.assetsContext.skeletons.map((b=>b.id)),Oe:this.assetsContext.Oe.map((b=>b.name)),geometries:this.assetsContext.geometries.map((b=>b.id)),multiMaterials:this.assetsContext.multiMaterials.map((b=>b.id)),transformNodes:this.assetsContext.transformNodes.map((b=>b.id))})}getClassName(){return"FlowGraphContext"}}(0,d.b)([(0,N.E)()],e.prototype,"uniqueId",void 0);var Y=P(13639),D=P(12142);class E{constructor(b){this.onEventTriggeredObservable=new S.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=b,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Nd.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const b=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",BP:{timeSinceStart:this._startingTime,deltaTime:b}}),this._startingTime+=b})),this._meshPickedObserver=this._scene.onPointerObservable.add((b=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",BP:b})}),D.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((b=>{const X=b.pointerId,P=b.mesh,Q=this._pointerUnderMeshState[X];!Q&&P?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",BP:{pointerId:X,mesh:P}}):Q&&!P?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",BP:{pointerId:X,mesh:Q}}):Q&&P&&Q!==P&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",BP:{pointerId:X,mesh:Q,over:P}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",BP:{pointerId:X,mesh:P,out:Q}})),this._pointerUnderMeshState[X]=P}),D.d.POINTERMOVE)}dispose(){var b,X,P,Q,S;null===(b=this._sceneDisposeObserver)||void 0===b||b.remove(),null===(X=this._sceneReadyObserver)||void 0===X||X.remove(),null===(P=this._sceneOnBeforeRenderObserver)||void 0===P||P.remove(),null===(Q=this._meshPickedObserver)||void 0===Q||Q.remove(),null===(S=this._meshUnderPointerObserver)||void 0===S||S.remove(),this.onEventTriggeredObservable.clear()}}var t,B=P(13659);!function(b){b[b.Stopped=0]="Stopped",b[b.Started=1]="Started"}(t||(t={}));class W{get state(){return this._state}set state(b){this._state=b,this.onStateChangedObservable.notifyObservers(b)}constructor(b){this.onStateChangedObservable=new S.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=b.WX,this._sceneEventCoordinator=new E(this._scene),this._coordinator=b.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((b=>{for(const X of this._executionContexts){const P=this._getContextualOrder(b.type,X);for(const Q of P)if(!Q._executeEvent(X,b.BP))break}switch(b.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const X of this._executionContexts)X._notifyOnTick(b.BP);break;case"SceneDispose":this.dispose()}}))}createContext(){const b=new e({WX:this._scene,coordinator:this._coordinator});return this._executionContexts.push(b),b}getContext(b){return this._executionContexts[b]}addEventBlock(b){if("PointerOver"!==b.type&&"PointerOut"!==b.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==b.type&&this._eventBlocks[b.type].push(b),1===this.state)for(const X of this._executionContexts)b._startPendingTasks(X);else this.onStateChangedObservable.addOnce((X=>{if(1===X)for(const P of this._executionContexts)b._startPendingTasks(P)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((b=>{1===b&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const b of this._executionContexts)for(const X in this._eventBlocks){const P=this._getContextualOrder(X,b);for(const X of P)X._startPendingTasks(b)}}_getContextualOrder(b,X){const P=this._eventBlocks[b].sort(((b,X)=>X.initPriority-b.initPriority));if("MeshPick"===b){const b=[];for(const Q of P){const S=Q.asset.getValue(X);let d=0;for(;d<P.length;d++){const b=P[d].asset.getValue(X);if(S&&b&&(0,B.k)(S,b))break}b.splice(d,0,Q)}return b}return P}dispose(){var b;if(0!==this.state){this.state=0;for(const b of this._executionContexts)b._clearPendingBlocks();this._executionContexts.length=0;for(const b in this._eventBlocks)this._eventBlocks[b].length=0;null===(b=this._eventObserver)||void 0===b||b.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(b){const X=[],P=new Set;for(const Q in this._eventBlocks)for(const b of this._eventBlocks[Q])X.push(b),P.add(b.uniqueId);for(;X.length>0;){const Q=X.pop();b(Q);for(const b of Q.dataInputs)for(const Q of b._connectedPoint)P.has(Q._ownerBlock.uniqueId)||(X.push(Q._ownerBlock),P.add(Q._ownerBlock.uniqueId));if(Q instanceof Y.c)for(const b of Q.signalOutputs)for(const Q of b._connectedPoint)P.has(Q._ownerBlock.uniqueId)||(X.push(Q._ownerBlock),P.add(Q._ownerBlock.uniqueId))}}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1?arguments[1]:void 0;b.allBlocks=[],this.visitAllBlocks((X=>{const P={};X.serialize(P),b.allBlocks.push(P)})),b.executionContexts=[];for(const P of this._executionContexts){const Q={};P.serialize(Q,X),b.executionContexts.push(Q)}}}class n{constructor(b){this.config=b,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.WX.Nd.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.WX.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const b=this._executeOnNextFrame.slice(0);if(b.length)for(const X of b){this.notifyCustomEvent(X.id,X.data,!1);const b=this._executeOnNextFrame.findIndex((b=>b.uniqueId===X.uniqueId));-1!==b&&this._executeOnNextFrame.splice(b,1)}}));(n.SceneCoordinators.get(this.config.WX)??[]).push(this)}createGraph(){const b=new W({WX:this.config.WX,coordinator:this});return this._flowGraphs.push(b),b}removeGraph(b){const X=this._flowGraphs.indexOf(b);-1!==X&&(b.dispose(),this._flowGraphs.splice(X,1))}start(){for(const b of this._flowGraphs)b.start()}dispose(){var b,X;for(const S of this._flowGraphs)S.dispose();this._flowGraphs.length=0,null===(b=this._disposeObserver)||void 0===b||b.remove(),null===(X=this._onBeforeRenderObserver)||void 0===X||X.remove();const P=n.SceneCoordinators.get(this.config.WX)??[],Q=P.indexOf(this);-1!==Q&&P.splice(Q,1)}serialize(b,X){b._flowGraphs=[];for(const P of this._flowGraphs){const Q={};P.serialize(Q,X),b._flowGraphs.push(Q)}b.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(b){let X=this._customEventsMap.get(b);return X||(X=new S.d,this._customEventsMap.set(b,X)),X}notifyCustomEvent(b,X){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:b,data:X,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(b)){const X=this._eventExecutionCounter.get(b);if(this._eventExecutionCounter.set(b,X+1),X>=n.MaxEventTypeExecutionPerFrame)return void(X===n.MaxEventTypeExecutionPerFrame&&f.b.Warn(`FlowGraphCoordinator: Too many executions of event "${b}".`))}else this._eventExecutionCounter.set(b,1);const P=this._customEventsMap.get(b);P&&P.notifyObservers(X)}}n.MaxEventsPerType=30,n.MaxEventTypeExecutionPerFrame=30,n.SceneCoordinators=new Map},13665:(b,X,P)=>{"use strict";P.d(X,{b:()=>S});var Q=P(13670);class S extends Q.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(b){b._notifyExecuteNode(this),this.done._activateSignal(b)}}},13639:(b,X,P)=>{"use strict";P.d(X,{c:()=>a});var Q=P(13647),S=P(13651),d=P(11802);class N extends S.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(b){super.connectTo(b),this._connectedPoint.sort(((b,X)=>X.priority-b.priority))}_activateSignal(b){var X;if(null===(X=b.logger)||void 0===X||X.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,BP:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)b._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(b,this),b._increaseExecutionId();else for(const P of this._connectedPoint)P._activateSignal(b)}}(0,d.h)("FlowGraphSignalConnection",N);class a extends Q.c{constructor(b){super(b),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(b){const X=new N(b,0,this);return this.signalInputs.push(X),X}_registerSignalOutput(b){const X=new N(b,1,this);return this.signalOutputs.push(X),X}_unregisterSignalInput(b){const X=this.signalInputs.findIndex((X=>X.name===b));-1!==X&&(this.signalInputs[X].dispose(),this.signalInputs.splice(X,1))}_unregisterSignalOutput(b){const X=this.signalOutputs.findIndex((X=>X.name===b));-1!==X&&(this.signalOutputs[X].dispose(),this.signalOutputs.splice(X,1))}_reportError(b,X){this.error.BP="string"===typeof X?new Error(X):X,this.error._activateSignal(b)}getSignalInput(b){return this.signalInputs.find((X=>X.name===b))}getSignalOutput(b){return this.signalOutputs.find((X=>X.name===b))}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(b),b.signalInputs=[],b.signalOutputs=[];for(const X of this.signalInputs){const P={};X.serialize(P),b.signalInputs.push(P)}for(const X of this.signalOutputs){const P={};X.serialize(P),b.signalOutputs.push(P)}}deserialize(b){for(let X=0;X<b.signalInputs.length;X++){const P=this.getSignalInput(b.signalInputs[X].name);if(!P)throw new Error("Could not find signal input with name "+b.signalInputs[X].name+" in block "+b.className);P.deserialize(b.signalInputs[X])}for(let X=0;X<b.signalOutputs.length;X++){const P=this.getSignalOutput(b.signalOutputs[X].name);if(!P)throw new Error("Could not find signal output with name "+b.signalOutputs[X].name+" in block "+b.className);P.deserialize(b.signalOutputs[X])}}getClassName(){return"FlowGraphExecutionBlock"}}},13678:(b,X,P)=>{"use strict";P.d(X,{b:()=>S});var Q=P(13639);class S extends Q.c{constructor(b){super(b),this.out=this._registerSignalOutput("out")}}},13631:(b,X,P)=>{"use strict";P.d(X,{B:()=>D,C:()=>E,F:()=>A,G:()=>o,H:()=>v,L:()=>Z,e:()=>w,h:()=>e,i:()=>L,k:()=>t,o:()=>B,s:()=>W,t:()=>O,u:()=>h,x:()=>f,y:()=>Y});var Q,S=P(11834),d=P(11878),N=P(13623),a=P(13633);!function(b){b.Any="any",b.String="string",b.Number="number",b.Boolean="boolean",b.Object="object",b.Integer="FlowGraphInteger",b.Vector2="Vector2",b.tX="tX",b.Vector4="Vector4",b.Quaternion="Quaternion",b.Matrix="Matrix",b.Matrix2D="Matrix2D",b.Matrix3D="Matrix3D",b.yX="yX",b.Ba="Ba"}(Q||(Q={}));class u{constructor(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=b,this.defaultValue=X,this.animationType=P}serialize(b){b.typeName=this.typeName,b.defaultValue=this.defaultValue}}const w=new u("any",void 0),f=new u("string",""),O=new u("number",0,0),e=new u("boolean",!1),Y=new u("Vector2",S.Vector2.Zero(),5),D=new u("tX",S.tX.Zero(),1),E=new u("Vector4",S.Vector4.Zero()),t=new u("Matrix",S.Matrix.Identity(),3),B=new u("Matrix2D",new a.d),W=new u("Matrix3D",new a.e),n=new u("yX",d.yX.Black(),4),y=new u("Ba",new d.Ba(0,0,0,0),7),h=new u("Quaternion",S.Quaternion.Identity(),2);h.typeTransformer=b=>{if(b.getClassName){if("Vector4"===b.getClassName())return S.Quaternion.hX(b.Zd());if("tX"===b.getClassName())return S.Quaternion.FromEulerVector(b);if("Matrix"===b.getClassName())return S.Quaternion.FromRotationMatrix(b)}return b};const L=new u("FlowGraphInteger",new N.c(0),0);function Z(b){const X=b;switch(typeof b){case"string":return f;case"number":return O;case"boolean":return e;case"object":if(X.getClassName)switch(X.getClassName()){case"Vector2":return Y;case"tX":return D;case"Vector4":return E;case"Matrix":return t;case"yX":return n;case"Ba":return y;case"Quaternion":return h;case"FlowGraphInteger":return L;case"Matrix2D":return B;case"Matrix3D":return W}return w;default:return w}}function v(b){switch(b){case"string":return f;case"number":return O;case"boolean":return e;case"Vector2":return Y;case"tX":return D;case"Vector4":return E;case"Matrix":return t;case"yX":return n;case"Ba":return y;case"Quaternion":return h;case"FlowGraphInteger":return L;case"Matrix2D":return B;case"Matrix3D":return W;default:return w}}function A(b){switch(b){case"number":default:return 0;case"Vector2":return 5;case"tX":return 1;case"Matrix":return 3;case"yX":return 4;case"Ba":return 7;case"Quaternion":return 2}}function o(b){switch(b){case 0:return O;case 5:return Y;case 1:return D;case 3:return t;case 4:return n;case 7:return y;case 2:return h;default:return w}}},13617:(b,X,P)=>{"use strict";P.d(X,{b:()=>f,d:()=>w,e:()=>O});var Q=P(11878),S=P(11834),d=P(13623),N=P(13631),a=P(13633);function u(b){return"Vector2"===b||"tX"===b||"Vector4"===b||"Quaternion"===b||"yX"===b||"Ba"===b}function w(b,X,P){var Q;const S=(null===X||void 0===X||null===(Q=X.getClassName)||void 0===Q?void 0:Q.call(X))??"";if(u(S)||function(b){return"Matrix"===b||"Matrix2D"===b||"Matrix3D"===b}(S))P[b]={value:X.Zd(),className:S};else if("FlowGraphInteger"===S)P[b]={value:X.value,className:S};else if(S&&(X.id||X.name))P[b]={id:X.id,name:X.name,className:S};else{if("object"===typeof X)throw new Error(`Could not serialize value ${X}`);P[b]=X}}function f(b,X,P,w){const O=X[b];let e;const Y=(null===O||void 0===O?void 0:O.type)??(null===O||void 0===O?void 0:O.className);if(function(b){return"Mesh"===b||"AbstractMesh"===b||"GroundMesh"===b||"InstanceMesh"===b||"LinesMesh"===b||"GoldbergMesh"===b||"GreasedLineMesh"===b||"TrailMesh"===b}(Y)){let b=w.meshes.filter((b=>O.id?b.id===O.id:b.name===O.name));0===b.length&&(b=w.transformNodes.filter((b=>O.id?b.id===O.id:b.name===O.name))),e=O.uniqueId?b.find((b=>b.uniqueId===O.uniqueId)):b[0]}else if(u(Y))e=function(b,X){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===b)return S.Vector2.hX(X);if("tX"===b)return P&&(X[2]*=-1),S.tX.hX(X);if("Vector4"===b)return S.Vector4.hX(X);if("Quaternion"===b)return P&&(X[2]*=-1,X[3]*=-1),S.Quaternion.hX(X);if("yX"===b)return new Q.yX(X[0],X[1],X[2]);if("Ba"===b)return new Q.Ba(X[0],X[1],X[2],X[3]);throw new Error(`Unknown vector class name ${b}`)}(Y,O.value);else if(function(b){return"AnimationGroup"===b}(Y)){const b=w.animationGroups.filter((b=>b.name===O.name));e=1===b.length?b[0]:b.find((b=>b.uniqueId===O.uniqueId))}else e="Matrix"===Y?S.Matrix.hX(O.value):"Matrix2D"===Y?new a.d(O.value):"Matrix3D"===Y?new a.e(O.value):"FlowGraphInteger"===Y?d.c.FromValue(O.value):"number"===Y||"string"===Y||"boolean"===Y?O.value[0]:O&&void 0!==O.value?O.value:Array.isArray(O)?O.reduce(((b,X)=>X.eventData?(b[X.id]={type:(0,N.H)(X.type)},"undefined"!==typeof X.value&&(b[X.id].value=f("value",X,P,w)),b):b),{}):O;return e}function O(b){return"FlowGraphJsonPointerParserBlock"===b}},13659:(b,X,P)=>{"use strict";function Q(b,X){return!(!b.parent||b.parent!==X&&!Q(b.parent,X))}function S(b){if(b.getClassName)return b.getClassName()}function d(b,X){return b===X&&("Vector2"===b||"tX"===b||"Vector4"===b||"Quaternion"===b)}function N(b,X){return b===X&&("Matrix"===b||"Matrix2D"===b||"Matrix3D"===b)}function a(b,X){return"FlowGraphInteger"===b&&"FlowGraphInteger"===X}function u(b,X){const P="number"===typeof b||"number"===typeof(null===b||void 0===b?void 0:b.value);return P&&!X?!isNaN(w(b)):P}function w(b){return"number"===typeof b?b:b.value}P.d(X,{c:()=>a,e:()=>N,f:()=>d,i:()=>S,k:()=>Q,l:()=>w,m:()=>u})},13037:(b,X,P)=>{"use strict";P.r(X),P.d(X,{SceneInstrumentation:()=>d});var Q=P(11689),S=P(12066);class d{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(b){b!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=b,b?(this._onBeforeActiveMeshesEvaluationObserver=this.WX.onBeforeActiveMeshesEvaluationObservable.add((()=>{Q.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.WX.onAfterActiveMeshesEvaluationObservable.add((()=>{Q.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.WX.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.WX.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(b){b!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=b,b?(this._onBeforeRenderTargetsRenderObserver=this.WX.onBeforeRenderTargetsRenderObservable.add((()=>{Q.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.WX.onAfterRenderTargetsRenderObservable.add((()=>{Q.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.WX.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.WX.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(b){b!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=b,b?(this._onBeforeParticlesRenderingObserver=this.WX.onBeforeParticlesRenderingObservable.add((()=>{Q.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.WX.onAfterParticlesRenderingObservable.add((()=>{Q.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.WX.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.WX.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(b){b!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=b,this.WX.spriteManagers&&(b?(this._onBeforeSpritesRenderingObserver=this.WX.onBeforeSpritesRenderingObservable.add((()=>{Q.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.WX.onAfterSpritesRenderingObservable.add((()=>{Q.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.WX.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.WX.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(b){b!==this._capturePhysicsTime&&this.WX.onBeforePhysicsObservable&&(this._capturePhysicsTime=b,b?(this._onBeforePhysicsObserver=this.WX.onBeforePhysicsObservable.add((()=>{Q.Tools.StartPerformanceCounter("tf"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.WX.onAfterPhysicsObservable.add((()=>{Q.Tools.EndPerformanceCounter("tf"),this._physicsTime.endMonitoring()}))):(this.WX.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.WX.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(b){b!==this._captureAnimationsTime&&(this._captureAnimationsTime=b,b?this._onAfterAnimationsObserver=this.WX.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.WX.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(b){this._captureFrameTime=b}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(b){this._captureInterFrameTime=b}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(b){b!==this._captureRenderTime&&(this._captureRenderTime=b,b?(this._onBeforeDrawPhaseObserver=this.WX.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),Q.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.WX.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),Q.Tools.EndPerformanceCounter("Main render")}))):(this.WX.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.WX.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(b){b!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=b,b?(this._onBeforeCameraRenderObserver=this.WX.onBeforeCameraRenderObservable.add((b=>{this._cameraRenderTime.beginMonitoring(),Q.Tools.StartPerformanceCounter(`Rendering camera ${b.name}`)})),this._onAfterCameraRenderObserver=this.WX.onAfterCameraRenderObservable.add((b=>{this._cameraRenderTime.endMonitoring(!1),Q.Tools.EndPerformanceCounter(`Rendering camera ${b.name}`)}))):(this.WX.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.WX.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.WX.getEngine()._drawCalls}constructor(b){this.WX=b,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new S.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new S.c,this._captureFrameTime=!1,this._frameTime=new S.c,this._captureRenderTime=!1,this._renderTime=new S.c,this._captureInterFrameTime=!1,this._interFrameTime=new S.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new S.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new S.c,this._capturePhysicsTime=!1,this._physicsTime=new S.c,this._captureAnimationsTime=!1,this._animationsTime=new S.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new S.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=b.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(Q.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.WX.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=b.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(Q.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.dd(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.dd(),this._captureParticlesRenderTime&&this._particlesRenderTime.dd(),this._captureSpritesRenderTime&&this._spritesRenderTime.dd(),this._captureRenderTime&&this._renderTime.dd(),this._captureCameraRenderTime&&this._cameraRenderTime.dd()}))}dispose(){this._disposed||(this.WX.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.WX.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.WX.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.WX.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.WX.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.WX.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.WX.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.WX.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.WX.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.WX.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.WX.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.WX.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.WX.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.WX.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.WX.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.WX.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.WX.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.WX=null,this._disposed=!0)}}},13608:(b,X,P)=>{"use strict";P.d(X,{d:()=>f});var Q=P(11822),S=P(11825),d=P(11834),N=P(12281),a=P(12396),u=P(12447),w=P(11802);N.c.AddNodeConstructor("Light_Type_1",((b,X)=>()=>new f(b,d.tX.Zero(),X)));class f extends u.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(b){this._shadowFrustumSize=b,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(b){this._shadowOrthoScale=b,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(b){this._orthoLeft=b}get orthoRight(){return this._orthoRight}set orthoRight(b){this._orthoRight=b}get orthoTop(){return this._orthoTop}set orthoTop(b){this._orthoTop=b}get orthoBottom(){return this._orthoBottom}set orthoBottom(b){this._orthoBottom=b}constructor(b,X,P){super(b,P),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=X.scale(-1),this.direction=X}getClassName(){return"Bf"}getTypeID(){return a.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(b,X,P){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(b):this._setDefaultAutoExtendShadowProjectionMatrix(b,X,P)}_setDefaultFixedFrustumShadowProjectionMatrix(b){const X=this.Ab().activeCamera;X&&d.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:X.Vd,void 0!==this.shadowMaxZ?this.shadowMaxZ:X.maxZ,b,this.Ab().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(b,X,P){const Q=this.Ab().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const b=d.tX.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let Q=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let N=0;N<P.length;N++){const a=P[N];if(!a)continue;const u=a.getBoundingInfo().boundingBox;for(let P=0;P<u.vectorsWorld.length;P++)d.tX.TransformCoordinatesToRef(u.vectorsWorld[P],X,b),b.x<this._orthoLeft&&(this._orthoLeft=b.x),b.y<this._orthoBottom&&(this._orthoBottom=b.y),b.x>this._orthoRight&&(this._orthoRight=b.x),b.y>this._orthoTop&&(this._orthoTop=b.y),this.autoCalcShadowZBounds&&(b.z<Q&&(Q=b.z),b.z>S&&(S=b.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=Q,this._shadowMaxZ=S)}const S=this._orthoRight-this._orthoLeft,N=this._orthoTop-this._orthoBottom,a=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Q||void 0===Q?void 0:Q.Vd)||0,u=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Q||void 0===Q?void 0:Q.maxZ)||1e4,w=this.Ab().getEngine().useReverseDepthBuffer;d.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-S*this.shadowOrthoScale,this._orthoRight+S*this.shadowOrthoScale,this._orthoBottom-N*this.shadowOrthoScale,this._orthoTop+N*this.shadowOrthoScale,w?u:a,w?a:u,b,this.Ab().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(b,X){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,X),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,X),this)}transferToNodeMaterialEffect(b,X){return this.computeTransformedInformation()?(b.setFloat3(X,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(b.setFloat3(X,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(b){const X=this._scene.getEngine();return!X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:1}getDepthMaxZ(b){const X=this._scene.getEngine();return X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:1}prepareLightSpecificDefines(b,X){b["DIRLIGHT"+X]=!0}}(0,Q.b)([(0,S.E)()],f.prototype,"shadowFrustumSize",null),(0,Q.b)([(0,S.E)()],f.prototype,"shadowOrthoScale",null),(0,Q.b)([(0,S.E)()],f.prototype,"autoUpdateExtends",void 0),(0,Q.b)([(0,S.E)()],f.prototype,"autoCalcShadowZBounds",void 0),(0,Q.b)([(0,S.E)("orthoLeft")],f.prototype,"_orthoLeft",void 0),(0,Q.b)([(0,S.E)("orthoRight")],f.prototype,"_orthoRight",void 0),(0,Q.b)([(0,S.E)("orthoTop")],f.prototype,"_orthoTop",void 0),(0,Q.b)([(0,S.E)("orthoBottom")],f.prototype,"_orthoBottom",void 0),(0,w.h)("BABYLON.DirectionalLight",f)},14098:(b,X,P)=>{"use strict";P.d(X,{b:()=>f});var Q=P(11822),S=P(11825),d=P(11834),N=P(11878),a=P(12281),u=P(12396),w=P(11802);a.c.AddNodeConstructor("Light_Type_3",((b,X)=>()=>new f(b,d.tX.Zero(),X)));class f extends u.e{constructor(b,X,P){super(b,P),this.groundColor=new N.yX(0,0,0),this.direction=X||d.tX.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Wf"}setDirectionToTarget(b){return this.direction=d.tX.Normalize(b.BX(d.tX.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(b,X){const P=d.tX.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",P.x,P.y,P.z,0,X),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.ya),X),this}transferToNodeMaterialEffect(b,X){const P=d.tX.Normalize(this.direction);return b.setFloat3(X,P.x,P.y,P.z),this}pd(){return this._worldMatrix||(this._worldMatrix=d.Matrix.Identity()),this._worldMatrix}getTypeID(){return u.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(b,X){b["HEMILIGHT"+X]=!0}}(0,Q.b)([(0,S.j)()],f.prototype,"groundColor",void 0),(0,Q.b)([(0,S.A)()],f.prototype,"direction",void 0),(0,w.h)("BABYLON.HemisphericLight",f)},13577:(b,X,P)=>{"use strict";P.d(X,{d:()=>O});var Q=P(11822),S=P(11825),d=P(11834),N=P(12281),a=P(12396),u=P(12447),w=P(11814),f=P(11802);N.c.AddNodeConstructor("Light_Type_2",((b,X)=>()=>new O(b,d.tX.Zero(),d.tX.Zero(),0,0,X)));class O extends u.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(b){this._iesProfileTexture!==b&&(this._iesProfileTexture=b,this._iesProfileTexture&&O._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(b){this._angle=b,this._cosHalfAngle=Math.cos(.5*b),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(b){this._innerAngle=b,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(b){this._shadowAngleScale=b,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(b){this._projectionTextureLightNear=b,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(b){this._projectionTextureLightFar=b,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(b){this._projectionTextureUpDirection=b,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(b){this._projectionTexture!==b&&(this._projectionTexture=b,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(O._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):O._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(b){return void 0!==b.onGeneratedObservable}static _IsTexture(b){return void 0!==b.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(b){this._projectionTextureProjectionLightMatrix=b,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(b,X,P,Q,S,N){super(b,N),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=d.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=d.tX.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=d.tX.Zero(),this._projectionTextureViewLightMatrix=d.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=d.Matrix.Zero(),this._projectionTextureScalingMatrix=d.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=X,this.direction=P,this.angle=Q,this.exponent=S}getClassName(){return"SpotLight"}getTypeID(){return a.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(b){super._setDirection(b),this._projectionTextureViewLightDirty=!0}_setPosition(b){super._setPosition(b),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(b,X,P){const Q=this.Ab().activeCamera;if(!Q)return;this._shadowAngleScale=this._shadowAngleScale||1;const S=this._shadowAngleScale*this._angle,N=void 0!==this.shadowMinZ?this.shadowMinZ:Q.Vd,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:Q.maxZ,u=this.Ab().getEngine().useReverseDepthBuffer;d.Matrix.PerspectiveFovLHToRef(S,1,u?a:N,u?N:a,b,!0,this._scene.getEngine().isNDCHalfZRange,void 0,u)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),d.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const b=this.projectionTextureLightFar,X=this.projectionTextureLightNear,P=b/(b-X),Q=-P*X,S=1/Math.tan(this._angle/2);d.Matrix.FromValuesToRef(S/1,0,0,0,0,S,0,0,0,0,P,1,0,0,Q,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof w.d){const b=this._projectionTexture.uScale/2,X=this._projectionTexture.vScale/2;d.Matrix.FromValuesToRef(b,0,0,0,0,X,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(b,X){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),b.setMatrix("textureProjectionMatrix"+X,this._projectionTextureMatrix),b.setTexture("projectionLightTexture"+X,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&b.setTexture("iesLightTexture"+X,this._iesProfileTexture),this}transferToEffect(b,X){let P;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,X),P=d.tX.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,X),P=d.tX.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",P.x,P.y,P.z,this._cosHalfAngle,X),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,X),this}transferToNodeMaterialEffect(b,X){let P;return P=this.computeTransformedInformation()?d.tX.Normalize(this.transformedDirection):d.tX.Normalize(this.direction),this.Ab().useRightHandedSystem?b.setFloat3(X,-P.x,-P.y,-P.z):b.setFloat3(X,P.x,P.y,P.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(b){const X=this._scene.getEngine(),P=void 0!==this.shadowMinZ?this.shadowMinZ:(null===b||void 0===b?void 0:b.Vd)??0;return X.useReverseDepthBuffer&&X.isNDCHalfZRange?P:this._scene.getEngine().isNDCHalfZRange?0:P}getDepthMaxZ(b){const X=this._scene.getEngine(),P=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===b||void 0===b?void 0:b.maxZ)??1e4;return X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:P}prepareLightSpecificDefines(b,X){b["SPOTLIGHT"+X]=!0,b["PROJECTEDLIGHTTEXTURE"+X]=!(!this.projectionTexture||!this.projectionTexture.isReady()),b["IESLIGHTTEXTURE"+X]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,Q.b)([(0,S.E)()],O.prototype,"angle",null),(0,Q.b)([(0,S.E)()],O.prototype,"innerAngle",null),(0,Q.b)([(0,S.E)()],O.prototype,"shadowAngleScale",null),(0,Q.b)([(0,S.E)()],O.prototype,"exponent",void 0),(0,Q.b)([(0,S.E)()],O.prototype,"projectionTextureLightNear",null),(0,Q.b)([(0,S.E)()],O.prototype,"projectionTextureLightFar",null),(0,Q.b)([(0,S.E)()],O.prototype,"projectionTextureUpDirection",null),(0,Q.b)([(0,S.v)("projectedLightTexture")],O.prototype,"_projectionTexture",void 0),(0,f.h)("BABYLON.SpotLight",O)},13308:(b,X,P)=>{"use strict";P.d(X,{b:()=>N,c:()=>d,f:()=>a});const Q={},S={};function d(b,X){Q[b]=X}function N(b,X){S[b]=X}function a(b){return S[b]?S[b]:null}},13211:(b,X,P)=>{"use strict";P.d(X,{d:()=>Z,h:()=>C});var Q,S=P(11689),d=P(11694),N=P(12093),a=P(11732),u=P(11700),w=P(12338),f=P(11738),O=P(11740),e=P(11804),Y=P(11760),D=P(11728);!function(b){b[b.Clean=0]="Clean",b[b.Stop=1]="Stop",b[b.Sync=2]="Sync",b[b.NoSync=3]="NoSync"}(Q||(Q={}));const E=new d.d,t={};let B=!1;function W(){return t[".babylon"]}function n(b,X){const P=t[b];return P||(u.b.Warn("Unable to find a plugin to load "+b+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),X?W():void 0)}function y(b,X,P){let Q="Unable to load from "+(b.rawData?"binary data":b.url);return X?Q+=`: ${X}`:P&&(Q+=`: ${P}`),Q}async function h(b,X,P,Q,S,d,N,a,u){var w;const O="data:"===(e=b.url).substring(0,5)?e.substring(5):null;var e;if(b.rawData&&!N)throw"When using ArrayBufferView to load data the file extension must be provided.";const B=O||N?"":function(b){const X=b.indexOf("?");-1!==X&&(b=b.substring(0,X));const P=b.lastIndexOf(".");return b.substring(P,b.length).toLowerCase()}(b.url);let y=N?n(N,!0):O?function(b){for(const X in t){const P=t[X].plugin;if(P.canDirectLoad&&P.canDirectLoad(b))return t[X]}return W()}(b.url):n(B,!1);if(!y&&B){if(b.url&&!b.url.startsWith("blob:")){const X=await async function(b,X){const P=X.method||"GET";return await new Promise(((Q,S)=>{const d=new D.c;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){const b={};if(X.responseHeaders)for(const P of X.responseHeaders)b[P]=d.getResponseHeader(P)||"";Q({response:d.response,headerValues:b})}else S(`Unable to fetch data from ${b}. Error code: ${d.status}`)})),d.open(P,b),d.send()}))}(b.url,{method:"HEAD",responseHeaders:["Content-Type"]}),P=X.headerValues?X.headerValues["Content-Type"]:"";P&&(y=function(b){for(const X in t){const P=t[X];if(P.mimeType===b)return P}}(P))}y||(y=W())}if(!y)throw new Error(`No plugin or fallback for ${N??b.url}`);if(!1===(null===u||void 0===u||null===(w=u[y.plugin.name])||void 0===w?void 0:w.enabled))throw new Error(`The '${y.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(b.rawData&&!y.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(b=>{if(y.plugin.createPlugin){const X=y.plugin.createPlugin(u??{});return X instanceof Promise?(X.then(b).catch((b=>{S("Error instantiating plugin.",b)})),null):(b(X),X)}return b(y.plugin),y.plugin})((u=>{var w;if(!u)throw`The loader plugin corresponding to the '${N}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(E.notifyObservers(u),O&&(u.canDirectLoad&&u.canDirectLoad(b.url)||!(0,f.i)(b.url))){if(u.directLoad){const b=u.directLoad(X,O);b instanceof Promise?b.then((b=>{P(u,b)})).catch((b=>{S("Error in directLoad of _loadData: "+b,b)})):P(u,b)}else P(u,O);return}const e=y.isBinary,D=(b,Q)=>{X.Y?S("Scene has been disposed"):P(u,b,Q)};let t=null,B=!1;null===(w=u.Nd)||void 0===w||w.add((()=>{B=!0,t&&(t.abort(),t=null),d()}));const W=()=>{if(B)return;const P=(b,X)=>{S(null===b||void 0===b?void 0:b.statusText,X)};if(!u.loadFile&&b.rawData)throw"Plugin does not support loading ArrayBufferView.";t=u.loadFile?u.loadFile(X,b.rawData||b.file||b.url,b.rootUrl,D,Q,e,P,a):X._loadFile(b.file||b.url,D,Q,!0,e,P)},n=X.getEngine();let h=n.enableOfflineSupport;if(h){let P=!1;for(const Q of X.disableOfflineSupportExceptionRules)if(Q.test(b.url)){P=!0;break}h=!P}h&&Y.c.OfflineProviderFactory?X.offlineProvider=Y.c.OfflineProviderFactory(b.url,W,n.disableManifestCheck):W()}))}function L(b,X){let P,Q,d=null,N=null;if(X)if(X.name)P=`file:${X.name}`,Q=X.name,d=X;else if(ArrayBuffer.isView(X))P="",Q=(0,e.b)(),N=X;else if(X.startsWith("data:"))P=X,Q="";else if(b){const d=X;if("/"===d.substring(0,1))return S.Tools.Error("Wrong sceneFilename parameter"),null;P=b+d,Q=d}else P=X,Q=S.Tools.GetFilename(X),b=S.Tools.GetFolderPath(X);else P=b,Q=S.Tools.GetFilename(b),b=S.Tools.GetFolderPath(b);return{url:P,rootUrl:b,name:Q,file:d,rawData:N}}function Z(b){if("string"===typeof b.extensions){const X=b.extensions;t[X.toLowerCase()]={plugin:b,isBinary:!1}}else{const X=b.extensions,P=Object.keys(X);for(const Q of P)t[Q.toLowerCase()]={plugin:b,isBinary:X[Q].isBinary,mimeType:X[Q].mimeType}}}async function v(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.e.LastCreatedScene,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!Q)return u.b.Error("No scene available to import mesh to"),null;const Y=L(X,P);if(!Y)return null;const D={};Q.addPendingData(D);const E=()=>{Q.removePendingData(D)},t=(b,X)=>{const P=y(Y,b,X);N?N(Q,P,new O.h(P,O.e.SceneLoaderError,X)):u.b.Error(P),E()},B=d?b=>{try{d(b)}catch(X){t("Error in onProgress callback: "+X,X)}}:void 0,W=(b,X,P,d,N,a,u,w)=>{if(Q.importedMeshesFiles.push(Y.url),S)try{S(b,X,P,d,N,a,u,w)}catch(f){t("Error in onSuccess callback: "+f,f)}Q.removePendingData(D)};return await h(Y,Q,((X,P,S)=>{if(X.rewriteRootURL&&(Y.rootUrl=X.rewriteRootURL(Y.rootUrl,S)),X.importMesh){const S=[],d=[],N=[];if(!X.importMesh(b,Q,P,Y.rootUrl,S,d,N,t))return;Q.loadingPluginName=X.name,W(S,d,N,[],[],[],[],[])}else{X.importMeshAsync(b,Q,P,Y.rootUrl,B,Y.name).then((b=>{Q.loadingPluginName=X.name,W(b.meshes,b.Oe,b.skeletons,b.animationGroups,b.transformNodes,b.geometries,b.lights,b.spriteManagers)})).catch((b=>{t(b.message,b)}))}}),B,t,E,w,f,e)}async function A(b,X,P,Q,S,d,N,a){return await new Promise(((u,w)=>{try{v(b,X,P,Q,((b,X,P,Q,S,d,N,a)=>{u({meshes:b,Oe:X,skeletons:P,animationGroups:Q,transformNodes:S,geometries:d,lights:N,spriteManagers:a})}),S,((b,X,P)=>{w(P||new Error(X))}),d,N,a).catch(w)}catch(O){w(O)}}))}async function o(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.e.LastCreatedEngine,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};P?await T(b,X,new N.e(P),Q,d,u,w,f,O):S.Tools.Error("No engine available")}async function K(b,X,P,Q,S,d,N){return await new Promise(((a,u)=>{o(b,X,P,(b=>{a(b)}),Q,((b,X,P)=>{u(P||new Error(X))}),S,d,N)}))}async function T(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.e.LastCreatedScene,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!P)return u.b.Error("No scene available to append to"),null;const Y=L(b,X);if(!Y)return null;const D={};P.addPendingData(D);const E=()=>{P.removePendingData(D)};w.c.ShowLoadingScreen&&!B&&(B=!0,P.getEngine().displayLoadingUI(),P.executeWhenReady((()=>{P.getEngine().hideLoadingUI(),B=!1})));const t=(b,X)=>{const Q=y(Y,b,X);d?d(P,Q,new O.h(Q,O.e.SceneLoaderError,X)):u.b.Error(Q),E()},W=S?b=>{try{S(b)}catch(X){t("Error in onProgress callback",X)}}:void 0,n=()=>{if(Q)try{Q(P)}catch(b){t("Error in onSuccess callback",b)}P.removePendingData(D)};return await h(Y,P,((b,X)=>{if(b.load){if(!b.load(P,X,Y.rootUrl,t))return;P.loadingPluginName=b.name,n()}else{b.loadAsync(P,X,Y.rootUrl,W,Y.name).then((()=>{P.loadingPluginName=b.name,n()})).catch((b=>{t(b.message,b)}))}}),W,t,E,N,f,e)}async function q(b,X,P,Q,S,d,N){return await new Promise(((a,u)=>{try{T(b,X,P,(b=>{a(b)}),Q,((b,X,P)=>{u(P||new Error(X))}),S,d,N).catch(u)}catch(O){u(O)}}))}async function V(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.e.LastCreatedScene,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!P)return u.b.Error("No scene available to load asset container to"),null;const e=L(b,X);if(!e)return null;const Y={};P.addPendingData(Y);const D=()=>{P.removePendingData(Y)},E=(b,X)=>{const Q=y(e,b,X);d?d(P,Q,new O.h(Q,O.e.SceneLoaderError,X)):u.b.Error(Q),D()},t=S?b=>{try{S(b)}catch(X){E("Error in onProgress callback",X)}}:void 0,B=b=>{if(Q)try{Q(b)}catch(X){E("Error in onSuccess callback",X)}P.removePendingData(Y)};return await h(e,P,((b,X)=>{if(b.loadAssetContainer){const Q=b.loadAssetContainer(P,X,e.rootUrl,E);if(!Q)return;Q.populateRootNodes(),P.loadingPluginName=b.name,B(Q)}else if(b.loadAssetContainerAsync){b.loadAssetContainerAsync(P,X,e.rootUrl,t,e.name).then((X=>{X.populateRootNodes(),P.loadingPluginName=b.name,B(X)})).catch((b=>{E(b.message,b)}))}else E("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),t,E,D,N,w,f)}async function i(b,X,P,Q,S,d,N){return await new Promise(((a,u)=>{try{V(b,X,P,(b=>{a(b)}),Q,((b,X,P)=>{u(P||new Error(X))}),S,d,N).catch(u)}catch(O){u(O)}}))}async function x(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.e.LastCreatedScene,Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!P)return void u.b.Error("No scene available to load animations to");if(Q){for(const Q of P.animatables)Q.reset();P.stopAllAnimations();const b=P.animationGroups.slice();for(const P of b)P.dispose();const X=P.getNodes();for(const P of X)P.animations&&(P.animations=[])}else switch(S){case 0:const b=P.animationGroups.slice();for(const X of b)X.dispose();break;case 1:for(const X of P.animationGroups)X.stop();break;case 2:for(const X of P.animationGroups)X.reset(),X.restart();break;case 3:break;default:return void u.b.Error("Unknown animation group loading mode value '"+S+"'")}const D=P.animatables.length;await V(b,X,P,(b=>{b.mergeAnimationsTo(P,P.animatables.slice(D),d),b.dispose(),P.onAnimationFileImportedObservable.notifyObservers(P),N&&N(P)}),w,f,O,e,Y)}async function H(b,X,P,Q,S,d,N,a,u,w){return await new Promise(((f,e)=>{try{x(b,X,P,Q,S,d,(b=>{f(b)}),N,((b,X,P)=>{e(P||new Error(X))}),a,u,w).catch(e)}catch(O){e(O)}}))}class C{static get ForceFullSceneLoadingForIncremental(){return w.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(b){w.c.ForceFullSceneLoadingForIncremental=b}static get ShowLoadingScreen(){return w.c.ShowLoadingScreen}static set ShowLoadingScreen(b){w.c.ShowLoadingScreen=b}static get loggingLevel(){return w.c.loggingLevel}static set loggingLevel(b){w.c.loggingLevel=b}static get CleanBoneMatrixWeights(){return w.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(b){w.c.CleanBoneMatrixWeights=b}static GetDefaultPlugin(){return W()}static GetPluginForExtension(b){var X;return null===(X=n(b,!0))||void 0===X?void 0:X.plugin}static IsPluginForExtensionAvailable(b){return function(b){return!!t[b]}(b)}static RegisterPlugin(b){Z(b)}static ImportMesh(b,X,P,Q,S,d,N,u,w){v(b,X,P,Q,S,d,N,u,w).catch((b=>null===N||void 0===N?void 0:N(a.e.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async ImportMeshAsync(b,X,P,Q,S,d,N){return await A(b,X,P,Q,S,d,N)}static Load(b,X,P,Q,S,d,N,u){o(b,X,P,Q,S,d,N,u).catch((b=>null===d||void 0===d?void 0:d(a.e.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async LoadAsync(b,X,P,Q,S,d){return await K(b,X,P,Q,S,d)}static Append(b,X,P,Q,S,d,N,u){T(b,X,P,Q,S,d,N,u).catch((b=>null===d||void 0===d?void 0:d(P??a.e.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async AppendAsync(b,X,P,Q,S,d){return await q(b,X,P,Q,S,d)}static LoadAssetContainer(b,X,P,Q,S,d,N,u){V(b,X,P,Q,S,d,N,u).catch((b=>null===d||void 0===d?void 0:d(P??a.e.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async LoadAssetContainerAsync(b,X,P,Q,S,d){return await i(b,X,P,Q,S,d)}static ImportAnimations(b,X,P,Q,S,d,N,u,w,f,O){x(b,X,P,Q,S,d,N,u,w,f,O).catch((b=>null===w||void 0===w?void 0:w(P??a.e.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async ImportAnimationsAsync(b,X,P,Q,S,d,N,a,u,w,f){return await H(b,X,P,Q,S,d,a,w,f)}}C.NO_LOGGING=0,C.MINIMAL_LOGGING=1,C.SUMMARY_LOGGING=2,C.DETAILED_LOGGING=3,C.OnPluginActivatedObservable=E},13592:(b,X,P)=>{"use strict";P.d(X,{c:()=>e});var Q=P(11822),S=P(11825),d=P(11689),N=P(11834),a=P(11846),u=P(11814),w=P(11802),f=P(11694),O=P(11862);P(13595);class e extends a.e{set boundingBoxSize(b){if(this._boundingBoxSize&&this._boundingBoxSize.equals(b))return;this._boundingBoxSize=b;const X=this.Ab();X&&X.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(b){this._rotationY=b,this.setReflectionTextureMatrix(N.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(b,X,P){let Q="";for(const S of b)Q+=S;return new e(Q,X,null,P,b)}static CreateFromPrefilteredData(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const S=X.useDelayedTextureLoading;X.useDelayedTextureLoading=!1;const d=new e(b,X,null,!1,null,null,null,void 0,!0,P,Q);return X.useDelayedTextureLoading=S,d}constructor(b,X){var P;let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,e=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]&&arguments[10],E=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,t=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,B=arguments.length>13?arguments[13]:void 0,W=arguments.length>14?arguments[14]:void 0;super(X),this.onLoadObservable=new f.d,this.boundingBoxPosition=N.tX.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new N.Matrix,this._buffer=null,this.name=b,this.url=b,this._noMipmap=S,this.Ad=!1,this.isCube=!0,this._textureMatrix=N.Matrix.Identity(),this.coordinatesMode=u.d.CUBIC_MODE;let n=null,y=null;null===Q||Array.isArray(Q)?(this._noMipmap=S,this._format=O,this._createPolynomials=D,n=Q,this._loaderOptions=B,this._useSRGBBuffer=W,this._lodScale=E,this._lodOffset=t):(n=Q.extensions??null,this._noMipmap=Q.noMipmap??!1,d=Q.files??null,y=Q.buffer??null,this._format=Q.format??5,e=Q.prefiltered??!1,Y=Q.forcedExtension??null,this._createPolynomials=Q.createPolynomials??!1,this._lodScale=Q.lodScale??.8,this._lodOffset=Q.lodOffset??0,this._loaderOptions=Q.loaderOptions,this._useSRGBBuffer=Q.useSRGBBuffer,a=Q.I??null,w=Q.onError??null),(b||d)&&this.updateURL(b,Y,a,e,w,n,null===(P=this.Ab())||void 0===P?void 0:P.useDelayedTextureLoading,d,y)}getClassName(){return"CubeTexture"}updateURL(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=b),this.url=b,X&&(this._forcedExtension=X);const w=b.lastIndexOf("."),f=X||(w>-1?b.substring(w).toLowerCase():""),O=0===f.indexOf(".dds"),e=0===f.indexOf(".env"),Y=0===f.indexOf(".basis");if(e?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=Q,Q&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),a)this._files=a;else if(Y||e||O||d||(d=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,d){for(let X=0;X<d.length;X++)this._files.push(b+d[X]);this._extensions=d}this._buffer=u,N?(this.delayLoadState=4,this._delayedOnLoad=P,this._delayedOnError=S):this._loadTexture(P,S)}delayLoad(b){4===this.delayLoadState&&(b&&(this._forcedExtension=b),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(b){var X,P;if(b.updateFlag===this._textureMatrix.updateFlag)return;b.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(P=this.Ab())||void 0===P||P.markAllMaterialsAsDirty(1,(b=>-1!==b.getActiveTextures().indexOf(this))));if(this._textureMatrix=b,null===(X=this.Ab())||void 0===X||!X.useRightHandedSystem)return;const Q=N.TmpVectors.tX[0],S=N.TmpVectors.Quaternion[0],d=N.TmpVectors.tX[1];this._textureMatrix.decompose(Q,S,d),S.z*=-1,S.w*=-1,N.Matrix.ComposeToRef(Q,S,d,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var b;return null!==(b=this.Ab())&&void 0!==b&&b.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=this.Ab(),Q=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const S=()=>{var X;(this.onLoadObservable.notifyObservers(this),Q)&&(Q.dispose(),null===(X=this.Ab())||void 0===X||X.markAllMaterialsAsDirty(1));b&&b()},N=(b,P)=>{this._loadingError=!0,this._errorObject={message:b,exception:P},X&&X(b,P),u.d.OnTextureLoadErrorObservable.notifyObservers(this)};var a;this._texture?this._texture.isReady?d.Tools.SetImmediate((()=>S())):this._texture.onLoadedObservable.add((()=>S())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,P,this._lodScale,this._lodOffset,b,N,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,P,this._files,this._noMipmap,b,N,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(a=this._texture)||void 0===a||a.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(b,X,P){const Q=O.b.Parse((()=>{let Q=!1;return b.prefiltered&&(Q=b.prefiltered),new e(P+(b.url??b.name),X,b.extensions,!1,b.files||null,null,null,void 0,Q,b.forcedExtension)}),b,X);if(b.boundingBoxPosition&&(Q.boundingBoxPosition=N.tX.hX(b.boundingBoxPosition)),b.boundingBoxSize&&(Q.boundingBoxSize=N.tX.hX(b.boundingBoxSize)),b.animations)for(let S=0;S<b.animations.length;S++){const X=b.animations[S],P=(0,w.d)("BABYLON.Animation");P&&Q.animations.push(P.Parse(X))}return Q}clone(){let b=0;const X=O.b.Clone((()=>{const X=new e(this.url,this.Ab()||this._getEngine(),this._extensions,this._noMipmap,this._files);return b=X.uniqueId,X}),this);return X.uniqueId=b,X}}(0,Q.b)([(0,S.E)()],e.prototype,"url",void 0),(0,Q.b)([(0,S.A)()],e.prototype,"boundingBoxPosition",void 0),(0,Q.b)([(0,S.A)()],e.prototype,"boundingBoxSize",null),(0,Q.b)([(0,S.E)("rotationY")],e.prototype,"rotationY",null),(0,Q.b)([(0,S.E)("files")],e.prototype,"_files",void 0),(0,Q.b)([(0,S.E)("forcedExtension")],e.prototype,"_forcedExtension",void 0),(0,Q.b)([(0,S.E)("extensions")],e.prototype,"_extensions",void 0),(0,Q.b)([(0,S.o)("textureMatrix")],e.prototype,"_textureMatrix",void 0),(0,Q.b)([(0,S.o)("textureMatrixRefraction")],e.prototype,"_textureMatrixRefraction",void 0),u.d._CubeTextureParser=e.Parse,(0,w.h)("BABYLON.CubeTexture",e)},14108:(b,X,P)=>{"use strict";P.d(X,{b:()=>u});var Q=P(11700),S=P(11814),d=P(11807),N=P(11976),a=P(11787);N.ThinEngine.prototype.createDynamicTexture=function(b,X,P,Q){const S=new a.e(this,4);return S.baseWidth=b,S.baseHeight=X,P&&(b=this.needPOTTextures?(0,d.h)(b,this._caps.maxTextureSize):b,X=this.needPOTTextures?(0,d.h)(X,this._caps.maxTextureSize):X),S.width=b,S.height=X,S.isReady=!1,S.generateMipMaps=P,S.samplingMode=Q,this.updateTextureSamplingMode(Q,S),this._internalTexturesCache.push(S),S},N.ThinEngine.prototype.updateDynamicTexture=function(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!b)return;const N=this._gl,a=N.TEXTURE_2D,u=this._bindTextureDirectly(a,b,!0,d);this._unpackFlipY(void 0===P?b.invertY:P),Q&&N.pixelStorei(N.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const w=this._getWebGLTextureType(b.type),f=this._getInternalFormat(S||b.format),O=this._getRGBABufferInternalSizedFormat(b.type,f);N.texImage2D(a,0,O,f,w,X),b.generateMipMaps&&N.generateMipmap(a),u||this._bindTextureDirectly(a,null),Q&&N.pixelStorei(N.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),S&&(b.format=S),b._dynamicTextureSource=X,b._premulAlpha=Q,b.invertY=P||!1,b.isReady=!0};class u extends S.d{constructor(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,a=arguments.length>6?arguments[6]:void 0;const u=!P||P._isScene;super(null,u?P:null===P||void 0===P?void 0:P.WX,u?!Q:P,a,d,void 0,void 0,void 0,void 0,N),this.name=b,this.wrapU=S.d.CLAMP_ADDRESSMODE,this.wrapV=S.d.CLAMP_ADDRESSMODE,this._generateMipMaps=Q;const w=this._getEngine();if(!w)return;if(X.getContext)this._canvas=X,this._ownCanvas=!1,this._texture=w.createDynamicTexture(this._canvas.width,this._canvas.height,Q,d);else{this._canvas=w.createCanvas(1,1),this._ownCanvas=!0;const b=X;b.width||0===b.width?this._texture=w.createDynamicTexture(b.width,b.height,Q,d):this._texture=w.createDynamicTexture(X,X,Q,d)}const f=this.getSize();this._canvas.width!==f.width&&(this._canvas.width=f.width),this._canvas.height!==f.height&&(this._canvas.height=f.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(b){this._canvas.width=b.width,this._canvas.height=b.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(b.width,b.height,this._generateMipMaps,this.samplingMode)}scale(b){const X=this.getSize();X.width*=b,X.height*=b,this._recreate(X)}scaleTo(b,X){const P=this.getSize();P.width=b,P.height=X,this._recreate(P)}getContext(){return this._context}clear(b){const X=this.getSize();b&&(this._context.fillStyle=b),this._context.clearRect(0,0,X.width,X.height)}update(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===b||b,X,this._format||void 0,void 0,P)}drawText(b,X,P,Q,S,d,N){let a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const u=this.getSize();if(d&&(this._context.fillStyle=d,this._context.fillRect(0,0,u.width,u.height)),this._context.font=Q,null===X||void 0===X){const P=this._context.measureText(b);X=(u.width-P.width)/2}if(null===P||void 0===P){const b=parseInt(Q.replace(/\D/g,""));P=u.height/2+b/3.65}this._context.fillStyle=S||"",this._context.fillText(b,X,P),a&&this.update(N)}dispose(){var b,X;(super.dispose(),this._ownCanvas)&&(null===(b=this._canvas)||void 0===b||null===(X=b.remove)||void 0===X||X.call(b));this._canvas=null,this._context=null}clone(){const b=this.Ab();if(!b)return this;const X=this.getSize(),P=new u(this.name,X,b,this._generateMipMaps);return P.Ad=this.Ad,P.level=this.level,P.wrapU=this.wrapU,P.wrapV=this.wrapV,P}serialize(){const b=this.Ab();b&&!b.isReady()&&Q.b.Warn("The scene must be ready before serializing the dynamic texture");const X=super.serialize();return u._IsCanvasElement(this._canvas)&&(X.base64String=this._canvas.toDataURL()),X.invertY=this._invertY,X.samplingMode=this.samplingMode,X}static _IsCanvasElement(b){return void 0!==b.toDataURL}_rebuild(){this.update()}}},13500:(b,X,P)=>{"use strict";P.d(X,{e:()=>S});var Q=P(11814);class S extends Q.d{get depth(){return this._depth}constructor(b,X,P,S,d,N){let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Q.d.TRILINEAR_SAMPLINGMODE,f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,O=arguments.length>10?arguments[10]:void 0;super(null,N,!a,u),this.format=d,this._texture=N.getEngine().createRawTexture2DArray(b,X,P,S,d,a,u,w,null,f,O),this._depth=S,this.is2DArray=!0}update(b){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,b,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(b,X,P,Q,d){return new S(b,X,P,Q,5,d,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13326:(b,X,P)=>{"use strict";P.d(X,{b:()=>a,c:()=>u,f:()=>d,g:()=>N});var Q=P(11844),S=P(11834);function d(b,X){return`{X: ${b.x.toFixed(X)} Y: ${b.y.toFixed(X)}}`}function N(b,X){return`{X: ${b._x.toFixed(X)} Y: ${b._y.toFixed(X)} Z: ${b._z.toFixed(X)}}`}function a(b,X){return 2*Math.acos((0,Q.Clamp)(S.Quaternion.Dot(b,X)))}function u(b,X){const P=new S.Quaternion;return function(b,X,P){const d=S.tX.Cross(b,X),N=Math.acos((0,Q.Clamp)(S.tX.Dot(b,X),-1,1));S.Quaternion.RotationAxisToRef(d,N,P)}(b,X,P),P}},13160:(b,X,P)=>{"use strict";P.d(X,{d:()=>w});var Q=P(11834),S=P(11878),d=P(12319),N=P(12299),a=P(11895);P(13169);function u(b){let X=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const P=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],d=[];let u=[];const w=b.width||b.size||1,f=b.height||b.size||1,O=b.depth||b.size||1,e=b.wrap||!1;let Y=void 0===b.topBaseAt?1:b.topBaseAt,D=void 0===b.bottomBaseAt?0:b.bottomBaseAt;Y=(Y+4)%4,D=(D+4)%4;let E=[2,0,3,1][Y],t=[2,0,1,3][D],B=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(e){X=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],B=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let b=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],P=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const Q=[17,18,19,16],S=[22,23,20,21];for(;E>0;)b.unshift(b.pop()),Q.unshift(Q.pop()),E--;for(;t>0;)P.unshift(P.pop()),S.unshift(S.pop()),t--;b=b.flat(),P=P.flat(),B=B.concat(b).concat(P),X.push(Q[0],Q[2],Q[3],Q[0],Q[1],Q[2]),X.push(S[0],S[2],S[3],S[0],S[1],S[2])}const W=[w/2,f/2,O/2];u=B.reduce(((b,X,P)=>b.concat(X*W[P%3])),[]);const n=0===b.sideOrientation?0:b.sideOrientation||N.e.DEFAULTSIDE,y=b.faceUV||new Array(6),h=b.faceColors,L=[];for(let N=0;N<6;N++)void 0===y[N]&&(y[N]=new Q.Vector4(0,0,1,1)),h&&void 0===h[N]&&(h[N]=new S.Ba(1,1,1,1));for(let Q=0;Q<6;Q++)if(d.push(y[Q].z,a.c?1-y[Q].w:y[Q].w),d.push(y[Q].x,a.c?1-y[Q].w:y[Q].w),d.push(y[Q].x,a.c?1-y[Q].y:y[Q].y),d.push(y[Q].z,a.c?1-y[Q].y:y[Q].y),h)for(let b=0;b<4;b++)L.push(h[Q].r,h[Q].g,h[Q].b,h[Q].a);N.e._ComputeSides(n,u,X,P,d,b.frontUVs,b.backUVs);const Z=new N.e;if(Z.indices=X,Z.Kb=u,Z.Tb=P,Z.Vb=d,h){const b=n===N.e.DOUBLESIDE?L.concat(L):L;Z.qb=b}return Z}function w(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new d.b(b,P);X.sideOrientation=d.b._GetDefaultSideOrientation(X.sideOrientation),Q._originalBuilderSideOrientation=X.sideOrientation;return u(X).xb(Q,X.updatable),Q}N.e.CreateBox=u,d.b.CreateBox=function(b,X){return w(b,{size:X,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13313:(b,X,P)=>{"use strict";P.d(X,{b:()=>a});var Q=P(12319),S=P(12299),d=P(11895);function N(b){const X=[],P=[],Q=[],N=[],a=b.radius||.5,u=b.tessellation||64,w=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1,f=0===b.sideOrientation?0:b.sideOrientation||S.e.DEFAULTSIDE;X.push(0,0,0),N.push(.5,.5);const O=2*Math.PI*w,e=1===w?O/u:O/(u-1);let Y=0;for(let S=0;S<u;S++){const b=Math.cos(Y),P=Math.sin(Y),Q=(b+1)/2,S=(1-P)/2;X.push(a*b,a*P,0),N.push(Q,d.c?1-S:S),Y+=e}1===w&&(X.push(X[3],X[4],X[5]),N.push(N[2],d.c?1-N[3]:N[3]));const D=X.length/3;for(let S=1;S<D-1;S++)P.push(S+1,0,S);S.e.ComputeNormals(X,P,Q),S.e._ComputeSides(f,X,P,Q,N,b.frontUVs,b.backUVs);const E=new S.e;return E.indices=P,E.Kb=X,E.Tb=Q,E.Vb=N,E}function a(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new Q.b(b,P);X.sideOrientation=Q.b._GetDefaultSideOrientation(X.sideOrientation),S._originalBuilderSideOrientation=X.sideOrientation;return N(X).xb(S,X.updatable),S}S.e.CreateDisc=N,Q.b.CreateDisc=function(b,X,P){return a(b,{radius:X,tessellation:P,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13169:(b,X,P)=>{"use strict";P.d(X,{c:()=>t,b:()=>W,d:()=>B});var Q=P(11834),S=P(11878),d=P(12319),N=P(12299),a=P(11912);d.b._GroundMeshParser=(b,X)=>u.Parse(b,X);class u extends d.b{constructor(b,X){super(b,X),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=b,this._subdivisionsY=b,this.subdivide(b);const P=this;P.createOrUpdateSubmeshesOctree&&P.createOrUpdateSubmeshesOctree(X)}getHeightAtCoordinates(b,X){const P=this.getWorldMatrix(),S=Q.TmpVectors.Matrix[5];P.invertToRef(S);const d=Q.TmpVectors.tX[8];if(Q.tX.TransformCoordinatesFromFloatsToRef(b,0,X,S,d),b=d.x,X=d.z,b<this._minX||b>=this._maxX||X<=this._minZ||X>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const N=this._getFacetAt(b,X),a=-(N.x*b+N.z*X+N.w)/N.y;return Q.tX.TransformCoordinatesFromFloatsToRef(0,a,0,P,d),d.y}getNormalAtCoordinates(b,X){const P=new Q.tX(0,1,0);return this.getNormalAtCoordinatesToRef(b,X,P),P}getNormalAtCoordinatesToRef(b,X,P){const S=this.getWorldMatrix(),d=Q.TmpVectors.Matrix[5];S.invertToRef(d);const N=Q.TmpVectors.tX[8];if(Q.tX.TransformCoordinatesFromFloatsToRef(b,0,X,d,N),b=N.x,X=N.z,b<this._minX||b>this._maxX||X<this._minZ||X>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const a=this._getFacetAt(b,X);return Q.tX.TransformNormalFromFloatsToRef(a.x,a.y,a.z,S,P),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(b,X){const P=Math.floor((b+this._maxX)*this._subdivisionsX/this._width),Q=Math.floor(-(X+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),S=this._heightQuads[Q*this._subdivisionsX+P];let d;return d=X<S.slope.x*b+S.slope.y?S.facet1:S.facet2,d}_initHeightQuads(){const b=this._subdivisionsX,X=this._subdivisionsY;this._heightQuads=[];for(let P=0;P<X;P++)for(let X=0;X<b;X++){const S={slope:Q.Vector2.Zero(),facet1:new Q.Vector4(0,0,0,0),facet2:new Q.Vector4(0,0,0,0)};this._heightQuads[P*b+X]=S}return this}_computeHeightQuads(){const b=this.getVerticesData(a.g.PositionKind);if(!b)return this;const X=Q.TmpVectors.tX[3],P=Q.TmpVectors.tX[2],S=Q.TmpVectors.tX[1],d=Q.TmpVectors.tX[0],N=Q.TmpVectors.tX[4],u=Q.TmpVectors.tX[5],w=Q.TmpVectors.tX[6],f=Q.TmpVectors.tX[7],O=Q.TmpVectors.tX[8];let e=0,Y=0,D=0,E=0,t=0,B=0,W=0;const n=this._subdivisionsX,y=this._subdivisionsY;for(let a=0;a<y;a++)for(let y=0;y<n;y++){e=3*y,Y=a*(n+1)*3,D=(a+1)*(n+1)*3,X.x=b[Y+e],X.y=b[Y+e+1],X.z=b[Y+e+2],P.x=b[Y+e+3],P.y=b[Y+e+4],P.z=b[Y+e+5],S.x=b[D+e],S.y=b[D+e+1],S.z=b[D+e+2],d.x=b[D+e+3],d.y=b[D+e+4],d.z=b[D+e+5],E=(d.z-X.z)/(d.x-X.x),t=X.z-E*X.x,P.subtractToRef(X,N),S.subtractToRef(X,u),d.subtractToRef(X,w),Q.tX.CrossToRef(w,u,f),Q.tX.CrossToRef(N,w,O),f.normalize(),O.normalize(),B=-(f.x*X.x+f.y*X.y+f.z*X.z),W=-(O.x*P.x+O.y*P.y+O.z*P.z);const h=this._heightQuads[a*n+y];h.slope.sd(E,t),h.facet1.sd(f.x,f.y,f.z,B),h.facet2.sd(O.x,O.y,O.z,W)}return this}serialize(b){super.serialize(b),b.subdivisionsX=this._subdivisionsX,b.subdivisionsY=this._subdivisionsY,b.minX=this._minX,b.maxX=this._maxX,b.Vd=this._minZ,b.maxZ=this._maxZ,b.width=this._width,b.height=this._height}static Parse(b,X){const P=new u(b.name,X);return P._subdivisionsX=b.subdivisionsX||1,P._subdivisionsY=b.subdivisionsY||1,P._minX=b.minX,P._maxX=b.maxX,P._minZ=b.Vd,P._maxZ=b.maxZ,P._width=b.width,P._height=b.height,P}}var w=P(11689),f=P(11732),O=P(11836),e=P(11895);function Y(b){const X=[],P=[],S=[],d=[];let a,u;const w=b.width||b.size||1,f=b.height||b.size||1,O=0|(b.subdivisionsX||b.subdivisions||1),Y=0|(b.subdivisionsY||b.subdivisions||1);for(a=0;a<=Y;a++)for(u=0;u<=O;u++){const b=new Q.tX(u*w/O-w/2,0,(Y-a)*f/Y-f/2),X=new Q.tX(0,1,0);P.push(b.x,b.y,b.z),S.push(X.x,X.y,X.z),d.push(u/O,e.c?a/Y:1-a/Y)}for(a=0;a<Y;a++)for(u=0;u<O;u++)X.push(u+1+(a+1)*(O+1)),X.push(u+1+a*(O+1)),X.push(u+a*(O+1)),X.push(u+(a+1)*(O+1)),X.push(u+1+(a+1)*(O+1)),X.push(u+a*(O+1));const D=new N.e;return D.indices=X,D.Kb=P,D.Tb=S,D.Vb=d,D}function D(b){const X=void 0!==b.xmin&&null!==b.xmin?b.xmin:-1,P=void 0!==b.zmin&&null!==b.zmin?b.zmin:-1,S=void 0!==b.xmax&&null!==b.xmax?b.xmax:1,d=void 0!==b.zmax&&null!==b.zmax?b.zmax:1,a=b.subdivisions||{w:1,h:1},u=b.precision||{w:1,h:1},w=[],f=[],O=[],e=[];let Y,D,E,t;a.h=a.h<1?1:a.h,a.w=a.w<1?1:a.w,u.w=u.w<1?1:u.w,u.h=u.h<1?1:u.h;const B=(S-X)/a.w,W=(d-P)/a.h;function n(b,X,P,S){const d=f.length/3,N=u.w+1;for(Y=0;Y<u.h;Y++)for(D=0;D<u.w;D++){const b=[d+D+Y*N,d+(D+1)+Y*N,d+(D+1)+(Y+1)*N,d+D+(Y+1)*N];w.push(b[1]),w.push(b[2]),w.push(b[3]),w.push(b[0]),w.push(b[1]),w.push(b[3])}const a=Q.tX.Zero(),E=new Q.tX(0,1,0);for(Y=0;Y<=u.h;Y++)for(a.z=Y*(S-X)/u.h+X,D=0;D<=u.w;D++)a.x=D*(P-b)/u.w+b,a.y=0,f.push(a.x,a.y,a.z),O.push(E.x,E.y,E.z),e.push(D/u.w,Y/u.h)}for(E=0;E<a.h;E++)for(t=0;t<a.w;t++)n(X+t*B,P+E*W,X+(t+1)*B,P+(E+1)*W);const y=new N.e;return y.indices=w,y.Kb=f,y.Tb=O,y.Vb=e,y}function E(b){const X=[],P=[],d=[],a=[];let u,w;const f=b.colorFilter||new S.yX(.3,.59,.11),e=b.alphaFilter||0;let Y=!1;if(b.minHeight>b.maxHeight){Y=!0;const X=b.maxHeight;b.maxHeight=b.minHeight,b.minHeight=X}for(u=0;u<=b.subdivisions;u++)for(w=0;w<=b.subdivisions;w++){const X=new Q.tX(w*b.width/b.subdivisions-b.width/2,0,(b.subdivisions-u)*b.height/b.subdivisions-b.height/2),S=4*(((X.x+b.width/2)/b.width*(b.bufferWidth-1)|0)+((1-(X.z+b.height/2)/b.height)*(b.bufferHeight-1)|0)*b.bufferWidth);let N=b.buffer[S]/255,D=b.buffer[S+1]/255,E=b.buffer[S+2]/255;const t=b.buffer[S+3]/255;Y&&(N=1-N,D=1-D,E=1-E);const B=N*f.r+D*f.g+E*f.b;X.y=t>=e?b.minHeight+(b.maxHeight-b.minHeight)*B:b.minHeight-O.c,b.heightBuffer&&(b.heightBuffer[u*(b.subdivisions+1)+w]=X.y),P.push(X.x,X.y,X.z),d.push(0,0,0),a.push(w/b.subdivisions,1-u/b.subdivisions)}for(u=0;u<b.subdivisions;u++)for(w=0;w<b.subdivisions;w++){const Q=w+1+(u+1)*(b.subdivisions+1),S=w+1+u*(b.subdivisions+1),d=w+u*(b.subdivisions+1),N=w+(u+1)*(b.subdivisions+1),a=P[3*Q+1]>=b.minHeight,f=P[3*S+1]>=b.minHeight,O=P[3*d+1]>=b.minHeight;a&&f&&O&&(X.push(Q),X.push(S),X.push(d));P[3*N+1]>=b.minHeight&&a&&O&&(X.push(N),X.push(Q),X.push(d))}N.e.ComputeNormals(P,X,d);const D=new N.e;return D.indices=X,D.Kb=P,D.Tb=d,D.Vb=a,D}function t(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const P=new u(b,arguments.length>2?arguments[2]:void 0);P._setReady(!1),P._subdivisionsX=X.subdivisionsX||X.subdivisions||1,P._subdivisionsY=X.subdivisionsY||X.subdivisions||1,P._width=X.width||1,P._height=X.height||1,P._maxX=P._width/2,P._maxZ=P._height/2,P._minX=-P._maxX,P._minZ=-P._maxZ;return Y(X).xb(P,X.updatable),P._setReady(!0),P}function B(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new d.b(b,P);return D(X).xb(Q,X.updatable),Q}function W(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const d=P.width||10,N=P.height||10,a=P.subdivisions||1,O=P.minHeight||0,e=P.maxHeight||1,Y=P.colorFilter||new S.yX(.3,.59,.11),D=P.alphaFilter||0,t=P.updatable,B=P.onReady;Q=Q||f.e.LastCreatedScene;const W=new u(b,Q);let n;W._subdivisionsX=a,W._subdivisionsY=a,W._width=d,W._height=N,W._maxX=W._width/2,W._maxZ=W._height/2,W._minX=-W._maxX,W._minZ=-W._maxZ,W._setReady(!1),P.passHeightBufferInCallback&&(n=new Float32Array((a+1)*(a+1)));const y=(b,X,P)=>{E({width:d,height:N,subdivisions:a,minHeight:O,maxHeight:e,colorFilter:Y,buffer:b,bufferWidth:X,bufferHeight:P,alphaFilter:D,heightBuffer:n}).xb(W,t),B&&B(W,n),W._setReady(!0)};if("string"===typeof X){const b=b=>{var X;const P=b.width,S=b.height;if(Q.Y)return;const d=null===(X=Q)||void 0===X?void 0:X.getEngine().resizeImageBitmap(b,P,S);y(d,P,S)};w.Tools.LoadImage(X,b,P.onError?P.onError:()=>{},Q.offlineProvider)}else y(X.data,X.width,X.height);return W}N.e.CreateGround=Y,N.e.CreateTiledGround=D,N.e.CreateGroundFromHeightMap=E,d.b.CreateGround=(b,X,P,Q,S,d)=>t(b,{width:X,height:P,subdivisions:Q,updatable:d},S),d.b.CreateTiledGround=(b,X,P,Q,S,d,N,a,u)=>B(b,{xmin:X,zmin:P,xmax:Q,zmax:S,subdivisions:d,precision:N,updatable:u},a),d.b.CreateGroundFromHeightMap=(b,X,P,Q,S,d,N,a,u,w,f)=>W(b,X,{width:P,height:Q,subdivisions:S,minHeight:d,maxHeight:N,updatable:u,onReady:w,alphaFilter:f},a)},13813:(b,X,P)=>{"use strict";P.d(X,{d:()=>Y,g:()=>O,k:()=>e});var Q=P(11834),S=P(12319),d=P(12299),N=P(12402),a=P(11912),u=P(11700);function w(b){const X=[],P=[],Q=b.lines,S=b.qb,N=[];let a=0;for(let d=0;d<Q.length;d++){const b=Q[d];for(let Q=0;Q<b.length;Q++){const{x:u,y:w,z:f}=b[Q];if(P.push(u,w,f),S){const b=S[d],{r:X,g:P,b:a,a:u}=b[Q];N.push(X,P,a,u)}Q>0&&(X.push(a-1),X.push(a)),a++}}const u=new d.e;return u.indices=X,u.Kb=P,S&&(u.qb=N),u}function f(b){const X=b.dashSize||3,P=b.gapSize||1,S=b.dashNb||200,N=b.points,a=[],u=[],w=Q.tX.Zero();let f=0,O=0,e=0,Y=0,D=0,E=0,t=0;for(t=0;t<N.length-1;t++)N[t+1].subtractToRef(N[t],w),f+=w.length();for(e=f/S,Y=X*e/(X+P),t=0;t<N.length-1;t++){N[t+1].subtractToRef(N[t],w),O=Math.floor(w.length()/e),w.normalize();for(let b=0;b<O;b++)D=e*b,a.push(N[t].x+D*w.x,N[t].y+D*w.y,N[t].z+D*w.z),a.push(N[t].x+(D+Y)*w.x,N[t].y+(D+Y)*w.y,N[t].z+(D+Y)*w.z),u.push(E,E+1),E+=2}const B=new d.e;return B.Kb=a,B.indices=u,B}function O(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=X.instance,S=X.lines,d=X.qb;if(Q){const b=Q.getVerticesData(a.g.PositionKind);let X,P;d&&(X=Q.getVerticesData(a.g.ColorKind));let N=0,u=0;for(let Q=0;Q<S.length;Q++){const a=S[Q];for(let S=0;S<a.length;S++)b[N]=a[S].x,b[N+1]=a[S].y,b[N+2]=a[S].z,d&&X&&(P=d[Q],X[u]=P[S].r,X[u+1]=P[S].g,X[u+2]=P[S].b,X[u+3]=P[S].a,u+=4),N+=3}return Q.updateVerticesData(a.g.PositionKind,b,!1,!1),d&&X&&Q.updateVerticesData(a.g.ColorKind,X,!1,!1),Q.refreshBoundingInfo(),Q}const u=!!d,f=new N.e(b,P,null,void 0,void 0,u,X.useVertexAlpha,X.material);return w(X).xb(f,X.updatable),f}function e(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=X.qb?[X.qb]:null;return O(b,{lines:[X.points],updatable:X.updatable,instance:X.instance,qb:Q,useVertexAlpha:X.useVertexAlpha,material:X.material},P)}function Y(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=X.points,a=X.instance,w=X.gapSize||1,O=X.dashSize||3;if(a){const b=b=>{const X=Q.tX.Zero(),P=b.length/6;let S=0,N=0,u=0,w=0,f=0,O=0,e=0,Y=0;for(e=0;e<d.length-1;e++)d[e+1].subtractToRef(d[e],X),S+=X.length();u=S/P;const D=a._creationDataStorage.dashSize;for(w=D*u/(D+a._creationDataStorage.gapSize),e=0;e<d.length-1;e++)for(d[e+1].subtractToRef(d[e],X),N=Math.floor(X.length()/u),X.normalize(),Y=0;Y<N&&O<b.length;)f=u*Y,b[O]=d[e].x+f*X.x,b[O+1]=d[e].y+f*X.y,b[O+2]=d[e].z+f*X.z,b[O+3]=d[e].x+(f+w)*X.x,b[O+4]=d[e].y+(f+w)*X.y,b[O+5]=d[e].z+(f+w)*X.z,O+=6,Y++;for(;O<b.length;)b[O]=d[e].x,b[O+1]=d[e].y,b[O+2]=d[e].z,O+=3};return(X.dashNb||X.dashSize||X.gapSize||X.useVertexAlpha||X.material)&&u.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),a.updateMeshPositions(b,!1),a}const e=new N.e(b,P,null,void 0,void 0,void 0,X.useVertexAlpha,X.material);return f(X).xb(e,X.updatable),e._creationDataStorage=new S.e,e._creationDataStorage.dashSize=O,e._creationDataStorage.gapSize=w,e}d.e.CreateLineSystem=w,d.e.CreateDashedLines=f,S.b.fw=function(b,X){return e(b,{points:X,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},S.b.CreateDashedLines=function(b,X,P,Q,S){return Y(b,{points:X,dashSize:P,gapSize:Q,dashNb:S,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13215:(b,X,P)=>{"use strict";P.d(X,{c:()=>a,d:()=>u});var Q=P(12319),S=P(12299),d=P(11895);function N(b){const X=[],P=[],Q=[],N=[],a=void 0!==b.width?b.width:void 0!==b.size?b.size:1,u=void 0!==b.height?b.height:void 0!==b.size?b.size:1,w=0===b.sideOrientation?0:b.sideOrientation||S.e.DEFAULTSIDE,f=a/2,O=u/2;P.push(-f,-O,0),Q.push(0,0,-1),N.push(0,d.c?1:0),P.push(f,-O,0),Q.push(0,0,-1),N.push(1,d.c?1:0),P.push(f,O,0),Q.push(0,0,-1),N.push(1,d.c?0:1),P.push(-f,O,0),Q.push(0,0,-1),N.push(0,d.c?0:1),X.push(0),X.push(1),X.push(2),X.push(0),X.push(2),X.push(3),S.e._ComputeSides(w,P,X,Q,N,b.frontUVs,b.backUVs);const e=new S.e;return e.indices=X,e.Kb=P,e.Tb=Q,e.Vb=N,e}function a(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new Q.b(b,P);X.sideOrientation=Q.b._GetDefaultSideOrientation(X.sideOrientation),S._originalBuilderSideOrientation=X.sideOrientation;return N(X).xb(S,X.updatable),X.sourcePlane&&(S.translate(X.sourcePlane.normal,-X.sourcePlane.d),S.setDirection(X.sourcePlane.normal.scale(-1))),S}const u={Yw:a};S.e.Yw=N,Q.b.Yw=(b,X,P,Q,S)=>a(b,{size:X,width:X,height:X,sideOrientation:S,updatable:Q},P)},13306:(b,X,P)=>{"use strict";P.d(X,{d:()=>u});var Q=P(11834),S=P(12319),d=P(12299),N=P(11895);function a(b){const X=0|(b.segments||32),P=b.diameterX||b.diameter||1,S=b.diameterY||b.diameter||1,a=b.diameterZ||b.diameter||1,u=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1,w=b.slice&&b.slice<=0?1:b.slice||1,f=0===b.sideOrientation?0:b.sideOrientation||d.e.DEFAULTSIDE,O=!!b.dedupTopBottomIndices,e=new Q.tX(P/2,S/2,a/2),Y=2+X,D=2*Y,E=[],t=[],B=[],W=[];for(let d=0;d<=Y;d++){const b=d/Y,X=b*Math.PI*w;for(let P=0;P<=D;P++){const S=P/D,d=S*Math.PI*2*u,a=Q.Matrix.RotationZ(-X),w=Q.Matrix.RotationY(d),f=Q.tX.TransformCoordinates(Q.tX.Up(),a),O=Q.tX.TransformCoordinates(f,w),Y=O.multiply(e),E=O.divide(e).normalize();t.push(Y.x,Y.y,Y.z),B.push(E.x,E.y,E.z),W.push(S,N.c?1-b:b)}if(d>0){const b=t.length/3;for(let X=b-2*(D+1);X+D+2<b;X++)O?(d>1&&(E.push(X),E.push(X+1),E.push(X+D+1)),(d<Y||w<1)&&(E.push(X+D+1),E.push(X+1),E.push(X+D+2))):(E.push(X),E.push(X+1),E.push(X+D+1),E.push(X+D+1),E.push(X+1),E.push(X+D+2))}}d.e._ComputeSides(f,t,E,B,W,b.frontUVs,b.backUVs);const n=new d.e;return n.indices=E,n.Kb=t,n.Tb=B,n.Vb=W,n}function u(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new S.b(b,P);X.sideOrientation=S.b._GetDefaultSideOrientation(X.sideOrientation),Q._originalBuilderSideOrientation=X.sideOrientation;return a(X).xb(Q,X.updatable),Q}d.e.CreateSphere=a,S.b.CreateSphere=(b,X,P,Q,S,d)=>u(b,{segments:X,diameterX:P,diameterY:P,diameterZ:P,sideOrientation:d,updatable:S},Q)},14119:(b,X,P)=>{"use strict";P.d(X,{b:()=>a});var Q=P(12423),S=P(13602),d=P(12438),N=P(12299);class a{static get Configuration(){return{get decoder(){return S.b.DefaultConfiguration},set decoder(b){S.b.DefaultConfiguration=b}}}static set Configuration(b){S.b.DefaultConfiguration=b.decoder}static get DecoderAvailable(){return(0,Q.i)(S.b.DefaultConfiguration)}static get Default(){return a._Default??(a._Default=new a),a._Default}static ResetDefault(b){a._Default&&(b||a._Default.dispose(),a._Default=null)}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.DefaultNumWorkers;const X="number"===typeof b?{...S.b.DefaultConfiguration,numWorkers:b}:{...S.b.DefaultConfiguration,...b};this._decoder=new S.b(X)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(b,X,P){return this._decoder.decodeMeshToMeshDataAsync(b,X,P)}async decodeMeshToGeometryAsync(b,X,P,Q){return await this._decoder.decodeMeshToGeometryAsync(b,X,P,Q)}async _decodeMeshToGeometryForGltfAsync(b,X,P,Q,S,d){return await this._decoder._decodeMeshToGeometryForGltfAsync(b,X,P,Q,S,d)}async decodeMeshAsync(b,X){const P=await this._decoder.decodeMeshToMeshDataAsync(b,X),Q=new N.e;P.indices&&(Q.indices=P.indices);for(const S of P.attributes){const b=d.b.GetFloatData(S.data,S.size,d.b.GetDataType(S.data),S.byteOffset,S.byteStride,S.normalized,P.totalVertices);Q.set(b,S.kind)}return Q}}a.DefaultNumWorkers=(0,Q.f)(),a._Default=null},13602:(b,X,P)=>{"use strict";P.d(X,{b:()=>w});var Q=P(12423),S=P(11689),d=P(12335),N=P(12438),a=P(11700),u=P(12435);class w extends Q.d{static get DefaultAvailable(){return(0,Q.i)(w.DefaultConfiguration)}static get Default(){return w._Default??(w._Default=new w),w._Default}static ResetDefault(b){w._Default&&(b||w._Default.dispose(),w._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(b,X){return{module:await(X||DracoDecoderModule)({wasmBinary:b})}}_getWorkerContent(){return`${u.e}(${u.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.DefaultConfiguration)}decodeMeshToMeshDataAsync(b,X,P){const Q=b instanceof ArrayBuffer?new Int8Array(b):new Int8Array(b.buffer,b.byteOffset,b.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async b=>await new Promise(((S,d)=>{b.push(((b,N)=>{let u=null;const w=[],f=X=>{b.removeEventListener("error",f),b.removeEventListener("message",O),d(X),N()},O=X=>{const Q=X.data;switch(Q.id){case"indices":u=Q.data;break;case"attribute":w.push({kind:Q.kind,data:Q.data,size:Q.size,byteOffset:Q.byteOffset,byteStride:Q.byteStride,normalized:(d=Q.kind,e=Q.normalized,P&&void 0!==P[d]?(e!==P[d]&&a.b.Warn(`Normalized flag from Draco data (${e}) does not match normalized flag from glTF accessor (${P[d]}). Using flag from glTF accessor.`),P[d]):e)});break;case"decodeMeshDone":b.removeEventListener("error",f),b.removeEventListener("message",O),S({indices:u,attributes:w,totalVertices:Q.totalVertices}),N()}var d,e};b.addEventListener("error",f),b.addEventListener("message",O);const e=Q.slice();b.postMessage({id:"decodeMesh",dataView:e,attributes:X},[e.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((b=>{let P=null;const S=[],d=(0,u.e)(b.module,Q,X,(b=>{P=b}),((b,X,P,Q,d,N)=>{S.push({kind:b,data:X,size:P,byteOffset:Q,byteStride:d,normalized:N})}));return{indices:P,attributes:S,totalVertices:d}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(b,X,P,Q){const S=await this.decodeMeshToMeshDataAsync(P,Q),a=new d.e(b,X);S.indices&&a.setIndices(S.indices);for(const d of S.attributes)a.setVerticesBuffer(new N.b(X.getEngine(),d.data,d.kind,!1,void 0,d.byteStride,void 0,d.byteOffset,d.size,void 0,d.normalized,!0),S.totalVertices);return a}async _decodeMeshToGeometryForGltfAsync(b,X,P,Q,S,a){const u=await this.decodeMeshToMeshDataAsync(P,Q,S),w=new d.e(b,X);a&&(w._boundingInfo=a,w.useBoundingInfoFromGeometry=!0),u.indices&&w.setIndices(u.indices);for(const d of u.attributes)w.setVerticesBuffer(new N.b(X.getEngine(),d.data,d.kind,!1,void 0,d.byteStride,void 0,d.byteOffset,d.size,void 0,d.normalized,!0),u.totalVertices);return w}}w.DefaultConfiguration={wasmUrl:`${S.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${S.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${S.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},w._Default=null},13811:(b,X,P)=>{"use strict";P.d(X,{e:()=>ab});var Q=P(11834),S=P(12319),d=P(11912),N=P(12299),a=P(11895);function u(b){let X=b.pathArray;const P=b.closeArray||!1,Q=b.closePath||!1,S=b.invertUV||!1,u=Math.floor(X[0].length/2);let w=b.offset||u;w=w>u?u:Math.floor(w);const f=0===b.sideOrientation?0:b.sideOrientation||N.e.DEFAULTSIDE,O=b.Vb,e=b.qb,Y=[],D=[],E=[],t=[],B=[],W=[],n=[],y=[];let h;const L=[],Z=[];let v,A,o;if(X.length<2){const b=[],P=[];for(A=0;A<X[0].length-w;A++)b.push(X[0][A]),P.push(X[0][A+w]);X=[b,P]}let K=0;const T=Q?1:0,q=P?1:0;let V,i,x,H,C,p;for(h=X[0].length,v=0;v<X.length+q;v++){for(n[v]=0,B[v]=[0],V=v===X.length?X[0]:X[v],i=V.length,h=h<i?h:i,o=0;o<i;)Y.push(V[o].x,V[o].y,V[o].z),o>0&&(x=V[o].BX(V[o-1]).length(),H=x+n[v],B[v].push(H),n[v]=H),o++;Q&&(o--,Y.push(V[0].x,V[0].y,V[0].z),x=V[o].BX(V[0]).length(),H=x+n[v],B[v].push(H),n[v]=H),L[v]=i+T,Z[v]=K,K+=i+T}let k,z,U=null,g=null;for(A=0;A<h+T;A++)for(y[A]=0,W[A]=[0],v=0;v<X.length-1+q;v++)C=X[v],p=v===X.length-1?X[0]:X[v+1],A===h?(U=C[0],g=p[0]):(U=C[A],g=p[A]),x=g.BX(U).length(),H=x+y[A],W[A].push(H),y[A]=H;if(O)for(v=0;v<O.length;v++)t.push(O[v].x,a.c?1-O[v].y:O[v].y);else for(v=0;v<X.length+q;v++)for(A=0;A<h+T;A++)k=0!=n[v]?B[v][A]/n[v]:0,z=0!=y[A]?W[A][v]/y[A]:0,S?t.push(z,k):t.push(k,a.c?1-z:z);v=0;let j=0,l=L[v]-1,J=L[v+1]-1,c=l<J?l:J,s=Z[1]-Z[0];const F=L.length-1;for(;j<=c&&v<F;)D.push(j,j+s,j+1),D.push(j+s+1,j+1,j+s),j+=1,j===c&&(v++,s=Z[v+1]-Z[v],l=L[v]-1,J=L[v+1]-1,j=Z[v],c=l<J?l+j:J+j);if(N.e.ComputeNormals(Y,D,E),Q){let b=0,P=0;for(v=0;v<X.length;v++){b=3*Z[v],P=v+1<X.length?3*(Z[v+1]-1):E.length-3,E[b]=.5*(E[b]+E[P]),E[b+1]=.5*(E[b+1]+E[P+1]),E[b+2]=.5*(E[b+2]+E[P+2]);const Q=Math.sqrt(E[b]*E[b]+E[b+1]*E[b+1]+E[b+2]*E[b+2]);E[b]/=Q,E[b+1]/=Q,E[b+2]/=Q,E[P]=E[b],E[P+1]=E[b+1],E[P+2]=E[b+2]}}if(P){let b=3*Z[0],P=3*Z[X.length];for(A=0;A<h+T;A++){E[b]=.5*(E[b]+E[P]),E[b+1]=.5*(E[b+1]+E[P+1]),E[b+2]=.5*(E[b+2]+E[P+2]);const X=Math.sqrt(E[b]*E[b]+E[b+1]*E[b+1]+E[b+2]*E[b+2]);E[b]/=X,E[b+1]/=X,E[b+2]/=X,E[P]=E[b],E[P+1]=E[b+1],E[P+2]=E[b+2],b+=3,P+=3}}N.e._ComputeSides(f,Y,D,E,t,b.frontUVs,b.backUVs);let M=null;if(e){M=new Float32Array(4*e.length);for(let b=0;b<e.length;b++)M[4*b]=e[b].r,M[4*b+1]=e[b].g,M[4*b+2]=e[b].b,M[4*b+3]=e[b].a}const R=new N.e,r=new Float32Array(Y),I=new Float32Array(E),G=new Float32Array(t);return R.indices=D,R.Kb=r,R.Tb=I,R.Vb=G,M&&R.set(M,d.g.ColorKind),Q&&(R._idx=Z),R}function w(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=X.pathArray,f=X.closeArray,O=X.closePath,e=S.b._GetDefaultSideOrientation(X.sideOrientation),Y=X.instance,D=X.updatable;if(Y){const b=Q.TmpVectors.tX[0].Gd(Number.MAX_VALUE),P=Q.TmpVectors.tX[1].Gd(-Number.MAX_VALUE),u=X=>{let Q=w[0].length;const d=Y;let N=0;const a=d._originalBuilderSideOrientation===S.b.DOUBLESIDE?2:1;for(let S=1;S<=a;++S)for(let a=0;a<w.length;++a){const S=w[a],u=S.length;Q=Q<u?Q:u;for(let d=0;d<Q;++d){const Q=S[d];X[N]=Q.x,X[N+1]=Q.y,X[N+2]=Q.z,b.minimizeInPlaceFromFloats(Q.x,Q.y,Q.z),P.maximizeInPlaceFromFloats(Q.x,Q.y,Q.z),N+=3}if(d._creationDataStorage&&d._creationDataStorage.closePath){const b=S[0];X[N]=b.x,X[N+1]=b.y,X[N+2]=b.z,N+=3}}},f=Y.getVerticesData(d.g.PositionKind);if(u(f),Y.hasBoundingInfo?Y.getBoundingInfo().reConstruct(b,P,Y._worldMatrix):Y.buildBoundingInfo(b,P,Y._worldMatrix),Y.updateVerticesData(d.g.PositionKind,f,!1,!1),X.qb){const b=Y.getVerticesData(d.g.ColorKind);for(let P=0,Q=0;P<X.qb.length;P++,Q+=4){const S=X.qb[P];b[Q]=S.r,b[Q+1]=S.g,b[Q+2]=S.b,b[Q+3]=S.a}Y.updateVerticesData(d.g.ColorKind,b,!1,!1)}if(X.Vb){const b=Y.getVerticesData(d.g.UVKind);for(let P=0;P<X.Vb.length;P++)b[2*P]=X.Vb[P].x,b[2*P+1]=a.c?1-X.Vb[P].y:X.Vb[P].y;Y.updateVerticesData(d.g.UVKind,b,!1,!1)}if(!Y.areNormalsFrozen||Y.isFacetDataEnabled){const b=Y.ld(),X=Y.getVerticesData(d.g.NormalKind),P=Y.isFacetDataEnabled?Y.getFacetDataParameters():null;if(N.e.ComputeNormals(f,b,X,P),Y._creationDataStorage&&Y._creationDataStorage.closePath){let b=0,P=0;for(let Q=0;Q<w.length;Q++)b=3*Y._creationDataStorage.idx[Q],P=Q+1<w.length?3*(Y._creationDataStorage.idx[Q+1]-1):X.length-3,X[b]=.5*(X[b]+X[P]),X[b+1]=.5*(X[b+1]+X[P+1]),X[b+2]=.5*(X[b+2]+X[P+2]),X[P]=X[b],X[P+1]=X[b+1],X[P+2]=X[b+2]}Y.areNormalsFrozen||Y.updateVerticesData(d.g.NormalKind,X,!1,!1)}return Y}{const Q=new S.b(b,P);Q._originalBuilderSideOrientation=e,Q._creationDataStorage=new S.e;const d=u(X);return O&&(Q._creationDataStorage.idx=d._idx),Q._creationDataStorage.closePath=O,Q._creationDataStorage.closeArray=f,d.xb(Q,D),Q}}N.e.CreateRibbon=u,S.b.CreateRibbon=function(b,X){return w(b,{pathArray:X,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var f=P(13313),O=P(13160),e=P(11878);function Y(b){const X=b.pattern||S.b.NO_FLIP,P=b.tileWidth||b.tileSize||1,Q=b.tileHeight||b.tileSize||1,d=b.alignHorizontal||0,a=b.alignVertical||0,u=b.width||b.size||1,w=Math.floor(u/P);let f=u-w*P;const O=b.height||b.size||1,e=Math.floor(O/Q);let Y=O-e*Q;const D=P*w/2,E=Q*e/2;let t=0,B=0,W=0,n=0,y=0,h=0;if(f>0||Y>0){switch(W=-D,n=-E,y=D,h=E,d){case S.b.CENTER:f/=2,W-=f,y+=f;break;case S.b.LEFT:y+=f,t=-f/2;break;case S.b.RIGHT:W-=f,t=f/2}switch(a){case S.b.CENTER:Y/=2,n-=Y,h+=Y;break;case S.b.BOTTOM:h+=Y,B=-Y/2;break;case S.b.TOP:n-=Y,B=Y/2}}const L=[],Z=[],v=[];v[0]=[0,0,1,0,1,1,0,1],v[1]=[0,0,1,0,1,1,0,1],X!==S.b.ROTATE_TILE&&X!==S.b.ROTATE_ROW||(v[1]=[1,1,0,1,0,0,1,0]),X!==S.b.FLIP_TILE&&X!==S.b.FLIP_ROW||(v[1]=[1,0,0,0,0,1,1,1]),X!==S.b.FLIP_N_ROTATE_TILE&&X!==S.b.FLIP_N_ROTATE_ROW||(v[1]=[0,1,1,1,1,0,0,0]);let A=[];const o=[],K=[];let T=0;for(let N=0;N<e;N++)for(let b=0;b<w;b++)L.push(b*P-D+t,N*Q-E+B,0),L.push((b+1)*P-D+t,N*Q-E+B,0),L.push((b+1)*P-D+t,(N+1)*Q-E+B,0),L.push(b*P-D+t,(N+1)*Q-E+B,0),K.push(T,T+1,T+3,T+1,T+2,T+3),A=X===S.b.FLIP_TILE||X===S.b.ROTATE_TILE||X===S.b.FLIP_N_ROTATE_TILE?A.concat(v[(b%2+N%2)%2]):X===S.b.FLIP_ROW||X===S.b.ROTATE_ROW||X===S.b.FLIP_N_ROTATE_ROW?A.concat(v[N%2]):A.concat(v[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),T+=4;if(f>0||Y>0){const b=Y>0&&(a===S.b.CENTER||a===S.b.TOP),N=Y>0&&(a===S.b.CENTER||a===S.b.BOTTOM),u=f>0&&(d===S.b.CENTER||d===S.b.RIGHT),O=f>0&&(d===S.b.CENTER||d===S.b.LEFT);let v,q,V,i,x=[];if(b&&u&&(L.push(W+t,n+B,0),L.push(-D+t,n+B,0),L.push(-D+t,n+Y+B,0),L.push(W+t,n+Y+B,0),K.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,v=1-f/P,q=1-Y/Q,V=1,i=1,x=[v,q,V,q,V,i,v,i],X===S.b.ROTATE_ROW&&(x=[1-v,1-q,1-V,1-q,1-V,1-i,1-v,1-i]),X===S.b.FLIP_ROW&&(x=[1-v,q,1-V,q,1-V,i,1-v,i]),X===S.b.FLIP_N_ROTATE_ROW&&(x=[v,1-q,V,1-q,V,1-i,v,1-i]),A=A.concat(x),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),b&&O&&(L.push(D+t,n+B,0),L.push(y+t,n+B,0),L.push(y+t,n+Y+B,0),L.push(D+t,n+Y+B,0),K.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,v=0,q=1-Y/Q,V=f/P,i=1,x=[v,q,V,q,V,i,v,i],(X===S.b.ROTATE_ROW||X===S.b.ROTATE_TILE&&w%2===0)&&(x=[1-v,1-q,1-V,1-q,1-V,1-i,1-v,1-i]),(X===S.b.FLIP_ROW||X===S.b.FLIP_TILE&&w%2===0)&&(x=[1-v,q,1-V,q,1-V,i,1-v,i]),(X===S.b.FLIP_N_ROTATE_ROW||X===S.b.FLIP_N_ROTATE_TILE&&w%2===0)&&(x=[v,1-q,V,1-q,V,1-i,v,1-i]),A=A.concat(x),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N&&u&&(L.push(W+t,E+B,0),L.push(-D+t,E+B,0),L.push(-D+t,h+B,0),L.push(W+t,h+B,0),K.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,v=1-f/P,q=0,V=1,i=Y/Q,x=[v,q,V,q,V,i,v,i],(X===S.b.ROTATE_ROW&&e%2===1||X===S.b.ROTATE_TILE&&e%1===0)&&(x=[1-v,1-q,1-V,1-q,1-V,1-i,1-v,1-i]),(X===S.b.FLIP_ROW&&e%2===1||X===S.b.FLIP_TILE&&e%2===0)&&(x=[1-v,q,1-V,q,1-V,i,1-v,i]),(X===S.b.FLIP_N_ROTATE_ROW&&e%2===1||X===S.b.FLIP_N_ROTATE_TILE&&e%2===0)&&(x=[v,1-q,V,1-q,V,1-i,v,1-i]),A=A.concat(x),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N&&O&&(L.push(D+t,E+B,0),L.push(y+t,E+B,0),L.push(y+t,h+B,0),L.push(D+t,h+B,0),K.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,v=0,q=0,V=f/P,i=Y/Q,x=[v,q,V,q,V,i,v,i],(X===S.b.ROTATE_ROW&&e%2===1||X===S.b.ROTATE_TILE&&(e+w)%2===1)&&(x=[1-v,1-q,1-V,1-q,1-V,1-i,1-v,1-i]),(X===S.b.FLIP_ROW&&e%2===1||X===S.b.FLIP_TILE&&(e+w)%2===1)&&(x=[1-v,q,1-V,q,1-V,i,1-v,i]),(X===S.b.FLIP_N_ROTATE_ROW&&e%2===1||X===S.b.FLIP_N_ROTATE_TILE&&(e+w)%2===1)&&(x=[v,1-q,V,1-q,V,1-i,v,1-i]),A=A.concat(x),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),b){const b=[];v=0,q=1-Y/Q,V=1,i=1,b[0]=[v,q,V,q,V,i,v,i],b[1]=[v,q,V,q,V,i,v,i],X!==S.b.ROTATE_TILE&&X!==S.b.ROTATE_ROW||(b[1]=[1-v,1-q,1-V,1-q,1-V,1-i,1-v,1-i]),X!==S.b.FLIP_TILE&&X!==S.b.FLIP_ROW||(b[1]=[1-v,q,1-V,q,1-V,i,1-v,i]),X!==S.b.FLIP_N_ROTATE_TILE&&X!==S.b.FLIP_N_ROTATE_ROW||(b[1]=[v,1-q,V,1-q,V,1-i,v,1-i]);for(let Q=0;Q<w;Q++)L.push(Q*P-D+t,n+B,0),L.push((Q+1)*P-D+t,n+B,0),L.push((Q+1)*P-D+t,n+Y+B,0),L.push(Q*P-D+t,n+Y+B,0),K.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,A=X===S.b.FLIP_TILE||X===S.b.ROTATE_TILE||X===S.b.FLIP_N_ROTATE_TILE?A.concat(b[(Q+1)%2]):X===S.b.FLIP_ROW||X===S.b.ROTATE_ROW||X===S.b.FLIP_N_ROTATE_ROW?A.concat(b[1]):A.concat(b[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(N){const b=[];v=0,q=0,V=1,i=Y/Q,b[0]=[v,q,V,q,V,i,v,i],b[1]=[v,q,V,q,V,i,v,i],X!==S.b.ROTATE_TILE&&X!==S.b.ROTATE_ROW||(b[1]=[1-v,1-q,1-V,1-q,1-V,1-i,1-v,1-i]),X!==S.b.FLIP_TILE&&X!==S.b.FLIP_ROW||(b[1]=[1-v,q,1-V,q,1-V,i,1-v,i]),X!==S.b.FLIP_N_ROTATE_TILE&&X!==S.b.FLIP_N_ROTATE_ROW||(b[1]=[v,1-q,V,1-q,V,1-i,v,1-i]);for(let Q=0;Q<w;Q++)L.push(Q*P-D+t,h-Y+B,0),L.push((Q+1)*P-D+t,h-Y+B,0),L.push((Q+1)*P-D+t,h+B,0),L.push(Q*P-D+t,h+B,0),K.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,A=X===S.b.FLIP_TILE||X===S.b.ROTATE_TILE||X===S.b.FLIP_N_ROTATE_TILE?A.concat(b[(Q+e)%2]):X===S.b.FLIP_ROW||X===S.b.ROTATE_ROW||X===S.b.FLIP_N_ROTATE_ROW?A.concat(b[e%2]):A.concat(b[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(u){const b=[];v=1-f/P,q=0,V=1,i=1,b[0]=[v,q,V,q,V,i,v,i],b[1]=[v,q,V,q,V,i,v,i],X!==S.b.ROTATE_TILE&&X!==S.b.ROTATE_ROW||(b[1]=[1-v,1-q,1-V,1-q,1-V,1-i,1-v,1-i]),X!==S.b.FLIP_TILE&&X!==S.b.FLIP_ROW||(b[1]=[1-v,q,1-V,q,1-V,i,1-v,i]),X!==S.b.FLIP_N_ROTATE_TILE&&X!==S.b.FLIP_N_ROTATE_ROW||(b[1]=[v,1-q,V,1-q,V,1-i,v,1-i]);for(let P=0;P<e;P++)L.push(W+t,P*Q-E+B,0),L.push(W+f+t,P*Q-E+B,0),L.push(W+f+t,(P+1)*Q-E+B,0),L.push(W+t,(P+1)*Q-E+B,0),K.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,A=X===S.b.FLIP_TILE||X===S.b.ROTATE_TILE||X===S.b.FLIP_N_ROTATE_TILE?A.concat(b[(P+1)%2]):X===S.b.FLIP_ROW||X===S.b.ROTATE_ROW||X===S.b.FLIP_N_ROTATE_ROW?A.concat(b[P%2]):A.concat(b[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(O){const b=[];v=0,q=0,V=f/Q,i=1,b[0]=[v,q,V,q,V,i,v,i],b[1]=[v,q,V,q,V,i,v,i],X!==S.b.ROTATE_TILE&&X!==S.b.ROTATE_ROW||(b[1]=[1-v,1-q,1-V,1-q,1-V,1-i,1-v,1-i]),X!==S.b.FLIP_TILE&&X!==S.b.FLIP_ROW||(b[1]=[1-v,q,1-V,q,1-V,i,1-v,i]),X!==S.b.FLIP_N_ROTATE_TILE&&X!==S.b.FLIP_N_ROTATE_ROW||(b[1]=[v,1-q,V,1-q,V,1-i,v,1-i]);for(let P=0;P<e;P++)L.push(y-f+t,P*Q-E+B,0),L.push(y+t,P*Q-E+B,0),L.push(y+t,(P+1)*Q-E+B,0),L.push(y-f+t,(P+1)*Q-E+B,0),K.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,A=X===S.b.FLIP_TILE||X===S.b.ROTATE_TILE||X===S.b.FLIP_N_ROTATE_TILE?A.concat(b[(P+w)%2]):X===S.b.FLIP_ROW||X===S.b.ROTATE_ROW||X===S.b.FLIP_N_ROTATE_ROW?A.concat(b[P%2]):A.concat(b[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const q=0===b.sideOrientation?0:b.sideOrientation||N.e.DEFAULTSIDE;N.e._ComputeSides(q,L,K,Z,A,b.frontUVs,b.backUVs);const V=new N.e;V.indices=K,V.Kb=L,V.Tb=Z,V.Vb=A;const i=q===N.e.DOUBLESIDE?o.concat(o):o;return V.qb=i,V}function D(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new S.b(b,P);X.sideOrientation=S.b._GetDefaultSideOrientation(X.sideOrientation),Q._originalBuilderSideOrientation=X.sideOrientation;return Y(X).xb(Q,X.updatable),Q}function E(b){const X=b.faceUV||new Array(6),P=b.faceColors,d=b.pattern||S.b.NO_FLIP,u=b.width||b.size||1,w=b.height||b.size||1,f=b.depth||b.size||1,O=b.tileWidth||b.tileSize||1,D=b.tileHeight||b.tileSize||1,E=b.alignHorizontal||0,t=b.alignVertical||0,B=0===b.sideOrientation?0:b.sideOrientation||N.e.DEFAULTSIDE;for(let S=0;S<6;S++)void 0===X[S]&&(X[S]=new Q.Vector4(0,0,1,1)),P&&void 0===P[S]&&(P[S]=new e.Ba(1,1,1,1));const W=u/2,n=w/2,y=f/2,h=[];for(let Q=0;Q<2;Q++)h[Q]=Y({pattern:d,tileWidth:O,tileHeight:D,width:u,height:w,alignVertical:t,alignHorizontal:E,sideOrientation:B});for(let Q=2;Q<4;Q++)h[Q]=Y({pattern:d,tileWidth:O,tileHeight:D,width:f,height:w,alignVertical:t,alignHorizontal:E,sideOrientation:B});let L=t;t===S.b.BOTTOM?L=S.b.TOP:t===S.b.TOP&&(L=S.b.BOTTOM);for(let Q=4;Q<6;Q++)h[Q]=Y({pattern:d,tileWidth:O,tileHeight:D,width:u,height:f,alignVertical:L,alignHorizontal:E,sideOrientation:B});let Z=[],v=[],A=[],o=[];const K=[],T=[],q=[],V=[];let i=0,x=0;for(let S=0;S<6;S++){const b=h[S].Kb.length;T[S]=[],q[S]=[];for(let X=0;X<b/3;X++)T[S].push(new Q.tX(h[S].Kb[3*X],h[S].Kb[3*X+1],h[S].Kb[3*X+2])),q[S].push(new Q.tX(h[S].Tb[3*X],h[S].Tb[3*X+1],h[S].Tb[3*X+2]));i=h[S].Vb.length,V[S]=[];for(let P=0;P<i;P+=2)V[S][P]=X[S].x+(X[S].z-X[S].x)*h[S].Vb[P],V[S][P+1]=X[S].y+(X[S].w-X[S].y)*h[S].Vb[P+1],a.c&&(V[S][P+1]=1-V[S][P+1]);if(A=A.concat(V[S]),o=o.concat(h[S].indices.map((b=>b+x))),x+=T[S].length,P)for(let X=0;X<4;X++)K.push(P[S].r,P[S].g,P[S].b,P[S].a)}const H=new Q.tX(0,0,y),C=Q.Matrix.RotationY(Math.PI);Z=T[0].map((b=>Q.tX.TransformNormal(b,C).add(H))).map((b=>[b.x,b.y,b.z])).reduce(((b,X)=>b.concat(X)),[]),v=q[0].map((b=>Q.tX.TransformNormal(b,C))).map((b=>[b.x,b.y,b.z])).reduce(((b,X)=>b.concat(X)),[]),Z=Z.concat(T[1].map((b=>b.BX(H))).map((b=>[b.x,b.y,b.z])).reduce(((b,X)=>b.concat(X)),[])),v=v.concat(q[1].map((b=>[b.x,b.y,b.z])).reduce(((b,X)=>b.concat(X)),[]));const p=new Q.tX(W,0,0),k=Q.Matrix.RotationY(-Math.PI/2);Z=Z.concat(T[2].map((b=>Q.tX.TransformNormal(b,k).add(p))).map((b=>[b.x,b.y,b.z])).reduce(((b,X)=>b.concat(X)),[])),v=v.concat(q[2].map((b=>Q.tX.TransformNormal(b,k))).map((b=>[b.x,b.y,b.z])).reduce(((b,X)=>b.concat(X)),[]));const z=Q.Matrix.RotationY(Math.PI/2);Z=Z.concat(T[3].map((b=>Q.tX.TransformNormal(b,z).BX(p))).map((b=>[b.x,b.y,b.z])).reduce(((b,X)=>b.concat(X)),[])),v=v.concat(q[3].map((b=>Q.tX.TransformNormal(b,z))).map((b=>[b.x,b.y,b.z])).reduce(((b,X)=>b.concat(X)),[]));const U=new Q.tX(0,n,0),g=Q.Matrix.RotationX(Math.PI/2);Z=Z.concat(T[4].map((b=>Q.tX.TransformNormal(b,g).add(U))).map((b=>[b.x,b.y,b.z])).reduce(((b,X)=>b.concat(X)),[])),v=v.concat(q[4].map((b=>Q.tX.TransformNormal(b,g))).map((b=>[b.x,b.y,b.z])).reduce(((b,X)=>b.concat(X)),[]));const j=Q.Matrix.RotationX(-Math.PI/2);Z=Z.concat(T[5].map((b=>Q.tX.TransformNormal(b,j).BX(U))).map((b=>[b.x,b.y,b.z])).reduce(((b,X)=>b.concat(X)),[])),v=v.concat(q[5].map((b=>Q.tX.TransformNormal(b,j))).map((b=>[b.x,b.y,b.z])).reduce(((b,X)=>b.concat(X)),[])),N.e._ComputeSides(B,Z,o,v,A);const l=new N.e;if(l.indices=o,l.Kb=Z,l.Tb=v,l.Vb=A,P){const b=B===N.e.DOUBLESIDE?K.concat(K):K;l.qb=b}return l}function t(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new S.b(b,P);X.sideOrientation=S.b._GetDefaultSideOrientation(X.sideOrientation),Q._originalBuilderSideOrientation=X.sideOrientation;return E(X).xb(Q,X.updatable),Q}N.e.CreateTiledPlane=Y;N.e.CreateTiledBox=E;var B=P(13306),W=P(12093),n=P(12043);function y(b){const X=b.height||2;let P=0===b.diameterTop?0:b.diameterTop||b.diameter||1,d=0===b.diameterBottom?0:b.diameterBottom||b.diameter||1;P=P||1e-5,d=d||1e-5;const u=0|(b.tessellation||24),w=0|(b.subdivisions||1),f=!!b.hasRings,O=!!b.enclose,Y=0===b.cap?0:b.cap||S.b.CAP_ALL,D=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1,E=0===b.sideOrientation?0:b.sideOrientation||N.e.DEFAULTSIDE,t=b.faceUV||new Array(3),B=b.faceColors,W=2+(1+(1!==D&&O?2:0))*(f?w:1);let y;for(y=0;y<W;y++)B&&void 0===B[y]&&(B[y]=new e.Ba(1,1,1,1));for(y=0;y<W;y++)t&&void 0===t[y]&&(t[y]=new Q.Vector4(0,0,1,1));const h=[],L=[],Z=[],v=[],A=[],o=2*Math.PI*D/u;let K,T,q;const V=(d-P)/2/X,i=Q.tX.Zero(),x=Q.tX.Zero(),H=Q.tX.Zero(),C=Q.tX.Zero(),p=Q.tX.Zero(),k=n.e.Y;let z,U,g,j=1,l=1,J=0,c=0;for(z=0;z<=w;z++)for(T=z/w,q=(T*(P-d)+d)/2,j=f&&0!==z&&z!==w?2:1,g=0;g<j;g++){for(f&&(l+=g),O&&(l+=2*g),U=0;U<=u;U++)K=U*o,i.x=Math.cos(-K)*q,i.y=-X/2+T*X,i.z=Math.sin(-K)*q,0===P&&z===w?(x.x=Z[Z.length-3*(u+1)],x.y=Z[Z.length-3*(u+1)+1],x.z=Z[Z.length-3*(u+1)+2]):(x.x=i.x,x.z=i.z,x.y=Math.sqrt(x.x*x.x+x.z*x.z)*V,x.normalize()),0===U&&(H.N(i),C.N(x)),L.push(i.x,i.y,i.z),Z.push(x.x,x.y,x.z),c=f?J!==l?t[l].y:t[l].w:t[l].y+(t[l].w-t[l].y)*T,v.push(t[l].x+(t[l].z-t[l].x)*U/u,a.c?1-c:c),B&&A.push(B[l].r,B[l].g,B[l].b,B[l].a);1!==D&&O&&(L.push(i.x,i.y,i.z),L.push(0,i.y,0),L.push(0,i.y,0),L.push(H.x,H.y,H.z),Q.tX.CrossToRef(k,x,p),p.normalize(),Z.push(p.x,p.y,p.z,p.x,p.y,p.z),Q.tX.CrossToRef(C,k,p),p.normalize(),Z.push(p.x,p.y,p.z,p.x,p.y,p.z),c=f?J!==l?t[l+1].y:t[l+1].w:t[l+1].y+(t[l+1].w-t[l+1].y)*T,v.push(t[l+1].x,a.c?1-c:c),v.push(t[l+1].z,a.c?1-c:c),c=f?J!==l?t[l+2].y:t[l+2].w:t[l+2].y+(t[l+2].w-t[l+2].y)*T,v.push(t[l+2].x,a.c?1-c:c),v.push(t[l+2].z,a.c?1-c:c),B&&(A.push(B[l+1].r,B[l+1].g,B[l+1].b,B[l+1].a),A.push(B[l+1].r,B[l+1].g,B[l+1].b,B[l+1].a),A.push(B[l+2].r,B[l+2].g,B[l+2].b,B[l+2].a),A.push(B[l+2].r,B[l+2].g,B[l+2].b,B[l+2].a))),J!==l&&(J=l)}const s=1!==D&&O?u+4:u;for(z=0,l=0;l<w;l++){let b=0,X=0,P=0,Q=0;for(U=0;U<u;U++)b=z*(s+1)+U,X=(z+1)*(s+1)+U,P=z*(s+1)+(U+1),Q=(z+1)*(s+1)+(U+1),h.push(b,X,P),h.push(Q,P,X);1!==D&&O&&(h.push(b+2,X+2,P+2),h.push(Q+2,P+2,X+2),h.push(b+4,X+4,P+4),h.push(Q+4,P+4,X+4)),z=f?z+2:z+1}const F=b=>{const S=b?P/2:d/2;if(0===S)return;let N,w,f;const O=b?t[W-1]:t[0];let e=null;B&&(e=b?B[W-1]:B[0]);const Y=L.length/3,E=b?X/2:-X/2,n=new Q.tX(0,E,0);L.push(n.x,n.y,n.z),Z.push(0,b?1:-1,0);const y=O.y+.5*(O.w-O.y);v.push(O.x+.5*(O.z-O.x),a.c?1-y:y),e&&A.push(e.r,e.g,e.b,e.a);const o=new Q.Vector2(.5,.5);for(f=0;f<=u;f++){N=2*Math.PI*f*D/u;const X=Math.cos(-N),P=Math.sin(-N);w=new Q.tX(X*S,E,P*S);const d=new Q.Vector2(X*o.x+.5,P*o.y+.5);L.push(w.x,w.y,w.z),Z.push(0,b?1:-1,0);const Y=O.y+(O.w-O.y)*d.y;v.push(O.x+(O.z-O.x)*d.x,a.c?1-Y:Y),e&&A.push(e.r,e.g,e.b,e.a)}for(f=0;f<u;f++)b?(h.push(Y),h.push(Y+(f+2)),h.push(Y+(f+1))):(h.push(Y),h.push(Y+(f+1)),h.push(Y+(f+2)))};Y!==S.b.CAP_START&&Y!==S.b.CAP_ALL||F(!1),Y!==S.b.CAP_END&&Y!==S.b.CAP_ALL||F(!0),N.e._ComputeSides(E,L,h,Z,v,b.frontUVs,b.backUVs);const M=new N.e;return M.indices=h,M.Kb=L,M.Tb=Z,M.Vb=v,B&&(M.qb=A),M}function h(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;const Q=new S.b(b,P);X.sideOrientation=S.b._GetDefaultSideOrientation(X.sideOrientation),Q._originalBuilderSideOrientation=X.sideOrientation;return y(X).xb(Q,X.updatable),Q}function L(b){const X=[],P=[],S=[],d=[],u=b.diameter||1,w=b.thickness||.5,f=0|(b.tessellation||16),O=0===b.sideOrientation?0:b.sideOrientation||N.e.DEFAULTSIDE,e=f+1;for(let N=0;N<=f;N++){const b=N/f,O=N*Math.PI*2/f-Math.PI/2,Y=Q.Matrix.Translation(u/2,0,0).multiply(Q.Matrix.RotationY(O));for(let u=0;u<=f;u++){const O=1-u/f,D=u*Math.PI*2/f+Math.PI,E=Math.cos(D),t=Math.sin(D);let B=new Q.tX(E,t,0),W=B.scale(w/2);const n=new Q.Vector2(b,O);W=Q.tX.TransformCoordinates(W,Y),B=Q.tX.TransformNormal(B,Y),P.push(W.x,W.y,W.z),S.push(B.x,B.y,B.z),d.push(n.x,a.c?1-n.y:n.y);const y=(N+1)%e,h=(u+1)%e;X.push(N*e+u),X.push(N*e+h),X.push(y*e+u),X.push(N*e+h),X.push(y*e+h),X.push(y*e+u)}}N.e._ComputeSides(O,P,X,S,d,b.frontUVs,b.backUVs);const Y=new N.e;return Y.indices=X,Y.Kb=P,Y.Tb=S,Y.Vb=d,Y}function Z(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;const Q=new S.b(b,P);X.sideOrientation=S.b._GetDefaultSideOrientation(X.sideOrientation),Q._originalBuilderSideOrientation=X.sideOrientation;return L(X).xb(Q,X.updatable),Q}N.e.CreateCylinder=y,S.b.CreateCylinder=(b,X,P,Q,d,N,a,u,w)=>{void 0!==a&&a instanceof W.e||(void 0!==a&&(w=u||S.b.DEFAULTSIDE,u=a),a=N,N=1);return h(b,{height:X,diameterTop:P,diameterBottom:Q,tessellation:d,subdivisions:N,sideOrientation:w,updatable:u},a)};function v(b){const X=[],P=[],S=[],d=[],u=b.radius||2,w=b.tube||.5,f=b.radialSegments||32,O=b.tubularSegments||32,e=b.p||2,Y=b.q||3,D=0===b.sideOrientation?0:b.sideOrientation||N.e.DEFAULTSIDE,E=b=>{const X=Math.cos(b),P=Math.sin(b),S=Y/e*b,d=Math.cos(S),N=u*(2+d)*.5*X,a=u*(2+d)*P*.5,w=u*Math.sin(S)*.5;return new Q.tX(N,a,w)};let t,B;for(t=0;t<=f;t++){const b=t%f/f*2*e*Math.PI,X=E(b),S=E(b+.01),N=S.BX(X);let u=S.add(X);const Y=Q.tX.Cross(N,u);for(u=Q.tX.Cross(Y,N),Y.normalize(),u.normalize(),B=0;B<O;B++){const b=B%O/O*2*Math.PI,Q=-w*Math.cos(b),S=w*Math.sin(b);P.push(X.x+Q*u.x+S*Y.x),P.push(X.y+Q*u.y+S*Y.y),P.push(X.z+Q*u.z+S*Y.z),d.push(t/f),d.push(a.c?1-B/O:B/O)}}for(t=0;t<f;t++)for(B=0;B<O;B++){const b=(B+1)%O,P=t*O+B,Q=(t+1)*O+B,S=(t+1)*O+b,d=t*O+b;X.push(d),X.push(Q),X.push(P),X.push(d),X.push(S),X.push(Q)}N.e.ComputeNormals(P,X,S),N.e._ComputeSides(D,P,X,S,d,b.frontUVs,b.backUVs);const W=new N.e;return W.indices=X,W.Kb=P,W.Tb=S,W.Vb=d,W}function A(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;const Q=new S.b(b,P);X.sideOrientation=S.b._GetDefaultSideOrientation(X.sideOrientation),Q._originalBuilderSideOrientation=X.sideOrientation;return v(X).xb(Q,X.updatable),Q}N.e.CreateTorus=L,S.b.CreateTorus=(b,X,P,Q,S,d,N)=>Z(b,{diameter:X,thickness:P,tessellation:Q,sideOrientation:N,updatable:d},S);N.e.CreateTorusKnot=v,S.b.CreateTorusKnot=(b,X,P,Q,S,d,N,a,u,w)=>A(b,{radius:X,tube:P,radialSegments:Q,tubularSegments:S,p:d,q:N,sideOrientation:w,updatable:u},a);var o=P(13813),K=P(12418),T=P(12057);function q(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=X.path,d=X.shape,N=X.scale||1,a=X.rotation||0,u=0===X.cap?0:X.cap||S.b.NO_CAP,w=X.updatable,f=S.b._GetDefaultSideOrientation(X.sideOrientation),O=X.instance||null,e=X.invertUV||!1,Y=X.closeShape||!1,D=X.closePath||!1,E=X.capFunction||null;return i(b,d,Q,N,a,null,null,D,Y,u,!1,P,!!w,f,O,e,X.frontUVs||null,X.backUVs||null,X.firstNormal||null,!!X.adjustFrame,E)}function V(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=X.path,d=X.shape,N=X.scaleFunction||(()=>1),a=X.rotationFunction||(()=>0),u=X.closePath||X.ribbonCloseArray||!1,w=X.closeShape||X.ribbonClosePath||!1,f=0===X.cap?0:X.cap||S.b.NO_CAP,O=X.updatable,e=X.firstNormal||null,Y=X.adjustFrame||!1,D=S.b._GetDefaultSideOrientation(X.sideOrientation),E=X.instance,t=X.invertUV||!1,B=X.capFunction||null;return i(b,d,Q,null,null,N,a,u,w,f,!0,P,!!O,D,E||null,t,X.frontUVs||null,X.backUVs||null,e,Y,B||null)}function i(b,X,P,d,N,a,u,f,O,e,Y,D,E,t,B,W,n,y,h,L,Z){const v=(b,X,P,d,N,a,u,w,f,O,e)=>{const Y=P.getTangents(),D=P.getNormals(),E=P.getBinormals(),t=P.getDistances();if(e)for(let S=0;S<Y.length;S++)if(0==Y[S].x&&0==Y[S].y&&0==Y[S].z&&Y[S].N(Y[S-1]),0==D[S].x&&0==D[S].y&&0==D[S].z&&D[S].N(D[S-1]),0==E[S].x&&0==E[S].y&&0==E[S].z&&E[S].N(E[S-1]),S>0){let b=Y[S-1];Q.tX.Dot(b,Y[S])<0&&Y[S].scaleInPlace(-1),b=D[S-1],Q.tX.Dot(b,D[S])<0&&D[S].scaleInPlace(-1),b=E[S-1],Q.tX.Dot(b,E[S])<0&&E[S].scaleInPlace(-1)}let B=0;const W=O&&w?w:()=>null!==a?a:0,n=O&&u?u:()=>null!==N?N:1;let y=f===S.b.NO_CAP||f===S.b.CAP_END?0:2;const h=Q.TmpVectors.Matrix[0];for(let S=0;S<X.length;S++){const P=[],N=W(S,t[S]),a=n(S,t[S]);Q.Matrix.RotationAxisToRef(Y[S],B,h);for(let d=0;d<b.length;d++){const N=Y[S].scale(b[d].z).add(D[S].scale(b[d].x)).add(E[S].scale(b[d].y)),u=Q.tX.Zero();Q.tX.TransformCoordinatesToRef(N,h,u),u.scaleInPlace(a).addInPlace(X[S]),P[d]=u}d[y]=P,B+=N,y++}const L=Z||(b=>{const X=Array(),P=Q.tX.Zero();let S;for(S=0;S<b.length;S++)P.addInPlace(b[S]);for(P.scaleInPlace(1/b.length),S=0;S<b.length;S++)X.push(P);return X});switch(f){case S.b.NO_CAP:break;case S.b.CAP_START:d[0]=L(d[2]),d[1]=d[2];break;case S.b.CAP_END:d[y]=d[y-1],d[y+1]=L(d[y-1]);break;case S.b.CAP_ALL:d[0]=L(d[2]),d[1]=d[2],d[y]=d[y-1],d[y+1]=L(d[y-1])}return d};let A,o;if(B){const b=B._creationDataStorage;return A=h?b.path3D.update(P,h):b.path3D.update(P),o=v(X,P,b.path3D,b.pathArray,d,N,a,u,b.cap,Y,L),B=w("",{pathArray:o,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:B},D||void 0)}A=h?new T.k(P,h):new T.k(P);o=v(X,P,A,new Array,d,N,a,u,e=e<0||e>3?0:e,Y,L);const K=w(b,{pathArray:o,closeArray:f,closePath:O,updatable:E,sideOrientation:t,invertUV:W,frontUVs:n||void 0,backUVs:y||void 0},D);return K._creationDataStorage.pathArray=o,K._creationDataStorage.path3D=A,K._creationDataStorage.cap=e,K}function x(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=X.arc?X.arc<=0||X.arc>1?1:X.arc:1,N=void 0===X.closed||X.closed,a=X.shape,u=X.radius||1,f=X.tessellation||64,O=X.clip||0,e=X.updatable,Y=S.b._GetDefaultSideOrientation(X.sideOrientation),D=X.cap||S.b.NO_CAP,E=2*Math.PI,t=[],B=X.invertUV||!1;let W=0,n=0;const y=E/f*d;let h,L;for(W=0;W<=f-O;W++){for(L=[],D!=S.b.CAP_START&&D!=S.b.CAP_ALL||(L.push(new Q.tX(0,a[0].y,0)),L.push(new Q.tX(Math.cos(W*y)*a[0].x*u,a[0].y,Math.sin(W*y)*a[0].x*u))),n=0;n<a.length;n++)h=new Q.tX(Math.cos(W*y)*a[n].x*u,a[n].y,Math.sin(W*y)*a[n].x*u),L.push(h);D!=S.b.CAP_END&&D!=S.b.CAP_ALL||(L.push(new Q.tX(Math.cos(W*y)*a[a.length-1].x*u,a[a.length-1].y,Math.sin(W*y)*a[a.length-1].x*u)),L.push(new Q.tX(0,a[a.length-1].y,0))),t.push(L)}return w(b,{pathArray:t,closeArray:N,sideOrientation:Y,updatable:e,invertUV:B,frontUVs:X.frontUVs,backUVs:X.backUVs},P)}S.b.ExtrudeShape=function(b,X,P,Q,d,N){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7?arguments[7]:void 0,w=arguments.length>8?arguments[8]:void 0,f=arguments.length>9?arguments[9]:void 0;return q(b,{shape:X,path:P,scale:Q,rotation:d,cap:0===N?0:N||S.b.NO_CAP,sideOrientation:w,instance:f,updatable:u},a)},S.b.ExtrudeShapeCustom=(b,X,P,Q,d,N,a,u,w,f,O,e)=>V(b,{shape:X,path:P,scaleFunction:Q,rotationFunction:d,ribbonCloseArray:N,ribbonClosePath:a,cap:0===u?0:u||S.b.NO_CAP,sideOrientation:O,instance:e,updatable:f},w);S.b.CreateLathe=(b,X,P,Q,S,d,N)=>x(b,{shape:X,radius:P,tessellation:Q,sideOrientation:N,updatable:d},S);var H=P(13215),C=P(13169);function p(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=X.path;let N=X.instance,a=1;void 0!==X.radius?a=X.radius:N&&(a=N._creationDataStorage.radius);const u=X.tessellation||64,f=X.radiusFunction||null;let O=X.cap||S.b.NO_CAP;const e=X.invertUV||!1,Y=X.updatable,D=S.b._GetDefaultSideOrientation(X.sideOrientation);X.arc=X.arc&&(X.arc<=0||X.arc>1)?1:X.arc||1;const E=(b,X,P,d,N,a,u,w)=>{const f=X.getTangents(),O=X.getNormals(),e=X.getDistances(),Y=2*Math.PI/N*w,D=a||(()=>d);let E,t,B,W;const n=Q.TmpVectors.Matrix[0];let y=u===S.b.NO_CAP||u===S.b.CAP_END?0:2;for(let S=0;S<b.length;S++){t=D(S,e[S]),E=Array(),B=O[S];for(let X=0;X<N;X++)Q.Matrix.RotationAxisToRef(f[S],Y*X,n),W=E[X]?E[X]:Q.tX.Zero(),Q.tX.TransformCoordinatesToRef(B,n,W),W.scaleInPlace(t).addInPlace(b[S]),E[X]=W;P[y]=E,y++}const h=(X,P)=>{const Q=Array();for(let S=0;S<X;S++)Q.push(b[P]);return Q};switch(u){case S.b.NO_CAP:break;case S.b.CAP_START:P[0]=h(N,0),P[1]=P[2].slice(0);break;case S.b.CAP_END:P[y]=P[y-1].slice(0),P[y+1]=h(N,b.length-1);break;case S.b.CAP_ALL:P[0]=h(N,0),P[1]=P[2].slice(0),P[y]=P[y-1].slice(0),P[y+1]=h(N,b.length-1)}return P};let t,B;if(N){const b=N._creationDataStorage,P=X.arc||b.arc;return t=b.path3D.update(d),B=E(d,t,b.pathArray,a,b.tessellation,f,b.cap,P),N=w("",{pathArray:B,instance:N}),b.path3D=t,b.pathArray=B,b.arc=P,b.radius=a,N}t=new T.k(d);O=O<0||O>3?0:O,B=E(d,t,new Array,a,u,f,O,X.arc);const W=w(b,{pathArray:B,closePath:!0,closeArray:!1,updatable:Y,sideOrientation:D,invertUV:e,frontUVs:X.frontUVs,backUVs:X.backUVs},P);return W._creationDataStorage.pathArray=B,W._creationDataStorage.path3D=t,W._creationDataStorage.tessellation=u,W._creationDataStorage.cap=O,W._creationDataStorage.arc=X.arc,W._creationDataStorage.radius=a,W}function k(b){const X=[];X[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},X[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},X[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},X[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},X[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},X[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},X[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},X[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},X[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},X[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},X[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},X[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},X[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},X[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},X[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const P=b.type&&(b.type<0||b.type>=X.length)?0:b.type||0,S=b.size,d=b.sizeX||S||1,u=b.sizeY||S||1,w=b.sizeZ||S||1,f=b.custom||X[P],O=f.face.length,Y=b.faceUV||new Array(O),D=b.faceColors,E=void 0===b.flat||b.flat,t=0===b.sideOrientation?0:b.sideOrientation||N.e.DEFAULTSIDE,B=[],W=[],n=[],y=[],h=[];let L=0,Z=0;const v=[];let A,o,K,T,q,V,i=0,x=0;if(E)for(x=0;x<O;x++)D&&void 0===D[x]&&(D[x]=new e.Ba(1,1,1,1)),Y&&void 0===Y[x]&&(Y[x]=new Q.Vector4(0,0,1,1));if(E)for(x=0;x<O;x++){const b=f.face[x].length;for(K=2*Math.PI/b,T=.5*Math.tan(K/2),q=.5,i=0;i<b;i++)B.push(f.vertex[f.face[x][i]][0]*d,f.vertex[f.face[x][i]][1]*u,f.vertex[f.face[x][i]][2]*w),v.push(L),L++,A=Y[x].x+(Y[x].z-Y[x].x)*(.5+T),o=Y[x].y+(Y[x].w-Y[x].y)*(q-.5),y.push(A,a.c?1-o:o),V=T*Math.cos(K)-q*Math.sin(K),q=T*Math.sin(K)+q*Math.cos(K),T=V,D&&h.push(D[x].r,D[x].g,D[x].b,D[x].a);for(i=0;i<b-2;i++)W.push(v[0+Z],v[i+2+Z],v[i+1+Z]);Z+=b}else{for(i=0;i<f.vertex.length;i++)B.push(f.vertex[i][0]*d,f.vertex[i][1]*u,f.vertex[i][2]*w),y.push(0,a.c?1:0);for(x=0;x<O;x++)for(i=0;i<f.face[x].length-2;i++)W.push(f.face[x][0],f.face[x][i+2],f.face[x][i+1])}N.e.ComputeNormals(B,W,n),N.e._ComputeSides(t,B,W,n,y,b.frontUVs,b.backUVs);const H=new N.e;return H.Kb=B,H.indices=W,H.Tb=n,H.Vb=y,D&&E&&(H.qb=h),H}function z(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new S.b(b,P);X.sideOrientation=S.b._GetDefaultSideOrientation(X.sideOrientation),Q._originalBuilderSideOrientation=X.sideOrientation;return k(X).xb(Q,X.updatable),Q}S.b.CreateTube=(b,X,P,Q,S,d,N,a,u,w)=>p(b,{path:X,radius:P,tessellation:Q,radiusFunction:S,arc:1,cap:d,updatable:a,sideOrientation:u,instance:w},N);function U(b){const X=b.sideOrientation||N.e.DEFAULTSIDE,P=b.radius||1,S=void 0===b.flat||b.flat,d=0|(b.subdivisions||4),u=b.radiusX||P,w=b.radiusY||P,f=b.radiusZ||P,O=(1+Math.sqrt(5))/2,e=[-1,O,-0,1,O,0,-1,-O,0,1,-O,0,0,-1,-O,0,1,-O,0,-1,O,0,1,O,O,0,1,O,0,-1,-O,0,1,-O,0,-1],Y=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],D=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],E=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],t=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],B=[],W=[],n=[],y=[];let h=0;const L=new Array(3),Z=new Array(3);let v;for(v=0;v<3;v++)L[v]=Q.tX.Zero(),Z[v]=Q.Vector2.Zero();for(let N=0;N<20;N++){for(v=0;v<3;v++){const b=Y[3*N+v];L[v].sd(e[3*D[b]],e[3*D[b]+1],e[3*D[b]+2]),L[v].normalize(),Z[v].sd(.134765625*E[2*b]+.05859375+-.0390625*t[N],.2333984375*E[2*b+1]+.025390625+.01953125*t[N])}const b=(b,X,P,N)=>{const O=Q.tX.Lerp(L[0],L[2],X/d),e=Q.tX.Lerp(L[1],L[2],X/d),Y=d===X?L[2]:Q.tX.Lerp(O,e,b/(d-X));let D;if(Y.normalize(),S){const b=Q.tX.Lerp(L[0],L[2],N/d),X=Q.tX.Lerp(L[1],L[2],N/d);D=Q.tX.Lerp(b,X,P/(d-N))}else D=new Q.tX(Y.x,Y.y,Y.z);D.x/=u,D.y/=w,D.z/=f,D.normalize();const E=Q.Vector2.Lerp(Z[0],Z[2],X/d),t=Q.Vector2.Lerp(Z[1],Z[2],X/d),v=d===X?Z[2]:Q.Vector2.Lerp(E,t,b/(d-X));W.push(Y.x*u,Y.y*w,Y.z*f),n.push(D.x,D.y,D.z),y.push(v.x,a.c?1-v.y:v.y),B.push(h),h++};for(let X=0;X<d;X++)for(let P=0;P+X<d;P++)b(P,X,P+1/3,X+1/3),b(P+1,X,P+1/3,X+1/3),b(P,X+1,P+1/3,X+1/3),P+X+1<d&&(b(P+1,X,P+2/3,X+2/3),b(P+1,X+1,P+2/3,X+2/3),b(P,X+1,P+2/3,X+2/3))}N.e._ComputeSides(X,W,B,n,y,b.frontUVs,b.backUVs);const A=new N.e;return A.indices=B,A.Kb=W,A.Tb=n,A.Vb=y,A}function g(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new S.b(b,P);X.sideOrientation=S.b._GetDefaultSideOrientation(X.sideOrientation),Q._originalBuilderSideOrientation=X.sideOrientation;return U(X).xb(Q,X.updatable),Q}N.e.CreatePolyhedron=k,S.b.CreatePolyhedron=(b,X,P)=>z(b,X,P);N.e.CreateIcoSphere=U,S.b.CreateIcoSphere=(b,X,P)=>g(b,X,P);var j=P(11844);const l=new Q.tX(1,0,0),J=new Q.tX(-1,0,0),c=new Q.tX(0,1,0),s=new Q.tX(0,-1,0),F=new Q.tX(0,0,1),M=new Q.tX(0,0,-1);class R{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q.tX.Zero(),X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q.tX.Up(),P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.Vector2.Zero(),S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=b,this.normal=X,this.uv=P,this.vertexIdx=S,this.vertexIdxForBones=d,this.localPositionOverride=N,this.localNormalOverride=a,this.matrixIndicesOverride=u,this.matrixWeightsOverride=w}clone(){var b,X,P,Q;return new R(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(b=this.localPositionOverride)||void 0===b?void 0:b.slice(),null===(X=this.localNormalOverride)||void 0===X?void 0:X.slice(),null===(P=this.matrixIndicesOverride)||void 0===P?void 0:P.slice(),null===(Q=this.matrixWeightsOverride)||void 0===Q?void 0:Q.slice())}}function r(b,X,P){var u,w,f,O,e;const Y=!!X.skeleton,D=!(null===(u=X.morphTargetManager)||void 0===u||!u.numTargets),E=P.localMode||Y,t=X.ld(),B=Y||D?X.qa(!0,!0):X.getVerticesData(d.g.PositionKind),W=Y||D?X.getNormalsData(!0,!0):X.getVerticesData(d.g.NormalKind),n=E?Y?X.getVerticesData(d.g.PositionKind):B:null,y=E?Y?X.getVerticesData(d.g.NormalKind):W:null,h=X.getVerticesData(d.g.UVKind),L=Y?X.getVerticesData(d.g.MatricesIndicesKind):null,Z=Y?X.getVerticesData(d.g.MatricesWeightsKind):null,v=Y?X.getVerticesData(d.g.MatricesIndicesExtraKind):null,A=Y?X.getVerticesData(d.g.MatricesWeightsExtraKind):null,o=P.position||Q.tX.Zero();let K=P.normal||Q.tX.Up();const T=P.size||Q.tX.One(),q=P.angle||0;if(!K){const b=new Q.tX(0,0,1),P=X.Ab().activeCamera,S=Q.tX.TransformCoordinates(b,P.getWorldMatrix());K=P.globalPosition.BX(S)}const V=-Math.atan2(K.z,K.x)-Math.PI/2,i=Math.sqrt(K.x*K.x+K.z*K.z),x=Math.atan2(K.y,i),H=new N.e;H.indices=[],H.Kb=[],H.Tb=[],H.Vb=[],H.matricesIndices=Y?[]:null,H.matricesWeights=Y?[]:null,H.matricesIndicesExtra=v?[]:null,H.matricesWeightsExtra=A?[]:null;let C=0;const p=(b,X)=>{const S=new R;if(!t||!B||!W)return S;const d=t[b];if(S.vertexIdx=3*d,S.vertexIdxForBones=4*d,S.position=new Q.tX(B[3*d],B[3*d+1],B[3*d+2]),Q.tX.TransformCoordinatesToRef(S.position,X,S.position),S.normal=new Q.tX(W[3*d],W[3*d+1],W[3*d+2]),Q.tX.TransformNormalToRef(S.normal,X,S.normal),P.captureUVS&&h){const b=h[2*d+1];S.uv=new Q.Vector2(h[2*d],a.c?1-b:b)}return S},k=[0,0,0,0],z=(b,X)=>{if(0===b.length)return b;const P=.5*Math.abs(Q.tX.Dot(T,X)),S=(b,X,P,Q)=>{for(let S=0;S<Q;++S)if(b[P+S]===X)return P+S;return-1},d=(b,d)=>{const N=Q.tX.GetClipFactor(b.position,d.position,X,P);let a=k,u=k;if(L&&Z){const X=b.matrixIndicesOverride?0:b.vertexIdxForBones,P=b.matrixIndicesOverride??L,Q=b.matrixWeightsOverride??Z,w=d.matrixIndicesOverride?0:d.vertexIdxForBones,f=d.matrixIndicesOverride??L,O=d.matrixWeightsOverride??Z;a=[0,0,0,0],u=[0,0,0,0];let e=0;for(let b=0;b<4;++b)if(Q[X+b]>0){const d=S(f,P[X+b],w,4);a[e]=P[X+b],u[e]=(0,j.Lerp)(Q[X+b],d>=0?O[d]:0,N),e++}for(let b=0;b<4&&e<4;++b){const Q=f[w+b];-1===S(P,Q,X,4)&&(a[e]=Q,u[e]=(0,j.Lerp)(0,O[w+b],N),e++)}const Y=u[0]+u[1]+u[2]+u[3];u[0]/=Y,u[1]/=Y,u[2]/=Y,u[3]/=Y}const w=b.localPositionOverride?b.localPositionOverride[0]:(null===n||void 0===n?void 0:n[b.vertexIdx])??0,f=b.localPositionOverride?b.localPositionOverride[1]:(null===n||void 0===n?void 0:n[b.vertexIdx+1])??0,O=b.localPositionOverride?b.localPositionOverride[2]:(null===n||void 0===n?void 0:n[b.vertexIdx+2])??0,e=d.localPositionOverride?d.localPositionOverride[0]:(null===n||void 0===n?void 0:n[d.vertexIdx])??0,Y=d.localPositionOverride?d.localPositionOverride[1]:(null===n||void 0===n?void 0:n[d.vertexIdx+1])??0,D=d.localPositionOverride?d.localPositionOverride[2]:(null===n||void 0===n?void 0:n[d.vertexIdx+2])??0,E=b.localNormalOverride?b.localNormalOverride[0]:(null===y||void 0===y?void 0:y[b.vertexIdx])??0,t=b.localNormalOverride?b.localNormalOverride[1]:(null===y||void 0===y?void 0:y[b.vertexIdx+1])??0,B=b.localNormalOverride?b.localNormalOverride[2]:(null===y||void 0===y?void 0:y[b.vertexIdx+2])??0,W=E+((d.localNormalOverride?d.localNormalOverride[0]:(null===y||void 0===y?void 0:y[d.vertexIdx])??0)-E)*N,h=t+((d.localNormalOverride?d.localNormalOverride[1]:(null===y||void 0===y?void 0:y[d.vertexIdx+1])??0)-t)*N,v=B+((d.localNormalOverride?d.localNormalOverride[2]:(null===y||void 0===y?void 0:y[d.vertexIdx+2])??0)-B)*N,A=Math.sqrt(W*W+h*h+v*v);return new R(Q.tX.Lerp(b.position,d.position,N),Q.tX.Lerp(b.normal,d.normal,N).normalize(),Q.Vector2.Lerp(b.uv,d.uv,N),-1,-1,n?[w+(e-w)*N,f+(Y-f)*N,O+(D-O)*N]:null,y?[W/A,h/A,v/A]:null,a,u)};let N=null;b.length>3&&(N=[]);for(let a=0;a<b.length;a+=3){let S=0,u=null,w=null,f=null,O=null;const e=Q.tX.Dot(b[a].position,X)-P>0,Y=Q.tX.Dot(b[a+1].position,X)-P>0,D=Q.tX.Dot(b[a+2].position,X)-P>0;switch(S=(e?1:0)+(Y?1:0)+(D?1:0),S){case 0:b.length>3?(N.push(b[a]),N.push(b[a+1]),N.push(b[a+2])):N=b;break;case 1:if(N=N??new Array,e&&(u=b[a+1],w=b[a+2],f=d(b[a],u),O=d(b[a],w)),Y){u=b[a],w=b[a+2],f=d(b[a+1],u),O=d(b[a+1],w),N.push(f),N.push(w.clone()),N.push(u.clone()),N.push(w.clone()),N.push(f.clone()),N.push(O);break}D&&(u=b[a],w=b[a+1],f=d(b[a+2],u),O=d(b[a+2],w)),u&&w&&f&&O&&(N.push(u.clone()),N.push(w.clone()),N.push(f),N.push(O),N.push(f.clone()),N.push(w.clone()));break;case 2:N=N??new Array,e||(u=b[a].clone(),w=d(u,b[a+1]),f=d(u,b[a+2]),N.push(u),N.push(w),N.push(f)),Y||(u=b[a+1].clone(),w=d(u,b[a+2]),f=d(u,b[a]),N.push(u),N.push(w),N.push(f)),D||(u=b[a+2].clone(),w=d(u,b[a]),f=d(u,b[a+1]),N.push(u),N.push(w),N.push(f))}}return N},U=X instanceof S.b?X:null,g=null===U||void 0===U?void 0:U._thinInstanceDataStorage.matrixData,r=(null===U||void 0===U?void 0:U.na)||1,I=Q.TmpVectors.Matrix[0];I.N(Q.Matrix.IdentityReadOnly);for(let S=0;S<r;++S){if(null!==U&&void 0!==U&&U.hasThinInstances&&g){const b=16*S;I.setRowFromFloats(0,g[b+0],g[b+1],g[b+2],g[b+3]),I.setRowFromFloats(1,g[b+4],g[b+5],g[b+6],g[b+7]),I.setRowFromFloats(2,g[b+8],g[b+9],g[b+10],g[b+11]),I.setRowFromFloats(3,g[b+12],g[b+13],g[b+14],g[b+15])}const b=Q.Matrix.RotationYawPitchRoll(V,x,q).multiply(Q.Matrix.Translation(o.x,o.y,o.z)),d=Q.Matrix.Invert(b),N=X.getWorldMatrix(),u=I.multiply(N).multiply(d),w=new Array(3);for(let X=0;X<t.length;X+=3){let b=w;if(b[0]=p(X,u),b[1]=p(X+1,u),b[2]=p(X+2,u),!(P.cullBackFaces&&-b[0].normal.z<=0&&-b[1].normal.z<=0&&-b[2].normal.z<=0)&&(b=z(b,l),b&&(b=z(b,J),b&&(b=z(b,c),b&&(b=z(b,s),b&&(b=z(b,F),b&&(b=z(b,M),b)))))))for(let X=0;X<b.length;X++){const Q=b[X];if(H.indices.push(C),E?(Q.localPositionOverride?(H.Kb[3*C]=Q.localPositionOverride[0],H.Kb[3*C+1]=Q.localPositionOverride[1],H.Kb[3*C+2]=Q.localPositionOverride[2]):n&&(H.Kb[3*C]=n[Q.vertexIdx],H.Kb[3*C+1]=n[Q.vertexIdx+1],H.Kb[3*C+2]=n[Q.vertexIdx+2]),Q.localNormalOverride?(H.Tb[3*C]=Q.localNormalOverride[0],H.Tb[3*C+1]=Q.localNormalOverride[1],H.Tb[3*C+2]=Q.localNormalOverride[2]):y&&(H.Tb[3*C]=y[Q.vertexIdx],H.Tb[3*C+1]=y[Q.vertexIdx+1],H.Tb[3*C+2]=y[Q.vertexIdx+2])):(Q.position.toArray(H.Kb,3*C),Q.normal.toArray(H.Tb,3*C)),H.matricesIndices&&H.matricesWeights&&(Q.matrixIndicesOverride?(H.matricesIndices[4*C]=Q.matrixIndicesOverride[0],H.matricesIndices[4*C+1]=Q.matrixIndicesOverride[1],H.matricesIndices[4*C+2]=Q.matrixIndicesOverride[2],H.matricesIndices[4*C+3]=Q.matrixIndicesOverride[3]):(L&&(H.matricesIndices[4*C]=L[Q.vertexIdxForBones],H.matricesIndices[4*C+1]=L[Q.vertexIdxForBones+1],H.matricesIndices[4*C+2]=L[Q.vertexIdxForBones+2],H.matricesIndices[4*C+3]=L[Q.vertexIdxForBones+3]),v&&H.matricesIndicesExtra&&(H.matricesIndicesExtra[4*C]=v[Q.vertexIdxForBones],H.matricesIndicesExtra[4*C+1]=v[Q.vertexIdxForBones+1],H.matricesIndicesExtra[4*C+2]=v[Q.vertexIdxForBones+2],H.matricesIndicesExtra[4*C+3]=v[Q.vertexIdxForBones+3])),Q.matrixWeightsOverride?(H.matricesWeights[4*C]=Q.matrixWeightsOverride[0],H.matricesWeights[4*C+1]=Q.matrixWeightsOverride[1],H.matricesWeights[4*C+2]=Q.matrixWeightsOverride[2],H.matricesWeights[4*C+3]=Q.matrixWeightsOverride[3]):(Z&&(H.matricesWeights[4*C]=Z[Q.vertexIdxForBones],H.matricesWeights[4*C+1]=Z[Q.vertexIdxForBones+1],H.matricesWeights[4*C+2]=Z[Q.vertexIdxForBones+2],H.matricesWeights[4*C+3]=Z[Q.vertexIdxForBones+3]),A&&H.matricesWeightsExtra&&(H.matricesWeightsExtra[4*C]=A[Q.vertexIdxForBones],H.matricesWeightsExtra[4*C+1]=A[Q.vertexIdxForBones+1],H.matricesWeightsExtra[4*C+2]=A[Q.vertexIdxForBones+2],H.matricesWeightsExtra[4*C+3]=A[Q.vertexIdxForBones+3]))),P.captureUVS)Q.uv.toArray(H.Vb,2*C);else{H.Vb.push(.5+Q.position.x/T.x);const b=.5+Q.position.y/T.y;H.Vb.push(a.c?1-b:b)}C++}}}0===H.indices.length&&(H.indices=null),0===H.Kb.length&&(H.Kb=null),0===H.Tb.length&&(H.Tb=null),0===H.Vb.length&&(H.Vb=null),0===(null===(w=H.matricesIndices)||void 0===w?void 0:w.length)&&(H.matricesIndices=null),0===(null===(f=H.matricesWeights)||void 0===f?void 0:f.length)&&(H.matricesWeights=null),0===(null===(O=H.matricesIndicesExtra)||void 0===O?void 0:O.length)&&(H.matricesIndicesExtra=null),0===(null===(e=H.matricesWeightsExtra)||void 0===e?void 0:e.length)&&(H.matricesWeightsExtra=null);const G=new S.b(b,X.Ab());return H.xb(G),E?(G.skeleton=X.skeleton,G.parent=X):(G.position=o.clone(),G.rotation=new Q.tX(x,V,q)),G.pd(!0),G.refreshBoundingInfo(!0,!0),G}function I(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const X=0|Math.max(b.subdivisions?b.subdivisions:2,1),P=0|Math.max(b.tessellation?b.tessellation:16,3),S=Math.max(b.height?b.height:1,0),d=Math.max(b.radius?b.radius:.25,0),u=0|Math.max(b.capSubdivisions?b.capSubdivisions:6,1),w=P,f=X,O=Math.max(b.radiusTop?b.radiusTop:d,0),e=Math.max(b.radiusBottom?b.radiusBottom:d,0),Y=S-(O+e),D=2*Math.PI,E=Math.max(b.topCapSubdivisions?b.topCapSubdivisions:u,1),t=Math.max(b.bottomCapSubdivisions?b.bottomCapSubdivisions:u,1),B=Math.acos((e-O)/S);let W=[];const n=[],y=[],h=[];let L=0;const Z=[],v=.5*Y,A=.5*Math.PI;let o,K;const T=Q.tX.Zero(),q=Q.tX.Zero(),V=Math.cos(B),i=Math.sin(B),x=new Q.Vector2(O*i,v+O*V).BX(new Q.Vector2(e*i,e*V-v)).length(),H=O*B+x+e*(A-B);let C=0;for(K=0;K<=E;K++){const b=[],X=A-B*(K/E);C+=O*B/E;const P=Math.cos(X),Q=Math.sin(X),S=P*O;for(o=0;o<=w;o++){const X=o/w,d=X*D+0,N=Math.sin(d),u=Math.cos(d);q.x=S*N,q.y=v+Q*O,q.z=S*u,n.push(q.x,q.y,q.z),T.set(P*N,Q,P*u),y.push(T.x,T.y,T.z),h.push(X,a.c?C/H:1-C/H),b.push(L),L++}Z.push(b)}const p=S-O-e+V*O-V*e,k=i*(e-O)/p;for(K=1;K<=f;K++){const b=[];C+=x/f;const X=i*(K*(e-O)/f+O);for(o=0;o<=w;o++){const P=o/w,Q=P*D+0,S=Math.sin(Q),d=Math.cos(Q);q.x=X*S,q.y=v+V*O-K*p/f,q.z=X*d,n.push(q.x,q.y,q.z),T.set(S,k,d).normalize(),y.push(T.x,T.y,T.z),h.push(P,a.c?C/H:1-C/H),b.push(L),L++}Z.push(b)}for(K=1;K<=t;K++){const b=[],X=A-B-(Math.PI-B)*(K/t);C+=e*B/t;const P=Math.cos(X),Q=Math.sin(X),S=P*e;for(o=0;o<=w;o++){const X=o/w,d=X*D+0,N=Math.sin(d),u=Math.cos(d);q.x=S*N,q.y=Q*e-v,q.z=S*u,n.push(q.x,q.y,q.z),T.set(P*N,Q,P*u),y.push(T.x,T.y,T.z),h.push(X,a.c?C/H:1-C/H),b.push(L),L++}Z.push(b)}for(o=0;o<w;o++)for(K=0;K<E+f+t;K++){const b=Z[K][o],X=Z[K+1][o],P=Z[K+1][o+1],Q=Z[K][o+1];W.push(b),W.push(X),W.push(Q),W.push(X),W.push(P),W.push(Q)}if(W=W.reverse(),b.orientation&&!b.orientation.equals(Q.tX.Up())){const X=new Q.Matrix;b.orientation.clone().scale(.5*Math.PI).cross(Q.tX.Up()).toQuaternion().toRotationMatrix(X);const P=Q.tX.Zero();for(let b=0;b<n.length;b+=3)P.set(n[b],n[b+1],n[b+2]),Q.tX.TransformCoordinatesToRef(P.clone(),X,P),n[b]=P.x,n[b+1]=P.y,n[b+2]=P.z}const z=new N.e;return z.Kb=n,z.Tb=y,z.Vb=h,z.indices=W,z}function G(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:Q.tX.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new S.b(b,P);return I(X).xb(d,X.updatable),d}S.b.CreateDecal=(b,X,P,Q,S,d)=>r(b,X,{position:P,normal:Q,size:S,angle:d});S.b.CreateCapsule=(b,X,P)=>G(b,X,P),N.e.CreateCapsule=I;var mb=P(11700),bb=P(11836);class Xb{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=b,this.y=X,b!==Math.floor(b)&&(b=Math.floor(b),mb.b.Warn("x is not an integer, floor(x) used")),X!==Math.floor(X)&&(X=Math.floor(X),mb.b.Warn("y is not an integer, floor(y) used"))}clone(){return new Xb(this.x,this.y)}rotate60About(b){const X=this.x;return this.x=b.x+b.y-this.y,this.y=X+this.y-b.x,this}rotateNeg60About(b){const X=this.x;return this.x=X+this.y-b.y,this.y=b.x+b.y-X,this}rotate120(b,X){b!==Math.floor(b)&&(b=Math.floor(b),mb.b.Warn("m not an integer only floor(m) used")),X!==Math.floor(X)&&(X=Math.floor(X),mb.b.Warn("n not an integer only floor(n) used"));const P=this.x;return this.x=b-P-this.y,this.y=X+P,this}rotateNeg120(b,X){b!==Math.floor(b)&&(b=Math.floor(b),mb.b.Warn("m is not an integer, floor(m) used")),X!==Math.floor(X)&&(X=Math.floor(X),mb.b.Warn("n is not an integer,   floor(n) used"));const P=this.x;return this.x=this.y-X,this.y=b+X-P-this.y,this}toCartesianOrigin(b,X){const P=Q.tX.Zero();return P.x=b.x+2*this.x*X+this.y*X,P.y=b.y+Math.sqrt(3)*this.y*X,P}static Zero(){return new Xb(0,0)}}class Pb{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Qb("icosahedron","Regular",[[0,bb.g,-1],[-bb.g,1,0],[-1,0,-bb.g],[1,0,-bb.g],[bb.g,1,0],[0,bb.g,1],[-1,0,bb.g],[-bb.g,-1,0],[0,-bb.g,-1],[bb.g,-1,0],[1,0,bb.g],[0,-bb.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let b=12;const X={},P=this.m,Q=this.n;let S,d,N,a,u,w=P,f=1,O=0;0!==Q&&(w=(0,j.HighestCommonFactor)(P,Q)),f=P/w,O=Q/w;const e=Xb.Zero(),Y=new Xb(P,Q),D=new Xb(-Q,P+Q),E=Xb.Zero(),t=Xb.Zero(),B=Xb.Zero();let W,n,y,h,L=[];const Z=[],v=this.vertByDist,A=(P,Q,S,d)=>{W=P+"|"+S,n=Q+"|"+d,W in X||n in X?W in X&&!(n in X)?X[n]=X[W]:n in X&&!(W in X)&&(X[W]=X[n]):(X[W]=b,X[n]=b,b++),v[S][0]>2?Z[X[W]]=[-v[S][0],v[S][1],X[W]]:Z[X[W]]=[L[v[S][0]],v[S][1],X[W]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let o=0;o<20;o++){if(L=this.IDATA.face[o],N=L[2],a=L[1],u=L[0],y=e.x+"|"+e.y,W=o+"|"+y,W in X||(X[W]=N,Z[N]=[L[v[y][0]],v[y][1]]),y=Y.x+"|"+Y.y,W=o+"|"+y,W in X||(X[W]=a,Z[a]=[L[v[y][0]],v[y][1]]),y=D.x+"|"+D.y,W=o+"|"+y,W in X||(X[W]=u,Z[u]=[L[v[y][0]],v[y][1]]),S=this.IDATA.edgematch[o][0],d=this.IDATA.edgematch[o][1],"B"===d)for(let b=1;b<w;b++)t.x=P-b*(f+O),t.y=Q+b*f,B.x=-b*O,B.y=b*(f+O),y=t.x+"|"+t.y,h=B.x+"|"+B.y,A(o,S,y,h);if("O"===d)for(let b=1;b<w;b++)B.x=-b*O,B.y=b*(f+O),E.x=b*f,E.y=b*O,y=B.x+"|"+B.y,h=E.x+"|"+E.y,A(o,S,y,h);if(S=this.IDATA.edgematch[o][2],d=this.IDATA.edgematch[o][3],d&&"A"===d)for(let b=1;b<w;b++)E.x=b*f,E.y=b*O,t.x=P-(w-b)*(f+O),t.y=Q+(w-b)*f,y=E.x+"|"+E.y,h=t.x+"|"+t.y,A(o,S,y,h);for(let P=0;P<this.vertices.length;P++)y=this.vertices[P].x+"|"+this.vertices[P].y,W=o+"|"+y,W in X||(X[W]=b++,v[y][0]>2?Z[X[W]]=[-v[y][0],v[y][1],X[W]]:Z[X[W]]=[L[v[y][0]],v[y][1],X[W]])}this.closestTo=Z,this.vecToidx=X}calcCoeffs(){const b=this.m,X=this.n,P=Math.sqrt(3)/3,Q=b*b+X*X+b*X;this.coau=(b+X)/Q,this.cobu=-X/Q,this.coav=-P*(b-X)/Q,this.cobv=P*(2*b+X)/Q}createInnerFacets(){const b=this.m,X=this.n;for(let P=0;P<X+b+1;P++)for(let b=this.min[P];b<this.max[P]+1;b++)b<this.max[P]&&b<this.max[P+1]+1&&this.innerFacets.push(["|"+b+"|"+P,"|"+b+"|"+(P+1),"|"+(b+1)+"|"+P]),P>0&&b<this.max[P-1]&&b+1<this.max[P]+1&&this.innerFacets.push(["|"+b+"|"+P,"|"+(b+1)+"|"+P,"|"+(b+1)+"|"+(P-1)])}edgeVecsABOB(){const b=this.m,X=this.n,P=new Xb(-X,b+X);for(let Q=1;Q<b+X;Q++){const b=new Xb(this.min[Q],Q),X=new Xb(this.min[Q-1],Q-1),S=new Xb(this.min[Q+1],Q+1),d=b.clone(),N=X.clone(),a=S.clone();d.rotate60About(P),N.rotate60About(P),a.rotate60About(P);const u=new Xb(this.max[d.y],d.y),w=new Xb(this.max[d.y-1],d.y-1),f=new Xb(this.max[d.y-1]-1,d.y-1);d.x===u.x&&d.y===u.y||(d.x!==w.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([b,w,f]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([b,f,u])):d.y===a.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([b,X,w]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([b,w,S])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([b,X,w]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([b,w,u])))}}mapABOBtoOBOA(){const b=new Xb(0,0);for(let X=0;X<this.isoVecsABOB.length;X++){const P=[];for(let Q=0;Q<3;Q++)b.x=this.isoVecsABOB[X][Q].x,b.y=this.isoVecsABOB[X][Q].y,0===this.vertexTypes[X][Q]&&b.rotateNeg120(this.m,this.n),P.push(b.clone());this.isoVecsOBOA.push(P)}}mapABOBtoBAOA(){const b=new Xb(0,0);for(let X=0;X<this.isoVecsABOB.length;X++){const P=[];for(let Q=0;Q<3;Q++)b.x=this.isoVecsABOB[X][Q].x,b.y=this.isoVecsABOB[X][Q].y,1===this.vertexTypes[X][Q]&&b.rotate120(this.m,this.n),P.push(b.clone());this.isoVecsBAOA.push(P)}}MapToFace(b,X){const P=this.IDATA.face[b],S=P[2],d=P[1],N=P[0],a=Q.tX.hX(this.IDATA.vertex[S]),u=Q.tX.hX(this.IDATA.vertex[d]),w=Q.tX.hX(this.IDATA.vertex[N]),f=u.BX(a),O=w.BX(a),e=f.scale(this.coau).add(O.scale(this.cobu)),Y=f.scale(this.coav).add(O.scale(this.cobv)),D=[];let E,t=Q.TmpVectors.tX[0];for(let Q=0;Q<this.cartesian.length;Q++)t=e.scale(this.cartesian[Q].x).add(Y.scale(this.cartesian[Q].y)).add(a),D[Q]=[t.x,t.y,t.z],E=b+"|"+this.vertices[Q].x+"|"+this.vertices[Q].y,X.vertex[this.vecToidx[E]]=[t.x,t.y,t.z]}build(b,X){const P=[],Q=Xb.Zero(),S=new Xb(b,X),d=new Xb(-X,b+X);P.push(Q,S,d);for(let y=X;y<b+1;y++)for(let X=0;X<b+1-y;X++)P.push(new Xb(X,y));if(X>0){const Q=(0,j.HighestCommonFactor)(b,X),S=b/Q,d=X/Q;for(let a=1;a<Q;a++)P.push(new Xb(a*S,a*d)),P.push(new Xb(-a*d,a*(S+d))),P.push(new Xb(b-a*(S+d),X+a*S));const N=b/X;for(let a=1;a<X;a++)for(let Q=0;Q<a*N;Q++)P.push(new Xb(Q,a)),P.push(new Xb(Q,a).rotate120(b,X)),P.push(new Xb(Q,a).rotateNeg120(b,X))}P.sort(((b,X)=>b.x-X.x)),P.sort(((b,X)=>b.y-X.y));const N=new Array(b+X+1),a=new Array(b+X+1);for(let y=0;y<N.length;y++)N[y]=1/0,a[y]=-1/0;let u=0,w=0;const f=P.length;for(let y=0;y<f;y++)w=P[y].x,u=P[y].y,N[u]=Math.min(w,N[u]),a[u]=Math.max(w,a[u]);const O=(P,Q)=>{const S=P.clone();return"A"===Q&&S.rotateNeg120(b,X),"B"===Q&&S.rotate120(b,X),S.x<0?S.y:S.x+S.y},e=[],Y=[],D=[],E=[],t={},B=[];let W=-1,n=-1;for(let y=0;y<f;y++)e[y]=P[y].toCartesianOrigin(new Xb(0,0),.5),Y[y]=O(P[y],"O"),D[y]=O(P[y],"A"),E[y]=O(P[y],"B"),Y[y]===D[y]&&D[y]===E[y]?(W=3,n=Y[y]):Y[y]===D[y]?(W=4,n=Y[y]):D[y]===E[y]?(W=5,n=D[y]):E[y]===Y[y]&&(W=6,n=Y[y]),Y[y]<D[y]&&Y[y]<E[y]&&(W=2,n=Y[y]),D[y]<Y[y]&&D[y]<E[y]&&(W=1,n=D[y]),E[y]<D[y]&&E[y]<Y[y]&&(W=0,n=E[y]),B.push([W,n,P[y].x,P[y].y]);B.sort(((b,X)=>b[2]-X[2])),B.sort(((b,X)=>b[3]-X[3])),B.sort(((b,X)=>b[1]-X[1])),B.sort(((b,X)=>b[0]-X[0]));for(let y=0;y<B.length;y++)t[B[y][2]+"|"+B[y][3]]=[B[y][0],B[y][1],y];return this.m=b,this.n=X,this.vertices=P,this.vertByDist=t,this.cartesian=e,this.min=N,this.max=a,this}}class Qb{constructor(b,X,P,Q){this.name=b,this.category=X,this.vertex=P,this.face=Q}}class Sb extends Qb{innerToData(b,X){for(let P=0;P<X.innerFacets.length;P++)this.face.push(X.innerFacets[P].map((P=>X.vecToidx[b+P])))}mapABOBtoDATA(b,X){const P=X.IDATA.edgematch[b][0];for(let Q=0;Q<X.isoVecsABOB.length;Q++){const S=[];for(let d=0;d<3;d++)0===X.vertexTypes[Q][d]?S.push(b+"|"+X.isoVecsABOB[Q][d].x+"|"+X.isoVecsABOB[Q][d].y):S.push(P+"|"+X.isoVecsABOB[Q][d].x+"|"+X.isoVecsABOB[Q][d].y);this.face.push([X.vecToidx[S[0]],X.vecToidx[S[1]],X.vecToidx[S[2]]])}}mapOBOAtoDATA(b,X){const P=X.IDATA.edgematch[b][0];for(let Q=0;Q<X.isoVecsOBOA.length;Q++){const S=[];for(let d=0;d<3;d++)1===X.vertexTypes[Q][d]?S.push(b+"|"+X.isoVecsOBOA[Q][d].x+"|"+X.isoVecsOBOA[Q][d].y):S.push(P+"|"+X.isoVecsOBOA[Q][d].x+"|"+X.isoVecsOBOA[Q][d].y);this.face.push([X.vecToidx[S[0]],X.vecToidx[S[1]],X.vecToidx[S[2]]])}}mapBAOAtoDATA(b,X){const P=X.IDATA.edgematch[b][2];for(let Q=0;Q<X.isoVecsBAOA.length;Q++){const S=[];for(let d=0;d<3;d++)1===X.vertexTypes[Q][d]?S.push(b+"|"+X.isoVecsBAOA[Q][d].x+"|"+X.isoVecsBAOA[Q][d].y):S.push(P+"|"+X.isoVecsBAOA[Q][d].x+"|"+X.isoVecsBAOA[Q][d].y);this.face.push([X.vecToidx[S[0]],X.vecToidx[S[1]],X.vecToidx[S[2]]])}}orderData(b){const X=[];for(let d=0;d<13;d++)X[d]=[];const P=b.closestTo;for(let d=0;d<P.length;d++)P[d][0]>-1?P[d][1]>0&&X[P[d][0]].push([d,P[d][1]]):X[12].push([d,P[d][0]]);const Q=[];for(let d=0;d<12;d++)Q[d]=d;let S=12;for(let d=0;d<12;d++){X[d].sort(((b,X)=>b[1]-X[1]));for(let b=0;b<X[d].length;b++)Q[X[d][b][0]]=S++}for(let d=0;d<X[12].length;d++)Q[X[12][d][0]]=S++;for(let d=0;d<this.vertex.length;d++)this.vertex[d].push(Q[d]);this.vertex.sort(((b,X)=>b[3]-X[3]));for(let d=0;d<this.vertex.length;d++)this.vertex[d].pop();for(let d=0;d<this.face.length;d++)for(let b=0;b<this.face[d].length;b++)this.face[d][b]=Q[this.face[d][b]];this.sharedNodes=X[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(b,X){const P=[],Q=[];let S=X.pop();Q.push(S);let d=this.face[S].indexOf(b);d=(d+2)%3;let N=this.face[S][d];P.push(N);let a=0;for(;X.length>0;)S=X[a],this.face[S].indexOf(N)>-1?(d=(this.face[S].indexOf(N)+1)%3,N=this.face[S][d],P.push(N),Q.push(S),X.splice(a,1),a=0):a++;return this.adjacentFaces.push(P),Q}toGoldbergPolyhedronData(){const b=new Qb("GeoDual","Goldberg",[],[]);b.name="GD dual";const X=this.vertex.length,P=new Array(X);for(let u=0;u<X;u++)P[u]=[];for(let u=0;u<this.face.length;u++)for(let b=0;b<3;b++)P[this.face[u][b]].push(u);let Q=0,S=0,d=0,N=[],a=[];this.adjacentFaces=[];for(let u=0;u<P.length;u++){b.face[u]=this.setOrder(u,P[u].concat([]));for(const X of P[u]){Q=0,S=0,d=0,N=this.face[X];for(let b=0;b<3;b++)a=this.vertex[N[b]],Q+=a[0],S+=a[1],d+=a[2];b.vertex[X]=[Q/3,S/3,d/3]}}return b}static BuildGeodesicData(b){const X=new Sb("Geodesic-m-n","Geodesic",[[0,bb.g,-1],[-bb.g,1,0],[-1,0,-bb.g],[1,0,-bb.g],[bb.g,1,0],[0,bb.g,1],[-1,0,bb.g],[-bb.g,-1,0],[0,-bb.g,-1],[bb.g,-1,0],[1,0,bb.g],[0,-bb.g,1]],[]);b.setIndices(),b.calcCoeffs(),b.createInnerFacets(),b.edgeVecsABOB(),b.mapABOBtoOBOA(),b.mapABOBtoBAOA();for(let P=0;P<b.IDATA.face.length;P++)b.MapToFace(P,X),X.innerToData(P,b),"B"===b.IDATA.edgematch[P][1]&&X.mapABOBtoDATA(P,b),"O"===b.IDATA.edgematch[P][1]&&X.mapOBOAtoDATA(P,b),"A"===b.IDATA.edgematch[P][3]&&X.mapBAOAtoDATA(P,b);X.orderData(b);return X.vertex=X.vertex.map((function(b){const X=b[0],P=b[1],Q=b[2],S=Math.sqrt(X*X+P*P+Q*Q);return b[0]*=1/S,b[1]*=1/S,b[2]*=1/S,b})),X}}S.b._GoldbergMeshParser=(b,X)=>db.Parse(b,X);class db extends S.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(b,X){return void 0===X?(b>this.goldbergData.nbUnsharedFaces-1&&(mb.b.Warn("Maximum number of unshared faces used"),b=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+b):(b>11&&(mb.b.Warn("Last pole used"),b=11),X>this.goldbergData.nbFacesAtPole-1&&(mb.b.Warn("Maximum number of faces at a pole used"),X=this.goldbergData.nbFacesAtPole-1),12+b*this.goldbergData.nbFacesAtPole+X)}_changeGoldbergFaceColors(b){for(let P=0;P<b.length;P++){const X=b[P][0],Q=b[P][1],S=b[P][2];for(let b=X;b<Q+1;b++)this.goldbergData.faceColors[b]=S}const X=[];for(let P=0;P<12;P++)for(let b=0;b<5;b++)X.push(this.goldbergData.faceColors[P].r,this.goldbergData.faceColors[P].g,this.goldbergData.faceColors[P].b,this.goldbergData.faceColors[P].a);for(let P=12;P<this.goldbergData.faceColors.length;P++)for(let b=0;b<6;b++)X.push(this.goldbergData.faceColors[P].r,this.goldbergData.faceColors[P].g,this.goldbergData.faceColors[P].b,this.goldbergData.faceColors[P].a);return X}setGoldbergFaceColors(b){const X=this._changeGoldbergFaceColors(b);this.kb(d.g.ColorKind,X)}updateGoldbergFaceColors(b){const X=this._changeGoldbergFaceColors(b);this.updateVerticesData(d.g.ColorKind,X)}_changeGoldbergFaceUVs(b){const X=this.getVerticesData(d.g.UVKind);for(let P=0;P<b.length;P++){const Q=b[P][0],S=b[P][1],d=b[P][2],N=b[P][3],a=b[P][4],u=[],w=[];let f,O;for(let b=0;b<5;b++)f=d.x+N*Math.cos(a+b*Math.PI/2.5),O=d.y+N*Math.sin(a+b*Math.PI/2.5),f<0&&(f=0),f>1&&(f=1),u.push(f,O);for(let b=0;b<6;b++)f=d.x+N*Math.cos(a+b*Math.PI/3),O=d.y+N*Math.sin(a+b*Math.PI/3),f<0&&(f=0),f>1&&(f=1),w.push(f,O);for(let b=Q;b<Math.min(12,S+1);b++)for(let P=0;P<5;P++)X[10*b+2*P]=u[2*P],X[10*b+2*P+1]=u[2*P+1];for(let b=Math.max(12,Q);b<S+1;b++)for(let P=0;P<6;P++)X[12*b-24+2*P]=w[2*P],X[12*b-23+2*P]=w[2*P+1]}return X}setGoldbergFaceUVs(b){const X=this._changeGoldbergFaceUVs(b);this.kb(d.g.UVKind,X)}updateGoldbergFaceUVs(b){const X=this._changeGoldbergFaceUVs(b);this.updateVerticesData(d.g.UVKind,X)}placeOnGoldbergFaceAt(b,X,P){const S=Q.tX.RotationFromAxis(this.goldbergData.faceXaxis[X],this.goldbergData.faceYaxis[X],this.goldbergData.faceZaxis[X]);b.rotation=S,b.position=this.goldbergData.faceCenters[X].add(this.goldbergData.faceXaxis[X].scale(P.x)).add(this.goldbergData.faceYaxis[X].scale(P.y)).add(this.goldbergData.faceZaxis[X].scale(P.z))}serialize(b){super.serialize(b),b.type="GoldbergMesh";const X={};if(X.adjacentFaces=this.goldbergData.adjacentFaces,X.nbSharedFaces=this.goldbergData.nbSharedFaces,X.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,X.nbFaces=this.goldbergData.nbFaces,X.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){X.faceColors=[];for(const b of this.goldbergData.faceColors)X.faceColors.push(b.Zd())}if(this.goldbergData.faceCenters){X.faceCenters=[];for(const b of this.goldbergData.faceCenters)X.faceCenters.push(b.Zd())}if(this.goldbergData.faceZaxis){X.faceZaxis=[];for(const b of this.goldbergData.faceZaxis)X.faceZaxis.push(b.Zd())}if(this.goldbergData.faceYaxis){X.faceYaxis=[];for(const b of this.goldbergData.faceYaxis)X.faceYaxis.push(b.Zd())}if(this.goldbergData.faceXaxis){X.faceXaxis=[];for(const b of this.goldbergData.faceXaxis)X.faceXaxis.push(b.Zd())}b.goldbergData=X}static Parse(b,X){const P=b.goldbergData;P.faceColors=P.faceColors.map((b=>e.Ba.hX(b))),P.faceCenters=P.faceCenters.map((b=>Q.tX.hX(b))),P.faceZaxis=P.faceZaxis.map((b=>Q.tX.hX(b))),P.faceXaxis=P.faceXaxis.map((b=>Q.tX.hX(b))),P.faceYaxis=P.faceYaxis.map((b=>Q.tX.hX(b)));const S=new db(b.name,X);return S.goldbergData=P,S}}var Nb=P(12410);const ab={CreateBox:O.d,CreateTiledBox:t,CreateSphere:B.d,CreateDisc:f.b,CreateIcoSphere:g,CreateRibbon:w,CreateCylinder:h,CreateTorus:Z,CreateTorusKnot:A,CreateLineSystem:o.g,fw:o.k,CreateDashedLines:o.d,ExtrudeShape:q,ExtrudeShapeCustom:V,CreateLathe:x,CreateTiledPlane:D,Yw:H.c,CreateGround:C.c,CreateTiledGround:C.d,CreateGroundFromHeightMap:C.b,CreatePolygon:K.c,ExtrudePolygon:K.d,CreateTube:p,CreatePolyhedron:z,CreateGeodesic:function(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=X.m||1;Q!==Math.floor(Q)&&(Q=Math.floor(Q),mb.b.Warn("m not an integer only floor(m) used"));let S=X.n||0;if(S!==Math.floor(S)&&(S=Math.floor(S),mb.b.Warn("n not an integer only floor(n) used")),S>Q){const b=S;S=Q,Q=b,mb.b.Warn("n > m therefore m and n swapped")}const d=new Pb;return d.build(Q,S),z(b,{custom:Sb.BuildGeodesicData(d),size:X.size,sizeX:X.sizeX,sizeY:X.sizeY,sizeZ:X.sizeZ,faceUV:X.faceUV,faceColors:X.faceColors,flat:X.flat,updatable:X.updatable,sideOrientation:X.sideOrientation,frontUVs:X.frontUVs,backUVs:X.backUVs},P)},CreateGoldberg:function(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=X.size,u=X.sizeX||d||1,w=X.sizeY||d||1,f=X.sizeZ||d||1;let O=X.m||1;O!==Math.floor(O)&&(O=Math.floor(O),mb.b.Warn("m not an integer only floor(m) used"));let Y=X.n||0;if(Y!==Math.floor(Y)&&(Y=Math.floor(Y),mb.b.Warn("n not an integer only floor(n) used")),Y>O){const b=Y;Y=O,O=b,mb.b.Warn("n > m therefore m and n swapped")}const D=new Pb;D.build(O,Y);const E=Sb.BuildGeodesicData(D),t=E.toGoldbergPolyhedronData(),B=new db(b,P);X.sideOrientation=S.b._GetDefaultSideOrientation(X.sideOrientation),B._originalBuilderSideOrientation=X.sideOrientation;(function(b,X){const P=b.size,S=b.sizeX||P||1,d=b.sizeY||P||1,u=b.sizeZ||P||1,w=0===b.sideOrientation?0:b.sideOrientation||N.e.DEFAULTSIDE,f=[],O=[],e=[],Y=[];let D=1/0,E=-1/0,t=1/0,B=-1/0;for(let Q=0;Q<X.vertex.length;Q++)D=Math.min(D,X.vertex[Q][0]*S),E=Math.max(E,X.vertex[Q][0]*S),t=Math.min(t,X.vertex[Q][1]*d),B=Math.max(B,X.vertex[Q][1]*d);let W=0;for(let N=0;N<X.face.length;N++){const b=X.face[N],P=Q.tX.hX(X.vertex[b[0]]),w=Q.tX.hX(X.vertex[b[2]]),n=Q.tX.hX(X.vertex[b[1]]),y=w.BX(P),h=n.BX(P),L=Q.tX.Cross(h,y).normalize();for(let Q=0;Q<b.length;Q++){e.push(L.x,L.y,L.z);const P=X.vertex[b[Q]];f.push(P[0]*S,P[1]*d,P[2]*u);const N=(P[1]*d-t)/(B-t);Y.push((P[0]*S-D)/(E-D),a.c?1-N:N)}for(let X=0;X<b.length-2;X++)O.push(W,W+X+2,W+X+1);W+=b.length}N.e._ComputeSides(w,f,O,e,Y);const n=new N.e;return n.Kb=f,n.indices=O,n.Tb=e,n.Vb=Y,n})(X,t).xb(B,X.updatable),B.goldbergData.nbSharedFaces=E.sharedNodes,B.goldbergData.nbUnsharedFaces=E.poleNodes,B.goldbergData.adjacentFaces=E.adjacentFaces,B.goldbergData.nbFaces=B.goldbergData.nbSharedFaces+B.goldbergData.nbUnsharedFaces,B.goldbergData.nbFacesAtPole=(B.goldbergData.nbUnsharedFaces-12)/12;for(let S=0;S<E.vertex.length;S++)B.goldbergData.faceCenters.push(Q.tX.hX(E.vertex[S])),B.goldbergData.faceCenters[S].x*=u,B.goldbergData.faceCenters[S].y*=w,B.goldbergData.faceCenters[S].z*=f,B.goldbergData.faceColors.push(new e.Ba(1,1,1,1));for(let S=0;S<t.face.length;S++){const b=t.face[S],X=Q.tX.hX(t.vertex[b[0]]),P=Q.tX.hX(t.vertex[b[2]]),d=Q.tX.hX(t.vertex[b[1]]),N=P.BX(X),a=d.BX(X),u=Q.tX.Cross(a,N).normalize(),w=Q.tX.Cross(a,u).normalize();B.goldbergData.faceXaxis.push(a.normalize()),B.goldbergData.faceYaxis.push(u),B.goldbergData.faceZaxis.push(w)}return B},CreateDecal:r,CreateCapsule:G,CreateText:Nb.g}},13232:(b,X,P)=>{"use strict";P.d(X,{e:()=>aX});var Q=P(11834),S=P(12240);class d extends S.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var N=P(11878),a=(P(12006),P(11802));class u{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(b){this._targetStopDuration!==b&&(this._targetStopDuration=b)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(b){this._noiseTexture!==b&&(this._noiseTexture=b,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(b){this._animationSheetEnabled!==b&&(this._animationSheetEnabled=b)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(b){this._isAnimationSheetEnabled!=b&&(this._isAnimationSheetEnabled=b,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(b){this._useLogarithmicDepth=b&&this.Ab().getEngine().getCaps().fragmentDepthSupported}Ab(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(b){switch(b){case u.BLENDMODE_MULTIPLYADD:return;case u.BLENDMODE_ADD:b=1;break;case u.BLENDMODE_ONEONE:b=6;break;case u.BLENDMODE_STANDARD:b=2;break;case u.BLENDMODE_MULTIPLY:b=4;break;case u.BLENDMODE_SUBTRACT:b=3}this._engine.setAlphaMode(b)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:Q.tX.Zero()}set direction1(b){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=b)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:Q.tX.Zero()}set direction2(b){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=b)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:Q.tX.Zero()}set minEmitBox(b){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=b)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:Q.tX.Zero()}set maxEmitBox(b){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=b)}get billboardMode(){return this._billboardMode}set billboardMode(b){this._billboardMode!==b&&(this._billboardMode=b,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(b){this._isBillboardBased!==b&&(this._isBillboardBased=b,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(b){this._attachImageProcessingConfiguration(b)}_attachImageProcessingConfiguration(b){b!==this._imageProcessingConfiguration&&(!b&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=b)}_reset(){}_removeGradientAndTexture(b,X,P){if(!X)return this;let Q=0;for(const S of X){if(S.gradient===b){X.splice(Q,1);break}Q++}return P&&P.dispose(),this}constructor(b){this.animations=[],this.renderingGroupId=0,this.dX=Q.tX.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new Q.tX(10,10,10),this.onAnimationEnd=null,this.blendMode=u.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new Q.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.aw=new Q.tX(0,0,0),this._useLogarithmicDepth=!1,this.gravity=Q.tX.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new N.Ba(1,1,1,1),this.color2=new N.Ba(1,1,1,1),this.colorDead=new N.Ba(0,0,0,1),this.textureMask=new N.Ba(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new d,this.id=b,this.name=b}createPointEmitter(b,X){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new Q.tX(0,1,0),arguments.length>2&&void 0!==arguments[2]||new Q.tX(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new Q.tX(0,1,0),arguments.length>4&&void 0!==arguments[4]||new Q.tX(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new Q.tX(0,1,0),arguments.length>3&&void 0!==arguments[3]||new Q.tX(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(b,X,P,Q){throw new Error("Method not implemented.")}}u.BLENDMODE_ONEONE=0,u.BLENDMODE_STANDARD=1,u.BLENDMODE_ADD=2,u.BLENDMODE_MULTIPLY=3,u.BLENDMODE_MULTIPLYADD=4,u.BLENDMODE_SUBTRACT=-1,(0,a.h)("BABYLON.BaseParticleSystem",u);var w=P(11844),f=P(11709);class O{constructor(){this.direction1=new Q.tX(0,1,0),this.direction2=new Q.tX(0,1,0),this.minEmitBox=new Q.tX(-.5,-.5,-.5),this.maxEmitBox=new Q.tX(.5,.5,.5)}startDirectionFunction(b,X,P,S){const d=(0,w.RandomRange)(this.direction1.x,this.direction2.x),N=(0,w.RandomRange)(this.direction1.y,this.direction2.y),a=(0,w.RandomRange)(this.direction1.z,this.direction2.z);if(S)return X.x=d,X.y=N,void(X.z=a);Q.tX.TransformNormalFromFloatsToRef(d,N,a,b,X)}startPositionFunction(b,X,P,S){const d=(0,w.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),N=(0,w.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),a=(0,w.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(S)return X.x=d,X.y=N,void(X.z=a);Q.tX.TransformCoordinatesFromFloatsToRef(d,N,a,b,X)}clone(){const b=new O;return f.b.DeepCopy(this,b),b}applyToShader(b){b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2),b.setVector3("minEmitBox",this.minEmitBox),b.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(b){b.addUniform("direction1",3),b.addUniform("direction2",3),b.addUniform("minEmitBox",3),b.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.direction1=this.direction1.Zd(),b.direction2=this.direction2.Zd(),b.minEmitBox=this.minEmitBox.Zd(),b.maxEmitBox=this.maxEmitBox.Zd(),b}parse(b){Q.tX.FromArrayToRef(b.direction1,0,this.direction1),Q.tX.FromArrayToRef(b.direction2,0,this.direction2),Q.tX.FromArrayToRef(b.minEmitBox,0,this.minEmitBox),Q.tX.FromArrayToRef(b.maxEmitBox,0,this.maxEmitBox)}}class e{get radius(){return this._radius}set radius(b){this._radius=b,this._buildHeight()}get angle(){return this._angle}set angle(b){this._angle=b,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=P,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=X,this.radius=b}startDirectionFunction(b,X,P,S){S?Q.TmpVectors.tX[0].N(P.ga).normalize():P.position.subtractToRef(b.getTranslation(),Q.TmpVectors.tX[0]).normalize();const d=(0,w.RandomRange)(0,this.directionRandomizer),N=(0,w.RandomRange)(0,this.directionRandomizer),a=(0,w.RandomRange)(0,this.directionRandomizer);X.x=Q.TmpVectors.tX[0].x+d,X.y=Q.TmpVectors.tX[0].y+N,X.z=Q.TmpVectors.tX[0].z+a,X.normalize()}startPositionFunction(b,X,P,S){const d=(0,w.RandomRange)(0,2*Math.PI);let N;this.emitFromSpawnPointOnly?N=1e-4:(N=(0,w.RandomRange)(0,this.heightRange),N=1-N*N);let a=this._radius-(0,w.RandomRange)(0,this._radius*this.radiusRange);a*=N;const u=a*Math.sin(d),f=a*Math.cos(d),O=N*this._height;if(S)return X.x=u,X.y=O,void(X.z=f);Q.tX.TransformCoordinatesFromFloatsToRef(u,O,f,b,X)}clone(){const b=new e(this._radius,this._angle,this.directionRandomizer);return f.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat2("radius",this._radius,this.radiusRange),b.setFloat("coneAngle",this._angle),b.setFloat2("height",this._height,this.heightRange),b.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(b){b.addUniform("radius",2),b.addUniform("coneAngle",1),b.addUniform("height",2),b.addUniform("directionRandomizer",1)}getEffectDefines(){let b="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(b+="\n#define CONEEMITTERSPAWNPOINT"),b}getClassName(){return"ConeParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.radius=this._radius,b.angle=this._angle,b.directionRandomizer=this.directionRandomizer,b.radiusRange=this.radiusRange,b.heightRange=this.heightRange,b.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,b}parse(b){this.radius=b.radius,this.angle=b.angle,this.directionRandomizer=b.directionRandomizer,this.radiusRange=void 0!==b.radiusRange?b.radiusRange:1,this.heightRange=void 0!==b.radiusRange?b.heightRange:1,this.emitFromSpawnPointOnly=void 0!==b.emitFromSpawnPointOnly&&b.emitFromSpawnPointOnly}}class Y extends e{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.tX(0,1,0),S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.tX(0,1,0);super(b,X),this.direction1=P,this.direction2=S}startDirectionFunction(b,X){const P=(0,w.RandomRange)(this.direction1.x,this.direction2.x),S=(0,w.RandomRange)(this.direction1.y,this.direction2.y),d=(0,w.RandomRange)(this.direction1.z,this.direction2.z);Q.tX.TransformNormalFromFloatsToRef(P,S,d,b,X)}clone(){const b=new Y(this.radius,this.angle,this.direction1,this.direction2);return f.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("radiusRange",1),b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const b=super.serialize();return b.direction1=this.direction1.Zd(),b.direction2=this.direction2.Zd(),b}parse(b){super.parse(b),this.direction1.N(b.direction1),this.direction2.N(b.direction2)}}class D{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=b,this.height=X,this.radiusRange=P,this.directionRandomizer=S,this._tempVector=Q.tX.Zero()}startDirectionFunction(b,X,P,S,d){P.position.subtractToRef(b.getTranslation(),this._tempVector),this._tempVector.normalize(),Q.tX.TransformNormalToRef(this._tempVector,d,this._tempVector);const N=(0,w.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let a=Math.atan2(this._tempVector.x,this._tempVector.z);a+=(0,w.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=N,this._tempVector.x=Math.sin(a),this._tempVector.z=Math.cos(a),this._tempVector.normalize(),S?X.N(this._tempVector):Q.tX.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,b,X)}startPositionFunction(b,X,P,S){const d=(0,w.RandomRange)(-this.height/2,this.height/2),N=(0,w.RandomRange)(0,2*Math.PI),a=(0,w.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),u=Math.sqrt(a)*this.radius,f=u*Math.cos(N),O=u*Math.sin(N);S?X.sd(f,d,O):Q.tX.TransformCoordinatesFromFloatsToRef(f,d,O,b,X)}clone(){const b=new D(this.radius,this.directionRandomizer);return f.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("height",this.height),b.setFloat("radiusRange",this.radiusRange),b.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("height",1),b.addUniform("radiusRange",1),b.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.radius=this.radius,b.height=this.height,b.radiusRange=this.radiusRange,b.directionRandomizer=this.directionRandomizer,b}parse(b){this.radius=b.radius,this.height=b.height,this.radiusRange=b.radiusRange,this.directionRandomizer=b.directionRandomizer}}class E extends D{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.tX(0,1,0),d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.tX(0,1,0);super(b,X,P),this.direction1=S,this.direction2=d}startDirectionFunction(b,X,P,S){const d=(0,w.RandomRange)(this.direction1.x,this.direction2.x),N=(0,w.RandomRange)(this.direction1.y,this.direction2.y),a=(0,w.RandomRange)(this.direction1.z,this.direction2.z);S?X.sd(d,N,a):Q.tX.TransformNormalFromFloatsToRef(d,N,a,b,X)}clone(){const b=new E(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return f.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("height",this.height),b.setFloat("radiusRange",this.radiusRange),b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("height",1),b.addUniform("radiusRange",1),b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const b=super.serialize();return b.direction1=this.direction1.Zd(),b.direction2=this.direction2.Zd(),b}parse(b){super.parse(b),Q.tX.FromArrayToRef(b.direction1,0,this.direction1),Q.tX.FromArrayToRef(b.direction2,0,this.direction2)}}class t{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=b,this.radiusRange=X,this.directionRandomizer=P}startDirectionFunction(b,X,P,S){const d=P.position.BX(b.getTranslation()).normalize(),N=(0,w.RandomRange)(0,this.directionRandomizer),a=(0,w.RandomRange)(0,this.directionRandomizer),u=(0,w.RandomRange)(0,this.directionRandomizer);d.x+=N,d.y+=a,d.z+=u,d.normalize(),S?X.N(d):Q.tX.TransformNormalFromFloatsToRef(d.x,d.y,d.z,b,X)}startPositionFunction(b,X,P,S){const d=this.radius-(0,w.RandomRange)(0,this.radius*this.radiusRange),N=(0,w.RandomRange)(0,1),a=(0,w.RandomRange)(0,2*Math.PI),u=Math.acos(2*N-1),f=d*Math.cos(a)*Math.sin(u),O=d*Math.cos(u),e=d*Math.sin(a)*Math.sin(u);S?X.sd(f,Math.abs(O),e):Q.tX.TransformCoordinatesFromFloatsToRef(f,Math.abs(O),e,b,X)}clone(){const b=new t(this.radius,this.directionRandomizer);return f.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("radiusRange",1),b.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.radius=this.radius,b.radiusRange=this.radiusRange,b.directionRandomizer=this.directionRandomizer,b}parse(b){this.radius=b.radius,this.radiusRange=b.radiusRange,this.directionRandomizer=b.directionRandomizer}}class B{constructor(){this.direction1=new Q.tX(0,1,0),this.direction2=new Q.tX(0,1,0)}startDirectionFunction(b,X,P,S){const d=(0,w.RandomRange)(this.direction1.x,this.direction2.x),N=(0,w.RandomRange)(this.direction1.y,this.direction2.y),a=(0,w.RandomRange)(this.direction1.z,this.direction2.z);S?X.sd(d,N,a):Q.tX.TransformNormalFromFloatsToRef(d,N,a,b,X)}startPositionFunction(b,X,P,S){S?X.sd(0,0,0):Q.tX.TransformCoordinatesFromFloatsToRef(0,0,0,b,X)}clone(){const b=new B;return f.b.DeepCopy(this,b),b}applyToShader(b){b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.direction1=this.direction1.Zd(),b.direction2=this.direction2.Zd(),b}parse(b){Q.tX.FromArrayToRef(b.direction1,0,this.direction1),Q.tX.FromArrayToRef(b.direction2,0,this.direction2)}}class W{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=b,this.radiusRange=X,this.directionRandomizer=P}startDirectionFunction(b,X,P,S){const d=P.position.BX(b.getTranslation()).normalize(),N=(0,w.RandomRange)(0,this.directionRandomizer),a=(0,w.RandomRange)(0,this.directionRandomizer),u=(0,w.RandomRange)(0,this.directionRandomizer);d.x+=N,d.y+=a,d.z+=u,d.normalize(),S?X.N(d):Q.tX.TransformNormalFromFloatsToRef(d.x,d.y,d.z,b,X)}startPositionFunction(b,X,P,S){const d=this.radius-(0,w.RandomRange)(0,this.radius*this.radiusRange),N=(0,w.RandomRange)(0,1),a=(0,w.RandomRange)(0,2*Math.PI),u=Math.acos(2*N-1),f=d*Math.cos(a)*Math.sin(u),O=d*Math.cos(u),e=d*Math.sin(a)*Math.sin(u);S?X.sd(f,O,e):Q.tX.TransformCoordinatesFromFloatsToRef(f,O,e,b,X)}clone(){const b=new W(this.radius,this.directionRandomizer);return f.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("radiusRange",1),b.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.radius=this.radius,b.radiusRange=this.radiusRange,b.directionRandomizer=this.directionRandomizer,b}parse(b){this.radius=b.radius,this.radiusRange=b.radiusRange,this.directionRandomizer=b.directionRandomizer}}class n extends W{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.tX(0,1,0),P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.tX(0,1,0);super(b),this.direction1=X,this.direction2=P}startDirectionFunction(b,X){const P=(0,w.RandomRange)(this.direction1.x,this.direction2.x),S=(0,w.RandomRange)(this.direction1.y,this.direction2.y),d=(0,w.RandomRange)(this.direction1.z,this.direction2.z);Q.tX.TransformNormalFromFloatsToRef(P,S,d,b,X)}clone(){const b=new n(this.radius,this.direction1,this.direction2);return f.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("radiusRange",1),b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const b=super.serialize();return b.direction1=this.direction1.Zd(),b.direction2=this.direction2.Zd(),b}parse(b){super.parse(b),this.direction1.N(b.direction1),this.direction2.N(b.direction2)}}class y{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(b,X,P,S){const d=Q.TmpVectors.tX[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,P,d);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,P,d);const b=Q.TmpVectors.tX[1];d.subtractToRef(P.position,b),b.scaleToRef(1/P.lifeTime,d)}else d.set(0,0,0);S?X.N(d):Q.tX.TransformNormalToRef(d,b,X)}startPositionFunction(b,X,P,S){const d=Q.TmpVectors.tX[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,P,d):d.set(0,0,0),S?X.N(d):Q.tX.TransformCoordinatesToRef(d,b,X)}clone(){const b=new y;return f.b.DeepCopy(this,b),b}applyToShader(b){}buildUniformLayout(b){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.particlePositionGenerator=this.particlePositionGenerator,b.particleDestinationGenerator=this.particleDestinationGenerator,b}parse(b){b.particlePositionGenerator&&(this.particlePositionGenerator=b.particlePositionGenerator),b.particleDestinationGenerator&&(this.particleDestinationGenerator=b.particleDestinationGenerator)}}var h=P(11912);class L{get mesh(){return this._mesh}set mesh(b){this._mesh!==b&&(this._mesh=b,b?(this._indices=b.ld(),this._positions=b.getVerticesData(h.g.PositionKind),this._normals=b.getVerticesData(h.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=Q.tX.Zero(),this._mesh=null,this.direction1=new Q.tX(0,1,0),this.direction2=new Q.tX(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=b}startDirectionFunction(b,X,P,S){if(this.useMeshNormalsForDirection&&this._normals)return void Q.tX.TransformNormalToRef(this._storedNormal,b,X);const d=(0,w.RandomRange)(this.direction1.x,this.direction2.x),N=(0,w.RandomRange)(this.direction1.y,this.direction2.y),a=(0,w.RandomRange)(this.direction1.z,this.direction2.z);S?X.sd(d,N,a):Q.tX.TransformNormalFromFloatsToRef(d,N,a,b,X)}startPositionFunction(b,X,P,S){if(!this._indices||!this._positions)return;const d=3*(Math.random()*(this._indices.length/3)|0),N=Math.random(),a=Math.random()*(1-N),u=1-N-a,w=this._indices[d],f=this._indices[d+1],O=this._indices[d+2],e=Q.TmpVectors.tX[0],Y=Q.TmpVectors.tX[1],D=Q.TmpVectors.tX[2],E=Q.TmpVectors.tX[3];Q.tX.FromArrayToRef(this._positions,3*w,e),Q.tX.FromArrayToRef(this._positions,3*f,Y),Q.tX.FromArrayToRef(this._positions,3*O,D),E.x=N*e.x+a*Y.x+u*D.x,E.y=N*e.y+a*Y.y+u*D.y,E.z=N*e.z+a*Y.z+u*D.z,S?X.sd(E.x,E.y,E.z):Q.tX.TransformCoordinatesFromFloatsToRef(E.x,E.y,E.z,b,X),this.useMeshNormalsForDirection&&this._normals&&(Q.tX.FromArrayToRef(this._normals,3*w,e),Q.tX.FromArrayToRef(this._normals,3*f,Y),Q.tX.FromArrayToRef(this._normals,3*O,D),this._storedNormal.x=N*e.x+a*Y.x+u*D.x,this._storedNormal.y=N*e.y+a*Y.y+u*D.y,this._storedNormal.z=N*e.z+a*Y.z+u*D.z)}clone(){const b=new L(this.mesh);return f.b.DeepCopy(this,b),b}applyToShader(b){b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var b;const X={};return X.type=this.getClassName(),X.direction1=this.direction1.Zd(),X.direction2=this.direction2.Zd(),X.meshId=null===(b=this.mesh)||void 0===b?void 0:b.id,X.useMeshNormalsForDirection=this.useMeshNormalsForDirection,X}parse(b,X){Q.tX.FromArrayToRef(b.direction1,0,this.direction1),Q.tX.FromArrayToRef(b.direction2,0,this.direction2),b.meshId&&X&&(this.mesh=X.getLastMeshById(b.meshId)),this.useMeshNormalsForDirection=b.useMeshNormalsForDirection}}class Z{_isUbo(b){return void 0!==b.addUniform}constructor(b){this._isUbo(b)?(this.setMatrix3x3=b.updateMatrix3x3.bind(b),this.setMatrix2x2=b.updateMatrix2x2.bind(b),this.setFloat=b.updateFloat.bind(b),this.setFloat2=b.updateFloat2.bind(b),this.setFloat3=b.updateFloat3.bind(b),this.setFloat4=b.updateFloat4.bind(b),this.setFloatArray=b.updateFloatArray.bind(b),this.setArray=b.updateArray.bind(b),this.setIntArray=b.updateIntArray.bind(b),this.setMatrix=b.Cd.bind(b),this.setMatrices=b.updateMatrices.bind(b),this.setVector3=b.updateVector3.bind(b),this.setVector4=b.updateVector4.bind(b),this.setColor3=b.updateColor3.bind(b),this.setColor4=b.updateColor4.bind(b),this.setDirectColor4=b.updateDirectColor4.bind(b),this.setInt=b.updateInt.bind(b),this.setInt2=b.updateInt2.bind(b),this.setInt3=b.updateInt3.bind(b),this.setInt4=b.updateInt4.bind(b)):(this.setMatrix3x3=b.setMatrix3x3.bind(b),this.setMatrix2x2=b.setMatrix2x2.bind(b),this.setFloat=b.setFloat.bind(b),this.setFloat2=b.setFloat2.bind(b),this.setFloat3=b.setFloat3.bind(b),this.setFloat4=b.setFloat4.bind(b),this.setFloatArray=b.setFloatArray.bind(b),this.setArray=b.setArray.bind(b),this.setIntArray=b.setIntArray.bind(b),this.setMatrix=b.setMatrix.bind(b),this.setMatrices=b.setMatrices.bind(b),this.setVector3=b.setVector3.bind(b),this.setVector4=b.setVector4.bind(b),this.setColor3=b.setColor3.bind(b),this.setColor4=b.setColor4.bind(b),this.setDirectColor4=b.setDirectColor4.bind(b),this.setInt=b.setInt.bind(b),this.setInt2=b.setInt2.bind(b),this.setInt3=b.setInt3.bind(b),this.setInt4=b.setInt4.bind(b))}}var v=P(11765);const A="gpuUpdateParticlesPixelShader",o="#version 300 es\nvoid main() {discard;}\n";v.c.ShadersStore[A]||(v.c.ShadersStore[A]=o);const K="gpuUpdateParticlesVertexShader",T="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";v.c.ShadersStore[K]||(v.c.ShadersStore[K]=T);(0,a.h)("BABYLON.WebGL2ParticleSystem",class{constructor(b,X){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=b,this._engine=X,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var b;return(null===(b=this._updateEffect)||void 0===b?void 0:b.isReady())??!1}createUpdateBuffer(b){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof y&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=b,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new Z(this._updateEffect)}createVertexBuffers(b,X){this._updateVAO.push(this._createUpdateVAO(b)),this._renderVAO.push(this._engine.recordVertexArrayObject(X,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=X}createParticleBuffer(b){return b}bindDrawBuffers(b,X,P){P?this._engine.bindBuffers(this._renderVertexBuffers,P,X):this._engine.bindVertexArrayObject(this._renderVAO[b],null)}preUpdateParticleBuffer(){const b=this._engine;if(this._engine.enableEffect(this._updateEffect),!b.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(b,X,P){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[b],null);const Q=this._engine;Q.bindTransformFeedbackBuffer(X.getBuffer()),Q.setRasterizerState(!1),Q.beginTransformFeedback(!0),Q.drawArraysType(3,0,P),Q.endTransformFeedback(),Q.setRasterizerState(!0),Q.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let b=0;b<this._updateVAO.length;b++)this._engine.releaseVertexArrayObject(this._updateVAO[b]);this._updateVAO.length=0;for(let b=0;b<this._renderVAO.length;b++)this._engine.releaseVertexArrayObject(this._renderVAO[b]);this._renderVAO.length=0}_createUpdateVAO(b){const X={};X.position=b.createVertexBuffer("position",0,3);let P=3;X.age=b.createVertexBuffer("age",P,1),P+=1,X.size=b.createVertexBuffer("size",P,3),P+=3,X.life=b.createVertexBuffer("life",P,1),P+=1,X.seed=b.createVertexBuffer("seed",P,4),P+=4,X.direction=b.createVertexBuffer("direction",P,3),P+=3,this._parent.particleEmitterType instanceof y&&(X.initialPosition=b.createVertexBuffer("initialPosition",P,3),P+=3),this._parent._colorGradientsTexture||(X.color=b.createVertexBuffer("color",P,4),P+=4),this._parent._isBillboardBased||(X.initialDirection=b.createVertexBuffer("initialDirection",P,3),P+=3),this._parent.noiseTexture&&(X.noiseCoordinates1=b.createVertexBuffer("noiseCoordinates1",P,3),P+=3,X.noiseCoordinates2=b.createVertexBuffer("noiseCoordinates2",P,3),P+=3),this._parent._angularSpeedGradientsTexture?(X.angle=b.createVertexBuffer("angle",P,1),P+=1):(X.angle=b.createVertexBuffer("angle",P,2),P+=2),this._parent._isAnimationSheetEnabled&&(X.cellIndex=b.createVertexBuffer("cellIndex",P,1),P+=1,this._parent.spriteRandomStartCell&&(X.cellStartOffset=b.createVertexBuffer("cellStartOffset",P,1),P+=1));const Q=this._engine.recordVertexArrayObject(X,null,this._updateEffect);return this._engine.bindArrayBuffer(null),Q}});class q{constructor(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,Q=arguments.length>3?arguments[3]:void 0;this._engine=b,this._label=Q,this._engine._storageBuffers.push(this),this._create(X,P)}_create(b,X){this._bufferSize=b,this._creationFlags=X,this._buffer=this._engine.createStorageBuffer(b,X,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(b,X,P){this._buffer&&this._engine.updateStorageBuffer(this._buffer,b,X,P)}async read(b,X,P,Q){return await this._engine.readFromStorageBuffer(this._buffer,b,X,P,Q)}dispose(){const b=this._engine._storageBuffers,X=b.indexOf(this);-1!==X&&(b[X]=b[b.length-1],b.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var V=P(11822),i=P(11825),x=P(11862),H=P(11814),C=P(12156),p=P(11700),k=P(11789),z=P(12066);class U{constructor(){this._gpuTimeInFrameId=-1,this.counter=new z.c}_addDuration(b,X){b<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==b?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(X,!1),this._gpuTimeInFrameId=b):this.counter.addCount(X,!1))}}var g=P(11755);class j{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=b,this._engine=X,this.uniqueId=C.b.UniqueId,X.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new U),this._engine.getCaps().supportComputeShaders?Q.bindingsMapping?(this._context=X.createComputeContext(),this._shaderPath=P,this._options={bindingsMapping:{},defines:[],...Q}):p.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):p.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(b,X){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const Q=this._bindings[b];this._bindings[b]={type:P?0:4,object:X,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==X||Q.type!==this._bindings[b].type)}setStorageTexture(b,X){const P=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==X),this._bindings[b]={type:1,object:X,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setExternalTexture(b,X){const P=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==X),this._bindings[b]={type:6,object:X,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setVideoTexture(b,X){return!!X.externalTexture&&(this.setExternalTexture(b,X.externalTexture),!0)}setUniformBuffer(b,X){const P=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==X),this._bindings[b]={type:j._BufferIsDataBuffer(X)?7:2,object:X,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setStorageBuffer(b,X){const P=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==X),this._bindings[b]={type:j._BufferIsDataBuffer(X)?7:3,object:X,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setTextureSampler(b,X){const P=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!P||!X.compareSampler(P.object)),this._bindings[b]={type:5,object:X,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}isReady(){let b=this._effect;for(const S in this._bindings){const b=this._bindings[S],X=b.type,P=b.object;switch(X){case 0:case 4:case 1:if(!P.isReady())return!1;break;case 6:if(!P.isReady())return!1;break}}const X=[],P=this._shaderPath;if(this._options.defines)for(let S=0;S<this._options.defines.length;S++)X.push(this._options.defines[S]);const Q=X.join("\n");return this._cachedDefines!==Q&&(this._cachedDefines=Q,b=this._engine.createComputeEffect(P,{defines:Q,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=b),!!b.isReady()}dispatch(b,X,P){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,b,X,P,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const P=j._BufferIsDataBuffer(b)?b:b.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,P,X,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const X in this._bindings){const P=this._bindings[X];if(!this._options.bindingsMapping[X])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+X+"'");switch(P.type){case 0:{const Q=this._samplers[X],S=P.object;var b;if(!Q||!S._texture||!Q.compareSampler(S._texture))this._samplers[X]=(new k.e).setParameters(S.wrapU,S.wrapV,S.wrapR,S.anisotropicFilteringLevel,S._texture.samplingMode,null===(b=S._texture)||void 0===b?void 0:b._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const b=P.object;b.getBuffer()!==P.buffer&&(P.buffer=b.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((S=>{(0,g.c)((()=>this.dispatch(b,X,P)),S,void 0,Q)}))}serialize(){const b=x.b.Serialize(this);b.options=this._options,b.shaderPath=this._shaderPath,b.ye={},b.textures={};for(const X in this._bindings){const P=this._bindings[X],Q=P.object;switch(P.type){case 0:case 4:case 1:{const S=Q.serialize();S&&(b.textures[X]=S,b.ye[X]={type:P.type});break}}}return b}static Parse(b,X,P){const Q=x.b.Parse((()=>new j(b.name,X.getEngine(),b.shaderPath,b.options)),b,X,P);for(const S in b.textures){const d=b.ye[S],N=H.d.Parse(b.textures[S],X,P);0===d.type?Q.setTexture(S,N):4===d.type?Q.setTexture(S,N,!1):Q.setStorageTexture(S,N)}return Q}static _BufferIsDataBuffer(b){return void 0!==b.underlyingResource}}(0,V.b)([(0,i.E)()],j.prototype,"name",void 0),(0,V.b)([(0,i.E)()],j.prototype,"fastMode",void 0),(0,a.h)("BABYLON.ComputeShader",j);var l=P(12121);const J="gpuUpdateParticlesComputeShader",c="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";v.c.ShadersStoreWGSL[J]||(v.c.ShadersStoreWGSL[J]=c);(0,a.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(b,X){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=b,this._engine=X}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var b;return(null===(b=this._updateComputeShader)||void 0===b?void 0:b.isReady())??!1}createUpdateBuffer(b){var X;const P={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(P.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(P.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(P.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(P.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(P.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(P.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(P.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new j("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:P,defines:b.split("\n")}),null===(X=this._simParamsComputeShader)||void 0===X||X.dispose(),this._simParamsComputeShader=new l.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new Z(this._simParamsComputeShader)}createVertexBuffers(b,X){this._renderVertexBuffers.push(X)}createParticleBuffer(b){const X=new q(this._engine,4*b.length,11,"ComputeShaderParticleSystemBuffer");return X.update(b),this._bufferComputeShader.push(X),X.getBuffer()}bindDrawBuffers(b,X,P){this._engine.bindBuffers(this._renderVertexBuffers[b],P,X)}preUpdateParticleBuffer(){}updateParticleBuffer(b,X,P){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[b]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^b]),this._updateComputeShader.dispatch(Math.ceil(P/64))}releaseBuffers(){var b;for(let X=0;X<this._bufferComputeShader.length;++X)this._bufferComputeShader[X].dispose();this._bufferComputeShader.length=0,null===(b=this._simParamsComputeShader)||void 0===b||b.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class s{constructor(b,X,P){this.gradient=b,this.color1=X,this.color2=P}getColorToRef(b){this.color2?N.Ba.LerpToRef(this.color1,this.color2,Math.random(),b):b.N(this.color1)}}class F{constructor(b,X){this.gradient=b,this.color=X}}class M{constructor(b,X,P){this.gradient=b,this.factor1=X,this.factor2=P}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class R{static GetCurrentGradient(b,X,P){if(X[0].gradient>b)return void P(X[0],X[0],1);for(let S=0;S<X.length-1;S++){const Q=X[S],d=X[S+1];if(b>=Q.gradient&&b<=d.gradient){return void P(Q,d,(b-Q.gradient)/(d.gradient-Q.gradient))}}const Q=X.length-1;P(X[Q],X[Q],1)}}var r=P(11694),I=P(12346),G=P(11732);class mb{constructor(b){this.particleSystem=b,this.position=Q.tX.Zero(),this.direction=Q.tX.Zero(),this.color=new N.Ba(0,0,0,0),this.colorStep=new N.Ba(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new Q.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new N.Ba(0,0,0,0),this._currentColor2=new N.Ba(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=mb._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let b=this.age,X=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===X?(X=1,b=this._randomCellOffset):b+=this._randomCellOffset);const P=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let Q;Q=this._initialSpriteCellLoop?(0,w.Clamp)(b*X%this.lifeTime/this.lifeTime):(0,w.Clamp)(b*X/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+Q*P|0}_inheritParticleInfoToSubEmitter(b){if(b.particleSystem.dX.position){const X=b.particleSystem.dX;if(X.position.N(this.position),b.inheritDirection){const b=Q.TmpVectors.tX[0];this.direction.normalizeToRef(b),X.setDirection(b,0,Math.PI/2)}}else{b.particleSystem.dX.N(this.position)}this.direction.scaleToRef(b.inheritedVelocityAmount/2,Q.TmpVectors.tX[0]),b.particleSystem._inheritedVelocityOffset.N(Q.TmpVectors.tX[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const b of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(b)}_reset(){this.age=0,this.id=mb._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(b){b.position.N(this.position),this._initialDirection?b._initialDirection?b._initialDirection.N(this._initialDirection):b._initialDirection=this._initialDirection.clone():b._initialDirection=null,b.direction.N(this.direction),this.ga&&(b.ga?b.ga.N(this.ga):b.ga=this.ga.clone()),b.color.N(this.color),b.colorStep.N(this.colorStep),b.lifeTime=this.lifeTime,b.age=this.age,b._randomCellOffset=this._randomCellOffset,b.size=this.size,b.scale.N(this.scale),b.angle=this.angle,b.angularSpeed=this.angularSpeed,b.particleSystem=this.particleSystem,b.cellIndex=this.cellIndex,b.id=this.id,b._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(b._currentColorGradient=this._currentColorGradient,b._currentColor1.N(this._currentColor1),b._currentColor2.N(this._currentColor2)),this._currentSizeGradient&&(b._currentSizeGradient=this._currentSizeGradient,b._currentSize1=this._currentSize1,b._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(b._currentAngularSpeedGradient=this._currentAngularSpeedGradient,b._currentAngularSpeed1=this._currentAngularSpeed1,b._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(b._currentVelocityGradient=this._currentVelocityGradient,b._currentVelocity1=this._currentVelocity1,b._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(b._currentLimitVelocityGradient=this._currentLimitVelocityGradient,b._currentLimitVelocity1=this._currentLimitVelocity1,b._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(b._currentDragGradient=this._currentDragGradient,b._currentDrag1=this._currentDrag1,b._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(b._initialStartSpriteCellId=this._initialStartSpriteCellId,b._initialEndSpriteCellId=this._initialEndSpriteCellId,b._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(b.remapData&&this.remapData?b.remapData.N(this.remapData):b.remapData=new Q.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(b._randomNoiseCoordinates1?(b._randomNoiseCoordinates1.N(this._randomNoiseCoordinates1),b._randomNoiseCoordinates2.N(this._randomNoiseCoordinates2)):(b._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),b._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}mb._Count=0;var bb=P(11959),Xb=(P(11998),P(12229)),Pb=P(12221),Qb=P(12114);function Sb(b,X){const P=(0,w.RandomRange)(0,1);N.Ba.LerpToRef(X.color1,X.color2,P,b.color),X.colorDead.subtractToRef(b.color,X._colorDiff),X._colorDiff.scaleToRef(1/b.lifeTime,b.colorStep)}function db(b,X){b._currentColorGradient=X._colorGradients[0],b._currentColorGradient.getColorToRef(b.color),b._currentColor1.N(b.color),X._colorGradients.length>1?X._colorGradients[1].getColorToRef(b._currentColor2):b._currentColor2.N(b.color)}function Nb(b,X){const P=X._colorGradients;R.GetCurrentGradient(X._ratio,P,((X,P,Q)=>{X!==b._currentColorGradient&&(b._currentColor1.N(b._currentColor2),P.getColorToRef(b._currentColor2),b._currentColorGradient=X),N.Ba.LerpToRef(b._currentColor1,b._currentColor2,Q,b.color)}))}function ab(b,X){b.colorStep.scaleToRef(X._scaledUpdateSpeed,X._scaledColorStep),b.color.addInPlace(X._scaledColorStep),b.color.a<0&&(b.color.a=0)}function ub(b,X){R.GetCurrentGradient(X._ratio,X._angularSpeedGradients,((X,P,Q)=>{X!==b._currentAngularSpeedGradient&&(b._currentAngularSpeed1=b._currentAngularSpeed2,b._currentAngularSpeed2=P.getFactor(),b._currentAngularSpeedGradient=X),b.angularSpeed=(0,w.Lerp)(b._currentAngularSpeed1,b._currentAngularSpeed2,Q)}))}function wb(b,X){b.angle+=b.angularSpeed*X._scaledUpdateSpeed}function fb(b,X){X.particleEmitterType.startDirectionFunction(X._emitterWorldMatrix,b.direction,b,X.isLocal,X._emitterInverseWorldMatrix)}function Ob(b,X){X.startDirectionFunction(X._emitterWorldMatrix,b.direction,b,X.isLocal)}function eb(b,X){b._currentVelocityGradient=X._velocityGradients[0],b._currentVelocity1=b._currentVelocityGradient.getFactor(),X._velocityGradients.length>1?b._currentVelocity2=X._velocityGradients[1].getFactor():b._currentVelocity2=b._currentVelocity1}function Yb(b,X){b._currentLimitVelocityGradient=X._limitVelocityGradients[0],b._currentLimitVelocity1=b._currentLimitVelocityGradient.getFactor(),X._limitVelocityGradients.length>1?b._currentLimitVelocity2=X._limitVelocityGradients[1].getFactor():b._currentLimitVelocity2=b._currentLimitVelocity1}function Db(b,X){R.GetCurrentGradient(X._ratio,X._velocityGradients,((P,Q,S)=>{P!==b._currentVelocityGradient&&(b._currentVelocity1=b._currentVelocity2,b._currentVelocity2=Q.getFactor(),b._currentVelocityGradient=P),X._directionScale*=(0,w.Lerp)(b._currentVelocity1,b._currentVelocity2,S)}))}function Eb(b,X){R.GetCurrentGradient(X._ratio,X._limitVelocityGradients,((P,Q,S)=>{P!==b._currentLimitVelocityGradient&&(b._currentLimitVelocity1=b._currentLimitVelocity2,b._currentLimitVelocity2=Q.getFactor(),b._currentLimitVelocityGradient=P);const d=(0,w.Lerp)(b._currentLimitVelocity1,b._currentLimitVelocity2,S);b.direction.length()>d&&b.direction.scaleInPlace(X.limitVelocityDamping)}))}function tb(b,X){b.direction.scaleToRef(X._directionScale,X._scaledDirection)}function Bb(b,X){X.particleEmitterType.startPositionFunction(X._emitterWorldMatrix,b.position,b,X.isLocal)}function Wb(b,X){X.startPositionFunction(X._emitterWorldMatrix,b.position,b,X.isLocal)}function nb(b,X){b.ga?b.ga.N(b.position):b.ga=b.position.clone(),Q.tX.TransformCoordinatesToRef(b.ga,X._emitterWorldMatrix,b.position)}function yb(b,X){X.isLocal&&b.ga?(b.ga.addInPlace(X._scaledDirection),Q.tX.TransformCoordinatesToRef(b.ga,X._emitterWorldMatrix,b.position)):b.position.addInPlace(X._scaledDirection)}function hb(b,X){b._currentDragGradient=X._dragGradients[0],b._currentDrag1=b._currentDragGradient.getFactor(),X._dragGradients.length>1?b._currentDrag2=X._dragGradients[1].getFactor():b._currentDrag2=b._currentDrag1}function Lb(b,X){R.GetCurrentGradient(X._ratio,X._dragGradients,((P,Q,S)=>{P!==b._currentDragGradient&&(b._currentDrag1=b._currentDrag2,b._currentDrag2=Q.getFactor(),b._currentDragGradient=P);const d=(0,w.Lerp)(b._currentDrag1,b._currentDrag2,S);X._scaledDirection.scaleInPlace(1-d)}))}function Zb(b,X){b._randomNoiseCoordinates1?(b._randomNoiseCoordinates1.sd(Math.random(),Math.random(),Math.random()),b._randomNoiseCoordinates2.sd(Math.random(),Math.random(),Math.random())):(b._randomNoiseCoordinates1=new Q.tX(Math.random(),Math.random(),Math.random()),b._randomNoiseCoordinates2=new Q.tX(Math.random(),Math.random(),Math.random()))}function vb(b,X){const P=X._noiseTextureData,S=X._noiseTextureSize;if(P&&S&&b._randomNoiseCoordinates1){const d=X._fetchR(b._randomNoiseCoordinates1.x,b._randomNoiseCoordinates1.y,S.width,S.height,P),N=X._fetchR(b._randomNoiseCoordinates1.z,b._randomNoiseCoordinates2.x,S.width,S.height,P),a=X._fetchR(b._randomNoiseCoordinates2.y,b._randomNoiseCoordinates2.z,S.width,S.height,P),u=Q.TmpVectors.tX[0],w=Q.TmpVectors.tX[1];u.sd((2*d-1)*X.noiseStrength.x,(2*N-1)*X.noiseStrength.y,(2*a-1)*X.noiseStrength.z),u.scaleToRef(X._tempScaledUpdateSpeed,w),b.direction.addInPlace(w)}}function Ab(b,X){X.gravity.scaleToRef(X._tempScaledUpdateSpeed,X._scaledGravity),b.direction.addInPlace(X._scaledGravity)}function ob(b,X){b.size=(0,w.RandomRange)(X.minSize,X.maxSize),b.scale.sd((0,w.RandomRange)(X.minScaleX,X.maxScaleX),(0,w.RandomRange)(X.minScaleY,X.maxScaleY))}function Kb(b,X){b._currentSizeGradient=X._sizeGradients[0],b._currentSize1=b._currentSizeGradient.getFactor(),b.size=b._currentSize1,X._sizeGradients.length>1?b._currentSize2=X._sizeGradients[1].getFactor():b._currentSize2=b._currentSize1,b.scale.sd((0,w.RandomRange)(X.minScaleX,X.maxScaleX),(0,w.RandomRange)(X.minScaleY,X.maxScaleY))}function Tb(b,X){const P=X._actualFrame/X.targetStopDuration;R.GetCurrentGradient(P,X._startSizeGradients,((P,Q,S)=>{P!==X._currentStartSizeGradient&&(X._currentStartSize1=X._currentStartSize2,X._currentStartSize2=Q.getFactor(),X._currentStartSizeGradient=P);const d=(0,w.Lerp)(X._currentStartSize1,X._currentStartSize2,S);b.scale.scaleInPlace(d)}))}function qb(b,X){R.GetCurrentGradient(X._ratio,X._sizeGradients,((X,P,Q)=>{X!==b._currentSizeGradient&&(b._currentSize1=b._currentSize2,b._currentSize2=P.getFactor(),b._currentSizeGradient=X),b.size=(0,w.Lerp)(b._currentSize1,b._currentSize2,Q)}))}function Vb(b,X){b.remapData=new Q.Vector4(0,1,0,1)}function ib(b,X){X._colorRemapGradients&&X._colorRemapGradients.length>0&&R.GetCurrentGradient(X._ratio,X._colorRemapGradients,((X,P,Q)=>{const S=(0,w.Lerp)(X.factor1,P.factor1,Q),d=(0,w.Lerp)(X.factor2,P.factor2,Q);b.remapData.x=S,b.remapData.y=d-S})),X._alphaRemapGradients&&X._alphaRemapGradients.length>0&&R.GetCurrentGradient(X._ratio,X._alphaRemapGradients,((X,P,Q)=>{const S=(0,w.Lerp)(X.factor1,P.factor1,Q),d=(0,w.Lerp)(X.factor2,P.factor2,Q);b.remapData.z=S,b.remapData.w=d-S}))}function xb(b,X){const P=(0,w.Clamp)(X._actualFrame/X.targetStopDuration);R.GetCurrentGradient(P,X._lifeTimeGradients,((X,Q)=>{const S=X,d=Q,N=S.getFactor(),a=d.getFactor(),u=(P-S.gradient)/(d.gradient-S.gradient);b.lifeTime=(0,w.Lerp)(N,a,u)})),X._emitPower=(0,w.RandomRange)(X.minEmitPower,X.maxEmitPower)}function Hb(b,X){b.lifeTime=(0,w.RandomRange)(X.minLifeTime,X.maxLifeTime),X._emitPower=(0,w.RandomRange)(X.minEmitPower,X.maxEmitPower)}function Cb(b,X){0===X._emitPower?(b._initialDirection?b._initialDirection.N(b.direction):b._initialDirection=b.direction.clone(),b.direction.set(0,0,0)):(b._initialDirection=null,b.direction.scaleInPlace(X._emitPower)),b.direction.addInPlace(X._inheritedVelocityOffset)}function pb(b,X){b.angularSpeed=(0,w.RandomRange)(X.minAngularSpeed,X.maxAngularSpeed),b.angle=(0,w.RandomRange)(X.minInitialRotation,X.maxInitialRotation)}function kb(b,X){b._currentAngularSpeedGradient=X._angularSpeedGradients[0],b.angularSpeed=b._currentAngularSpeedGradient.getFactor(),b._currentAngularSpeed1=b.angularSpeed,X._angularSpeedGradients.length>1?b._currentAngularSpeed2=X._angularSpeedGradients[1].getFactor():b._currentAngularSpeed2=b._currentAngularSpeed1,b.angle=(0,w.RandomRange)(X.minInitialRotation,X.maxInitialRotation)}function zb(b,X){b._initialStartSpriteCellId=X.startSpriteCellID,b._initialEndSpriteCellId=X.endSpriteCellID,b._initialSpriteCellLoop=X.spriteCellLoop}function Ub(b,X){b.previousItem=X.previousItem,b.nextItem=X,X.previousItem&&(X.previousItem.nextItem=b),X.previousItem=b}function gb(b,X){b.previousItem=X,b.nextItem=X.nextItem,X.nextItem&&(X.nextItem.previousItem=b),X.nextItem=b}function jb(b,X){let P=X;for(;P.nextItem;)P=P.nextItem;b.previousItem=P,b.nextItem=P.nextItem,P.nextItem=b}function lb(b){b.previousItem&&(b.previousItem.nextItem=b.nextItem),b.nextItem&&(b.nextItem.previousItem=b.previousItem)}class Jb extends u{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(b){this._startDirectionFunction!==b&&(this._startDirectionFunction=b,this._directionProcessing.process=b?Ob:fb)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(b){this._startPositionFunction!==b&&(this._startPositionFunction=b,this._positionCreation.process=b?Wb:Bb)}set onDispose(b){this._onDisposeObserver&&this.Nd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Nd.add(b)}get Y(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(b){this._useRampGradients!==b&&(this._useRampGradients=b,this._resetEffect(),b?(this._rampCreation={process:Vb,previousItem:null,nextItem:null},gb(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:ib,previousItem:null,nextItem:null},gb(this._remapGradientProcessing,this._gravityProcessing)):(lb(this._rampCreation),lb(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(b){this._isLocal!==b&&(this._isLocal=b,b?(this._isLocalCreation={process:nb,previousItem:null,nextItem:null},gb(this._isLocalCreation,this._positionCreation)):lb(this._isLocalCreation))}get particles(){return this.De}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(b){this._animationSheetEnabled!==b&&(this._animationSheetEnabled=b,b?(this._sheetCreation={process:zb,previousItem:null,nextItem:null},gb(this._sheetCreation,this._colorCreation)):lb(this._sheetCreation),this._reset())}getActiveCount(){return this.De.length}getClassName(){return"mf"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var b;let X=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(b=this._customWrappers[X])||void 0===b?void 0:b.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[b]??this._customWrappers[0]}setCustomEffect(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[X]=new bb.b(this._engine),this._customWrappers[X].effect=b,this._customWrappers[X].drawContext&&(this._customWrappers[X].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new r.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(b){if(this.noiseTexture!==b){if(this._noiseTexture=b,!b)return lb(this._noiseCreation),void lb(this._noiseProcessing);this._noiseCreation={process:Zb,previousItem:null,nextItem:null},gb(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:vb,previousItem:null,nextItem:null},gb(this._noiseProcessing,this._positionProcessing)}}constructor(b,X,P){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(b),this._emitterInverseWorldMatrix=Q.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new Q.tX,this.Nd=new r.d,this.onStoppedObservable=new r.d,this.onStartedObservable=new r.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.De=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new N.Ba(0,0,0,0),this._colorDiff=new N.Ba(0,0,0,0),this._scaledDirection=Q.tX.Zero(),this._scaledGravity=Q.tX.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=b=>{},this.recycleParticle=b=>{const X=this.De.pop();X!==b&&X.copyTo(b),this._stockParticles.push(X)},this._createParticle=()=>{let b;return 0!==this._stockParticles.length?(b=this._stockParticles.pop(),b._reset()):b=new mb(this),this._prepareParticle(b),b},this.paused=!1,this._shadersLoaded=!1,this._capacity=X,this._epsilon=a,P&&"Scene"!==P.getClassName()?(this._engine=P,this.defaultProjectionMatrix=Q.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=P||G.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Oe.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Hb,previousItem:null,nextItem:null},this._positionCreation={process:Bb,previousItem:null,nextItem:null},gb(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:fb,previousItem:null,nextItem:null},gb(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Cb,previousItem:null,nextItem:null},gb(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:ob,previousItem:null,nextItem:null},gb(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:pb,previousItem:null,nextItem:null},gb(this._angleCreation,this._sizeCreation),this._colorCreation={process:Sb,previousItem:null,nextItem:null},gb(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,u||(this._colorProcessing={process:ab,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:wb,previousItem:null,nextItem:null},gb(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:tb,previousItem:null,nextItem:null},gb(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:yb,previousItem:null,nextItem:null},gb(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Ab,previousItem:null,nextItem:null},gb(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=d,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new bb.b(this._engine)},this._customWrappers[0].effect=S,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new O,this.updateFunction=b=>{var X;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(X=this.noiseTexture.getContent())||void 0===X||X.then((b=>{this._noiseTextureData=b})));const P=b===this.De;for(let Q=0;Q<b.length;Q++){const X=b[Q];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const S=X.age;if(X.age+=this._tempScaledUpdateSpeed,X.age>X.lifeTime){const b=X.age-S,P=X.lifeTime-S;this._tempScaledUpdateSpeed=P*this._tempScaledUpdateSpeed/b,X.age=X.lifeTime}this._ratio=X.age/X.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let d=this._updateQueueStart;for(;d;)d.process(X,this),d=d.nextItem;if(this._isAnimationSheetEnabled&&!u&&X.updateCellIndex(),X._inheritParticleInfoToSubEmitters(),X.age>=X.lifeTime){if(this._emitFromParticle(X),X._attachedSubEmitters){for(const b of X._attachedSubEmitters)b.particleSystem.disposeOnStop=!0,b.particleSystem.stop();X._attachedSubEmitters=null}this.recycleParticle(X),P&&Q--}else;}}}serialize(b){throw new Error("Method not implemented.")}clone(b,X){throw new Error("Method not implemented.")}_addFactorGradient(b,X,P,Q){const S=new M(X,P,Q);b.push(S),b.sort(((b,X)=>b.gradient<X.gradient?-1:b.gradient>X.gradient?1:0))}_removeFactorGradient(b,X){if(!b)return;let P=0;for(const Q of b){if(Q.gradient===X){b.splice(P,1);break}P++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=xb:this._lifeTimeCreation.process=Hb}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Tb,previousItem:null,nextItem:null},gb(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(lb(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(b){this.targetStopDuration!==b&&(this._targetStopDuration=b,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(b,X,P){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,b,X,P),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(b){return this._removeFactorGradient(this._lifeTimeGradients,b),this._syncLifeTimeCreation(),this}addSizeGradient(b,X,P){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Kb,this._sizeGradientProcessing={process:qb,previousItem:null,nextItem:null},Ub(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,b,X,P),this}removeSizeGradient(b){var X;return this._removeFactorGradient(this._sizeGradients,b),0===(null===(X=this._sizeGradients)||void 0===X?void 0:X.length)&&(lb(this._sizeGradientProcessing),this._sizeCreation.process=ob),this}addColorRemapGradient(b,X,P){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,b,X,P),this}removeColorRemapGradient(b){return this._removeFactorGradient(this._colorRemapGradients,b),this}addAlphaRemapGradient(b,X,P){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,b,X,P),this}removeAlphaRemapGradient(b){return this._removeFactorGradient(this._alphaRemapGradients,b),this}addAngularSpeedGradient(b,X,P){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=kb,this._angularSpeedGradientProcessing={process:ub,previousItem:null,nextItem:null},Ub(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,b,X,P),this}removeAngularSpeedGradient(b){var X;return this._removeFactorGradient(this._angularSpeedGradients,b),0===(null===(X=this._angularSpeedGradients)||void 0===X?void 0:X.length)&&(this._angleCreation.process=pb,lb(this._angularSpeedGradientProcessing)),this}addVelocityGradient(b,X,P){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:eb,previousItem:null,nextItem:null},gb(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Db,previousItem:null,nextItem:null},Ub(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,b,X,P),this}removeVelocityGradient(b){var X;return this._removeFactorGradient(this._velocityGradients,b),0===(null===(X=this._velocityGradients)||void 0===X?void 0:X.length)&&(lb(this._velocityCreation),lb(this._velocityGradientProcessing)),this}addLimitVelocityGradient(b,X,P){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Yb,previousItem:null,nextItem:null},gb(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Eb,previousItem:null,nextItem:null},gb(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,b,X,P),this}removeLimitVelocityGradient(b){var X;return this._removeFactorGradient(this._limitVelocityGradients,b),0===(null===(X=this._limitVelocityGradients)||void 0===X?void 0:X.length)&&(lb(this._limitVelocityCreation),lb(this._limitVelocityGradientProcessing)),this}addDragGradient(b,X,P){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:hb,previousItem:null,nextItem:null},Ub(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Lb,previousItem:null,nextItem:null},Ub(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,b,X,P),this}removeDragGradient(b){var X;return this._removeFactorGradient(this._dragGradients,b),0===(null===(X=this._dragGradients)||void 0===X?void 0:X.length)&&(lb(this._dragCreation),lb(this._dragGradientProcessing)),this}addEmitRateGradient(b,X,P){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,b,X,P),this}removeEmitRateGradient(b){return this._removeFactorGradient(this._emitRateGradients,b),this}addStartSizeGradient(b,X,P){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,b,X,P),this._syncStartSizeCreation(),this}removeStartSizeGradient(b){return this._removeFactorGradient(this._startSizeGradients,b),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const b=new Uint8Array(4*this._rawTextureWidth),X=N.TmpColors.yX[0];for(let P=0;P<this._rawTextureWidth;P++){const Q=P/this._rawTextureWidth;R.GetCurrentGradient(Q,this._rampGradients,((Q,S,d)=>{N.yX.LerpToRef(Q.color,S.color,d,X),b[4*P]=255*X.r,b[4*P+1]=255*X.g,b[4*P+2]=255*X.b,b[4*P+3]=255}))}this._rampGradientsTexture=I.d.CreateRGBATexture(b,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((b,X)=>b.gradient<X.gradient?-1:b.gradient>X.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(b,X){this._rampGradients||(this._rampGradients=[]);const P=new F(b,X);return this._rampGradients.push(P),this._syncRampGradientTexture(),this}removeRampGradient(b){return this._removeGradientAndTexture(b,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(b,X,P){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=db,this._colorProcessing.process=Nb);const Q=new s(b,X,P);return this._colorGradients.push(Q),this._colorGradients.sort(((b,X)=>b.gradient<X.gradient?-1:b.gradient>X.gradient?1:0)),this}removeColorGradient(b){if(!this._colorGradients)return this;let X=0;for(const P of this._colorGradients){if(P.gradient===b){this._colorGradients.splice(X,1);break}X++}return 0===this._colorGradients.length&&(this._colorCreation.process=Sb,this._colorProcessing.process=ab),this}resetDrawCache(){if(this._drawWrappers){for(const b of this._drawWrappers)if(b)for(const X of b)null===X||void 0===X||X.dispose();this._drawWrappers=[]}}_fetchR(b,X,P,Q,S){return S[4*(((b=.5*Math.abs(b)+.5)*P%P|0)+((X=.5*Math.abs(X)+.5)*Q%Q|0)*P)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const b=this._engine,X=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*X),this._vertexBuffer=new h.c(b,this._vertexData,!0,X);let P=0;const Q=this._vertexBuffer.createVertexBuffer(h.g.PositionKind,P,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[h.g.PositionKind]=Q,P+=3;const S=this._vertexBuffer.createVertexBuffer(h.g.ColorKind,P,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[h.g.ColorKind]=S,P+=4;const d=this._vertexBuffer.createVertexBuffer("angle",P,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=d,P+=1;const N=this._vertexBuffer.createVertexBuffer("size",P,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=N,P+=2,this._isAnimationSheetEnabled){const b=this._vertexBuffer.createVertexBuffer("cellIndex",P,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=b,P+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const b=this._vertexBuffer.createVertexBuffer("direction",P,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=b,P+=3}if(this._useRampGradients){const b=this._vertexBuffer.createVertexBuffer("remapData",P,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=b,P+=4}let a;if(this._useInstancing){const X=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new h.c(b,X,!1,2),a=this._spriteBuffer.createVertexBuffer("offset",0,2)}else a=this._vertexBuffer.createVertexBuffer("offset",P,2,this._vertexBufferSize,this._useInstancing),P+=2;this._vertexBuffers.offset=a,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const b=[],X=[];let P=0;for(let Q=0;Q<this._capacity;Q++)b.push(P),b.push(P+1),b.push(P+2),b.push(P),b.push(P+2),b.push(P+3),X.push(P,P+1,P+1,P+2,P+2,P+3,P+3,P,P,P+3),P+=4;this._indexBuffer=this._engine.createIndexBuffer(b),this._linesIndexBuffer=this._engine.createIndexBuffer(X)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(b)setTimeout((()=>{this.start(0)}),b);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var X;-1!==(null===(X=this.dX)||void 0===X?void 0:X.getClassName().indexOf("Mesh"))&&this.dX.pd(!0);const b=this.noiseTexture;if(b&&b.onGeneratedObservable)b.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let X=0;X<this.preWarmCycles;X++)this.animate(!0),b.render()}))}));else for(let X=0;X<this.preWarmCycles;X++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(b))}_postStop(b){}reset(){this._stockParticles.length=0,this.De.length=0}_appendParticleVertex(b,X,P,S){let d=b*this._vertexBufferSize;if(this._vertexData[d++]=X.position.x+this.aw.x,this._vertexData[d++]=X.position.y+this.aw.y,this._vertexData[d++]=X.position.z+this.aw.z,this._vertexData[d++]=X.color.r,this._vertexData[d++]=X.color.g,this._vertexData[d++]=X.color.b,this._vertexData[d++]=X.color.a,this._vertexData[d++]=X.angle,this._vertexData[d++]=X.scale.x*X.size,this._vertexData[d++]=X.scale.y*X.size,this._isAnimationSheetEnabled&&(this._vertexData[d++]=X.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[d++]=X.direction.x,this._vertexData[d++]=X.direction.y,this._vertexData[d++]=X.direction.z);else if(X._initialDirection){let b=X._initialDirection;this.isLocal&&(Q.tX.TransformNormalToRef(b,this._emitterWorldMatrix,Q.TmpVectors.tX[0]),b=Q.TmpVectors.tX[0]),0===b.x&&0===b.z&&(b.x=.001),this._vertexData[d++]=b.x,this._vertexData[d++]=b.y,this._vertexData[d++]=b.z}else{let b=X.direction;this.isLocal&&(Q.tX.TransformNormalToRef(b,this._emitterWorldMatrix,Q.TmpVectors.tX[0]),b=Q.TmpVectors.tX[0]),0===b.x&&0===b.z&&(b.x=.001),this._vertexData[d++]=b.x,this._vertexData[d++]=b.y,this._vertexData[d++]=b.z}this._useRampGradients&&X.remapData&&(this._vertexData[d++]=X.remapData.x,this._vertexData[d++]=X.remapData.y,this._vertexData[d++]=X.remapData.z,this._vertexData[d++]=X.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===P?P=this._epsilon:1===P&&(P=1-this._epsilon),0===S?S=this._epsilon:1===S&&(S=1-this._epsilon)),this._vertexData[d++]=P,this._vertexData[d++]=S)}_prepareParticle(b){}_createNewOnes(b){let X;for(let P=0;P<b&&this.De.length!==this._capacity;P++){X=this._createParticle(),this.De.push(X);let b=this._createQueueStart;for(;b;)b.process(X,this),b=b.nextItem;X._inheritParticleInfoToSubEmitters()}}_update(b){if(this._alive=this.De.length>0,this.dX.position){const b=this.dX;this._emitterWorldMatrix=b.getWorldMatrix()}else{const b=this.dX;this._emitterWorldMatrix=Q.Matrix.Translation(b.x,b.y,b.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.De),this._createNewOnes(b)}static _GetAttributeNamesOrOptions(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=[h.g.PositionKind,h.g.ColorKind,"angle","offset","size"];return b&&Q.push("cellIndex"),X||Q.push("direction"),P&&Q.push("remapData"),Q}static _GetEffectCreationOptions(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Xb.e)(Q),b&&Q.push("particlesInfos"),X&&Q.push("logarithmicDepthConstant"),P&&(Q.push("vFogInfos"),Q.push("vFogColor")),Q}fillDefines(b,X){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Xb.m)(this,this._scene,b),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&b.push("#define FOG")),this._isAnimationSheetEnabled&&b.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&b.push("#define LOGARITHMICDEPTH"),X===u.BLENDMODE_MULTIPLY&&b.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&b.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(b.push("#define BILLBOARD"),this.billboardMode){case 2:b.push("#define BILLBOARDY");break;case 8:case 9:b.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&b.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:b.push("#define BILLBOARDMODE_ALL")}P&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),b.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(b,X,P){X.push(...Jb._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),b.push(...Jb._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),P.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Qb.e)(b,this._imageProcessingConfigurationDefines),(0,Qb.d)(P,this._imageProcessingConfigurationDefines))}_getWrapper(b){const X=this._getCustomDrawWrapper(b);if(null!==X&&void 0!==X&&X.effect)return X;const P=[];this.fillDefines(P,b);const Q=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let S=this._drawWrappers[Q];S||(S=this._drawWrappers[Q]=[]);let d=S[b];d||(d=new bb.b(this._engine),d.drawContext&&(d.drawContext.useInstancing=this._useInstancing),S[b]=d);const N=P.join("\n");if(d.defines!==N){const b=[],X=[],P=[];this.fillUniformsAttributesAndSamplerNames(X,b,P),d.setEffect(this._engine.createEffect("particles",b,X,P,N,void 0,void 0,void 0,void 0,this._shaderLanguage),N)}return d}animate(){var b;let X,P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!P&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(P?this.preWarmStepOffset:(null===(b=this._scene)||void 0===b?void 0:b.getAnimationRatio())||1),this.manualEmitCount>-1)X=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let b=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const X=this._actualFrame/this.targetStopDuration;R.GetCurrentGradient(X,this._emitRateGradients,((X,P,Q)=>{X!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=P.getFactor(),this._currentEmitRateGradient=X),b=(0,w.Lerp)(this._currentEmitRate1,this._currentEmitRate2,Q)}))}X=b*this._scaledUpdateSpeed|0,this._newPartsExcess+=b*this._scaledUpdateSpeed-X}if(this._newPartsExcess>1&&(X+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?X=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(X),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!P){let b=0;for(let X=0;X<this.De.length;X++){const P=this.De[X];this._appendParticleVertices(b,P),b+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.De.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(b,X){this._appendParticleVertex(b++,X,0,0),this._useInstancing||(this._appendParticleVertex(b++,X,1,0),this._appendParticleVertex(b++,X,1,1),this._appendParticleVertex(b++,X,0,1))}rebuild(){var b;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(b=this._spriteBuffer)||void 0===b||b._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Jb.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(P.bind(P,13410)),Promise.resolve().then(P.bind(P,13356))])):await Promise.all([Promise.resolve().then(P.bind(P,13344)),Promise.resolve().then(P.bind(P,13330))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.dX||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==u.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(u.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(u.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(b){const X=this._getWrapper(b),P=X.effect,S=this._engine;S.enableEffect(X);const d=this.defaultViewMatrix??this._scene.getViewMatrix();if(P.setTexture("diffuseSampler",this.particleTexture),P.setMatrix("view",d),P.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const b=this.particleTexture.getBaseSize();P.setFloat3("particlesInfos",this.spriteCellWidth/b.width,this.spriteCellHeight/b.height,this.spriteCellWidth/b.width)}if(P.setVector2("translationPivot",this.translationPivot),P.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const b=this._scene.activeCamera;P.setVector3("eyePosition",b.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),P.setTexture("rampSampler",this._rampGradientsTexture));const N=P.defines;var a,u,w,f,O,e;(this._scene&&((0,Xb.i)(P,this,this._scene),this.applyFog&&(0,Pb.g)(this._scene,void 0,P)),N.indexOf("#define BILLBOARDMODE_ALL")>=0&&(d.invertToRef(Q.TmpVectors.Matrix[0]),P.setMatrix("invView",Q.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?S.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,P):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,P)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?S.bindBuffers(this._vertexBuffers,null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?this._linesIndexBuffer:this._indexBuffer,P):S.bindBuffers(this._vertexBuffers,null!==(f=this._scene)&&void 0!==f&&f.forceWireframe?this._linesIndexBufferUseInstancing:null,P);(this.useLogarithmicDepth&&this._scene&&(0,Pb.k)(N,P,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(P),this._setEngineBasedOnBlendMode(b),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(P),this._useInstancing)?null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?S.drawElementsType(6,0,10,this.De.length):S.drawArraysType(7,0,4,this.De.length):null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?S.drawElementsType(1,0,10*this.De.length):S.drawElementsType(0,0,6*this.De.length);return this.De.length}render(){if(!this.isReady()||!this.De.length)return 0;const b=this._engine;b.setState&&(b.setState(!1),this.forceDepthWrite&&b.setDepthWrite(!0));let X=0;return X=this.blendMode===u.BLENDMODE_MULTIPLYADD?this._render(u.BLENDMODE_MULTIPLY)+this._render(u.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),X}_onDispose(){}dispose(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),b&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),b&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(X,P),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const b=this._scene.Oe.indexOf(this);b>-1&&this._scene.Oe.splice(b,1),this._scene._activeParticleSystems.dispose()}this.Nd.notifyObservers(this),this.Nd.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Jb.ForceGLSL=!1;var cb,sb=P(11719);!function(b){b[b.ATTACHED=0]="ATTACHED",b[b.END=1]="END"}(cb||(cb={}));class Fb{constructor(b){if(this.particleSystem=b,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!b.dX||!b.dX.dispose){const X=(0,a.d)("BABYLON.AbstractMesh");b.dX=new X("SubemitterSystemEmitter",b.Ab()),b._disposeEmitterOnDispose=!0}}clone(){let b=this.particleSystem.dX;if(b){if(b instanceof Q.tX)b=b.clone();else if(-1!==b.getClassName().indexOf("Mesh")){b=new((0,a.d)("BABYLON.Mesh"))("",b.Ab()),b.isVisible=!1}}else b=new Q.tX;const X=new Fb(this.particleSystem.clone(this.particleSystem.name,b));return X.particleSystem.name+="Clone",X.type=this.type,X.inheritDirection=this.inheritDirection,X.inheritedVelocityAmount=this.inheritedVelocityAmount,X.particleSystem._disposeEmitterOnDispose=!0,X.particleSystem.disposeOnStop=!0,X}serialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};return X.type=this.type,X.inheritDirection=this.inheritDirection,X.inheritedVelocityAmount=this.inheritedVelocityAmount,X.particleSystem=this.particleSystem.serialize(b),X}static _ParseParticleSystem(b,X,P){throw(0,sb.b)("ParseParticle")}static Parse(b,X,P){const Q=b.particleSystem,S=new Fb(Fb._ParseParticleSystem(Q,X,P,!0));return S.type=b.type,S.inheritDirection=b.inheritDirection,S.inheritedVelocityAmount=b.inheritedVelocityAmount,S.particleSystem._isSubEmitter=!0,S}dispose(){this.particleSystem.dispose()}}var Mb=P(11760);function Rb(b,X){const P=new B;return P.direction1=b,P.direction2=X,P}function rb(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Ib(){return new W(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Gb(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.tX(0,1,0),P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.tX(0,1,0);return new n(b,X,P)}function mX(){return new D(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function bX(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.tX(0,1,0),d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.tX(0,1,0);return new E(b,X,P,S,d)}function XX(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new e(b,X)}function PX(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.tX(0,1,0),S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.tX(0,1,0);return new Y(b,X,P,S)}const QX=Q.tX.Zero(),SX=Q.tX.Zero(),dX=Q.tX.Zero();class NX{constructor(){this.strength=0,this.position=Q.tX.Zero()}_processParticle(b,X){this.position.subtractToRef(b.position,QX);const P=QX.lengthSquared()+1;QX.normalize().scaleToRef(this.strength/P,SX),SX.scaleToRef(X._tempScaledUpdateSpeed,dX),b.direction.addInPlace(dX)}serialize(){return{position:this.position.Zd(),strength:this.strength}}}class aX extends Jb{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=b=>{if(!this._subEmitters||0===this._subEmitters.length)return;const X=Math.floor(Math.random()*this._subEmitters.length);for(const P of this._subEmitters[X])if(1===P.type){const X=P.clone();b._inheritParticleInfoToSubEmitter(X),X.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(X.particleSystem),X.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(b,X){const P=Rb(b,X);return this.particleEmitterType=P,P}get flowMap(){return this._flowMap}set flowMap(b){this._flowMap!==b&&(this._flowMap=b,this._flowMapUpdate&&(lb(this._flowMapUpdate),this._flowMapUpdate=null),b&&(this._flowMapUpdate={process:b=>{var X;const P=null===(X=this.Ab())||void 0===X?void 0:X.getTransformMatrix();this._flowMap._processParticle(b,this.flowMapStrength*this._tempScaledUpdateSpeed,P)},previousItem:null,nextItem:null},gb(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(b){this._attractors.push(b),1===this._attractors.length&&(this._attractorUpdate={process:b=>{for(const X of this._attractors)X._processParticle(b,this)},previousItem:null,nextItem:null},gb(this._attractorUpdate,this._directionProcessing))}removeAttractor(b){const X=this._attractors.indexOf(b);-1!==X&&this._attractors.splice(X,1),0===this._attractors.length&&lb(this._attractorUpdate)}start(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(b)}createHemisphericEmitter(){const b=rb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=b,b}createSphereEmitter(){const b=Ib(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=b,b}createDirectedSphereEmitter(){const b=Gb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.tX(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.tX(0,1,0));return this.particleEmitterType=b,b}createCylinderEmitter(){const b=mX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=b,b}createDirectedCylinderEmitter(){const b=bX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.tX(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.tX(0,1,0));return this.particleEmitterType=b,b}createConeEmitter(){const b=XX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=b,b}createDirectedConeEmitter(){const b=PX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.tX(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.tX(0,1,0));return this.particleEmitterType=b,b}createBoxEmitter(b,X,P,Q){const S=new O;return this.particleEmitterType=S,this.direction1=b,this.direction2=X,this.minEmitBox=P,this.maxEmitBox=Q,S}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const b of this.subEmitters)b instanceof aX?this._subEmitters.push([new Fb(b)]):b instanceof Fb?this._subEmitters.push([b]):b instanceof Array&&this._subEmitters.push(b)}_stopSubEmitters(){if(this.activeSubSystems){for(const b of this.activeSubSystems)b.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const b=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==b&&this._rootParticleSystem.activeSubSystems.splice(b,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(b){b&&this._stopSubEmitters()}_prepareParticle(b){if(this._subEmitters&&this._subEmitters.length>0){const X=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];b._attachedSubEmitters=[];for(const P of X)if(0===P.type){const X=P.clone();b._attachedSubEmitters.push(X),X.particleSystem.start()}}}_onDispose(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),b&&this.particles)for(const P of this.particles)if(P._attachedSubEmitters)for(let b=P._attachedSubEmitters.length-1;b>=0;b-=1)P._attachedSubEmitters[b].dispose();if(X&&this.activeSubSystems)for(let P=this.activeSubSystems.length-1;P>=0;P-=1)this.activeSubSystems[P].dispose();if(this._subEmitters&&this._subEmitters.length){for(let b=0;b<this._subEmitters.length;b++)for(const X of this._subEmitters[b])X.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.dX&&this.dX.dispose&&this.dX.dispose(!0)}static _Parse(b,X,P,S){let d;d=P instanceof Mb.c?null:P;const u=(0,a.d)("BABYLON.Texture");if(u&&d&&(b.texture?X.particleTexture=u.Parse(b.texture,d,S):b.textureName&&(X.particleTexture=new u(S+b.textureName,d,!1,void 0===b.invertY||b.invertY),X.particleTexture.name=b.textureName)),b.emitterId||0===b.emitterId||void 0!==b.dX?b.emitterId&&d?X.dX=d.getLastMeshById(b.emitterId):X.dX=Q.tX.hX(b.dX):X.dX=Q.tX.Zero(),X.isLocal=!!b.isLocal,void 0!==b.renderingGroupId&&(X.renderingGroupId=b.renderingGroupId),void 0!==b.isBillboardBased&&(X.isBillboardBased=b.isBillboardBased),void 0!==b.billboardMode&&(X.billboardMode=b.billboardMode),void 0!==b.useLogarithmicDepth&&(X.useLogarithmicDepth=b.useLogarithmicDepth),b.animations){for(let P=0;P<b.animations.length;P++){const Q=b.animations[P],S=(0,a.d)("BABYLON.Animation");S&&X.animations.push(S.Parse(Q))}X.beginAnimationOnStart=b.beginAnimationOnStart,X.beginAnimationFrom=b.beginAnimationFrom,X.beginAnimationTo=b.beginAnimationTo,X.beginAnimationLoop=b.beginAnimationLoop}if(b.autoAnimate&&d&&d.beginAnimation(X,b.autoAnimateFrom,b.autoAnimateTo,b.autoAnimateLoop,b.autoAnimateSpeed||1),X.startDelay=0|b.startDelay,X.minAngularSpeed=b.minAngularSpeed,X.maxAngularSpeed=b.maxAngularSpeed,X.minSize=b.minSize,X.maxSize=b.maxSize,b.minScaleX&&(X.minScaleX=b.minScaleX,X.maxScaleX=b.maxScaleX,X.minScaleY=b.minScaleY,X.maxScaleY=b.maxScaleY),void 0!==b.preWarmCycles&&(X.preWarmCycles=b.preWarmCycles,X.preWarmStepOffset=b.preWarmStepOffset),void 0!==b.minInitialRotation&&(X.minInitialRotation=b.minInitialRotation,X.maxInitialRotation=b.maxInitialRotation),X.minLifeTime=b.minLifeTime,X.maxLifeTime=b.maxLifeTime,X.minEmitPower=b.minEmitPower,X.maxEmitPower=b.maxEmitPower,X.emitRate=b.emitRate,X.gravity=Q.tX.hX(b.gravity),b.noiseStrength&&(X.noiseStrength=Q.tX.hX(b.noiseStrength)),X.color1=N.Ba.hX(b.color1),X.color2=N.Ba.hX(b.color2),X.colorDead=N.Ba.hX(b.colorDead),X.updateSpeed=b.updateSpeed,X.targetStopDuration=b.targetStopDuration,X.blendMode=b.blendMode,b.colorGradients)for(const Q of b.colorGradients)X.addColorGradient(Q.gradient,N.Ba.hX(Q.color1),Q.color2?N.Ba.hX(Q.color2):void 0);if(b.rampGradients){for(const P of b.rampGradients)X.addRampGradient(P.gradient,N.yX.hX(P.color));X.useRampGradients=b.useRampGradients}if(b.colorRemapGradients)for(const Q of b.colorRemapGradients)X.addColorRemapGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(b.alphaRemapGradients)for(const Q of b.alphaRemapGradients)X.addAlphaRemapGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(b.sizeGradients)for(const Q of b.sizeGradients)X.addSizeGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(b.angularSpeedGradients)for(const Q of b.angularSpeedGradients)X.addAngularSpeedGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(b.velocityGradients)for(const Q of b.velocityGradients)X.addVelocityGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(b.dragGradients)for(const Q of b.dragGradients)X.addDragGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(b.emitRateGradients)for(const Q of b.emitRateGradients)X.addEmitRateGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(b.startSizeGradients)for(const Q of b.startSizeGradients)X.addStartSizeGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(b.lifeTimeGradients)for(const Q of b.lifeTimeGradients)X.addLifeTimeGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(b.limitVelocityGradients){for(const P of b.limitVelocityGradients)X.addLimitVelocityGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);X.limitVelocityDamping=b.limitVelocityDamping}if(b.noiseTexture&&d){const P=(0,a.d)("BABYLON.ProceduralTexture");X.noiseTexture=P.Parse(b.noiseTexture,d,S)}let w;if(b.particleEmitterType){switch(b.particleEmitterType.type){case"SphereParticleEmitter":w=new W;break;case"SphereDirectedParticleEmitter":w=new n;break;case"ConeEmitter":case"ConeParticleEmitter":w=new e;break;case"ConeDirectedParticleEmitter":w=new Y;break;case"CylinderParticleEmitter":w=new D;break;case"CylinderDirectedParticleEmitter":w=new E;break;case"HemisphericParticleEmitter":w=new t;break;case"PointParticleEmitter":w=new B;break;case"MeshParticleEmitter":w=new L;break;case"CustomParticleEmitter":w=new y;break;default:w=new O}w.parse(b.particleEmitterType,d)}else w=new O,w.parse(b,d);X.particleEmitterType=w,X.startSpriteCellID=b.startSpriteCellID,X.endSpriteCellID=b.endSpriteCellID,X.spriteCellLoop=b.spriteCellLoop??!0,X.spriteCellWidth=b.spriteCellWidth,X.spriteCellHeight=b.spriteCellHeight,X.spriteCellChangeSpeed=b.spriteCellChangeSpeed,X.spriteRandomStartCell=b.spriteRandomStartCell,X.disposeOnStop=b.disposeOnStop??!1,X.manualEmitCount=b.manualEmitCount??-1}static Parse(b,X,P){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4?arguments[4]:void 0;const a=b.name;let u,w,f=null,O=null;if(X instanceof Mb.c?u=X:(w=X,u=w.getEngine()),b.customShader&&u.createEffectForParticles){O=b.customShader;const X=O.shaderOptions.defines.length>0?O.shaderOptions.defines.join("\n"):"";f=u.createEffectForParticles(O.shaderPath.fragmentElement,O.shaderOptions.uniforms,O.shaderOptions.samplers,X)}const e=new aX(a,d||b.zX,X,f,b.isAnimationSheetEnabled);if(e.customShader=O,e._rootUrl=P,b.id&&(e.id=b.id),b.subEmitters){e.subEmitters=[];for(const Q of b.subEmitters){const b=[];for(const S of Q)b.push(Fb.Parse(S,X,P));e.subEmitters.push(b)}}if(b.attractors)for(const N of b.attractors){const b=new NX;b.position=Q.tX.hX(N.position),b.strength=N.strength,e.addAttractor(b)}return aX._Parse(b,e,X,P),b.textureMask&&(e.textureMask=N.Ba.hX(b.textureMask)),b.aw&&(e.aw=Q.tX.hX(b.aw)),b.preventAutoStart&&(e.preventAutoStart=b.preventAutoStart),S||e.preventAutoStart||e.start(),e}serialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};if(aX._Serialize(X,this,b),X.textureMask=this.textureMask.Zd(),X.customShader=this.customShader,X.preventAutoStart=this.preventAutoStart,X.aw=this.aw.Zd(),this.subEmitters){X.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const P of this._subEmitters){const Q=[];for(const X of P)Q.push(X.serialize(b));X.subEmitters.push(Q)}}if(this._attractors&&this._attractors.length){X.attractors=[];for(const b of this._attractors)X.attractors.push(b.serialize())}return X}static _Serialize(b,X,P){if(b.name=X.name,b.id=X.id,b.zX=X.getCapacity(),b.disposeOnStop=X.disposeOnStop,b.manualEmitCount=X.manualEmitCount,X.dX.position){const P=X.dX;b.emitterId=P.id}else{const P=X.dX;b.dX=P.Zd()}X.particleEmitterType&&(b.particleEmitterType=X.particleEmitterType.serialize()),X.particleTexture&&(P?b.texture=X.particleTexture.serialize():(b.textureName=X.particleTexture.name,b.invertY=!!X.particleTexture._invertY)),b.isLocal=X.isLocal,x.b.AppendSerializedAnimations(X,b),b.beginAnimationOnStart=X.beginAnimationOnStart,b.beginAnimationFrom=X.beginAnimationFrom,b.beginAnimationTo=X.beginAnimationTo,b.beginAnimationLoop=X.beginAnimationLoop,b.startDelay=X.startDelay,b.renderingGroupId=X.renderingGroupId,b.isBillboardBased=X.isBillboardBased,b.billboardMode=X.billboardMode,b.minAngularSpeed=X.minAngularSpeed,b.maxAngularSpeed=X.maxAngularSpeed,b.minSize=X.minSize,b.maxSize=X.maxSize,b.minScaleX=X.minScaleX,b.maxScaleX=X.maxScaleX,b.minScaleY=X.minScaleY,b.maxScaleY=X.maxScaleY,b.minEmitPower=X.minEmitPower,b.maxEmitPower=X.maxEmitPower,b.minLifeTime=X.minLifeTime,b.maxLifeTime=X.maxLifeTime,b.emitRate=X.emitRate,b.gravity=X.gravity.Zd(),b.noiseStrength=X.noiseStrength.Zd(),b.color1=X.color1.Zd(),b.color2=X.color2.Zd(),b.colorDead=X.colorDead.Zd(),b.updateSpeed=X.updateSpeed,b.targetStopDuration=X.targetStopDuration,b.blendMode=X.blendMode,b.preWarmCycles=X.preWarmCycles,b.preWarmStepOffset=X.preWarmStepOffset,b.minInitialRotation=X.minInitialRotation,b.maxInitialRotation=X.maxInitialRotation,b.startSpriteCellID=X.startSpriteCellID,b.spriteCellLoop=X.spriteCellLoop,b.endSpriteCellID=X.endSpriteCellID,b.spriteCellChangeSpeed=X.spriteCellChangeSpeed,b.spriteCellWidth=X.spriteCellWidth,b.spriteCellHeight=X.spriteCellHeight,b.spriteRandomStartCell=X.spriteRandomStartCell,b.isAnimationSheetEnabled=X.isAnimationSheetEnabled,b.useLogarithmicDepth=X.useLogarithmicDepth;const Q=X.getColorGradients();if(Q){b.colorGradients=[];for(const X of Q){const P={gradient:X.gradient,color1:X.color1.Zd()};X.color2?P.color2=X.color2.Zd():P.color2=X.color1.Zd(),b.colorGradients.push(P)}}const S=X.getRampGradients();if(S){b.rampGradients=[];for(const X of S){const P={gradient:X.gradient,color:X.color.Zd()};b.rampGradients.push(P)}b.useRampGradients=X.useRampGradients}const d=X.getColorRemapGradients();if(d){b.colorRemapGradients=[];for(const X of d){const P={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?P.factor2=X.factor2:P.factor2=X.factor1,b.colorRemapGradients.push(P)}}const N=X.getAlphaRemapGradients();if(N){b.alphaRemapGradients=[];for(const X of N){const P={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?P.factor2=X.factor2:P.factor2=X.factor1,b.alphaRemapGradients.push(P)}}const a=X.getSizeGradients();if(a){b.sizeGradients=[];for(const X of a){const P={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?P.factor2=X.factor2:P.factor2=X.factor1,b.sizeGradients.push(P)}}const u=X.getAngularSpeedGradients();if(u){b.angularSpeedGradients=[];for(const X of u){const P={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?P.factor2=X.factor2:P.factor2=X.factor1,b.angularSpeedGradients.push(P)}}const w=X.getVelocityGradients();if(w){b.velocityGradients=[];for(const X of w){const P={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?P.factor2=X.factor2:P.factor2=X.factor1,b.velocityGradients.push(P)}}const f=X.getDragGradients();if(f){b.dragGradients=[];for(const X of f){const P={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?P.factor2=X.factor2:P.factor2=X.factor1,b.dragGradients.push(P)}}const O=X.getEmitRateGradients();if(O){b.emitRateGradients=[];for(const X of O){const P={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?P.factor2=X.factor2:P.factor2=X.factor1,b.emitRateGradients.push(P)}}const e=X.getStartSizeGradients();if(e){b.startSizeGradients=[];for(const X of e){const P={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?P.factor2=X.factor2:P.factor2=X.factor1,b.startSizeGradients.push(P)}}const Y=X.getLifeTimeGradients();if(Y){b.lifeTimeGradients=[];for(const X of Y){const P={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?P.factor2=X.factor2:P.factor2=X.factor1,b.lifeTimeGradients.push(P)}}const D=X.getLimitVelocityGradients();if(D){b.limitVelocityGradients=[];for(const X of D){const P={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?P.factor2=X.factor2:P.factor2=X.factor1,b.limitVelocityGradients.push(P)}b.limitVelocityDamping=X.limitVelocityDamping}X.noiseTexture&&(b.noiseTexture=X.noiseTexture.serialize())}clone(b,X){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q={...this._customWrappers};let S=null;const d=this._engine;if(d.createEffectForParticles&&null!=this.customShader){S=this.customShader;const b=S.shaderOptions.defines.length>0?S.shaderOptions.defines.join("\n"):"",X=d.createEffectForParticles(S.shaderPath.fragmentElement,S.shaderOptions.uniforms,S.shaderOptions.samplers,b);Q[0]?Q[0].effect=X:this.setCustomEffect(X,0)}const N=this.serialize(P),a=aX.Parse(N,this._scene||this._engine,this._rootUrl);return a.name=b,a.customShader=S,a._customWrappers=Q,void 0===X&&(X=this.dX),this.noiseTexture&&(a.noiseTexture=this.noiseTexture.clone()),a.dX=X,this.preventAutoStart||a.start(),a}}aX.BILLBOARDMODE_Y=2,aX.BILLBOARDMODE_ALL=7,aX.BILLBOARDMODE_STRETCHED=8,aX.BILLBOARDMODE_STRETCHED_LOCAL=9,Fb._ParseParticleSystem=aX.Parse;var uX=P(12102),wX=P(12093),fX=P(11973);fX.b.prototype.createTransformFeedback=function(){const b=this._gl.createTransformFeedback();if(!b)throw new Error("Unable to create Transform Feedback");return b},fX.b.prototype.deleteTransformFeedback=function(b){this._gl.deleteTransformFeedback(b)},fX.b.prototype.bindTransformFeedback=function(b){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,b)},fX.b.prototype.beginTransformFeedback=function(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(b?this._gl.POINTS:this._gl.TRIANGLES)},fX.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},fX.b.prototype.setTranformFeedbackVaryings=function(b,X){this._gl.transformFeedbackVaryings(b,X,this._gl.INTERLEAVED_ATTRIBS)},fX.b.prototype.bindTransformFeedbackBuffer=function(b){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,b?b.underlyingResource:null)},fX.b.prototype.readTransformFeedbackBuffer=function(b){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,b)};const OX="clipPlaneFragmentDeclaration2",eX="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";v.c.IncludesShadersStore[OX]||(v.c.IncludesShadersStore[OX]=eX);P(13234),P(13243),P(13245),P(13250),P(13257),P(13263),P(13267),P(13272);const YX="gpuRenderParticlesPixelShader",DX="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";v.c.ShadersStore[YX]||(v.c.ShadersStore[YX]=DX);const EX="clipPlaneVertexDeclaration2",tX="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";v.c.IncludesShadersStore[EX]||(v.c.IncludesShadersStore[EX]=tX);P(13280),P(13289),P(13294),P(13302);const BX="gpuRenderParticlesVertexShader",WX="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";v.c.ShadersStore[BX]||(v.c.ShadersStore[BX]=WX);class nX extends u{static get IsSupported(){if(!G.e.LastCreatedEngine)return!1;const b=G.e.LastCreatedEngine.getCaps();return b.supportTransformFeedbacks||b.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(b){this._maxActiveParticleCount=Math.min(b,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(b){this.maxActiveParticleCount=b}createPointEmitter(b,X){const P=Rb(b,X);return this.particleEmitterType=P,P}createHemisphericEmitter(){const b=rb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=b,b}createSphereEmitter(){const b=Ib(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=b,b}createDirectedSphereEmitter(){const b=Gb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.tX(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.tX(0,1,0));return this.particleEmitterType=b,b}createCylinderEmitter(){const b=mX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=b,b}createDirectedCylinderEmitter(){const b=bX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.tX(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.tX(0,1,0));return this.particleEmitterType=b,b}createConeEmitter(){const b=XX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=b,b}createDirectedConeEmitter(){const b=PX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.tX(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.tX(0,1,0));return this.particleEmitterType=b,b}createBoxEmitter(b,X,P,Q){const S=new O;return this.particleEmitterType=S,this.direction1=b,this.direction2=X,this.minEmitBox=P,this.maxEmitBox=Q,S}get flowMap(){return this._flowMap}set flowMap(b){this._flowMap!==b&&(this._flowMap=b)}isReady(){if(!this.dX||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==aX.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(aX.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(aX.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";b?setTimeout((()=>{this.start(0)}),b):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var b;let X=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(b=this._customWrappers[X])||void 0===b?void 0:b.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[b]??this._customWrappers[0]}setCustomEffect(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[X]=new bb.b(this._engine),this._customWrappers[X].effect=b}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new r.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(b,X,P){return super._removeGradientAndTexture(b,X,P),this._releaseBuffers(),this}addColorGradient(b,X){this._colorGradients||(this._colorGradients=[]);const P=new s(b,X);return this._colorGradients.push(P),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(b&&this._colorGradients.sort(((b,X)=>b.gradient<X.gradient?-1:b.gradient>X.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(b){return this._removeGradientAndTexture(b,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const X in this._drawWrappers){var b;null===(b=this._drawWrappers[X].drawContext)||void 0===b||b.reset()}}_addFactorGradient(b,X,P){const Q=new M(X,P);b.push(Q),this._releaseBuffers()}addSizeGradient(b,X){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,b,X),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(b){return this._removeGradientAndTexture(b,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(b,X){if(!b)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&b.sort(((b,X)=>b.gradient<X.gradient?-1:b.gradient>X.gradient?1:0));const P=this;P[X]&&(P[X].dispose(),P[X]=null)}addAngularSpeedGradient(b,X){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,b,X),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(b){return this._removeGradientAndTexture(b,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(b,X){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,b,X),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(b){return this._removeGradientAndTexture(b,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(b,X){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,b,X),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(b){return this._removeGradientAndTexture(b,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(b,X){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,b,X),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(b){return this._removeGradientAndTexture(b,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(b){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(b,X,P){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(b),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Nd=new r.d,this.onStoppedObservable=new r.d,this.onStartedObservable=new r.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,P&&"Scene"!==P.getClassName()?(this._engine=P,this.defaultProjectionMatrix=Q.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=P||G.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Oe.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,a.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,a.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,a.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,a.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new bb.b(this._engine)},this._customWrappers[0].effect=S,this._drawWrappers={0:new bb.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(X=X??{}).randomTextureSize||delete X.randomTextureSize;const N={zX:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...X},u=X;isFinite(u)&&(N.zX=u),this._capacity=N.zX,this._maxActiveParticleCount=N.zX,this._currentActiveCount=0,this._isAnimationSheetEnabled=d,this.particleEmitterType=new O;const w=Math.min(this._engine.getCaps().maxTextureSize,N.randomTextureSize);let f=[];for(let Q=0;Q<w;++Q)f.push(Math.random()),f.push(Math.random()),f.push(Math.random()),f.push(Math.random());this._randomTexture=new I.d(new Float32Array(f),w,1,5,P,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,f=[];for(let Q=0;Q<w;++Q)f.push(Math.random()),f.push(Math.random()),f.push(Math.random()),f.push(Math.random());this._randomTexture2=new I.d(new Float32Array(f),w,1,5,P,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=w}_reset(){this._releaseBuffers()}_createVertexBuffers(b,X,P){const Q={};Q.position=X.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let S=3;Q.age=X.createVertexBuffer("age",S,1,this._attributesStrideSize,!0),S+=1,Q.size=X.createVertexBuffer("size",S,3,this._attributesStrideSize,!0),S+=3,Q.life=X.createVertexBuffer("life",S,1,this._attributesStrideSize,!0),S+=1,S+=4,this.billboardMode===aX.BILLBOARDMODE_STRETCHED&&(Q.direction=X.createVertexBuffer("direction",S,3,this._attributesStrideSize,!0)),S+=3,this._platform.alignDataInBuffer&&(S+=1),this.particleEmitterType instanceof y&&(S+=3,this._platform.alignDataInBuffer&&(S+=1)),this._colorGradientsTexture||(Q.color=X.createVertexBuffer("color",S,4,this._attributesStrideSize,!0),S+=4),this._isBillboardBased||(Q.initialDirection=X.createVertexBuffer("initialDirection",S,3,this._attributesStrideSize,!0),S+=3,this._platform.alignDataInBuffer&&(S+=1)),this.noiseTexture&&(Q.noiseCoordinates1=X.createVertexBuffer("noiseCoordinates1",S,3,this._attributesStrideSize,!0),S+=3,this._platform.alignDataInBuffer&&(S+=1),Q.noiseCoordinates2=X.createVertexBuffer("noiseCoordinates2",S,3,this._attributesStrideSize,!0),S+=3,this._platform.alignDataInBuffer&&(S+=1)),Q.angle=X.createVertexBuffer("angle",S,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?S++:S+=2,this._isAnimationSheetEnabled&&(Q.cellIndex=X.createVertexBuffer("cellIndex",S,1,this._attributesStrideSize,!0),S+=1,this.spriteRandomStartCell&&(Q.cellStartOffset=X.createVertexBuffer("cellStartOffset",S,1,this._attributesStrideSize,!0),S+=1)),Q.offset=P.createVertexBuffer("offset",0,2),Q.uv=P.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(Q),this._platform.createVertexBuffers(b,Q),this.resetDrawCache()}_initialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!b)return;const X=this._engine,P=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof y&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const S=this.particleEmitterType instanceof y,d=Q.TmpVectors.tX[0];let N=0;for(let Q=0;Q<this._capacity;Q++)if(P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),S?(this.particleEmitterType.particleDestinationGenerator(Q,null,d),P.push(d.x),P.push(d.y),P.push(d.z)):(P.push(0),P.push(0),P.push(0)),this._platform.alignDataInBuffer&&P.push(0),N+=16,S&&(this.particleEmitterType.particlePositionGenerator(Q,null,d),P.push(d.x),P.push(d.y),P.push(d.z),this._platform.alignDataInBuffer&&P.push(0),N+=4),this._colorGradientsTexture||(P.push(0),P.push(0),P.push(0),P.push(0),N+=4),this.isBillboardBased||(P.push(0),P.push(0),P.push(0),this._platform.alignDataInBuffer&&P.push(0),N+=4),this.noiseTexture&&(P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),this._platform.alignDataInBuffer&&P.push(0),P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),this._platform.alignDataInBuffer&&P.push(0),N+=8),P.push(0),N+=1,this._angularSpeedGradientsTexture||(P.push(0),N+=1),this._isAnimationSheetEnabled&&(P.push(0),N+=1,this.spriteRandomStartCell&&(P.push(0),N+=1)),this._platform.alignDataInBuffer){let b=3-(N+3&3);for(N+=b;b-- >0;)P.push(0)}const a=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),u=this._platform.createParticleBuffer(P),w=this._platform.createParticleBuffer(P);this._buffer0=new h.c(X,u,!1,this._attributesStrideSize),this._buffer1=new h.c(X,w,!1,this._attributesStrideSize),this._spriteBuffer=new h.c(X,a,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let b=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(b+="\n#define BILLBOARD"),this._colorGradientsTexture&&(b+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(b+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(b+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(b+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(b+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(b+="\n#define DRAGGRADIENTS"),this._flowMap&&(b+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(b+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(b+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(b+="\n#define NOISE"),this.isLocal&&(b+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===b||(this._cachedUpdateDefines=b,this._updateBuffer=this._platform.createUpdateBuffer(b)),this._platform.isUpdateBufferReady()}_getWrapper(b){const X=this._getCustomDrawWrapper(b);if(null!==X&&void 0!==X&&X.effect)return X;const P=[];this.fillDefines(P,b);let Q=this._drawWrappers[b];Q||(Q=new bb.b(this._engine),Q.drawContext&&(Q.drawContext.useInstancing=!0),this._drawWrappers[b]=Q);const S=P.join("\n");if(Q.defines!==S){const b=[],X=[],P=[];this.fillUniformsAttributesAndSamplerNames(X,b,P),Q.setEffect(this._engine.createEffect("gpuRenderParticles",b,X,P,S),S)}return Q}static _GetAttributeNamesOrOptions(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const S=[h.g.PositionKind,"age","life","size","angle"];return b||S.push(h.g.ColorKind),X&&S.push("cellIndex"),P||S.push("initialDirection"),Q&&S.push("direction"),S.push("offset",h.g.UVKind),S}static _GetEffectCreationOptions(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=["emitterWM","aw","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Xb.e)(Q),b&&Q.push("sheetInfos"),X&&Q.push("logarithmicDepthConstant"),P&&(Q.push("vFogInfos"),Q.push("vFogColor")),Q}fillDefines(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Xb.m)(this,this._scene,b),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==wX.e.FOGMODE_NONE&&b.push("#define FOG")),X===aX.BLENDMODE_MULTIPLY&&b.push("#define BLENDMULTIPLYMODE"),this.isLocal&&b.push("#define LOCAL"),this.useLogarithmicDepth&&b.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(b.push("#define BILLBOARD"),this.billboardMode){case aX.BILLBOARDMODE_Y:b.push("#define BILLBOARDY");break;case aX.BILLBOARDMODE_STRETCHED:b.push("#define BILLBOARDSTRETCHED");break;case aX.BILLBOARDMODE_ALL:b.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&b.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&b.push("#define ANIMATESHEET"),P&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),b.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(b,X,P){X.push(...nX._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===aX.BILLBOARDMODE_STRETCHED)),b.push(...nX._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),P.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(uX.d.PrepareUniforms(b,this._imageProcessingConfigurationDefines),uX.d.PrepareSamplers(P,this._imageProcessingConfigurationDefines))}animate(){var b;let X=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(X?this.preWarmStepOffset:(null===(b=this._scene)||void 0===b?void 0:b.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(b,X){const P=this[X];if(!b||!b.length||P)return;const Q=new Float32Array(this._rawTextureWidth);for(let S=0;S<this._rawTextureWidth;S++){const X=S/this._rawTextureWidth;R.GetCurrentGradient(X,b,((b,X,P)=>{Q[S]=(0,w.Lerp)(b.factor1,X.factor1,P)}))}this[X]=I.d.CreateRTexture(Q,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[X].name=X.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const b=new Uint8Array(4*this._rawTextureWidth),X=N.TmpColors.Ba[0];for(let P=0;P<this._rawTextureWidth;P++){const Q=P/this._rawTextureWidth;R.GetCurrentGradient(Q,this._colorGradients,((Q,S,d)=>{N.Ba.LerpToRef(Q.color1,S.color1,d,X),b[4*P]=255*X.r,b[4*P+1]=255*X.g,b[4*P+2]=255*X.b,b[4*P+3]=255*X.a}))}this._colorGradientsTexture=I.d.CreateRGBATexture(b,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(b,X){var P,S,d,N;const a=this._getWrapper(b),u=a.effect;this._engine.enableEffect(a);const w=(null===(P=this._scene)||void 0===P?void 0:P.getViewMatrix())||Q.Matrix.IdentityReadOnly;if(u.setMatrix("view",w),u.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),u.setTexture("diffuseSampler",this.particleTexture),u.setVector2("translationPivot",this.translationPivot),u.setVector3("aw",this.aw),this.isLocal&&u.setMatrix("emitterWM",X),this._colorGradientsTexture?u.setTexture("colorGradientSampler",this._colorGradientsTexture):u.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const b=this.particleTexture.getBaseSize();u.setFloat3("sheetInfos",this.spriteCellWidth/b.width,this.spriteCellHeight/b.height,b.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const b=this._scene.activeCamera;u.setVector3("eyePosition",b.globalPosition)}const f=u.defines;if(this._scene&&((0,Xb.i)(u,this,this._scene),this.applyFog&&(0,Pb.g)(this._scene,void 0,u)),f.indexOf("#define BILLBOARDMODE_ALL")>=0){const b=w.clone();b.invert(),u.setMatrix("invView",b)}return this.useLogarithmicDepth&&this._scene&&(0,Pb.k)(f,u,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(u),this._setEngineBasedOnBlendMode(b),this._platform.bindDrawBuffers(this._targetIndex,u,null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(u),null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(N=this._scene)&&void 0!==N&&N.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(b){if(!this.dX||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!b)if(this.dX.position){b=this.dX.getWorldMatrix()}else{const X=this.dX;b=Q.TmpVectors.Matrix[0],Q.Matrix.TranslationToRef(X.x,X.y,X.z,b)}const X=this._engine,P=X.getDepthWrite();if(X.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const b=this.Ab();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",b.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",b),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const S=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=S,X.setDepthWrite(P)}render(){let b,X=arguments.length>0&&void 0!==arguments[0]&&arguments[0],P=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!X&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let b=0;b<this.preWarmCycles;b++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const b=0|this._accumulatedCount;this._accumulatedCount-=b,this._currentActiveCount+=b}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.dX.position){b=this.dX.getWorldMatrix()}else{const X=this.dX;b=Q.TmpVectors.Matrix[0],Q.Matrix.TranslationToRef(X.x,X.y,X.z,b)}const S=this._engine;this.updateInAnimate||this._update(b);let d=0;return X||P||(S.setState(!1),this.forceDepthWrite&&S.setDepthWrite(!0),d=this.blendMode===aX.BLENDMODE_MULTIPLYADD?this._render(aX.BLENDMODE_MULTIPLY,b)+this._render(aX.BLENDMODE_ADD,b):this._render(this.blendMode,b),this._engine.setAlphaMode(0)),d}rebuild(){const b=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(b,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,b()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const X in this._drawWrappers){this._drawWrappers[X].dispose()}if(this._drawWrappers={},this._scene){const b=this._scene.Oe.indexOf(this);b>-1&&this._scene.Oe.splice(b,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let X=0;X<this._renderVertexBuffers.length;++X){const b=this._renderVertexBuffers[X];for(const X in b)b[X].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),b&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),b&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Nd.notifyObservers(this),this.Nd.clear()}clone(b,X){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q={...this._customWrappers};let S=null;const d=this._engine;if(d.createEffectForParticles&&null!=this.customShader){S=this.customShader;const b=S.shaderOptions.defines.length>0?S.shaderOptions.defines.join("\n"):"";Q[0]=d.createEffectForParticles(S.shaderPath.fragmentElement,S.shaderOptions.uniforms,S.shaderOptions.samplers,b,void 0,void 0,void 0,this)}const N=this.serialize(P),a=nX.Parse(N,this._scene||this._engine,this._rootUrl);return a.name=b,a.customShader=S,a._customWrappers=Q,void 0===X&&(X=this.dX),this.noiseTexture&&(a.noiseTexture=this.noiseTexture.clone()),a.dX=X,a}serialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};return aX._Serialize(X,this,b),X.activeParticleCount=this.activeParticleCount,X.randomTextureSize=this._randomTextureSize,X.customShader=this.customShader,X}static Parse(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0;const d=b.name;let N,a;X instanceof Mb.c?N=X:(a=X,N=a.getEngine());const u=new nX(d,{zX:S||b.zX,randomTextureSize:b.randomTextureSize},X,null,b.isAnimationSheetEnabled);if(u._rootUrl=P,b.customShader&&N.createEffectForParticles){const X=b.customShader,P=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"",Q=N.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,P,void 0,void 0,void 0,u);u.setCustomEffect(Q,0),u.customShader=X}return b.id&&(u.id=b.id),b.activeParticleCount&&(u.activeParticleCount=b.activeParticleCount),aX._Parse(b,u,X,P),b.preventAutoStart&&(u.preventAutoStart=b.preventAutoStart),Q||u.preventAutoStart||u.start(),u}}var yX=P(11689),hX=P(13306),LX=P(12232);class ZX{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(b){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const X of this.systems)X.dX=b;this._emitterNode=b}setEmitterAsSphere(b,X,P){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:b,renderingGroupId:X};const Q=(0,hX.d)("emitterSphere",{diameter:b.diameter,segments:b.segments},P);Q.renderingGroupId=X;const S=new LX.nX("emitterSphereMaterial",P);S.emissiveColor=b.color,Q.material=S;for(const d of this.systems)d.dX=Q;this._emitterNode=Q}start(b){for(const X of this.systems)b&&(X.dX=b),X.start()}dispose(){for(const b of this.systems)b.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={systems:[]};for(const P of this.systems)X.systems.push(P.serialize(b));return this._emitterNode&&(X.dX=this._emitterCreationOptions),X}static Parse(b,X){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0;const S=new ZX,d=this.BaseAssetsUrl+"/textures/";X=X||G.e.LastCreatedScene;for(const N of b.systems)S.systems.push(P?nX.Parse(N,X,d,!0,Q):aX.Parse(N,X,d,!0,Q));if(b.dX){const P=b.dX.options;if("Sphere"===b.dX.kind)S.setEmitterAsSphere({diameter:P.diameter,segments:P.segments,color:N.yX.hX(P.color)},b.dX.renderingGroupId,X)}return S}}ZX.BaseAssetsUrl="https://assets.babylonjs.com/particles";var vX=P(11728);class AX{static CreateDefault(b){let X,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,Q=arguments.length>2?arguments[2]:void 0;X=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new nX("default system",{zX:P},Q):new aX("default system",P,Q),X.dX=b;const S=yX.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return X.particleTexture=new H.d(S,X.Ab()),X.createConeEmitter(.1,Math.PI/4),X.color1=new N.Ba(1,1,1,1),X.color2=new N.Ba(1,1,1,1),X.colorDead=new N.Ba(1,1,1,0),X.minSize=.1,X.maxSize=.1,X.minEmitPower=2,X.maxEmitPower=2,X.updateSpeed=1/60,X.emitRate=30,X}static CreateAsync(b,X){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0;X||(X=G.e.LastCreatedScene);const S={};return X.addPendingData(S),new Promise(((d,N)=>{if(P&&!nX.IsSupported)return X.removePendingData(S),N("Particle system with GPU is not supported.");yX.Tools.LoadFile(`${AX.BaseAssetsUrl}/systems/${b}.json`,(b=>{X.removePendingData(S);const N=JSON.parse(b.toString());return d(ZX.Parse(N,X,P,Q))}),void 0,void 0,void 0,(()=>(X.removePendingData(S),N(`An error occurred with the creation of your particle system. Check if your type '${b}' exists.`))))}))}static ExportSet(b){const X=new ZX;for(const P of b)X.systems.push(P);return X}static ParseFromFileAsync(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",d=arguments.length>5?arguments[5]:void 0;return new Promise(((N,a)=>{const u=new vX.c;u.addEventListener("readystatechange",(()=>{if(4==u.readyState)if(200==u.status){const X=JSON.parse(u.responseText);let a;a=Q?nX.Parse(X,P,S,!1,d):aX.Parse(X,P,S,!1,d),b&&(a.name=b),N(a)}else a("Unable to load the particle system")})),u.open("GET",X),u.send()}))}static ParseFromSnippetAsync(b,X){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",S=arguments.length>4?arguments[4]:void 0;if("_BLANK"===b){const b=this.CreateDefault(null);return b.start(),Promise.resolve(b)}return new Promise(((d,N)=>{const a=new vX.c;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const N=JSON.parse(JSON.parse(a.responseText).jsonPayload),u=JSON.parse(N.particleSystem);let w;w=P?nX.Parse(u,X,Q,!1,S):aX.Parse(u,X,Q,!1,S),w.snippetId=b,d(w)}else N("Unable to load the snippet "+b)})),a.open("GET",this.SnippetUrl+"/"+b.replace(/#/g,"/")),a.send()}))}}AX.BaseAssetsUrl=ZX.BaseAssetsUrl,AX.SnippetUrl="https://snippet.babylonjs.com",AX.CreateFromSnippetAsync=AX.ParseFromSnippetAsync;var oX=P(12319),KX=P(12134),TX=P(13308);(0,TX.c)(KX.e.NAME_PARTICLESYSTEM,((b,X,P,Q)=>{const S=(0,TX.f)(KX.e.NAME_PARTICLESYSTEM);if(S&&void 0!==b.Oe&&null!==b.Oe)for(let d=0,N=b.Oe.length;d<N;d++){const N=b.Oe[d];P.Oe.push(S(N,X,Q))}})),(0,TX.b)(KX.e.NAME_PARTICLESYSTEM,((b,X,P)=>{if(b.activeParticleCount){return nX.Parse(b,X,P)}return aX.Parse(b,X,P)})),Mb.c.prototype.createEffectForParticles=function(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",d=arguments.length>4?arguments[4]:void 0,N=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,u=arguments.length>7?arguments[7]:void 0,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,f=arguments.length>9?arguments[9]:void 0,O=[],e=[];const Y=[];return u?u.fillUniformsAttributesAndSamplerNames(e,O,Y):(O=aX._GetAttributeNamesOrOptions(),e=aX._GetEffectCreationOptions()),-1===S.indexOf(" BILLBOARD")&&(S+="\n#define BILLBOARD\n"),null!==u&&void 0!==u&&u.isAnimationSheetEnabled&&-1===S.indexOf(" ANIMATESHEET")&&(S+="\n#define ANIMATESHEET\n"),-1===Q.indexOf("diffuseSampler")&&Q.push("diffuseSampler"),this.createEffect({vertex:f??(null===u||void 0===u?void 0:u.vertexShaderName)??"particles",fragmentElement:b},O,e.concat(X),Y.concat(Q),S,d,N,a,void 0,w,(async()=>{0===w?await Promise.resolve().then(P.bind(P,13344)):await Promise.resolve().then(P.bind(P,13410))}))},oX.b.prototype.getEmittedParticleSystems=function(){const b=[];for(let X=0;X<this.Ab().Oe.length;X++){const P=this.Ab().Oe[X];P.dX===this&&b.push(P)}return b},oX.b.prototype.getHierarchyEmittedParticleSystems=function(){const b=[],X=this.getDescendants();X.push(this);for(let P=0;P<this.Ab().Oe.length;P++){const Q=this.Ab().Oe[P],S=Q.dX;S.position&&-1!==X.indexOf(S)&&b.push(Q)}return b};P(12192),P(12207),P(12290);P(12299),P(13313),P(12043),P(12179),P(12342);P(12034);var qX;P(13320),P(11846);!function(b){b[b.Color=2]="Color",b[b.UV=1]="UV",b[b.Random=0]="Random",b[b.Stated=3]="Stated"}(qX||(qX={}));var VX=P(12081);const iX=new Q.tX(0,0,0),xX=new Q.tX(0,0,0),HX=new Q.tX(0,0,0);class CX{constructor(b,X,P){this.width=b,this.height=X,this.data=P}processFlowable(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2?arguments[2]:void 0;if(!P)return;P instanceof Q.Matrix?Q.tX.TransformCoordinatesToRef(b.position,P,HX):(HX.x=P.x,HX.y=P.y,HX.z=P.z);const S=.5*HX.x+.5,d=1-(.5*HX.y+.5),N=Math.floor(S*this.width),a=Math.floor(d*this.height);if(N<0||N>=this.width||a<0||a>=this.height)return;const u=4*(a*this.width+N),w=this.data[u]/255*2-1,f=this.data[u+1]/255*2-1,O=this.data[u+2]/255*2-1,e=this.data[u+3]/255;iX.set(w,f,O),iX.scaleToRef(X*e,xX),b.direction.addInPlace(xX)}_processParticle(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2?arguments[2]:void 0;this.processFlowable(b,X,P)}static async FromUrlAsync(b){return await new Promise(((X,P)=>{const Q=document.createElement("canvas"),S=Q.getContext("2d");let d=null;const N=new Image;N.crossOrigin="anonymous",N.src=b,N.onerror=X=>{P(new Error(`Failed to load image: ${b} : ${X}`))},N.onload=()=>{Q.width=N.width,Q.height=N.height,S.drawImage(N,0,0),d=S.getImageData(0,0,Q.width,Q.height),X(new CX(Q.width,Q.height,d.data))}}))}static async ExtractFromTextureAsync(b){return await new Promise(((X,P)=>{if(!b.isReady())return void b.onLoadObservable.addOnce((async()=>{try{const P=await this.ExtractFromTextureAsync(b);X(P)}catch(Q){P(Q)}}));const Q=b.getSize();VX.m.GetTextureDataAsync(b,Q.width,Q.height).then((b=>{X(new CX(Q.width,Q.height,new Uint8ClampedArray(b)))})).catch(P)}))}}var pX,kX,zX,UX,gX,jX,lX,JX,cX;!function(b){b[b.Int=1]="Int",b[b.Float=2]="Float",b[b.Vector2=4]="Vector2",b[b.tX=8]="tX",b[b.Matrix=16]="Matrix",b[b.Particle=32]="Particle",b[b.Texture=64]="Texture",b[b.Ba=128]="Ba",b[b.FloatGradient=256]="FloatGradient",b[b.Vector2Gradient=512]="Vector2Gradient",b[b.Vector3Gradient=1024]="Vector3Gradient",b[b.Color4Gradient=2048]="Color4Gradient",b[b.System=4096]="System",b[b.AutoDetect=8192]="AutoDetect",b[b.BasedOnInput=16384]="BasedOnInput",b[b.Undefined=32768]="Undefined",b[b.All=65535]="All"}(pX||(pX={})),function(b){b[b.Compatible=0]="Compatible",b[b.TypeIncompatible=1]="TypeIncompatible",b[b.HierarchyIssue=2]="HierarchyIssue"}(kX||(kX={})),function(b){b[b.Input=0]="Input",b[b.Output=1]="Output"}(zX||(zX={}));class sX{get direction(){return this._direction}get type(){if(this._type===pX.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===pX.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(b){this._type=b}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((b=>b.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(b,X,P){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=pX.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new r.d,this.onDisconnectionObservable=new r.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=X,this.name=b,this._direction=P}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(b){var X;return this.isConnected?null!==(X=this._connectedPoint)&&void 0!==X&&X._storedFunction?this._connectedPoint._storedFunction(b):this._connectedPoint._storedValue:this.value}canConnectTo(b){return 0===this.checkCompatibilityState(b)}checkCompatibilityState(b){const X=this._ownerBlock,P=b.ownerBlock;if(this.type!==b.type&&b.innerType!==pX.AutoDetect)return b.acceptedConnectionPointTypes&&-1!==b.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(b.excludedConnectionPointTypes&&-1!==b.excludedConnectionPointTypes.indexOf(this.type))return 1;let Q=P,S=X;return 0===this.direction&&(Q=X,S=P),Q.isAnAncestorOf(S)?2:0}connectTo(b){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(b))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${b.ownerBlock.name}".${b.name}`;return this._endpoints.push(b),b._connectedPoint=this,this.onConnectionObservable.notifyObservers(b),b.onConnectionObservable.notifyObservers(this),this}disconnectFrom(b){const X=this._endpoints.indexOf(b);return-1===X||(this._endpoints.splice(X,1),b._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(b),b.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(b){let X=1;for(;X<pX.All;)b&X||this.excludedConnectionPointTypes.push(X),X<<=1}serialize(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const X={};return X.name=this.name,X.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Zd?(X.valueType="BABYLON."+this.value.getClassName(),X.value=this.value.Zd()):(X.valueType="number",X.value=this.value)),b&&this.connectedPoint&&(X.inputName=this.name,X.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,X.targetConnectionName=this.connectedPoint.name,X.isExposedOnFrame=!0,X.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(X.isExposedOnFrame=!0,X.exposedPortPosition=this.exposedPortPosition),X}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class FX{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(b){this._name=b}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(b){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new r.d,this.Nd=new r.d,this.onInputChangedObservable=new r.d,this.visibleOnFrame=!1,this._name=b,this.uniqueId=C.b.UniqueId}_inputRename(b){return b}_outputRename(b){return b}isAnAncestorOf(b){for(const X of this._outputs)if(X.hasEndpoints)for(const P of X.endpoints){if(P.ownerBlock===b)return!0;if(P.ownerBlock.isAnAncestorOf(b))return!0}return!1}isAnAncestorOfType(b){if(this.getClassName()===b)return!0;for(const X of this._outputs)if(X.hasEndpoints)for(const P of X.endpoints)if(P.ownerBlock.isAnAncestorOfType(b))return!0;return!1}getInputByName(b){const X=this._inputs.filter((X=>X.name===b));return X.length?X[0]:null}_linkConnectionTypes(b,X){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[X]._acceptedConnectionPointType=this._inputs[b]:(this._inputs[b]._linkedConnectionSource=this._inputs[X],this._inputs[b]._isMainLinkSource=!0),this._inputs[X]._linkedConnectionSource=this._inputs[b]}registerInput(b,X){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0;const N=new sX(b,this,0);return N.type=X,N.isOptional=P,N.defaultValue=Q,N.value=Q,N.valueMin=S,N.valueMax=d,this._inputs.push(N),this.onInputChangedObservable.notifyObservers(N),this}registerOutput(b,X,P){return(P=P??new sX(b,this,1)).type=X,this._outputs.push(P),this}_build(b){}_customBuildStep(b){}build(b){if(this._buildId===b.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((b=>b.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=b.buildId;for(const X of this._inputs){if(!X.connectedPoint){X.isOptional||b.notConnectedNonOptionalInputs.push(X);continue}const P=X.connectedPoint.ownerBlock;P&&P!==this&&!P.isSystem&&P.build(b)}return this._customBuildStep(b),b.verbose&&p.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(b),this.onBuildObservable.notifyObservers(this),!1}serialize(){const b={};b.customType="BABYLON."+this.getClassName(),b.id=this.uniqueId,b.name=this.name,b.visibleOnFrame=this.visibleOnFrame,b.inputs=[],b.outputs=[];for(const X of this.inputs)b.inputs.push(X.serialize());for(const X of this.outputs)b.outputs.push(X.serialize(!1));return b}_deserialize(b){this._name=b.name,this.comments=b.comments,this.visibleOnFrame=!!b.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(b)}_deserializePortDisplayNamesAndExposedOnFrame(b){const X=b.inputs,P=b.outputs;if(X)for(const Q of X){const b=this.inputs.find((b=>b.name===Q.name));if(!b)return;if(Q.displayName&&(b.displayName=Q.displayName),Q.isExposedOnFrame&&(b.isExposedOnFrame=Q.isExposedOnFrame,b.exposedPortPosition=Q.exposedPortPosition),void 0!==Q.value&&null!==Q.value)if("number"===Q.valueType)b.value=Q.value;else{const X=(0,a.d)(Q.valueType);X&&(b.value=X.hX(Q.value))}}if(P)for(let Q=0;Q<P.length;Q++){const b=P[Q];b.displayName&&(this.outputs[Q].displayName=b.displayName),b.isExposedOnFrame&&(this.outputs[Q].isExposedOnFrame=b.isExposedOnFrame,this.outputs[Q].exposedPortPosition=b.exposedPortPosition)}}clone(){const b=this.serialize(),X=(0,a.d)(b.customType);if(X){const P=new X;return P._deserialize(b),P}return null}dispose(){this.Nd.notifyObservers(this),this.Nd.clear();for(const b of this.inputs)b.dispose();for(const b of this.outputs)b.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function MX(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",Q=arguments.length>3?arguments[3]:void 0;return(S,d)=>{let N=S._propStore;N||(N=[],S._propStore=N),N.push({propertyName:d,displayName:b,type:X,groupName:P,options:Q??{},className:S.getClassName()})}}(0,V.b)([(0,i.E)("comment")],FX.prototype,"comments",void 0),function(b){b[b.Boolean=0]="Boolean",b[b.Float=1]="Float",b[b.Int=2]="Int",b[b.Vector2=3]="Vector2",b[b.List=4]="List",b[b.Ba=5]="Ba",b[b.SamplingMode=6]="SamplingMode",b[b.TextureFormat=7]="TextureFormat",b[b.TextureType=8]="TextureType"}(UX||(UX={})),function(b){b[b.None=0]="None",b[b.Position=1]="Position",b[b.Direction=2]="Direction",b[b.Age=3]="Age",b[b.Lifetime=4]="Lifetime",b[b.Color=5]="Color",b[b.ScaledDirection=6]="ScaledDirection",b[b.Scale=7]="Scale",b[b.AgeGradient=8]="AgeGradient",b[b.Angle=9]="Angle",b[b.SpriteCellIndex=16]="SpriteCellIndex",b[b.SpriteCellStart=17]="SpriteCellStart",b[b.SpriteCellEnd=18]="SpriteCellEnd"}(gX||(gX={})),function(b){b[b.None=0]="None",b[b.Time=1]="Time",b[b.Delta=2]="Delta",b[b.Emitter=3]="Emitter"}(jX||(jX={}));class RX{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let b="";for(const X of this.notConnectedNonOptionalInputs)b+=`input ${X.name} from block ${X.ownerBlock.name}[${X.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(b)throw"Build of Node Particle System Set failed:\n"+b}adapt(b,X){const P=b.getConnectedValue(this)||0;if(b.type===X)return P;switch(X){case pX.Vector2:return new Q.Vector2(P,P);case pX.tX:return new Q.tX(P,P,P);case pX.Ba:return new N.Ba(P,P,P,P)}return null}getContextualValue(b){if(!this.particleContext||!this.systemContext)return null;switch(b){case gX.Position:return this.particleContext.position;case gX.Direction:return this.particleContext.direction;case gX.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case gX.Color:return this.particleContext.color;case gX.Age:return this.particleContext.age;case gX.Lifetime:return this.particleContext.lifeTime;case gX.Angle:return this.particleContext.angle;case gX.Scale:return this.particleContext.scale;case gX.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case gX.SpriteCellEnd:return this.systemContext.endSpriteCellID;case gX.SpriteCellIndex:return this.particleContext.cellIndex;case gX.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.dX.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.dX.absolutePosition:this.systemContext.dX:null}getSystemValue(b){if(!this.particleContext||!this.systemContext)return null;switch(b){case jX.Time:return this.systemContext._actualFrame;case jX.Delta:return this.systemContext._scaledUpdateSpeed;case jX.Emitter:if(this.isEmitterTransformNode){return this.systemContext.dX.absolutePosition}return this.systemContext.dX}return null}}function rX(b,X,P){const Q=new RX;Q.WX=X;const S=b.createSystem(Q);return S.canStart=()=>!0,S.dX=P.clone(),S.disposeOnStop=!0,S.start(),S}class IX extends FX{constructor(b){super(b),this.blendMode=u.BLENDMODE_ONEONE,this.zX=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",pX.Particle),this.registerInput("texture",pX.Texture),this.registerInput("onStart",pX.System,!0),this.registerInput("onEnd",pX.System,!0),this.registerOutput("system",pX.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(b){b.zX=this.zX,b.buildId=this._buildId++,this.build(b);const X=this.particle.getConnectedValue(b);return X.particleTexture=this.texture.getConnectedValue(b),X.emitRate=this.emitRate,X.blendMode=this.blendMode,X.name=this.name,X._nodeGenerated=!0,X._targetStopDuration=this.targetStopDuration,X.startDelay=this.startDelay,this.system._storedValue=this,X.canStart=()=>!this.doNoStart,X.onStartedObservable.add((P=>{const Q=this.onStart.getConnectedValue(b);Q&&P.onStartedObservable.addOnce((()=>{b.systemContext=X;const P=rX(Q,b.WX,b.emitterPosition);this.Nd.addOnce((()=>{P.dispose()}))}));const S=this.onEnd.getConnectedValue(b);S&&P.onStoppedObservable.addOnce((()=>{b.systemContext=X;const P=rX(S,b.WX,b.emitterPosition);this.Nd.addOnce((()=>{P.dispose()}))}))})),this.Nd.addOnce((()=>{X.dispose()})),X}serialize(){const b=super.serialize();return b.zX=this.zX,b.emitRate=this.emitRate,b.blendMode=this.blendMode,b.doNoStart=this.doNoStart,b.targetStopDuration=this.targetStopDuration,b.startDelay=this.startDelay,b}_deserialize(b){super._deserialize(b),this.zX=b.zX,this.emitRate=b.emitRate,this.doNoStart=!!b.doNoStart,void 0!==b.blendMode&&(this.blendMode=b.blendMode),void 0!==b.targetStopDuration&&(this.targetStopDuration=b.targetStopDuration),void 0!==b.startDelay&&(this.startDelay=b.startDelay)}}(0,V.b)([MX("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:u.BLENDMODE_ONEONE},{label:"Standard",value:u.BLENDMODE_STANDARD},{label:"Add",value:u.BLENDMODE_ADD},{label:"Multiply",value:u.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:u.BLENDMODE_MULTIPLYADD}]})],IX.prototype,"blendMode",void 0),(0,V.b)([MX("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],IX.prototype,"zX",void 0),(0,V.b)([MX("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],IX.prototype,"emitRate",void 0),(0,V.b)([MX("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],IX.prototype,"targetStopDuration",void 0),(0,V.b)([MX("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],IX.prototype,"startDelay",void 0),(0,V.b)([MX("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],IX.prototype,"doNoStart",void 0),(0,a.h)("BABYLON.SystemBlock",IX);class GX extends FX{get type(){if(this._type===pX.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=pX.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=pX.Vector2,this._type;case"tX":return this._type=pX.tX,this._type;case"Ba":return this._type=pX.Ba,this._type;case"Matrix":return this._type=pX.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===gX.None&&this._systemSource!==jX.None}get systemSource(){return this._systemSource}set systemSource(b){if(this._systemSource=b,b!==jX.None){switch(this._contextualSource=gX.None,this._type=pX.Float,b){case jX.Time:case jX.Delta:this._type=pX.Float;break;case jX.Emitter:this._type=pX.tX}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==gX.None}get contextualValue(){return this._contextualSource}set contextualValue(b){if(this._contextualSource=b,b!==gX.None){switch(this._systemSource=jX.None,b){case gX.Scale:this._type=pX.Vector2;break;case gX.Position:case gX.Direction:case gX.ScaledDirection:this._type=pX.tX;break;case gX.Color:this._type=pX.Ba;break;case gX.Age:case gX.Lifetime:case gX.Angle:case gX.AgeGradient:this._type=pX.Float;break;case gX.SpriteCellEnd:case gX.SpriteCellStart:case gX.SpriteCellIndex:this._type=pX.Int}this.output&&(this.output.type=this._type)}}constructor(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pX.AutoDetect;super(b),this._type=pX.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new r.d,this._systemSource=jX.None,this._contextualSource=gX.None,this._type=X,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",X)}get value(){return this._storedValue}set value(b){this.type===pX.Float&&this.min!==this.max&&(b=Math.max(this.min,b),b=Math.min(this.max,b)),this._storedValue=b,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(b){this._valueCallback=b}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case pX.Int:case pX.Float:this.value=0;break;case pX.Vector2:this.value=Q.Vector2.Zero();break;case pX.tX:this.value=Q.tX.Zero();break;case pX.Ba:this.value=new N.Ba(1,1,1,1);break;case pX.Matrix:this.value=Q.Matrix.Identity()}}_build(b){super._build(b),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=b=>b.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=b=>b.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const b=super.serialize();return b.type=this.type,b.contextualValue=this.contextualValue,b.systemSource=this.systemSource,b.min=this.min,b.max=this.max,b.groupInInspector=this.groupInInspector,b.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Zd?(b.valueType="BABYLON."+this._storedValue.getClassName(),b.value=this._storedValue.Zd()):(b.valueType="number",b.value=this._storedValue)),b}_deserialize(b){if(super._deserialize(b),this._type=b.type,this.contextualValue=b.contextualValue,this.systemSource=b.systemSource||jX.None,this.min=b.min||0,this.max=b.max||0,this.groupInInspector=b.groupInInspector||"",void 0!==b.displayInInspector&&(this.displayInInspector=b.displayInInspector),b.valueType)if("number"===b.valueType)this._storedValue=b.value;else{const X=(0,a.d)(b.valueType);X&&(this._storedValue=X.hX(b.value))}}}(0,a.h)("BABYLON.ParticleInputBlock",GX);class mP extends FX{get url(){return this._url}set url(b){this._url!==b&&(this._cachedData=null,this._url=b,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(b){this._textureDataUrl!==b&&(this._cachedData=null,this._textureDataUrl=b,this._url="",this._sourceTexture=null)}set sourceTexture(b){this._sourceTexture!==b&&(this._cachedData=null,this._sourceTexture=b,this._url="",this._textureDataUrl="")}constructor(b){super(b),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",pX.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const b=this.texture._storedValue;return await new Promise(((X,P)=>{if(!b.isReady())return void b.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),X(this._cachedData)}catch(b){P(b)}}));const Q=b.getSize();VX.m.GetTextureDataAsync(b,Q.width,Q.height).then((P=>{this._cachedData={width:Q.width,height:Q.height,data:new Uint8ClampedArray(P)},b.dispose(),X(this._cachedData)})).catch(P)}))}_build(b){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new H.d(this._textureDataUrl,b.WX):this.texture._storedValue=new H.d(this._url,b.WX):this.texture._storedValue=null}serialize(){const b=super.serialize();return b.url=this.url,b.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(b.textureDataUrl=this.textureDataUrl),b}_deserialize(b){super._deserialize(b),this.url=b.url,this.serializedCachedData=!!b.serializedCachedData,b.textureDataUrl&&(this.textureDataUrl=b.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,a.h)("BABYLON.ParticleTextureSourceBlock",mP);class bP extends FX{constructor(b){super(b),this.registerInput("particle",pX.Particle),this.registerInput("position",pX.tX),this.registerOutput("output",pX.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(b){const X=this.particle.getConnectedValue(b);if(this.output._storedValue=X,!this.position.isConnected)return;const P={process:P=>{b.particleContext=P,b.systemContext=X,P.position.N(this.position.getConnectedValue(b))},previousItem:null,nextItem:null};X._updateQueueStart?jb(P,X._updateQueueStart):X._updateQueueStart=P}}(0,a.h)("BABYLON.UpdatePositionBlock",bP),function(b){b[b.Add=0]="Add",b[b.Subtract=1]="Subtract",b[b.Multiply=2]="Multiply",b[b.Divide=3]="Divide",b[b.Max=4]="Max",b[b.Min=5]="Min"}(lX||(lX={}));class XP extends FX{constructor(b){super(b),this.operation=lX.Add,this.registerInput("left",pX.AutoDetect),this.registerInput("right",pX.AutoDetect),this.registerOutput("output",pX.BasedOnInput),this.output._typeConnectionSource=this.left;const X=[pX.Matrix,pX.Particle,pX.Texture,pX.System,pX.FloatGradient,pX.Color4Gradient,pX.Vector2Gradient,pX.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...X),this.right.excludedConnectionPointTypes.push(...X),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(b){let X;const P=this.left,S=this.right;if(!P.isConnected||!S.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const d=P.type===pX.Float||P.type===pX.Int,a=S.type===pX.Float||S.type===pX.Int,u=d&&a;switch(this.operation){case lX.Add:X=u?b=>P.getConnectedValue(b)+S.getConnectedValue(b):d?b=>b.adapt(P,S.type).add(S.getConnectedValue(b)):b=>P.getConnectedValue(b).add(b.adapt(S,P.type));break;case lX.Subtract:X=u?b=>P.getConnectedValue(b)-S.getConnectedValue(b):d?b=>b.adapt(P,S.type).BX(S.getConnectedValue(b)):b=>P.getConnectedValue(b).BX(b.adapt(S,P.type));break;case lX.Multiply:X=u?b=>P.getConnectedValue(b)*S.getConnectedValue(b):d?b=>b.adapt(P,S.type).multiply(S.getConnectedValue(b)):b=>P.getConnectedValue(b).multiply(b.adapt(S,P.type));break;case lX.Divide:X=u?b=>P.getConnectedValue(b)/S.getConnectedValue(b):d?b=>b.adapt(P,S.type).divide(S.getConnectedValue(b)):b=>P.getConnectedValue(b).divide(b.adapt(S,P.type));break;case lX.Min:if(u)X=b=>Math.min(P.getConnectedValue(b),S.getConnectedValue(b));else{const[b,a]=d?[S,P]:[P,S];switch(b.type){case pX.Vector2:X=X=>Q.Vector2.Minimize(b.getConnectedValue(X),X.adapt(a,b.type));break;case pX.tX:X=X=>Q.tX.Minimize(b.getConnectedValue(X),X.adapt(a,b.type));break;case pX.Ba:X=X=>{const P=b.getConnectedValue(X),{r:Q,g:S,b:d,a:u}=X.adapt(a,b.type);return new N.Ba(Math.min(P.r,Q),Math.min(P.g,S),Math.min(P.b,d),Math.min(P.a,u))}}}break;case lX.Max:if(!u){const[b,a]=d?[S,P]:[P,S];switch(b.type){case pX.Vector2:X=X=>Q.Vector2.Maximize(b.getConnectedValue(X),X.adapt(a,b.type));break;case pX.tX:X=X=>Q.tX.Maximize(b.getConnectedValue(X),X.adapt(a,b.type));break;case pX.Ba:X=X=>{const P=b.getConnectedValue(X),{r:Q,g:S,b:d,a:u}=X.adapt(a,b.type);return new N.Ba(Math.max(P.r,Q),Math.min(P.g,S),Math.min(P.b,d),Math.min(P.a,u))}}break}X=b=>Math.max(P.getConnectedValue(b),S.getConnectedValue(b))}this.output._storedFunction=b=>P.type===pX.Int?0|X(b):X(b)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===pX.Int||this.left.type===pX.Float&&this.right.type!==pX.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[b,X]of[[this.left,this.right],[this.right,this.left]])b.acceptedConnectionPointTypes=[pX.Int,pX.Float],X.isConnected&&(b.acceptedConnectionPointTypes.push(X.type),X.type!==pX.Int&&X.type!==pX.Float||b.acceptedConnectionPointTypes.push(pX.Vector2,pX.tX,pX.Ba))}dispose(){super.dispose();for(const b of this._connectionObservers)b.remove();this._connectionObservers.length=0}serialize(){const b=super.serialize();return b.operation=this.operation,b}_deserialize(b){super._deserialize(b),this.operation=b.operation}}(0,V.b)([MX("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:lX.Add},{label:"Subtract",value:lX.Subtract},{label:"Multiply",value:lX.Multiply},{label:"Divide",value:lX.Divide},{label:"Max",value:lX.Max},{label:"Min",value:lX.Min}]})],XP.prototype,"operation",void 0),(0,a.h)("BABYLON.ParticleMathBlock",XP);class PP extends FX{constructor(b){super(b),this.registerInput("particle",pX.Particle),this.registerInput("direction1",pX.tX,!0,new Q.tX(0,1,0)),this.registerInput("direction2",pX.tX,!0,new Q.tX(0,1,0)),this.registerInput("minEmitBox",pX.tX,!0,new Q.tX(-.5,-.5,-.5)),this.registerInput("maxEmitBox",pX.tX,!0,new Q.tX(.5,.5,.5)),this.registerOutput("output",pX.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(b){const X=this.particle.getConnectedValue(b);X._directionCreation.process=P=>{b.particleContext=P,b.systemContext=X;const S=this.direction1.getConnectedValue(b),d=this.direction2.getConnectedValue(b),N=(0,w.RandomRange)(S.x,d.x),a=(0,w.RandomRange)(S.y,d.y),u=(0,w.RandomRange)(S.z,d.z);b.isEmitterTransformNode?Q.tX.TransformNormalFromFloatsToRef(N,a,u,b.emitterWorldMatrix,P.direction):P.direction.sd(N,a,u)},X._positionCreation.process=P=>{b.particleContext=P,b.systemContext=X;const S=this.minEmitBox.getConnectedValue(b),d=this.maxEmitBox.getConnectedValue(b),N=(0,w.RandomRange)(S.x,d.x),a=(0,w.RandomRange)(S.y,d.y),u=(0,w.RandomRange)(S.z,d.z);b.isEmitterTransformNode?Q.tX.TransformCoordinatesFromFloatsToRef(N,a,u,b.emitterWorldMatrix,P.position):(P.position.sd(N,a,u),P.position.addInPlace(b.emitterPosition))},this.output._storedValue=X}}(0,a.h)("BABYLON.BoxShapeBlock",PP);class QP extends FX{constructor(b){super(b),this.registerInput("emitPower",pX.Float,!0,1),this.registerInput("lifeTime",pX.Float,!0,1),this.registerInput("color",pX.Ba,!0,new N.Ba(1,1,1,1)),this.registerInput("scale",pX.Vector2,!0,new Q.Vector2(1,1)),this.registerInput("angle",pX.Float,!0,0),this.registerOutput("particle",pX.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(b){const X=new aX(this.name,b.zX,b.WX,null,!1,void 0,!0);X.particleEmitterType=new B,X._lifeTimeCreation.process=(X,P)=>{b.particleContext=X,X.lifeTime=this.lifeTime.getConnectedValue(b),P._emitPower=this.emitPower.getConnectedValue(b)},X._colorCreation.process=X=>{b.particleContext=X,X.color.N(this.color.getConnectedValue(b))},X._sizeCreation.process=X=>{b.particleContext=X,X.size=1,X.scale.N(this.scale.getConnectedValue(b))},X._angleCreation.process=X=>{b.particleContext=X,X.angle=this.angle.getConnectedValue(b)},this.particle._storedValue=X}}(0,a.h)("BABYLON.CreateParticleBlock",QP);class SP{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const b=[];for(const X of this.attachedBlocks)X.isInput&&b.push(X);return b}constructor(b){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new r.d,this.name=b}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(b){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(b)&&this.attachedBlocks.push(b);for(const P of b.inputs){const Q=P.connectedPoint;if(Q){const P=Q.ownerBlock;P!==b&&this._initializeBlock(P,X)}}}async buildAsync(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((P=>{const Q=new ZX;for(const b of this._systemBlocks)this._initializeBlock(b);for(const S of this.systemBlocks){const P=new RX;P.buildId=this._buildId++,P.WX=b,P.verbose=X;const d=S.createSystem(P);P.emitErrors(),Q.systems.push(d)}this.onBuildObservable.notifyObservers(this),P(Q)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const b=new IX("Particle system"),X=new bP("Update position");X.output.connectTo(b.particle);const P=new GX("Position");P.contextualValue=gX.Position;const Q=new GX("Scaled direction");Q.contextualValue=gX.ScaledDirection;const S=new XP("Add");S.operation=lX.Add,P.output.connectTo(S.left),Q.output.connectTo(S.right),S.output.connectTo(X.position);const d=new QP("Create particle"),N=new PP("Box shape");d.particle.connectTo(N.particle),N.output.connectTo(X.particle);const a=new mP("Texture");a.texture.connectTo(b.texture),a.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(b)}removeBlock(b){const X=this.attachedBlocks.indexOf(b);if(X>-1&&this.attachedBlocks.splice(X,1),b.isSystem){const X=this._systemBlocks.indexOf(b);X>-1&&this._systemBlocks.splice(X,1)}}parseSerializedObject(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];X||this.clear();const P={};for(const Q of b.Of){const b=(0,a.d)(Q.customType);if(b){const X=new b;X._deserialize(Q),P[Q.id]=X,this.attachedBlocks.push(X),X.isSystem&&this._systemBlocks.push(X)}}for(const Q of this.attachedBlocks)if(Q.isTeleportOut){const b=Q,X=b._tempEntryPointUniqueId;if(X){const Q=P[X];Q&&Q.attachToEndpoint(b)}}for(let Q=0;Q<b.Of.length;Q++){const S=b.Of[Q],d=P[S.id];d&&(d.inputs.length&&S.inputs.some((b=>b.targetConnectionName))&&!X||this._restoreConnections(d,b,P))}if(b.locations||b.editorData&&b.editorData.locations){const Q=b.locations||b.editorData.locations;for(const b of Q)P[b.IQ]&&(b.IQ=P[b.IQ].uniqueId);X&&this.editorData&&this.editorData.locations&&Q.concat(this.editorData.locations),b.locations?this.editorData={locations:Q}:(this.editorData=b.editorData,this.editorData.locations=Q);const S=[];for(const b in P)S[b]=P[b].uniqueId;this.editorData.map=S}this.comment=b.comment}_restoreConnections(b,X,P){for(const Q of b.outputs)for(const S of X.Of){const d=P[S.id];if(d)for(const N of S.inputs)if(P[N.targetBlockId]!==b||N.targetConnectionName!==Q.name);else{const b=d.getInputByName(N.inputName);if(!b||b.isConnected)continue;Q.connectTo(b,!0),this._restoreConnections(d,X,P)}}}serialize(b){const X=b?{}:x.b.Serialize(this);X.editorData=JSON.parse(JSON.stringify(this.editorData));let P=[];b?P=b:X.customType="BABYLON.NodeParticleSystemSet",X.Of=[];for(const Q of P)X.Of.push(Q.serialize());if(!b)for(const Q of this.attachedBlocks)-1===P.indexOf(Q)&&X.Of.push(Q.serialize());return X}dispose(){for(const b of this.attachedBlocks)b.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(b){const X=new SP(b);return X.setToDefault(),X}static Parse(b){const X=x.b.Parse((()=>new SP(b.name)),b,null);return X.parseSerializedObject(b),X}static ParseFromSnippetAsync(b,X){return"_BLANK"===b?Promise.resolve(SP.CreateDefault("blank")):new Promise(((P,Q)=>{const S=new vX.c;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const N=JSON.parse(JSON.parse(S.responseText).jsonPayload),a=JSON.parse(N.nodeParticle);X||(X=x.b.Parse((()=>new SP(b)),a,null)),X.parseSerializedObject(a),X.snippetId=b;try{P(X)}catch(d){Q(d)}}else Q("Unable to load the snippet "+b)})),S.open("GET",this.SnippetUrl+"/"+b.replace(/#/g,"/")),S.send()}))}}SP.EditorURL=`${yX.Tools._DefaultCdnUrl}/v${Mb.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,SP.SnippetUrl="https://snippet.babylonjs.com",(0,V.b)([(0,i.E)()],SP.prototype,"name",void 0),(0,V.b)([(0,i.E)("comment")],SP.prototype,"comment",void 0),function(b){b[b.None=0]="None",b[b.PerParticle=1]="PerParticle",b[b.PerSystem=2]="PerSystem"}(JX||(JX={}));class dP extends FX{constructor(b){super(b),this._currentLockId=-2,this.lockMode=JX.PerParticle,this.registerInput("min",pX.AutoDetect,!0,0),this.registerInput("max",pX.AutoDetect,!0,1),this.registerOutput("output",pX.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(pX.Float|pX.Int|pX.Vector2|pX.tX|pX.Ba),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(pX.Float|pX.Int|pX.Vector2|pX.tX|pX.Ba),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=pX.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let b=null;switch(this._currentLockId=-2,this.min.type){case pX.AutoDetect:case pX.Int:case pX.Float:b=b=>{const X=this.min.getConnectedValue(b)||0,P=this.max.getConnectedValue(b)||1;return X+Math.random()*(P-X)};break;case pX.Vector2:b=b=>{const X=this.min.getConnectedValue(b)||Q.Vector2.Zero(),P=this.max.getConnectedValue(b)||Q.Vector2.One();return new Q.Vector2(X.x+Math.random()*(P.x-X.x),X.y+Math.random()*(P.y-X.y))};break;case pX.tX:b=b=>{const X=this.min.getConnectedValue(b)||Q.tX.Zero(),P=this.max.getConnectedValue(b)||Q.tX.One();return new Q.tX(X.x+Math.random()*(P.x-X.x),X.y+Math.random()*(P.y-X.y),X.z+Math.random()*(P.z-X.z))};break;case pX.Ba:b=b=>{const X=this.min.getConnectedValue(b)||new N.Ba(0,0,0,0),P=this.max.getConnectedValue(b)||new N.Ba(1,1,1,1);return new N.Ba(X.x+Math.random()*(P.x-X.x),X.y+Math.random()*(P.y-X.y),X.z+Math.random()*(P.z-X.z),X.w+Math.random()*(P.w-X.w))}}this.output._storedFunction=X=>{var P;let Q=0;switch(this.lockMode){case JX.PerParticle:Q=(null===(P=X.particleContext)||void 0===P?void 0:P.id)||-1;break;case JX.PerSystem:Q=X.buildId||0}return this._currentLockId!==Q&&(this.lockMode!==JX.None&&(this._currentLockId=Q),this.output._storedValue=b(X)),this.output._storedValue}}serialize(){const b=super.serialize();return b.lockMode=this.lockMode,b}_deserialize(b){super._deserialize(b),this.lockMode=b.lockMode}}(0,V.b)([MX("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:JX.None},{label:"Per particle",value:JX.PerParticle},{label:"Per system",value:JX.PerSystem}]})],dP.prototype,"lockMode",void 0),(0,a.h)("BABYLON.ParticleRandomBlock",dP);class NP extends FX{constructor(b){super(b),this._currentLockId=-2,this.lockMode=JX.PerParticle,this.registerInput("min",pX.AutoDetect),this.registerInput("max",pX.AutoDetect),this.registerOutput("output",pX.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const X=[pX.Matrix,pX.Particle,pX.Texture,pX.System,pX.FloatGradient,pX.Color4Gradient,pX.Vector2Gradient,pX.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...X),this.max.excludedConnectionPointTypes.push(...X)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let b=null;switch(this._currentLockId=-2,this.min.type){case pX.Float:case pX.Int:b=b=>{const X=this.min.getConnectedValue(b),P=this.max.getConnectedValue(b);return Math.random()*(P-X)+X};break;case pX.Vector2:b=b=>{const X=this.min.getConnectedValue(b),P=this.max.getConnectedValue(b);return new Q.Vector2(Math.random()*(P.x-X.x)+X.x,Math.random()*(P.y-X.y)+X.y)};break;case pX.tX:b=b=>{const X=this.min.getConnectedValue(b),P=this.max.getConnectedValue(b);return new Q.tX(Math.random()*(P.x-X.x)+X.x,Math.random()*(P.y-X.y)+X.y,Math.random()*(P.z-X.z)+X.z)};break;case pX.Ba:b=b=>{const X=this.min.getConnectedValue(b),P=this.max.getConnectedValue(b);return new N.Ba(Math.random()*(P.r-X.r)+X.r,Math.random()*(P.g-X.g)+X.g,Math.random()*(P.b-X.b)+X.b,Math.random()*(P.a-X.a)+X.a)}}this.output._storedFunction=X=>{var P;let Q=0;switch(this.lockMode){case JX.PerParticle:Q=(null===(P=X.particleContext)||void 0===P?void 0:P.id)||-1;break;case JX.PerSystem:Q=X.buildId||0}return this._currentLockId!==Q&&(this.lockMode!==JX.None&&(this._currentLockId=Q),this.output._storedValue=b(X)),this.output._storedValue}}serialize(){const b=super.serialize();return b.lockMode=this.lockMode,b}_deserialize(b){super._deserialize(b),void 0!==b.lockMode&&(this.lockMode=b.lockMode)}}(0,V.b)([MX("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:JX.None},{label:"Per particle",value:JX.PerParticle},{label:"Per system",value:JX.PerSystem}]})],NP.prototype,"lockMode",void 0),(0,a.h)("BABYLON.RandomRangeBlock",NP);(0,a.h)("BABYLON.ParticleLerpBlock",class extends FX{constructor(b){super(b),this.registerInput("left",pX.AutoDetect),this.registerInput("right",pX.AutoDetect),this.registerInput("gradient",pX.Float,!0,0,0,1),this.registerOutput("output",pX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(pX.Float|pX.Int|pX.Vector2|pX.tX|pX.Ba)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const b=(b,X,P)=>(1-b)*X+b*P;this.output._storedFunction=X=>{const P=this.left.getConnectedValue(X),S=this.right.getConnectedValue(X),d=this.gradient.getConnectedValue(X);switch(this.left.type){case pX.Int:case pX.Float:return b(d,P,S);case pX.Vector2:return new Q.Vector2(b(d,P.x,S.x),b(d,P.y,S.y));case pX.tX:return new Q.tX(b(d,P.x,S.x),b(d,P.y,S.y),b(d,P.z,S.z));case pX.Ba:return new N.Ba(b(d,P.r,S.r),b(d,P.g,S.g),b(d,P.b,S.b),b(d,P.a,S.a))}return 0}}});(0,a.h)("BABYLON.UpdateDirectionBlock",class extends FX{constructor(b){super(b),this.registerInput("particle",pX.Particle),this.registerInput("direction",pX.tX),this.registerOutput("output",pX.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(b){const X=this.particle.getConnectedValue(b);if(this.output._storedValue=X,!this.direction.isConnected)return;const P={process:P=>{b.particleContext=P,b.systemContext=X,P.direction.N(this.direction.getConnectedValue(b))},previousItem:null,nextItem:null};X._updateQueueStart?jb(P,X._updateQueueStart):X._updateQueueStart=P}});(0,a.h)("BABYLON.UpdateColorBlock",class extends FX{constructor(b){super(b),this.registerInput("particle",pX.Particle),this.registerInput("color",pX.Ba),this.registerOutput("output",pX.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(b){const X=this.particle.getConnectedValue(b);if(this.output._storedValue=X,!this.color.isConnected)return;const P={process:P=>{b.particleContext=P,b.systemContext=X,P.color.N(this.color.getConnectedValue(b))},previousItem:null,nextItem:null};X._updateQueueStart?jb(P,X._updateQueueStart):X._updateQueueStart=P}});(0,a.h)("BABYLON.UpdateScaleBlock",class extends FX{constructor(b){super(b),this.registerInput("particle",pX.Particle),this.registerInput("scale",pX.Vector2),this.registerOutput("output",pX.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(b){const X=this.particle.getConnectedValue(b);if(this.output._storedValue=X,!this.scale.isConnected)return;const P={process:P=>{b.particleContext=P,b.systemContext=X,P.scale.N(this.scale.getConnectedValue(b))},previousItem:null,nextItem:null};X._updateQueueStart?jb(P,X._updateQueueStart):X._updateQueueStart=P}});(0,a.h)("BABYLON.UpdateAngleBlock",class extends FX{constructor(b){super(b),this.registerInput("particle",pX.Particle),this.registerInput("angle",pX.Float),this.registerOutput("output",pX.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(b){const X=this.particle.getConnectedValue(b);if(this.output._storedValue=X,!this.angle.isConnected)return;const P={process:P=>{b.particleContext=P,b.systemContext=X,P.angle=this.angle.getConnectedValue(b)},previousItem:null,nextItem:null};X._updateQueueStart?jb(P,X._updateQueueStart):X._updateQueueStart=P}});(0,a.h)("BABYLON.BasicPositionUpdateBlock",class extends FX{constructor(b){super(b),this.registerInput("particle",pX.Particle),this.registerOutput("output",pX.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(b){const X=this.particle.getConnectedValue(b),P={process:P=>{b.particleContext=P,b.systemContext=X,P.direction.scaleToRef(X._directionScale,X._scaledDirection),P.position.addInPlace(X._scaledDirection)},previousItem:null,nextItem:null};X._updateQueueStart?jb(P,X._updateQueueStart):X._updateQueueStart=P,this.output._storedValue=X}});(0,a.h)("BABYLON.BasicSpriteUpdateBlock",class extends FX{constructor(b){super(b),this.registerInput("particle",pX.Particle),this.registerOutput("output",pX.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(b){const X=this.particle.getConnectedValue(b),P={process:P=>{b.particleContext=P,b.systemContext=X,P.updateCellIndex()},previousItem:null,nextItem:null};X._updateQueueStart?jb(P,X._updateQueueStart):X._updateQueueStart=P,this.output._storedValue=X}});(0,a.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends FX{constructor(b){super(b),this.registerInput("particle",pX.Particle),this.registerInput("cellIndex",pX.Int),this.registerOutput("output",pX.Particle),this.cellIndex.acceptedConnectionPointTypes=[pX.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(b){const X=this.particle.getConnectedValue(b);if(this.output._storedValue=X,!this.cellIndex.isConnected)return;const P={process:P=>{b.particleContext=P,b.systemContext=X,P.cellIndex=Math.floor(this.cellIndex.getConnectedValue(b))},previousItem:null,nextItem:null};X._updateQueueStart?jb(P,X._updateQueueStart):X._updateQueueStart=P}});class aP extends FX{constructor(b){super(b),this.strength=1,this.registerInput("particle",pX.Particle),this.registerInput("flowMap",pX.Texture),this.registerOutput("output",pX.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(b){var X;const P=this.particle.getConnectedValue(b),Q=b.WX;let S;(null===(X=this.flowMap.connectedPoint)||void 0===X?void 0:X.ownerBlock).extractTextureContentAsync().then((b=>{b&&(S=new CX(b.width,b.height,b.data))}));const d={process:b=>{const X=Q.getTransformMatrix();S&&S._processParticle(b,this.strength*P._tempScaledUpdateSpeed,X)},previousItem:null,nextItem:null};P._updateQueueStart?jb(d,P._updateQueueStart):P._updateQueueStart=d,this.output._storedValue=P}serialize(){const b=super.serialize();return b.strength=this.strength,b}_deserialize(b){super._deserialize(b),this.strength=b.strength}}(0,V.b)([MX("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aP.prototype,"strength",void 0),(0,a.h)("BABYLON.UpdateFlowMapBlock",aP);(0,a.h)("BABYLON.SphereShapeBlock",class extends FX{constructor(b){super(b),this.registerInput("input",pX.Particle),this.registerInput("radius",pX.Float,!0,1),this.registerInput("radiusRange",pX.Float,!0,1,0,1),this.registerInput("directionRandomizer",pX.Float,!0,0,0,1),this.registerOutput("output",pX.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(b){const X=this.input.getConnectedValue(b);X._directionCreation.process=P=>{b.particleContext=P,b.systemContext=X;const S=this.directionRandomizer.getConnectedValue(b),d=P.position.BX(b.emitterPosition).normalize(),N=(0,w.RandomRange)(0,S),a=(0,w.RandomRange)(0,S),u=(0,w.RandomRange)(0,S);d.x+=N,d.y+=a,d.z+=u,d.normalize(),b.isEmitterTransformNode?Q.tX.TransformNormalFromFloatsToRef(N,a,u,b.emitterWorldMatrix,P.direction):P.direction.sd(N,a,u)},X._positionCreation.process=P=>{b.particleContext=P,b.systemContext=X;const S=this.radius.getConnectedValue(b),d=this.radiusRange.getConnectedValue(b),N=S-(0,w.RandomRange)(0,S*d),a=(0,w.RandomRange)(0,1),u=(0,w.RandomRange)(0,2*Math.PI),f=Math.acos(2*a-1),O=N*Math.cos(u)*Math.sin(f),e=N*Math.cos(f),Y=N*Math.sin(u)*Math.sin(f);b.isEmitterTransformNode?Q.tX.TransformCoordinatesFromFloatsToRef(O,e,Y,b.emitterWorldMatrix,P.position):(P.position.sd(O,e,Y),P.position.addInPlace(b.emitterPosition))},this.output._storedValue=X}});(0,a.h)("BABYLON.PointShapeBlock",class extends FX{constructor(b){super(b),this.registerInput("particle",pX.Particle),this.registerInput("direction1",pX.tX,!0,new Q.tX(0,1,0)),this.registerInput("direction2",pX.tX,!0,new Q.tX(0,1,0)),this.registerOutput("output",pX.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(b){const X=this.particle.getConnectedValue(b);X._directionCreation.process=P=>{b.particleContext=P,b.systemContext=X;const S=this.direction1.getConnectedValue(b),d=this.direction2.getConnectedValue(b),N=(0,w.RandomRange)(S.x,d.x),a=(0,w.RandomRange)(S.y,d.y),u=(0,w.RandomRange)(S.z,d.z);b.isEmitterTransformNode?Q.tX.TransformNormalFromFloatsToRef(N,a,u,b.emitterWorldMatrix,P.direction):P.direction.sd(N,a,u)},X._positionCreation.process=P=>{b.systemContext=X,b.isEmitterTransformNode?Q.tX.TransformCoordinatesFromFloatsToRef(0,0,0,b.emitterWorldMatrix,P.position):P.position.N(b.emitterPosition)},this.output._storedValue=X}});(0,a.h)("BABYLON.CustomShapeBlock",class extends FX{constructor(b){super(b),this.registerInput("particle",pX.Particle),this.registerInput("position",pX.tX,!0,new Q.tX(0,0,0)),this.registerInput("direction",pX.tX,!0,new Q.tX(0,1,0)),this.registerOutput("output",pX.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(b){const X=this.particle.getConnectedValue(b);X._directionCreation.process=P=>{b.particleContext=P,b.systemContext=X;const S=this.direction.getConnectedValue(b);b.isEmitterTransformNode?Q.tX.TransformNormalToRef(S,b.emitterWorldMatrix,P.direction):P.direction.N(S)},X._positionCreation.process=P=>{b.particleContext=P,b.systemContext=X;const S=this.position.getConnectedValue(b);b.isEmitterTransformNode?Q.tX.TransformCoordinatesToRef(S,b.emitterWorldMatrix,P.position):(P.position.N(S),P.position.addInPlace(b.emitterPosition))},this.output._storedValue=X}});(0,a.h)("BABYLON.CylinderShapeBlock",class extends FX{constructor(b){super(b),this._tempVector=Q.tX.Zero(),this.registerInput("particle",pX.Particle),this.registerInput("radius",pX.Float,!0,1),this.registerInput("height",pX.Float,!0,1,0),this.registerInput("radiusRange",pX.Float,!0,1,0,1),this.registerInput("directionRandomizer",pX.Float,!0,0,0,1),this.registerOutput("output",pX.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(b){const X=this.particle.getConnectedValue(b);X._directionCreation.process=P=>{b.particleContext=P,b.systemContext=X;const S=this.directionRandomizer.getConnectedValue(b);P.position.subtractToRef(b.emitterPosition,this._tempVector),this._tempVector.normalize(),b.isEmitterTransformNode&&Q.tX.TransformNormalToRef(this._tempVector,b.emitterInverseWorldMatrix,this._tempVector);const d=(0,w.RandomRange)(-S/2,S/2);let N=Math.atan2(this._tempVector.x,this._tempVector.z);N+=(0,w.RandomRange)(-Math.PI/2,Math.PI/2)*S,this._tempVector.y=d,this._tempVector.x=Math.sin(N),this._tempVector.z=Math.cos(N),this._tempVector.normalize(),b.isEmitterTransformNode?Q.tX.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,b.emitterWorldMatrix,P.direction):P.direction.N(this._tempVector)},X._positionCreation.process=P=>{b.particleContext=P,b.systemContext=X;const S=this.height.getConnectedValue(b),d=this.radiusRange.getConnectedValue(b),N=this.radius.getConnectedValue(b),a=(0,w.RandomRange)(-S/2,S/2),u=(0,w.RandomRange)(0,2*Math.PI),f=(0,w.RandomRange)((1-d)*(1-d),1),O=Math.sqrt(f)*N,e=O*Math.cos(u),Y=O*Math.sin(u);b.isEmitterTransformNode?Q.tX.TransformCoordinatesFromFloatsToRef(e,a,Y,b.emitterWorldMatrix,P.position):(P.position.sd(e,a,Y),P.position.addInPlace(b.emitterPosition))},this.output._storedValue=X}});class uP extends FX{constructor(b){super(b),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",pX.Particle),this.registerOutput("output",pX.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(b){super._build(b);const X=this.particle.getConnectedValue(b);X._isAnimationSheetEnabled=!0,X.spriteCellWidth=this.width,X.spriteCellHeight=this.height,X.startSpriteCellID=this.start,X.endSpriteCellID=this.end,X.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=X}serialize(){const b=super.serialize();return b.width=this.width,b.height=this.height,b.start=this.start,b.end=this.end,b.randomStartCell=this.randomStartCell,b}_deserialize(b){super._deserialize(b),this.width=b.width,this.height=b.height,this.start=b.start,this.end=b.end,this.randomStartCell=b.randomStartCell}}(0,V.b)([MX("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uP.prototype,"start",void 0),(0,V.b)([MX("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uP.prototype,"end",void 0),(0,V.b)([MX("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uP.prototype,"width",void 0),(0,V.b)([MX("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uP.prototype,"height",void 0),(0,V.b)([MX("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],uP.prototype,"loop",void 0),(0,V.b)([MX("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],uP.prototype,"randomStartCell",void 0),(0,a.h)("BABYLON.SetupSpriteSheetBlock",uP);class wP extends FX{constructor(b){super(b),this.reference=0,this.registerInput("value",pX.AutoDetect),this.registerOutput("output",pX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=b=>{switch(b){case pX.Float:return pX.FloatGradient;case pX.Vector2:return pX.Vector2Gradient;case pX.tX:return pX.Vector3Gradient;case pX.Ba:return pX.Color4Gradient}return b},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(pX.Float|pX.Vector2|pX.tX|pX.Ba)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=b=>null}serialize(){const b=super.serialize();return b.reference=this.reference,b}_deserialize(b){super._deserialize(b),this.reference=b.reference}}(0,V.b)([MX("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],wP.prototype,"reference",void 0),(0,a.h)("BABYLON.ParticleGradientValueBlock",wP);(0,a.h)("BABYLON.ParticleGradientBlock",class extends FX{constructor(b){super(b),this._entryCount=1,this.registerInput("gradient",pX.Float,!0,1,0,1),this.registerInput("value0",pX.AutoDetect),this.registerOutput("output",pX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=b=>{switch(b){case pX.FloatGradient:return pX.Float;case pX.Vector2Gradient:return pX.Vector2;case pX.Vector3Gradient:return pX.tX;case pX.Color4Gradient:return pX.Ba}return b},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(pX.FloatGradient|pX.Vector2Gradient|pX.Vector3Gradient|pX.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(b){this._inputs[b].onConnectionObservable.add((()=>{this._entryCount>b||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),pX.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const b=[];for(let P=1;P<this._inputs.length;P++){var X;if(this._inputs[P].isConnected)b.push(null===(X=this._inputs[P].connectedPoint)||void 0===X?void 0:X.ownerBlock)}b.sort(((b,X)=>b.reference-X.reference)),this.output._storedFunction=X=>{const P=this.gradient.getConnectedValue(X);if(1===b.length)return b[0].value.getConnectedValue(X);let S=null;for(let d=b.length-1;d>=0;d--){const a=b[d];if(a.reference<=P){const b=a.value.getConnectedValue(X);if(S){const d=S.value.getConnectedValue(X),u=S.reference,f=a.reference,O=Math.max(0,Math.min(1,(P-f)/(u-f)));switch(this.output.type){case pX.Float:return(0,w.Lerp)(b,d,O);case pX.Vector2:return Q.Vector2.Lerp(b,d,O);case pX.tX:return Q.tX.Lerp(b,d,O);case pX.Ba:return N.Ba.Lerp(b,d,O)}}return b}S=a}return 0}}});(0,a.h)("BABYLON.ParticleConverterBlock",class extends FX{constructor(b){super(b),this.registerInput("color ",pX.Ba,!0),this.registerInput("xyz ",pX.tX,!0),this.registerInput("xy ",pX.Vector2,!0),this.registerInput("zw ",pX.Vector2,!0),this.registerInput("x ",pX.Float,!0),this.registerInput("y ",pX.Float,!0),this.registerInput("z ",pX.Float,!0),this.registerInput("w ",pX.Float,!0),this.registerOutput("color",pX.Ba),this.registerOutput("xyz",pX.tX),this.registerOutput("xy",pX.Vector2),this.registerOutput("zw",pX.Vector2),this.registerOutput("x",pX.Float),this.registerOutput("y",pX.Float),this.registerOutput("z",pX.Float),this.registerOutput("w",pX.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(b){return"color "===b?"colorIn":"xyz "===b?"xyzIn":"xy "===b?"xyIn":"zw "===b?"zwIn":"x "===b?"xIn":"y "===b?"yIn":"z "===b?"zIn":"w "===b?"wIn":b}_outputRename(b){switch(b){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return b}}_build(b){super._build(b);const X=this.xIn,P=this.yIn,S=this.zIn,d=this.wIn,a=this.xyIn,u=this.zwIn,w=this.xyzIn,f=this.colorIn,O=this.colorOut,e=this.xyzOut,Y=this.xyOut,D=this.zwOut,E=this.xOut,t=this.yOut,B=this.zOut,W=this.wOut,n=b=>{if(f.isConnected)return f.getConnectedValue(b);let Q=0,O=0,e=0,Y=0;if(X.isConnected&&(Q=X.getConnectedValue(b)),P.isConnected&&(O=P.getConnectedValue(b)),S.isConnected&&(e=S.getConnectedValue(b)),d.isConnected&&(Y=d.getConnectedValue(b)),a.isConnected){const X=a.getConnectedValue(b);X&&(Q=X.x,O=X.y)}if(u.isConnected){const X=u.getConnectedValue(b);X&&(e=X.x,Y=X.y)}if(w.isConnected){const X=w.getConnectedValue(b);X&&(Q=X.x,O=X.y,e=X.z)}return new N.Ba(Q,O,e,Y)};O._storedFunction=b=>n(b),e._storedFunction=b=>{const X=n(b);return new Q.tX(X.r,X.g,X.b)},Y._storedFunction=b=>{const X=n(b);return new Q.Vector2(X.r,X.g)},D._storedFunction=b=>{const X=n(b);return new Q.Vector2(X.b,X.a)},E._storedFunction=b=>n(b).r,t._storedFunction=b=>n(b).g,B._storedFunction=b=>n(b).b,W._storedFunction=b=>n(b).a}}),function(b){b[b.Cos=0]="Cos",b[b.Sin=1]="Sin",b[b.Abs=2]="Abs",b[b.Exp=3]="Exp",b[b.Exp2=4]="Exp2",b[b.Round=5]="Round",b[b.Floor=6]="Floor",b[b.Ceiling=7]="Ceiling",b[b.Sqrt=8]="Sqrt",b[b.Log=9]="Log",b[b.Tan=10]="Tan",b[b.ArcTan=11]="ArcTan",b[b.ArcCos=12]="ArcCos",b[b.ArcSin=13]="ArcSin",b[b.Sign=14]="Sign",b[b.Negate=15]="Negate",b[b.OneMinus=16]="OneMinus",b[b.Reciprocal=17]="Reciprocal",b[b.ToDegrees=18]="ToDegrees",b[b.ToRadians=19]="ToRadians",b[b.Fract=20]="Fract"}(cX||(cX={}));class fP extends FX{constructor(b){super(b),this.operation=cX.Cos,this.registerInput("input",pX.AutoDetect),this.registerOutput("output",pX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(pX.Float|pX.Int|pX.Vector2|pX.tX|pX.Ba)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(b){super._build(b);let X=null;switch(this.operation){case cX.Cos:X=b=>Math.cos(b);break;case cX.Sin:X=b=>Math.sin(b);break;case cX.Abs:X=b=>Math.abs(b);break;case cX.Exp:X=b=>Math.exp(b);break;case cX.Exp2:X=b=>Math.pow(2,b);break;case cX.Round:X=b=>Math.round(b);break;case cX.Floor:X=b=>Math.floor(b);break;case cX.Ceiling:X=b=>Math.ceil(b);break;case cX.Sqrt:X=b=>Math.sqrt(b);break;case cX.Log:X=b=>Math.log(b);break;case cX.Tan:X=b=>Math.tan(b);break;case cX.ArcTan:X=b=>Math.atan(b);break;case cX.ArcCos:X=b=>Math.acos(b);break;case cX.ArcSin:X=b=>Math.asin(b);break;case cX.Sign:X=b=>Math.sign(b);break;case cX.Negate:X=b=>-b;break;case cX.OneMinus:X=b=>1-b;break;case cX.Reciprocal:X=b=>1/b;break;case cX.ToRadians:X=b=>b*Math.PI/180;break;case cX.ToDegrees:X=b=>180*b/Math.PI;break;case cX.Fract:X=b=>b>=0?b-Math.floor(b):b-Math.ceil(b)}if(!X)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case pX.Int:case pX.Float:this.output._storedFunction=b=>{const P=this.input.getConnectedValue(b);return X(P)};break;case pX.Vector2:this.output._storedFunction=b=>{const P=this.input.getConnectedValue(b);return new Q.Vector2(X(P.x),X(P.y))};break;case pX.tX:this.output._storedFunction=b=>{const P=this.input.getConnectedValue(b);return new Q.tX(X(P.x),X(P.y),X(P.z))};break;case pX.Ba:this.output._storedFunction=b=>{const P=this.input.getConnectedValue(b);return new N.Ba(X(P.r),X(P.g),X(P.b),X(P.a))}}return this}serialize(){const b=super.serialize();return b.operation=this.operation,b}_deserialize(b){super._deserialize(b),this.operation=b.operation}}(0,V.b)([MX("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:cX.Cos},{label:"Sin",value:cX.Sin},{label:"Abs",value:cX.Abs},{label:"Exp",value:cX.Exp},{label:"Exp2",value:cX.Exp2},{label:"Round",value:cX.Round},{label:"Floor",value:cX.Floor},{label:"Ceiling",value:cX.Ceiling},{label:"Sqrt",value:cX.Sqrt},{label:"Log",value:cX.Log},{label:"Tan",value:cX.Tan},{label:"ArcTan",value:cX.ArcTan},{label:"ArcCos",value:cX.ArcCos},{label:"ArcSin",value:cX.ArcSin},{label:"Sign",value:cX.Sign},{label:"Negate",value:cX.Negate},{label:"OneMinus",value:cX.OneMinus},{label:"Reciprocal",value:cX.Reciprocal},{label:"ToDegrees",value:cX.ToDegrees},{label:"ToRadians",value:cX.ToRadians},{label:"Fract",value:cX.Fract}]})],fP.prototype,"operation",void 0),(0,a.h)("BABYLON.ParticleTrigonometryBlock",fP);var OP,eP=P(13326);class YP extends FX{constructor(b){super(b),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",pX.AutoDetect),this.registerOutput("output",pX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(pX.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(pX.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(pX.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(pX.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(pX.System),this._inputs[0].excludedConnectionPointTypes.push(pX.Particle),this._inputs[0].excludedConnectionPointTypes.push(pX.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(b){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const X=b=>{const X=this.input.getConnectedValue(b);if(this.log.length>=this.stackSize)return X;if(null===X||void 0===X)return this.log.push(["null",""]),X;switch(this.input.type){case pX.Vector2:this.log.push([(0,eP.f)(X,4),X.toString()]);break;case pX.tX:this.log.push([(0,eP.g)(X,4),X.toString()]);break;case pX.Ba:this.log.push([`{R: ${X.r.toFixed(4)} G: ${X.g.toFixed(4)} B: ${X.b.toFixed(4)} A: ${X.a.toFixed(4)}}`,X.toString()]);break;default:this.log.push([X.toString(),X.toString()])}return X};this.output.isConnected?this.output._storedFunction=X:this.output._storedValue=X(b)}serialize(){const b=super.serialize();return b.stackSize=this.stackSize,b}_deserialize(b){super._deserialize(b),this.stackSize=b.stackSize}}(0,V.b)([MX("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],YP.prototype,"stackSize",void 0),(0,a.h)("BABYLON.ParticleDebugBlock",YP);(0,a.h)("BABYLON.ParticleElbowBlock",class extends FX{constructor(b){super(b),this.registerInput("input",pX.AutoDetect),this.registerOutput("output",pX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(b){super._build(b);const X=this._outputs[0],P=this._inputs[0];X._storedFunction=b=>P.getConnectedValue(b)}});(0,a.h)("BABYLON.ParticleTeleportInBlock",class extends FX{get endpoints(){return this._endpoints}constructor(b){super(b),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",pX.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(b){if(this.getClassName()===b)return!0;for(const X of this.endpoints)if(X.isAnAncestorOfType(b))return!0;return!1}isAnAncestorOf(b){for(const X of this.endpoints){if(X===b)return!0;if(X.isAnAncestorOf(b))return!0}return!1}attachToEndpoint(b){b.detach(),this._endpoints.push(b),b._entryPoint=this,b._outputs[0]._typeConnectionSource=this._inputs[0],b._tempEntryPointUniqueId=null,b.name="> "+this.name}detachFromEndpoint(b){const X=this._endpoints.indexOf(b);-1!==X&&(this._endpoints.splice(X,1),b._outputs[0]._typeConnectionSource=null,b._entryPoint=null)}_build(){for(const b of this._endpoints)b.output._storedFunction=b=>this.input.getConnectedValue(b)}});(0,a.h)("BABYLON.ParticleTeleportOutBlock",class extends FX{constructor(b){super(b),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",pX.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(b){this.entryPoint&&this.entryPoint.build(b)}clone(){const b=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(b),b}serialize(){var b;const X=super.serialize();return X.entryPoint=(null===(b=this.entryPoint)||void 0===b?void 0:b.uniqueId)??"",X}_deserialize(b){super._deserialize(b),this._tempEntryPointUniqueId=b.entryPoint}}),function(b){b[b.Equal=0]="Equal",b[b.NotEqual=1]="NotEqual",b[b.LessThan=2]="LessThan",b[b.GreaterThan=3]="GreaterThan",b[b.LessOrEqual=4]="LessOrEqual",b[b.GreaterOrEqual=5]="GreaterOrEqual",b[b.Xor=6]="Xor",b[b.Or=7]="Or",b[b.And=8]="And"}(OP||(OP={}));class DP extends FX{constructor(b){super(b),this.test=OP.Equal,this.epsilon=0,this.registerInput("left",pX.Float),this.registerInput("right",pX.Float,!0,0),this.registerInput("ifTrue",pX.AutoDetect,!0,1),this.registerInput("ifFalse",pX.AutoDetect,!0,0),this.registerOutput("output",pX.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=pX.Float,this._inputs[0].acceptedConnectionPointTypes.push(pX.Int),this._inputs[1].acceptedConnectionPointTypes.push(pX.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const b=b=>{const X=this.left.getConnectedValue(b),P=this.right.getConnectedValue(b);let Q=!1;switch(this.test){case OP.Equal:Q=(0,w.WithinEpsilon)(X,P,this.epsilon);break;case OP.NotEqual:Q=!(0,w.WithinEpsilon)(X,P,this.epsilon);break;case OP.LessThan:Q=X<P+this.epsilon;break;case OP.GreaterThan:Q=X>P-this.epsilon;break;case OP.LessOrEqual:Q=X<=P+this.epsilon;break;case OP.GreaterOrEqual:Q=X>=P-this.epsilon;break;case OP.Xor:Q=!!X&&!P||!X&&!!P;break;case OP.Or:Q=!!X||!!P;break;case OP.And:Q=!!X&&!!P}return Q};this.output._storedFunction=X=>b(X)?this.ifTrue.getConnectedValue(X):this.ifFalse.getConnectedValue(X)}serialize(){const b=super.serialize();return b.test=this.test,b.epsilon=this.epsilon,b}_deserialize(b){super._deserialize(b),this.test=b.test,void 0!==b.epsilon&&(this.epsilon=b.epsilon)}}(0,V.b)([MX("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:OP.Equal},{label:"NotEqual",value:OP.NotEqual},{label:"LessThan",value:OP.LessThan},{label:"GreaterThan",value:OP.GreaterThan},{label:"LessOrEqual",value:OP.LessOrEqual},{label:"GreaterOrEqual",value:OP.GreaterOrEqual},{label:"Xor",value:OP.Xor},{label:"Or",value:OP.Or},{label:"And",value:OP.And}]})],DP.prototype,"test",void 0),(0,V.b)([MX("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],DP.prototype,"epsilon",void 0),(0,a.h)("BABYLON.ParticleConditionBlock",DP);class EP extends FX{constructor(b){super(b),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",pX.Particle),this.registerInput("condition",pX.Float,!0,0),this.registerInput("system",pX.System),this.registerOutput("output",pX.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(b){this._triggerCount=0;const X=this.input.getConnectedValue(b),P={process:P=>{if(b.particleContext=P,b.systemContext=X,0!==this.condition.getConnectedValue(b)&&(0===this.limit||this._triggerCount<this.limit)){const Q=(new Date).getTime();if(this._previousOne&&Q-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=Q;const S=this.system.getConnectedValue(b);if(S){const Q=rX(S,b.WX,P.position);Q.Nd.addOnce((()=>{this._triggerCount--})),X.Nd.addOnce((()=>{Q.dispose()}))}}},previousItem:null,nextItem:null};X._updateQueueStart?jb(P,X._updateQueueStart):X._updateQueueStart=P,this.output._storedValue=X}serialize(){const b=super.serialize();return b.limit=this.limit,b.delay=this.delay,b}_deserialize(b){super._deserialize(b),void 0!==b.limit&&(this.limit=b.limit),void 0!==b.delay&&(this.delay=b.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,V.b)([MX("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],EP.prototype,"limit",void 0),(0,V.b)([MX("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],EP.prototype,"delay",void 0),(0,a.h)("BABYLON.ParticleTriggerBlock",EP);P(13330),P(13344),P(13356),P(13410)},13402:(b,X,P)=>{"use strict";var Q=P(11765);const S="clipPlaneFragment",d="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13361:(b,X,P)=>{"use strict";var Q=P(11765);const S="clipPlaneFragmentDeclaration",d="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13422:(b,X,P)=>{"use strict";var Q=P(11765);const S="clipPlaneVertex",d="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13415:(b,X,P)=>{"use strict";var Q=P(11765);const S="clipPlaneVertexDeclaration",d="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13406:(b,X,P)=>{"use strict";var Q=P(11765);const S="fogFragment",d="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13394:(b,X,P)=>{"use strict";var Q=P(11765);const S="fogFragmentDeclaration",d="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13426:(b,X,P)=>{"use strict";var Q=P(11765);const S="fogVertex",d="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13420:(b,X,P)=>{"use strict";var Q=P(11765);const S="fogVertexDeclaration",d="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13382:(b,X,P)=>{"use strict";var Q=P(11765);const S="helperFunctions",d="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13367:(b,X,P)=>{"use strict";var Q=P(11765);const S="imageProcessingDeclaration",d="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13386:(b,X,P)=>{"use strict";var Q=P(11765);const S="imageProcessingFunctions",d="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13376:(b,X,P)=>{"use strict";var Q=P(11765);const S="logDepthDeclaration",d="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13404:(b,X,P)=>{"use strict";var Q=P(11765);const S="logDepthFragment",d="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13430:(b,X,P)=>{"use strict";var Q=P(11765);const S="logDepthVertex",d="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";Q.c.IncludesShadersStoreWGSL[S]||(Q.c.IncludesShadersStoreWGSL[S]=d)},13356:(b,X,P)=>{"use strict";P.r(X),P.d(X,{particlesPixelShaderWGSL:()=>N});var Q=P(11765);P(13361),P(13367),P(13376),P(13382),P(13386),P(13394),P(13402),P(13404),P(13406);const S="particlesPixelShader",d="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Q.c.ShadersStoreWGSL[S]||(Q.c.ShadersStoreWGSL[S]=d);const N={name:S,shader:d}},13410:(b,X,P)=>{"use strict";P.r(X),P.d(X,{particlesVertexShaderWGSL:()=>N});var Q=P(11765);P(13415),P(13420),P(13376),P(13422),P(13426),P(13430);const S="particlesVertexShader",d="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Q.c.ShadersStoreWGSL[S]||(Q.c.ShadersStoreWGSL[S]=d);const N={name:S,shader:d}},13263:(b,X,P)=>{"use strict";var Q=P(11765);const S="clipPlaneFragment",d="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13335:(b,X,P)=>{"use strict";var Q=P(11765);const S="clipPlaneFragmentDeclaration",d="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13289:(b,X,P)=>{"use strict";var Q=P(11765);const S="clipPlaneVertex",d="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13352:(b,X,P)=>{"use strict";var Q=P(11765);const S="clipPlaneVertexDeclaration",d="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13272:(b,X,P)=>{"use strict";var Q=P(11765);const S="fogFragment",d="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13257:(b,X,P)=>{"use strict";var Q=P(11765);const S="fogFragmentDeclaration",d="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13294:(b,X,P)=>{"use strict";var Q=P(11765);const S="fogVertex",d="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13280:(b,X,P)=>{"use strict";var Q=P(11765);const S="fogVertexDeclaration",d="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13245:(b,X,P)=>{"use strict";var Q=P(11765);const S="helperFunctions",d="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13234:(b,X,P)=>{"use strict";var Q=P(11765);const S="imageProcessingDeclaration",d="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13250:(b,X,P)=>{"use strict";var Q=P(11765);const S="imageProcessingFunctions",d="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13243:(b,X,P)=>{"use strict";var Q=P(11765);const S="logDepthDeclaration",d="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13267:(b,X,P)=>{"use strict";var Q=P(11765);const S="logDepthFragment",d="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13302:(b,X,P)=>{"use strict";var Q=P(11765);const S="logDepthVertex",d="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";Q.c.IncludesShadersStore[S]||(Q.c.IncludesShadersStore[S]=d)},13330:(b,X,P)=>{"use strict";P.r(X),P.d(X,{particlesPixelShader:()=>N});var Q=P(11765);P(13335),P(13234),P(13243),P(13245),P(13250),P(13257),P(13263),P(13267),P(13272);const S="particlesPixelShader",d="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Q.c.ShadersStore[S]||(Q.c.ShadersStore[S]=d);const N={name:S,shader:d}},13344:(b,X,P)=>{"use strict";P.r(X),P.d(X,{particlesVertexShader:()=>N});var Q=P(11765);P(13352),P(13280),P(13243),P(13289),P(13294),P(13302);const S="particlesVertexShader",d="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Q.c.ShadersStore[S]||(Q.c.ShadersStore[S]=d);const N={name:S,shader:d}},13683:(b,X,P)=>{"use strict";P.r(X),P.d(X,{FlowGraphGLTFDataProvider:()=>d});var Q=P(13647),S=P(13631);class d extends Q.c{constructor(b){var X,P;super();const Q=b.glTF,d=(null===(X=Q.animations)||void 0===X?void 0:X.map((b=>b._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",S.e,d);const N=(null===(P=Q.nodes)||void 0===P?void 0:P.map((b=>b._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",S.e,N)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13570:(b,X,P)=>{"use strict";P.d(X,{d:()=>t,e:()=>D,i:()=>Y,j:()=>E});var Q=P(11834),S=P(12348),d=P(11878),N=P(13577);const a=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class u{constructor(b,X){this._gltf=b,this._infoTree=X}convert(b){let X,P=this._gltf,Q=this._infoTree;if(!b.startsWith("/"))throw new Error("Path must start with a /");const S=b.split("/");if(S.shift(),S[S.length-1].includes(".length")){const b=S[S.length-1].split(".");S.pop(),S.push(...b)}let d=!1;for(const u of S){const S="length"===u;if(S&&!Q.__array__)throw new Error(`Path ${b} is invalid`);if(Q.__ignoreObjectTree__&&(d=!0),Q.__array__&&!S)Q=Q.__array__;else if(Q=Q[u],!Q)throw new Error(`Path ${b} is invalid`);if(!d)if(void 0===P){if(!a.find((X=>X.regex.test(b))))throw new Error(`Path ${b} is invalid`)}else if(!S){var N;P=null===(N=P)||void 0===N?void 0:N[u]}(Q.__target__||S)&&(X=P)}return{object:X,info:Q}}}function w(b,X,P,Q){const S=f(b,X);return Q?S[P][Q]:S[P]}function f(b,X,P){var Q,d;return null===(Q=b._data)||void 0===Q||null===(d=Q[(null===P||void 0===P?void 0:P.fillMode)??S.b.MATERIAL_TriangleFillMode])||void 0===d?void 0:d.babylonMaterial}function O(b,X){return{offset:{componentsCount:2,type:"Vector2",get:(P,S,d)=>{const N=w(P,d,b,X);return new Q.Vector2(null===N||void 0===N?void 0:N.uOffset,null===N||void 0===N?void 0:N.vOffset)},getTarget:f,set:(P,Q,S,d)=>{const N=w(Q,d,b,X);N.uOffset=P.x,N.vOffset=P.y},getPropertyName:[()=>`${b}${X?"."+X:""}.uOffset`,()=>`${b}${X?"."+X:""}.vOffset`]},rotation:{type:"number",get:(P,Q,S)=>{var d;return null===(d=w(P,S,b,X))||void 0===d?void 0:d.wAng},getTarget:f,set:(P,Q,S,d)=>w(Q,d,b,X).wAng=P,getPropertyName:[()=>`${b}${X?"."+X:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(P,S,d)=>{const N=w(P,d,b,X);return new Q.Vector2(null===N||void 0===N?void 0:N.uScale,null===N||void 0===N?void 0:N.vScale)},getTarget:f,set:(P,Q,S,d)=>{const N=w(Q,d,b,X);N.uScale=P.x,N.vScale=P.y},getPropertyName:[()=>`${b}${X?"."+X:""}.uScale`,()=>`${b}${X?"."+X:""}.vScale`]}}}const e={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:b=>{var X,P;return new Q.Vector2((null===(X=b._babylonCamera)||void 0===X?void 0:X.orthoLeft)??0,(null===(P=b._babylonCamera)||void 0===P?void 0:P.orthoRight)??0)},set:(b,X)=>{X._babylonCamera&&(X._babylonCamera.orthoLeft=b.x,X._babylonCamera.orthoRight=b.y)},getTarget:b=>b,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:b=>{var X,P;return new Q.Vector2((null===(X=b._babylonCamera)||void 0===X?void 0:X.orthoBottom)??0,(null===(P=b._babylonCamera)||void 0===P?void 0:P.orthoTop)??0)},set:(b,X)=>{X._babylonCamera&&(X._babylonCamera.orthoBottom=b.x,X._babylonCamera.orthoTop=b.y)},getTarget:b=>b,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:b=>{var X;return null===(X=b._babylonCamera)||void 0===X?void 0:X.maxZ},set:(b,X)=>{X._babylonCamera&&(X._babylonCamera.maxZ=b)},getTarget:b=>b,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:b=>{var X;return null===(X=b._babylonCamera)||void 0===X?void 0:X.Vd},set:(b,X)=>{X._babylonCamera&&(X._babylonCamera.Vd=b)},getTarget:b=>b,getPropertyName:[()=>"Vd"]}},perspective:{aspectRatio:{type:"number",get:b=>{var X;return null===(X=b._babylonCamera)||void 0===X?void 0:X.getEngine().getAspectRatio(b._babylonCamera)},getTarget:b=>b,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:b=>{var X;return null===(X=b._babylonCamera)||void 0===X?void 0:X.fov},set:(b,X)=>{X._babylonCamera&&(X._babylonCamera.fov=b)},getTarget:b=>b,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:b=>{var X;return null===(X=b._babylonCamera)||void 0===X?void 0:X.maxZ},set:(b,X)=>{X._babylonCamera&&(X._babylonCamera.maxZ=b)},getTarget:b=>b,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:b=>{var X;return null===(X=b._babylonCamera)||void 0===X?void 0:X.Vd},set:(b,X)=>{X._babylonCamera&&(X._babylonCamera.Vd=b)},getTarget:b=>b,getPropertyName:[()=>"Vd"]}}}},nodes:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"tX",get:b=>{var X;return null===(X=b._babylonTransformNode)||void 0===X?void 0:X.position},set:(b,X)=>{var P;return null===(P=X._babylonTransformNode)||void 0===P?void 0:P.position.N(b)},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:b=>{var X;return null===(X=b._babylonTransformNode)||void 0===X?void 0:X.rotationQuaternion},set:(b,X)=>{var P,Q;return null===(P=X._babylonTransformNode)||void 0===P||null===(Q=P.rotationQuaternion)||void 0===Q?void 0:Q.N(b)},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"tX",get:b=>{var X;return null===(X=b._babylonTransformNode)||void 0===X?void 0:X.Fd},set:(b,X)=>{var P;return null===(P=X._babylonTransformNode)||void 0===P?void 0:P.Fd.N(b)},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"Fd"]},weights:{length:{type:"number",get:b=>b._numMorphTargets,getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(b,X)=>{var P,Q;return void 0!==X?null===(P=b._primitiveBabylonMeshes)||void 0===P||null===(Q=P[0].morphTargetManager)||void 0===Q?void 0:Q.getTarget(X).influence:void 0},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(b,X)=>[0],getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:b=>{var X,P,S;return Q.Matrix.Compose(null===(X=b._babylonTransformNode)||void 0===X?void 0:X.Fd,null===(P=b._babylonTransformNode)||void 0===P?void 0:P.rotationQuaternion,null===(S=b._babylonTransformNode)||void 0===S?void 0:S.position)},getTarget:b=>b._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:b=>{var X,P,S,d;const N=Q.Matrix.Identity();let a=b.parent;for(;a&&a.parent;)a=a.parent;const u=(null===(X=b._babylonTransformNode)||void 0===X?void 0:X.position._isDirty)||(null===(P=b._babylonTransformNode)||void 0===P||null===(S=P.rotationQuaternion)||void 0===S?void 0:S._isDirty)||(null===(d=b._babylonTransformNode)||void 0===d?void 0:d.Fd._isDirty);if(a){var w;const X=null===(w=a._babylonTransformNode)||void 0===w?void 0:w.pd(!0).invert();var f,O;if(X)null===(f=b._babylonTransformNode)||void 0===f||null===(O=f.pd(u))||void 0===O||O.multiplyToRef(X,N)}else b._babylonTransformNode&&N.N(b._babylonTransformNode.pd(u));return N},getTarget:b=>b._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:b=>{var X,P;return null===(X=b._babylonTransformNode)||void 0===X||null===(P=X.getChildren((b=>b instanceof N.d),!0)[0])||void 0===P?void 0:P.ya},getTarget:b=>{var X;return null===(X=b._babylonTransformNode)||void 0===X?void 0:X.getChildren((b=>b instanceof N.d),!0)[0]},set:(b,X)=>{if(X._babylonTransformNode){const P=X._babylonTransformNode.getChildren((b=>b instanceof N.d),!0)[0];P&&(P.ya=b)}}},color:{type:"yX",get:b=>{var X,P;return null===(X=b._babylonTransformNode)||void 0===X||null===(P=X.getChildren((b=>b instanceof N.d),!0)[0])||void 0===P?void 0:P.ha},getTarget:b=>{var X;return null===(X=b._babylonTransformNode)||void 0===X?void 0:X.getChildren((b=>b instanceof N.d),!0)[0]},set:(b,X)=>{if(X._babylonTransformNode){const P=X._babylonTransformNode.getChildren((b=>b instanceof N.d),!0)[0];P&&(P.ha=b)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"yX",get:(b,X,P)=>f(b,X,P).emissiveColor,set:(b,X,P,Q)=>f(X,P,Q).emissiveColor.N(b),getTarget:(b,X,P)=>f(b,X,P),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:O("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(b,X,P)=>{var Q;return null===(Q=w(b,P,"bumpTexture"))||void 0===Q?void 0:Q.level},set:(b,X,P,Q)=>{const S=w(X,Q,"bumpTexture");S&&(S.level=b)},getTarget:(b,X,P)=>f(b,X,P),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:O("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(b,X,P)=>f(b,X,P).ambientTextureStrength,set:(b,X,P,Q)=>{const S=f(X,P,Q);S&&(S.ambientTextureStrength=b)},getTarget:(b,X,P)=>f(b,X,P),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:O("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Ba",get:(b,X,P)=>{const Q=f(b,X,P);return d.Ba.FromColor3(Q.albedoColor,Q.alpha)},set:(b,X,P,Q)=>{const S=f(X,P,Q);S.albedoColor.set(b.r,b.g,b.b),S.alpha=b.a},getTarget:(b,X,P)=>f(b,X,P),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:O("albedoTexture")}},metallicFactor:{type:"number",get:(b,X,P)=>f(b,X,P).metallic,set:(b,X,P,Q)=>{const S=f(X,P,Q);S&&(S.metallic=b)},getTarget:(b,X,P)=>f(b,X,P),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(b,X,P)=>f(b,X,P).roughness,set:(b,X,P,Q)=>{const S=f(X,P,Q);S&&(S.roughness=b)},getTarget:(b,X,P)=>f(b,X,P),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:O("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(b,X,P)=>f(b,X,P).anisotropy.ya,set:(b,X,P,Q)=>{f(X,P,Q).anisotropy.ya=b},getTarget:(b,X,P)=>f(b,X,P),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(b,X,P)=>f(b,X,P).anisotropy.angle,set:(b,X,P,Q)=>{f(X,P,Q).anisotropy.angle=b},getTarget:(b,X,P)=>f(b,X,P),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:O("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(b,X,P)=>f(b,X,P).clearCoat.ya,set:(b,X,P,Q)=>{f(X,P,Q).clearCoat.ya=b},getTarget:(b,X,P)=>f(b,X,P),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(b,X,P)=>f(b,X,P).clearCoat.roughness,set:(b,X,P,Q)=>{f(X,P,Q).clearCoat.roughness=b},getTarget:(b,X,P)=>f(b,X,P),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:O("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(b,X,P)=>{var Q;return null===(Q=f(b,X,P).clearCoat.bumpTexture)||void 0===Q?void 0:Q.level},getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).clearCoat.bumpTexture.level=b},extensions:{KHR_texture_transform:O("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:O("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(b,X,P)=>f(b,X,P).subSurface.dispersion,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).subSurface.dispersion=b}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(b,X,P)=>f(b,X,P).emissiveIntensity,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).emissiveIntensity=b}},KHR_materials_ior:{ior:{type:"number",get:(b,X,P)=>f(b,X,P).indexOfRefraction,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).indexOfRefraction=b}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(b,X,P)=>f(b,X,P).iridescence.ya,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).iridescence.ya=b},iridescenceIor:{type:"number",get:(b,X,P)=>f(b,X,P).iridescence.indexOfRefraction,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).iridescence.indexOfRefraction=b},iridescenceTexture:{extensions:{KHR_texture_transform:O("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(b,X,P)=>f(b,X,P).iridescence.maximumThickness,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).iridescence.maximumThickness=b},iridescenceThicknessMinimum:{type:"number",get:(b,X,P)=>f(b,X,P).iridescence.minimumThickness,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).iridescence.minimumThickness=b},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:O("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"yX",get:(b,X,P)=>f(b,X,P).sheen.color,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).sheen.color.N(b)},sheenColorTexture:{extensions:{KHR_texture_transform:O("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(b,X,P)=>f(b,X,P).sheen.ya,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).sheen.ya=b},sheenRoughnessTexture:{extensions:{KHR_texture_transform:O("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(b,X,P)=>f(b,X,P).metallicF0Factor,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).metallicF0Factor=b,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"yX",get:(b,X,P)=>f(b,X,P).metallicReflectanceColor,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).metallicReflectanceColor.N(b),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:O("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:O("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(b,X,P)=>f(b,X,P).subSurface.refractionIntensity,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).subSurface.refractionIntensity=b,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:O("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(b,X,P)=>f(b,X,P).subSurface.translucencyIntensity,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).subSurface.translucencyIntensity=b},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:O("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"yX",get:(b,X,P)=>f(b,X,P).subSurface.translucencyColor,getTarget:f,set:(b,X,P,Q)=>{var S;return b&&(null===(S=f(X,P,Q).subSurface.translucencyColor)||void 0===S?void 0:S.N(b))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:O("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"yX",get:(b,X,P)=>f(b,X,P).subSurface.tintColor,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).subSurface.tintColor.N(b)},attenuationDistance:{type:"number",get:(b,X,P)=>f(b,X,P).subSurface.tintColorAtDistance,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).subSurface.tintColorAtDistance=b},thicknessFactor:{type:"number",get:(b,X,P)=>f(b,X,P).subSurface.maximumThickness,getTarget:f,set:(b,X,P,Q)=>f(X,P,Q).subSurface.maximumThickness=b},thicknessTexture:{extensions:{KHR_texture_transform:O("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonLight)),getPropertyName:[b=>"length"]},__array__:{__target__:!0,color:{type:"yX",get:b=>{var X;return null===(X=b._babylonLight)||void 0===X?void 0:X.ha},set:(b,X)=>{var P;return null===(P=X._babylonLight)||void 0===P?void 0:P.ha.N(b)},getTarget:b=>b._babylonLight,getPropertyName:[b=>"diffuse"]},ya:{type:"number",get:b=>{var X;return null===(X=b._babylonLight)||void 0===X?void 0:X.ya},set:(b,X)=>X._babylonLight?X._babylonLight.ya=b:void 0,getTarget:b=>b._babylonLight,getPropertyName:[b=>"intensity"]},range:{type:"number",get:b=>{var X;return null===(X=b._babylonLight)||void 0===X?void 0:X.range},set:(b,X)=>X._babylonLight?X._babylonLight.range=b:void 0,getTarget:b=>b._babylonLight,getPropertyName:[b=>"range"]},spot:{innerConeAngle:{type:"number",get:b=>{var X;return null===(X=b._babylonLight)||void 0===X?void 0:X.innerAngle},set:(b,X)=>X._babylonLight?X._babylonLight.innerAngle=b:void 0,getTarget:b=>b._babylonLight,getPropertyName:[b=>"innerConeAngle"]},outerConeAngle:{type:"number",get:b=>{var X;return null===(X=b._babylonLight)||void 0===X?void 0:X.angle},set:(b,X)=>X._babylonLight?X._babylonLight.angle=b:void 0,getTarget:b=>b._babylonLight,getPropertyName:[b=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonLight)),getPropertyName:[b=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonTexture)),getPropertyName:[b=>"length"]},__array__:{__target__:!0,ya:{type:"number",get:b=>{var X;return null===(X=b._babylonTexture)||void 0===X?void 0:X.level},set:(b,X)=>{X._babylonTexture&&(X._babylonTexture.level=b)},getTarget:b=>b._babylonTexture},rotation:{type:"Quaternion",get:b=>{var X;return b._babylonTexture&&Q.Quaternion.FromRotationMatrix(null===(X=b._babylonTexture)||void 0===X?void 0:X.getReflectionTextureMatrix())},set:(b,X)=>{var P;X._babylonTexture&&(null!==(P=X._babylonTexture.Ab())&&void 0!==P&&P.useRightHandedSystem||(b=Q.Quaternion.Inverse(b)),Q.Matrix.FromQuaternionToRef(b,X._babylonTexture.getReflectionTextureMatrix()))},getTarget:b=>b._babylonTexture}}}}},animations:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>{var X;return null===(X=b.primitives[0]._instanceData)||void 0===X?void 0:X.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function Y(b){return new u(b,e)}function D(b){const X=b.split("/").map((b=>b.replace(/{}/g,"__array__")));let P=e;for(const Q of X)Q&&(P=P[Q]);if(P&&P.type&&P.get)return P}function E(b,X){const P=b.split("/").map((b=>b.replace(/{}/g,"__array__")));let Q=e;for(const S of P)S&&(Q=Q[S]);Q&&Q.type&&Q.get&&(Q.interpolation=X)}function t(b,X){const P=b.split("/").map((b=>b.replace(/{}/g,"__array__")));let Q=e;for(const S of P)if(S){if(!Q[S]){if("?"===S){Q.__ignoreObjectTree__=!0;continue}Q[S]={},"__array__"===S&&(Q[S].__target__=!0)}Q=Q[S]}Object.assign(Q,X)}},13579:(b,X,P)=>{"use strict";P.r(X),P.d(X,{AnimationPropertyInfo:()=>w,TransformNodeAnimationPropertyInfo:()=>f,WeightAnimationPropertyInfo:()=>O,getQuaternion:()=>a,getVector3:()=>N,getWeights:()=>u});var Q=P(12386),S=P(11834),d=P(13570);function N(b,X,P,Q){return S.tX.hX(X,P).scaleInPlace(Q)}function a(b,X,P,Q){return S.Quaternion.hX(X,P).scaleInPlace(Q)}function u(b,X,P,Q){const S=new Array(b._numMorphTargets);for(let d=0;d<S.length;d++)S[d]=X[P++]*Q;return S}class w{constructor(b,X,P,Q){this.type=b,this.name=X,this.getValue=P,this.getStride=Q}_buildAnimation(b,X,P){const S=new Q.c(b,this.name,X,this.type);return S.setKeys(P),S}}class f extends w{buildAnimations(b,X,P,Q){const S=[];return S.push({babylonAnimatable:b._babylonTransformNode,babylonAnimation:this._buildAnimation(X,P,Q)}),S}}class O extends w{buildAnimations(b,X,P,S){const d=[];if(b._numMorphTargets)for(let N=0;N<b._numMorphTargets;N++){const a=new Q.c(`${X}_${N}`,this.name,P,this.type);if(a.setKeys(S.map((b=>({frame:b.frame,inTangent:b.inTangent?b.inTangent[N]:void 0,value:b.value[N],outTangent:b.outTangent?b.outTangent[N]:void 0,interpolation:b.interpolation})))),b._primitiveBabylonMeshes)for(const X of b._primitiveBabylonMeshes)if(X.morphTargetManager){const b=X.morphTargetManager.getTarget(N),P=a.clone();b.animations.push(P),d.push({babylonAnimatable:b,babylonAnimation:P})}}return d}}(0,d.j)("/nodes/{}/translation",[new f(Q.c.ANIMATIONTYPE_VECTOR3,"position",N,(()=>3))]),(0,d.j)("/nodes/{}/rotation",[new f(Q.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",a,(()=>4))]),(0,d.j)("/nodes/{}/scale",[new f(Q.c.ANIMATIONTYPE_VECTOR3,"Fd",N,(()=>3))]),(0,d.j)("/nodes/{}/weights",[new O(Q.c.ANIMATIONTYPE_FLOAT,"influence",u,(b=>b._numMorphTargets))])},13535:(b,X,P)=>{"use strict";class Q{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((b,X)=>{this._resolve=b,this._reject=X}))}}var S=P(11834),d=P(11878),N=P(11689),a=P(12328),u=P(13541),w=P(13555),f=P(11694),O=P(12346),e=P(12386),Y=P(12388),D=P(11732),E=P(11700),t=P(11709);class B{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(b){this._useTextureToStoreBoneMatrices=b,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(b){this._animationPropertiesOverride=b}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(b,X,P){this.name=b,this.id=X,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=S.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new f.d,this.bones=[],this._scene=P||D.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const Q=this._scene.getEngine().getCaps();this._canUseTextureForBones=Q.textureFloat&&Q.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((b=>!b.getParent()))}getTransformMatrices(b){if(this.needInitialSkinMatrix){if(!b)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return b._bonesTransformMatrices||this.prepare(!0),b._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(b){return this.needInitialSkinMatrix&&b._transformMatrixTexture?b._transformMatrixTexture:this._transformMatrixTexture}Ab(){return this._scene}toString(b){let X=`Name: ${this.name}, nBones: ${this.bones.length}`;if(X+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,b){X+=", Ranges: {";let b=!0;for(const P in this._ranges)b&&(X+=", ",b=!1),X+=P;X+="}"}return X}getBoneIndexByName(b){for(let X=0,P=this.bones.length;X<P;X++)if(this.bones[X].name===b)return X;return-1}createAnimationRange(b,X,P){if(!this._ranges[b]){this._ranges[b]=new Y.b(b,X,P);for(let Q=0,S=this.bones.length;Q<S;Q++)this.bones[Q].animations[0]&&this.bones[Q].animations[0].createRange(b,X,P)}}deleteAnimationRange(b){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let P=0,Q=this.bones.length;P<Q;P++)this.bones[P].animations[0]&&this.bones[P].animations[0].deleteRange(b,X);this._ranges[b]=null}getAnimationRange(b){return this._ranges[b]||null}getAnimationRanges(){const b=[];let X;for(X in this._ranges)b.push(this._ranges[X]);return b}copyAnimationRange(b,X){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[X]||!b.getAnimationRange(X))return!1;let Q=!0;const S=this._getHighestAnimationFrame()+1,d={},N=b.bones;let a,u;for(u=0,a=N.length;u<a;u++)d[N[u].name]=N[u];this.bones.length!==N.length&&(E.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${N.length}`),Q=!1);const w=P&&this.dimensionsAtRest&&b.dimensionsAtRest?this.dimensionsAtRest.divide(b.dimensionsAtRest):null;for(u=0,a=this.bones.length;u<a;u++){const b=this.bones[u].name,N=d[b];N?Q=Q&&this.bones[u].copyAnimationRange(N,X,S,P,w):(E.b.Warn("copyAnimationRange: not same rig, missing source bone "+b),Q=!1)}const f=b.getAnimationRange(X);return f&&(this._ranges[X]=new Y.b(X,f.from+S,f.to+S)),Q}returnToRest(){for(const b of this.bones)-1!==b._index&&b.returnToRest()}_getHighestAnimationFrame(){let b=0;for(let X=0,P=this.bones.length;X<P;X++)if(this.bones[X].animations[0]){const P=this.bones[X].animations[0].getHighestFrame();b<P&&(b=P)}return b}beginAnimation(b,X,P,Q){const S=this.getAnimationRange(b);return S?this._scene.beginAnimation(this,S.from,S.to,X,P,Q):null}static MakeAnimationAdditive(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;const Q=b.getAnimationRange(P);if(!Q)return null;const S=b._scene.getAllAnimatablesByTarget(b);let d=null;for(let a=0;a<S.length;a++){const b=S[a];if(b.fromFrame===(null===Q||void 0===Q?void 0:Q.from)&&b.toFrame===(null===Q||void 0===Q?void 0:Q.to)){d=b;break}}const N=b.getAnimatables();for(let a=0;a<N.length;a++){const b=N[a].animations;if(b)for(let Q=0;Q<b.length;Q++)e.c.MakeAnimationAdditive(b[Q],X,P)}return d&&(d.isAdditive=!0),b}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(b){this._meshesWithPoseMatrix.push(b)}_unregisterMeshWithPoseMatrix(b){const X=this._meshesWithPoseMatrix.indexOf(b);X>-1&&this._meshesWithPoseMatrix.splice(X,1)}_computeTransformMatrices(b,X){this.onBeforeComputeObservable.notifyObservers(this);for(let P=0;P<this.bones.length;P++){const Q=this.bones[P];Q._childUpdateId++;const S=Q.getParent();if(S?Q.getLocalMatrix().multiplyToRef(S.getFinalMatrix(),Q.getFinalMatrix()):X?Q.getLocalMatrix().multiplyToRef(X,Q.getFinalMatrix()):Q.getFinalMatrix().N(Q.getLocalMatrix()),-1!==Q._index){const X=null===Q._index?P:Q._index;Q.getAbsoluteInverseBindMatrix().multiplyToArray(Q.getFinalMatrix(),b,16*X)}}this._identity.copyToArray(b,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const b=this.Ab().getRenderId();if(this._currentRenderId===b)return;this._currentRenderId=b}if(this._numBonesWithLinkedTransformNode>0)for(const b of this.bones)if(b._linkedTransformNode){const X=b._linkedTransformNode;b.position=X.position,X.rotationQuaternion?b.rotationQuaternion=X.rotationQuaternion:b.rotation=X.rotation,b.Fd=X.Fd}if(this.needInitialSkinMatrix)for(const b of this._meshesWithPoseMatrix){const X=b.getPoseMatrix();let P=this._isDirty;if(b._bonesTransformMatrices&&b._bonesTransformMatrices.length===16*(this.bones.length+1)||(b._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),P=!0),P){if(this._synchronizedWithMesh!==b){this._synchronizedWithMesh=b;for(const b of this.bones)if(!b.getParent()){b.getBindMatrix().multiplyToRef(X,S.TmpVectors.Matrix[1]),b._updateAbsoluteBindMatrices(S.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const X=4*(this.bones.length+1);b._transformMatrixTexture&&b._transformMatrixTexture.getSize().width===X||(b._transformMatrixTexture&&b._transformMatrixTexture.dispose(),b._transformMatrixTexture=O.d.CreateRGBATexture(b._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(b._bonesTransformMatrices,X),this.isUsingTextureForMatrices&&b._transformMatrixTexture&&b._transformMatrixTexture.update(b._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=O.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let b=0;b<this.bones.length;b++)this._animatables.push(this.bones[b])}return this._animatables}clone(b,X){const P=new B(b,X||b,this._scene);P.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Q=0;Q<this.bones.length;Q++){const b=this.bones[Q];let X=null;const S=b.getParent();if(S){const b=this.bones.indexOf(S);X=P.bones[b]}const d=new w.d(b.name,P,X,b.getBindMatrix().clone(),b.getRestMatrix().clone());d._index=b._index,b._linkedTransformNode&&d.linkTransformNode(b._linkedTransformNode),t.b.DeepCopy(b.animations,d.animations)}if(this._ranges){P._ranges={};for(const b in this._ranges){const X=this._ranges[b];X&&(P._ranges[b]=X.clone())}}return this._isDirty=!0,P.prepare(!0),P}enableBlending(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const X of this.bones)for(const P of X.animations)P.enableBlending=!0,P.blendingSpeed=b}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Ab().stopAnimation(this),this.Ab().removeSkeleton(this),this._parentContainer){const b=this._parentContainer.skeletons.indexOf(this);b>-1&&this._parentContainer.skeletons.splice(b,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const b={};b.name=this.name,b.id=this.id,this.dimensionsAtRest&&(b.dimensionsAtRest=this.dimensionsAtRest.Zd()),b.bones=[],b.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let P=0;P<this.bones.length;P++){var X;const Q=this.bones[P],S=Q.getParent(),d={parentBoneIndex:S?this.bones.indexOf(S):-1,index:Q.getIndex(),name:Q.name,id:Q.id,matrix:Q.getBindMatrix().Zd(),rest:Q.getRestMatrix().Zd(),linkedTransformNodeId:null===(X=Q.getTransformNode())||void 0===X?void 0:X.id};b.bones.push(d),Q.length&&(d.length=Q.length),Q.metadata&&(d.metadata=Q.metadata),Q.animations&&Q.animations.length>0&&(d.animation=Q.animations[0].serialize()),b.ranges=[];for(const X in this._ranges){const P=this._ranges[X];if(!P)continue;const Q={};Q.name=X,Q.from=P.from,Q.to=P.to,b.ranges.push(Q)}}return b}static Parse(b,X){const P=new B(b.name,b.id,X);let Q;for(b.dimensionsAtRest&&(P.dimensionsAtRest=S.tX.hX(b.dimensionsAtRest)),P.needInitialSkinMatrix=b.needInitialSkinMatrix,Q=0;Q<b.bones.length;Q++){const X=b.bones[Q],d=b.bones[Q].index;let N=null;X.parentBoneIndex>-1&&(N=P.bones[X.parentBoneIndex]);const a=X.rest?S.Matrix.hX(X.rest):null,u=new w.d(X.name,P,N,S.Matrix.hX(X.matrix),a,null,d);void 0!==X.id&&null!==X.id&&(u.id=X.id),X.length&&(u.length=X.length),X.metadata&&(u.metadata=X.metadata),X.animation&&u.animations.push(e.c.Parse(X.animation)),void 0!==X.linkedTransformNodeId&&null!==X.linkedTransformNodeId&&(P._hasWaitingData=!0,u._waitingTransformNodeId=X.linkedTransformNodeId)}if(b.ranges)for(Q=0;Q<b.ranges.length;Q++){const X=b.ranges[Q];P.createAnimationRange(X.name,X.from,X.to)}return P}computeAbsoluteMatrices(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||b)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(b)}getPoseMatrix(){let b=null;return this._meshesWithPoseMatrix.length>0&&(b=this._meshesWithPoseMatrix[0].getPoseMatrix()),b}sortBones(){const b=[],X=new Array(this.bones.length);for(let P=0;P<this.bones.length;P++)this._sortBones(P,b,X);this.bones=b}_sortBones(b,X,P){if(P[b])return;P[b]=!0;const Q=this.bones[b];if(!Q)return;void 0===Q._index&&(Q._index=b);const S=Q.getParent();S&&this._sortBones(this.bones.indexOf(S),X,P),X.push(Q)}setCurrentPoseAsRest(){for(const b of this.bones)b.setCurrentPoseAsRest()}}var W=P(12177),n=P(12358),y=P(11814),h=P(12277),L=P(11912),Z=P(12335),v=P(12290),A=P(12319),o=P(12390),K=P(11934),T=P(13500);class q{set areUpdatesFrozen(b){b?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new K.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,b||(b=D.e.LastCreatedScene),this._scene=b,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const b=this._scene.getEngine().getCaps();this._canUseTextureForTargets=b.canUseGLVertexID&&b.textureFloat&&b.maxVertexTextureImageUnits>0&&b.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return q.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?q.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(b){this._numMaxInfluencers!==b&&(this._numMaxInfluencers=b,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(b){this._useTextureToStoreTargets!==b&&(this._useTextureToStoreTargets=b,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var b;return q.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(b=this._scene)&&void 0!==b&&b.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(b){return this._activeTargets.data[b]}getTarget(b){return this._targets[b]}getTargetByName(b){for(const X of this._targets)if(X.name===b)return X;return null}addTarget(b){this._targets.push(b),this._targetInfluenceChangedObservers.push(b.onInfluenceChanged.add((b=>{this.areUpdatesFrozen&&b&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(b)}))),this._targetDataLayoutChangedObservers.push(b._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(b){const X=this._targets.indexOf(b);X>=0&&(this._targets.splice(X,1),b.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(X,1)[0]),b._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(X,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(b)}_bind(b){b.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),b.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),b.setTexture("morphTargets",this._targetStoreTexture),b.setInt("morphTargetCount",this.numInfluencers)}clone(){const b=new q(this._scene);for(const X of this._targets)b.addTarget(X.clone());return b.enablePositionMorphing=this.enablePositionMorphing,b.enableNormalMorphing=this.enableNormalMorphing,b.enableTangentMorphing=this.enableTangentMorphing,b.enableUVMorphing=this.enableUVMorphing,b.enableUV2Morphing=this.enableUV2Morphing,b.enableColorMorphing=this.enableColorMorphing,b}serialize(){const b={};b.id=this.uniqueId,b.targets=[];for(const X of this._targets)b.targets.push(X.serialize());return b}_syncActiveTargets(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const X=!!this._targetStoreTexture,P=this.isUsingTextureForTargets;(this._mustSynchronize||X!==P)&&(this._mustSynchronize=!1,this.synchronize());let Q=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let S=-1;for(const d of this._targets)if(S++,0!==d.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=q.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(d),this._morphTargetTextureIndices[Q]=S,this._tempInfluences[Q++]=d.influence}this._morphTargetTextureIndices.length!==Q&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,Q)),this._influences&&this._influences.length===Q||(this._influences=new Float32Array(Q));for(let d=0;d<Q;d++)this._influences[d]=this._tempInfluences[d];if(b&&this._scene)for(const d of this._scene.meshes)d.morphTargetManager===this&&(P?d._markSubMeshesAsAttributesDirty():d._syncGeometryWithMorphTargetManager())}synchronize(){var b;if(!this._scene||this.areUpdatesFrozen)return;const X=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(b=this._targetStoreTexture)||void 0===b||b.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>X.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const P of this._targets){this._supportsPositions=this._supportsPositions&&P.hasPositions,this._supportsNormals=this._supportsNormals&&P.hasNormals,this._supportsTangents=this._supportsTangents&&P.hasTangents,this._supportsUVs=this._supportsUVs&&P.hasUVs,this._supportsUV2s=this._supportsUV2s&&P.hasUV2s,this._supportsColors=this._supportsColors&&P.hasColors;const b=P.vertexCount;if(0===this._vertexCount)this._vertexCount=b;else if(this._vertexCount!==b)return void E.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${P.name}": ${b}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const b=X.getCaps().maxTextureSize;this._textureWidth>b&&(this._textureHeight=Math.ceil(this._textureWidth/b),this._textureWidth=b);const P=this._targets.length,Q=new Float32Array(P*this._textureWidth*this._textureHeight*4);let S=0;for(let X=0;X<P;X++){const b=this._targets[X],P=b.getPositions(),d=b.getNormals(),N=b.getUVs(),a=b.getTangents(),u=b.getUV2s(),w=b.getColors();S=X*this._textureWidth*this._textureHeight*4;for(let X=0;X<this._vertexCount;X++)this._supportsPositions&&P&&(Q[S]=P[3*X],Q[S+1]=P[3*X+1],Q[S+2]=P[3*X+2],S+=4),this._supportsNormals&&d&&(Q[S]=d[3*X],Q[S+1]=d[3*X+1],Q[S+2]=d[3*X+2],S+=4),this._supportsUVs&&N&&(Q[S]=N[2*X],Q[S+1]=N[2*X+1],S+=4),this._supportsTangents&&a&&(Q[S]=a[3*X],Q[S+1]=a[3*X+1],Q[S+2]=a[3*X+2],S+=4),this._supportsUV2s&&u&&(Q[S]=u[2*X],Q[S+1]=u[2*X+1],S+=4),this._supportsColors&&w&&(Q[S]=w[4*X],Q[S+1]=w[4*X+1],Q[S+2]=w[4*X+2],Q[S+3]=w[4*X+3],S+=4)}this._targetStoreTexture=T.e.CreateRGBATexture(Q,this._textureWidth,this._textureHeight,P,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const P of this._scene.meshes)P.morphTargetManager===this&&P._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const b=this._parentContainer.morphTargetManagers.indexOf(this);b>-1&&this._parentContainer.morphTargetManagers.splice(b,1),this._parentContainer=null}for(const b of this._targets)this._scene.stopAnimation(b)}}static Parse(b,X){const P=new q(X);for(const Q of b.targets)P.addTarget(o.c.Parse(Q,X));return P}}q.EnableTextureStorage=!0,q.MaxActiveMorphTargetsInVertexAttributeMode=8,q.ConstantTargetCountForTextureMode=0;var V=P(13560),i=P(11738),x=P(12192);const H=new Map,C=H;function p(b,X,P){k(b)&&E.b.Warn(`Extension with the name '${b}' already exists`),H.set(b,{isGLTFExtension:X,factory:P})}function k(b){return H.delete(b)}var z=P(13570),U=P(12441),g=P(11918);class j{static Get(b,X,P){if(!X||void 0==P||!X[P])throw new Error(`${b}: Failed to find index (${P})`);return X[P]}static TryGet(b,X){return b&&void 0!=X&&b[X]?b[X]:null}static Assign(b){if(b)for(let X=0;X<b.length;X++)b[X].index=X}}function l(b){if(b.min&&b.max){const X=b.min,P=b.max,Q=S.TmpVectors.tX[0].sd(X[0],X[1],X[2]),d=S.TmpVectors.tX[1].sd(P[0],P[1],P[2]);if(b.normalized&&5126!==b.componentType){let X=1;switch(b.componentType){case 5120:X=127;break;case 5121:X=255;break;case 5122:X=32767;break;case 5123:X=65535}const P=1/X;Q.scaleInPlace(P),d.scaleInPlace(P)}return new x.c(Q,d)}return null}class J{static RegisterExtension(b,X){p(b,!1,X)}static UnregisterExtension(b){return k(b)}get ed(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(b){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=b}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((b=>b.dispose&&b.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(b,X,P,Q,S,d){let N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=X,this._assetContainer=P,this._loadData(Q);let d=null;if(b){const X={};if(this._gltf.nodes)for(const b of this._gltf.nodes)b.name&&(X[b.name]=b.index);d=(b instanceof Array?b:[b]).map((b=>{const P=X[b];if(void 0===P)throw new Error(`Failed to find node '${b}'`);return P}))}return await this._loadAsync(S,N,d,(()=>({meshes:this._getMeshes(),Oe:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(b,X,P,Q){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=b,this._loadData(X),await this._loadAsync(P,S,null,(()=>{}))}async _loadAsync(b,X,P,Q){return await Promise.resolve().then((async()=>{this._rootUrl=b,this._uniqueRootUrl=!b.startsWith("file:")&&X?b:`${b}${Date.now()}/`,this._fileName=X,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const S=`${V.k[V.k.LOADING]} => ${V.k[V.k.READY]}`,d=`${V.k[V.k.LOADING]} => ${V.k[V.k.COMPLETE]}`;this._parent._startPerformanceCounter(S),this._parent._startPerformanceCounter(d),this._parent._setState(V.k.LOADING),this._extensionsOnLoading();const a=new Array;if(!this.parent.loadOnlyMaterials)if(P)a.push(this.loadSceneAsync("/nodes",{nodes:P,index:-1}));else if(void 0!=this._gltf.WX||this._gltf.scenes&&this._gltf.scenes[0]){const b=j.Get("/scene",this._gltf.scenes,this._gltf.WX||0);a.push(this.loadSceneAsync(`/scenes/${b.index}`,b))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let b=0;b<this._gltf.materials.length;++b){const X=this._gltf.materials[b],P="/materials/"+b,Q=W.b.TriangleFillMode;a.push(this._loadMaterialAsync(P,X,null,Q,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&a.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&a.push(this._compileShadowGeneratorsAsync());const u=Promise.all(a).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.za(!0);for(const b of this._babylonScene.materials){const X=b;void 0!==X.maxSimultaneousLights&&(X.maxSimultaneousLights=Math.max(X.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(V.k.READY),this._skipStartAnimationStep||this._startAnimations(),Q()}));return await u.then((b=>(this._parent._endPerformanceCounter(S),N.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(d),this._parent._setState(V.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(b=>{this._parent.onErrorObservable.notifyObservers(b),this._parent.onErrorObservable.clear(),this.dispose()}))})),b)))})).catch((b=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(b),this._parent.onErrorObservable.clear(),this.dispose()),b}))}_loadData(b){if(this._gltf=b.json,this._setupData(),b.bin){const X=this._gltf.buffers;if(X&&X[0]&&!X[0].uri){const P=X[0];(P.byteLength<b.bin.byteLength-3||P.byteLength>b.bin.byteLength)&&E.b.Warn(`Binary buffer length (${P.byteLength}) from JSON does not match chunk length (${b.bin.byteLength})`),this._bin=b.bin}else E.b.Warn("Unexpected BIN chunk")}}_setupData(){if(j.Assign(this._gltf.accessors),j.Assign(this._gltf.animations),j.Assign(this._gltf.buffers),j.Assign(this._gltf.bufferViews),j.Assign(this._gltf.cameras),j.Assign(this._gltf.images),j.Assign(this._gltf.materials),j.Assign(this._gltf.meshes),j.Assign(this._gltf.nodes),j.Assign(this._gltf.samplers),j.Assign(this._gltf.scenes),j.Assign(this._gltf.skins),j.Assign(this._gltf.textures),this._gltf.nodes){const b={};for(const P of this._gltf.nodes)if(P.children)for(const X of P.children)b[X]=P.index;const X=this._createRootNode();for(const P of this._gltf.nodes){const Q=b[P.index];P.parent=void 0===Q?X:this._gltf.nodes[Q]}}}async _loadExtensionsAsync(){const b=[];if(C.forEach(((X,P)=>{var Q;!1===(null===(Q=this.parent.extensionOptions[P])||void 0===Q?void 0:Q.enabled)?X.isGLTFExtension&&this.isExtensionUsed(P)&&E.b.Warn(`Extension ${P} is used but has been explicitly disabled.`):X.isGLTFExtension&&!this.isExtensionUsed(P)||b.push((async()=>{const b=await X.factory(this);return b.name!==P&&E.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${b.name} !== ${P}`),this._parent.onExtensionLoadedObservable.notifyObservers(b),b})())})),this._extensions.push(...await Promise.all(b)),this._extensions.sort(((b,X)=>(b.order||Number.MAX_VALUE)-(X.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const P of this._gltf.extensionsRequired){if(!this._extensions.some((b=>b.name===P&&b.enabled))){var X;if(!1===(null===(X=this.parent.extensionOptions[P])||void 0===X?void 0:X.enabled))throw new Error(`Required extension ${P} is disabled`);throw new Error(`Required extension ${P} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new A.b("__root__",this._babylonScene);this._rootBabylonMesh=b,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.za(!1);const X={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case V.i.AUTO:this._babylonScene.useRightHandedSystem||(X.rotation=[0,1,0,0],X.scale=[1,1,-1],J._LoadTransform(X,this._rootBabylonMesh));break;case V.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(b),X}loadSceneAsync(b,X){const P=this._extensionsLoadSceneAsync(b,X);if(P)return P;const Q=new Array;if(this.logOpen(`${b} ${X.name||""}`),X.nodes)for(const S of X.nodes){const X=j.Get(`${b}/nodes/${S}`,this._gltf.nodes,S);Q.push(this.loadNodeAsync(`/nodes/${X.index}`,X,(b=>{b.parent=this._rootBabylonMesh})))}for(const S of this._postSceneLoadActions)S();return Q.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(Q).then((()=>{}))}_forEachPrimitive(b,X){if(b._primitiveBabylonMeshes)for(const P of b._primitiveBabylonMeshes)X(P)}_getGeometries(){const b=[],X=this._gltf.nodes;if(X)for(const P of X)this._forEachPrimitive(P,(X=>{const P=X.Ud;P&&-1===b.indexOf(P)&&b.push(P)}));return b}_getMeshes(){const b=[];this._rootBabylonMesh instanceof v.e&&b.push(this._rootBabylonMesh);const X=this._gltf.nodes;if(X)for(const P of X)this._forEachPrimitive(P,(X=>{b.push(X)}));return b}_getTransformNodes(){const b=[],X=this._gltf.nodes;if(X)for(const P of X)P._babylonTransformNode&&"af"===P._babylonTransformNode.getClassName()&&b.push(P._babylonTransformNode),P._babylonTransformNodeForSkin&&b.push(P._babylonTransformNodeForSkin);return b}_getSkeletons(){const b=[],X=this._gltf.skins;if(X)for(const P of X)P._data&&b.push(P._data.babylonSkeleton);return b}_getAnimationGroups(){const b=[],X=this._gltf.animations;if(X)for(const P of X)P._babylonAnimationGroup&&b.push(P._babylonAnimationGroup);return b}_startAnimations(){switch(this._parent.animationStartMode){case V.g.NONE:break;case V.g.FIRST:{const b=this._getAnimationGroups();0!==b.length&&b[0].start(!0);break}case V.g.ALL:{const b=this._getAnimationGroups();for(const X of b)X.start(!0);break}default:return void E.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadNodeAsync(b,X,P);if(Q)return Q;if(X._babylonTransformNode)throw new Error(`${b}: Invalid recursive node hierarchy`);const S=new Array;this.logOpen(`${b} ${X.name||""}`);const d=Q=>{if(J.AddPointerMetadata(Q,b),J._LoadTransform(X,Q),void 0!=X.camera){const P=j.Get(`${b}/camera`,this._gltf.cameras,X.camera);S.push(this.loadCameraAsync(`/cameras/${P.index}`,P,(b=>{b.parent=Q,this._babylonScene.useRightHandedSystem||(Q.Fd.x=-1)})))}if(X.children)for(const P of X.children){const X=j.Get(`${b}/children/${P}`,this._gltf.nodes,P);S.push(this.loadNodeAsync(`/nodes/${X.index}`,X,(b=>{b.parent=Q})))}P(Q)},N=void 0!=X.mesh,a=this._parent.loadSkins&&void 0!=X.skin;if(!N||a){const b=X.name||`node${X.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const P=new h.b(b,this._babylonScene);P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==X.mesh?X._babylonTransformNode=P:X._babylonTransformNodeForSkin=P,d(P)}if(N)if(a){const P=j.Get(`${b}/mesh`,this._gltf.meshes,X.mesh);S.push(this._loadMeshAsync(`/meshes/${P.index}`,X,P,(P=>{const Q=X._babylonTransformNodeForSkin;P.metadata=(0,U.d)(Q.metadata,P.metadata||{});const d=j.Get(`${b}/skin`,this._gltf.skins,X.skin);S.push(this._loadSkinAsync(`/skins/${d.index}`,X,d,(b=>{this._forEachPrimitive(X,(X=>{X.skeleton=b})),this._postSceneLoadActions.push((()=>{if(void 0!=d.skeleton){const b=j.Get(`/skins/${d.index}/skeleton`,this._gltf.nodes,d.skeleton).parent;X.index===b.index?P.parent=Q.parent:P.parent=b._babylonTransformNode}else P.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:Q,skinnedNode:P})}))})))})))}else{const P=j.Get(`${b}/mesh`,this._gltf.meshes,X.mesh);S.push(this._loadMeshAsync(`/meshes/${P.index}`,X,P,d))}return this.logClose(),Promise.all(S).then((()=>(this._forEachPrimitive(X,(b=>{const X=b;!X.isAnInstance&&X.Ud&&X.Ud.useBoundingInfoFromGeometry?b.Cb():b.refreshBoundingInfo(!0,!0)})),X._babylonTransformNode)))}_loadMeshAsync(b,X,P,Q){const S=P.primitives;if(!S||!S.length)throw new Error(`${b}: Primitives are missing`);void 0==S[0].index&&j.Assign(S);const d=new Array;this.logOpen(`${b} ${P.name||""}`);const N=X.name||`node${X.index}`;if(1===S.length){const Q=P.primitives[0];d.push(this._loadMeshPrimitiveAsync(`${b}/primitives/${Q.index}`,N,X,P,Q,(b=>{X._babylonTransformNode=b,X._primitiveBabylonMeshes=[b]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,X._babylonTransformNode=new h.b(N,this._babylonScene),X._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._primitiveBabylonMeshes=[];for(const Q of S)d.push(this._loadMeshPrimitiveAsync(`${b}/primitives/${Q.index}`,`${N}_primitive${Q.index}`,X,P,Q,(b=>{b.parent=X._babylonTransformNode,X._primitiveBabylonMeshes.push(b)})))}return Q(X._babylonTransformNode),this.logClose(),Promise.all(d).then((()=>X._babylonTransformNode))}_loadMeshPrimitiveAsync(b,X,P,Q,S,d){const N=this._extensionsLoadMeshPrimitiveAsync(b,X,P,Q,S,d);if(N)return N;this.logOpen(`${b}`);const a=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==P.skin&&!Q.primitives[0].targets;let u,w;if(a&&S._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,u=S._instanceData.babylonSourceMesh.createInstance(X),u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w=S._instanceData.promise;else{const d=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new A.b(X,this._babylonScene);N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,N.sideOrientation=this._babylonScene.useRightHandedSystem?W.b.CounterClockWiseSideOrientation:W.b.ClockWiseSideOrientation,this._createMorphTargets(b,P,Q,S,N),d.push(this._loadVertexDataAsync(b,S,N).then((async X=>await this._loadMorphTargetsAsync(b,S,N,X).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,X.xb(N),X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const f=J._GetDrawMode(b,S.mode);if(void 0==S.material){let b=this._defaultBabylonMaterialData[f];b||(b=this._createDefaultMaterial("__GLTFLoader._default",f),this._parent.onMaterialLoadedObservable.notifyObservers(b),this._defaultBabylonMaterialData[f]=b),N.material=b}else if(!this.parent.skipMaterials){const X=j.Get(`${b}/material`,this._gltf.materials,S.material);d.push(this._loadMaterialAsync(`/materials/${X.index}`,X,N,f,(b=>{N.material=b})))}w=Promise.all(d),a&&(S._instanceData={babylonSourceMesh:N,promise:w}),u=N}return J.AddPointerMetadata(u,b),this._parent.onMeshLoadedObservable.notifyObservers(u),d(u),this.logClose(),w.then((()=>u))}_loadVertexDataAsync(b,X,P){const Q=this._extensionsLoadVertexDataAsync(b,X,P);if(Q)return Q;const S=X.attributes;if(!S)throw new Error(`${b}: Attributes are missing`);const d=new Array,N=new Z.e(P.name,this._babylonScene);if(void 0==X.indices)P.isUnIndexed=!0;else{const P=j.Get(`${b}/indices`,this._gltf.accessors,X.indices);d.push(this._loadIndicesAccessorAsync(`/accessors/${P.index}`,P).then((b=>{N.setIndices(b)})))}const a=(X,Q,a)=>{if(void 0==S[X])return;P._delayInfo=P._delayInfo||[],-1===P._delayInfo.indexOf(Q)&&P._delayInfo.push(Q);const u=j.Get(`${b}/attributes/${X}`,this._gltf.accessors,S[X]);d.push(this._loadVertexAccessorAsync(`/accessors/${u.index}`,u,Q).then((b=>{if(b.getKind()===L.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!P.skeleton){const b=l(u);b&&(N._boundingInfo=b,N.useBoundingInfoFromGeometry=!0)}N.setVerticesBuffer(b,u.count)}))),Q==L.g.MatricesIndicesExtraKind&&(P.numBoneInfluencers=8),a&&a(u)};return a("POSITION",L.g.PositionKind),a("NORMAL",L.g.NormalKind),a("TANGENT",L.g.TangentKind),a("TEXCOORD_0",L.g.UVKind),a("TEXCOORD_1",L.g.UV2Kind),a("TEXCOORD_2",L.g.UV3Kind),a("TEXCOORD_3",L.g.UV4Kind),a("TEXCOORD_4",L.g.UV5Kind),a("TEXCOORD_5",L.g.UV6Kind),a("JOINTS_0",L.g.MatricesIndicesKind),a("WEIGHTS_0",L.g.MatricesWeightsKind),a("JOINTS_1",L.g.MatricesIndicesExtraKind),a("WEIGHTS_1",L.g.MatricesWeightsExtraKind),a("COLOR_0",L.g.ColorKind,(b=>{"VEC4"===b.type&&(P.hasVertexAlpha=!0)})),Promise.all(d).then((()=>N))}_createMorphTargets(b,X,P,Q,S){if(!Q.targets||!this._parent.loadMorphTargets)return;if(void 0==X._numMorphTargets)X._numMorphTargets=Q.targets.length;else if(Q.targets.length!==X._numMorphTargets)throw new Error(`${b}: Primitives do not have the same number of targets`);const d=P.extras?P.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,S.morphTargetManager=new q(this._babylonScene),S.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S.morphTargetManager.areUpdatesFrozen=!0;for(let N=0;N<Q.targets.length;N++){const b=X.weights?X.weights[N]:P.weights?P.weights[N]:0,Q=d?d[N]:`morphTarget${N}`;S.morphTargetManager.addTarget(new o.c(Q,b,S.Ab()))}}_loadMorphTargetsAsync(b,X,P,Q){if(!X.targets||!this._parent.loadMorphTargets)return Promise.resolve();const S=new Array,d=P.morphTargetManager;for(let N=0;N<d.numTargets;N++){const P=d.getTarget(N);S.push(this._loadMorphTargetVertexDataAsync(`${b}/targets/${N}`,Q,X.targets[N],P))}return Promise.all(S).then((()=>{d.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(b,X,P,Q){const S=new Array,d=(Q,d,N)=>{if(void 0==P[Q])return;const a=X.getVertexBuffer(d);if(!a)return;const u=j.Get(`${b}/${Q}`,this._gltf.accessors,P[Q]);S.push(this._loadFloatAccessorAsync(`/accessors/${u.index}`,u).then((b=>{N(a,b)})))};return d("POSITION",L.g.PositionKind,((b,X)=>{const P=new Float32Array(X.length);b.forEach(X.length,((b,Q)=>{P[Q]=X[Q]+b})),Q.setPositions(P)})),d("NORMAL",L.g.NormalKind,((b,X)=>{const P=new Float32Array(X.length);b.forEach(P.length,((b,Q)=>{P[Q]=X[Q]+b})),Q.setNormals(P)})),d("TANGENT",L.g.TangentKind,((b,X)=>{const P=new Float32Array(X.length/3*4);let S=0;b.forEach(X.length/3*4,((b,Q)=>{(Q+1)%4!==0&&(P[S]=X[S]+b,S++)})),Q.setTangents(P)})),d("TEXCOORD_0",L.g.UVKind,((b,X)=>{const P=new Float32Array(X.length);b.forEach(X.length,((b,Q)=>{P[Q]=X[Q]+b})),Q.setUVs(P)})),d("TEXCOORD_1",L.g.UV2Kind,((b,X)=>{const P=new Float32Array(X.length);b.forEach(X.length,((b,Q)=>{P[Q]=X[Q]+b})),Q.setUV2s(P)})),d("COLOR_0",L.g.ColorKind,((X,P)=>{let S=null;const d=X.getSize();if(3===d){S=new Float32Array(P.length/3*4),X.forEach(P.length,((b,X)=>{const Q=Math.floor(X/3),d=X%3;S[4*Q+d]=P[3*Q+d]+b}));for(let b=0;b<P.length/3;++b)S[4*b+3]=1}else{if(4!==d)throw new Error(`${b}: Invalid number of components (${d}) for COLOR_0 attribute`);S=new Float32Array(P.length),X.forEach(P.length,((b,X)=>{S[X]=P[X]+b}))}Q.setColors(S)})),await Promise.all(S).then((()=>{}))}static _LoadTransform(b,X){if(void 0!=b.skin)return;let P=S.tX.Zero(),Q=S.Quaternion.Identity(),d=S.tX.One();if(b.matrix){S.Matrix.hX(b.matrix).decompose(d,Q,P)}else b.translation&&(P=S.tX.hX(b.translation)),b.rotation&&(Q=S.Quaternion.hX(b.rotation)),b.scale&&(d=S.tX.hX(b.scale));X.position=P,X.rotationQuaternion=Q,X.Fd=d}_loadSkinAsync(b,X,P,Q){if(!this._parent.loadSkins)return Promise.resolve();const S=this._extensionsLoadSkinAsync(b,X,P);if(S)return S;if(P._data)return Q(P._data.babylonSkeleton),P._data.promise;const d=`skeleton${P.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new B(P.name||d,d,this._babylonScene);N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(b,P,N);const a=this._loadSkinInverseBindMatricesDataAsync(b,P).then((b=>{this._updateBoneMatrices(N,b)}));return P._data={babylonSkeleton:N,promise:a},Q(N),a}_loadBones(b,X,P){if(void 0==X.skeleton||this._parent.alwaysComputeSkeletonRootNode){const P=this._findSkeletonRootNode(`${b}/joints`,X.joints);if(P)if(void 0===X.skeleton)X.skeleton=P.index;else{const Q=(b,X)=>{for(;X.parent;X=X.parent)if(X.parent===b)return!0;return!1},S=j.Get(`${b}/skeleton`,this._gltf.nodes,X.skeleton);S===P||Q(S,P)||(E.b.Warn(`${b}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),X.skeleton=P.index)}else E.b.Warn(`${b}: Failed to find common root`)}const Q={};for(const S of X.joints){const d=j.Get(`${b}/joints/${S}`,this._gltf.nodes,S);this._loadBone(d,X,P,Q)}}_findSkeletonRootNode(b,X){if(0===X.length)return null;const P={};for(const S of X){const X=[];let Q=j.Get(`${b}/${S}`,this._gltf.nodes,S);for(;-1!==Q.index;)X.unshift(Q),Q=Q.parent;P[S]=X}let Q=null;for(let S=0;;++S){let b=P[X[0]];if(S>=b.length)return Q;const d=b[S];for(let N=1;N<X.length;++N)if(b=P[X[N]],S>=b.length||d!==b[S])return Q;Q=d}}_loadBone(b,X,P,Q){b._isJoint=!0;let S=Q[b.index];if(S)return S;let d=null;b.index!==X.skeleton&&(b.parent&&-1!==b.parent.index?d=this._loadBone(b.parent,X,P,Q):void 0!==X.skeleton&&E.b.Warn(`/skins/${X.index}/skeleton: Skeleton node is not a common root`));const N=X.joints.indexOf(b.index);return S=new w.d(b.name||`joint${b.index}`,P,d,this._getNodeMatrix(b),null,null,N),Q[b.index]=S,this._postSceneLoadActions.push((()=>{S.linkTransformNode(b._babylonTransformNode)})),S}_loadSkinInverseBindMatricesDataAsync(b,X){if(void 0==X.inverseBindMatrices)return Promise.resolve(null);const P=j.Get(`${b}/inverseBindMatrices`,this._gltf.accessors,X.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${P.index}`,P)}_updateBoneMatrices(b,X){for(const P of b.bones){const b=S.Matrix.Identity(),Q=P._index;X&&-1!==Q&&(S.Matrix.FromArrayToRef(X,16*Q,b),b.invertToRef(b));const d=P.getParent();d&&b.multiplyToRef(d.getAbsoluteInverseBindMatrix(),b),P.Cd(b,!1,!1),P._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(b){return b.matrix?S.Matrix.hX(b.matrix):S.Matrix.Compose(b.scale?S.tX.hX(b.scale):S.tX.One(),b.rotation?S.Quaternion.hX(b.rotation):S.Quaternion.Identity(),b.translation?S.tX.hX(b.translation):S.tX.Zero())}loadCameraAsync(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadCameraAsync(b,X,P);if(Q)return Q;const d=new Array;this.logOpen(`${b} ${X.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new u.b(X.name||`camera${X.index}`,S.tX.Zero(),this._babylonScene,!1);switch(N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._babylonCamera=N,N.setTarget(new S.tX(0,0,-1)),X.type){case"perspective":{const P=X.perspective;if(!P)throw new Error(`${b}: Camera perspective properties are missing`);N.fov=P.yfov,N.Vd=P.znear,N.maxZ=P.zfar||0;break}case"orthographic":if(!X.orthographic)throw new Error(`${b}: Camera orthographic properties are missing`);N.mode=a.c.ORTHOGRAPHIC_CAMERA,N.orthoLeft=-X.orthographic.xmag,N.orthoRight=X.orthographic.xmag,N.orthoBottom=-X.orthographic.ymag,N.orthoTop=X.orthographic.ymag,N.Vd=X.orthographic.znear,N.maxZ=X.orthographic.zfar;break;default:throw new Error(`${b}: Invalid camera type (${X.type})`)}return J.AddPointerMetadata(N,b),this._parent.onCameraLoadedObservable.notifyObservers(N),P(N),this.logClose(),Promise.all(d).then((()=>N))}_loadAnimationsAsync(){const b=this._gltf.animations;if(!b)return Promise.resolve();const X=new Array;for(let P=0;P<b.length;P++){const Q=b[P];X.push(this.loadAnimationAsync(`/animations/${Q.index}`,Q).then((b=>{0===b.targetedAnimations.length&&b.dispose()})))}return Promise.all(X).then((()=>{}))}loadAnimationAsync(b,X){const Q=this._extensionsLoadAnimationAsync(b,X);return Q||P.e(78).then(P.bind(P,15121)).then((P=>{let{AnimationGroup:Q}=P;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new Q(X.name||`animation${X.index}`,this._babylonScene);S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._babylonAnimationGroup=S;const d=new Array;j.Assign(X.channels),j.Assign(X.samplers);for(const N of X.channels)d.push(this._loadAnimationChannelAsync(`${b}/channels/${N.index}`,b,X,N,((b,X)=>{b.animations=b.animations||[],b.animations.push(X),S.addTargetedAnimation(X,b)})));return Promise.all(d).then((()=>(S.normalize(0),S)))}))}async _loadAnimationChannelAsync(b,X,Q,S,d){const N=this._extensionsLoadAnimationChannelAsync(b,X,Q,S,d);if(N)return await N;if(void 0==S.target.node)return await Promise.resolve();const a=j.Get(`${b}/target/node`,this._gltf.nodes,S.target.node),u=S.target.path,w="weights"===u;if(w&&!a._numMorphTargets||!w&&!a._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!w&&!a._isJoint)return await Promise.resolve();let f;switch(await Promise.resolve().then(P.bind(P,13579)),u){case"translation":var O;f=null===(O=(0,z.e)("/nodes/{}/translation"))||void 0===O?void 0:O.interpolation;break;case"rotation":var e;f=null===(e=(0,z.e)("/nodes/{}/rotation"))||void 0===e?void 0:e.interpolation;break;case"scale":var Y;f=null===(Y=(0,z.e)("/nodes/{}/scale"))||void 0===Y?void 0:Y.interpolation;break;case"weights":var D;f=null===(D=(0,z.e)("/nodes/{}/weights"))||void 0===D?void 0:D.interpolation;break;default:throw new Error(`${b}/target/path: Invalid value (${S.target.path})`)}if(!f)throw new Error(`${b}/target/path: Could not find interpolation properties for target path (${S.target.path})`);const E={object:a,info:f};return await this._loadAnimationChannelFromTargetInfoAsync(b,X,Q,S,E,d)}_loadAnimationChannelFromTargetInfoAsync(b,X,P,Q,S,d){const N=this.parent.targetFps,a=1/N,u=j.Get(`${b}/sampler`,P.samplers,Q.sampler);return this._loadAnimationSamplerAsync(`${X}/samplers/${Q.sampler}`,u).then((b=>{let X=0;const u=S.object,w=S.info;for(const S of w){const w=S.getStride(u),f=b.input,O=b.output,e=new Array(f.length);let Y=0;switch(b.interpolation){case"STEP":for(let b=0;b<f.length;b++){const X=S.getValue(u,O,Y,1);Y+=w,e[b]={frame:f[b]*N,value:X,interpolation:1}}break;case"CUBICSPLINE":for(let b=0;b<f.length;b++){const X=S.getValue(u,O,Y,a);Y+=w;const P=S.getValue(u,O,Y,1);Y+=w;const Q=S.getValue(u,O,Y,a);Y+=w,e[b]={frame:f[b]*N,inTangent:X,value:P,outTangent:Q}}break;case"LINEAR":for(let b=0;b<f.length;b++){const X=S.getValue(u,O,Y,1);Y+=w,e[b]={frame:f[b]*N,value:X}}}if(Y>0){const b=`${P.name||`animation${P.index}`}_channel${Q.index}_${X}`,a=S.buildAnimations(u,b,N,e);for(const P of a)X++,d(P.babylonAnimatable,P.babylonAnimation)}}}))}_loadAnimationSamplerAsync(b,X){if(X._data)return X._data;const P=X.interpolation||"LINEAR";switch(P){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${b}/interpolation: Invalid value (${X.interpolation})`)}const Q=j.Get(`${b}/input`,this._gltf.accessors,X.input),S=j.Get(`${b}/output`,this._gltf.accessors,X.output);return X._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${Q.index}`,Q),this._loadFloatAccessorAsync(`/accessors/${S.index}`,S)]).then((b=>{let[X,Q]=b;return{input:X,interpolation:P,output:Q}})),X._data}loadBufferAsync(b,X,P,Q){const S=this._extensionsLoadBufferAsync(b,X,P,Q);if(S)return S;if(!X._data)if(X.uri)X._data=this.loadUriAsync(`${b}/uri`,X,X.uri);else{if(!this._bin)throw new Error(`${b}: Uri is missing or the binary glTF is missing its binary chunk`);X._data=this._bin.readAsync(0,X.byteLength)}return X._data.then((X=>{try{return new Uint8Array(X.buffer,X.byteOffset+P,Q)}catch(S){throw new Error(`${b}: ${S.message}`)}}))}loadBufferViewAsync(b,X){const P=this._extensionsLoadBufferViewAsync(b,X);if(P)return P;if(X._data)return X._data;const Q=j.Get(`${b}/buffer`,this._gltf.buffers,X.buffer);return X._data=this.loadBufferAsync(`/buffers/${Q.index}`,Q,X.byteOffset||0,X.byteLength),X._data}_loadAccessorAsync(b,X,P){if(X._data)return X._data;const Q=J._GetNumComponents(b,X.type),S=Q*L.g.GetTypeByteLength(X.componentType),d=Q*X.count;if(void 0==X.bufferView)X._data=Promise.resolve(new P(d));else{const N=j.Get(`${b}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${N.index}`,N).then((a=>{if(5126!==X.componentType||X.normalized||N.byteStride&&N.byteStride!==S){const b=new P(d);return L.g.ForEach(a,X.byteOffset||0,N.byteStride||S,Q,X.componentType,b.length,X.normalized||!1,((X,P)=>{b[P]=X})),b}return J._GetTypedArray(b,X.componentType,a,X.byteOffset,d)}))}if(X.sparse){const d=X.sparse;X._data=X._data.then((N=>{const a=N,u=j.Get(`${b}/sparse/indices/bufferView`,this._gltf.bufferViews,d.indices.bufferView),w=j.Get(`${b}/sparse/values/bufferView`,this._gltf.bufferViews,d.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${u.index}`,u),this.loadBufferViewAsync(`/bufferViews/${w.index}`,w)]).then((N=>{let[u,w]=N;const f=J._GetTypedArray(`${b}/sparse/indices`,d.indices.componentType,u,d.indices.byteOffset,d.count),O=Q*d.count;let e;if(5126!==X.componentType||X.normalized){const N=J._GetTypedArray(`${b}/sparse/values`,X.componentType,w,d.values.byteOffset,O);e=new P(O),L.g.ForEach(N,0,S,Q,X.componentType,e.length,X.normalized||!1,((b,X)=>{e[X]=b}))}else e=J._GetTypedArray(`${b}/sparse/values`,X.componentType,w,d.values.byteOffset,O);let Y=0;for(let b=0;b<f.length;b++){let X=f[b]*Q;for(let b=0;b<Q;b++)a[X++]=e[Y++]}return a}))}))}return X._data}_loadFloatAccessorAsync(b,X){return this._loadAccessorAsync(b,X,Float32Array)}_loadIndicesAccessorAsync(b,X){if("SCALAR"!==X.type)throw new Error(`${b}/type: Invalid value ${X.type}`);if(5121!==X.componentType&&5123!==X.componentType&&5125!==X.componentType)throw new Error(`${b}/componentType: Invalid value ${X.componentType}`);if(X._data)return X._data;if(X.sparse){const P=J._GetTypedArrayConstructor(`${b}/componentType`,X.componentType);X._data=this._loadAccessorAsync(b,X,P)}else{const P=j.Get(`${b}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${P.index}`,P).then((P=>J._GetTypedArray(b,X.componentType,P,X.byteOffset,X.count)))}return X._data}_loadVertexBufferViewAsync(b){if(b._babylonBuffer)return b._babylonBuffer;const X=this._babylonScene.getEngine();return b._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((b=>new L.c(X,b,!1))),b._babylonBuffer}_loadVertexAccessorAsync(b,X,P){var Q;if(null!==(Q=X._babylonVertexBuffer)&&void 0!==Q&&Q[P])return X._babylonVertexBuffer[P];X._babylonVertexBuffer||(X._babylonVertexBuffer={});const S=this._babylonScene.getEngine();if(X.sparse||void 0==X.bufferView)X._babylonVertexBuffer[P]=this._loadFloatAccessorAsync(b,X).then((b=>new L.g(S,b,P,!1)));else{const Q=j.Get(`${b}/bufferView`,this._gltf.bufferViews,X.bufferView);X._babylonVertexBuffer[P]=this._loadVertexBufferViewAsync(Q).then((d=>{const N=J._GetNumComponents(b,X.type);return new L.g(S,d,P,!1,void 0,Q.byteStride,void 0,X.byteOffset,N,X.componentType,X.normalized,!0,void 0,!0)}))}return X._babylonVertexBuffer[P]}_loadMaterialMetallicRoughnessPropertiesAsync(b,X,P){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);const Q=new Array;return X&&(X.baseColorFactor?(P.albedoColor=d.yX.hX(X.baseColorFactor),P.alpha=X.baseColorFactor[3]):P.albedoColor=d.yX.White(),P.metallic=void 0==X.metallicFactor?1:X.metallicFactor,P.roughness=void 0==X.roughnessFactor?1:X.roughnessFactor,X.baseColorTexture&&Q.push(this.loadTextureInfoAsync(`${b}/baseColorTexture`,X.baseColorTexture,(b=>{b.name=`${P.name} (Base Color)`,P.albedoTexture=b}))),X.metallicRoughnessTexture&&(X.metallicRoughnessTexture.nonColorData=!0,Q.push(this.loadTextureInfoAsync(`${b}/metallicRoughnessTexture`,X.metallicRoughnessTexture,(b=>{b.name=`${P.name} (Metallic Roughness)`,P.metallicTexture=b}))),P.useMetallnessFromMetallicTextureBlue=!0,P.useRoughnessFromMetallicTextureGreen=!0,P.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(Q).then((()=>{}))}_loadMaterialAsync(b,X,P,Q){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const d=this._extensionsLoadMaterialAsync(b,X,P,Q,S);if(d)return d;X._data=X._data||{};let N=X._data[Q];if(!N){this.logOpen(`${b} ${X.name||""}`);const P=this.createMaterial(b,X,Q);N={babylonMaterial:P,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(b,X,P)},X._data[Q]=N,J.AddPointerMetadata(P,b),this._parent.onMaterialLoadedObservable.notifyObservers(P),this.logClose()}return P&&(N.babylonMeshes.push(P),P.Nd.addOnce((()=>{const b=N.babylonMeshes.indexOf(P);-1!==b&&N.babylonMeshes.splice(b,1)}))),S(N.babylonMaterial),N.promise.then((()=>N.babylonMaterial))}_createDefaultMaterial(b,X){this._babylonScene._blockEntityCollection=!!this._assetContainer;const P=new n.e(b,this._babylonScene);return P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,P.fillMode=X,P.enableSpecularAntiAliasing=!0,P.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,P.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,P.transparencyMode=n.e.PBRMATERIAL_OPAQUE,P.metallic=1,P.roughness=1,P}createMaterial(b,X,P){const Q=this._extensionsCreateMaterial(b,X,P);if(Q)return Q;const S=X.name||`material${X.index}`;return this._createDefaultMaterial(S,P)}loadMaterialPropertiesAsync(b,X,P){const Q=this._extensionsLoadMaterialPropertiesAsync(b,X,P);if(Q)return Q;const S=new Array;return S.push(this.loadMaterialBasePropertiesAsync(b,X,P)),X.pbrMetallicRoughness&&S.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${b}/pbrMetallicRoughness`,X.pbrMetallicRoughness,P)),this.loadMaterialAlphaProperties(b,X,P),Promise.all(S).then((()=>{}))}loadMaterialBasePropertiesAsync(b,X,P){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);const Q=new Array;return P.emissiveColor=X.emissiveFactor?d.yX.hX(X.emissiveFactor):new d.yX(0,0,0),X.doubleSided&&(P.Jd=!1,P.twoSidedLighting=!0),X.normalTexture&&(X.normalTexture.nonColorData=!0,Q.push(this.loadTextureInfoAsync(`${b}/normalTexture`,X.normalTexture,(b=>{b.name=`${P.name} (Normal)`,P.bumpTexture=b}))),P.invertNormalMapX=!this._babylonScene.useRightHandedSystem,P.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=X.normalTexture.scale&&P.bumpTexture&&(P.bumpTexture.level=X.normalTexture.scale),P.forceIrradianceInFragment=!0),X.occlusionTexture&&(X.occlusionTexture.nonColorData=!0,Q.push(this.loadTextureInfoAsync(`${b}/occlusionTexture`,X.occlusionTexture,(b=>{b.name=`${P.name} (Occlusion)`,P.ambientTexture=b}))),P.useAmbientInGrayScale=!0,void 0!=X.occlusionTexture.strength&&(P.ambientTextureStrength=X.occlusionTexture.strength)),X.emissiveTexture&&Q.push(this.loadTextureInfoAsync(`${b}/emissiveTexture`,X.emissiveTexture,(b=>{b.name=`${P.name} (Emissive)`,P.emissiveTexture=b}))),Promise.all(Q).then((()=>{}))}loadMaterialAlphaProperties(b,X,P){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);switch(X.alphaMode||"OPAQUE"){case"OPAQUE":P.transparencyMode=n.e.PBRMATERIAL_OPAQUE,P.alpha=1;break;case"MASK":P.transparencyMode=n.e.PBRMATERIAL_ALPHATEST,P.alphaCutOff=void 0==X.alphaCutoff?.5:X.alphaCutoff,P.albedoTexture&&(P.albedoTexture.Ad=!0);break;case"BLEND":P.transparencyMode=n.e.PBRMATERIAL_ALPHABLEND,P.albedoTexture&&(P.albedoTexture.Ad=!0,P.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${b}/alphaMode: Invalid value (${X.alphaMode})`)}}loadTextureInfoAsync(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadTextureInfoAsync(b,X,P);if(Q)return Q;if(this.logOpen(`${b}`),X.texCoord>=6)throw new Error(`${b}/texCoord: Invalid value (${X.texCoord})`);const S=j.Get(`${b}/index`,this._gltf.textures,X.index);S._textureInfo=X;const d=this._loadTextureAsync(`/textures/${X.index}`,S,(Q=>{Q.coordinatesIndex=X.texCoord||0,J.AddPointerMetadata(Q,b),this._parent.onTextureLoadedObservable.notifyObservers(Q),P(Q)}));return this.logClose(),d}_loadTextureAsync(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadTextureAsync(b,X,P);if(Q)return Q;this.logOpen(`${b} ${X.name||""}`);const S=void 0==X.sampler?J.DefaultSampler:j.Get(`${b}/sampler`,this._gltf.samplers,X.sampler),d=j.Get(`${b}/source`,this._gltf.images,X.source),N=this._createTextureAsync(b,S,d,P,void 0,!X._textureInfo.nonColorData);return this.logClose(),N}_createTextureAsync(b,X,P){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},d=arguments.length>4?arguments[4]:void 0,N=arguments.length>5?arguments[5]:void 0;const a=this._loadSampler(`/samplers/${X.index}`,X),u=new Array,w=new Q;this._babylonScene._blockEntityCollection=!!this._assetContainer;const f={noMipmap:a.noMipMaps,invertY:!1,samplingMode:a.samplingMode,I:()=>{this._disposed||w.resolve()},onError:(X,P)=>{this._disposed||w.reject(new Error(`${b}: ${P&&P.message?P.message:X||"Failed to load texture"}`))},mimeType:P.mimeType??(0,i.f)(P.uri??""),loaderOptions:d,useSRGBBuffer:!!N&&this._parent.useSRGBBuffers},O=new y.d(null,this._babylonScene,f);return O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.push(w.promise),u.push(this.loadImageAsync(`/images/${P.index}`,P).then((b=>{const X=P.uri||`${this._fileName}#image${P.index}`,Q=`data:${this._uniqueRootUrl}${X}`;O.updateURL(Q,b);const S=O.getInternalTexture();S&&(S.label=P.name)}))),O.wrapU=a.wrapU,O.wrapV=a.wrapV,S(O),this._parent.useGltfTextureNames&&(O.name=P.name||P.uri||`image${P.index}`),Promise.all(u).then((()=>O))}_loadSampler(b,X){return X._data||(X._data={noMipMaps:9728===X.minFilter||9729===X.minFilter,samplingMode:J._GetTextureSamplingMode(b,X),wrapU:J._GetTextureWrapMode(`${b}/wrapS`,X.wrapS),wrapV:J._GetTextureWrapMode(`${b}/wrapT`,X.wrapT)}),X._data}loadImageAsync(b,X){if(!X._data){if(this.logOpen(`${b} ${X.name||""}`),X.uri)X._data=this.loadUriAsync(`${b}/uri`,X,X.uri);else{const P=j.Get(`${b}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${P.index}`,P)}this.logClose()}return X._data}loadUriAsync(b,X,P){const Q=this._extensionsLoadUriAsync(b,X,P);if(Q)return Q;if(!J._ValidateUri(P))throw new Error(`${b}: '${P}' is invalid`);if((0,i.i)(P)){const X=new Uint8Array((0,i.c)(P));return this.log(`${b}: Decoded ${P.substring(0,64)}... (${X.length} bytes)`),Promise.resolve(X)}return this.log(`${b}: Loading ${P}`),this._parent.preprocessUrlAsync(this._rootUrl+P).then((X=>new Promise(((Q,S)=>{this._parent._loadFile(this._babylonScene,X,(X=>{this._disposed||(this.log(`${b}: Loaded ${P} (${X.byteLength} bytes)`),Q(new Uint8Array(X)))}),!0,(X=>{S(new i.j(`${b}: Failed to load '${P}'${X?": "+X.status+" "+X.statusText:""}`,X))}))}))))}static AddPointerMetadata(b,X){b.metadata=b.metadata||{};const P=b._internalMetadata=b._internalMetadata||{},Q=P.ed=P.ed||{};(Q.pointers=Q.pointers||[]).push(X)}static _GetTextureWrapMode(b,X){switch(X=void 0==X?10497:X){case 33071:return y.d.CLAMP_ADDRESSMODE;case 33648:return y.d.MIRROR_ADDRESSMODE;case 10497:return y.d.WRAP_ADDRESSMODE;default:return E.b.Warn(`${b}: Invalid value (${X})`),y.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(b,X){const P=void 0==X.magFilter?9729:X.magFilter,Q=void 0==X.minFilter?9987:X.minFilter;if(9729===P)switch(Q){case 9728:return y.d.LINEAR_NEAREST;case 9729:return y.d.LINEAR_LINEAR;case 9984:return y.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return y.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return y.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return y.d.LINEAR_LINEAR_MIPLINEAR;default:return E.b.Warn(`${b}/minFilter: Invalid value (${Q})`),y.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==P&&E.b.Warn(`${b}/magFilter: Invalid value (${P})`),Q){case 9728:return y.d.NEAREST_NEAREST;case 9729:return y.d.NEAREST_LINEAR;case 9984:return y.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return y.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return y.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return y.d.NEAREST_LINEAR_MIPLINEAR;default:return E.b.Warn(`${b}/minFilter: Invalid value (${Q})`),y.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(b,X){try{return(0,g.r)(X)}catch(P){throw new Error(`${b}: ${P.message}`)}}static _GetTypedArray(b,X,P,Q,S){const d=P.buffer;Q=P.byteOffset+(Q||0);const N=J._GetTypedArrayConstructor(`${b}/componentType`,X),a=L.g.GetTypeByteLength(X);return Q%a!==0?(E.b.Warn(`${b}: Copying buffer as byte offset (${Q}) is not a multiple of component type byte length (${a})`),new N(d.slice(Q,Q+S*a),0)):new N(d,Q,S)}static _GetNumComponents(b,X){switch(X){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${b}: Invalid type (${X})`)}static _ValidateUri(b){return N.Tools.IsBase64(b)||-1===b.indexOf("..")}static _GetDrawMode(b,X){switch(void 0==X&&(X=4),X){case 0:return W.b.PointListDrawMode;case 1:return W.b.LineListDrawMode;case 2:return W.b.LineLoopDrawMode;case 3:return W.b.LineStripDrawMode;case 4:return W.b.TriangleFillMode;case 5:return W.b.TriangleStripDrawMode;case 6:return W.b.TriangleFanDrawMode}throw new Error(`${b}: Invalid mesh primitive mode (${X})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const b=new Array;if(this._gltf.materials)for(const X of this._gltf.materials)if(X._data)for(const P in X._data){const Q=X._data[P];for(const X of Q.babylonMeshes){X.pd(!0);const P=Q.babylonMaterial;b.push(P.forceCompilationAsync(X)),b.push(P.forceCompilationAsync(X,{useInstances:!0})),this._parent.useClipPlane&&(b.push(P.forceCompilationAsync(X,{clipPlane:!0})),b.push(P.forceCompilationAsync(X,{clipPlane:!0,useInstances:!0})))}}return Promise.all(b).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const b=new Array,X=this._babylonScene.lights;for(const P of X){const X=P.getShadowGenerator();X&&b.push(X.forceCompilationAsync())}return Promise.all(b).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(b){for(const X of this._extensions)X.enabled&&b(X)}_applyExtensions(b,X,P){for(const Q of this._extensions)if(Q.enabled){const S=`${Q.name}.${X}`,d=b;d._activeLoaderExtensionFunctions=d._activeLoaderExtensionFunctions||{};const N=d._activeLoaderExtensionFunctions;if(!N[S]){N[S]=!0;try{const b=P(Q);if(b)return b}finally{delete N[S]}}}return null}_extensionsOnLoading(){this._forEachExtensions((b=>b.onLoading&&b.onLoading()))}_extensionsOnReady(){this._forEachExtensions((b=>b.onReady&&b.onReady()))}_extensionsLoadSceneAsync(b,X){return this._applyExtensions(X,"loadScene",(P=>P.loadSceneAsync&&P.loadSceneAsync(b,X)))}_extensionsLoadNodeAsync(b,X,P){return this._applyExtensions(X,"loadNode",(Q=>Q.loadNodeAsync&&Q.loadNodeAsync(b,X,P)))}_extensionsLoadCameraAsync(b,X,P){return this._applyExtensions(X,"loadCamera",(Q=>Q.loadCameraAsync&&Q.loadCameraAsync(b,X,P)))}_extensionsLoadVertexDataAsync(b,X,P){return this._applyExtensions(X,"loadVertexData",(Q=>Q._loadVertexDataAsync&&Q._loadVertexDataAsync(b,X,P)))}_extensionsLoadMeshPrimitiveAsync(b,X,P,Q,S,d){return this._applyExtensions(S,"loadMeshPrimitive",(N=>N._loadMeshPrimitiveAsync&&N._loadMeshPrimitiveAsync(b,X,P,Q,S,d)))}_extensionsLoadMaterialAsync(b,X,P,Q,S){return this._applyExtensions(X,"loadMaterial",(d=>d._loadMaterialAsync&&d._loadMaterialAsync(b,X,P,Q,S)))}_extensionsCreateMaterial(b,X,P){return this._applyExtensions(X,"createMaterial",(Q=>Q.createMaterial&&Q.createMaterial(b,X,P)))}_extensionsLoadMaterialPropertiesAsync(b,X,P){return this._applyExtensions(X,"loadMaterialProperties",(Q=>Q.loadMaterialPropertiesAsync&&Q.loadMaterialPropertiesAsync(b,X,P)))}_extensionsLoadTextureInfoAsync(b,X,P){return this._applyExtensions(X,"loadTextureInfo",(Q=>Q.loadTextureInfoAsync&&Q.loadTextureInfoAsync(b,X,P)))}_extensionsLoadTextureAsync(b,X,P){return this._applyExtensions(X,"loadTexture",(Q=>Q._loadTextureAsync&&Q._loadTextureAsync(b,X,P)))}_extensionsLoadAnimationAsync(b,X){return this._applyExtensions(X,"loadAnimation",(P=>P.loadAnimationAsync&&P.loadAnimationAsync(b,X)))}_extensionsLoadAnimationChannelAsync(b,X,P,Q,S){return this._applyExtensions(P,"loadAnimationChannel",(d=>d._loadAnimationChannelAsync&&d._loadAnimationChannelAsync(b,X,P,Q,S)))}_extensionsLoadSkinAsync(b,X,P){return this._applyExtensions(P,"loadSkin",(Q=>Q._loadSkinAsync&&Q._loadSkinAsync(b,X,P)))}_extensionsLoadUriAsync(b,X,P){return this._applyExtensions(X,"loadUri",(Q=>Q._loadUriAsync&&Q._loadUriAsync(b,X,P)))}_extensionsLoadBufferViewAsync(b,X){return this._applyExtensions(X,"loadBufferView",(P=>P.loadBufferViewAsync&&P.loadBufferViewAsync(b,X)))}_extensionsLoadBufferAsync(b,X,P,Q){return this._applyExtensions(X,"loadBuffer",(S=>S.loadBufferAsync&&S.loadBufferAsync(b,X,P,Q)))}static LoadExtensionAsync(b,X,P,Q){if(!X.extensions)return null;const S=X.extensions[P];return S?Q(`${b}/extensions/${P}`,S):null}static LoadExtraAsync(b,X,P,Q){if(!X.extras)return null;const S=X.extras[P];return S?Q(`${b}/extras/${P}`,S):null}isExtensionUsed(b){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(b)}logOpen(b){this._parent._logOpen(b)}logClose(){this._parent._logClose()}log(b){this._parent._log(b)}startPerformanceCounter(b){this._parent._startPerformanceCounter(b)}endPerformanceCounter(b){this._parent._endPerformanceCounter(b)}}J.DefaultSampler={index:-1},V.c._CreateGLTF2Loader=b=>new J(b);var c=P(13579),s=P(12032),F=P(11862),M=P(13583),R=P(13592);class r extends R.c{constructor(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],N=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",b),this._texture=b.getEngine().createRawCubeTexture(X,P,Q,S,d,N,a,u)}update(b,X,P,Q){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,b,X,P,Q,S)}updateRGBDAsync(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,M.h)(this._texture,b,X,P,Q).then((()=>{}))}clone(){return F.b.Clone((()=>{const b=this.Ab(),X=this._texture,P=new r(b,X._bufferViewArray,X.width,X.format,X.type,X.generateMipMaps,X.invertY,X.samplingMode,X._compression);return 13===X.source&&P.updateRGBDAsync(X._bufferViewArrayArray,X._sphericalPolynomial,X._lodGenerationScale,X._lodGenerationOffset),P}),this)}}const I="EXT_lights_image_based";class G{constructor(b){this.name=I,this._loader=b,this.enabled=this._loader.isExtensionUsed(I)}dispose(){this._loader=null,delete this._lights}onLoading(){const b=this._loader.ed.extensions;if(b&&b[this.name]){const X=b[this.name];this._lights=X.lights}}loadSceneAsync(b,X){return J.LoadExtensionAsync(b,X,this.name,(async(P,Q)=>{this._loader._allMaterialsDirtyRequired=!0;const S=new Array;S.push(this._loader.loadSceneAsync(b,X)),this._loader.logOpen(`${P}`);const d=j.Get(`${P}/light`,this._lights,Q.Pd);return S.push(this._loadLightAsync(`/extensions/${this.name}/lights/${Q.Pd}`,d).then((b=>{this._loader.babylonScene.environmentTexture=b}))),this._loader.logClose(),await Promise.all(S).then((()=>{}))}))}_loadLightAsync(b,X){if(!X._loaded){const P=new Array;this._loader.logOpen(`${b}`);const Q=new Array(X.specularImages.length);for(let S=0;S<X.specularImages.length;S++){const d=X.specularImages[S];Q[S]=new Array(d.length);for(let X=0;X<d.length;X++){const N=`${b}/specularImages/${S}/${X}`;this._loader.logOpen(`${N}`);const a=d[X],u=j.Get(N,this._loader.ed.images,a);P.push(this._loader.loadImageAsync(`/images/${a}`,u).then((b=>{Q[S][X]=b}))),this._loader.logClose()}}this._loader.logClose(),X._loaded=Promise.all(P).then((async()=>{const P=new r(this._loader.babylonScene,null,X.specularImageSize);if(P.name=X.name||"environment",X._babylonTexture=P,void 0!=X.ya&&(P.level=X.ya),X.rotation){let b=S.Quaternion.hX(X.rotation);this._loader.babylonScene.useRightHandedSystem||(b=S.Quaternion.Inverse(b)),S.Matrix.FromQuaternionToRef(b,P.getReflectionTextureMatrix())}if(!X.irradianceCoefficients)throw new Error(`${b}: Irradiance coefficients are missing`);const d=s.c.hX(X.irradianceCoefficients);d.scaleInPlace(X.ya),d.convertIrradianceToLambertianRadiance();const N=s.d.FromHarmonics(d),a=(Q.length-1)/Math.log2(X.specularImageSize);return await P.updateRGBDAsync(Q,N,a)}))}return X._loaded.then((()=>X._babylonTexture))}}k(I),p(I,!0,(b=>new G(b)));P(12420);const mb="EXT_mesh_gpu_instancing";class bb{constructor(b){this.name=mb,this._loader=b,this.enabled=this._loader.isExtensionUsed(mb)}dispose(){this._loader=null}loadNodeAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(b,Q)=>{this._loader._disableInstancedMesh++;const d=this._loader.loadNodeAsync(`/nodes/${X.index}`,X,P);if(this._loader._disableInstancedMesh--,!X._primitiveBabylonMeshes)return await d;const N=new Array;let a=0;const u=X=>{if(void 0==Q.attributes[X])return void N.push(Promise.resolve(null));const P=j.Get(`${b}/attributes/${X}`,this._loader.ed.accessors,Q.attributes[X]);if(N.push(this._loader._loadFloatAccessorAsync(`/accessors/${P.bufferView}`,P)),0===a)a=P.count;else if(a!==P.count)throw new Error(`${b}/attributes: Instance buffer accessors do not have the same count.`)};return u("TRANSLATION"),u("ROTATION"),u("SCALE"),await d.then((async b=>{const[P,Q,d]=await Promise.all(N),u=new Float32Array(16*a);S.TmpVectors.tX[0].sd(0,0,0),S.TmpVectors.Quaternion[0].sd(0,0,0,1),S.TmpVectors.tX[1].sd(1,1,1);for(let X=0;X<a;++X)P&&S.tX.FromArrayToRef(P,3*X,S.TmpVectors.tX[0]),Q&&S.Quaternion.FromArrayToRef(Q,4*X,S.TmpVectors.Quaternion[0]),d&&S.tX.FromArrayToRef(d,3*X,S.TmpVectors.tX[1]),S.Matrix.ComposeToRef(S.TmpVectors.tX[1],S.TmpVectors.Quaternion[0],S.TmpVectors.tX[0],S.TmpVectors.Matrix[0]),S.TmpVectors.Matrix[0].copyToArray(u,16*X);for(const S of X._primitiveBabylonMeshes)S.oO("matrix",u,16,!0);return b}))}))}}k(mb),p(mb,!0,(b=>new bb(b)));let Xb=0,Pb=null;class Qb{static get Default(){return Qb._Default||(Qb._Default=new Qb),Qb._Default}constructor(){const b=Qb.Configuration.decoder;this._decoderModulePromise=N.Tools.LoadBabylonScriptAsync(b.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(b,X,P,Q,S){await this._decoderModulePromise,0===Xb&&(MeshoptDecoder.useWorkers(1),Xb=1);const d=await MeshoptDecoder.decodeGltfBufferAsync(X,P,b,Q,S);return null!==Pb&&clearTimeout(Pb),Pb=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Xb=0,Pb=null}),1e3),d}}Qb.Configuration={decoder:{url:`${N.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Qb._Default=null;const Sb="EXT_meshopt_compression";class db{constructor(b){this.name=Sb,this.enabled=b.isExtensionUsed(Sb),this._loader=b}dispose(){this._loader=null}loadBufferViewAsync(b,X){return J.LoadExtensionAsync(b,X,this.name,(async(P,Q)=>{const S=X;if(S._meshOptData)return await S._meshOptData;const d=j.Get(`${b}/buffer`,this._loader.ed.buffers,Q.buffer);return S._meshOptData=this._loader.loadBufferAsync(`/buffers/${d.index}`,d,Q.byteOffset||0,Q.byteLength).then((async b=>await Qb.Default.decodeGltfBufferAsync(b,Q.count,Q.byteStride,Q.mode,Q.filter))),await S._meshOptData}))}}k(Sb),p(Sb,!0,(b=>new db(b)));const Nb="EXT_texture_webp";class ab{constructor(b){this.name=Nb,this._loader=b,this.enabled=b.isExtensionUsed(Nb)}dispose(){this._loader=null}_loadTextureAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=void 0==X.sampler?J.DefaultSampler:j.Get(`${b}/sampler`,this._loader.ed.samplers,X.sampler),N=j.Get(`${Q}/source`,this._loader.ed.images,S.source);return await this._loader._createTextureAsync(b,d,N,(b=>{P(b)}),void 0,!X._textureInfo.nonColorData)}))}}k(Nb),p(Nb,!0,(b=>new ab(b)));const ub="EXT_texture_avif";class wb{constructor(b){this.name=ub,this._loader=b,this.enabled=b.isExtensionUsed(ub)}dispose(){this._loader=null}_loadTextureAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=void 0==X.sampler?J.DefaultSampler:j.Get(`${b}/sampler`,this._loader.ed.samplers,X.sampler),N=j.Get(`${Q}/source`,this._loader.ed.images,S.source);return await this._loader._createTextureAsync(b,d,N,(b=>{P(b)}),void 0,!X._textureInfo.nonColorData)}))}}k(ub),p(ub,!0,(b=>new wb(b)));var fb=P(13577),Ob=P(12396);const eb="EXT_lights_ies";class Yb{constructor(b){this.name=eb,this._loader=b,this.enabled=this._loader.isExtensionUsed(eb)}dispose(){this._loader=null,delete this._lights}onLoading(){const b=this._loader.ed.extensions;if(b&&b[this.name]){const X=b[this.name];this._lights=X.lights,j.Assign(this._lights)}}loadNodeAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,N)=>{let a,u;this._loader._allMaterialsDirtyRequired=!0;const w=await this._loader.loadNodeAsync(b,X,(b=>{u=j.Get(Q,this._lights,N.Pd);const X=u.name||b.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,a=new fb.d(X,S.tX.Zero(),S.tX.Backward(),0,1,this._loader.babylonScene),a.angle=Math.PI/2,a.innerAngle=0,a._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,u._babylonLight=a,a.falloffType=Ob.e.FALLOFF_GLTF,a.ha=N.color?d.yX.hX(N.color):d.yX.White(),a.ya=N.multiplier||1,a.range=Number.MAX_VALUE,a.parent=b,this._loader._babylonLights.push(a),J.AddPointerMetadata(a,Q),P(b)}));let f;if(u.uri)f=await this._loader.loadUriAsync(b,u,u.uri);else{const X=j.Get(`${b}/bufferView`,this._loader.ed.bufferViews,u.bufferView);f=await this._loader.loadBufferViewAsync(`/bufferViews/${X.index}`,X)}return a.iesProfileTexture=new y.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,f,!0,void 0,void 0,void 0,void 0,".ies"),w}))}}k(eb),p(eb,!0,(b=>new Yb(b)));var Db=P(13602);const Eb="KHR_draco_mesh_compression";class tb{constructor(b){this.name=Eb,this.useNormalizedFlagFromAccessor=!0,this._loader=b,this.enabled=Db.b.DefaultAvailable&&this._loader.isExtensionUsed(Eb)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{if(void 0!=X.mode&&4!==X.mode&&5!==X.mode)throw new Error(`${b}: Unsupported mode ${X.mode}`);const d={},N={},a=(b,Q)=>{const a=S.attributes[b];if(void 0!=a&&(P._delayInfo=P._delayInfo||[],-1===P._delayInfo.indexOf(Q)&&P._delayInfo.push(Q),d[Q]=a,this.useNormalizedFlagFromAccessor)){const P=j.TryGet(this._loader.ed.accessors,X.attributes[b]);P&&(N[Q]=P.normalized||!1)}};a("POSITION",L.g.PositionKind),a("NORMAL",L.g.NormalKind),a("TANGENT",L.g.TangentKind),a("TEXCOORD_0",L.g.UVKind),a("TEXCOORD_1",L.g.UV2Kind),a("TEXCOORD_2",L.g.UV3Kind),a("TEXCOORD_3",L.g.UV4Kind),a("TEXCOORD_4",L.g.UV5Kind),a("TEXCOORD_5",L.g.UV6Kind),a("JOINTS_0",L.g.MatricesIndicesKind),a("WEIGHTS_0",L.g.MatricesWeightsKind),a("COLOR_0",L.g.ColorKind);const u=j.Get(Q,this._loader.ed.bufferViews,S.bufferView);return u._dracoBabylonGeometry||(u._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${u.index}`,u).then((async Q=>{const S=this.dracoDecoder||Db.b.Default,a=j.TryGet(this._loader.ed.accessors,X.attributes.POSITION),u=this._loader.parent.alwaysComputeBoundingBox||P.skeleton||!a?null:l(a);return await S._decodeMeshToGeometryForGltfAsync(P.name,this._loader.babylonScene,Q,d,N,u).catch((X=>{throw new Error(`${b}: ${X.message}`)}))}))),await u._dracoBabylonGeometry}))}}k(Eb),p(Eb,!0,(b=>new tb(b)));var Bb=P(13608),Wb=P(11822),nb=P(11825),yb=P(12281),hb=P(12447),Lb=P(11802);yb.c.AddNodeConstructor("Light_Type_0",((b,X)=>()=>new Zb(b,S.tX.Zero(),X)));class Zb extends hb.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(b){this._shadowAngle=b,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(b){const X=this.needCube();if(this._direction=b,this.needCube()!==X&&this._shadowGenerators){const b=this._shadowGenerators.values();for(let X=b.next();!0!==X.done;X=b.next()){X.value.recreateShadowMap()}}}constructor(b,X,P){super(b,P),this._shadowAngle=Math.PI/2,this.position=X}getClassName(){return"PointLight"}getTypeID(){return Ob.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(b){if(this.direction)return super.getShadowDirection(b);switch(b){case 0:return new S.tX(1,0,0);case 1:return new S.tX(-1,0,0);case 2:return new S.tX(0,-1,0);case 3:return new S.tX(0,1,0);case 4:return new S.tX(0,0,1);case 5:return new S.tX(0,0,-1)}return S.tX.Zero()}_setDefaultShadowProjectionMatrix(b,X,P){const Q=this.Ab().activeCamera;if(!Q)return;const d=void 0!==this.shadowMinZ?this.shadowMinZ:Q.Vd,N=void 0!==this.shadowMaxZ?this.shadowMaxZ:Q.maxZ,a=this.Ab().getEngine().useReverseDepthBuffer;S.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,a?N:d,a?d:N,b,!0,this._scene.getEngine().isNDCHalfZRange,void 0,a)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(b,X){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,X):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,X),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,X),this}transferToNodeMaterialEffect(b,X){return this.computeTransformedInformation()?b.setFloat3(X,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):b.setFloat3(X,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(b,X){b["POINTLIGHT"+X]=!0}}(0,Wb.b)([(0,nb.E)()],Zb.prototype,"shadowAngle",null),(0,Lb.h)("BABYLON.PointLight",Zb);const vb="KHR_lights_punctual";class Ab{constructor(b){this.name=vb,this._loader=b,this.enabled=this._loader.isExtensionUsed(vb)}dispose(){this._loader=null,delete this._lights}onLoading(){const b=this._loader.ed.extensions;if(b&&b[this.name]){const X=b[this.name];this._lights=X.lights,j.Assign(this._lights)}}loadNodeAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,N)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(b,X,(b=>{let X;const a=j.Get(Q,this._lights,N.Pd),u=a.name||b.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,a.type){case"directional":{const b=new Bb.d(u,S.tX.Backward(),this._loader.babylonScene);b.position.Gd(0),X=b;break}case"point":X=new Zb(u,S.tX.Zero(),this._loader.babylonScene);break;case"spot":{const b=new fb.d(u,S.tX.Zero(),S.tX.Backward(),0,1,this._loader.babylonScene);b.angle=2*(a.spot&&a.spot.outerConeAngle||Math.PI/4),b.innerAngle=2*(a.spot&&a.spot.innerConeAngle||0),X=b;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${Q}: Invalid light type (${a.type})`)}X._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,a._babylonLight=X,X.falloffType=Ob.e.FALLOFF_GLTF,X.ha=a.color?d.yX.hX(a.color):d.yX.White(),X.ya=void 0==a.ya?1:a.ya,X.range=void 0==a.range?Number.MAX_VALUE:a.range,X.parent=b,this._loader._babylonLights.push(X),J.AddPointerMetadata(X,Q),P(b)})))))}}k(vb),p(vb,!0,(b=>new Ab(b)));const ob="KHR_materials_pbrSpecularGlossiness";class Kb{constructor(b){this.name=ob,this.order=200,this._loader=b,this.enabled=this._loader.isExtensionUsed(ob)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=new Array;return d.push(this._loader.loadMaterialBasePropertiesAsync(b,X,P)),d.push(this._loadSpecularGlossinessPropertiesAsync(Q,S,P)),this._loader.loadMaterialAlphaProperties(b,X,P),await Promise.all(d).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(b,X,P){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);const Q=new Array;return P.metallic=null,P.roughness=null,X.diffuseFactor?(P.albedoColor=d.yX.hX(X.diffuseFactor),P.alpha=X.diffuseFactor[3]):P.albedoColor=d.yX.White(),P.reflectivityColor=X.specularFactor?d.yX.hX(X.specularFactor):d.yX.White(),P.microSurface=void 0==X.glossinessFactor?1:X.glossinessFactor,X.diffuseTexture&&Q.push(this._loader.loadTextureInfoAsync(`${b}/diffuseTexture`,X.diffuseTexture,(b=>{b.name=`${P.name} (Diffuse)`,P.albedoTexture=b}))),X.specularGlossinessTexture&&(Q.push(this._loader.loadTextureInfoAsync(`${b}/specularGlossinessTexture`,X.specularGlossinessTexture,(b=>{b.name=`${P.name} (Specular Glossiness)`,P.reflectivityTexture=b,P.reflectivityTexture.Ad=!0}))),P.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(Q).then((()=>{}))}}k(ob),p(ob,!0,(b=>new Kb(b)));const Tb="KHR_materials_unlit";class qb{constructor(b){this.name=Tb,this.order=210,this._loader=b,this.enabled=this._loader.isExtensionUsed(Tb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async()=>await this._loadUnlitPropertiesAsync(b,X,P)))}_loadUnlitPropertiesAsync(b,X,P){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);const Q=new Array;P.unlit=!0;const S=X.pbrMetallicRoughness;return S&&(S.baseColorFactor?(P.albedoColor=d.yX.hX(S.baseColorFactor),P.alpha=S.baseColorFactor[3]):P.albedoColor=d.yX.White(),S.baseColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${b}/baseColorTexture`,S.baseColorTexture,(b=>{b.name=`${P.name} (Base Color)`,P.albedoTexture=b})))),X.doubleSided&&(P.Jd=!1,P.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(b,X,P),Promise.all(Q).then((()=>{}))}}k(Tb),p(Tb,!0,(b=>new qb(b)));const Vb="KHR_materials_clearcoat";class ib{constructor(b){this.name=Vb,this.order=190,this._loader=b,this.enabled=this._loader.isExtensionUsed(Vb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=new Array;d.push(this._loader.loadMaterialPropertiesAsync(b,X,P)),d.push(this._loadClearCoatPropertiesAsync(Q,S,P)),await Promise.all(d)}))}_loadClearCoatPropertiesAsync(b,X,P){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);const Q=new Array;return P.clearCoat.isEnabled=!0,P.clearCoat.useRoughnessFromMainTexture=!1,P.clearCoat.remapF0OnInterfaceChange=!1,void 0!=X.clearcoatFactor?P.clearCoat.ya=X.clearcoatFactor:P.clearCoat.ya=0,X.clearcoatTexture&&Q.push(this._loader.loadTextureInfoAsync(`${b}/clearcoatTexture`,X.clearcoatTexture,(b=>{b.name=`${P.name} (ClearCoat)`,P.clearCoat.texture=b}))),void 0!=X.clearcoatRoughnessFactor?P.clearCoat.roughness=X.clearcoatRoughnessFactor:P.clearCoat.roughness=0,X.clearcoatRoughnessTexture&&(X.clearcoatRoughnessTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${b}/clearcoatRoughnessTexture`,X.clearcoatRoughnessTexture,(b=>{b.name=`${P.name} (ClearCoat Roughness)`,P.clearCoat.textureRoughness=b})))),X.clearcoatNormalTexture&&(X.clearcoatNormalTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${b}/clearcoatNormalTexture`,X.clearcoatNormalTexture,(b=>{b.name=`${P.name} (ClearCoat Normal)`,P.clearCoat.bumpTexture=b}))),P.invertNormalMapX=!P.Ab().useRightHandedSystem,P.invertNormalMapY=P.Ab().useRightHandedSystem,void 0!=X.clearcoatNormalTexture.scale&&(P.clearCoat.bumpTexture.level=X.clearcoatNormalTexture.scale)),Promise.all(Q).then((()=>{}))}}k(Vb),p(Vb,!0,(b=>new ib(b)));const xb="KHR_materials_iridescence";class Hb{constructor(b){this.name=xb,this.order=195,this._loader=b,this.enabled=this._loader.isExtensionUsed(xb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(b,X,P)),d.push(this._loadIridescencePropertiesAsync(Q,S,P)),await Promise.all(d).then((()=>{}))}))}_loadIridescencePropertiesAsync(b,X,P){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);const Q=new Array;return P.iridescence.isEnabled=!0,P.iridescence.ya=X.iridescenceFactor??0,P.iridescence.indexOfRefraction=X.iridescenceIor??X.iridescenceIOR??1.3,P.iridescence.minimumThickness=X.iridescenceThicknessMinimum??100,P.iridescence.maximumThickness=X.iridescenceThicknessMaximum??400,X.iridescenceTexture&&Q.push(this._loader.loadTextureInfoAsync(`${b}/iridescenceTexture`,X.iridescenceTexture,(b=>{b.name=`${P.name} (Iridescence)`,P.iridescence.texture=b}))),X.iridescenceThicknessTexture&&Q.push(this._loader.loadTextureInfoAsync(`${b}/iridescenceThicknessTexture`,X.iridescenceThicknessTexture,(b=>{b.name=`${P.name} (Iridescence Thickness)`,P.iridescence.thicknessTexture=b}))),Promise.all(Q).then((()=>{}))}}k(xb),p(xb,!0,(b=>new Hb(b)));const Cb="KHR_materials_anisotropy";class pb{constructor(b){this.name=Cb,this.order=195,this._loader=b,this.enabled=this._loader.isExtensionUsed(Cb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=new Array;d.push(this._loader.loadMaterialPropertiesAsync(b,X,P)),d.push(this._loadIridescencePropertiesAsync(Q,S,P)),await Promise.all(d)}))}async _loadIridescencePropertiesAsync(b,X,P){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);const Q=new Array;P.anisotropy.isEnabled=!0,P.anisotropy.ya=X.anisotropyStrength??0,P.anisotropy.angle=X.anisotropyRotation??0,X.anisotropyTexture&&(X.anisotropyTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${b}/anisotropyTexture`,X.anisotropyTexture,(b=>{b.name=`${P.name} (Anisotropy Intensity)`,P.anisotropy.texture=b})))),await Promise.all(Q)}}k(Cb),p(Cb,!0,(b=>new pb(b)));const kb="KHR_materials_emissive_strength";class zb{constructor(b){this.name=kb,this.order=170,this._loader=b,this.enabled=this._loader.isExtensionUsed(kb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>await this._loader.loadMaterialPropertiesAsync(b,X,P).then((()=>{this._loadEmissiveProperties(Q,S,P)}))))}_loadEmissiveProperties(b,X,P){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);void 0!==X.emissiveStrength&&(P.emissiveIntensity=X.emissiveStrength)}}k(kb),p(kb,!0,(b=>new zb(b)));const Ub="KHR_materials_sheen";class gb{constructor(b){this.name=Ub,this.order=190,this._loader=b,this.enabled=this._loader.isExtensionUsed(Ub)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(b,X,P)),d.push(this._loadSheenPropertiesAsync(Q,S,P)),await Promise.all(d).then((()=>{}))}))}_loadSheenPropertiesAsync(b,X,P){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);const Q=new Array;return P.sheen.isEnabled=!0,P.sheen.ya=1,void 0!=X.sheenColorFactor?P.sheen.color=d.yX.hX(X.sheenColorFactor):P.sheen.color=d.yX.Black(),X.sheenColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${b}/sheenColorTexture`,X.sheenColorTexture,(b=>{b.name=`${P.name} (Sheen Color)`,P.sheen.texture=b}))),void 0!==X.sheenRoughnessFactor?P.sheen.roughness=X.sheenRoughnessFactor:P.sheen.roughness=0,X.sheenRoughnessTexture&&(X.sheenRoughnessTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${b}/sheenRoughnessTexture`,X.sheenRoughnessTexture,(b=>{b.name=`${P.name} (Sheen Roughness)`,P.sheen.textureRoughness=b})))),P.sheen.albedoScaling=!0,P.sheen.useRoughnessFromMainTexture=!1,Promise.all(Q).then((()=>{}))}}k(Ub),p(Ub,!0,(b=>new gb(b)));var jb=P(12348);const lb="KHR_materials_specular";class Jb{constructor(b){this.name=lb,this.order=190,this._loader=b,this.enabled=this._loader.isExtensionUsed(lb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=new Array;if(d.push(this._loader.loadMaterialPropertiesAsync(b,X,P)),d.push(this._loadSpecularPropertiesAsync(Q,S,P)),S.extensions&&S.extensions.EXT_materials_specular_edge_color&&P instanceof n.e){S.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(P.brdf.dielectricSpecularModel=jb.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,P.brdf.conductorSpecularModel=jb.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(d).then((()=>{}))}))}_loadSpecularPropertiesAsync(b,X,P){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);const Q=new Array;return void 0!==X.specularFactor&&(P.metallicF0Factor=X.specularFactor),void 0!==X.specularColorFactor&&(P.metallicReflectanceColor=d.yX.hX(X.specularColorFactor)),X.specularTexture&&(X.specularTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${b}/specularTexture`,X.specularTexture,(b=>{b.name=`${P.name} (Specular)`,P.metallicReflectanceTexture=b,P.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),X.specularColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${b}/specularColorTexture`,X.specularColorTexture,(b=>{b.name=`${P.name} (Specular Color)`,P.reflectanceTexture=b}))),Promise.all(Q).then((()=>{}))}}k(lb),p(lb,!0,(b=>new Jb(b)));const cb="KHR_materials_ior";class sb{constructor(b){this.name=cb,this.order=180,this._loader=b,this.enabled=this._loader.isExtensionUsed(cb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(b,X,P)),d.push(this._loadIorPropertiesAsync(Q,S,P)),await Promise.all(d).then((()=>{}))}))}_loadIorPropertiesAsync(b,X,P){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);return void 0!==X.ior?P.indexOfRefraction=X.ior:P.indexOfRefraction=sb._DEFAULT_IOR,Promise.resolve()}}sb._DEFAULT_IOR=1.5,k(cb),p(cb,!0,(b=>new sb(b)));const Fb="KHR_materials_variants";class Mb{constructor(b){this.name=Fb,this._loader=b,this.enabled=this._loader.isExtensionUsed(Fb)}dispose(){this._loader=null}static GetAvailableVariants(b){const X=this._GetExtensionMetadata(b);return X?Object.keys(X.variants):[]}getAvailableVariants(b){return Mb.GetAvailableVariants(b)}static SelectVariant(b,X){const P=this._GetExtensionMetadata(b);if(!P)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Fb} extension`);const Q=b=>{const X=P.variants[b];if(X)for(const P of X)P.mesh.material=P.material};if(X instanceof Array)for(const S of X)Q(S);else Q(X);P.lastSelected=X}selectVariant(b,X){Mb.SelectVariant(b,X)}static Reset(b){const X=this._GetExtensionMetadata(b);if(!X)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Fb} extension`);for(const P of X.original)P.mesh.material=P.material;X.lastSelected=null}reset(b){Mb.Reset(b)}static GetLastSelectedVariant(b){const X=this._GetExtensionMetadata(b);if(!X)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Fb} extension`);return X.lastSelected}getLastSelectedVariant(b){return Mb.GetLastSelectedVariant(b)}static _GetExtensionMetadata(b){var X,P;return(null===b||void 0===b||null===(X=b._internalMetadata)||void 0===X||null===(P=X.ed)||void 0===P?void 0:P[Fb])||null}onLoading(){const b=this._loader.ed.extensions;if(b&&b[this.name]){const X=b[this.name];this._variants=X.variants}}onReady(){const b=this._loader.rootBabylonMesh;if(b){var X;const P=this._loader.parent.extensionOptions[Fb];null!==P&&void 0!==P&&P.defaultVariant&&Mb.SelectVariant(b,P.defaultVariant),null===P||void 0===P||null===(X=P.onLoaded)||void 0===X||X.call(P,{get variants(){return Mb.GetAvailableVariants(b)},get selectedVariant(){const X=Mb.GetLastSelectedVariant(b);return X?Array.isArray(X)?X[0]:X:Mb.GetAvailableVariants(b)[0]},set selectedVariant(X){Mb.SelectVariant(b,X)}})}}_loadMeshPrimitiveAsync(b,X,P,Q,S,d){return J.LoadExtensionAsync(b,S,this.name,(async(N,a)=>{const u=new Array;return u.push(this._loader._loadMeshPrimitiveAsync(b,X,P,Q,S,(X=>{if(d(X),X instanceof A.b){const P=J._GetDrawMode(b,S.mode),Q=this._loader.rootBabylonMesh,d=Q?Q._internalMetadata=Q._internalMetadata||{}:{},w=d.ed=d.ed||{},f=w[Fb]=w[Fb]||{lastSelected:null,original:[],variants:{}};f.original.push({mesh:X,material:X.material});for(let b=0;b<a.mappings.length;++b){const S=a.mappings[b],d=j.Get(`${N}/mappings/${b}/material`,this._loader.ed.materials,S.material);u.push(this._loader._loadMaterialAsync(`#/materials/${S.material}`,d,X,P,(b=>{for(let P=0;P<S.variants.length;++P){const d=S.variants[P],N=j.Get(`/extensions/${Fb}/variants/${d}`,this._variants,d);f.variants[N.name]=f.variants[N.name]||[],f.variants[N.name].push({mesh:X,material:b}),X.onClonedObservable.add((b=>{const P=b;let S=null,d=P;do{if(d=d.parent,!d)return;S=Mb._GetExtensionMetadata(d)}while(null===S);if(Q&&S===Mb._GetExtensionMetadata(Q)){d._internalMetadata={};for(const b in Q._internalMetadata)d._internalMetadata[b]=Q._internalMetadata[b];d._internalMetadata.ed=[];for(const b in Q._internalMetadata.ed)d._internalMetadata.ed[b]=Q._internalMetadata.ed[b];d._internalMetadata.ed[Fb]={lastSelected:null,original:[],variants:{}};for(const b of S.original)d._internalMetadata.ed[Fb].original.push({mesh:b.mesh,material:b.material});for(const b in S.variants)if(Object.prototype.hasOwnProperty.call(S.variants,b)){d._internalMetadata.ed[Fb].variants[b]=[];for(const X of S.variants[b])d._internalMetadata.ed[Fb].variants[b].push({mesh:X.mesh,material:X.material})}S=d._internalMetadata.ed[Fb]}for(const Q of S.original)Q.mesh===X&&(Q.mesh=P);for(const Q of S.variants[N.name])Q.mesh===X&&(Q.mesh=P)}))}})))}}}))),await Promise.all(u).then((b=>{let[X]=b;return X}))}))}}k(Fb),p(Fb,!0,(b=>new Mb(b)));var Rb=P(11902);class rb{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:jb.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(b,X){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...rb._GetDefaultOptions(),...b},this._scene=X,this._scene._transmissionHelper=this,this.onErrorObservable=new f.d,this._scene.Nd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(b){if(!Object.keys(b).filter((X=>this._options[X]!==b[X])).length)return;const X={...this._options,...b},P=this._options;this._options=X,X.renderSize===P.renderSize&&X.renderTargetTextureType===P.renderTargetTextureType&&X.generateMipmaps===P.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=X.samples,this._opaqueRenderTarget.lodGenerationScale=X.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=X.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(b){return!!b&&!!(b instanceof n.e&&b.subSurface.isRefractionEnabled)}_addMesh(b){this._materialObservers[b.uniqueId]=b.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),N.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(b.material)?(b.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(b)&&this._transparentMeshesCache.push(b)):-1===this._opaqueMeshesCache.indexOf(b)&&this._opaqueMeshesCache.push(b)}))}_removeMesh(b){b.onMaterialChangedObservable.remove(this._materialObservers[b.uniqueId]),delete this._materialObservers[b.uniqueId];let X=this._transparentMeshesCache.indexOf(b);-1!==X&&this._transparentMeshesCache.splice(X,1),X=this._opaqueMeshesCache.indexOf(b),-1!==X&&this._opaqueMeshesCache.splice(X,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(b){const X=this._transparentMeshesCache.indexOf(b),P=this._opaqueMeshesCache.indexOf(b);this._shouldRenderAsTransmission(b.material)?(b.material instanceof n.e&&(b.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==P?(this._opaqueMeshesCache.splice(P,1),this._transparentMeshesCache.push(b)):-1===X&&this._transparentMeshesCache.push(b)):-1!==X?(this._transparentMeshesCache.splice(X,1),this._opaqueMeshesCache.push(b)):-1===P&&this._opaqueMeshesCache.push(b)}_isRenderTargetValid(){var b;return null!==(null===(b=this._opaqueRenderTarget)||void 0===b?void 0:b.getInternalTexture())}_setupRenderTargets(){var b;let X;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Rb.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(b=this._options.clearColor)||void 0===b?void 0:b.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((b=>{X=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?b.clearColor.N(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(b.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=X}));for(const P of this._transparentMeshesCache)this._shouldRenderAsTransmission(P.material)&&(P.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Ib="KHR_materials_transmission";class Gb{constructor(b){this.name=Ib,this.order=175,this._loader=b,this.enabled=this._loader.isExtensionUsed(Ib),this.enabled&&(b.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(b,X,P)),d.push(this._loadTransparentPropertiesAsync(Q,X,P,S)),await Promise.all(d).then((()=>{}))}))}_loadTransparentPropertiesAsync(b,X,P,Q){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);const S=P;if(S.subSurface.isRefractionEnabled=!0,S.subSurface.volumeIndexOfRefraction=1,S.subSurface.useAlbedoToTintRefraction=!0,void 0===Q.transmissionFactor)return S.subSurface.refractionIntensity=0,S.subSurface.isRefractionEnabled=!1,Promise.resolve();{var d;S.subSurface.refractionIntensity=Q.transmissionFactor;const b=S.Ab();if(S.subSurface.refractionIntensity&&!b._transmissionHelper)new rb({},S.Ab());else if(S.subSurface.refractionIntensity&&(null===(d=b._transmissionHelper)||void 0===d||!d._isRenderTargetValid())){var N;null===(N=b._transmissionHelper)||void 0===N||N._setupRenderTargets()}}return S.subSurface.minimumThickness=0,S.subSurface.maximumThickness=0,Q.transmissionTexture?(Q.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${b}/transmissionTexture`,Q.transmissionTexture,void 0).then((b=>{b.name=`${P.name} (Transmission)`,S.subSurface.refractionIntensityTexture=b,S.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}k(Ib),p(Ib,!0,(b=>new Gb(b)));const mX="KHR_materials_diffuse_transmission";class bX{constructor(b){this.name=mX,this.order=174,this._loader=b,this.enabled=this._loader.isExtensionUsed(mX),this.enabled&&(b.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(b,X,P)),d.push(this._loadTranslucentPropertiesAsync(Q,X,P,S)),await Promise.all(d).then((()=>{}))}))}_loadTranslucentPropertiesAsync(b,X,P,Q){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);const S=P;if(S.subSurface.isTranslucencyEnabled=!0,S.subSurface.volumeIndexOfRefraction=1,S.subSurface.minimumThickness=0,S.subSurface.maximumThickness=0,S.subSurface.useAlbedoToTintTranslucency=!1,void 0===Q.diffuseTransmissionFactor)return S.subSurface.translucencyIntensity=0,S.subSurface.isTranslucencyEnabled=!1,Promise.resolve();S.subSurface.translucencyIntensity=Q.diffuseTransmissionFactor;const N=new Array;return S.subSurface.useGltfStyleTextures=!0,Q.diffuseTransmissionTexture&&(Q.diffuseTransmissionTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${b}/diffuseTransmissionTexture`,Q.diffuseTransmissionTexture).then((b=>{b.name=`${P.name} (Diffuse Transmission)`,S.subSurface.translucencyIntensityTexture=b})))),void 0!==Q.diffuseTransmissionColorFactor?S.subSurface.translucencyColor=d.yX.hX(Q.diffuseTransmissionColorFactor):S.subSurface.translucencyColor=d.yX.White(),Q.diffuseTransmissionColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${b}/diffuseTransmissionColorTexture`,Q.diffuseTransmissionColorTexture).then((b=>{b.name=`${P.name} (Diffuse Transmission Color)`,S.subSurface.translucencyColorTexture=b}))),Promise.all(N).then((()=>{}))}}k(mX),p(mX,!0,(b=>new bX(b)));const XX="KHR_materials_volume";class PX{constructor(b){this.name=XX,this.order=173,this._loader=b,this.enabled=this._loader.isExtensionUsed(XX),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(b,X,P)),d.push(this._loadVolumePropertiesAsync(Q,X,P,S)),await Promise.all(d).then((()=>{}))}))}_loadVolumePropertiesAsync(b,X,P,Q){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);if(!P.subSurface.isRefractionEnabled&&!P.subSurface.isTranslucencyEnabled||!Q.thicknessFactor)return Promise.resolve();P.subSurface.volumeIndexOfRefraction=P.indexOfRefraction;const S=void 0!==Q.attenuationDistance?Q.attenuationDistance:Number.MAX_VALUE;return P.subSurface.tintColorAtDistance=S,void 0!==Q.attenuationColor&&3==Q.attenuationColor.length&&P.subSurface.tintColor.sd(Q.attenuationColor[0],Q.attenuationColor[1],Q.attenuationColor[2]),P.subSurface.minimumThickness=0,P.subSurface.maximumThickness=Q.thicknessFactor,P.subSurface.useThicknessAsDepth=!0,Q.thicknessTexture?(Q.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${b}/thicknessTexture`,Q.thicknessTexture).then((b=>{b.name=`${P.name} (Thickness)`,P.subSurface.thicknessTexture=b,P.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}k(XX),p(XX,!0,(b=>new PX(b)));const QX="KHR_materials_dispersion";class SX{constructor(b){this.name=QX,this.order=174,this._loader=b,this.enabled=this._loader.isExtensionUsed(QX)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(b,X,P)),d.push(this._loadDispersionPropertiesAsync(Q,X,P,S)),await Promise.all(d).then((()=>{}))}))}_loadDispersionPropertiesAsync(b,X,P,Q){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);return P.subSurface.isRefractionEnabled&&Q.dispersion?(P.subSurface.isDispersionEnabled=!0,P.subSurface.dispersion=Q.dispersion,Promise.resolve()):Promise.resolve()}}k(QX),p(QX,!0,(b=>new SX(b)));const dX="EXT_materials_diffuse_roughness";class NX{constructor(b){this.name=dX,this.order=190,this._loader=b,this.enabled=this._loader.isExtensionUsed(dX)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(b,X,P)),d.push(this._loadDiffuseRoughnessPropertiesAsync(Q,S,P)),await Promise.all(d).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(b,X,P){if(!(P instanceof n.e))throw new Error(`${b}: Material type not supported`);const Q=new Array;return P.brdf.baseDiffuseModel=jb.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=X.diffuseRoughnessFactor?P.baseDiffuseRoughness=X.diffuseRoughnessFactor:P.baseDiffuseRoughness=0,X.diffuseRoughnessTexture&&Q.push(this._loader.loadTextureInfoAsync(`${b}/diffuseRoughnessTexture`,X.diffuseRoughnessTexture,(b=>{b.name=`${P.name} (Diffuse Roughness)`,P.baseDiffuseRoughnessTexture=b}))),Promise.all(Q).then((()=>{}))}}k(dX),p(dX,!0,(b=>new NX(b)));const aX="KHR_mesh_quantization";class uX{constructor(b){this.name=aX,this.enabled=b.isExtensionUsed(aX)}dispose(){}}k(aX),p(aX,!0,(b=>new uX(b)));const wX="KHR_texture_basisu";class fX{constructor(b){this.name=wX,this._loader=b,this.enabled=b.isExtensionUsed(wX)}dispose(){this._loader=null}_loadTextureAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>{const d=void 0==X.sampler?J.DefaultSampler:j.Get(`${b}/sampler`,this._loader.ed.samplers,X.sampler),N=j.Get(`${Q}/source`,this._loader.ed.images,S.source);return await this._loader._createTextureAsync(b,d,N,(b=>{P(b)}),X._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!X._textureInfo.nonColorData)}))}}k(wX),p(wX,!0,(b=>new fX(b)));const OX="KHR_texture_transform";class eX{constructor(b){this.name=OX,this._loader=b,this.enabled=this._loader.isExtensionUsed(OX)}dispose(){this._loader=null}loadTextureInfoAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(Q,S)=>await this._loader.loadTextureInfoAsync(b,X,(b=>{if(!(b instanceof y.d))throw new Error(`${Q}: Texture type not supported`);S.offset&&(b.uOffset=S.offset[0],b.vOffset=S.offset[1]),b.uRotationCenter=0,b.vRotationCenter=0,S.rotation&&(b.wAng=-S.rotation),S.scale&&(b.uScale=S.scale[0],b.vScale=S.scale[1]),void 0!=S.texCoord&&(b.coordinatesIndex=S.texCoord),P(b)}))))}}k(OX),p(OX,!0,(b=>new eX(b)));const YX="KHR_xmp_json_ld";class DX{constructor(b){this.name=YX,this.order=100,this._loader=b,this.enabled=this._loader.isExtensionUsed(YX)}dispose(){this._loader=null}onLoading(){var b,X,P;if(null===this._loader.rootBabylonMesh)return;const Q=null===(b=this._loader.ed.extensions)||void 0===b?void 0:b.KHR_xmp_json_ld,S=null===(X=this._loader.ed.asset)||void 0===X||null===(P=X.extensions)||void 0===P?void 0:P.KHR_xmp_json_ld;if(Q&&S){const b=+S.packet;Q.packets&&b<Q.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=Q.packets[b])}}}function EX(b,X,P,Q){return d.yX.hX(X,P).scale(Q)}function tX(b,X,P,Q){return X[P]*Q}function BX(b,X,P,Q){return-X[P]*Q}function WX(b,X,P,Q){return X[P+1]*Q}function nX(b,X,P,Q){return X[P]*Q*2}function yX(b){return{scale:[new LX(e.c.ANIMATIONTYPE_FLOAT,`${b}.uScale`,tX,(()=>2)),new LX(e.c.ANIMATIONTYPE_FLOAT,`${b}.vScale`,WX,(()=>2))],offset:[new LX(e.c.ANIMATIONTYPE_FLOAT,`${b}.uOffset`,tX,(()=>2)),new LX(e.c.ANIMATIONTYPE_FLOAT,`${b}.vOffset`,WX,(()=>2))],rotation:[new LX(e.c.ANIMATIONTYPE_FLOAT,`${b}.wAng`,BX,(()=>1))]}}k(YX),p(YX,!0,(b=>new DX(b)));class hX extends c.AnimationPropertyInfo{buildAnimations(b,X,P,Q){return[{babylonAnimatable:b._babylonCamera,babylonAnimation:this._buildAnimation(X,P,Q)}]}}class LX extends c.AnimationPropertyInfo{buildAnimations(b,X,P,Q){const S=[];for(const d in b._data)S.push({babylonAnimatable:b._data[d].babylonMaterial,babylonAnimation:this._buildAnimation(X,P,Q)});return S}}class ZX extends c.AnimationPropertyInfo{buildAnimations(b,X,P,Q){return[{babylonAnimatable:b._babylonLight,babylonAnimation:this._buildAnimation(X,P,Q)}]}}(0,z.j)("/cameras/{}/orthographic/xmag",[new hX(e.c.ANIMATIONTYPE_FLOAT,"orthoLeft",BX,(()=>1)),new hX(e.c.ANIMATIONTYPE_FLOAT,"orthoRight",WX,(()=>1))]),(0,z.j)("/cameras/{}/orthographic/ymag",[new hX(e.c.ANIMATIONTYPE_FLOAT,"orthoBottom",BX,(()=>1)),new hX(e.c.ANIMATIONTYPE_FLOAT,"orthoTop",WX,(()=>1))]),(0,z.j)("/cameras/{}/orthographic/zfar",[new hX(e.c.ANIMATIONTYPE_FLOAT,"maxZ",tX,(()=>1))]),(0,z.j)("/cameras/{}/orthographic/znear",[new hX(e.c.ANIMATIONTYPE_FLOAT,"Vd",tX,(()=>1))]),(0,z.j)("/cameras/{}/perspective/yfov",[new hX(e.c.ANIMATIONTYPE_FLOAT,"fov",tX,(()=>1))]),(0,z.j)("/cameras/{}/perspective/zfar",[new hX(e.c.ANIMATIONTYPE_FLOAT,"maxZ",tX,(()=>1))]),(0,z.j)("/cameras/{}/perspective/znear",[new hX(e.c.ANIMATIONTYPE_FLOAT,"Vd",tX,(()=>1))]),(0,z.j)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new LX(e.c.ANIMATIONTYPE_COLOR3,"albedoColor",EX,(()=>4)),new LX(e.c.ANIMATIONTYPE_FLOAT,"alpha",(function(b,X,P,Q){return X[P+3]*Q}),(()=>4))]),(0,z.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new LX(e.c.ANIMATIONTYPE_FLOAT,"metallic",tX,(()=>1))]),(0,z.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new LX(e.c.ANIMATIONTYPE_FLOAT,"roughness",tX,(()=>1))]);const vX=yX("albedoTexture");(0,z.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",vX.scale),(0,z.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",vX.offset),(0,z.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",vX.rotation);const AX=yX("metallicTexture");(0,z.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",AX.scale),(0,z.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",AX.offset),(0,z.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",AX.rotation),(0,z.j)("/materials/{}/emissiveFactor",[new LX(e.c.ANIMATIONTYPE_COLOR3,"emissiveColor",EX,(()=>3))]);const oX=yX("bumpTexture");(0,z.j)("/materials/{}/normalTexture/scale",[new LX(e.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",tX,(()=>1))]),(0,z.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",oX.scale),(0,z.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",oX.offset),(0,z.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",oX.rotation),(0,z.j)("/materials/{}/occlusionTexture/strength",[new LX(e.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",tX,(()=>1))]);const KX=yX("ambientTexture");(0,z.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",KX.scale),(0,z.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",KX.offset),(0,z.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",KX.rotation);const TX=yX("emissiveTexture");(0,z.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",TX.scale),(0,z.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",TX.offset),(0,z.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",TX.rotation),(0,z.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new LX(e.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",tX,(()=>1))]),(0,z.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new LX(e.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",tX,(()=>1))]);const qX=yX("anisotropy.texture");(0,z.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",qX.scale),(0,z.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",qX.offset),(0,z.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",qX.rotation),(0,z.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new LX(e.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",tX,(()=>1))]),(0,z.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new LX(e.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",tX,(()=>1))]);const VX=yX("clearCoat.texture");(0,z.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",VX.scale),(0,z.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",VX.offset),(0,z.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",VX.rotation);const iX=yX("clearCoat.bumpTexture");(0,z.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new LX(e.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",tX,(()=>1))]),(0,z.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",iX.scale),(0,z.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",iX.offset),(0,z.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",iX.rotation);const xX=yX("clearCoat.textureRoughness");(0,z.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",xX.scale),(0,z.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",xX.offset),(0,z.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",xX.rotation),(0,z.j)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new LX(e.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",tX,(()=>1))]),(0,z.j)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new LX(e.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",tX,(()=>1))]),(0,z.j)("/materials/{}/extensions/KHR_materials_ior/ior",[new LX(e.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",tX,(()=>1))]),(0,z.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new LX(e.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",tX,(()=>1))]),(0,z.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new LX(e.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",tX,(()=>1))]),(0,z.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new LX(e.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",tX,(()=>1))]),(0,z.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new LX(e.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",tX,(()=>1))]);const HX=yX("iridescence.texture");(0,z.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",HX.scale),(0,z.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",HX.offset),(0,z.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",HX.rotation);const CX=yX("iridescence.thicknessTexture");(0,z.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",CX.scale),(0,z.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",CX.offset),(0,z.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",CX.rotation),(0,z.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new LX(e.c.ANIMATIONTYPE_COLOR3,"sheen.color",EX,(()=>3))]),(0,z.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new LX(e.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",tX,(()=>1))]);const pX=yX("sheen.texture");(0,z.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",pX.scale),(0,z.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",pX.offset),(0,z.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",pX.rotation);const kX=yX("sheen.textureRoughness");(0,z.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",kX.scale),(0,z.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",kX.offset),(0,z.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",kX.rotation),(0,z.j)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new LX(e.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",tX,(()=>1))]),(0,z.j)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new LX(e.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",EX,(()=>3))]);const zX=yX("metallicReflectanceTexture");(0,z.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",zX.scale),(0,z.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",zX.offset),(0,z.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",zX.rotation);const UX=yX("reflectanceTexture");(0,z.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",UX.scale),(0,z.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",UX.offset),(0,z.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",UX.rotation),(0,z.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new LX(e.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",tX,(()=>1))]);const gX=yX("subSurface.refractionIntensityTexture");(0,z.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",gX.scale),(0,z.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",gX.offset),(0,z.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",gX.rotation),(0,z.j)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new LX(e.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",EX,(()=>3))]),(0,z.j)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new LX(e.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",tX,(()=>1))]),(0,z.j)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new LX(e.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",tX,(()=>1))]);const jX=yX("subSurface.thicknessTexture");(0,z.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",jX.scale),(0,z.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",jX.offset),(0,z.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",jX.rotation),(0,z.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new LX(e.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",tX,(()=>1))]);const lX=yX("subSurface.translucencyIntensityTexture");(0,z.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",lX.scale),(0,z.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",lX.offset),(0,z.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",lX.rotation),(0,z.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new LX(e.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",EX,(()=>3))]);const JX=yX("subSurface.translucencyColorTexture");(0,z.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",JX.scale),(0,z.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",JX.offset),(0,z.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",JX.rotation),(0,z.j)("/extensions/KHR_lights_punctual/lights/{}/color",[new ZX(e.c.ANIMATIONTYPE_COLOR3,"diffuse",EX,(()=>3))]),(0,z.j)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new ZX(e.c.ANIMATIONTYPE_FLOAT,"intensity",tX,(()=>1))]),(0,z.j)("/extensions/KHR_lights_punctual/lights/{}/range",[new ZX(e.c.ANIMATIONTYPE_FLOAT,"range",tX,(()=>1))]),(0,z.j)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new ZX(e.c.ANIMATIONTYPE_FLOAT,"innerAngle",nX,(()=>1))]),(0,z.j)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new ZX(e.c.ANIMATIONTYPE_FLOAT,"angle",nX,(()=>1))]),(0,z.j)("/nodes/{}/extensions/EXT_lights_ies/color",[new ZX(e.c.ANIMATIONTYPE_COLOR3,"diffuse",EX,(()=>3))]),(0,z.j)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new ZX(e.c.ANIMATIONTYPE_FLOAT,"intensity",tX,(()=>1))]);const cX="KHR_animation_pointer";class sX{constructor(b){this.name=cX,this._loader=b,this._pathToObjectConverter=(0,z.i)(this._loader.ed)}get enabled(){return this._loader.isExtensionUsed(cX)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(b,X,P,Q,S){var d;const N=null===(d=Q.target.extensions)||void 0===d?void 0:d.KHR_animation_pointer;if(!N||!this._pathToObjectConverter)return null;"pointer"!==Q.target.path&&E.b.Warn(`${b}/target/path: Value (${Q.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=Q.target.node&&E.b.Warn(`${b}/target/node: Value (${Q.target.node}) must not be present when using the ${this.name} extension`);const a=`${b}/extensions/${this.name}`,u=N.pointer;if(!u)throw new Error(`${a}: Pointer is missing`);try{const d=this._pathToObjectConverter.convert(u);if(!d.info.interpolation)throw new Error(`${a}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(b,X,P,Q,{object:d.object,info:d.info.interpolation},S)}catch(w){return E.b.Warn(`${a}/pointer: Invalid pointer (${u}) skipped`),null}}}k(cX),p(cX,!0,(b=>new sX(b)));class FX{constructor(b,X,P){this.frame=b,this.action=X,this.onlyOnce=P,this.isDone=!1}_clone(){return new FX(this.frame,this.action,this.onlyOnce)}}var MX=P(11719),RX=P(11760),rX=P(11755);class IX{get loop(){return this._loop}set loop(b){b!==this._loop&&(this._loop=b,this.updateOptions({loop:b}))}get currentTime(){var b;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(b=RX.c.audioEngine)&&void 0!==b&&b.audioContext&&(this.isPlaying||this.isPaused)){const b=this.isPaused?0:RX.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+b}return 0}get spatialSound(){return this._spatialSound}set spatialSound(b){if(b==this._spatialSound)return;const X=this.isPlaying;this.pause(),b?(this._spatialSound=b,this._updateSpatialParameters()):this._disableSpatialSound(),X&&this.play()}constructor(b,X,P){var Q;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new f.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=S.tX.Zero(),this._localDirection=new S.tX(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=b,P=P||D.e.LastCreatedScene)if(this._scene=P,IX._SceneComponentInitialization(P),this._readyToPlayCallback=d,this._customAttenuationFunction=(b,X,P,Q,S)=>X<P?b*(1-X/P):0,a&&(this.autoplay=a.autoplay||!1,this._loop=a.loop||!1,void 0!==a.volume&&(this._volume=a.volume),this._spatialSound=a.spatialSound??!1,this.maxDistance=a.maxDistance??100,this.useCustomAttenuation=a.useCustomAttenuation??!1,this.rolloffFactor=a.rolloffFactor||1,this.refDistance=a.refDistance||1,this.distanceModel=a.distanceModel||"linear",this._playbackRate=a.playbackRate||1,this._streaming=a.streaming??!1,this._length=a.length,this._offset=a.offset),null!==(Q=RX.c.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&RX.c.audioEngine.audioContext){this._soundGain=RX.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let b=!0;if(X)try{"string"===typeof X?(this._urlType="String",this._url=X):X instanceof ArrayBuffer?this._urlType="ArrayBuffer":X instanceof HTMLMediaElement?this._urlType="MediaElement":X instanceof MediaStream?this._urlType="MediaStream":X instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(X)&&(this._urlType="Array");let P=[],Q=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=RX.c.audioEngine.audioContext.createMediaElementSource(X),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=RX.c.audioEngine.audioContext.createMediaStreamSource(X),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":X.byteLength>0&&(Q=!0,this._soundLoaded(X));break;case"AudioBuffer":this._audioBufferLoaded(X);break;case"String":P.push(X);case"Array":0===P.length&&(P=X);for(let b=0;b<P.length;b++){const X=P[b];if(Q=a&&a.skipCodecCheck||-1!==X.indexOf(".mp3",X.length-4)&&RX.c.audioEngine.isMP3supported||-1!==X.indexOf(".ogg",X.length-4)&&RX.c.audioEngine.isOGGsupported||-1!==X.indexOf(".wav",X.length-4)||-1!==X.indexOf(".m4a",X.length-4)||-1!==X.indexOf(".mp4",X.length-4)||-1!==X.indexOf("blob:"),Q){this._streaming?(this._htmlAudioElement=new Audio(X),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,N.Tools.SetCorsBehavior(X,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(X,(b=>{this._soundLoaded(b)}),void 0,!0,!0,(b=>{b&&E.b.Error("XHR "+b.status+" error on: "+X+"."),E.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:b=!1}b?Q||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):E.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(u){E.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),RX.c.audioEngine&&!RX.c.audioEngine.WarnedWebAudioUnsupported&&(E.b.Error("Web Audio is not supported by your browser."),RX.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var b;null!==(b=RX.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(b){var X;null!==(X=RX.c.audioEngine)&&void 0!==X&&X.audioContext&&(this._audioBuffer=b,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(b){var X;null!==(X=RX.c.audioEngine)&&void 0!==X&&X.audioContext&&RX.c.audioEngine.audioContext.decodeAudioData(b,(b=>{this._audioBufferLoaded(b)}),(b=>{E.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+b)}))}setAudioBuffer(b){var X;null!==(X=RX.c.audioEngine)&&void 0!==X&&X.canUseWebAudio&&(this._audioBuffer=b,this._isReadyToPlay=!0)}updateOptions(b){b&&(this.loop=b.loop??this.loop,this.maxDistance=b.maxDistance??this.maxDistance,this.useCustomAttenuation=b.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=b.rolloffFactor??this.rolloffFactor,this.refDistance=b.refDistance??this.refDistance,this.distanceModel=b.distanceModel??this.distanceModel,this._playbackRate=b.playbackRate??this._playbackRate,this._length=b.length??void 0,this.spatialSound=b.spatialSound??this._spatialSound,this._setOffset(b.offset??void 0),this.setVolume(b.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var b;null!==(b=RX.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&RX.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??RX.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var b;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(b=this._soundPanner)||void 0===b||b.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var b;null!==(b=RX.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(b){var X;null!==(X=RX.c.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(b),this._isOutputConnected=!0)}setDirectionalCone(b,X,P){X<b?E.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=b,this._coneOuterAngle=X,this._coneOuterGain=P,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(b){if(b!=this._coneInnerAngle){var X;if(this._coneOuterAngle<b)return void E.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=b,null!==(X=RX.c.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(b){if(b!=this._coneOuterAngle){var X;if(b<this._coneInnerAngle)return void E.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=b,null!==(X=RX.c.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(b){var X;b.equals(this._position)||(this._position.N(b),null!==(X=RX.c.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(b){var X;this._localDirection=b,null!==(X=RX.c.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const b=this._connectedTransformNode.getWorldMatrix(),X=S.tX.TransformNormal(this._localDirection,b);X.normalize(),this._soundPanner.orientationX.value=X.x,this._soundPanner.orientationY.value=X.y,this._soundPanner.orientationZ.value=X.z}updateDistanceFromListener(){var b;if(null!==(b=RX.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const b=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.BX(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,b,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(b){this._customAttenuationFunction=b}play(b,X,P){var Q;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(Q=RX.c.audioEngine)&&void 0!==Q&&Q.audioContext)try{var S,d;this._clearTimeoutsAndObservers();let Q=b?(null===(S=RX.c.audioEngine)||void 0===S?void 0:S.audioContext.currentTime)+b:null===(d=RX.c.audioEngine)||void 0===d?void 0:d.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=RX.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const b=()=>{var P;if(null!==(P=RX.c.audioEngine)&&void 0!==P&&P.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=X??0;const P=this._htmlAudioElement.play();void 0!==P&&P.catch((()=>{var X,P;(null===(X=RX.c.audioEngine)||void 0===X||X.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(P=RX.c.audioEngine)||void 0===P?void 0:P.onAudioUnlockedObservable.addOnce((()=>{b()})))}))}else{var Q;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(Q=RX.c.audioEngine)||void 0===Q?void 0:Q.onAudioUnlockedObservable.addOnce((()=>{b()}))}};b()}}else{var N;const S=()=>{var S;if(null!==(S=RX.c.audioEngine)&&void 0!==S&&S.audioContext){var d;if(P=P||this._length,void 0!==X&&this._setOffset(X),this._soundSource){const b=this._soundSource;b.onended=()=>{b.disconnect()}}if(this._soundSource=null===(d=RX.c.audioEngine)||void 0===d?void 0:d.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var N;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==X&&(this._soundSource.loopStart=X),void 0!==P&&(this._soundSource.loopEnd=(0|X)+P),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},Q=b?(null===(N=RX.c.audioEngine)||void 0===N?void 0:N.audioContext.currentTime)+b:RX.c.audioEngine.audioContext.currentTime;const S=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(Q,S,this.loop?void 0:P)}}};"suspended"===(null===(N=RX.c.audioEngine)||void 0===N?void 0:N.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var b;"suspended"===(null===(b=RX.c.audioEngine)||void 0===b?void 0:b.audioContext.state)?(RX.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=RX.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{S()})))):S()}),500):S()}this._startTime=Q,this.isPlaying=!0,this.isPaused=!1}catch(a){E.b.Error("Error while trying to play audio: "+this.name+", "+a.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(b){var X;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var P;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(P=this._streamingSource)||void 0===P||P.disconnect();this.isPlaying=!1}else if(null!==(X=RX.c.audioEngine)&&void 0!==X&&X.audioContext&&this._soundSource){const X=b?RX.c.audioEngine.audioContext.currentTime+b:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(X)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var b;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var X;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(X=this._streamingSource)||void 0===X||X.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(b=RX.c.audioEngine)&&void 0!==b&&b.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=RX.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(b,X){var P;null!==(P=RX.c.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._soundGain&&(X&&RX.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(RX.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,RX.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(b,RX.c.audioEngine.audioContext.currentTime+X)):this._soundGain.gain.value=b),this._volume=b}setPlaybackRate(b){this._playbackRate=b,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(b){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=b,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=b=>this._onRegisterAfterWorldMatrixUpdate(b),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(b){var X;if(b.getBoundingInfo){const X=b.getBoundingInfo();this.setPosition(X.boundingSphere.centerWorld)}else this.setPosition(b.absolutePosition);null!==(X=RX.c.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const b=()=>{(0,rX.c)((()=>this._isReadyToPlay),(()=>{P._audioBuffer=this.getAudioBuffer(),P._isReadyToPlay=!0,P.autoplay&&P.play(0,this._offset,this._length)}),void 0,300)},X={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},P=new IX(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,X);return this.useCustomAttenuation&&P.setAttenuationFunction(this._customAttenuationFunction),P.setPosition(this._position),P.setPlaybackRate(this._playbackRate),b(),P}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const b={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(b.connectedMeshId=this._connectedTransformNode.id),b.position=this._position.Zd(),b.refDistance=this.refDistance,b.distanceModel=this.distanceModel,b.isDirectional=this._isDirectional,b.localDirectionToMesh=this._localDirection.Zd(),b.coneInnerAngle=this._coneInnerAngle,b.coneOuterAngle=this._coneOuterAngle,b.coneOuterGain=this._coneOuterGain),b}static Parse(b,X,P,Q){const d=b.name;let N;N=b.url?P+b.url:P+d;const a={autoplay:b.autoplay,loop:b.loop,volume:b.volume,spatialSound:b.spatialSound,maxDistance:b.maxDistance,rolloffFactor:b.rolloffFactor,refDistance:b.refDistance,distanceModel:b.distanceModel,playbackRate:b.playbackRate};let u;if(Q){const b=()=>{(0,rX.c)((()=>Q._isReadyToPlay),(()=>{u._audioBuffer=Q.getAudioBuffer(),u._isReadyToPlay=!0,u.autoplay&&u.play(0,u._offset,u._length)}),void 0,300)};u=new IX(d,new ArrayBuffer(0),X,null,a),b()}else u=new IX(d,N,X,(()=>{X.removePendingData(u)}),a),X.addPendingData(u);if(b.position){const X=S.tX.hX(b.position);u.setPosition(X)}if(b.isDirectional&&(u.setDirectionalCone(b.coneInnerAngle||360,b.coneOuterAngle||360,b.coneOuterGain||0),b.localDirectionToMesh)){const X=S.tX.hX(b.localDirectionToMesh);u.setLocalDirectionToMesh(X)}if(b.connectedMeshId){const P=X.getMeshById(b.connectedMeshId);P&&u.attachToMesh(P)}return b.metadata&&(u.metadata=b.metadata),u}_setOffset(b){this._offset!==b&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=b)}_clearTimeoutsAndObservers(){var b;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(b=RX.c.audioEngine)||void 0===b||b.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}IX._SceneComponentInitialization=b=>{throw(0,MX.b)("AudioSceneComponent")},(0,Lb.h)("BABYLON.Sound",IX);class GX{constructor(b,X,P){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],X.length!==P.length)throw new Error("Sounds length does not equal weights length");this.loop=b,this._weights=P;let Q=0;for(const d of P)Q+=d;const S=Q>0?1/Q:0;for(let d=0;d<this._weights.length;d++)this._weights[d]*=S;this._sounds=X;for(const d of this._sounds)d.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(b){if(b!==this._coneInnerAngle){if(this._coneOuterAngle<b)return void E.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=b;for(const X of this._sounds)X.directionalConeInnerAngle=b}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(b){if(b!==this._coneOuterAngle){if(b<this._coneInnerAngle)return void E.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=b;for(const X of this._sounds)X.directionalConeOuterAngle=b}}get volume(){return this._volume}set volume(b){if(b!==this._volume)for(const X of this._sounds)X.setVolume(b)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(b){if(!this.isPaused){this.stop();const b=Math.random();let X=0;for(let P=0;P<this._weights.length;P++)if(X+=this._weights[P],b<=X){this._currentIndex=P;break}}const X=this._sounds[this._currentIndex??0];X.isReady()?X.play(0,this.isPaused?void 0:b):X.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class mP{constructor(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(b=b||D.e.LastCreatedScene)&&(this._scene=b,this.soundCollection=[],this._options=X,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var b;null!==(b=RX.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&RX.c.audioEngine.audioContext&&(this._outputAudioNode=RX.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(RX.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(RX.c.audioEngine&&RX.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(b){var X;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(X=RX.c.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&b.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==b.soundTrackId&&(-1===b.soundTrackId?this._scene.mainSoundTrack.removeSound(b):this._scene.soundTracks&&this._scene.soundTracks[b.soundTrackId].removeSound(b)),this.soundCollection.push(b),b.soundTrackId=this.id}removeSound(b){const X=this.soundCollection.indexOf(b);-1!==X&&this.soundCollection.splice(X,1)}setVolume(b){var X;null!==(X=RX.c.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=b)}switchPanningModelToHRTF(){var b;if(null!==(b=RX.c.audioEngine)&&void 0!==b&&b.canUseWebAudio)for(let X=0;X<this.soundCollection.length;X++)this.soundCollection[X].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var b;if(null!==(b=RX.c.audioEngine)&&void 0!==b&&b.canUseWebAudio)for(let X=0;X<this.soundCollection.length;X++)this.soundCollection[X].switchPanningModelToEqualPower()}connectToAnalyser(b){var X;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=b,null!==(X=RX.c.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,RX.c.audioEngine.masterGain))}}var bP=P(12134),XP=P(12093),PP=P(11696);RX.c.AudioEngineFactory=(b,X,P)=>new QP(b,X,P);class QP{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new f.d,this.onAudioLockedObservable=new f.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,PP.o)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const Q=document.createElement("audio");this._hostElement=b,this._audioContext=X,this._audioDestination=P;try{Q&&Q.canPlayType&&(Q.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||Q.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(S){}try{Q&&Q.canPlayType&&Q.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(S){}}lock(){this._triggerSuspendedState()}unlock(){var b,X;if("running"===(null===(b=this._audioContext)||void 0===b?void 0:b.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(X=this._audioContext)||void 0===X||X.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{E.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var b;null===(b=this._audioContext)||void 0===b||b.addEventListener("statechange",(()=>{var b;this.unlocked&&"running"!==(null===(b=this._audioContext)||void 0===b?void 0:b.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var b;return null!==(b=this._audioContext)&&void 0!==b&&b.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(b){this.canUseWebAudio=!1,E.b.Error("Web Audio: "+b.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(b){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const b=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",X=document.createElement("style");X.appendChild(document.createTextNode(b)),document.getElementsByTagName("head")[0].appendChild(X),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var b;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(b=this._audioContext)||void 0===b||b.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(b){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=b)}connectToAnalyser(b){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=b,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var SP=P(11713);(0,P(13308).c)(bP.e.NAME_AUDIO,((b,X,P,Q)=>{let S,d=[];if(P.uY=P.uY||[],void 0!==b.uY&&null!==b.uY)for(let a=0,u=b.uY.length;a<u;a++){var N;const u=b.uY[a];null!==(N=RX.c.audioEngine)&&void 0!==N&&N.canUseWebAudio?(u.url||(u.url=u.name),d[u.url]?P.uY.push(IX.Parse(u,X,Q,d[u.url])):(S=IX.Parse(u,X,Q),d[u.url]=S,P.uY.push(S))):P.uY.push(new IX(u.name,null,X))}d=[]})),Object.defineProperty(XP.e.prototype,"mainSoundTrack",{get:function(){let b=this._getComponent(bP.e.NAME_AUDIO);return b||(b=new dP(this),this.o(b)),this._mainSoundTrack||(this._mainSoundTrack=new mP(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),XP.e.prototype.getSoundByName=function(b){let X;for(X=0;X<this.mainSoundTrack.soundCollection.length;X++)if(this.mainSoundTrack.soundCollection[X].name===b)return this.mainSoundTrack.soundCollection[X];if(this.soundTracks)for(let P=0;P<this.soundTracks.length;P++)for(X=0;X<this.soundTracks[P].soundCollection.length;X++)if(this.soundTracks[P].soundCollection[X].name===b)return this.soundTracks[P].soundCollection[X];return null},Object.defineProperty(XP.e.prototype,"audioEnabled",{get:function(){let b=this._getComponent(bP.e.NAME_AUDIO);return b||(b=new dP(this),this.o(b)),b.audioEnabled},set:function(b){let X=this._getComponent(bP.e.NAME_AUDIO);X||(X=new dP(this),this.o(X)),b?X.enableAudio():X.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(XP.e.prototype,"headphone",{get:function(){let b=this._getComponent(bP.e.NAME_AUDIO);return b||(b=new dP(this),this.o(b)),b.headphone},set:function(b){let X=this._getComponent(bP.e.NAME_AUDIO);X||(X=new dP(this),this.o(X)),b?X.switchAudioModeForHeadphones():X.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(XP.e.prototype,"audioListenerPositionProvider",{get:function(){let b=this._getComponent(bP.e.NAME_AUDIO);return b||(b=new dP(this),this.o(b)),b.audioListenerPositionProvider},set:function(b){let X=this._getComponent(bP.e.NAME_AUDIO);if(X||(X=new dP(this),this.o(X)),b&&"function"!==typeof b)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");X.audioListenerPositionProvider=b},enumerable:!0,configurable:!0}),Object.defineProperty(XP.e.prototype,"audioListenerRotationProvider",{get:function(){let b=this._getComponent(bP.e.NAME_AUDIO);return b||(b=new dP(this),this.o(b)),b.audioListenerRotationProvider},set:function(b){let X=this._getComponent(bP.e.NAME_AUDIO);if(X||(X=new dP(this),this.o(X)),b&&"function"!==typeof b)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");X.audioListenerRotationProvider=b},enumerable:!0,configurable:!0}),Object.defineProperty(XP.e.prototype,"audioPositioningRefreshRate",{get:function(){let b=this._getComponent(bP.e.NAME_AUDIO);return b||(b=new dP(this),this.o(b)),b.audioPositioningRefreshRate},set:function(b){let X=this._getComponent(bP.e.NAME_AUDIO);X||(X=new dP(this),this.o(X)),X.audioPositioningRefreshRate=b},enumerable:!0,configurable:!0});class dP{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(b){this.name=bP.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new S.tX,this._cachedCameraPosition=new S.tX,this._lastCheck=0,this._invertMatrixTemp=new S.Matrix,this._cameraDirectionTemp=new S.tX,(b=b||D.e.LastCreatedScene)&&(this.WX=b,b.soundTracks=[],b.uY=[])}register(){this.WX._afterRenderStage.registerStep(bP.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(b){if(b.uY=[],this.WX.soundTracks)for(let X=0;X<this.WX.soundTracks.length;X++){const P=this.WX.soundTracks[X];for(let X=0;X<P.soundCollection.length;X++)b.uY.push(P.soundCollection[X].serialize())}}addFromContainer(b){if(b.uY)for(const X of b.uY)X.play(),X.autoplay=!0,this.WX.mainSoundTrack.addSound(X)}removeFromContainer(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(b.uY)for(const P of b.uY)P.stop(),P.autoplay=!1,this.WX.mainSoundTrack.removeSound(P),X&&P.dispose()}dispose(){const b=this.WX;if(b._mainSoundTrack&&b.mainSoundTrack.dispose(),b.soundTracks)for(let X=0;X<b.soundTracks.length;X++)b.soundTracks[X].dispose()}disableAudio(){const b=this.WX;let X;for(this._audioEnabled=!1,RX.c.audioEngine&&RX.c.audioEngine.audioContext&&RX.c.audioEngine.audioContext.suspend(),X=0;X<b.mainSoundTrack.soundCollection.length;X++)b.mainSoundTrack.soundCollection[X].pause();if(b.soundTracks)for(X=0;X<b.soundTracks.length;X++)for(let P=0;P<b.soundTracks[X].soundCollection.length;P++)b.soundTracks[X].soundCollection[P].pause()}enableAudio(){const b=this.WX;let X;for(this._audioEnabled=!0,RX.c.audioEngine&&RX.c.audioEngine.audioContext&&RX.c.audioEngine.audioContext.resume(),X=0;X<b.mainSoundTrack.soundCollection.length;X++)b.mainSoundTrack.soundCollection[X].isPaused&&b.mainSoundTrack.soundCollection[X].play();if(b.soundTracks)for(X=0;X<b.soundTracks.length;X++)for(let P=0;P<b.soundTracks[X].soundCollection.length;P++)b.soundTracks[X].soundCollection[P].isPaused&&b.soundTracks[X].soundCollection[P].play()}switchAudioModeForHeadphones(){const b=this.WX;if(this._headphone=!0,b.mainSoundTrack.switchPanningModelToHRTF(),b.soundTracks)for(let X=0;X<b.soundTracks.length;X++)b.soundTracks[X].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const b=this.WX;if(this._headphone=!1,b.mainSoundTrack.switchPanningModelToEqualPower(),b.soundTracks)for(let X=0;X<b.soundTracks.length;X++)b.soundTracks[X].switchPanningModelToEqualPower()}_afterRender(){const b=SP.e.Now;if(this._lastCheck&&b-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=b;const X=this.WX;if(!this._audioEnabled||!X._mainSoundTrack||!X.soundTracks||0===X._mainSoundTrack.soundCollection.length&&1===X.soundTracks.length)return;const P=RX.c.audioEngine;if(P&&P.audioContext){let b,Q=X.activeCamera;if(X.activeCameras&&X.activeCameras.length>0&&(Q=X.activeCameras[0]),this.audioListenerPositionProvider){const b=this.audioListenerPositionProvider();P.audioContext.listener.setPosition(b.x||0,b.y||0,b.z||0)}else Q?this._cachedCameraPosition.equals(Q.globalPosition)||(this._cachedCameraPosition.N(Q.globalPosition),P.audioContext.listener.setPosition(Q.globalPosition.x,Q.globalPosition.y,Q.globalPosition.z)):P.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const b=this.audioListenerRotationProvider();P.audioContext.listener.setOrientation(b.x||0,b.y||0,b.z||0,0,1,0)}else Q?(Q.rigCameras&&Q.rigCameras.length>0&&(Q=Q.rigCameras[0]),Q.getViewMatrix().invertToRef(this._invertMatrixTemp),S.tX.TransformNormalToRef(dP._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.N(this._cameraDirectionTemp),P.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):P.audioContext.listener.setOrientation(0,0,0,0,1,0);for(b=0;b<X.mainSoundTrack.soundCollection.length;b++){const P=X.mainSoundTrack.soundCollection[b];P.useCustomAttenuation&&P.updateDistanceFromListener()}if(X.soundTracks)for(b=0;b<X.soundTracks.length;b++)for(let P=0;P<X.soundTracks[b].soundCollection.length;P++){const Q=X.soundTracks[b].soundCollection[P];Q.useCustomAttenuation&&Q.updateDistanceFromListener()}}}}dP._CameraDirection=new S.tX(0,0,-1),IX._SceneComponentInitialization=b=>{let X=b._getComponent(bP.e.NAME_AUDIO);X||(X=new dP(b),b.o(X))};const NP="MSFT_audio_emitter";class aP{constructor(b){this.name=NP,this._loader=b,this.enabled=this._loader.isExtensionUsed(NP)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const b=this._loader.ed.extensions;if(b&&b[this.name]){const X=b[this.name];this._clips=X.clips,this._emitters=X.emitters,j.Assign(this._clips),j.Assign(this._emitters)}}loadSceneAsync(b,X){return J.LoadExtensionAsync(b,X,this.name,(async(P,Q)=>{const S=new Array;S.push(this._loader.loadSceneAsync(b,X));for(const b of Q.emitters){const X=j.Get(`${P}/emitters`,this._emitters,b);if(void 0!=X.refDistance||void 0!=X.maxDistance||void 0!=X.rolloffFactor||void 0!=X.distanceModel||void 0!=X.innerAngle||void 0!=X.outerAngle)throw new Error(`${P}: Direction or Distance properties are not allowed on emitters attached to a scene`);S.push(this._loadEmitterAsync(`${P}/emitters/${X.index}`,X))}await Promise.all(S)}))}loadNodeAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(b,Q)=>{const d=new Array,a=await this._loader.loadNodeAsync(b,X,(X=>{for(const P of Q.emitters){const Q=j.Get(`${b}/emitters`,this._emitters,P);d.push(this._loadEmitterAsync(`${b}/emitters/${Q.index}`,Q).then((()=>{for(const b of Q._babylonSounds)b.attachToMesh(X),void 0==Q.innerAngle&&void 0==Q.outerAngle||(b.setLocalDirectionToMesh(S.tX.Forward()),b.setDirectionalCone(2*N.Tools.ToDegrees(void 0==Q.innerAngle?Math.PI:Q.innerAngle),2*N.Tools.ToDegrees(void 0==Q.outerAngle?Math.PI:Q.outerAngle),0))})))}P(X)}));return await Promise.all(d),a}))}loadAnimationAsync(b,X){return J.LoadExtensionAsync(b,X,this.name,(async(P,Q)=>{const S=await this._loader.loadAnimationAsync(b,X),d=new Array;j.Assign(Q.events);for(const N of Q.events)d.push(this._loadAnimationEventAsync(`${P}/events/${N.index}`,b,X,N,S));return await Promise.all(d),S}))}_loadClipAsync(b,X){if(X._objectURL)return X._objectURL;let P;if(X.uri)P=this._loader.loadUriAsync(b,X,X.uri);else{const Q=j.Get(`${b}/bufferView`,this._loader.ed.bufferViews,X.bufferView);P=this._loader.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q)}return X._objectURL=P.then((b=>URL.createObjectURL(new Blob([b],{type:X.mimeType})))),X._objectURL}_loadEmitterAsync(b,X){if(X._babylonSounds=X._babylonSounds||[],!X._babylonData){const b=new Array,P=X.name||`emitter${X.index}`,Q={loop:!1,autoplay:!1,volume:void 0==X.volume?1:X.volume};for(let d=0;d<X.clips.length;d++){const S=`/extensions/${this.name}/clips`,N=j.Get(S,this._clips,X.clips[d].clip);b.push(this._loadClipAsync(`${S}/${X.clips[d].clip}`,N).then((b=>{const S=X._babylonSounds[d]=new IX(P,b,this._loader.babylonScene,null,Q);S.refDistance=X.refDistance||1,S.maxDistance=X.maxDistance||256,S.rolloffFactor=X.rolloffFactor||1,S.distanceModel=X.distanceModel||"exponential"})))}const S=Promise.all(b).then((()=>{const b=X.clips.map((b=>b.weight||1)),P=new GX(X.loop||!1,X._babylonSounds,b);X.innerAngle&&(P.directionalConeInnerAngle=2*N.Tools.ToDegrees(X.innerAngle)),X.outerAngle&&(P.directionalConeOuterAngle=2*N.Tools.ToDegrees(X.outerAngle)),X.volume&&(P.volume=X.volume),X._babylonData.sound=P}));X._babylonData={loaded:S}}return X._babylonData.loaded}_getEventAction(b,X,P,Q,S){switch(P){case"play":return b=>{const P=(S||0)+(b-Q);X.play(P)};case"stop":return()=>{X.stop()};case"pause":return()=>{X.pause()};default:throw new Error(`${b}: Unsupported action ${P}`)}}_loadAnimationEventAsync(b,X,P,Q,S){if(0==S.targetedAnimations.length)return Promise.resolve();const d=S.targetedAnimations[0],N=Q.dX,a=j.Get(`/extensions/${this.name}/emitters`,this._emitters,N);return this._loadEmitterAsync(b,a).then((()=>{const X=a._babylonData.sound;if(X){const P=new FX(Q.time,this._getEventAction(b,X,Q.action,Q.time,Q.startOffset));d.animation.addEvent(P),S.onAnimationGroupEndObservable.add((()=>{X.stop()})),S.onAnimationGroupPauseObservable.add((()=>{X.pause()}))}}))}}k(NP),p(NP,!0,(b=>new aP(b)));const uP="MSFT_lod";class wP{constructor(b){var X;this.name=uP,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new f.d,this.onMaterialLODsLoadedObservable=new f.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=b,this.maxLODsToLoad=(null===(X=this._loader.parent.extensionOptions[uP])||void 0===X?void 0:X.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(uP)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let b=0;b<this._nodePromiseLODs.length;b++){const X=Promise.all(this._nodePromiseLODs[b]).then((()=>{0!==b&&(this._loader.endPerformanceCounter(`Node LOD ${b}`),this._loader.log(`Loaded node LOD ${b}`)),this.onNodeLODsLoadedObservable.notifyObservers(b),b!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${b+1}`),this._loadBufferLOD(this._nodeBufferLODs,b+1),this._nodeSignalLODs[b]&&this._nodeSignalLODs[b].resolve())}));this._loader._completePromises.push(X)}for(let b=0;b<this._materialPromiseLODs.length;b++){const X=Promise.all(this._materialPromiseLODs[b]).then((()=>{0!==b&&(this._loader.endPerformanceCounter(`Material LOD ${b}`),this._loader.log(`Loaded material LOD ${b}`)),this.onMaterialLODsLoadedObservable.notifyObservers(b),b!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${b+1}`),this._loadBufferLOD(this._materialBufferLODs,b+1),this._materialSignalLODs[b]&&this._materialSignalLODs[b].resolve())}));this._loader._completePromises.push(X)}}loadSceneAsync(b,X){const P=this._loader.loadSceneAsync(b,X);return this._loadBufferLOD(this._bufferLODs,0),P}loadNodeAsync(b,X,P){return J.LoadExtensionAsync(b,X,this.name,(async(b,S)=>{let d;const N=this._getLODs(b,X,this._loader.ed.nodes,S.ids);this._loader.logOpen(`${b}`);for(let X=0;X<N.length;X++){const b=N[X];0!==X&&(this._nodeIndexLOD=X,this._nodeSignalLODs[X]=this._nodeSignalLODs[X]||new Q);const S=b=>{P(b),b.za(!1)},a=this._loader.loadNodeAsync(`/nodes/${b.index}`,b,S).then((b=>{if(0!==X){const b=N[X-1];b._babylonTransformNode&&(this._disposeTransformNode(b._babylonTransformNode),delete b._babylonTransformNode)}return b.za(!0),b}));this._nodePromiseLODs[X]=this._nodePromiseLODs[X]||[],0===X?d=a:(this._nodeIndexLOD=null,this._nodePromiseLODs[X].push(a))}return this._loader.logClose(),await d}))}_loadMaterialAsync(b,X,P,Q,S){return this._nodeIndexLOD?null:J.LoadExtensionAsync(b,X,this.name,(async(b,d)=>{let N;const a=this._getLODs(b,X,this._loader.ed.materials,d.ids);this._loader.logOpen(`${b}`);for(let X=0;X<a.length;X++){const b=a[X];0!==X&&(this._materialIndexLOD=X);const d=this._loader._loadMaterialAsync(`/materials/${b.index}`,b,P,Q,(b=>{0===X&&S(b)})).then((b=>{if(0!==X){S(b);const P=a[X-1]._data;P[Q]&&(this._disposeMaterials([P[Q].babylonMaterial]),delete P[Q])}return b}));this._materialPromiseLODs[X]=this._materialPromiseLODs[X]||[],0===X?N=d:(this._materialIndexLOD=null,this._materialPromiseLODs[X].push(d))}return this._loader.logClose(),await N}))}_loadUriAsync(b,X,P){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const S=this._nodeIndexLOD-1;return this._nodeSignalLODs[S]=this._nodeSignalLODs[S]||new Q,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(b,X,P)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const S=this._materialIndexLOD-1;return this._materialSignalLODs[S]=this._materialSignalLODs[S]||new Q,this._materialSignalLODs[S].promise.then((async()=>await this._loader.loadUriAsync(b,X,P)))}return null}loadBufferAsync(b,X,P,S){if(this._loader.parent.useRangeRequests&&!X.uri){if(!this._loader.bin)throw new Error(`${b}: Uri is missing or the binary glTF is missing its binary chunk`);const X=async(b,X)=>{const d=P,N=d+S-1;let a=b[X];return a?(a.start=Math.min(a.start,d),a.end=Math.max(a.end,N)):(a={start:d,end:N,loaded:new Q},b[X]=a),await a.loaded.promise.then((b=>new Uint8Array(b.buffer,b.byteOffset+P-a.start,S)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?X(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?X(this._materialBufferLODs,this._materialIndexLOD):X(this._bufferLODs,0)}return null}_loadBufferLOD(b,X){const P=b[X];P&&(this._loader.log(`Loading buffer range [${P.start}-${P.end}]`),this._loader.bin.readAsync(P.start,P.end-P.start+1).then((b=>{P.loaded.resolve(b)}),(b=>{P.loaded.reject(b)})))}_getLODs(b,X,P,Q){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const S=[];for(let d=Q.length-1;d>=0;d--)if(S.push(j.Get(`${b}/ids/${Q[d]}`,P,Q[d])),S.length===this.maxLODsToLoad)return S;return S.push(X),S}_disposeTransformNode(b){const X=[],P=b.material;P&&X.push(P);for(const S of b.getChildMeshes())S.material&&X.push(S.material);b.dispose();const Q=X.filter((b=>this._loader.babylonScene.meshes.every((X=>X.material!=b))));this._disposeMaterials(Q)}_disposeMaterials(b){const X={};for(const P of b){for(const b of P.getActiveTextures())X[b.uniqueId]=b;P.dispose()}for(const P in X)for(const b of this._loader.babylonScene.materials)b.hasTexture(X[P])&&delete X[P];for(const P in X)X[P].dispose()}}k(uP),p(uP,!0,(b=>new wP(b)));const fP="MSFT_minecraftMesh";class OP{constructor(b){this.name=fP,this._loader=b,this.enabled=this._loader.isExtensionUsed(fP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtraAsync(b,X,this.name,(async(Q,S)=>{if(S){if(!(P instanceof n.e))throw new Error(`${Q}: Material type not supported`);const S=this._loader.loadMaterialPropertiesAsync(b,X,P);return P.needAlphaBlending()&&(P.forceDepthWrite=!0,P.separateCullingPass=!0),P.Jd=P.forceDepthWrite,P.twoSidedLighting=!0,await S}}))}}k(fP),p(fP,!0,(b=>new OP(b)));const eP="MSFT_sRGBFactors";class YP{constructor(b){this.name=eP,this._loader=b,this.enabled=this._loader.isExtensionUsed(eP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,X,P){return J.LoadExtraAsync(b,X,this.name,(async(Q,S)=>{if(S){if(!(P instanceof n.e))throw new Error(`${Q}: Material type not supported`);const S=this._loader.loadMaterialPropertiesAsync(b,X,P),d=P.Ab().getEngine().useExactSrgbConversions;return P.albedoTexture||P.albedoColor.toLinearSpaceToRef(P.albedoColor,d),P.reflectivityTexture||P.reflectivityColor.toLinearSpaceToRef(P.reflectivityColor,d),await S}}))}}k(eP),p(eP,!0,(b=>new YP(b)));var DP=P(13612);const EP={};var tP=P(13665),BP=P(13639),WP=P(13617),nP=P(13631);function yP(b,X){for(const P of b)for(const b of P.dataOutputs)if(b.uniqueId===X)return b;throw new Error("Could not find data out connection with unique id "+X)}function hP(b,X){for(const P of b)if(P instanceof BP.c)for(const b of P.signalInputs)if(b.uniqueId===X)return b;throw new Error("Could not find signal in connection with unique id "+X)}async function LP(b,X){const Q=await Promise.all(b.allBlocks.map((async b=>{const X=function(b){switch(b){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([P.e(78),P.e(79)]).then(P.bind(P,15130))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await P.e(80).then(P.bind(P,15139))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await P.e(81).then(P.bind(P,15144))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await P.e(82).then(P.bind(P,15152))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await P.e(83).then(P.bind(P,15161))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await P.e(84).then(P.bind(P,15170))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await P.e(85).then(P.bind(P,15174))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await P.e(86).then(P.bind(P,15183))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await P.e(87).then(P.bind(P,15188))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await P.e(89).then(P.bind(P,15222))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await P.e(89).then(P.bind(P,15222))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await P.e(89).then(P.bind(P,15222))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await P.e(89).then(P.bind(P,15222))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await P.e(89).then(P.bind(P,15222))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await P.e(89).then(P.bind(P,15222))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await P.e(90).then(P.bind(P,15225))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await P.e(90).then(P.bind(P,15225))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await P.e(90).then(P.bind(P,15225))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await P.e(90).then(P.bind(P,15225))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await P.e(95).then(P.bind(P,15232))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await P.e(96).then(P.bind(P,15236))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await P.e(97).then(P.bind(P,15240))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await P.e(98).then(P.bind(P,15243))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await P.e(99).then(P.bind(P,15249))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await P.e(100).then(P.bind(P,15255))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await P.e(101).then(P.bind(P,15262))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await P.e(102).then(P.bind(P,15269))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await P.e(103).then(P.bind(P,15274))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await P.e(104).then(P.bind(P,15283))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await P.e(105).then(P.bind(P,15285))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await P.e(106).then(P.bind(P,15293))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await P.e(107).then(P.bind(P,15301))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await P.e(108).then(P.bind(P,15306))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await P.e(109).then(P.bind(P,15311))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await P.e(110).then(P.bind(P,15320))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await P.e(111).then(P.bind(P,15325))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await P.e(112).then(P.bind(P,15331))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await P.e(113).then(P.bind(P,15336))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await P.e(92).then(P.bind(P,15339))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await P.e(114).then(P.bind(P,15348))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await P.e(115).then(P.bind(P,15355))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await P.e(116).then(P.bind(P,15357))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await P.e(93).then(P.bind(P,15364))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await P.e(88).then(P.bind(P,15195))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await P.e(94).then(P.bind(P,15372))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await P.e(94).then(P.bind(P,15372))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await P.e(94).then(P.bind(P,15372))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await P.e(94).then(P.bind(P,15372))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await P.e(94).then(P.bind(P,15372))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await P.e(94).then(P.bind(P,15372))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await P.e(94).then(P.bind(P,15372))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await P.e(94).then(P.bind(P,15372))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await P.e(89).then(P.bind(P,15222))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await P.e(89).then(P.bind(P,15222))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await P.e(89).then(P.bind(P,15222))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await P.e(89).then(P.bind(P,15222))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await P.e(89).then(P.bind(P,15222))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await P.e(89).then(P.bind(P,15222))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await P.e(89).then(P.bind(P,15222))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await P.e(90).then(P.bind(P,15225))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await P.e(90).then(P.bind(P,15225))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await P.e(91).then(P.bind(P,15377))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await P.e(91).then(P.bind(P,15377))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await P.e(91).then(P.bind(P,15377))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await P.e(91).then(P.bind(P,15377))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await P.e(91).then(P.bind(P,15377))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await P.e(91).then(P.bind(P,15377))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await P.e(117).then(P.bind(P,15386))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await P.e(118).then(P.bind(P,15390))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await P.e(119).then(P.bind(P,15399))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await P.e(120).then(P.bind(P,15403))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await P.e(121).then(P.bind(P,15409))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await P.e(122).then(P.bind(P,15412))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await P.e(123).then(P.bind(P,15415))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await P.e(124).then(P.bind(P,15419))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await P.e(125).then(P.bind(P,15423))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await P.e(126).then(P.bind(P,15430))).FlowGraphDataSwitchBlock;default:if(EP[b])return EP[b];throw new Error(`Unknown block name ${b}`)}}(b.className);return await X()})));return function(b,X,P){const Q=X.coordinator.createGraph(),S=[],d=X.valueParseFunction??WP.b;for(let N=0;N<b.allBlocks.length;N++){const a=vP(b.allBlocks[N],{WX:X.coordinator.config.WX,pathConverter:X.pathConverter,assetsContainer:X.coordinator.config.WX,valueParseFunction:d},P[N]);S.push(a),a instanceof tP.b&&Q.addEventBlock(a)}for(const N of S){for(const b of N.dataInputs)for(const X of b.connectedPointIds){const P=yP(S,X);b.connectTo(P)}if(N instanceof BP.c)for(const b of N.signalOutputs)for(const X of b.connectedPointIds){const P=hP(S,X);b.connectTo(P)}}for(const N of b.executionContexts)ZP(N,{graph:Q,valueParseFunction:d},b.rightHanded);return Q}(b,X,Q)}function ZP(b,X,P){const Q=X.graph.createContext();b.enableLogging&&(Q.enableLogging=!0),Q.treatDataAsRightHanded=P||!1;const S=X.valueParseFunction??WP.b;Q.uniqueId=b.uniqueId;const d=Q.Ab();if(b._assetsContext){var N,a,u,w,f,O,e,Y,D,E;const X=b._assetsContext,P={meshes:null===(N=X.meshes)||void 0===N?void 0:N.map((b=>d.getMeshById(b))),lights:null===(a=X.lights)||void 0===a?void 0:a.map((b=>d.getLightByName(b))),cameras:null===(u=X.cameras)||void 0===u?void 0:u.map((b=>d.getCameraByName(b))),materials:null===(w=X.materials)||void 0===w?void 0:w.map((b=>d.getMaterialById(b))),textures:null===(f=X.textures)||void 0===f?void 0:f.map((b=>d.getTextureByName(b))),animations:null===(O=X.animations)||void 0===O?void 0:O.map((b=>d.animations.find((X=>X.name===b)))),skeletons:null===(e=X.skeletons)||void 0===e?void 0:e.map((b=>d.getSkeletonByName(b))),Oe:null===(Y=X.Oe)||void 0===Y?void 0:Y.map((b=>d.getParticleSystemById(b))),animationGroups:null===(D=X.animationGroups)||void 0===D?void 0:D.map((b=>d.getAnimationGroupByName(b))),transformNodes:null===(E=X.transformNodes)||void 0===E?void 0:E.map((b=>d.getTransformNodeById(b))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],uY:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};Q.assetsContext=P}for(const t in b._userVariables){const X=S(t,b._userVariables,Q.assetsContext,d);Q.userVariables[t]=X}for(const t in b._connectionValues){const X=S(t,b._connectionValues,Q.assetsContext,d);Q._setConnectionValueByKey(t,X)}return Q}function vP(b,X,P){const Q={},S=X.valueParseFunction??WP.b;if(b.config)for(const N in b.config)Q[N]=S(N,b.config,X.assetsContainer||X.WX,X.WX);if((0,WP.e)(b.className)){if(!X.pathConverter)throw new Error("Path converter is required for this block");Q.pathConverter=X.pathConverter}const d=new P(Q);d.uniqueId=b.uniqueId;for(let N=0;N<b.dataInputs.length;N++){const X=d.getDataInput(b.dataInputs[N].name);if(!X)throw new Error("Could not find data input with name "+b.dataInputs[N].name+" in block "+b.className);X.deserialize(b.dataInputs[N])}for(let N=0;N<b.dataOutputs.length;N++){const X=d.getDataOutput(b.dataOutputs[N].name);if(!X)throw new Error("Could not find data output with name "+b.dataOutputs[N].name+" in block "+b.className);X.deserialize(b.dataOutputs[N])}return d.metadata=b.metadata,d.deserialize&&d.deserialize(b),d}function AP(b){const[X,P]=b.split(":");return oP({op:X,extension:P})}function oP(b){var X;let P=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Q=b.extension?null===(X=TP[b.extension])||void 0===X?void 0:X[b.op]:qP[b.op];if(!Q&&(E.b.Warn(`No mapping found for operation ${b.op} and extension ${b.extension||"KHR_interactivity"}`),P)){const X={},P={flows:{}};if(b.inputValueSockets){X.values={};for(const P in b.inputValueSockets)X.values[P]={name:P}}return b.outputValueSockets&&(P.values={},Object.keys(b.outputValueSockets).forEach((b=>{P.values[b]={name:b}}))),{Of:[],inputs:X,outputs:P}}return Q}function KP(b,X,P){TP[X]||(TP[X]={}),TP[X][b]=P}const TP={BABYLON:{"flow/log":{Of:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},qP={"event/onStart":{Of:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Of:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Of:["FlowGraphSendCustomEventBlock"],extraProcessor(b,X,P,Q,S){if("event/send"!==X.op||!b.configuration||1!==Object.keys(b.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const d=b.configuration.event.value[0];if("number"!==typeof d)throw new Error("Event id should be a number");const N=Q.arrays.events[d],a=S[0];return a.config||(a.config={}),a.config.eventId=N.eventId,a.config.eventData=N.eventData,S}},"event/receive":{Of:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(b,X){var P;if(!b.configuration)return E.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const Q=b.configuration.event;if(!Q)return E.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const S=Q.value[0];if("number"!==typeof S)return E.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(P=X.events)||void 0===P?void 0:P[S])?{valid:!0}:(E.b.Error(`Event with id ${S} not found`),{valid:!1,error:`Event with id ${S} not found`})},extraProcessor(b,X,P,Q,S){if("event/receive"!==X.op||!b.configuration||1!==Object.keys(b.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const d=b.configuration.event.value[0];if("number"!==typeof d)throw new Error("Event id should be a number");const N=Q.arrays.events[d],a=S[0];return a.config||(a.config={}),a.config.eventId=N.eventId,a.config.eventData=N.eventData,S}},"math/e":VP("FlowGraphEBlock"),"math/pi":VP("FlowGraphPIBlock"),"math/inf":VP("FlowGraphInfBlock"),"math/nan":VP("FlowGraphNaNBlock"),"math/abs":VP("FlowGraphAbsBlock"),"math/sign":VP("FlowGraphSignBlock"),"math/trunc":VP("FlowGraphTruncBlock"),"math/floor":VP("FlowGraphFloorBlock"),"math/ceil":VP("FlowGraphCeilBlock"),"math/round":{Of:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,X,P,Q,S){var d;return(d=S[0]).config||(d.config={}),S[0].config.roundHalfAwayFromZero=!0,S}},"math/fract":VP("FlowGraphFractBlock"),"math/neg":VP("FlowGraphNegationBlock"),"math/add":VP("FlowGraphAddBlock",["a","b"],!0),"math/sub":VP("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Of:["FlowGraphMultiplyBlock"],extraProcessor(b,X,P,Q,S){var d;(d=S[0]).config||(d.config={}),S[0].config.useMatrixPerComponent=!0,S[0].config.preventIntegerFloatArithmetic=!0;let N=-1;return Object.keys(b.values||{}).find((X=>{var P;return void 0!==(null===(P=b.values)||void 0===P?void 0:P[X].type)&&(N=b.values[X].type,!0)})),-1!==N&&(S[0].config.type=Q.arrays.types[N].flowGraphType),S},validation:b=>b.values?iP(b):{valid:!0}},"math/div":VP("FlowGraphDivideBlock",["a","b"],!0),"math/rem":VP("FlowGraphModuloBlock",["a","b"]),"math/min":VP("FlowGraphMinBlock",["a","b"]),"math/max":VP("FlowGraphMaxBlock",["a","b"]),"math/clamp":VP("FlowGraphClampBlock",["a","b","c"]),"math/saturate":VP("FlowGraphSaturateBlock"),"math/mix":VP("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":VP("FlowGraphEqualityBlock",["a","b"]),"math/lt":VP("FlowGraphLessThanBlock",["a","b"]),"math/le":VP("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":VP("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":VP("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":VP("FlowGraphIsNaNBlock"),"math/isinf":VP("FlowGraphIsInfBlock"),"math/select":{Of:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Of:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":VP("FlowGraphSinBlock"),"math/cos":VP("FlowGraphCosBlock"),"math/tan":VP("FlowGraphTanBlock"),"math/asin":VP("FlowGraphASinBlock"),"math/acos":VP("FlowGraphACosBlock"),"math/atan":VP("FlowGraphATanBlock"),"math/atan2":VP("FlowGraphATan2Block",["a","b"]),"math/sinh":VP("FlowGraphSinhBlock"),"math/cosh":VP("FlowGraphCoshBlock"),"math/tanh":VP("FlowGraphTanhBlock"),"math/asinh":VP("FlowGraphASinhBlock"),"math/acosh":VP("FlowGraphACoshBlock"),"math/atanh":VP("FlowGraphATanhBlock"),"math/exp":VP("FlowGraphExponentialBlock"),"math/log":VP("FlowGraphLogBlock"),"math/log2":VP("FlowGraphLog2Block"),"math/log10":VP("FlowGraphLog10Block"),"math/sqrt":VP("FlowGraphSquareRootBlock"),"math/cbrt":VP("FlowGraphCubeRootBlock"),"math/pow":VP("FlowGraphPowerBlock",["a","b"]),"math/length":VP("FlowGraphLengthBlock"),"math/normalize":VP("FlowGraphNormalizeBlock"),"math/dot":VP("FlowGraphDotBlock",["a","b"]),"math/cross":VP("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":VP("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":VP("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Of:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Of:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Of:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Of:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Of:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Of:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Of:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":VP("FlowGraphTransposeBlock"),"math/determinant":VP("FlowGraphDeterminantBlock"),"math/inverse":VP("FlowGraphInvertMatrixBlock"),"math/matmul":VP("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Of:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Fd",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,X,P,Q,S,d){const N=S[0].dataInputs.find((b=>"rotationQuaternion"===b.name));if(!N)throw new Error("Rotation quaternion input not found");return d._connectionValues[N.uniqueId]&&(d._connectionValues[N.uniqueId].type="Quaternion"),S}},"math/matDecompose":{Of:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Fd"}}}},"math/quatConjugate":VP("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Of:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,X,P,Q,S){var d;return(d=S[0]).config||(d.config={}),S[0].config.type="Quaternion",S}},"math/quatAngleBetween":VP("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Of:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":VP("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":VP("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Of:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,X,P,Q,S){var d;return(d=S[0]).config||(d.config={}),S[0].config.inputIsColumnMajor=!0,S}},"math/extract2x2":{Of:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Of:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,X,P,Q,S){var d;return(d=S[0]).config||(d.config={}),S[0].config.inputIsColumnMajor=!0,S}},"math/extract3x3":{Of:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Of:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,X,P,Q,S){var d;return(d=S[0]).config||(d.config={}),S[0].config.inputIsColumnMajor=!0,S}},"math/extract4x4":{Of:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Of:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,X,P,Q,S,d){var N,a;(a=S[0]).config||(a.config={});const u=S[0].dataInputs[0];return S[0].config.valueType=(null===(N=d._connectionValues[u.uniqueId])||void 0===N?void 0:N.type)??"FlowGraphInteger",S}},"math/and":{Of:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,X,P,Q,S,d){var N,a,u;(u=S[0]).config||(u.config={});const w=S[0].dataInputs[0],f=S[0].dataInputs[1];return S[0].config.valueType=(null===(N=d._connectionValues[w.uniqueId])||void 0===N?void 0:N.type)??(null===(a=d._connectionValues[f.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",S}},"math/or":{Of:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,X,P,Q,S,d){var N,a,u;(u=S[0]).config||(u.config={});const w=S[0].dataInputs[0],f=S[0].dataInputs[1];return S[0].config.valueType=(null===(N=d._connectionValues[w.uniqueId])||void 0===N?void 0:N.type)??(null===(a=d._connectionValues[f.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",S}},"math/xor":{Of:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,X,P,Q,S,d){var N,a,u;(u=S[0]).config||(u.config={});const w=S[0].dataInputs[0],f=S[0].dataInputs[1];return S[0].config.valueType=(null===(N=d._connectionValues[w.uniqueId])||void 0===N?void 0:N.type)??(null===(a=d._connectionValues[f.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",S}},"math/asr":VP("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":VP("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":VP("FlowGraphLeadingZerosBlock"),"math/ctz":VP("FlowGraphTrailingZerosBlock"),"math/popcnt":VP("FlowGraphOneBitsCounterBlock"),"math/rad":VP("FlowGraphDegToRadBlock"),"math/deg":VP("FlowGraphRadToDegBlock"),"type/boolToInt":VP("FlowGraphBooleanToInt"),"type/boolToFloat":VP("FlowGraphBooleanToFloat"),"type/intToBool":VP("FlowGraphIntToBoolean"),"type/intToFloat":VP("FlowGraphIntToFloat"),"type/floatToInt":VP("FlowGraphFloatToInt"),"type/floatToBool":VP("FlowGraphFloatToBoolean"),"flow/sequence":{Of:["FlowGraphSequenceBlock"],extraProcessor(b,X,P,Q,S){const d=S[0];return d.config||(d.config={}),d.config.outputSignalCount=Object.keys(b.flows||[]).length,d.signalOutputs.forEach(((b,X)=>{b.name="out_"+X})),S}},"flow/branch":{Of:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Of:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(b){if(b.configuration&&b.configuration.cases){const X=b.configuration.cases.value;if(!X.every((b=>"number"===typeof b&&/^-?\d+$/.test(b.toString()))))return E.b.Warn("Switch cases should be integers. Using empty array instead."),b.configuration.cases.value=[],{valid:!0};const P=new Set(X);b.configuration.cases.value=Array.from(P)}return{valid:!0}},extraProcessor(b,X,P,Q,S){if("flow/switch"!==X.op||!b.flows||0===Object.keys(b.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return S[0].signalOutputs.forEach((b=>{"default"!==b.name&&(b.name="out_"+b.name)})),S}},"flow/while":{Of:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Of:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(b,X,P,Q,S){const d=S[0];return d.config||(d.config={}),d.config.incrementIndexWhenLoopDone=!0,S}},"flow/doN":{Of:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Of:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(b,X,P,Q,S){if("flow/multiGate"!==X.op||!b.flows||0===Object.keys(b.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const d=S[0];return d.config||(d.config={}),d.config.outputSignalCount=Object.keys(b.flows).length,d.signalOutputs.forEach(((b,X)=>{b.name="out_"+X})),S}},"flow/waitAll":{Of:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(b){var X,P;return"number"!==typeof(null===(X=b.configuration)||void 0===X||null===(P=X.inputFlows)||void 0===P?void 0:P.value[0])&&(b.configuration=b.configuration||{inputFlows:{value:[0]}},b.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Of:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Of:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Of:["FlowGraphCancelDelayBlock"]},"variable/get":{Of:["FlowGraphGetVariableBlock"],validation(b){var X,P;return null!==(X=b.configuration)&&void 0!==X&&null!==(P=X.variable)&&void 0!==P&&P.value?{valid:!0}:(E.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(b,X)=>[X.getVariableName(b[0])]}}},"variable/set":{Of:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(b,X)=>[X.getVariableName(b[0])]}}},"variable/setMultiple":{Of:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(b,X)=>[b[0].map((b=>X.getVariableName(b)))]}},extraProcessor:(b,X,P,Q,S)=>(S[0].dataInputs.forEach((b=>{b.name=Q.getVariableName(+b.name)})),S)},"variable/interpolate":{Of:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(b,X)=>[X.getVariableName(b[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:b=>!0===b[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",ZP:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",ZP:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",ZP:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",ZP:"FlowGraphPlayAnimationBlock"},out:{name:"out",ZP:"FlowGraphPlayAnimationBlock"},done:{name:"done",ZP:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(b,X,P,Q,S){var d,N,a;const u=S[0],w=null===(d=b.configuration)||void 0===d?void 0:d.variable.value[0];if("number"!==typeof w)throw E.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const f=Q.arrays.staticVariables[w];"undefined"===typeof u.config.animationType.value&&(Q.arrays.staticVariables,u.config.animationType.value=(0,nP.F)(f.type));const O=S[4];return O.config||(O.config={}),(N=O.config).variable||(N.variable={}),O.config.variable.value=Q.getVariableName(w),(a=S[3]).config||(a.config={}),S}},"pointer/get":{Of:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",ZP:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",ZP:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(b,X,P,Q,S)=>(S.forEach((b=>{"FlowGraphJsonPointerParserBlock"===b.className&&(b.config||(b.config={}),b.config.outputValue=!0)})),S)},"pointer/set":{Of:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",ZP:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",ZP:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(b,X,P,Q,S)=>(S.forEach((b=>{"FlowGraphJsonPointerParserBlock"===b.className&&(b.config||(b.config={}),b.config.outputValue=!0)})),S)},"pointer/interpolate":{Of:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",ZP:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",ZP:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",ZP:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",ZP:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",ZP:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",ZP:"FlowGraphPlayAnimationBlock"},out:{name:"out",ZP:"FlowGraphPlayAnimationBlock"},done:{name:"done",ZP:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(b,X,P,Q,S)=>(S.forEach((X=>{"FlowGraphJsonPointerParserBlock"===X.className?(X.config||(X.config={}),X.config.outputValue=!0):"FlowGraphInterpolationBlock"===X.className&&(X.config||(X.config={}),Object.keys(b.values||[]).forEach((P=>{var S;const d=null===(S=b.values)||void 0===S?void 0:S[P];if("value"===P&&d){const b=d.type;void 0!==b&&(X.config.animationType=Q.arrays.types[b].flowGraphType)}})))})),S)},"animation/start":{Of:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",ZP:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(b,X)=>[b[0]*X._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(b,X)=>[b[0]*X._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(b,X,P,Q,S,d,N){const a=S[S.length-1];return a.config||(a.config={}),a.config.glTF=N,S}},"animation/stop":{Of:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",ZP:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(b,X,P,Q,S,d,N){const a=S[S.length-1];return a.config||(a.config={}),a.config.glTF=N,S}},"animation/stopAt":{Of:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",ZP:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(b,X)=>[b[0]*X._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(b,X,P,Q,S,d,N){const a=S[S.length-1];return a.config||(a.config={}),a.config.glTF=N,S}},"math/switch":{Of:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(b){if(b.configuration&&b.configuration.cases){const X=b.configuration.cases.value;if(!X.every((b=>"number"===typeof b&&/^-?\d+$/.test(b.toString()))))return E.b.Warn("Switch cases should be integers. Using empty array instead."),b.configuration.cases.value=[],{valid:!0};const P=new Set(X);b.configuration.cases.value=Array.from(P)}return{valid:!0}},extraProcessor(b,X,P,Q,S){const d=S[0];return d.dataInputs.forEach((b=>{"default"!==b.name&&"case"!==b.name&&(b.name="in_"+b.name)})),d.config||(d.config={}),d.config.treatCasesAsIntegers=!0,S}},"debug/log":{Of:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function VP(b){let X=arguments.length>2?arguments[2]:void 0;return{Of:[b],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((b,X)=>(b[X]={name:X},b)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(b,P,Q,S,d){var N;if(X){(N=d[0]).config||(N.config={}),d[0].config.preventIntegerFloatArithmetic=!0;let X=-1;Object.keys(b.values||{}).find((P=>{var Q;return void 0!==(null===(Q=b.values)||void 0===Q?void 0:Q[P].type)&&(X=b.values[P].type,!0)})),-1!==X&&(d[0].config.type=S.arrays.types[X].flowGraphType)}return d},validation:b=>X?iP(b):{valid:!0}}}function iP(b){if(b.values){const X=Object.keys(b.values).map((X=>b.values[X].type)).filter((b=>void 0!==b));if(!X.every((b=>b===X[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}qP["math/compose"]=qP["math/matCompose"],qP["math/decompose"]=qP["math/matDecompose"];var xP=P(11804);const HP={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"tX",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class CP{constructor(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=b,this._gltf=X,this._animationTargetFps=P,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const b of this._interactivityGraph.types)this._types.push(HP[b.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const b of this._interactivityGraph.declarations){const X=oP(b);if(!X)throw E.b.Error(["No mapping found for declaration",b]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:X,fullOperationName:b.extension?b.op+":"+b.extension:b.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const b of this._interactivityGraph.variables){const X=this._parseVariable(b);this._staticVariables.push(X)}}_parseVariable(b,X){const P=this._types[b.type];if(!P)throw E.b.Error(["No type found for variable",b]),new Error("Error parsing variables");if(b.value&&b.value.length!==P.length)throw E.b.Error(["Invalid value length for variable",b,P]),new Error("Error parsing variables");const Q=b.value||[];if(!Q.length)switch(P.flowGraphType){case"boolean":Q.push(!1);break;case"FlowGraphInteger":Q.push(0);break;case"number":Q.push(NaN);break;case"Vector2":Q.push(NaN,NaN);break;case"tX":Q.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":Q.fill(NaN,0,4);break;case"Matrix":Q.fill(NaN,0,16);break;case"Matrix3D":Q.fill(NaN,0,9)}return"number"===P.elementType&&"string"===typeof Q[0]&&(Q[0]=parseFloat(Q[0])),{type:P.flowGraphType,value:X?X(Q,this):Q}}_parseEvents(){if(this._interactivityGraph.events)for(const b of this._interactivityGraph.events){const X={eventId:b.id||"internalEvent_"+this._internalEventsCounter++};b.values&&(X.eventData=Object.keys(b.values).map((X=>{var P;const Q=null===(P=b.values)||void 0===P?void 0:P[X];if(!Q)throw E.b.Error(["No value found for event key",X]),new Error("Error parsing events");const S=this._types[Q.type];if(!S)throw E.b.Error(["No type found for event value",Q]),new Error("Error parsing events");const d="undefined"!==typeof Q.value?this._parseVariable(Q):void 0;return{id:X,type:S.flowGraphType,eventData:!0,value:d}}))),this._events.push(X)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const X of this._interactivityGraph.nodes){if("number"!==typeof X.declaration)throw E.b.Error(["No declaration found for node",X]),new Error("Error parsing nodes");const P=this._mappings[X.declaration];if(!P)throw E.b.Error(["No mapping found for node",X]),new Error("Error parsing nodes");if(P.flowGraphMapping.validation){const Q=P.flowGraphMapping.validation(X,this._interactivityGraph,this._gltf);var b;if(!Q.valid)throw new Error(`Error validating interactivity node ${null===(b=this._interactivityGraph.declarations)||void 0===b?void 0:b[X.declaration].op} - ${Q.error}`)}const Q=[];for(const b of P.flowGraphMapping.Of){const S=this._getEmptyBlock(b,P.fullOperationName);this._parseNodeConfiguration(X,S,P.flowGraphMapping,b),Q.push(S)}this._nodes.push({Of:Q,fullOperationName:P.fullOperationName})}}_getEmptyBlock(b,X){return{uniqueId:(0,xP.b)(),className:b,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:X,metadata:{}}}_parseNodeConfiguration(b,X,P,Q){const S=X.config;if(b.configuration){const X=Object.keys(b.configuration);for(const a of X){var d,N;const X=null===(d=b.configuration)||void 0===d?void 0:d[a];if(!X)throw E.b.Error(["No value found for node configuration",a]),new Error("Error parsing node configuration");const u=null===(N=P.configuration)||void 0===N?void 0:N[a];if(u&&u.ZP?u.ZP===Q:0===P.Of.indexOf(Q)){const b=(null===u||void 0===u?void 0:u.name)||a;X&&"undefined"!==typeof X.value||"undefined"===typeof(null===u||void 0===u?void 0:u.defaultValue)?X.value.length>=0?S[b]={value:1===X.value.length?X.value[0]:X.value}:E.b.Warn(["Invalid value for node configuration",X]):S[b]={value:u.defaultValue},u&&u.dataTransformer&&(S[b].value=u.dataTransformer([S[b].value],this)[0])}}}}_parseNodeConnections(b){for(let L=0;L<this._nodes.length;L++){var X;const Z=null===(X=this._interactivityGraph.nodes)||void 0===X?void 0:X[L];if(!Z)throw E.b.Error(["No node found for interactivity node",this._nodes[L]]),new Error("Error parsing node connections");const v=this._nodes[L],A=this._mappings[Z.declaration];if(!A)throw E.b.Error(["No mapping found for node",Z]),new Error("Error parsing node connections");const o=Z.flows||{},K=Object.keys(o).sort();for(const b of K){var P,Q,S,d;const X=o[b],w=null===(P=A.flowGraphMapping.outputs)||void 0===P||null===(Q=P.flows)||void 0===Q?void 0:Q[b],f=(null===w||void 0===w?void 0:w.name)||b,O=this._createNewSocketConnection(f,!0);(w&&w.ZP&&v.Of.find((b=>b.className===w.ZP))||v.Of[0]).signalOutputs.push(O);const e=X.node,Y=this._nodes[e];if(!Y)throw E.b.Error(["No node found for input node id",e]),new Error("Error parsing node connections");const D=AP(Y.fullOperationName);if(!D)throw E.b.Error(["No mapping found for input node",Y]),new Error("Error parsing node connections");let t=null===(S=D.inputs)||void 0===S||null===(d=S.flows)||void 0===d?void 0:d[X.socket||"in"],B=!1;if(!t)for(const b in null===(N=D.inputs)||void 0===N?void 0:N.flows){var N,a,u;if(b.startsWith("[")&&b.endsWith("]"))B=!0,t=null===(a=D.inputs)||void 0===a||null===(u=a.flows)||void 0===u?void 0:u[b]}const W=t?B?t.name.replace("$1",X.socket||""):t.name:X.socket||"in",n=t&&t.ZP&&Y.Of.find((b=>b.className===t.ZP))||Y.Of[0];let y=n.signalInputs.find((b=>b.name===W));y||(y=this._createNewSocketConnection(W),n.signalInputs.push(y)),y.connectedPointIds.push(O.uniqueId),O.connectedPointIds.push(y.uniqueId)}const T=Z.values||{},q=Object.keys(T);for(const X of q){var w,f;const P=T[X];let Q=null===(w=A.flowGraphMapping.inputs)||void 0===w||null===(f=w.values)||void 0===f?void 0:f[X],S=!1;if(!Q)for(const b in null===(O=A.flowGraphMapping.inputs)||void 0===O?void 0:O.values){var O,e,Y;if(b.startsWith("[")&&b.endsWith("]"))S=!0,Q=null===(e=A.flowGraphMapping.inputs)||void 0===e||null===(Y=e.values)||void 0===Y?void 0:Y[b]}const d=Q?S?Q.name.replace("$1",X):Q.name:X,N=this._createNewSocketConnection(d);if((Q&&Q.ZP&&v.Of.find((b=>b.className===Q.ZP))||v.Of[0]).dataInputs.push(N),void 0!==P.value){const X=this._parseVariable(P,Q&&Q.dataTransformer);b._connectionValues[N.uniqueId]=X}else{if("undefined"===typeof P.node)throw E.b.Error(["Invalid value for value connection",P]),new Error("Error parsing node connections");{var D,t,B;const b=P.node,X=P.socket||"value",Q=this._nodes[b];if(!Q)throw E.b.Error(["No node found for output socket reference",P]),new Error("Error parsing node connections");const S=AP(Q.fullOperationName);if(!S)throw E.b.Error(["No mapping found for output socket reference",P]),new Error("Error parsing node connections");let d=null===(D=S.outputs)||void 0===D||null===(t=D.values)||void 0===t?void 0:t[X],a=!1;if(!d)for(const P in null===(W=S.outputs)||void 0===W?void 0:W.values){var W,n,y;if(P.startsWith("[")&&P.endsWith("]"))a=!0,d=null===(n=S.outputs)||void 0===n||null===(y=n.values)||void 0===y?void 0:y[P]}const u=d?a?d.name.replace("$1",X):null===(B=d)||void 0===B?void 0:B.name:X,w=d&&d.ZP&&Q.Of.find((b=>b.className===d.ZP))||Q.Of[0];let f=w.dataOutputs.find((b=>b.name===u));f||(f=this._createNewSocketConnection(u,!0),w.dataOutputs.push(f)),N.connectedPointIds.push(f.uniqueId),f.connectedPointIds.push(N.uniqueId)}}}if(A.flowGraphMapping.interBlockConnectors)for(const b of A.flowGraphMapping.interBlockConnectors){const X=b.input,P=b.output,Q=b.isVariable;this._connectFlowGraphNodes(X,P,v.Of[b.inputBlockIndex],v.Of[b.outputBlockIndex],Q)}if(A.flowGraphMapping.extraProcessor){var h;const X=null===(h=this._interactivityGraph.declarations)||void 0===h?void 0:h[Z.declaration];if(!X)throw E.b.Error(["No declaration found for extra processor",Z]),new Error("Error parsing node connections");v.Of=A.flowGraphMapping.extraProcessor(Z,X,A.flowGraphMapping,this,v.Of,b,this._gltf)}}}_createNewSocketConnection(b,X){return{uniqueId:(0,xP.b)(),name:b,_connectionType:X?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(b,X,P,Q,S){const d=S?P.dataInputs:P.signalInputs,N=S?Q.dataOutputs:Q.signalOutputs,a=d.find((X=>X.name===b))||this._createNewSocketConnection(b),u=N.find((b=>b.name===X))||this._createNewSocketConnection(X,!0);d.find((X=>X.name===b))||d.push(a),N.find((b=>b.name===X))||N.push(u),a.connectedPointIds.push(u.uniqueId),u.connectedPointIds.push(a.uniqueId)}getVariableName(b){return"staticVariable_"+b}serializeToFlowGraph(){const b={uniqueId:(0,xP.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(b);for(let X=0;X<this._staticVariables.length;X++){const P=this._staticVariables[X];b._userVariables[this.getVariableName(X)]=P}return{rightHanded:!0,allBlocks:this._nodes.reduce(((b,X)=>b.concat(X.Of)),[]),executionContexts:[b]}}}const pP="KHR_interactivity";class kP{constructor(b){this._loader=b,this.name=pP,this.enabled=this._loader.isExtensionUsed(pP),this._pathConverter=(0,z.i)(this._loader.ed),b._skipStartAnimationStep=!0;const X=b.babylonScene;X&&function(b){(0,z.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!b.activeCamera)return new S.Quaternion(NaN,NaN,NaN,NaN);const X=S.Quaternion.FromRotationMatrix(b.activeCamera.getWorldMatrix()).normalize();return b.useRightHandedSystem||(X.w*=-1,X.x*=-1),X},type:"Quaternion",getTarget:()=>b.activeCamera}),(0,z.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!b.activeCamera)return new S.tX(NaN,NaN,NaN);const X=b.activeCamera.getWorldMatrix().getTranslation();return b.useRightHandedSystem||(X.x*=-1),X},type:"tX",getTarget:()=>b.activeCamera}),(0,z.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:b=>{var X;return(null===(X=b._babylonAnimationGroup)||void 0===X?void 0:X.isPlaying)??!1},type:"boolean",getTarget:b=>b._babylonAnimationGroup}),(0,z.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:b=>{var X;return((null===(X=b._babylonAnimationGroup)||void 0===X?void 0:X.from)??0)/60},type:"number",getTarget:b=>b._babylonAnimationGroup}),(0,z.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:b=>{var X;return((null===(X=b._babylonAnimationGroup)||void 0===X?void 0:X.to)??0)/60},type:"number",getTarget:b=>b._babylonAnimationGroup}),(0,z.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:b=>{var X;return((null===(X=b._babylonAnimationGroup)||void 0===X?void 0:X.getCurrentFrame())??0)/60},type:"number",getTarget:b=>b._babylonAnimationGroup}),(0,z.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:b=>{var X;return((null===(X=b._babylonAnimationGroup)||void 0===X?void 0:X.getCurrentFrame())??0)/60},type:"number",getTarget:b=>b._babylonAnimationGroup})}(X)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var b;if(!this._loader.babylonScene||!this._pathConverter)return;const X=this._loader.babylonScene,P=null===(b=this._loader.ed.extensions)||void 0===b?void 0:b.KHR_interactivity;if(!P)return;const Q=new DP.c({WX:X});Q.dispatchEventsSynchronously=!1;const S=P.graphs.map((b=>new CP(b,this._loader.ed,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(S.map((async b=>await LP(b,{coordinator:Q,pathConverter:this._pathConverter})))),Q.start()}}var zP;zP=async()=>(await Promise.resolve().then(P.bind(P,13683))).FlowGraphGLTFDataProvider,EP[`${pP}/${"FlowGraphGLTFDataProvider"}`]=zP,k(pP),p(pP,!0,(b=>new kP(b)));const UP="KHR_node_visibility";(0,z.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:b=>{const X=b._babylonTransformNode;return!X||void 0===X.isVisible||X.isVisible},set:(b,X)=>{var P,Q;null===(P=X._primitiveBabylonMeshes)||void 0===P||P.forEach((b=>{b.inheritVisibility=!0})),X._babylonTransformNode&&(X._babylonTransformNode.isVisible=b),null===(Q=X._primitiveBabylonMeshes)||void 0===Q||Q.forEach((X=>{X.isVisible=b}))},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class gP{constructor(b){this.name=UP,this._loader=b,this.enabled=b.isExtensionUsed(UP)}async onReady(){var b;null===(b=this._loader.ed.nodes)||void 0===b||b.forEach((b=>{var X,P,Q,S;(null===(X=b._primitiveBabylonMeshes)||void 0===X||X.forEach((b=>{b.inheritVisibility=!0})),null!==(P=b.extensions)&&void 0!==P&&P.KHR_node_visibility)&&(!1===(null===(Q=b.extensions)||void 0===Q?void 0:Q.KHR_node_visibility.visible)&&(b._babylonTransformNode&&(b._babylonTransformNode.isVisible=!1),null===(S=b._primitiveBabylonMeshes)||void 0===S||S.forEach((b=>{b.isVisible=!1}))))}))}dispose(){this._loader=null}}k(UP),p(UP,!0,(b=>new gP(b)));const jP="KHR_node_selectability";KP("event/onSelect",jP,{Of:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",ZP:"FlowGraphGetVariableBlock",dataTransformer:b=>["pickedMesh_"+b[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",ZP:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(b,X,P,Q,S,d,N){var a,u,w,f,O,e;const Y=S[S.length-1];Y.config=Y.config||{},Y.config.glTF=N;const D=null===(a=b.configuration)||void 0===a||null===(u=a.nodeIndex)||void 0===u?void 0:u.value[0];if(void 0===D||"number"!==typeof D)throw new Error("nodeIndex not found in configuration");const E="pickedMesh_"+D;return S[1].config.variable=E,d._userVariables[E]={className:"Mesh",id:null===N||void 0===N||null===(w=N.nodes)||void 0===w||null===(f=w[D]._babylonTransformNode)||void 0===f?void 0:f.id,uniqueId:null===N||void 0===N||null===(O=N.nodes)||void 0===O||null===(e=O[D]._babylonTransformNode)||void 0===e?void 0:e.uniqueId},S}}),(0,z.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:b=>{const X=b._babylonTransformNode;return!X||void 0===X.iu||X.iu},set:(b,X)=>{var P;null===(P=X._primitiveBabylonMeshes)||void 0===P||P.forEach((X=>{X.iu=b}))},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"iu"],type:"boolean"});class lP{constructor(b){this.name=jP,this._loader=b,this.enabled=b.isExtensionUsed(jP)}async onReady(){var b;null===(b=this._loader.ed.nodes)||void 0===b||b.forEach((b=>{var X,P,Q;null!==(X=b.extensions)&&void 0!==X&&X.KHR_node_selectability&&!1===(null===(P=b.extensions)||void 0===P?void 0:P.KHR_node_selectability.selectable)&&(null===(Q=b._babylonTransformNode)||void 0===Q||Q.getChildMeshes().forEach((b=>{b.iu=!1})))}))}dispose(){this._loader=null}}k(jP),p(jP,!0,(b=>new lP(b)));const JP="KHR_node_hoverability",cP="targetMeshPointerOver_";KP("event/onHoverIn",JP,{Of:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",ZP:"FlowGraphGetVariableBlock",dataTransformer:b=>[cP+b[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",ZP:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(b,X,P,Q,S,d,N){var a,u,w,f,O,e;const Y=S[S.length-1];Y.config=Y.config||{},Y.config.glTF=N;const D=null===(a=b.configuration)||void 0===a||null===(u=a.nodeIndex)||void 0===u?void 0:u.value[0];if(void 0===D||"number"!==typeof D)throw new Error("nodeIndex not found in configuration");const E=cP+D;return S[1].config.variable=E,d._userVariables[E]={className:"Mesh",id:null===N||void 0===N||null===(w=N.nodes)||void 0===w||null===(f=w[D]._babylonTransformNode)||void 0===f?void 0:f.id,uniqueId:null===N||void 0===N||null===(O=N.nodes)||void 0===O||null===(e=O[D]._babylonTransformNode)||void 0===e?void 0:e.uniqueId},S}});const sP="targetMeshPointerOut_";KP("event/onHoverOut",JP,{Of:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",ZP:"FlowGraphGetVariableBlock",dataTransformer:b=>[sP+b[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",ZP:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(b,X,P,Q,S,d,N){var a,u,w,f,O,e;const Y=S[S.length-1];Y.config=Y.config||{},Y.config.glTF=N;const D=null===(a=b.configuration)||void 0===a||null===(u=a.nodeIndex)||void 0===u?void 0:u.value[0];if(void 0===D||"number"!==typeof D)throw new Error("nodeIndex not found in configuration");const E=sP+D;return S[1].config.variable=E,d._userVariables[E]={className:"Mesh",id:null===N||void 0===N||null===(w=N.nodes)||void 0===w||null===(f=w[D]._babylonTransformNode)||void 0===f?void 0:f.id,uniqueId:null===N||void 0===N||null===(O=N.nodes)||void 0===O||null===(e=O[D]._babylonTransformNode)||void 0===e?void 0:e.uniqueId},S}}),(0,z.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:b=>{const X=b._babylonTransformNode;return!X||void 0===X.pointerOverDisableMeshTesting||X.pointerOverDisableMeshTesting},set:(b,X)=>{var P;null===(P=X._primitiveBabylonMeshes)||void 0===P||P.forEach((X=>{X.pointerOverDisableMeshTesting=!b}))},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class FP{constructor(b){this.name=JP,this._loader=b,this.enabled=b.isExtensionUsed(JP)}async onReady(){var b;null===(b=this._loader.ed.nodes)||void 0===b||b.forEach((b=>{var X,P,Q;null!==(X=b.extensions)&&void 0!==X&&X.KHR_node_hoverability&&!1===(null===(P=b.extensions)||void 0===P?void 0:P.KHR_node_hoverability.hoverable)&&(null===(Q=b._babylonTransformNode)||void 0===Q||Q.getChildMeshes().forEach((b=>{b.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}k(JP),p(JP,!0,(b=>new FP(b)));const MP="ExtrasAsMetadata";class RP{_assignExtras(b,X){if(X.extras&&Object.keys(X.extras).length>0){const P=b.metadata=b.metadata||{};(P.ed=P.ed||{}).extras=X.extras}}constructor(b){this.name=MP,this.enabled=!0,this._loader=b}dispose(){this._loader=null}loadNodeAsync(b,X,P){return this._loader.loadNodeAsync(b,X,(b=>{this._assignExtras(b,X),P(b)}))}loadCameraAsync(b,X,P){return this._loader.loadCameraAsync(b,X,(b=>{this._assignExtras(b,X),P(b)}))}createMaterial(b,X,P){const Q=this._loader.createMaterial(b,X,P);return this._assignExtras(Q,X),Q}}k(MP),p(MP,!1,(b=>new RP(b)));P(13683)},13560:(b,X,P)=>{"use strict";P.d(X,{c:()=>i,g:()=>A,i:()=>v,k:()=>o});var Q=P(11694),S=P(11689),d=P(13211),N=P(12319),a=P(12277),u=P(12290),w=P(11700),f=P(11732),O=P(12311),e=P(12396),Y=P(12328),D=P(11870);class E{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Oe=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.uY=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(b){this._environmentTexture=b}getNodes(){let b=[];b=b.concat(this.meshes),b=b.concat(this.lights),b=b.concat(this.cameras),b=b.concat(this.transformNodes);for(const X of this.skeletons)b=b.concat(X.bones);return b}}class t extends E{}class B{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const b=this.rootNodes;for(const Q of b)Q.dispose();b.length=0;const X=this.skeletons;for(const Q of X)Q.dispose();X.length=0;const P=this.animationGroups;for(const Q of P)Q.dispose();P.length=0}}class W extends E{constructor(b){super(),this._wasAddedToScene=!1,(b=b||f.e.LastCreatedScene)&&(this.WX=b,this.proceduralTextures=[],b.Nd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=b.getEngine().onContextRestoredObservable.add((()=>{for(const b of this.geometries)b._rebuild();for(const b of this.meshes)b._rebuild();for(const b of this.Oe)b.rebuild();for(const b of this.textures)b._rebuild()})))}_topologicalSort(b){const X=new Map;for(const N of b)X.set(N.uniqueId,N);const P={dependsOn:new Map,dependedBy:new Map};for(const N of b){const b=N.uniqueId;P.dependsOn.set(b,new Set),P.dependedBy.set(b,new Set)}for(const N of b){const b=N.uniqueId,Q=P.dependsOn.get(b);if(N instanceof O.d){const S=N.sourceMesh;X.has(S.uniqueId)&&(Q.add(S.uniqueId),P.dependedBy.get(S.uniqueId).add(b))}const S=P.dependedBy.get(b);for(const d of N.getDescendants()){const Q=d.uniqueId;if(X.has(Q)){S.add(Q);P.dependsOn.get(Q).add(b)}}}const Q=[],S=[];for(const N of b){const b=N.uniqueId;0===P.dependsOn.get(b).size&&(S.push(N),X.delete(b))}const d=S;for(;d.length>0;){const b=d.shift();Q.push(b);const S=P.dependedBy.get(b.uniqueId);for(const Q of Array.from(S.values())){const S=P.dependsOn.get(Q);S.delete(b.uniqueId),0===S.size&&X.get(Q)&&(d.push(X.get(Q)),X.delete(Q))}}return X.size>0&&(w.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),X.forEach((b=>{w.b.Error(b.name)}))),Q}_addNodeAndDescendantsToList(b,X,P,Q){if(P&&(!Q||Q(P))&&!X.has(P.uniqueId)){b.push(P),X.add(P.uniqueId);for(const S of P.getDescendants(!0))this._addNodeAndDescendantsToList(b,X,S,Q)}}_isNodeInContainer(b){return b instanceof u.e&&-1!==this.meshes.indexOf(b)||(b instanceof a.b&&-1!==this.transformNodes.indexOf(b)||(b instanceof e.e&&-1!==this.lights.indexOf(b)||b instanceof Y.c&&-1!==this.cameras.indexOf(b)))}_isValidHierarchy(){for(const b of this.meshes)if(b.parent&&!this._isNodeInContainer(b.parent))return w.b.Warn(`Node ${b.name} has a parent that is not in the container.`),!1;for(const b of this.transformNodes)if(b.parent&&!this._isNodeInContainer(b.parent))return w.b.Warn(`Node ${b.name} has a parent that is not in the container.`),!1;for(const b of this.lights)if(b.parent&&!this._isNodeInContainer(b.parent))return w.b.Warn(`Node ${b.name} has a parent that is not in the container.`),!1;for(const b of this.cameras)if(b.parent&&!this._isNodeInContainer(b.parent))return w.b.Warn(`Node ${b.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||S.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const Q={},d={},a=new B,u=[],w=[],f={doNotInstantiate:!0,...P},O=[],e=new Set;for(const S of this.transformNodes)null===S.parent&&this._addNodeAndDescendantsToList(O,e,S,f.predicate);for(const S of this.meshes)null===S.parent&&this._addNodeAndDescendantsToList(O,e,S,f.predicate);const Y=this._topologicalSort(O),D=(P,S)=>{if(((X,P)=>{if(Q[X.uniqueId]=P.uniqueId,d[P.uniqueId]=P,b&&(P.name=b(X.name)),P instanceof N.b){const b=P;if(b.morphTargetManager){const P=X.morphTargetManager;b.morphTargetManager=P.clone();for(let X=0;X<P.numTargets;X++){const S=P.getTarget(X),N=b.morphTargetManager.getTarget(X);Q[S.uniqueId]=N.uniqueId,d[N.uniqueId]=N}}}})(P,S),P.parent){const b=Q[P.parent.uniqueId],X=d[b];S.parent=X||P.parent}if(S.position&&P.position&&S.position.N(P.position),S.rotationQuaternion&&P.rotationQuaternion&&S.rotationQuaternion.N(P.rotationQuaternion),S.rotation&&P.rotation&&S.rotation.N(P.rotation),S.Fd&&P.Fd&&S.Fd.N(P.Fd),S.material){const N=S;if(N.material)if(X){const X=P.material;if(-1===w.indexOf(X)){let P=X.clone(b?b(X.name):"Clone of "+X.name);if(w.push(X),Q[X.uniqueId]=P.uniqueId,d[P.uniqueId]=P,"MultiMaterial"===X.getClassName()){const S=X;for(const X of S.Wa)X&&(P=X.clone(b?b(X.name):"Clone of "+X.name),w.push(X),Q[X.uniqueId]=P.uniqueId,d[P.uniqueId]=P);S.Wa=S.Wa.map((b=>b&&d[Q[b.uniqueId]]))}}"InstancedMesh"!==N.getClassName()&&(N.material=d[Q[X.uniqueId]])}else"MultiMaterial"===N.material.getClassName()?-1===this.WX.multiMaterials.indexOf(N.material)&&this.WX.addMultiMaterial(N.material):-1===this.WX.materials.indexOf(N.material)&&this.WX.addMaterial(N.material)}null===S.parent&&a.rootNodes.push(S)};for(const S of Y)if("InstancedMesh"===S.getClassName()){const b=S,X=b.sourceMesh,P=Q[X.uniqueId];D(b,("number"===typeof P?d[P]:X).createInstance(b.name))}else{let b=!0;"af"===S.getClassName()||"Node"===S.getClassName()||S.skeleton||!S.getTotalVertices||0===S.getTotalVertices()?b=!1:f.doNotInstantiate&&(b="function"===typeof f.doNotInstantiate?!f.doNotInstantiate(S):!f.doNotInstantiate);const X=b?S.createInstance(`instance of ${S.name}`):S.clone(`Clone of ${S.name}`,null,!0);if(!X)throw new Error(`Could not clone or instantiate node on Asset Container ${S.name}`);D(S,X)}for(const S of this.skeletons){if(f.predicate&&!f.predicate(S))continue;const X=S.clone(b?b(S.name):"Clone of "+S.name);for(const b of this.meshes)if(b.skeleton===S&&!b.isAnInstance){const P=d[Q[b.uniqueId]];if(!P||P.isAnInstance)continue;if(P.skeleton=X,-1!==u.indexOf(X))continue;u.push(X);for(const b of X.bones)b._linkedTransformNode&&(b._linkedTransformNode=d[Q[b._linkedTransformNode.uniqueId]])}a.skeletons.push(X)}for(const S of this.animationGroups){if(f.predicate&&!f.predicate(S))continue;const X=S.clone(b?b(S.name):"Clone of "+S.name,(b=>d[Q[b.uniqueId]]||b));a.animationGroups.push(X)}return a}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||S.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.WX.environmentTexture=this.environmentTexture);for(const b of this.WX._serializableComponents)b.addFromContainer(this);this.WX.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const X=[];for(const P of this.cameras)b&&!b(P)||(this.WX.addCamera(P),X.push(P));for(const P of this.lights)b&&!b(P)||(this.WX.addLight(P),X.push(P));for(const P of this.meshes)b&&!b(P)||(this.WX.rw(P),X.push(P));for(const P of this.skeletons)b&&!b(P)||this.WX.addSkeleton(P);for(const P of this.animations)b&&!b(P)||this.WX.addAnimation(P);for(const P of this.animationGroups)b&&!b(P)||this.WX.addAnimationGroup(P);for(const P of this.multiMaterials)b&&!b(P)||this.WX.addMultiMaterial(P);for(const P of this.materials)b&&!b(P)||this.WX.addMaterial(P);for(const P of this.morphTargetManagers)b&&!b(P)||this.WX.addMorphTargetManager(P);for(const P of this.geometries)b&&!b(P)||this.WX.addGeometry(P);for(const P of this.transformNodes)b&&!b(P)||(this.WX.addTransformNode(P),X.push(P));for(const P of this.actionManagers)b&&!b(P)||this.WX.addActionManager(P);for(const P of this.textures)b&&!b(P)||this.WX.addTexture(P);for(const P of this.reflectionProbes)b&&!b(P)||this.WX.addReflectionProbe(P);for(const P of X)P.parent&&-1===this.WX.getNodes().indexOf(P.parent)&&(P.setParent?P.setParent(null):P.parent=null)}removeAllFromScene(){this._isValidHierarchy()||S.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.WX.environmentTexture&&(this.WX.environmentTexture=null);for(const b of this.WX._serializableComponents)b.removeFromContainer(this)}removeFromScene(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const X of this.cameras)b&&!b(X)||this.WX.removeCamera(X);for(const X of this.lights)b&&!b(X)||this.WX.removeLight(X);for(const X of this.meshes)b&&!b(X)||this.WX.Rw(X,!0);for(const X of this.skeletons)b&&!b(X)||this.WX.removeSkeleton(X);for(const X of this.animations)b&&!b(X)||this.WX.removeAnimation(X);for(const X of this.animationGroups)b&&!b(X)||this.WX.removeAnimationGroup(X);for(const X of this.multiMaterials)b&&!b(X)||this.WX.removeMultiMaterial(X);for(const X of this.materials)b&&!b(X)||this.WX.removeMaterial(X);for(const X of this.morphTargetManagers)b&&!b(X)||this.WX.removeMorphTargetManager(X);for(const X of this.geometries)b&&!b(X)||this.WX.removeGeometry(X);for(const X of this.transformNodes)b&&!b(X)||this.WX.removeTransformNode(X);for(const X of this.actionManagers)b&&!b(X)||this.WX.removeActionManager(X);for(const X of this.textures)b&&!b(X)||this.WX.removeTexture(X);for(const X of this.reflectionProbes)b&&!b(X)||this.WX.removeReflectionProbe(X)}dispose(){const b=this.cameras.slice(0);for(const Y of b)Y.dispose();this.cameras.length=0;const X=this.lights.slice(0);for(const Y of X)Y.dispose();this.lights.length=0;const P=this.meshes.slice(0);for(const Y of P)Y.dispose();this.meshes.length=0;const Q=this.skeletons.slice(0);for(const Y of Q)Y.dispose();this.skeletons.length=0;const S=this.animationGroups.slice(0);for(const Y of S)Y.dispose();this.animationGroups.length=0;const d=this.multiMaterials.slice(0);for(const Y of d)Y.dispose();this.multiMaterials.length=0;const N=this.materials.slice(0);for(const Y of N)Y.dispose();this.materials.length=0;const a=this.geometries.slice(0);for(const Y of a)Y.dispose();this.geometries.length=0;const u=this.transformNodes.slice(0);for(const Y of u)Y.dispose();this.transformNodes.length=0;const w=this.actionManagers.slice(0);for(const Y of w)Y.dispose();this.actionManagers.length=0;const f=this.textures.slice(0);for(const Y of f)Y.dispose();this.textures.length=0;const O=this.reflectionProbes.slice(0);for(const Y of O)Y.dispose();this.reflectionProbes.length=0;const e=this.morphTargetManagers.slice(0);for(const Y of e)Y.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const Y of this.WX._serializableComponents)Y.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.WX.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(b,X,P){if(b&&X)for(const Q of b){let b=!0;if(P)for(const X of P)if(Q===X){b=!1;break}b&&(X.push(Q),Q._parentContainer=this)}}moveAllFromScene(b){this._wasAddedToScene=!1,void 0===b&&(b=new t);for(const X in this)Object.prototype.hasOwnProperty.call(this,X)&&(this[X]=this[X]||("_environmentTexture"===X?null:[]),this._moveAssets(this.WX[X],this[X],b[X]));this.environmentTexture=this.WX.environmentTexture,this.removeAllFromScene()}createRootMesh(){const b=new N.b("assetContainerRootMesh",this.WX);for(const X of this.meshes)X.parent||b.addChild(X);return this.meshes.unshift(b),b}mergeAnimationsTo(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.e.LastCreatedScene,X=arguments.length>1?arguments[1]:void 0,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!b)return w.b.Error("No scene available to merge animations to"),[];const Q=P||(X=>{let P=null;const Q=X.animations.length?X.animations[0].targetProperty:"",S=X.name.split(".").join("").split("_primitive")[0];switch(Q){case"position":case"rotationQuaternion":P=b.getTransformNodeByName(X.name)||b.getTransformNodeByName(S);break;case"influence":P=b.getMorphTargetByName(X.name)||b.getMorphTargetByName(S);break;default:P=b.getNodeByName(X.name)||b.getNodeByName(S)}return P}),S=this.getNodes();for(const a of S){const b=Q(a);if(null!==b){for(const X of a.animations){const P=b.animations.filter((b=>b.targetProperty===X.targetProperty));for(const X of P){const P=b.animations.indexOf(X,0);P>-1&&b.animations.splice(P,1)}}b.animations=b.animations.concat(a.animations)}}const d=[],N=this.animationGroups.slice();for(const a of N){d.push(a.clone(a.name,Q));for(const b of a.animatables)b.stop()}for(const a of X){const X=Q(a.target);X&&(b.beginAnimation(X,a.fromFrame,a.toFrame,a.loopAnimation,a.speedRatio,a.onAnimationEnd?a.onAnimationEnd:void 0,void 0,!0,void 0,a.onAnimationLoop?a.onAnimationLoop:void 0),b.stopAnimation(a.target))}return d}populateRootNodes(){this.rootNodes.length=0;for(const b of this.meshes)b.parent||-1!==this.rootNodes.indexOf(b)||this.rootNodes.push(b);for(const b of this.transformNodes)b.parent||-1!==this.rootNodes.indexOf(b)||this.rootNodes.push(b);for(const b of this.lights)b.parent||-1!==this.rootNodes.indexOf(b)||this.rootNodes.push(b);for(const b of this.cameras)b.parent||-1!==this.rootNodes.indexOf(b)||this.rootNodes.push(b)}addAllAssetsToContainer(b){if(!b)return;const X=[],P=new Set;for(X.push(b);X.length>0;){const b=X.pop();if(b instanceof N.b?(b.Ud&&-1===this.geometries.indexOf(b.Ud)&&this.geometries.push(b.Ud),this.meshes.push(b)):b instanceof O.d?this.meshes.push(b):b instanceof a.b?this.transformNodes.push(b):b instanceof e.e?this.lights.push(b):b instanceof Y.c&&this.cameras.push(b),b instanceof u.e){if(b.material&&-1===this.materials.indexOf(b.material)){this.materials.push(b.material);for(const X of b.material.getActiveTextures())-1===this.textures.indexOf(X)&&this.textures.push(X)}b.skeleton&&-1===this.skeletons.indexOf(b.skeleton)&&this.skeletons.push(b.skeleton),b.morphTargetManager&&-1===this.morphTargetManagers.indexOf(b.morphTargetManager)&&this.morphTargetManagers.push(b.morphTargetManager)}for(const Q of b.getChildren())P.has(Q)||X.push(Q);P.add(b)}this.populateRootNodes()}_getByTags(b,X,P){if(void 0===X)return b;const Q=[];for(const S in b){const d=b[S];D.d&&D.d.MatchesQuery(d,X)&&(!P||P(d))&&Q.push(d)}return Q}getMeshesByTags(b,X){return this._getByTags(this.meshes,b,X)}getCamerasByTags(b,X){return this._getByTags(this.cameras,b,X)}getLightsByTags(b,X){return this._getByTags(this.lights,b,X)}getMaterialsByTags(b,X){return this._getByTags(this.materials,b,X).concat(this._getByTags(this.multiMaterials,b,X))}getTransformNodesByTags(b,X){return this._getByTags(this.transformNodes,b,X)}}var n=P(11745);class y{constructor(b){this.byteOffset=0,this.buffer=b}async loadAsync(b){const X=await this.buffer.readAsync(this.byteOffset,b);this._dataView=new DataView(X.buffer,X.byteOffset,X.byteLength),this._dataByteOffset=0}readUint32(){const b=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,b}readUint8Array(b){const X=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,b);return this._dataByteOffset+=b,this.byteOffset+=b,X}readString(b){return(0,n.i)(this.readUint8Array(b))}skipBytes(b){this._dataByteOffset+=b,this.byteOffset+=b}}var h=P(13566);const L="Z2xURg",Z={name:"ed",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:b=>-1!==b.indexOf("asset")&&-1!==b.indexOf("version")||b.startsWith("data:base64,"+L)||b.startsWith("data:;base64,"+L)||b.startsWith("data:application/octet-stream;base64,"+L)||b.startsWith("data:model/gltf-binary;base64,"+L)};var v,A,o,K=P(11738),T=P(11740);function q(b,X,P){try{return Promise.resolve(new Uint8Array(b,X,P))}catch(Q){return Promise.reject(Q)}}!function(b){b[b.AUTO=0]="AUTO",b[b.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(v||(v={})),function(b){b[b.NONE=0]="NONE",b[b.FIRST=1]="FIRST",b[b.ALL=2]="ALL"}(A||(A={})),function(b){b[b.LOADING=0]="LOADING",b[b.READY=1]="READY",b[b.COMPLETE=2]="COMPLETE"}(o||(o={}));class V{constructor(){this.coordinateSystemMode=v.AUTO,this.animationStartMode=A.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=b=>Promise.resolve(b),this.extensionOptions={}}N(b){b&&(this.onParsed=b.onParsed,this.coordinateSystemMode=b.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=b.animationStartMode??this.animationStartMode,this.loadNodeAnimations=b.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=b.loadSkins??this.loadSkins,this.loadMorphTargets=b.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=b.compileMaterials??this.compileMaterials,this.useClipPlane=b.useClipPlane??this.useClipPlane,this.compileShadowGenerators=b.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=b.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=b.useRangeRequests??this.useRangeRequests,this.createInstances=b.createInstances??this.createInstances,this.alwaysComputeBoundingBox=b.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=b.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=b.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=b.skipMaterials??this.skipMaterials,this.useSRGBBuffers=b.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=b.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=b.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=b.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=b.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=b.customRootNode,this.onMeshLoaded=b.onMeshLoaded,this.onSkinLoaded=b.onSkinLoaded,this.onTextureLoaded=b.onTextureLoaded,this.onMaterialLoaded=b.onMaterialLoaded,this.onCameraLoaded=b.onCameraLoaded,this.extensionOptions=b.extensionOptions??this.extensionOptions)}}class i extends V{constructor(b){super(),this.onParsedObservable=new Q.d,this.onMeshLoadedObservable=new Q.d,this.onSkinLoadedObservable=new Q.d,this.onTextureLoadedObservable=new Q.d,this.onMaterialLoadedObservable=new Q.d,this.onCameraLoadedObservable=new Q.d,this.onCompleteObservable=new Q.d,this.onErrorObservable=new Q.d,this.Nd=new Q.d,this.onExtensionLoadedObservable=new Q.d,this.validate=!1,this.onValidatedObservable=new Q.d,this._loader=null,this._state=null,this._requests=new Array,this.name=Z.name,this.extensions=Z.extensions,this.onLoaderStateChangedObservable=new Q.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.N(b)}set onParsed(b){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),b&&(this._onParsedObserver=this.onParsedObservable.add(b))}set onMeshLoaded(b){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),b&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(b))}set onSkinLoaded(b){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),b&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((X=>b(X.node,X.skinnedNode))))}set onTextureLoaded(b){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),b&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(b))}set onMaterialLoaded(b){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),b&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(b))}set onCameraLoaded(b){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),b&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(b))}set onComplete(b){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(b)}set onError(b){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(b)}set onDispose(b){this._onDisposeObserver&&this.Nd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Nd.add(b)}set onExtensionLoaded(b){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(b)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(b){this._loggingEnabled!==b&&(this._loggingEnabled=b,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(b){this._capturePerformanceCounters!==b&&(this._capturePerformanceCounters=b,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(b){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(b)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const b of this._requests)b.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=b=>Promise.resolve(b),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Nd.notifyObservers(void 0),this.Nd.clear()}loadFile(b,X,P,d,N,a,u,f){if(ArrayBuffer.isView(X))return this._loadBinary(b,X,P,d,u,f),null;this._progressCallback=N;const O=X.name||S.Tools.GetFilename(X);if(a){if(this.useRangeRequests){this.validate&&w.b.Warn("glTF validation is not supported when range requests are enabled");const P={abort:()=>{},onCompleteObservable:new Q.d},S={readAsync:(P,Q)=>new Promise(((S,d)=>{this._loadFile(b,X,(b=>{S(new Uint8Array(b))}),!0,(b=>{d(b)}),(b=>{b.setRequestHeader("Range",`bytes=${P}-${P+Q-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new y(S)).then((b=>{P.onCompleteObservable.notifyObservers(P),d(b)}),u?b=>u(void 0,b):void 0),P}return this._loadFile(b,X,(X=>{this._validate(b,new Uint8Array(X,0,X.byteLength),P,O),this._unpackBinaryAsync(new y({readAsync:(b,P)=>q(X,b,P),byteLength:X.byteLength})).then((b=>{d(b)}),u?b=>u(void 0,b):void 0)}),!0,u)}return this._loadFile(b,X,(X=>{try{this._validate(b,X,P,O),d({json:this._parseJson(X)})}catch{u&&u()}}),!1,u)}_loadBinary(b,X,P,Q,S,d){this._validate(b,new Uint8Array(X.buffer,X.byteOffset,X.byteLength),P,d),this._unpackBinaryAsync(new y({readAsync:(b,P)=>function(b,X,P){try{if(X<0||X>=b.byteLength)throw new RangeError("Offset is out of range.");if(X+P>b.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(b.buffer,b.byteOffset+X,P))}catch(Q){return Promise.reject(Q)}}(X,b,P),byteLength:X.byteLength})).then((b=>{Q(b)}),S?b=>S(void 0,b):void 0)}importMeshAsync(b,X,P,Q,S,d){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(P),this.onParsedObservable.clear(),this._log(`Loading ${d||""}`),this._loader=this._getLoader(P),this._loader.importMeshAsync(b,X,null,P,Q,S,d))))}loadAsync(b,X,P,Q,S){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(X),this.onParsedObservable.clear(),this._log(`Loading ${S||""}`),this._loader=this._getLoader(X),this._loader.loadAsync(b,X,P,Q,S))))}loadAssetContainerAsync(b,X,P,Q,S){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(X),this.onParsedObservable.clear(),this._log(`Loading ${S||""}`),this._loader=this._getLoader(X);const d=new W(b),N=[];this.onMaterialLoadedObservable.add((b=>{N.push(b)}));const a=[];this.onTextureLoadedObservable.add((b=>{a.push(b)}));const u=[];this.onCameraLoadedObservable.add((b=>{u.push(b)}));const w=[];return this.onMeshLoadedObservable.add((b=>{b.morphTargetManager&&w.push(b.morphTargetManager)})),this._loader.importMeshAsync(null,b,d,X,P,Q,S).then((b=>(Array.prototype.push.apply(d.geometries,b.geometries),Array.prototype.push.apply(d.meshes,b.meshes),Array.prototype.push.apply(d.Oe,b.Oe),Array.prototype.push.apply(d.skeletons,b.skeletons),Array.prototype.push.apply(d.animationGroups,b.animationGroups),Array.prototype.push.apply(d.materials,N),Array.prototype.push.apply(d.textures,a),Array.prototype.push.apply(d.lights,b.lights),Array.prototype.push.apply(d.transformNodes,b.transformNodes),Array.prototype.push.apply(d.cameras,u),Array.prototype.push.apply(d.morphTargetManagers,w),d)))}))}canDirectLoad(b){return Z.canDirectLoad(b)}directLoad(b,X){if(X.startsWith("base64,"+L)||X.startsWith(";base64,"+L)||X.startsWith("application/octet-stream;base64,"+L)||X.startsWith("model/gltf-binary;base64,"+L)){const P=(0,K.c)(X);return this._validate(b,new Uint8Array(P,0,P.byteLength)),this._unpackBinaryAsync(new y({readAsync:(b,X)=>q(P,b,X),byteLength:P.byteLength}))}return this._validate(b,X),Promise.resolve({json:this._parseJson(X)})}createPlugin(b){return new i(b[Z.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((b,X)=>{this.onCompleteObservable.addOnce((()=>{b()})),this.onErrorObservable.addOnce((b=>{X(b)}))}))}_setState(b){this._state!==b&&(this._state=b,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(o[this._state]))}_loadFile(b,X,P,Q,S,d){const N=b._loadFile(X,P,(b=>{this._onProgress(b,N)}),!0,Q,S,d);return N.onCompleteObservable.add((()=>{N._lengthComputable=!0,N._total=N._loaded})),this._requests.push(N),N}_onProgress(b,X){if(!this._progressCallback)return;X._lengthComputable=b.lengthComputable,X._loaded=b.loaded,X._total=b.total;let P=!0,Q=0,S=0;for(const d of this._requests){if(void 0===d._lengthComputable||void 0===d._loaded||void 0===d._total)return;P=P&&d._lengthComputable,Q+=d._loaded,S+=d._total}this._progressCallback({lengthComputable:P,loaded:Q,total:P?S:0})}_validate(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),h.e.ValidateAsync(X,P,Q,(X=>this.preprocessUrlAsync(P+X).then((X=>b._loadFileAsync(X,void 0,!0,!0).then((b=>new Uint8Array(b,0,b.byteLength))))))).then((b=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(b),this.onValidatedObservable.clear()}),(b=>{this._endPerformanceCounter("Validate JSON"),S.Tools.Warn(`Failed to validate: ${b.message}`),this.onValidatedObservable.clear()})))}_getLoader(b){const X=b.json.asset||{};this._log(`Asset version: ${X.version}`),X.minVersion&&this._log(`Asset minimum version: ${X.minVersion}`),X.generator&&this._log(`Asset generator: ${X.generator}`);const P=i._parseVersion(X.version);if(!P)throw new Error("Invalid version: "+X.version);if(void 0!==X.minVersion){const b=i._parseVersion(X.minVersion);if(!b)throw new Error("Invalid minimum version: "+X.minVersion);if(i._compareVersion(b,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+X.minVersion)}const Q={1:i._CreateGLTF1Loader,2:i._CreateGLTF2Loader}[P.major];if(!Q)throw new Error("Unsupported version: "+X.version);return Q(this)}_parseJson(b){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${b.length}`);const X=JSON.parse(b);return this._endPerformanceCounter("Parse JSON"),X}_unpackBinaryAsync(b){return this._startPerformanceCounter("Unpack Binary"),b.loadAsync(20).then((()=>{const X=b.readUint32();if(1179937895!==X)throw new T.h("Unexpected magic: "+X,T.e.GLTFLoaderUnexpectedMagicError);const P=b.readUint32();this.loggingEnabled&&this._log(`Binary version: ${P}`);const Q=b.readUint32();let S;switch(this.useRangeRequests||Q===b.buffer.byteLength||w.b.Warn(`Length in header does not match actual data length: ${Q} != ${b.buffer.byteLength}`),P){case 1:S=this._unpackBinaryV1Async(b,Q);break;case 2:S=this._unpackBinaryV2Async(b,Q);break;default:throw new Error("Unsupported version: "+P)}return this._endPerformanceCounter("Unpack Binary"),S}))}_unpackBinaryV1Async(b,X){const P=b.readUint32(),Q=b.readUint32();if(0!==Q)throw new Error(`Unexpected content format: ${Q}`);const S=X-b.byteOffset,d={json:this._parseJson(b.readString(P)),bin:null};if(0!==S){const X=b.byteOffset;d.bin={readAsync:(P,Q)=>b.buffer.readAsync(X+P,Q),byteLength:S}}return Promise.resolve(d)}_unpackBinaryV2Async(b,X){const P=1313821514,Q=5130562,S=b.readUint32();if(b.readUint32()!==P)throw new Error("First chunk format is not JSON");return b.byteOffset+S===X?b.loadAsync(S).then((()=>({json:this._parseJson(b.readString(S)),bin:null}))):b.loadAsync(S+8).then((()=>{const d={json:this._parseJson(b.readString(S)),bin:null},N=()=>{const S=b.readUint32();switch(b.readUint32()){case P:throw new Error("Unexpected JSON chunk");case Q:{const X=b.byteOffset;d.bin={readAsync:(P,Q)=>b.buffer.readAsync(X+P,Q),byteLength:S},b.skipBytes(S);break}default:b.skipBytes(S)}return b.byteOffset!==X?b.loadAsync(8).then(N):Promise.resolve(d)};return N()}))}static _parseVersion(b){if("1.0"===b||"1.0.1"===b)return{major:1,minor:0};const X=(b+"").match(/^(\d+)\.(\d+)/);return X?{major:parseInt(X[1]),minor:parseInt(X[2])}:null}static _compareVersion(b,X){return b.major>X.major?1:b.major<X.major?-1:b.minor>X.minor?1:b.minor<X.minor?-1:0}_logOpen(b){this._log(b),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(b){const X=i._logSpaces.substring(0,2*this._logIndentLevel);w.b.Log(`${X}${b}`)}_logDisabled(b){}_startPerformanceCounterEnabled(b){S.Tools.StartPerformanceCounter(b)}_startPerformanceCounterDisabled(b){}_endPerformanceCounterEnabled(b){S.Tools.EndPerformanceCounter(b)}_endPerformanceCounterDisabled(b){}}i.IncrementalLoading=!0,i.HomogeneousCoordinates=!1,i._logSpaces="                                ",(0,d.d)(new i)},13566:(b,X,P)=>{"use strict";P.d(X,{e:()=>N});var Q=P(11689);function S(b,X,P,Q){const S={externalResourceFunction:Q};return P&&(S.uri="file:"===X?P:X+P),ArrayBuffer.isView(b)?GLTFValidator.validateBytes(b,S):GLTFValidator.validateString(b,S)}function d(){const b=[];onmessage=X=>{const P=X.data;switch(P.id){case"init":importScripts(P.url);break;case"validate":S(P.data,P.rootUrl,P.fileName,(X=>new Promise(((P,Q)=>{const S=b.length;b.push({resolve:P,reject:Q}),postMessage({id:"getExternalResource",index:S,uri:X})})))).then((b=>{postMessage({id:"validate.resolve",value:b})}),(b=>{postMessage({id:"validate.reject",reason:b})}));break;case"getExternalResource.resolve":b[P.index].resolve(P.value);break;case"getExternalResource.reject":b[P.index].reject(P.reason)}}}class N{static ValidateAsync(b,X,P,N){return"function"===typeof Worker?new Promise(((a,u)=>{const w=`${S}(${d})()`,f=URL.createObjectURL(new Blob([w],{type:"application/javascript"})),O=new Worker(f),e=b=>{O.removeEventListener("error",e),O.removeEventListener("message",Y),u(b)},Y=b=>{const X=b.data;switch(X.id){case"getExternalResource":N(X.uri).then((b=>{O.postMessage({id:"getExternalResource.resolve",index:X.index,value:b},[b.buffer])}),(b=>{O.postMessage({id:"getExternalResource.reject",index:X.index,reason:b})}));break;case"validate.resolve":O.removeEventListener("error",e),O.removeEventListener("message",Y),a(X.value),O.terminate();break;case"validate.reject":O.removeEventListener("error",e),O.removeEventListener("message",Y),u(X.reason),O.terminate()}};if(O.addEventListener("error",e),O.addEventListener("message",Y),O.postMessage({id:"init",url:Q.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(b)){const Q=b.slice();O.postMessage({id:"validate",data:Q,rootUrl:X,fileName:P},[Q.buffer])}else O.postMessage({id:"validate",data:b,rootUrl:X,fileName:P})})):(this._LoadScriptPromise||(this._LoadScriptPromise=Q.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>S(b,X,P,N))))}}N.Configuration={url:`${Q.Tools._DefaultCdnUrl}/gltf_validator.js`}},14116:(b,X,P)=>{"use strict";P.d(X,{c:()=>Z});var Q=P(11822),S=P(11825),d=P(11862),N=P(11834),a=P(12240),u=P(12169),w=P(11912),f=P(12093),O=P(11802),e=P(11765);P(13335),P(13243),P(13257),P(13245),P(13263),P(13267),P(13272);const Y="imageProcessingCompatibility",D="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";e.c.IncludesShadersStore[Y]||(e.c.IncludesShadersStore[Y]=D);const E="skyPixelShader",t="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";e.c.ShadersStore[E]||(e.c.ShadersStore[E]=t);P(13352),P(13280),P(13289),P(13302),P(13294);const B="skyVertexShader",W="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";e.c.ShadersStore[B]||(e.c.ShadersStore[B]=W);var n=P(12163),y=P(12229),h=P(12221);class L extends a.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class Z extends u.d{constructor(b,X){super(b,X),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new N.tX(0,100,0),this.useSunPosition=!1,this.cameraOffset=N.tX.Zero(),this.up=N.tX.Up(),this.dithering=!1,this._cameraPosition=N.tX.Zero(),this._skyOrientation=new N.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(b,X){const P=X._drawWrapper;if(this.isFrozen&&P.effect&&P._wasPreviouslyReady)return!0;X.materialDefines||(X.materialDefines=new L);const Q=X.materialDefines,S=this.Ab();if(this._isReadyForSubMesh(X))return!0;if((0,h.ab)(b,S,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,Q),(0,h.O)(b,Q,!0,!1),Q.IMAGEPROCESSINGPOSTPROCESS!==S.imageProcessingConfiguration.applyByPostProcess&&Q.markAsMiscDirty(),Q.DITHER!==this.dithering&&Q.markAsMiscDirty(),Q.isDirty){Q.markAsProcessed(),S.resetCachedMaterial();const b=new n.c;Q.FOG&&b.addFallback(1,"FOG"),Q.IMAGEPROCESSINGPOSTPROCESS=S.imageProcessingConfiguration.applyByPostProcess,Q.DITHER=this.dithering;const P=[w.g.PositionKind];Q.VERTEXCOLOR&&P.push(w.g.ColorKind);const d="sky",N=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,y.e)(N);const a=Q.toString();X.setEffect(S.getEngine().createEffect(d,P,N,[],a,b,this.onCompiled,this.onError),Q,this._materialContext)}return!(!X.effect||!X.effect.isReady())&&(Q._renderId=S.getRenderId(),P._wasPreviouslyReady=!0,!0)}bindForSubMesh(b,X,P){const Q=this.Ab(),S=P.materialDefines;if(!S)return;const d=P.effect;if(!d)return;this._activeEffect=d,this.bindOnlyWorldMatrix(b),this._activeEffect.setMatrix("viewProjection",Q.getTransformMatrix()),this._mustRebind(Q,d,P)&&((0,y.i)(d,this,Q),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,h.k)(S,d,Q)),Q.fogEnabled&&X.applyFog&&Q.fogMode!==f.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",Q.getViewMatrix()),(0,h.g)(Q,X,this._activeEffect);const a=Q.activeCamera;if(a){const b=a.getWorldMatrix();this._cameraPosition.x=b.m[12],this._cameraPosition.y=b.m[13],this._cameraPosition.z=b.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const b=Math.PI*(this.inclination-.5),X=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(X)*Math.cos(b),this.sunPosition.y=this.distance*Math.sin(-b),this.sunPosition.z=this.distance*Math.sin(X)*Math.cos(b),N.Quaternion.FromUnitVectorsToRef(N.tX.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(X,this._activeEffect,P)}getAnimatables(){return[]}dispose(b){super.dispose(b)}clone(b){return d.b.Clone((()=>new Z(b,this.Ab())),this)}serialize(){const b=super.serialize();return b.customType="BABYLON.SkyMaterial",b}getClassName(){return"SkyMaterial"}static Parse(b,X,P){return d.b.Parse((()=>new Z(b.name,X)),b,X,P)}}(0,Q.b)([(0,S.E)()],Z.prototype,"luminance",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"turbidity",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"rayleigh",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"mieCoefficient",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"mieDirectionalG",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"distance",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"inclination",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"azimuth",void 0),(0,Q.b)([(0,S.A)()],Z.prototype,"sunPosition",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"useSunPosition",void 0),(0,Q.b)([(0,S.A)()],Z.prototype,"cameraOffset",void 0),(0,Q.b)([(0,S.A)()],Z.prototype,"up",void 0),(0,Q.b)([(0,S.E)()],Z.prototype,"dithering",void 0),(0,O.h)("BABYLON.SkyMaterial",Z)},12555:(b,X,P)=>{"use strict";function Q(b,X){X.headers=b.headers||{},X.statusMessage=b.statusText,X.statusCode=b.status,X.data=b.response}function S(b,X,P){return new Promise((function(S,d){P=P||{};var N,a,u,w=new XMLHttpRequest,f=P.body,O=P.headers||{};for(N in P.timeout&&(w.timeout=P.timeout),w.ontimeout=w.onerror=function(b){b.timeout="timeout"==b.type,d(b)},w.open(b,X.href||X),w.onload=function(){for(u=w.getAllResponseHeaders().trim().split(/[\r\n]+/),Q(w,w);a=u.shift();)a=a.split(": "),w.headers[a.shift().toLowerCase()]=a.join(": ");if((a=w.headers["content-type"])&&~a.indexOf("application/json"))try{w.data=JSON.parse(w.data,P.reviver)}catch(b){return Q(w,b),d(b)}(w.status>=400?d:S)(w)},typeof FormData<"u"&&f instanceof FormData||f&&"object"==typeof f&&(O["content-type"]="application/json",f=JSON.stringify(f)),w.withCredentials=!!P.withCredentials,O)w.setRequestHeader(N,O[N]);w.send(f)}))}P.r(X),P.d(X,{del:()=>u,get:()=>d,patch:()=>a,post:()=>N,put:()=>w,send:()=>S});var d=S.bind(S,"GET"),N=S.bind(S,"POST"),a=S.bind(S,"PATCH"),u=S.bind(S,"DELETE"),w=S.bind(S,"PUT")},14214:(b,X,P)=>{"use strict";P.d(X,{b:()=>O});const Q=.5*(Math.sqrt(3)-1),S=(3-Math.sqrt(3))/6,d=1/3,N=1/6,a=(Math.sqrt(5)-1)/4,u=(5-Math.sqrt(5))/20,w=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),f=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const O=class{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const X="function"==typeof b?b:function(b){let X=0,P=0,Q=0,S=1;const d=function(){let b=4022871197;return function(X){X=X.toString();for(let P=0;P<X.length;P++){b+=X.charCodeAt(P);let Q=.02519603282416938*b;b=Q>>>0,Q-=b,Q*=b,b=Q>>>0,Q-=b,b+=4294967296*Q}return 2.3283064365386963e-10*(b>>>0)}}();X=d(" "),P=d(" "),Q=d(" "),X-=d(b),X<0&&(X+=1);P-=d(b),P<0&&(P+=1);Q-=d(b),Q<0&&(Q+=1);return function(){const b=2091639*X+2.3283064365386963e-10*S;return X=P,P=Q,Q=b-(S=0|b)}}(b);this.p=function(b){const X=new Uint8Array(256);for(let P=0;P<256;P++)X[P]=P;for(let P=0;P<255;P++){const Q=P+~~(b()*(256-P)),S=X[P];X[P]=X[Q],X[Q]=S}return X}(X),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let P=0;P<512;P++)this.perm[P]=this.p[255&P],this.permMod12[P]=this.perm[P]%12}noise2D(b,X){const P=this.permMod12,d=this.perm;let N=0,a=0,u=0;const f=(b+X)*Q,O=Math.floor(b+f),e=Math.floor(X+f),Y=(O+e)*S,D=b-(O-Y),E=X-(e-Y);let t,B;D>E?(t=1,B=0):(t=0,B=1);const W=D-t+S,n=E-B+S,y=D-1+2*S,h=E-1+2*S,L=255&O,Z=255&e;let v=.5-D*D-E*E;if(v>=0){const b=3*P[L+d[Z]];v*=v,N=v*v*(w[b]*D+w[b+1]*E)}let A=.5-W*W-n*n;if(A>=0){const b=3*P[L+t+d[Z+B]];A*=A,a=A*A*(w[b]*W+w[b+1]*n)}let o=.5-y*y-h*h;if(o>=0){const b=3*P[L+1+d[Z+1]];o*=o,u=o*o*(w[b]*y+w[b+1]*h)}return 70*(N+a+u)}noise3D(b,X,P){const Q=this.permMod12,S=this.perm;let a,u,f,O;const e=(b+X+P)*d,Y=Math.floor(b+e),D=Math.floor(X+e),E=Math.floor(P+e),t=(Y+D+E)*N,B=b-(Y-t),W=X-(D-t),n=P-(E-t);let y,h,L,Z,v,A;B>=W?W>=n?(y=1,h=0,L=0,Z=1,v=1,A=0):B>=n?(y=1,h=0,L=0,Z=1,v=0,A=1):(y=0,h=0,L=1,Z=1,v=0,A=1):W<n?(y=0,h=0,L=1,Z=0,v=1,A=1):B<n?(y=0,h=1,L=0,Z=0,v=1,A=1):(y=0,h=1,L=0,Z=1,v=1,A=0);const o=B-y+N,K=W-h+N,T=n-L+N,q=B-Z+2*N,V=W-v+2*N,i=n-A+2*N,x=B-1+.5,H=W-1+.5,C=n-1+.5,p=255&Y,k=255&D,z=255&E;let U=.6-B*B-W*W-n*n;if(U<0)a=0;else{const b=3*Q[p+S[k+S[z]]];U*=U,a=U*U*(w[b]*B+w[b+1]*W+w[b+2]*n)}let g=.6-o*o-K*K-T*T;if(g<0)u=0;else{const b=3*Q[p+y+S[k+h+S[z+L]]];g*=g,u=g*g*(w[b]*o+w[b+1]*K+w[b+2]*T)}let j=.6-q*q-V*V-i*i;if(j<0)f=0;else{const b=3*Q[p+Z+S[k+v+S[z+A]]];j*=j,f=j*j*(w[b]*q+w[b+1]*V+w[b+2]*i)}let l=.6-x*x-H*H-C*C;if(l<0)O=0;else{const b=3*Q[p+1+S[k+1+S[z+1]]];l*=l,O=l*l*(w[b]*x+w[b+1]*H+w[b+2]*C)}return 32*(a+u+f+O)}noise4D(b,X,P,Q){const S=this.perm;let d,N,w,O,e;const Y=(b+X+P+Q)*a,D=Math.floor(b+Y),E=Math.floor(X+Y),t=Math.floor(P+Y),B=Math.floor(Q+Y),W=(D+E+t+B)*u,n=b-(D-W),y=X-(E-W),h=P-(t-W),L=Q-(B-W);let Z=0,v=0,A=0,o=0;n>y?Z++:v++,n>h?Z++:A++,n>L?Z++:o++,y>h?v++:A++,y>L?v++:o++,h>L?A++:o++;const K=Z>=3?1:0,T=v>=3?1:0,q=A>=3?1:0,V=o>=3?1:0,i=Z>=2?1:0,x=v>=2?1:0,H=A>=2?1:0,C=o>=2?1:0,p=Z>=1?1:0,k=v>=1?1:0,z=A>=1?1:0,U=o>=1?1:0,g=n-K+u,j=y-T+u,l=h-q+u,J=L-V+u,c=n-i+2*u,s=y-x+2*u,F=h-H+2*u,M=L-C+2*u,R=n-p+3*u,r=y-k+3*u,I=h-z+3*u,G=L-U+3*u,mb=n-1+4*u,bb=y-1+4*u,Xb=h-1+4*u,Pb=L-1+4*u,Qb=255&D,Sb=255&E,db=255&t,Nb=255&B;let ab=.6-n*n-y*y-h*h-L*L;if(ab<0)d=0;else{const b=S[Qb+S[Sb+S[db+S[Nb]]]]%32*4;ab*=ab,d=ab*ab*(f[b]*n+f[b+1]*y+f[b+2]*h+f[b+3]*L)}let ub=.6-g*g-j*j-l*l-J*J;if(ub<0)N=0;else{const b=S[Qb+K+S[Sb+T+S[db+q+S[Nb+V]]]]%32*4;ub*=ub,N=ub*ub*(f[b]*g+f[b+1]*j+f[b+2]*l+f[b+3]*J)}let wb=.6-c*c-s*s-F*F-M*M;if(wb<0)w=0;else{const b=S[Qb+i+S[Sb+x+S[db+H+S[Nb+C]]]]%32*4;wb*=wb,w=wb*wb*(f[b]*c+f[b+1]*s+f[b+2]*F+f[b+3]*M)}let fb=.6-R*R-r*r-I*I-G*G;if(fb<0)O=0;else{const b=S[Qb+p+S[Sb+k+S[db+z+S[Nb+U]]]]%32*4;fb*=fb,O=fb*fb*(f[b]*R+f[b+1]*r+f[b+2]*I+f[b+3]*G)}let Ob=.6-mb*mb-bb*bb-Xb*Xb-Pb*Pb;if(Ob<0)e=0;else{const b=S[Qb+1+S[Sb+1+S[db+1+S[Nb+1]]]]%32*4;Ob*=Ob,e=Ob*Ob*(f[b]*mb+f[b+1]*bb+f[b+2]*Xb+f[b+3]*Pb)}return 27*(d+N+w+O+e)}}}}]);