/*! For license information please see xy4hv.32.7cfc98b2.chunk.js.LICENSE.txt */
(self.fjf2z1c8il8=self.fjf2z1c8il8||[]).push([[32],{14514:(g,i,a)=>{"use strict";var n=a(14522),L=a(14527),d=a(14534);a.g.__TYPEDARRAY_POOL||(a.g.__TYPEDARRAY_POOL={UINT8:L([32,0]),UINT16:L([32,0]),UINT32:L([32,0]),INT8:L([32,0]),INT16:L([32,0]),INT32:L([32,0]),FLOAT:L([32,0]),DOUBLE:L([32,0]),DATA:L([32,0]),UINT8C:L([32,0]),BUFFER:L([32,0])});var b="undefined"!==typeof Uint8ClampedArray,k=a.g.__TYPEDARRAY_POOL;k.UINT8C||(k.UINT8C=L([32,0])),k.BUFFER||(k.BUFFER=L([32,0]));var e=k.DATA,N=k.BUFFER;function F(g){if(g){var i=g.length||g.byteLength,a=n.log2(i);e[a].push(g)}}function I(g){g=n.nextPow2(g);var i=n.log2(g),a=e[i];return a.length>0?a.pop():new ArrayBuffer(g)}function j(g){return new Uint8Array(I(g),0,g)}function y(g){return new Uint16Array(I(2*g),0,g)}function B(g){return new Uint32Array(I(4*g),0,g)}function c(g){return new Int8Array(I(g),0,g)}function D(g){return new Int16Array(I(2*g),0,g)}function p(g){return new Int32Array(I(4*g),0,g)}function R(g){return new Float32Array(I(4*g),0,g)}function x(g){return new Float64Array(I(8*g),0,g)}function E(g){return b?new Uint8ClampedArray(I(g),0,g):j(g)}function X(g){return new DataView(I(g),0,g)}i.free=function(g){if(d(g))N[n.log2(g.length)].push(g);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(g)&&(g=g.buffer),!g)return;var i=g.length||g.byteLength,a=0|n.log2(i);e[a].push(g)}},i.freeUint8=i.freeUint16=i.freeUint32=i.freeInt8=i.freeInt16=i.freeInt32=i.freeFloat32=i.freeFloat=i.freeFloat64=i.freeDouble=i.freeUint8Clamped=i.freeDataView=function(g){F(g.buffer)},i.freeArrayBuffer=F,i.freeBuffer=function(g){N[n.log2(g.length)].push(g)},i.malloc=function(g,i){if(void 0===i||"arraybuffer"===i)return I(g);switch(i){case"uint8":return j(g);case"uint16":return y(g);case"uint32":return B(g);case"int8":return c(g);case"int16":return D(g);case"int32":return p(g);case"float":case"float32":return R(g);case"double":case"float64":return x(g);case"uint8_clamped":return E(g);case"buffer":throw"Buffer not supported";case"data":case"dataview":return X(g);default:return null}return null},i.mallocArrayBuffer=I,i.mallocUint8=j,i.mallocUint16=y,i.mallocUint32=B,i.mallocInt8=c,i.mallocInt16=D,i.mallocInt32=p,i.mallocFloat32=i.mallocFloat=R,i.mallocFloat64=i.mallocDouble=x,i.mallocUint8Clamped=E,i.mallocDataView=X,i.clearCache=function(){for(var g=0;g<32;++g)k.UINT8[g].length=0,k.UINT16[g].length=0,k.UINT32[g].length=0,k.INT8[g].length=0,k.INT16[g].length=0,k.INT32[g].length=0,k.FLOAT[g].length=0,k.DOUBLE[g].length=0,k.UINT8C[g].length=0,e[g].length=0,N[g].length=0}},14618:(g,i,a)=>{g.exports=L;var n=a(13280);function L(g,i){if(!(this instanceof L))return new L(g,i);var a=n.create();n.add(a,g,i),this.base=n.min(n.create(),g,a),this.GF=n.clone(i),this.max=n.max(n.create(),g,a),this.mag=n.length(this.GF)}var d=L.prototype;d.width=function(){return this.GF[0]},d.height=function(){return this.GF[1]},d.depth=function(){return this.GF[2]},d.x0=function(){return this.base[0]},d.y0=function(){return this.base[1]},d.z0=function(){return this.base[2]},d.x1=function(){return this.max[0]},d.y1=function(){return this.max[1]},d.z1=function(){return this.max[2]},d.translate=function(g){return n.add(this.max,this.max,g),n.add(this.base,this.base,g),this},d.setPosition=function(g){return n.add(this.max,g,this.GF),n.j(this.base,g),this},d.expand=function(g){var i=n.create(),a=n.create();return n.max(i,g.max,this.max),n.min(a,g.base,this.base),n.ci(i,i,a),new L(a,i)},d.intersects=function(g){return!(g.base[0]>this.max[0])&&(!(g.base[1]>this.max[1])&&(!(g.base[2]>this.max[2])&&(!(g.max[0]<this.base[0])&&(!(g.max[1]<this.base[1])&&!(g.max[2]<this.base[2])))))},d.touches=function(g){var i=this.union(g);return null!==i&&(0==i.width()||0==i.height()||0==i.depth())},d.union=function(g){if(!this.intersects(g))return null;var i=Math.max(g.base[0],this.base[0]),a=Math.max(g.base[1],this.base[1]),n=Math.max(g.base[2],this.base[2]);return new L([i,a,n],[Math.min(g.max[0],this.max[0])-i,Math.min(g.max[1],this.max[1])-a,Math.min(g.max[2],this.max[2])-n])}},14522:(g,i)=>{"use strict";function a(g){var i=32;return(g&=-g)&&i--,65535&g&&(i-=16),16711935&g&&(i-=8),252645135&g&&(i-=4),858993459&g&&(i-=2),1431655765&g&&(i-=1),i}i.INT_BITS=32,i.INT_MAX=2147483647,i.INT_MIN=-1<<31,i.sign=function(g){return(g>0)-(g<0)},i.abs=function(g){var i=g>>31;return(g^i)-i},i.min=function(g,i){return i^(g^i)&-(g<i)},i.max=function(g,i){return g^(g^i)&-(g<i)},i.isPow2=function(g){return!(g&g-1)&&!!g},i.log2=function(g){var i,a;return i=(g>65535)<<4,i|=a=((g>>>=i)>255)<<3,i|=a=((g>>>=a)>15)<<2,(i|=a=((g>>>=a)>3)<<1)|(g>>>=a)>>1},i.log10=function(g){return g>=1e9?9:g>=1e8?8:g>=1e7?7:g>=1e6?6:g>=1e5?5:g>=1e4?4:g>=1e3?3:g>=100?2:g>=10?1:0},i.popCount=function(g){return 16843009*((g=(858993459&(g-=g>>>1&1431655765))+(g>>>2&858993459))+(g>>>4)&252645135)>>>24},i.countTrailingZeros=a,i.nextPow2=function(g){return g+=0===g,--g,g|=g>>>1,g|=g>>>2,g|=g>>>4,g|=g>>>8,(g|=g>>>16)+1},i.prevPow2=function(g){return g|=g>>>1,g|=g>>>2,g|=g>>>4,g|=g>>>8,(g|=g>>>16)-(g>>>1)},i.parity=function(g){return g^=g>>>16,g^=g>>>8,g^=g>>>4,27030>>>(g&=15)&1};var n=new Array(256);!function(g){for(var i=0;i<256;++i){var a=i,n=i,L=7;for(a>>>=1;a;a>>>=1)n<<=1,n|=1&a,--L;g[i]=n<<L&255}}(n),i.reverse=function(g){return n[255&g]<<24|n[g>>>8&255]<<16|n[g>>>16&255]<<8|n[g>>>24&255]},i.interleave2=function(g,i){return(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g&=65535)|g<<8))|g<<4))|g<<2))|g<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i&=65535)|i<<8))|i<<4))|i<<2))|i<<1))<<1},i.deinterleave2=function(g,i){return(g=65535&((g=16711935&((g=252645135&((g=858993459&((g=g>>>i&1431655765)|g>>>1))|g>>>2))|g>>>4))|g>>>16))<<16>>16},i.interleave3=function(g,i,a){return g=1227133513&((g=3272356035&((g=251719695&((g=4278190335&((g&=1023)|g<<16))|g<<8))|g<<4))|g<<2),(g|=(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<1)|(a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2))<<2},i.deinterleave3=function(g,i){return(g=1023&((g=4278190335&((g=251719695&((g=3272356035&((g=g>>>i&1227133513)|g>>>2))|g>>>4))|g>>>8))|g>>>16))<<22>>22},i.nextCombination=function(g){var i=g|g-1;return i+1|(~i&-~i)-1>>>a(g)+1}},14507:(g,i,a)=>{"use strict";g.exports=function(g,i,a){switch(arguments.length){case 1:return n=[],N(L=g,L,F,!0),n;case 2:return"function"===typeof i?N(g,g,i,!0):function(g,i){return n=[],N(g,i,F,!1),n}(g,i);case 3:return N(g,i,a,!1);default:throw new Error("box-intersect: Invalid arguments")}var L};var n,L=a(14514),d=a(14536),b=a(14553);function k(g,i){for(var a=0;a<g;++a)if(!(i[a]<=i[a+g]))return!0;return!1}function e(g,i,a,n){for(var L=0,d=0,b=0,e=g.length;b<e;++b){var N=g[b];if(!k(i,N)){for(var F=0;F<2*i;++F)a[L++]=N[F];n[d++]=b}}return d}function N(g,i,a,n){var k=g.length,N=i.length;if(!(k<=0||N<=0)){var F=g[0].length>>>1;if(!(F<=0)){var I,j=L.mallocDouble(2*F*k),y=L.mallocInt32(k);if((k=e(g,F,j,y))>0){if(1===F&&n)d.init(k),I=d.sweepComplete(F,a,0,k,j,y,0,k,j,y);else{var B=L.mallocDouble(2*F*N),c=L.mallocInt32(N);(N=e(i,F,B,c))>0&&(d.init(k+N),I=1===F?d.sweepBipartite(F,a,0,k,j,y,0,N,B,c):b(F,a,n,k,j,y,N,B,c),L.free(B),L.free(c))}L.free(j),L.free(y)}return I}}}function F(g,i){n.push([g,i])}},14559:(g,i)=>{"use strict";var a="d",n="ax",L="fp",d="es",b="rs",k="re",e="rb",N="bs",F="be",I="bb",j=[a,n,"vv",b,k,e,"ri",N,F,I,"bi"];function y(g){var i="bruteForce"+(g?"Full":"Partial"),n=[],b=j.slice();g||b.splice(3,0,L);var k=["function "+i+"("+b.join()+"){"];function e(i,L){var b=function(g,i,n){var L="bruteForce"+(g?"Red":"Blue")+(i?"Flip":"")+(n?"Full":""),b=["function ",L,"(",j.join(),"){","var ",d,"=2*",a,";"],k="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",e="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(n?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return g?b.push(k,"Q",":",e):b.push(e,"Q",":",k),n?b.push("if(y1<x0||x1<y0)continue;"):i?b.push("if(y0<=x0||x1<y0)continue;"):b.push("if(y0<x0||x1<y0)continue;"),b.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),i?b.push("yi,xi"):b.push("xi,yi"),b.push(");if(rv!==void 0)return rv;}}}"),{name:L,code:b.join("")}}(i,L,g);n.push(b.code),k.push("return "+b.name+"("+j.join()+");")}k.push("if(re-rs>be-bs){"),g?(e(!0,!1),k.push("}else{"),e(!1,!1)):(k.push("if(fp){"),e(!0,!0),k.push("}else{"),e(!0,!1),k.push("}}else{if(fp){"),e(!1,!0),k.push("}else{"),e(!1,!1),k.push("}")),k.push("}}return "+i);var N=n.join("")+k.join("");return new Function(N)()}i.partial=y(!1),i.full=y(!0)},14553:(g,i,a)=>{"use strict";g.exports=function(g,i,a,d,F,U,S,V,K){!function(g,i){var a=8*L.log2(i+1)*(g+1)|0,d=L.nextPow2(E*a);v.length<d&&(n.free(v),v=n.mallocInt32(d));var b=L.nextPow2(X*a);P.length<b&&(n.free(P),P=n.mallocDouble(b))}(g,d+S);var T,l=0,Z=2*g;Y(l++,0,0,d,0,S,a?16:0,-1/0,1/0),a||Y(l++,0,0,S,0,d,1,-1/0,1/0);for(;l>0;){var h=(l-=1)*E,w=v[h],t=v[h+1],A=v[h+2],O=v[h+3],z=v[h+4],s=v[h+5],mg=l*X,r=P[mg],Q=P[mg+1],o=1&s,u=!!(16&s),H=F,M=U,q=V,W=K;if(o&&(H=V,M=K,q=F,W=U),!(2&s&&t>=(A=D(g,w,t,A,H,M,Q)))&&!(4&s&&(t=p(g,w,t,A,H,M,r))>=A)){var G=A-t,J=z-O;if(u){if(g*G*(G+J)<y){if(void 0!==(T=e.scanComplete(g,w,i,t,A,H,M,O,z,q,W)))return T;continue}}else{if(g*Math.min(G,J)<I){if(void 0!==(T=b(g,w,i,o,t,A,H,M,O,z,q,W)))return T;continue}if(g*G*J<j){if(void 0!==(T=e.scanBipartite(g,w,i,o,t,A,H,M,O,z,q,W)))return T;continue}}var gg=B(g,w,t,A,H,M,r,Q);if(t<gg)if(g*(gg-t)<I){if(void 0!==(T=k(g,w+1,i,t,gg,H,M,O,z,q,W)))return T}else if(w===g-2){if(void 0!==(T=o?e.sweepBipartite(g,i,O,z,q,W,t,gg,H,M):e.sweepBipartite(g,i,t,gg,H,M,O,z,q,W)))return T}else Y(l++,w+1,t,gg,O,z,o,-1/0,1/0),Y(l++,w+1,O,z,t,gg,1^o,-1/0,1/0);if(gg<A){var ig=N(g,w,O,z,q,W),ag=q[Z*ig+w],ng=c(g,w,ig,z,q,W,ag);if(ng<z&&Y(l++,w,gg,A,ng,z,(4|o)+(u?16:0),ag,Q),O<ig&&Y(l++,w,gg,A,O,ig,(2|o)+(u?16:0),r,ag),ig+1===ng){if(void 0!==(T=u?C(g,w,i,gg,A,H,M,ig,q,W[ig]):f(g,w,i,o,gg,A,H,M,ig,q,W[ig])))return T}else if(ig<ng){var Lg;if(u){if(gg<(Lg=R(g,w,gg,A,H,M,ag))){var dg=c(g,w,gg,Lg,H,M,ag);if(w===g-2){if(gg<dg&&void 0!==(T=e.sweepComplete(g,i,gg,dg,H,M,ig,ng,q,W)))return T;if(dg<Lg&&void 0!==(T=e.sweepBipartite(g,i,dg,Lg,H,M,ig,ng,q,W)))return T}else gg<dg&&Y(l++,w+1,gg,dg,ig,ng,16,-1/0,1/0),dg<Lg&&(Y(l++,w+1,dg,Lg,ig,ng,0,-1/0,1/0),Y(l++,w+1,ig,ng,dg,Lg,1,-1/0,1/0))}}else gg<(Lg=o?x(g,w,gg,A,H,M,ag):R(g,w,gg,A,H,M,ag))&&(w===g-2?T=o?e.sweepBipartite(g,i,ig,ng,q,W,gg,Lg,H,M):e.sweepBipartite(g,i,gg,Lg,H,M,ig,ng,q,W):(Y(l++,w+1,gg,Lg,ig,ng,o,-1/0,1/0),Y(l++,w+1,ig,ng,gg,Lg,1^o,-1/0,1/0)))}}}}};var n=a(14514),L=a(14522),d=a(14559),b=d.partial,k=d.full,e=a(14536),N=a(14562),F=a(14571),I=128,j=1<<22,y=1<<22,B=F("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),c=F("lo===p0",["p0"]),D=F("lo<p0",["p0"]),p=F("hi<=p0",["p0"]),R=F("lo<=p0&&p0<=hi",["p0"]),x=F("lo<p0&&p0<=hi",["p0"]),E=6,X=2,v=n.mallocInt32(1024),P=n.mallocDouble(1024);function Y(g,i,a,n,L,d,b,k,e){var N=E*g;v[N]=i,v[N+1]=a,v[N+2]=n,v[N+3]=L,v[N+4]=d,v[N+5]=b;var F=X*g;P[F]=k,P[F+1]=e}function f(g,i,a,n,L,d,b,k,e,N,F){var I=2*g,j=e*I,y=N[j+i];g:for(var B=L,c=L*I;B<d;++B,c+=I){var D=b[c+i],p=b[c+i+g];if(!(y<D||p<y)&&(!n||y!==D)){for(var R,x=k[B],E=i+1;E<g;++E){D=b[c+E],p=b[c+E+g];var X=N[j+E],v=N[j+E+g];if(p<X||v<D)continue g}if(void 0!==(R=n?a(F,x):a(x,F)))return R}}}function C(g,i,a,n,L,d,b,k,e,N){var F=2*g,I=k*F,j=e[I+i];g:for(var y=n,B=n*F;y<L;++y,B+=F){var c=b[y];if(c!==N){var D=d[B+i],p=d[B+i+g];if(!(j<D||p<j)){for(var R=i+1;R<g;++R){D=d[B+R],p=d[B+R+g];var x=e[I+R],E=e[I+R+g];if(p<x||E<D)continue g}var X=a(c,N);if(void 0!==X)return X}}}}},14562:(g,i,a)=>{"use strict";g.exports=function(g,i,a,b,k,e){if(b<=a+1)return a;var N=a,F=b,I=b+a>>>1,j=2*g,y=I,B=k[j*I+i];for(;N<F;){if(F-N<L){d(g,i,N,F,k,e),B=k[j*I+i];break}var c=F-N,D=Math.random()*c+N|0,p=k[j*D+i],R=Math.random()*c+N|0,x=k[j*R+i],E=Math.random()*c+N|0,X=k[j*E+i];p<=x?X>=x?(y=R,B=x):p>=X?(y=D,B=p):(y=E,B=X):x>=X?(y=R,B=x):X>=p?(y=D,B=p):(y=E,B=X);for(var v=j*(F-1),P=j*y,Y=0;Y<j;++Y,++v,++P){var f=k[v];k[v]=k[P],k[P]=f}var C=e[F-1];e[F-1]=e[y],e[y]=C;for(v=j*(F-1),P=j*(y=n(g,i,N,F-1,k,e,B)),Y=0;Y<j;++Y,++v,++P){f=k[v];k[v]=k[P],k[P]=f}C=e[F-1];if(e[F-1]=e[y],e[y]=C,I<y){for(F=y-1;N<F&&k[j*(F-1)+i]===B;)F-=1;F+=1}else{if(!(y<I))break;for(N=y+1;N<F&&k[j*N+i]===B;)N+=1}}return n(g,i,a,I,k,e,k[j*I+i])};var n=a(14571)("lo<p0",["p0"]),L=8;function d(g,i,a,n,L,d){for(var b=2*g,k=b*(a+1)+i,e=a+1;e<n;++e,k+=b)for(var N=L[k],F=e,I=b*(e-1);F>a&&L[I+i]>N;--F,I-=b){for(var j=I,y=I+b,B=0;B<b;++B,++j,++y){var c=L[j];L[j]=L[y],L[y]=c}var D=d[F];d[F]=d[F-1],d[F-1]=D}}},14571:g=>{"use strict";g.exports=function(g,a){var n="abcdef".split("").concat(a),L=[];g.indexOf("lo")>=0&&L.push("lo=e[k+n]");g.indexOf("hi")>=0&&L.push("hi=e[k+o]");return n.push(i.replace("_",L.join()).replace("$",g)),Function.apply(void 0,n)};var i="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14544:g=>{"use strict";g.exports=function(g,n){n<=4*i?a(0,n-1,g):N(0,n-1,g)};var i=32;function a(g,i,a){for(var n=2*(g+1),L=g+1;L<=i;++L){for(var d=a[n++],b=a[n++],k=L,e=n-2;k-- >g;){var N=a[e-2],F=a[e-1];if(N<d)break;if(N===d&&F<b)break;a[e]=N,a[e+1]=F,e-=2}a[e]=d,a[e+1]=b}}function n(g,i,a){i*=2;var n=a[g*=2],L=a[g+1];a[g]=a[i],a[g+1]=a[i+1],a[i]=n,a[i+1]=L}function L(g,i,a){i*=2,a[g*=2]=a[i],a[g+1]=a[i+1]}function d(g,i,a,n){i*=2,a*=2;var L=n[g*=2],d=n[g+1];n[g]=n[i],n[g+1]=n[i+1],n[i]=n[a],n[i+1]=n[a+1],n[a]=L,n[a+1]=d}function b(g,i,a,n,L){i*=2,L[g*=2]=L[i],L[i]=a,L[g+1]=L[i+1],L[i+1]=n}function k(g,i,a){i*=2;var n=a[g*=2],L=a[i];return!(n<L)&&(n!==L||a[g+1]>a[i+1])}function e(g,i,a,n){var L=n[g*=2];return L<i||L===i&&n[g+1]<a}function N(g,F,I){var j=(F-g+1)/6|0,y=g+j,B=F-j,c=g+F>>1,D=c-j,p=c+j,R=y,x=D,E=c,X=p,v=B,P=g+1,Y=F-1,f=0;k(R,x,I)&&(f=R,R=x,x=f),k(X,v,I)&&(f=X,X=v,v=f),k(R,E,I)&&(f=R,R=E,E=f),k(x,E,I)&&(f=x,x=E,E=f),k(R,X,I)&&(f=R,R=X,X=f),k(E,X,I)&&(f=E,E=X,X=f),k(x,v,I)&&(f=x,x=v,v=f),k(x,E,I)&&(f=x,x=E,E=f),k(X,v,I)&&(f=X,X=v,v=f);for(var C=I[2*x],U=I[2*x+1],S=I[2*X],V=I[2*X+1],K=2*R,T=2*E,l=2*v,Z=2*y,h=2*c,w=2*B,t=0;t<2;++t){var A=I[K+t],O=I[T+t],z=I[l+t];I[Z+t]=A,I[h+t]=O,I[w+t]=z}L(D,g,I),L(p,F,I);for(var s=P;s<=Y;++s)if(e(s,C,U,I))s!==P&&n(s,P,I),++P;else if(!e(s,S,V,I))for(;;){if(e(Y,S,V,I)){e(Y,C,U,I)?(d(s,P,Y,I),++P,--Y):(n(s,Y,I),--Y);break}if(--Y<s)break}b(g,P-1,C,U,I),b(F,Y+1,S,V,I),P-2-g<=i?a(g,P-2,I):N(g,P-2,I),F-(Y+2)<=i?a(Y+2,F,I):N(Y+2,F,I),Y-P<=i?a(P,Y,I):N(P,Y,I)}},14536:(g,i,a)=>{"use strict";g.exports={init:function(g){var i=L.nextPow2(g);e.length<i&&(n.free(e),e=n.mallocInt32(i));N.length<i&&(n.free(N),N=n.mallocInt32(i));F.length<i&&(n.free(F),F=n.mallocInt32(i));I.length<i&&(n.free(I),I=n.mallocInt32(i));j.length<i&&(n.free(j),j=n.mallocInt32(i));y.length<i&&(n.free(y),y=n.mallocInt32(i));var a=8*i;B.length<a&&(n.free(B),B=n.mallocDouble(a))},sweepBipartite:function(g,i,a,n,L,k,j,y,p,R){for(var x=0,E=2*g,X=g-1,v=E-1,P=a;P<n;++P){var Y=k[P],f=E*P;B[x++]=L[f+X],B[x++]=-(Y+1),B[x++]=L[f+v],B[x++]=Y}for(P=j;P<y;++P){Y=R[P]+b;var C=E*P;B[x++]=p[C+X],B[x++]=-Y,B[x++]=p[C+v],B[x++]=Y}var U=x>>>1;d(B,U);var S=0,V=0;for(P=0;P<U;++P){var K=0|B[2*P+1];if(K>=b)c(F,I,V--,K=K-b|0);else if(K>=0)c(e,N,S--,K);else if(K<=-b){K=-K-b|0;for(var T=0;T<S;++T){if(void 0!==(l=i(e[T],K)))return l}D(F,I,V++,K)}else{K=-K-1|0;for(T=0;T<V;++T){var l;if(void 0!==(l=i(K,F[T])))return l}D(e,N,S++,K)}}},sweepComplete:function(g,i,a,n,L,b,k,p,R,x){for(var E=0,X=2*g,v=g-1,P=X-1,Y=a;Y<n;++Y){var f=b[Y]+1<<1,C=X*Y;B[E++]=L[C+v],B[E++]=-f,B[E++]=L[C+P],B[E++]=f}for(Y=k;Y<p;++Y){f=x[Y]+1<<1;var U=X*Y;B[E++]=R[U+v],B[E++]=1|-f,B[E++]=R[U+P],B[E++]=1|f}var S=E>>>1;d(B,S);var V=0,K=0,T=0;for(Y=0;Y<S;++Y){var l=0|B[2*Y+1],Z=1&l;if(Y<S-1&&l>>1===B[2*Y+3]>>1&&(Z=2,Y+=1),l<0){for(var h=-(l>>1)-1,w=0;w<T;++w){if(void 0!==(t=i(j[w],h)))return t}if(0!==Z)for(w=0;w<V;++w){if(void 0!==(t=i(e[w],h)))return t}if(1!==Z)for(w=0;w<K;++w){var t;if(void 0!==(t=i(F[w],h)))return t}0===Z?D(e,N,V++,h):1===Z?D(F,I,K++,h):2===Z&&D(j,y,T++,h)}else{h=(l>>1)-1;0===Z?c(e,N,V--,h):1===Z?c(F,I,K--,h):2===Z&&c(j,y,T--,h)}}},scanBipartite:function(g,i,a,n,L,k,F,I,j,y,p,R){var x=0,E=2*g,X=i,v=i+g,P=1,Y=1;n?Y=b:P=b;for(var f=L;f<k;++f){var C=f+P,U=E*f;B[x++]=F[U+X],B[x++]=-C,B[x++]=F[U+v],B[x++]=C}for(f=j;f<y;++f){C=f+Y;var S=E*f;B[x++]=p[S+X],B[x++]=-C}var V=x>>>1;d(B,V);var K=0;for(f=0;f<V;++f){var T=0|B[2*f+1];if(T<0){var l=!1;if((C=-T)>=b?(l=!n,C-=b):(l=!!n,C-=1),l)D(e,N,K++,C);else{var Z=R[C],h=E*C,w=p[h+i+1],t=p[h+i+1+g];g:for(var A=0;A<K;++A){var O=e[A],z=E*O;if(!(t<F[z+i+1]||F[z+i+1+g]<w)){for(var s=i+2;s<g;++s)if(p[h+s+g]<F[z+s]||F[z+s+g]<p[h+s])continue g;var mg,r=I[O];if(void 0!==(mg=n?a(Z,r):a(r,Z)))return mg}}}}else c(e,N,K--,T-P)}},scanComplete:function(g,i,a,n,L,k,N,F,I,j,y){for(var c=0,D=2*g,p=i,R=i+g,x=n;x<L;++x){var E=x+b,X=D*x;B[c++]=k[X+p],B[c++]=-E,B[c++]=k[X+R],B[c++]=E}for(x=F;x<I;++x){E=x+1;var v=D*x;B[c++]=j[v+p],B[c++]=-E}var P=c>>>1;d(B,P);var Y=0;for(x=0;x<P;++x){var f=0|B[2*x+1];if(f<0){if((E=-f)>=b)e[Y++]=E-b;else{var C=y[E-=1],U=D*E,S=j[U+i+1],V=j[U+i+1+g];g:for(var K=0;K<Y;++K){var T=e[K],l=N[T];if(l===C)break;var Z=D*T;if(!(V<k[Z+i+1]||k[Z+i+1+g]<S)){for(var h=i+2;h<g;++h)if(j[U+h+g]<k[Z+h]||k[Z+h+g]<j[U+h])continue g;var w=a(l,C);if(void 0!==w)return w}}}}else{for(E=f-b,K=Y-1;K>=0;--K)if(e[K]===E){for(h=K+1;h<Y;++h)e[h-1]=e[h];break}--Y}}}};var n=a(14514),L=a(14522),d=a(14544),b=1<<28,k=1024,e=n.mallocInt32(k),N=n.mallocInt32(k),F=n.mallocInt32(k),I=n.mallocInt32(k),j=n.mallocInt32(k),y=n.mallocInt32(k),B=n.mallocDouble(8192);function c(g,i,a,n){var L=i[n],d=g[a-1];g[L]=d,i[d]=L}function D(g,i,a,n){g[a]=n,i[n]=a}},14527:g=>{"use strict";function i(g,a,n){var L=0|g[n];if(L<=0)return[];var d,b=new Array(L);if(n===g.length-1)for(d=0;d<L;++d)b[d]=a;else for(d=0;d<L;++d)b[d]=i(g,a,n+1);return b}g.exports=function(g,a){switch("undefined"===typeof a&&(a=0),typeof g){case"number":if(g>0)return function(g,i){var a,n;for(a=new Array(g),n=0;n<g;++n)a[n]=i;return a}(0|g,a);break;case"object":if("number"===typeof g.length)return i(g,a,0)}return[]}},14478:(g,i,a)=>{g.exports=function(){var g=this;this.components={},this.comps=this.components;var i=this.components,a=1,L={},d=[],b=[],k={timeout:!1,removals:[],multiComps:[]};function e(g,a){var n=i[a],d=L[a],b=d.hash[g];b&&(d.remove(g),n.en&&(n.multi?(b.forEach((i=>{i&&n.en(g,i)})),b.length=0):n.en(g,b)),k.removals.push(d),N())}function N(){k.timeout||(k.timeout=!0,setTimeout(F,1))}function F(){k.timeout=!1,I()}function I(){k.multiComps.length&&function(g){for(var i=0;i<g.length;i++){var{entID:a,data:n}=g[i],L=n.hash[a];if(L){for(var d=0;d<L.length;d++)L[d]||(L.splice(d,1),d--);0===L.length&&(n.remove(a),k.removals.push(n))}}g.length=0}(k.multiComps),k.removals.length&&function(g){for(var i=0;i<g.length;i++){g[i].flush()}g.length=0}(k.removals)}this.yj=L,this._systems=d,this._renderSystems=b,this.iI=function(i){var n=a++;return Array.isArray(i)&&i.forEach((i=>g.AN(n,i))),n},this.deleteEntity=function(i){return Object.keys(L).forEach((g=>{L[g].hash[i]&&e(i,g)})),g},this.DI=function(g){if(!g)throw new Error("Missing component definition");var a=g.name;if(!a)throw new Error("Component definition must have a name property.");if("string"!==typeof a)throw new Error("Component name must be a string.");if(""===a)throw new Error("Component name must be a non-empty string.");if(L[a])throw new Error(`Component ${a} already exists.`);var k={};return k.name=a,k.multi=!!g.multi,k.order=isNaN(g.order)?99:g.order,k.stateConstructor=g.stateConstructor||null,k.state=g.state||{},k.le=g.le||null,k.en=g.en||null,k.system=g.system||null,k.se=g.se||null,i[a]=k,L[a]=new n,L[a]._pendingMultiCleanup=!1,L[a]._multiCleanupIDs=k.multi?[]:null,k.system&&(d.push(a),d.sort(((g,a)=>i[g].order-i[a].order))),k.se&&(b.push(a),b.sort(((g,a)=>i[g].order-i[a].order))),a},this.overwriteComponent=function(g,a){var n=i[g];if(!n)throw new Error(`Unknown component: ${g}`);if(!a)throw new Error("Missing component definition");if(n.name!==a.name)throw new Error("Overwriting component must use the same name property.");var k={};k.name=g,k.multi=!!a.multi,k.order=isNaN(a.order)?99:a.order,k.state=a.state||{},k.le=a.le||null,k.en=a.en||null,k.system=a.system||null,k.se=a.se||null,i[g]=k,L[g]._pendingMultiCleanup=!1,L[g]._multiCleanupIDs=k.multi?[]:null;var e=d.indexOf(g);k.system&&e<0&&d.push(g),!k.system&&e>=0&&d.splice(e,1),d.sort(((g,a)=>i[g].order-i[a].order));var N=b.indexOf(g);k.se&&N<0&&b.push(g),!k.se&&N>=0&&b.splice(N,1),b.sort(((g,a)=>i[g].order-i[a].order));var F=k.state;return this.wF(g).forEach((g=>{for(var i in F)i in g||(g[i]=F[i]);k.le&&k.le(g.Oe,g)})),g},this.deleteComponent=function(a){var n=L[a];if(!n)throw new Error(`Unknown component: ${a}`);n.flush(),n.list.forEach((g=>{g&&e(g.Oe||g[0].Oe,a)}));var k=d.indexOf(a),N=b.indexOf(a);return k>-1&&d.splice(k,1),N>-1&&b.splice(N,1),L[a].dispose(),delete L[a],delete i[a],g},this.AN=function(g,a,n){var d,b=i[a],k=L[a];if(!k)throw new Error(`Unknown component: ${a}.`);if(k.hash[g]&&!b.multi)throw new Error(`Entity ${g} already has component: ${a}.`);if(b.stateConstructor){if(!(d=new b.stateConstructor).hasOwnProperty("Oe"))throw new Error(`Component ${b.name} stateConstructor type does not have property __id`)}else d=Object.assign({},{Oe:g},b.state,n);if(d.Oe=g,b.multi){var e=k.hash[g];e||(e=[],k.add(g,e)),e.push(d)}else k.add(g,d);return b.le&&b.le(g,d),this},this.MN=function(g,i){var a=L[i];if(!a)throw new Error(`Unknown component: ${i}.`);return!!a.hash[g]},this.mF=function(i,a){if(!L[a])throw new Error(`Unknown component: ${a}.`);return e(i,a),g},this.getState=function(g,i){var a=L[i];if(!a)throw new Error(`Unknown component: ${i}.`);return a.hash[g]},this.wF=function(g){var i=L[g];if(!i)throw new Error(`Unknown component: ${g}.`);return I(),i.list},this.eB=function(g){if(!L[g])throw new Error(`Unknown component: ${g}.`);var i=L[g].hash;return g=>i[g]},this.IB=function(g){if(!L[g])throw new Error(`Unknown component: ${g}.`);var i=L[g].hash;return g=>!!i[g]},this.Se=function(a){I();for(var n=0;n<d.length;n++){var b=d[n],k=i[b],e=L[b];k.system(a,e.list),I()}return g},this.render=function(a){I();for(var n=0;n<b.length;n++){var d=b[n],k=i[d],e=L[d];k.se(a,e.list),I()}return g},this.removeMultiComponent=function(a,n,d){var b=i[n],e=L[n];if(!e)throw new Error(`Unknown component: ${n}.`);if(!b.multi)throw new Error("removeMultiComponent called on non-multi component");return function(g,i,a,n){var L=a.hash[g];if(L){var d=L[n];d&&(L[n]=null,i.en&&i.en(g,d),k.multiComps.push({entID:g,data:a}),N())}}(a,b,e,d),g}};var n=a(14485)},14485:g=>{function i(g,i){var a=g._map[i];if(delete g.hash[i],delete g._map[i],a===g.list.length-1)g.list.pop();else{var n=g.list.pop();if(g.list[a]=n,null===n||null===n[0]){var L=g.list.length;for(var d in g._map)if(g._map[d]===L)return void(g._map[d]=a)}else{var b=n.Oe||n[0].Oe;g._map[b]=a}}}g.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(g,i){if("number"===typeof this._map[g]){var a=this._map[g];this.hash[g]=i,this.list[a]=i}else this._map[g]=this.list.length,this.hash[g]=i,this.list.push(i)}remove(g){var i=this._map[g];this.hash[g]=null,this.list[i]=null,this._pendingRemovals.push(g)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var g=0;g<this._pendingRemovals.length;g++){var a=this._pendingRemovals[g];null===this.hash[a]&&i(this,a)}this._pendingRemovals.length=0}}},14451:g=>{"use strict";var i,a="object"===typeof Reflect?Reflect:null,n=function(g,i,a){return Function.prototype.apply.call(g,i,a)};i=a&&"function"===typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(g){return Object.getOwnPropertyNames(g).concat(Object.getOwnPropertySymbols(g))}:function(g){return Object.getOwnPropertyNames(g)};var L=Number.isNaN||function(g){return g!==g};function d(){d.init.call(this)}g.exports=d,g.exports.once=function(g,i){return new Promise((function(a,n){function L(a){g.removeListener(i,d),n(a)}function d(){"function"===typeof g.removeListener&&g.removeListener("error",L),a([].slice.call(arguments))}c(g,i,d,{once:!0}),"error"!==i&&function(g,i,a){"function"===typeof g.on&&c(g,"error",i,a)}(g,L,{once:!0})}))},d.EventEmitter=d,d.prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var b=10;function k(g){if("function"!==typeof g)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof g)}function e(g){return void 0===g._maxListeners?d.defaultMaxListeners:g._maxListeners}function N(g,i,a,n){var L,d,b,N;if(k(a),void 0===(d=g._events)?(d=g._events=Object.create(null),g._eventsCount=0):(void 0!==d.newListener&&(g.emit("newListener",i,a.listener?a.listener:a),d=g._events),b=d[i]),void 0===b)b=d[i]=a,++g._eventsCount;else if("function"===typeof b?b=d[i]=n?[a,b]:[b,a]:n?b.unshift(a):b.push(a),(L=e(g))>0&&b.length>L&&!b.warned){b.warned=!0;var F=new Error("Possible EventEmitter memory leak detected. "+b.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit");F.name="MaxListenersExceededWarning",F.ni=g,F.type=i,F.count=b.length,N=F,console&&console.warn&&console.warn(N)}return g}function F(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function I(g,i,a){var n={fired:!1,wrapFn:void 0,target:g,type:i,listener:a},L=F.bind(n);return L.listener=a,n.wrapFn=L,L}function j(g,i,a){var n=g._events;if(void 0===n)return[];var L=n[i];return void 0===L?[]:"function"===typeof L?a?[L.listener||L]:[L]:a?function(g){for(var i=new Array(g.length),a=0;a<i.length;++a)i[a]=g[a].listener||g[a];return i}(L):B(L,L.length)}function y(g){var i=this._events;if(void 0!==i){var a=i[g];if("function"===typeof a)return 1;if(void 0!==a)return a.length}return 0}function B(g,i){for(var a=new Array(i),n=0;n<i;++n)a[n]=g[n];return a}function c(g,i,a,n){if("function"===typeof g.on)n.once?g.once(i,a):g.on(i,a);else{if("function"!==typeof g.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof g);g.addEventListener(i,(function L(d){n.once&&g.removeEventListener(i,L),a(d)}))}}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(g){if("number"!==typeof g||g<0||L(g))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+g+".");b=g}}),d.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(g){if("number"!==typeof g||g<0||L(g))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+g+".");return this._maxListeners=g,this},d.prototype.getMaxListeners=function(){return e(this)},d.prototype.emit=function(g){for(var i=[],a=1;a<arguments.length;a++)i.push(arguments[a]);var L="error"===g,d=this._events;if(void 0!==d)L=L&&void 0===d.error;else if(!L)return!1;if(L){var b;if(i.length>0&&(b=i[0]),b instanceof Error)throw b;var k=new Error("Unhandled error."+(b?" ("+b.message+")":""));throw k.context=b,k}var e=d[g];if(void 0===e)return!1;if("function"===typeof e)n(e,this,i);else{var N=e.length,F=B(e,N);for(a=0;a<N;++a)n(F[a],this,i)}return!0},d.prototype.addListener=function(g,i){return N(this,g,i,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(g,i){return N(this,g,i,!0)},d.prototype.once=function(g,i){return k(i),this.on(g,I(this,g,i)),this},d.prototype.prependOnceListener=function(g,i){return k(i),this.prependListener(g,I(this,g,i)),this},d.prototype.removeListener=function(g,i){var a,n,L,d,b;if(k(i),void 0===(n=this._events))return this;if(void 0===(a=n[g]))return this;if(a===i||a.listener===i)0===--this._eventsCount?this._events=Object.create(null):(delete n[g],n.removeListener&&this.emit("removeListener",g,a.listener||i));else if("function"!==typeof a){for(L=-1,d=a.length-1;d>=0;d--)if(a[d]===i||a[d].listener===i){b=a[d].listener,L=d;break}if(L<0)return this;0===L?a.shift():function(g,i){for(;i+1<g.length;i++)g[i]=g[i+1];g.pop()}(a,L),1===a.length&&(n[g]=a[0]),void 0!==n.removeListener&&this.emit("removeListener",g,b||i)}return this},d.prototype.off=d.prototype.removeListener,d.prototype.Li=function(g){var i,a,n;if(void 0===(a=this._events))return this;if(void 0===a.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==a[g]&&(0===--this._eventsCount?this._events=Object.create(null):delete a[g]),this;if(0===arguments.length){var L,d=Object.keys(a);for(n=0;n<d.length;++n)"removeListener"!==(L=d[n])&&this.Li(L);return this.Li("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(i=a[g]))this.removeListener(g,i);else if(void 0!==i)for(n=i.length-1;n>=0;n--)this.removeListener(g,i[n]);return this},d.prototype.listeners=function(g){return j(this,g,!0)},d.prototype.rawListeners=function(g){return j(this,g,!1)},d.listenerCount=function(g,i){return"function"===typeof g.listenerCount?g.listenerCount(i):y.call(g,i)},d.prototype.listenerCount=y,d.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},14740:g=>{"use strict";g.exports=function(g,i,a,n,L,d){var b=+i[0],k=+i[1],e=+i[2],N=+a[0],F=+a[1],I=+a[2],j=Math.sqrt(N*N+F*F+I*I);if(0===j)throw new Error("Can't raycast along a zero vector");return function(g,i,a,n,L,d,b,k,e,N){for(var F=0,I=Math.floor,j=0|I(i),y=0|I(a),B=0|I(n),c=L>0?1:-1,D=d>0?1:-1,p=b>0?1:-1,R=Math.abs(1/L),x=Math.abs(1/d),E=Math.abs(1/b),X=R<1/0?R*(c>0?j+1-i:i-j):1/0,v=x<1/0?x*(D>0?y+1-a:a-y):1/0,P=E<1/0?E*(p>0?B+1-n:n-B):1/0,Y=-1;F<=k;){var f=g(j,y,B);if(f)return e&&(e[0]=i+F*L,e[1]=a+F*d,e[2]=n+F*b),N&&(N[0]=N[1]=N[2]=0,0===Y&&(N[0]=-c),1===Y&&(N[1]=-D),2===Y&&(N[2]=-p)),f;X<v?X<P?(j+=c,F=X,X+=R,Y=0):(B+=p,F=P,P+=E,Y=2):v<P?(y+=D,F=v,v+=x,Y=1):(B+=p,F=P,P+=E,Y=2)}return e&&(e[0]=i+F*L,e[1]=a+F*d,e[2]=n+F*b),N&&(N[0]=N[1]=N[2]=0),0}(g,b,k,e,N/=j,F/=j,I/=j,n="undefined"===typeof n?64:+n,L,d)}},14774:(g,i,a)=>{"use strict";a.d(i,{e:()=>d});var n=a(14451);function L(){this.Ly=!1,this.stopPropagation=!1,this.by=!1,this.disabled=!1}class d{constructor(g,i){this.version="0.7.0";var a=Object.assign({},new L,i||{});this.element=g||document,this.Ly=!!a.Ly,this.stopPropagation=!!a.stopPropagation,this.by=!!a.by,this.disabled=!!a.disabled,this.filterEvents=(g,i)=>!0,this.down=new n.EventEmitter,this.up=new n.EventEmitter,this.state={},this.VF={dx:0,dy:0,Jy:0,SF:0,gB:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?k(this):document.addEventListener("DOMContentLoaded",(g=>{k(this)}),{once:!0})}bind(g){for(var i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];a.forEach((i=>{var a=this._keyBindmap[i]||[];a.includes(g)||(a.push(g),this._keyBindmap[i]=a)})),this.state[g]=!!this.state[g],this.pressCount[g]=this.pressCount[g]||0,this.releaseCount[g]=this.releaseCount[g]||0}unbind(g){for(var i in this._keyBindmap){var a=this._keyBindmap[i],n=a.indexOf(g);n>-1&&a.splice(n,1)}}getBindings(){var g={};for(var i in this._keyBindmap){this._keyBindmap[i].forEach((a=>{g[a]=g[a]||[],g[a].push(i)}))}return g}Se(){b(this.VF),b(this.pressCount),b(this.releaseCount)}}function b(g){for(var i in g)g[i]=0}function k(g){window.addEventListener("keydown",B.bind(null,g,!0),!1),window.addEventListener("keyup",B.bind(null,g,!1),!1);var i={passive:!0};g.element.addEventListener("touchstart",I.bind(void 0,g),{passive:!1}),g.element.addEventListener("touchend",y.bind(void 0,g),i),g.element.addEventListener("mousedown",c.bind(null,g,!0),i),window.document.addEventListener("mouseup",c.bind(null,g,!1),i),g.element.addEventListener("touchmove",D.bind(null,g),i),g.element.addEventListener("mousemove",D.bind(null,g),i),window.PointerEvent,g.element.addEventListener("wheel",p.bind(null,g),i),g.element.addEventListener("contextmenu",R.bind(null,g),!1),window.addEventListener("blur",x.bind(null,g),!1)}var e=0,N=0,F=null;function I(g,i){i.preventDefault(),j(i)}function j(g){let i=!1;for(let a=0;a<g.touches.length;++a)if(g.touches[a].identifier===F){i=!0;break}if(!i){const i=g.changedTouches[0];e=i.clientX,N=i.clientY,F=i.identifier}}function y(g,i){for(var a=i.changedTouches,n=0;n<a.length;++n)a[n].identifier===F&&(F=null)}function B(g,i,a){E(a.code,i,g,a)}function c(g,i,a){if("pointerId"in a)if(i){if(null!==g._touches.currID)return;g._touches.currID=a.pointerId}else{if(g._touches.currID!==a.pointerId)return;g._touches.currID=null}return E("Mouse"+("button"in a?a.button+1:1),i,g,a),!1}function D(g,i){var a=i.movementX||i.mozMovementX||0,n=i.movementY||i.mozMovementY||0;if(i.touches&&0===(a|n)){var L=function(g){j(g);for(let i=0;i<g.changedTouches.length;++i)if(g.changedTouches[i].identifier==F){const a=g.changedTouches[i],n=[a.clientX-e,a.clientY-N];return e=a.clientX,N=a.clientY,n}return console.error(`Did not find touch id ${F}`),[0,0]}(i);a=L[0],n=L[1]}g.VF.dx+=a,g.VF.dy+=n}function p(g,i){var a=1;switch(i.deltaMode){case 0:a=1;break;case 1:a=12;break;case 2:a=g.element.clientHeight||window.innerHeight}g.VF.Jy+=(i.deltaX||0)*a,g.VF.SF+=(i.deltaY||0)*a,g.VF.gB+=(i.deltaZ||0)*a}function R(g,i){if(!g.by)return i.preventDefault(),!1}function x(g){for(var i in g._keyStates)g._keyStates[i]&&(/^Mouse\d/.test(i)||E(i,!1,g,{code:i,note:"pwnn6gil2ck",preventDefault:()=>{},stopPropagation:()=>{}}))}function E(g,i,a,n){var L=a._keyBindmap[g];L&&(X(a._keyStates[g],i)&&(a._keyStates[g]=i,L.forEach((g=>{(!a.filterEvents||a.filterEvents(n,g))&&function(g,i,a,n){var L=i?a.pressCount:a.releaseCount;L[g]=(L[g]||0)+1;var d=a._bindPressCount[g]||0;(d+=i?1:-1)<0&&(d=0);a._bindPressCount[g]=d;var b=a.state[g];if(X(b,d)){a.state[g]=d>0;var k=i?a.down:a.up;a.disabled||k.emit(g,n)}}(g,i,a,n)}))),"button"in n||(a.Ly&&!n.defaultPrevented&&n.preventDefault(),a.stopPropagation&&n.stopPropagation()))}function X(g,i){return g?!i:i}},13351:g=>{g.exports=function(g,i,a){return g[0]=i[0]+a[0],g[1]=i[1]+a[1],g[2]=i[2]+a[2],g}},13298:(g,i,a)=>{g.exports=function(g,i){var a=n(g[0],g[1],g[2]),b=n(i[0],i[1],i[2]);L(a,a),L(b,b);var k=d(a,b);return k>1?0:Math.acos(k)};var n=a(13307),L=a(13311),d=a(13317)},13406:g=>{g.exports=function(g,i){return g[0]=Math.ceil(i[0]),g[1]=Math.ceil(i[1]),g[2]=Math.ceil(i[2]),g}},13295:g=>{g.exports=function(g){var i=new Float32Array(3);return i[0]=g[0],i[1]=g[1],i[2]=g[2],i}},13320:g=>{g.exports=function(g,i){return g[0]=i[0],g[1]=i[1],g[2]=i[2],g}},13287:g=>{g.exports=function(){var g=new Float32Array(3);return g[0]=0,g[1]=0,g[2]=0,g}},13490:g=>{g.exports=function(g,i,a){var n=i[0],L=i[1],d=i[2],b=a[0],k=a[1],e=a[2];return g[0]=L*e-d*k,g[1]=d*b-n*e,g[2]=n*k-L*b,g}},13434:(g,i,a)=>{g.exports=a(13430)},13430:g=>{g.exports=function(g,i){var a=i[0]-g[0],n=i[1]-g[1],L=i[2]-g[2];return Math.sqrt(a*a+n*n+L*L)}},13384:(g,i,a)=>{g.exports=a(13378)},13378:g=>{g.exports=function(g,i,a){return g[0]=i[0]/a[0],g[1]=i[1]/a[1],g[2]=i[2]/a[2],g}},13317:g=>{g.exports=function(g,i){return g[0]*i[0]+g[1]*i[1]+g[2]*i[2]}},13282:g=>{g.exports=1e-6},13338:(g,i,a)=>{g.exports=function(g,i){var a=g[0],L=g[1],d=g[2],b=i[0],k=i[1],e=i[2];return Math.abs(a-b)<=n*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(L-k)<=n*Math.max(1,Math.abs(L),Math.abs(k))&&Math.abs(d-e)<=n*Math.max(1,Math.abs(d),Math.abs(e))};var n=a(13282)},13345:g=>{g.exports=function(g,i){return g[0]===i[0]&&g[1]===i[1]&&g[2]===i[2]}},13398:g=>{g.exports=function(g,i){return g[0]=Math.floor(i[0]),g[1]=Math.floor(i[1]),g[2]=Math.floor(i[2]),g}},13549:(g,i,a)=>{g.exports=function(g,i,a,L,d,b){var k,e;i||(i=3);a||(a=0);e=L?Math.min(L*i+a,g.length):g.length;for(k=a;k<e;k+=i)n[0]=g[k],n[1]=g[k+1],n[2]=g[k+2],d(n,n,b),g[k]=n[0],g[k+1]=n[1],g[k+2]=n[2];return g};var n=a(13287)()},13307:g=>{g.exports=function(g,i,a){var n=new Float32Array(3);return n[0]=g,n[1]=i,n[2]=a,n}},13280:(g,i,a)=>{g.exports={EPSILON:a(13282),create:a(13287),clone:a(13295),angle:a(13298),ce:a(13307),j:a(13320),set:a(13329),equals:a(13338),exactEquals:a(13345),add:a(13351),ci:a(13360),sub:a(13364),multiply:a(13367),mul:a(13375),divide:a(13378),div:a(13384),min:a(13386),max:a(13389),floor:a(13398),ceil:a(13406),round:a(13415),scale:a(13421),De:a(13424),distance:a(13430),i:a(13434),squaredDistance:a(13440),sqrDist:a(13449),length:a(13453),len:a(13462),squaredLength:a(13469),Re:a(13473),negate:a(13481),inverse:a(13487),normalize:a(13311),dot:a(13317),cross:a(13490),Ne:a(13493),random:a(13502),transformMat4:a(13510),transformMat3:a(13518),transformQuat:a(13526),xe:a(13529),Ee:a(13537),ve:a(13543),forEach:a(13549)}},13487:g=>{g.exports=function(g,i){return g[0]=1/i[0],g[1]=1/i[1],g[2]=1/i[2],g}},13462:(g,i,a)=>{g.exports=a(13453)},13453:g=>{g.exports=function(g){var i=g[0],a=g[1],n=g[2];return Math.sqrt(i*i+a*a+n*n)}},13493:g=>{g.exports=function(g,i,a,n){var L=i[0],d=i[1],b=i[2];return g[0]=L+n*(a[0]-L),g[1]=d+n*(a[1]-d),g[2]=b+n*(a[2]-b),g}},13389:g=>{g.exports=function(g,i,a){return g[0]=Math.max(i[0],a[0]),g[1]=Math.max(i[1],a[1]),g[2]=Math.max(i[2],a[2]),g}},13386:g=>{g.exports=function(g,i,a){return g[0]=Math.min(i[0],a[0]),g[1]=Math.min(i[1],a[1]),g[2]=Math.min(i[2],a[2]),g}},13375:(g,i,a)=>{g.exports=a(13367)},13367:g=>{g.exports=function(g,i,a){return g[0]=i[0]*a[0],g[1]=i[1]*a[1],g[2]=i[2]*a[2],g}},13481:g=>{g.exports=function(g,i){return g[0]=-i[0],g[1]=-i[1],g[2]=-i[2],g}},13311:g=>{g.exports=function(g,i){var a=i[0],n=i[1],L=i[2],d=a*a+n*n+L*L;d>0&&(d=1/Math.sqrt(d),g[0]=i[0]*d,g[1]=i[1]*d,g[2]=i[2]*d);return g}},13502:g=>{g.exports=function(g,i){i=i||1;var a=2*Math.random()*Math.PI,n=2*Math.random()-1,L=Math.sqrt(1-n*n)*i;return g[0]=Math.cos(a)*L,g[1]=Math.sin(a)*L,g[2]=n*i,g}},13529:g=>{g.exports=function(g,i,a,n){var L=a[1],d=a[2],b=i[1]-L,k=i[2]-d,e=Math.sin(n),N=Math.cos(n);return g[0]=i[0],g[1]=L+b*N-k*e,g[2]=d+b*e+k*N,g}},13537:g=>{g.exports=function(g,i,a,n){var L=a[0],d=a[2],b=i[0]-L,k=i[2]-d,e=Math.sin(n),N=Math.cos(n);return g[0]=L+k*e+b*N,g[1]=i[1],g[2]=d+k*N-b*e,g}},13543:g=>{g.exports=function(g,i,a,n){var L=a[0],d=a[1],b=i[0]-L,k=i[1]-d,e=Math.sin(n),N=Math.cos(n);return g[0]=L+b*N-k*e,g[1]=d+b*e+k*N,g[2]=i[2],g}},13415:g=>{g.exports=function(g,i){return g[0]=Math.round(i[0]),g[1]=Math.round(i[1]),g[2]=Math.round(i[2]),g}},13421:g=>{g.exports=function(g,i,a){return g[0]=i[0]*a,g[1]=i[1]*a,g[2]=i[2]*a,g}},13424:g=>{g.exports=function(g,i,a,n){return g[0]=i[0]+a[0]*n,g[1]=i[1]+a[1]*n,g[2]=i[2]+a[2]*n,g}},13329:g=>{g.exports=function(g,i,a,n){return g[0]=i,g[1]=a,g[2]=n,g}},13449:(g,i,a)=>{g.exports=a(13440)},13473:(g,i,a)=>{g.exports=a(13469)},13440:g=>{g.exports=function(g,i){var a=i[0]-g[0],n=i[1]-g[1],L=i[2]-g[2];return a*a+n*n+L*L}},13469:g=>{g.exports=function(g){var i=g[0],a=g[1],n=g[2];return i*i+a*a+n*n}},13364:(g,i,a)=>{g.exports=a(13360)},13360:g=>{g.exports=function(g,i,a){return g[0]=i[0]-a[0],g[1]=i[1]-a[1],g[2]=i[2]-a[2],g}},13518:g=>{g.exports=function(g,i,a){var n=i[0],L=i[1],d=i[2];return g[0]=n*a[0]+L*a[3]+d*a[6],g[1]=n*a[1]+L*a[4]+d*a[7],g[2]=n*a[2]+L*a[5]+d*a[8],g}},13510:g=>{g.exports=function(g,i,a){var n=i[0],L=i[1],d=i[2],b=a[3]*n+a[7]*L+a[11]*d+a[15];return b=b||1,g[0]=(a[0]*n+a[4]*L+a[8]*d+a[12])/b,g[1]=(a[1]*n+a[5]*L+a[9]*d+a[13])/b,g[2]=(a[2]*n+a[6]*L+a[10]*d+a[14])/b,g}},13526:g=>{g.exports=function(g,i,a){var n=i[0],L=i[1],d=i[2],b=a[0],k=a[1],e=a[2],N=a[3],F=N*n+k*d-e*L,I=N*L+e*n-b*d,j=N*d+b*L-k*n,y=-b*n-k*L-e*d;return g[0]=F*N+y*-b+I*-e-j*-k,g[1]=I*N+y*-k+j*-b-F*-e,g[2]=j*N+y*-e+F*-k-I*-b,g}},14469:g=>{"use strict";g.exports=function(g){for(var i=new Array(g),a=0;a<g;++a)i[a]=a;return i}},14534:g=>{g.exports=function(g){return null!=g&&null!=g.constructor&&"function"===typeof g.constructor.isBuffer&&g.constructor.isBuffer(g)}},14743:(g,i,a)=>{"use strict";a.d(i,{d:()=>n});class n{constructor(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.AI=!1,this.OI=!1,this.wI=30,this.tI=0,this.HI=!1,this.fullscreen=!1,this.sI=function(g){},this.mj=function(){},this.oI=function(){},this.ln=function(){},this.rI=function(g){},this.onFullscreenChanged=function(g){},N((()=>{!function(g,i){g._nowObject=performance||Date,g._lastTick=0,g._renderAccum=0,g._rt=0,g._frameCB=k.bind(null,g),requestAnimationFrame(g._frameCB),i>0&&(g._intervalCB=b.bind(null,g),g._interval=setInterval(g._intervalCB,Math.max(i,1e3/g.wI/2)))}(this,i),function(g,i){if(!i)return;var a=!1,n=!1;document.addEventListener("pointerlockchange",(n=>{a=document.pointerLockElement===i,g.rI(a)})),document.addEventListener("fullscreenchange",(a=>{n=document.fullscreenElement===i,g.onFullscreenChanged(n)})),Object.defineProperty(g,"HI",{get:()=>a,set:g=>{g&&!a?e(i):a&&!g&&function(g){g.exitPointerLock&&g.exitPointerLock()}(document)}}),Object.defineProperty(g,"fullscreen",{get:()=>n,set:g=>{g&&!n?i.requestFullscreen():n&&!g&&document.exitFullscreen()}}),i.addEventListener("click",(L=>{g.AI&&!a&&e(i),g.OI&&!n&&i.requestFullscreen()}));var L=()=>g.ln();if(window.ResizeObserver){new ResizeObserver(L).observe(i)}else window.addEventListener("resize",L)}(this,g),this.oI()}))}}var L=3,d=20;function b(g){for(var i=1e3/g.wI,a=g._nowObject.now()+d,n=0;g._nowObject.now()>=g._lastTick+i&&g._nowObject.now()<a&&++n<=L;)g.sI(i),g._lastTick+=i;var b=5*(i+5),k=g._nowObject.now();if(k-g._lastTick>b)for(;k>=g._lastTick+i;)g._lastTick+=i}function k(g){requestAnimationFrame(g._frameCB),b(g);var i=g._nowObject.now(),a=i-g._rt;if(g._rt=i,g.tI>0){g._renderAccum+=a;var n=1e3/g.tI;if(g._renderAccum<n)return;g._renderAccum=Math.min(g._renderAccum-n,n)}var L=1e3/g.wI,d=(i-g._lastTick)/L;g.mj(a,d,L)}function e(g){g.requestPointerLock&&g.requestPointerLock()}var N=g=>{if("loading"===document.readyState){var i=()=>{document.removeEventListener("readystatechange",i),g()};document.addEventListener("readystatechange",i)}else setTimeout(g,1)}},14466:(g,i,a)=>{var n=a(14469),L=a(14473),d="undefined"!==typeof Float64Array;function b(g,i){return g[0]-i[0]}function k(){var g,i=this.stride,a=new Array(i.length);for(g=0;g<a.length;++g)a[g]=[Math.abs(i[g]),g];a.sort(b);var n=new Array(a.length);for(g=0;g<n.length;++g)n[g]=a[g][1];return n}function e(g,i){var a=["View",i,"d",g].join("");i<0&&(a="View_Nil"+g);var L="generic"===g;if(-1===i){var d="function "+a+"(a){this.data=a;};var proto="+a+".prototype;proto.dtype='"+g+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+a+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+a+"(a){return new "+a+"(a);}";return new Function(d)()}if(0===i){d="function "+a+"(a,d) {this.data = a;this.offset = d};var proto="+a+".prototype;proto.dtype='"+g+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+a+"_copy() {return new "+a+"(this.data,this.offset)};proto.pick=function "+a+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+a+"_get(){return "+(L?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+a+"_set(v){return "+(L?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+a+"(a,b,c,d){return new "+a+"(a,d)}";return new Function("TrivialArray",d)(N[g][0])}d=["'use strict'"];var b=n(i),e=b.map((function(g){return"i"+g})),F="this.offset+"+b.map((function(g){return"this.stride["+g+"]*i"+g})).join("+"),I=b.map((function(g){return"b"+g})).join(","),j=b.map((function(g){return"c"+g})).join(",");d.push("function "+a+"(a,"+I+","+j+",d){this.data=a","this.shape=["+I+"]","this.stride=["+j+"]","this.offset=d|0}","var proto="+a+".prototype","proto.dtype='"+g+"'","proto.dimension="+i),d.push("Object.defineProperty(proto,'size',{get:function "+a+"_size(){return "+b.map((function(g){return"this.shape["+g+"]"})).join("*"),"}})"),1===i?d.push("proto.order=[0]"):(d.push("Object.defineProperty(proto,'order',{get:"),i<4?(d.push("function "+a+"_order(){"),2===i?d.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===i&&d.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):d.push("ORDER})")),d.push("proto.set=function "+a+"_set("+e.join(",")+",v){"),L?d.push("return this.data.set("+F+",v)}"):d.push("return this.data["+F+"]=v}"),d.push("proto.get=function "+a+"_get("+e.join(",")+"){"),L?d.push("return this.data.get("+F+")}"):d.push("return this.data["+F+"]}"),d.push("proto.index=function "+a+"_index(",e.join(),"){return "+F+"}"),d.push("proto.hi=function "+a+"_hi("+e.join(",")+"){return new "+a+"(this.data,"+b.map((function(g){return["(typeof i",g,"!=='number'||i",g,"<0)?this.shape[",g,"]:i",g,"|0"].join("")})).join(",")+","+b.map((function(g){return"this.stride["+g+"]"})).join(",")+",this.offset)}");var y=b.map((function(g){return"a"+g+"=this.shape["+g+"]"})),B=b.map((function(g){return"c"+g+"=this.stride["+g+"]"}));d.push("proto.lo=function "+a+"_lo("+e.join(",")+"){var b=this.offset,d=0,"+y.join(",")+","+B.join(","));for(var c=0;c<i;++c)d.push("if(typeof i"+c+"==='number'&&i"+c+">=0){d=i"+c+"|0;b+=c"+c+"*d;a"+c+"-=d}");d.push("return new "+a+"(this.data,"+b.map((function(g){return"a"+g})).join(",")+","+b.map((function(g){return"c"+g})).join(",")+",b)}"),d.push("proto.step=function "+a+"_step("+e.join(",")+"){var "+b.map((function(g){return"a"+g+"=this.shape["+g+"]"})).join(",")+","+b.map((function(g){return"b"+g+"=this.stride["+g+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(c=0;c<i;++c)d.push("if(typeof i"+c+"==='number'){d=i"+c+"|0;if(d<0){c+=b"+c+"*(a"+c+"-1);a"+c+"=ceil(-a"+c+"/d)}else{a"+c+"=ceil(a"+c+"/d)}b"+c+"*=d}");d.push("return new "+a+"(this.data,"+b.map((function(g){return"a"+g})).join(",")+","+b.map((function(g){return"b"+g})).join(",")+",c)}");var D=new Array(i),p=new Array(i);for(c=0;c<i;++c)D[c]="a[i"+c+"]",p[c]="b[i"+c+"]";d.push("proto.transpose=function "+a+"_transpose("+e+"){"+e.map((function(g,i){return g+"=("+g+"===undefined?"+i+":"+g+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+a+"(this.data,"+D.join(",")+","+p.join(",")+",this.offset)}"),d.push("proto.pick=function "+a+"_pick("+e+"){var a=[],b=[],c=this.offset");for(c=0;c<i;++c)d.push("if(typeof i"+c+"==='number'&&i"+c+">=0){c=(c+this.stride["+c+"]*i"+c+")|0}else{a.push(this.shape["+c+"]);b.push(this.stride["+c+"])}");return d.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),d.push("return function construct_"+a+"(data,shape,stride,offset){return new "+a+"(data,"+b.map((function(g){return"shape["+g+"]"})).join(",")+","+b.map((function(g){return"stride["+g+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",d.join("\n"))(N[g],k)}var N={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};g.exports=function(g,i,a,n){if(void 0===g)return(0,N.array[0])([]);"number"===typeof g&&(g=[g]),void 0===i&&(i=[g.length]);var b=i.length;if(void 0===a){a=new Array(b);for(var k=b-1,F=1;k>=0;--k)a[k]=F,F*=i[k]}if(void 0===n){n=0;for(k=0;k<b;++k)a[k]<0&&(n-=(i[k]-1)*a[k])}for(var I=function(g){if(L(g))return"buffer";if(d)switch(Object.prototype.toString.call(g)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(g)?"array":"generic"}(g),j=N[I];j.length<=b+1;)j.push(e(I,j.length-1));return(0,j[b+1])(g,i,a,n)}},14473:g=>{function i(g){return!!g.constructor&&"function"===typeof g.constructor.isBuffer&&g.constructor.isBuffer(g)}g.exports=function(g){return null!=g&&(i(g)||function(g){return"function"===typeof g.readFloatLE&&"function"===typeof g.slice&&i(g.slice(0,0))}(g)||!!g._isBuffer)}},14622:g=>{"use strict";var i=[],a=[],n=[],L=[],d=[],b=[],k=[],e=[],N=[],F=[],I=[],j=[];g.exports=function(g,y,B,c,D,p){for(var R=k,x=N,E=F,X=j,v=0;v<3;v++)R[v]=+B[v],E[v]=+y.max[v],x[v]=+y.base[v];p||(p=1e-10);var P=function(g,k,N,F,j,y){var B=i,c=a,D=n,p=L,R=d,x=b,E=e,X=Math.floor,v=0,P=0,Y=0,f=0,C=0;if(U(),0===Y)return 0;for(f=K();P<=Y;){if(S(f)&&V())return v;f=K()}for(v+=Y,C=0;C<3;C++)F[C]+=N[C],j[C]+=N[C];return v;function U(){if(P=0,0!==(Y=Math.sqrt(N[0]*N[0]+N[1]*N[1]+N[2]*N[2])))for(var g=0;g<3;g++){var i=N[g]>=0;p[g]=i?1:-1;var a=i?j[g]:F[g];B[g]=i?F[g]:j[g],c[g]=T(a,p[g]),D[g]=l(B[g],p[g]),E[g]=N[g]/Y,R[g]=Math.abs(1/E[g]);var n=i?c[g]+1-a:a-c[g];x[g]=R[g]<1/0?R[g]*n:1/0}}function S(i){for(var a=p[0],n=0===i?c[0]:D[0],L=c[0]+a,d=p[1],b=1===i?c[1]:D[1],k=c[1]+d,e=p[2],N=2===i?c[2]:D[2],F=c[2]+e,I=n;I!=L;I+=a)for(var j=b;j!=k;j+=d)for(var y=N;y!=F;y+=e)if(g(I,j,y))return!0;return!1}function V(){v+=P;var g=p[f],i=P/Y,a=I;for(C=0;C<3;C++){var n=N[C]*i;F[C]+=n,j[C]+=n,a[C]=N[C]-n}if(g>0?j[f]=Math.round(j[f]):F[f]=Math.round(F[f]),k(v,f,g,a))return!0;for(C=0;C<3;C++)N[C]=a[C];return U(),0===Y}function K(){var g=x[0]<x[1]?x[0]<x[2]?0:2:x[1]<x[2]?1:2,i=x[g]-P;for(P=x[g],c[g]+=p[g],x[g]+=R[g],C=0;C<3;C++)B[C]+=i*E[C],D[C]=l(B[C],p[C]);return g}function T(g,i){return X(g-i*y)}function l(g,i){return X(g+i*y)}}(g,c,R,x,E,p);if(!D){for(v=0;v<3;v++)X[v]=B[v]>0?E[v]-y.max[v]:x[v]-y.base[v];y.translate(X)}return P}},14783:(g,i,a)=>{"use strict";a.d(i,{d:()=>I});var n=a(14618),L=a(13280);class d{constructor(g,i,a,d,b,k,e){this.hF=new n(g.base,g.GF),this.Ma=i,this.friction=a,this.restitution=d,this.Mk=b,this.xB=k,this.qk=!!e,this.WF=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Pc=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.FF=L.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=L.create(),this._impulses=L.create(),this._sleepFrameCount=10}loadFromCopy(g){L.j(this.hF.base,g.hF.base),L.j(this.hF.GF,g.hF.GF),L.j(this.hF.max,g.hF.max),this.hF.mag=g.hF.mag,this.Ma=g.Ma,this.friction=g.friction,this.restitution=g.restitution,this.Mk=g.Mk,this.xB=g.xB,this.qk=g.qk,this.WF=g.WF,this.fluidDrag=g.fluidDrag,this.Pc=g.Pc,this.preventFallOffEdge=g.preventFallOffEdge,this.rolledBackLastTick=g.rolledBackLastTick,L.j(this.FF,g.FF),L.j(this.resting,g.resting),this.inFluid=g.inFluid,this._ratioInFluid=g._ratioInFluid,L.j(this._forces,g._forces),L.j(this._impulses,g._impulses),this._sleepFrameCount=g._sleepFrameCount}setPosition(g){b(g),L.ci(g,g,this.hF.base),this.hF.translate(g),this.yF()}XL(){return L.clone(this.hF.base)}applyForce(g){b(g),L.add(this._forces,this._forces,g),this.yF()}applyImpulse(g){b(g),L.add(this._impulses,this._impulses,g),this.yF()}yF(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var b=g=>{};var k=a(14618),e=a(13280),N=a(14622);function F(){this.WF=.1,this.fluidDrag=.4,this.be=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function I(g,i,a){g=Object.assign(new F,g),this.gravity=g.gravity||[0,-10,0],this.WF=g.WF||.1,this.be=g.be||2,this.fluidDrag=g.fluidDrag||.4,this.minBounceImpulse=g.minBounceImpulse,this.bodies=[],this.sy=g.sy,this.testSolid=i,this.testFluid=a}I.prototype.CB=function(g,i,a,n,L,b){g=g||new k([0,0,0],[1,1,1]),"undefined"==typeof i&&(i=1),"undefined"==typeof a&&(a=1),"undefined"==typeof n&&(n=0),"undefined"==typeof L&&(L=1);var e=new d(g,i,a,n,L,b);return this.bodies.push(e),e},I.prototype.UB=function(g){var i=this.bodies.indexOf(g);i<0||(this.bodies.splice(i,1),g.hF=g.xB=null)};var j=e.create(),y=e.create(),B=e.create(),c=e.create(),D=e.create(),p=e.create(),R=e.create(),x=new k([0,0,0],[1,1,1]),E=new d(x,1,1,0,1,(()=>{}),!1);function X(g,i,a){return i=a,i*=1-(1-g.ratioInFluid)**2}I.prototype.Se=function(g){g/=1e3;var i=A(0,e.squaredLength(this.gravity));this.bodies.forEach((a=>function(g,i,a,n){e.j(D,i.resting),g.sy&&E.loadFromCopy(i);if(i.Ma<=0)return e.set(i.FF,0,0,0),e.set(i._forces,0,0,0),void e.set(i._impulses,0,0,0);var L=n||0===i.Mk;if(function(g,i,a,n){if(i._sleepFrameCount>0)return!1;if(n)return!0;var L=!1,d=.5*a*a*i.Mk;return e.scale(t,g.gravity,d),N(g.testSolid,i.hF,t,(function(){return L=!0,!0}),!0),L}(g,i,a,L))return;i._sleepFrameCount--,function(g,i){var a=i.hF,n=Math.floor(a.base[0]),L=Math.floor(a.base[2]),d=Math.floor(a.base[1]),b=Math.floor(a.max[1]);if(!g.testFluid(n,d,L))return i.inFluid=!1,void(i.ratioInFluid=0);var k=1,N=d+1;for(;N<=b&&g.testFluid(n,N,L);)k++,N++;var F=(d+k-a.base[1])/a.GF[1];F>1&&(F=1);var I=a.GF[0]*a.GF[1]*a.GF[2]*F,j=P;e.scale(j,g.gravity,-g.be*I*i.Mk),i.applyForce(j),i.inFluid=!0,i.ratioInFluid=F}(g,i),z(i._forces),z(i._impulses),z(i.FF),z(i.resting),e.scale(j,i._forces,1/i.Ma),e.De(j,j,g.gravity,i.Mk),e.scale(y,i._impulses,1/i.Ma),e.De(y,y,j,a),e.add(i.FF,i.FF,y),i.friction&&(Y(g,0,i,y,a),Y(g,1,i,y,a),Y(g,2,i,y,a));var d=i.fluidDrag>=0?i.fluidDrag:g.fluidDrag,b=i.WF>=0?i.WF:g.WF,k=b,F=b;i.inFluid&&(k=X(i,k,i.fluidDragHoriz>=0?i.fluidDragHoriz:d),F=X(i,F,i.fluidDragVert>=0?i.fluidDragVert:d));k=Math.max(1-k*a/i.Ma,0),F=Math.max(1-F*a/i.Ma,0),e.set(v,k,F,k),e.multiply(i.FF,i.FF,v),e.scale(B,i.FF,a),e.set(i._forces,0,0,0),e.set(i._impulses,0,0,0),i.qk&&O(U,i.hF);e.j(p,B),e.set(R,0,0,0),i.preventFallOffEdge&&function(g,i,a,n){if(!i.resting[1]||a[1]>0)return;var L=Z;O(L,i.hF);for(var d=0;d<3;d+=2){e.set(l,0,0,0),l[d]=a[d];var b=!0;(b=(b=(b=(b=b&&!w(g,L.base[0]+l[0]+1e-5,L.base[1],L.base[2]+l[2]+1e-5))&&!w(g,L.max[0]+l[0]-1e-5,L.base[1],L.base[2]+l[2]+1e-5))&&!w(g,L.base[0]+l[0]+1e-5,L.base[1],L.max[2]+l[2]-1e-5))&&!w(g,L.max[0]+l[0]-1e-5,L.base[1],L.max[2]+l[2]-1e-5))?(n[d]=a[d]>0?1:-1,a[d]=0):0===d&&(e.set(h,a[0],0,0),C(g,L,h,n,i.slideOnCollision))}}(g,i,B,R);C(g,i.hF,B,i.resting,i.slideOnCollision),i.qk&&function(g,i,a,n){if(i.resting[1]>=0&&!i.inFluid)return;var L=0!==i.resting[0],d=0!==i.resting[2];if(!L&&!d)return;var b=Math.abs(n[0]/n[2]),k=4;if(!L&&b>k)return;if(!d&&b<1/k)return;e.add(V,a.base,n);var F=g.testSolid;N(F,a,n,(function(g,i,a,n){if(1!==i)return!0;n[i]=0}));var I=a.base[1],j=i.inFluid?1.951:1.001,y=Math.floor(I+j)-I;e.set(K,0,y,0);var B=!1;if(N(F,a,K,(function(g,i,a,n){return B=!0,!0})),B)return;e.ci(T,V,a.base),T[1]=0,C(g,a,T,S,!0);var c=A(a.base[0],V[0]),D=A(a.base[2],V[2]);if(L&&!c&&(!D||!d))return;if(d&&(!c||!L)&&!D)return;var p=!0;if(p=p&&!w(g,a.base[0]+1e-5,a.base[1],a.base[2]+1e-5),p=p&&!w(g,a.max[0]-1e-5,a.base[1],a.base[2]+1e-5),p=p&&!w(g,a.base[0]+1e-5,a.base[1],a.max[2]-1e-5),p=p&&!w(g,a.max[0]-1e-5,a.base[1],a.max[2]-1e-5),p)return;O(i.hF,a),i.resting[0]=S[0],i.resting[2]=S[2],i.Pc&&i.Pc()}(g,i,U,p);for(var I=0;I<3;++I)i.resting[I]=i.resting[I]||R[I],c[I]=0,i.resting[I]&&(D[I]||(c[I]=-i.FF[I]),i.FF[I]=0);var x=e.length(c);x>.001&&(e.scale(c,c,i.Ma),i.xB&&i.xB(c),i.restitution>0&&x>g.minBounceImpulse&&(e.scale(c,c,i.restitution),i.applyImpulse(c)));var f=e.squaredLength(i.FF);f>1e-5&&i.yF();g.sy&&g.sy(i)?(i.loadFromCopy(E),i.rolledBackLastTick=!0):i.rolledBackLastTick=!1}(this,a,g,i)))};var v=e.create([0,0,0]);var P=e.create();function Y(g,i,a,n,L){var d=a.resting[i],b=n[i];if(!a.alwaysApplyHorizFriction||1!==i){if(0===d)return;if(d*b<=0)return}e.j(f,a.FF),f[i]=0;var k=e.length(f);if(!A(k,0)){var N=Math.abs(a.friction*g.gravity[i]*L),F=k>N?(k-N)/k:0;a.FF[(i+1)%3]*=F,a.FF[(i+2)%3]*=F}}var f=e.create();function C(g,i,a,n,L){return e.set(n,0,0,0),N(g.testSolid,i,a,(function(g,i,a,d){n[i]=a,d[i]=0,L||(d[0]=0,d[1]=0,d[2]=0)}))}var U=new k([],[]),S=e.create(),V=e.create(),K=e.create(),T=e.create();var l=e.create(),Z=new k([],[]),h=e.create();function w(g,i,a,n){return g.testSolid(Math.floor(i),Math.floor(a-1),Math.floor(n))}var t=e.create();function A(g,i){return Math.abs(g-i)<1e-5}function O(g,i){for(var a=0;a<3;a++)g.base[a]=i.base[a],g.max[a]=i.max[a],g.GF[a]=i.GF[a]}var z=function(g){}},13140:function(g,i){!function(g){"use strict";var i=function(g,a){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,i){g.__proto__=i}||function(g,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(g[a]=i[a])},i(g,a)};function a(g,a){if("function"!==typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function n(){this.constructor=g}i(g,a),g.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}function n(g,i,a,n){var L,d=arguments.length,b=d<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,a):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)b=Reflect.decorate(g,i,a,n);else for(var k=g.length-1;k>=0;k--)(L=g[k])&&(b=(d<3?L(b):d>3?L(i,a,b):L(i,a))||b);return d>3&&b&&Object.defineProperty(i,a,b),b}function L(g,i,a){if(a||2===arguments.length)for(var n,L=0,d=i.length;L<d;L++)!n&&L in i||(n||(n=Array.prototype.slice.call(i,0,L)),n[L]=i[L]);return g.concat(n||Array.prototype.slice.call(i))}var d,b=255,k=213;g.OPERATION=void 0,(d=g.OPERATION||(g.OPERATION={}))[d.ADD=128]="ADD",d[d.REPLACE=0]="REPLACE",d[d.DELETE=64]="DELETE",d[d.DELETE_AND_ADD=192]="DELETE_AND_ADD",d[d.TOUCH=1]="TOUCH",d[d.CLEAR=10]="CLEAR";var e=function(){function i(g,i,a){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=g,this.setParent(i,a)}return i.prototype.setParent=function(g,i,a){var n=this;if(this.indexes||(this.indexes=this.ref instanceof Tg?this.ref._definition.indexes:{}),this.parent=g,this.parentIndex=a,i)if(this.root=i,this.ref instanceof Tg){var L=this.ref._definition;for(var d in L.schema){var b=this.ref[d];if(b&&b.$changes){var k=L.indexes[d];b.$changes.setParent(this.ref,i,k)}}}else"object"===typeof this.ref&&this.ref.forEach((function(g,i){if(g instanceof Tg){var a=g.$changes,L=n.ref.$changes.indexes[i];a.setParent(n.ref,n.root,L)}}))},i.prototype.operation=function(g){this.changes.set(--this.currentCustomOperation,g)},i.prototype.change=function(i,a){void 0===a&&(a=g.OPERATION.ADD);var n="number"===typeof i?i:this.indexes[i];this.assertValidIndex(n,i);var L=this.changes.get(n);L&&L.op!==g.OPERATION.DELETE&&L.op!==g.OPERATION.TOUCH||this.changes.set(n,{op:L&&L.op===g.OPERATION.DELETE?g.OPERATION.DELETE_AND_ADD:a,index:n}),this.allChanges.add(n),this.changed=!0,this.touchParents()},i.prototype.touch=function(i){var a="number"===typeof i?i:this.indexes[i];this.assertValidIndex(a,i),this.changes.has(a)||this.changes.set(a,{op:g.OPERATION.TOUCH,index:a}),this.allChanges.add(a),this.touchParents()},i.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},i.prototype.getType=function(g){if(this.ref._definition)return(i=this.ref._definition).schema[i.fieldsByIndex[g]];var i,a=(i=this.parent._definition).schema[i.fieldsByIndex[this.parentIndex]];return Object.values(a)[0]},i.prototype.getChildrenFilter=function(){var g=this.parent._definition.childFilters;return g&&g[this.parentIndex]},i.prototype.getValue=function(g){return this.ref.getByIndex(g)},i.prototype.delete=function(i){var a="number"===typeof i?i:this.indexes[i];if(void 0!==a){var n=this.getValue(a);this.changes.set(a,{op:g.OPERATION.DELETE,index:a}),this.allChanges.delete(a),delete this.caches[a],n&&n.$changes&&(n.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(i," (").concat(a,")"))},i.prototype.discard=function(i,a){var n=this;void 0===i&&(i=!1),void 0===a&&(a=!1),this.ref instanceof Tg||this.changes.forEach((function(i){if(i.op===g.OPERATION.DELETE){var a=n.ref.getIndex(i.index);delete n.indexes[a]}})),this.changes.clear(),this.changed=i,a&&this.allChanges.clear(),this.currentCustomOperation=0},i.prototype.discardAll=function(){var g=this;this.changes.forEach((function(i){var a=g.getValue(i.index);a&&a.$changes&&a.$changes.discardAll()})),this.discard()},i.prototype.cache=function(g,i){this.caches[g]=i},i.prototype.clone=function(){return new i(this.ref,this.parent,this.root)},i.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},i.prototype.assertValidIndex=function(g,i){if(void 0===g)throw new Error('ChangeTree: missing index for field "'.concat(i,'"'))},i}();function N(g,i,a,n){return g[i]||(g[i]=[]),g[i].push(a),null===n||void 0===n||n.forEach((function(g,i){return a(g,i)})),function(){return I(g[i],g[i].indexOf(a))}}function F(i){var a=this,n="string"!==typeof this.$changes.getType();this.$items.forEach((function(L,d){i.push({refId:a.$changes.refId,op:g.OPERATION.DELETE,field:d,value:void 0,previousValue:L}),n&&a.$changes.root.removeRef(L.$changes.refId)}))}function I(g,i){if(-1===i||i>=g.length)return!1;for(var a=g.length-1,n=i;n<a;n++)g[n]=g[n+1];return g.length=a,!0}var j=function(g,i){var a=g.toString(),n=i.toString();return a<n?-1:a>n?1:0};function y(g){return g.$proxy=!0,g=new Proxy(g,{get:function(g,i){return"symbol"===typeof i||isNaN(i)?g[i]:g.at(i)},set:function(g,i,a){if("symbol"===typeof i||isNaN(i))g[i]=a;else{var n=Array.from(g.$items.keys()),L=parseInt(n[i]||i);void 0===a||null===a?g.deleteAt(L):g.setAt(L,a)}return!0},deleteProperty:function(g,i){return"number"===typeof i?g.deleteAt(i):delete g[i],!0}})}var B=function(){function i(){for(var g=[],i=0;i<arguments.length;i++)g[i]=arguments[i];this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,g)}return i.prototype.le=function(i,a){return void 0===a&&(a=!0),N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.ADD,i,a?this.$items:void 0)},i.prototype.en=function(i){return N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.DELETE,i)},i.prototype.onChange=function(i){return N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.REPLACE,i)},i.is=function(g){return Array.isArray(g)||void 0!==g.array},Object.defineProperty(i.prototype,"length",{get:function(){return this.$items.size},set:function(g){0===g?this.clear():this.splice(g,this.length-g)},enumerable:!1,configurable:!0}),i.prototype.push=function(){for(var g,i=this,a=[],n=0;n<arguments.length;n++)a[n]=arguments[n];return a.forEach((function(a){g=i.$refId++,i.setAt(g,a)})),g},i.prototype.pop=function(){var g=Array.from(this.$indexes.values()).pop();if(void 0!==g){this.$changes.delete(g),this.$indexes.delete(g);var i=this.$items.get(g);return this.$items.delete(g),i}},i.prototype.at=function(g){var i=Array.from(this.$items.keys())[g];return this.$items.get(i)},i.prototype.setAt=function(i,a){var n,L;if(void 0!==a&&null!==a){if(this.$items.get(i)!==a){void 0!==a.$changes&&a.$changes.setParent(this,this.$changes.root,i);var d=null!==(L=null===(n=this.$changes.indexes[i])||void 0===n?void 0:n.op)&&void 0!==L?L:g.OPERATION.ADD;this.$changes.indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,a),this.$changes.change(i,d)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},i.prototype.deleteAt=function(g){var i=Array.from(this.$items.keys())[g];return void 0!==i&&this.$deleteAt(i)},i.prototype.$deleteAt=function(g){return this.$changes.delete(g),this.$indexes.delete(g),this.$items.delete(g)},i.prototype.clear=function(i){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),i&&F.call(this,i),this.$items.clear(),this.$changes.operation({index:0,op:g.OPERATION.CLEAR}),this.$changes.touchParents()},i.prototype.concat=function(){for(var g,a=[],n=0;n<arguments.length;n++)a[n]=arguments[n];return new(i.bind.apply(i,L([void 0],(g=Array.from(this.$items.values())).concat.apply(g,a),!1)))},i.prototype.join=function(g){return Array.from(this.$items.values()).join(g)},i.prototype.reverse=function(){var g=this,i=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(a,n){g.setAt(i[n],a)})),this},i.prototype.shift=function(){var g=Array.from(this.$items.keys()).shift();if(void 0!==g){var i=this.$items.get(g);return this.$deleteAt(g),i}},i.prototype.slice=function(g,a){var n=new i;return n.push.apply(n,Array.from(this.$items.values()).slice(g,a)),n},i.prototype.sort=function(g){var i=this;void 0===g&&(g=j);var a=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(g).forEach((function(g,n){i.setAt(a[n],g)})),this},i.prototype.splice=function(g,i){void 0===i&&(i=this.length-g);for(var a=Array.from(this.$items.keys()),n=[],L=g;L<g+i;L++)n.push(this.$items.get(a[L])),this.$deleteAt(a[L]);return n},i.prototype.unshift=function(){for(var g=this,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];var n=this.length,L=i.length,d=Array.from(this.$items.values());return i.forEach((function(i,a){g.setAt(a,i)})),d.forEach((function(i,a){g.setAt(L+a,i)})),n+L},i.prototype.indexOf=function(g,i){return Array.from(this.$items.values()).indexOf(g,i)},i.prototype.lastIndexOf=function(g,i){return void 0===i&&(i=this.length-1),Array.from(this.$items.values()).lastIndexOf(g,i)},i.prototype.every=function(g,i){return Array.from(this.$items.values()).every(g,i)},i.prototype.some=function(g,i){return Array.from(this.$items.values()).some(g,i)},i.prototype.forEach=function(g,i){Array.from(this.$items.values()).forEach(g,i)},i.prototype.map=function(g,i){return Array.from(this.$items.values()).map(g,i)},i.prototype.filter=function(g,i){return Array.from(this.$items.values()).filter(g,i)},i.prototype.reduce=function(g,i){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},i.prototype.reduceRight=function(g,i){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},i.prototype.find=function(g,i){return Array.from(this.$items.values()).find(g,i)},i.prototype.findIndex=function(g,i){return Array.from(this.$items.values()).findIndex(g,i)},i.prototype.fill=function(g,i,a){throw new Error("ArraySchema#fill() not implemented")},i.prototype.copyWithin=function(g,i,a){throw new Error("ArraySchema#copyWithin() not implemented")},i.prototype.toString=function(){return this.$items.toString()},i.prototype.toLocaleString=function(){return this.$items.toLocaleString()},i.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(i,Symbol.species,{get:function(){return i},enumerable:!1,configurable:!0}),i.prototype.entries=function(){return this.$items.entries()},i.prototype.keys=function(){return this.$items.keys()},i.prototype.values=function(){return this.$items.values()},i.prototype.includes=function(g,i){return Array.from(this.$items.values()).includes(g,i)},i.prototype.flatMap=function(g,i){throw new Error("ArraySchema#flatMap() is not supported.")},i.prototype.flat=function(g){throw new Error("ArraySchema#flat() is not supported.")},i.prototype.findLast=function(){var g=Array.from(this.$items.values());return g.findLast.apply(g,arguments)},i.prototype.findLastIndex=function(){var g=Array.from(this.$items.values());return g.findLastIndex.apply(g,arguments)},i.prototype.setIndex=function(g,i){this.$indexes.set(g,i)},i.prototype.getIndex=function(g){return this.$indexes.get(g)},i.prototype.getByIndex=function(g){return this.$items.get(this.$indexes.get(g))},i.prototype.deleteByIndex=function(g){var i=this.$indexes.get(g);this.$items.delete(i),this.$indexes.delete(g)},i.prototype.toArray=function(){return Array.from(this.$items.values())},i.prototype.toJSON=function(){return this.toArray().map((function(g){return"function"===typeof g.toJSON?g.toJSON():g}))},i.prototype.clone=function(g){return g?new(i.bind.apply(i,L([void 0],Array.from(this.$items.values()),!1))):new(i.bind.apply(i,L([void 0],this.map((function(g){return g.$changes?g.clone():g})),!1)))},i}();function c(g){return g.$proxy=!0,g=new Proxy(g,{get:function(g,i){return"symbol"!==typeof i&&"undefined"===typeof g[i]?g.get(i):g[i]},set:function(g,i,a){return"symbol"!==typeof i&&-1===i.indexOf("$")&&"le"!==i&&"en"!==i&&"onChange"!==i?g.set(i,a):g[i]=a,!0},deleteProperty:function(g,i){return g.delete(i),!0}})}var D=function(){function i(g){var a=this;if(this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,g)if(g instanceof Map||g instanceof i)g.forEach((function(g,i){return a.set(i,g)}));else for(var n in g)this.set(n,g[n])}return i.prototype.le=function(i,a){return void 0===a&&(a=!0),N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.ADD,i,a?this.$items:void 0)},i.prototype.en=function(i){return N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.DELETE,i)},i.prototype.onChange=function(i){return N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.REPLACE,i)},i.is=function(g){return void 0!==g.map},i.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(i.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(i,Symbol.species,{get:function(){return i},enumerable:!1,configurable:!0}),i.prototype.set=function(i,a){if(void 0===a||null===a)throw new Error("MapSchema#set('".concat(i,"', ").concat(a,"): trying to set ").concat(a," value on '").concat(i,"'."));i=i.toString();var n="undefined"!==typeof this.$changes.indexes[i],L=n?this.$changes.indexes[i]:this.$refId++,d=n?g.OPERATION.REPLACE:g.OPERATION.ADD,b=void 0!==a.$changes;if(b&&a.$changes.setParent(this,this.$changes.root,L),n){if(!b&&this.$items.get(i)===a)return;b&&this.$items.get(i)!==a&&(d=g.OPERATION.ADD)}else this.$changes.indexes[i]=L,this.$indexes.set(L,i);return this.$items.set(i,a),this.$changes.change(i,d),this},i.prototype.get=function(g){return this.$items.get(g)},i.prototype.delete=function(g){return this.$changes.delete(g),this.$items.delete(g)},i.prototype.clear=function(i){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),i&&F.call(this,i),this.$items.clear(),this.$changes.operation({index:0,op:g.OPERATION.CLEAR}),this.$changes.touchParents()},i.prototype.has=function(g){return this.$items.has(g)},i.prototype.forEach=function(g){this.$items.forEach(g)},i.prototype.entries=function(){return this.$items.entries()},i.prototype.keys=function(){return this.$items.keys()},i.prototype.values=function(){return this.$items.values()},Object.defineProperty(i.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),i.prototype.setIndex=function(g,i){this.$indexes.set(g,i)},i.prototype.getIndex=function(g){return this.$indexes.get(g)},i.prototype.getByIndex=function(g){return this.$items.get(this.$indexes.get(g))},i.prototype.deleteByIndex=function(g){var i=this.$indexes.get(g);this.$items.delete(i),this.$indexes.delete(g)},i.prototype.toJSON=function(){var g={};return this.forEach((function(i,a){g[a]="function"===typeof i.toJSON?i.toJSON():i})),g},i.prototype.clone=function(g){var a;return g?a=Object.assign(new i,this):(a=new i,this.forEach((function(g,i){g.$changes?a.set(i,g.clone()):a.set(i,g)}))),a},i}(),p={};function R(g,i){p[g]=i}function x(g){return p[g]}var E=function(){function g(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return g.create=function(i){var a=new g;return a.schema=Object.assign({},i&&i.schema||{}),a.indexes=Object.assign({},i&&i.indexes||{}),a.fieldsByIndex=Object.assign({},i&&i.fieldsByIndex||{}),a.descriptors=Object.assign({},i&&i.descriptors||{}),a.deprecated=Object.assign({},i&&i.deprecated||{}),a},g.prototype.addField=function(g,i){var a=this.getNextFieldIndex();this.fieldsByIndex[a]=g,this.indexes[g]=a,this.schema[g]=Array.isArray(i)?{array:i[0]}:i},g.prototype.hasField=function(g){return void 0!==this.indexes[g]},g.prototype.addFilter=function(g,i){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[g]]=i,this.indexesWithFilters.push(this.indexes[g]),!0},g.prototype.addChildrenFilter=function(g,i){var a=this.indexes[g],n=this.schema[g];if(x(Object.keys(n)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[a]=i,!0;console.warn("@filterChildren: field '".concat(g,"' can't have children. Ignoring filter."))},g.prototype.getChildrenFilter=function(g){return this.childFilters&&this.childFilters[this.indexes[g]]},g.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},g}();function X(g){return g._context&&g._context.useFilters}var v=function(){function g(){this.types={},this.schemas=new Map,this.useFilters=!1}return g.prototype.has=function(g){return this.schemas.has(g)},g.prototype.get=function(g){return this.types[g]},g.prototype.add=function(g,i){void 0===i&&(i=this.schemas.size),g._definition=E.create(g._definition),g._typeid=i,this.types[i]=g,this.schemas.set(g,i)},g.create=function(i){return void 0===i&&(i={}),function(a){return i.context||(i.context=new g),Y(a,i)}},g}(),P=new v;function Y(g,i){return void 0===i&&(i={}),function(a,n){var d=i.context||P,b=a.constructor;if(b._context=d,!g)throw new Error("".concat(b.name,': @type() reference provided for "').concat(n,"\" is undefined. Make sure you don't have any circular dependencies."));d.has(b)||d.add(b);var k=b._definition;if(k.addField(n,g),k.descriptors[n]){if(k.deprecated[n])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(n,"' definition on '").concat(b.name,"'.\nCheck @type() annotation"))}catch(p){var e=p.stack.split("\n")[4].trim();throw new Error("".concat(p.message," ").concat(e))}}var N=B.is(g),F=!N&&D.is(g);if("string"!==typeof g&&!Tg.is(g)){var I=Object.values(g)[0];"string"===typeof I||d.has(I)||d.add(I)}if(i.manual)k.descriptors[n]={enumerable:!0,configurable:!0,writable:!0};else{var j="_".concat(n);k.descriptors[j]={enumerable:!1,configurable:!1,writable:!0},k.descriptors[n]={get:function(){return this[j]},set:function(g){g!==this[j]&&(void 0!==g&&null!==g?(!N||g instanceof B||(g=new(B.bind.apply(B,L([void 0],g,!1)))),!F||g instanceof D||(g=new D(g)),void 0===g.$proxy&&(F?g=c(g):N&&(g=y(g))),this.$changes.change(n),g.$changes&&g.$changes.setParent(this,this.$changes.root,this._definition.indexes[n])):this[j]&&this.$changes.delete(n),this[j]=g)},enumerable:!0,configurable:!0}}}}function f(g){return function(i,a){var n=i.constructor;n._definition.addFilter(a,g)&&(n._context.useFilters=!0)}}function C(g){return function(i,a){var n=i.constructor;n._definition.addChildrenFilter(a,g)&&(n._context.useFilters=!0)}}function U(g){return void 0===g&&(g=!0),function(i,a){var n=i.constructor._definition;n.deprecated[a]=!0,g&&(n.descriptors[a]={get:function(){throw new Error("".concat(a," is deprecated."))},set:function(g){},enumerable:!1,configurable:!0})}}function S(g,i,a){for(var n in void 0===a&&(a={}),a.context||(a.context=g._context||a.context||P),i)Y(i[n],a)(g.prototype,n);return g}function V(g){for(var i=0,a=0,n=0,L=g.length;n<L;n++)(i=g.charCodeAt(n))<128?a+=1:i<2048?a+=2:i<55296||i>=57344?a+=3:(n++,a+=4);return a}function K(g,i,a){for(var n=0,L=0,d=a.length;L<d;L++)(n=a.charCodeAt(L))<128?g[i++]=n:n<2048?(g[i++]=192|n>>6,g[i++]=128|63&n):n<55296||n>=57344?(g[i++]=224|n>>12,g[i++]=128|n>>6&63,g[i++]=128|63&n):(L++,n=65536+((1023&n)<<10|1023&a.charCodeAt(L)),g[i++]=240|n>>18,g[i++]=128|n>>12&63,g[i++]=128|n>>6&63,g[i++]=128|63&n)}function T(g,i){g.push(255&i)}function l(g,i){g.push(255&i)}function Z(g,i){g.push(255&i),g.push(i>>8&255)}function h(g,i){g.push(255&i),g.push(i>>8&255)}function w(g,i){g.push(255&i),g.push(i>>8&255),g.push(i>>16&255),g.push(i>>24&255)}function t(g,i){var a=i>>24,n=i>>16,L=i>>8,d=i;g.push(255&d),g.push(255&L),g.push(255&n),g.push(255&a)}function A(g,i){var a=Math.floor(i/Math.pow(2,32));t(g,i>>>0),t(g,a)}function O(g,i){var a=i/Math.pow(2,32)|0;t(g,i>>>0),t(g,a)}function z(g,i){o(g,i)}function s(g,i){u(g,i)}var mg=new Int32Array(2),r=new Float32Array(mg.buffer),Q=new Float64Array(mg.buffer);function o(g,i){r[0]=i,w(g,mg[0])}function u(g,i){Q[0]=i,w(g,mg[0]),w(g,mg[1])}function H(g,i){return l(g,i?1:0)}function M(g,i){i||(i="");var a=V(i),n=0;if(a<32)g.push(160|a),n=1;else if(a<256)g.push(217),l(g,a),n=2;else if(a<65536)g.push(218),h(g,a),n=3;else{if(!(a<4294967296))throw new Error("String too long");g.push(219),t(g,a),n=5}return K(g,g.length,i),n+a}function q(g,i){return isNaN(i)?q(g,0):isFinite(i)?i!==(0|i)?(g.push(203),u(g,i),9):i>=0?i<128?(l(g,i),1):i<256?(g.push(204),l(g,i),2):i<65536?(g.push(205),h(g,i),3):i<4294967296?(g.push(206),t(g,i),5):(g.push(207),O(g,i),9):i>=-32?(g.push(224|i+32),1):i>=-128?(g.push(208),T(g,i),2):i>=-32768?(g.push(209),Z(g,i),3):i>=-2147483648?(g.push(210),w(g,i),5):(g.push(211),A(g,i),9):q(g,i>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var W=Object.freeze({__proto__:null,utf8Write:K,int8:T,uint8:l,int16:Z,uint16:h,int32:w,uint32:t,int64:A,uint64:O,float32:z,float64:s,writeFloat32:o,writeFloat64:u,boolean:H,string:M,number:q});function G(g,i,a){for(var n="",L=0,d=i,b=i+a;d<b;d++){var k=g[d];0!==(128&k)?192!==(224&k)?224!==(240&k)?240!==(248&k)?console.error("Invalid byte "+k.toString(16)):(L=(7&k)<<18|(63&g[++d])<<12|(63&g[++d])<<6|63&g[++d])>=65536?(L-=65536,n+=String.fromCharCode(55296+(L>>>10),56320+(1023&L))):n+=String.fromCharCode(L):n+=String.fromCharCode((15&k)<<12|(63&g[++d])<<6|63&g[++d]):n+=String.fromCharCode((31&k)<<6|63&g[++d]):n+=String.fromCharCode(k)}return n}function J(g,i){return gg(g,i)<<24>>24}function gg(g,i){return g[i.offset++]}function ig(g,i){return ag(g,i)<<16>>16}function ag(g,i){return g[i.offset++]|g[i.offset++]<<8}function ng(g,i){return g[i.offset++]|g[i.offset++]<<8|g[i.offset++]<<16|g[i.offset++]<<24}function Lg(g,i){return ng(g,i)>>>0}function dg(g,i){return jg(g,i)}function bg(g,i){return yg(g,i)}function kg(g,i){var a=Lg(g,i);return ng(g,i)*Math.pow(2,32)+a}function eg(g,i){var a=Lg(g,i);return Lg(g,i)*Math.pow(2,32)+a}var Ng=new Int32Array(2),Fg=new Float32Array(Ng.buffer),Ig=new Float64Array(Ng.buffer);function jg(g,i){return Ng[0]=ng(g,i),Fg[0]}function yg(g,i){return Ng[0]=ng(g,i),Ng[1]=ng(g,i),Ig[0]}function Bg(g,i){return gg(g,i)>0}function cg(g,i){var a,n=g[i.offset++];n<192?a=31&n:217===n?a=gg(g,i):218===n?a=ag(g,i):219===n&&(a=Lg(g,i));var L=G(g,i.offset,a);return i.offset+=a,L}function Dg(g,i){var a=g[i.offset];return a<192&&a>160||217===a||218===a||219===a}function pg(g,i){var a=g[i.offset++];return a<128?a:202===a?jg(g,i):203===a?yg(g,i):204===a?gg(g,i):205===a?ag(g,i):206===a?Lg(g,i):207===a?eg(g,i):208===a?J(g,i):209===a?ig(g,i):210===a?ng(g,i):211===a?kg(g,i):a>223?-1*(255-a+1):void 0}function Rg(g,i){var a=g[i.offset];return a<128||a>=202&&a<=211}function xg(g,i){return g[i.offset]<160}function Eg(g,i){return g[i.offset-1]===b&&(g[i.offset]<128||g[i.offset]>=202&&g[i.offset]<=211)}var Xg=Object.freeze({__proto__:null,int8:J,uint8:gg,int16:ig,uint16:ag,int32:ng,uint32:Lg,float32:dg,float64:bg,int64:kg,uint64:eg,readFloat32:jg,readFloat64:yg,boolean:Bg,string:cg,stringCheck:Dg,number:pg,numberCheck:Rg,arrayCheck:xg,switchStructureCheck:Eg}),vg=function(){function i(g){var i=this;this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,g&&g.forEach((function(g){return i.add(g)}))}return i.prototype.le=function(i,a){return void 0===a&&(a=!0),N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.ADD,i,a?this.$items:void 0)},i.prototype.en=function(i){return N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.DELETE,i)},i.prototype.onChange=function(i){return N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.REPLACE,i)},i.is=function(g){return void 0!==g.collection},i.prototype.add=function(g){var i=this.$refId++;return void 0!==g.$changes&&g.$changes.setParent(this,this.$changes.root,i),this.$changes.indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,g),this.$changes.change(i),i},i.prototype.at=function(g){var i=Array.from(this.$items.keys())[g];return this.$items.get(i)},i.prototype.entries=function(){return this.$items.entries()},i.prototype.delete=function(g){for(var i,a,n=this.$items.entries();(a=n.next())&&!a.done;)if(g===a.value[1]){i=a.value[0];break}return void 0!==i&&(this.$changes.delete(i),this.$indexes.delete(i),this.$items.delete(i))},i.prototype.clear=function(i){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),i&&F.call(this,i),this.$items.clear(),this.$changes.operation({index:0,op:g.OPERATION.CLEAR}),this.$changes.touchParents()},i.prototype.has=function(g){return Array.from(this.$items.values()).some((function(i){return i===g}))},i.prototype.forEach=function(g){var i=this;this.$items.forEach((function(a,n,L){return g(a,n,i)}))},i.prototype.values=function(){return this.$items.values()},Object.defineProperty(i.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),i.prototype.setIndex=function(g,i){this.$indexes.set(g,i)},i.prototype.getIndex=function(g){return this.$indexes.get(g)},i.prototype.getByIndex=function(g){return this.$items.get(this.$indexes.get(g))},i.prototype.deleteByIndex=function(g){var i=this.$indexes.get(g);this.$items.delete(i),this.$indexes.delete(g)},i.prototype.toArray=function(){return Array.from(this.$items.values())},i.prototype.toJSON=function(){var g=[];return this.forEach((function(i,a){g.push("function"===typeof i.toJSON?i.toJSON():i)})),g},i.prototype.clone=function(g){var a;return g?a=Object.assign(new i,this):(a=new i,this.forEach((function(g){g.$changes?a.add(g.clone()):a.add(g)}))),a},i}(),Pg=function(){function i(g){var i=this;this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,g&&g.forEach((function(g){return i.add(g)}))}return i.prototype.le=function(i,a){return void 0===a&&(a=!0),N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.ADD,i,a?this.$items:void 0)},i.prototype.en=function(i){return N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.DELETE,i)},i.prototype.onChange=function(i){return N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.REPLACE,i)},i.is=function(g){return void 0!==g.set},i.prototype.add=function(i){var a,n;if(this.has(i))return!1;var L=this.$refId++;void 0!==i.$changes&&i.$changes.setParent(this,this.$changes.root,L);var d=null!==(n=null===(a=this.$changes.indexes[L])||void 0===a?void 0:a.op)&&void 0!==n?n:g.OPERATION.ADD;return this.$changes.indexes[L]=L,this.$indexes.set(L,L),this.$items.set(L,i),this.$changes.change(L,d),L},i.prototype.entries=function(){return this.$items.entries()},i.prototype.delete=function(g){for(var i,a,n=this.$items.entries();(a=n.next())&&!a.done;)if(g===a.value[1]){i=a.value[0];break}return void 0!==i&&(this.$changes.delete(i),this.$indexes.delete(i),this.$items.delete(i))},i.prototype.clear=function(i){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),i&&F.call(this,i),this.$items.clear(),this.$changes.operation({index:0,op:g.OPERATION.CLEAR}),this.$changes.touchParents()},i.prototype.has=function(g){for(var i,a=this.$items.values(),n=!1;(i=a.next())&&!i.done;)if(g===i.value){n=!0;break}return n},i.prototype.forEach=function(g){var i=this;this.$items.forEach((function(a,n,L){return g(a,n,i)}))},i.prototype.values=function(){return this.$items.values()},Object.defineProperty(i.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),i.prototype.setIndex=function(g,i){this.$indexes.set(g,i)},i.prototype.getIndex=function(g){return this.$indexes.get(g)},i.prototype.getByIndex=function(g){return this.$items.get(this.$indexes.get(g))},i.prototype.deleteByIndex=function(g){var i=this.$indexes.get(g);this.$items.delete(i),this.$indexes.delete(g)},i.prototype.toArray=function(){return Array.from(this.$items.values())},i.prototype.toJSON=function(){var g=[];return this.forEach((function(i,a){g.push("function"===typeof i.toJSON?i.toJSON():i)})),g},i.prototype.clone=function(g){var a;return g?a=Object.assign(new i,this):(a=new i,this.forEach((function(g){g.$changes?a.add(g.clone()):a.add(g)}))),a},i}(),Yg=function(){function g(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return g.prototype.addRefId=function(g){this.refIds.has(g)||(this.refIds.add(g),this.containerIndexes.set(g,new Set))},g.get=function(i){return void 0===i.$filterState&&(i.$filterState=new g),i.$filterState},g}(),fg=function(){function g(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return g.prototype.getNextUniqueId=function(){return this.nextUniqueId++},g.prototype.addRef=function(g,i,a){void 0===a&&(a=!0),this.refs.set(g,i),a&&(this.refCounts[g]=(this.refCounts[g]||0)+1)},g.prototype.removeRef=function(g){this.refCounts[g]=this.refCounts[g]-1,this.deletedRefs.add(g)},g.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},g.prototype.garbageCollectDeletedRefs=function(){var g=this;this.deletedRefs.forEach((function(i){if(!(g.refCounts[i]>0)){var a=g.refs.get(i);if(a instanceof Tg)for(var n in a._definition.schema)"string"!==typeof a._definition.schema[n]&&a[n]&&a[n].$changes&&g.removeRef(a[n].$changes.refId);else{var L=a.$changes.parent._definition,d=L.schema[L.fieldsByIndex[a.$changes.parentIndex]];"function"===typeof Object.values(d)[0]&&Array.from(a.values()).forEach((function(i){return g.removeRef(i.$changes.refId)}))}g.refs.delete(i),delete g.refCounts[i]}})),this.deletedRefs.clear()},g}(),Cg=function(g){function i(){return null!==g&&g.apply(this,arguments)||this}return a(i,g),i}(Error);function Ug(g,i,a,n){var L,d=!1;switch(i){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":L="number",isNaN(g)&&console.log('trying to encode "NaN" in '.concat(a.constructor.name,"#").concat(n));break;case"string":L="string",d=!0;break;case"boolean":return}if(typeof g!==L&&(!d||d&&null!==g)){var b="'".concat(JSON.stringify(g),"'").concat(g&&g.constructor&&" (".concat(g.constructor.name,")")||"");throw new Cg("a '".concat(L,"' was expected, but ").concat(b," was provided in ").concat(a.constructor.name,"#").concat(n))}}function Sg(g,i,a,n){if(!(g instanceof i))throw new Cg("a '".concat(i.name,"' was expected, but '").concat(g.constructor.name,"' was provided in ").concat(a.constructor.name,"#").concat(n))}function Vg(g,i,a,n,L){Ug(a,g,n,L);var d=W[g];if(!d)throw new Cg("a '".concat(g,"' was expected, but ").concat(a," was provided in ").concat(n.constructor.name,"#").concat(L));d(i,a)}function Kg(g,i,a){return Xg[g](i,a)}var Tg=function(){function i(){for(var g=[],i=0;i<arguments.length;i++)g[i]=arguments[i];Object.defineProperties(this,{$changes:{value:new e(this,void 0,new fg),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var a=this._definition.descriptors;a&&Object.defineProperties(this,a),g[0]&&this.assign(g[0])}return i.onError=function(g){console.error(g)},i.is=function(g){return g._definition&&void 0!==g._definition.schema},i.prototype.onChange=function(i){return N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.REPLACE,i)},i.prototype.en=function(i){return N(this.$callbacks||(this.$callbacks=[]),g.OPERATION.DELETE,i)},i.prototype.assign=function(g){return Object.assign(this,g),this},Object.defineProperty(i.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),i.prototype.setDirty=function(g,i){this.$changes.change(g,i)},i.prototype.listen=function(g,i,a){var n=this;return void 0===a&&(a=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[g]||(this.$callbacks[g]=[]),this.$callbacks[g].push(i),a&&void 0!==this[g]&&i(this[g],void 0),function(){return I(n.$callbacks[g],n.$callbacks[g].indexOf(i))}},i.prototype.decode=function(a,n,L){var d;void 0===n&&(n={offset:0}),void 0===L&&(L=this);var k=[],e=this.$changes.root,N=a.length,F=0;for(e.refs.set(F,this);n.offset<N;){var I=a[n.offset++];if(I!=b){var j=L.$changes,y=void 0!==L._definition,c=y?I>>6<<6:I;if(c!==g.OPERATION.CLEAR){var p=y?I%(c||255):pg(a,n),R=y?L._definition.fieldsByIndex[p]:"",E=j.getType(p),X=void 0,v=void 0,P=void 0;if(y?v=L["_".concat(R)]:(v=L.getByIndex(p),(c&g.OPERATION.ADD)===g.OPERATION.ADD?(P=L instanceof D?cg(a,n):p,L.setIndex(p,P)):P=L.getIndex(p)),(c&g.OPERATION.DELETE)===g.OPERATION.DELETE&&(c!==g.OPERATION.DELETE_AND_ADD&&L.deleteByIndex(p),v&&v.$changes&&e.removeRef(v.$changes.refId),X=null),void 0!==R){if(c===g.OPERATION.DELETE);else if(i.is(E)){var Y=pg(a,n);if(X=e.refs.get(Y),c!==g.OPERATION.REPLACE){var f=this.getSchemaType(a,n,E);X||((X=this.createTypeInstance(f)).$changes.refId=Y,v&&(X.$callbacks=v.$callbacks,v.$changes.refId&&Y!==v.$changes.refId&&e.removeRef(v.$changes.refId))),e.addRef(Y,X,X!==v)}}else if("string"===typeof E)X=Kg(E,a,n);else{var C=x(Object.keys(E)[0]),U=pg(a,n),S=e.refs.has(U)?v||e.refs.get(U):new C.constructor;if((X=S.clone(!0)).$changes.refId=U,v&&(X.$callbacks=v.$callbacks,v.$changes.refId&&U!==v.$changes.refId)){e.removeRef(v.$changes.refId);for(var V=v.entries(),K=void 0;(K=V.next())&&!K.done;){var T=(d=K.value)[0],l=d[1];k.push({refId:U,op:g.OPERATION.DELETE,field:T,value:void 0,previousValue:l})}}e.addRef(U,X,S!==v)}if(null!==X&&void 0!==X)if(X.$changes&&X.$changes.setParent(j.ref,j.root,p),L instanceof i)L[R]=X;else if(L instanceof D)T=P,L.$items.set(T,X),L.$changes.allChanges.add(p);else if(L instanceof B)L.setAt(p,X);else if(L instanceof vg){var Z=L.add(X);L.setIndex(p,Z)}else L instanceof Pg&&!1!==(Z=L.add(X))&&L.setIndex(p,Z);v!==X&&k.push({refId:F,op:c,field:R,dynamicIndex:P,value:X,previousValue:v})}else{console.warn("@colyseus/schema: definition mismatch");for(var h={offset:n.offset};n.offset<N&&(!Eg(a,n)||(h.offset=n.offset+1,!e.refs.has(pg(a,h))));)n.offset++}}else L.clear(k)}else{F=pg(a,n);var w=e.refs.get(F);if(!w)throw new Error('"refId" not found: '.concat(F));L=w}}return this._triggerChanges(k),e.garbageCollectDeletedRefs(),k},i.prototype.encode=function(a,n,L){void 0===a&&(a=!1),void 0===n&&(n=[]),void 0===L&&(L=!1);for(var d=this.$changes,k=new WeakSet,e=[d],N=1,F=0;F<N;F++){var I=e[F],j=I.ref,y=j instanceof i;I.ensureRefId(),k.add(I),I!==d&&(I.changed||a)&&(l(n,b),q(n,I.refId));for(var B=a?Array.from(I.allChanges):Array.from(I.changes.values()),c=0,p=B.length;c<p;c++){var R=a?{op:g.OPERATION.ADD,index:B[c]}:B[c],E=R.index,X=y?j._definition.fieldsByIndex&&j._definition.fieldsByIndex[E]:E,v=n.length;if(R.op!==g.OPERATION.TOUCH)if(y)l(n,E|R.op);else{if(l(n,R.op),R.op===g.OPERATION.CLEAR)continue;q(n,E)}if(y||(R.op&g.OPERATION.ADD)!=g.OPERATION.ADD||j instanceof D&&M(n,I.ref.$indexes.get(E)),R.op!==g.OPERATION.DELETE){var P=I.getType(E),Y=I.getValue(E);if(Y&&Y.$changes&&!k.has(Y.$changes)&&(e.push(Y.$changes),Y.$changes.ensureRefId(),N++),R.op!==g.OPERATION.TOUCH){if(i.is(P))Sg(Y,P,j,X),q(n,Y.$changes.refId),(R.op&g.OPERATION.ADD)===g.OPERATION.ADD&&this.tryEncodeTypeId(n,P,Y.constructor);else if("string"===typeof P)Vg(P,n,Y,j,X);else{var f=x(Object.keys(P)[0]);Sg(j["_".concat(X)],f.constructor,j,X),q(n,Y.$changes.refId)}L&&I.cache(E,n.slice(v))}}}a||L||I.discard()}return n},i.prototype.encodeAll=function(g){return this.encode(!0,[],g)},i.prototype.applyFilters=function(a,n){var L,d;void 0===n&&(n=!1);for(var k=this,e=new Set,N=Yg.get(a),F=[this.$changes],I=1,j=[],y=function(y){var B=F[y];if(e.has(B.refId))return"continue";var c=B.ref,p=c instanceof i;l(j,b),q(j,B.refId);var R=N.refIds.has(B),x=n||!R;N.addRefId(B);var E=N.containerIndexes.get(B),X=x?Array.from(B.allChanges):Array.from(B.changes.values());!n&&p&&c._definition.indexesWithFilters&&c._definition.indexesWithFilters.forEach((function(i){!E.has(i)&&B.allChanges.has(i)&&(x?X.push(i):X.push({op:g.OPERATION.ADD,index:i}))}));for(var v=0,P=X.length;v<P;v++){var Y=x?{op:g.OPERATION.ADD,index:X[v]}:X[v];if(Y.op!==g.OPERATION.CLEAR){var f=Y.index;if(Y.op!==g.OPERATION.DELETE){var C=B.getValue(f),U=B.getType(f);if(p){if((S=c._definition.filters&&c._definition.filters[f])&&!S.call(c,a,C,k)){C&&C.$changes&&e.add(C.$changes.refId);continue}}else{var S,V=B.parent;if((S=B.getChildrenFilter())&&!S.call(V,a,c.$indexes.get(f),C,k)){C&&C.$changes&&e.add(C.$changes.refId);continue}}if(C.$changes&&(F.push(C.$changes),I++),Y.op!==g.OPERATION.TOUCH)if(Y.op===g.OPERATION.ADD||p)j.push.apply(j,null!==(L=B.caches[f])&&void 0!==L?L:[]),E.add(f);else if(E.has(f))j.push.apply(j,null!==(d=B.caches[f])&&void 0!==d?d:[]);else{if(E.add(f),l(j,g.OPERATION.ADD),q(j,f),c instanceof D){var K=B.ref.$indexes.get(f);M(j,K)}C.$changes?q(j,C.$changes.refId):W[U](j,C)}else C.$changes&&!p&&(l(j,g.OPERATION.ADD),q(j,f),c instanceof D&&(K=B.ref.$indexes.get(f),M(j,K)),q(j,C.$changes.refId))}else p?l(j,Y.op|f):(l(j,Y.op),q(j,f))}else l(j,Y.op)}},B=0;B<I;B++)y(B);return j},i.prototype.clone=function(){var g,i=new this.constructor,a=this._definition.schema;for(var n in a)"object"===typeof this[n]&&"function"===typeof(null===(g=this[n])||void 0===g?void 0:g.clone)?i[n]=this[n].clone():i[n]=this[n];return i},i.prototype.toJSON=function(){var g=this._definition.schema,i=this._definition.deprecated,a={};for(var n in g)i[n]||null===this[n]||"undefined"===typeof this[n]||(a[n]="function"===typeof this[n].toJSON?this[n].toJSON():this["_".concat(n)]);return a},i.prototype.discardAllChanges=function(){this.$changes.discardAll()},i.prototype.getByIndex=function(g){return this[this._definition.fieldsByIndex[g]]},i.prototype.deleteByIndex=function(g){this[this._definition.fieldsByIndex[g]]=void 0},i.prototype.tryEncodeTypeId=function(g,i,a){i._typeid!==a._typeid&&(l(g,k),q(g,a._typeid))},i.prototype.getSchemaType=function(g,i,a){var n;return g[i.offset]===k&&(i.offset++,n=this.constructor._context.get(pg(g,i))),n||a},i.prototype.createTypeInstance=function(g){var i=new g;return i.$changes.root=this.$changes.root,i},i.prototype._triggerChanges=function(a){for(var n,L,d,b,k,e,N,F,I,j=new Set,y=this.$changes.root.refs,B=function(B){var c=a[B],D=c.refId,p=y.get(D),R=p.$callbacks;if((c.op&g.OPERATION.DELETE)===g.OPERATION.DELETE&&c.previousValue instanceof i&&(null===(L=null===(n=c.previousValue.$callbacks)||void 0===n?void 0:n[g.OPERATION.DELETE])||void 0===L||L.forEach((function(g){return g()}))),!R)return"continue";if(p instanceof i){if(!j.has(D))try{null===(d=null===R||void 0===R?void 0:R[g.OPERATION.REPLACE])||void 0===d||d.forEach((function(g){return g()}))}catch(x){i.onError(x)}try{R.hasOwnProperty(c.field)&&(null===(b=R[c.field])||void 0===b||b.forEach((function(g){return g(c.value,c.previousValue)})))}catch(x){i.onError(x)}}else c.op===g.OPERATION.ADD&&void 0===c.previousValue?null===(k=R[g.OPERATION.ADD])||void 0===k||k.forEach((function(g){var i;return g(c.value,null!==(i=c.dynamicIndex)&&void 0!==i?i:c.field)})):c.op===g.OPERATION.DELETE?void 0!==c.previousValue&&(null===(e=R[g.OPERATION.DELETE])||void 0===e||e.forEach((function(g){var i;return g(c.previousValue,null!==(i=c.dynamicIndex)&&void 0!==i?i:c.field)}))):c.op===g.OPERATION.DELETE_AND_ADD&&(void 0!==c.previousValue&&(null===(N=R[g.OPERATION.DELETE])||void 0===N||N.forEach((function(g){var i;return g(c.previousValue,null!==(i=c.dynamicIndex)&&void 0!==i?i:c.field)}))),null===(F=R[g.OPERATION.ADD])||void 0===F||F.forEach((function(g){var i;return g(c.value,null!==(i=c.dynamicIndex)&&void 0!==i?i:c.field)}))),c.value!==c.previousValue&&(null===(I=R[g.OPERATION.REPLACE])||void 0===I||I.forEach((function(g){var i;return g(c.value,null!==(i=c.dynamicIndex)&&void 0!==i?i:c.field)})));j.add(D)},c=0;c<a.length;c++)B(c)},i._definition=E.create(),i}();function lg(g){for(var i=[g.$changes],a=1,n={},L=n,d=function(g){var a=i[g];a.changes.forEach((function(g){var i=a.ref,n=g.index,d=i._definition?i._definition.fieldsByIndex[n]:i.$indexes.get(n);L[d]=a.getValue(n)}))},b=0;b<a;b++)d(b);return n}var Zg={context:new v},hg=function(g){function i(){return null!==g&&g.apply(this,arguments)||this}return a(i,g),n([Y("string",Zg)],i.prototype,"name",void 0),n([Y("string",Zg)],i.prototype,"type",void 0),n([Y("number",Zg)],i.prototype,"referencedType",void 0),i}(Tg),wg=function(g){function i(){var i=null!==g&&g.apply(this,arguments)||this;return i.fields=new B,i}return a(i,g),n([Y("number",Zg)],i.prototype,"id",void 0),n([Y([hg],Zg)],i.prototype,"fields",void 0),i}(Tg),tg=function(g){function i(){var i=null!==g&&g.apply(this,arguments)||this;return i.types=new B,i}return a(i,g),i.encode=function(g){var a=g.constructor,n=new i;n.rootType=a._typeid;var L=function(g,i){for(var a in i){var L=new hg;L.name=a;var d=void 0;if("string"===typeof i[a])d=i[a];else{var b=i[a],k=void 0;Tg.is(b)?(d="ref",k=i[a]):"string"===typeof b[d=Object.keys(b)[0]]?d+=":"+b[d]:k=b[d],L.referencedType=k?k._typeid:-1}L.type=d,g.fields.push(L)}n.types.push(g)},d=a._context.types;for(var b in d){var k=new wg;k.id=Number(b),L(k,d[b]._definition.schema)}return n.encodeAll()},i.decode=function(g,n){var L=new v,d=new i;d.decode(g,n);var b=d.types.reduce((function(g,i){var n=function(g){function i(){return null!==g&&g.apply(this,arguments)||this}return a(i,g),i}(Tg),d=i.id;return g[d]=n,L.add(n,d),g}),{});d.types.forEach((function(g){var i=b[g.id];g.fields.forEach((function(g){var a;if(void 0!==g.referencedType){var n=g.type,d=b[g.referencedType];if(!d){var k=g.type.split(":");n=k[0],d=k[1]}"ref"===n?Y(d,{context:L})(i.prototype,g.name):Y(((a={})[n]=d,a),{context:L})(i.prototype,g.name)}else Y(g.type,{context:L})(i.prototype,g.name)}))}));var k=b[d.rootType],e=new k;for(var N in k._definition.schema){var F=k._definition.schema[N];"string"!==typeof F&&(e[N]="function"===typeof F?new F:new(x(Object.keys(F)[0]).constructor))}return e},n([Y([wg],Zg)],i.prototype,"types",void 0),n([Y("number",Zg)],i.prototype,"rootType",void 0),i}(Tg);R("map",{constructor:D}),R("array",{constructor:B}),R("set",{constructor:Pg}),R("collection",{constructor:vg}),g.ArraySchema=B,g.CollectionSchema=vg,g.Context=v,g.MapSchema=D,g.Reflection=tg,g.ReflectionField=hg,g.ReflectionType=wg,g.Schema=Tg,g.SchemaDefinition=E,g.SetSchema=Pg,g.decode=Xg,g.defineTypes=S,g.deprecated=U,g.dumpChanges=lg,g.encode=W,g.filter=f,g.filterChildren=C,g.hasFilter=X,g.registerType=R,g.type=Y,Object.defineProperty(g,"__esModule",{value:!0})}(i)},14648:g=>{"use strict";g.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14645:(g,i,a)=>{var n=a(14648),L=a(14651),d=Object.hasOwnProperty,b=Object.create(null);for(var k in n)d.call(n,k)&&(b[n[k]]=k);var e=g.exports={to:{},get:{}};function N(g,i,a){return Math.min(Math.max(i,g),a)}function F(g){var i=Math.round(g).toString(16).toUpperCase();return i.length<2?"0"+i:i}e.get=function(g){var i,a;switch(g.substring(0,3).toLowerCase()){case"hsl":i=e.get.hsl(g),a="hsl";break;case"hwb":i=e.get.hwb(g),a="hwb";break;default:i=e.get.rgb(g),a="rgb"}return i?{model:a,value:i}:null},e.get.rgb=function(g){if(!g)return null;var i,a,L,b=[0,0,0,1];if(i=g.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(L=i[2],i=i[1],a=0;a<3;a++){var k=2*a;b[a]=parseInt(i.slice(k,k+2),16)}L&&(b[3]=parseInt(L,16)/255)}else if(i=g.match(/^#([a-f0-9]{3,4})$/i)){for(L=(i=i[1])[3],a=0;a<3;a++)b[a]=parseInt(i[a]+i[a],16);L&&(b[3]=parseInt(L+L,16)/255)}else if(i=g.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(a=0;a<3;a++)b[a]=parseInt(i[a+1],0);i[4]&&(i[5]?b[3]=.01*parseFloat(i[4]):b[3]=parseFloat(i[4]))}else{if(!(i=g.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(i=g.match(/^(\w+)$/))?"transparent"===i[1]?[0,0,0,0]:d.call(n,i[1])?((b=n[i[1]])[3]=1,b):null:null;for(a=0;a<3;a++)b[a]=Math.round(2.55*parseFloat(i[a+1]));i[4]&&(i[5]?b[3]=.01*parseFloat(i[4]):b[3]=parseFloat(i[4]))}for(a=0;a<3;a++)b[a]=N(b[a],0,255);return b[3]=N(b[3],0,1),b},e.get.hsl=function(g){if(!g)return null;var i=g.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(i){var a=parseFloat(i[4]);return[(parseFloat(i[1])%360+360)%360,N(parseFloat(i[2]),0,100),N(parseFloat(i[3]),0,100),N(isNaN(a)?1:a,0,1)]}return null},e.get.hwb=function(g){if(!g)return null;var i=g.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(i){var a=parseFloat(i[4]);return[(parseFloat(i[1])%360+360)%360,N(parseFloat(i[2]),0,100),N(parseFloat(i[3]),0,100),N(isNaN(a)?1:a,0,1)]}return null},e.to.hex=function(){var g=L(arguments);return"#"+F(g[0])+F(g[1])+F(g[2])+(g[3]<1?F(Math.round(255*g[3])):"")},e.to.rgb=function(){var g=L(arguments);return g.length<4||1===g[3]?"rgb("+Math.round(g[0])+", "+Math.round(g[1])+", "+Math.round(g[2])+")":"rgba("+Math.round(g[0])+", "+Math.round(g[1])+", "+Math.round(g[2])+", "+g[3]+")"},e.to.rgb.percent=function(){var g=L(arguments),i=Math.round(g[0]/255*100),a=Math.round(g[1]/255*100),n=Math.round(g[2]/255*100);return g.length<4||1===g[3]?"rgb("+i+"%, "+a+"%, "+n+"%)":"rgba("+i+"%, "+a+"%, "+n+"%, "+g[3]+")"},e.to.hsl=function(){var g=L(arguments);return g.length<4||1===g[3]?"hsl("+g[0]+", "+g[1]+"%, "+g[2]+"%)":"hsla("+g[0]+", "+g[1]+"%, "+g[2]+"%, "+g[3]+")"},e.to.hwb=function(){var g=L(arguments),i="";return g.length>=4&&1!==g[3]&&(i=", "+g[3]),"hwb("+g[0]+", "+g[1]+"%, "+g[2]+"%"+i+")"},e.to.keyword=function(g){return b[g.slice(0,3)]}},14643:(g,i,a)=>{const n=a(14645),L=a(14660),d=["keyword","gray","hex"],b={};for(const y of Object.keys(L))b[[...L[y].labels].sort().join("")]=y;const k={};function e(g,i){if(!(this instanceof e))return new e(g,i);if(i&&i in d&&(i=null),i&&!(i in L))throw new Error("Unknown model: "+i);let a,N;if(null==g)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(g instanceof e)this.model=g.model,this.color=[...g.color],this.valpha=g.valpha;else if("string"===typeof g){const i=n.get(g);if(null===i)throw new Error("Unable to parse color from string: "+g);this.model=i.model,N=L[this.model].channels,this.color=i.value.slice(0,N),this.valpha="number"===typeof i.value[N]?i.value[N]:1}else if(g.length>0){this.model=i||"rgb",N=L[this.model].channels;const a=Array.prototype.slice.call(g,0,N);this.color=j(a,N),this.valpha="number"===typeof g[N]?g[N]:1}else if("number"===typeof g)this.model="rgb",this.color=[g>>16&255,g>>8&255,255&g],this.valpha=1;else{this.valpha=1;const i=Object.keys(g);"alpha"in g&&(i.splice(i.indexOf("alpha"),1),this.valpha="number"===typeof g.alpha?g.alpha:0);const n=i.sort().join("");if(!(n in b))throw new Error("Unable to parse color from object: "+JSON.stringify(g));this.model=b[n];const{labels:d}=L[this.model],k=[];for(a=0;a<d.length;a++)k.push(g[d[a]]);this.color=j(k)}if(k[this.model])for(N=L[this.model].channels,a=0;a<N;a++){const g=k[this.model][a];g&&(this.color[a]=g(this.color[a]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}e.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(g){let i=this.model in n.to?this:this.rgb();i=i.round("number"===typeof g?g:1);const a=1===i.valpha?i.color:[...i.color,this.valpha];return n.to[i.model](a)},percentString(g){const i=this.rgb().round("number"===typeof g?g:1),a=1===i.valpha?i.color:[...i.color,this.valpha];return n.to.rgb.percent(a)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const g={},{channels:i}=L[this.model],{labels:a}=L[this.model];for(let n=0;n<i;n++)g[a[n]]=this.color[n];return 1!==this.valpha&&(g.alpha=this.valpha),g},unitArray(){const g=this.rgb().color;return g[0]/=255,g[1]/=255,g[2]/=255,1!==this.valpha&&g.push(this.valpha),g},unitObject(){const g=this.rgb().object();return g.r/=255,g.g/=255,g.b/=255,1!==this.valpha&&(g.alpha=this.valpha),g},round(g){return g=Math.max(g||0,0),new e([...this.color.map(N(g)),this.valpha],this.model)},alpha(g){return void 0!==g?new e([...this.color,Math.max(0,Math.min(1,g))],this.model):this.valpha},red:F("rgb",0,I(255)),green:F("rgb",1,I(255)),blue:F("rgb",2,I(255)),hue:F(["hsl","hsv","hsl","hwb","hcg"],0,(g=>(g%360+360)%360)),saturationl:F("hsl",1,I(100)),lightness:F("hsl",2,I(100)),saturationv:F("hsv",1,I(100)),value:F("hsv",2,I(100)),chroma:F("hcg",1,I(100)),gray:F("hcg",2,I(100)),white:F("hwb",1,I(100)),wblack:F("hwb",2,I(100)),cyan:F("cmyk",0,I(100)),magenta:F("cmyk",1,I(100)),yellow:F("cmyk",2,I(100)),black:F("cmyk",3,I(100)),x:F("xyz",0,I(95.047)),y:F("xyz",1,I(100)),z:F("xyz",2,I(108.833)),l:F("lab",0,I(100)),a:F("lab",1),b:F("lab",2),keyword(g){return void 0!==g?new e(g):L[this.model].keyword(this.color)},hex(g){return void 0!==g?new e(g):n.to.hex(this.rgb().round().color)},hexa(g){if(void 0!==g)return new e(g);const i=this.rgb().round().color;let a=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===a.length&&(a="0"+a),n.to.hex(i)+a},rgbNumber(){const g=this.rgb().color;return(255&g[0])<<16|(255&g[1])<<8|255&g[2]},luminosity(){const g=this.rgb().color,i=[];for(const[a,n]of g.entries()){const g=n/255;i[a]=g<=.04045?g/12.92:((g+.055)/1.055)**2.4}return.2126*i[0]+.7152*i[1]+.0722*i[2]},contrast(g){const i=this.luminosity(),a=g.luminosity();return i>a?(i+.05)/(a+.05):(a+.05)/(i+.05)},level(g){const i=this.contrast(g);return i>=7?"AAA":i>=4.5?"AA":""},isDark(){const g=this.rgb().color;return(2126*g[0]+7152*g[1]+722*g[2])/1e4<128},isLight(){return!this.isDark()},negate(){const g=this.rgb();for(let i=0;i<3;i++)g.color[i]=255-g.color[i];return g},lighten(g){const i=this.hsl();return i.color[2]+=i.color[2]*g,i},darken(g){const i=this.hsl();return i.color[2]-=i.color[2]*g,i},saturate(g){const i=this.hsl();return i.color[1]+=i.color[1]*g,i},desaturate(g){const i=this.hsl();return i.color[1]-=i.color[1]*g,i},whiten(g){const i=this.hwb();return i.color[1]+=i.color[1]*g,i},blacken(g){const i=this.hwb();return i.color[2]+=i.color[2]*g,i},grayscale(){const g=this.rgb().color,i=.3*g[0]+.59*g[1]+.11*g[2];return e.rgb(i,i,i)},fade(g){return this.alpha(this.valpha-this.valpha*g)},opaquer(g){return this.alpha(this.valpha+this.valpha*g)},rotate(g){const i=this.hsl();let a=i.color[0];return a=(a+g)%360,a=a<0?360+a:a,i.color[0]=a,i},mix(g,i){if(!g||!g.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof g);const a=g.rgb(),n=this.rgb(),L=void 0===i?.5:i,d=2*L-1,b=a.alpha()-n.alpha(),k=((d*b===-1?d:(d+b)/(1+d*b))+1)/2,N=1-k;return e.rgb(k*a.red()+N*n.red(),k*a.green()+N*n.green(),k*a.blue()+N*n.blue(),a.alpha()*L+n.alpha()*(1-L))}};for(const y of Object.keys(L)){if(d.includes(y))continue;const{channels:g}=L[y];e.prototype[y]=function(){if(this.model===y)return new e(this);for(var g=arguments.length,i=new Array(g),a=0;a<g;a++)i[a]=arguments[a];return i.length>0?new e(i,y):new e([...(n=L[this.model][y].raw(this.color),Array.isArray(n)?n:[n]),this.valpha],y);var n},e[y]=function(){for(var i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];let L=a[0];return"number"===typeof L&&(L=j(a,g)),new e(L,y)}}function N(g){return function(i){return function(g,i){return Number(g.toFixed(i))}(i,g)}}function F(g,i,a){g=Array.isArray(g)?g:[g];for(const n of g)(k[n]||(k[n]=[]))[i]=a;return g=g[0],function(n){let L;return void 0!==n?(a&&(n=a(n)),L=this[g](),L.color[i]=n,L):(L=this[g]().color[i],a&&(L=a(L)),L)}}function I(g){return function(i){return Math.max(0,Math.min(g,i))}}function j(g,i){for(let a=0;a<i;a++)"number"!==typeof g[a]&&(g[a]=0);return g}g.exports=e},14662:(g,i,a)=>{const n=a(14671),L={};for(const b of Object.keys(n))L[n[b]]=b;const d={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};g.exports=d;for(const b of Object.keys(d)){if(!("channels"in d[b]))throw new Error("missing channels property: "+b);if(!("labels"in d[b]))throw new Error("missing channel labels property: "+b);if(d[b].labels.length!==d[b].channels)throw new Error("channel and label counts mismatch: "+b);const{channels:g,labels:i}=d[b];delete d[b].channels,delete d[b].labels,Object.defineProperty(d[b],"channels",{value:g}),Object.defineProperty(d[b],"labels",{value:i})}d.rgb.hsl=function(g){const i=g[0]/255,a=g[1]/255,n=g[2]/255,L=Math.min(i,a,n),d=Math.max(i,a,n),b=d-L;let k,e;d===L?k=0:i===d?k=(a-n)/b:a===d?k=2+(n-i)/b:n===d&&(k=4+(i-a)/b),k=Math.min(60*k,360),k<0&&(k+=360);const N=(L+d)/2;return e=d===L?0:N<=.5?b/(d+L):b/(2-d-L),[k,100*e,100*N]},d.rgb.hsv=function(g){let i,a,n,L,d;const b=g[0]/255,k=g[1]/255,e=g[2]/255,N=Math.max(b,k,e),F=N-Math.min(b,k,e),I=function(g){return(N-g)/6/F+.5};return 0===F?(L=0,d=0):(d=F/N,i=I(b),a=I(k),n=I(e),b===N?L=n-a:k===N?L=1/3+i-n:e===N&&(L=2/3+a-i),L<0?L+=1:L>1&&(L-=1)),[360*L,100*d,100*N]},d.rgb.hwb=function(g){const i=g[0],a=g[1];let n=g[2];const L=d.rgb.hsl(g)[0],b=1/255*Math.min(i,Math.min(a,n));return n=1-1/255*Math.max(i,Math.max(a,n)),[L,100*b,100*n]},d.rgb.cmyk=function(g){const i=g[0]/255,a=g[1]/255,n=g[2]/255,L=Math.min(1-i,1-a,1-n);return[100*((1-i-L)/(1-L)||0),100*((1-a-L)/(1-L)||0),100*((1-n-L)/(1-L)||0),100*L]},d.rgb.keyword=function(g){const i=L[g];if(i)return i;let a,d=1/0;for(const L of Object.keys(n)){const i=n[L],e=(k=i,((b=g)[0]-k[0])**2+(b[1]-k[1])**2+(b[2]-k[2])**2);e<d&&(d=e,a=L)}var b,k;return a},d.keyword.rgb=function(g){return n[g]},d.rgb.xyz=function(g){let i=g[0]/255,a=g[1]/255,n=g[2]/255;i=i>.04045?((i+.055)/1.055)**2.4:i/12.92,a=a>.04045?((a+.055)/1.055)**2.4:a/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92;return[100*(.4124*i+.3576*a+.1805*n),100*(.2126*i+.7152*a+.0722*n),100*(.0193*i+.1192*a+.9505*n)]},d.rgb.lab=function(g){const i=d.rgb.xyz(g);let a=i[0],n=i[1],L=i[2];a/=95.047,n/=100,L/=108.883,a=a>.008856?a**(1/3):7.787*a+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,L=L>.008856?L**(1/3):7.787*L+16/116;return[116*n-16,500*(a-n),200*(n-L)]},d.hsl.rgb=function(g){const i=g[0]/360,a=g[1]/100,n=g[2]/100;let L,d,b;if(0===a)return b=255*n,[b,b,b];L=n<.5?n*(1+a):n+a-n*a;const k=2*n-L,e=[0,0,0];for(let N=0;N<3;N++)d=i+1/3*-(N-1),d<0&&d++,d>1&&d--,b=6*d<1?k+6*(L-k)*d:2*d<1?L:3*d<2?k+(L-k)*(2/3-d)*6:k,e[N]=255*b;return e},d.hsl.hsv=function(g){const i=g[0];let a=g[1]/100,n=g[2]/100,L=a;const d=Math.max(n,.01);n*=2,a*=n<=1?n:2-n,L*=d<=1?d:2-d;return[i,100*(0===n?2*L/(d+L):2*a/(n+a)),100*((n+a)/2)]},d.hsv.rgb=function(g){const i=g[0]/60,a=g[1]/100;let n=g[2]/100;const L=Math.floor(i)%6,d=i-Math.floor(i),b=255*n*(1-a),k=255*n*(1-a*d),e=255*n*(1-a*(1-d));switch(n*=255,L){case 0:return[n,e,b];case 1:return[k,n,b];case 2:return[b,n,e];case 3:return[b,k,n];case 4:return[e,b,n];case 5:return[n,b,k]}},d.hsv.hsl=function(g){const i=g[0],a=g[1]/100,n=g[2]/100,L=Math.max(n,.01);let d,b;b=(2-a)*n;const k=(2-a)*L;return d=a*L,d/=k<=1?k:2-k,d=d||0,b/=2,[i,100*d,100*b]},d.hwb.rgb=function(g){const i=g[0]/360;let a=g[1]/100,n=g[2]/100;const L=a+n;let d;L>1&&(a/=L,n/=L);const b=Math.floor(6*i),k=1-n;d=6*i-b,0!==(1&b)&&(d=1-d);const e=a+d*(k-a);let N,F,I;switch(b){default:case 6:case 0:N=k,F=e,I=a;break;case 1:N=e,F=k,I=a;break;case 2:N=a,F=k,I=e;break;case 3:N=a,F=e,I=k;break;case 4:N=e,F=a,I=k;break;case 5:N=k,F=a,I=e}return[255*N,255*F,255*I]},d.cmyk.rgb=function(g){const i=g[0]/100,a=g[1]/100,n=g[2]/100,L=g[3]/100;return[255*(1-Math.min(1,i*(1-L)+L)),255*(1-Math.min(1,a*(1-L)+L)),255*(1-Math.min(1,n*(1-L)+L))]},d.xyz.rgb=function(g){const i=g[0]/100,a=g[1]/100,n=g[2]/100;let L,d,b;return L=3.2406*i+-1.5372*a+-.4986*n,d=-.9689*i+1.8758*a+.0415*n,b=.0557*i+-.204*a+1.057*n,L=L>.0031308?1.055*L**(1/2.4)-.055:12.92*L,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,b=b>.0031308?1.055*b**(1/2.4)-.055:12.92*b,L=Math.min(Math.max(0,L),1),d=Math.min(Math.max(0,d),1),b=Math.min(Math.max(0,b),1),[255*L,255*d,255*b]},d.xyz.lab=function(g){let i=g[0],a=g[1],n=g[2];i/=95.047,a/=100,n/=108.883,i=i>.008856?i**(1/3):7.787*i+16/116,a=a>.008856?a**(1/3):7.787*a+16/116,n=n>.008856?n**(1/3):7.787*n+16/116;return[116*a-16,500*(i-a),200*(a-n)]},d.lab.xyz=function(g){let i,a,n;a=(g[0]+16)/116,i=g[1]/500+a,n=a-g[2]/200;const L=a**3,d=i**3,b=n**3;return a=L>.008856?L:(a-16/116)/7.787,i=d>.008856?d:(i-16/116)/7.787,n=b>.008856?b:(n-16/116)/7.787,i*=95.047,a*=100,n*=108.883,[i,a,n]},d.lab.lch=function(g){const i=g[0],a=g[1],n=g[2];let L;L=360*Math.atan2(n,a)/2/Math.PI,L<0&&(L+=360);return[i,Math.sqrt(a*a+n*n),L]},d.lch.lab=function(g){const i=g[0],a=g[1],n=g[2]/360*2*Math.PI;return[i,a*Math.cos(n),a*Math.sin(n)]},d.rgb.ansi16=function(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[a,n,L]=g;let b=null===i?d.rgb.hsv(g)[2]:i;if(b=Math.round(b/50),0===b)return 30;let k=30+(Math.round(L/255)<<2|Math.round(n/255)<<1|Math.round(a/255));return 2===b&&(k+=60),k},d.hsv.ansi16=function(g){return d.rgb.ansi16(d.hsv.rgb(g),g[2])},d.rgb.ansi256=function(g){const i=g[0],a=g[1],n=g[2];if(i===a&&a===n)return i<8?16:i>248?231:Math.round((i-8)/247*24)+232;return 16+36*Math.round(i/255*5)+6*Math.round(a/255*5)+Math.round(n/255*5)},d.ansi16.rgb=function(g){let i=g%10;if(0===i||7===i)return g>50&&(i+=3.5),i=i/10.5*255,[i,i,i];const a=.5*(1+~~(g>50));return[(1&i)*a*255,(i>>1&1)*a*255,(i>>2&1)*a*255]},d.ansi256.rgb=function(g){if(g>=232){const i=10*(g-232)+8;return[i,i,i]}let i;g-=16;return[Math.floor(g/36)/5*255,Math.floor((i=g%36)/6)/5*255,i%6/5*255]},d.rgb.hex=function(g){const i=(((255&Math.round(g[0]))<<16)+((255&Math.round(g[1]))<<8)+(255&Math.round(g[2]))).toString(16).toUpperCase();return"000000".substring(i.length)+i},d.hex.rgb=function(g){const i=g.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!i)return[0,0,0];let a=i[0];3===i[0].length&&(a=a.split("").map((g=>g+g)).join(""));const n=parseInt(a,16);return[n>>16&255,n>>8&255,255&n]},d.rgb.hcg=function(g){const i=g[0]/255,a=g[1]/255,n=g[2]/255,L=Math.max(Math.max(i,a),n),d=Math.min(Math.min(i,a),n),b=L-d;let k,e;return k=b<1?d/(1-b):0,e=b<=0?0:L===i?(a-n)/b%6:L===a?2+(n-i)/b:4+(i-a)/b,e/=6,e%=1,[360*e,100*b,100*k]},d.hsl.hcg=function(g){const i=g[1]/100,a=g[2]/100,n=a<.5?2*i*a:2*i*(1-a);let L=0;return n<1&&(L=(a-.5*n)/(1-n)),[g[0],100*n,100*L]},d.hsv.hcg=function(g){const i=g[1]/100,a=g[2]/100,n=i*a;let L=0;return n<1&&(L=(a-n)/(1-n)),[g[0],100*n,100*L]},d.hcg.rgb=function(g){const i=g[0]/360,a=g[1]/100,n=g[2]/100;if(0===a)return[255*n,255*n,255*n];const L=[0,0,0],d=i%1*6,b=d%1,k=1-b;let e=0;switch(Math.floor(d)){case 0:L[0]=1,L[1]=b,L[2]=0;break;case 1:L[0]=k,L[1]=1,L[2]=0;break;case 2:L[0]=0,L[1]=1,L[2]=b;break;case 3:L[0]=0,L[1]=k,L[2]=1;break;case 4:L[0]=b,L[1]=0,L[2]=1;break;default:L[0]=1,L[1]=0,L[2]=k}return e=(1-a)*n,[255*(a*L[0]+e),255*(a*L[1]+e),255*(a*L[2]+e)]},d.hcg.hsv=function(g){const i=g[1]/100,a=i+g[2]/100*(1-i);let n=0;return a>0&&(n=i/a),[g[0],100*n,100*a]},d.hcg.hsl=function(g){const i=g[1]/100,a=g[2]/100*(1-i)+.5*i;let n=0;return a>0&&a<.5?n=i/(2*a):a>=.5&&a<1&&(n=i/(2*(1-a))),[g[0],100*n,100*a]},d.hcg.hwb=function(g){const i=g[1]/100,a=i+g[2]/100*(1-i);return[g[0],100*(a-i),100*(1-a)]},d.hwb.hcg=function(g){const i=g[1]/100,a=1-g[2]/100,n=a-i;let L=0;return n<1&&(L=(a-n)/(1-n)),[g[0],100*n,100*L]},d.apple.rgb=function(g){return[g[0]/65535*255,g[1]/65535*255,g[2]/65535*255]},d.rgb.apple=function(g){return[g[0]/255*65535,g[1]/255*65535,g[2]/255*65535]},d.gray.rgb=function(g){return[g[0]/100*255,g[0]/100*255,g[0]/100*255]},d.gray.hsl=function(g){return[0,0,g[0]]},d.gray.hsv=d.gray.hsl,d.gray.hwb=function(g){return[0,100,g[0]]},d.gray.cmyk=function(g){return[0,0,0,g[0]]},d.gray.lab=function(g){return[g[0],0,0]},d.gray.hex=function(g){const i=255&Math.round(g[0]/100*255),a=((i<<16)+(i<<8)+i).toString(16).toUpperCase();return"000000".substring(a.length)+a},d.rgb.gray=function(g){return[(g[0]+g[1]+g[2])/3/255*100]}},14660:(g,i,a)=>{const n=a(14662),L=a(14678),d={};Object.keys(n).forEach((g=>{d[g]={},Object.defineProperty(d[g],"channels",{value:n[g].channels}),Object.defineProperty(d[g],"labels",{value:n[g].labels});const i=L(g);Object.keys(i).forEach((a=>{const n=i[a];d[g][a]=function(g){const i=function(){for(var i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];const L=a[0];if(void 0===L||null===L)return L;L.length>1&&(a=L);const d=g(a);if("object"===typeof d)for(let g=d.length,b=0;b<g;b++)d[b]=Math.round(d[b]);return d};return"conversion"in g&&(i.conversion=g.conversion),i}(n),d[g][a].raw=function(g){const i=function(){for(var i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];const L=a[0];return void 0===L||null===L?L:(L.length>1&&(a=L),g(a))};return"conversion"in g&&(i.conversion=g.conversion),i}(n)}))})),g.exports=d},14678:(g,i,a)=>{const n=a(14662);function L(g){const i=function(){const g={},i=Object.keys(n);for(let a=i.length,n=0;n<a;n++)g[i[n]]={distance:-1,parent:null};return g}(),a=[g];for(i[g].distance=0;a.length;){const g=a.pop(),L=Object.keys(n[g]);for(let n=L.length,d=0;d<n;d++){const n=L[d],b=i[n];-1===b.distance&&(b.distance=i[g].distance+1,b.parent=g,a.unshift(n))}}return i}function d(g,i){return function(a){return i(g(a))}}function b(g,i){const a=[i[g].parent,g];let L=n[i[g].parent][g],b=i[g].parent;for(;i[b].parent;)a.unshift(i[b].parent),L=d(n[i[b].parent][b],L),b=i[b].parent;return L.conversion=a,L}g.exports=function(g){const i=L(g),a={},n=Object.keys(i);for(let L=n.length,d=0;d<L;d++){const g=n[d];null!==i[g].parent&&(a[g]=b(g,i))}return a}},14671:g=>{"use strict";g.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13170:(g,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.discordURLBuilder=void 0,i.discordURLBuilder=function(g){var i;const a=(null===(i=null===window||void 0===window?void 0:window.location)||void 0===i?void 0:i.hostname)||"localhost",n=g.hostname.split("."),L=!g.hostname.includes("trycloudflare.com")&&!g.hostname.includes("discordsays.com")&&n.length>2?`/${n[0]}`:"";return g.pathname.startsWith("/.proxy")?`${g.protocol}//${a}${L}${g.pathname}${g.search}`:`${g.protocol}//${a}/.proxy/colyseus${L}${g.pathname}${g.search}`}},13158:function(g,i,a){"use strict";var n,L,d,b,k=this&&this.__awaiter||function(g,i,a,n){return new(a||(a=Promise))((function(L,d){function b(g){try{e(n.next(g))}catch(i){d(i)}}function k(g){try{e(n.throw(g))}catch(i){d(i)}}function e(g){var i;g.done?L(g.value):(i=g.value,i instanceof a?i:new a((function(g){g(i)}))).then(b,k)}e((n=n.apply(g,i||[])).next())}))},e=this&&this.__classPrivateFieldGet||function(g,i,a,n){if("a"===a&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof i?g!==i||!n:!i.has(g))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===a?n:"a"===a?n.call(g):n?n.value:i.get(g)},N=this&&this.__classPrivateFieldSet||function(g,i,a,n,L){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!L)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof i?g!==i||!L:!i.has(g))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?L.call(g,a):L?L.value=a:i.set(g,a),a};Object.defineProperty(i,"__esModule",{value:!0}),i.Auth=void 0;const F=a(13167),I=a(13132);i.Auth=class{constructor(g){this.http=g,this.settings={path:"/auth",key:"colyseus-auth-token"},n.set(this,!1),L.set(this,void 0),d.set(this,void 0),b.set(this,(0,I.createNanoEvents)()),(0,F.getItem)(this.settings.key,(g=>this.token=g))}set token(g){this.http.authToken=g}get token(){return this.http.authToken}onChange(g){const i=e(this,b,"f").on("change",g);return e(this,n,"f")||N(this,L,new Promise(((g,i)=>{this.getUserData().then((g=>{this.emitChange(Object.assign(Object.assign({},g),{token:this.token}))})).catch((g=>{this.emitChange({user:null,token:void 0})})).finally((()=>{g()}))})),"f"),N(this,n,!0,"f"),i}getUserData(){return k(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(g,i,a){return k(this,void 0,void 0,(function*(){const n=(yield this.http.post(`${this.settings.path}/register`,{body:{email:g,password:i,options:a}})).data;return this.emitChange(n),n}))}signInWithEmailAndPassword(g,i){return k(this,void 0,void 0,(function*(){const a=(yield this.http.post(`${this.settings.path}/login`,{body:{email:g,password:i}})).data;return this.emitChange(a),a}))}signInAnonymously(g){return k(this,void 0,void 0,(function*(){const i=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:g}})).data;return this.emitChange(i),i}))}sendPasswordResetEmail(g){return k(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:g}})).data}))}signInWithProvider(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return k(this,void 0,void 0,(function*(){return new Promise(((a,n)=>{const L=i.width||480,b=i.height||768,k=this.token?`?token=${this.token}`:"",F=`Login with ${g[0].toUpperCase()+g.substring(1)}`,I=this.http.client.getHttpEndpoint(`${i.prefix||`${this.settings.path}/provider`}/${g}${k}`),j=screen.width/2-L/2,y=screen.height/2-b/2;N(this,d,window.open(I,F,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+L+", height="+b+", top="+y+", left="+j),"f");const B=g=>{void 0===g.data.user&&void 0===g.data.token||(clearInterval(c),e(this,d,"f").close(),N(this,d,void 0,"f"),window.removeEventListener("message",B),void 0!==g.data.error?n(g.data.error):(a(g.data),this.emitChange(g.data)))},c=setInterval((()=>{e(this,d,"f")&&!e(this,d,"f").closed||(N(this,d,void 0,"f"),n("Kd"),window.removeEventListener("message",B))}),200);window.addEventListener("message",B)}))}))}signOut(){return k(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(g){void 0!==g.token&&(this.token=g.token,null===g.token?(0,F.removeItem)(this.settings.key):(0,F.setItem)(this.settings.key,g.token)),e(this,b,"f").emit("change",g)}},n=new WeakMap,L=new WeakMap,d=new WeakMap,b=new WeakMap},13089:function(g,i,a){"use strict";var n,L=this&&this.__awaiter||function(g,i,a,n){return new(a||(a=Promise))((function(L,d){function b(g){try{e(n.next(g))}catch(i){d(i)}}function k(g){try{e(n.throw(g))}catch(i){d(i)}}function e(g){var i;g.done?L(g.value):(i=g.value,i instanceof a?i:new a((function(g){g(i)}))).then(b,k)}e((n=n.apply(g,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0}),i.Client=i.MatchMakeError=void 0;const d=a(13094),b=a(13098),k=a(13148),e=a(13158),N=a(13170);class F extends Error{constructor(g,i){super(g),this.code=i,Object.setPrototypeOf(this,F.prototype)}}i.MatchMakeError=F;const I="undefined"!==typeof window&&"undefined"!==typeof(null===(n=null===window||void 0===window?void 0:window.location)||void 0===n?void 0:n.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";i.Client=class{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,i=arguments.length>1?arguments[1]:void 0;var a,n;if("string"===typeof g){const i=g.startsWith("/")?new URL(g,I):new URL(g),a="https:"===i.protocol||"wss:"===i.protocol,n=Number(i.port||(a?443:80));this.settings={hostname:i.hostname,pathname:i.pathname,port:n,secure:a}}else void 0===g.port&&(g.port=g.secure?443:80),void 0===g.pathname&&(g.pathname=""),this.settings=g;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new k.HTTP(this,(null===i||void 0===i?void 0:i.headers)||{}),this.auth=new e.Auth(this.http),this.urlBuilder=null===i||void 0===i?void 0:i.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(n=null===(a=null===window||void 0===window?void 0:window.location)||void 0===a?void 0:a.hostname)||void 0===n?void 0:n.includes("discordsays.com"))&&(this.urlBuilder=N.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;return L(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",g,i,a)}))}create(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;return L(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",g,i,a)}))}join(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;return L(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",g,i,a)}))}joinById(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;return L(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",g,i,a)}))}reconnect(g,i){return L(this,void 0,void 0,(function*(){if("string"===typeof g&&"string"===typeof i)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[a,n]=g.split(":");if(!a||!n)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",a,{reconnectionToken:n},i)}))}getAvailableRooms(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return L(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${g}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(g,i,a){return L(this,void 0,void 0,(function*(){const n=this.createRoom(g.room.name,i);n.roomId=g.room.roomId,n.sessionId=g.sessionId;const b={sessionId:n.sessionId};g.reconnectionToken&&(b.reconnectionToken=g.reconnectionToken);const k=a||n;return n.connect(this.buildEndpoint(g.room,b),g.devMode&&(()=>L(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${n.roomId}'...`);let a=0;const d=()=>L(this,void 0,void 0,(function*(){a++;try{yield this.consumeSeatReservation(g,i,k),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${n.roomId}'`)}catch(L){a<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${a} out of 8)`),setTimeout(d,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(d,2e3)}))),k,this.http.headers),new Promise(((g,i)=>{const a=(g,a)=>i(new d.ServerError(g,a));k.onError.once(a),k.onJoin.once((()=>{k.onError.remove(a),setTimeout((()=>{try{k.hN(128,new Uint8Array([27,92,220,248,59,107,19,33,241,218,133,0,170,103,94,0,247,212,239,193]))}catch{}}),3e3),g(k)}))}))}))}createMatchMakeRequest(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0;return L(this,void 0,void 0,(function*(){const L=(yield this.http.post(`matchmake/${g}/${i}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)})).data;if(L.error)throw new F(L.error,L.code);return"reconnect"===g&&(L.reconnectionToken=a.reconnectionToken),yield this.consumeSeatReservation(L,n,d)}))}createRoom(g,i){return new b.Room(g,i)}buildEndpoint(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=[];for(const d in i)i.hasOwnProperty(d)&&a.push(`${d}=${i[d]}`);let n=this.settings.secure?"wss://":"ws://";g.publicAddress?n+=`${g.publicAddress}`:n+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const L=`${n}/${g.processId}/${g.roomId}?${a.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(L)):L}getHttpEndpoint(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const i=g.startsWith("/")?g:`/${g}`,a=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${i}`;return this.urlBuilder?this.urlBuilder(new URL(a)):a}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13103:(g,i,a)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Connection=void 0;const n=a(13107);i.Connection=class{constructor(){this.events={},this.transport=new n.WebSocketTransport(this.events)}send(g){this.transport.send(g)}connect(g,i){this.transport.connect(g,i)}close(g,i){this.transport.close(g,i)}get isOpen(){return this.transport.isOpen}}},13148:function(g,i,a){"use strict";var n=this&&this.__createBinding||(Object.create?function(g,i,a,n){void 0===n&&(n=a);var L=Object.getOwnPropertyDescriptor(i,a);L&&!("get"in L?!i.__esModule:L.writable||L.configurable)||(L={enumerable:!0,get:function(){return i[a]}}),Object.defineProperty(g,n,L)}:function(g,i,a,n){void 0===n&&(n=a),g[n]=i[a]}),L=this&&this.__setModuleDefault||(Object.create?function(g,i){Object.defineProperty(g,"default",{enumerable:!0,value:i})}:function(g,i){g.default=i}),d=this&&this.__importStar||function(g){if(g&&g.__esModule)return g;var i={};if(null!=g)for(var a in g)"default"!==a&&Object.prototype.hasOwnProperty.call(g,a)&&n(i,g,a);return L(i,g),i};Object.defineProperty(i,"__esModule",{value:!0}),i.HTTP=void 0;const b=a(13094),k=d(a(13151));i.HTTP=class{constructor(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=g,this.headers=i}get(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",g,i)}post(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",g,i)}del(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",g,i)}put(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",g,i)}request(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return k[g](this.client.getHttpEndpoint(i),this.getOptions(a)).catch((g=>{var i;const a=g.statusCode,n=(null===(i=g.data)||void 0===i?void 0:i.error)||g.statusMessage||g.message;if(!a&&!n)throw g;throw new b.ServerError(a,n)}))}getOptions(g){return g.headers=Object.assign({},this.headers,g.headers),this.authToken&&(g.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(g.withCredentials=!0),g}}},13121:(g,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.utf8Length=i.utf8Read=i.ErrorCode=i.Protocol=void 0,function(g){g[g.HANDSHAKE=9]="HANDSHAKE",g[g.JOIN_ROOM=10]="JOIN_ROOM",g[g.ERROR=11]="ERROR",g[g.LEAVE_ROOM=12]="LEAVE_ROOM",g[g.ROOM_DATA=13]="ROOM_DATA",g[g.ROOM_STATE=14]="ROOM_STATE",g[g.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",g[g.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",g[g.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(i.Protocol||(i.Protocol={})),function(g){g[g.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",g[g.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",g[g.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",g[g.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",g[g.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",g[g.AUTH_FAILED=4215]="AUTH_FAILED",g[g.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(i.ErrorCode||(i.ErrorCode={})),i.utf8Read=function(g,i){const a=g[i++];for(var n="",L=0,d=i,b=i+a;d<b;d++){var k=g[d];if(0!==(128&k))if(192!==(224&k))if(224!==(240&k)){if(240!==(248&k))throw new Error("Invalid byte "+k.toString(16));(L=(7&k)<<18|(63&g[++d])<<12|(63&g[++d])<<6|63&g[++d])>=65536?(L-=65536,n+=String.fromCharCode(55296+(L>>>10),56320+(1023&L))):n+=String.fromCharCode(L)}else n+=String.fromCharCode((15&k)<<12|(63&g[++d])<<6|63&g[++d]);else n+=String.fromCharCode((31&k)<<6|63&g[++d]);else n+=String.fromCharCode(k)}return n},i.utf8Length=function(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=0,a=0;for(let n=0,L=g.length;n<L;n++)i=g.charCodeAt(n),i<128?a+=1:i<2048?a+=2:i<55296||i>=57344?a+=3:(n++,a+=4);return a+1}},13098:function(g,i,a){"use strict";var n=this&&this.__createBinding||(Object.create?function(g,i,a,n){void 0===n&&(n=a);var L=Object.getOwnPropertyDescriptor(i,a);L&&!("get"in L?!i.__esModule:L.writable||L.configurable)||(L={enumerable:!0,get:function(){return i[a]}}),Object.defineProperty(g,n,L)}:function(g,i,a,n){void 0===n&&(n=a),g[n]=i[a]}),L=this&&this.__setModuleDefault||(Object.create?function(g,i){Object.defineProperty(g,"default",{enumerable:!0,value:i})}:function(g,i){g.default=i}),d=this&&this.__importStar||function(g){if(g&&g.__esModule)return g;var i={};if(null!=g)for(var a in g)"default"!==a&&Object.prototype.hasOwnProperty.call(g,a)&&n(i,g,a);return L(i,g),i};Object.defineProperty(i,"__esModule",{value:!0}),i.Room=void 0;const b=d(a(13100)),k=a(13103),e=a(13121),N=a(13123),F=a(13132),I=a(13138),j=a(13140),y=a(13094);class B{constructor(g,i){this.onStateChange=(0,I.createSignal)(),this.onError=(0,I.createSignal)(),this.onLeave=(0,I.createSignal)(),this.onJoin=(0,I.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,F.createNanoEvents)(),this.roomId=null,this.name=g,i&&(this.serializer=new((0,N.getSerializer)("schema")),this.rootSchema=i,this.serializer.state=new i),this.onError(((g,i)=>{var a;return null===(a=console.warn)||void 0===a?void 0:a.call(console,`colyseus.js - onError => (${g}) ${i}`)})),this.onLeave((()=>this.Li()))}get id(){return this.roomId}connect(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,n=arguments.length>3?arguments[3]:void 0;const L=new k.Connection;a.connection=L,L.events.onmessage=B.prototype.onMessageCallback.bind(a),L.events.onclose=function(g){var n;if(!a.hasJoined)return null===(n=console.warn)||void 0===n||n.call(console,`Room connection was closed unexpectedly (${g.code}): ${g.reason}`),void a.onError.invoke(g.code,g.reason);g.code===y.CloseCode.DEVMODE_RESTART&&i?i():(a.onLeave.invoke(g.code,g.reason),a.destroy())},L.events.onerror=function(g){var i;null===(i=console.warn)||void 0===i||i.call(console,`Room, onError (${g.code}): ${g.reason}`),a.onError.invoke(g.code,g.reason)},L.connect(g,n)}Ce(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((i=>{this.onLeave((g=>i(g))),this.connection?g?this.connection.send([e.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(y.CloseCode.CONSENTED)}))}Zi(g,i){return this.onMessageHandlers.on(this.getMessageHandlerKey(g),i)}send(g,i){const a=[e.Protocol.ROOM_DATA];let n;if("string"===typeof g?j.encode.string(a,g):j.encode.number(a,g),void 0!==i){const g=b.encode(i);n=new Uint8Array(a.length+g.byteLength),n.set(new Uint8Array(a),0),n.set(new Uint8Array(g),a.length)}else n=new Uint8Array(a);this.connection.send(n.buffer)}hN(g,i){const a=[e.Protocol.ROOM_DATA_BYTES];let n;"string"===typeof g?j.encode.string(a,g):j.encode.number(a,g),n=new Uint8Array(a.length+(i.byteLength||i.length)),n.set(new Uint8Array(a),0),n.set(new Uint8Array(i),a.length),this.connection.send(n.buffer)}get state(){return this.serializer.getState()}Li(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(g){const i=Array.from(new Uint8Array(g.data)),a=i[0];if(a===e.Protocol.JOIN_ROOM){let g=1;const a=(0,e.utf8Read)(i,g);if(g+=(0,e.utf8Length)(a),this.serializerId=(0,e.utf8Read)(i,g),g+=(0,e.utf8Length)(this.serializerId),!this.serializer){const g=(0,N.getSerializer)(this.serializerId);this.serializer=new g}i.length>g&&this.serializer.handshake&&this.serializer.handshake(i,{offset:g}),this.reconnectionToken=`${this.roomId}:${a}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([e.Protocol.JOIN_ROOM])}else if(a===e.Protocol.ERROR){const g={offset:1},a=j.decode.number(i,g),n=j.decode.string(i,g);this.onError.invoke(a,n)}else if(a===e.Protocol.LEAVE_ROOM)this.Ce();else if(a===e.Protocol.ROOM_DATA_SCHEMA){const g={offset:1},a=this.serializer.getState().constructor._context.get(j.decode.number(i,g)),n=new a;n.decode(i,g),this.dispatchMessage(a,n)}else if(a===e.Protocol.ROOM_STATE)i.shift(),this.setState(i);else if(a===e.Protocol.ROOM_STATE_PATCH)i.shift(),this.patch(i);else if(a===e.Protocol.ROOM_DATA){const a={offset:1},n=j.decode.stringCheck(i,a)?j.decode.string(i,a):j.decode.number(i,a),L=i.length>a.offset?b.decode(g.data,a.offset):void 0;this.dispatchMessage(n,L)}else if(a===e.Protocol.ROOM_DATA_BYTES){const g={offset:1},a=j.decode.stringCheck(i,g)?j.decode.string(i,g):j.decode.number(i,g);this.dispatchMessage(a,new Uint8Array(i.slice(g.offset)))}}setState(g){this.serializer.setState(g),this.onStateChange.invoke(this.serializer.getState())}patch(g){this.serializer.patch(g),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(g,i){var a;const n=this.getMessageHandlerKey(g);this.onMessageHandlers.events[n]?this.onMessageHandlers.emit(n,i):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",g,i):null===(a=console.warn)||void 0===a||a.call(console,`colyseus.js: onMessage() not registered for type '${g}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(g){switch(typeof g){case"function":return`$${g._typeid}`;case"string":return g;case"number":return`i${g}`;default:throw new Error("invalid message type.")}}}i.Room=B},13167:(g,i)=>{"use strict";let a;function n(){if(!a)try{a="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(g){}return a||(a={cache:{},setItem:function(g,i){this.cache[g]=i},getItem:function(g){this.cache[g]},removeItem:function(g){delete this.cache[g]}}),a}Object.defineProperty(i,"__esModule",{value:!0}),i.getItem=i.removeItem=i.setItem=void 0,i.setItem=function(g,i){n().setItem(g,i)},i.removeItem=function(g){n().removeItem(g)},i.getItem=function(g,i){const a=n().getItem(g);"undefined"!==typeof Promise&&a instanceof Promise?a.then((g=>i(g))):i(a)}},13132:(g,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.createNanoEvents=void 0;i.createNanoEvents=()=>({emit(g){let i=this.events[g]||[];for(var a=arguments.length,n=new Array(a>1?a-1:0),L=1;L<a;L++)n[L-1]=arguments[L];for(let d=0,b=i.length;d<b;d++)i[d](...n)},events:{},on(g,i){var a;return(null===(a=this.events[g])||void 0===a?void 0:a.push(i))||(this.events[g]=[i]),()=>{var a;this.events[g]=null===(a=this.events[g])||void 0===a?void 0:a.filter((g=>i!==g))}}})},13138:(g,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.createSignal=i.EventEmitter=void 0;class a{constructor(){this.handlers=[]}register(g){return this.handlers.push(g),this}invoke(){for(var g=arguments.length,i=new Array(g),a=0;a<g;a++)i[a]=arguments[a];this.handlers.forEach((g=>g.apply(this,i)))}invokeAsync(){for(var g=arguments.length,i=new Array(g),a=0;a<g;a++)i[a]=arguments[a];return Promise.all(this.handlers.map((g=>g.apply(this,i))))}remove(g){const i=this.handlers.indexOf(g);this.handlers[i]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}i.EventEmitter=a,i.createSignal=function(){const g=new a;function i(i){return g.register(i,null===this)}return i.once=i=>{const a=function(){for(var n=arguments.length,L=new Array(n),d=0;d<n;d++)L[d]=arguments[d];i.apply(this,L),g.remove(a)};g.register(a)},i.remove=i=>g.remove(i),i.invoke=function(){return g.invoke(...arguments)},i.invokeAsync=function(){return g.invokeAsync(...arguments)},i.clear=()=>g.clear(),i}},13094:(g,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ServerError=i.CloseCode=void 0,function(g){g[g.CONSENTED=4e3]="CONSENTED",g[g.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(i.CloseCode||(i.CloseCode={}));class a extends Error{constructor(g,i){super(i),this.name="ServerError",this.code=g}}i.ServerError=a},13076:(g,i,a)=>{"use strict";i.c=void 0,a(13083);var n=a(13089);Object.defineProperty(i,"c",{enumerable:!0,get:function(){return n.Client}});var L=a(13121);var d=a(13098);var b=a(13158);const k=a(13176);const e=a(13183),N=a(13123);(0,N.registerSerializer)("schema",k.SchemaSerializer),(0,N.registerSerializer)("none",e.NoneSerializer)},13083:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=g=>null!==g&&"object"===typeof g&&g.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13100:(g,i)=>{"use strict";function a(g,i){if(this._offset=i,g instanceof ArrayBuffer)this._buffer=g,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(g))throw new Error("Invalid argument");this._buffer=g.buffer,this._view=new DataView(this._buffer,g.byteOffset,g.byteLength)}}Object.defineProperty(i,"__esModule",{value:!0}),i.decode=i.encode=void 0,a.prototype._array=function(g){for(var i=new Array(g),a=0;a<g;a++)i[a]=this._parse();return i},a.prototype._map=function(g){for(var i={},a=0;a<g;a++)i[this._parse()]=this._parse();return i},a.prototype._str=function(g){var i=function(g,i,a){for(var n="",L=0,d=i,b=i+a;d<b;d++){var k=g.getUint8(d);if(0!==(128&k))if(192!==(224&k))if(224!==(240&k)){if(240!==(248&k))throw new Error("Invalid byte "+k.toString(16));(L=(7&k)<<18|(63&g.getUint8(++d))<<12|(63&g.getUint8(++d))<<6|63&g.getUint8(++d))>=65536?(L-=65536,n+=String.fromCharCode(55296+(L>>>10),56320+(1023&L))):n+=String.fromCharCode(L)}else n+=String.fromCharCode((15&k)<<12|(63&g.getUint8(++d))<<6|63&g.getUint8(++d));else n+=String.fromCharCode((31&k)<<6|63&g.getUint8(++d));else n+=String.fromCharCode(k)}return n}(this._view,this._offset,g);return this._offset+=g,i},a.prototype._bin=function(g){var i=this._buffer.slice(this._offset,this._offset+g);return this._offset+=g,i},a.prototype._parse=function(){var g,i=this._view.getUint8(this._offset++),a=0,n=0,L=0,d=0;if(i<192)return i<128?i:i<144?this._map(15&i):i<160?this._array(15&i):this._str(31&i);if(i>223)return-1*(255-i+1);switch(i){case 192:return null;case 194:return!1;case 195:return!0;case 196:return a=this._view.getUint8(this._offset),this._offset+=1,this._bin(a);case 197:return a=this._view.getUint16(this._offset),this._offset+=2,this._bin(a);case 198:return a=this._view.getUint32(this._offset),this._offset+=4,this._bin(a);case 199:if(a=this._view.getUint8(this._offset),n=this._view.getInt8(this._offset+1),this._offset+=2,-1===n){var b=this._view.getUint32(this._offset);return L=this._view.getInt32(this._offset+4),d=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*L+d)+b/1e6)}return[n,this._bin(a)];case 200:return a=this._view.getUint16(this._offset),n=this._view.getInt8(this._offset+2),this._offset+=3,[n,this._bin(a)];case 201:return a=this._view.getUint32(this._offset),n=this._view.getInt8(this._offset+4),this._offset+=5,[n,this._bin(a)];case 202:return g=this._view.getFloat32(this._offset),this._offset+=4,g;case 203:return g=this._view.getFloat64(this._offset),this._offset+=8,g;case 204:return g=this._view.getUint8(this._offset),this._offset+=1,g;case 205:return g=this._view.getUint16(this._offset),this._offset+=2,g;case 206:return g=this._view.getUint32(this._offset),this._offset+=4,g;case 207:return L=this._view.getUint32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,L+d;case 208:return g=this._view.getInt8(this._offset),this._offset+=1,g;case 209:return g=this._view.getInt16(this._offset),this._offset+=2,g;case 210:return g=this._view.getInt32(this._offset),this._offset+=4,g;case 211:return L=this._view.getInt32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,L+d;case 212:return n=this._view.getInt8(this._offset),this._offset+=1,0===n?void(this._offset+=1):[n,this._bin(1)];case 213:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(2)];case 214:return n=this._view.getInt8(this._offset),this._offset+=1,-1===n?(g=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*g)):[n,this._bin(4)];case 215:return n=this._view.getInt8(this._offset),this._offset+=1,0===n?(L=this._view.getInt32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,new Date(L+d)):-1===n?(L=this._view.getUint32(this._offset),d=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&L)+d)+(L>>>2)/1e6)):[n,this._bin(8)];case 216:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(16)];case 217:return a=this._view.getUint8(this._offset),this._offset+=1,this._str(a);case 218:return a=this._view.getUint16(this._offset),this._offset+=2,this._str(a);case 219:return a=this._view.getUint32(this._offset),this._offset+=4,this._str(a);case 220:return a=this._view.getUint16(this._offset),this._offset+=2,this._array(a);case 221:return a=this._view.getUint32(this._offset),this._offset+=4,this._array(a);case 222:return a=this._view.getUint16(this._offset),this._offset+=2,this._map(a);case 223:return a=this._view.getUint32(this._offset),this._offset+=4,this._map(a)}throw new Error("Could not parse")},i.decode=function(g){var i=new a(g,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),n=i._parse();if(i._offset!==g.byteLength)throw new Error(g.byteLength-i._offset+" trailing bytes");return n};function n(g,i,a){for(var n=0,L=0,d=a.length;L<d;L++)(n=a.charCodeAt(L))<128?g.setUint8(i++,n):n<2048?(g.setUint8(i++,192|n>>6),g.setUint8(i++,128|63&n)):n<55296||n>=57344?(g.setUint8(i++,224|n>>12),g.setUint8(i++,128|n>>6&63),g.setUint8(i++,128|63&n)):(L++,n=65536+((1023&n)<<10|1023&a.charCodeAt(L)),g.setUint8(i++,240|n>>18),g.setUint8(i++,128|n>>12&63),g.setUint8(i++,128|n>>6&63),g.setUint8(i++,128|63&n))}function L(g,i,a){var n=typeof a,d=0,b=0,k=0,e=0,N=0,F=0;if("string"===n){if(N=function(g){for(var i=0,a=0,n=0,L=g.length;n<L;n++)(i=g.charCodeAt(n))<128?a+=1:i<2048?a+=2:i<55296||i>=57344?a+=3:(n++,a+=4);return a}(a),N<32)g.push(160|N),F=1;else if(N<256)g.push(217,N),F=2;else if(N<65536)g.push(218,N>>8,N),F=3;else{if(!(N<4294967296))throw new Error("String too long");g.push(219,N>>24,N>>16,N>>8,N),F=5}return i.push({_str:a,_length:N,_offset:g.length}),F+N}if("number"===n)return Math.floor(a)===a&&isFinite(a)?a>=0?a<128?(g.push(a),1):a<256?(g.push(204,a),2):a<65536?(g.push(205,a>>8,a),3):a<4294967296?(g.push(206,a>>24,a>>16,a>>8,a),5):(k=a/Math.pow(2,32)|0,e=a>>>0,g.push(207,k>>24,k>>16,k>>8,k,e>>24,e>>16,e>>8,e),9):a>=-32?(g.push(a),1):a>=-128?(g.push(208,a),2):a>=-32768?(g.push(209,a>>8,a),3):a>=-2147483648?(g.push(210,a>>24,a>>16,a>>8,a),5):(k=Math.floor(a/Math.pow(2,32)),e=a>>>0,g.push(211,k>>24,k>>16,k>>8,k,e>>24,e>>16,e>>8,e),9):(g.push(203),i.push({_float:a,_length:8,_offset:g.length}),9);if("object"===n){if(null===a)return g.push(192),1;if(Array.isArray(a)){if((N=a.length)<16)g.push(144|N),F=1;else if(N<65536)g.push(220,N>>8,N),F=3;else{if(!(N<4294967296))throw new Error("Array too large");g.push(221,N>>24,N>>16,N>>8,N),F=5}for(d=0;d<N;d++)F+=L(g,i,a[d]);return F}if(a instanceof Date){var I=a.getTime(),j=Math.floor(I/1e3),y=1e6*(I-1e3*j);return j>=0&&y>=0&&j<=17179869183?0===y&&j<=4294967295?(g.push(214,255,j>>24,j>>16,j>>8,j),6):(k=j/4294967296,e=4294967295&j,g.push(215,255,y>>22,y>>14,y>>6,k,e>>24,e>>16,e>>8,e),10):(k=Math.floor(j/4294967296),e=j>>>0,g.push(199,12,255,y>>24,y>>16,y>>8,y,k>>24,k>>16,k>>8,k,e>>24,e>>16,e>>8,e),15)}if(a instanceof ArrayBuffer){if((N=a.byteLength)<256)g.push(196,N),F=2;else if(N<65536)g.push(197,N>>8,N),F=3;else{if(!(N<4294967296))throw new Error("Buffer too large");g.push(198,N>>24,N>>16,N>>8,N),F=5}return i.push({_bin:a,_length:N,_offset:g.length}),F+N}if("function"===typeof a.toJSON)return L(g,i,a.toJSON());var B=[],c="",D=Object.keys(a);for(d=0,b=D.length;d<b;d++)void 0!==a[c=D[d]]&&"function"!==typeof a[c]&&B.push(c);if((N=B.length)<16)g.push(128|N),F=1;else if(N<65536)g.push(222,N>>8,N),F=3;else{if(!(N<4294967296))throw new Error("Object too large");g.push(223,N>>24,N>>16,N>>8,N),F=5}for(d=0;d<N;d++)F+=L(g,i,c=B[d]),F+=L(g,i,a[c]);return F}if("boolean"===n)return g.push(a?195:194),1;if("undefined"===n)return g.push(192),1;if("function"===typeof a.toJSON)return L(g,i,a.toJSON());throw new Error("Could not encode")}i.encode=function(g){var i=[],a=[],d=L(i,a,g),b=new ArrayBuffer(d),k=new DataView(b),e=0,N=0,F=-1;a.length>0&&(F=a[0]._offset);for(var I,j=0,y=0,B=0,c=i.length;B<c;B++)if(k.setUint8(N+B,i[B]),B+1===F){if(j=(I=a[e])._length,y=N+F,I._bin)for(var D=new Uint8Array(I._bin),p=0;p<j;p++)k.setUint8(y+p,D[p]);else I._str?n(k,y,I._str):void 0!==I._float&&k.setFloat64(y,I._float);N+=j,a[++e]&&(F=a[e]._offset)}return b}},13183:(g,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.NoneSerializer=void 0;i.NoneSerializer=class{setState(g){}getState(){return null}patch(g){}teardown(){}handshake(g){}}},13176:(g,i,a)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SchemaSerializer=void 0;const n=a(13140);i.SchemaSerializer=class{setState(g){return this.state.decode(g)}getState(){return this.state}patch(g){return this.state.decode(g)}teardown(){var g,i;null===(i=null===(g=this.state)||void 0===g?void 0:g.$changes)||void 0===i||i.root.clearRefs()}handshake(g,i){if(this.state){(new n.Reflection).decode(g,i)}else this.state=n.Reflection.decode(g,i)}}},13123:(g,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.getSerializer=i.registerSerializer=void 0;const a={};i.registerSerializer=function(g,i){a[g]=i},i.getSerializer=function(g){const i=a[g];if(!i)throw new Error("missing serializer: "+g);return i}},13107:function(g,i,a){"use strict";var n=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(i,"__esModule",{value:!0}),i.WebSocketTransport=void 0;const L=n(a(13116)),d=globalThis.WebSocket||L.default;i.WebSocketTransport=class{constructor(g){this.events=g}send(g){g instanceof ArrayBuffer?this.ws.send(g):Array.isArray(g)&&this.ws.send(new Uint8Array(g).buffer)}connect(g,i){try{this.ws=new d(g,{headers:i,protocols:this.protocols})}catch(a){this.ws=new d(g,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(g,i){this.ws.close(g,i)}get isOpen(){return this.ws.readyState===d.OPEN}}},13116:g=>{"use strict";g.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13583:g=>{"use strict";g.exports=function(g){for(var i=new Array(g),a=0;a<g;++a)i[a]=a;return i}},13586:g=>{function i(g){return!!g.constructor&&"function"===typeof g.constructor.isBuffer&&g.constructor.isBuffer(g)}g.exports=function(g){return null!=g&&(i(g)||function(g){return"function"===typeof g.readFloatLE&&"function"===typeof g.slice&&i(g.slice(0,0))}(g)||!!g._isBuffer)}},13579:(g,i,a)=>{var n=a(13583),L=a(13586),d="undefined"!==typeof Float64Array;function b(g,i){return g[0]-i[0]}function k(){var g,i=this.stride,a=new Array(i.length);for(g=0;g<a.length;++g)a[g]=[Math.abs(i[g]),g];a.sort(b);var n=new Array(a.length);for(g=0;g<n.length;++g)n[g]=a[g][1];return n}function e(g,i){var a=["View",i,"d",g].join("");i<0&&(a="View_Nil"+g);var L="generic"===g;if(-1===i){var d="function "+a+"(a){this.data=a;};var proto="+a+".prototype;proto.dtype='"+g+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+a+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+a+"(a){return new "+a+"(a);}";return new Function(d)()}if(0===i){d="function "+a+"(a,d) {this.data = a;this.offset = d};var proto="+a+".prototype;proto.dtype='"+g+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+a+"_copy() {return new "+a+"(this.data,this.offset)};proto.pick=function "+a+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+a+"_get(){return "+(L?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+a+"_set(v){return "+(L?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+a+"(a,b,c,d){return new "+a+"(a,d)}";return new Function("TrivialArray",d)(N[g][0])}d=["'use strict'"];var b=n(i),e=b.map((function(g){return"i"+g})),F="this.offset+"+b.map((function(g){return"this.stride["+g+"]*i"+g})).join("+"),I=b.map((function(g){return"b"+g})).join(","),j=b.map((function(g){return"c"+g})).join(",");d.push("function "+a+"(a,"+I+","+j+",d){this.data=a","this.shape=["+I+"]","this.stride=["+j+"]","this.offset=d|0}","var proto="+a+".prototype","proto.dtype='"+g+"'","proto.dimension="+i),d.push("Object.defineProperty(proto,'size',{get:function "+a+"_size(){return "+b.map((function(g){return"this.shape["+g+"]"})).join("*"),"}})"),1===i?d.push("proto.order=[0]"):(d.push("Object.defineProperty(proto,'order',{get:"),i<4?(d.push("function "+a+"_order(){"),2===i?d.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===i&&d.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):d.push("ORDER})")),d.push("proto.set=function "+a+"_set("+e.join(",")+",v){"),L?d.push("return this.data.set("+F+",v)}"):d.push("return this.data["+F+"]=v}"),d.push("proto.get=function "+a+"_get("+e.join(",")+"){"),L?d.push("return this.data.get("+F+")}"):d.push("return this.data["+F+"]}"),d.push("proto.index=function "+a+"_index(",e.join(),"){return "+F+"}"),d.push("proto.hi=function "+a+"_hi("+e.join(",")+"){return new "+a+"(this.data,"+b.map((function(g){return["(typeof i",g,"!=='number'||i",g,"<0)?this.shape[",g,"]:i",g,"|0"].join("")})).join(",")+","+b.map((function(g){return"this.stride["+g+"]"})).join(",")+",this.offset)}");var y=b.map((function(g){return"a"+g+"=this.shape["+g+"]"})),B=b.map((function(g){return"c"+g+"=this.stride["+g+"]"}));d.push("proto.lo=function "+a+"_lo("+e.join(",")+"){var b=this.offset,d=0,"+y.join(",")+","+B.join(","));for(var c=0;c<i;++c)d.push("if(typeof i"+c+"==='number'&&i"+c+">=0){d=i"+c+"|0;b+=c"+c+"*d;a"+c+"-=d}");d.push("return new "+a+"(this.data,"+b.map((function(g){return"a"+g})).join(",")+","+b.map((function(g){return"c"+g})).join(",")+",b)}"),d.push("proto.step=function "+a+"_step("+e.join(",")+"){var "+b.map((function(g){return"a"+g+"=this.shape["+g+"]"})).join(",")+","+b.map((function(g){return"b"+g+"=this.stride["+g+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(c=0;c<i;++c)d.push("if(typeof i"+c+"==='number'){d=i"+c+"|0;if(d<0){c+=b"+c+"*(a"+c+"-1);a"+c+"=ceil(-a"+c+"/d)}else{a"+c+"=ceil(a"+c+"/d)}b"+c+"*=d}");d.push("return new "+a+"(this.data,"+b.map((function(g){return"a"+g})).join(",")+","+b.map((function(g){return"b"+g})).join(",")+",c)}");var D=new Array(i),p=new Array(i);for(c=0;c<i;++c)D[c]="a[i"+c+"]",p[c]="b[i"+c+"]";d.push("proto.transpose=function "+a+"_transpose("+e+"){"+e.map((function(g,i){return g+"=("+g+"===undefined?"+i+":"+g+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+a+"(this.data,"+D.join(",")+","+p.join(",")+",this.offset)}"),d.push("proto.pick=function "+a+"_pick("+e+"){var a=[],b=[],c=this.offset");for(c=0;c<i;++c)d.push("if(typeof i"+c+"==='number'&&i"+c+">=0){c=(c+this.stride["+c+"]*i"+c+")|0}else{a.push(this.shape["+c+"]);b.push(this.stride["+c+"])}");return d.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),d.push("return function construct_"+a+"(data,shape,stride,offset){return new "+a+"(data,"+b.map((function(g){return"shape["+g+"]"})).join(",")+","+b.map((function(g){return"stride["+g+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",d.join("\n"))(N[g],k)}var N={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};g.exports=function(g,i,a,n){if(void 0===g)return(0,N.array[0])([]);"number"===typeof g&&(g=[g]),void 0===i&&(i=[g.length]);var b=i.length;if(void 0===a){a=new Array(b);for(var k=b-1,F=1;k>=0;--k)a[k]=F,F*=i[k]}if(void 0===n){n=0;for(k=0;k<b;++k)a[k]<0&&(n-=(i[k]-1)*a[k])}for(var I=function(g){if(L(g))return"buffer";if(d)switch(Object.prototype.toString.call(g)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(g)?"array":"generic"}(g),j=N[I];j.length<=b+1;)j.push(e(I,j.length-1));return(0,j[b+1])(g,i,a,n)}},14628:g=>{var i;self,i=()=>(()=>{"use strict";var g={d:(i,a)=>{for(var n in a)g.o(a,n)&&!g.o(i,n)&&Object.defineProperty(i,n,{enumerable:!0,get:a[n]})},o:(g,i)=>Object.prototype.hasOwnProperty.call(g,i)},i={};g.d(i,{default:()=>l});var a,n=function(g,i){var a=i.x-g.x,n=i.y-g.y;return Math.sqrt(a*a+n*n)},L=function(g){return g*(Math.PI/180)},d=new Map,b=function(g){d.has(g)&&clearTimeout(d.get(g)),d.set(g,setTimeout(g,100))},k=function(g,i,a){for(var n,L=i.split(/[ ,]+/g),d=0;d<L.length;d+=1)n=L[d],g.addEventListener?g.addEventListener(n,a,!1):g.attachEvent&&g.attachEvent(n,a)},e=function(g,i,a){for(var n,L=i.split(/[ ,]+/g),d=0;d<L.length;d+=1)n=L[d],g.removeEventListener?g.removeEventListener(n,a):g.detachEvent&&g.detachEvent(n,a)},N=function(g){return g.preventDefault(),g.type.match(/^touch/)?g.changedTouches:g},F=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},I=function(g,i){i.top||i.right||i.bottom||i.left?(g.style.top=i.top,g.style.right=i.right,g.style.bottom=i.bottom,g.style.left=i.left):(g.style.left=i.x+"px",g.style.top=i.y+"px")},j=function(g,i,a){var n=y(g);for(var L in n)if(n.hasOwnProperty(L))if("string"==typeof i)n[L]=i+" "+a;else{for(var d="",b=0,k=i.length;b<k;b+=1)d+=i[b]+" "+a+", ";n[L]=d.slice(0,-2)}return n},y=function(g){var i={};return i[g]="",["webkit","Moz","o"].forEach((function(a){i[a+g.charAt(0).toUpperCase()+g.slice(1)]=""})),i},B=function(g,i){for(var a in i)i.hasOwnProperty(a)&&(g[a]=i[a]);return g},c=function(g,i){if(g.length)for(var a=0,n=g.length;a<n;a+=1)i(g[a]);else i(g)},D="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,p=window.matchMedia("(any-hover: none)").matches,R=!!("ontouchstart"in window),x=!!window.PointerEvent,E=!!window.MSPointerEvent,X={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},v={start:"mousedown",move:"mousemove",end:"mouseup"},P={};function Y(){}D&&!p?a=X:x?a={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:E?a={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:R?(a=X,P=v):a=v,Y.prototype.on=function(g,i){var a,n=this,L=g.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var d=0;d<L.length;d+=1)a=L[d],n._handlers_[a]=n._handlers_[a]||[],n._handlers_[a].push(i);return n},Y.prototype.off=function(g,i){var a=this;return a._handlers_=a._handlers_||{},void 0===g?a._handlers_={}:void 0===i?a._handlers_[g]=null:a._handlers_[g]&&a._handlers_[g].indexOf(i)>=0&&a._handlers_[g].splice(a._handlers_[g].indexOf(i),1),a},Y.prototype.trigger=function(g,i){var a,n=this,L=g.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var d=0;d<L.length;d+=1)a=L[d],n._handlers_[a]&&n._handlers_[a].length&&n._handlers_[a].forEach((function(g){g.call(n,{type:a,target:n},i)}))},Y.prototype.config=function(g){var i=this;i.options=i.defaults||{},g&&(i.options=function(g,i){var a={};for(var n in g)g.hasOwnProperty(n)&&i.hasOwnProperty(n)?a[n]=i[n]:g.hasOwnProperty(n)&&(a[n]=g[n]);return a}(i.options,g))},Y.prototype.bindEvt=function(g,i){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[i]=function(){"function"==typeof n["on"+i]?n["on"+i].apply(n,arguments):console.warn('[WARNING] : Missing "on'+i+'" handler.')},k(g,a[i],n._domHandlers_[i]),P[i]&&k(g,P[i],n._domHandlers_[i]),n},Y.prototype.unbindEvt=function(g,i){var n=this;return n._domHandlers_=n._domHandlers_||{},e(g,a[i],n._domHandlers_[i]),P[i]&&e(g,P[i],n._domHandlers_[i]),delete n._domHandlers_[i],this};const f=Y;function C(g,i){return this.identifier=i.identifier,this.position=i.position,this.frontPosition=i.frontPosition,this.collection=g,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(i),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=C.id,C.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}C.prototype=new f,C.constructor=C,C.id=0,C.prototype.buildEl=function(g){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},C.prototype.stylize=function(){if(this.options.dataOnly)return this;var g=this.options.fadeTime+"ms",i=function(){var g=y("borderRadius");for(var i in g)g.hasOwnProperty(i)&&(g[i]="50%");return g}(),a=j("transition","opacity",g),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},B(n.el,a),"circle"===this.options.shape&&B(n.back,i),B(n.front,i),this.applyStyles(n),this},C.prototype.applyStyles=function(g){for(var i in this.ui)if(this.ui.hasOwnProperty(i))for(var a in g[i])this.ui[i].style[a]=g[i][a];return this},C.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},C.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},C.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},C.prototype.show=function(g){var i=this;return i.options.dataOnly||(clearTimeout(i.removeTimeout),clearTimeout(i.showTimeout),clearTimeout(i.restTimeout),i.addToDom(),i.restCallback(),setTimeout((function(){i.ui.el.style.opacity=1}),0),i.showTimeout=setTimeout((function(){i.trigger("shown",i.instance),"function"==typeof g&&g.call(this)}),i.options.fadeTime)),i},C.prototype.hide=function(g){var i=this;if(i.options.dataOnly)return i;if(i.ui.el.style.opacity=i.options.restOpacity,clearTimeout(i.removeTimeout),clearTimeout(i.showTimeout),clearTimeout(i.restTimeout),i.removeTimeout=setTimeout((function(){var a="dynamic"===i.options.mode?"none":"block";i.ui.el.style.display=a,"function"==typeof g&&g.call(i),i.trigger("hidden",i.instance)}),i.options.fadeTime),i.options.restJoystick){var a=i.options.restJoystick,n={};n.x=!0===a||!1!==a.x?0:i.instance.frontPosition.x,n.y=!0===a||!1!==a.y?0:i.instance.frontPosition.y,i.setPosition(g,n)}return i},C.prototype.setPosition=function(g,i){var a=this;a.frontPosition={x:i.x,y:i.y};var n=a.options.fadeTime+"ms",L={};L.front=j("transition",["transform"],n);var d={front:{}};d.front={transform:"translate("+a.frontPosition.x+"px,"+a.frontPosition.y+"px)"},a.applyStyles(L),a.applyStyles(d),a.restTimeout=setTimeout((function(){"function"==typeof g&&g.call(a),a.restCallback()}),a.options.fadeTime)},C.prototype.restCallback=function(){var g=this,i={};i.front=j("transition","none",""),g.applyStyles(i),g.trigger("rested",g.instance)},C.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},C.prototype.computeDirection=function(g){var i,a,n,L=g.angle.radian,d=Math.PI/4,b=Math.PI/2;if(L>d&&L<3*d&&!g.lockX?i="up":L>-d&&L<=d&&!g.lockY?i="left":L>3*-d&&L<=-d&&!g.lockX?i="down":g.lockY||(i="right"),g.lockY||(a=L>-b&&L<b?"left":"right"),g.lockX||(n=L>0?"up":"down"),g.force>this.options.threshold){var k,e={};for(k in this.direction)this.direction.hasOwnProperty(k)&&(e[k]=this.direction[k]);var N={};for(k in this.direction={x:a,y:n,angle:i},g.direction=this.direction,e)e[k]===this.direction[k]&&(N[k]=!0);if(N.x&&N.y&&N.angle)return g;N.x&&N.y||this.trigger("plain",g),N.x||this.trigger("plain:"+a,g),N.y||this.trigger("plain:"+n,g),N.angle||this.trigger("dir dir:"+i,g)}else this.resetDirection();return g};const U=C;function S(g,i){var a=this;a.nipples=[],a.idles=[],a.actives=[],a.ids=[],a.pressureIntervals={},a.manager=g,a.id=S.id,S.id+=1,a.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},a.config(i),"static"!==a.options.mode&&"semi"!==a.options.mode||(a.options.multitouch=!1),a.options.multitouch||(a.options.maxNumberOfNipples=1);var n=getComputedStyle(a.options.zone.parentElement);return n&&"flex"===n.display&&(a.parentIsFlex=!0),a.updateBox(),a.prepareNipples(),a.ky(),a.begin(),a.nipples}S.prototype=new f,S.constructor=S,S.id=0,S.prototype.prepareNipples=function(){var g=this,i=g.nipples;i.on=g.on.bind(g),i.off=g.off.bind(g),i.options=g.options,i.destroy=g.destroy.bind(g),i.ids=g.ids,i.id=g.id,i.processOnMove=g.processOnMove.bind(g),i.processOnEnd=g.processOnEnd.bind(g),i.get=function(g){if(void 0===g)return i[0];for(var a=0,n=i.length;a<n;a+=1)if(i[a].identifier===g)return i[a];return!1}},S.prototype.ky=function(){var g=this;g.bindEvt(g.options.zone,"start"),g.options.zone.style.touchAction="none",g.options.zone.style.msTouchAction="none"},S.prototype.begin=function(){var g=this,i=g.options;if("static"===i.mode){var a=g.createNipple(i.position,g.manager.getIdentifier());a.add(),g.idles.push(a)}},S.prototype.createNipple=function(g,i){var a=this,n=a.manager.scroll,L={},d=a.options,b=a.parentIsFlex?n.x:n.x+a.box.left,k=a.parentIsFlex?n.y:n.y+a.box.top;if(g.x&&g.y)L={x:g.x-b,y:g.y-k};else if(g.top||g.right||g.bottom||g.left){var e=document.createElement("DIV");e.style.display="hidden",e.style.top=g.top,e.style.right=g.right,e.style.bottom=g.bottom,e.style.left=g.left,e.style.position="absolute",d.zone.appendChild(e);var N=e.getBoundingClientRect();d.zone.removeChild(e),L=g,g={x:N.left+n.x,y:N.top+n.y}}var F=new U(a,{color:d.color,size:d.size,threshold:d.threshold,fadeTime:d.fadeTime,dataOnly:d.dataOnly,restJoystick:d.restJoystick,restOpacity:d.restOpacity,mode:d.mode,identifier:i,position:g,zone:d.zone,frontPosition:{x:0,y:0},shape:d.shape});return d.dataOnly||(I(F.ui.el,L),I(F.ui.front,F.frontPosition)),a.nipples.push(F),a.trigger("added "+F.identifier+":added",F),a.manager.trigger("added "+F.identifier+":added",F),a.bindNipple(F),F},S.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},S.prototype.bindNipple=function(g){var i,a=this,n=function(g,n){i=g.type+" "+n.id+":"+g.type,a.trigger(i,n)};g.on("destroyed",a.onDestroyed.bind(a)),g.on("shown hidden rested dir plain",n),g.on("dir:up dir:right dir:down dir:left",n),g.on("plain:up plain:right plain:down plain:left",n)},S.prototype.pressureFn=function(g,i,a){var n=this,L=0;clearInterval(n.pressureIntervals[a]),n.pressureIntervals[a]=setInterval(function(){var a=g.force||g.pressure||g.webkitForce||0;a!==L&&(i.trigger("pressure",a),n.trigger("pressure "+i.identifier+":pressure",a),L=a)}.bind(n),100)},S.prototype.onstart=function(g){var i=this,a=i.options,n=g;return g=N(g),i.updateBox(),c(g,(function(L){i.actives.length<a.maxNumberOfNipples?i.processOnStart(L):n.type.match(/^touch/)&&(Object.keys(i.manager.ids).forEach((function(a){if(Object.values(n.touches).findIndex((function(g){return g.identifier===a}))<0){var L=[g[0]];L.identifier=a,i.processOnEnd(L)}})),i.actives.length<a.maxNumberOfNipples&&i.processOnStart(L))})),i.manager.bindDocument(),!1},S.prototype.processOnStart=function(g){var i,a=this,L=a.options,d=a.manager.getIdentifier(g),b=g.force||g.pressure||g.webkitForce||0,k={x:g.pageX,y:g.pageY},e=a.getOrCreate(d,k);e.identifier!==d&&a.manager.removeIdentifier(e.identifier),e.identifier=d;var N=function(i){i.trigger("start",i),a.trigger("start "+i.id+":start",i),i.show(),b>0&&a.pressureFn(g,i,i.identifier),a.processOnMove(g)};if((i=a.idles.indexOf(e))>=0&&a.idles.splice(i,1),a.actives.push(e),a.ids.push(e.identifier),"semi"!==L.mode)N(e);else{if(!(n(k,e.position)<=L.catchDistance))return e.destroy(),void a.processOnStart(g);N(e)}return e},S.prototype.getOrCreate=function(g,i){var a,n=this,L=n.options;return/(semi|static)/.test(L.mode)?(a=n.idles[0])?(n.idles.splice(0,1),a):"semi"===L.mode?n.createNipple(i,g):(console.warn("Coudln't find the needed nipple."),!1):a=n.createNipple(i,g)},S.prototype.processOnMove=function(g){var i=this,a=i.options,d=i.manager.getIdentifier(g),b=i.nipples.get(d),k=i.manager.scroll;if(function(g){return isNaN(g.buttons)?0!==g.pressure:0!==g.buttons}(g)){if(!b)return console.error("Found zombie joystick with ID "+d),void i.manager.removeIdentifier(d);if(a.dynamicPage){var e=b.el.getBoundingClientRect();b.position={x:k.x+e.left,y:k.y+e.top}}b.identifier=d;var N=b.options.size/2,F={x:g.pageX,y:g.pageY};a.lockX&&(F.y=b.position.y),a.lockY&&(F.x=b.position.x);var I,j,y,B,c,D,p,R,x,E,X=n(F,b.position),v=(I=F,y=(j=b.position).x-I.x,B=j.y-I.y,function(g){return g*(180/Math.PI)}(Math.atan2(B,y))),P=L(v),Y=X/N,f={distance:X,position:F};if("circle"===b.options.shape?(c=Math.min(X,N),p=b.position,R=c,E={x:0,y:0},x=L(x=v),E.x=p.x-R*Math.cos(x),E.y=p.y-R*Math.sin(x),D=E):(D=function(g,i,a){return{x:Math.min(Math.max(g.x,i.x-a),i.x+a),y:Math.min(Math.max(g.y,i.y-a),i.y+a)}}(F,b.position,N),c=n(D,b.position)),a.follow){if(X>N){var C=F.x-D.x,U=F.y-D.y;b.position.x+=C,b.position.y+=U,b.el.style.top=b.position.y-(i.box.top+k.y)+"px",b.el.style.left=b.position.x-(i.box.left+k.x)+"px",X=n(F,b.position)}}else F=D,X=c;var S=F.x-b.position.x,V=F.y-b.position.y;b.frontPosition={x:S,y:V},a.dataOnly||(b.ui.front.style.transform="translate("+S+"px,"+V+"px)");var K={identifier:b.identifier,position:F,force:Y,pressure:g.force||g.pressure||g.webkitForce||0,distance:X,angle:{radian:P,degree:v},vector:{x:S/N,y:-V/N},raw:f,instance:b,lockX:a.lockX,lockY:a.lockY};(K=b.computeDirection(K)).angle={radian:L(180-v),degree:180-v},b.trigger("move",K),i.trigger("move "+b.id+":move",K)}else this.processOnEnd(g)},S.prototype.processOnEnd=function(g){var i=this,a=i.options,n=i.manager.getIdentifier(g),L=i.nipples.get(n),d=i.manager.removeIdentifier(L.identifier);L&&(a.dataOnly||L.hide((function(){"dynamic"===a.mode&&(L.trigger("removed",L),i.trigger("removed "+L.id+":removed",L),i.manager.trigger("removed "+L.id+":removed",L),L.destroy())})),clearInterval(i.pressureIntervals[L.identifier]),L.resetDirection(),L.trigger("end",L),i.trigger("end "+L.id+":end",L),i.ids.indexOf(L.identifier)>=0&&i.ids.splice(i.ids.indexOf(L.identifier),1),i.actives.indexOf(L)>=0&&i.actives.splice(i.actives.indexOf(L),1),/(semi|static)/.test(a.mode)?i.idles.push(L):i.nipples.indexOf(L)>=0&&i.nipples.splice(i.nipples.indexOf(L),1),i.manager.unbindDocument(),/(semi|static)/.test(a.mode)&&(i.manager.ids[d.id]=d.identifier))},S.prototype.onDestroyed=function(g,i){var a=this;a.nipples.indexOf(i)>=0&&a.nipples.splice(a.nipples.indexOf(i),1),a.actives.indexOf(i)>=0&&a.actives.splice(a.actives.indexOf(i),1),a.idles.indexOf(i)>=0&&a.idles.splice(a.idles.indexOf(i),1),a.ids.indexOf(i.identifier)>=0&&a.ids.splice(a.ids.indexOf(i.identifier),1),a.manager.removeIdentifier(i.identifier),a.manager.unbindDocument()},S.prototype.destroy=function(){var g=this;for(var i in g.unbindEvt(g.options.zone,"start"),g.nipples.forEach((function(g){g.destroy()})),g.pressureIntervals)g.pressureIntervals.hasOwnProperty(i)&&clearInterval(g.pressureIntervals[i]);g.trigger("destroyed",g.nipples),g.manager.unbindDocument(),g.off()};const V=S;function K(g){var i=this;i.ids={},i.index=0,i.collections=[],i.scroll=F(),i.config(g),i.prepareCollections();var a=function(){var g;i.collections.forEach((function(a){a.forEach((function(a){g=a.el.getBoundingClientRect(),a.position={x:i.scroll.x+g.left,y:i.scroll.y+g.top}}))}))};k(window,"resize",(function(){b(a)}));var n=function(){i.scroll=F()};return k(window,"scroll",(function(){b(n)})),i.collections}K.prototype=new f,K.constructor=K,K.prototype.prepareCollections=function(){var g=this;g.collections.create=g.create.bind(g),g.collections.on=g.on.bind(g),g.collections.off=g.off.bind(g),g.collections.destroy=g.destroy.bind(g),g.collections.get=function(i){var a;return g.collections.every((function(g){return!(a=g.get(i))})),a}},K.prototype.create=function(g){return this.createCollection(g)},K.prototype.createCollection=function(g){var i=this,a=new V(i,g);return i.bindCollection(a),i.collections.push(a),a},K.prototype.bindCollection=function(g){var i,a=this,n=function(g,n){i=g.type+" "+n.id+":"+g.type,a.trigger(i,n)};g.on("destroyed",a.onDestroyed.bind(a)),g.on("shown hidden rested dir plain",n),g.on("dir:up dir:right dir:down dir:left",n),g.on("plain:up plain:right plain:down plain:left",n)},K.prototype.bindDocument=function(){var g=this;g.binded||(g.bindEvt(document,"move").bindEvt(document,"end"),g.binded=!0)},K.prototype.unbindDocument=function(g){var i=this;Object.keys(i.ids).length&&!0!==g||(i.unbindEvt(document,"move").unbindEvt(document,"end"),i.binded=!1)},K.prototype.getIdentifier=function(g){var i;return g?void 0===(i=void 0===g.identifier?g.pointerId:g.identifier)&&(i=this.latest||0):i=this.index,void 0===this.ids[i]&&(this.ids[i]=this.index,this.index+=1),this.latest=i,this.ids[i]},K.prototype.removeIdentifier=function(g){var i={};for(var a in this.ids)if(this.ids[a]===g){i.id=a,i.identifier=this.ids[a],delete this.ids[a];break}return i},K.prototype.onmove=function(g){return this.onAny("move",g),!1},K.prototype.onend=function(g){return this.onAny("end",g),!1},K.prototype.oncancel=function(g){return this.onAny("end",g),!1},K.prototype.onAny=function(g,i){var a,n=this,L="processOn"+g.charAt(0).toUpperCase()+g.slice(1);i=N(i);var d=function(g,i,a){a.ids.indexOf(i)>=0&&(a[L](g),g._found_=!0)};return c(i,(function(g){a=n.getIdentifier(g),c(n.collections,d.bind(null,g,a)),g._found_||n.removeIdentifier(a)})),!1},K.prototype.destroy=function(){var g=this;g.unbindDocument(!0),g.ids={},g.index=0,g.collections.forEach((function(g){g.destroy()})),g.off()},K.prototype.onDestroyed=function(g,i){var a=this;if(a.collections.indexOf(i)<0)return!1;a.collections.splice(a.collections.indexOf(i),1)};var T=new K;const l={create:function(g){return T.create(g)},factory:T};return i.default})(),g.exports=i()},13606:(g,i,a)=>{"use strict";const{Deflate:n,deflate:L,deflateRaw:d,gzip:b}=a(13615),{Inflate:k,inflate:e,inflateRaw:N,ungzip:F}=a(13661),I=a(13645);g.exports.Deflate=n,g.exports.deflate=L,g.exports.deflateRaw=d,g.exports.gzip=b,g.exports.Inflate=k,g.exports.inflate=e,g.exports.inflateRaw=N,g.exports.ungzip=F,g.exports.constants=I},13615:(g,i,a)=>{"use strict";const n=a(13619),L=a(13651),d=a(13653),b=a(13639),k=a(13658),e=Object.prototype.toString,{Z_NO_FLUSH:N,Z_SYNC_FLUSH:F,Z_FULL_FLUSH:I,Z_FINISH:j,Z_OK:y,Z_STREAM_END:B,Z_DEFAULT_COMPRESSION:c,Z_DEFAULT_STRATEGY:D,Z_DEFLATED:p}=a(13645);function R(g){this.options=L.assign({level:c,method:p,Ag:16384,windowBits:15,memLevel:8,strategy:D},g||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.Ni="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;let a=n.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(a!==y)throw new Error(b[a]);if(i.header&&n.deflateSetHeader(this.strm,i.header),i.dictionary){let g;if(g="string"===typeof i.dictionary?d.string2buf(i.dictionary):"[object ArrayBuffer]"===e.call(i.dictionary)?new Uint8Array(i.dictionary):i.dictionary,a=n.deflateSetDictionary(this.strm,g),a!==y)throw new Error(b[a]);this._dict_set=!0}}function x(g,i){const a=new R(i);if(a.push(g,!0),a.err)throw a.Ni||b[a.err];return a.result}R.prototype.push=function(g,i){const a=this.strm,L=this.options.Ag;let b,k;if(this.ended)return!1;for(k=i===~~i?i:!0===i?j:N,"string"===typeof g?a.input=d.string2buf(g):"[object ArrayBuffer]"===e.call(g)?a.input=new Uint8Array(g):a.input=g,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(L),a.next_out=0,a.avail_out=L),(k===F||k===I)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if(b=n.deflate(a,k),b===B)return a.next_out>0&&this.onData(a.output.subarray(0,a.next_out)),b=n.deflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===y;if(0!==a.avail_out){if(k>0&&a.next_out>0)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},R.prototype.onData=function(g){this.chunks.push(g)},R.prototype.onEnd=function(g){g===y&&(this.result=L.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.Ni=this.strm.Ni},g.exports.Deflate=R,g.exports.deflate=x,g.exports.deflateRaw=function(g,i){return(i=i||{}).raw=!0,x(g,i)},g.exports.gzip=function(g,i){return(i=i||{}).gzip=!0,x(g,i)},g.exports.constants=a(13645)},13661:(g,i,a)=>{"use strict";const n=a(13667),L=a(13651),d=a(13653),b=a(13639),k=a(13658),e=a(13679),N=Object.prototype.toString,{Z_NO_FLUSH:F,Z_FINISH:I,Z_OK:j,Z_STREAM_END:y,Z_NEED_DICT:B,Z_STREAM_ERROR:c,Z_DATA_ERROR:D,Z_MEM_ERROR:p}=a(13645);function R(g){this.options=L.assign({Ag:65536,windowBits:15,to:""},g||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,0===i.windowBits&&(i.windowBits=-15)),!(i.windowBits>=0&&i.windowBits<16)||g&&g.windowBits||(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&0===(15&i.windowBits)&&(i.windowBits|=15),this.err=0,this.Ni="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;let a=n.inflateInit2(this.strm,i.windowBits);if(a!==j)throw new Error(b[a]);if(this.header=new e,n.inflateGetHeader(this.strm,this.header),i.dictionary&&("string"===typeof i.dictionary?i.dictionary=d.string2buf(i.dictionary):"[object ArrayBuffer]"===N.call(i.dictionary)&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(a=n.inflateSetDictionary(this.strm,i.dictionary),a!==j)))throw new Error(b[a])}function x(g,i){const a=new R(i);if(a.push(g),a.err)throw a.Ni||b[a.err];return a.result}R.prototype.push=function(g,i){const a=this.strm,L=this.options.Ag,b=this.options.dictionary;let k,e,R;if(this.ended)return!1;for(e=i===~~i?i:!0===i?I:F,"[object ArrayBuffer]"===N.call(g)?a.input=new Uint8Array(g):a.input=g,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(L),a.next_out=0,a.avail_out=L),k=n.inflate(a,e),k===B&&b&&(k=n.inflateSetDictionary(a,b),k===j?k=n.inflate(a,e):k===D&&(k=B));a.avail_in>0&&k===y&&a.state.wrap>0&&0!==g[a.next_in];)n.inflateReset(a),k=n.inflate(a,e);switch(k){case c:case D:case B:case p:return this.onEnd(k),this.ended=!0,!1}if(R=a.avail_out,a.next_out&&(0===a.avail_out||k===y))if("string"===this.options.to){let g=d.utf8border(a.output,a.next_out),i=a.next_out-g,n=d.buf2string(a.output,g);a.next_out=i,a.avail_out=L-i,i&&a.output.set(a.output.subarray(g,g+i),0),this.onData(n)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(k!==j||0!==R){if(k===y)return k=n.inflateEnd(this.strm),this.onEnd(k),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},R.prototype.onData=function(g){this.chunks.push(g)},R.prototype.onEnd=function(g){g===j&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=L.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.Ni=this.strm.Ni},g.exports.Inflate=R,g.exports.inflate=x,g.exports.inflateRaw=function(g,i){return(i=i||{}).raw=!0,x(g,i)},g.exports.ungzip=x,g.exports.constants=a(13645)},13651:g=>{"use strict";const i=(g,i)=>Object.prototype.hasOwnProperty.call(g,i);g.exports.assign=function(g){const a=Array.prototype.slice.call(arguments,1);for(;a.length;){const n=a.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(const a in n)i(n,a)&&(g[a]=n[a])}}return g},g.exports.flattenChunks=g=>{let i=0;for(let n=0,L=g.length;n<L;n++)i+=g[n].length;const a=new Uint8Array(i);for(let n=0,L=0,d=g.length;n<d;n++){let i=g[n];a.set(i,L),L+=i.length}return a}},13653:g=>{"use strict";let i=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(n){i=!1}const a=new Uint8Array(256);for(let L=0;L<256;L++)a[L]=L>=252?6:L>=248?5:L>=240?4:L>=224?3:L>=192?2:1;a[254]=a[254]=1,g.exports.string2buf=g=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(g);let i,a,n,L,d,b=g.length,k=0;for(L=0;L<b;L++)a=g.charCodeAt(L),55296===(64512&a)&&L+1<b&&(n=g.charCodeAt(L+1),56320===(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),L++)),k+=a<128?1:a<2048?2:a<65536?3:4;for(i=new Uint8Array(k),d=0,L=0;d<k;L++)a=g.charCodeAt(L),55296===(64512&a)&&L+1<b&&(n=g.charCodeAt(L+1),56320===(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),L++)),a<128?i[d++]=a:a<2048?(i[d++]=192|a>>>6,i[d++]=128|63&a):a<65536?(i[d++]=224|a>>>12,i[d++]=128|a>>>6&63,i[d++]=128|63&a):(i[d++]=240|a>>>18,i[d++]=128|a>>>12&63,i[d++]=128|a>>>6&63,i[d++]=128|63&a);return i};g.exports.buf2string=(g,n)=>{const L=n||g.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(g.subarray(0,n));let d,b;const k=new Array(2*L);for(b=0,d=0;d<L;){let i=g[d++];if(i<128){k[b++]=i;continue}let n=a[i];if(n>4)k[b++]=65533,d+=n-1;else{for(i&=2===n?31:3===n?15:7;n>1&&d<L;)i=i<<6|63&g[d++],n--;n>1?k[b++]=65533:i<65536?k[b++]=i:(i-=65536,k[b++]=55296|i>>10&1023,k[b++]=56320|1023&i)}}return((g,a)=>{if(a<65534&&g.subarray&&i)return String.fromCharCode.apply(null,g.length===a?g:g.subarray(0,a));let n="";for(let i=0;i<a;i++)n+=String.fromCharCode(g[i]);return n})(k,b)},g.exports.utf8border=(g,i)=>{(i=i||g.length)>g.length&&(i=g.length);let n=i-1;for(;n>=0&&128===(192&g[n]);)n--;return n<0||0===n?i:n+a[g[n]]>i?n:i}},13624:g=>{"use strict";g.exports=(g,i,a,n)=>{let L=65535&g,d=g>>>16&65535,b=0;for(;0!==a;){b=a>2e3?2e3:a,a-=b;do{L=L+i[n++]|0,d=d+L|0}while(--b);L%=65521,d%=65521}return L|d<<16}},13645:g=>{"use strict";g.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13631:g=>{"use strict";const i=new Uint32Array((()=>{let g,i=[];for(var a=0;a<256;a++){g=a;for(var n=0;n<8;n++)g=1&g?3988292384^g>>>1:g>>>1;i[a]=g}return i})());g.exports=(g,a,n,L)=>{const d=i,b=L+n;g^=-1;for(let i=L;i<b;i++)g=g>>>8^d[255&(g^a[i])];return~g}},13619:(g,i,a)=>{"use strict";const{_tr_init:n,_tr_stored_block:L,_tr_flush_block:d,_tr_tally:b,_tr_align:k}=a(13622),e=a(13624),N=a(13631),F=a(13639),{Z_NO_FLUSH:I,Z_PARTIAL_FLUSH:j,Z_FULL_FLUSH:y,Z_FINISH:B,Z_BLOCK:c,Z_OK:D,Z_STREAM_END:p,Z_STREAM_ERROR:R,Z_DATA_ERROR:x,Z_BUF_ERROR:E,Z_DEFAULT_COMPRESSION:X,Z_FILTERED:v,Z_HUFFMAN_ONLY:P,Z_RLE:Y,Z_FIXED:f,Z_DEFAULT_STRATEGY:C,Z_UNKNOWN:U,Z_DEFLATED:S}=a(13645),V=258,K=262,T=103,l=113,Z=666,h=(g,i)=>(g.Ni=F[i],i),w=g=>(g<<1)-(g>4?9:0),t=g=>{let i=g.length;for(;--i>=0;)g[i]=0};let A=(g,i,a)=>(i<<g.hash_shift^a)&g.hash_mask;const O=g=>{const i=g.state;let a=i.pending;a>g.avail_out&&(a=g.avail_out),0!==a&&(g.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+a),g.next_out),g.next_out+=a,i.pending_out+=a,g.total_out+=a,g.avail_out-=a,i.pending-=a,0===i.pending&&(i.pending_out=0))},z=(g,i)=>{d(g,g.block_start>=0?g.block_start:-1,g.strstart-g.block_start,i),g.block_start=g.strstart,O(g.strm)},s=(g,i)=>{g.pending_buf[g.pending++]=i},mg=(g,i)=>{g.pending_buf[g.pending++]=i>>>8&255,g.pending_buf[g.pending++]=255&i},r=(g,i,a,n)=>{let L=g.avail_in;return L>n&&(L=n),0===L?0:(g.avail_in-=L,i.set(g.input.subarray(g.next_in,g.next_in+L),a),1===g.state.wrap?g.adler=e(g.adler,i,L,a):2===g.state.wrap&&(g.adler=N(g.adler,i,L,a)),g.next_in+=L,g.total_in+=L,L)},Q=(g,i)=>{let a,n,L=g.max_chain_length,d=g.strstart,b=g.prev_length,k=g.nice_match;const e=g.strstart>g.w_size-K?g.strstart-(g.w_size-K):0,N=g.window,F=g.w_mask,I=g.prev,j=g.strstart+V;let y=N[d+b-1],B=N[d+b];g.prev_length>=g.good_match&&(L>>=2),k>g.lookahead&&(k=g.lookahead);do{if(a=i,N[a+b]===B&&N[a+b-1]===y&&N[a]===N[d]&&N[++a]===N[d+1]){d+=2,a++;do{}while(N[++d]===N[++a]&&N[++d]===N[++a]&&N[++d]===N[++a]&&N[++d]===N[++a]&&N[++d]===N[++a]&&N[++d]===N[++a]&&N[++d]===N[++a]&&N[++d]===N[++a]&&d<j);if(n=V-(j-d),d=j-V,n>b){if(g.match_start=i,b=n,n>=k)break;y=N[d+b-1],B=N[d+b]}}}while((i=I[i&F])>e&&0!==--L);return b<=g.lookahead?b:g.lookahead},o=g=>{const i=g.w_size;let a,n,L,d,b;do{if(d=g.window_size-g.lookahead-g.strstart,g.strstart>=i+(i-K)){g.window.set(g.window.subarray(i,i+i),0),g.match_start-=i,g.strstart-=i,g.block_start-=i,n=g.hash_size,a=n;do{L=g.head[--a],g.head[a]=L>=i?L-i:0}while(--n);n=i,a=n;do{L=g.prev[--a],g.prev[a]=L>=i?L-i:0}while(--n);d+=i}if(0===g.strm.avail_in)break;if(n=r(g.strm,g.window,g.strstart+g.lookahead,d),g.lookahead+=n,g.lookahead+g.insert>=3)for(b=g.strstart-g.insert,g.ins_h=g.window[b],g.ins_h=A(g,g.ins_h,g.window[b+1]);g.insert&&(g.ins_h=A(g,g.ins_h,g.window[b+3-1]),g.prev[b&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=b,b++,g.insert--,!(g.lookahead+g.insert<3)););}while(g.lookahead<K&&0!==g.strm.avail_in)},u=(g,i)=>{let a,n;for(;;){if(g.lookahead<K){if(o(g),g.lookahead<K&&i===I)return 1;if(0===g.lookahead)break}if(a=0,g.lookahead>=3&&(g.ins_h=A(g,g.ins_h,g.window[g.strstart+3-1]),a=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),0!==a&&g.strstart-a<=g.w_size-K&&(g.match_length=Q(g,a)),g.match_length>=3)if(n=b(g,g.strstart-g.match_start,g.match_length-3),g.lookahead-=g.match_length,g.match_length<=g.max_lazy_match&&g.lookahead>=3){g.match_length--;do{g.strstart++,g.ins_h=A(g,g.ins_h,g.window[g.strstart+3-1]),a=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart}while(0!==--g.match_length);g.strstart++}else g.strstart+=g.match_length,g.match_length=0,g.ins_h=g.window[g.strstart],g.ins_h=A(g,g.ins_h,g.window[g.strstart+1]);else n=b(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++;if(n&&(z(g,!1),0===g.strm.avail_out))return 1}return g.insert=g.strstart<2?g.strstart:2,i===B?(z(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(z(g,!1),0===g.strm.avail_out)?1:2},H=(g,i)=>{let a,n,L;for(;;){if(g.lookahead<K){if(o(g),g.lookahead<K&&i===I)return 1;if(0===g.lookahead)break}if(a=0,g.lookahead>=3&&(g.ins_h=A(g,g.ins_h,g.window[g.strstart+3-1]),a=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),g.prev_length=g.match_length,g.prev_match=g.match_start,g.match_length=2,0!==a&&g.prev_length<g.max_lazy_match&&g.strstart-a<=g.w_size-K&&(g.match_length=Q(g,a),g.match_length<=5&&(g.strategy===v||3===g.match_length&&g.strstart-g.match_start>4096)&&(g.match_length=2)),g.prev_length>=3&&g.match_length<=g.prev_length){L=g.strstart+g.lookahead-3,n=b(g,g.strstart-1-g.prev_match,g.prev_length-3),g.lookahead-=g.prev_length-1,g.prev_length-=2;do{++g.strstart<=L&&(g.ins_h=A(g,g.ins_h,g.window[g.strstart+3-1]),a=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart)}while(0!==--g.prev_length);if(g.match_available=0,g.match_length=2,g.strstart++,n&&(z(g,!1),0===g.strm.avail_out))return 1}else if(g.match_available){if(n=b(g,0,g.window[g.strstart-1]),n&&z(g,!1),g.strstart++,g.lookahead--,0===g.strm.avail_out)return 1}else g.match_available=1,g.strstart++,g.lookahead--}return g.match_available&&(n=b(g,0,g.window[g.strstart-1]),g.match_available=0),g.insert=g.strstart<2?g.strstart:2,i===B?(z(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(z(g,!1),0===g.strm.avail_out)?1:2};function M(g,i,a,n,L){this.good_length=g,this.max_lazy=i,this.nice_length=a,this.max_chain=n,this.func=L}const q=[new M(0,0,0,0,((g,i)=>{let a=65535;for(a>g.pending_buf_size-5&&(a=g.pending_buf_size-5);;){if(g.lookahead<=1){if(o(g),0===g.lookahead&&i===I)return 1;if(0===g.lookahead)break}g.strstart+=g.lookahead,g.lookahead=0;const n=g.block_start+a;if((0===g.strstart||g.strstart>=n)&&(g.lookahead=g.strstart-n,g.strstart=n,z(g,!1),0===g.strm.avail_out))return 1;if(g.strstart-g.block_start>=g.w_size-K&&(z(g,!1),0===g.strm.avail_out))return 1}return g.insert=0,i===B?(z(g,!0),0===g.strm.avail_out?3:4):(g.strstart>g.block_start&&(z(g,!1),g.strm.avail_out),1)})),new M(4,4,8,4,u),new M(4,5,16,8,u),new M(4,6,32,32,u),new M(4,4,16,16,H),new M(8,16,32,32,H),new M(8,16,128,128,H),new M(8,32,128,256,H),new M(32,128,258,1024,H),new M(32,258,258,4096,H)];function W(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),t(this.dyn_ltree),t(this.dyn_dtree),t(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),t(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),t(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const G=g=>{if(!g||!g.state)return h(g,R);g.total_in=g.total_out=0,g.data_type=U;const i=g.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap?42:l,g.adler=2===i.wrap?0:1,i.last_flush=I,n(i),D},J=g=>{const i=G(g);var a;return i===D&&((a=g.state).window_size=2*a.w_size,t(a.head),a.max_lazy_match=q[a.level].max_lazy,a.good_match=q[a.level].good_length,a.nice_match=q[a.level].nice_length,a.max_chain_length=q[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0),i},gg=(g,i,a,n,L,d)=>{if(!g)return R;let b=1;if(i===X&&(i=6),n<0?(b=0,n=-n):n>15&&(b=2,n-=16),L<1||L>9||a!==S||n<8||n>15||i<0||i>9||d<0||d>f)return h(g,R);8===n&&(n=9);const k=new W;return g.state=k,k.strm=g,k.wrap=b,k.gzhead=null,k.w_bits=n,k.w_size=1<<k.w_bits,k.w_mask=k.w_size-1,k.hash_bits=L+7,k.hash_size=1<<k.hash_bits,k.hash_mask=k.hash_size-1,k.hash_shift=~~((k.hash_bits+3-1)/3),k.window=new Uint8Array(2*k.w_size),k.head=new Uint16Array(k.hash_size),k.prev=new Uint16Array(k.w_size),k.lit_bufsize=1<<L+6,k.pending_buf_size=4*k.lit_bufsize,k.pending_buf=new Uint8Array(k.pending_buf_size),k.d_buf=1*k.lit_bufsize,k.l_buf=3*k.lit_bufsize,k.level=i,k.strategy=d,k.method=a,J(g)};g.exports.deflateInit=(g,i)=>gg(g,i,S,15,8,C),g.exports.deflateInit2=gg,g.exports.deflateReset=J,g.exports.deflateResetKeep=G,g.exports.deflateSetHeader=(g,i)=>g&&g.state?2!==g.state.wrap?R:(g.state.gzhead=i,D):R,g.exports.deflate=(g,i)=>{let a,n;if(!g||!g.state||i>c||i<0)return g?h(g,R):R;const d=g.state;if(!g.output||!g.input&&0!==g.avail_in||d.status===Z&&i!==B)return h(g,0===g.avail_out?E:R);d.strm=g;const e=d.last_flush;if(d.last_flush=i,42===d.status)if(2===d.wrap)g.adler=0,s(d,31),s(d,139),s(d,8),d.gzhead?(s(d,(d.gzhead.text?1:0)+(d.gzhead.hcrc?2:0)+(d.gzhead.extra?4:0)+(d.gzhead.name?8:0)+(d.gzhead.comment?16:0)),s(d,255&d.gzhead.time),s(d,d.gzhead.time>>8&255),s(d,d.gzhead.time>>16&255),s(d,d.gzhead.time>>24&255),s(d,9===d.level?2:d.strategy>=P||d.level<2?4:0),s(d,255&d.gzhead.os),d.gzhead.extra&&d.gzhead.extra.length&&(s(d,255&d.gzhead.extra.length),s(d,d.gzhead.extra.length>>8&255)),d.gzhead.hcrc&&(g.adler=N(g.adler,d.pending_buf,d.pending,0)),d.gzindex=0,d.status=69):(s(d,0),s(d,0),s(d,0),s(d,0),s(d,0),s(d,9===d.level?2:d.strategy>=P||d.level<2?4:0),s(d,3),d.status=l);else{let i=S+(d.w_bits-8<<4)<<8,a=-1;a=d.strategy>=P||d.level<2?0:d.level<6?1:6===d.level?2:3,i|=a<<6,0!==d.strstart&&(i|=32),i+=31-i%31,d.status=l,mg(d,i),0!==d.strstart&&(mg(d,g.adler>>>16),mg(d,65535&g.adler)),g.adler=1}if(69===d.status)if(d.gzhead.extra){for(a=d.pending;d.gzindex<(65535&d.gzhead.extra.length)&&(d.pending!==d.pending_buf_size||(d.gzhead.hcrc&&d.pending>a&&(g.adler=N(g.adler,d.pending_buf,d.pending-a,a)),O(g),a=d.pending,d.pending!==d.pending_buf_size));)s(d,255&d.gzhead.extra[d.gzindex]),d.gzindex++;d.gzhead.hcrc&&d.pending>a&&(g.adler=N(g.adler,d.pending_buf,d.pending-a,a)),d.gzindex===d.gzhead.extra.length&&(d.gzindex=0,d.status=73)}else d.status=73;if(73===d.status)if(d.gzhead.name){a=d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>a&&(g.adler=N(g.adler,d.pending_buf,d.pending-a,a)),O(g),a=d.pending,d.pending===d.pending_buf_size)){n=1;break}n=d.gzindex<d.gzhead.name.length?255&d.gzhead.name.charCodeAt(d.gzindex++):0,s(d,n)}while(0!==n);d.gzhead.hcrc&&d.pending>a&&(g.adler=N(g.adler,d.pending_buf,d.pending-a,a)),0===n&&(d.gzindex=0,d.status=91)}else d.status=91;if(91===d.status)if(d.gzhead.comment){a=d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>a&&(g.adler=N(g.adler,d.pending_buf,d.pending-a,a)),O(g),a=d.pending,d.pending===d.pending_buf_size)){n=1;break}n=d.gzindex<d.gzhead.comment.length?255&d.gzhead.comment.charCodeAt(d.gzindex++):0,s(d,n)}while(0!==n);d.gzhead.hcrc&&d.pending>a&&(g.adler=N(g.adler,d.pending_buf,d.pending-a,a)),0===n&&(d.status=T)}else d.status=T;if(d.status===T&&(d.gzhead.hcrc?(d.pending+2>d.pending_buf_size&&O(g),d.pending+2<=d.pending_buf_size&&(s(d,255&g.adler),s(d,g.adler>>8&255),g.adler=0,d.status=l)):d.status=l),0!==d.pending){if(O(g),0===g.avail_out)return d.last_flush=-1,D}else if(0===g.avail_in&&w(i)<=w(e)&&i!==B)return h(g,E);if(d.status===Z&&0!==g.avail_in)return h(g,E);if(0!==g.avail_in||0!==d.lookahead||i!==I&&d.status!==Z){let a=d.strategy===P?((g,i)=>{let a;for(;;){if(0===g.lookahead&&(o(g),0===g.lookahead)){if(i===I)return 1;break}if(g.match_length=0,a=b(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++,a&&(z(g,!1),0===g.strm.avail_out))return 1}return g.insert=0,i===B?(z(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(z(g,!1),0===g.strm.avail_out)?1:2})(d,i):d.strategy===Y?((g,i)=>{let a,n,L,d;const k=g.window;for(;;){if(g.lookahead<=V){if(o(g),g.lookahead<=V&&i===I)return 1;if(0===g.lookahead)break}if(g.match_length=0,g.lookahead>=3&&g.strstart>0&&(L=g.strstart-1,n=k[L],n===k[++L]&&n===k[++L]&&n===k[++L])){d=g.strstart+V;do{}while(n===k[++L]&&n===k[++L]&&n===k[++L]&&n===k[++L]&&n===k[++L]&&n===k[++L]&&n===k[++L]&&n===k[++L]&&L<d);g.match_length=V-(d-L),g.match_length>g.lookahead&&(g.match_length=g.lookahead)}if(g.match_length>=3?(a=b(g,1,g.match_length-3),g.lookahead-=g.match_length,g.strstart+=g.match_length,g.match_length=0):(a=b(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++),a&&(z(g,!1),0===g.strm.avail_out))return 1}return g.insert=0,i===B?(z(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(z(g,!1),0===g.strm.avail_out)?1:2})(d,i):q[d.level].func(d,i);if(3!==a&&4!==a||(d.status=Z),1===a||3===a)return 0===g.avail_out&&(d.last_flush=-1),D;if(2===a&&(i===j?k(d):i!==c&&(L(d,0,0,!1),i===y&&(t(d.head),0===d.lookahead&&(d.strstart=0,d.block_start=0,d.insert=0))),O(g),0===g.avail_out))return d.last_flush=-1,D}return i!==B?D:d.wrap<=0?p:(2===d.wrap?(s(d,255&g.adler),s(d,g.adler>>8&255),s(d,g.adler>>16&255),s(d,g.adler>>24&255),s(d,255&g.total_in),s(d,g.total_in>>8&255),s(d,g.total_in>>16&255),s(d,g.total_in>>24&255)):(mg(d,g.adler>>>16),mg(d,65535&g.adler)),O(g),d.wrap>0&&(d.wrap=-d.wrap),0!==d.pending?D:p)},g.exports.deflateEnd=g=>{if(!g||!g.state)return R;const i=g.state.status;return 42!==i&&69!==i&&73!==i&&91!==i&&i!==T&&i!==l&&i!==Z?h(g,R):(g.state=null,i===l?h(g,x):D)},g.exports.deflateSetDictionary=(g,i)=>{let a=i.length;if(!g||!g.state)return R;const n=g.state,L=n.wrap;if(2===L||1===L&&42!==n.status||n.lookahead)return R;if(1===L&&(g.adler=e(g.adler,i,a,0)),n.wrap=0,a>=n.w_size){0===L&&(t(n.head),n.strstart=0,n.block_start=0,n.insert=0);let g=new Uint8Array(n.w_size);g.set(i.subarray(a-n.w_size,a),0),i=g,a=n.w_size}const d=g.avail_in,b=g.next_in,k=g.input;for(g.avail_in=a,g.next_in=0,g.input=i,o(n);n.lookahead>=3;){let g=n.strstart,i=n.lookahead-2;do{n.ins_h=A(n,n.ins_h,n.window[g+3-1]),n.prev[g&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=g,g++}while(--i);n.strstart=g,n.lookahead=2,o(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,g.next_in=b,g.input=k,g.avail_in=d,n.wrap=L,D},g.exports.deflateInfo="pako deflate (from Nodeca project)"},13679:g=>{"use strict";g.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13671:g=>{"use strict";g.exports=function(g,i){let a,n,L,d,b,k,e,N,F,I,j,y,B,c,D,p,R,x,E,X,v,P,Y,f;const C=g.state;a=g.next_in,Y=g.input,n=a+(g.avail_in-5),L=g.next_out,f=g.output,d=L-(i-g.avail_out),b=L+(g.avail_out-257),k=C.dmax,e=C.wsize,N=C.whave,F=C.wnext,I=C.window,j=C.hold,y=C.bits,B=C.lencode,c=C.distcode,D=(1<<C.lenbits)-1,p=(1<<C.distbits)-1;g:do{y<15&&(j+=Y[a++]<<y,y+=8,j+=Y[a++]<<y,y+=8),R=B[j&D];i:for(;;){if(x=R>>>24,j>>>=x,y-=x,x=R>>>16&255,0===x)f[L++]=65535&R;else{if(!(16&x)){if(0===(64&x)){R=B[(65535&R)+(j&(1<<x)-1)];continue i}if(32&x){C.mode=12;break g}g.Ni="invalid literal/length code",C.mode=30;break g}E=65535&R,x&=15,x&&(y<x&&(j+=Y[a++]<<y,y+=8),E+=j&(1<<x)-1,j>>>=x,y-=x),y<15&&(j+=Y[a++]<<y,y+=8,j+=Y[a++]<<y,y+=8),R=c[j&p];a:for(;;){if(x=R>>>24,j>>>=x,y-=x,x=R>>>16&255,!(16&x)){if(0===(64&x)){R=c[(65535&R)+(j&(1<<x)-1)];continue a}g.Ni="invalid distance code",C.mode=30;break g}if(X=65535&R,x&=15,y<x&&(j+=Y[a++]<<y,y+=8,y<x&&(j+=Y[a++]<<y,y+=8)),X+=j&(1<<x)-1,X>k){g.Ni="invalid distance too far back",C.mode=30;break g}if(j>>>=x,y-=x,x=L-d,X>x){if(x=X-x,x>N&&C.sane){g.Ni="invalid distance too far back",C.mode=30;break g}if(v=0,P=I,0===F){if(v+=e-x,x<E){E-=x;do{f[L++]=I[v++]}while(--x);v=L-X,P=f}}else if(F<x){if(v+=e+F-x,x-=F,x<E){E-=x;do{f[L++]=I[v++]}while(--x);if(v=0,F<E){x=F,E-=x;do{f[L++]=I[v++]}while(--x);v=L-X,P=f}}}else if(v+=F-x,x<E){E-=x;do{f[L++]=I[v++]}while(--x);v=L-X,P=f}for(;E>2;)f[L++]=P[v++],f[L++]=P[v++],f[L++]=P[v++],E-=3;E&&(f[L++]=P[v++],E>1&&(f[L++]=P[v++]))}else{v=L-X;do{f[L++]=f[v++],f[L++]=f[v++],f[L++]=f[v++],E-=3}while(E>2);E&&(f[L++]=f[v++],E>1&&(f[L++]=f[v++]))}break}}break}}while(a<n&&L<b);E=y>>3,a-=E,y-=E<<3,j&=(1<<y)-1,g.next_in=a,g.next_out=L,g.avail_in=a<n?n-a+5:5-(a-n),g.avail_out=L<b?b-L+257:257-(L-b),C.hold=j,C.bits=y}},13667:(g,i,a)=>{"use strict";const n=a(13624),L=a(13631),d=a(13671),b=a(13674),{Z_FINISH:k,Z_BLOCK:e,Z_TREES:N,Z_OK:F,Z_STREAM_END:I,Z_NEED_DICT:j,Z_STREAM_ERROR:y,Z_DATA_ERROR:B,Z_MEM_ERROR:c,Z_BUF_ERROR:D,Z_DEFLATED:p}=a(13645),R=12,x=30,E=g=>(g>>>24&255)+(g>>>8&65280)+((65280&g)<<8)+((255&g)<<24);function X(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const v=g=>{if(!g||!g.state)return y;const i=g.state;return g.total_in=g.total_out=i.total=0,g.Ni="",i.wrap&&(g.adler=1&i.wrap),i.mode=1,i.last=0,i.havedict=0,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,F},P=g=>{if(!g||!g.state)return y;const i=g.state;return i.wsize=0,i.whave=0,i.wnext=0,v(g)},Y=(g,i)=>{let a;if(!g||!g.state)return y;const n=g.state;return i<0?(a=0,i=-i):(a=1+(i>>4),i<48&&(i&=15)),i&&(i<8||i>15)?y:(null!==n.window&&n.wbits!==i&&(n.window=null),n.wrap=a,n.wbits=i,P(g))},f=(g,i)=>{if(!g)return y;const a=new X;g.state=a,a.window=null;const n=Y(g,i);return n!==F&&(g.state=null),n};let C,U,S=!0;const V=g=>{if(S){C=new Int32Array(512),U=new Int32Array(32);let i=0;for(;i<144;)g.lens[i++]=8;for(;i<256;)g.lens[i++]=9;for(;i<280;)g.lens[i++]=7;for(;i<288;)g.lens[i++]=8;for(b(1,g.lens,0,288,C,0,g.work,{bits:9}),i=0;i<32;)g.lens[i++]=5;b(2,g.lens,0,32,U,0,g.work,{bits:5}),S=!1}g.lencode=C,g.lenbits=9,g.distcode=U,g.distbits=5},K=(g,i,a,n)=>{let L;const d=g.state;return null===d.window&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),n>=d.wsize?(d.window.set(i.subarray(a-d.wsize,a),0),d.wnext=0,d.whave=d.wsize):(L=d.wsize-d.wnext,L>n&&(L=n),d.window.set(i.subarray(a-n,a-n+L),d.wnext),(n-=L)?(d.window.set(i.subarray(a-n,a),0),d.wnext=n,d.whave=d.wsize):(d.wnext+=L,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=L))),0};g.exports.inflateReset=P,g.exports.inflateReset2=Y,g.exports.inflateResetKeep=v,g.exports.inflateInit=g=>f(g,15),g.exports.inflateInit2=f,g.exports.inflate=(g,i)=>{let a,X,v,P,Y,f,C,U,S,T,l,Z,h,w,t,A,O,z,s,mg,r,Q,o=0;const u=new Uint8Array(4);let H,M;const q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!g||!g.state||!g.output||!g.input&&0!==g.avail_in)return y;a=g.state,a.mode===R&&(a.mode=13),Y=g.next_out,v=g.output,C=g.avail_out,P=g.next_in,X=g.input,f=g.avail_in,U=a.hold,S=a.bits,T=f,l=C,Q=F;g:for(;;)switch(a.mode){case 1:if(0===a.wrap){a.mode=13;break}for(;S<16;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}if(2&a.wrap&&35615===U){a.check=0,u[0]=255&U,u[1]=U>>>8&255,a.check=L(a.check,u,2,0),U=0,S=0,a.mode=2;break}if(a.flags=0,a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&U)<<8)+(U>>8))%31){g.Ni="incorrect header check",a.mode=x;break}if((15&U)!==p){g.Ni="unknown compression method",a.mode=x;break}if(U>>>=4,S-=4,r=8+(15&U),0===a.wbits)a.wbits=r;else if(r>a.wbits){g.Ni="invalid window size",a.mode=x;break}a.dmax=1<<a.wbits,g.adler=a.check=1,a.mode=512&U?10:R,U=0,S=0;break;case 2:for(;S<16;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}if(a.flags=U,(255&a.flags)!==p){g.Ni="unknown compression method",a.mode=x;break}if(57344&a.flags){g.Ni="unknown header flags set",a.mode=x;break}a.head&&(a.head.text=U>>8&1),512&a.flags&&(u[0]=255&U,u[1]=U>>>8&255,a.check=L(a.check,u,2,0)),U=0,S=0,a.mode=3;case 3:for(;S<32;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}a.head&&(a.head.time=U),512&a.flags&&(u[0]=255&U,u[1]=U>>>8&255,u[2]=U>>>16&255,u[3]=U>>>24&255,a.check=L(a.check,u,4,0)),U=0,S=0,a.mode=4;case 4:for(;S<16;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}a.head&&(a.head.xflags=255&U,a.head.os=U>>8),512&a.flags&&(u[0]=255&U,u[1]=U>>>8&255,a.check=L(a.check,u,2,0)),U=0,S=0,a.mode=5;case 5:if(1024&a.flags){for(;S<16;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}a.length=U,a.head&&(a.head.extra_len=U),512&a.flags&&(u[0]=255&U,u[1]=U>>>8&255,a.check=L(a.check,u,2,0)),U=0,S=0}else a.head&&(a.head.extra=null);a.mode=6;case 6:if(1024&a.flags&&(Z=a.length,Z>f&&(Z=f),Z&&(a.head&&(r=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(X.subarray(P,P+Z),r)),512&a.flags&&(a.check=L(a.check,X,Z,P)),f-=Z,P+=Z,a.length-=Z),a.length))break g;a.length=0,a.mode=7;case 7:if(2048&a.flags){if(0===f)break g;Z=0;do{r=X[P+Z++],a.head&&r&&a.length<65536&&(a.head.name+=String.fromCharCode(r))}while(r&&Z<f);if(512&a.flags&&(a.check=L(a.check,X,Z,P)),f-=Z,P+=Z,r)break g}else a.head&&(a.head.name=null);a.length=0,a.mode=8;case 8:if(4096&a.flags){if(0===f)break g;Z=0;do{r=X[P+Z++],a.head&&r&&a.length<65536&&(a.head.comment+=String.fromCharCode(r))}while(r&&Z<f);if(512&a.flags&&(a.check=L(a.check,X,Z,P)),f-=Z,P+=Z,r)break g}else a.head&&(a.head.comment=null);a.mode=9;case 9:if(512&a.flags){for(;S<16;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}if(U!==(65535&a.check)){g.Ni="header crc mismatch",a.mode=x;break}U=0,S=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),g.adler=a.check=0,a.mode=R;break;case 10:for(;S<32;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}g.adler=a.check=E(U),U=0,S=0,a.mode=11;case 11:if(0===a.havedict)return g.next_out=Y,g.avail_out=C,g.next_in=P,g.avail_in=f,a.hold=U,a.bits=S,j;g.adler=a.check=1,a.mode=R;case R:if(i===e||i===N)break g;case 13:if(a.last){U>>>=7&S,S-=7&S,a.mode=27;break}for(;S<3;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}switch(a.last=1&U,U>>>=1,S-=1,3&U){case 0:a.mode=14;break;case 1:if(V(a),a.mode=20,i===N){U>>>=2,S-=2;break g}break;case 2:a.mode=17;break;case 3:g.Ni="invalid block type",a.mode=x}U>>>=2,S-=2;break;case 14:for(U>>>=7&S,S-=7&S;S<32;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}if((65535&U)!==(U>>>16^65535)){g.Ni="invalid stored block lengths",a.mode=x;break}if(a.length=65535&U,U=0,S=0,a.mode=15,i===N)break g;case 15:a.mode=16;case 16:if(Z=a.length,Z){if(Z>f&&(Z=f),Z>C&&(Z=C),0===Z)break g;v.set(X.subarray(P,P+Z),Y),f-=Z,P+=Z,C-=Z,Y+=Z,a.length-=Z;break}a.mode=R;break;case 17:for(;S<14;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}if(a.nlen=257+(31&U),U>>>=5,S-=5,a.ndist=1+(31&U),U>>>=5,S-=5,a.ncode=4+(15&U),U>>>=4,S-=4,a.nlen>286||a.ndist>30){g.Ni="too many length or distance symbols",a.mode=x;break}a.have=0,a.mode=18;case 18:for(;a.have<a.ncode;){for(;S<3;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}a.lens[q[a.have++]]=7&U,U>>>=3,S-=3}for(;a.have<19;)a.lens[q[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,H={bits:a.lenbits},Q=b(0,a.lens,0,19,a.lencode,0,a.work,H),a.lenbits=H.bits,Q){g.Ni="invalid code lengths set",a.mode=x;break}a.have=0,a.mode=19;case 19:for(;a.have<a.nlen+a.ndist;){for(;o=a.lencode[U&(1<<a.lenbits)-1],t=o>>>24,A=o>>>16&255,O=65535&o,!(t<=S);){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}if(O<16)U>>>=t,S-=t,a.lens[a.have++]=O;else{if(16===O){for(M=t+2;S<M;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}if(U>>>=t,S-=t,0===a.have){g.Ni="invalid bit length repeat",a.mode=x;break}r=a.lens[a.have-1],Z=3+(3&U),U>>>=2,S-=2}else if(17===O){for(M=t+3;S<M;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}U>>>=t,S-=t,r=0,Z=3+(7&U),U>>>=3,S-=3}else{for(M=t+7;S<M;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}U>>>=t,S-=t,r=0,Z=11+(127&U),U>>>=7,S-=7}if(a.have+Z>a.nlen+a.ndist){g.Ni="invalid bit length repeat",a.mode=x;break}for(;Z--;)a.lens[a.have++]=r}}if(a.mode===x)break;if(0===a.lens[256]){g.Ni="invalid code -- missing end-of-block",a.mode=x;break}if(a.lenbits=9,H={bits:a.lenbits},Q=b(1,a.lens,0,a.nlen,a.lencode,0,a.work,H),a.lenbits=H.bits,Q){g.Ni="invalid literal/lengths set",a.mode=x;break}if(a.distbits=6,a.distcode=a.distdyn,H={bits:a.distbits},Q=b(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,H),a.distbits=H.bits,Q){g.Ni="invalid distances set",a.mode=x;break}if(a.mode=20,i===N)break g;case 20:a.mode=21;case 21:if(f>=6&&C>=258){g.next_out=Y,g.avail_out=C,g.next_in=P,g.avail_in=f,a.hold=U,a.bits=S,d(g,l),Y=g.next_out,v=g.output,C=g.avail_out,P=g.next_in,X=g.input,f=g.avail_in,U=a.hold,S=a.bits,a.mode===R&&(a.back=-1);break}for(a.back=0;o=a.lencode[U&(1<<a.lenbits)-1],t=o>>>24,A=o>>>16&255,O=65535&o,!(t<=S);){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}if(A&&0===(240&A)){for(z=t,s=A,mg=O;o=a.lencode[mg+((U&(1<<z+s)-1)>>z)],t=o>>>24,A=o>>>16&255,O=65535&o,!(z+t<=S);){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}U>>>=z,S-=z,a.back+=z}if(U>>>=t,S-=t,a.back+=t,a.length=O,0===A){a.mode=26;break}if(32&A){a.back=-1,a.mode=R;break}if(64&A){g.Ni="invalid literal/length code",a.mode=x;break}a.extra=15&A,a.mode=22;case 22:if(a.extra){for(M=a.extra;S<M;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}a.length+=U&(1<<a.extra)-1,U>>>=a.extra,S-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=23;case 23:for(;o=a.distcode[U&(1<<a.distbits)-1],t=o>>>24,A=o>>>16&255,O=65535&o,!(t<=S);){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}if(0===(240&A)){for(z=t,s=A,mg=O;o=a.distcode[mg+((U&(1<<z+s)-1)>>z)],t=o>>>24,A=o>>>16&255,O=65535&o,!(z+t<=S);){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}U>>>=z,S-=z,a.back+=z}if(U>>>=t,S-=t,a.back+=t,64&A){g.Ni="invalid distance code",a.mode=x;break}a.offset=O,a.extra=15&A,a.mode=24;case 24:if(a.extra){for(M=a.extra;S<M;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}a.offset+=U&(1<<a.extra)-1,U>>>=a.extra,S-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){g.Ni="invalid distance too far back",a.mode=x;break}a.mode=25;case 25:if(0===C)break g;if(Z=l-C,a.offset>Z){if(Z=a.offset-Z,Z>a.whave&&a.sane){g.Ni="invalid distance too far back",a.mode=x;break}Z>a.wnext?(Z-=a.wnext,h=a.wsize-Z):h=a.wnext-Z,Z>a.length&&(Z=a.length),w=a.window}else w=v,h=Y-a.offset,Z=a.length;Z>C&&(Z=C),C-=Z,a.length-=Z;do{v[Y++]=w[h++]}while(--Z);0===a.length&&(a.mode=21);break;case 26:if(0===C)break g;v[Y++]=a.length,C--,a.mode=21;break;case 27:if(a.wrap){for(;S<32;){if(0===f)break g;f--,U|=X[P++]<<S,S+=8}if(l-=C,g.total_out+=l,a.total+=l,l&&(g.adler=a.check=a.flags?L(a.check,v,l,Y-l):n(a.check,v,l,Y-l)),l=C,(a.flags?U:E(U))!==a.check){g.Ni="incorrect data check",a.mode=x;break}U=0,S=0}a.mode=28;case 28:if(a.wrap&&a.flags){for(;S<32;){if(0===f)break g;f--,U+=X[P++]<<S,S+=8}if(U!==(4294967295&a.total)){g.Ni="incorrect length check",a.mode=x;break}U=0,S=0}a.mode=29;case 29:Q=I;break g;case x:Q=B;break g;case 31:return c;default:return y}return g.next_out=Y,g.avail_out=C,g.next_in=P,g.avail_in=f,a.hold=U,a.bits=S,(a.wsize||l!==g.avail_out&&a.mode<x&&(a.mode<27||i!==k))&&K(g,g.output,g.next_out,l-g.avail_out)?(a.mode=31,c):(T-=g.avail_in,l-=g.avail_out,g.total_in+=T,g.total_out+=l,a.total+=l,a.wrap&&l&&(g.adler=a.check=a.flags?L(a.check,v,l,g.next_out-l):n(a.check,v,l,g.next_out-l)),g.data_type=a.bits+(a.last?64:0)+(a.mode===R?128:0)+(20===a.mode||15===a.mode?256:0),(0===T&&0===l||i===k)&&Q===F&&(Q=D),Q)},g.exports.inflateEnd=g=>{if(!g||!g.state)return y;let i=g.state;return i.window&&(i.window=null),g.state=null,F},g.exports.inflateGetHeader=(g,i)=>{if(!g||!g.state)return y;const a=g.state;return 0===(2&a.wrap)?y:(a.head=i,i.done=!1,F)},g.exports.inflateSetDictionary=(g,i)=>{const a=i.length;let L,d,b;return g&&g.state?(L=g.state,0!==L.wrap&&11!==L.mode?y:11===L.mode&&(d=1,d=n(d,i,a,0),d!==L.check)?B:(b=K(g,i,a,a),b?(L.mode=31,c):(L.havedict=1,F))):y},g.exports.inflateInfo="pako inflate (from Nodeca project)"},13674:g=>{"use strict";const i=15,a=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),n=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),L=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),d=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);g.exports=(g,b,k,e,N,F,I,j)=>{const y=j.bits;let B,c,D,p,R,x,E=0,X=0,v=0,P=0,Y=0,f=0,C=0,U=0,S=0,V=0,K=null,T=0;const l=new Uint16Array(16),Z=new Uint16Array(16);let h,w,t,A=null,O=0;for(E=0;E<=i;E++)l[E]=0;for(X=0;X<e;X++)l[b[k+X]]++;for(Y=y,P=i;P>=1&&0===l[P];P--);if(Y>P&&(Y=P),0===P)return N[F++]=20971520,N[F++]=20971520,j.bits=1,0;for(v=1;v<P&&0===l[v];v++);for(Y<v&&(Y=v),U=1,E=1;E<=i;E++)if(U<<=1,U-=l[E],U<0)return-1;if(U>0&&(0===g||1!==P))return-1;for(Z[1]=0,E=1;E<i;E++)Z[E+1]=Z[E]+l[E];for(X=0;X<e;X++)0!==b[k+X]&&(I[Z[b[k+X]]++]=X);if(0===g?(K=A=I,x=19):1===g?(K=a,T-=257,A=n,O-=257,x=256):(K=L,A=d,x=-1),V=0,X=0,E=v,R=F,f=Y,C=0,D=-1,S=1<<Y,p=S-1,1===g&&S>852||2===g&&S>592)return 1;for(;;){h=E-C,I[X]<x?(w=0,t=I[X]):I[X]>x?(w=A[O+I[X]],t=K[T+I[X]]):(w=96,t=0),B=1<<E-C,c=1<<f,v=c;do{c-=B,N[R+(V>>C)+c]=h<<24|w<<16|t}while(0!==c);for(B=1<<E-1;V&B;)B>>=1;if(0!==B?(V&=B-1,V+=B):V=0,X++,0===--l[E]){if(E===P)break;E=b[k+I[X]]}if(E>Y&&(V&p)!==D){for(0===C&&(C=Y),R+=v,f=E-C,U=1<<f;f+C<P&&(U-=l[f+C],!(U<=0));)f++,U<<=1;if(S+=1<<f,1===g&&S>852||2===g&&S>592)return 1;D=V&p,N[D]=Y<<24|f<<16|R-F}}return 0!==V&&(N[R+V]=E-C<<24|64<<16),j.bits=Y,0}},13639:g=>{"use strict";g.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13622:g=>{"use strict";function i(g){let i=g.length;for(;--i>=0;)g[i]=0}const a=256,n=286,L=30,d=15,b=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),k=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),N=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),F=new Array(576);i(F);const I=new Array(60);i(I);const j=new Array(512);i(j);const y=new Array(256);i(y);const B=new Array(29);i(B);const c=new Array(L);function D(g,i,a,n,L){this.static_tree=g,this.extra_bits=i,this.extra_base=a,this.elems=n,this.max_length=L,this.has_stree=g&&g.length}let p,R,x;function E(g,i){this.dyn_tree=g,this.max_code=0,this.stat_desc=i}i(c);const X=g=>g<256?j[g]:j[256+(g>>>7)],v=(g,i)=>{g.pending_buf[g.pending++]=255&i,g.pending_buf[g.pending++]=i>>>8&255},P=(g,i,a)=>{g.bi_valid>16-a?(g.bi_buf|=i<<g.bi_valid&65535,v(g,g.bi_buf),g.bi_buf=i>>16-g.bi_valid,g.bi_valid+=a-16):(g.bi_buf|=i<<g.bi_valid&65535,g.bi_valid+=a)},Y=(g,i,a)=>{P(g,a[2*i],a[2*i+1])},f=(g,i)=>{let a=0;do{a|=1&g,g>>>=1,a<<=1}while(--i>0);return a>>>1},C=(g,i,a)=>{const n=new Array(16);let L,b,k=0;for(L=1;L<=d;L++)n[L]=k=k+a[L-1]<<1;for(b=0;b<=i;b++){let i=g[2*b+1];0!==i&&(g[2*b]=f(n[i]++,i))}},U=g=>{let i;for(i=0;i<n;i++)g.dyn_ltree[2*i]=0;for(i=0;i<L;i++)g.dyn_dtree[2*i]=0;for(i=0;i<19;i++)g.bl_tree[2*i]=0;g.dyn_ltree[512]=1,g.opt_len=g.static_len=0,g.last_lit=g.matches=0},S=g=>{g.bi_valid>8?v(g,g.bi_buf):g.bi_valid>0&&(g.pending_buf[g.pending++]=g.bi_buf),g.bi_buf=0,g.bi_valid=0},V=(g,i,a,n)=>{const L=2*i,d=2*a;return g[L]<g[d]||g[L]===g[d]&&n[i]<=n[a]},K=(g,i,a)=>{const n=g.heap[a];let L=a<<1;for(;L<=g.heap_len&&(L<g.heap_len&&V(i,g.heap[L+1],g.heap[L],g.depth)&&L++,!V(i,n,g.heap[L],g.depth));)g.heap[a]=g.heap[L],a=L,L<<=1;g.heap[a]=n},T=(g,i,n)=>{let L,d,e,N,F=0;if(0!==g.last_lit)do{L=g.pending_buf[g.d_buf+2*F]<<8|g.pending_buf[g.d_buf+2*F+1],d=g.pending_buf[g.l_buf+F],F++,0===L?Y(g,d,i):(e=y[d],Y(g,e+a+1,i),N=b[e],0!==N&&(d-=B[e],P(g,d,N)),L--,e=X(L),Y(g,e,n),N=k[e],0!==N&&(L-=c[e],P(g,L,N)))}while(F<g.last_lit);Y(g,256,i)},l=(g,i)=>{const a=i.dyn_tree,n=i.stat_desc.static_tree,L=i.stat_desc.has_stree,b=i.stat_desc.elems;let k,e,N,F=-1;for(g.heap_len=0,g.heap_max=573,k=0;k<b;k++)0!==a[2*k]?(g.heap[++g.heap_len]=F=k,g.depth[k]=0):a[2*k+1]=0;for(;g.heap_len<2;)N=g.heap[++g.heap_len]=F<2?++F:0,a[2*N]=1,g.depth[N]=0,g.opt_len--,L&&(g.static_len-=n[2*N+1]);for(i.max_code=F,k=g.heap_len>>1;k>=1;k--)K(g,a,k);N=b;do{k=g.heap[1],g.heap[1]=g.heap[g.heap_len--],K(g,a,1),e=g.heap[1],g.heap[--g.heap_max]=k,g.heap[--g.heap_max]=e,a[2*N]=a[2*k]+a[2*e],g.depth[N]=(g.depth[k]>=g.depth[e]?g.depth[k]:g.depth[e])+1,a[2*k+1]=a[2*e+1]=N,g.heap[1]=N++,K(g,a,1)}while(g.heap_len>=2);g.heap[--g.heap_max]=g.heap[1],((g,i)=>{const a=i.dyn_tree,n=i.max_code,L=i.stat_desc.static_tree,b=i.stat_desc.has_stree,k=i.stat_desc.extra_bits,e=i.stat_desc.extra_base,N=i.stat_desc.max_length;let F,I,j,y,B,c,D=0;for(y=0;y<=d;y++)g.bl_count[y]=0;for(a[2*g.heap[g.heap_max]+1]=0,F=g.heap_max+1;F<573;F++)I=g.heap[F],y=a[2*a[2*I+1]+1]+1,y>N&&(y=N,D++),a[2*I+1]=y,I>n||(g.bl_count[y]++,B=0,I>=e&&(B=k[I-e]),c=a[2*I],g.opt_len+=c*(y+B),b&&(g.static_len+=c*(L[2*I+1]+B)));if(0!==D){do{for(y=N-1;0===g.bl_count[y];)y--;g.bl_count[y]--,g.bl_count[y+1]+=2,g.bl_count[N]--,D-=2}while(D>0);for(y=N;0!==y;y--)for(I=g.bl_count[y];0!==I;)j=g.heap[--F],j>n||(a[2*j+1]!==y&&(g.opt_len+=(y-a[2*j+1])*a[2*j],a[2*j+1]=y),I--)}})(g,i),C(a,F,g.bl_count)},Z=(g,i,a)=>{let n,L,d=-1,b=i[1],k=0,e=7,N=4;for(0===b&&(e=138,N=3),i[2*(a+1)+1]=65535,n=0;n<=a;n++)L=b,b=i[2*(n+1)+1],++k<e&&L===b||(k<N?g.bl_tree[2*L]+=k:0!==L?(L!==d&&g.bl_tree[2*L]++,g.bl_tree[32]++):k<=10?g.bl_tree[34]++:g.bl_tree[36]++,k=0,d=L,0===b?(e=138,N=3):L===b?(e=6,N=3):(e=7,N=4))},h=(g,i,a)=>{let n,L,d=-1,b=i[1],k=0,e=7,N=4;for(0===b&&(e=138,N=3),n=0;n<=a;n++)if(L=b,b=i[2*(n+1)+1],!(++k<e&&L===b)){if(k<N)do{Y(g,L,g.bl_tree)}while(0!==--k);else 0!==L?(L!==d&&(Y(g,L,g.bl_tree),k--),Y(g,16,g.bl_tree),P(g,k-3,2)):k<=10?(Y(g,17,g.bl_tree),P(g,k-3,3)):(Y(g,18,g.bl_tree),P(g,k-11,7));k=0,d=L,0===b?(e=138,N=3):L===b?(e=6,N=3):(e=7,N=4)}};let w=!1;const t=(g,i,a,n)=>{P(g,0+(n?1:0),3),((g,i,a,n)=>{S(g),n&&(v(g,a),v(g,~a)),g.pending_buf.set(g.window.subarray(i,i+a),g.pending),g.pending+=a})(g,i,a,!0)};g.exports._tr_init=g=>{w||((()=>{let g,i,a,N,E;const X=new Array(16);for(a=0,N=0;N<28;N++)for(B[N]=a,g=0;g<1<<b[N];g++)y[a++]=N;for(y[a-1]=N,E=0,N=0;N<16;N++)for(c[N]=E,g=0;g<1<<k[N];g++)j[E++]=N;for(E>>=7;N<L;N++)for(c[N]=E<<7,g=0;g<1<<k[N]-7;g++)j[256+E++]=N;for(i=0;i<=d;i++)X[i]=0;for(g=0;g<=143;)F[2*g+1]=8,g++,X[8]++;for(;g<=255;)F[2*g+1]=9,g++,X[9]++;for(;g<=279;)F[2*g+1]=7,g++,X[7]++;for(;g<=287;)F[2*g+1]=8,g++,X[8]++;for(C(F,287,X),g=0;g<L;g++)I[2*g+1]=5,I[2*g]=f(g,5);p=new D(F,b,257,n,d),R=new D(I,k,0,L,d),x=new D(new Array(0),e,0,19,7)})(),w=!0),g.l_desc=new E(g.dyn_ltree,p),g.d_desc=new E(g.dyn_dtree,R),g.bl_desc=new E(g.bl_tree,x),g.bi_buf=0,g.bi_valid=0,U(g)},g.exports._tr_stored_block=t,g.exports._tr_flush_block=(g,i,n,L)=>{let d,b,k=0;g.level>0?(2===g.strm.data_type&&(g.strm.data_type=(g=>{let i,n=4093624447;for(i=0;i<=31;i++,n>>>=1)if(1&n&&0!==g.dyn_ltree[2*i])return 0;if(0!==g.dyn_ltree[18]||0!==g.dyn_ltree[20]||0!==g.dyn_ltree[26])return 1;for(i=32;i<a;i++)if(0!==g.dyn_ltree[2*i])return 1;return 0})(g)),l(g,g.l_desc),l(g,g.d_desc),k=(g=>{let i;for(Z(g,g.dyn_ltree,g.l_desc.max_code),Z(g,g.dyn_dtree,g.d_desc.max_code),l(g,g.bl_desc),i=18;i>=3&&0===g.bl_tree[2*N[i]+1];i--);return g.opt_len+=3*(i+1)+5+5+4,i})(g),d=g.opt_len+3+7>>>3,b=g.static_len+3+7>>>3,b<=d&&(d=b)):d=b=n+5,n+4<=d&&-1!==i?t(g,i,n,L):4===g.strategy||b===d?(P(g,2+(L?1:0),3),T(g,F,I)):(P(g,4+(L?1:0),3),((g,i,a,n)=>{let L;for(P(g,i-257,5),P(g,a-1,5),P(g,n-4,4),L=0;L<n;L++)P(g,g.bl_tree[2*N[L]+1],3);h(g,g.dyn_ltree,i-1),h(g,g.dyn_dtree,a-1)})(g,g.l_desc.max_code+1,g.d_desc.max_code+1,k+1),T(g,g.dyn_ltree,g.dyn_dtree)),U(g),L&&S(g)},g.exports._tr_tally=(g,i,n)=>(g.pending_buf[g.d_buf+2*g.last_lit]=i>>>8&255,g.pending_buf[g.d_buf+2*g.last_lit+1]=255&i,g.pending_buf[g.l_buf+g.last_lit]=255&n,g.last_lit++,0===i?g.dyn_ltree[2*n]++:(g.matches++,i--,g.dyn_ltree[2*(y[n]+a+1)]++,g.dyn_dtree[2*X(i)]++),g.last_lit===g.lit_bufsize-1),g.exports._tr_align=g=>{P(g,2,3),Y(g,256,F),(g=>{16===g.bi_valid?(v(g,g.bi_buf),g.bi_buf=0,g.bi_valid=0):g.bi_valid>=8&&(g.pending_buf[g.pending++]=255&g.bi_buf,g.bi_buf>>=8,g.bi_valid-=8)})(g)}},13658:g=>{"use strict";g.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Ni="",this.state=null,this.data_type=2,this.adler=0}},13270:g=>{function i(g,i,a){for(var n=g.length,L=-1/0,d=1/0,b=0;b<n;b++){var k=(a[0][b]-g[b])/i[b],e=(a[1][b]-g[b])/i[b];if(k>e){var N=k;k=e,e=N}if(e<L||k>d)return 1/0;k>L&&(L=k),e<d&&(d=e)}return L>d?1/0:L}g.exports=function(g,a,n,L){var d=i(a,n,L);if(d===1/0)g=null;else{g=g||[];for(var b=0;b<a.length;b++)g[b]=a[b]+n[b]*d}return g},g.exports.distance=i},14706:(g,i,a)=>{"use strict";a.d(i,{e:()=>b});var n=a(28);const L=n.useLayoutEffect;const d=function(g){var i=(0,n.useRef)(g);return L((function(){i.current=g})),i};var b=function(g){var i=d(g);(0,n.bi)((function(){var g=function(g){var a;if(null!=i.current&&(a=i.current(g)),g.defaultPrevented&&(g.returnValue=""),"string"===typeof a)return g.returnValue=a,a};return window.addEventListener("beforeunload",g),function(){window.removeEventListener("beforeunload",g)}}),[])}},14651:(g,i,a)=>{"use strict";var n=a(14657),L=Array.prototype.concat,d=Array.prototype.slice,b=g.exports=function(g){for(var i=[],a=0,b=g.length;a<b;a++){var k=g[a];n(k)?i=L.call(i,d.call(k)):i.push(k)}return i};b.wrap=function(g){return function(){return g(b(arguments))}}},14657:g=>{g.exports=function(g){return!(!g||"string"===typeof g)&&(g instanceof Array||Array.isArray(g)||g.length>=0&&(g.splice instanceof Function||Object.getOwnPropertyDescriptor(g,g.length-1)&&"String"!==g.constructor.name))}},13563:(g,i,a)=>{var n=a(13570);function L(g){for(var i,a,L=0,d=g.length,b=0;b<g.length;){for(i=g[b],a=0;b<d&&g[b]===i;)++b,++a;L+=n.log2(a)/7|0,L+=n.log2(i>>>0)/7|0,L+=2}return L}i.size=L,i.encode=function(g,i){i||(i=new Uint8Array(L(g)));for(var a,n,d=0,b=i.length,k=0;k<g.length;){for(a=g[k],n=0;k<g.length&&g[k]===a;)++k,++n;for(;d<b&&n>=128;)i[d++]=128+(127&n),n>>>=7;if(d>=b)throw new Error("RLE buffer overflow");for(i[d++]=n,a>>>=0;d<b&&a>=128;)i[d++]=128+(127&a),a>>>=7;if(d>=b)throw new Error("RLE buffer overflow");i[d++]=a}return i},i.decode=function(g,i){for(var a,n,L,d,b=i.length,k=g.length,e=0,N=0;N<k;){for(a=0,n=0;N<k&&g[N]>=128;)a+=(127&g[N++])<<n,n+=7;if(a+=g[N++]<<n,N>=k)throw new Error("RLE buffer underrun");if(e+a>b)throw new Error("Chunk buffer overflow");for(L=0,n=0;N<k&&g[N]>=128;)L+=(127&g[N++])<<n,n+=7;if(N>=k)throw new Error("RLE buffer underrun");for(L+=g[N++]<<n,d=0;d<a;++d)i[e++]=L}return i}},13570:(g,i)=>{"use strict";function a(g){var i=32;return(g&=-g)&&i--,65535&g&&(i-=16),16711935&g&&(i-=8),252645135&g&&(i-=4),858993459&g&&(i-=2),1431655765&g&&(i-=1),i}i.INT_BITS=32,i.INT_MAX=2147483647,i.INT_MIN=-1<<31,i.sign=function(g){return(g>0)-(g<0)},i.abs=function(g){var i=g>>31;return(g^i)-i},i.min=function(g,i){return i^(g^i)&-(g<i)},i.max=function(g,i){return g^(g^i)&-(g<i)},i.isPow2=function(g){return!(g&g-1)&&!!g},i.log2=function(g){var i,a;return i=(g>65535)<<4,i|=a=((g>>>=i)>255)<<3,i|=a=((g>>>=a)>15)<<2,(i|=a=((g>>>=a)>3)<<1)|(g>>>=a)>>1},i.log10=function(g){return g>=1e9?9:g>=1e8?8:g>=1e7?7:g>=1e6?6:g>=1e5?5:g>=1e4?4:g>=1e3?3:g>=100?2:g>=10?1:0},i.popCount=function(g){return 16843009*((g=(858993459&(g-=g>>>1&1431655765))+(g>>>2&858993459))+(g>>>4)&252645135)>>>24},i.countTrailingZeros=a,i.nextPow2=function(g){return g+=0===g,--g,g|=g>>>1,g|=g>>>2,g|=g>>>4,g|=g>>>8,(g|=g>>>16)+1},i.prevPow2=function(g){return g|=g>>>1,g|=g>>>2,g|=g>>>4,g|=g>>>8,(g|=g>>>16)-(g>>>1)},i.parity=function(g){return g^=g>>>16,g^=g>>>8,g^=g>>>4,27030>>>(g&=15)&1};var n=new Array(256);!function(g){for(var i=0;i<256;++i){var a=i,n=i,L=7;for(a>>>=1;a;a>>>=1)n<<=1,n|=1&a,--L;g[i]=n<<L&255}}(n),i.reverse=function(g){return n[255&g]<<24|n[g>>>8&255]<<16|n[g>>>16&255]<<8|n[g>>>24&255]},i.interleave2=function(g,i){return(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g&=65535)|g<<8))|g<<4))|g<<2))|g<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i&=65535)|i<<8))|i<<4))|i<<2))|i<<1))<<1},i.deinterleave2=function(g,i){return(g=65535&((g=16711935&((g=252645135&((g=858993459&((g=g>>>i&1431655765)|g>>>1))|g>>>2))|g>>>4))|g>>>16))<<16>>16},i.interleave3=function(g,i,a){return g=1227133513&((g=3272356035&((g=251719695&((g=4278190335&((g&=1023)|g<<16))|g<<8))|g<<4))|g<<2),(g|=(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<1)|(a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2))<<2},i.deinterleave3=function(g,i){return(g=1023&((g=4278190335&((g=251719695&((g=3272356035&((g=g>>>i&1227133513)|g>>>2))|g>>>4))|g>>>8))|g>>>16))<<22>>22},i.nextCombination=function(g){var i=g|g-1;return i+1|(~i&-~i)-1>>>a(g)+1}},13597:g=>{"use strict";g.exports=function(g,i,a,n){var L=self||window;try{try{var d;try{d=new L.Blob([g])}catch(N){(d=new(L.BlobBuilder||L.WebKitBlobBuilder||L.MozBlobBuilder||L.MSBlobBuilder)).append(g),d=d.getBlob()}var b=L.URL||L.webkitURL,k=b.createObjectURL(d),e=new L[i](k,a);return b.revokeObjectURL(k),e}catch(N){return new L[i]("data:application/javascript,".concat(encodeURIComponent(g)),a)}}catch(N){if(!n)throw Error("Inline worker is not supported");return new L[i](n,a)}}},13256:(g,i,a)=>{"use strict";function n(g,i,a,n,L){var d={};return Object.keys(n).forEach((function(g){d[g]=n[g]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=a.slice().reverse().reduce((function(a,n){return n(g,i,a)||a}),d),L&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(L):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(g,i,d),d=null),d}a.d(i,{e:()=>n})},13253:(g,i,a)=>{"use strict";function n(g,i,a,n){a&&Object.defineProperty(g,i,{enumerable:a.enumerable,configurable:a.configurable,writable:a.writable,value:a.initializer?a.initializer.call(n):void 0})}a.d(i,{d:()=>n})},14691:(g,i,a)=>{"use strict";a.d(i,{A:()=>F,e:()=>b,i:()=>I,l:()=>k,n:()=>d,r:()=>e,u:()=>L,x:()=>N});var n=a(12671);class L{constructor(){this._easingMode=L.EASINGMODE_EASEIN}setEasingMode(g){const i=Math.min(Math.max(g,0),2);this._easingMode=i}getEasingMode(){return this._easingMode}easeInCore(g){throw new Error("You must implement this method")}ease(g){switch(this._easingMode){case L.EASINGMODE_EASEIN:return this.easeInCore(g);case L.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-g)}return g>=.5?.5*(1-this.easeInCore(2*(1-g)))+.5:.5*this.easeInCore(2*g)}}L.EASINGMODE_EASEIN=0,L.EASINGMODE_EASEOUT=1,L.EASINGMODE_EASEINOUT=2;class d extends L{easeInCore(g){return g=Math.max(0,Math.min(1,g)),1-Math.sqrt(1-g*g)}}class b extends L{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=g}easeInCore(g){const i=Math.max(0,this.amplitude);return Math.pow(g,3)-g*i*Math.sin(3.141592653589793*g)}}class k extends L{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=g,this.bounciness=i}easeInCore(g){const i=Math.max(0,this.bounces);let a=this.bounciness;a<=1&&(a=1.001);const n=Math.pow(a,i),L=1-a,d=(1-n)/L+.5*n,b=g*d,k=Math.log(-b*(1-a)+1)/Math.log(a),e=Math.floor(k),N=e+1,F=(1-Math.pow(a,e))/(L*d),I=.5*(F+(1-Math.pow(a,N))/(L*d)),j=g-I,y=I-F;return-Math.pow(1/a,i-e)/(y*y)*(j-y)*(j+y)}}class e extends L{easeInCore(g){return g*g*g}}class N extends L{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=g,this.springiness=i}easeInCore(g){let i;const a=Math.max(0,this.oscillations),n=Math.max(0,this.springiness);return i=0==n?g:(Math.exp(n*g)-1)/(Math.exp(n)-1),i*Math.sin((6.283185307179586*a+1.5707963267948966)*g)}}class F extends L{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=g}easeInCore(g){return this.exponent<=0?g:(Math.exp(this.exponent*g)-1)/(Math.exp(this.exponent)-1)}}class I extends L{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=g,this.y1=i,this.x2=a,this.y2=n}easeInCore(g){return n.c.Interpolate(g,this.x1,this.y1,this.x2,this.y2)}}},14115:(g,i,a)=>{"use strict";a.d(i,{d:()=>b});var n=a(12452),L=a(12462),d=a(12887);class b extends d.d{get _matrix(){return this._compose(),this.Yy}set _matrix(g){(g.updateFlag!==this.Yy.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Yy.I(g),this._markAsDirtyAndDecompose())}constructor(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(g,i.Pg(),!1),this.name=g,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=i,this.Yy=(null===L||void 0===L?void 0:L.clone())??n.Matrix.Identity(),this._restMatrix=d??this.Yy.clone(),this._bindMatrix=b??this.Yy.clone(),this._index=k,this._absoluteMatrix=new n.Matrix,this._absoluteBindMatrix=new n.Matrix,this._absoluteInverseBindMatrix=new n.Matrix,this._finalMatrix=new n.Matrix,i.bones.push(this),this.setParent(a,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(g){this.setParent(g)}setParent(g){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==g){if(this.parent){const g=this.parent.children.indexOf(this);-1!==g&&this.parent.children.splice(g,1)}this._parentNode=g,this.parent&&this.parent.children.push(this),i&&this._updateAbsoluteBindMatrices(),this.rF()}}getLocalMatrix(){return this._compose(),this.Yy}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(g){this._restMatrix.I(g)}setRestPose(g){this.setRestMatrix(g)}getBindPose(){return this.getBindMatrix()}setBindMatrix(g){this.ld(g)}setBindPose(g){this.setBindMatrix(g)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const g=n.TmpVectors.Bi[0],i=n.TmpVectors.Quaternion[0],a=n.TmpVectors.Bi[1];this.getRestMatrix().decompose(g,i,a),this._linkedTransformNode.position.I(a),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??n.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.I(i),this._linkedTransformNode.rd.I(g)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(g){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=g,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Me}set position(g){this._decompose(),this.Me.I(g),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(g){this.setRotation(g)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(g){this.setRotationQuaternion(g)}get rd(){return this.getScale()}set rd(g){this.setScale(g)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=n.Bi.Zero(),this._localRotation=n.Quaternion.Zero(),this.Me=n.Bi.Zero()),this.Yy.decompose(this._localScaling,this._localRotation,this.Me))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,n.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Me,this.Yy)):this._needToCompose=!1)}ld(g){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.I(g),i&&this._updateAbsoluteBindMatrices(),a?this._matrix=g:this.rF()}_updateAbsoluteBindMatrices(g){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(g||(g=this._bindMatrix),this.parent?g.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.I(g),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),i)for(let a=0;a<this.children.length;a++)this.children[a]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}rF(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.rF(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.rF(),this._needToDecompose=!0}_updatePosition(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0,L=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const d=this.getLocalMatrix();if(0==i)L?(d.addAtIndex(12,g.x),d.addAtIndex(13,g.y),d.addAtIndex(14,g.z)):d.setTranslationFromFloats(g.x,g.y,g.z);else{let i=null;a&&(i=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const k=b._TmpMats[0],e=b._TmpVecs[0];this.parent?a&&i?(k.I(this.parent.getAbsoluteMatrix()),k.multiplyToRef(i,k)):k.I(this.parent.getAbsoluteMatrix()):n.Matrix.IdentityToRef(k),L&&k.setTranslationFromFloats(0,0,0),k.invert(),n.Bi.TransformCoordinatesToRef(g,k,e),L?(d.addAtIndex(12,e.x),d.addAtIndex(13,e.y),d.addAtIndex(14,e.z)):d.setTranslationFromFloats(e.x,e.y,e.z)}this._markAsDirtyAndDecompose()}translate(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;this._updatePosition(g,i,a,!0)}setPosition(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;this._updatePosition(g,i,a,!1)}setAbsolutePosition(g,i){this.setPosition(g,1,i)}scale(g,i,a){let L=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=this.getLocalMatrix(),k=b._TmpMats[0];n.Matrix.ScalingToRef(g,i,a,k),k.multiplyToRef(d,d),k.invert();for(const n of this.children){const L=n.getLocalMatrix();L.multiplyToRef(k,L),L.multiplyAtIndex(12,g),L.multiplyAtIndex(13,i),L.multiplyAtIndex(14,a),n._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),L)for(const n of this.children)n.scale(g,i,a,L)}setScale(g){this._decompose(),this._localScaling.I(g),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(g){this._decompose(),g.I(this._localScaling)}setYawPitchRoll(g,i,a){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4?arguments[4]:void 0;if(0===L){const k=b._TmpQuat;return n.Quaternion.RotationYawPitchRollToRef(g,i,a,k),void this.setRotationQuaternion(k,L,d)}const k=b._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,d))return;const e=b._TmpMats[1];n.Matrix.RotationYawPitchRollToRef(g,i,a,e),k.multiplyToRef(e,e),this._rotateWithMatrix(e,L,d)}rotate(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,L=arguments.length>3?arguments[3]:void 0;const d=b._TmpMats[0];d.setTranslationFromFloats(0,0,0),n.Matrix.RotationAxisToRef(g,i,d),this._rotateWithMatrix(d,a,L)}setAxisAngle(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,L=arguments.length>3?arguments[3]:void 0;if(0===a){const d=b._TmpQuat;return n.Quaternion.RotationAxisToRef(g,i,d),void this.setRotationQuaternion(d,a,L)}const d=b._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(d,L))return;const k=b._TmpMats[1];n.Matrix.RotationAxisToRef(g,i,k),d.multiplyToRef(k,k),this._rotateWithMatrix(k,a,L)}setRotation(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(g.y,g.x,g.z,i,a)}setRotationQuaternion(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;if(0===i)return this._decompose(),this._localRotation.I(g),void this._markAsDirtyAndCompose();const L=b._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(L,a))return;const d=b._TmpMats[1];n.Matrix.FromQuaternionToRef(g,d),L.multiplyToRef(d,d),this._rotateWithMatrix(d,i,a)}setRotationMatrix(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;if(0===i){const L=b._TmpQuat;return n.Quaternion.FromRotationMatrixToRef(g,L),void this.setRotationQuaternion(L,i,a)}const L=b._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(L,a))return;const d=b._TmpMats[1];d.I(g),L.multiplyToRef(g,d),this._rotateWithMatrix(d,i,a)}_rotateWithMatrix(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;const n=this.getLocalMatrix(),L=n.m[12],d=n.m[13],k=n.m[14],e=this.getParent(),N=b._TmpMats[3],F=b._TmpMats[4];e&&1==i?(a?(N.I(a.getWorldMatrix()),e.getAbsoluteMatrix().multiplyToRef(N,N)):N.I(e.getAbsoluteMatrix()),F.I(N),F.invert(),n.multiplyToRef(N,n),n.multiplyToRef(g,n),n.multiplyToRef(F,n)):1==i&&a?(N.I(a.getWorldMatrix()),F.I(N),F.invert(),n.multiplyToRef(N,n),n.multiplyToRef(g,n),n.multiplyToRef(F,n)):n.multiplyToRef(g,n),n.setTranslationFromFloats(L,d,k),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(g,i){const a=b._TmpMats[2];return g.I(this.getAbsoluteMatrix()),i?(g.multiplyToRef(i.getWorldMatrix(),g),n.Matrix.ScalingToRef(i.rd.x,i.rd.y,i.rd.z,a)):n.Matrix.IdentityToRef(a),g.invert(),!isNaN(g.m[0])&&(a.multiplyAtIndex(0,this._scalingDeterminant),g.multiplyToRef(a,g),!0)}XL(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=n.Bi.Zero();return this.getPositionToRef(g,i,a),a}getPositionToRef(){let g=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const g=this.getLocalMatrix();i.x=g.m[12],i.y=g.m[13],i.z=g.m[14]}else{let a=null;g&&(a=g.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let n=b._TmpMats[0];g&&a?(n.I(this.getAbsoluteMatrix()),n.multiplyToRef(a,n)):n=this.getAbsoluteMatrix(),i.x=n.m[12],i.y=n.m[13],i.z=n.m[14]}}getAbsolutePosition(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const i=n.Bi.Zero();return this.getPositionToRef(1,g,i),i}getAbsolutePositionToRef(g,i){this.getPositionToRef(1,g,i)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Yy.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.I(this.Yy);const g=this._skeleton.getPoseMatrix();g&&this._absoluteMatrix.multiplyToRef(g,this._absoluteMatrix)}const g=this.children,i=g.length;for(let a=0;a<i;a++)g[a].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}vN(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=n.Bi.Zero();return this.getDirectionToRef(g,i,a),a}getDirectionToRef(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0,L=null;i&&(L=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=b._TmpMats[0];d.I(this.getAbsoluteMatrix()),i&&L&&d.multiplyToRef(L,d),n.Bi.TransformNormalToRef(g,d,a),a.normalize()}getRotation(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=n.Bi.Zero();return this.getRotationToRef(g,i,a),a}getRotationToRef(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0;const n=b._TmpQuat;this.getRotationQuaternionToRef(g,i,n),n.toEulerAnglesToRef(a)}getRotationQuaternion(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=n.Quaternion.Identity();return this.getRotationQuaternionToRef(g,i,a),a}getRotationQuaternionToRef(){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),i.I(this._localRotation);else{const a=b._TmpMats[0],n=this.getAbsoluteMatrix();g?n.multiplyToRef(g.getWorldMatrix(),a):a.I(n),a.multiplyAtIndex(0,this._scalingDeterminant),a.multiplyAtIndex(1,this._scalingDeterminant),a.multiplyAtIndex(2,this._scalingDeterminant),a.decompose(void 0,i,void 0)}}getRotationMatrix(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;const a=n.Matrix.Identity();return this.getRotationMatrixToRef(g,i,a),a}getRotationMatrixToRef(){let g=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(i);else{const a=b._TmpMats[0],n=this.getAbsoluteMatrix();g?n.multiplyToRef(g.getWorldMatrix(),a):a.I(n),a.multiplyAtIndex(0,this._scalingDeterminant),a.multiplyAtIndex(1,this._scalingDeterminant),a.multiplyAtIndex(2,this._scalingDeterminant),a.getRotationMatrixToRef(i)}}getAbsolutePositionFromLocal(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=n.Bi.Zero();return this.getAbsolutePositionFromLocalToRef(g,i,a),a}getAbsolutePositionFromLocalToRef(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0,L=null;i&&(L=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=b._TmpMats[0];d.I(this.getAbsoluteMatrix()),i&&L&&d.multiplyToRef(L,d),n.Bi.TransformCoordinatesToRef(g,d,a)}getLocalPositionFromAbsolute(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=n.Bi.Zero();return this.getLocalPositionFromAbsoluteToRef(g,i,a),a}getLocalPositionFromAbsoluteToRef(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0,L=null;i&&(L=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=b._TmpMats[0];d.I(this.getAbsoluteMatrix()),i&&L&&d.multiplyToRef(L,d),d.invert(),n.Bi.TransformCoordinatesToRef(g,d,a)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const g=this._skeleton.bones.indexOf(this);if(-1!==g&&this._skeleton.bones.splice(g,1),this._parentNode&&this._parentNode.children){const g=this._parentNode.children,i=g.indexOf(this);-1!==i&&g.splice(i,1)}super.dispose()}}b._TmpVecs=(0,L.d)(2,n.Bi.Zero),b._TmpQuat=n.Quaternion.Identity(),b._TmpMats=(0,L.d)(5,n.Matrix.Identity)},14684:(g,i,a)=>{"use strict";a.d(i,{c:()=>l});var n=a(12441),L=a(12447),d=a(12286),b=a(12452),k=a(12466),e=a(12887),N=a(12910),F=a(12734),I=a(12301),j=a(12454);class y{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(g){this._zoomStopsAnimation=g}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(g){this._idleRotationSpeed=g}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(g){this._idleRotationWaitTime=g}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(g){this._idleRotationSpinupTime=g}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(g){this._attachedCamera=g;const i=this._attachedCamera.Pg();this._onPrePointerObservableObserver=i.onPrePointerObservable.add((g=>{g.type!==F.b.POINTERDOWN?g.type===F.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=g.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const g=I.c.Now;let i=0;null!=this._lastFrameTime&&(i=g-this._lastFrameTime),this._lastFrameTime=g,this._applyUserInteraction();const a=g-this._lastInteractionTime-this._idleRotationWaitTime,n=Math.max(Math.min(a/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*n,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(i/1e3))}))}detach(){if(!this._attachedCamera)return;const g=this._attachedCamera.Pg();this._onPrePointerObservableObserver&&g.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(g){this._lastInteractionTime=g??I.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<j.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let g=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(g=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?g:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=I.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var B=a(14691),c=a(12994);class D{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(g){if(this._autoTransitionRange===g)return;this._autoTransitionRange=g;const i=this._attachedCamera;i&&(g?this._onMeshTargetChangedObserver=i.onMeshTargetChangedObservable.add((g=>{if(g&&(g.Zd(!0),g.getBoundingInfo)){const i=g.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*i,this.upperRadiusTransitionRange=.05*i}})):this._onMeshTargetChangedObserver&&i.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(g){this._attachedCamera=g,this._onAfterCheckInputsObserver=g.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(g){return!!this._attachedCamera&&(this._attachedCamera.radius===g&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(g){if(!this._attachedCamera)return;this._radiusBounceTransition||(D.EasingFunction.setEasingMode(D.EasingMode),this._radiusBounceTransition=c.b.CreateAnimation("radius",c.b.ANIMATIONTYPE_FLOAT,60,D.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const i=c.b.TransitionTo("radius",this._attachedCamera.radius+g,this._attachedCamera,this._attachedCamera.Pg(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));i&&this._animatables.push(i)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}D.EasingFunction=new B.e(.3),D.EasingMode=B.u.EASINGMODE_EASEOUT;class p{constructor(){this.onTargetFramingAnimationEndObservable=new d.b,this._mode=p.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(g){this._mode=g}get mode(){return this._mode}set radiusScale(g){this._radiusScale=g}get radiusScale(){return this._radiusScale}set positionScale(g){this._positionScale=g}get positionScale(){return this._positionScale}set defaultElevation(g){this._defaultElevation=g}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(g){this._elevationReturnTime=g}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(g){this._elevationReturnWaitTime=g}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(g){this._zoomStopsAnimation=g}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(g){this._framingTime=g}get framingTime(){return this._framingTime}init(){}attach(g){this._attachedCamera=g;const i=this._attachedCamera.Pg();p.EasingFunction.setEasingMode(p.EasingMode),this._onPrePointerObservableObserver=i.onPrePointerObservable.add((g=>{g.type!==F.b.POINTERDOWN?g.type===F.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=g.onMeshTargetChangedObservable.add((g=>{g&&g.getBoundingInfo&&this.zoomOnMesh(g,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=g.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const g=this._attachedCamera.Pg();this._onPrePointerObservableObserver&&g.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(g){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;g.Zd(!0);const n=g.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(n.minimumWorld,n.maximumWorld,i,a)}zoomOnMeshHierarchy(g){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;g.Zd(!0);const n=g.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(n.min,n.max,i,a)}zoomOnMeshesHierarchy(g){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new b.Bi(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),L=new b.Bi(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let d=0;d<g.length;d++){const i=g[d].getHierarchyBoundingVectors(!0);b.Bi.CheckExtends(i.min,n,L),b.Bi.CheckExtends(i.max,n,L)}this.zoomOnBoundingInfo(n,L,i,a)}zoomOnBoundingInfo(g,i){let a,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const d=g.y,k=d+(i.y-d)*this._positionScale,e=i.ci(g).scale(.5);if(!isFinite(k))return!1;if(n)a=new b.Bi(0,k,0);else{const i=g.add(e);a=new b.Bi(i.x,k,i.z)}this._vectorTransition||(this._vectorTransition=c.b.CreateAnimation("target",c.b.ANIMATIONTYPE_VECTOR3,60,p.EasingFunction)),this._betaIsAnimating=!0;let N=c.b.TransitionTo("target",a,this._attachedCamera,this._attachedCamera.Pg(),60,this._vectorTransition,this._framingTime);N&&this._animatables.push(N);let F=0;if(this._mode===p.FitFrustumSidesMode){const a=this._calculateLowerRadiusFromModelBoundingSphere(g,i);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=e.length()+this._attachedCamera.Vd),F=a}else this._mode===p.IgnoreBoundsSizeMode&&(F=this._calculateLowerRadiusFromModelBoundingSphere(g,i),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Vd));if(this.autoCorrectCameraLimitsAndSensibility){const a=i.ci(g).length();this._attachedCamera.panningSensibility=5e3/a,this._attachedCamera.wheelPrecision=100/F}return this._radiusTransition||(this._radiusTransition=c.b.CreateAnimation("radius",c.b.ANIMATIONTYPE_FLOAT,60,p.EasingFunction)),N=c.b.TransitionTo("radius",F,this._attachedCamera,this._attachedCamera.Pg(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),L&&L(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),N&&this._animatables.push(N),!0}_calculateLowerRadiusFromModelBoundingSphere(g,i){const a=this._attachedCamera;if(!a)return 0;let n=a._calculateLowerRadiusFromModelBoundingSphere(g,i,this._radiusScale);return a.lowerRadiusLimit&&this._mode===p.IgnoreBoundsSizeMode&&(n=n<a.lowerRadiusLimit?a.lowerRadiusLimit:n),a.upperRadiusLimit&&(n=n>a.upperRadiusLimit?a.upperRadiusLimit:n),n}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const g=I.c.Now-this._lastInteractionTime,i=.5*Math.PI-this._defaultElevation,a=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>a&&g>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=c.b.CreateAnimation("beta",c.b.ANIMATIONTYPE_FLOAT,60,p.EasingFunction));const g=c.b.TransitionTo("beta",i,this._attachedCamera,this._attachedCamera.Pg(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));g&&this._animatables.push(g)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=I.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}p.EasingFunction=new B.A,p.EasingMode=B.u.EASINGMODE_EASEINOUT,p.IgnoreBoundsSizeMode=0,p.FitFrustumSidesMode=1;var R=a(12916),x=a(12956),E=a(14111),X=a(12277);class v{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(g){g=X.Tools.BackCompatCameraNoPreventDefault(arguments);const i=this.camera.getEngine(),a=i.getInputElement();let n=0,L=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=d=>{var b,k;const e=d.event,N="touch"===e.pointerType;if(d.type!==F.b.POINTERMOVE&&-1===this.buttons.indexOf(e.button))return;const I=e.target;if(this._altKey=e.altKey,this._ctrlKey=e.ctrlKey,this._metaKey=e.metaKey,this._shiftKey=e.shiftKey,this._buttonsPressed=e.buttons,i.isPointerLock){const g=e.movementX,i=e.movementY;this.onTouch(null,g,i),this._pointA=null,this._pointB=null}else{if(d.type!==F.b.POINTERDOWN&&d.type!==F.b.POINTERDOUBLETAP&&N&&(null===(b=this._pointA)||void 0===b?void 0:b.pointerId)!==e.pointerId&&(null===(k=this._pointB)||void 0===k?void 0:k.pointerId)!==e.pointerId)return;if(d.type!==F.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!N)if(d.type===F.b.POINTERDOUBLETAP)this.onDoubleTap(e.pointerType);else if(d.type!==F.b.POINTERUP||this._currentMousePointerIdDown!==e.pointerId&&!N){if(d.type===F.b.POINTERMOVE)if(g||e.preventDefault(),this._pointA&&null===this._pointB){const g=e.clientX-this._pointA.x,i=e.clientY-this._pointA.y;this._pointA.x=e.clientX,this._pointA.y=e.clientY,this.onTouch(this._pointA,g,i)}else if(this._pointA&&this._pointB){const g=this._pointA.pointerId===e.pointerId?this._pointA:this._pointB;g.x=e.clientX,g.y=e.clientY;const i=this._pointA.x-this._pointB.x,a=this._pointA.y-this._pointB.y,b=i*i+a*a,k={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:e.pointerId,type:d.type};this.onMultiTouch(this._pointA,this._pointB,n,b,L,k),L=k,n=b}}else{try{null===I||void 0===I||I.releasePointerCapture(e.pointerId)}catch(j){}N||(this._pointB=null),i._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==e.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==e.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==n||L)&&(this.onMultiTouch(this._pointA,this._pointB,n,0,L,null),n=0,L=null),this._currentMousePointerIdDown=-1,this.onButtonUp(e),g||e.preventDefault()}else{try{null===I||void 0===I||I.setPointerCapture(e.pointerId)}catch(j){}if(null===this._pointA)this._pointA={x:e.clientX,y:e.clientY,pointerId:e.pointerId,type:e.pointerType};else{if(null!==this._pointB)return;this._pointB={x:e.clientX,y:e.clientY,pointerId:e.pointerId,type:e.pointerType}}-1!==this._currentMousePointerIdDown||N||(this._currentMousePointerIdDown=e.pointerId),this.onButtonDown(e),g||(e.preventDefault(),a&&a.focus())}}},this._observer=this.camera.Pg()._inputManager._addCameraPointerObserver(this._pointerInput,F.b.POINTERDOWN|F.b.POINTERUP|F.b.POINTERMOVE|F.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,n=0,L=null,this.onLostFocus()},this._contextMenuBind=g=>this.onContextMenu(g),a&&a.addEventListener("contextmenu",this._contextMenuBind,!1);const d=this.camera.Pg().getEngine().getHostWindow();d&&X.Tools.RegisterTopRootEvents(d,[{name:"blur",handler:this._onLostFocus}])}Kj(){if(this._onLostFocus){const g=this.camera.Pg().getEngine().getHostWindow();g&&X.Tools.UnregisterTopRootEvents(g,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Pg()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const g=this.camera.Pg().getEngine().getInputElement();g&&g.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(g){}onTouch(g,i,a){}onMultiTouch(g,i,a,n,L,d){}onContextMenu(g){g.preventDefault()}onButtonDown(g){}onButtonUp(g){}onLostFocus(){}}(0,n.e)([(0,L.P)()],v.prototype,"buttons",void 0);class P extends v{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(g,i){if(0!==this.panningSensibility&&g&&i){const a=i.x-g.x,n=i.y-g.y;this.camera.inertialPanningX+=-a/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility}}_computePinchZoom(g,i){const a=this.camera.radius||P.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=a*Math.sqrt(g)/Math.sqrt(i):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(i-g)*a*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(i-g)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(g,i,a){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=a/this.panningSensibility):(this.camera.inertialAlphaOffset-=i/this.angularSensibilityX,this.camera.inertialBetaOffset-=a/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(g,i,a,n,L,d){0===a&&null===L||0===n&&null===d||(this.multiTouchPanAndZoom?(this._computePinchZoom(a,n),this._computeMultiTouchPanning(L,d)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(n)-Math.sqrt(a))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(a,n),this._isPinching=!0):this._computeMultiTouchPanning(L,d)):this.multiTouchPanning?this._computeMultiTouchPanning(L,d):this.pinchZoom&&this._computePinchZoom(a,n))}onButtonDown(g){this._isPanClick=g.button===this.camera._panningMouseButton}onButtonUp(g){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}P.MinimumRadiusForPinch=.001,(0,n.e)([(0,L.P)()],P.prototype,"buttons",void 0),(0,n.e)([(0,L.P)()],P.prototype,"angularSensibilityX",void 0),(0,n.e)([(0,L.P)()],P.prototype,"angularSensibilityY",void 0),(0,n.e)([(0,L.P)()],P.prototype,"pinchPrecision",void 0),(0,n.e)([(0,L.P)()],P.prototype,"pinchDeltaPercentage",void 0),(0,n.e)([(0,L.P)()],P.prototype,"useNaturalPinchZoom",void 0),(0,n.e)([(0,L.P)()],P.prototype,"pinchZoom",void 0),(0,n.e)([(0,L.P)()],P.prototype,"panningSensibility",void 0),(0,n.e)([(0,L.P)()],P.prototype,"multiTouchPanning",void 0),(0,n.e)([(0,L.P)()],P.prototype,"multiTouchPanAndZoom",void 0),E.b.ArcRotateCameraPointersInput=P;var Y=a(12742);class f{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(g){g=X.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Pg(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((i=>{const a=i.event;if(!a.metaKey)if(i.type===Y.d.KEYDOWN){if(this._ctrlPressed=a.ctrlKey,this._altPressed=a.altKey,-1!==this.keysUp.indexOf(a.keyCode)||-1!==this.keysDown.indexOf(a.keyCode)||-1!==this.keysLeft.indexOf(a.keyCode)||-1!==this.keysRight.indexOf(a.keyCode)||-1!==this.keysReset.indexOf(a.keyCode)){-1===this._keys.indexOf(a.keyCode)&&this._keys.push(a.keyCode),a.preventDefault&&(g||a.preventDefault())}}else if(-1!==this.keysUp.indexOf(a.keyCode)||-1!==this.keysDown.indexOf(a.keyCode)||-1!==this.keysLeft.indexOf(a.keyCode)||-1!==this.keysRight.indexOf(a.keyCode)||-1!==this.keysReset.indexOf(a.keyCode)){const i=this._keys.indexOf(a.keyCode);i>=0&&this._keys.splice(i,1),a.preventDefault&&(g||a.preventDefault())}})))}Kj(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const g=this.camera;for(let i=0;i<this._keys.length;i++){const a=this._keys[i];-1!==this.keysLeft.indexOf(a)?this._ctrlPressed&&this.camera._useCtrlForPanning?g.inertialPanningX-=1/this.panningSensibility:g.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(a)?this._ctrlPressed&&this.camera._useCtrlForPanning?g.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?g.inertialRadiusOffset+=1/this.zoomingSensibility:g.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(a)?this._ctrlPressed&&this.camera._useCtrlForPanning?g.inertialPanningX+=1/this.panningSensibility:g.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(a)?this._ctrlPressed&&this.camera._useCtrlForPanning?g.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?g.inertialRadiusOffset-=1/this.zoomingSensibility:g.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(a)&&g.useInputToRestoreState&&g.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,n.e)([(0,L.P)()],f.prototype,"keysUp",void 0),(0,n.e)([(0,L.P)()],f.prototype,"keysDown",void 0),(0,n.e)([(0,L.P)()],f.prototype,"keysLeft",void 0),(0,n.e)([(0,L.P)()],f.prototype,"keysRight",void 0),(0,n.e)([(0,L.P)()],f.prototype,"keysReset",void 0),(0,n.e)([(0,L.P)()],f.prototype,"panningSensibility",void 0),(0,n.e)([(0,L.P)()],f.prototype,"zoomingSensibility",void 0),(0,n.e)([(0,L.P)()],f.prototype,"useAltToZoom",void 0),(0,n.e)([(0,L.P)()],f.prototype,"angularSpeed",void 0),E.b.ArcRotateCameraKeyboardMoveInput=f;var C=a(12498),U=a(12751);class S{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new b.Bi(0,0,0),this._globalOffset=new b.Bi(0,0,0),this._inertialPanning=b.Bi.Zero()}_computeDeltaFromMouseWheelLegacyEvent(g,i){let a=0;const n=.01*g*this.wheelDeltaPercentage*i;return a=g>0?n/(1+this.wheelDeltaPercentage):n*(1+this.wheelDeltaPercentage),a}attachControl(g){g=X.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=i=>{if(i.type!==F.b.POINTERWHEEL)return;const a=i.event;let n=0;const L=a.deltaMode===U.d.DOM_DELTA_LINE?40:1,d=-a.deltaY*L;if(this.customComputeDeltaFromMouseWheel)n=this.customComputeDeltaFromMouseWheel(d,this,a);else if(this.wheelDeltaPercentage){if(n=this._computeDeltaFromMouseWheelLegacyEvent(d,this.camera.radius),n>0){let g=this.camera.radius,i=this.camera.inertialRadiusOffset+n;for(let a=0;a<20&&!(g<=i)&&!(Math.abs(i*this.camera.inertia)<.001);a++)g-=i,i*=this.camera.inertia;g=(0,k.Clamp)(g,0,Number.MAX_VALUE),n=this._computeDeltaFromMouseWheelLegacyEvent(d,g)}}else n=d/(40*this.wheelPrecision);n&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(n)):this.camera.inertialRadiusOffset+=n),a.preventDefault&&(g||a.preventDefault())},this._observer=this.camera.Pg()._inputManager._addCameraPointerObserver(this._wheel,F.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Qd(0)}Kj(){this._observer&&(this.camera.Pg()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const g=this.camera;0+g.inertialAlphaOffset+g.inertialBetaOffset+g.inertialRadiusOffset&&(this._updateHitPlane(),g.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(g.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const g=this.camera,i=g.target.ci(g.position);this._hitPlane=C.b.FromPositionAndNormal(g.target,i)}_getPosition(){const g=this.camera,i=g.Pg(),a=i.createPickingRay(i.pointerX,i.pointerY,b.Matrix.Identity(),g,!1);0===g.targetScreenOffset.x&&0===g.targetScreenOffset.y||(this._viewOffset.set(g.targetScreenOffset.x,g.targetScreenOffset.y,0),g.getViewMatrix().invertToRef(g._cameraTransformMatrix),this._globalOffset=b.Bi.TransformNormal(this._viewOffset,g._cameraTransformMatrix),a.origin.addInPlace(this._globalOffset));let n=0;return this._hitPlane&&(n=a.intersectsPlane(this._hitPlane)??0),a.origin.addInPlace(a.direction.scaleInPlace(n))}_zoomToMouse(g){const i=this.camera,a=1-i.inertia;if(i.lowerRadiusLimit){const n=i.lowerRadiusLimit??0;i.radius-(i.inertialRadiusOffset+g)/a<n&&(g=(i.radius-n)*a-i.inertialRadiusOffset)}if(i.upperRadiusLimit){const n=i.upperRadiusLimit??0;i.radius-(i.inertialRadiusOffset+g)/a>n&&(g=(i.radius-n)*a-i.inertialRadiusOffset)}const n=g/a/i.radius,L=this._getPosition(),d=b.TmpVectors.Bi[6];L.subtractToRef(i.target,d),d.scaleInPlace(n),d.scaleInPlace(a),this._inertialPanning.addInPlace(d),i.inertialRadiusOffset+=g}_zeroIfClose(g){Math.abs(g.x)<j.b&&(g.x=0),Math.abs(g.y)<j.b&&(g.y=0),Math.abs(g.z)<j.b&&(g.z=0)}}(0,n.e)([(0,L.P)()],S.prototype,"wheelPrecision",void 0),(0,n.e)([(0,L.P)()],S.prototype,"zoomToMouseLocation",void 0),(0,n.e)([(0,L.P)()],S.prototype,"wheelDeltaPercentage",void 0),E.b.ArcRotateCameraMouseWheelInput=S;class V extends E.d{constructor(g){super(g)}addMouseWheel(){return this.add(new S),this}addPointers(){return this.add(new P),this}addKeyboard(){return this.add(new f),this}}var K=a(12415);function T(g,i){return isNaN(g)?i:g}e.d.AddNodeConstructor("ArcRotateCamera",((g,i)=>()=>new l(g,0,0,1,b.Bi.Zero(),i)));class l extends x.c{get target(){return this._target}set target(g){this.setTarget(g)}get targetHost(){return this._targetHost}set targetHost(g){g&&this.setTarget(g)}getTarget(){return this.target}get position(){return this._position}set position(g){this.setPosition(g)}set upVector(g){this._upToYMatrix||(this._yToUpMatrix=new b.Matrix,this._upToYMatrix=new b.Matrix,this._upVector=b.Bi.Zero()),g.normalize(),this._upVector.I(g),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){b.Matrix.RotationAlignToRef(b.Bi.UpReadOnly,this._upVector,this._yToUpMatrix),b.Matrix.RotationAlignToRef(this._upVector,b.Bi.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const g=this.inputs.attached.pointers;return g?g.angularSensibilityX:0}set angularSensibilityX(g){const i=this.inputs.attached.pointers;i&&(i.angularSensibilityX=g)}get angularSensibilityY(){const g=this.inputs.attached.pointers;return g?g.angularSensibilityY:0}set angularSensibilityY(g){const i=this.inputs.attached.pointers;i&&(i.angularSensibilityY=g)}get pinchPrecision(){const g=this.inputs.attached.pointers;return g?g.pinchPrecision:0}set pinchPrecision(g){const i=this.inputs.attached.pointers;i&&(i.pinchPrecision=g)}get pinchDeltaPercentage(){const g=this.inputs.attached.pointers;return g?g.pinchDeltaPercentage:0}set pinchDeltaPercentage(g){const i=this.inputs.attached.pointers;i&&(i.pinchDeltaPercentage=g)}get useNaturalPinchZoom(){const g=this.inputs.attached.pointers;return!!g&&g.useNaturalPinchZoom}set useNaturalPinchZoom(g){const i=this.inputs.attached.pointers;i&&(i.useNaturalPinchZoom=g)}get panningSensibility(){const g=this.inputs.attached.pointers;return g?g.panningSensibility:0}set panningSensibility(g){const i=this.inputs.attached.pointers;i&&(i.panningSensibility=g)}get keysUp(){const g=this.inputs.attached.keyboard;return g?g.keysUp:[]}set keysUp(g){const i=this.inputs.attached.keyboard;i&&(i.keysUp=g)}get keysDown(){const g=this.inputs.attached.keyboard;return g?g.keysDown:[]}set keysDown(g){const i=this.inputs.attached.keyboard;i&&(i.keysDown=g)}get keysLeft(){const g=this.inputs.attached.keyboard;return g?g.keysLeft:[]}set keysLeft(g){const i=this.inputs.attached.keyboard;i&&(i.keysLeft=g)}get keysRight(){const g=this.inputs.attached.keyboard;return g?g.keysRight:[]}set keysRight(g){const i=this.inputs.attached.keyboard;i&&(i.keysRight=g)}get wheelPrecision(){const g=this.inputs.attached.mousewheel;return g?g.wheelPrecision:0}set wheelPrecision(g){const i=this.inputs.attached.mousewheel;i&&(i.wheelPrecision=g)}get zoomToMouseLocation(){const g=this.inputs.attached.mousewheel;return!!g&&g.zoomToMouseLocation}set zoomToMouseLocation(g){const i=this.inputs.attached.mousewheel;i&&(i.zoomToMouseLocation=g)}get wheelDeltaPercentage(){const g=this.inputs.attached.mousewheel;return g?g.wheelDeltaPercentage:0}set wheelDeltaPercentage(g){const i=this.inputs.attached.mousewheel;i&&(i.wheelDeltaPercentage=g)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(g){g!==this.useBouncingBehavior&&(g?(this._bouncingBehavior=new D,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(g){g!==this.useFramingBehavior&&(g?(this._framingBehavior=new p,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(g){g!==this.useAutoRotationBehavior&&(g?(this._autoRotationBehavior=new y,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(g,i,a,n,L,k){var e;let N=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(g,b.Bi.Zero(),k,N),e=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=b.Bi.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=b.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new b.Matrix,this.panningAxis=new b.Bi(1,1,0),this._transformedDirection=new b.Bi,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new d.b,this.checkCollisions=!1,this.collisionRadius=new b.Bi(.5,.5,.5),this._previousPosition=b.Bi.Zero(),this._collisionVelocity=b.Bi.Zero(),this._newPosition=b.Bi.Zero(),this._computationVector=b.Bi.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new b.Bi(NaN,NaN,NaN),this._goalTargetScreenOffset=new b.Vector2(NaN,NaN),this._onCollisionPositionChange=function(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a?(e.setPosition(i),e.xB&&e.xB(a)):e._previousPosition.I(e._position);const n=Math.cos(e.alpha),L=Math.sin(e.alpha),d=Math.cos(e.beta);let b=Math.sin(e.beta);0===b&&(b=1e-4);const k=e._getTargetPosition();e._computationVector.sd(e.radius*n*b,e.radius*d,e.radius*L*b),k.addToRef(e._computationVector,e._newPosition),e._position.I(e._newPosition);let N=e.upVector;e.allowUpsideDown&&e.beta<0&&(N=N.clone(),N=N.negate()),e._computeViewMatrix(e._position,k,N),e._viewMatrix.addAtIndex(12,e.targetScreenOffset.x),e._viewMatrix.addAtIndex(13,e.targetScreenOffset.y),e._collisionTriggered=!1},this._target=b.Bi.Zero(),L&&this.setTarget(L),this.alpha=i,this.beta=a,this.radius=n,this.getViewMatrix(),this.inputs=new V(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new b.Bi(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=b.Vector2.Zero()}_updateCache(g){g||super._updateCache(),this._cache._target.I(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.I(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const g=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?g.addToRef(this._targetBoundingCenter,this._target):this._target.I(g)}const g=this._getLockedTargetPosition();return g||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>j.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,d=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=d?this._currentInterpolationFactor=d:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=T(g,this._goalAlpha),this._goalBeta=T(i,this._goalBeta),this._goalRadius=T(a,this._goalRadius),this._goalTarget.set(T(n.x,this._goalTarget.x),T(n.y,this._goalTarget.y),T(n.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(T(L.x,this._goalTargetScreenOffset.x),T(L.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,k.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,k.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,k.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,k.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(g,i){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const L=arguments;i=X.Tools.BackCompatCameraNoPreventDefault(L),this._useCtrlForPanning=a,this._panningMouseButton=n,"boolean"===typeof L[0]&&(L.length>1&&(this._useCtrlForPanning=L[1]),L.length>2&&(this._panningMouseButton=L[2])),this.inputs.attachElement(i),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Kj(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let g=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){g=!0;const i=this.invertRotation?-1:1,a=this._calculateHandednessMultiplier();let n=this.inertialAlphaOffset*a;this.beta<0&&(n*=-1),this.alpha+=n*i,this.beta+=this.inertialBetaOffset*i,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<j.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<j.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*j.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){g=!0;const i=new b.Bi(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),i.multiplyInPlace(this.panningAxis),b.Bi.TransformNormalToRef(i,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const g=this.upVector,i=b.Bi.CrossToRef(this._transformedDirection,g,this._transformedDirection);b.Bi.CrossToRef(g,i,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);b.Bi.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.I(this._transformedDirection)}else{if(this.parent){const g=b.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(g),g.transposeToRef(g),b.Bi.TransformCoordinatesToRef(this._transformedDirection,g,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*j.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*j.b&&(this.inertialPanningY=0)}if(g)this.stopInterpolation();else if(this._isInterpolating){let g=!1;const i=this._scene.getEngine().getDeltaTime()/1e3,a=1-Math.pow(2,-i/this._currentInterpolationFactor),n=T(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const i=b.TmpVectors.Bi[0].set(T(this._goalTarget.x,this._target.x),T(this._goalTarget.y,this._target.y),T(this._goalTarget.z,this._target.z));b.Bi.LerpToRef(this.target,i,a,this._target),10*b.Bi.Distance(this.target,i)/n<j.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.I(i),this.setTarget(this.target,!1,!0,!0)):g=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const i=b.Quaternion.RotationAlphaBetaGammaToRef(T(this._goalAlpha,this.alpha),T(this._goalBeta,this.beta),0,b.TmpVectors.Quaternion[0]),n=b.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,b.TmpVectors.Quaternion[1]),L=b.Quaternion.SlerpToRef(n,i,a,b.TmpVectors.Quaternion[2]);L.normalize();const d=L.toAlphaBetaGammaToRef(b.TmpVectors.Bi[0]);if(this.alpha=d.x,this.beta=d.y,L.isApprox(i,j.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const g=i.toAlphaBetaGammaToRef(b.TmpVectors.Bi[0]);this.alpha=g.x,this.beta=g.y}else g=!0}if(isNaN(this._goalRadius)||(this.radius+=(n-this.radius)*a,Math.abs(n/this.radius-1)<j.b?(this._goalRadius=NaN,this.radius=n):g=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const i=b.TmpVectors.Vector2[0].set(T(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),T(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));b.Vector2.LerpToRef(this.targetScreenOffset,i,a,this.targetScreenOffset),b.Vector2.Distance(this.targetScreenOffset,i)<j.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.I(i)):g=!0}this._isInterpolating=g}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||b.Bi.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const g=this.alpha;var i,a;this.alpha=function(g){let i=Math.PI/2;return 0===g.x&&0===g.z||(i=Math.acos(g.x/Math.sqrt(Math.pow(g.x,2)+Math.pow(g.z,2)))),g.z<0&&(i=2*Math.PI-i),i}(this._computationVector),this.beta=(i=this._computationVector.y,a=this.radius,Math.acos(i/a));const n=Math.round((g-this.alpha)/(2*Math.PI));this.alpha+=2*n*Math.PI,this._checkLimits()}setPosition(g){this._position.equals(g)||(this._position.I(g),this.rebuildAnglesAndRadius())}setTarget(g){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(n=this.overrideCloneAlphaBetaRadius??n,g.Zd)i&&g.getBoundingInfo?this._targetBoundingCenter=g.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,g.Zd(),this._targetHost=g,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const i=g,n=this._getTargetPosition();if(n&&!a&&n.equals(i))return;this._targetHost=null,this._target=i,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}n||this.rebuildAnglesAndRadius()}_getViewMatrix(){const g=Math.cos(this.alpha),i=Math.sin(this.alpha),a=Math.cos(this.beta);let n=Math.sin(this.beta);0===n&&(n=1e-4),0===this.radius&&(this.radius=1e-4);const L=this._getTargetPosition();if(this._computationVector.sd(this.radius*g*n,this.radius*a,this.radius*i*n),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||b.Bi.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),L.addToRef(this._computationVector,this._newPosition),this.Pg().collisionsEnabled&&this.checkCollisions){const g=this.Pg().collisionCoordinator;this._collider||(this._collider=g.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,g.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.I(this._newPosition);let g=this.upVector;this.allowUpsideDown&&n<0&&(g=g.negate()),this._computeViewMatrix(this._position,L,g),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.I(L),this._viewMatrix}zoomOn(g){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];g=g||this.Pg().meshes;const a=N.e.MinMax(g);let n=this._calculateLowerRadiusFromModelBoundingSphere(a.min,a.max);if(n=Math.max(Math.min(n,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=n*this.zoomOnFactor,this.mode===R.b.ORTHOGRAPHIC_CAMERA){const g=this.Pg().getEngine().getAspectRatio(this),i=n*this.zoomOnFactor/2;this.orthoLeft=-i*g,this.orthoRight=i*g,this.orthoBottom=-i,this.orthoTop=i}this.focusOn({min:a.min,max:a.max,distance:n},i)}focusOn(g){let i,a,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===g.min){const n=g||this.Pg().meshes;i=N.e.MinMax(n),a=b.Bi.Distance(i.min,i.max)}else{i=g,a=g.distance}this._target=N.e.Center(i),n||(this.maxZ=2*a)}createRigCamera(g,i){let a=0;switch(this.cameraRigMode){case R.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case R.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case R.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case R.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case R.b.RIG_MODE_VR:a=this._cameraRigParams.stereoHalfAngle*(0===i?1:-1);break;case R.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:a=this._cameraRigParams.stereoHalfAngle*(0===i?-1:1)}const n=new l(g,this.alpha+a,this.beta,this.radius,this._target,this.Pg());return n._cameraRigParams={},n.isRigCamera=!0,n.rigParent=this,n.upVector=this.upVector,n.mode=this.mode,n.orthoLeft=this.orthoLeft,n.orthoRight=this.orthoRight,n.orthoBottom=this.orthoBottom,n.orthoTop=this.orthoTop,n}_updateRigCameras(){const g=this._rigCameras[0],i=this._rigCameras[1];switch(g.beta=i.beta=this.beta,this.cameraRigMode){case R.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case R.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case R.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case R.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case R.b.RIG_MODE_VR:g.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case R.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:g.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const n=b.Bi.Distance(g,i),L=this.Pg().getEngine().getAspectRatio(this),d=Math.tan(this.fov/2),k=d*L,e=.5*n*a,N=e*Math.sqrt(1+1/(k*k)),F=e*Math.sqrt(1+1/(d*d));return Math.max(N,F)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,n.e)([(0,L.P)()],l.prototype,"alpha",void 0),(0,n.e)([(0,L.P)()],l.prototype,"beta",void 0),(0,n.e)([(0,L.P)()],l.prototype,"radius",void 0),(0,n.e)([(0,L.P)()],l.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,n.e)([(0,L.M)("target")],l.prototype,"_target",void 0),(0,n.e)([(0,L.E)("targetHost")],l.prototype,"_targetHost",void 0),(0,n.e)([(0,L.P)()],l.prototype,"inertialAlphaOffset",void 0),(0,n.e)([(0,L.P)()],l.prototype,"inertialBetaOffset",void 0),(0,n.e)([(0,L.P)()],l.prototype,"inertialRadiusOffset",void 0),(0,n.e)([(0,L.P)()],l.prototype,"lowerAlphaLimit",void 0),(0,n.e)([(0,L.P)()],l.prototype,"upperAlphaLimit",void 0),(0,n.e)([(0,L.P)()],l.prototype,"lowerBetaLimit",void 0),(0,n.e)([(0,L.P)()],l.prototype,"upperBetaLimit",void 0),(0,n.e)([(0,L.P)()],l.prototype,"lowerRadiusLimit",void 0),(0,n.e)([(0,L.P)()],l.prototype,"upperRadiusLimit",void 0),(0,n.e)([(0,L.P)()],l.prototype,"lowerTargetYLimit",void 0),(0,n.e)([(0,L.P)()],l.prototype,"inertialPanningX",void 0),(0,n.e)([(0,L.P)()],l.prototype,"inertialPanningY",void 0),(0,n.e)([(0,L.P)()],l.prototype,"pinchToPanMaxDistance",void 0),(0,n.e)([(0,L.P)()],l.prototype,"panningDistanceLimit",void 0),(0,n.e)([(0,L.M)()],l.prototype,"panningOriginTarget",void 0),(0,n.e)([(0,L.P)()],l.prototype,"panningInertia",void 0),(0,n.e)([(0,L.P)()],l.prototype,"zoomToMouseLocation",null),(0,n.e)([(0,L.P)()],l.prototype,"zoomOnFactor",void 0),(0,n.e)([(0,L.L)()],l.prototype,"targetScreenOffset",void 0),(0,n.e)([(0,L.P)()],l.prototype,"allowUpsideDown",void 0),(0,n.e)([(0,L.P)()],l.prototype,"useInputToRestoreState",void 0),(0,n.e)([(0,L.P)()],l.prototype,"restoreStateInterpolationFactor",void 0),(0,K.e)("BABYLON.ArcRotateCamera",l)},14111:(g,i,a)=>{"use strict";a.d(i,{b:()=>b,d:()=>k});var n=a(12292),L=a(12484),d=a(12916),b={};class k{constructor(g){this.attachedToElement=!1,this.attached={},this.camera=g,this.checkInputs=()=>{}}add(g){const i=g.getSimpleName();this.attached[i]?n.b.Warn("camera input of type "+i+" already exists on camera"):(this.attached[i]=g,g.camera=this.camera,g.checkInputs&&(this.checkInputs=this._addCheckInputs(g.checkInputs.bind(g))),this.attachedToElement&&g.attachControl(this.noPreventDefault))}remove(g){for(const i in this.attached){const a=this.attached[i];if(a===g)return a.Kj(),a.camera=null,delete this.attached[i],void this.rebuildInputCheck()}}removeByType(g){for(const i in this.attached){const a=this.attached[i];a.getClassName()===g&&(a.Kj(),a.camera=null,delete this.attached[i],this.rebuildInputCheck())}}_addCheckInputs(g){const i=this.checkInputs;return()=>{i(),g()}}attachInput(g){this.attachedToElement&&g.attachControl(this.noPreventDefault)}attachElement(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){g=!d.b.ForceAttachControlToAlwaysPreventDefault&&g,this.attachedToElement=!0,this.noPreventDefault=g;for(const i in this.attached)this.attached[i].attachControl(g)}}detachElement(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const i in this.attached)this.attached[i].Kj(),g&&(this.attached[i].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const g in this.attached){const i=this.attached[g];i.checkInputs&&(this.checkInputs=this._addCheckInputs(i.checkInputs.bind(i)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(g){const i={};for(const a in this.attached){const g=this.attached[a],n=L.c.Serialize(g);i[g.getClassName()]=n}g.inputsmgr=i}parse(g){const i=g.inputsmgr;if(i){this.clear();for(const g in i){const a=b[g];if(a){const n=i[g],d=L.c.Parse((()=>new a),n,null);this.add(d)}}}else for(const a in this.attached){const i=b[this.attached[a].getClassName()];if(i){const n=L.c.Parse((()=>new i),g,null);this.remove(this.attached[a]),this.add(n)}}}}},14106:(g,i,a)=>{"use strict";a.d(i,{e:()=>v});var n=a(12441),L=a(12447),d=a(12452),b=a(12956),k=a(14111),e=a(12742),N=a(12277);class F{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(g){g=N.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Pg(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((i=>{const a=i.event;if(!a.metaKey)if(i.type===e.d.KEYDOWN){if(-1!==this.keysUp.indexOf(a.keyCode)||-1!==this.keysDown.indexOf(a.keyCode)||-1!==this.keysLeft.indexOf(a.keyCode)||-1!==this.keysRight.indexOf(a.keyCode)||-1!==this.keysUpward.indexOf(a.keyCode)||-1!==this.keysDownward.indexOf(a.keyCode)||-1!==this.keysRotateLeft.indexOf(a.keyCode)||-1!==this.keysRotateRight.indexOf(a.keyCode)||-1!==this.keysRotateUp.indexOf(a.keyCode)||-1!==this.keysRotateDown.indexOf(a.keyCode)){-1===this._keys.indexOf(a.keyCode)&&this._keys.push(a.keyCode),g||a.preventDefault()}}else if(-1!==this.keysUp.indexOf(a.keyCode)||-1!==this.keysDown.indexOf(a.keyCode)||-1!==this.keysLeft.indexOf(a.keyCode)||-1!==this.keysRight.indexOf(a.keyCode)||-1!==this.keysUpward.indexOf(a.keyCode)||-1!==this.keysDownward.indexOf(a.keyCode)||-1!==this.keysRotateLeft.indexOf(a.keyCode)||-1!==this.keysRotateRight.indexOf(a.keyCode)||-1!==this.keysRotateUp.indexOf(a.keyCode)||-1!==this.keysRotateDown.indexOf(a.keyCode)){const i=this._keys.indexOf(a.keyCode);i>=0&&this._keys.splice(i,1),g||a.preventDefault()}})))}Kj(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const g=this.camera;for(let i=0;i<this._keys.length;i++){const a=this._keys[i],n=g._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(a)?g._localDirection.sd(-n,0,0):-1!==this.keysUp.indexOf(a)?g._localDirection.sd(0,0,n):-1!==this.keysRight.indexOf(a)?g._localDirection.sd(n,0,0):-1!==this.keysDown.indexOf(a)?g._localDirection.sd(0,0,-n):-1!==this.keysUpward.indexOf(a)?g._localDirection.sd(0,n,0):-1!==this.keysDownward.indexOf(a)?g._localDirection.sd(0,-n,0):-1!==this.keysRotateLeft.indexOf(a)?(g._localDirection.sd(0,0,0),g.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(a)?(g._localDirection.sd(0,0,0),g.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(a)?(g._localDirection.sd(0,0,0),g.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(a)&&(g._localDirection.sd(0,0,0),g.cameraRotation.x+=this._getLocalRotation()),g.Pg().useRightHandedSystem&&(g._localDirection.z*=-1),g.getViewMatrix().invertToRef(g._cameraTransformMatrix),d.Bi.TransformNormalToRef(g._localDirection,g._cameraTransformMatrix,g._transformedDirection),g.cameraDirection.addInPlace(g._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const g=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*g}}(0,n.e)([(0,L.P)()],F.prototype,"keysUp",void 0),(0,n.e)([(0,L.P)()],F.prototype,"keysUpward",void 0),(0,n.e)([(0,L.P)()],F.prototype,"keysDown",void 0),(0,n.e)([(0,L.P)()],F.prototype,"keysDownward",void 0),(0,n.e)([(0,L.P)()],F.prototype,"keysLeft",void 0),(0,n.e)([(0,L.P)()],F.prototype,"keysRight",void 0),(0,n.e)([(0,L.P)()],F.prototype,"rotationSpeed",void 0),(0,n.e)([(0,L.P)()],F.prototype,"keysRotateLeft",void 0),(0,n.e)([(0,L.P)()],F.prototype,"keysRotateRight",void 0),(0,n.e)([(0,L.P)()],F.prototype,"keysRotateUp",void 0),(0,n.e)([(0,L.P)()],F.prototype,"keysRotateDown",void 0),k.b.FreeCameraKeyboardMoveInput=F;var I=a(12286),j=a(12734);class y{constructor(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=g,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new I.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(g){g=N.Tools.BackCompatCameraNoPreventDefault(arguments);const i=this.camera.getEngine(),a=i.getInputElement();this._pointerInput||(this._pointerInput=n=>{const L=n.event,d="touch"===L.pointerType;if(!this.touchEnabled&&d)return;if(n.type!==j.b.POINTERMOVE&&-1===this.buttons.indexOf(L.button))return;const b=L.target;if(n.type===j.b.POINTERDOWN){if(d&&-1!==this._activePointerId||!d&&-1!==this._currentActiveButton)return;this._activePointerId=L.pointerId;try{null===b||void 0===b||b.setPointerCapture(L.pointerId)}catch(k){}-1===this._currentActiveButton&&(this._currentActiveButton=L.button),this._previousPosition={x:L.clientX,y:L.clientY},g||(L.preventDefault(),a&&a.focus()),i.isPointerLock&&this._onMouseMove&&this._onMouseMove(n.event)}else if(n.type===j.b.POINTERUP){if(d&&this._activePointerId!==L.pointerId||!d&&this._currentActiveButton!==L.button)return;try{null===b||void 0===b||b.releasePointerCapture(L.pointerId)}catch(k){}this._currentActiveButton=-1,this._previousPosition=null,g||L.preventDefault(),this._activePointerId=-1}else if(n.type===j.b.POINTERMOVE&&(this._activePointerId===L.pointerId||!d))if(i.isPointerLock&&this._onMouseMove)this._onMouseMove(n.event);else if(this._previousPosition){const i=this.camera._calculateHandednessMultiplier(),a=(L.clientX-this._previousPosition.x)*i,n=L.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=a/this.angularSensibility,this.camera.cameraRotation.x+=n/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:a,offsetY:n}),this._previousPosition={x:L.clientX,y:L.clientY},g||L.preventDefault()}}),this._onMouseMove=a=>{if(!i.isPointerLock)return;const n=this.camera._calculateHandednessMultiplier(),L=a.movementX*n;this.camera.cameraRotation.y+=L/this.angularSensibility;const d=a.movementY;this.camera.cameraRotation.x+=d/this.angularSensibility,this._previousPosition=null,g||a.preventDefault()},this._observer=this.camera.Pg()._inputManager._addCameraPointerObserver(this._pointerInput,j.b.POINTERDOWN|j.b.POINTERUP|j.b.POINTERMOVE),a&&(this._contextMenuBind=g=>this.onContextMenu(g),a.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(g){g.preventDefault()}Kj(){if(this._observer){if(this.camera.Pg()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const g=this.camera.getEngine().getInputElement();g&&g.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,n.e)([(0,L.P)()],y.prototype,"buttons",void 0),(0,n.e)([(0,L.P)()],y.prototype,"angularSensibility",void 0),k.b.FreeCameraMouseInput=y;var B,c=a(12751);class D{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new I.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(g){g=N.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=i=>{if(i.type!==j.b.POINTERWHEEL)return;const a=i.event,n=a.deltaMode===c.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*n*a.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*n*a.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*n*a.deltaZ/this._normalize,a.preventDefault&&(g||a.preventDefault())},this._observer=this.camera.Pg()._inputManager._addCameraPointerObserver(this._wheel,j.b.POINTERWHEEL)}Kj(){this._observer&&(this.camera.Pg()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,n.e)([(0,L.P)()],D.prototype,"wheelPrecisionX",void 0),(0,n.e)([(0,L.P)()],D.prototype,"wheelPrecisionY",void 0),(0,n.e)([(0,L.P)()],D.prototype,"wheelPrecisionZ",void 0),function(g){g[g.MoveRelative=0]="MoveRelative",g[g.RotateRelative=1]="RotateRelative",g[g.MoveScene=2]="MoveScene"}(B||(B={}));class p extends D{constructor(){super(...arguments),this._moveRelative=d.Bi.Zero(),this._rotateRelative=d.Bi.Zero(),this._moveScene=d.Bi.Zero(),this._wheelXAction=B.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=B.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(g){null===g&&this._wheelXAction!==B.MoveRelative||(this._wheelXAction=B.MoveRelative,this._wheelXActionCoordinate=g)}get wheelXMoveRelative(){return this._wheelXAction!==B.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(g){null===g&&this._wheelYAction!==B.MoveRelative||(this._wheelYAction=B.MoveRelative,this._wheelYActionCoordinate=g)}get wheelYMoveRelative(){return this._wheelYAction!==B.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(g){null===g&&this._wheelZAction!==B.MoveRelative||(this._wheelZAction=B.MoveRelative,this._wheelZActionCoordinate=g)}get wheelZMoveRelative(){return this._wheelZAction!==B.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(g){null===g&&this._wheelXAction!==B.RotateRelative||(this._wheelXAction=B.RotateRelative,this._wheelXActionCoordinate=g)}get wheelXRotateRelative(){return this._wheelXAction!==B.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(g){null===g&&this._wheelYAction!==B.RotateRelative||(this._wheelYAction=B.RotateRelative,this._wheelYActionCoordinate=g)}get wheelYRotateRelative(){return this._wheelYAction!==B.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(g){null===g&&this._wheelZAction!==B.RotateRelative||(this._wheelZAction=B.RotateRelative,this._wheelZActionCoordinate=g)}get wheelZRotateRelative(){return this._wheelZAction!==B.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(g){null===g&&this._wheelXAction!==B.MoveScene||(this._wheelXAction=B.MoveScene,this._wheelXActionCoordinate=g)}get wheelXMoveScene(){return this._wheelXAction!==B.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(g){null===g&&this._wheelYAction!==B.MoveScene||(this._wheelYAction=B.MoveScene,this._wheelYActionCoordinate=g)}get wheelYMoveScene(){return this._wheelYAction!==B.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(g){null===g&&this._wheelZAction!==B.MoveScene||(this._wheelZAction=B.MoveScene,this._wheelZActionCoordinate=g)}get wheelZMoveScene(){return this._wheelZAction!==B.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Qd(0),this._rotateRelative.Qd(0),this._moveScene.Qd(0),this._updateCamera(),this.camera.Pg().useRightHandedSystem&&(this._moveRelative.z*=-1);const g=d.Matrix.Zero();this.camera.getViewMatrix().invertToRef(g);const i=d.Bi.Zero();d.Bi.TransformNormalToRef(this._moveRelative,g,i),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(i),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(g,i,a){if(0===g)return;if(null===i||null===a)return;let n=null;switch(i){case B.MoveRelative:n=this._moveRelative;break;case B.RotateRelative:n=this._rotateRelative;break;case B.MoveScene:n=this._moveScene}switch(a){case 0:n.set(g,0,0);break;case 1:n.set(0,g,0);break;case 2:n.set(0,0,g)}}}(0,n.e)([(0,L.P)()],p.prototype,"wheelXMoveRelative",null),(0,n.e)([(0,L.P)()],p.prototype,"wheelYMoveRelative",null),(0,n.e)([(0,L.P)()],p.prototype,"wheelZMoveRelative",null),(0,n.e)([(0,L.P)()],p.prototype,"wheelXRotateRelative",null),(0,n.e)([(0,L.P)()],p.prototype,"wheelYRotateRelative",null),(0,n.e)([(0,L.P)()],p.prototype,"wheelZRotateRelative",null),(0,n.e)([(0,L.P)()],p.prototype,"wheelXMoveScene",null),(0,n.e)([(0,L.P)()],p.prototype,"wheelYMoveScene",null),(0,n.e)([(0,L.P)()],p.prototype,"wheelZMoveScene",null),k.b.FreeCameraMouseWheelInput=p;class R{constructor(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=g,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=N.Tools.IsSafari()}attachControl(g){g=N.Tools.BackCompatCameraNoPreventDefault(arguments);let i=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=a=>{const n=a.event,L="mouse"===n.pointerType||this._isSafari&&"undefined"===typeof n.pointerType;if(this.allowMouse||!L)if(a.type===j.b.POINTERDOWN){if(g||n.preventDefault(),this._pointerPressed.push(n.pointerId),1!==this._pointerPressed.length)return;i={x:n.clientX,y:n.clientY}}else if(a.type===j.b.POINTERUP){g||n.preventDefault();const a=this._pointerPressed.indexOf(n.pointerId);if(-1===a)return;if(this._pointerPressed.splice(a,1),0!=a)return;i=null,this._offsetX=null,this._offsetY=null}else if(a.type===j.b.POINTERMOVE){if(g||n.preventDefault(),!i)return;if(0!=this._pointerPressed.indexOf(n.pointerId))return;this._offsetX=n.clientX-i.x,this._offsetY=-(n.clientY-i.y)}}),this._observer=this.camera.Pg()._inputManager._addCameraPointerObserver(this._pointerInput,j.b.POINTERDOWN|j.b.POINTERUP|j.b.POINTERMOVE),this._onLostFocus){const g=this.camera.getEngine().getInputElement();g&&g.addEventListener("blur",this._onLostFocus)}}Kj(){if(this._pointerInput){if(this._observer&&(this.camera.Pg()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const g=this.camera.getEngine().getInputElement();g&&g.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const g=this.camera,i=g._calculateHandednessMultiplier();g.cameraRotation.y=i*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)g.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const i=g._computeLocalCameraSpeed(),a=new d.Bi(0,0,0!==this.touchMoveSensibility?i*this._offsetY/this.touchMoveSensibility:0);d.Matrix.RotationYawPitchRollToRef(g.rotation.y,g.rotation.x,0,g._cameraRotationMatrix),g.cameraDirection.addInPlace(d.Bi.TransformCoordinates(a,g._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,n.e)([(0,L.P)()],R.prototype,"touchAngularSensibility",void 0),(0,n.e)([(0,L.P)()],R.prototype,"touchMoveSensibility",void 0),k.b.FreeCameraTouchInput=R;class x extends k.d{constructor(g){super(g),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new F),this}addMouse(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new y(g),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new p,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new R),this}clear(){super.clear(),this._mouseInput=null}}var E=a(12415),X=a(12354);class v extends b.c{get angularSensibility(){const g=this.inputs.attached.mouse;return g?g.angularSensibility:0}set angularSensibility(g){const i=this.inputs.attached.mouse;i&&(i.angularSensibility=g)}get keysUp(){const g=this.inputs.attached.keyboard;return g?g.keysUp:[]}set keysUp(g){const i=this.inputs.attached.keyboard;i&&(i.keysUp=g)}get keysUpward(){const g=this.inputs.attached.keyboard;return g?g.keysUpward:[]}set keysUpward(g){const i=this.inputs.attached.keyboard;i&&(i.keysUpward=g)}get keysDown(){const g=this.inputs.attached.keyboard;return g?g.keysDown:[]}set keysDown(g){const i=this.inputs.attached.keyboard;i&&(i.keysDown=g)}get keysDownward(){const g=this.inputs.attached.keyboard;return g?g.keysDownward:[]}set keysDownward(g){const i=this.inputs.attached.keyboard;i&&(i.keysDownward=g)}get keysLeft(){const g=this.inputs.attached.keyboard;return g?g.keysLeft:[]}set keysLeft(g){const i=this.inputs.attached.keyboard;i&&(i.keysLeft=g)}get keysRight(){const g=this.inputs.attached.keyboard;return g?g.keysRight:[]}set keysRight(g){const i=this.inputs.attached.keyboard;i&&(i.keysRight=g)}get keysRotateLeft(){const g=this.inputs.attached.keyboard;return g?g.keysRotateLeft:[]}set keysRotateLeft(g){const i=this.inputs.attached.keyboard;i&&(i.keysRotateLeft=g)}get keysRotateRight(){const g=this.inputs.attached.keyboard;return g?g.keysRotateRight:[]}set keysRotateRight(g){const i=this.inputs.attached.keyboard;i&&(i.keysRotateRight=g)}get keysRotateUp(){const g=this.inputs.attached.keyboard;return g?g.keysRotateUp:[]}set keysRotateUp(g){const i=this.inputs.attached.keyboard;i&&(i.keysRotateUp=g)}get keysRotateDown(){const g=this.inputs.attached.keyboard;return g?g.keysRotateDown:[]}set keysRotateDown(g){const i=this.inputs.attached.keyboard;i&&(i.keysRotateDown=g)}constructor(g,i,a){var n;super(g,i,a,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),n=this,this.ellipsoid=new d.Bi(.5,1,.5),this.ellipsoidOffset=new d.Bi(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=d.Bi.Zero(),this._diffPosition=d.Bi.Zero(),this._newPosition=d.Bi.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n._newPosition.I(i),n._newPosition.subtractToRef(n._oldPosition,n._diffPosition),n._diffPosition.length()>X.d.CollisionsEpsilon&&(n.position.addToRef(n._diffPosition,n._deferredPositionUpdate),n._deferOnly?n._deferredUpdated=!0:n.position.I(n._deferredPositionUpdate),n.xB&&a&&n.xB(a))},this.inputs=new x(this),this.inputs.addKeyboard().addMouse()}attachControl(g,i){i=N.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(i)}Kj(){this.inputs.detachElement(),this.cameraDirection=new d.Bi(0,0,0),this.cameraRotation=new d.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(g){this._collisionMask=isNaN(g)?-1:g}_collideWithWorld(g){let i;i=this.parent?d.Bi.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,i.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const a=this.Pg().collisionCoordinator;this._collider||(this._collider=a.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let n=g;this.applyGravity&&(n=g.add(this.Pg().gravity)),a.getNewPosition(this._oldPosition,n,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=d.Bi.Zero(),this._transformedDirection=d.Bi.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(g){this._needMoveForGravity=g}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Pg().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"eb"}}(0,n.e)([(0,L.M)()],v.prototype,"ellipsoid",void 0),(0,n.e)([(0,L.M)()],v.prototype,"ellipsoidOffset",void 0),(0,n.e)([(0,L.P)()],v.prototype,"checkCollisions",void 0),(0,n.e)([(0,L.P)()],v.prototype,"applyGravity",void 0),(0,E.e)("BABYLON.FreeCamera",v)},14752:(g,i,a)=>{"use strict";a.d(i,{b:()=>d});var n=a(12541),L=a(14759);class d{constructor(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=a,this.WI=[],this._maxBlockCapacity=i||64,this._selectionContent=new n.d(1024),this._creationFunc=g}update(g,i,a){L.c._CreateBlocks(g,i,a,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}nI(g){for(let i=0;i<this.cI.length;i++){this.cI[i].addEntry(g)}}aI(g){for(let i=0;i<this.cI.length;i++){this.cI[i].removeEntry(g)}}select(g,i){this._selectionContent.reset();for(let a=0;a<this.cI.length;a++){this.cI[a].select(g,this._selectionContent,i)}return i?this._selectionContent.concat(this.WI):this._selectionContent.concatWithNoDuplicate(this.WI),this._selectionContent}intersects(g,i,a){this._selectionContent.reset();for(let n=0;n<this.cI.length;n++){this.cI[n].intersects(g,i,this._selectionContent,a)}return a?this._selectionContent.concat(this.WI):this._selectionContent.concatWithNoDuplicate(this.WI),this._selectionContent}intersectsRay(g){this._selectionContent.reset();for(let i=0;i<this.cI.length;i++){this.cI[i].intersectsRay(g,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.WI),this._selectionContent}}d.CreationFuncForMeshes=(g,i)=>{const a=g.getBoundingInfo();!g.isBlocked&&a.boundingBox.intersectsMinMax(i.aj,i.nj)&&i.entries.push(g)},d.CreationFuncForSubMeshes=(g,i)=>{g.getBoundingInfo().boundingBox.intersectsMinMax(i.aj,i.nj)&&i.entries.push(g)}},14759:(g,i,a)=>{"use strict";a.d(i,{c:()=>d});var n=a(12452),L=a(12800);class d{constructor(g,i,a,n,L,d){this.entries=[],this.Lj=new Array,this._capacity=a,this._depth=n,this._maxDepth=L,this._creationFunc=d,this._minPoint=g,this._maxPoint=i,this.Lj.push(g.clone()),this.Lj.push(i.clone()),this.Lj.push(g.clone()),this.Lj[2].x=i.x,this.Lj.push(g.clone()),this.Lj[3].y=i.y,this.Lj.push(g.clone()),this.Lj[4].z=i.z,this.Lj.push(i.clone()),this.Lj[5].z=g.z,this.Lj.push(i.clone()),this.Lj[6].x=g.x,this.Lj.push(i.clone()),this.Lj[7].y=g.y}get Hk(){return this._capacity}get aj(){return this._minPoint}get nj(){return this._maxPoint}addEntry(g){if(this.cI)for(let i=0;i<this.cI.length;i++){this.cI[i].addEntry(g)}else this._creationFunc(g,this),this.entries.length>this.Hk&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(g){if(this.cI){for(let i=0;i<this.cI.length;i++){this.cI[i].removeEntry(g)}return}const i=this.entries.indexOf(g);i>-1&&this.entries.splice(i,1)}addEntries(g){for(let i=0;i<g.length;i++){const a=g[i];this.addEntry(a)}}select(g,i,a){if(L.b.IsInFrustum(this.Lj,g)){if(this.cI){for(let n=0;n<this.cI.length;n++){this.cI[n].select(g,i,a)}return}a?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}}intersects(g,i,a,n){if(L.b.IntersectsSphere(this._minPoint,this._maxPoint,g,i)){if(this.cI){for(let L=0;L<this.cI.length;L++){this.cI[L].intersects(g,i,a,n)}return}n?a.concat(this.entries):a.concatWithNoDuplicate(this.entries)}}intersectsRay(g,i){if(g.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.cI){for(let a=0;a<this.cI.length;a++){this.cI[a].intersectsRay(g,i)}return}i.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){d._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(g,i,a,L,b,k,e,N){e.cI=new Array;const F=new n.Bi((i.x-g.x)/2,(i.y-g.y)/2,(i.z-g.z)/2);for(let n=0;n<2;n++)for(let i=0;i<2;i++)for(let I=0;I<2;I++){const j=g.add(F.multiplyByFloats(n,i,I)),y=g.add(F.multiplyByFloats(n+1,i+1,I+1)),B=new d(j,y,L,b+1,k,N);B.addEntries(a),e.cI.push(B)}}}},14765:(g,i,a)=>{"use strict";a.d(i,{d:()=>F});var n=a(12692),L=a(12452),d=a(12894),b=a(13853),k=a(12731),e=a(14752),N=a(12316);n.e.prototype.createOrUpdateSelectionOctree=function(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=this._getComponent(k.b.NAME_OCTREE);a||(a=new F(this),this.ad(a)),this.MI||(this.MI=new e.b(e.b.CreationFuncForMeshes,g,i));const n=this.getWorldExtends();return this.MI.update(n.min,n.max,this.meshes),this.MI},Object.defineProperty(n.e.prototype,"selectionOctree",{get:function(){return this.MI},enumerable:!0,configurable:!0}),d.d.prototype.createOrUpdateSubmeshesOctree=function(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const a=this.Pg();let n=a._getComponent(k.b.NAME_OCTREE);n||(n=new F(a),a.ad(n)),this._submeshesOctree||(this._submeshesOctree=new e.b(e.b.CreationFuncForSubMeshes,g,i)),this.Zd(!0);const L=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(L.minimumWorld,L.maximumWorld,this.Yd),this._submeshesOctree};class F{constructor(g){this.name=k.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new b.c(L.Bi.Zero(),new L.Bi(1,1,1)),(g=g||N.c.LastCreatedScene)&&(this.Di=g,this.Di.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Di.getActiveSubMeshCandidates=g=>this.getActiveSubMeshCandidates(g),this.Di.getCollidingSubMeshCandidates=(g,i)=>this.getCollidingSubMeshCandidates(g,i),this.Di.getIntersectingSubMeshCandidates=(g,i)=>this.getIntersectingSubMeshCandidates(g,i))}register(){this.Di.onMeshRemovedObservable.add((g=>{const i=this.Di.selectionOctree;if(void 0!==i&&null!==i){const a=i.WI.indexOf(g);-1!==a&&i.WI.splice(a,1)}})),this.Di.onMeshImportedObservable.add((g=>{const i=this.Di.selectionOctree;void 0!==i&&null!==i&&i.nI(g)}))}getActiveMeshCandidates(){var g;return(null===(g=this.Di.MI)||void 0===g?void 0:g.select(this.Di.frustumPlanes))||this.Di._getDefaultMeshCandidates()}getActiveSubMeshCandidates(g){if(g._submeshesOctree&&g.useOctreeForRenderingSelection){return g._submeshesOctree.select(this.Di.frustumPlanes)}return this.Di._getDefaultSubMeshCandidates(g)}getIntersectingSubMeshCandidates(g,i){if(g._submeshesOctree&&g.useOctreeForPicking){b.c.TransformToRef(i,g.getWorldMatrix(),this._tempRay);return g._submeshesOctree.intersectsRay(this._tempRay)}return this.Di._getDefaultSubMeshCandidates(g)}getCollidingSubMeshCandidates(g,i){if(g._submeshesOctree&&g.useOctreeForCollisions){const a=i._velocityWorldLength+Math.max(i._radius.x,i._radius.y,i._radius.z);return g._submeshesOctree.intersects(i._basePointWorld,a)}return this.Di._getDefaultSubMeshCandidates(g)}rebuild(){}dispose(){}}},13853:(g,i,a)=>{"use strict";a.d(i,{c:()=>y});var n=a(12692),L=a(12916),d=a(12454),b=a(12452),k=a(12462),e=a(12789),N=a(12728),F=a(12316),I=a(12754);const j={internalPickerForMesh:void 0};class y{constructor(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.b;this.origin=g,this.direction=i,this.length=a,this.epsilon=n}clone(){return new y(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=y._TmpVector3[0].sd(g.x-a,g.y-a,g.z-a),L=y._TmpVector3[1].sd(i.x+a,i.y+a,i.z+a);let d,b,k,e,N=0,F=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<n.x||this.origin.x>L.x)return!1}else if(d=1/this.direction.x,b=(n.x-this.origin.x)*d,k=(L.x-this.origin.x)*d,k===-1/0&&(k=1/0),b>k&&(e=b,b=k,k=e),N=Math.max(b,N),F=Math.min(k,F),N>F)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<n.y||this.origin.y>L.y)return!1}else if(d=1/this.direction.y,b=(n.y-this.origin.y)*d,k=(L.y-this.origin.y)*d,k===-1/0&&(k=1/0),b>k&&(e=b,b=k,k=e),N=Math.max(b,N),F=Math.min(k,F),N>F)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<n.z||this.origin.z>L.z)return!1}else if(d=1/this.direction.z,b=(n.z-this.origin.z)*d,k=(L.z-this.origin.z)*d,k===-1/0&&(k=1/0),b>k&&(e=b,b=k,k=e),N=Math.max(b,N),F=Math.min(k,F),N>F)return!1;return!0}intersectsBox(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(g.minimum,g.maximum,i)}intersectsSphere(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=g.center.x-this.origin.x,n=g.center.y-this.origin.y,L=g.center.z-this.origin.z,d=a*a+n*n+L*L,b=g.radius+i,k=b*b;if(d<=k)return!0;const e=a*this.direction.x+n*this.direction.y+L*this.direction.z;if(e<0)return!1;return d-e*e<=k}intersectsTriangle(g,i,a){const n=y._TmpVector3[0],L=y._TmpVector3[1],d=y._TmpVector3[2],k=y._TmpVector3[3],N=y._TmpVector3[4];i.subtractToRef(g,n),a.subtractToRef(g,L),b.Bi.CrossToRef(this.direction,L,d);const F=b.Bi.Dot(n,d);if(0===F)return null;const I=1/F;this.origin.subtractToRef(g,k);const j=b.Bi.Dot(k,d)*I;if(j<-this.epsilon||j>1+this.epsilon)return null;b.Bi.CrossToRef(k,n,N);const B=b.Bi.Dot(this.direction,N)*I;if(B<-this.epsilon||j+B>1+this.epsilon)return null;const c=b.Bi.Dot(L,N)*I;return c>this.length?null:new e.d(1-j-B,j,c)}intersectsPlane(g){let i;const a=b.Bi.Dot(g.normal,this.direction);if(Math.abs(a)<9.99999997475243e-7)return null;{const n=b.Bi.Dot(g.normal,this.origin);return i=(-g.d-n)/a,i<0?i<-9.99999997475243e-7?null:0:i}}intersectsAxis(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(g){case"y":{const g=(this.origin.y-i)/this.direction.y;return g>0?null:new b.Bi(this.origin.x+this.direction.x*-g,i,this.origin.z+this.direction.z*-g)}case"x":{const g=(this.origin.x-i)/this.direction.x;return g>0?null:new b.Bi(i,this.origin.y+this.direction.y*-g,this.origin.z+this.direction.z*-g)}case"z":{const g=(this.origin.z-i)/this.direction.z;return g>0?null:new b.Bi(this.origin.x+this.direction.x*-g,this.origin.y+this.direction.y*-g,i)}default:return null}}intersectsMesh(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const k=b.TmpVectors.Matrix[0];return g.getWorldMatrix().invertToRef(k),this._tmpRay?y.TransformToRef(this,k,this._tmpRay):this._tmpRay=y.Transform(this,k),g.intersects(this._tmpRay,i,a,n,L,d)}intersectsMeshes(g,i,a){a?a.length=0:a=[];for(let n=0;n<g.length;n++){const L=this.intersectsMesh(g[n],i);L.hit&&a.push(L)}return a.sort(this._comparePickingInfo),a}_comparePickingInfo(g,i){return g.distance<i.distance?-1:g.distance>i.distance?1:0}intersectionSegment(g,i,a){const n=this.origin,L=b.TmpVectors.Bi[0],d=b.TmpVectors.Bi[1],k=b.TmpVectors.Bi[2],e=b.TmpVectors.Bi[3];i.subtractToRef(g,L),this.direction.scaleToRef(y._Rayl,k),n.addToRef(k,d),g.subtractToRef(n,e);const N=b.Bi.Dot(L,L),F=b.Bi.Dot(L,k),I=b.Bi.Dot(k,k),j=b.Bi.Dot(L,e),B=b.Bi.Dot(k,e),c=N*I-F*F;let D,p,R=c,x=c;c<y._Smallnum?(D=0,R=1,p=B,x=I):(D=F*B-I*j,p=N*B-F*j,D<0?(D=0,p=B,x=I):D>R&&(D=R,p=B+F,x=I)),p<0?(p=0,-j<0?D=0:-j>N?D=R:(D=-j,R=N)):p>x&&(p=x,-j+F<0?D=0:-j+F>N?D=R:(D=-j+F,R=N));const E=Math.abs(D)<y._Smallnum?0:D/R,X=Math.abs(p)<y._Smallnum?0:p/x,v=b.TmpVectors.Bi[4];k.scaleToRef(X,v);const P=b.TmpVectors.Bi[5];L.scaleToRef(E,P),P.addInPlace(e);const Y=b.TmpVectors.Bi[6];P.subtractToRef(v,Y);return X>0&&X<=this.length&&Y.lengthSquared()<a*a?P.length():-1}update(g,i,a,n,L,d,k){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){y._RayDistant||(y._RayDistant=y.Zero()),y._RayDistant.unprojectRayToRef(g,i,a,n,b.Matrix.IdentityReadOnly,d,k);const e=b.TmpVectors.Matrix[0];L.invertToRef(e),y.TransformToRef(y._RayDistant,e,this)}else this.unprojectRayToRef(g,i,a,n,L,d,k);return this}static Zero(){return new y(b.Bi.Zero(),b.Bi.Zero())}static CreateNew(g,i,a,n,L,d,b){return y.Zero().update(g,i,a,n,L,d,b)}static CreateNewFromTo(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.Matrix.IdentityReadOnly;const n=new y(new b.Bi(0,0,0),new b.Bi(0,0,0));return y.CreateFromToToRef(g,i,n,a)}static CreateFromToToRef(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b.Matrix.IdentityReadOnly;a.origin.I(g);const L=i.subtractToRef(g,a.direction),d=Math.sqrt(L.x*L.x+L.y*L.y+L.z*L.z);return a.length=d,a.direction.normalize(),y.TransformToRef(a,n,a)}static Transform(g,i){const a=new y(new b.Bi(0,0,0),new b.Bi(0,0,0));return y.TransformToRef(g,i,a),a}static TransformToRef(g,i,a){b.Bi.TransformCoordinatesToRef(g.origin,i,a.origin),b.Bi.TransformNormalToRef(g.direction,i,a.direction),a.length=g.length,a.epsilon=g.epsilon;const n=a.direction,L=n.length();if(0!==L&&1!==L){const g=1/L;n.x*=g,n.y*=g,n.z*=g,a.length*=L}return a}unprojectRayToRef(g,i,a,n,L,d,k){const e=b.TmpVectors.Matrix[0];L.multiplyToRef(d,e),e.multiplyToRef(k,e),e.invert();const N=F.c.LastCreatedEngine,I=b.TmpVectors.Bi[0];I.x=g/a*2-1,I.y=-(i/n*2-1),I.z=null!==N&&void 0!==N&&N.o?1:null!==N&&void 0!==N&&N.isNDCHalfZRange?0:-1;const j=b.TmpVectors.Bi[1].sd(I.x,I.y,1-1e-8),y=b.TmpVectors.Bi[2],B=b.TmpVectors.Bi[3];b.Bi._UnprojectFromInvertedMatrixToRef(I,e,y),b.Bi._UnprojectFromInvertedMatrixToRef(j,e,B),this.origin.I(y),B.subtractToRef(y,this.direction),this.direction.normalize()}}function B(g,i,a,n,L){let d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const b=y.Zero();return c(g,i,a,n,b,L,d),b}function c(g,i,a,n,L,d){let k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const N=g.getEngine();if(!d&&!(d=g.activeCamera))return g;const F=d.viewport,I=N.getRenderHeight(),{x:j,y:y,width:B,height:c}=F.toGlobal(N.getRenderWidth(),I),D=1/N.getHardwareScalingLevel();return i=i*D-j,a=a*D-(I-y-c),L.update(i,a,B,c,n||b.Matrix.IdentityReadOnly,k?b.Matrix.IdentityReadOnly:d.getViewMatrix(),d.getProjectionMatrix(),e),g}function D(g,i,a,n,L){if(!N.b)return g;const d=g.getEngine();if(!L&&!(L=g.activeCamera))throw new Error("Active camera not set");const k=L.viewport,e=d.getRenderHeight(),{x:F,y:I,width:j,height:y}=k.toGlobal(d.getRenderWidth(),e),B=b.Matrix.Identity(),c=1/d.getHardwareScalingLevel();return i=i*c-F,a=a*c-(e-I-y),n.update(i,a,j,y,B,B,L.getProjectionMatrix()),g}function p(g,i,a,n,L,d,b,k){const e=i(n,a.enableDistantPicking),N=a.intersects(e,L,b,d,n,k);return N&&N.hit?!L&&null!=g&&N.distance>=g.distance?null:N:null}function R(g,i,a,n,L,d){let k=null;const e=!!(g.activeCameras&&g.activeCameras.length>1&&g.cameraToUseForPointers!==g.activeCamera),F=g.cameraToUseForPointers||g.activeCamera,I=j.internalPickerForMesh||p;for(let N=0;N<g.meshes.length;N++){const j=g.meshes[N];if(a){if(!a(j,-1))continue}else if(!j.isEnabled()||!j.isVisible||!j.zN)continue;const y=e&&j.isWorldMatrixCameraDependent(),B=j.Zd(y,F);if(j.hasThinInstances&&j.xF){const g=I(k,i,j,B,!0,!0,d);if(g){if(L)return g;const e=b.TmpVectors.Matrix[1],N=j.thinInstanceGetWorldMatrices();for(let g=0;g<N.length;g++){if(a&&!a(j,g))continue;N[g].multiplyToRef(B,e);const b=I(k,i,j,e,n,L,d,!0);if(b&&(k=b,k.thinInstanceIndex=g,n))return k}}}else{const g=I(k,i,j,B,n,L,d);if(g&&(k=g,n))return k}}return k||new N.b}function x(g,i,a,n){if(!N.b)return null;const L=[],d=!!(g.activeCameras&&g.activeCameras.length>1&&g.cameraToUseForPointers!==g.activeCamera),k=g.cameraToUseForPointers||g.activeCamera,e=j.internalPickerForMesh||p;for(let N=0;N<g.meshes.length;N++){const F=g.meshes[N];if(a){if(!a(F,-1))continue}else if(!F.isEnabled()||!F.isVisible||!F.zN)continue;const I=d&&F.isWorldMatrixCameraDependent(),j=F.Zd(I,k);if(F.hasThinInstances&&F.xF){if(e(null,i,F,j,!0,!0,n)){const g=b.TmpVectors.Matrix[1],d=F.thinInstanceGetWorldMatrices();for(let b=0;b<d.length;b++){if(a&&!a(F,b))continue;d[b].multiplyToRef(j,g);const k=e(null,i,F,g,!1,!1,n,!0);k&&(k.thinInstanceIndex=b,L.push(k))}}}else{const g=e(null,i,F,j,!1,!1,n);g&&L.push(g)}}return L}function E(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0;n||(n=g.getWorldMatrix()),i.length=a,L?i.origin.I(L):i.origin.I(g.position);const d=b.TmpVectors.Bi[2];d.set(0,0,g._scene.useRightHandedSystem?-1:1);const k=b.TmpVectors.Bi[3];return b.Bi.TransformNormalToRef(d,n,k),b.Bi.NormalizeToRef(k,i.direction),i}var X,v;y._TmpVector3=(0,k.d)(6,b.Bi.Zero),y._RayDistant=y.Zero(),y._Smallnum=1e-8,y._Rayl=1e9,X=n.e,(v=L.b)&&(v.prototype.getForwardRay=function(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return E(this,new y(b.Bi.Zero(),b.Bi.Zero(),g),g,i,a)},v.prototype.getForwardRayToRef=function(g){return E(this,g,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),X&&(I.b._IsPickingAvailable=!0,X.prototype.createPickingRay=function(g,i,a,n){return B(this,g,i,a,n,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),n.e.prototype.createPickingRayToRef=function(g,i,a,n,L){return c(this,g,i,a,n,L,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},n.e.prototype.createPickingRayInCameraSpace=function(g,i,a){return function(g,i,a,n){const L=y.Zero();return D(g,i,a,L,n),L}(this,g,i,a)},n.e.prototype.createPickingRayInCameraSpaceToRef=function(g,i,a,n){return D(this,g,i,a,n)},n.e.prototype.pickWithBoundingInfo=function(g,i,a,n,L){return function(g,i,a,n,L,d){if(!N.b)return null;const k=R(g,(n=>(g._tempPickingRay||(g._tempPickingRay=y.Zero()),c(g,i,a,n,g._tempPickingRay,d||null),g._tempPickingRay)),n,L,!0);return k&&(k.ray=B(g,i,a,b.Matrix.Identity(),d||null)),k}(this,g,i,a,n,L)},n.e.prototype.ja=function(g,i,a,n,L,d){return function(g,i,a,n,L,d,k){const e=R(g,((n,L)=>(g._tempPickingRay||(g._tempPickingRay=y.Zero()),c(g,i,a,n,g._tempPickingRay,d||null,!1,L),g._tempPickingRay)),n,L,!1,k);return e&&(e.ray=B(g,i,a,b.Matrix.Identity(),d||null)),e}(this,g,i,a,n,L,d)},n.e.prototype.pickWithRay=function(g,i,a,n){return function(g,i,a,n,L){const d=R(g,(a=>(g._pickWithRayInverseMatrix||(g._pickWithRayInverseMatrix=b.Matrix.Identity()),a.invertToRef(g._pickWithRayInverseMatrix),g._cachedRayForTransform||(g._cachedRayForTransform=y.Zero()),y.TransformToRef(i,g._pickWithRayInverseMatrix,g._cachedRayForTransform),g._cachedRayForTransform)),a,n,!1,L);return d&&(d.ray=i),d}(this,g,i,a,n)},n.e.prototype.multiPick=function(g,i,a,n,L){return function(g,i,a,n,L,d){return x(g,(n=>B(g,i,a,n,L||null)),n,d)}(this,g,i,a,n,L)},n.e.prototype.multiPickWithRay=function(g,i,a){return function(g,i,a,n){return x(g,(a=>(g._pickWithRayInverseMatrix||(g._pickWithRayInverseMatrix=b.Matrix.Identity()),a.invertToRef(g._pickWithRayInverseMatrix),g._cachedRayForTransform||(g._cachedRayForTransform=y.Zero()),y.TransformToRef(i,g._pickWithRayInverseMatrix,g._cachedRayForTransform),g._cachedRayForTransform)),a,n)}(this,g,i,a)}},14175:(g,i,a)=>{"use strict";var n=a(12392),L=a(12292),d=a(12324),b=a(12422),k=a(12354),e=a(12403);k.d.prototype._partialLoadFile=function(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(g,(g=>{a[i]=g,a._internalCount++,6===a._internalCount&&n(a)}),void 0,void 0,!0,((g,i)=>{L&&g&&L(g.status+" "+g.statusText,i)}))},k.d.prototype._cascadeLoadFiles=function(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const L=[];L._internalCount=0;for(let d=0;d<6;d++)this._partialLoadFile(a[d],d,L,i,n)},k.d.prototype._cascadeLoadImgs=function(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5?arguments[5]:void 0;const b=[];b._internalCount=0;for(let k=0;k<6;k++)this._partialLoadImg(n[k],k,b,g,i,a,L,d)},k.d.prototype._partialLoadImg=function(g,i,a,n,L,k){let e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7?arguments[7]:void 0;const F=(0,b.d)();(0,d.m)(g,(g=>{a[i]=g,a._internalCount++,n&&n.removePendingData(F),6===a._internalCount&&k&&k(L,a)}),((g,i)=>{n&&n.removePendingData(F),e&&e(g,i)}),n?n.offlineProvider:null,N),n&&n.addPendingData(F)},k.d.prototype.createCubeTextureBase=function(g,i,a,d){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6?arguments[6]:void 0,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,I=arguments.length>8&&void 0!==arguments[8]&&arguments[8],j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,D=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,p=arguments.length>14&&void 0!==arguments[14]&&arguments[14],R=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const x=B||new n.d(this,7);x.isCube=!0,x.url=g,x.generateMipMaps=!d,x._lodGenerationScale=j,x._lodGenerationOffset=y,x._useSRGBBuffer=!!p&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!d),x!==B&&(x.label=g.substring(0,60)),this._doNotHandleContextLost||(x._extension=F,x._files=a,x._buffer=R);const E=g;this._transformTextureUrl&&!B&&(g=this._transformTextureUrl(g));const X=F??function(g){const i=g.split("?")[0],a=i.lastIndexOf(".");return a>-1?i.substring(a).toLowerCase():""}(g),v=(0,e.c)(X),P=(g,i)=>{x.dispose(),k?k(g,i):g&&L.b.Warn(g)},Y=(n,k)=>{g===E?n&&P(n.status+" "+n.statusText,k):(L.b.Warn(`Failed to load ${g}, falling back to the ${E}`),this.createCubeTextureBase(E,i,a,!!d,b,P,N,F,I,j,y,x,c,D,p,R))};if(v)v.then((n=>{const L=g=>{c&&c(x,g),n.loadCubeData(g,x,I,b,((g,i)=>{P(g,i)}))};R?L(R):a&&6===a.length?n.supportCascades?this._cascadeLoadFiles(i,(g=>L(g.map((g=>new Uint8Array(g))))),a,P):P("Textures type does not support cascades."):this._loadFile(g,(g=>L(new Uint8Array(g))),void 0,void 0,!0,Y)}));else{if(!a||0===a.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(i,x,((g,i)=>{D&&D(g,i)}),a,P)}return this._internalTexturesCache.push(x),x}},14767:(g,i,a)=>{"use strict";a(12292);var n=a(12571);a(12392),a(12531),a(12383),a(12641),a(12587);n.b},14209:(g,i,a)=>{"use strict";a.d(i,{e:()=>L});var n=a(12415);class L{constructor(g){this.value=this._toInt(g)}_toInt(g){return 0|g}add(g){return new L(this.value+g.value)}ci(g){return new L(this.value-g.value)}multiply(g){return new L(Math.imul(this.value,g.value))}divide(g){return new L(this.value/g.value)}getClassName(){return L.ClassName}equals(g){return this.value===g.value}static FromValue(g){return new L(g)}toString(){return this.value.toString()}}L.ClassName="FlowGraphInteger",(0,n.e)("FlowGraphInteger",L)},14221:(g,i,a)=>{"use strict";a.d(i,{d:()=>L,h:()=>d});var n=a(12452);class L{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.kd=g}get m(){return this.kd}transformVector(g){return this.transformVectorToRef(g,new n.Vector2)}transformVectorToRef(g,i){return i.x=g.x*this.kd[0]+g.y*this.kd[1],i.y=g.x*this.kd[2]+g.y*this.kd[3],i}fd(){return this.toArray()}toArray(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let i=0;i<4;i++)g[i]=this.kd[i];return g}ya(g){for(let i=0;i<4;i++)this.kd[i]=g[i];return this}multiplyToRef(g,i){const a=g.kd,n=this.kd,L=i.kd;return L[0]=a[0]*n[0]+a[1]*n[2],L[1]=a[0]*n[1]+a[1]*n[3],L[2]=a[2]*n[0]+a[3]*n[2],L[3]=a[2]*n[1]+a[3]*n[3],i}multiply(g){return this.multiplyToRef(g,new L)}divideToRef(g,i){const a=this.kd,n=g.kd,L=i.kd;return L[0]=a[0]/n[0],L[1]=a[1]/n[1],L[2]=a[2]/n[2],L[3]=a[3]/n[3],i}divide(g){return this.divideToRef(g,new L)}addToRef(g,i){const a=this.kd,n=g.m,L=i.m;return L[0]=a[0]+n[0],L[1]=a[1]+n[1],L[2]=a[2]+n[2],L[3]=a[3]+n[3],i}add(g){return this.addToRef(g,new L)}subtractToRef(g,i){const a=this.kd,n=g.m,L=i.m;return L[0]=a[0]-n[0],L[1]=a[1]-n[1],L[2]=a[2]-n[2],L[3]=a[3]-n[3],i}ci(g){return this.subtractToRef(g,new L)}transpose(){const g=this.kd;return new L([g[0],g[2],g[1],g[3]])}determinant(){const g=this.kd;return g[0]*g[3]-g[1]*g[2]}inverse(){const g=this.determinant();if(0===g)throw new Error("Matrix is not invertible");const i=this.kd,a=1/g;return new L([i[3]*a,-i[1]*a,-i[2]*a,i[0]*a])}equals(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=this.kd,n=g.m;return 0===i?a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]&&a[3]===n[3]:Math.abs(a[0]-n[0])<i&&Math.abs(a[1]-n[1])<i&&Math.abs(a[2]-n[2])<i&&Math.abs(a[3]-n[3])<i}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.kd.join(", ")})`}}class d{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.kd=g}get m(){return this.kd}transformVector(g){return this.transformVectorToRef(g,new n.Bi)}transformVectorToRef(g,i){const a=this.kd;return i.x=g.x*a[0]+g.y*a[1]+g.z*a[2],i.y=g.x*a[3]+g.y*a[4]+g.z*a[5],i.z=g.x*a[6]+g.y*a[7]+g.z*a[8],i}multiplyToRef(g,i){const a=g.kd,n=this.kd,L=i.m;return L[0]=a[0]*n[0]+a[1]*n[3]+a[2]*n[6],L[1]=a[0]*n[1]+a[1]*n[4]+a[2]*n[7],L[2]=a[0]*n[2]+a[1]*n[5]+a[2]*n[8],L[3]=a[3]*n[0]+a[4]*n[3]+a[5]*n[6],L[4]=a[3]*n[1]+a[4]*n[4]+a[5]*n[7],L[5]=a[3]*n[2]+a[4]*n[5]+a[5]*n[8],L[6]=a[6]*n[0]+a[7]*n[3]+a[8]*n[6],L[7]=a[6]*n[1]+a[7]*n[4]+a[8]*n[7],L[8]=a[6]*n[2]+a[7]*n[5]+a[8]*n[8],i}multiply(g){return this.multiplyToRef(g,new d)}divideToRef(g,i){const a=this.kd,n=g.m,L=i.m;return L[0]=a[0]/n[0],L[1]=a[1]/n[1],L[2]=a[2]/n[2],L[3]=a[3]/n[3],L[4]=a[4]/n[4],L[5]=a[5]/n[5],L[6]=a[6]/n[6],L[7]=a[7]/n[7],L[8]=a[8]/n[8],i}divide(g){return this.divideToRef(g,new d)}addToRef(g,i){const a=this.kd,n=g.m,L=i.m;return L[0]=a[0]+n[0],L[1]=a[1]+n[1],L[2]=a[2]+n[2],L[3]=a[3]+n[3],L[4]=a[4]+n[4],L[5]=a[5]+n[5],L[6]=a[6]+n[6],L[7]=a[7]+n[7],L[8]=a[8]+n[8],i}add(g){return this.addToRef(g,new d)}subtractToRef(g,i){const a=this.kd,n=g.m,L=i.m;return L[0]=a[0]-n[0],L[1]=a[1]-n[1],L[2]=a[2]-n[2],L[3]=a[3]-n[3],L[4]=a[4]-n[4],L[5]=a[5]-n[5],L[6]=a[6]-n[6],L[7]=a[7]-n[7],L[8]=a[8]-n[8],i}ci(g){return this.subtractToRef(g,new d)}toArray(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let i=0;i<9;i++)g[i]=this.kd[i];return g}fd(){return this.toArray()}ya(g){for(let i=0;i<9;i++)this.kd[i]=g[i];return this}transpose(){const g=this.kd;return new d([g[0],g[3],g[6],g[1],g[4],g[7],g[2],g[5],g[8]])}determinant(){const g=this.kd;return g[0]*(g[4]*g[8]-g[5]*g[7])-g[1]*(g[3]*g[8]-g[5]*g[6])+g[2]*(g[3]*g[7]-g[4]*g[6])}inverse(){const g=this.determinant();if(0===g)throw new Error("Matrix is not invertible");const i=this.kd,a=1/g;return new d([(i[4]*i[8]-i[5]*i[7])*a,(i[2]*i[7]-i[1]*i[8])*a,(i[1]*i[5]-i[2]*i[4])*a,(i[5]*i[6]-i[3]*i[8])*a,(i[0]*i[8]-i[2]*i[6])*a,(i[2]*i[3]-i[0]*i[5])*a,(i[3]*i[7]-i[4]*i[6])*a,(i[1]*i[6]-i[0]*i[7])*a,(i[0]*i[4]-i[1]*i[3])*a])}equals(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=this.kd,n=g.m;return 0===i?a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]&&a[3]===n[3]&&a[4]===n[4]&&a[5]===n[5]&&a[6]===n[6]&&a[7]===n[7]&&a[8]===n[8]:Math.abs(a[0]-n[0])<i&&Math.abs(a[1]-n[1])<i&&Math.abs(a[2]-n[2])<i&&Math.abs(a[3]-n[3])<i&&Math.abs(a[4]-n[4])<i&&Math.abs(a[5]-n[5])<i&&Math.abs(a[6]-n[6])<i&&Math.abs(a[7]-n[7])<i&&Math.abs(a[8]-n[8])<i}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.kd.join(", ")})`}}},14228:(g,i,a)=>{"use strict";var n;function L(g,i,a,n){switch(i){case"Animation":return n?g.animations.find((g=>g.uniqueId===a))??null:g.animations[a]??null;case"AnimationGroup":return n?g.animationGroups.find((g=>g.uniqueId===a))??null:g.animationGroups[a]??null;case"Mesh":return n?g.meshes.find((g=>g.uniqueId===a))??null:g.meshes[a]??null;case"Material":return n?g.materials.find((g=>g.uniqueId===a))??null:g.materials[a]??null;case"II":return n?g.cameras.find((g=>g.uniqueId===a))??null:g.cameras[a]??null;case"Light":return n?g.lights.find((g=>g.uniqueId===a))??null:g.lights[a]??null;default:return null}}a.d(i,{c:()=>L}),function(g){g.Animation="Animation",g.AnimationGroup="AnimationGroup",g.Mesh="Mesh",g.Material="Material",g.II="II",g.Light="Light"}(n||(n={}))},14265:(g,i,a)=>{"use strict";a.d(i,{d:()=>L});var n=a(14271);class L extends n.d{constructor(g,i){if(super(g),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),i)for(const a of i)this._eventsSignalOutputs[a]=this._registerSignalOutput(a+"Event")}_executeOnTick(g){}_startPendingTasks(g){g._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(g),this._resetAfterCanceled(g)),this._preparePendingTasks(g),g._addPendingBlock(this),this.out._activateSignal(g),g._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(g){g._deleteExecutionVariable(this,"_initialized"),g._removePendingBlock(this)}}},14234:(g,i,a)=>{"use strict";a.d(i,{c:()=>N});var n=a(12422),L=a(12415),d=a(14241),b=a(12286),k=a(14204);class e extends d.c{constructor(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.defaultValue,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(g,i,a),this.richType=n,this._defaultValue=L,this._optional=d,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new b.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(g){this._isDisabled!==g&&(this._isDisabled=g,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(g,i){i._getConnectionValue(this)!==g&&(i._setConnectionValue(this,g),this.onValueChangedObservable.notifyObservers(g))}resetToDefaultValue(g){g._setConnectionValue(this,this._defaultValue)}connectTo(g){this._isDisabled||super.connectTo(g)}_getValueOrDefault(g){const i=g._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(i):i}getValue(g){if(1===this.connectionType){g._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(g);const i=this._getValueOrDefault(g);return this._lastValue=i,this.richType.typeTransformer?this.richType.typeTransformer(i):i}const i=this.isConnected()?this._connectedPoint[0].getValue(g):this._getValueOrDefault(g);return this._lastValue=i,this.richType.typeTransformer?this.richType.typeTransformer(i):i}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(g),g.richType={},this.richType.serialize(g.richType),g.optional=this._optional,(0,k.i)("defaultValue",this._defaultValue,g)}}(0,L.e)("FlowGraphDataConnection",e);class N{constructor(g){var i;this.config=g,this.uniqueId=(0,n.d)(),this.name=(null===(i=this.config)||void 0===i?void 0:i.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(g){}registerDataInput(g,i,a){const n=new e(g,0,this,i,a);return this.dataInputs.push(n),n}registerDataOutput(g,i,a){const n=new e(g,1,this,i,a);return this.dataOutputs.push(n),n}getDataInput(g){return this.dataInputs.find((i=>i.name===g))}getDataOutput(g){return this.dataOutputs.find((i=>i.name===g))}serialize(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.i;if(g.uniqueId=this.uniqueId,g.config={},this.config){const a=this.config,n=Object.keys(a);for(const L of n)i(L,a[L],g.config)}g.dataInputs=[],g.dataOutputs=[],g.className=this.getClassName();for(const a of this.dataInputs){const i={};a.serialize(i),g.dataInputs.push(i)}for(const a of this.dataOutputs){const i={};a.serialize(i),g.dataOutputs.push(i)}}deserialize(g){}_log(g,i,a){var n;null===(n=g.logger)||void 0===n||n.addLogItem({action:i,Ba:a,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14241:(g,i,a)=>{"use strict";a.d(i,{c:()=>d});var n,L=a(12422);!function(g){g[g.Input=0]="Input",g[g.Output=1]="Output"}(n||(n={}));class d{constructor(g,i,a){this._ownerBlock=a,this._connectedPoint=[],this.uniqueId=(0,L.d)(),this.connectedPointIds=[],this.name=g,this._connectionType=i}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(g){if(this._connectionType===g._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||g._isSingularConnection()&&g._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(g),g._connectedPoint.push(this)}disconnectFrom(g){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const a=this._connectedPoint.indexOf(g),n=g._connectedPoint.indexOf(this);-1!==a&&-1!==n&&(i&&this._connectedPoint.splice(a,1),g._connectedPoint.splice(n,1))}disconnectFromAll(){for(const g of this._connectedPoint)this.disconnectFrom(g,!1);this._connectedPoint.length=0}dispose(){for(const g of this._connectedPoint)this.disconnectFrom(g)}serialize(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};g.uniqueId=this.uniqueId,g.name=this.name,g._connectionType=this._connectionType,g.connectedPointIds=[],g.className=this.getClassName();for(const i of this._connectedPoint)g.connectedPointIds.push(i.uniqueId)}getClassName(){return"FGConnection"}deserialize(g){this.uniqueId=g.uniqueId,this.name=g.name,this._connectionType=g._connectionType,this.connectedPointIds=g.connectedPointIds}}},14197:(g,i,a)=>{"use strict";a.d(i,{e:()=>x});var n,L=a(12286),d=a(12441),b=a(12447),k=a(12422),e=a(14204),N=a(14228),F=a(12292);!function(g){g.ExecuteBlock="ExecuteBlock",g.ExecuteEvent="ExecuteEvent",g.TriggerConnection="TriggerConnection",g.ContextVariableSet="ContextVariableSet",g.GlobalVariableSet="GlobalVariableSet",g.GlobalVariableDelete="GlobalVariableDelete",g.GlobalVariableGet="GlobalVariableGet",g.AddConnection="AddConnection",g.GetConnectionValue="GetConnectionValue",g.SetConnectionValue="SetConnectionValue",g.ActivateSignal="ActivateSignal",g.ContextVariableGet="ContextVariableGet"}(n||(n={}));class I{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(g){if(g.time||(g.time=Date.now()),this.log.push(g),this.logToConsole){var i;const a=null===(i=g.Ba)||void 0===i?void 0:i.value;"object"===typeof a&&a.getClassName?F.b.Log(`[FGLog] ${g.className}:${g.uniqueId.split("-")[0]} ${g.action} - ${JSON.stringify(a.getClassName())}: ${a.toString()}`):F.b.Log(`[FGLog] ${g.className}:${g.uniqueId.split("-")[0]} ${g.action} - ${JSON.stringify(g.Ba)}`)}}getItemsOfType(g){return this.log.filter((i=>i.action===g))}}class j{get enableLogging(){return this._enableLogging}set enableLogging(g){this._enableLogging!==g&&(this._enableLogging=g,this._enableLogging?(this.logger=new I,this.logger.logToConsole=!0):this.logger=null)}constructor(g){this.uniqueId=(0,k.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new L.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=g,this.assetsContext=g.assetsContext??g.Di}hasVariable(g){return g in this._userVariables}setVariable(g,i){var a;this._userVariables[g]=i,null===(a=this.logger)||void 0===a||a.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Ba:{name:g,value:i}})}getAsset(g,i){return(0,N.c)(this.assetsContext,g,i)}getVariable(g){var i;return null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Ba:{name:g,value:this._userVariables[g]}}),this._userVariables[g]}get userVariables(){return this._userVariables}Pg(){return this._configuration.Di}_getUniqueIdPrefixedName(g,i){return`${g.uniqueId}_${i}`}_getGlobalContextVariable(g,i){var a;return null===(a=this.logger)||void 0===a||a.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Ba:{name:g,defaultValue:i,possibleValue:this._globalContextVariables[g]}}),this._hasGlobalContextVariable(g)?this._globalContextVariables[g]:i}_setGlobalContextVariable(g,i){var a;null===(a=this.logger)||void 0===a||a.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Ba:{name:g,value:i}}),this._globalContextVariables[g]=i}_deleteGlobalContextVariable(g){var i;null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Ba:{name:g}}),delete this._globalContextVariables[g]}_hasGlobalContextVariable(g){return g in this._globalContextVariables}_setExecutionVariable(g,i,a){this._executionVariables[this._getUniqueIdPrefixedName(g,i)]=a}_getExecutionVariable(g,i,a){return this._hasExecutionVariable(g,i)?this._executionVariables[this._getUniqueIdPrefixedName(g,i)]:a}_deleteExecutionVariable(g,i){delete this._executionVariables[this._getUniqueIdPrefixedName(g,i)]}_hasExecutionVariable(g,i){return this._getUniqueIdPrefixedName(g,i)in this._executionVariables}_hasConnectionValue(g){return g.uniqueId in this._connectionValues}_setConnectionValue(g,i){var a;this._connectionValues[g.uniqueId]=i,null===(a=this.logger)||void 0===a||a.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Ba:{connectionPointId:g.uniqueId,value:i}})}_setConnectionValueByKey(g,i){this._connectionValues[g]=i}_getConnectionValue(g){var i;return null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Ba:{connectionPointId:g.uniqueId,value:this._connectionValues[g.uniqueId]}}),this._connectionValues[g.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(g){this._pendingBlocks.includes(g)||(this._pendingBlocks.push(g),this._pendingBlocks.sort(((g,i)=>g.priority-i.priority)))}_removePendingBlock(g){const i=this._pendingBlocks.indexOf(g);-1!==i&&this._pendingBlocks.splice(i,1)}_clearPendingBlocks(){for(const g of this._pendingBlocks)g._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(g){var i;this.onNodeExecutedObservable.notifyObservers(g),null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:g.getClassName(),uniqueId:g.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(g){this._setGlobalContextVariable("timeSinceStart",g.timeSinceStart),this._setGlobalContextVariable("deltaTime",g.deltaTime);for(const a of this._pendingBlocks){var i;null===(i=a._executeOnTick)||void 0===i||i.call(a,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.i;g.uniqueId=this.uniqueId,g._userVariables={};for(const n in this._userVariables)i(n,this._userVariables[n],g._userVariables);g._connectionValues={};for(const n in this._connectionValues)i(n,this._connectionValues[n],g._connectionValues);var a;this.assetsContext!==this.Pg()&&(g._assetsContext={meshes:this.assetsContext.meshes.map((g=>g.id)),materials:this.assetsContext.materials.map((g=>g.id)),textures:this.assetsContext.textures.map((g=>g.name)),animations:this.assetsContext.animations.map((g=>g.name)),lights:this.assetsContext.lights.map((g=>g.id)),cameras:this.assetsContext.cameras.map((g=>g.id)),ty:null===(a=this.assetsContext.ty)||void 0===a?void 0:a.map((g=>g.name)),skeletons:this.assetsContext.skeletons.map((g=>g.id)),Wj:this.assetsContext.Wj.map((g=>g.name)),geometries:this.assetsContext.geometries.map((g=>g.id)),multiMaterials:this.assetsContext.multiMaterials.map((g=>g.id)),transformNodes:this.assetsContext.transformNodes.map((g=>g.id))})}getClassName(){return"FlowGraphContext"}}(0,d.e)([(0,b.P)()],j.prototype,"uniqueId",void 0);var y=a(14231),B=a(12734);class c{constructor(g){this.onEventTriggeredObservable=new L.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=g,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.dd.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const g=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Ba:{timeSinceStart:this._startingTime,deltaTime:g}}),this._startingTime+=g})),this._meshPickedObserver=this._scene.onPointerObservable.add((g=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Ba:g})}),B.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((g=>{const i=g.pointerId,a=g.mesh,n=this._pointerUnderMeshState[i];!n&&a?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Ba:{pointerId:i,mesh:a}}):n&&!a?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Ba:{pointerId:i,mesh:n}}):n&&a&&n!==a&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Ba:{pointerId:i,mesh:n,over:a}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Ba:{pointerId:i,mesh:a,out:n}})),this._pointerUnderMeshState[i]=a}),B.b.POINTERMOVE)}dispose(){var g,i,a,n,L;null===(g=this._sceneDisposeObserver)||void 0===g||g.remove(),null===(i=this._sceneReadyObserver)||void 0===i||i.remove(),null===(a=this._sceneOnBeforeRenderObserver)||void 0===a||a.remove(),null===(n=this._meshPickedObserver)||void 0===n||n.remove(),null===(L=this._meshUnderPointerObserver)||void 0===L||L.remove(),this.onEventTriggeredObservable.clear()}}var D,p=a(14249);!function(g){g[g.Stopped=0]="Stopped",g[g.Started=1]="Started"}(D||(D={}));class R{get state(){return this._state}set state(g){this._state=g,this.onStateChangedObservable.notifyObservers(g)}constructor(g){this.onStateChangedObservable=new L.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=g.Di,this._sceneEventCoordinator=new c(this._scene),this._coordinator=g.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((g=>{for(const i of this._executionContexts){const a=this._getContextualOrder(g.type,i);for(const n of a)if(!n._executeEvent(i,g.Ba))break}switch(g.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const i of this._executionContexts)i._notifyOnTick(g.Ba);break;case"SceneDispose":this.dispose()}}))}createContext(){const g=new j({Di:this._scene,coordinator:this._coordinator});return this._executionContexts.push(g),g}getContext(g){return this._executionContexts[g]}addEventBlock(g){if("PointerOver"!==g.type&&"PointerOut"!==g.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==g.type&&this._eventBlocks[g.type].push(g),1===this.state)for(const i of this._executionContexts)g._startPendingTasks(i);else this.onStateChangedObservable.addOnce((i=>{if(1===i)for(const a of this._executionContexts)g._startPendingTasks(a)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((g=>{1===g&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const g of this._executionContexts)for(const i in this._eventBlocks){const a=this._getContextualOrder(i,g);for(const i of a)i._startPendingTasks(g)}}_getContextualOrder(g,i){const a=this._eventBlocks[g].sort(((g,i)=>i.initPriority-g.initPriority));if("MeshPick"===g){const g=[];for(const n of a){const L=n.asset.getValue(i);let d=0;for(;d<a.length;d++){const g=a[d].asset.getValue(i);if(L&&g&&(0,p.m)(L,g))break}g.splice(d,0,n)}return g}return a}dispose(){var g;if(0!==this.state){this.state=0;for(const g of this._executionContexts)g._clearPendingBlocks();this._executionContexts.length=0;for(const g in this._eventBlocks)this._eventBlocks[g].length=0;null===(g=this._eventObserver)||void 0===g||g.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(g){const i=[],a=new Set;for(const n in this._eventBlocks)for(const g of this._eventBlocks[n])i.push(g),a.add(g.uniqueId);for(;i.length>0;){const n=i.pop();g(n);for(const g of n.dataInputs)for(const n of g._connectedPoint)a.has(n._ownerBlock.uniqueId)||(i.push(n._ownerBlock),a.add(n._ownerBlock.uniqueId));if(n instanceof y.b)for(const g of n.signalOutputs)for(const n of g._connectedPoint)a.has(n._ownerBlock.uniqueId)||(i.push(n._ownerBlock),a.add(n._ownerBlock.uniqueId))}}serialize(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;g.allBlocks=[],this.visitAllBlocks((i=>{const a={};i.serialize(a),g.allBlocks.push(a)})),g.executionContexts=[];for(const a of this._executionContexts){const n={};a.serialize(n,i),g.executionContexts.push(n)}}}class x{constructor(g){this.config=g,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Di.dd.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Di.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const g=this._executeOnNextFrame.slice(0);if(g.length)for(const i of g){this.notifyCustomEvent(i.id,i.data,!1);const g=this._executeOnNextFrame.findIndex((g=>g.uniqueId===i.uniqueId));-1!==g&&this._executeOnNextFrame.splice(g,1)}}));(x.SceneCoordinators.get(this.config.Di)??[]).push(this)}createGraph(){const g=new R({Di:this.config.Di,coordinator:this});return this._flowGraphs.push(g),g}removeGraph(g){const i=this._flowGraphs.indexOf(g);-1!==i&&(g.dispose(),this._flowGraphs.splice(i,1))}start(){for(const g of this._flowGraphs)g.start()}dispose(){var g,i;for(const L of this._flowGraphs)L.dispose();this._flowGraphs.length=0,null===(g=this._disposeObserver)||void 0===g||g.remove(),null===(i=this._onBeforeRenderObserver)||void 0===i||i.remove();const a=x.SceneCoordinators.get(this.config.Di)??[],n=a.indexOf(this);-1!==n&&a.splice(n,1)}serialize(g,i){g._flowGraphs=[];for(const a of this._flowGraphs){const n={};a.serialize(n,i),g._flowGraphs.push(n)}g.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(g){let i=this._customEventsMap.get(g);return i||(i=new L.b,this._customEventsMap.set(g,i)),i}notifyCustomEvent(g,i){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:g,data:i,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(g)){const i=this._eventExecutionCounter.get(g);if(this._eventExecutionCounter.set(g,i+1),i>=x.MaxEventTypeExecutionPerFrame)return void(i===x.MaxEventTypeExecutionPerFrame&&F.b.Warn(`FlowGraphCoordinator: Too many executions of event "${g}".`))}else this._eventExecutionCounter.set(g,1);const a=this._customEventsMap.get(g);a&&a.notifyObservers(i)}}x.MaxEventsPerType=30,x.MaxEventTypeExecutionPerFrame=30,x.SceneCoordinators=new Map},14256:(g,i,a)=>{"use strict";a.d(i,{e:()=>L});var n=a(14265);class L extends n.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(g){g._notifyExecuteNode(this),this.done._activateSignal(g)}}},14231:(g,i,a)=>{"use strict";a.d(i,{b:()=>k});var n=a(14234),L=a(14241),d=a(12415);class b extends L.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(g){super.connectTo(g),this._connectedPoint.sort(((g,i)=>i.priority-g.priority))}_activateSignal(g){var i;if(null===(i=g.logger)||void 0===i||i.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Ba:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)g._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(g,this),g._increaseExecutionId();else for(const a of this._connectedPoint)a._activateSignal(g)}}(0,d.e)("FlowGraphSignalConnection",b);class k extends n.c{constructor(g){super(g),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(g){const i=new b(g,0,this);return this.signalInputs.push(i),i}_registerSignalOutput(g){const i=new b(g,1,this);return this.signalOutputs.push(i),i}_unregisterSignalInput(g){const i=this.signalInputs.findIndex((i=>i.name===g));-1!==i&&(this.signalInputs[i].dispose(),this.signalInputs.splice(i,1))}_unregisterSignalOutput(g){const i=this.signalOutputs.findIndex((i=>i.name===g));-1!==i&&(this.signalOutputs[i].dispose(),this.signalOutputs.splice(i,1))}_reportError(g,i){this.error.Ba="string"===typeof i?new Error(i):i,this.error._activateSignal(g)}getSignalInput(g){return this.signalInputs.find((i=>i.name===g))}getSignalOutput(g){return this.signalOutputs.find((i=>i.name===g))}serialize(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(g),g.signalInputs=[],g.signalOutputs=[];for(const i of this.signalInputs){const a={};i.serialize(a),g.signalInputs.push(a)}for(const i of this.signalOutputs){const a={};i.serialize(a),g.signalOutputs.push(a)}}deserialize(g){for(let i=0;i<g.signalInputs.length;i++){const a=this.getSignalInput(g.signalInputs[i].name);if(!a)throw new Error("Could not find signal input with name "+g.signalInputs[i].name+" in block "+g.className);a.deserialize(g.signalInputs[i])}for(let i=0;i<g.signalOutputs.length;i++){const a=this.getSignalOutput(g.signalOutputs[i].name);if(!a)throw new Error("Could not find signal output with name "+g.signalOutputs[i].name+" in block "+g.className);a.deserialize(g.signalOutputs[i])}}getClassName(){return"FlowGraphExecutionBlock"}}},14271:(g,i,a)=>{"use strict";a.d(i,{d:()=>L});var n=a(14231);class L extends n.b{constructor(g){super(g),this.out=this._registerSignalOutput("out")}}},14214:(g,i,a)=>{"use strict";a.d(i,{D:()=>f,G:()=>C,I:()=>Y,L:()=>P,d:()=>N,e:()=>j,f:()=>v,h:()=>D,j:()=>p,n:()=>R,q:()=>I,t:()=>X,u:()=>F,v:()=>y,w:()=>B,z:()=>c});var n,L=a(12452),d=a(12496),b=a(14209),k=a(14221);!function(g){g.Any="any",g.String="string",g.Number="number",g.Boolean="boolean",g.Object="object",g.Integer="FlowGraphInteger",g.Vector2="Vector2",g.Bi="Bi",g.Vector4="Vector4",g.Quaternion="Quaternion",g.Matrix="Matrix",g.Matrix2D="Matrix2D",g.Matrix3D="Matrix3D",g.Ri="Ri",g.Hd="Hd"}(n||(n={}));class e{constructor(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=g,this.defaultValue=i,this.animationType=a}serialize(g){g.typeName=this.typeName,g.defaultValue=this.defaultValue}}const N=new e("any",void 0),F=new e("string",""),I=new e("number",0,0),j=new e("boolean",!1),y=new e("Vector2",L.Vector2.Zero(),5),B=new e("Bi",L.Bi.Zero(),1),c=new e("Vector4",L.Vector4.Zero()),D=new e("Matrix",L.Matrix.Identity(),3),p=new e("Matrix2D",new k.d),R=new e("Matrix3D",new k.h),x=new e("Ri",d.Ri.Black(),4),E=new e("Hd",new d.Hd(0,0,0,0),7),X=new e("Quaternion",L.Quaternion.Identity(),2);X.typeTransformer=g=>{if(g.getClassName){if("Vector4"===g.getClassName())return L.Quaternion.xi(g.fd());if("Bi"===g.getClassName())return L.Quaternion.FromEulerVector(g);if("Matrix"===g.getClassName())return L.Quaternion.FromRotationMatrix(g)}return g};const v=new e("FlowGraphInteger",new b.e(0),0);function P(g){const i=g;switch(typeof g){case"string":return F;case"number":return I;case"boolean":return j;case"object":if(i.getClassName)switch(i.getClassName()){case"Vector2":return y;case"Bi":return B;case"Vector4":return c;case"Matrix":return D;case"Ri":return x;case"Hd":return E;case"Quaternion":return X;case"FlowGraphInteger":return v;case"Matrix2D":return p;case"Matrix3D":return R}return N;default:return N}}function Y(g){switch(g){case"string":return F;case"number":return I;case"boolean":return j;case"Vector2":return y;case"Bi":return B;case"Vector4":return c;case"Matrix":return D;case"Ri":return x;case"Hd":return E;case"Quaternion":return X;case"FlowGraphInteger":return v;case"Matrix2D":return p;case"Matrix3D":return R;default:return N}}function f(g){switch(g){case"number":default:return 0;case"Vector2":return 5;case"Bi":return 1;case"Matrix":return 3;case"Ri":return 4;case"Hd":return 7;case"Quaternion":return 2}}function C(g){switch(g){case 0:return I;case 5:return y;case 1:return B;case 3:return D;case 4:return x;case 7:return E;case 2:return X;default:return N}}},14204:(g,i,a)=>{"use strict";a.d(i,{e:()=>F,i:()=>N,k:()=>I});var n=a(12496),L=a(12452),d=a(14209),b=a(14214),k=a(14221);function e(g){return"Vector2"===g||"Bi"===g||"Vector4"===g||"Quaternion"===g||"Ri"===g||"Hd"===g}function N(g,i,a){var n;const L=(null===i||void 0===i||null===(n=i.getClassName)||void 0===n?void 0:n.call(i))??"";if(e(L)||function(g){return"Matrix"===g||"Matrix2D"===g||"Matrix3D"===g}(L))a[g]={value:i.fd(),className:L};else if("FlowGraphInteger"===L)a[g]={value:i.value,className:L};else if(L&&(i.id||i.name))a[g]={id:i.id,name:i.name,className:L};else{if("object"===typeof i)throw new Error(`Could not serialize value ${i}`);a[g]=i}}function F(g,i,a,N){const I=i[g];let j;const y=(null===I||void 0===I?void 0:I.type)??(null===I||void 0===I?void 0:I.className);if(function(g){return"Mesh"===g||"AbstractMesh"===g||"GroundMesh"===g||"InstanceMesh"===g||"LinesMesh"===g||"GoldbergMesh"===g||"GreasedLineMesh"===g||"TrailMesh"===g}(y)){let g=N.meshes.filter((g=>I.id?g.id===I.id:g.name===I.name));0===g.length&&(g=N.transformNodes.filter((g=>I.id?g.id===I.id:g.name===I.name))),j=I.uniqueId?g.find((g=>g.uniqueId===I.uniqueId)):g[0]}else if(e(y))j=function(g,i){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===g)return L.Vector2.xi(i);if("Bi"===g)return a&&(i[2]*=-1),L.Bi.xi(i);if("Vector4"===g)return L.Vector4.xi(i);if("Quaternion"===g)return a&&(i[2]*=-1,i[3]*=-1),L.Quaternion.xi(i);if("Ri"===g)return new n.Ri(i[0],i[1],i[2]);if("Hd"===g)return new n.Hd(i[0],i[1],i[2],i[3]);throw new Error(`Unknown vector class name ${g}`)}(y,I.value);else if(function(g){return"AnimationGroup"===g}(y)){const g=N.animationGroups.filter((g=>g.name===I.name));j=1===g.length?g[0]:g.find((g=>g.uniqueId===I.uniqueId))}else j="Matrix"===y?L.Matrix.xi(I.value):"Matrix2D"===y?new k.d(I.value):"Matrix3D"===y?new k.h(I.value):"FlowGraphInteger"===y?d.e.FromValue(I.value):"number"===y||"string"===y||"boolean"===y?I.value[0]:I&&void 0!==I.value?I.value:Array.isArray(I)?I.reduce(((g,i)=>i.eventData?(g[i.id]={type:(0,b.I)(i.type)},"undefined"!==typeof i.value&&(g[i.id].value=F("value",i,a,N)),g):g),{}):I;return j}function I(g){return"FlowGraphJsonPointerParserBlock"===g}},14249:(g,i,a)=>{"use strict";function n(g,i){return!(!g.parent||g.parent!==i&&!n(g.parent,i))}function L(g){if(g.getClassName)return g.getClassName()}function d(g,i){return g===i&&("Vector2"===g||"Bi"===g||"Vector4"===g||"Quaternion"===g)}function b(g,i){return g===i&&("Matrix"===g||"Matrix2D"===g||"Matrix3D"===g)}function k(g,i){return"FlowGraphInteger"===g&&"FlowGraphInteger"===i}function e(g,i){const a="number"===typeof g||"number"===typeof(null===g||void 0===g?void 0:g.value);return a&&!i?!isNaN(N(g)):a}function N(g){return"number"===typeof g?g:g.value}a.d(i,{d:()=>k,g:()=>b,j:()=>d,l:()=>L,m:()=>n,p:()=>N,r:()=>e})},13589:(g,i,a)=>{"use strict";a.r(i),a.d(i,{SceneInstrumentation:()=>d});var n=a(12277),L=a(12678);class d{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(g){g!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=g,g?(this._onBeforeActiveMeshesEvaluationObserver=this.Di.onBeforeActiveMeshesEvaluationObservable.add((()=>{n.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Di.onAfterActiveMeshesEvaluationObservable.add((()=>{n.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Di.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Di.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(g){g!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=g,g?(this._onBeforeRenderTargetsRenderObserver=this.Di.onBeforeRenderTargetsRenderObservable.add((()=>{n.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Di.onAfterRenderTargetsRenderObservable.add((()=>{n.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Di.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Di.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(g){g!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=g,g?(this._onBeforeParticlesRenderingObserver=this.Di.onBeforeParticlesRenderingObservable.add((()=>{n.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Di.onAfterParticlesRenderingObservable.add((()=>{n.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Di.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Di.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(g){g!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=g,this.Di.spriteManagers&&(g?(this._onBeforeSpritesRenderingObserver=this.Di.onBeforeSpritesRenderingObservable.add((()=>{n.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Di.onAfterSpritesRenderingObservable.add((()=>{n.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Di.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Di.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(g){g!==this._capturePhysicsTime&&this.Di.onBeforePhysicsObservable&&(this._capturePhysicsTime=g,g?(this._onBeforePhysicsObserver=this.Di.onBeforePhysicsObservable.add((()=>{n.Tools.StartPerformanceCounter("Nb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Di.onAfterPhysicsObservable.add((()=>{n.Tools.EndPerformanceCounter("Nb"),this._physicsTime.endMonitoring()}))):(this.Di.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Di.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(g){g!==this._captureAnimationsTime&&(this._captureAnimationsTime=g,g?this._onAfterAnimationsObserver=this.Di.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Di.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(g){this._captureFrameTime=g}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(g){this._captureInterFrameTime=g}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(g){g!==this._captureRenderTime&&(this._captureRenderTime=g,g?(this._onBeforeDrawPhaseObserver=this.Di.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),n.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Di.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),n.Tools.EndPerformanceCounter("Main render")}))):(this.Di.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Di.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(g){g!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=g,g?(this._onBeforeCameraRenderObserver=this.Di.onBeforeCameraRenderObservable.add((g=>{this._cameraRenderTime.beginMonitoring(),n.Tools.StartPerformanceCounter(`Rendering camera ${g.name}`)})),this._onAfterCameraRenderObserver=this.Di.onAfterCameraRenderObservable.add((g=>{this._cameraRenderTime.endMonitoring(!1),n.Tools.EndPerformanceCounter(`Rendering camera ${g.name}`)}))):(this.Di.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Di.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Di.getEngine()._drawCalls}constructor(g){this.Di=g,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new L.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new L.b,this._captureFrameTime=!1,this._frameTime=new L.b,this._captureRenderTime=!1,this._renderTime=new L.b,this._captureInterFrameTime=!1,this._interFrameTime=new L.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new L.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new L.b,this._capturePhysicsTime=!1,this._physicsTime=new L.b,this._captureAnimationsTime=!1,this._animationsTime=new L.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new L.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=g.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(n.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Di.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=g.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(n.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ld(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ld(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ld(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ld(),this._captureRenderTime&&this._renderTime.Ld(),this._captureCameraRenderTime&&this._cameraRenderTime.Ld()}))}dispose(){this._disposed||(this.Di.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Di.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Di.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Di.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Di.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Di.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Di.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Di.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Di.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Di.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Di.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Di.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Di.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Di.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Di.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Di.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Di.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Di=null,this._disposed=!0)}}},14189:(g,i,a)=>{"use strict";a.d(i,{d:()=>F});var n=a(12441),L=a(12447),d=a(12452),b=a(12887),k=a(13004),e=a(13065),N=a(12415);b.d.AddNodeConstructor("Light_Type_1",((g,i)=>()=>new F(g,d.Bi.Zero(),i)));class F extends e.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(g){this._shadowFrustumSize=g,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(g){this._shadowOrthoScale=g,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(g){this._orthoLeft=g}get orthoRight(){return this._orthoRight}set orthoRight(g){this._orthoRight=g}get orthoTop(){return this._orthoTop}set orthoTop(g){this._orthoTop=g}get orthoBottom(){return this._orthoBottom}set orthoBottom(g){this._orthoBottom=g}constructor(g,i,a){super(g,a),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=i.scale(-1),this.direction=i}getClassName(){return"Fb"}getTypeID(){return k.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(g,i,a){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(g):this._setDefaultAutoExtendShadowProjectionMatrix(g,i,a)}_setDefaultFixedFrustumShadowProjectionMatrix(g){const i=this.Pg().activeCamera;i&&d.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:i.Vd,void 0!==this.shadowMaxZ?this.shadowMaxZ:i.maxZ,g,this.Pg().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(g,i,a){const n=this.Pg().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const g=d.Bi.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let n=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(let b=0;b<a.length;b++){const k=a[b];if(!k)continue;const e=k.getBoundingInfo().boundingBox;for(let a=0;a<e.vectorsWorld.length;a++)d.Bi.TransformCoordinatesToRef(e.vectorsWorld[a],i,g),g.x<this._orthoLeft&&(this._orthoLeft=g.x),g.y<this._orthoBottom&&(this._orthoBottom=g.y),g.x>this._orthoRight&&(this._orthoRight=g.x),g.y>this._orthoTop&&(this._orthoTop=g.y),this.autoCalcShadowZBounds&&(g.z<n&&(n=g.z),g.z>L&&(L=g.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=n,this._shadowMaxZ=L)}const L=this._orthoRight-this._orthoLeft,b=this._orthoTop-this._orthoBottom,k=void 0!==this.shadowMinZ?this.shadowMinZ:(null===n||void 0===n?void 0:n.Vd)||0,e=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===n||void 0===n?void 0:n.maxZ)||1e4,N=this.Pg().getEngine().o;d.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-L*this.shadowOrthoScale,this._orthoRight+L*this.shadowOrthoScale,this._orthoBottom-b*this.shadowOrthoScale,this._orthoTop+b*this.shadowOrthoScale,N?e:k,N?k:e,g,this.Pg().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(g,i){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,i),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,i),this)}transferToNodeMaterialEffect(g,i){return this.computeTransformedInformation()?(g.setFloat3(i,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(g.setFloat3(i,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(g){const i=this._scene.getEngine();return!i.o&&i.isNDCHalfZRange?0:1}getDepthMaxZ(g){const i=this._scene.getEngine();return i.o&&i.isNDCHalfZRange?0:1}prepareLightSpecificDefines(g,i){g["DIRLIGHT"+i]=!0}}(0,n.e)([(0,L.P)()],F.prototype,"shadowFrustumSize",null),(0,n.e)([(0,L.P)()],F.prototype,"shadowOrthoScale",null),(0,n.e)([(0,L.P)()],F.prototype,"autoUpdateExtends",void 0),(0,n.e)([(0,L.P)()],F.prototype,"autoCalcShadowZBounds",void 0),(0,n.e)([(0,L.P)("orthoLeft")],F.prototype,"_orthoLeft",void 0),(0,n.e)([(0,L.P)("orthoRight")],F.prototype,"_orthoRight",void 0),(0,n.e)([(0,L.P)("orthoTop")],F.prototype,"_orthoTop",void 0),(0,n.e)([(0,L.P)("orthoBottom")],F.prototype,"_orthoBottom",void 0),(0,N.e)("BABYLON.DirectionalLight",F)},14697:(g,i,a)=>{"use strict";a.d(i,{c:()=>F});var n=a(12441),L=a(12447),d=a(12452),b=a(12496),k=a(12887),e=a(13004),N=a(12415);k.d.AddNodeConstructor("Light_Type_3",((g,i)=>()=>new F(g,d.Bi.Zero(),i)));class F extends e.e{constructor(g,i,a){super(g,a),this.groundColor=new b.Ri(0,0,0),this.direction=i||d.Bi.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"jb"}setDirectionToTarget(g){return this.direction=d.Bi.Normalize(g.ci(d.Bi.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(g,i){const a=d.Bi.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",a.x,a.y,a.z,0,i),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.ib),i),this}transferToNodeMaterialEffect(g,i){const a=d.Bi.Normalize(this.direction);return g.setFloat3(i,a.x,a.y,a.z),this}Zd(){return this._worldMatrix||(this._worldMatrix=d.Matrix.Identity()),this._worldMatrix}getTypeID(){return e.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(g,i){g["HEMILIGHT"+i]=!0}}(0,n.e)([(0,L.o)()],F.prototype,"groundColor",void 0),(0,n.e)([(0,L.M)()],F.prototype,"direction",void 0),(0,N.e)("BABYLON.HemisphericLight",F)},14143:(g,i,a)=>{"use strict";a.d(i,{c:()=>I});var n=a(12441),L=a(12447),d=a(12452),b=a(12887),k=a(13004),e=a(13065),N=a(12436),F=a(12415);b.d.AddNodeConstructor("Light_Type_2",((g,i)=>()=>new I(g,d.Bi.Zero(),d.Bi.Zero(),0,0,i)));class I extends e.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(g){this._iesProfileTexture!==g&&(this._iesProfileTexture=g,this._iesProfileTexture&&I._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(g){this._angle=g,this._cosHalfAngle=Math.cos(.5*g),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(g){this._innerAngle=g,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(g){this._shadowAngleScale=g,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(g){this._projectionTextureLightNear=g,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(g){this._projectionTextureLightFar=g,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(g){this._projectionTextureUpDirection=g,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(g){this._projectionTexture!==g&&(this._projectionTexture=g,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(I._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):I._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(g){return void 0!==g.onGeneratedObservable}static _IsTexture(g){return void 0!==g.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(g){this._projectionTextureProjectionLightMatrix=g,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(g,i,a,n,L,b){super(g,b),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=d.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=d.Bi.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=d.Bi.Zero(),this._projectionTextureViewLightMatrix=d.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=d.Matrix.Zero(),this._projectionTextureScalingMatrix=d.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=i,this.direction=a,this.angle=n,this.exponent=L}getClassName(){return"SpotLight"}getTypeID(){return k.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(g){super._setDirection(g),this._projectionTextureViewLightDirty=!0}_setPosition(g){super._setPosition(g),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(g,i,a){const n=this.Pg().activeCamera;if(!n)return;this._shadowAngleScale=this._shadowAngleScale||1;const L=this._shadowAngleScale*this._angle,b=void 0!==this.shadowMinZ?this.shadowMinZ:n.Vd,k=void 0!==this.shadowMaxZ?this.shadowMaxZ:n.maxZ,e=this.Pg().getEngine().o;d.Matrix.PerspectiveFovLHToRef(L,1,e?k:b,e?b:k,g,!0,this._scene.getEngine().isNDCHalfZRange,void 0,e)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),d.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const g=this.projectionTextureLightFar,i=this.projectionTextureLightNear,a=g/(g-i),n=-a*i,L=1/Math.tan(this._angle/2);d.Matrix.FromValuesToRef(L/1,0,0,0,0,L,0,0,0,0,a,1,0,0,n,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof N.c){const g=this._projectionTexture.uScale/2,i=this._projectionTexture.vScale/2;d.Matrix.FromValuesToRef(g,0,0,0,0,i,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(g,i){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),g.setMatrix("textureProjectionMatrix"+i,this._projectionTextureMatrix),g.setTexture("projectionLightTexture"+i,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&g.setTexture("iesLightTexture"+i,this._iesProfileTexture),this}transferToEffect(g,i){let a;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,i),a=d.Bi.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,i),a=d.Bi.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",a.x,a.y,a.z,this._cosHalfAngle,i),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,i),this}transferToNodeMaterialEffect(g,i){let a;return a=this.computeTransformedInformation()?d.Bi.Normalize(this.transformedDirection):d.Bi.Normalize(this.direction),this.Pg().useRightHandedSystem?g.setFloat3(i,-a.x,-a.y,-a.z):g.setFloat3(i,a.x,a.y,a.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(g){const i=this._scene.getEngine(),a=void 0!==this.shadowMinZ?this.shadowMinZ:(null===g||void 0===g?void 0:g.Vd)??0;return i.o&&i.isNDCHalfZRange?a:this._scene.getEngine().isNDCHalfZRange?0:a}getDepthMaxZ(g){const i=this._scene.getEngine(),a=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===g||void 0===g?void 0:g.maxZ)??1e4;return i.o&&i.isNDCHalfZRange?0:a}prepareLightSpecificDefines(g,i){g["SPOTLIGHT"+i]=!0,g["PROJECTEDLIGHTTEXTURE"+i]=!(!this.projectionTexture||!this.projectionTexture.isReady()),g["IESLIGHTTEXTURE"+i]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,n.e)([(0,L.P)()],I.prototype,"angle",null),(0,n.e)([(0,L.P)()],I.prototype,"innerAngle",null),(0,n.e)([(0,L.P)()],I.prototype,"shadowAngleScale",null),(0,n.e)([(0,L.P)()],I.prototype,"exponent",void 0),(0,n.e)([(0,L.P)()],I.prototype,"projectionTextureLightNear",null),(0,n.e)([(0,L.P)()],I.prototype,"projectionTextureLightFar",null),(0,n.e)([(0,L.P)()],I.prototype,"projectionTextureUpDirection",null),(0,n.e)([(0,L.H)("projectedLightTexture")],I.prototype,"_projectionTexture",void 0),(0,F.e)("BABYLON.SpotLight",I)},13838:(g,i,a)=>{"use strict";a.d(i,{e:()=>b,h:()=>d,i:()=>k});const n={},L={};function d(g,i){n[g]=i}function b(g,i){L[g]=i}function k(g){return L[g]?L[g]:null}},13743:(g,i,a)=>{"use strict";a.d(i,{c:()=>P,f:()=>h});var n,L=a(12277),d=a(12286),b=a(12692),k=a(12316),e=a(12292),N=a(12928),F=a(12324),I=a(12330),j=a(12422),y=a(12354),B=a(12308);!function(g){g[g.Clean=0]="Clean",g[g.Stop=1]="Stop",g[g.Sync=2]="Sync",g[g.NoSync=3]="NoSync"}(n||(n={}));const c=new d.b,D={};let p=!1;function R(){return D[".babylon"]}function x(g,i){const a=D[g];return a||(e.b.Warn("Unable to find a plugin to load "+g+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),i?R():void 0)}function E(g,i,a){let n="Unable to load from "+(g.rawData?"binary data":g.url);return i?n+=`: ${i}`:a&&(n+=`: ${a}`),n}async function X(g,i,a,n,L,d,b,k,e){var N;const I="data:"===(j=g.url).substring(0,5)?j.substring(5):null;var j;if(g.rawData&&!b)throw"When using ArrayBufferView to load data the file extension must be provided.";const p=I||b?"":function(g){const i=g.indexOf("?");-1!==i&&(g=g.substring(0,i));const a=g.lastIndexOf(".");return g.substring(a,g.length).toLowerCase()}(g.url);let E=b?x(b,!0):I?function(g){for(const i in D){const a=D[i].plugin;if(a.canDirectLoad&&a.canDirectLoad(g))return D[i]}return R()}(g.url):x(p,!1);if(!E&&p){if(g.url&&!g.url.startsWith("blob:")){const i=await async function(g,i){const a=i.method||"GET";return await new Promise(((n,L)=>{const d=new B.d;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){const g={};if(i.responseHeaders)for(const a of i.responseHeaders)g[a]=d.getResponseHeader(a)||"";n({response:d.response,headerValues:g})}else L(`Unable to fetch data from ${g}. Error code: ${d.status}`)})),d.open(a,g),d.send()}))}(g.url,{method:"HEAD",responseHeaders:["Content-Type"]}),a=i.headerValues?i.headerValues["Content-Type"]:"";a&&(E=function(g){for(const i in D){const a=D[i];if(a.mimeType===g)return a}}(a))}E||(E=R())}if(!E)throw new Error(`No plugin or fallback for ${b??g.url}`);if(!1===(null===e||void 0===e||null===(N=e[E.plugin.name])||void 0===N?void 0:N.enabled))throw new Error(`The '${E.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(g.rawData&&!E.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(g=>{if(E.plugin.createPlugin){const i=E.plugin.createPlugin(e??{});return i instanceof Promise?(i.then(g).catch((g=>{L("Error instantiating plugin.",g)})),null):(g(i),i)}return g(E.plugin),E.plugin})((e=>{var N;if(!e)throw`The loader plugin corresponding to the '${b}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(c.notifyObservers(e),I&&(e.canDirectLoad&&e.canDirectLoad(g.url)||!(0,F.i)(g.url))){if(e.directLoad){const g=e.directLoad(i,I);g instanceof Promise?g.then((g=>{a(e,g)})).catch((g=>{L("Error in directLoad of _loadData: "+g,g)})):a(e,g)}else a(e,I);return}const j=E.isBinary,B=(g,n)=>{i.p?L("Scene has been disposed"):a(e,g,n)};let D=null,p=!1;null===(N=e.dd)||void 0===N||N.add((()=>{p=!0,D&&(D.abort(),D=null),d()}));const R=()=>{if(p)return;const a=(g,i)=>{L(null===g||void 0===g?void 0:g.statusText,i)};if(!e.loadFile&&g.rawData)throw"Plugin does not support loading ArrayBufferView.";D=e.loadFile?e.loadFile(i,g.rawData||g.file||g.url,g.rootUrl,B,n,j,a,k):i._loadFile(g.file||g.url,B,n,!0,j,a)},x=i.getEngine();let X=x.enableOfflineSupport;if(X){let a=!1;for(const n of i.disableOfflineSupportExceptionRules)if(n.test(g.url)){a=!0;break}X=!a}X&&y.d.OfflineProviderFactory?i.offlineProvider=y.d.OfflineProviderFactory(g.url,R,x.disableManifestCheck):R()}))}function v(g,i){let a,n,d=null,b=null;if(i)if(i.name)a=`file:${i.name}`,n=i.name,d=i;else if(ArrayBuffer.isView(i))a="",n=(0,j.d)(),b=i;else if(i.startsWith("data:"))a=i,n="";else if(g){const d=i;if("/"===d.substring(0,1))return L.Tools.Error("Wrong sceneFilename parameter"),null;a=g+d,n=d}else a=i,n=L.Tools.GetFilename(i),g=L.Tools.GetFolderPath(i);else a=g,n=L.Tools.GetFilename(g),g=L.Tools.GetFolderPath(g);return{url:a,rootUrl:g,name:n,file:d,rawData:b}}function P(g){if("string"===typeof g.extensions){const i=g.extensions;D[i.toLowerCase()]={plugin:g,isBinary:!1}}else{const i=g.extensions,a=Object.keys(i);for(const n of a)D[n.toLowerCase()]={plugin:g,isBinary:i[n].isBinary,mimeType:i[n].mimeType}}}async function Y(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k.c.LastCreatedScene,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!n)return e.b.Error("No scene available to import mesh to"),null;const y=v(i,a);if(!y)return null;const B={};n.addPendingData(B);const c=()=>{n.removePendingData(B)},D=(g,i)=>{const a=E(y,g,i);b?b(n,a,new I.i(a,I.e.SceneLoaderError,i)):e.b.Error(a),c()},p=d?g=>{try{d(g)}catch(i){D("Error in onProgress callback: "+i,i)}}:void 0,R=(g,i,a,d,b,k,e,N)=>{if(n.importedMeshesFiles.push(y.url),L)try{L(g,i,a,d,b,k,e,N)}catch(F){D("Error in onSuccess callback: "+F,F)}n.removePendingData(B)};return await X(y,n,((i,a,L)=>{if(i.rewriteRootURL&&(y.rootUrl=i.rewriteRootURL(y.rootUrl,L)),i.importMesh){const L=[],d=[],b=[];if(!i.importMesh(g,n,a,y.rootUrl,L,d,b,D))return;n.loadingPluginName=i.name,R(L,d,b,[],[],[],[],[])}else{i.importMeshAsync(g,n,a,y.rootUrl,p,y.name).then((g=>{n.loadingPluginName=i.name,R(g.meshes,g.Wj,g.skeletons,g.animationGroups,g.transformNodes,g.geometries,g.lights,g.spriteManagers)})).catch((g=>{D(g.message,g)}))}}),p,D,c,N,F,j)}async function f(g,i,a,n,L,d,b,k){return await new Promise(((e,N)=>{try{Y(g,i,a,n,((g,i,a,n,L,d,b,k)=>{e({meshes:g,Wj:i,skeletons:a,animationGroups:n,transformNodes:L,geometries:d,lights:b,spriteManagers:k})}),L,((g,i,a)=>{N(a||new Error(i))}),d,b,k).catch(N)}catch(I){N(I)}}))}async function C(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.c.LastCreatedEngine,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};a?await S(g,i,new b.e(a),n,d,e,N,F,I):L.Tools.Error("No engine available")}async function U(g,i,a,n,L,d,b){return await new Promise(((k,e)=>{C(g,i,a,(g=>{k(g)}),n,((g,i,a)=>{e(a||new Error(i))}),L,d,b)}))}async function S(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.c.LastCreatedScene,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!a)return e.b.Error("No scene available to append to"),null;const y=v(g,i);if(!y)return null;const B={};a.addPendingData(B);const c=()=>{a.removePendingData(B)};N.e.ShowLoadingScreen&&!p&&(p=!0,a.getEngine().displayLoadingUI(),a.executeWhenReady((()=>{a.getEngine().hideLoadingUI(),p=!1})));const D=(g,i)=>{const n=E(y,g,i);d?d(a,n,new I.i(n,I.e.SceneLoaderError,i)):e.b.Error(n),c()},R=L?g=>{try{L(g)}catch(i){D("Error in onProgress callback",i)}}:void 0,x=()=>{if(n)try{n(a)}catch(g){D("Error in onSuccess callback",g)}a.removePendingData(B)};return await X(y,a,((g,i)=>{if(g.load){if(!g.load(a,i,y.rootUrl,D))return;a.loadingPluginName=g.name,x()}else{g.loadAsync(a,i,y.rootUrl,R,y.name).then((()=>{a.loadingPluginName=g.name,x()})).catch((g=>{D(g.message,g)}))}}),R,D,c,b,F,j)}async function V(g,i,a,n,L,d,b){return await new Promise(((k,e)=>{try{S(g,i,a,(g=>{k(g)}),n,((g,i,a)=>{e(a||new Error(i))}),L,d,b).catch(e)}catch(I){e(I)}}))}async function K(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.c.LastCreatedScene,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!a)return e.b.Error("No scene available to load asset container to"),null;const j=v(g,i);if(!j)return null;const y={};a.addPendingData(y);const B=()=>{a.removePendingData(y)},c=(g,i)=>{const n=E(j,g,i);d?d(a,n,new I.i(n,I.e.SceneLoaderError,i)):e.b.Error(n),B()},D=L?g=>{try{L(g)}catch(i){c("Error in onProgress callback",i)}}:void 0,p=g=>{if(n)try{n(g)}catch(i){c("Error in onSuccess callback",i)}a.removePendingData(y)};return await X(j,a,((g,i)=>{if(g.loadAssetContainer){const n=g.loadAssetContainer(a,i,j.rootUrl,c);if(!n)return;n.populateRootNodes(),a.loadingPluginName=g.name,p(n)}else if(g.loadAssetContainerAsync){g.loadAssetContainerAsync(a,i,j.rootUrl,D,j.name).then((i=>{i.populateRootNodes(),a.loadingPluginName=g.name,p(i)})).catch((g=>{c(g.message,g)}))}else c("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),D,c,B,b,N,F)}async function T(g,i,a,n,L,d,b){return await new Promise(((k,e)=>{try{K(g,i,a,(g=>{k(g)}),n,((g,i,a)=>{e(a||new Error(i))}),L,d,b).catch(e)}catch(I){e(I)}}))}async function l(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.c.LastCreatedScene,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,I=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,j=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!a)return void e.b.Error("No scene available to load animations to");if(n){for(const n of a.animatables)n.reset();a.stopAllAnimations();const g=a.animationGroups.slice();for(const a of g)a.dispose();const i=a.getNodes();for(const a of i)a.animations&&(a.animations=[])}else switch(L){case 0:const g=a.animationGroups.slice();for(const i of g)i.dispose();break;case 1:for(const i of a.animationGroups)i.stop();break;case 2:for(const i of a.animationGroups)i.reset(),i.restart();break;case 3:break;default:return void e.b.Error("Unknown animation group loading mode value '"+L+"'")}const B=a.animatables.length;await K(g,i,a,(g=>{g.mergeAnimationsTo(a,a.animatables.slice(B),d),g.dispose(),a.onAnimationFileImportedObservable.notifyObservers(a),b&&b(a)}),N,F,I,j,y)}async function Z(g,i,a,n,L,d,b,k,e,N){return await new Promise(((F,j)=>{try{l(g,i,a,n,L,d,(g=>{F(g)}),b,((g,i,a)=>{j(a||new Error(i))}),k,e,N).catch(j)}catch(I){j(I)}}))}class h{static get ForceFullSceneLoadingForIncremental(){return N.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(g){N.e.ForceFullSceneLoadingForIncremental=g}static get ShowLoadingScreen(){return N.e.ShowLoadingScreen}static set ShowLoadingScreen(g){N.e.ShowLoadingScreen=g}static get loggingLevel(){return N.e.loggingLevel}static set loggingLevel(g){N.e.loggingLevel=g}static get CleanBoneMatrixWeights(){return N.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(g){N.e.CleanBoneMatrixWeights=g}static GetDefaultPlugin(){return R()}static GetPluginForExtension(g){var i;return null===(i=x(g,!0))||void 0===i?void 0:i.plugin}static IsPluginForExtensionAvailable(g){return function(g){return!!D[g]}(g)}static RegisterPlugin(g){P(g)}static ImportMesh(g,i,a,n,L,d,b,e,N){Y(g,i,a,n,L,d,b,e,N).catch((g=>null===b||void 0===b?void 0:b(k.c.LastCreatedScene,null===g||void 0===g?void 0:g.message,g)))}static async ImportMeshAsync(g,i,a,n,L,d,b){return await f(g,i,a,n,L,d,b)}static Load(g,i,a,n,L,d,b,e){C(g,i,a,n,L,d,b,e).catch((g=>null===d||void 0===d?void 0:d(k.c.LastCreatedScene,null===g||void 0===g?void 0:g.message,g)))}static async LoadAsync(g,i,a,n,L,d){return await U(g,i,a,n,L,d)}static Append(g,i,a,n,L,d,b,e){S(g,i,a,n,L,d,b,e).catch((g=>null===d||void 0===d?void 0:d(a??k.c.LastCreatedScene,null===g||void 0===g?void 0:g.message,g)))}static async AppendAsync(g,i,a,n,L,d){return await V(g,i,a,n,L,d)}static LoadAssetContainer(g,i,a,n,L,d,b,e){K(g,i,a,n,L,d,b,e).catch((g=>null===d||void 0===d?void 0:d(a??k.c.LastCreatedScene,null===g||void 0===g?void 0:g.message,g)))}static async LoadAssetContainerAsync(g,i,a,n,L,d){return await T(g,i,a,n,L,d)}static ImportAnimations(g,i,a,n,L,d,b,e,N,F,I){l(g,i,a,n,L,d,b,e,N,F,I).catch((g=>null===N||void 0===N?void 0:N(a??k.c.LastCreatedScene,null===g||void 0===g?void 0:g.message,g)))}static async ImportAnimationsAsync(g,i,a,n,L,d,b,k,e,N,F){return await Z(g,i,a,n,L,d,k,N,F)}}h.NO_LOGGING=0,h.MINIMAL_LOGGING=1,h.SUMMARY_LOGGING=2,h.DETAILED_LOGGING=3,h.OnPluginActivatedObservable=c},14168:(g,i,a)=>{"use strict";a.d(i,{c:()=>j});var n=a(12441),L=a(12447),d=a(12277),b=a(12452),k=a(12475),e=a(12436),N=a(12415),F=a(12286),I=a(12484);a(14175);class j extends k.c{set boundingBoxSize(g){if(this._boundingBoxSize&&this._boundingBoxSize.equals(g))return;this._boundingBoxSize=g;const i=this.Pg();i&&i.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(g){this._rotationY=g,this.setReflectionTextureMatrix(b.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(g,i,a){let n="";for(const L of g)n+=L;return new j(n,i,null,a,g)}static CreateFromPrefilteredData(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const L=i.useDelayedTextureLoading;i.useDelayedTextureLoading=!1;const d=new j(g,i,null,!1,null,null,null,void 0,!0,a,n);return i.useDelayedTextureLoading=L,d}constructor(g,i){var a;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,j=arguments.length>8&&void 0!==arguments[8]&&arguments[8],y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,B=arguments.length>10&&void 0!==arguments[10]&&arguments[10],c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,D=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,p=arguments.length>13?arguments[13]:void 0,R=arguments.length>14?arguments[14]:void 0;super(i),this.onLoadObservable=new F.b,this.boundingBoxPosition=b.Bi.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new b.Matrix,this._buffer=null,this.name=g,this.url=g,this._noMipmap=L,this.Ud=!1,this.isCube=!0,this._textureMatrix=b.Matrix.Identity(),this.coordinatesMode=e.c.CUBIC_MODE;let x=null,E=null;null===n||Array.isArray(n)?(this._noMipmap=L,this._format=I,this._createPolynomials=B,x=n,this._loaderOptions=p,this._useSRGBBuffer=R,this._lodScale=c,this._lodOffset=D):(x=n.extensions??null,this._noMipmap=n.noMipmap??!1,d=n.files??null,E=n.buffer??null,this._format=n.format??5,j=n.prefiltered??!1,y=n.forcedExtension??null,this._createPolynomials=n.createPolynomials??!1,this._lodScale=n.lodScale??.8,this._lodOffset=n.lodOffset??0,this._loaderOptions=n.loaderOptions,this._useSRGBBuffer=n.useSRGBBuffer,k=n.W??null,N=n.onError??null),(g||d)&&this.updateURL(g,y,k,j,N,x,null===(a=this.Pg())||void 0===a?void 0:a.useDelayedTextureLoading,d,E)}getClassName(){return"CubeTexture"}updateURL(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=g),this.url=g,i&&(this._forcedExtension=i);const N=g.lastIndexOf("."),F=i||(N>-1?g.substring(N).toLowerCase():""),I=0===F.indexOf(".dds"),j=0===F.indexOf(".env"),y=0===F.indexOf(".basis");if(j?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=n,n&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),k)this._files=k;else if(y||j||I||d||(d=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,d){for(let i=0;i<d.length;i++)this._files.push(g+d[i]);this._extensions=d}this._buffer=e,b?(this.delayLoadState=4,this._delayedOnLoad=a,this._delayedOnError=L):this._loadTexture(a,L)}delayLoad(g){4===this.delayLoadState&&(g&&(this._forcedExtension=g),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(g){var i,a;if(g.updateFlag===this._textureMatrix.updateFlag)return;g.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(a=this.Pg())||void 0===a||a.markAllMaterialsAsDirty(1,(g=>-1!==g.getActiveTextures().indexOf(this))));if(this._textureMatrix=g,null===(i=this.Pg())||void 0===i||!i.useRightHandedSystem)return;const n=b.TmpVectors.Bi[0],L=b.TmpVectors.Quaternion[0],d=b.TmpVectors.Bi[1];this._textureMatrix.decompose(n,L,d),L.z*=-1,L.w*=-1,b.Matrix.ComposeToRef(n,L,d,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var g;return null!==(g=this.Pg())&&void 0!==g&&g.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=this.Pg(),n=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const L=()=>{var i;(this.onLoadObservable.notifyObservers(this),n)&&(n.dispose(),null===(i=this.Pg())||void 0===i||i.markAllMaterialsAsDirty(1));g&&g()},b=(g,a)=>{this._loadingError=!0,this._errorObject={message:g,exception:a},i&&i(g,a),e.c.OnTextureLoadErrorObservable.notifyObservers(this)};var k;this._texture?this._texture.isReady?d.Tools.SetImmediate((()=>L())):this._texture.onLoadedObservable.add((()=>L())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,a,this._lodScale,this._lodOffset,g,b,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,a,this._files,this._noMipmap,g,b,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(k=this._texture)||void 0===k||k.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(g,i,a){const n=I.c.Parse((()=>{let n=!1;return g.prefiltered&&(n=g.prefiltered),new j(a+(g.url??g.name),i,g.extensions,!1,g.files||null,null,null,void 0,n,g.forcedExtension)}),g,i);if(g.boundingBoxPosition&&(n.boundingBoxPosition=b.Bi.xi(g.boundingBoxPosition)),g.boundingBoxSize&&(n.boundingBoxSize=b.Bi.xi(g.boundingBoxSize)),g.animations)for(let L=0;L<g.animations.length;L++){const i=g.animations[L],a=(0,N.d)("BABYLON.Animation");a&&n.animations.push(a.Parse(i))}return n}clone(){let g=0;const i=I.c.Clone((()=>{const i=new j(this.url,this.Pg()||this._getEngine(),this._extensions,this._noMipmap,this._files);return g=i.uniqueId,i}),this);return i.uniqueId=g,i}}(0,n.e)([(0,L.P)()],j.prototype,"url",void 0),(0,n.e)([(0,L.M)()],j.prototype,"boundingBoxPosition",void 0),(0,n.e)([(0,L.M)()],j.prototype,"boundingBoxSize",null),(0,n.e)([(0,L.P)("rotationY")],j.prototype,"rotationY",null),(0,n.e)([(0,L.P)("files")],j.prototype,"_files",void 0),(0,n.e)([(0,L.P)("forcedExtension")],j.prototype,"_forcedExtension",void 0),(0,n.e)([(0,L.P)("extensions")],j.prototype,"_extensions",void 0),(0,n.e)([(0,L.B)("textureMatrix")],j.prototype,"_textureMatrix",void 0),(0,n.e)([(0,L.B)("textureMatrixRefraction")],j.prototype,"_textureMatrixRefraction",void 0),e.c._CubeTextureParser=j.Parse,(0,N.e)("BABYLON.CubeTexture",j)},14715:(g,i,a)=>{"use strict";a.d(i,{e:()=>e});var n=a(12292),L=a(12436),d=a(12426),b=a(12578),k=a(12392);b.ThinEngine.prototype.createDynamicTexture=function(g,i,a,n){const L=new k.d(this,4);return L.baseWidth=g,L.baseHeight=i,a&&(g=this.needPOTTextures?(0,d.d)(g,this._caps.maxTextureSize):g,i=this.needPOTTextures?(0,d.d)(i,this._caps.maxTextureSize):i),L.width=g,L.height=i,L.isReady=!1,L.generateMipMaps=a,L.samplingMode=n,this.updateTextureSamplingMode(n,L),this._internalTexturesCache.push(L),L},b.ThinEngine.prototype.updateDynamicTexture=function(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!g)return;const b=this._gl,k=b.TEXTURE_2D,e=this._bindTextureDirectly(k,g,!0,d);this._unpackFlipY(void 0===a?g.invertY:a),n&&b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const N=this._getWebGLTextureType(g.type),F=this._getInternalFormat(L||g.format),I=this._getRGBABufferInternalSizedFormat(g.type,F);b.texImage2D(k,0,I,F,N,i),g.generateMipMaps&&b.generateMipmap(k),e||this._bindTextureDirectly(k,null),n&&b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),L&&(g.format=L),g._dynamicTextureSource=i,g._premulAlpha=n,g.invertY=a||!1,g.isReady=!0};class e extends L.c{constructor(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,k=arguments.length>6?arguments[6]:void 0;const e=!a||a._isScene;super(null,e?a:null===a||void 0===a?void 0:a.Di,e?!n:a,k,d,void 0,void 0,void 0,void 0,b),this.name=g,this.wrapU=L.c.CLAMP_ADDRESSMODE,this.wrapV=L.c.CLAMP_ADDRESSMODE,this._generateMipMaps=n;const N=this._getEngine();if(!N)return;if(i.getContext)this._canvas=i,this._ownCanvas=!1,this._texture=N.createDynamicTexture(this._canvas.width,this._canvas.height,n,d);else{this._canvas=N.createCanvas(1,1),this._ownCanvas=!0;const g=i;g.width||0===g.width?this._texture=N.createDynamicTexture(g.width,g.height,n,d):this._texture=N.createDynamicTexture(i,i,n,d)}const F=this.getSize();this._canvas.width!==F.width&&(this._canvas.width=F.width),this._canvas.height!==F.height&&(this._canvas.height=F.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(g){this._canvas.width=g.width,this._canvas.height=g.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(g.width,g.height,this._generateMipMaps,this.samplingMode)}scale(g){const i=this.getSize();i.width*=g,i.height*=g,this._recreate(i)}scaleTo(g,i){const a=this.getSize();a.width=g,a.height=i,this._recreate(a)}getContext(){return this._context}clear(g){const i=this.getSize();g&&(this._context.fillStyle=g),this._context.clearRect(0,0,i.width,i.height)}update(g){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===g||g,i,this._format||void 0,void 0,a)}drawText(g,i,a,n,L,d,b){let k=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const e=this.getSize();if(d&&(this._context.fillStyle=d,this._context.fillRect(0,0,e.width,e.height)),this._context.font=n,null===i||void 0===i){const a=this._context.measureText(g);i=(e.width-a.width)/2}if(null===a||void 0===a){const g=parseInt(n.replace(/\D/g,""));a=e.height/2+g/3.65}this._context.fillStyle=L||"",this._context.fillText(g,i,a),k&&this.update(b)}dispose(){var g,i;(super.dispose(),this._ownCanvas)&&(null===(g=this._canvas)||void 0===g||null===(i=g.remove)||void 0===i||i.call(g));this._canvas=null,this._context=null}clone(){const g=this.Pg();if(!g)return this;const i=this.getSize(),a=new e(this.name,i,g,this._generateMipMaps);return a.Ud=this.Ud,a.level=this.level,a.wrapU=this.wrapU,a.wrapV=this.wrapV,a}serialize(){const g=this.Pg();g&&!g.isReady()&&n.b.Warn("The scene must be ready before serializing the dynamic texture");const i=super.serialize();return e._IsCanvasElement(this._canvas)&&(i.base64String=this._canvas.toDataURL()),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i}static _IsCanvasElement(g){return void 0!==g.toDataURL}_rebuild(){this.update()}}},14058:(g,i,a)=>{"use strict";a.d(i,{d:()=>L});var n=a(12436);class L extends n.c{get depth(){return this._depth}constructor(g,i,a,L,d,b){let k=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],e=arguments.length>7&&void 0!==arguments[7]&&arguments[7],N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:n.c.TRILINEAR_SAMPLINGMODE,F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,I=arguments.length>10?arguments[10]:void 0;super(null,b,!k,e),this.format=d,this._texture=b.getEngine().createRawTexture2DArray(g,i,a,L,d,k,e,N,null,F,I),this._depth=L,this.is2DArray=!0}update(g){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,g,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(g,i,a,n,d){return new L(g,i,a,n,5,d,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13858:(g,i,a)=>{"use strict";a.d(i,{c:()=>k,g:()=>e,j:()=>d,l:()=>b});var n=a(12466),L=a(12452);function d(g,i){return`{X: ${g.x.toFixed(i)} Y: ${g.y.toFixed(i)}}`}function b(g,i){return`{X: ${g._x.toFixed(i)} Y: ${g._y.toFixed(i)} Z: ${g._z.toFixed(i)}}`}function k(g,i){return 2*Math.acos((0,n.Clamp)(L.Quaternion.Dot(g,i)))}function e(g,i){const a=new L.Quaternion;return function(g,i,a){const d=L.Bi.Cross(g,i),b=Math.acos((0,n.Clamp)(L.Bi.Dot(g,i),-1,1));L.Quaternion.RotationAxisToRef(d,b,a)}(g,i,a),a}},13701:(g,i,a)=>{"use strict";a.d(i,{c:()=>N});var n=a(12452),L=a(12496),d=a(12910),b=a(12896),k=a(12501);a(13704);function e(g){let i=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const a=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],d=[];let e=[];const N=g.width||g.size||1,F=g.height||g.size||1,I=g.depth||g.size||1,j=g.wrap||!1;let y=void 0===g.topBaseAt?1:g.topBaseAt,B=void 0===g.bottomBaseAt?0:g.bottomBaseAt;y=(y+4)%4,B=(B+4)%4;let c=[2,0,3,1][y],D=[2,0,1,3][B],p=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(j){i=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],p=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let g=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],a=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const n=[17,18,19,16],L=[22,23,20,21];for(;c>0;)g.unshift(g.pop()),n.unshift(n.pop()),c--;for(;D>0;)a.unshift(a.pop()),L.unshift(L.pop()),D--;g=g.flat(),a=a.flat(),p=p.concat(g).concat(a),i.push(n[0],n[2],n[3],n[0],n[1],n[2]),i.push(L[0],L[2],L[3],L[0],L[1],L[2])}const R=[N/2,F/2,I/2];e=p.reduce(((g,i,a)=>g.concat(i*R[a%3])),[]);const x=0===g.sideOrientation?0:g.sideOrientation||b.c.DEFAULTSIDE,E=g.faceUV||new Array(6),X=g.faceColors,v=[];for(let b=0;b<6;b++)void 0===E[b]&&(E[b]=new n.Vector4(0,0,1,1)),X&&void 0===X[b]&&(X[b]=new L.Hd(1,1,1,1));for(let n=0;n<6;n++)if(d.push(E[n].z,k.e?1-E[n].w:E[n].w),d.push(E[n].x,k.e?1-E[n].w:E[n].w),d.push(E[n].x,k.e?1-E[n].y:E[n].y),d.push(E[n].z,k.e?1-E[n].y:E[n].y),X)for(let g=0;g<4;g++)v.push(X[n].r,X[n].g,X[n].b,X[n].a);b.c._ComputeSides(x,e,i,a,d,g.frontUVs,g.backUVs);const P=new b.c;if(P.indices=i,P.fg=e,P.Cg=a,P.Sg=d,X){const g=x===b.c.DOUBLESIDE?v.concat(v):v;P.Ug=g}return P}function N(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new d.e(g,a);i.sideOrientation=d.e._GetDefaultSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;return e(i).Kg(n,i.updatable),n}b.c.CreateBox=e,d.e.CreateBox=function(g,i){return N(g,{size:i,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13844:(g,i,a)=>{"use strict";a.d(i,{b:()=>k});var n=a(12910),L=a(12896),d=a(12501);function b(g){const i=[],a=[],n=[],b=[],k=g.radius||.5,e=g.tessellation||64,N=g.arc&&(g.arc<=0||g.arc>1)?1:g.arc||1,F=0===g.sideOrientation?0:g.sideOrientation||L.c.DEFAULTSIDE;i.push(0,0,0),b.push(.5,.5);const I=2*Math.PI*N,j=1===N?I/e:I/(e-1);let y=0;for(let L=0;L<e;L++){const g=Math.cos(y),a=Math.sin(y),n=(g+1)/2,L=(1-a)/2;i.push(k*g,k*a,0),b.push(n,d.e?1-L:L),y+=j}1===N&&(i.push(i[3],i[4],i[5]),b.push(b[2],d.e?1-b[3]:b[3]));const B=i.length/3;for(let L=1;L<B-1;L++)a.push(L+1,0,L);L.c.ComputeNormals(i,a,n),L.c._ComputeSides(F,i,a,n,b,g.frontUVs,g.backUVs);const c=new L.c;return c.indices=a,c.fg=i,c.Cg=n,c.Sg=b,c}function k(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new n.e(g,a);i.sideOrientation=n.e._GetDefaultSideOrientation(i.sideOrientation),L._originalBuilderSideOrientation=i.sideOrientation;return b(i).Kg(L,i.updatable),L}L.c.CreateDisc=b,n.e.CreateDisc=function(g,i,a){return k(g,{radius:i,tessellation:a,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13704:(g,i,a)=>{"use strict";a.d(i,{c:()=>D,b:()=>R,e:()=>p});var n=a(12452),L=a(12496),d=a(12910),b=a(12896),k=a(12526);d.e._GroundMeshParser=(g,i)=>e.Parse(g,i);class e extends d.e{constructor(g,i){super(g,i),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=g,this._subdivisionsY=g,this.subdivide(g);const a=this;a.createOrUpdateSubmeshesOctree&&a.createOrUpdateSubmeshesOctree(i)}getHeightAtCoordinates(g,i){const a=this.getWorldMatrix(),L=n.TmpVectors.Matrix[5];a.invertToRef(L);const d=n.TmpVectors.Bi[8];if(n.Bi.TransformCoordinatesFromFloatsToRef(g,0,i,L,d),g=d.x,i=d.z,g<this._minX||g>=this._maxX||i<=this._minZ||i>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const b=this._getFacetAt(g,i),k=-(b.x*g+b.z*i+b.w)/b.y;return n.Bi.TransformCoordinatesFromFloatsToRef(0,k,0,a,d),d.y}getNormalAtCoordinates(g,i){const a=new n.Bi(0,1,0);return this.getNormalAtCoordinatesToRef(g,i,a),a}getNormalAtCoordinatesToRef(g,i,a){const L=this.getWorldMatrix(),d=n.TmpVectors.Matrix[5];L.invertToRef(d);const b=n.TmpVectors.Bi[8];if(n.Bi.TransformCoordinatesFromFloatsToRef(g,0,i,d,b),g=b.x,i=b.z,g<this._minX||g>this._maxX||i<this._minZ||i>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const k=this._getFacetAt(g,i);return n.Bi.TransformNormalFromFloatsToRef(k.x,k.y,k.z,L,a),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(g,i){const a=Math.floor((g+this._maxX)*this._subdivisionsX/this._width),n=Math.floor(-(i+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),L=this._heightQuads[n*this._subdivisionsX+a];let d;return d=i<L.slope.x*g+L.slope.y?L.facet1:L.facet2,d}_initHeightQuads(){const g=this._subdivisionsX,i=this._subdivisionsY;this._heightQuads=[];for(let a=0;a<i;a++)for(let i=0;i<g;i++){const L={slope:n.Vector2.Zero(),facet1:new n.Vector4(0,0,0,0),facet2:new n.Vector4(0,0,0,0)};this._heightQuads[a*g+i]=L}return this}_computeHeightQuads(){const g=this.getVerticesData(k.g.PositionKind);if(!g)return this;const i=n.TmpVectors.Bi[3],a=n.TmpVectors.Bi[2],L=n.TmpVectors.Bi[1],d=n.TmpVectors.Bi[0],b=n.TmpVectors.Bi[4],e=n.TmpVectors.Bi[5],N=n.TmpVectors.Bi[6],F=n.TmpVectors.Bi[7],I=n.TmpVectors.Bi[8];let j=0,y=0,B=0,c=0,D=0,p=0,R=0;const x=this._subdivisionsX,E=this._subdivisionsY;for(let k=0;k<E;k++)for(let E=0;E<x;E++){j=3*E,y=k*(x+1)*3,B=(k+1)*(x+1)*3,i.x=g[y+j],i.y=g[y+j+1],i.z=g[y+j+2],a.x=g[y+j+3],a.y=g[y+j+4],a.z=g[y+j+5],L.x=g[B+j],L.y=g[B+j+1],L.z=g[B+j+2],d.x=g[B+j+3],d.y=g[B+j+4],d.z=g[B+j+5],c=(d.z-i.z)/(d.x-i.x),D=i.z-c*i.x,a.subtractToRef(i,b),L.subtractToRef(i,e),d.subtractToRef(i,N),n.Bi.CrossToRef(N,e,F),n.Bi.CrossToRef(b,N,I),F.normalize(),I.normalize(),p=-(F.x*i.x+F.y*i.y+F.z*i.z),R=-(I.x*a.x+I.y*a.y+I.z*a.z);const X=this._heightQuads[k*x+E];X.slope.sd(c,D),X.facet1.sd(F.x,F.y,F.z,p),X.facet2.sd(I.x,I.y,I.z,R)}return this}serialize(g){super.serialize(g),g.subdivisionsX=this._subdivisionsX,g.subdivisionsY=this._subdivisionsY,g.minX=this._minX,g.maxX=this._maxX,g.Vd=this._minZ,g.maxZ=this._maxZ,g.width=this._width,g.height=this._height}static Parse(g,i){const a=new e(g.name,i);return a._subdivisionsX=g.subdivisionsX||1,a._subdivisionsY=g.subdivisionsY||1,a._minX=g.minX,a._maxX=g.maxX,a._minZ=g.Vd,a._maxZ=g.maxZ,a._width=g.width,a._height=g.height,a}}var N=a(12277),F=a(12316),I=a(12454),j=a(12501);function y(g){const i=[],a=[],L=[],d=[];let k,e;const N=g.width||g.size||1,F=g.height||g.size||1,I=0|(g.subdivisionsX||g.subdivisions||1),y=0|(g.subdivisionsY||g.subdivisions||1);for(k=0;k<=y;k++)for(e=0;e<=I;e++){const g=new n.Bi(e*N/I-N/2,0,(y-k)*F/y-F/2),i=new n.Bi(0,1,0);a.push(g.x,g.y,g.z),L.push(i.x,i.y,i.z),d.push(e/I,j.e?k/y:1-k/y)}for(k=0;k<y;k++)for(e=0;e<I;e++)i.push(e+1+(k+1)*(I+1)),i.push(e+1+k*(I+1)),i.push(e+k*(I+1)),i.push(e+(k+1)*(I+1)),i.push(e+1+(k+1)*(I+1)),i.push(e+k*(I+1));const B=new b.c;return B.indices=i,B.fg=a,B.Cg=L,B.Sg=d,B}function B(g){const i=void 0!==g.xmin&&null!==g.xmin?g.xmin:-1,a=void 0!==g.zmin&&null!==g.zmin?g.zmin:-1,L=void 0!==g.xmax&&null!==g.xmax?g.xmax:1,d=void 0!==g.zmax&&null!==g.zmax?g.zmax:1,k=g.subdivisions||{w:1,h:1},e=g.precision||{w:1,h:1},N=[],F=[],I=[],j=[];let y,B,c,D;k.h=k.h<1?1:k.h,k.w=k.w<1?1:k.w,e.w=e.w<1?1:e.w,e.h=e.h<1?1:e.h;const p=(L-i)/k.w,R=(d-a)/k.h;function x(g,i,a,L){const d=F.length/3,b=e.w+1;for(y=0;y<e.h;y++)for(B=0;B<e.w;B++){const g=[d+B+y*b,d+(B+1)+y*b,d+(B+1)+(y+1)*b,d+B+(y+1)*b];N.push(g[1]),N.push(g[2]),N.push(g[3]),N.push(g[0]),N.push(g[1]),N.push(g[3])}const k=n.Bi.Zero(),c=new n.Bi(0,1,0);for(y=0;y<=e.h;y++)for(k.z=y*(L-i)/e.h+i,B=0;B<=e.w;B++)k.x=B*(a-g)/e.w+g,k.y=0,F.push(k.x,k.y,k.z),I.push(c.x,c.y,c.z),j.push(B/e.w,y/e.h)}for(c=0;c<k.h;c++)for(D=0;D<k.w;D++)x(i+D*p,a+c*R,i+(D+1)*p,a+(c+1)*R);const E=new b.c;return E.indices=N,E.fg=F,E.Cg=I,E.Sg=j,E}function c(g){const i=[],a=[],d=[],k=[];let e,N;const F=g.colorFilter||new L.Ri(.3,.59,.11),j=g.alphaFilter||0;let y=!1;if(g.minHeight>g.maxHeight){y=!0;const i=g.maxHeight;g.maxHeight=g.minHeight,g.minHeight=i}for(e=0;e<=g.subdivisions;e++)for(N=0;N<=g.subdivisions;N++){const i=new n.Bi(N*g.width/g.subdivisions-g.width/2,0,(g.subdivisions-e)*g.height/g.subdivisions-g.height/2),L=4*(((i.x+g.width/2)/g.width*(g.bufferWidth-1)|0)+((1-(i.z+g.height/2)/g.height)*(g.bufferHeight-1)|0)*g.bufferWidth);let b=g.buffer[L]/255,B=g.buffer[L+1]/255,c=g.buffer[L+2]/255;const D=g.buffer[L+3]/255;y&&(b=1-b,B=1-B,c=1-c);const p=b*F.r+B*F.g+c*F.b;i.y=D>=j?g.minHeight+(g.maxHeight-g.minHeight)*p:g.minHeight-I.b,g.heightBuffer&&(g.heightBuffer[e*(g.subdivisions+1)+N]=i.y),a.push(i.x,i.y,i.z),d.push(0,0,0),k.push(N/g.subdivisions,1-e/g.subdivisions)}for(e=0;e<g.subdivisions;e++)for(N=0;N<g.subdivisions;N++){const n=N+1+(e+1)*(g.subdivisions+1),L=N+1+e*(g.subdivisions+1),d=N+e*(g.subdivisions+1),b=N+(e+1)*(g.subdivisions+1),k=a[3*n+1]>=g.minHeight,F=a[3*L+1]>=g.minHeight,I=a[3*d+1]>=g.minHeight;k&&F&&I&&(i.push(n),i.push(L),i.push(d));a[3*b+1]>=g.minHeight&&k&&I&&(i.push(b),i.push(n),i.push(d))}b.c.ComputeNormals(a,i,d);const B=new b.c;return B.indices=i,B.fg=a,B.Cg=d,B.Sg=k,B}function D(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=new e(g,arguments.length>2?arguments[2]:void 0);a._setReady(!1),a._subdivisionsX=i.subdivisionsX||i.subdivisions||1,a._subdivisionsY=i.subdivisionsY||i.subdivisions||1,a._width=i.width||1,a._height=i.height||1,a._maxX=a._width/2,a._maxZ=a._height/2,a._minX=-a._maxX,a._minZ=-a._maxZ;return y(i).Kg(a,i.updatable),a._setReady(!0),a}function p(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new d.e(g,a);return B(i).Kg(n,i.updatable),n}function R(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const d=a.width||10,b=a.height||10,k=a.subdivisions||1,I=a.minHeight||0,j=a.maxHeight||1,y=a.colorFilter||new L.Ri(.3,.59,.11),B=a.alphaFilter||0,D=a.updatable,p=a.onReady;n=n||F.c.LastCreatedScene;const R=new e(g,n);let x;R._subdivisionsX=k,R._subdivisionsY=k,R._width=d,R._height=b,R._maxX=R._width/2,R._maxZ=R._height/2,R._minX=-R._maxX,R._minZ=-R._maxZ,R._setReady(!1),a.passHeightBufferInCallback&&(x=new Float32Array((k+1)*(k+1)));const E=(g,i,a)=>{c({width:d,height:b,subdivisions:k,minHeight:I,maxHeight:j,colorFilter:y,buffer:g,bufferWidth:i,bufferHeight:a,alphaFilter:B,heightBuffer:x}).Kg(R,D),p&&p(R,x),R._setReady(!0)};if("string"===typeof i){const g=g=>{var i;const a=g.width,L=g.height;if(n.p)return;const d=null===(i=n)||void 0===i?void 0:i.getEngine().resizeImageBitmap(g,a,L);E(d,a,L)};N.Tools.LoadImage(i,g,a.onError?a.onError:()=>{},n.offlineProvider)}else E(i.data,i.width,i.height);return R}b.c.CreateGround=y,b.c.CreateTiledGround=B,b.c.CreateGroundFromHeightMap=c,d.e.CreateGround=(g,i,a,n,L,d)=>D(g,{width:i,height:a,subdivisions:n,updatable:d},L),d.e.CreateTiledGround=(g,i,a,n,L,d,b,k,e)=>p(g,{xmin:i,zmin:a,xmax:n,zmax:L,subdivisions:d,precision:b,updatable:e},k),d.e.CreateGroundFromHeightMap=(g,i,a,n,L,d,b,k,e,N,F)=>R(g,i,{width:a,height:n,subdivisions:L,minHeight:d,maxHeight:b,updatable:e,onReady:N,alphaFilter:F},k)},14428:(g,i,a)=>{"use strict";a.d(i,{e:()=>y,f:()=>I,g:()=>j});var n=a(12452),L=a(12910),d=a(12896),b=a(13011),k=a(12526),e=a(12292);function N(g){const i=[],a=[],n=g.lines,L=g.Ug,b=[];let k=0;for(let d=0;d<n.length;d++){const g=n[d];for(let n=0;n<g.length;n++){const{x:e,y:N,z:F}=g[n];if(a.push(e,N,F),L){const g=L[d],{r:i,g:a,b:k,a:e}=g[n];b.push(i,a,k,e)}n>0&&(i.push(k-1),i.push(k)),k++}}const e=new d.c;return e.indices=i,e.fg=a,L&&(e.Ug=b),e}function F(g){const i=g.dashSize||3,a=g.gapSize||1,L=g.dashNb||200,b=g.points,k=[],e=[],N=n.Bi.Zero();let F=0,I=0,j=0,y=0,B=0,c=0,D=0;for(D=0;D<b.length-1;D++)b[D+1].subtractToRef(b[D],N),F+=N.length();for(j=F/L,y=i*j/(i+a),D=0;D<b.length-1;D++){b[D+1].subtractToRef(b[D],N),I=Math.floor(N.length()/j),N.normalize();for(let g=0;g<I;g++)B=j*g,k.push(b[D].x+B*N.x,b[D].y+B*N.y,b[D].z+B*N.z),k.push(b[D].x+(B+y)*N.x,b[D].y+(B+y)*N.y,b[D].z+(B+y)*N.z),e.push(c,c+1),c+=2}const p=new d.c;return p.fg=k,p.indices=e,p}function I(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=i.instance,L=i.lines,d=i.Ug;if(n){const g=n.getVerticesData(k.g.PositionKind);let i,a;d&&(i=n.getVerticesData(k.g.ColorKind));let b=0,e=0;for(let n=0;n<L.length;n++){const k=L[n];for(let L=0;L<k.length;L++)g[b]=k[L].x,g[b+1]=k[L].y,g[b+2]=k[L].z,d&&i&&(a=d[n],i[e]=a[L].r,i[e+1]=a[L].g,i[e+2]=a[L].b,i[e+3]=a[L].a,e+=4),b+=3}return n.updateVerticesData(k.g.PositionKind,g,!1,!1),d&&i&&n.updateVerticesData(k.g.ColorKind,i,!1,!1),n.refreshBoundingInfo(),n}const e=!!d,F=new b.d(g,a,null,void 0,void 0,e,i.useVertexAlpha,i.material);return N(i).Kg(F,i.updatable),F}function j(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=i.Ug?[i.Ug]:null;return I(g,{lines:[i.points],updatable:i.updatable,instance:i.instance,Ug:n,useVertexAlpha:i.useVertexAlpha,material:i.material},a)}function y(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=i.points,k=i.instance,N=i.gapSize||1,I=i.dashSize||3;if(k){const g=g=>{const i=n.Bi.Zero(),a=g.length/6;let L=0,b=0,e=0,N=0,F=0,I=0,j=0,y=0;for(j=0;j<d.length-1;j++)d[j+1].subtractToRef(d[j],i),L+=i.length();e=L/a;const B=k._creationDataStorage.dashSize;for(N=B*e/(B+k._creationDataStorage.gapSize),j=0;j<d.length-1;j++)for(d[j+1].subtractToRef(d[j],i),b=Math.floor(i.length()/e),i.normalize(),y=0;y<b&&I<g.length;)F=e*y,g[I]=d[j].x+F*i.x,g[I+1]=d[j].y+F*i.y,g[I+2]=d[j].z+F*i.z,g[I+3]=d[j].x+(F+N)*i.x,g[I+4]=d[j].y+(F+N)*i.y,g[I+5]=d[j].z+(F+N)*i.z,I+=6,y++;for(;I<g.length;)g[I]=d[j].x,g[I+1]=d[j].y,g[I+2]=d[j].z,I+=3};return(i.dashNb||i.dashSize||i.gapSize||i.useVertexAlpha||i.material)&&e.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),k.updateMeshPositions(g,!1),k}const j=new b.d(g,a,null,void 0,void 0,void 0,i.useVertexAlpha,i.material);return F(i).Kg(j,i.updatable),j._creationDataStorage=new L.f,j._creationDataStorage.dashSize=I,j._creationDataStorage.gapSize=N,j}d.c.CreateLineSystem=N,d.c.CreateDashedLines=F,L.e.RF=function(g,i){return j(g,{points:i,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},L.e.CreateDashedLines=function(g,i,a,n,L){return y(g,{points:i,dashSize:a,gapSize:n,dashNb:L,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13748:(g,i,a)=>{"use strict";a.d(i,{c:()=>k,g:()=>e});var n=a(12910),L=a(12896),d=a(12501);function b(g){const i=[],a=[],n=[],b=[],k=void 0!==g.width?g.width:void 0!==g.size?g.size:1,e=void 0!==g.height?g.height:void 0!==g.size?g.size:1,N=0===g.sideOrientation?0:g.sideOrientation||L.c.DEFAULTSIDE,F=k/2,I=e/2;a.push(-F,-I,0),n.push(0,0,-1),b.push(0,d.e?1:0),a.push(F,-I,0),n.push(0,0,-1),b.push(1,d.e?1:0),a.push(F,I,0),n.push(0,0,-1),b.push(1,d.e?0:1),a.push(-F,I,0),n.push(0,0,-1),b.push(0,d.e?0:1),i.push(0),i.push(1),i.push(2),i.push(0),i.push(2),i.push(3),L.c._ComputeSides(N,a,i,n,b,g.frontUVs,g.backUVs);const j=new L.c;return j.indices=i,j.fg=a,j.Cg=n,j.Sg=b,j}function k(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new n.e(g,a);i.sideOrientation=n.e._GetDefaultSideOrientation(i.sideOrientation),L._originalBuilderSideOrientation=i.sideOrientation;return b(i).Kg(L,i.updatable),i.sourcePlane&&(L.translate(i.sourcePlane.normal,-i.sourcePlane.d),L.setDirection(i.sourcePlane.normal.scale(-1))),L}const e={XF:k};L.c.XF=b,n.e.XF=(g,i,a,n,L)=>k(g,{size:i,width:i,height:i,sideOrientation:L,updatable:n},a)},13836:(g,i,a)=>{"use strict";a.d(i,{d:()=>e});var n=a(12452),L=a(12910),d=a(12896),b=a(12501);function k(g){const i=0|(g.segments||32),a=g.diameterX||g.diameter||1,L=g.diameterY||g.diameter||1,k=g.diameterZ||g.diameter||1,e=g.arc&&(g.arc<=0||g.arc>1)?1:g.arc||1,N=g.slice&&g.slice<=0?1:g.slice||1,F=0===g.sideOrientation?0:g.sideOrientation||d.c.DEFAULTSIDE,I=!!g.dedupTopBottomIndices,j=new n.Bi(a/2,L/2,k/2),y=2+i,B=2*y,c=[],D=[],p=[],R=[];for(let d=0;d<=y;d++){const g=d/y,i=g*Math.PI*N;for(let a=0;a<=B;a++){const L=a/B,d=L*Math.PI*2*e,k=n.Matrix.RotationZ(-i),N=n.Matrix.RotationY(d),F=n.Bi.TransformCoordinates(n.Bi.Up(),k),I=n.Bi.TransformCoordinates(F,N),y=I.multiply(j),c=I.divide(j).normalize();D.push(y.x,y.y,y.z),p.push(c.x,c.y,c.z),R.push(L,b.e?1-g:g)}if(d>0){const g=D.length/3;for(let i=g-2*(B+1);i+B+2<g;i++)I?(d>1&&(c.push(i),c.push(i+1),c.push(i+B+1)),(d<y||N<1)&&(c.push(i+B+1),c.push(i+1),c.push(i+B+2))):(c.push(i),c.push(i+1),c.push(i+B+1),c.push(i+B+1),c.push(i+1),c.push(i+B+2))}}d.c._ComputeSides(F,D,c,p,R,g.frontUVs,g.backUVs);const x=new d.c;return x.indices=c,x.fg=D,x.Cg=p,x.Sg=R,x}function e(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new L.e(g,a);i.sideOrientation=L.e._GetDefaultSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;return k(i).Kg(n,i.updatable),n}d.c.CreateSphere=k,L.e.CreateSphere=(g,i,a,n,L,d)=>e(g,{segments:i,diameterX:a,diameterY:a,diameterZ:a,sideOrientation:d,updatable:L},n)},14728:(g,i,a)=>{"use strict";a.d(i,{e:()=>k});var n=a(13040),L=a(14183),d=a(13058),b=a(12896);class k{static get Configuration(){return{get decoder(){return L.c.DefaultConfiguration},set decoder(g){L.c.DefaultConfiguration=g}}}static set Configuration(g){L.c.DefaultConfiguration=g.decoder}static get DecoderAvailable(){return(0,n.h)(L.c.DefaultConfiguration)}static get Default(){return k._Default??(k._Default=new k),k._Default}static ResetDefault(g){k._Default&&(g||k._Default.dispose(),k._Default=null)}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.DefaultNumWorkers;const i="number"===typeof g?{...L.c.DefaultConfiguration,numWorkers:g}:{...L.c.DefaultConfiguration,...g};this._decoder=new L.c(i)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(g,i,a){return this._decoder.decodeMeshToMeshDataAsync(g,i,a)}async decodeMeshToGeometryAsync(g,i,a,n){return await this._decoder.decodeMeshToGeometryAsync(g,i,a,n)}async _decodeMeshToGeometryForGltfAsync(g,i,a,n,L,d){return await this._decoder._decodeMeshToGeometryForGltfAsync(g,i,a,n,L,d)}async decodeMeshAsync(g,i){const a=await this._decoder.decodeMeshToMeshDataAsync(g,i),n=new b.c;a.indices&&(n.indices=a.indices);for(const L of a.attributes){const g=d.e.GetFloatData(L.data,L.size,d.e.GetDataType(L.data),L.byteOffset,L.byteStride,L.normalized,a.totalVertices);n.set(g,L.kind)}return n}}k.DefaultNumWorkers=(0,n.g)(),k._Default=null},14183:(g,i,a)=>{"use strict";a.d(i,{c:()=>N});var n=a(13040),L=a(12277),d=a(12924),b=a(13058),k=a(12292),e=a(13053);class N extends n.d{static get DefaultAvailable(){return(0,n.h)(N.DefaultConfiguration)}static get Default(){return N._Default??(N._Default=new N),N._Default}static ResetDefault(g){N._Default&&(g||N._Default.dispose(),N._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(g,i){return{module:await(i||DracoDecoderModule)({wasmBinary:g})}}_getWorkerContent(){return`${e.b}(${e.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.DefaultConfiguration)}decodeMeshToMeshDataAsync(g,i,a){const n=g instanceof ArrayBuffer?new Int8Array(g):new Int8Array(g.buffer,g.byteOffset,g.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async g=>await new Promise(((L,d)=>{g.push(((g,b)=>{let e=null;const N=[],F=i=>{g.removeEventListener("error",F),g.removeEventListener("message",I),d(i),b()},I=i=>{const n=i.data;switch(n.id){case"indices":e=n.data;break;case"attribute":N.push({kind:n.kind,data:n.data,size:n.size,byteOffset:n.byteOffset,byteStride:n.byteStride,normalized:(d=n.kind,j=n.normalized,a&&void 0!==a[d]?(j!==a[d]&&k.b.Warn(`Normalized flag from Draco data (${j}) does not match normalized flag from glTF accessor (${a[d]}). Using flag from glTF accessor.`),a[d]):j)});break;case"decodeMeshDone":g.removeEventListener("error",F),g.removeEventListener("message",I),L({indices:e,attributes:N,totalVertices:n.totalVertices}),b()}var d,j};g.addEventListener("error",F),g.addEventListener("message",I);const j=n.slice();g.postMessage({id:"decodeMesh",dataView:j,attributes:i},[j.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((g=>{let a=null;const L=[],d=(0,e.b)(g.module,n,i,(g=>{a=g}),((g,i,a,n,d,b)=>{L.push({kind:g,data:i,size:a,byteOffset:n,byteStride:d,normalized:b})}));return{indices:a,attributes:L,totalVertices:d}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(g,i,a,n){const L=await this.decodeMeshToMeshDataAsync(a,n),k=new d.d(g,i);L.indices&&k.setIndices(L.indices);for(const d of L.attributes)k.setVerticesBuffer(new b.e(i.getEngine(),d.data,d.kind,!1,void 0,d.byteStride,void 0,d.byteOffset,d.size,void 0,d.normalized,!0),L.totalVertices);return k}async _decodeMeshToGeometryForGltfAsync(g,i,a,n,L,k){const e=await this.decodeMeshToMeshDataAsync(a,n,L),N=new d.d(g,i);k&&(N._boundingInfo=k,N.useBoundingInfoFromGeometry=!0),e.indices&&N.setIndices(e.indices);for(const d of e.attributes)N.setVerticesBuffer(new b.e(i.getEngine(),d.data,d.kind,!1,void 0,d.byteStride,void 0,d.byteOffset,d.size,void 0,d.normalized,!0),e.totalVertices);return N}}N.DefaultConfiguration={wasmUrl:`${L.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${L.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${L.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},N._Default=null},14420:(g,i,a)=>{"use strict";a.d(i,{e:()=>kg});var n=a(12452),L=a(12910),d=a(12526),b=a(12896),k=a(12501);function e(g){let i=g.pathArray;const a=g.closeArray||!1,n=g.closePath||!1,L=g.invertUV||!1,e=Math.floor(i[0].length/2);let N=g.offset||e;N=N>e?e:Math.floor(N);const F=0===g.sideOrientation?0:g.sideOrientation||b.c.DEFAULTSIDE,I=g.Sg,j=g.Ug,y=[],B=[],c=[],D=[],p=[],R=[],x=[],E=[];let X;const v=[],P=[];let Y,f,C;if(i.length<2){const g=[],a=[];for(f=0;f<i[0].length-N;f++)g.push(i[0][f]),a.push(i[0][f+N]);i=[g,a]}let U=0;const S=n?1:0,V=a?1:0;let K,T,l,Z,h,w;for(X=i[0].length,Y=0;Y<i.length+V;Y++){for(x[Y]=0,p[Y]=[0],K=Y===i.length?i[0]:i[Y],T=K.length,X=X<T?X:T,C=0;C<T;)y.push(K[C].x,K[C].y,K[C].z),C>0&&(l=K[C].ci(K[C-1]).length(),Z=l+x[Y],p[Y].push(Z),x[Y]=Z),C++;n&&(C--,y.push(K[0].x,K[0].y,K[0].z),l=K[C].ci(K[0]).length(),Z=l+x[Y],p[Y].push(Z),x[Y]=Z),v[Y]=T+S,P[Y]=U,U+=T+S}let t,A,O=null,z=null;for(f=0;f<X+S;f++)for(E[f]=0,R[f]=[0],Y=0;Y<i.length-1+V;Y++)h=i[Y],w=Y===i.length-1?i[0]:i[Y+1],f===X?(O=h[0],z=w[0]):(O=h[f],z=w[f]),l=z.ci(O).length(),Z=l+E[f],R[f].push(Z),E[f]=Z;if(I)for(Y=0;Y<I.length;Y++)D.push(I[Y].x,k.e?1-I[Y].y:I[Y].y);else for(Y=0;Y<i.length+V;Y++)for(f=0;f<X+S;f++)t=0!=x[Y]?p[Y][f]/x[Y]:0,A=0!=E[f]?R[f][Y]/E[f]:0,L?D.push(A,t):D.push(t,k.e?1-A:A);Y=0;let s=0,mg=v[Y]-1,r=v[Y+1]-1,Q=mg<r?mg:r,o=P[1]-P[0];const u=v.length-1;for(;s<=Q&&Y<u;)B.push(s,s+o,s+1),B.push(s+o+1,s+1,s+o),s+=1,s===Q&&(Y++,o=P[Y+1]-P[Y],mg=v[Y]-1,r=v[Y+1]-1,s=P[Y],Q=mg<r?mg+s:r+s);if(b.c.ComputeNormals(y,B,c),n){let g=0,a=0;for(Y=0;Y<i.length;Y++){g=3*P[Y],a=Y+1<i.length?3*(P[Y+1]-1):c.length-3,c[g]=.5*(c[g]+c[a]),c[g+1]=.5*(c[g+1]+c[a+1]),c[g+2]=.5*(c[g+2]+c[a+2]);const n=Math.sqrt(c[g]*c[g]+c[g+1]*c[g+1]+c[g+2]*c[g+2]);c[g]/=n,c[g+1]/=n,c[g+2]/=n,c[a]=c[g],c[a+1]=c[g+1],c[a+2]=c[g+2]}}if(a){let g=3*P[0],a=3*P[i.length];for(f=0;f<X+S;f++){c[g]=.5*(c[g]+c[a]),c[g+1]=.5*(c[g+1]+c[a+1]),c[g+2]=.5*(c[g+2]+c[a+2]);const i=Math.sqrt(c[g]*c[g]+c[g+1]*c[g+1]+c[g+2]*c[g+2]);c[g]/=i,c[g+1]/=i,c[g+2]/=i,c[a]=c[g],c[a+1]=c[g+1],c[a+2]=c[g+2],g+=3,a+=3}}b.c._ComputeSides(F,y,B,c,D,g.frontUVs,g.backUVs);let H=null;if(j){H=new Float32Array(4*j.length);for(let g=0;g<j.length;g++)H[4*g]=j[g].r,H[4*g+1]=j[g].g,H[4*g+2]=j[g].b,H[4*g+3]=j[g].a}const M=new b.c,q=new Float32Array(y),W=new Float32Array(c),G=new Float32Array(D);return M.indices=B,M.fg=q,M.Cg=W,M.Sg=G,H&&M.set(H,d.g.ColorKind),n&&(M._idx=P),M}function N(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=i.pathArray,F=i.closeArray,I=i.closePath,j=L.e._GetDefaultSideOrientation(i.sideOrientation),y=i.instance,B=i.updatable;if(y){const g=n.TmpVectors.Bi[0].Qd(Number.MAX_VALUE),a=n.TmpVectors.Bi[1].Qd(-Number.MAX_VALUE),e=i=>{let n=N[0].length;const d=y;let b=0;const k=d._originalBuilderSideOrientation===L.e.DOUBLESIDE?2:1;for(let L=1;L<=k;++L)for(let k=0;k<N.length;++k){const L=N[k],e=L.length;n=n<e?n:e;for(let d=0;d<n;++d){const n=L[d];i[b]=n.x,i[b+1]=n.y,i[b+2]=n.z,g.minimizeInPlaceFromFloats(n.x,n.y,n.z),a.maximizeInPlaceFromFloats(n.x,n.y,n.z),b+=3}if(d._creationDataStorage&&d._creationDataStorage.closePath){const g=L[0];i[b]=g.x,i[b+1]=g.y,i[b+2]=g.z,b+=3}}},F=y.getVerticesData(d.g.PositionKind);if(e(F),y.hasBoundingInfo?y.getBoundingInfo().reConstruct(g,a,y._worldMatrix):y.buildBoundingInfo(g,a,y._worldMatrix),y.updateVerticesData(d.g.PositionKind,F,!1,!1),i.Ug){const g=y.getVerticesData(d.g.ColorKind);for(let a=0,n=0;a<i.Ug.length;a++,n+=4){const L=i.Ug[a];g[n]=L.r,g[n+1]=L.g,g[n+2]=L.b,g[n+3]=L.a}y.updateVerticesData(d.g.ColorKind,g,!1,!1)}if(i.Sg){const g=y.getVerticesData(d.g.UVKind);for(let a=0;a<i.Sg.length;a++)g[2*a]=i.Sg[a].x,g[2*a+1]=k.e?1-i.Sg[a].y:i.Sg[a].y;y.updateVerticesData(d.g.UVKind,g,!1,!1)}if(!y.areNormalsFrozen||y.isFacetDataEnabled){const g=y.Ad(),i=y.getVerticesData(d.g.NormalKind),a=y.isFacetDataEnabled?y.getFacetDataParameters():null;if(b.c.ComputeNormals(F,g,i,a),y._creationDataStorage&&y._creationDataStorage.closePath){let g=0,a=0;for(let n=0;n<N.length;n++)g=3*y._creationDataStorage.idx[n],a=n+1<N.length?3*(y._creationDataStorage.idx[n+1]-1):i.length-3,i[g]=.5*(i[g]+i[a]),i[g+1]=.5*(i[g+1]+i[a+1]),i[g+2]=.5*(i[g+2]+i[a+2]),i[a]=i[g],i[a+1]=i[g+1],i[a+2]=i[g+2]}y.areNormalsFrozen||y.updateVerticesData(d.g.NormalKind,i,!1,!1)}return y}{const n=new L.e(g,a);n._originalBuilderSideOrientation=j,n._creationDataStorage=new L.f;const d=e(i);return I&&(n._creationDataStorage.idx=d._idx),n._creationDataStorage.closePath=I,n._creationDataStorage.closeArray=F,d.Kg(n,B),n}}b.c.CreateRibbon=e,L.e.CreateRibbon=function(g,i){return N(g,{pathArray:i,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var F=a(13844),I=a(13701),j=a(12496);function y(g){const i=g.pattern||L.e.NO_FLIP,a=g.tileWidth||g.tileSize||1,n=g.tileHeight||g.tileSize||1,d=g.alignHorizontal||0,k=g.alignVertical||0,e=g.width||g.size||1,N=Math.floor(e/a);let F=e-N*a;const I=g.height||g.size||1,j=Math.floor(I/n);let y=I-j*n;const B=a*N/2,c=n*j/2;let D=0,p=0,R=0,x=0,E=0,X=0;if(F>0||y>0){switch(R=-B,x=-c,E=B,X=c,d){case L.e.CENTER:F/=2,R-=F,E+=F;break;case L.e.LEFT:E+=F,D=-F/2;break;case L.e.RIGHT:R-=F,D=F/2}switch(k){case L.e.CENTER:y/=2,x-=y,X+=y;break;case L.e.BOTTOM:X+=y,p=-y/2;break;case L.e.TOP:x-=y,p=y/2}}const v=[],P=[],Y=[];Y[0]=[0,0,1,0,1,1,0,1],Y[1]=[0,0,1,0,1,1,0,1],i!==L.e.ROTATE_TILE&&i!==L.e.ROTATE_ROW||(Y[1]=[1,1,0,1,0,0,1,0]),i!==L.e.FLIP_TILE&&i!==L.e.FLIP_ROW||(Y[1]=[1,0,0,0,0,1,1,1]),i!==L.e.FLIP_N_ROTATE_TILE&&i!==L.e.FLIP_N_ROTATE_ROW||(Y[1]=[0,1,1,1,1,0,0,0]);let f=[];const C=[],U=[];let S=0;for(let b=0;b<j;b++)for(let g=0;g<N;g++)v.push(g*a-B+D,b*n-c+p,0),v.push((g+1)*a-B+D,b*n-c+p,0),v.push((g+1)*a-B+D,(b+1)*n-c+p,0),v.push(g*a-B+D,(b+1)*n-c+p,0),U.push(S,S+1,S+3,S+1,S+2,S+3),f=i===L.e.FLIP_TILE||i===L.e.ROTATE_TILE||i===L.e.FLIP_N_ROTATE_TILE?f.concat(Y[(g%2+b%2)%2]):i===L.e.FLIP_ROW||i===L.e.ROTATE_ROW||i===L.e.FLIP_N_ROTATE_ROW?f.concat(Y[b%2]):f.concat(Y[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),S+=4;if(F>0||y>0){const g=y>0&&(k===L.e.CENTER||k===L.e.TOP),b=y>0&&(k===L.e.CENTER||k===L.e.BOTTOM),e=F>0&&(d===L.e.CENTER||d===L.e.RIGHT),I=F>0&&(d===L.e.CENTER||d===L.e.LEFT);let Y,V,K,T,l=[];if(g&&e&&(v.push(R+D,x+p,0),v.push(-B+D,x+p,0),v.push(-B+D,x+y+p,0),v.push(R+D,x+y+p,0),U.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,Y=1-F/a,V=1-y/n,K=1,T=1,l=[Y,V,K,V,K,T,Y,T],i===L.e.ROTATE_ROW&&(l=[1-Y,1-V,1-K,1-V,1-K,1-T,1-Y,1-T]),i===L.e.FLIP_ROW&&(l=[1-Y,V,1-K,V,1-K,T,1-Y,T]),i===L.e.FLIP_N_ROTATE_ROW&&(l=[Y,1-V,K,1-V,K,1-T,Y,1-T]),f=f.concat(l),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&I&&(v.push(B+D,x+p,0),v.push(E+D,x+p,0),v.push(E+D,x+y+p,0),v.push(B+D,x+y+p,0),U.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,Y=0,V=1-y/n,K=F/a,T=1,l=[Y,V,K,V,K,T,Y,T],(i===L.e.ROTATE_ROW||i===L.e.ROTATE_TILE&&N%2===0)&&(l=[1-Y,1-V,1-K,1-V,1-K,1-T,1-Y,1-T]),(i===L.e.FLIP_ROW||i===L.e.FLIP_TILE&&N%2===0)&&(l=[1-Y,V,1-K,V,1-K,T,1-Y,T]),(i===L.e.FLIP_N_ROTATE_ROW||i===L.e.FLIP_N_ROTATE_TILE&&N%2===0)&&(l=[Y,1-V,K,1-V,K,1-T,Y,1-T]),f=f.concat(l),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),b&&e&&(v.push(R+D,c+p,0),v.push(-B+D,c+p,0),v.push(-B+D,X+p,0),v.push(R+D,X+p,0),U.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,Y=1-F/a,V=0,K=1,T=y/n,l=[Y,V,K,V,K,T,Y,T],(i===L.e.ROTATE_ROW&&j%2===1||i===L.e.ROTATE_TILE&&j%1===0)&&(l=[1-Y,1-V,1-K,1-V,1-K,1-T,1-Y,1-T]),(i===L.e.FLIP_ROW&&j%2===1||i===L.e.FLIP_TILE&&j%2===0)&&(l=[1-Y,V,1-K,V,1-K,T,1-Y,T]),(i===L.e.FLIP_N_ROTATE_ROW&&j%2===1||i===L.e.FLIP_N_ROTATE_TILE&&j%2===0)&&(l=[Y,1-V,K,1-V,K,1-T,Y,1-T]),f=f.concat(l),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),b&&I&&(v.push(B+D,c+p,0),v.push(E+D,c+p,0),v.push(E+D,X+p,0),v.push(B+D,X+p,0),U.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,Y=0,V=0,K=F/a,T=y/n,l=[Y,V,K,V,K,T,Y,T],(i===L.e.ROTATE_ROW&&j%2===1||i===L.e.ROTATE_TILE&&(j+N)%2===1)&&(l=[1-Y,1-V,1-K,1-V,1-K,1-T,1-Y,1-T]),(i===L.e.FLIP_ROW&&j%2===1||i===L.e.FLIP_TILE&&(j+N)%2===1)&&(l=[1-Y,V,1-K,V,1-K,T,1-Y,T]),(i===L.e.FLIP_N_ROTATE_ROW&&j%2===1||i===L.e.FLIP_N_ROTATE_TILE&&(j+N)%2===1)&&(l=[Y,1-V,K,1-V,K,1-T,Y,1-T]),f=f.concat(l),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g){const g=[];Y=0,V=1-y/n,K=1,T=1,g[0]=[Y,V,K,V,K,T,Y,T],g[1]=[Y,V,K,V,K,T,Y,T],i!==L.e.ROTATE_TILE&&i!==L.e.ROTATE_ROW||(g[1]=[1-Y,1-V,1-K,1-V,1-K,1-T,1-Y,1-T]),i!==L.e.FLIP_TILE&&i!==L.e.FLIP_ROW||(g[1]=[1-Y,V,1-K,V,1-K,T,1-Y,T]),i!==L.e.FLIP_N_ROTATE_TILE&&i!==L.e.FLIP_N_ROTATE_ROW||(g[1]=[Y,1-V,K,1-V,K,1-T,Y,1-T]);for(let n=0;n<N;n++)v.push(n*a-B+D,x+p,0),v.push((n+1)*a-B+D,x+p,0),v.push((n+1)*a-B+D,x+y+p,0),v.push(n*a-B+D,x+y+p,0),U.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,f=i===L.e.FLIP_TILE||i===L.e.ROTATE_TILE||i===L.e.FLIP_N_ROTATE_TILE?f.concat(g[(n+1)%2]):i===L.e.FLIP_ROW||i===L.e.ROTATE_ROW||i===L.e.FLIP_N_ROTATE_ROW?f.concat(g[1]):f.concat(g[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(b){const g=[];Y=0,V=0,K=1,T=y/n,g[0]=[Y,V,K,V,K,T,Y,T],g[1]=[Y,V,K,V,K,T,Y,T],i!==L.e.ROTATE_TILE&&i!==L.e.ROTATE_ROW||(g[1]=[1-Y,1-V,1-K,1-V,1-K,1-T,1-Y,1-T]),i!==L.e.FLIP_TILE&&i!==L.e.FLIP_ROW||(g[1]=[1-Y,V,1-K,V,1-K,T,1-Y,T]),i!==L.e.FLIP_N_ROTATE_TILE&&i!==L.e.FLIP_N_ROTATE_ROW||(g[1]=[Y,1-V,K,1-V,K,1-T,Y,1-T]);for(let n=0;n<N;n++)v.push(n*a-B+D,X-y+p,0),v.push((n+1)*a-B+D,X-y+p,0),v.push((n+1)*a-B+D,X+p,0),v.push(n*a-B+D,X+p,0),U.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,f=i===L.e.FLIP_TILE||i===L.e.ROTATE_TILE||i===L.e.FLIP_N_ROTATE_TILE?f.concat(g[(n+j)%2]):i===L.e.FLIP_ROW||i===L.e.ROTATE_ROW||i===L.e.FLIP_N_ROTATE_ROW?f.concat(g[j%2]):f.concat(g[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(e){const g=[];Y=1-F/a,V=0,K=1,T=1,g[0]=[Y,V,K,V,K,T,Y,T],g[1]=[Y,V,K,V,K,T,Y,T],i!==L.e.ROTATE_TILE&&i!==L.e.ROTATE_ROW||(g[1]=[1-Y,1-V,1-K,1-V,1-K,1-T,1-Y,1-T]),i!==L.e.FLIP_TILE&&i!==L.e.FLIP_ROW||(g[1]=[1-Y,V,1-K,V,1-K,T,1-Y,T]),i!==L.e.FLIP_N_ROTATE_TILE&&i!==L.e.FLIP_N_ROTATE_ROW||(g[1]=[Y,1-V,K,1-V,K,1-T,Y,1-T]);for(let a=0;a<j;a++)v.push(R+D,a*n-c+p,0),v.push(R+F+D,a*n-c+p,0),v.push(R+F+D,(a+1)*n-c+p,0),v.push(R+D,(a+1)*n-c+p,0),U.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,f=i===L.e.FLIP_TILE||i===L.e.ROTATE_TILE||i===L.e.FLIP_N_ROTATE_TILE?f.concat(g[(a+1)%2]):i===L.e.FLIP_ROW||i===L.e.ROTATE_ROW||i===L.e.FLIP_N_ROTATE_ROW?f.concat(g[a%2]):f.concat(g[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(I){const g=[];Y=0,V=0,K=F/n,T=1,g[0]=[Y,V,K,V,K,T,Y,T],g[1]=[Y,V,K,V,K,T,Y,T],i!==L.e.ROTATE_TILE&&i!==L.e.ROTATE_ROW||(g[1]=[1-Y,1-V,1-K,1-V,1-K,1-T,1-Y,1-T]),i!==L.e.FLIP_TILE&&i!==L.e.FLIP_ROW||(g[1]=[1-Y,V,1-K,V,1-K,T,1-Y,T]),i!==L.e.FLIP_N_ROTATE_TILE&&i!==L.e.FLIP_N_ROTATE_ROW||(g[1]=[Y,1-V,K,1-V,K,1-T,Y,1-T]);for(let a=0;a<j;a++)v.push(E-F+D,a*n-c+p,0),v.push(E+D,a*n-c+p,0),v.push(E+D,(a+1)*n-c+p,0),v.push(E-F+D,(a+1)*n-c+p,0),U.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,f=i===L.e.FLIP_TILE||i===L.e.ROTATE_TILE||i===L.e.FLIP_N_ROTATE_TILE?f.concat(g[(a+N)%2]):i===L.e.FLIP_ROW||i===L.e.ROTATE_ROW||i===L.e.FLIP_N_ROTATE_ROW?f.concat(g[a%2]):f.concat(g[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const V=0===g.sideOrientation?0:g.sideOrientation||b.c.DEFAULTSIDE;b.c._ComputeSides(V,v,U,P,f,g.frontUVs,g.backUVs);const K=new b.c;K.indices=U,K.fg=v,K.Cg=P,K.Sg=f;const T=V===b.c.DOUBLESIDE?C.concat(C):C;return K.Ug=T,K}function B(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new L.e(g,a);i.sideOrientation=L.e._GetDefaultSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;return y(i).Kg(n,i.updatable),n}function c(g){const i=g.faceUV||new Array(6),a=g.faceColors,d=g.pattern||L.e.NO_FLIP,e=g.width||g.size||1,N=g.height||g.size||1,F=g.depth||g.size||1,I=g.tileWidth||g.tileSize||1,B=g.tileHeight||g.tileSize||1,c=g.alignHorizontal||0,D=g.alignVertical||0,p=0===g.sideOrientation?0:g.sideOrientation||b.c.DEFAULTSIDE;for(let L=0;L<6;L++)void 0===i[L]&&(i[L]=new n.Vector4(0,0,1,1)),a&&void 0===a[L]&&(a[L]=new j.Hd(1,1,1,1));const R=e/2,x=N/2,E=F/2,X=[];for(let n=0;n<2;n++)X[n]=y({pattern:d,tileWidth:I,tileHeight:B,width:e,height:N,alignVertical:D,alignHorizontal:c,sideOrientation:p});for(let n=2;n<4;n++)X[n]=y({pattern:d,tileWidth:I,tileHeight:B,width:F,height:N,alignVertical:D,alignHorizontal:c,sideOrientation:p});let v=D;D===L.e.BOTTOM?v=L.e.TOP:D===L.e.TOP&&(v=L.e.BOTTOM);for(let n=4;n<6;n++)X[n]=y({pattern:d,tileWidth:I,tileHeight:B,width:e,height:F,alignVertical:v,alignHorizontal:c,sideOrientation:p});let P=[],Y=[],f=[],C=[];const U=[],S=[],V=[],K=[];let T=0,l=0;for(let L=0;L<6;L++){const g=X[L].fg.length;S[L]=[],V[L]=[];for(let i=0;i<g/3;i++)S[L].push(new n.Bi(X[L].fg[3*i],X[L].fg[3*i+1],X[L].fg[3*i+2])),V[L].push(new n.Bi(X[L].Cg[3*i],X[L].Cg[3*i+1],X[L].Cg[3*i+2]));T=X[L].Sg.length,K[L]=[];for(let a=0;a<T;a+=2)K[L][a]=i[L].x+(i[L].z-i[L].x)*X[L].Sg[a],K[L][a+1]=i[L].y+(i[L].w-i[L].y)*X[L].Sg[a+1],k.e&&(K[L][a+1]=1-K[L][a+1]);if(f=f.concat(K[L]),C=C.concat(X[L].indices.map((g=>g+l))),l+=S[L].length,a)for(let i=0;i<4;i++)U.push(a[L].r,a[L].g,a[L].b,a[L].a)}const Z=new n.Bi(0,0,E),h=n.Matrix.RotationY(Math.PI);P=S[0].map((g=>n.Bi.TransformNormal(g,h).add(Z))).map((g=>[g.x,g.y,g.z])).reduce(((g,i)=>g.concat(i)),[]),Y=V[0].map((g=>n.Bi.TransformNormal(g,h))).map((g=>[g.x,g.y,g.z])).reduce(((g,i)=>g.concat(i)),[]),P=P.concat(S[1].map((g=>g.ci(Z))).map((g=>[g.x,g.y,g.z])).reduce(((g,i)=>g.concat(i)),[])),Y=Y.concat(V[1].map((g=>[g.x,g.y,g.z])).reduce(((g,i)=>g.concat(i)),[]));const w=new n.Bi(R,0,0),t=n.Matrix.RotationY(-Math.PI/2);P=P.concat(S[2].map((g=>n.Bi.TransformNormal(g,t).add(w))).map((g=>[g.x,g.y,g.z])).reduce(((g,i)=>g.concat(i)),[])),Y=Y.concat(V[2].map((g=>n.Bi.TransformNormal(g,t))).map((g=>[g.x,g.y,g.z])).reduce(((g,i)=>g.concat(i)),[]));const A=n.Matrix.RotationY(Math.PI/2);P=P.concat(S[3].map((g=>n.Bi.TransformNormal(g,A).ci(w))).map((g=>[g.x,g.y,g.z])).reduce(((g,i)=>g.concat(i)),[])),Y=Y.concat(V[3].map((g=>n.Bi.TransformNormal(g,A))).map((g=>[g.x,g.y,g.z])).reduce(((g,i)=>g.concat(i)),[]));const O=new n.Bi(0,x,0),z=n.Matrix.RotationX(Math.PI/2);P=P.concat(S[4].map((g=>n.Bi.TransformNormal(g,z).add(O))).map((g=>[g.x,g.y,g.z])).reduce(((g,i)=>g.concat(i)),[])),Y=Y.concat(V[4].map((g=>n.Bi.TransformNormal(g,z))).map((g=>[g.x,g.y,g.z])).reduce(((g,i)=>g.concat(i)),[]));const s=n.Matrix.RotationX(-Math.PI/2);P=P.concat(S[5].map((g=>n.Bi.TransformNormal(g,s).ci(O))).map((g=>[g.x,g.y,g.z])).reduce(((g,i)=>g.concat(i)),[])),Y=Y.concat(V[5].map((g=>n.Bi.TransformNormal(g,s))).map((g=>[g.x,g.y,g.z])).reduce(((g,i)=>g.concat(i)),[])),b.c._ComputeSides(p,P,C,Y,f);const mg=new b.c;if(mg.indices=C,mg.fg=P,mg.Cg=Y,mg.Sg=f,a){const g=p===b.c.DOUBLESIDE?U.concat(U):U;mg.Ug=g}return mg}function D(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new L.e(g,a);i.sideOrientation=L.e._GetDefaultSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;return c(i).Kg(n,i.updatable),n}b.c.CreateTiledPlane=y;b.c.CreateTiledBox=c;var p=a(13836),R=a(12692),x=a(12655);function E(g){const i=g.height||2;let a=0===g.diameterTop?0:g.diameterTop||g.diameter||1,d=0===g.diameterBottom?0:g.diameterBottom||g.diameter||1;a=a||1e-5,d=d||1e-5;const e=0|(g.tessellation||24),N=0|(g.subdivisions||1),F=!!g.hasRings,I=!!g.enclose,y=0===g.cap?0:g.cap||L.e.CAP_ALL,B=g.arc&&(g.arc<=0||g.arc>1)?1:g.arc||1,c=0===g.sideOrientation?0:g.sideOrientation||b.c.DEFAULTSIDE,D=g.faceUV||new Array(3),p=g.faceColors,R=2+(1+(1!==B&&I?2:0))*(F?N:1);let E;for(E=0;E<R;E++)p&&void 0===p[E]&&(p[E]=new j.Hd(1,1,1,1));for(E=0;E<R;E++)D&&void 0===D[E]&&(D[E]=new n.Vector4(0,0,1,1));const X=[],v=[],P=[],Y=[],f=[],C=2*Math.PI*B/e;let U,S,V;const K=(d-a)/2/i,T=n.Bi.Zero(),l=n.Bi.Zero(),Z=n.Bi.Zero(),h=n.Bi.Zero(),w=n.Bi.Zero(),t=x.d.Y;let A,O,z,s=1,mg=1,r=0,Q=0;for(A=0;A<=N;A++)for(S=A/N,V=(S*(a-d)+d)/2,s=F&&0!==A&&A!==N?2:1,z=0;z<s;z++){for(F&&(mg+=z),I&&(mg+=2*z),O=0;O<=e;O++)U=O*C,T.x=Math.cos(-U)*V,T.y=-i/2+S*i,T.z=Math.sin(-U)*V,0===a&&A===N?(l.x=P[P.length-3*(e+1)],l.y=P[P.length-3*(e+1)+1],l.z=P[P.length-3*(e+1)+2]):(l.x=T.x,l.z=T.z,l.y=Math.sqrt(l.x*l.x+l.z*l.z)*K,l.normalize()),0===O&&(Z.I(T),h.I(l)),v.push(T.x,T.y,T.z),P.push(l.x,l.y,l.z),Q=F?r!==mg?D[mg].y:D[mg].w:D[mg].y+(D[mg].w-D[mg].y)*S,Y.push(D[mg].x+(D[mg].z-D[mg].x)*O/e,k.e?1-Q:Q),p&&f.push(p[mg].r,p[mg].g,p[mg].b,p[mg].a);1!==B&&I&&(v.push(T.x,T.y,T.z),v.push(0,T.y,0),v.push(0,T.y,0),v.push(Z.x,Z.y,Z.z),n.Bi.CrossToRef(t,l,w),w.normalize(),P.push(w.x,w.y,w.z,w.x,w.y,w.z),n.Bi.CrossToRef(h,t,w),w.normalize(),P.push(w.x,w.y,w.z,w.x,w.y,w.z),Q=F?r!==mg?D[mg+1].y:D[mg+1].w:D[mg+1].y+(D[mg+1].w-D[mg+1].y)*S,Y.push(D[mg+1].x,k.e?1-Q:Q),Y.push(D[mg+1].z,k.e?1-Q:Q),Q=F?r!==mg?D[mg+2].y:D[mg+2].w:D[mg+2].y+(D[mg+2].w-D[mg+2].y)*S,Y.push(D[mg+2].x,k.e?1-Q:Q),Y.push(D[mg+2].z,k.e?1-Q:Q),p&&(f.push(p[mg+1].r,p[mg+1].g,p[mg+1].b,p[mg+1].a),f.push(p[mg+1].r,p[mg+1].g,p[mg+1].b,p[mg+1].a),f.push(p[mg+2].r,p[mg+2].g,p[mg+2].b,p[mg+2].a),f.push(p[mg+2].r,p[mg+2].g,p[mg+2].b,p[mg+2].a))),r!==mg&&(r=mg)}const o=1!==B&&I?e+4:e;for(A=0,mg=0;mg<N;mg++){let g=0,i=0,a=0,n=0;for(O=0;O<e;O++)g=A*(o+1)+O,i=(A+1)*(o+1)+O,a=A*(o+1)+(O+1),n=(A+1)*(o+1)+(O+1),X.push(g,i,a),X.push(n,a,i);1!==B&&I&&(X.push(g+2,i+2,a+2),X.push(n+2,a+2,i+2),X.push(g+4,i+4,a+4),X.push(n+4,a+4,i+4)),A=F?A+2:A+1}const u=g=>{const L=g?a/2:d/2;if(0===L)return;let b,N,F;const I=g?D[R-1]:D[0];let j=null;p&&(j=g?p[R-1]:p[0]);const y=v.length/3,c=g?i/2:-i/2,x=new n.Bi(0,c,0);v.push(x.x,x.y,x.z),P.push(0,g?1:-1,0);const E=I.y+.5*(I.w-I.y);Y.push(I.x+.5*(I.z-I.x),k.e?1-E:E),j&&f.push(j.r,j.g,j.b,j.a);const C=new n.Vector2(.5,.5);for(F=0;F<=e;F++){b=2*Math.PI*F*B/e;const i=Math.cos(-b),a=Math.sin(-b);N=new n.Bi(i*L,c,a*L);const d=new n.Vector2(i*C.x+.5,a*C.y+.5);v.push(N.x,N.y,N.z),P.push(0,g?1:-1,0);const y=I.y+(I.w-I.y)*d.y;Y.push(I.x+(I.z-I.x)*d.x,k.e?1-y:y),j&&f.push(j.r,j.g,j.b,j.a)}for(F=0;F<e;F++)g?(X.push(y),X.push(y+(F+2)),X.push(y+(F+1))):(X.push(y),X.push(y+(F+1)),X.push(y+(F+2)))};y!==L.e.CAP_START&&y!==L.e.CAP_ALL||u(!1),y!==L.e.CAP_END&&y!==L.e.CAP_ALL||u(!0),b.c._ComputeSides(c,v,X,P,Y,g.frontUVs,g.backUVs);const H=new b.c;return H.indices=X,H.fg=v,H.Cg=P,H.Sg=Y,p&&(H.Ug=f),H}function X(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;const n=new L.e(g,a);i.sideOrientation=L.e._GetDefaultSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;return E(i).Kg(n,i.updatable),n}function v(g){const i=[],a=[],L=[],d=[],e=g.diameter||1,N=g.thickness||.5,F=0|(g.tessellation||16),I=0===g.sideOrientation?0:g.sideOrientation||b.c.DEFAULTSIDE,j=F+1;for(let b=0;b<=F;b++){const g=b/F,I=b*Math.PI*2/F-Math.PI/2,y=n.Matrix.Translation(e/2,0,0).multiply(n.Matrix.RotationY(I));for(let e=0;e<=F;e++){const I=1-e/F,B=e*Math.PI*2/F+Math.PI,c=Math.cos(B),D=Math.sin(B);let p=new n.Bi(c,D,0),R=p.scale(N/2);const x=new n.Vector2(g,I);R=n.Bi.TransformCoordinates(R,y),p=n.Bi.TransformNormal(p,y),a.push(R.x,R.y,R.z),L.push(p.x,p.y,p.z),d.push(x.x,k.e?1-x.y:x.y);const E=(b+1)%j,X=(e+1)%j;i.push(b*j+e),i.push(b*j+X),i.push(E*j+e),i.push(b*j+X),i.push(E*j+X),i.push(E*j+e)}}b.c._ComputeSides(I,a,i,L,d,g.frontUVs,g.backUVs);const y=new b.c;return y.indices=i,y.fg=a,y.Cg=L,y.Sg=d,y}function P(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;const n=new L.e(g,a);i.sideOrientation=L.e._GetDefaultSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;return v(i).Kg(n,i.updatable),n}b.c.CreateCylinder=E,L.e.CreateCylinder=(g,i,a,n,d,b,k,e,N)=>{void 0!==k&&k instanceof R.e||(void 0!==k&&(N=e||L.e.DEFAULTSIDE,e=k),k=b,b=1);return X(g,{height:i,diameterTop:a,diameterBottom:n,tessellation:d,subdivisions:b,sideOrientation:N,updatable:e},k)};function Y(g){const i=[],a=[],L=[],d=[],e=g.radius||2,N=g.tube||.5,F=g.radialSegments||32,I=g.tubularSegments||32,j=g.p||2,y=g.q||3,B=0===g.sideOrientation?0:g.sideOrientation||b.c.DEFAULTSIDE,c=g=>{const i=Math.cos(g),a=Math.sin(g),L=y/j*g,d=Math.cos(L),b=e*(2+d)*.5*i,k=e*(2+d)*a*.5,N=e*Math.sin(L)*.5;return new n.Bi(b,k,N)};let D,p;for(D=0;D<=F;D++){const g=D%F/F*2*j*Math.PI,i=c(g),L=c(g+.01),b=L.ci(i);let e=L.add(i);const y=n.Bi.Cross(b,e);for(e=n.Bi.Cross(y,b),y.normalize(),e.normalize(),p=0;p<I;p++){const g=p%I/I*2*Math.PI,n=-N*Math.cos(g),L=N*Math.sin(g);a.push(i.x+n*e.x+L*y.x),a.push(i.y+n*e.y+L*y.y),a.push(i.z+n*e.z+L*y.z),d.push(D/F),d.push(k.e?1-p/I:p/I)}}for(D=0;D<F;D++)for(p=0;p<I;p++){const g=(p+1)%I,a=D*I+p,n=(D+1)*I+p,L=(D+1)*I+g,d=D*I+g;i.push(d),i.push(n),i.push(a),i.push(d),i.push(L),i.push(n)}b.c.ComputeNormals(a,i,L),b.c._ComputeSides(B,a,i,L,d,g.frontUVs,g.backUVs);const R=new b.c;return R.indices=i,R.fg=a,R.Cg=L,R.Sg=d,R}function f(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;const n=new L.e(g,a);i.sideOrientation=L.e._GetDefaultSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;return Y(i).Kg(n,i.updatable),n}b.c.CreateTorus=v,L.e.CreateTorus=(g,i,a,n,L,d,b)=>P(g,{diameter:i,thickness:a,tessellation:n,sideOrientation:b,updatable:d},L);b.c.CreateTorusKnot=Y,L.e.CreateTorusKnot=(g,i,a,n,L,d,b,k,e,N)=>f(g,{radius:i,tube:a,radialSegments:n,tubularSegments:L,p:d,q:b,sideOrientation:N,updatable:e},k);var C=a(14428),U=a(13024),S=a(12671);function V(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=i.path,d=i.shape,b=i.scale||1,k=i.rotation||0,e=0===i.cap?0:i.cap||L.e.NO_CAP,N=i.updatable,F=L.e._GetDefaultSideOrientation(i.sideOrientation),I=i.instance||null,j=i.invertUV||!1,y=i.closeShape||!1,B=i.closePath||!1,c=i.capFunction||null;return T(g,d,n,b,k,null,null,B,y,e,!1,a,!!N,F,I,j,i.frontUVs||null,i.backUVs||null,i.firstNormal||null,!!i.adjustFrame,c)}function K(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=i.path,d=i.shape,b=i.scaleFunction||(()=>1),k=i.rotationFunction||(()=>0),e=i.closePath||i.ribbonCloseArray||!1,N=i.closeShape||i.ribbonClosePath||!1,F=0===i.cap?0:i.cap||L.e.NO_CAP,I=i.updatable,j=i.firstNormal||null,y=i.adjustFrame||!1,B=L.e._GetDefaultSideOrientation(i.sideOrientation),c=i.instance,D=i.invertUV||!1,p=i.capFunction||null;return T(g,d,n,null,null,b,k,e,N,F,!0,a,!!I,B,c||null,D,i.frontUVs||null,i.backUVs||null,j,y,p||null)}function T(g,i,a,d,b,k,e,F,I,j,y,B,c,D,p,R,x,E,X,v,P){const Y=(g,i,a,d,b,k,e,N,F,I,j)=>{const y=a.getTangents(),B=a.getNormals(),c=a.getBinormals(),D=a.getDistances();if(j)for(let L=0;L<y.length;L++)if(0==y[L].x&&0==y[L].y&&0==y[L].z&&y[L].I(y[L-1]),0==B[L].x&&0==B[L].y&&0==B[L].z&&B[L].I(B[L-1]),0==c[L].x&&0==c[L].y&&0==c[L].z&&c[L].I(c[L-1]),L>0){let g=y[L-1];n.Bi.Dot(g,y[L])<0&&y[L].scaleInPlace(-1),g=B[L-1],n.Bi.Dot(g,B[L])<0&&B[L].scaleInPlace(-1),g=c[L-1],n.Bi.Dot(g,c[L])<0&&c[L].scaleInPlace(-1)}let p=0;const R=I&&N?N:()=>null!==k?k:0,x=I&&e?e:()=>null!==b?b:1;let E=F===L.e.NO_CAP||F===L.e.CAP_END?0:2;const X=n.TmpVectors.Matrix[0];for(let L=0;L<i.length;L++){const a=[],b=R(L,D[L]),k=x(L,D[L]);n.Matrix.RotationAxisToRef(y[L],p,X);for(let d=0;d<g.length;d++){const b=y[L].scale(g[d].z).add(B[L].scale(g[d].x)).add(c[L].scale(g[d].y)),e=n.Bi.Zero();n.Bi.TransformCoordinatesToRef(b,X,e),e.scaleInPlace(k).addInPlace(i[L]),a[d]=e}d[E]=a,p+=b,E++}const v=P||(g=>{const i=Array(),a=n.Bi.Zero();let L;for(L=0;L<g.length;L++)a.addInPlace(g[L]);for(a.scaleInPlace(1/g.length),L=0;L<g.length;L++)i.push(a);return i});switch(F){case L.e.NO_CAP:break;case L.e.CAP_START:d[0]=v(d[2]),d[1]=d[2];break;case L.e.CAP_END:d[E]=d[E-1],d[E+1]=v(d[E-1]);break;case L.e.CAP_ALL:d[0]=v(d[2]),d[1]=d[2],d[E]=d[E-1],d[E+1]=v(d[E-1])}return d};let f,C;if(p){const g=p._creationDataStorage;return f=X?g.path3D.update(a,X):g.path3D.update(a),C=Y(i,a,g.path3D,g.pathArray,d,b,k,e,g.cap,y,v),p=N("",{pathArray:C,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:p},B||void 0)}f=X?new S.i(a,X):new S.i(a);C=Y(i,a,f,new Array,d,b,k,e,j=j<0||j>3?0:j,y,v);const U=N(g,{pathArray:C,closeArray:F,closePath:I,updatable:c,sideOrientation:D,invertUV:R,frontUVs:x||void 0,backUVs:E||void 0},B);return U._creationDataStorage.pathArray=C,U._creationDataStorage.path3D=f,U._creationDataStorage.cap=j,U}function l(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=i.arc?i.arc<=0||i.arc>1?1:i.arc:1,b=void 0===i.closed||i.closed,k=i.shape,e=i.radius||1,F=i.tessellation||64,I=i.clip||0,j=i.updatable,y=L.e._GetDefaultSideOrientation(i.sideOrientation),B=i.cap||L.e.NO_CAP,c=2*Math.PI,D=[],p=i.invertUV||!1;let R=0,x=0;const E=c/F*d;let X,v;for(R=0;R<=F-I;R++){for(v=[],B!=L.e.CAP_START&&B!=L.e.CAP_ALL||(v.push(new n.Bi(0,k[0].y,0)),v.push(new n.Bi(Math.cos(R*E)*k[0].x*e,k[0].y,Math.sin(R*E)*k[0].x*e))),x=0;x<k.length;x++)X=new n.Bi(Math.cos(R*E)*k[x].x*e,k[x].y,Math.sin(R*E)*k[x].x*e),v.push(X);B!=L.e.CAP_END&&B!=L.e.CAP_ALL||(v.push(new n.Bi(Math.cos(R*E)*k[k.length-1].x*e,k[k.length-1].y,Math.sin(R*E)*k[k.length-1].x*e)),v.push(new n.Bi(0,k[k.length-1].y,0))),D.push(v)}return N(g,{pathArray:D,closeArray:b,sideOrientation:y,updatable:j,invertUV:p,frontUVs:i.frontUVs,backUVs:i.backUVs},a)}L.e.ExtrudeShape=function(g,i,a,n,d,b){let k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7?arguments[7]:void 0,N=arguments.length>8?arguments[8]:void 0,F=arguments.length>9?arguments[9]:void 0;return V(g,{shape:i,path:a,scale:n,rotation:d,cap:0===b?0:b||L.e.NO_CAP,sideOrientation:N,instance:F,updatable:e},k)},L.e.ExtrudeShapeCustom=(g,i,a,n,d,b,k,e,N,F,I,j)=>K(g,{shape:i,path:a,scaleFunction:n,rotationFunction:d,ribbonCloseArray:b,ribbonClosePath:k,cap:0===e?0:e||L.e.NO_CAP,sideOrientation:I,instance:j,updatable:F},N);L.e.CreateLathe=(g,i,a,n,L,d,b)=>l(g,{shape:i,radius:a,tessellation:n,sideOrientation:b,updatable:d},L);var Z=a(13748),h=a(13704);function w(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=i.path;let b=i.instance,k=1;void 0!==i.radius?k=i.radius:b&&(k=b._creationDataStorage.radius);const e=i.tessellation||64,F=i.radiusFunction||null;let I=i.cap||L.e.NO_CAP;const j=i.invertUV||!1,y=i.updatable,B=L.e._GetDefaultSideOrientation(i.sideOrientation);i.arc=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1;const c=(g,i,a,d,b,k,e,N)=>{const F=i.getTangents(),I=i.getNormals(),j=i.getDistances(),y=2*Math.PI/b*N,B=k||(()=>d);let c,D,p,R;const x=n.TmpVectors.Matrix[0];let E=e===L.e.NO_CAP||e===L.e.CAP_END?0:2;for(let L=0;L<g.length;L++){D=B(L,j[L]),c=Array(),p=I[L];for(let i=0;i<b;i++)n.Matrix.RotationAxisToRef(F[L],y*i,x),R=c[i]?c[i]:n.Bi.Zero(),n.Bi.TransformCoordinatesToRef(p,x,R),R.scaleInPlace(D).addInPlace(g[L]),c[i]=R;a[E]=c,E++}const X=(i,a)=>{const n=Array();for(let L=0;L<i;L++)n.push(g[a]);return n};switch(e){case L.e.NO_CAP:break;case L.e.CAP_START:a[0]=X(b,0),a[1]=a[2].slice(0);break;case L.e.CAP_END:a[E]=a[E-1].slice(0),a[E+1]=X(b,g.length-1);break;case L.e.CAP_ALL:a[0]=X(b,0),a[1]=a[2].slice(0),a[E]=a[E-1].slice(0),a[E+1]=X(b,g.length-1)}return a};let D,p;if(b){const g=b._creationDataStorage,a=i.arc||g.arc;return D=g.path3D.update(d),p=c(d,D,g.pathArray,k,g.tessellation,F,g.cap,a),b=N("",{pathArray:p,instance:b}),g.path3D=D,g.pathArray=p,g.arc=a,g.radius=k,b}D=new S.i(d);I=I<0||I>3?0:I,p=c(d,D,new Array,k,e,F,I,i.arc);const R=N(g,{pathArray:p,closePath:!0,closeArray:!1,updatable:y,sideOrientation:B,invertUV:j,frontUVs:i.frontUVs,backUVs:i.backUVs},a);return R._creationDataStorage.pathArray=p,R._creationDataStorage.path3D=D,R._creationDataStorage.tessellation=e,R._creationDataStorage.cap=I,R._creationDataStorage.arc=i.arc,R._creationDataStorage.radius=k,R}function t(g){const i=[];i[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},i[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},i[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},i[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},i[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},i[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},i[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},i[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},i[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},i[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},i[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},i[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},i[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},i[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},i[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const a=g.type&&(g.type<0||g.type>=i.length)?0:g.type||0,L=g.size,d=g.sizeX||L||1,e=g.sizeY||L||1,N=g.sizeZ||L||1,F=g.custom||i[a],I=F.face.length,y=g.faceUV||new Array(I),B=g.faceColors,c=void 0===g.flat||g.flat,D=0===g.sideOrientation?0:g.sideOrientation||b.c.DEFAULTSIDE,p=[],R=[],x=[],E=[],X=[];let v=0,P=0;const Y=[];let f,C,U,S,V,K,T=0,l=0;if(c)for(l=0;l<I;l++)B&&void 0===B[l]&&(B[l]=new j.Hd(1,1,1,1)),y&&void 0===y[l]&&(y[l]=new n.Vector4(0,0,1,1));if(c)for(l=0;l<I;l++){const g=F.face[l].length;for(U=2*Math.PI/g,S=.5*Math.tan(U/2),V=.5,T=0;T<g;T++)p.push(F.vertex[F.face[l][T]][0]*d,F.vertex[F.face[l][T]][1]*e,F.vertex[F.face[l][T]][2]*N),Y.push(v),v++,f=y[l].x+(y[l].z-y[l].x)*(.5+S),C=y[l].y+(y[l].w-y[l].y)*(V-.5),E.push(f,k.e?1-C:C),K=S*Math.cos(U)-V*Math.sin(U),V=S*Math.sin(U)+V*Math.cos(U),S=K,B&&X.push(B[l].r,B[l].g,B[l].b,B[l].a);for(T=0;T<g-2;T++)R.push(Y[0+P],Y[T+2+P],Y[T+1+P]);P+=g}else{for(T=0;T<F.vertex.length;T++)p.push(F.vertex[T][0]*d,F.vertex[T][1]*e,F.vertex[T][2]*N),E.push(0,k.e?1:0);for(l=0;l<I;l++)for(T=0;T<F.face[l].length-2;T++)R.push(F.face[l][0],F.face[l][T+2],F.face[l][T+1])}b.c.ComputeNormals(p,R,x),b.c._ComputeSides(D,p,R,x,E,g.frontUVs,g.backUVs);const Z=new b.c;return Z.fg=p,Z.indices=R,Z.Cg=x,Z.Sg=E,B&&c&&(Z.Ug=X),Z}function A(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new L.e(g,a);i.sideOrientation=L.e._GetDefaultSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;return t(i).Kg(n,i.updatable),n}L.e.CreateTube=(g,i,a,n,L,d,b,k,e,N)=>w(g,{path:i,radius:a,tessellation:n,radiusFunction:L,arc:1,cap:d,updatable:k,sideOrientation:e,instance:N},b);function O(g){const i=g.sideOrientation||b.c.DEFAULTSIDE,a=g.radius||1,L=void 0===g.flat||g.flat,d=0|(g.subdivisions||4),e=g.radiusX||a,N=g.radiusY||a,F=g.radiusZ||a,I=(1+Math.sqrt(5))/2,j=[-1,I,-0,1,I,0,-1,-I,0,1,-I,0,0,-1,-I,0,1,-I,0,-1,I,0,1,I,I,0,1,I,0,-1,-I,0,1,-I,0,-1],y=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],B=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],c=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],D=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],p=[],R=[],x=[],E=[];let X=0;const v=new Array(3),P=new Array(3);let Y;for(Y=0;Y<3;Y++)v[Y]=n.Bi.Zero(),P[Y]=n.Vector2.Zero();for(let b=0;b<20;b++){for(Y=0;Y<3;Y++){const g=y[3*b+Y];v[Y].sd(j[3*B[g]],j[3*B[g]+1],j[3*B[g]+2]),v[Y].normalize(),P[Y].sd(.134765625*c[2*g]+.05859375+-.0390625*D[b],.2333984375*c[2*g+1]+.025390625+.01953125*D[b])}const g=(g,i,a,b)=>{const I=n.Bi.Lerp(v[0],v[2],i/d),j=n.Bi.Lerp(v[1],v[2],i/d),y=d===i?v[2]:n.Bi.Lerp(I,j,g/(d-i));let B;if(y.normalize(),L){const g=n.Bi.Lerp(v[0],v[2],b/d),i=n.Bi.Lerp(v[1],v[2],b/d);B=n.Bi.Lerp(g,i,a/(d-b))}else B=new n.Bi(y.x,y.y,y.z);B.x/=e,B.y/=N,B.z/=F,B.normalize();const c=n.Vector2.Lerp(P[0],P[2],i/d),D=n.Vector2.Lerp(P[1],P[2],i/d),Y=d===i?P[2]:n.Vector2.Lerp(c,D,g/(d-i));R.push(y.x*e,y.y*N,y.z*F),x.push(B.x,B.y,B.z),E.push(Y.x,k.e?1-Y.y:Y.y),p.push(X),X++};for(let i=0;i<d;i++)for(let a=0;a+i<d;a++)g(a,i,a+1/3,i+1/3),g(a+1,i,a+1/3,i+1/3),g(a,i+1,a+1/3,i+1/3),a+i+1<d&&(g(a+1,i,a+2/3,i+2/3),g(a+1,i+1,a+2/3,i+2/3),g(a,i+1,a+2/3,i+2/3))}b.c._ComputeSides(i,R,p,x,E,g.frontUVs,g.backUVs);const f=new b.c;return f.indices=p,f.fg=R,f.Cg=x,f.Sg=E,f}function z(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new L.e(g,a);i.sideOrientation=L.e._GetDefaultSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;return O(i).Kg(n,i.updatable),n}b.c.CreatePolyhedron=t,L.e.CreatePolyhedron=(g,i,a)=>A(g,i,a);b.c.CreateIcoSphere=O,L.e.CreateIcoSphere=(g,i,a)=>z(g,i,a);var s=a(12466);const mg=new n.Bi(1,0,0),r=new n.Bi(-1,0,0),Q=new n.Bi(0,1,0),o=new n.Bi(0,-1,0),u=new n.Bi(0,0,1),H=new n.Bi(0,0,-1);class M{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.Bi.Zero(),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Bi.Up(),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.Vector2.Zero(),L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=g,this.normal=i,this.uv=a,this.vertexIdx=L,this.vertexIdxForBones=d,this.localPositionOverride=b,this.localNormalOverride=k,this.matrixIndicesOverride=e,this.matrixWeightsOverride=N}clone(){var g,i,a,n;return new M(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(g=this.localPositionOverride)||void 0===g?void 0:g.slice(),null===(i=this.localNormalOverride)||void 0===i?void 0:i.slice(),null===(a=this.matrixIndicesOverride)||void 0===a?void 0:a.slice(),null===(n=this.matrixWeightsOverride)||void 0===n?void 0:n.slice())}}function q(g,i,a){var e,N,F,I,j;const y=!!i.skeleton,B=!(null===(e=i.morphTargetManager)||void 0===e||!e.numTargets),c=a.localMode||y,D=i.Ad(),p=y||B?i.he(!0,!0):i.getVerticesData(d.g.PositionKind),R=y||B?i.getNormalsData(!0,!0):i.getVerticesData(d.g.NormalKind),x=c?y?i.getVerticesData(d.g.PositionKind):p:null,E=c?y?i.getVerticesData(d.g.NormalKind):R:null,X=i.getVerticesData(d.g.UVKind),v=y?i.getVerticesData(d.g.MatricesIndicesKind):null,P=y?i.getVerticesData(d.g.MatricesWeightsKind):null,Y=y?i.getVerticesData(d.g.MatricesIndicesExtraKind):null,f=y?i.getVerticesData(d.g.MatricesWeightsExtraKind):null,C=a.position||n.Bi.Zero();let U=a.normal||n.Bi.Up();const S=a.size||n.Bi.One(),V=a.angle||0;if(!U){const g=new n.Bi(0,0,1),a=i.Pg().activeCamera,L=n.Bi.TransformCoordinates(g,a.getWorldMatrix());U=a.globalPosition.ci(L)}const K=-Math.atan2(U.z,U.x)-Math.PI/2,T=Math.sqrt(U.x*U.x+U.z*U.z),l=Math.atan2(U.y,T),Z=new b.c;Z.indices=[],Z.fg=[],Z.Cg=[],Z.Sg=[],Z.matricesIndices=y?[]:null,Z.matricesWeights=y?[]:null,Z.matricesIndicesExtra=Y?[]:null,Z.matricesWeightsExtra=f?[]:null;let h=0;const w=(g,i)=>{const L=new M;if(!D||!p||!R)return L;const d=D[g];if(L.vertexIdx=3*d,L.vertexIdxForBones=4*d,L.position=new n.Bi(p[3*d],p[3*d+1],p[3*d+2]),n.Bi.TransformCoordinatesToRef(L.position,i,L.position),L.normal=new n.Bi(R[3*d],R[3*d+1],R[3*d+2]),n.Bi.TransformNormalToRef(L.normal,i,L.normal),a.captureUVS&&X){const g=X[2*d+1];L.uv=new n.Vector2(X[2*d],k.e?1-g:g)}return L},t=[0,0,0,0],A=(g,i)=>{if(0===g.length)return g;const a=.5*Math.abs(n.Bi.Dot(S,i)),L=(g,i,a,n)=>{for(let L=0;L<n;++L)if(g[a+L]===i)return a+L;return-1},d=(g,d)=>{const b=n.Bi.GetClipFactor(g.position,d.position,i,a);let k=t,e=t;if(v&&P){const i=g.matrixIndicesOverride?0:g.vertexIdxForBones,a=g.matrixIndicesOverride??v,n=g.matrixWeightsOverride??P,N=d.matrixIndicesOverride?0:d.vertexIdxForBones,F=d.matrixIndicesOverride??v,I=d.matrixWeightsOverride??P;k=[0,0,0,0],e=[0,0,0,0];let j=0;for(let g=0;g<4;++g)if(n[i+g]>0){const d=L(F,a[i+g],N,4);k[j]=a[i+g],e[j]=(0,s.Lerp)(n[i+g],d>=0?I[d]:0,b),j++}for(let g=0;g<4&&j<4;++g){const n=F[N+g];-1===L(a,n,i,4)&&(k[j]=n,e[j]=(0,s.Lerp)(0,I[N+g],b),j++)}const y=e[0]+e[1]+e[2]+e[3];e[0]/=y,e[1]/=y,e[2]/=y,e[3]/=y}const N=g.localPositionOverride?g.localPositionOverride[0]:(null===x||void 0===x?void 0:x[g.vertexIdx])??0,F=g.localPositionOverride?g.localPositionOverride[1]:(null===x||void 0===x?void 0:x[g.vertexIdx+1])??0,I=g.localPositionOverride?g.localPositionOverride[2]:(null===x||void 0===x?void 0:x[g.vertexIdx+2])??0,j=d.localPositionOverride?d.localPositionOverride[0]:(null===x||void 0===x?void 0:x[d.vertexIdx])??0,y=d.localPositionOverride?d.localPositionOverride[1]:(null===x||void 0===x?void 0:x[d.vertexIdx+1])??0,B=d.localPositionOverride?d.localPositionOverride[2]:(null===x||void 0===x?void 0:x[d.vertexIdx+2])??0,c=g.localNormalOverride?g.localNormalOverride[0]:(null===E||void 0===E?void 0:E[g.vertexIdx])??0,D=g.localNormalOverride?g.localNormalOverride[1]:(null===E||void 0===E?void 0:E[g.vertexIdx+1])??0,p=g.localNormalOverride?g.localNormalOverride[2]:(null===E||void 0===E?void 0:E[g.vertexIdx+2])??0,R=c+((d.localNormalOverride?d.localNormalOverride[0]:(null===E||void 0===E?void 0:E[d.vertexIdx])??0)-c)*b,X=D+((d.localNormalOverride?d.localNormalOverride[1]:(null===E||void 0===E?void 0:E[d.vertexIdx+1])??0)-D)*b,Y=p+((d.localNormalOverride?d.localNormalOverride[2]:(null===E||void 0===E?void 0:E[d.vertexIdx+2])??0)-p)*b,f=Math.sqrt(R*R+X*X+Y*Y);return new M(n.Bi.Lerp(g.position,d.position,b),n.Bi.Lerp(g.normal,d.normal,b).normalize(),n.Vector2.Lerp(g.uv,d.uv,b),-1,-1,x?[N+(j-N)*b,F+(y-F)*b,I+(B-I)*b]:null,E?[R/f,X/f,Y/f]:null,k,e)};let b=null;g.length>3&&(b=[]);for(let k=0;k<g.length;k+=3){let L=0,e=null,N=null,F=null,I=null;const j=n.Bi.Dot(g[k].position,i)-a>0,y=n.Bi.Dot(g[k+1].position,i)-a>0,B=n.Bi.Dot(g[k+2].position,i)-a>0;switch(L=(j?1:0)+(y?1:0)+(B?1:0),L){case 0:g.length>3?(b.push(g[k]),b.push(g[k+1]),b.push(g[k+2])):b=g;break;case 1:if(b=b??new Array,j&&(e=g[k+1],N=g[k+2],F=d(g[k],e),I=d(g[k],N)),y){e=g[k],N=g[k+2],F=d(g[k+1],e),I=d(g[k+1],N),b.push(F),b.push(N.clone()),b.push(e.clone()),b.push(N.clone()),b.push(F.clone()),b.push(I);break}B&&(e=g[k],N=g[k+1],F=d(g[k+2],e),I=d(g[k+2],N)),e&&N&&F&&I&&(b.push(e.clone()),b.push(N.clone()),b.push(F),b.push(I),b.push(F.clone()),b.push(N.clone()));break;case 2:b=b??new Array,j||(e=g[k].clone(),N=d(e,g[k+1]),F=d(e,g[k+2]),b.push(e),b.push(N),b.push(F)),y||(e=g[k+1].clone(),N=d(e,g[k+2]),F=d(e,g[k]),b.push(e),b.push(N),b.push(F)),B||(e=g[k+2].clone(),N=d(e,g[k]),F=d(e,g[k+1]),b.push(e),b.push(N),b.push(F))}}return b},O=i instanceof L.e?i:null,z=null===O||void 0===O?void 0:O._thinInstanceDataStorage.matrixData,q=(null===O||void 0===O?void 0:O.gb)||1,W=n.TmpVectors.Matrix[0];W.I(n.Matrix.IdentityReadOnly);for(let L=0;L<q;++L){if(null!==O&&void 0!==O&&O.hasThinInstances&&z){const g=16*L;W.setRowFromFloats(0,z[g+0],z[g+1],z[g+2],z[g+3]),W.setRowFromFloats(1,z[g+4],z[g+5],z[g+6],z[g+7]),W.setRowFromFloats(2,z[g+8],z[g+9],z[g+10],z[g+11]),W.setRowFromFloats(3,z[g+12],z[g+13],z[g+14],z[g+15])}const g=n.Matrix.RotationYawPitchRoll(K,l,V).multiply(n.Matrix.Translation(C.x,C.y,C.z)),d=n.Matrix.Invert(g),b=i.getWorldMatrix(),e=W.multiply(b).multiply(d),N=new Array(3);for(let i=0;i<D.length;i+=3){let g=N;if(g[0]=w(i,e),g[1]=w(i+1,e),g[2]=w(i+2,e),!(a.cullBackFaces&&-g[0].normal.z<=0&&-g[1].normal.z<=0&&-g[2].normal.z<=0)&&(g=A(g,mg),g&&(g=A(g,r),g&&(g=A(g,Q),g&&(g=A(g,o),g&&(g=A(g,u),g&&(g=A(g,H),g)))))))for(let i=0;i<g.length;i++){const n=g[i];if(Z.indices.push(h),c?(n.localPositionOverride?(Z.fg[3*h]=n.localPositionOverride[0],Z.fg[3*h+1]=n.localPositionOverride[1],Z.fg[3*h+2]=n.localPositionOverride[2]):x&&(Z.fg[3*h]=x[n.vertexIdx],Z.fg[3*h+1]=x[n.vertexIdx+1],Z.fg[3*h+2]=x[n.vertexIdx+2]),n.localNormalOverride?(Z.Cg[3*h]=n.localNormalOverride[0],Z.Cg[3*h+1]=n.localNormalOverride[1],Z.Cg[3*h+2]=n.localNormalOverride[2]):E&&(Z.Cg[3*h]=E[n.vertexIdx],Z.Cg[3*h+1]=E[n.vertexIdx+1],Z.Cg[3*h+2]=E[n.vertexIdx+2])):(n.position.toArray(Z.fg,3*h),n.normal.toArray(Z.Cg,3*h)),Z.matricesIndices&&Z.matricesWeights&&(n.matrixIndicesOverride?(Z.matricesIndices[4*h]=n.matrixIndicesOverride[0],Z.matricesIndices[4*h+1]=n.matrixIndicesOverride[1],Z.matricesIndices[4*h+2]=n.matrixIndicesOverride[2],Z.matricesIndices[4*h+3]=n.matrixIndicesOverride[3]):(v&&(Z.matricesIndices[4*h]=v[n.vertexIdxForBones],Z.matricesIndices[4*h+1]=v[n.vertexIdxForBones+1],Z.matricesIndices[4*h+2]=v[n.vertexIdxForBones+2],Z.matricesIndices[4*h+3]=v[n.vertexIdxForBones+3]),Y&&Z.matricesIndicesExtra&&(Z.matricesIndicesExtra[4*h]=Y[n.vertexIdxForBones],Z.matricesIndicesExtra[4*h+1]=Y[n.vertexIdxForBones+1],Z.matricesIndicesExtra[4*h+2]=Y[n.vertexIdxForBones+2],Z.matricesIndicesExtra[4*h+3]=Y[n.vertexIdxForBones+3])),n.matrixWeightsOverride?(Z.matricesWeights[4*h]=n.matrixWeightsOverride[0],Z.matricesWeights[4*h+1]=n.matrixWeightsOverride[1],Z.matricesWeights[4*h+2]=n.matrixWeightsOverride[2],Z.matricesWeights[4*h+3]=n.matrixWeightsOverride[3]):(P&&(Z.matricesWeights[4*h]=P[n.vertexIdxForBones],Z.matricesWeights[4*h+1]=P[n.vertexIdxForBones+1],Z.matricesWeights[4*h+2]=P[n.vertexIdxForBones+2],Z.matricesWeights[4*h+3]=P[n.vertexIdxForBones+3]),f&&Z.matricesWeightsExtra&&(Z.matricesWeightsExtra[4*h]=f[n.vertexIdxForBones],Z.matricesWeightsExtra[4*h+1]=f[n.vertexIdxForBones+1],Z.matricesWeightsExtra[4*h+2]=f[n.vertexIdxForBones+2],Z.matricesWeightsExtra[4*h+3]=f[n.vertexIdxForBones+3]))),a.captureUVS)n.uv.toArray(Z.Sg,2*h);else{Z.Sg.push(.5+n.position.x/S.x);const g=.5+n.position.y/S.y;Z.Sg.push(k.e?1-g:g)}h++}}}0===Z.indices.length&&(Z.indices=null),0===Z.fg.length&&(Z.fg=null),0===Z.Cg.length&&(Z.Cg=null),0===Z.Sg.length&&(Z.Sg=null),0===(null===(N=Z.matricesIndices)||void 0===N?void 0:N.length)&&(Z.matricesIndices=null),0===(null===(F=Z.matricesWeights)||void 0===F?void 0:F.length)&&(Z.matricesWeights=null),0===(null===(I=Z.matricesIndicesExtra)||void 0===I?void 0:I.length)&&(Z.matricesIndicesExtra=null),0===(null===(j=Z.matricesWeightsExtra)||void 0===j?void 0:j.length)&&(Z.matricesWeightsExtra=null);const G=new L.e(g,i.Pg());return Z.Kg(G),c?(G.skeleton=i.skeleton,G.parent=i):(G.position=C.clone(),G.rotation=new n.Bi(l,K,V)),G.Zd(!0),G.refreshBoundingInfo(!0,!0),G}function W(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const i=0|Math.max(g.subdivisions?g.subdivisions:2,1),a=0|Math.max(g.tessellation?g.tessellation:16,3),L=Math.max(g.height?g.height:1,0),d=Math.max(g.radius?g.radius:.25,0),e=0|Math.max(g.capSubdivisions?g.capSubdivisions:6,1),N=a,F=i,I=Math.max(g.radiusTop?g.radiusTop:d,0),j=Math.max(g.radiusBottom?g.radiusBottom:d,0),y=L-(I+j),B=2*Math.PI,c=Math.max(g.topCapSubdivisions?g.topCapSubdivisions:e,1),D=Math.max(g.bottomCapSubdivisions?g.bottomCapSubdivisions:e,1),p=Math.acos((j-I)/L);let R=[];const x=[],E=[],X=[];let v=0;const P=[],Y=.5*y,f=.5*Math.PI;let C,U;const S=n.Bi.Zero(),V=n.Bi.Zero(),K=Math.cos(p),T=Math.sin(p),l=new n.Vector2(I*T,Y+I*K).ci(new n.Vector2(j*T,j*K-Y)).length(),Z=I*p+l+j*(f-p);let h=0;for(U=0;U<=c;U++){const g=[],i=f-p*(U/c);h+=I*p/c;const a=Math.cos(i),n=Math.sin(i),L=a*I;for(C=0;C<=N;C++){const i=C/N,d=i*B+0,b=Math.sin(d),e=Math.cos(d);V.x=L*b,V.y=Y+n*I,V.z=L*e,x.push(V.x,V.y,V.z),S.set(a*b,n,a*e),E.push(S.x,S.y,S.z),X.push(i,k.e?h/Z:1-h/Z),g.push(v),v++}P.push(g)}const w=L-I-j+K*I-K*j,t=T*(j-I)/w;for(U=1;U<=F;U++){const g=[];h+=l/F;const i=T*(U*(j-I)/F+I);for(C=0;C<=N;C++){const a=C/N,n=a*B+0,L=Math.sin(n),d=Math.cos(n);V.x=i*L,V.y=Y+K*I-U*w/F,V.z=i*d,x.push(V.x,V.y,V.z),S.set(L,t,d).normalize(),E.push(S.x,S.y,S.z),X.push(a,k.e?h/Z:1-h/Z),g.push(v),v++}P.push(g)}for(U=1;U<=D;U++){const g=[],i=f-p-(Math.PI-p)*(U/D);h+=j*p/D;const a=Math.cos(i),n=Math.sin(i),L=a*j;for(C=0;C<=N;C++){const i=C/N,d=i*B+0,b=Math.sin(d),e=Math.cos(d);V.x=L*b,V.y=n*j-Y,V.z=L*e,x.push(V.x,V.y,V.z),S.set(a*b,n,a*e),E.push(S.x,S.y,S.z),X.push(i,k.e?h/Z:1-h/Z),g.push(v),v++}P.push(g)}for(C=0;C<N;C++)for(U=0;U<c+F+D;U++){const g=P[U][C],i=P[U+1][C],a=P[U+1][C+1],n=P[U][C+1];R.push(g),R.push(i),R.push(n),R.push(i),R.push(a),R.push(n)}if(R=R.reverse(),g.orientation&&!g.orientation.equals(n.Bi.Up())){const i=new n.Matrix;g.orientation.clone().scale(.5*Math.PI).cross(n.Bi.Up()).toQuaternion().toRotationMatrix(i);const a=n.Bi.Zero();for(let g=0;g<x.length;g+=3)a.set(x[g],x[g+1],x[g+2]),n.Bi.TransformCoordinatesToRef(a.clone(),i,a),x[g]=a.x,x[g+1]=a.y,x[g+2]=a.z}const A=new b.c;return A.fg=x,A.Cg=E,A.Sg=X,A.indices=R,A}function G(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:n.Bi.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new L.e(g,a);return W(i).Kg(d,i.updatable),d}L.e.CreateDecal=(g,i,a,n,L,d)=>q(g,i,{position:a,normal:n,size:L,angle:d});L.e.CreateCapsule=(g,i,a)=>G(g,i,a),b.c.CreateCapsule=W;var J=a(12292),gg=a(12454);class ig{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=g,this.y=i,g!==Math.floor(g)&&(g=Math.floor(g),J.b.Warn("x is not an integer, floor(x) used")),i!==Math.floor(i)&&(i=Math.floor(i),J.b.Warn("y is not an integer, floor(y) used"))}clone(){return new ig(this.x,this.y)}rotate60About(g){const i=this.x;return this.x=g.x+g.y-this.y,this.y=i+this.y-g.x,this}rotateNeg60About(g){const i=this.x;return this.x=i+this.y-g.y,this.y=g.x+g.y-i,this}rotate120(g,i){g!==Math.floor(g)&&(g=Math.floor(g),J.b.Warn("m not an integer only floor(m) used")),i!==Math.floor(i)&&(i=Math.floor(i),J.b.Warn("n not an integer only floor(n) used"));const a=this.x;return this.x=g-a-this.y,this.y=i+a,this}rotateNeg120(g,i){g!==Math.floor(g)&&(g=Math.floor(g),J.b.Warn("m is not an integer, floor(m) used")),i!==Math.floor(i)&&(i=Math.floor(i),J.b.Warn("n is not an integer,   floor(n) used"));const a=this.x;return this.x=this.y-i,this.y=g+i-a-this.y,this}toCartesianOrigin(g,i){const a=n.Bi.Zero();return a.x=g.x+2*this.x*i+this.y*i,a.y=g.y+Math.sqrt(3)*this.y*i,a}static Zero(){return new ig(0,0)}}class ag{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new ng("icosahedron","Regular",[[0,gg.e,-1],[-gg.e,1,0],[-1,0,-gg.e],[1,0,-gg.e],[gg.e,1,0],[0,gg.e,1],[-1,0,gg.e],[-gg.e,-1,0],[0,-gg.e,-1],[gg.e,-1,0],[1,0,gg.e],[0,-gg.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let g=12;const i={},a=this.m,n=this.n;let L,d,b,k,e,N=a,F=1,I=0;0!==n&&(N=(0,s.HighestCommonFactor)(a,n)),F=a/N,I=n/N;const j=ig.Zero(),y=new ig(a,n),B=new ig(-n,a+n),c=ig.Zero(),D=ig.Zero(),p=ig.Zero();let R,x,E,X,v=[];const P=[],Y=this.vertByDist,f=(a,n,L,d)=>{R=a+"|"+L,x=n+"|"+d,R in i||x in i?R in i&&!(x in i)?i[x]=i[R]:x in i&&!(R in i)&&(i[R]=i[x]):(i[R]=g,i[x]=g,g++),Y[L][0]>2?P[i[R]]=[-Y[L][0],Y[L][1],i[R]]:P[i[R]]=[v[Y[L][0]],Y[L][1],i[R]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let C=0;C<20;C++){if(v=this.IDATA.face[C],b=v[2],k=v[1],e=v[0],E=j.x+"|"+j.y,R=C+"|"+E,R in i||(i[R]=b,P[b]=[v[Y[E][0]],Y[E][1]]),E=y.x+"|"+y.y,R=C+"|"+E,R in i||(i[R]=k,P[k]=[v[Y[E][0]],Y[E][1]]),E=B.x+"|"+B.y,R=C+"|"+E,R in i||(i[R]=e,P[e]=[v[Y[E][0]],Y[E][1]]),L=this.IDATA.edgematch[C][0],d=this.IDATA.edgematch[C][1],"B"===d)for(let g=1;g<N;g++)D.x=a-g*(F+I),D.y=n+g*F,p.x=-g*I,p.y=g*(F+I),E=D.x+"|"+D.y,X=p.x+"|"+p.y,f(C,L,E,X);if("O"===d)for(let g=1;g<N;g++)p.x=-g*I,p.y=g*(F+I),c.x=g*F,c.y=g*I,E=p.x+"|"+p.y,X=c.x+"|"+c.y,f(C,L,E,X);if(L=this.IDATA.edgematch[C][2],d=this.IDATA.edgematch[C][3],d&&"A"===d)for(let g=1;g<N;g++)c.x=g*F,c.y=g*I,D.x=a-(N-g)*(F+I),D.y=n+(N-g)*F,E=c.x+"|"+c.y,X=D.x+"|"+D.y,f(C,L,E,X);for(let a=0;a<this.vertices.length;a++)E=this.vertices[a].x+"|"+this.vertices[a].y,R=C+"|"+E,R in i||(i[R]=g++,Y[E][0]>2?P[i[R]]=[-Y[E][0],Y[E][1],i[R]]:P[i[R]]=[v[Y[E][0]],Y[E][1],i[R]])}this.closestTo=P,this.vecToidx=i}calcCoeffs(){const g=this.m,i=this.n,a=Math.sqrt(3)/3,n=g*g+i*i+g*i;this.coau=(g+i)/n,this.cobu=-i/n,this.coav=-a*(g-i)/n,this.cobv=a*(2*g+i)/n}createInnerFacets(){const g=this.m,i=this.n;for(let a=0;a<i+g+1;a++)for(let g=this.min[a];g<this.max[a]+1;g++)g<this.max[a]&&g<this.max[a+1]+1&&this.innerFacets.push(["|"+g+"|"+a,"|"+g+"|"+(a+1),"|"+(g+1)+"|"+a]),a>0&&g<this.max[a-1]&&g+1<this.max[a]+1&&this.innerFacets.push(["|"+g+"|"+a,"|"+(g+1)+"|"+a,"|"+(g+1)+"|"+(a-1)])}edgeVecsABOB(){const g=this.m,i=this.n,a=new ig(-i,g+i);for(let n=1;n<g+i;n++){const g=new ig(this.min[n],n),i=new ig(this.min[n-1],n-1),L=new ig(this.min[n+1],n+1),d=g.clone(),b=i.clone(),k=L.clone();d.rotate60About(a),b.rotate60About(a),k.rotate60About(a);const e=new ig(this.max[d.y],d.y),N=new ig(this.max[d.y-1],d.y-1),F=new ig(this.max[d.y-1]-1,d.y-1);d.x===e.x&&d.y===e.y||(d.x!==N.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([g,N,F]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([g,F,e])):d.y===k.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([g,i,N]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([g,N,L])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([g,i,N]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([g,N,e])))}}mapABOBtoOBOA(){const g=new ig(0,0);for(let i=0;i<this.isoVecsABOB.length;i++){const a=[];for(let n=0;n<3;n++)g.x=this.isoVecsABOB[i][n].x,g.y=this.isoVecsABOB[i][n].y,0===this.vertexTypes[i][n]&&g.rotateNeg120(this.m,this.n),a.push(g.clone());this.isoVecsOBOA.push(a)}}mapABOBtoBAOA(){const g=new ig(0,0);for(let i=0;i<this.isoVecsABOB.length;i++){const a=[];for(let n=0;n<3;n++)g.x=this.isoVecsABOB[i][n].x,g.y=this.isoVecsABOB[i][n].y,1===this.vertexTypes[i][n]&&g.rotate120(this.m,this.n),a.push(g.clone());this.isoVecsBAOA.push(a)}}MapToFace(g,i){const a=this.IDATA.face[g],L=a[2],d=a[1],b=a[0],k=n.Bi.xi(this.IDATA.vertex[L]),e=n.Bi.xi(this.IDATA.vertex[d]),N=n.Bi.xi(this.IDATA.vertex[b]),F=e.ci(k),I=N.ci(k),j=F.scale(this.coau).add(I.scale(this.cobu)),y=F.scale(this.coav).add(I.scale(this.cobv)),B=[];let c,D=n.TmpVectors.Bi[0];for(let n=0;n<this.cartesian.length;n++)D=j.scale(this.cartesian[n].x).add(y.scale(this.cartesian[n].y)).add(k),B[n]=[D.x,D.y,D.z],c=g+"|"+this.vertices[n].x+"|"+this.vertices[n].y,i.vertex[this.vecToidx[c]]=[D.x,D.y,D.z]}build(g,i){const a=[],n=ig.Zero(),L=new ig(g,i),d=new ig(-i,g+i);a.push(n,L,d);for(let E=i;E<g+1;E++)for(let i=0;i<g+1-E;i++)a.push(new ig(i,E));if(i>0){const n=(0,s.HighestCommonFactor)(g,i),L=g/n,d=i/n;for(let k=1;k<n;k++)a.push(new ig(k*L,k*d)),a.push(new ig(-k*d,k*(L+d))),a.push(new ig(g-k*(L+d),i+k*L));const b=g/i;for(let k=1;k<i;k++)for(let n=0;n<k*b;n++)a.push(new ig(n,k)),a.push(new ig(n,k).rotate120(g,i)),a.push(new ig(n,k).rotateNeg120(g,i))}a.sort(((g,i)=>g.x-i.x)),a.sort(((g,i)=>g.y-i.y));const b=new Array(g+i+1),k=new Array(g+i+1);for(let E=0;E<b.length;E++)b[E]=1/0,k[E]=-1/0;let e=0,N=0;const F=a.length;for(let E=0;E<F;E++)N=a[E].x,e=a[E].y,b[e]=Math.min(N,b[e]),k[e]=Math.max(N,k[e]);const I=(a,n)=>{const L=a.clone();return"A"===n&&L.rotateNeg120(g,i),"B"===n&&L.rotate120(g,i),L.x<0?L.y:L.x+L.y},j=[],y=[],B=[],c=[],D={},p=[];let R=-1,x=-1;for(let E=0;E<F;E++)j[E]=a[E].toCartesianOrigin(new ig(0,0),.5),y[E]=I(a[E],"O"),B[E]=I(a[E],"A"),c[E]=I(a[E],"B"),y[E]===B[E]&&B[E]===c[E]?(R=3,x=y[E]):y[E]===B[E]?(R=4,x=y[E]):B[E]===c[E]?(R=5,x=B[E]):c[E]===y[E]&&(R=6,x=y[E]),y[E]<B[E]&&y[E]<c[E]&&(R=2,x=y[E]),B[E]<y[E]&&B[E]<c[E]&&(R=1,x=B[E]),c[E]<B[E]&&c[E]<y[E]&&(R=0,x=c[E]),p.push([R,x,a[E].x,a[E].y]);p.sort(((g,i)=>g[2]-i[2])),p.sort(((g,i)=>g[3]-i[3])),p.sort(((g,i)=>g[1]-i[1])),p.sort(((g,i)=>g[0]-i[0]));for(let E=0;E<p.length;E++)D[p[E][2]+"|"+p[E][3]]=[p[E][0],p[E][1],E];return this.m=g,this.n=i,this.vertices=a,this.vertByDist=D,this.cartesian=j,this.min=b,this.max=k,this}}class ng{constructor(g,i,a,n){this.name=g,this.category=i,this.vertex=a,this.face=n}}class Lg extends ng{innerToData(g,i){for(let a=0;a<i.innerFacets.length;a++)this.face.push(i.innerFacets[a].map((a=>i.vecToidx[g+a])))}mapABOBtoDATA(g,i){const a=i.IDATA.edgematch[g][0];for(let n=0;n<i.isoVecsABOB.length;n++){const L=[];for(let d=0;d<3;d++)0===i.vertexTypes[n][d]?L.push(g+"|"+i.isoVecsABOB[n][d].x+"|"+i.isoVecsABOB[n][d].y):L.push(a+"|"+i.isoVecsABOB[n][d].x+"|"+i.isoVecsABOB[n][d].y);this.face.push([i.vecToidx[L[0]],i.vecToidx[L[1]],i.vecToidx[L[2]]])}}mapOBOAtoDATA(g,i){const a=i.IDATA.edgematch[g][0];for(let n=0;n<i.isoVecsOBOA.length;n++){const L=[];for(let d=0;d<3;d++)1===i.vertexTypes[n][d]?L.push(g+"|"+i.isoVecsOBOA[n][d].x+"|"+i.isoVecsOBOA[n][d].y):L.push(a+"|"+i.isoVecsOBOA[n][d].x+"|"+i.isoVecsOBOA[n][d].y);this.face.push([i.vecToidx[L[0]],i.vecToidx[L[1]],i.vecToidx[L[2]]])}}mapBAOAtoDATA(g,i){const a=i.IDATA.edgematch[g][2];for(let n=0;n<i.isoVecsBAOA.length;n++){const L=[];for(let d=0;d<3;d++)1===i.vertexTypes[n][d]?L.push(g+"|"+i.isoVecsBAOA[n][d].x+"|"+i.isoVecsBAOA[n][d].y):L.push(a+"|"+i.isoVecsBAOA[n][d].x+"|"+i.isoVecsBAOA[n][d].y);this.face.push([i.vecToidx[L[0]],i.vecToidx[L[1]],i.vecToidx[L[2]]])}}orderData(g){const i=[];for(let d=0;d<13;d++)i[d]=[];const a=g.closestTo;for(let d=0;d<a.length;d++)a[d][0]>-1?a[d][1]>0&&i[a[d][0]].push([d,a[d][1]]):i[12].push([d,a[d][0]]);const n=[];for(let d=0;d<12;d++)n[d]=d;let L=12;for(let d=0;d<12;d++){i[d].sort(((g,i)=>g[1]-i[1]));for(let g=0;g<i[d].length;g++)n[i[d][g][0]]=L++}for(let d=0;d<i[12].length;d++)n[i[12][d][0]]=L++;for(let d=0;d<this.vertex.length;d++)this.vertex[d].push(n[d]);this.vertex.sort(((g,i)=>g[3]-i[3]));for(let d=0;d<this.vertex.length;d++)this.vertex[d].pop();for(let d=0;d<this.face.length;d++)for(let g=0;g<this.face[d].length;g++)this.face[d][g]=n[this.face[d][g]];this.sharedNodes=i[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(g,i){const a=[],n=[];let L=i.pop();n.push(L);let d=this.face[L].indexOf(g);d=(d+2)%3;let b=this.face[L][d];a.push(b);let k=0;for(;i.length>0;)L=i[k],this.face[L].indexOf(b)>-1?(d=(this.face[L].indexOf(b)+1)%3,b=this.face[L][d],a.push(b),n.push(L),i.splice(k,1),k=0):k++;return this.adjacentFaces.push(a),n}toGoldbergPolyhedronData(){const g=new ng("GeoDual","Goldberg",[],[]);g.name="GD dual";const i=this.vertex.length,a=new Array(i);for(let e=0;e<i;e++)a[e]=[];for(let e=0;e<this.face.length;e++)for(let g=0;g<3;g++)a[this.face[e][g]].push(e);let n=0,L=0,d=0,b=[],k=[];this.adjacentFaces=[];for(let e=0;e<a.length;e++){g.face[e]=this.setOrder(e,a[e].concat([]));for(const i of a[e]){n=0,L=0,d=0,b=this.face[i];for(let g=0;g<3;g++)k=this.vertex[b[g]],n+=k[0],L+=k[1],d+=k[2];g.vertex[i]=[n/3,L/3,d/3]}}return g}static BuildGeodesicData(g){const i=new Lg("Geodesic-m-n","Geodesic",[[0,gg.e,-1],[-gg.e,1,0],[-1,0,-gg.e],[1,0,-gg.e],[gg.e,1,0],[0,gg.e,1],[-1,0,gg.e],[-gg.e,-1,0],[0,-gg.e,-1],[gg.e,-1,0],[1,0,gg.e],[0,-gg.e,1]],[]);g.setIndices(),g.calcCoeffs(),g.createInnerFacets(),g.edgeVecsABOB(),g.mapABOBtoOBOA(),g.mapABOBtoBAOA();for(let a=0;a<g.IDATA.face.length;a++)g.MapToFace(a,i),i.innerToData(a,g),"B"===g.IDATA.edgematch[a][1]&&i.mapABOBtoDATA(a,g),"O"===g.IDATA.edgematch[a][1]&&i.mapOBOAtoDATA(a,g),"A"===g.IDATA.edgematch[a][3]&&i.mapBAOAtoDATA(a,g);i.orderData(g);return i.vertex=i.vertex.map((function(g){const i=g[0],a=g[1],n=g[2],L=Math.sqrt(i*i+a*a+n*n);return g[0]*=1/L,g[1]*=1/L,g[2]*=1/L,g})),i}}L.e._GoldbergMeshParser=(g,i)=>dg.Parse(g,i);class dg extends L.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(g,i){return void 0===i?(g>this.goldbergData.nbUnsharedFaces-1&&(J.b.Warn("Maximum number of unshared faces used"),g=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+g):(g>11&&(J.b.Warn("Last pole used"),g=11),i>this.goldbergData.nbFacesAtPole-1&&(J.b.Warn("Maximum number of faces at a pole used"),i=this.goldbergData.nbFacesAtPole-1),12+g*this.goldbergData.nbFacesAtPole+i)}_changeGoldbergFaceColors(g){for(let a=0;a<g.length;a++){const i=g[a][0],n=g[a][1],L=g[a][2];for(let g=i;g<n+1;g++)this.goldbergData.faceColors[g]=L}const i=[];for(let a=0;a<12;a++)for(let g=0;g<5;g++)i.push(this.goldbergData.faceColors[a].r,this.goldbergData.faceColors[a].g,this.goldbergData.faceColors[a].b,this.goldbergData.faceColors[a].a);for(let a=12;a<this.goldbergData.faceColors.length;a++)for(let g=0;g<6;g++)i.push(this.goldbergData.faceColors[a].r,this.goldbergData.faceColors[a].g,this.goldbergData.faceColors[a].b,this.goldbergData.faceColors[a].a);return i}setGoldbergFaceColors(g){const i=this._changeGoldbergFaceColors(g);this.hg(d.g.ColorKind,i)}updateGoldbergFaceColors(g){const i=this._changeGoldbergFaceColors(g);this.updateVerticesData(d.g.ColorKind,i)}_changeGoldbergFaceUVs(g){const i=this.getVerticesData(d.g.UVKind);for(let a=0;a<g.length;a++){const n=g[a][0],L=g[a][1],d=g[a][2],b=g[a][3],k=g[a][4],e=[],N=[];let F,I;for(let g=0;g<5;g++)F=d.x+b*Math.cos(k+g*Math.PI/2.5),I=d.y+b*Math.sin(k+g*Math.PI/2.5),F<0&&(F=0),F>1&&(F=1),e.push(F,I);for(let g=0;g<6;g++)F=d.x+b*Math.cos(k+g*Math.PI/3),I=d.y+b*Math.sin(k+g*Math.PI/3),F<0&&(F=0),F>1&&(F=1),N.push(F,I);for(let g=n;g<Math.min(12,L+1);g++)for(let a=0;a<5;a++)i[10*g+2*a]=e[2*a],i[10*g+2*a+1]=e[2*a+1];for(let g=Math.max(12,n);g<L+1;g++)for(let a=0;a<6;a++)i[12*g-24+2*a]=N[2*a],i[12*g-23+2*a]=N[2*a+1]}return i}setGoldbergFaceUVs(g){const i=this._changeGoldbergFaceUVs(g);this.hg(d.g.UVKind,i)}updateGoldbergFaceUVs(g){const i=this._changeGoldbergFaceUVs(g);this.updateVerticesData(d.g.UVKind,i)}placeOnGoldbergFaceAt(g,i,a){const L=n.Bi.RotationFromAxis(this.goldbergData.faceXaxis[i],this.goldbergData.faceYaxis[i],this.goldbergData.faceZaxis[i]);g.rotation=L,g.position=this.goldbergData.faceCenters[i].add(this.goldbergData.faceXaxis[i].scale(a.x)).add(this.goldbergData.faceYaxis[i].scale(a.y)).add(this.goldbergData.faceZaxis[i].scale(a.z))}serialize(g){super.serialize(g),g.type="GoldbergMesh";const i={};if(i.adjacentFaces=this.goldbergData.adjacentFaces,i.nbSharedFaces=this.goldbergData.nbSharedFaces,i.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,i.nbFaces=this.goldbergData.nbFaces,i.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){i.faceColors=[];for(const g of this.goldbergData.faceColors)i.faceColors.push(g.fd())}if(this.goldbergData.faceCenters){i.faceCenters=[];for(const g of this.goldbergData.faceCenters)i.faceCenters.push(g.fd())}if(this.goldbergData.faceZaxis){i.faceZaxis=[];for(const g of this.goldbergData.faceZaxis)i.faceZaxis.push(g.fd())}if(this.goldbergData.faceYaxis){i.faceYaxis=[];for(const g of this.goldbergData.faceYaxis)i.faceYaxis.push(g.fd())}if(this.goldbergData.faceXaxis){i.faceXaxis=[];for(const g of this.goldbergData.faceXaxis)i.faceXaxis.push(g.fd())}g.goldbergData=i}static Parse(g,i){const a=g.goldbergData;a.faceColors=a.faceColors.map((g=>j.Hd.xi(g))),a.faceCenters=a.faceCenters.map((g=>n.Bi.xi(g))),a.faceZaxis=a.faceZaxis.map((g=>n.Bi.xi(g))),a.faceXaxis=a.faceXaxis.map((g=>n.Bi.xi(g))),a.faceYaxis=a.faceYaxis.map((g=>n.Bi.xi(g)));const L=new dg(g.name,i);return L.goldbergData=a,L}}var bg=a(13017);const kg={CreateBox:I.c,CreateTiledBox:D,CreateSphere:p.d,CreateDisc:F.b,CreateIcoSphere:z,CreateRibbon:N,CreateCylinder:X,CreateTorus:P,CreateTorusKnot:f,CreateLineSystem:C.f,RF:C.g,CreateDashedLines:C.e,ExtrudeShape:V,ExtrudeShapeCustom:K,CreateLathe:l,CreateTiledPlane:B,XF:Z.c,CreateGround:h.c,CreateTiledGround:h.e,CreateGroundFromHeightMap:h.b,CreatePolygon:U.e,ExtrudePolygon:U.h,CreateTube:w,CreatePolyhedron:A,CreateGeodesic:function(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=i.m||1;n!==Math.floor(n)&&(n=Math.floor(n),J.b.Warn("m not an integer only floor(m) used"));let L=i.n||0;if(L!==Math.floor(L)&&(L=Math.floor(L),J.b.Warn("n not an integer only floor(n) used")),L>n){const g=L;L=n,n=g,J.b.Warn("n > m therefore m and n swapped")}const d=new ag;return d.build(n,L),A(g,{custom:Lg.BuildGeodesicData(d),size:i.size,sizeX:i.sizeX,sizeY:i.sizeY,sizeZ:i.sizeZ,faceUV:i.faceUV,faceColors:i.faceColors,flat:i.flat,updatable:i.updatable,sideOrientation:i.sideOrientation,frontUVs:i.frontUVs,backUVs:i.backUVs},a)},CreateGoldberg:function(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=i.size,e=i.sizeX||d||1,N=i.sizeY||d||1,F=i.sizeZ||d||1;let I=i.m||1;I!==Math.floor(I)&&(I=Math.floor(I),J.b.Warn("m not an integer only floor(m) used"));let y=i.n||0;if(y!==Math.floor(y)&&(y=Math.floor(y),J.b.Warn("n not an integer only floor(n) used")),y>I){const g=y;y=I,I=g,J.b.Warn("n > m therefore m and n swapped")}const B=new ag;B.build(I,y);const c=Lg.BuildGeodesicData(B),D=c.toGoldbergPolyhedronData(),p=new dg(g,a);i.sideOrientation=L.e._GetDefaultSideOrientation(i.sideOrientation),p._originalBuilderSideOrientation=i.sideOrientation;(function(g,i){const a=g.size,L=g.sizeX||a||1,d=g.sizeY||a||1,e=g.sizeZ||a||1,N=0===g.sideOrientation?0:g.sideOrientation||b.c.DEFAULTSIDE,F=[],I=[],j=[],y=[];let B=1/0,c=-1/0,D=1/0,p=-1/0;for(let n=0;n<i.vertex.length;n++)B=Math.min(B,i.vertex[n][0]*L),c=Math.max(c,i.vertex[n][0]*L),D=Math.min(D,i.vertex[n][1]*d),p=Math.max(p,i.vertex[n][1]*d);let R=0;for(let b=0;b<i.face.length;b++){const g=i.face[b],a=n.Bi.xi(i.vertex[g[0]]),N=n.Bi.xi(i.vertex[g[2]]),x=n.Bi.xi(i.vertex[g[1]]),E=N.ci(a),X=x.ci(a),v=n.Bi.Cross(X,E).normalize();for(let n=0;n<g.length;n++){j.push(v.x,v.y,v.z);const a=i.vertex[g[n]];F.push(a[0]*L,a[1]*d,a[2]*e);const b=(a[1]*d-D)/(p-D);y.push((a[0]*L-B)/(c-B),k.e?1-b:b)}for(let i=0;i<g.length-2;i++)I.push(R,R+i+2,R+i+1);R+=g.length}b.c._ComputeSides(N,F,I,j,y);const x=new b.c;return x.fg=F,x.indices=I,x.Cg=j,x.Sg=y,x})(i,D).Kg(p,i.updatable),p.goldbergData.nbSharedFaces=c.sharedNodes,p.goldbergData.nbUnsharedFaces=c.poleNodes,p.goldbergData.adjacentFaces=c.adjacentFaces,p.goldbergData.nbFaces=p.goldbergData.nbSharedFaces+p.goldbergData.nbUnsharedFaces,p.goldbergData.nbFacesAtPole=(p.goldbergData.nbUnsharedFaces-12)/12;for(let L=0;L<c.vertex.length;L++)p.goldbergData.faceCenters.push(n.Bi.xi(c.vertex[L])),p.goldbergData.faceCenters[L].x*=e,p.goldbergData.faceCenters[L].y*=N,p.goldbergData.faceCenters[L].z*=F,p.goldbergData.faceColors.push(new j.Hd(1,1,1,1));for(let L=0;L<D.face.length;L++){const g=D.face[L],i=n.Bi.xi(D.vertex[g[0]]),a=n.Bi.xi(D.vertex[g[2]]),d=n.Bi.xi(D.vertex[g[1]]),b=a.ci(i),k=d.ci(i),e=n.Bi.Cross(k,b).normalize(),N=n.Bi.Cross(k,e).normalize();p.goldbergData.faceXaxis.push(k.normalize()),p.goldbergData.faceYaxis.push(e),p.goldbergData.faceZaxis.push(N)}return p},CreateDecal:q,CreateCapsule:G,CreateText:bg.g}},13763:(g,i,a)=>{"use strict";a.d(i,{c:()=>ki});var n=a(12452),L=a(12843);class d extends L.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var b=a(12496),k=(a(12627),a(12415));class e{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(g){this._targetStopDuration!==g&&(this._targetStopDuration=g)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(g){this._noiseTexture!==g&&(this._noiseTexture=g,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(g){this._animationSheetEnabled!==g&&(this._animationSheetEnabled=g)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(g){this._isAnimationSheetEnabled!=g&&(this._isAnimationSheetEnabled=g,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(g){this._useLogarithmicDepth=g&&this.Pg().getEngine().getCaps().fragmentDepthSupported}Pg(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(g){switch(g){case e.BLENDMODE_MULTIPLYADD:return;case e.BLENDMODE_ADD:g=1;break;case e.BLENDMODE_ONEONE:g=6;break;case e.BLENDMODE_STANDARD:g=2;break;case e.BLENDMODE_MULTIPLY:g=4;break;case e.BLENDMODE_SUBTRACT:g=3}this._engine.setAlphaMode(g)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:n.Bi.Zero()}set direction1(g){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=g)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:n.Bi.Zero()}set direction2(g){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=g)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:n.Bi.Zero()}set minEmitBox(g){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=g)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:n.Bi.Zero()}set maxEmitBox(g){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=g)}get billboardMode(){return this._billboardMode}set billboardMode(g){this._billboardMode!==g&&(this._billboardMode=g,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(g){this._isBillboardBased!==g&&(this._isBillboardBased=g,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(g){this._attachImageProcessingConfiguration(g)}_attachImageProcessingConfiguration(g){g!==this._imageProcessingConfiguration&&(!g&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=g)}_reset(){}_removeGradientAndTexture(g,i,a){if(!i)return this;let n=0;for(const L of i){if(L.gradient===g){i.splice(n,1);break}n++}return a&&a.dispose(),this}constructor(g){this.animations=[],this.renderingGroupId=0,this.ni=n.Bi.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new n.Bi(10,10,10),this.onAnimationEnd=null,this.blendMode=e.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new n.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.cF=new n.Bi(0,0,0),this._useLogarithmicDepth=!1,this.gravity=n.Bi.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new b.Hd(1,1,1,1),this.color2=new b.Hd(1,1,1,1),this.colorDead=new b.Hd(0,0,0,1),this.textureMask=new b.Hd(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new d,this.id=g,this.name=g}createPointEmitter(g,i){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new n.Bi(0,1,0),arguments.length>2&&void 0!==arguments[2]||new n.Bi(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new n.Bi(0,1,0),arguments.length>4&&void 0!==arguments[4]||new n.Bi(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new n.Bi(0,1,0),arguments.length>3&&void 0!==arguments[3]||new n.Bi(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(g,i,a,n){throw new Error("Method not implemented.")}}e.BLENDMODE_ONEONE=0,e.BLENDMODE_STANDARD=1,e.BLENDMODE_ADD=2,e.BLENDMODE_MULTIPLY=3,e.BLENDMODE_MULTIPLYADD=4,e.BLENDMODE_SUBTRACT=-1,(0,k.e)("BABYLON.BaseParticleSystem",e);var N=a(12466),F=a(12296);class I{constructor(){this.direction1=new n.Bi(0,1,0),this.direction2=new n.Bi(0,1,0),this.minEmitBox=new n.Bi(-.5,-.5,-.5),this.maxEmitBox=new n.Bi(.5,.5,.5)}startDirectionFunction(g,i,a,L){const d=(0,N.RandomRange)(this.direction1.x,this.direction2.x),b=(0,N.RandomRange)(this.direction1.y,this.direction2.y),k=(0,N.RandomRange)(this.direction1.z,this.direction2.z);if(L)return i.x=d,i.y=b,void(i.z=k);n.Bi.TransformNormalFromFloatsToRef(d,b,k,g,i)}startPositionFunction(g,i,a,L){const d=(0,N.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),b=(0,N.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),k=(0,N.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(L)return i.x=d,i.y=b,void(i.z=k);n.Bi.TransformCoordinatesFromFloatsToRef(d,b,k,g,i)}clone(){const g=new I;return F.c.DeepCopy(this,g),g}applyToShader(g){g.setVector3("direction1",this.direction1),g.setVector3("direction2",this.direction2),g.setVector3("minEmitBox",this.minEmitBox),g.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(g){g.addUniform("direction1",3),g.addUniform("direction2",3),g.addUniform("minEmitBox",3),g.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.direction1=this.direction1.fd(),g.direction2=this.direction2.fd(),g.minEmitBox=this.minEmitBox.fd(),g.maxEmitBox=this.maxEmitBox.fd(),g}parse(g){n.Bi.FromArrayToRef(g.direction1,0,this.direction1),n.Bi.FromArrayToRef(g.direction2,0,this.direction2),n.Bi.FromArrayToRef(g.minEmitBox,0,this.minEmitBox),n.Bi.FromArrayToRef(g.maxEmitBox,0,this.maxEmitBox)}}class j{get radius(){return this._radius}set radius(g){this._radius=g,this._buildHeight()}get angle(){return this._angle}set angle(g){this._angle=g,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=a,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=i,this.radius=g}startDirectionFunction(g,i,a,L){L?n.TmpVectors.Bi[0].I(a.Me).normalize():a.position.subtractToRef(g.getTranslation(),n.TmpVectors.Bi[0]).normalize();const d=(0,N.RandomRange)(0,this.directionRandomizer),b=(0,N.RandomRange)(0,this.directionRandomizer),k=(0,N.RandomRange)(0,this.directionRandomizer);i.x=n.TmpVectors.Bi[0].x+d,i.y=n.TmpVectors.Bi[0].y+b,i.z=n.TmpVectors.Bi[0].z+k,i.normalize()}startPositionFunction(g,i,a,L){const d=(0,N.RandomRange)(0,2*Math.PI);let b;this.emitFromSpawnPointOnly?b=1e-4:(b=(0,N.RandomRange)(0,this.heightRange),b=1-b*b);let k=this._radius-(0,N.RandomRange)(0,this._radius*this.radiusRange);k*=b;const e=k*Math.sin(d),F=k*Math.cos(d),I=b*this._height;if(L)return i.x=e,i.y=I,void(i.z=F);n.Bi.TransformCoordinatesFromFloatsToRef(e,I,F,g,i)}clone(){const g=new j(this._radius,this._angle,this.directionRandomizer);return F.c.DeepCopy(this,g),g}applyToShader(g){g.setFloat2("radius",this._radius,this.radiusRange),g.setFloat("coneAngle",this._angle),g.setFloat2("height",this._height,this.heightRange),g.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(g){g.addUniform("radius",2),g.addUniform("coneAngle",1),g.addUniform("height",2),g.addUniform("directionRandomizer",1)}getEffectDefines(){let g="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(g+="\n#define CONEEMITTERSPAWNPOINT"),g}getClassName(){return"ConeParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.radius=this._radius,g.angle=this._angle,g.directionRandomizer=this.directionRandomizer,g.radiusRange=this.radiusRange,g.heightRange=this.heightRange,g.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,g}parse(g){this.radius=g.radius,this.angle=g.angle,this.directionRandomizer=g.directionRandomizer,this.radiusRange=void 0!==g.radiusRange?g.radiusRange:1,this.heightRange=void 0!==g.radiusRange?g.heightRange:1,this.emitFromSpawnPointOnly=void 0!==g.emitFromSpawnPointOnly&&g.emitFromSpawnPointOnly}}class y extends j{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.Bi(0,1,0),L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.Bi(0,1,0);super(g,i),this.direction1=a,this.direction2=L}startDirectionFunction(g,i){const a=(0,N.RandomRange)(this.direction1.x,this.direction2.x),L=(0,N.RandomRange)(this.direction1.y,this.direction2.y),d=(0,N.RandomRange)(this.direction1.z,this.direction2.z);n.Bi.TransformNormalFromFloatsToRef(a,L,d,g,i)}clone(){const g=new y(this.radius,this.angle,this.direction1,this.direction2);return F.c.DeepCopy(this,g),g}applyToShader(g){g.setFloat("radius",this.radius),g.setFloat("radiusRange",this.radiusRange),g.setVector3("direction1",this.direction1),g.setVector3("direction2",this.direction2)}buildUniformLayout(g){g.addUniform("radius",1),g.addUniform("radiusRange",1),g.addUniform("direction1",3),g.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const g=super.serialize();return g.direction1=this.direction1.fd(),g.direction2=this.direction2.fd(),g}parse(g){super.parse(g),this.direction1.I(g.direction1),this.direction2.I(g.direction2)}}class B{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=g,this.height=i,this.radiusRange=a,this.directionRandomizer=L,this._tempVector=n.Bi.Zero()}startDirectionFunction(g,i,a,L,d){a.position.subtractToRef(g.getTranslation(),this._tempVector),this._tempVector.normalize(),n.Bi.TransformNormalToRef(this._tempVector,d,this._tempVector);const b=(0,N.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let k=Math.atan2(this._tempVector.x,this._tempVector.z);k+=(0,N.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=b,this._tempVector.x=Math.sin(k),this._tempVector.z=Math.cos(k),this._tempVector.normalize(),L?i.I(this._tempVector):n.Bi.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,g,i)}startPositionFunction(g,i,a,L){const d=(0,N.RandomRange)(-this.height/2,this.height/2),b=(0,N.RandomRange)(0,2*Math.PI),k=(0,N.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),e=Math.sqrt(k)*this.radius,F=e*Math.cos(b),I=e*Math.sin(b);L?i.sd(F,d,I):n.Bi.TransformCoordinatesFromFloatsToRef(F,d,I,g,i)}clone(){const g=new B(this.radius,this.directionRandomizer);return F.c.DeepCopy(this,g),g}applyToShader(g){g.setFloat("radius",this.radius),g.setFloat("height",this.height),g.setFloat("radiusRange",this.radiusRange),g.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(g){g.addUniform("radius",1),g.addUniform("height",1),g.addUniform("radiusRange",1),g.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.radius=this.radius,g.height=this.height,g.radiusRange=this.radiusRange,g.directionRandomizer=this.directionRandomizer,g}parse(g){this.radius=g.radius,this.height=g.height,this.radiusRange=g.radiusRange,this.directionRandomizer=g.directionRandomizer}}class c extends B{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.Bi(0,1,0),d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new n.Bi(0,1,0);super(g,i,a),this.direction1=L,this.direction2=d}startDirectionFunction(g,i,a,L){const d=(0,N.RandomRange)(this.direction1.x,this.direction2.x),b=(0,N.RandomRange)(this.direction1.y,this.direction2.y),k=(0,N.RandomRange)(this.direction1.z,this.direction2.z);L?i.sd(d,b,k):n.Bi.TransformNormalFromFloatsToRef(d,b,k,g,i)}clone(){const g=new c(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return F.c.DeepCopy(this,g),g}applyToShader(g){g.setFloat("radius",this.radius),g.setFloat("height",this.height),g.setFloat("radiusRange",this.radiusRange),g.setVector3("direction1",this.direction1),g.setVector3("direction2",this.direction2)}buildUniformLayout(g){g.addUniform("radius",1),g.addUniform("height",1),g.addUniform("radiusRange",1),g.addUniform("direction1",3),g.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const g=super.serialize();return g.direction1=this.direction1.fd(),g.direction2=this.direction2.fd(),g}parse(g){super.parse(g),n.Bi.FromArrayToRef(g.direction1,0,this.direction1),n.Bi.FromArrayToRef(g.direction2,0,this.direction2)}}class D{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=g,this.radiusRange=i,this.directionRandomizer=a}startDirectionFunction(g,i,a,L){const d=a.position.ci(g.getTranslation()).normalize(),b=(0,N.RandomRange)(0,this.directionRandomizer),k=(0,N.RandomRange)(0,this.directionRandomizer),e=(0,N.RandomRange)(0,this.directionRandomizer);d.x+=b,d.y+=k,d.z+=e,d.normalize(),L?i.I(d):n.Bi.TransformNormalFromFloatsToRef(d.x,d.y,d.z,g,i)}startPositionFunction(g,i,a,L){const d=this.radius-(0,N.RandomRange)(0,this.radius*this.radiusRange),b=(0,N.RandomRange)(0,1),k=(0,N.RandomRange)(0,2*Math.PI),e=Math.acos(2*b-1),F=d*Math.cos(k)*Math.sin(e),I=d*Math.cos(e),j=d*Math.sin(k)*Math.sin(e);L?i.sd(F,Math.abs(I),j):n.Bi.TransformCoordinatesFromFloatsToRef(F,Math.abs(I),j,g,i)}clone(){const g=new D(this.radius,this.directionRandomizer);return F.c.DeepCopy(this,g),g}applyToShader(g){g.setFloat("radius",this.radius),g.setFloat("radiusRange",this.radiusRange),g.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(g){g.addUniform("radius",1),g.addUniform("radiusRange",1),g.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.radius=this.radius,g.radiusRange=this.radiusRange,g.directionRandomizer=this.directionRandomizer,g}parse(g){this.radius=g.radius,this.radiusRange=g.radiusRange,this.directionRandomizer=g.directionRandomizer}}class p{constructor(){this.direction1=new n.Bi(0,1,0),this.direction2=new n.Bi(0,1,0)}startDirectionFunction(g,i,a,L){const d=(0,N.RandomRange)(this.direction1.x,this.direction2.x),b=(0,N.RandomRange)(this.direction1.y,this.direction2.y),k=(0,N.RandomRange)(this.direction1.z,this.direction2.z);L?i.sd(d,b,k):n.Bi.TransformNormalFromFloatsToRef(d,b,k,g,i)}startPositionFunction(g,i,a,L){L?i.sd(0,0,0):n.Bi.TransformCoordinatesFromFloatsToRef(0,0,0,g,i)}clone(){const g=new p;return F.c.DeepCopy(this,g),g}applyToShader(g){g.setVector3("direction1",this.direction1),g.setVector3("direction2",this.direction2)}buildUniformLayout(g){g.addUniform("direction1",3),g.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.direction1=this.direction1.fd(),g.direction2=this.direction2.fd(),g}parse(g){n.Bi.FromArrayToRef(g.direction1,0,this.direction1),n.Bi.FromArrayToRef(g.direction2,0,this.direction2)}}class R{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=g,this.radiusRange=i,this.directionRandomizer=a}startDirectionFunction(g,i,a,L){const d=a.position.ci(g.getTranslation()).normalize(),b=(0,N.RandomRange)(0,this.directionRandomizer),k=(0,N.RandomRange)(0,this.directionRandomizer),e=(0,N.RandomRange)(0,this.directionRandomizer);d.x+=b,d.y+=k,d.z+=e,d.normalize(),L?i.I(d):n.Bi.TransformNormalFromFloatsToRef(d.x,d.y,d.z,g,i)}startPositionFunction(g,i,a,L){const d=this.radius-(0,N.RandomRange)(0,this.radius*this.radiusRange),b=(0,N.RandomRange)(0,1),k=(0,N.RandomRange)(0,2*Math.PI),e=Math.acos(2*b-1),F=d*Math.cos(k)*Math.sin(e),I=d*Math.cos(e),j=d*Math.sin(k)*Math.sin(e);L?i.sd(F,I,j):n.Bi.TransformCoordinatesFromFloatsToRef(F,I,j,g,i)}clone(){const g=new R(this.radius,this.directionRandomizer);return F.c.DeepCopy(this,g),g}applyToShader(g){g.setFloat("radius",this.radius),g.setFloat("radiusRange",this.radiusRange),g.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(g){g.addUniform("radius",1),g.addUniform("radiusRange",1),g.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.radius=this.radius,g.radiusRange=this.radiusRange,g.directionRandomizer=this.directionRandomizer,g}parse(g){this.radius=g.radius,this.radiusRange=g.radiusRange,this.directionRandomizer=g.directionRandomizer}}class x extends R{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.Bi(0,1,0),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.Bi(0,1,0);super(g),this.direction1=i,this.direction2=a}startDirectionFunction(g,i){const a=(0,N.RandomRange)(this.direction1.x,this.direction2.x),L=(0,N.RandomRange)(this.direction1.y,this.direction2.y),d=(0,N.RandomRange)(this.direction1.z,this.direction2.z);n.Bi.TransformNormalFromFloatsToRef(a,L,d,g,i)}clone(){const g=new x(this.radius,this.direction1,this.direction2);return F.c.DeepCopy(this,g),g}applyToShader(g){g.setFloat("radius",this.radius),g.setFloat("radiusRange",this.radiusRange),g.setVector3("direction1",this.direction1),g.setVector3("direction2",this.direction2)}buildUniformLayout(g){g.addUniform("radius",1),g.addUniform("radiusRange",1),g.addUniform("direction1",3),g.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const g=super.serialize();return g.direction1=this.direction1.fd(),g.direction2=this.direction2.fd(),g}parse(g){super.parse(g),this.direction1.I(g.direction1),this.direction2.I(g.direction2)}}class E{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(g,i,a,L){const d=n.TmpVectors.Bi[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,a,d);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,a,d);const g=n.TmpVectors.Bi[1];d.subtractToRef(a.position,g),g.scaleToRef(1/a.lifeTime,d)}else d.set(0,0,0);L?i.I(d):n.Bi.TransformNormalToRef(d,g,i)}startPositionFunction(g,i,a,L){const d=n.TmpVectors.Bi[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,a,d):d.set(0,0,0),L?i.I(d):n.Bi.TransformCoordinatesToRef(d,g,i)}clone(){const g=new E;return F.c.DeepCopy(this,g),g}applyToShader(g){}buildUniformLayout(g){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.particlePositionGenerator=this.particlePositionGenerator,g.particleDestinationGenerator=this.particleDestinationGenerator,g}parse(g){g.particlePositionGenerator&&(this.particlePositionGenerator=g.particlePositionGenerator),g.particleDestinationGenerator&&(this.particleDestinationGenerator=g.particleDestinationGenerator)}}var X=a(12526);class v{get mesh(){return this._mesh}set mesh(g){this._mesh!==g&&(this._mesh=g,g?(this._indices=g.Ad(),this._positions=g.getVerticesData(X.g.PositionKind),this._normals=g.getVerticesData(X.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=n.Bi.Zero(),this._mesh=null,this.direction1=new n.Bi(0,1,0),this.direction2=new n.Bi(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=g}startDirectionFunction(g,i,a,L){if(this.useMeshNormalsForDirection&&this._normals)return void n.Bi.TransformNormalToRef(this._storedNormal,g,i);const d=(0,N.RandomRange)(this.direction1.x,this.direction2.x),b=(0,N.RandomRange)(this.direction1.y,this.direction2.y),k=(0,N.RandomRange)(this.direction1.z,this.direction2.z);L?i.sd(d,b,k):n.Bi.TransformNormalFromFloatsToRef(d,b,k,g,i)}startPositionFunction(g,i,a,L){if(!this._indices||!this._positions)return;const d=3*(Math.random()*(this._indices.length/3)|0),b=Math.random(),k=Math.random()*(1-b),e=1-b-k,N=this._indices[d],F=this._indices[d+1],I=this._indices[d+2],j=n.TmpVectors.Bi[0],y=n.TmpVectors.Bi[1],B=n.TmpVectors.Bi[2],c=n.TmpVectors.Bi[3];n.Bi.FromArrayToRef(this._positions,3*N,j),n.Bi.FromArrayToRef(this._positions,3*F,y),n.Bi.FromArrayToRef(this._positions,3*I,B),c.x=b*j.x+k*y.x+e*B.x,c.y=b*j.y+k*y.y+e*B.y,c.z=b*j.z+k*y.z+e*B.z,L?i.sd(c.x,c.y,c.z):n.Bi.TransformCoordinatesFromFloatsToRef(c.x,c.y,c.z,g,i),this.useMeshNormalsForDirection&&this._normals&&(n.Bi.FromArrayToRef(this._normals,3*N,j),n.Bi.FromArrayToRef(this._normals,3*F,y),n.Bi.FromArrayToRef(this._normals,3*I,B),this._storedNormal.x=b*j.x+k*y.x+e*B.x,this._storedNormal.y=b*j.y+k*y.y+e*B.y,this._storedNormal.z=b*j.z+k*y.z+e*B.z)}clone(){const g=new v(this.mesh);return F.c.DeepCopy(this,g),g}applyToShader(g){g.setVector3("direction1",this.direction1),g.setVector3("direction2",this.direction2)}buildUniformLayout(g){g.addUniform("direction1",3),g.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var g;const i={};return i.type=this.getClassName(),i.direction1=this.direction1.fd(),i.direction2=this.direction2.fd(),i.meshId=null===(g=this.mesh)||void 0===g?void 0:g.id,i.useMeshNormalsForDirection=this.useMeshNormalsForDirection,i}parse(g,i){n.Bi.FromArrayToRef(g.direction1,0,this.direction1),n.Bi.FromArrayToRef(g.direction2,0,this.direction2),g.meshId&&i&&(this.mesh=i.getLastMeshById(g.meshId)),this.useMeshNormalsForDirection=g.useMeshNormalsForDirection}}class P{_isUbo(g){return void 0!==g.addUniform}constructor(g){this._isUbo(g)?(this.setMatrix3x3=g.updateMatrix3x3.bind(g),this.setMatrix2x2=g.updateMatrix2x2.bind(g),this.setFloat=g.updateFloat.bind(g),this.setFloat2=g.updateFloat2.bind(g),this.setFloat3=g.updateFloat3.bind(g),this.setFloat4=g.updateFloat4.bind(g),this.setFloatArray=g.updateFloatArray.bind(g),this.setArray=g.updateArray.bind(g),this.setIntArray=g.updateIntArray.bind(g),this.setMatrix=g.ld.bind(g),this.setMatrices=g.updateMatrices.bind(g),this.setVector3=g.updateVector3.bind(g),this.setVector4=g.updateVector4.bind(g),this.setColor3=g.updateColor3.bind(g),this.setColor4=g.updateColor4.bind(g),this.setDirectColor4=g.updateDirectColor4.bind(g),this.setInt=g.updateInt.bind(g),this.setInt2=g.updateInt2.bind(g),this.setInt3=g.updateInt3.bind(g),this.setInt4=g.updateInt4.bind(g)):(this.setMatrix3x3=g.setMatrix3x3.bind(g),this.setMatrix2x2=g.setMatrix2x2.bind(g),this.setFloat=g.setFloat.bind(g),this.setFloat2=g.setFloat2.bind(g),this.setFloat3=g.setFloat3.bind(g),this.setFloat4=g.setFloat4.bind(g),this.setFloatArray=g.setFloatArray.bind(g),this.setArray=g.setArray.bind(g),this.setIntArray=g.setIntArray.bind(g),this.setMatrix=g.setMatrix.bind(g),this.setMatrices=g.setMatrices.bind(g),this.setVector3=g.setVector3.bind(g),this.setVector4=g.setVector4.bind(g),this.setColor3=g.setColor3.bind(g),this.setColor4=g.setColor4.bind(g),this.setDirectColor4=g.setDirectColor4.bind(g),this.setInt=g.setInt.bind(g),this.setInt2=g.setInt2.bind(g),this.setInt3=g.setInt3.bind(g),this.setInt4=g.setInt4.bind(g))}}var Y=a(12367);const f="gpuUpdateParticlesPixelShader",C="#version 300 es\nvoid main() {discard;}\n";Y.c.ShadersStore[f]||(Y.c.ShadersStore[f]=C);const U="gpuUpdateParticlesVertexShader",S="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";Y.c.ShadersStore[U]||(Y.c.ShadersStore[U]=S);(0,k.e)("BABYLON.WebGL2ParticleSystem",class{constructor(g,i){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=g,this._engine=i,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var g;return(null===(g=this._updateEffect)||void 0===g?void 0:g.isReady())??!1}createUpdateBuffer(g){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof E&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=g,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new P(this._updateEffect)}createVertexBuffers(g,i){this._updateVAO.push(this._createUpdateVAO(g)),this._renderVAO.push(this._engine.recordVertexArrayObject(i,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=i}createParticleBuffer(g){return g}bindDrawBuffers(g,i,a){a?this._engine.bindBuffers(this._renderVertexBuffers,a,i):this._engine.bindVertexArrayObject(this._renderVAO[g],null)}preUpdateParticleBuffer(){const g=this._engine;if(this._engine.enableEffect(this._updateEffect),!g.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(g,i,a){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[g],null);const n=this._engine;n.bindTransformFeedbackBuffer(i.getBuffer()),n.setRasterizerState(!1),n.beginTransformFeedback(!0),n.drawArraysType(3,0,a),n.endTransformFeedback(),n.setRasterizerState(!0),n.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let g=0;g<this._updateVAO.length;g++)this._engine.releaseVertexArrayObject(this._updateVAO[g]);this._updateVAO.length=0;for(let g=0;g<this._renderVAO.length;g++)this._engine.releaseVertexArrayObject(this._renderVAO[g]);this._renderVAO.length=0}_createUpdateVAO(g){const i={};i.position=g.createVertexBuffer("position",0,3);let a=3;i.age=g.createVertexBuffer("age",a,1),a+=1,i.size=g.createVertexBuffer("size",a,3),a+=3,i.life=g.createVertexBuffer("life",a,1),a+=1,i.seed=g.createVertexBuffer("seed",a,4),a+=4,i.direction=g.createVertexBuffer("direction",a,3),a+=3,this._parent.particleEmitterType instanceof E&&(i.initialPosition=g.createVertexBuffer("initialPosition",a,3),a+=3),this._parent._colorGradientsTexture||(i.color=g.createVertexBuffer("color",a,4),a+=4),this._parent._isBillboardBased||(i.initialDirection=g.createVertexBuffer("initialDirection",a,3),a+=3),this._parent.noiseTexture&&(i.noiseCoordinates1=g.createVertexBuffer("noiseCoordinates1",a,3),a+=3,i.noiseCoordinates2=g.createVertexBuffer("noiseCoordinates2",a,3),a+=3),this._parent._angularSpeedGradientsTexture?(i.angle=g.createVertexBuffer("angle",a,1),a+=1):(i.angle=g.createVertexBuffer("angle",a,2),a+=2),this._parent._isAnimationSheetEnabled&&(i.cellIndex=g.createVertexBuffer("cellIndex",a,1),a+=1,this._parent.spriteRandomStartCell&&(i.cellStartOffset=g.createVertexBuffer("cellStartOffset",a,1),a+=1));const n=this._engine.recordVertexArrayObject(i,null,this._updateEffect);return this._engine.bindArrayBuffer(null),n}});class V{constructor(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3?arguments[3]:void 0;this._engine=g,this._label=n,this._engine._storageBuffers.push(this),this._create(i,a)}_create(g,i){this._bufferSize=g,this._creationFlags=i,this._buffer=this._engine.createStorageBuffer(g,i,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(g,i,a){this._buffer&&this._engine.updateStorageBuffer(this._buffer,g,i,a)}async read(g,i,a,n){return await this._engine.readFromStorageBuffer(this._buffer,g,i,a,n)}dispose(){const g=this._engine._storageBuffers,i=g.indexOf(this);-1!==i&&(g[i]=g[g.length-1],g.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var K=a(12441),T=a(12447),l=a(12484),Z=a(12436),h=a(12761),w=a(12292),t=a(12400),A=a(12678);class O{constructor(){this._gpuTimeInFrameId=-1,this.counter=new A.b}_addDuration(g,i){g<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==g?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(i,!1),this._gpuTimeInFrameId=g):this.counter.addCount(i,!1))}}var z=a(12352);class s{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=g,this._engine=i,this.uniqueId=h.c.UniqueId,i.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new O),this._engine.getCaps().supportComputeShaders?n.bindingsMapping?(this._context=i.createComputeContext(),this._shaderPath=a,this._options={bindingsMapping:{},defines:[],...n}):w.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):w.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(g,i){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=this._bindings[g];this._bindings[g]={type:a?0:4,object:i,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!n||n.object!==i||n.type!==this._bindings[g].type)}setStorageTexture(g,i){const a=this._bindings[g];this._contextIsDirty||(this._contextIsDirty=!a||a.object!==i),this._bindings[g]={type:1,object:i,indexInGroupEntries:null===a||void 0===a?void 0:a.indexInGroupEntries}}setExternalTexture(g,i){const a=this._bindings[g];this._contextIsDirty||(this._contextIsDirty=!a||a.object!==i),this._bindings[g]={type:6,object:i,indexInGroupEntries:null===a||void 0===a?void 0:a.indexInGroupEntries}}setVideoTexture(g,i){return!!i.externalTexture&&(this.setExternalTexture(g,i.externalTexture),!0)}setUniformBuffer(g,i){const a=this._bindings[g];this._contextIsDirty||(this._contextIsDirty=!a||a.object!==i),this._bindings[g]={type:s._BufferIsDataBuffer(i)?7:2,object:i,indexInGroupEntries:null===a||void 0===a?void 0:a.indexInGroupEntries}}setStorageBuffer(g,i){const a=this._bindings[g];this._contextIsDirty||(this._contextIsDirty=!a||a.object!==i),this._bindings[g]={type:s._BufferIsDataBuffer(i)?7:3,object:i,indexInGroupEntries:null===a||void 0===a?void 0:a.indexInGroupEntries}}setTextureSampler(g,i){const a=this._bindings[g];this._contextIsDirty||(this._contextIsDirty=!a||!i.compareSampler(a.object)),this._bindings[g]={type:5,object:i,indexInGroupEntries:null===a||void 0===a?void 0:a.indexInGroupEntries}}isReady(){let g=this._effect;for(const L in this._bindings){const g=this._bindings[L],i=g.type,a=g.object;switch(i){case 0:case 4:case 1:if(!a.isReady())return!1;break;case 6:if(!a.isReady())return!1;break}}const i=[],a=this._shaderPath;if(this._options.defines)for(let L=0;L<this._options.defines.length;L++)i.push(this._options.defines[L]);const n=i.join("\n");return this._cachedDefines!==n&&(this._cachedDefines=n,g=this._engine.createComputeEffect(a,{defines:n,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=g),!!g.isReady()}dispatch(g,i,a){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,g,i,a,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const a=s._BufferIsDataBuffer(g)?g:g.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,a,i,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const i in this._bindings){const a=this._bindings[i];if(!this._options.bindingsMapping[i])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+i+"'");switch(a.type){case 0:{const n=this._samplers[i],L=a.object;var g;if(!n||!L._texture||!n.compareSampler(L._texture))this._samplers[i]=(new t.c).setParameters(L.wrapU,L.wrapV,L.wrapR,L.anisotropicFilteringLevel,L._texture.samplingMode,null===(g=L._texture)||void 0===g?void 0:g._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const g=a.object;g.getBuffer()!==a.buffer&&(a.buffer=g.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((L=>{(0,z.f)((()=>this.dispatch(g,i,a)),L,void 0,n)}))}serialize(){const g=l.c.Serialize(this);g.options=this._options,g.shaderPath=this._shaderPath,g.ky={},g.textures={};for(const i in this._bindings){const a=this._bindings[i],n=a.object;switch(a.type){case 0:case 4:case 1:{const L=n.serialize();L&&(g.textures[i]=L,g.ky[i]={type:a.type});break}}}return g}static Parse(g,i,a){const n=l.c.Parse((()=>new s(g.name,i.getEngine(),g.shaderPath,g.options)),g,i,a);for(const L in g.textures){const d=g.ky[L],b=Z.c.Parse(g.textures[L],i,a);0===d.type?n.setTexture(L,b):4===d.type?n.setTexture(L,b,!1):n.setStorageTexture(L,b)}return n}static _BufferIsDataBuffer(g){return void 0!==g.underlyingResource}}(0,K.e)([(0,T.P)()],s.prototype,"name",void 0),(0,K.e)([(0,T.P)()],s.prototype,"fastMode",void 0),(0,k.e)("BABYLON.ComputeShader",s);var mg=a(12724);const r="gpuUpdateParticlesComputeShader",Q="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";Y.c.ShadersStoreWGSL[r]||(Y.c.ShadersStoreWGSL[r]=Q);(0,k.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(g,i){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=g,this._engine=i}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var g;return(null===(g=this._updateComputeShader)||void 0===g?void 0:g.isReady())??!1}createUpdateBuffer(g){var i;const a={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(a.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(a.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(a.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(a.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(a.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(a.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(a.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new s("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:a,defines:g.split("\n")}),null===(i=this._simParamsComputeShader)||void 0===i||i.dispose(),this._simParamsComputeShader=new mg.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new P(this._simParamsComputeShader)}createVertexBuffers(g,i){this._renderVertexBuffers.push(i)}createParticleBuffer(g){const i=new V(this._engine,4*g.length,11,"ComputeShaderParticleSystemBuffer");return i.update(g),this._bufferComputeShader.push(i),i.getBuffer()}bindDrawBuffers(g,i,a){this._engine.bindBuffers(this._renderVertexBuffers[g],a,i)}preUpdateParticleBuffer(){}updateParticleBuffer(g,i,a){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[g]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^g]),this._updateComputeShader.dispatch(Math.ceil(a/64))}releaseBuffers(){var g;for(let i=0;i<this._bufferComputeShader.length;++i)this._bufferComputeShader[i].dispose();this._bufferComputeShader.length=0,null===(g=this._simParamsComputeShader)||void 0===g||g.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class o{constructor(g,i,a){this.gradient=g,this.color1=i,this.color2=a}getColorToRef(g){this.color2?b.Hd.LerpToRef(this.color1,this.color2,Math.random(),g):g.I(this.color1)}}class u{constructor(g,i){this.gradient=g,this.color=i}}class H{constructor(g,i,a){this.gradient=g,this.factor1=i,this.factor2=a}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class M{static GetCurrentGradient(g,i,a){if(i[0].gradient>g)return void a(i[0],i[0],1);for(let L=0;L<i.length-1;L++){const n=i[L],d=i[L+1];if(g>=n.gradient&&g<=d.gradient){return void a(n,d,(g-n.gradient)/(d.gradient-n.gradient))}}const n=i.length-1;a(i[n],i[n],1)}}var q=a(12286),W=a(12943),G=a(12316);class J{constructor(g){this.particleSystem=g,this.position=n.Bi.Zero(),this.direction=n.Bi.Zero(),this.color=new b.Hd(0,0,0,0),this.colorStep=new b.Hd(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new n.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new b.Hd(0,0,0,0),this._currentColor2=new b.Hd(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=J._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let g=this.age,i=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===i?(i=1,g=this._randomCellOffset):g+=this._randomCellOffset);const a=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let n;n=this._initialSpriteCellLoop?(0,N.Clamp)(g*i%this.lifeTime/this.lifeTime):(0,N.Clamp)(g*i/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+n*a|0}_inheritParticleInfoToSubEmitter(g){if(g.particleSystem.ni.position){const i=g.particleSystem.ni;if(i.position.I(this.position),g.inheritDirection){const g=n.TmpVectors.Bi[0];this.direction.normalizeToRef(g),i.setDirection(g,0,Math.PI/2)}}else{g.particleSystem.ni.I(this.position)}this.direction.scaleToRef(g.inheritedVelocityAmount/2,n.TmpVectors.Bi[0]),g.particleSystem._inheritedVelocityOffset.I(n.TmpVectors.Bi[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const g of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(g)}_reset(){this.age=0,this.id=J._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(g){g.position.I(this.position),this._initialDirection?g._initialDirection?g._initialDirection.I(this._initialDirection):g._initialDirection=this._initialDirection.clone():g._initialDirection=null,g.direction.I(this.direction),this.Me&&(g.Me?g.Me.I(this.Me):g.Me=this.Me.clone()),g.color.I(this.color),g.colorStep.I(this.colorStep),g.lifeTime=this.lifeTime,g.age=this.age,g._randomCellOffset=this._randomCellOffset,g.size=this.size,g.scale.I(this.scale),g.angle=this.angle,g.angularSpeed=this.angularSpeed,g.particleSystem=this.particleSystem,g.cellIndex=this.cellIndex,g.id=this.id,g._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(g._currentColorGradient=this._currentColorGradient,g._currentColor1.I(this._currentColor1),g._currentColor2.I(this._currentColor2)),this._currentSizeGradient&&(g._currentSizeGradient=this._currentSizeGradient,g._currentSize1=this._currentSize1,g._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(g._currentAngularSpeedGradient=this._currentAngularSpeedGradient,g._currentAngularSpeed1=this._currentAngularSpeed1,g._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(g._currentVelocityGradient=this._currentVelocityGradient,g._currentVelocity1=this._currentVelocity1,g._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(g._currentLimitVelocityGradient=this._currentLimitVelocityGradient,g._currentLimitVelocity1=this._currentLimitVelocity1,g._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(g._currentDragGradient=this._currentDragGradient,g._currentDrag1=this._currentDrag1,g._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(g._initialStartSpriteCellId=this._initialStartSpriteCellId,g._initialEndSpriteCellId=this._initialEndSpriteCellId,g._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(g.remapData&&this.remapData?g.remapData.I(this.remapData):g.remapData=new n.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(g._randomNoiseCoordinates1?(g._randomNoiseCoordinates1.I(this._randomNoiseCoordinates1),g._randomNoiseCoordinates2.I(this._randomNoiseCoordinates2)):(g._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),g._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}J._Count=0;var gg=a(12564),ig=(a(12618),a(12825)),ag=a(12820),ng=a(12715);function Lg(g,i){const a=(0,N.RandomRange)(0,1);b.Hd.LerpToRef(i.color1,i.color2,a,g.color),i.colorDead.subtractToRef(g.color,i._colorDiff),i._colorDiff.scaleToRef(1/g.lifeTime,g.colorStep)}function dg(g,i){g._currentColorGradient=i._colorGradients[0],g._currentColorGradient.getColorToRef(g.color),g._currentColor1.I(g.color),i._colorGradients.length>1?i._colorGradients[1].getColorToRef(g._currentColor2):g._currentColor2.I(g.color)}function bg(g,i){const a=i._colorGradients;M.GetCurrentGradient(i._ratio,a,((i,a,n)=>{i!==g._currentColorGradient&&(g._currentColor1.I(g._currentColor2),a.getColorToRef(g._currentColor2),g._currentColorGradient=i),b.Hd.LerpToRef(g._currentColor1,g._currentColor2,n,g.color)}))}function kg(g,i){g.colorStep.scaleToRef(i._scaledUpdateSpeed,i._scaledColorStep),g.color.addInPlace(i._scaledColorStep),g.color.a<0&&(g.color.a=0)}function eg(g,i){M.GetCurrentGradient(i._ratio,i._angularSpeedGradients,((i,a,n)=>{i!==g._currentAngularSpeedGradient&&(g._currentAngularSpeed1=g._currentAngularSpeed2,g._currentAngularSpeed2=a.getFactor(),g._currentAngularSpeedGradient=i),g.angularSpeed=(0,N.Lerp)(g._currentAngularSpeed1,g._currentAngularSpeed2,n)}))}function Ng(g,i){g.angle+=g.angularSpeed*i._scaledUpdateSpeed}function Fg(g,i){i.particleEmitterType.startDirectionFunction(i._emitterWorldMatrix,g.direction,g,i.isLocal,i._emitterInverseWorldMatrix)}function Ig(g,i){i.startDirectionFunction(i._emitterWorldMatrix,g.direction,g,i.isLocal)}function jg(g,i){g._currentVelocityGradient=i._velocityGradients[0],g._currentVelocity1=g._currentVelocityGradient.getFactor(),i._velocityGradients.length>1?g._currentVelocity2=i._velocityGradients[1].getFactor():g._currentVelocity2=g._currentVelocity1}function yg(g,i){g._currentLimitVelocityGradient=i._limitVelocityGradients[0],g._currentLimitVelocity1=g._currentLimitVelocityGradient.getFactor(),i._limitVelocityGradients.length>1?g._currentLimitVelocity2=i._limitVelocityGradients[1].getFactor():g._currentLimitVelocity2=g._currentLimitVelocity1}function Bg(g,i){M.GetCurrentGradient(i._ratio,i._velocityGradients,((a,n,L)=>{a!==g._currentVelocityGradient&&(g._currentVelocity1=g._currentVelocity2,g._currentVelocity2=n.getFactor(),g._currentVelocityGradient=a),i._directionScale*=(0,N.Lerp)(g._currentVelocity1,g._currentVelocity2,L)}))}function cg(g,i){M.GetCurrentGradient(i._ratio,i._limitVelocityGradients,((a,n,L)=>{a!==g._currentLimitVelocityGradient&&(g._currentLimitVelocity1=g._currentLimitVelocity2,g._currentLimitVelocity2=n.getFactor(),g._currentLimitVelocityGradient=a);const d=(0,N.Lerp)(g._currentLimitVelocity1,g._currentLimitVelocity2,L);g.direction.length()>d&&g.direction.scaleInPlace(i.limitVelocityDamping)}))}function Dg(g,i){g.direction.scaleToRef(i._directionScale,i._scaledDirection)}function pg(g,i){i.particleEmitterType.startPositionFunction(i._emitterWorldMatrix,g.position,g,i.isLocal)}function Rg(g,i){i.startPositionFunction(i._emitterWorldMatrix,g.position,g,i.isLocal)}function xg(g,i){g.Me?g.Me.I(g.position):g.Me=g.position.clone(),n.Bi.TransformCoordinatesToRef(g.Me,i._emitterWorldMatrix,g.position)}function Eg(g,i){i.isLocal&&g.Me?(g.Me.addInPlace(i._scaledDirection),n.Bi.TransformCoordinatesToRef(g.Me,i._emitterWorldMatrix,g.position)):g.position.addInPlace(i._scaledDirection)}function Xg(g,i){g._currentDragGradient=i._dragGradients[0],g._currentDrag1=g._currentDragGradient.getFactor(),i._dragGradients.length>1?g._currentDrag2=i._dragGradients[1].getFactor():g._currentDrag2=g._currentDrag1}function vg(g,i){M.GetCurrentGradient(i._ratio,i._dragGradients,((a,n,L)=>{a!==g._currentDragGradient&&(g._currentDrag1=g._currentDrag2,g._currentDrag2=n.getFactor(),g._currentDragGradient=a);const d=(0,N.Lerp)(g._currentDrag1,g._currentDrag2,L);i._scaledDirection.scaleInPlace(1-d)}))}function Pg(g,i){g._randomNoiseCoordinates1?(g._randomNoiseCoordinates1.sd(Math.random(),Math.random(),Math.random()),g._randomNoiseCoordinates2.sd(Math.random(),Math.random(),Math.random())):(g._randomNoiseCoordinates1=new n.Bi(Math.random(),Math.random(),Math.random()),g._randomNoiseCoordinates2=new n.Bi(Math.random(),Math.random(),Math.random()))}function Yg(g,i){const a=i._noiseTextureData,L=i._noiseTextureSize;if(a&&L&&g._randomNoiseCoordinates1){const d=i._fetchR(g._randomNoiseCoordinates1.x,g._randomNoiseCoordinates1.y,L.width,L.height,a),b=i._fetchR(g._randomNoiseCoordinates1.z,g._randomNoiseCoordinates2.x,L.width,L.height,a),k=i._fetchR(g._randomNoiseCoordinates2.y,g._randomNoiseCoordinates2.z,L.width,L.height,a),e=n.TmpVectors.Bi[0],N=n.TmpVectors.Bi[1];e.sd((2*d-1)*i.noiseStrength.x,(2*b-1)*i.noiseStrength.y,(2*k-1)*i.noiseStrength.z),e.scaleToRef(i._tempScaledUpdateSpeed,N),g.direction.addInPlace(N)}}function fg(g,i){i.gravity.scaleToRef(i._tempScaledUpdateSpeed,i._scaledGravity),g.direction.addInPlace(i._scaledGravity)}function Cg(g,i){g.size=(0,N.RandomRange)(i.minSize,i.maxSize),g.scale.sd((0,N.RandomRange)(i.minScaleX,i.maxScaleX),(0,N.RandomRange)(i.minScaleY,i.maxScaleY))}function Ug(g,i){g._currentSizeGradient=i._sizeGradients[0],g._currentSize1=g._currentSizeGradient.getFactor(),g.size=g._currentSize1,i._sizeGradients.length>1?g._currentSize2=i._sizeGradients[1].getFactor():g._currentSize2=g._currentSize1,g.scale.sd((0,N.RandomRange)(i.minScaleX,i.maxScaleX),(0,N.RandomRange)(i.minScaleY,i.maxScaleY))}function Sg(g,i){const a=i._actualFrame/i.targetStopDuration;M.GetCurrentGradient(a,i._startSizeGradients,((a,n,L)=>{a!==i._currentStartSizeGradient&&(i._currentStartSize1=i._currentStartSize2,i._currentStartSize2=n.getFactor(),i._currentStartSizeGradient=a);const d=(0,N.Lerp)(i._currentStartSize1,i._currentStartSize2,L);g.scale.scaleInPlace(d)}))}function Vg(g,i){M.GetCurrentGradient(i._ratio,i._sizeGradients,((i,a,n)=>{i!==g._currentSizeGradient&&(g._currentSize1=g._currentSize2,g._currentSize2=a.getFactor(),g._currentSizeGradient=i),g.size=(0,N.Lerp)(g._currentSize1,g._currentSize2,n)}))}function Kg(g,i){g.remapData=new n.Vector4(0,1,0,1)}function Tg(g,i){i._colorRemapGradients&&i._colorRemapGradients.length>0&&M.GetCurrentGradient(i._ratio,i._colorRemapGradients,((i,a,n)=>{const L=(0,N.Lerp)(i.factor1,a.factor1,n),d=(0,N.Lerp)(i.factor2,a.factor2,n);g.remapData.x=L,g.remapData.y=d-L})),i._alphaRemapGradients&&i._alphaRemapGradients.length>0&&M.GetCurrentGradient(i._ratio,i._alphaRemapGradients,((i,a,n)=>{const L=(0,N.Lerp)(i.factor1,a.factor1,n),d=(0,N.Lerp)(i.factor2,a.factor2,n);g.remapData.z=L,g.remapData.w=d-L}))}function lg(g,i){const a=(0,N.Clamp)(i._actualFrame/i.targetStopDuration);M.GetCurrentGradient(a,i._lifeTimeGradients,((i,n)=>{const L=i,d=n,b=L.getFactor(),k=d.getFactor(),e=(a-L.gradient)/(d.gradient-L.gradient);g.lifeTime=(0,N.Lerp)(b,k,e)})),i._emitPower=(0,N.RandomRange)(i.minEmitPower,i.maxEmitPower)}function Zg(g,i){g.lifeTime=(0,N.RandomRange)(i.minLifeTime,i.maxLifeTime),i._emitPower=(0,N.RandomRange)(i.minEmitPower,i.maxEmitPower)}function hg(g,i){0===i._emitPower?(g._initialDirection?g._initialDirection.I(g.direction):g._initialDirection=g.direction.clone(),g.direction.set(0,0,0)):(g._initialDirection=null,g.direction.scaleInPlace(i._emitPower)),g.direction.addInPlace(i._inheritedVelocityOffset)}function wg(g,i){g.angularSpeed=(0,N.RandomRange)(i.minAngularSpeed,i.maxAngularSpeed),g.angle=(0,N.RandomRange)(i.minInitialRotation,i.maxInitialRotation)}function tg(g,i){g._currentAngularSpeedGradient=i._angularSpeedGradients[0],g.angularSpeed=g._currentAngularSpeedGradient.getFactor(),g._currentAngularSpeed1=g.angularSpeed,i._angularSpeedGradients.length>1?g._currentAngularSpeed2=i._angularSpeedGradients[1].getFactor():g._currentAngularSpeed2=g._currentAngularSpeed1,g.angle=(0,N.RandomRange)(i.minInitialRotation,i.maxInitialRotation)}function Ag(g,i){g._initialStartSpriteCellId=i.startSpriteCellID,g._initialEndSpriteCellId=i.endSpriteCellID,g._initialSpriteCellLoop=i.spriteCellLoop}function Og(g,i){g.previousItem=i.previousItem,g.nextItem=i,i.previousItem&&(i.previousItem.nextItem=g),i.previousItem=g}function zg(g,i){g.previousItem=i,g.nextItem=i.nextItem,i.nextItem&&(i.nextItem.previousItem=g),i.nextItem=g}function sg(g,i){let a=i;for(;a.nextItem;)a=a.nextItem;g.previousItem=a,g.nextItem=a.nextItem,a.nextItem=g}function mi(g){g.previousItem&&(g.previousItem.nextItem=g.nextItem),g.nextItem&&(g.nextItem.previousItem=g.previousItem)}class rg extends e{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(g){this._startDirectionFunction!==g&&(this._startDirectionFunction=g,this._directionProcessing.process=g?Ig:Fg)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(g){this._startPositionFunction!==g&&(this._startPositionFunction=g,this._positionCreation.process=g?Rg:pg)}set onDispose(g){this._onDisposeObserver&&this.dd.remove(this._onDisposeObserver),this._onDisposeObserver=this.dd.add(g)}get p(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(g){this._useRampGradients!==g&&(this._useRampGradients=g,this._resetEffect(),g?(this._rampCreation={process:Kg,previousItem:null,nextItem:null},zg(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Tg,previousItem:null,nextItem:null},zg(this._remapGradientProcessing,this._gravityProcessing)):(mi(this._rampCreation),mi(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(g){this._isLocal!==g&&(this._isLocal=g,g?(this._isLocalCreation={process:xg,previousItem:null,nextItem:null},zg(this._isLocalCreation,this._positionCreation)):mi(this._isLocalCreation))}get particles(){return this.Jj}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(g){this._animationSheetEnabled!==g&&(this._animationSheetEnabled=g,g?(this._sheetCreation={process:Ag,previousItem:null,nextItem:null},zg(this._sheetCreation,this._colorCreation)):mi(this._sheetCreation),this._reset())}getActiveCount(){return this.Jj.length}getClassName(){return"nb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var g;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(g=this._customWrappers[i])||void 0===g?void 0:g.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[g]??this._customWrappers[0]}setCustomEffect(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[i]=new gg.c(this._engine),this._customWrappers[i].effect=g,this._customWrappers[i].drawContext&&(this._customWrappers[i].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new q.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(g){if(this.noiseTexture!==g){if(this._noiseTexture=g,!g)return mi(this._noiseCreation),void mi(this._noiseProcessing);this._noiseCreation={process:Pg,previousItem:null,nextItem:null},zg(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Yg,previousItem:null,nextItem:null},zg(this._noiseProcessing,this._positionProcessing)}}constructor(g,i,a){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,e=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(g),this._emitterInverseWorldMatrix=n.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new n.Bi,this.dd=new q.b,this.onStoppedObservable=new q.b,this.onStartedObservable=new q.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Jj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new b.Hd(0,0,0,0),this._colorDiff=new b.Hd(0,0,0,0),this._scaledDirection=n.Bi.Zero(),this._scaledGravity=n.Bi.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=g=>{},this.recycleParticle=g=>{const i=this.Jj.pop();i!==g&&i.copyTo(g),this._stockParticles.push(i)},this._createParticle=()=>{let g;return 0!==this._stockParticles.length?(g=this._stockParticles.pop(),g._reset()):g=new J(this),this._prepareParticle(g),g},this.paused=!1,this._shadersLoaded=!1,this._capacity=i,this._epsilon=k,a&&"Scene"!==a.getClassName()?(this._engine=a,this.defaultProjectionMatrix=n.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=a||G.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Wj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Zg,previousItem:null,nextItem:null},this._positionCreation={process:pg,previousItem:null,nextItem:null},zg(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Fg,previousItem:null,nextItem:null},zg(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:hg,previousItem:null,nextItem:null},zg(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Cg,previousItem:null,nextItem:null},zg(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:wg,previousItem:null,nextItem:null},zg(this._angleCreation,this._sizeCreation),this._colorCreation={process:Lg,previousItem:null,nextItem:null},zg(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,e||(this._colorProcessing={process:kg,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Ng,previousItem:null,nextItem:null},zg(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Dg,previousItem:null,nextItem:null},zg(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Eg,previousItem:null,nextItem:null},zg(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:fg,previousItem:null,nextItem:null},zg(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=d,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new gg.c(this._engine)},this._customWrappers[0].effect=L,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new I,this.updateFunction=g=>{var i;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(i=this.noiseTexture.getContent())||void 0===i||i.then((g=>{this._noiseTextureData=g})));const a=g===this.Jj;for(let n=0;n<g.length;n++){const i=g[n];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const L=i.age;if(i.age+=this._tempScaledUpdateSpeed,i.age>i.lifeTime){const g=i.age-L,a=i.lifeTime-L;this._tempScaledUpdateSpeed=a*this._tempScaledUpdateSpeed/g,i.age=i.lifeTime}this._ratio=i.age/i.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let d=this._updateQueueStart;for(;d;)d.process(i,this),d=d.nextItem;if(this._isAnimationSheetEnabled&&!e&&i.updateCellIndex(),i._inheritParticleInfoToSubEmitters(),i.age>=i.lifeTime){if(this._emitFromParticle(i),i._attachedSubEmitters){for(const g of i._attachedSubEmitters)g.particleSystem.disposeOnStop=!0,g.particleSystem.stop();i._attachedSubEmitters=null}this.recycleParticle(i),a&&n--}else;}}}serialize(g){throw new Error("Method not implemented.")}clone(g,i){throw new Error("Method not implemented.")}_addFactorGradient(g,i,a,n){const L=new H(i,a,n);g.push(L),g.sort(((g,i)=>g.gradient<i.gradient?-1:g.gradient>i.gradient?1:0))}_removeFactorGradient(g,i){if(!g)return;let a=0;for(const n of g){if(n.gradient===i){g.splice(a,1);break}a++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=lg:this._lifeTimeCreation.process=Zg}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Sg,previousItem:null,nextItem:null},zg(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(mi(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(g){this.targetStopDuration!==g&&(this._targetStopDuration=g,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(g,i,a){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,g,i,a),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(g){return this._removeFactorGradient(this._lifeTimeGradients,g),this._syncLifeTimeCreation(),this}addSizeGradient(g,i,a){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Ug,this._sizeGradientProcessing={process:Vg,previousItem:null,nextItem:null},Og(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,g,i,a),this}removeSizeGradient(g){var i;return this._removeFactorGradient(this._sizeGradients,g),0===(null===(i=this._sizeGradients)||void 0===i?void 0:i.length)&&(mi(this._sizeGradientProcessing),this._sizeCreation.process=Cg),this}addColorRemapGradient(g,i,a){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,g,i,a),this}removeColorRemapGradient(g){return this._removeFactorGradient(this._colorRemapGradients,g),this}addAlphaRemapGradient(g,i,a){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,g,i,a),this}removeAlphaRemapGradient(g){return this._removeFactorGradient(this._alphaRemapGradients,g),this}addAngularSpeedGradient(g,i,a){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=tg,this._angularSpeedGradientProcessing={process:eg,previousItem:null,nextItem:null},Og(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,g,i,a),this}removeAngularSpeedGradient(g){var i;return this._removeFactorGradient(this._angularSpeedGradients,g),0===(null===(i=this._angularSpeedGradients)||void 0===i?void 0:i.length)&&(this._angleCreation.process=wg,mi(this._angularSpeedGradientProcessing)),this}addVelocityGradient(g,i,a){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:jg,previousItem:null,nextItem:null},zg(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Bg,previousItem:null,nextItem:null},Og(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,g,i,a),this}removeVelocityGradient(g){var i;return this._removeFactorGradient(this._velocityGradients,g),0===(null===(i=this._velocityGradients)||void 0===i?void 0:i.length)&&(mi(this._velocityCreation),mi(this._velocityGradientProcessing)),this}addLimitVelocityGradient(g,i,a){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:yg,previousItem:null,nextItem:null},zg(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:cg,previousItem:null,nextItem:null},zg(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,g,i,a),this}removeLimitVelocityGradient(g){var i;return this._removeFactorGradient(this._limitVelocityGradients,g),0===(null===(i=this._limitVelocityGradients)||void 0===i?void 0:i.length)&&(mi(this._limitVelocityCreation),mi(this._limitVelocityGradientProcessing)),this}addDragGradient(g,i,a){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Xg,previousItem:null,nextItem:null},Og(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:vg,previousItem:null,nextItem:null},Og(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,g,i,a),this}removeDragGradient(g){var i;return this._removeFactorGradient(this._dragGradients,g),0===(null===(i=this._dragGradients)||void 0===i?void 0:i.length)&&(mi(this._dragCreation),mi(this._dragGradientProcessing)),this}addEmitRateGradient(g,i,a){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,g,i,a),this}removeEmitRateGradient(g){return this._removeFactorGradient(this._emitRateGradients,g),this}addStartSizeGradient(g,i,a){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,g,i,a),this._syncStartSizeCreation(),this}removeStartSizeGradient(g){return this._removeFactorGradient(this._startSizeGradients,g),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const g=new Uint8Array(4*this._rawTextureWidth),i=b.TmpColors.Ri[0];for(let a=0;a<this._rawTextureWidth;a++){const n=a/this._rawTextureWidth;M.GetCurrentGradient(n,this._rampGradients,((n,L,d)=>{b.Ri.LerpToRef(n.color,L.color,d,i),g[4*a]=255*i.r,g[4*a+1]=255*i.g,g[4*a+2]=255*i.b,g[4*a+3]=255}))}this._rampGradientsTexture=W.b.CreateRGBATexture(g,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((g,i)=>g.gradient<i.gradient?-1:g.gradient>i.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(g,i){this._rampGradients||(this._rampGradients=[]);const a=new u(g,i);return this._rampGradients.push(a),this._syncRampGradientTexture(),this}removeRampGradient(g){return this._removeGradientAndTexture(g,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(g,i,a){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=dg,this._colorProcessing.process=bg);const n=new o(g,i,a);return this._colorGradients.push(n),this._colorGradients.sort(((g,i)=>g.gradient<i.gradient?-1:g.gradient>i.gradient?1:0)),this}removeColorGradient(g){if(!this._colorGradients)return this;let i=0;for(const a of this._colorGradients){if(a.gradient===g){this._colorGradients.splice(i,1);break}i++}return 0===this._colorGradients.length&&(this._colorCreation.process=Lg,this._colorProcessing.process=kg),this}resetDrawCache(){if(this._drawWrappers){for(const g of this._drawWrappers)if(g)for(const i of g)null===i||void 0===i||i.dispose();this._drawWrappers=[]}}_fetchR(g,i,a,n,L){return L[4*(((g=.5*Math.abs(g)+.5)*a%a|0)+((i=.5*Math.abs(i)+.5)*n%n|0)*a)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const g=this._engine,i=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*i),this._vertexBuffer=new X.c(g,this._vertexData,!0,i);let a=0;const n=this._vertexBuffer.createVertexBuffer(X.g.PositionKind,a,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[X.g.PositionKind]=n,a+=3;const L=this._vertexBuffer.createVertexBuffer(X.g.ColorKind,a,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[X.g.ColorKind]=L,a+=4;const d=this._vertexBuffer.createVertexBuffer("angle",a,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=d,a+=1;const b=this._vertexBuffer.createVertexBuffer("size",a,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=b,a+=2,this._isAnimationSheetEnabled){const g=this._vertexBuffer.createVertexBuffer("cellIndex",a,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=g,a+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const g=this._vertexBuffer.createVertexBuffer("direction",a,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=g,a+=3}if(this._useRampGradients){const g=this._vertexBuffer.createVertexBuffer("remapData",a,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=g,a+=4}let k;if(this._useInstancing){const i=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new X.c(g,i,!1,2),k=this._spriteBuffer.createVertexBuffer("offset",0,2)}else k=this._vertexBuffer.createVertexBuffer("offset",a,2,this._vertexBufferSize,this._useInstancing),a+=2;this._vertexBuffers.offset=k,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const g=[],i=[];let a=0;for(let n=0;n<this._capacity;n++)g.push(a),g.push(a+1),g.push(a+2),g.push(a),g.push(a+2),g.push(a+3),i.push(a,a+1,a+1,a+2,a+2,a+3,a+3,a,a,a+3),a+=4;this._indexBuffer=this._engine.createIndexBuffer(g),this._linesIndexBuffer=this._engine.createIndexBuffer(i)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(g)setTimeout((()=>{this.start(0)}),g);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var i;-1!==(null===(i=this.ni)||void 0===i?void 0:i.getClassName().indexOf("Mesh"))&&this.ni.Zd(!0);const g=this.noiseTexture;if(g&&g.onGeneratedObservable)g.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let i=0;i<this.preWarmCycles;i++)this.animate(!0),g.render()}))}));else for(let i=0;i<this.preWarmCycles;i++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(g))}_postStop(g){}reset(){this._stockParticles.length=0,this.Jj.length=0}_appendParticleVertex(g,i,a,L){let d=g*this._vertexBufferSize;if(this._vertexData[d++]=i.position.x+this.cF.x,this._vertexData[d++]=i.position.y+this.cF.y,this._vertexData[d++]=i.position.z+this.cF.z,this._vertexData[d++]=i.color.r,this._vertexData[d++]=i.color.g,this._vertexData[d++]=i.color.b,this._vertexData[d++]=i.color.a,this._vertexData[d++]=i.angle,this._vertexData[d++]=i.scale.x*i.size,this._vertexData[d++]=i.scale.y*i.size,this._isAnimationSheetEnabled&&(this._vertexData[d++]=i.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[d++]=i.direction.x,this._vertexData[d++]=i.direction.y,this._vertexData[d++]=i.direction.z);else if(i._initialDirection){let g=i._initialDirection;this.isLocal&&(n.Bi.TransformNormalToRef(g,this._emitterWorldMatrix,n.TmpVectors.Bi[0]),g=n.TmpVectors.Bi[0]),0===g.x&&0===g.z&&(g.x=.001),this._vertexData[d++]=g.x,this._vertexData[d++]=g.y,this._vertexData[d++]=g.z}else{let g=i.direction;this.isLocal&&(n.Bi.TransformNormalToRef(g,this._emitterWorldMatrix,n.TmpVectors.Bi[0]),g=n.TmpVectors.Bi[0]),0===g.x&&0===g.z&&(g.x=.001),this._vertexData[d++]=g.x,this._vertexData[d++]=g.y,this._vertexData[d++]=g.z}this._useRampGradients&&i.remapData&&(this._vertexData[d++]=i.remapData.x,this._vertexData[d++]=i.remapData.y,this._vertexData[d++]=i.remapData.z,this._vertexData[d++]=i.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===a?a=this._epsilon:1===a&&(a=1-this._epsilon),0===L?L=this._epsilon:1===L&&(L=1-this._epsilon)),this._vertexData[d++]=a,this._vertexData[d++]=L)}_prepareParticle(g){}_createNewOnes(g){let i;for(let a=0;a<g&&this.Jj.length!==this._capacity;a++){i=this._createParticle(),this.Jj.push(i);let g=this._createQueueStart;for(;g;)g.process(i,this),g=g.nextItem;i._inheritParticleInfoToSubEmitters()}}_update(g){if(this._alive=this.Jj.length>0,this.ni.position){const g=this.ni;this._emitterWorldMatrix=g.getWorldMatrix()}else{const g=this.ni;this._emitterWorldMatrix=n.Matrix.Translation(g.x,g.y,g.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Jj),this._createNewOnes(g)}static _GetAttributeNamesOrOptions(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=[X.g.PositionKind,X.g.ColorKind,"angle","offset","size"];return g&&n.push("cellIndex"),i||n.push("direction"),a&&n.push("remapData"),n}static _GetEffectCreationOptions(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,ig.e)(n),g&&n.push("particlesInfos"),i&&n.push("logarithmicDepthConstant"),a&&(n.push("vFogInfos"),n.push("vFogColor")),n}fillDefines(g,i){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,ig.n)(this,this._scene,g),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&g.push("#define FOG")),this._isAnimationSheetEnabled&&g.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&g.push("#define LOGARITHMICDEPTH"),i===e.BLENDMODE_MULTIPLY&&g.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&g.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(g.push("#define BILLBOARD"),this.billboardMode){case 2:g.push("#define BILLBOARDY");break;case 8:case 9:g.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&g.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:g.push("#define BILLBOARDMODE_ALL")}a&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),g.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(g,i,a){i.push(...rg._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),g.push(...rg._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),a.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,ng.e)(g,this._imageProcessingConfigurationDefines),(0,ng.c)(a,this._imageProcessingConfigurationDefines))}_getWrapper(g){const i=this._getCustomDrawWrapper(g);if(null!==i&&void 0!==i&&i.effect)return i;const a=[];this.fillDefines(a,g);const n=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let L=this._drawWrappers[n];L||(L=this._drawWrappers[n]=[]);let d=L[g];d||(d=new gg.c(this._engine),d.drawContext&&(d.drawContext.useInstancing=this._useInstancing),L[g]=d);const b=a.join("\n");if(d.defines!==b){const g=[],i=[],a=[];this.fillUniformsAttributesAndSamplerNames(i,g,a),d.setEffect(this._engine.createEffect("particles",g,i,a,b,void 0,void 0,void 0,void 0,this._shaderLanguage),b)}return d}animate(){var g;let i,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!a&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(a?this.preWarmStepOffset:(null===(g=this._scene)||void 0===g?void 0:g.getAnimationRatio())||1),this.manualEmitCount>-1)i=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let g=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const i=this._actualFrame/this.targetStopDuration;M.GetCurrentGradient(i,this._emitRateGradients,((i,a,n)=>{i!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=a.getFactor(),this._currentEmitRateGradient=i),g=(0,N.Lerp)(this._currentEmitRate1,this._currentEmitRate2,n)}))}i=g*this._scaledUpdateSpeed|0,this._newPartsExcess+=g*this._scaledUpdateSpeed-i}if(this._newPartsExcess>1&&(i+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?i=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(i),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!a){let g=0;for(let i=0;i<this.Jj.length;i++){const a=this.Jj[i];this._appendParticleVertices(g,a),g+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Jj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(g,i){this._appendParticleVertex(g++,i,0,0),this._useInstancing||(this._appendParticleVertex(g++,i,1,0),this._appendParticleVertex(g++,i,1,1),this._appendParticleVertex(g++,i,0,1))}rebuild(){var g;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(g=this._spriteBuffer)||void 0===g||g._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!rg.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(a.bind(a,13950)),Promise.resolve().then(a.bind(a,13894))])):await Promise.all([Promise.resolve().then(a.bind(a,13881)),Promise.resolve().then(a.bind(a,13864))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.ni||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==e.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(e.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(e.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(g){const i=this._getWrapper(g),a=i.effect,L=this._engine;L.enableEffect(i);const d=this.defaultViewMatrix??this._scene.getViewMatrix();if(a.setTexture("diffuseSampler",this.particleTexture),a.setMatrix("view",d),a.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const g=this.particleTexture.getBaseSize();a.setFloat3("particlesInfos",this.spriteCellWidth/g.width,this.spriteCellHeight/g.height,this.spriteCellWidth/g.width)}if(a.setVector2("translationPivot",this.translationPivot),a.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const g=this._scene.activeCamera;a.setVector3("eyePosition",g.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),a.setTexture("rampSampler",this._rampGradientsTexture));const b=a.defines;var k,e,N,F,I,j;(this._scene&&((0,ig.i)(a,this,this._scene),this.applyFog&&(0,ag.d)(this._scene,void 0,a)),b.indexOf("#define BILLBOARDMODE_ALL")>=0&&(d.invertToRef(n.TmpVectors.Matrix[0]),a.setMatrix("invView",n.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?L.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,a):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,a)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?L.bindBuffers(this._vertexBuffers,null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?this._linesIndexBuffer:this._indexBuffer,a):L.bindBuffers(this._vertexBuffers,null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?this._linesIndexBufferUseInstancing:null,a);(this.useLogarithmicDepth&&this._scene&&(0,ag.j)(b,a,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(a),this._setEngineBasedOnBlendMode(g),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(a),this._useInstancing)?null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?L.drawElementsType(6,0,10,this.Jj.length):L.drawArraysType(7,0,4,this.Jj.length):null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?L.drawElementsType(1,0,10*this.Jj.length):L.drawElementsType(0,0,6*this.Jj.length);return this.Jj.length}render(){if(!this.isReady()||!this.Jj.length)return 0;const g=this._engine;g.setState&&(g.setState(!1),this.forceDepthWrite&&g.setDepthWrite(!0));let i=0;return i=this.blendMode===e.BLENDMODE_MULTIPLYADD?this._render(e.BLENDMODE_MULTIPLY)+this._render(e.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),i}_onDispose(){}dispose(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),g&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),g&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(i,a),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const g=this._scene.Wj.indexOf(this);g>-1&&this._scene.Wj.splice(g,1),this._scene._activeParticleSystems.dispose()}this.dd.notifyObservers(this),this.dd.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}rg.ForceGLSL=!1;var Qg,og=a(12303);!function(g){g[g.ATTACHED=0]="ATTACHED",g[g.END=1]="END"}(Qg||(Qg={}));class ug{constructor(g){if(this.particleSystem=g,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!g.ni||!g.ni.dispose){const i=(0,k.d)("BABYLON.AbstractMesh");g.ni=new i("SubemitterSystemEmitter",g.Pg()),g._disposeEmitterOnDispose=!0}}clone(){let g=this.particleSystem.ni;if(g){if(g instanceof n.Bi)g=g.clone();else if(-1!==g.getClassName().indexOf("Mesh")){g=new((0,k.d)("BABYLON.Mesh"))("",g.Pg()),g.isVisible=!1}}else g=new n.Bi;const i=new ug(this.particleSystem.clone(this.particleSystem.name,g));return i.particleSystem.name+="Clone",i.type=this.type,i.inheritDirection=this.inheritDirection,i.inheritedVelocityAmount=this.inheritedVelocityAmount,i.particleSystem._disposeEmitterOnDispose=!0,i.particleSystem.disposeOnStop=!0,i}serialize(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const i={};return i.type=this.type,i.inheritDirection=this.inheritDirection,i.inheritedVelocityAmount=this.inheritedVelocityAmount,i.particleSystem=this.particleSystem.serialize(g),i}static _ParseParticleSystem(g,i,a){throw(0,og.b)("ParseParticle")}static Parse(g,i,a){const n=g.particleSystem,L=new ug(ug._ParseParticleSystem(n,i,a,!0));return L.type=g.type,L.inheritDirection=g.inheritDirection,L.inheritedVelocityAmount=g.inheritedVelocityAmount,L.particleSystem._isSubEmitter=!0,L}dispose(){this.particleSystem.dispose()}}var Hg=a(12354);function Mg(g,i){const a=new p;return a.direction1=g,a.direction2=i,a}function qg(){return new D(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Wg(){return new R(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Gg(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.Bi(0,1,0),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.Bi(0,1,0);return new x(g,i,a)}function Jg(){return new B(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function gi(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.Bi(0,1,0),d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new n.Bi(0,1,0);return new c(g,i,a,L,d)}function ii(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new j(g,i)}function ai(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.Bi(0,1,0),L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.Bi(0,1,0);return new y(g,i,a,L)}const ni=n.Bi.Zero(),Li=n.Bi.Zero(),di=n.Bi.Zero();class bi{constructor(){this.strength=0,this.position=n.Bi.Zero()}_processParticle(g,i){this.position.subtractToRef(g.position,ni);const a=ni.lengthSquared()+1;ni.normalize().scaleToRef(this.strength/a,Li),Li.scaleToRef(i._tempScaledUpdateSpeed,di),g.direction.addInPlace(di)}serialize(){return{position:this.position.fd(),strength:this.strength}}}class ki extends rg{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=g=>{if(!this._subEmitters||0===this._subEmitters.length)return;const i=Math.floor(Math.random()*this._subEmitters.length);for(const a of this._subEmitters[i])if(1===a.type){const i=a.clone();g._inheritParticleInfoToSubEmitter(i),i.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(i.particleSystem),i.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(g,i){const a=Mg(g,i);return this.particleEmitterType=a,a}get flowMap(){return this._flowMap}set flowMap(g){this._flowMap!==g&&(this._flowMap=g,this._flowMapUpdate&&(mi(this._flowMapUpdate),this._flowMapUpdate=null),g&&(this._flowMapUpdate={process:g=>{var i;const a=null===(i=this.Pg())||void 0===i?void 0:i.getTransformMatrix();this._flowMap._processParticle(g,this.flowMapStrength*this._tempScaledUpdateSpeed,a)},previousItem:null,nextItem:null},zg(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(g){this._attractors.push(g),1===this._attractors.length&&(this._attractorUpdate={process:g=>{for(const i of this._attractors)i._processParticle(g,this)},previousItem:null,nextItem:null},zg(this._attractorUpdate,this._directionProcessing))}removeAttractor(g){const i=this._attractors.indexOf(g);-1!==i&&this._attractors.splice(i,1),0===this._attractors.length&&mi(this._attractorUpdate)}start(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(g)}createHemisphericEmitter(){const g=qg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=g,g}createSphereEmitter(){const g=Wg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=g,g}createDirectedSphereEmitter(){const g=Gg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.Bi(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.Bi(0,1,0));return this.particleEmitterType=g,g}createCylinderEmitter(){const g=Jg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=g,g}createDirectedCylinderEmitter(){const g=gi(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.Bi(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new n.Bi(0,1,0));return this.particleEmitterType=g,g}createConeEmitter(){const g=ii(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=g,g}createDirectedConeEmitter(){const g=ai(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.Bi(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.Bi(0,1,0));return this.particleEmitterType=g,g}createBoxEmitter(g,i,a,n){const L=new I;return this.particleEmitterType=L,this.direction1=g,this.direction2=i,this.minEmitBox=a,this.maxEmitBox=n,L}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const g of this.subEmitters)g instanceof ki?this._subEmitters.push([new ug(g)]):g instanceof ug?this._subEmitters.push([g]):g instanceof Array&&this._subEmitters.push(g)}_stopSubEmitters(){if(this.activeSubSystems){for(const g of this.activeSubSystems)g.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const g=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==g&&this._rootParticleSystem.activeSubSystems.splice(g,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(g){g&&this._stopSubEmitters()}_prepareParticle(g){if(this._subEmitters&&this._subEmitters.length>0){const i=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];g._attachedSubEmitters=[];for(const a of i)if(0===a.type){const i=a.clone();g._attachedSubEmitters.push(i),i.particleSystem.start()}}}_onDispose(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),g&&this.particles)for(const a of this.particles)if(a._attachedSubEmitters)for(let g=a._attachedSubEmitters.length-1;g>=0;g-=1)a._attachedSubEmitters[g].dispose();if(i&&this.activeSubSystems)for(let a=this.activeSubSystems.length-1;a>=0;a-=1)this.activeSubSystems[a].dispose();if(this._subEmitters&&this._subEmitters.length){for(let g=0;g<this._subEmitters.length;g++)for(const i of this._subEmitters[g])i.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.ni&&this.ni.dispose&&this.ni.dispose(!0)}static _Parse(g,i,a,L){let d;d=a instanceof Hg.d?null:a;const e=(0,k.d)("BABYLON.Texture");if(e&&d&&(g.texture?i.particleTexture=e.Parse(g.texture,d,L):g.textureName&&(i.particleTexture=new e(L+g.textureName,d,!1,void 0===g.invertY||g.invertY),i.particleTexture.name=g.textureName)),g.emitterId||0===g.emitterId||void 0!==g.ni?g.emitterId&&d?i.ni=d.getLastMeshById(g.emitterId):i.ni=n.Bi.xi(g.ni):i.ni=n.Bi.Zero(),i.isLocal=!!g.isLocal,void 0!==g.renderingGroupId&&(i.renderingGroupId=g.renderingGroupId),void 0!==g.isBillboardBased&&(i.isBillboardBased=g.isBillboardBased),void 0!==g.billboardMode&&(i.billboardMode=g.billboardMode),void 0!==g.useLogarithmicDepth&&(i.useLogarithmicDepth=g.useLogarithmicDepth),g.animations){for(let a=0;a<g.animations.length;a++){const n=g.animations[a],L=(0,k.d)("BABYLON.Animation");L&&i.animations.push(L.Parse(n))}i.beginAnimationOnStart=g.beginAnimationOnStart,i.beginAnimationFrom=g.beginAnimationFrom,i.beginAnimationTo=g.beginAnimationTo,i.beginAnimationLoop=g.beginAnimationLoop}if(g.autoAnimate&&d&&d.beginAnimation(i,g.autoAnimateFrom,g.autoAnimateTo,g.autoAnimateLoop,g.autoAnimateSpeed||1),i.startDelay=0|g.startDelay,i.minAngularSpeed=g.minAngularSpeed,i.maxAngularSpeed=g.maxAngularSpeed,i.minSize=g.minSize,i.maxSize=g.maxSize,g.minScaleX&&(i.minScaleX=g.minScaleX,i.maxScaleX=g.maxScaleX,i.minScaleY=g.minScaleY,i.maxScaleY=g.maxScaleY),void 0!==g.preWarmCycles&&(i.preWarmCycles=g.preWarmCycles,i.preWarmStepOffset=g.preWarmStepOffset),void 0!==g.minInitialRotation&&(i.minInitialRotation=g.minInitialRotation,i.maxInitialRotation=g.maxInitialRotation),i.minLifeTime=g.minLifeTime,i.maxLifeTime=g.maxLifeTime,i.minEmitPower=g.minEmitPower,i.maxEmitPower=g.maxEmitPower,i.emitRate=g.emitRate,i.gravity=n.Bi.xi(g.gravity),g.noiseStrength&&(i.noiseStrength=n.Bi.xi(g.noiseStrength)),i.color1=b.Hd.xi(g.color1),i.color2=b.Hd.xi(g.color2),i.colorDead=b.Hd.xi(g.colorDead),i.updateSpeed=g.updateSpeed,i.targetStopDuration=g.targetStopDuration,i.blendMode=g.blendMode,g.colorGradients)for(const n of g.colorGradients)i.addColorGradient(n.gradient,b.Hd.xi(n.color1),n.color2?b.Hd.xi(n.color2):void 0);if(g.rampGradients){for(const a of g.rampGradients)i.addRampGradient(a.gradient,b.Ri.xi(a.color));i.useRampGradients=g.useRampGradients}if(g.colorRemapGradients)for(const n of g.colorRemapGradients)i.addColorRemapGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(g.alphaRemapGradients)for(const n of g.alphaRemapGradients)i.addAlphaRemapGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(g.sizeGradients)for(const n of g.sizeGradients)i.addSizeGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(g.angularSpeedGradients)for(const n of g.angularSpeedGradients)i.addAngularSpeedGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(g.velocityGradients)for(const n of g.velocityGradients)i.addVelocityGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(g.dragGradients)for(const n of g.dragGradients)i.addDragGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(g.emitRateGradients)for(const n of g.emitRateGradients)i.addEmitRateGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(g.startSizeGradients)for(const n of g.startSizeGradients)i.addStartSizeGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(g.lifeTimeGradients)for(const n of g.lifeTimeGradients)i.addLifeTimeGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(g.limitVelocityGradients){for(const a of g.limitVelocityGradients)i.addLimitVelocityGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);i.limitVelocityDamping=g.limitVelocityDamping}if(g.noiseTexture&&d){const a=(0,k.d)("BABYLON.ProceduralTexture");i.noiseTexture=a.Parse(g.noiseTexture,d,L)}let N;if(g.particleEmitterType){switch(g.particleEmitterType.type){case"SphereParticleEmitter":N=new R;break;case"SphereDirectedParticleEmitter":N=new x;break;case"ConeEmitter":case"ConeParticleEmitter":N=new j;break;case"ConeDirectedParticleEmitter":N=new y;break;case"CylinderParticleEmitter":N=new B;break;case"CylinderDirectedParticleEmitter":N=new c;break;case"HemisphericParticleEmitter":N=new D;break;case"PointParticleEmitter":N=new p;break;case"MeshParticleEmitter":N=new v;break;case"CustomParticleEmitter":N=new E;break;default:N=new I}N.parse(g.particleEmitterType,d)}else N=new I,N.parse(g,d);i.particleEmitterType=N,i.startSpriteCellID=g.startSpriteCellID,i.endSpriteCellID=g.endSpriteCellID,i.spriteCellLoop=g.spriteCellLoop??!0,i.spriteCellWidth=g.spriteCellWidth,i.spriteCellHeight=g.spriteCellHeight,i.spriteCellChangeSpeed=g.spriteCellChangeSpeed,i.spriteRandomStartCell=g.spriteRandomStartCell,i.disposeOnStop=g.disposeOnStop??!1,i.manualEmitCount=g.manualEmitCount??-1}static Parse(g,i,a){let L=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4?arguments[4]:void 0;const k=g.name;let e,N,F=null,I=null;if(i instanceof Hg.d?e=i:(N=i,e=N.getEngine()),g.customShader&&e.createEffectForParticles){I=g.customShader;const i=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"";F=e.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,i)}const j=new ki(k,d||g.Hk,i,F,g.isAnimationSheetEnabled);if(j.customShader=I,j._rootUrl=a,g.id&&(j.id=g.id),g.subEmitters){j.subEmitters=[];for(const n of g.subEmitters){const g=[];for(const L of n)g.push(ug.Parse(L,i,a));j.subEmitters.push(g)}}if(g.attractors)for(const b of g.attractors){const g=new bi;g.position=n.Bi.xi(b.position),g.strength=b.strength,j.addAttractor(g)}return ki._Parse(g,j,i,a),g.textureMask&&(j.textureMask=b.Hd.xi(g.textureMask)),g.cF&&(j.cF=n.Bi.xi(g.cF)),g.preventAutoStart&&(j.preventAutoStart=g.preventAutoStart),L||j.preventAutoStart||j.start(),j}serialize(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const i={};if(ki._Serialize(i,this,g),i.textureMask=this.textureMask.fd(),i.customShader=this.customShader,i.preventAutoStart=this.preventAutoStart,i.cF=this.cF.fd(),this.subEmitters){i.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const a of this._subEmitters){const n=[];for(const i of a)n.push(i.serialize(g));i.subEmitters.push(n)}}if(this._attractors&&this._attractors.length){i.attractors=[];for(const g of this._attractors)i.attractors.push(g.serialize())}return i}static _Serialize(g,i,a){if(g.name=i.name,g.id=i.id,g.Hk=i.getCapacity(),g.disposeOnStop=i.disposeOnStop,g.manualEmitCount=i.manualEmitCount,i.ni.position){const a=i.ni;g.emitterId=a.id}else{const a=i.ni;g.ni=a.fd()}i.particleEmitterType&&(g.particleEmitterType=i.particleEmitterType.serialize()),i.particleTexture&&(a?g.texture=i.particleTexture.serialize():(g.textureName=i.particleTexture.name,g.invertY=!!i.particleTexture._invertY)),g.isLocal=i.isLocal,l.c.AppendSerializedAnimations(i,g),g.beginAnimationOnStart=i.beginAnimationOnStart,g.beginAnimationFrom=i.beginAnimationFrom,g.beginAnimationTo=i.beginAnimationTo,g.beginAnimationLoop=i.beginAnimationLoop,g.startDelay=i.startDelay,g.renderingGroupId=i.renderingGroupId,g.isBillboardBased=i.isBillboardBased,g.billboardMode=i.billboardMode,g.minAngularSpeed=i.minAngularSpeed,g.maxAngularSpeed=i.maxAngularSpeed,g.minSize=i.minSize,g.maxSize=i.maxSize,g.minScaleX=i.minScaleX,g.maxScaleX=i.maxScaleX,g.minScaleY=i.minScaleY,g.maxScaleY=i.maxScaleY,g.minEmitPower=i.minEmitPower,g.maxEmitPower=i.maxEmitPower,g.minLifeTime=i.minLifeTime,g.maxLifeTime=i.maxLifeTime,g.emitRate=i.emitRate,g.gravity=i.gravity.fd(),g.noiseStrength=i.noiseStrength.fd(),g.color1=i.color1.fd(),g.color2=i.color2.fd(),g.colorDead=i.colorDead.fd(),g.updateSpeed=i.updateSpeed,g.targetStopDuration=i.targetStopDuration,g.blendMode=i.blendMode,g.preWarmCycles=i.preWarmCycles,g.preWarmStepOffset=i.preWarmStepOffset,g.minInitialRotation=i.minInitialRotation,g.maxInitialRotation=i.maxInitialRotation,g.startSpriteCellID=i.startSpriteCellID,g.spriteCellLoop=i.spriteCellLoop,g.endSpriteCellID=i.endSpriteCellID,g.spriteCellChangeSpeed=i.spriteCellChangeSpeed,g.spriteCellWidth=i.spriteCellWidth,g.spriteCellHeight=i.spriteCellHeight,g.spriteRandomStartCell=i.spriteRandomStartCell,g.isAnimationSheetEnabled=i.isAnimationSheetEnabled,g.useLogarithmicDepth=i.useLogarithmicDepth;const n=i.getColorGradients();if(n){g.colorGradients=[];for(const i of n){const a={gradient:i.gradient,color1:i.color1.fd()};i.color2?a.color2=i.color2.fd():a.color2=i.color1.fd(),g.colorGradients.push(a)}}const L=i.getRampGradients();if(L){g.rampGradients=[];for(const i of L){const a={gradient:i.gradient,color:i.color.fd()};g.rampGradients.push(a)}g.useRampGradients=i.useRampGradients}const d=i.getColorRemapGradients();if(d){g.colorRemapGradients=[];for(const i of d){const a={gradient:i.gradient,factor1:i.factor1};void 0!==i.factor2?a.factor2=i.factor2:a.factor2=i.factor1,g.colorRemapGradients.push(a)}}const b=i.getAlphaRemapGradients();if(b){g.alphaRemapGradients=[];for(const i of b){const a={gradient:i.gradient,factor1:i.factor1};void 0!==i.factor2?a.factor2=i.factor2:a.factor2=i.factor1,g.alphaRemapGradients.push(a)}}const k=i.getSizeGradients();if(k){g.sizeGradients=[];for(const i of k){const a={gradient:i.gradient,factor1:i.factor1};void 0!==i.factor2?a.factor2=i.factor2:a.factor2=i.factor1,g.sizeGradients.push(a)}}const e=i.getAngularSpeedGradients();if(e){g.angularSpeedGradients=[];for(const i of e){const a={gradient:i.gradient,factor1:i.factor1};void 0!==i.factor2?a.factor2=i.factor2:a.factor2=i.factor1,g.angularSpeedGradients.push(a)}}const N=i.getVelocityGradients();if(N){g.velocityGradients=[];for(const i of N){const a={gradient:i.gradient,factor1:i.factor1};void 0!==i.factor2?a.factor2=i.factor2:a.factor2=i.factor1,g.velocityGradients.push(a)}}const F=i.getDragGradients();if(F){g.dragGradients=[];for(const i of F){const a={gradient:i.gradient,factor1:i.factor1};void 0!==i.factor2?a.factor2=i.factor2:a.factor2=i.factor1,g.dragGradients.push(a)}}const I=i.getEmitRateGradients();if(I){g.emitRateGradients=[];for(const i of I){const a={gradient:i.gradient,factor1:i.factor1};void 0!==i.factor2?a.factor2=i.factor2:a.factor2=i.factor1,g.emitRateGradients.push(a)}}const j=i.getStartSizeGradients();if(j){g.startSizeGradients=[];for(const i of j){const a={gradient:i.gradient,factor1:i.factor1};void 0!==i.factor2?a.factor2=i.factor2:a.factor2=i.factor1,g.startSizeGradients.push(a)}}const y=i.getLifeTimeGradients();if(y){g.lifeTimeGradients=[];for(const i of y){const a={gradient:i.gradient,factor1:i.factor1};void 0!==i.factor2?a.factor2=i.factor2:a.factor2=i.factor1,g.lifeTimeGradients.push(a)}}const B=i.getLimitVelocityGradients();if(B){g.limitVelocityGradients=[];for(const i of B){const a={gradient:i.gradient,factor1:i.factor1};void 0!==i.factor2?a.factor2=i.factor2:a.factor2=i.factor1,g.limitVelocityGradients.push(a)}g.limitVelocityDamping=i.limitVelocityDamping}i.noiseTexture&&(g.noiseTexture=i.noiseTexture.serialize())}clone(g,i){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n={...this._customWrappers};let L=null;const d=this._engine;if(d.createEffectForParticles&&null!=this.customShader){L=this.customShader;const g=L.shaderOptions.defines.length>0?L.shaderOptions.defines.join("\n"):"",i=d.createEffectForParticles(L.shaderPath.fragmentElement,L.shaderOptions.uniforms,L.shaderOptions.samplers,g);n[0]?n[0].effect=i:this.setCustomEffect(i,0)}const b=this.serialize(a),k=ki.Parse(b,this._scene||this._engine,this._rootUrl);return k.name=g,k.customShader=L,k._customWrappers=n,void 0===i&&(i=this.ni),this.noiseTexture&&(k.noiseTexture=this.noiseTexture.clone()),k.ni=i,this.preventAutoStart||k.start(),k}}ki.BILLBOARDMODE_Y=2,ki.BILLBOARDMODE_ALL=7,ki.BILLBOARDMODE_STRETCHED=8,ki.BILLBOARDMODE_STRETCHED_LOCAL=9,ug._ParseParticleSystem=ki.Parse;var ei=a(12701),Ni=a(12692),Fi=a(12571);Fi.b.prototype.createTransformFeedback=function(){const g=this._gl.createTransformFeedback();if(!g)throw new Error("Unable to create Transform Feedback");return g},Fi.b.prototype.deleteTransformFeedback=function(g){this._gl.deleteTransformFeedback(g)},Fi.b.prototype.bindTransformFeedback=function(g){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,g)},Fi.b.prototype.beginTransformFeedback=function(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(g?this._gl.POINTS:this._gl.TRIANGLES)},Fi.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Fi.b.prototype.setTranformFeedbackVaryings=function(g,i){this._gl.transformFeedbackVaryings(g,i,this._gl.INTERLEAVED_ATTRIBS)},Fi.b.prototype.bindTransformFeedbackBuffer=function(g){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,g?g.underlyingResource:null)},Fi.b.prototype.readTransformFeedbackBuffer=function(g){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,g)};const Ii="clipPlaneFragmentDeclaration2",ji="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";Y.c.IncludesShadersStore[Ii]||(Y.c.IncludesShadersStore[Ii]=ji);a(13766),a(13775),a(13784),a(13786),a(13795),a(13799),a(13803),a(13807);const yi="gpuRenderParticlesPixelShader",Bi="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";Y.c.ShadersStore[yi]||(Y.c.ShadersStore[yi]=Bi);const ci="clipPlaneVertexDeclaration2",Di="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";Y.c.IncludesShadersStore[ci]||(Y.c.IncludesShadersStore[ci]=Di);a(13816),a(13819),a(13822),a(13829);const pi="gpuRenderParticlesVertexShader",Ri="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";Y.c.ShadersStore[pi]||(Y.c.ShadersStore[pi]=Ri);class xi extends e{static get IsSupported(){if(!G.c.LastCreatedEngine)return!1;const g=G.c.LastCreatedEngine.getCaps();return g.supportTransformFeedbacks||g.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(g){this._maxActiveParticleCount=Math.min(g,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(g){this.maxActiveParticleCount=g}createPointEmitter(g,i){const a=Mg(g,i);return this.particleEmitterType=a,a}createHemisphericEmitter(){const g=qg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=g,g}createSphereEmitter(){const g=Wg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=g,g}createDirectedSphereEmitter(){const g=Gg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.Bi(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.Bi(0,1,0));return this.particleEmitterType=g,g}createCylinderEmitter(){const g=Jg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=g,g}createDirectedCylinderEmitter(){const g=gi(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.Bi(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new n.Bi(0,1,0));return this.particleEmitterType=g,g}createConeEmitter(){const g=ii(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=g,g}createDirectedConeEmitter(){const g=ai(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.Bi(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.Bi(0,1,0));return this.particleEmitterType=g,g}createBoxEmitter(g,i,a,n){const L=new I;return this.particleEmitterType=L,this.direction1=g,this.direction2=i,this.minEmitBox=a,this.maxEmitBox=n,L}get flowMap(){return this._flowMap}set flowMap(g){this._flowMap!==g&&(this._flowMap=g)}isReady(){if(!this.ni||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==ki.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(ki.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(ki.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";g?setTimeout((()=>{this.start(0)}),g):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var g;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(g=this._customWrappers[i])||void 0===g?void 0:g.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[g]??this._customWrappers[0]}setCustomEffect(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[i]=new gg.c(this._engine),this._customWrappers[i].effect=g}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new q.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(g,i,a){return super._removeGradientAndTexture(g,i,a),this._releaseBuffers(),this}addColorGradient(g,i){this._colorGradients||(this._colorGradients=[]);const a=new o(g,i);return this._colorGradients.push(a),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(g&&this._colorGradients.sort(((g,i)=>g.gradient<i.gradient?-1:g.gradient>i.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(g){return this._removeGradientAndTexture(g,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const i in this._drawWrappers){var g;null===(g=this._drawWrappers[i].drawContext)||void 0===g||g.reset()}}_addFactorGradient(g,i,a){const n=new H(i,a);g.push(n),this._releaseBuffers()}addSizeGradient(g,i){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,g,i),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(g){return this._removeGradientAndTexture(g,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(g,i){if(!g)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&g.sort(((g,i)=>g.gradient<i.gradient?-1:g.gradient>i.gradient?1:0));const a=this;a[i]&&(a[i].dispose(),a[i]=null)}addAngularSpeedGradient(g,i){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,g,i),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(g){return this._removeGradientAndTexture(g,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(g,i){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,g,i),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(g){return this._removeGradientAndTexture(g,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(g,i){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,g,i),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(g){return this._removeGradientAndTexture(g,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(g,i){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,g,i),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(g){return this._removeGradientAndTexture(g,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(g){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(g,i,a){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(g),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.dd=new q.b,this.onStoppedObservable=new q.b,this.onStartedObservable=new q.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,a&&"Scene"!==a.getClassName()?(this._engine=a,this.defaultProjectionMatrix=n.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=a||G.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Wj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,k.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,k.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,k.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,k.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new gg.c(this._engine)},this._customWrappers[0].effect=L,this._drawWrappers={0:new gg.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(i=i??{}).randomTextureSize||delete i.randomTextureSize;const b={Hk:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...i},e=i;isFinite(e)&&(b.Hk=e),this._capacity=b.Hk,this._maxActiveParticleCount=b.Hk,this._currentActiveCount=0,this._isAnimationSheetEnabled=d,this.particleEmitterType=new I;const N=Math.min(this._engine.getCaps().maxTextureSize,b.randomTextureSize);let F=[];for(let n=0;n<N;++n)F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),F.push(Math.random());this._randomTexture=new W.b(new Float32Array(F),N,1,5,a,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,F=[];for(let n=0;n<N;++n)F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),F.push(Math.random());this._randomTexture2=new W.b(new Float32Array(F),N,1,5,a,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=N}_reset(){this._releaseBuffers()}_createVertexBuffers(g,i,a){const n={};n.position=i.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let L=3;n.age=i.createVertexBuffer("age",L,1,this._attributesStrideSize,!0),L+=1,n.size=i.createVertexBuffer("size",L,3,this._attributesStrideSize,!0),L+=3,n.life=i.createVertexBuffer("life",L,1,this._attributesStrideSize,!0),L+=1,L+=4,this.billboardMode===ki.BILLBOARDMODE_STRETCHED&&(n.direction=i.createVertexBuffer("direction",L,3,this._attributesStrideSize,!0)),L+=3,this._platform.alignDataInBuffer&&(L+=1),this.particleEmitterType instanceof E&&(L+=3,this._platform.alignDataInBuffer&&(L+=1)),this._colorGradientsTexture||(n.color=i.createVertexBuffer("color",L,4,this._attributesStrideSize,!0),L+=4),this._isBillboardBased||(n.initialDirection=i.createVertexBuffer("initialDirection",L,3,this._attributesStrideSize,!0),L+=3,this._platform.alignDataInBuffer&&(L+=1)),this.noiseTexture&&(n.noiseCoordinates1=i.createVertexBuffer("noiseCoordinates1",L,3,this._attributesStrideSize,!0),L+=3,this._platform.alignDataInBuffer&&(L+=1),n.noiseCoordinates2=i.createVertexBuffer("noiseCoordinates2",L,3,this._attributesStrideSize,!0),L+=3,this._platform.alignDataInBuffer&&(L+=1)),n.angle=i.createVertexBuffer("angle",L,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?L++:L+=2,this._isAnimationSheetEnabled&&(n.cellIndex=i.createVertexBuffer("cellIndex",L,1,this._attributesStrideSize,!0),L+=1,this.spriteRandomStartCell&&(n.cellStartOffset=i.createVertexBuffer("cellStartOffset",L,1,this._attributesStrideSize,!0),L+=1)),n.offset=a.createVertexBuffer("offset",0,2),n.uv=a.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(n),this._platform.createVertexBuffers(g,n),this.resetDrawCache()}_initialize(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!g)return;const i=this._engine,a=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof E&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const L=this.particleEmitterType instanceof E,d=n.TmpVectors.Bi[0];let b=0;for(let n=0;n<this._capacity;n++)if(a.push(0),a.push(0),a.push(0),a.push(0),a.push(0),a.push(0),a.push(0),a.push(0),a.push(Math.random()),a.push(Math.random()),a.push(Math.random()),a.push(Math.random()),L?(this.particleEmitterType.particleDestinationGenerator(n,null,d),a.push(d.x),a.push(d.y),a.push(d.z)):(a.push(0),a.push(0),a.push(0)),this._platform.alignDataInBuffer&&a.push(0),b+=16,L&&(this.particleEmitterType.particlePositionGenerator(n,null,d),a.push(d.x),a.push(d.y),a.push(d.z),this._platform.alignDataInBuffer&&a.push(0),b+=4),this._colorGradientsTexture||(a.push(0),a.push(0),a.push(0),a.push(0),b+=4),this.isBillboardBased||(a.push(0),a.push(0),a.push(0),this._platform.alignDataInBuffer&&a.push(0),b+=4),this.noiseTexture&&(a.push(Math.random()),a.push(Math.random()),a.push(Math.random()),this._platform.alignDataInBuffer&&a.push(0),a.push(Math.random()),a.push(Math.random()),a.push(Math.random()),this._platform.alignDataInBuffer&&a.push(0),b+=8),a.push(0),b+=1,this._angularSpeedGradientsTexture||(a.push(0),b+=1),this._isAnimationSheetEnabled&&(a.push(0),b+=1,this.spriteRandomStartCell&&(a.push(0),b+=1)),this._platform.alignDataInBuffer){let g=3-(b+3&3);for(b+=g;g-- >0;)a.push(0)}const k=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),e=this._platform.createParticleBuffer(a),N=this._platform.createParticleBuffer(a);this._buffer0=new X.c(i,e,!1,this._attributesStrideSize),this._buffer1=new X.c(i,N,!1,this._attributesStrideSize),this._spriteBuffer=new X.c(i,k,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let g=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(g+="\n#define BILLBOARD"),this._colorGradientsTexture&&(g+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(g+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(g+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(g+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(g+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(g+="\n#define DRAGGRADIENTS"),this._flowMap&&(g+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(g+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(g+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(g+="\n#define NOISE"),this.isLocal&&(g+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===g||(this._cachedUpdateDefines=g,this._updateBuffer=this._platform.createUpdateBuffer(g)),this._platform.isUpdateBufferReady()}_getWrapper(g){const i=this._getCustomDrawWrapper(g);if(null!==i&&void 0!==i&&i.effect)return i;const a=[];this.fillDefines(a,g);let n=this._drawWrappers[g];n||(n=new gg.c(this._engine),n.drawContext&&(n.drawContext.useInstancing=!0),this._drawWrappers[g]=n);const L=a.join("\n");if(n.defines!==L){const g=[],i=[],a=[];this.fillUniformsAttributesAndSamplerNames(i,g,a),n.setEffect(this._engine.createEffect("gpuRenderParticles",g,i,a,L),L)}return n}static _GetAttributeNamesOrOptions(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const L=[X.g.PositionKind,"age","life","size","angle"];return g||L.push(X.g.ColorKind),i&&L.push("cellIndex"),a||L.push("initialDirection"),n&&L.push("direction"),L.push("offset",X.g.UVKind),L}static _GetEffectCreationOptions(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=["emitterWM","cF","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,ig.e)(n),g&&n.push("sheetInfos"),i&&n.push("logarithmicDepthConstant"),a&&(n.push("vFogInfos"),n.push("vFogColor")),n}fillDefines(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,ig.n)(this,this._scene,g),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Ni.e.FOGMODE_NONE&&g.push("#define FOG")),i===ki.BLENDMODE_MULTIPLY&&g.push("#define BLENDMULTIPLYMODE"),this.isLocal&&g.push("#define LOCAL"),this.useLogarithmicDepth&&g.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(g.push("#define BILLBOARD"),this.billboardMode){case ki.BILLBOARDMODE_Y:g.push("#define BILLBOARDY");break;case ki.BILLBOARDMODE_STRETCHED:g.push("#define BILLBOARDSTRETCHED");break;case ki.BILLBOARDMODE_ALL:g.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&g.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&g.push("#define ANIMATESHEET"),a&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),g.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(g,i,a){i.push(...xi._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===ki.BILLBOARDMODE_STRETCHED)),g.push(...xi._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),a.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(ei.c.PrepareUniforms(g,this._imageProcessingConfigurationDefines),ei.c.PrepareSamplers(a,this._imageProcessingConfigurationDefines))}animate(){var g;let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(i?this.preWarmStepOffset:(null===(g=this._scene)||void 0===g?void 0:g.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(g,i){const a=this[i];if(!g||!g.length||a)return;const n=new Float32Array(this._rawTextureWidth);for(let L=0;L<this._rawTextureWidth;L++){const i=L/this._rawTextureWidth;M.GetCurrentGradient(i,g,((g,i,a)=>{n[L]=(0,N.Lerp)(g.factor1,i.factor1,a)}))}this[i]=W.b.CreateRTexture(n,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[i].name=i.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const g=new Uint8Array(4*this._rawTextureWidth),i=b.TmpColors.Hd[0];for(let a=0;a<this._rawTextureWidth;a++){const n=a/this._rawTextureWidth;M.GetCurrentGradient(n,this._colorGradients,((n,L,d)=>{b.Hd.LerpToRef(n.color1,L.color1,d,i),g[4*a]=255*i.r,g[4*a+1]=255*i.g,g[4*a+2]=255*i.b,g[4*a+3]=255*i.a}))}this._colorGradientsTexture=W.b.CreateRGBATexture(g,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(g,i){var a,L,d,b;const k=this._getWrapper(g),e=k.effect;this._engine.enableEffect(k);const N=(null===(a=this._scene)||void 0===a?void 0:a.getViewMatrix())||n.Matrix.IdentityReadOnly;if(e.setMatrix("view",N),e.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),e.setTexture("diffuseSampler",this.particleTexture),e.setVector2("translationPivot",this.translationPivot),e.setVector3("cF",this.cF),this.isLocal&&e.setMatrix("emitterWM",i),this._colorGradientsTexture?e.setTexture("colorGradientSampler",this._colorGradientsTexture):e.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const g=this.particleTexture.getBaseSize();e.setFloat3("sheetInfos",this.spriteCellWidth/g.width,this.spriteCellHeight/g.height,g.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const g=this._scene.activeCamera;e.setVector3("eyePosition",g.globalPosition)}const F=e.defines;if(this._scene&&((0,ig.i)(e,this,this._scene),this.applyFog&&(0,ag.d)(this._scene,void 0,e)),F.indexOf("#define BILLBOARDMODE_ALL")>=0){const g=N.clone();g.invert(),e.setMatrix("invView",g)}return this.useLogarithmicDepth&&this._scene&&(0,ag.j)(F,e,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(e),this._setEngineBasedOnBlendMode(g),this._platform.bindDrawBuffers(this._targetIndex,e,null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(e),null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(b=this._scene)&&void 0!==b&&b.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(g){if(!this.ni||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!g)if(this.ni.position){g=this.ni.getWorldMatrix()}else{const i=this.ni;g=n.TmpVectors.Matrix[0],n.Matrix.TranslationToRef(i.x,i.y,i.z,g)}const i=this._engine,a=i.getDepthWrite();if(i.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const g=this.Pg();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",g.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",g),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const L=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=L,i.setDepthWrite(a)}render(){let g,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!i&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let g=0;g<this.preWarmCycles;g++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const g=0|this._accumulatedCount;this._accumulatedCount-=g,this._currentActiveCount+=g}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.ni.position){g=this.ni.getWorldMatrix()}else{const i=this.ni;g=n.TmpVectors.Matrix[0],n.Matrix.TranslationToRef(i.x,i.y,i.z,g)}const L=this._engine;this.updateInAnimate||this._update(g);let d=0;return i||a||(L.setState(!1),this.forceDepthWrite&&L.setDepthWrite(!0),d=this.blendMode===ki.BLENDMODE_MULTIPLYADD?this._render(ki.BLENDMODE_MULTIPLY,g)+this._render(ki.BLENDMODE_ADD,g):this._render(this.blendMode,g),this._engine.setAlphaMode(0)),d}rebuild(){const g=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(g,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,g()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const i in this._drawWrappers){this._drawWrappers[i].dispose()}if(this._drawWrappers={},this._scene){const g=this._scene.Wj.indexOf(this);g>-1&&this._scene.Wj.splice(g,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let i=0;i<this._renderVertexBuffers.length;++i){const g=this._renderVertexBuffers[i];for(const i in g)g[i].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),g&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),g&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.dd.notifyObservers(this),this.dd.clear()}clone(g,i){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n={...this._customWrappers};let L=null;const d=this._engine;if(d.createEffectForParticles&&null!=this.customShader){L=this.customShader;const g=L.shaderOptions.defines.length>0?L.shaderOptions.defines.join("\n"):"";n[0]=d.createEffectForParticles(L.shaderPath.fragmentElement,L.shaderOptions.uniforms,L.shaderOptions.samplers,g,void 0,void 0,void 0,this)}const b=this.serialize(a),k=xi.Parse(b,this._scene||this._engine,this._rootUrl);return k.name=g,k.customShader=L,k._customWrappers=n,void 0===i&&(i=this.ni),this.noiseTexture&&(k.noiseTexture=this.noiseTexture.clone()),k.ni=i,k}serialize(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const i={};return ki._Serialize(i,this,g),i.activeParticleCount=this.activeParticleCount,i.randomTextureSize=this._randomTextureSize,i.customShader=this.customShader,i}static Parse(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0;const d=g.name;let b,k;i instanceof Hg.d?b=i:(k=i,b=k.getEngine());const e=new xi(d,{Hk:L||g.Hk,randomTextureSize:g.randomTextureSize},i,null,g.isAnimationSheetEnabled);if(e._rootUrl=a,g.customShader&&b.createEffectForParticles){const i=g.customShader,a=i.shaderOptions.defines.length>0?i.shaderOptions.defines.join("\n"):"",n=b.createEffectForParticles(i.shaderPath.fragmentElement,i.shaderOptions.uniforms,i.shaderOptions.samplers,a,void 0,void 0,void 0,e);e.setCustomEffect(n,0),e.customShader=i}return g.id&&(e.id=g.id),g.activeParticleCount&&(e.activeParticleCount=g.activeParticleCount),ki._Parse(g,e,i,a),g.preventAutoStart&&(e.preventAutoStart=g.preventAutoStart),n||e.preventAutoStart||e.start(),e}}var Ei=a(12277),Xi=a(13836),vi=a(12831);class Pi{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(g){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const i of this.systems)i.ni=g;this._emitterNode=g}setEmitterAsSphere(g,i,a){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:g,renderingGroupId:i};const n=(0,Xi.d)("emitterSphere",{diameter:g.diameter,segments:g.segments},a);n.renderingGroupId=i;const L=new vi.pi("emitterSphereMaterial",a);L.emissiveColor=g.color,n.material=L;for(const d of this.systems)d.ni=n;this._emitterNode=n}start(g){for(const i of this.systems)g&&(i.ni=g),i.start()}dispose(){for(const g of this.systems)g.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const i={systems:[]};for(const a of this.systems)i.systems.push(a.serialize(g));return this._emitterNode&&(i.ni=this._emitterCreationOptions),i}static Parse(g,i){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;const L=new Pi,d=this.BaseAssetsUrl+"/textures/";i=i||G.c.LastCreatedScene;for(const b of g.systems)L.systems.push(a?xi.Parse(b,i,d,!0,n):ki.Parse(b,i,d,!0,n));if(g.ni){const a=g.ni.options;if("Sphere"===g.ni.kind)L.setEmitterAsSphere({diameter:a.diameter,segments:a.segments,color:b.Ri.xi(a.color)},g.ni.renderingGroupId,i)}return L}}Pi.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Yi=a(12308);class fi{static CreateDefault(g){let i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=arguments.length>2?arguments[2]:void 0;i=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new xi("default system",{Hk:a},n):new ki("default system",a,n),i.ni=g;const L=Ei.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return i.particleTexture=new Z.c(L,i.Pg()),i.createConeEmitter(.1,Math.PI/4),i.color1=new b.Hd(1,1,1,1),i.color2=new b.Hd(1,1,1,1),i.colorDead=new b.Hd(1,1,1,0),i.minSize=.1,i.maxSize=.1,i.minEmitPower=2,i.maxEmitPower=2,i.updateSpeed=1/60,i.emitRate=30,i}static CreateAsync(g,i){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;i||(i=G.c.LastCreatedScene);const L={};return i.addPendingData(L),new Promise(((d,b)=>{if(a&&!xi.IsSupported)return i.removePendingData(L),b("Particle system with GPU is not supported.");Ei.Tools.LoadFile(`${fi.BaseAssetsUrl}/systems/${g}.json`,(g=>{i.removePendingData(L);const b=JSON.parse(g.toString());return d(Pi.Parse(b,i,a,n))}),void 0,void 0,void 0,(()=>(i.removePendingData(L),b(`An error occurred with the creation of your particle system. Check if your type '${g}' exists.`))))}))}static ExportSet(g){const i=new Pi;for(const a of g)i.systems.push(a);return i}static ParseFromFileAsync(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",d=arguments.length>5?arguments[5]:void 0;return new Promise(((b,k)=>{const e=new Yi.d;e.addEventListener("readystatechange",(()=>{if(4==e.readyState)if(200==e.status){const i=JSON.parse(e.responseText);let k;k=n?xi.Parse(i,a,L,!1,d):ki.Parse(i,a,L,!1,d),g&&(k.name=g),b(k)}else k("Unable to load the particle system")})),e.open("GET",i),e.send()}))}static ParseFromSnippetAsync(g,i){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",L=arguments.length>4?arguments[4]:void 0;if("_BLANK"===g){const g=this.CreateDefault(null);return g.start(),Promise.resolve(g)}return new Promise(((d,b)=>{const k=new Yi.d;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){const b=JSON.parse(JSON.parse(k.responseText).jsonPayload),e=JSON.parse(b.particleSystem);let N;N=a?xi.Parse(e,i,n,!1,L):ki.Parse(e,i,n,!1,L),N.snippetId=g,d(N)}else b("Unable to load the snippet "+g)})),k.open("GET",this.SnippetUrl+"/"+g.replace(/#/g,"/")),k.send()}))}}fi.BaseAssetsUrl=Pi.BaseAssetsUrl,fi.SnippetUrl="https://snippet.babylonjs.com",fi.CreateFromSnippetAsync=fi.ParseFromSnippetAsync;var Ci=a(12910),Ui=a(12731),Si=a(13838);(0,Si.h)(Ui.b.NAME_PARTICLESYSTEM,((g,i,a,n)=>{const L=(0,Si.i)(Ui.b.NAME_PARTICLESYSTEM);if(L&&void 0!==g.Wj&&null!==g.Wj)for(let d=0,b=g.Wj.length;d<b;d++){const b=g.Wj[d];a.Wj.push(L(b,i,n))}})),(0,Si.e)(Ui.b.NAME_PARTICLESYSTEM,((g,i,a)=>{if(g.activeParticleCount){return xi.Parse(g,i,a)}return ki.Parse(g,i,a)})),Hg.d.prototype.createEffectForParticles=function(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",d=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0,e=arguments.length>7?arguments[7]:void 0,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,F=arguments.length>9?arguments[9]:void 0,I=[],j=[];const y=[];return e?e.fillUniformsAttributesAndSamplerNames(j,I,y):(I=ki._GetAttributeNamesOrOptions(),j=ki._GetEffectCreationOptions()),-1===L.indexOf(" BILLBOARD")&&(L+="\n#define BILLBOARD\n"),null!==e&&void 0!==e&&e.isAnimationSheetEnabled&&-1===L.indexOf(" ANIMATESHEET")&&(L+="\n#define ANIMATESHEET\n"),-1===n.indexOf("diffuseSampler")&&n.push("diffuseSampler"),this.createEffect({vertex:F??(null===e||void 0===e?void 0:e.vertexShaderName)??"particles",fragmentElement:g},I,j.concat(i),y.concat(n),L,d,b,k,void 0,N,(async()=>{0===N?await Promise.resolve().then(a.bind(a,13881)):await Promise.resolve().then(a.bind(a,13950))}))},Ci.e.prototype.getEmittedParticleSystems=function(){const g=[];for(let i=0;i<this.Pg().Wj.length;i++){const a=this.Pg().Wj[i];a.ni===this&&g.push(a)}return g},Ci.e.prototype.getHierarchyEmittedParticleSystems=function(){const g=[],i=this.getDescendants();i.push(this);for(let a=0;a<this.Pg().Wj.length;a++){const n=this.Pg().Wj[a],L=n.ni;L.position&&-1!==i.indexOf(L)&&g.push(n)}return g};a(12791),a(12809),a(12894);a(12896),a(13844),a(12655),a(12784),a(12935);a(12650);var Vi;a(13853),a(12475);!function(g){g[g.Color=2]="Color",g[g.UV=1]="UV",g[g.Random=0]="Random",g[g.Stated=3]="Stated"}(Vi||(Vi={}));var Ki=a(12684);const Ti=new n.Bi(0,0,0),li=new n.Bi(0,0,0),Zi=new n.Bi(0,0,0);class hi{constructor(g,i,a){this.width=g,this.height=i,this.data=a}processFlowable(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0;if(!a)return;a instanceof n.Matrix?n.Bi.TransformCoordinatesToRef(g.position,a,Zi):(Zi.x=a.x,Zi.y=a.y,Zi.z=a.z);const L=.5*Zi.x+.5,d=1-(.5*Zi.y+.5),b=Math.floor(L*this.width),k=Math.floor(d*this.height);if(b<0||b>=this.width||k<0||k>=this.height)return;const e=4*(k*this.width+b),N=this.data[e]/255*2-1,F=this.data[e+1]/255*2-1,I=this.data[e+2]/255*2-1,j=this.data[e+3]/255;Ti.set(N,F,I),Ti.scaleToRef(i*j,li),g.direction.addInPlace(li)}_processParticle(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0;this.processFlowable(g,i,a)}static async FromUrlAsync(g){return await new Promise(((i,a)=>{const n=document.createElement("canvas"),L=n.getContext("2d");let d=null;const b=new Image;b.crossOrigin="anonymous",b.src=g,b.onerror=i=>{a(new Error(`Failed to load image: ${g} : ${i}`))},b.onload=()=>{n.width=b.width,n.height=b.height,L.drawImage(b,0,0),d=L.getImageData(0,0,n.width,n.height),i(new hi(n.width,n.height,d.data))}}))}static async ExtractFromTextureAsync(g){return await new Promise(((i,a)=>{if(!g.isReady())return void g.onLoadObservable.addOnce((async()=>{try{const a=await this.ExtractFromTextureAsync(g);i(a)}catch(n){a(n)}}));const n=g.getSize();Ki.m.GetTextureDataAsync(g,n.width,n.height).then((g=>{i(new hi(n.width,n.height,new Uint8ClampedArray(g)))})).catch(a)}))}}var wi,ti,Ai,Oi,zi,si,ma,ri,Qi;!function(g){g[g.Int=1]="Int",g[g.Float=2]="Float",g[g.Vector2=4]="Vector2",g[g.Bi=8]="Bi",g[g.Matrix=16]="Matrix",g[g.Particle=32]="Particle",g[g.Texture=64]="Texture",g[g.Hd=128]="Hd",g[g.FloatGradient=256]="FloatGradient",g[g.Vector2Gradient=512]="Vector2Gradient",g[g.Vector3Gradient=1024]="Vector3Gradient",g[g.Color4Gradient=2048]="Color4Gradient",g[g.System=4096]="System",g[g.AutoDetect=8192]="AutoDetect",g[g.BasedOnInput=16384]="BasedOnInput",g[g.Undefined=32768]="Undefined",g[g.All=65535]="All"}(wi||(wi={})),function(g){g[g.Compatible=0]="Compatible",g[g.TypeIncompatible=1]="TypeIncompatible",g[g.HierarchyIssue=2]="HierarchyIssue"}(ti||(ti={})),function(g){g[g.Input=0]="Input",g[g.Output=1]="Output"}(Ai||(Ai={}));class oi{get direction(){return this._direction}get type(){if(this._type===wi.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===wi.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(g){this._type=g}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((g=>g.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(g,i,a){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=wi.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new q.b,this.onDisconnectionObservable=new q.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=i,this.name=g,this._direction=a}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(g){var i;return this.isConnected?null!==(i=this._connectedPoint)&&void 0!==i&&i._storedFunction?this._connectedPoint._storedFunction(g):this._connectedPoint._storedValue:this.value}canConnectTo(g){return 0===this.checkCompatibilityState(g)}checkCompatibilityState(g){const i=this._ownerBlock,a=g.ownerBlock;if(this.type!==g.type&&g.innerType!==wi.AutoDetect)return g.acceptedConnectionPointTypes&&-1!==g.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(g.excludedConnectionPointTypes&&-1!==g.excludedConnectionPointTypes.indexOf(this.type))return 1;let n=a,L=i;return 0===this.direction&&(n=i,L=a),n.isAnAncestorOf(L)?2:0}connectTo(g){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(g))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${g.ownerBlock.name}".${g.name}`;return this._endpoints.push(g),g._connectedPoint=this,this.onConnectionObservable.notifyObservers(g),g.onConnectionObservable.notifyObservers(this),this}disconnectFrom(g){const i=this._endpoints.indexOf(g);return-1===i||(this._endpoints.splice(i,1),g._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(g),g.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(g){let i=1;for(;i<wi.All;)g&i||this.excludedConnectionPointTypes.push(i),i<<=1}serialize(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const i={};return i.name=this.name,i.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.fd?(i.valueType="BABYLON."+this.value.getClassName(),i.value=this.value.fd()):(i.valueType="number",i.value=this.value)),g&&this.connectedPoint&&(i.inputName=this.name,i.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,i.targetConnectionName=this.connectedPoint.name,i.isExposedOnFrame=!0,i.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(i.isExposedOnFrame=!0,i.exposedPortPosition=this.exposedPortPosition),i}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class ui{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(g){this._name=g}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(g){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new q.b,this.dd=new q.b,this.onInputChangedObservable=new q.b,this.visibleOnFrame=!1,this._name=g,this.uniqueId=h.c.UniqueId}_inputRename(g){return g}_outputRename(g){return g}isAnAncestorOf(g){for(const i of this._outputs)if(i.hasEndpoints)for(const a of i.endpoints){if(a.ownerBlock===g)return!0;if(a.ownerBlock.isAnAncestorOf(g))return!0}return!1}isAnAncestorOfType(g){if(this.getClassName()===g)return!0;for(const i of this._outputs)if(i.hasEndpoints)for(const a of i.endpoints)if(a.ownerBlock.isAnAncestorOfType(g))return!0;return!1}getInputByName(g){const i=this._inputs.filter((i=>i.name===g));return i.length?i[0]:null}_linkConnectionTypes(g,i){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[i]._acceptedConnectionPointType=this._inputs[g]:(this._inputs[g]._linkedConnectionSource=this._inputs[i],this._inputs[g]._isMainLinkSource=!0),this._inputs[i]._linkedConnectionSource=this._inputs[g]}registerInput(g,i){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0;const b=new oi(g,this,0);return b.type=i,b.isOptional=a,b.defaultValue=n,b.value=n,b.valueMin=L,b.valueMax=d,this._inputs.push(b),this.onInputChangedObservable.notifyObservers(b),this}registerOutput(g,i,a){return(a=a??new oi(g,this,1)).type=i,this._outputs.push(a),this}_build(g){}_customBuildStep(g){}build(g){if(this._buildId===g.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((g=>g.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=g.buildId;for(const i of this._inputs){if(!i.connectedPoint){i.isOptional||g.notConnectedNonOptionalInputs.push(i);continue}const a=i.connectedPoint.ownerBlock;a&&a!==this&&!a.isSystem&&a.build(g)}return this._customBuildStep(g),g.verbose&&w.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(g),this.onBuildObservable.notifyObservers(this),!1}serialize(){const g={};g.customType="BABYLON."+this.getClassName(),g.id=this.uniqueId,g.name=this.name,g.visibleOnFrame=this.visibleOnFrame,g.inputs=[],g.outputs=[];for(const i of this.inputs)g.inputs.push(i.serialize());for(const i of this.outputs)g.outputs.push(i.serialize(!1));return g}_deserialize(g){this._name=g.name,this.comments=g.comments,this.visibleOnFrame=!!g.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(g)}_deserializePortDisplayNamesAndExposedOnFrame(g){const i=g.inputs,a=g.outputs;if(i)for(const n of i){const g=this.inputs.find((g=>g.name===n.name));if(!g)return;if(n.displayName&&(g.displayName=n.displayName),n.isExposedOnFrame&&(g.isExposedOnFrame=n.isExposedOnFrame,g.exposedPortPosition=n.exposedPortPosition),void 0!==n.value&&null!==n.value)if("number"===n.valueType)g.value=n.value;else{const i=(0,k.d)(n.valueType);i&&(g.value=i.xi(n.value))}}if(a)for(let n=0;n<a.length;n++){const g=a[n];g.displayName&&(this.outputs[n].displayName=g.displayName),g.isExposedOnFrame&&(this.outputs[n].isExposedOnFrame=g.isExposedOnFrame,this.outputs[n].exposedPortPosition=g.exposedPortPosition)}}clone(){const g=this.serialize(),i=(0,k.d)(g.customType);if(i){const a=new i;return a._deserialize(g),a}return null}dispose(){this.dd.notifyObservers(this),this.dd.clear();for(const g of this.inputs)g.dispose();for(const g of this.outputs)g.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Hi(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",n=arguments.length>3?arguments[3]:void 0;return(L,d)=>{let b=L._propStore;b||(b=[],L._propStore=b),b.push({propertyName:d,displayName:g,type:i,groupName:a,options:n??{},className:L.getClassName()})}}(0,K.e)([(0,T.P)("comment")],ui.prototype,"comments",void 0),function(g){g[g.Boolean=0]="Boolean",g[g.Float=1]="Float",g[g.Int=2]="Int",g[g.Vector2=3]="Vector2",g[g.List=4]="List",g[g.Hd=5]="Hd",g[g.SamplingMode=6]="SamplingMode",g[g.TextureFormat=7]="TextureFormat",g[g.TextureType=8]="TextureType"}(Oi||(Oi={})),function(g){g[g.None=0]="None",g[g.Position=1]="Position",g[g.Direction=2]="Direction",g[g.Age=3]="Age",g[g.Lifetime=4]="Lifetime",g[g.Color=5]="Color",g[g.ScaledDirection=6]="ScaledDirection",g[g.Scale=7]="Scale",g[g.AgeGradient=8]="AgeGradient",g[g.Angle=9]="Angle",g[g.SpriteCellIndex=16]="SpriteCellIndex",g[g.SpriteCellStart=17]="SpriteCellStart",g[g.SpriteCellEnd=18]="SpriteCellEnd"}(zi||(zi={})),function(g){g[g.None=0]="None",g[g.Time=1]="Time",g[g.Delta=2]="Delta",g[g.Emitter=3]="Emitter"}(si||(si={}));class Mi{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let g="";for(const i of this.notConnectedNonOptionalInputs)g+=`input ${i.name} from block ${i.ownerBlock.name}[${i.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(g)throw"Build of Node Particle System Set failed:\n"+g}adapt(g,i){const a=g.getConnectedValue(this)||0;if(g.type===i)return a;switch(i){case wi.Vector2:return new n.Vector2(a,a);case wi.Bi:return new n.Bi(a,a,a);case wi.Hd:return new b.Hd(a,a,a,a)}return null}getContextualValue(g){if(!this.particleContext||!this.systemContext)return null;switch(g){case zi.Position:return this.particleContext.position;case zi.Direction:return this.particleContext.direction;case zi.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case zi.Color:return this.particleContext.color;case zi.Age:return this.particleContext.age;case zi.Lifetime:return this.particleContext.lifeTime;case zi.Angle:return this.particleContext.angle;case zi.Scale:return this.particleContext.scale;case zi.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case zi.SpriteCellEnd:return this.systemContext.endSpriteCellID;case zi.SpriteCellIndex:return this.particleContext.cellIndex;case zi.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.ni.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.ni.absolutePosition:this.systemContext.ni:null}getSystemValue(g){if(!this.particleContext||!this.systemContext)return null;switch(g){case si.Time:return this.systemContext._actualFrame;case si.Delta:return this.systemContext._scaledUpdateSpeed;case si.Emitter:if(this.isEmitterTransformNode){return this.systemContext.ni.absolutePosition}return this.systemContext.ni}return null}}function qi(g,i,a){const n=new Mi;n.Di=i;const L=g.createSystem(n);return L.canStart=()=>!0,L.ni=a.clone(),L.disposeOnStop=!0,L.start(),L}class Wi extends ui{constructor(g){super(g),this.blendMode=e.BLENDMODE_ONEONE,this.Hk=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",wi.Particle),this.registerInput("texture",wi.Texture),this.registerInput("onStart",wi.System,!0),this.registerInput("onEnd",wi.System,!0),this.registerOutput("system",wi.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(g){g.Hk=this.Hk,g.buildId=this._buildId++,this.build(g);const i=this.particle.getConnectedValue(g);return i.particleTexture=this.texture.getConnectedValue(g),i.emitRate=this.emitRate,i.blendMode=this.blendMode,i.name=this.name,i._nodeGenerated=!0,i._targetStopDuration=this.targetStopDuration,i.startDelay=this.startDelay,this.system._storedValue=this,i.canStart=()=>!this.doNoStart,i.onStartedObservable.add((a=>{const n=this.onStart.getConnectedValue(g);n&&a.onStartedObservable.addOnce((()=>{g.systemContext=i;const a=qi(n,g.Di,g.emitterPosition);this.dd.addOnce((()=>{a.dispose()}))}));const L=this.onEnd.getConnectedValue(g);L&&a.onStoppedObservable.addOnce((()=>{g.systemContext=i;const a=qi(L,g.Di,g.emitterPosition);this.dd.addOnce((()=>{a.dispose()}))}))})),this.dd.addOnce((()=>{i.dispose()})),i}serialize(){const g=super.serialize();return g.Hk=this.Hk,g.emitRate=this.emitRate,g.blendMode=this.blendMode,g.doNoStart=this.doNoStart,g.targetStopDuration=this.targetStopDuration,g.startDelay=this.startDelay,g}_deserialize(g){super._deserialize(g),this.Hk=g.Hk,this.emitRate=g.emitRate,this.doNoStart=!!g.doNoStart,void 0!==g.blendMode&&(this.blendMode=g.blendMode),void 0!==g.targetStopDuration&&(this.targetStopDuration=g.targetStopDuration),void 0!==g.startDelay&&(this.startDelay=g.startDelay)}}(0,K.e)([Hi("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:e.BLENDMODE_ONEONE},{label:"Standard",value:e.BLENDMODE_STANDARD},{label:"Add",value:e.BLENDMODE_ADD},{label:"Multiply",value:e.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:e.BLENDMODE_MULTIPLYADD}]})],Wi.prototype,"blendMode",void 0),(0,K.e)([Hi("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Wi.prototype,"Hk",void 0),(0,K.e)([Hi("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Wi.prototype,"emitRate",void 0),(0,K.e)([Hi("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Wi.prototype,"targetStopDuration",void 0),(0,K.e)([Hi("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Wi.prototype,"startDelay",void 0),(0,K.e)([Hi("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Wi.prototype,"doNoStart",void 0),(0,k.e)("BABYLON.SystemBlock",Wi);class Gi extends ui{get type(){if(this._type===wi.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=wi.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=wi.Vector2,this._type;case"Bi":return this._type=wi.Bi,this._type;case"Hd":return this._type=wi.Hd,this._type;case"Matrix":return this._type=wi.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===zi.None&&this._systemSource!==si.None}get systemSource(){return this._systemSource}set systemSource(g){if(this._systemSource=g,g!==si.None){switch(this._contextualSource=zi.None,this._type=wi.Float,g){case si.Time:case si.Delta:this._type=wi.Float;break;case si.Emitter:this._type=wi.Bi}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==zi.None}get contextualValue(){return this._contextualSource}set contextualValue(g){if(this._contextualSource=g,g!==zi.None){switch(this._systemSource=si.None,g){case zi.Scale:this._type=wi.Vector2;break;case zi.Position:case zi.Direction:case zi.ScaledDirection:this._type=wi.Bi;break;case zi.Color:this._type=wi.Hd;break;case zi.Age:case zi.Lifetime:case zi.Angle:case zi.AgeGradient:this._type=wi.Float;break;case zi.SpriteCellEnd:case zi.SpriteCellStart:case zi.SpriteCellIndex:this._type=wi.Int}this.output&&(this.output.type=this._type)}}constructor(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wi.AutoDetect;super(g),this._type=wi.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new q.b,this._systemSource=si.None,this._contextualSource=zi.None,this._type=i,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",i)}get value(){return this._storedValue}set value(g){this.type===wi.Float&&this.min!==this.max&&(g=Math.max(this.min,g),g=Math.min(this.max,g)),this._storedValue=g,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(g){this._valueCallback=g}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case wi.Int:case wi.Float:this.value=0;break;case wi.Vector2:this.value=n.Vector2.Zero();break;case wi.Bi:this.value=n.Bi.Zero();break;case wi.Hd:this.value=new b.Hd(1,1,1,1);break;case wi.Matrix:this.value=n.Matrix.Identity()}}_build(g){super._build(g),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=g=>g.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=g=>g.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const g=super.serialize();return g.type=this.type,g.contextualValue=this.contextualValue,g.systemSource=this.systemSource,g.min=this.min,g.max=this.max,g.groupInInspector=this.groupInInspector,g.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.fd?(g.valueType="BABYLON."+this._storedValue.getClassName(),g.value=this._storedValue.fd()):(g.valueType="number",g.value=this._storedValue)),g}_deserialize(g){if(super._deserialize(g),this._type=g.type,this.contextualValue=g.contextualValue,this.systemSource=g.systemSource||si.None,this.min=g.min||0,this.max=g.max||0,this.groupInInspector=g.groupInInspector||"",void 0!==g.displayInInspector&&(this.displayInInspector=g.displayInInspector),g.valueType)if("number"===g.valueType)this._storedValue=g.value;else{const i=(0,k.d)(g.valueType);i&&(this._storedValue=i.xi(g.value))}}}(0,k.e)("BABYLON.ParticleInputBlock",Gi);class Ji extends ui{get url(){return this._url}set url(g){this._url!==g&&(this._cachedData=null,this._url=g,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(g){this._textureDataUrl!==g&&(this._cachedData=null,this._textureDataUrl=g,this._url="",this._sourceTexture=null)}set sourceTexture(g){this._sourceTexture!==g&&(this._cachedData=null,this._sourceTexture=g,this._url="",this._textureDataUrl="")}constructor(g){super(g),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",wi.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const g=this.texture._storedValue;return await new Promise(((i,a)=>{if(!g.isReady())return void g.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),i(this._cachedData)}catch(g){a(g)}}));const n=g.getSize();Ki.m.GetTextureDataAsync(g,n.width,n.height).then((a=>{this._cachedData={width:n.width,height:n.height,data:new Uint8ClampedArray(a)},g.dispose(),i(this._cachedData)})).catch(a)}))}_build(g){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new Z.c(this._textureDataUrl,g.Di):this.texture._storedValue=new Z.c(this._url,g.Di):this.texture._storedValue=null}serialize(){const g=super.serialize();return g.url=this.url,g.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(g.textureDataUrl=this.textureDataUrl),g}_deserialize(g){super._deserialize(g),this.url=g.url,this.serializedCachedData=!!g.serializedCachedData,g.textureDataUrl&&(this.textureDataUrl=g.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,k.e)("BABYLON.ParticleTextureSourceBlock",Ji);class ga extends ui{constructor(g){super(g),this.registerInput("particle",wi.Particle),this.registerInput("position",wi.Bi),this.registerOutput("output",wi.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(g){const i=this.particle.getConnectedValue(g);if(this.output._storedValue=i,!this.position.isConnected)return;const a={process:a=>{g.particleContext=a,g.systemContext=i,a.position.I(this.position.getConnectedValue(g))},previousItem:null,nextItem:null};i._updateQueueStart?sg(a,i._updateQueueStart):i._updateQueueStart=a}}(0,k.e)("BABYLON.UpdatePositionBlock",ga),function(g){g[g.Add=0]="Add",g[g.Subtract=1]="Subtract",g[g.Multiply=2]="Multiply",g[g.Divide=3]="Divide",g[g.Max=4]="Max",g[g.Min=5]="Min"}(ma||(ma={}));class ia extends ui{constructor(g){super(g),this.operation=ma.Add,this.registerInput("left",wi.AutoDetect),this.registerInput("right",wi.AutoDetect),this.registerOutput("output",wi.BasedOnInput),this.output._typeConnectionSource=this.left;const i=[wi.Matrix,wi.Particle,wi.Texture,wi.System,wi.FloatGradient,wi.Color4Gradient,wi.Vector2Gradient,wi.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...i),this.right.excludedConnectionPointTypes.push(...i),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(g){let i;const a=this.left,L=this.right;if(!a.isConnected||!L.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const d=a.type===wi.Float||a.type===wi.Int,k=L.type===wi.Float||L.type===wi.Int,e=d&&k;switch(this.operation){case ma.Add:i=e?g=>a.getConnectedValue(g)+L.getConnectedValue(g):d?g=>g.adapt(a,L.type).add(L.getConnectedValue(g)):g=>a.getConnectedValue(g).add(g.adapt(L,a.type));break;case ma.Subtract:i=e?g=>a.getConnectedValue(g)-L.getConnectedValue(g):d?g=>g.adapt(a,L.type).ci(L.getConnectedValue(g)):g=>a.getConnectedValue(g).ci(g.adapt(L,a.type));break;case ma.Multiply:i=e?g=>a.getConnectedValue(g)*L.getConnectedValue(g):d?g=>g.adapt(a,L.type).multiply(L.getConnectedValue(g)):g=>a.getConnectedValue(g).multiply(g.adapt(L,a.type));break;case ma.Divide:i=e?g=>a.getConnectedValue(g)/L.getConnectedValue(g):d?g=>g.adapt(a,L.type).divide(L.getConnectedValue(g)):g=>a.getConnectedValue(g).divide(g.adapt(L,a.type));break;case ma.Min:if(e)i=g=>Math.min(a.getConnectedValue(g),L.getConnectedValue(g));else{const[g,k]=d?[L,a]:[a,L];switch(g.type){case wi.Vector2:i=i=>n.Vector2.Minimize(g.getConnectedValue(i),i.adapt(k,g.type));break;case wi.Bi:i=i=>n.Bi.Minimize(g.getConnectedValue(i),i.adapt(k,g.type));break;case wi.Hd:i=i=>{const a=g.getConnectedValue(i),{r:n,g:L,b:d,a:e}=i.adapt(k,g.type);return new b.Hd(Math.min(a.r,n),Math.min(a.g,L),Math.min(a.b,d),Math.min(a.a,e))}}}break;case ma.Max:if(!e){const[g,k]=d?[L,a]:[a,L];switch(g.type){case wi.Vector2:i=i=>n.Vector2.Maximize(g.getConnectedValue(i),i.adapt(k,g.type));break;case wi.Bi:i=i=>n.Bi.Maximize(g.getConnectedValue(i),i.adapt(k,g.type));break;case wi.Hd:i=i=>{const a=g.getConnectedValue(i),{r:n,g:L,b:d,a:e}=i.adapt(k,g.type);return new b.Hd(Math.max(a.r,n),Math.min(a.g,L),Math.min(a.b,d),Math.min(a.a,e))}}break}i=g=>Math.max(a.getConnectedValue(g),L.getConnectedValue(g))}this.output._storedFunction=g=>a.type===wi.Int?0|i(g):i(g)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===wi.Int||this.left.type===wi.Float&&this.right.type!==wi.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[g,i]of[[this.left,this.right],[this.right,this.left]])g.acceptedConnectionPointTypes=[wi.Int,wi.Float],i.isConnected&&(g.acceptedConnectionPointTypes.push(i.type),i.type!==wi.Int&&i.type!==wi.Float||g.acceptedConnectionPointTypes.push(wi.Vector2,wi.Bi,wi.Hd))}dispose(){super.dispose();for(const g of this._connectionObservers)g.remove();this._connectionObservers.length=0}serialize(){const g=super.serialize();return g.operation=this.operation,g}_deserialize(g){super._deserialize(g),this.operation=g.operation}}(0,K.e)([Hi("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:ma.Add},{label:"Subtract",value:ma.Subtract},{label:"Multiply",value:ma.Multiply},{label:"Divide",value:ma.Divide},{label:"Max",value:ma.Max},{label:"Min",value:ma.Min}]})],ia.prototype,"operation",void 0),(0,k.e)("BABYLON.ParticleMathBlock",ia);class aa extends ui{constructor(g){super(g),this.registerInput("particle",wi.Particle),this.registerInput("direction1",wi.Bi,!0,new n.Bi(0,1,0)),this.registerInput("direction2",wi.Bi,!0,new n.Bi(0,1,0)),this.registerInput("minEmitBox",wi.Bi,!0,new n.Bi(-.5,-.5,-.5)),this.registerInput("maxEmitBox",wi.Bi,!0,new n.Bi(.5,.5,.5)),this.registerOutput("output",wi.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(g){const i=this.particle.getConnectedValue(g);i._directionCreation.process=a=>{g.particleContext=a,g.systemContext=i;const L=this.direction1.getConnectedValue(g),d=this.direction2.getConnectedValue(g),b=(0,N.RandomRange)(L.x,d.x),k=(0,N.RandomRange)(L.y,d.y),e=(0,N.RandomRange)(L.z,d.z);g.isEmitterTransformNode?n.Bi.TransformNormalFromFloatsToRef(b,k,e,g.emitterWorldMatrix,a.direction):a.direction.sd(b,k,e)},i._positionCreation.process=a=>{g.particleContext=a,g.systemContext=i;const L=this.minEmitBox.getConnectedValue(g),d=this.maxEmitBox.getConnectedValue(g),b=(0,N.RandomRange)(L.x,d.x),k=(0,N.RandomRange)(L.y,d.y),e=(0,N.RandomRange)(L.z,d.z);g.isEmitterTransformNode?n.Bi.TransformCoordinatesFromFloatsToRef(b,k,e,g.emitterWorldMatrix,a.position):(a.position.sd(b,k,e),a.position.addInPlace(g.emitterPosition))},this.output._storedValue=i}}(0,k.e)("BABYLON.BoxShapeBlock",aa);class na extends ui{constructor(g){super(g),this.registerInput("emitPower",wi.Float,!0,1),this.registerInput("lifeTime",wi.Float,!0,1),this.registerInput("color",wi.Hd,!0,new b.Hd(1,1,1,1)),this.registerInput("scale",wi.Vector2,!0,new n.Vector2(1,1)),this.registerInput("angle",wi.Float,!0,0),this.registerOutput("particle",wi.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(g){const i=new ki(this.name,g.Hk,g.Di,null,!1,void 0,!0);i.particleEmitterType=new p,i._lifeTimeCreation.process=(i,a)=>{g.particleContext=i,i.lifeTime=this.lifeTime.getConnectedValue(g),a._emitPower=this.emitPower.getConnectedValue(g)},i._colorCreation.process=i=>{g.particleContext=i,i.color.I(this.color.getConnectedValue(g))},i._sizeCreation.process=i=>{g.particleContext=i,i.size=1,i.scale.I(this.scale.getConnectedValue(g))},i._angleCreation.process=i=>{g.particleContext=i,i.angle=this.angle.getConnectedValue(g)},this.particle._storedValue=i}}(0,k.e)("BABYLON.CreateParticleBlock",na);class La{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const g=[];for(const i of this.attachedBlocks)i.isInput&&g.push(i);return g}constructor(g){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new q.b,this.name=g}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(g){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(g)&&this.attachedBlocks.push(g);for(const a of g.inputs){const n=a.connectedPoint;if(n){const a=n.ownerBlock;a!==g&&this._initializeBlock(a,i)}}}async buildAsync(g){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((a=>{const n=new Pi;for(const g of this._systemBlocks)this._initializeBlock(g);for(const L of this.systemBlocks){const a=new Mi;a.buildId=this._buildId++,a.Di=g,a.verbose=i;const d=L.createSystem(a);a.emitErrors(),n.systems.push(d)}this.onBuildObservable.notifyObservers(this),a(n)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const g=new Wi("Particle system"),i=new ga("Update position");i.output.connectTo(g.particle);const a=new Gi("Position");a.contextualValue=zi.Position;const n=new Gi("Scaled direction");n.contextualValue=zi.ScaledDirection;const L=new ia("Add");L.operation=ma.Add,a.output.connectTo(L.left),n.output.connectTo(L.right),L.output.connectTo(i.position);const d=new na("Create particle"),b=new aa("Box shape");d.particle.connectTo(b.particle),b.output.connectTo(i.particle);const k=new Ji("Texture");k.texture.connectTo(g.texture),k.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(g)}removeBlock(g){const i=this.attachedBlocks.indexOf(g);if(i>-1&&this.attachedBlocks.splice(i,1),g.isSystem){const i=this._systemBlocks.indexOf(g);i>-1&&this._systemBlocks.splice(i,1)}}parseSerializedObject(g){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i||this.clear();const a={};for(const n of g.cI){const g=(0,k.d)(n.customType);if(g){const i=new g;i._deserialize(n),a[n.id]=i,this.attachedBlocks.push(i),i.isSystem&&this._systemBlocks.push(i)}}for(const n of this.attachedBlocks)if(n.isTeleportOut){const g=n,i=g._tempEntryPointUniqueId;if(i){const n=a[i];n&&n.attachToEndpoint(g)}}for(let n=0;n<g.cI.length;n++){const L=g.cI[n],d=a[L.id];d&&(d.inputs.length&&L.inputs.some((g=>g.targetConnectionName))&&!i||this._restoreConnections(d,g,a))}if(g.locations||g.editorData&&g.editorData.locations){const n=g.locations||g.editorData.locations;for(const g of n)a[g.rL]&&(g.rL=a[g.rL].uniqueId);i&&this.editorData&&this.editorData.locations&&n.concat(this.editorData.locations),g.locations?this.editorData={locations:n}:(this.editorData=g.editorData,this.editorData.locations=n);const L=[];for(const g in a)L[g]=a[g].uniqueId;this.editorData.map=L}this.comment=g.comment}_restoreConnections(g,i,a){for(const n of g.outputs)for(const L of i.cI){const d=a[L.id];if(d)for(const b of L.inputs)if(a[b.targetBlockId]!==g||b.targetConnectionName!==n.name);else{const g=d.getInputByName(b.inputName);if(!g||g.isConnected)continue;n.connectTo(g,!0),this._restoreConnections(d,i,a)}}}serialize(g){const i=g?{}:l.c.Serialize(this);i.editorData=JSON.parse(JSON.stringify(this.editorData));let a=[];g?a=g:i.customType="BABYLON.NodeParticleSystemSet",i.cI=[];for(const n of a)i.cI.push(n.serialize());if(!g)for(const n of this.attachedBlocks)-1===a.indexOf(n)&&i.cI.push(n.serialize());return i}dispose(){for(const g of this.attachedBlocks)g.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(g){const i=new La(g);return i.setToDefault(),i}static Parse(g){const i=l.c.Parse((()=>new La(g.name)),g,null);return i.parseSerializedObject(g),i}static ParseFromSnippetAsync(g,i){return"_BLANK"===g?Promise.resolve(La.CreateDefault("blank")):new Promise(((a,n)=>{const L=new Yi.d;L.addEventListener("readystatechange",(()=>{if(4==L.readyState)if(200==L.status){const b=JSON.parse(JSON.parse(L.responseText).jsonPayload),k=JSON.parse(b.nodeParticle);i||(i=l.c.Parse((()=>new La(g)),k,null)),i.parseSerializedObject(k),i.snippetId=g;try{a(i)}catch(d){n(d)}}else n("Unable to load the snippet "+g)})),L.open("GET",this.SnippetUrl+"/"+g.replace(/#/g,"/")),L.send()}))}}La.EditorURL=`${Ei.Tools._DefaultCdnUrl}/v${Hg.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,La.SnippetUrl="https://snippet.babylonjs.com",(0,K.e)([(0,T.P)()],La.prototype,"name",void 0),(0,K.e)([(0,T.P)("comment")],La.prototype,"comment",void 0),function(g){g[g.None=0]="None",g[g.PerParticle=1]="PerParticle",g[g.PerSystem=2]="PerSystem"}(ri||(ri={}));class da extends ui{constructor(g){super(g),this._currentLockId=-2,this.lockMode=ri.PerParticle,this.registerInput("min",wi.AutoDetect,!0,0),this.registerInput("max",wi.AutoDetect,!0,1),this.registerOutput("output",wi.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wi.Float|wi.Int|wi.Vector2|wi.Bi|wi.Hd),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(wi.Float|wi.Int|wi.Vector2|wi.Bi|wi.Hd),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=wi.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let g=null;switch(this._currentLockId=-2,this.min.type){case wi.AutoDetect:case wi.Int:case wi.Float:g=g=>{const i=this.min.getConnectedValue(g)||0,a=this.max.getConnectedValue(g)||1;return i+Math.random()*(a-i)};break;case wi.Vector2:g=g=>{const i=this.min.getConnectedValue(g)||n.Vector2.Zero(),a=this.max.getConnectedValue(g)||n.Vector2.One();return new n.Vector2(i.x+Math.random()*(a.x-i.x),i.y+Math.random()*(a.y-i.y))};break;case wi.Bi:g=g=>{const i=this.min.getConnectedValue(g)||n.Bi.Zero(),a=this.max.getConnectedValue(g)||n.Bi.One();return new n.Bi(i.x+Math.random()*(a.x-i.x),i.y+Math.random()*(a.y-i.y),i.z+Math.random()*(a.z-i.z))};break;case wi.Hd:g=g=>{const i=this.min.getConnectedValue(g)||new b.Hd(0,0,0,0),a=this.max.getConnectedValue(g)||new b.Hd(1,1,1,1);return new b.Hd(i.x+Math.random()*(a.x-i.x),i.y+Math.random()*(a.y-i.y),i.z+Math.random()*(a.z-i.z),i.w+Math.random()*(a.w-i.w))}}this.output._storedFunction=i=>{var a;let n=0;switch(this.lockMode){case ri.PerParticle:n=(null===(a=i.particleContext)||void 0===a?void 0:a.id)||-1;break;case ri.PerSystem:n=i.buildId||0}return this._currentLockId!==n&&(this.lockMode!==ri.None&&(this._currentLockId=n),this.output._storedValue=g(i)),this.output._storedValue}}serialize(){const g=super.serialize();return g.lockMode=this.lockMode,g}_deserialize(g){super._deserialize(g),this.lockMode=g.lockMode}}(0,K.e)([Hi("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:ri.None},{label:"Per particle",value:ri.PerParticle},{label:"Per system",value:ri.PerSystem}]})],da.prototype,"lockMode",void 0),(0,k.e)("BABYLON.ParticleRandomBlock",da);class ba extends ui{constructor(g){super(g),this._currentLockId=-2,this.lockMode=ri.PerParticle,this.registerInput("min",wi.AutoDetect),this.registerInput("max",wi.AutoDetect),this.registerOutput("output",wi.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const i=[wi.Matrix,wi.Particle,wi.Texture,wi.System,wi.FloatGradient,wi.Color4Gradient,wi.Vector2Gradient,wi.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...i),this.max.excludedConnectionPointTypes.push(...i)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let g=null;switch(this._currentLockId=-2,this.min.type){case wi.Float:case wi.Int:g=g=>{const i=this.min.getConnectedValue(g),a=this.max.getConnectedValue(g);return Math.random()*(a-i)+i};break;case wi.Vector2:g=g=>{const i=this.min.getConnectedValue(g),a=this.max.getConnectedValue(g);return new n.Vector2(Math.random()*(a.x-i.x)+i.x,Math.random()*(a.y-i.y)+i.y)};break;case wi.Bi:g=g=>{const i=this.min.getConnectedValue(g),a=this.max.getConnectedValue(g);return new n.Bi(Math.random()*(a.x-i.x)+i.x,Math.random()*(a.y-i.y)+i.y,Math.random()*(a.z-i.z)+i.z)};break;case wi.Hd:g=g=>{const i=this.min.getConnectedValue(g),a=this.max.getConnectedValue(g);return new b.Hd(Math.random()*(a.r-i.r)+i.r,Math.random()*(a.g-i.g)+i.g,Math.random()*(a.b-i.b)+i.b,Math.random()*(a.a-i.a)+i.a)}}this.output._storedFunction=i=>{var a;let n=0;switch(this.lockMode){case ri.PerParticle:n=(null===(a=i.particleContext)||void 0===a?void 0:a.id)||-1;break;case ri.PerSystem:n=i.buildId||0}return this._currentLockId!==n&&(this.lockMode!==ri.None&&(this._currentLockId=n),this.output._storedValue=g(i)),this.output._storedValue}}serialize(){const g=super.serialize();return g.lockMode=this.lockMode,g}_deserialize(g){super._deserialize(g),void 0!==g.lockMode&&(this.lockMode=g.lockMode)}}(0,K.e)([Hi("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:ri.None},{label:"Per particle",value:ri.PerParticle},{label:"Per system",value:ri.PerSystem}]})],ba.prototype,"lockMode",void 0),(0,k.e)("BABYLON.RandomRangeBlock",ba);(0,k.e)("BABYLON.ParticleLerpBlock",class extends ui{constructor(g){super(g),this.registerInput("left",wi.AutoDetect),this.registerInput("right",wi.AutoDetect),this.registerInput("gradient",wi.Float,!0,0,0,1),this.registerOutput("output",wi.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wi.Float|wi.Int|wi.Vector2|wi.Bi|wi.Hd)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const g=(g,i,a)=>(1-g)*i+g*a;this.output._storedFunction=i=>{const a=this.left.getConnectedValue(i),L=this.right.getConnectedValue(i),d=this.gradient.getConnectedValue(i);switch(this.left.type){case wi.Int:case wi.Float:return g(d,a,L);case wi.Vector2:return new n.Vector2(g(d,a.x,L.x),g(d,a.y,L.y));case wi.Bi:return new n.Bi(g(d,a.x,L.x),g(d,a.y,L.y),g(d,a.z,L.z));case wi.Hd:return new b.Hd(g(d,a.r,L.r),g(d,a.g,L.g),g(d,a.b,L.b),g(d,a.a,L.a))}return 0}}});(0,k.e)("BABYLON.UpdateDirectionBlock",class extends ui{constructor(g){super(g),this.registerInput("particle",wi.Particle),this.registerInput("direction",wi.Bi),this.registerOutput("output",wi.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(g){const i=this.particle.getConnectedValue(g);if(this.output._storedValue=i,!this.direction.isConnected)return;const a={process:a=>{g.particleContext=a,g.systemContext=i,a.direction.I(this.direction.getConnectedValue(g))},previousItem:null,nextItem:null};i._updateQueueStart?sg(a,i._updateQueueStart):i._updateQueueStart=a}});(0,k.e)("BABYLON.UpdateColorBlock",class extends ui{constructor(g){super(g),this.registerInput("particle",wi.Particle),this.registerInput("color",wi.Hd),this.registerOutput("output",wi.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(g){const i=this.particle.getConnectedValue(g);if(this.output._storedValue=i,!this.color.isConnected)return;const a={process:a=>{g.particleContext=a,g.systemContext=i,a.color.I(this.color.getConnectedValue(g))},previousItem:null,nextItem:null};i._updateQueueStart?sg(a,i._updateQueueStart):i._updateQueueStart=a}});(0,k.e)("BABYLON.UpdateScaleBlock",class extends ui{constructor(g){super(g),this.registerInput("particle",wi.Particle),this.registerInput("scale",wi.Vector2),this.registerOutput("output",wi.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(g){const i=this.particle.getConnectedValue(g);if(this.output._storedValue=i,!this.scale.isConnected)return;const a={process:a=>{g.particleContext=a,g.systemContext=i,a.scale.I(this.scale.getConnectedValue(g))},previousItem:null,nextItem:null};i._updateQueueStart?sg(a,i._updateQueueStart):i._updateQueueStart=a}});(0,k.e)("BABYLON.UpdateAngleBlock",class extends ui{constructor(g){super(g),this.registerInput("particle",wi.Particle),this.registerInput("angle",wi.Float),this.registerOutput("output",wi.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(g){const i=this.particle.getConnectedValue(g);if(this.output._storedValue=i,!this.angle.isConnected)return;const a={process:a=>{g.particleContext=a,g.systemContext=i,a.angle=this.angle.getConnectedValue(g)},previousItem:null,nextItem:null};i._updateQueueStart?sg(a,i._updateQueueStart):i._updateQueueStart=a}});(0,k.e)("BABYLON.BasicPositionUpdateBlock",class extends ui{constructor(g){super(g),this.registerInput("particle",wi.Particle),this.registerOutput("output",wi.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(g){const i=this.particle.getConnectedValue(g),a={process:a=>{g.particleContext=a,g.systemContext=i,a.direction.scaleToRef(i._directionScale,i._scaledDirection),a.position.addInPlace(i._scaledDirection)},previousItem:null,nextItem:null};i._updateQueueStart?sg(a,i._updateQueueStart):i._updateQueueStart=a,this.output._storedValue=i}});(0,k.e)("BABYLON.BasicSpriteUpdateBlock",class extends ui{constructor(g){super(g),this.registerInput("particle",wi.Particle),this.registerOutput("output",wi.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(g){const i=this.particle.getConnectedValue(g),a={process:a=>{g.particleContext=a,g.systemContext=i,a.updateCellIndex()},previousItem:null,nextItem:null};i._updateQueueStart?sg(a,i._updateQueueStart):i._updateQueueStart=a,this.output._storedValue=i}});(0,k.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends ui{constructor(g){super(g),this.registerInput("particle",wi.Particle),this.registerInput("cellIndex",wi.Int),this.registerOutput("output",wi.Particle),this.cellIndex.acceptedConnectionPointTypes=[wi.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(g){const i=this.particle.getConnectedValue(g);if(this.output._storedValue=i,!this.cellIndex.isConnected)return;const a={process:a=>{g.particleContext=a,g.systemContext=i,a.cellIndex=Math.floor(this.cellIndex.getConnectedValue(g))},previousItem:null,nextItem:null};i._updateQueueStart?sg(a,i._updateQueueStart):i._updateQueueStart=a}});class ka extends ui{constructor(g){super(g),this.strength=1,this.registerInput("particle",wi.Particle),this.registerInput("flowMap",wi.Texture),this.registerOutput("output",wi.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(g){var i;const a=this.particle.getConnectedValue(g),n=g.Di;let L;(null===(i=this.flowMap.connectedPoint)||void 0===i?void 0:i.ownerBlock).extractTextureContentAsync().then((g=>{g&&(L=new hi(g.width,g.height,g.data))}));const d={process:g=>{const i=n.getTransformMatrix();L&&L._processParticle(g,this.strength*a._tempScaledUpdateSpeed,i)},previousItem:null,nextItem:null};a._updateQueueStart?sg(d,a._updateQueueStart):a._updateQueueStart=d,this.output._storedValue=a}serialize(){const g=super.serialize();return g.strength=this.strength,g}_deserialize(g){super._deserialize(g),this.strength=g.strength}}(0,K.e)([Hi("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ka.prototype,"strength",void 0),(0,k.e)("BABYLON.UpdateFlowMapBlock",ka);(0,k.e)("BABYLON.SphereShapeBlock",class extends ui{constructor(g){super(g),this.registerInput("input",wi.Particle),this.registerInput("radius",wi.Float,!0,1),this.registerInput("radiusRange",wi.Float,!0,1,0,1),this.registerInput("directionRandomizer",wi.Float,!0,0,0,1),this.registerOutput("output",wi.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(g){const i=this.input.getConnectedValue(g);i._directionCreation.process=a=>{g.particleContext=a,g.systemContext=i;const L=this.directionRandomizer.getConnectedValue(g),d=a.position.ci(g.emitterPosition).normalize(),b=(0,N.RandomRange)(0,L),k=(0,N.RandomRange)(0,L),e=(0,N.RandomRange)(0,L);d.x+=b,d.y+=k,d.z+=e,d.normalize(),g.isEmitterTransformNode?n.Bi.TransformNormalFromFloatsToRef(b,k,e,g.emitterWorldMatrix,a.direction):a.direction.sd(b,k,e)},i._positionCreation.process=a=>{g.particleContext=a,g.systemContext=i;const L=this.radius.getConnectedValue(g),d=this.radiusRange.getConnectedValue(g),b=L-(0,N.RandomRange)(0,L*d),k=(0,N.RandomRange)(0,1),e=(0,N.RandomRange)(0,2*Math.PI),F=Math.acos(2*k-1),I=b*Math.cos(e)*Math.sin(F),j=b*Math.cos(F),y=b*Math.sin(e)*Math.sin(F);g.isEmitterTransformNode?n.Bi.TransformCoordinatesFromFloatsToRef(I,j,y,g.emitterWorldMatrix,a.position):(a.position.sd(I,j,y),a.position.addInPlace(g.emitterPosition))},this.output._storedValue=i}});(0,k.e)("BABYLON.PointShapeBlock",class extends ui{constructor(g){super(g),this.registerInput("particle",wi.Particle),this.registerInput("direction1",wi.Bi,!0,new n.Bi(0,1,0)),this.registerInput("direction2",wi.Bi,!0,new n.Bi(0,1,0)),this.registerOutput("output",wi.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(g){const i=this.particle.getConnectedValue(g);i._directionCreation.process=a=>{g.particleContext=a,g.systemContext=i;const L=this.direction1.getConnectedValue(g),d=this.direction2.getConnectedValue(g),b=(0,N.RandomRange)(L.x,d.x),k=(0,N.RandomRange)(L.y,d.y),e=(0,N.RandomRange)(L.z,d.z);g.isEmitterTransformNode?n.Bi.TransformNormalFromFloatsToRef(b,k,e,g.emitterWorldMatrix,a.direction):a.direction.sd(b,k,e)},i._positionCreation.process=a=>{g.systemContext=i,g.isEmitterTransformNode?n.Bi.TransformCoordinatesFromFloatsToRef(0,0,0,g.emitterWorldMatrix,a.position):a.position.I(g.emitterPosition)},this.output._storedValue=i}});(0,k.e)("BABYLON.CustomShapeBlock",class extends ui{constructor(g){super(g),this.registerInput("particle",wi.Particle),this.registerInput("position",wi.Bi,!0,new n.Bi(0,0,0)),this.registerInput("direction",wi.Bi,!0,new n.Bi(0,1,0)),this.registerOutput("output",wi.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(g){const i=this.particle.getConnectedValue(g);i._directionCreation.process=a=>{g.particleContext=a,g.systemContext=i;const L=this.direction.getConnectedValue(g);g.isEmitterTransformNode?n.Bi.TransformNormalToRef(L,g.emitterWorldMatrix,a.direction):a.direction.I(L)},i._positionCreation.process=a=>{g.particleContext=a,g.systemContext=i;const L=this.position.getConnectedValue(g);g.isEmitterTransformNode?n.Bi.TransformCoordinatesToRef(L,g.emitterWorldMatrix,a.position):(a.position.I(L),a.position.addInPlace(g.emitterPosition))},this.output._storedValue=i}});(0,k.e)("BABYLON.CylinderShapeBlock",class extends ui{constructor(g){super(g),this._tempVector=n.Bi.Zero(),this.registerInput("particle",wi.Particle),this.registerInput("radius",wi.Float,!0,1),this.registerInput("height",wi.Float,!0,1,0),this.registerInput("radiusRange",wi.Float,!0,1,0,1),this.registerInput("directionRandomizer",wi.Float,!0,0,0,1),this.registerOutput("output",wi.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(g){const i=this.particle.getConnectedValue(g);i._directionCreation.process=a=>{g.particleContext=a,g.systemContext=i;const L=this.directionRandomizer.getConnectedValue(g);a.position.subtractToRef(g.emitterPosition,this._tempVector),this._tempVector.normalize(),g.isEmitterTransformNode&&n.Bi.TransformNormalToRef(this._tempVector,g.emitterInverseWorldMatrix,this._tempVector);const d=(0,N.RandomRange)(-L/2,L/2);let b=Math.atan2(this._tempVector.x,this._tempVector.z);b+=(0,N.RandomRange)(-Math.PI/2,Math.PI/2)*L,this._tempVector.y=d,this._tempVector.x=Math.sin(b),this._tempVector.z=Math.cos(b),this._tempVector.normalize(),g.isEmitterTransformNode?n.Bi.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,g.emitterWorldMatrix,a.direction):a.direction.I(this._tempVector)},i._positionCreation.process=a=>{g.particleContext=a,g.systemContext=i;const L=this.height.getConnectedValue(g),d=this.radiusRange.getConnectedValue(g),b=this.radius.getConnectedValue(g),k=(0,N.RandomRange)(-L/2,L/2),e=(0,N.RandomRange)(0,2*Math.PI),F=(0,N.RandomRange)((1-d)*(1-d),1),I=Math.sqrt(F)*b,j=I*Math.cos(e),y=I*Math.sin(e);g.isEmitterTransformNode?n.Bi.TransformCoordinatesFromFloatsToRef(j,k,y,g.emitterWorldMatrix,a.position):(a.position.sd(j,k,y),a.position.addInPlace(g.emitterPosition))},this.output._storedValue=i}});class ea extends ui{constructor(g){super(g),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",wi.Particle),this.registerOutput("output",wi.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(g){super._build(g);const i=this.particle.getConnectedValue(g);i._isAnimationSheetEnabled=!0,i.spriteCellWidth=this.width,i.spriteCellHeight=this.height,i.startSpriteCellID=this.start,i.endSpriteCellID=this.end,i.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=i}serialize(){const g=super.serialize();return g.width=this.width,g.height=this.height,g.start=this.start,g.end=this.end,g.randomStartCell=this.randomStartCell,g}_deserialize(g){super._deserialize(g),this.width=g.width,this.height=g.height,this.start=g.start,this.end=g.end,this.randomStartCell=g.randomStartCell}}(0,K.e)([Hi("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ea.prototype,"start",void 0),(0,K.e)([Hi("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ea.prototype,"end",void 0),(0,K.e)([Hi("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ea.prototype,"width",void 0),(0,K.e)([Hi("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ea.prototype,"height",void 0),(0,K.e)([Hi("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ea.prototype,"loop",void 0),(0,K.e)([Hi("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ea.prototype,"randomStartCell",void 0),(0,k.e)("BABYLON.SetupSpriteSheetBlock",ea);class Na extends ui{constructor(g){super(g),this.reference=0,this.registerInput("value",wi.AutoDetect),this.registerOutput("output",wi.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=g=>{switch(g){case wi.Float:return wi.FloatGradient;case wi.Vector2:return wi.Vector2Gradient;case wi.Bi:return wi.Vector3Gradient;case wi.Hd:return wi.Color4Gradient}return g},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wi.Float|wi.Vector2|wi.Bi|wi.Hd)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=g=>null}serialize(){const g=super.serialize();return g.reference=this.reference,g}_deserialize(g){super._deserialize(g),this.reference=g.reference}}(0,K.e)([Hi("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Na.prototype,"reference",void 0),(0,k.e)("BABYLON.ParticleGradientValueBlock",Na);(0,k.e)("BABYLON.ParticleGradientBlock",class extends ui{constructor(g){super(g),this._entryCount=1,this.registerInput("gradient",wi.Float,!0,1,0,1),this.registerInput("value0",wi.AutoDetect),this.registerOutput("output",wi.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=g=>{switch(g){case wi.FloatGradient:return wi.Float;case wi.Vector2Gradient:return wi.Vector2;case wi.Vector3Gradient:return wi.Bi;case wi.Color4Gradient:return wi.Hd}return g},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(wi.FloatGradient|wi.Vector2Gradient|wi.Vector3Gradient|wi.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(g){this._inputs[g].onConnectionObservable.add((()=>{this._entryCount>g||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),wi.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const g=[];for(let a=1;a<this._inputs.length;a++){var i;if(this._inputs[a].isConnected)g.push(null===(i=this._inputs[a].connectedPoint)||void 0===i?void 0:i.ownerBlock)}g.sort(((g,i)=>g.reference-i.reference)),this.output._storedFunction=i=>{const a=this.gradient.getConnectedValue(i);if(1===g.length)return g[0].value.getConnectedValue(i);let L=null;for(let d=g.length-1;d>=0;d--){const k=g[d];if(k.reference<=a){const g=k.value.getConnectedValue(i);if(L){const d=L.value.getConnectedValue(i),e=L.reference,F=k.reference,I=Math.max(0,Math.min(1,(a-F)/(e-F)));switch(this.output.type){case wi.Float:return(0,N.Lerp)(g,d,I);case wi.Vector2:return n.Vector2.Lerp(g,d,I);case wi.Bi:return n.Bi.Lerp(g,d,I);case wi.Hd:return b.Hd.Lerp(g,d,I)}}return g}L=k}return 0}}});(0,k.e)("BABYLON.ParticleConverterBlock",class extends ui{constructor(g){super(g),this.registerInput("color ",wi.Hd,!0),this.registerInput("xyz ",wi.Bi,!0),this.registerInput("xy ",wi.Vector2,!0),this.registerInput("zw ",wi.Vector2,!0),this.registerInput("x ",wi.Float,!0),this.registerInput("y ",wi.Float,!0),this.registerInput("z ",wi.Float,!0),this.registerInput("w ",wi.Float,!0),this.registerOutput("color",wi.Hd),this.registerOutput("xyz",wi.Bi),this.registerOutput("xy",wi.Vector2),this.registerOutput("zw",wi.Vector2),this.registerOutput("x",wi.Float),this.registerOutput("y",wi.Float),this.registerOutput("z",wi.Float),this.registerOutput("w",wi.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(g){return"color "===g?"colorIn":"xyz "===g?"xyzIn":"xy "===g?"xyIn":"zw "===g?"zwIn":"x "===g?"xIn":"y "===g?"yIn":"z "===g?"zIn":"w "===g?"wIn":g}_outputRename(g){switch(g){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return g}}_build(g){super._build(g);const i=this.xIn,a=this.yIn,L=this.zIn,d=this.wIn,k=this.xyIn,e=this.zwIn,N=this.xyzIn,F=this.colorIn,I=this.colorOut,j=this.xyzOut,y=this.xyOut,B=this.zwOut,c=this.xOut,D=this.yOut,p=this.zOut,R=this.wOut,x=g=>{if(F.isConnected)return F.getConnectedValue(g);let n=0,I=0,j=0,y=0;if(i.isConnected&&(n=i.getConnectedValue(g)),a.isConnected&&(I=a.getConnectedValue(g)),L.isConnected&&(j=L.getConnectedValue(g)),d.isConnected&&(y=d.getConnectedValue(g)),k.isConnected){const i=k.getConnectedValue(g);i&&(n=i.x,I=i.y)}if(e.isConnected){const i=e.getConnectedValue(g);i&&(j=i.x,y=i.y)}if(N.isConnected){const i=N.getConnectedValue(g);i&&(n=i.x,I=i.y,j=i.z)}return new b.Hd(n,I,j,y)};I._storedFunction=g=>x(g),j._storedFunction=g=>{const i=x(g);return new n.Bi(i.r,i.g,i.b)},y._storedFunction=g=>{const i=x(g);return new n.Vector2(i.r,i.g)},B._storedFunction=g=>{const i=x(g);return new n.Vector2(i.b,i.a)},c._storedFunction=g=>x(g).r,D._storedFunction=g=>x(g).g,p._storedFunction=g=>x(g).b,R._storedFunction=g=>x(g).a}}),function(g){g[g.Cos=0]="Cos",g[g.Sin=1]="Sin",g[g.Abs=2]="Abs",g[g.Exp=3]="Exp",g[g.Exp2=4]="Exp2",g[g.Round=5]="Round",g[g.Floor=6]="Floor",g[g.Ceiling=7]="Ceiling",g[g.Sqrt=8]="Sqrt",g[g.Log=9]="Log",g[g.Tan=10]="Tan",g[g.ArcTan=11]="ArcTan",g[g.ArcCos=12]="ArcCos",g[g.ArcSin=13]="ArcSin",g[g.Sign=14]="Sign",g[g.Negate=15]="Negate",g[g.OneMinus=16]="OneMinus",g[g.Reciprocal=17]="Reciprocal",g[g.ToDegrees=18]="ToDegrees",g[g.ToRadians=19]="ToRadians",g[g.Fract=20]="Fract"}(Qi||(Qi={}));class Fa extends ui{constructor(g){super(g),this.operation=Qi.Cos,this.registerInput("input",wi.AutoDetect),this.registerOutput("output",wi.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wi.Float|wi.Int|wi.Vector2|wi.Bi|wi.Hd)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(g){super._build(g);let i=null;switch(this.operation){case Qi.Cos:i=g=>Math.cos(g);break;case Qi.Sin:i=g=>Math.sin(g);break;case Qi.Abs:i=g=>Math.abs(g);break;case Qi.Exp:i=g=>Math.exp(g);break;case Qi.Exp2:i=g=>Math.pow(2,g);break;case Qi.Round:i=g=>Math.round(g);break;case Qi.Floor:i=g=>Math.floor(g);break;case Qi.Ceiling:i=g=>Math.ceil(g);break;case Qi.Sqrt:i=g=>Math.sqrt(g);break;case Qi.Log:i=g=>Math.log(g);break;case Qi.Tan:i=g=>Math.tan(g);break;case Qi.ArcTan:i=g=>Math.atan(g);break;case Qi.ArcCos:i=g=>Math.acos(g);break;case Qi.ArcSin:i=g=>Math.asin(g);break;case Qi.Sign:i=g=>Math.sign(g);break;case Qi.Negate:i=g=>-g;break;case Qi.OneMinus:i=g=>1-g;break;case Qi.Reciprocal:i=g=>1/g;break;case Qi.ToRadians:i=g=>g*Math.PI/180;break;case Qi.ToDegrees:i=g=>180*g/Math.PI;break;case Qi.Fract:i=g=>g>=0?g-Math.floor(g):g-Math.ceil(g)}if(!i)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case wi.Int:case wi.Float:this.output._storedFunction=g=>{const a=this.input.getConnectedValue(g);return i(a)};break;case wi.Vector2:this.output._storedFunction=g=>{const a=this.input.getConnectedValue(g);return new n.Vector2(i(a.x),i(a.y))};break;case wi.Bi:this.output._storedFunction=g=>{const a=this.input.getConnectedValue(g);return new n.Bi(i(a.x),i(a.y),i(a.z))};break;case wi.Hd:this.output._storedFunction=g=>{const a=this.input.getConnectedValue(g);return new b.Hd(i(a.r),i(a.g),i(a.b),i(a.a))}}return this}serialize(){const g=super.serialize();return g.operation=this.operation,g}_deserialize(g){super._deserialize(g),this.operation=g.operation}}(0,K.e)([Hi("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Qi.Cos},{label:"Sin",value:Qi.Sin},{label:"Abs",value:Qi.Abs},{label:"Exp",value:Qi.Exp},{label:"Exp2",value:Qi.Exp2},{label:"Round",value:Qi.Round},{label:"Floor",value:Qi.Floor},{label:"Ceiling",value:Qi.Ceiling},{label:"Sqrt",value:Qi.Sqrt},{label:"Log",value:Qi.Log},{label:"Tan",value:Qi.Tan},{label:"ArcTan",value:Qi.ArcTan},{label:"ArcCos",value:Qi.ArcCos},{label:"ArcSin",value:Qi.ArcSin},{label:"Sign",value:Qi.Sign},{label:"Negate",value:Qi.Negate},{label:"OneMinus",value:Qi.OneMinus},{label:"Reciprocal",value:Qi.Reciprocal},{label:"ToDegrees",value:Qi.ToDegrees},{label:"ToRadians",value:Qi.ToRadians},{label:"Fract",value:Qi.Fract}]})],Fa.prototype,"operation",void 0),(0,k.e)("BABYLON.ParticleTrigonometryBlock",Fa);var Ia,ja=a(13858);class ya extends ui{constructor(g){super(g),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",wi.AutoDetect),this.registerOutput("output",wi.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(wi.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(wi.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(wi.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(wi.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(wi.System),this._inputs[0].excludedConnectionPointTypes.push(wi.Particle),this._inputs[0].excludedConnectionPointTypes.push(wi.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(g){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const i=g=>{const i=this.input.getConnectedValue(g);if(this.log.length>=this.stackSize)return i;if(null===i||void 0===i)return this.log.push(["null",""]),i;switch(this.input.type){case wi.Vector2:this.log.push([(0,ja.j)(i,4),i.toString()]);break;case wi.Bi:this.log.push([(0,ja.l)(i,4),i.toString()]);break;case wi.Hd:this.log.push([`{R: ${i.r.toFixed(4)} G: ${i.g.toFixed(4)} B: ${i.b.toFixed(4)} A: ${i.a.toFixed(4)}}`,i.toString()]);break;default:this.log.push([i.toString(),i.toString()])}return i};this.output.isConnected?this.output._storedFunction=i:this.output._storedValue=i(g)}serialize(){const g=super.serialize();return g.stackSize=this.stackSize,g}_deserialize(g){super._deserialize(g),this.stackSize=g.stackSize}}(0,K.e)([Hi("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],ya.prototype,"stackSize",void 0),(0,k.e)("BABYLON.ParticleDebugBlock",ya);(0,k.e)("BABYLON.ParticleElbowBlock",class extends ui{constructor(g){super(g),this.registerInput("input",wi.AutoDetect),this.registerOutput("output",wi.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(g){super._build(g);const i=this._outputs[0],a=this._inputs[0];i._storedFunction=g=>a.getConnectedValue(g)}});(0,k.e)("BABYLON.ParticleTeleportInBlock",class extends ui{get endpoints(){return this._endpoints}constructor(g){super(g),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",wi.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(g){if(this.getClassName()===g)return!0;for(const i of this.endpoints)if(i.isAnAncestorOfType(g))return!0;return!1}isAnAncestorOf(g){for(const i of this.endpoints){if(i===g)return!0;if(i.isAnAncestorOf(g))return!0}return!1}attachToEndpoint(g){g.detach(),this._endpoints.push(g),g._entryPoint=this,g._outputs[0]._typeConnectionSource=this._inputs[0],g._tempEntryPointUniqueId=null,g.name="> "+this.name}detachFromEndpoint(g){const i=this._endpoints.indexOf(g);-1!==i&&(this._endpoints.splice(i,1),g._outputs[0]._typeConnectionSource=null,g._entryPoint=null)}_build(){for(const g of this._endpoints)g.output._storedFunction=g=>this.input.getConnectedValue(g)}});(0,k.e)("BABYLON.ParticleTeleportOutBlock",class extends ui{constructor(g){super(g),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",wi.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(g){this.entryPoint&&this.entryPoint.build(g)}clone(){const g=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(g),g}serialize(){var g;const i=super.serialize();return i.entryPoint=(null===(g=this.entryPoint)||void 0===g?void 0:g.uniqueId)??"",i}_deserialize(g){super._deserialize(g),this._tempEntryPointUniqueId=g.entryPoint}}),function(g){g[g.Equal=0]="Equal",g[g.NotEqual=1]="NotEqual",g[g.LessThan=2]="LessThan",g[g.GreaterThan=3]="GreaterThan",g[g.LessOrEqual=4]="LessOrEqual",g[g.GreaterOrEqual=5]="GreaterOrEqual",g[g.Xor=6]="Xor",g[g.Or=7]="Or",g[g.And=8]="And"}(Ia||(Ia={}));class Ba extends ui{constructor(g){super(g),this.test=Ia.Equal,this.epsilon=0,this.registerInput("left",wi.Float),this.registerInput("right",wi.Float,!0,0),this.registerInput("ifTrue",wi.AutoDetect,!0,1),this.registerInput("ifFalse",wi.AutoDetect,!0,0),this.registerOutput("output",wi.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=wi.Float,this._inputs[0].acceptedConnectionPointTypes.push(wi.Int),this._inputs[1].acceptedConnectionPointTypes.push(wi.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const g=g=>{const i=this.left.getConnectedValue(g),a=this.right.getConnectedValue(g);let n=!1;switch(this.test){case Ia.Equal:n=(0,N.WithinEpsilon)(i,a,this.epsilon);break;case Ia.NotEqual:n=!(0,N.WithinEpsilon)(i,a,this.epsilon);break;case Ia.LessThan:n=i<a+this.epsilon;break;case Ia.GreaterThan:n=i>a-this.epsilon;break;case Ia.LessOrEqual:n=i<=a+this.epsilon;break;case Ia.GreaterOrEqual:n=i>=a-this.epsilon;break;case Ia.Xor:n=!!i&&!a||!i&&!!a;break;case Ia.Or:n=!!i||!!a;break;case Ia.And:n=!!i&&!!a}return n};this.output._storedFunction=i=>g(i)?this.ifTrue.getConnectedValue(i):this.ifFalse.getConnectedValue(i)}serialize(){const g=super.serialize();return g.test=this.test,g.epsilon=this.epsilon,g}_deserialize(g){super._deserialize(g),this.test=g.test,void 0!==g.epsilon&&(this.epsilon=g.epsilon)}}(0,K.e)([Hi("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Ia.Equal},{label:"NotEqual",value:Ia.NotEqual},{label:"LessThan",value:Ia.LessThan},{label:"GreaterThan",value:Ia.GreaterThan},{label:"LessOrEqual",value:Ia.LessOrEqual},{label:"GreaterOrEqual",value:Ia.GreaterOrEqual},{label:"Xor",value:Ia.Xor},{label:"Or",value:Ia.Or},{label:"And",value:Ia.And}]})],Ba.prototype,"test",void 0),(0,K.e)([Hi("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ba.prototype,"epsilon",void 0),(0,k.e)("BABYLON.ParticleConditionBlock",Ba);class ca extends ui{constructor(g){super(g),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",wi.Particle),this.registerInput("condition",wi.Float,!0,0),this.registerInput("system",wi.System),this.registerOutput("output",wi.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(g){this._triggerCount=0;const i=this.input.getConnectedValue(g),a={process:a=>{if(g.particleContext=a,g.systemContext=i,0!==this.condition.getConnectedValue(g)&&(0===this.limit||this._triggerCount<this.limit)){const n=(new Date).getTime();if(this._previousOne&&n-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=n;const L=this.system.getConnectedValue(g);if(L){const n=qi(L,g.Di,a.position);n.dd.addOnce((()=>{this._triggerCount--})),i.dd.addOnce((()=>{n.dispose()}))}}},previousItem:null,nextItem:null};i._updateQueueStart?sg(a,i._updateQueueStart):i._updateQueueStart=a,this.output._storedValue=i}serialize(){const g=super.serialize();return g.limit=this.limit,g.delay=this.delay,g}_deserialize(g){super._deserialize(g),void 0!==g.limit&&(this.limit=g.limit),void 0!==g.delay&&(this.delay=g.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,K.e)([Hi("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ca.prototype,"limit",void 0),(0,K.e)([Hi("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ca.prototype,"delay",void 0),(0,k.e)("BABYLON.ParticleTriggerBlock",ca);a(13864),a(13881),a(13894),a(13950)},13928:(g,i,a)=>{"use strict";var n=a(12367);const L="clipPlaneFragment",d="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13898:(g,i,a)=>{"use strict";var n=a(12367);const L="clipPlaneFragmentDeclaration",d="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13965:(g,i,a)=>{"use strict";var n=a(12367);const L="clipPlaneVertex",d="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13953:(g,i,a)=>{"use strict";var n=a(12367);const L="clipPlaneVertexDeclaration",d="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13943:(g,i,a)=>{"use strict";var n=a(12367);const L="fogFragment",d="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13921:(g,i,a)=>{"use strict";var n=a(12367);const L="fogFragmentDeclaration",d="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13971:(g,i,a)=>{"use strict";var n=a(12367);const L="fogVertex",d="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13962:(g,i,a)=>{"use strict";var n=a(12367);const L="fogVertexDeclaration",d="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13912:(g,i,a)=>{"use strict";var n=a(12367);const L="helperFunctions",d="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13902:(g,i,a)=>{"use strict";var n=a(12367);const L="imageProcessingDeclaration",d="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13916:(g,i,a)=>{"use strict";var n=a(12367);const L="imageProcessingFunctions",d="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13904:(g,i,a)=>{"use strict";var n=a(12367);const L="logDepthDeclaration",d="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13937:(g,i,a)=>{"use strict";var n=a(12367);const L="logDepthFragment",d="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13977:(g,i,a)=>{"use strict";var n=a(12367);const L="logDepthVertex",d="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";n.c.IncludesShadersStoreWGSL[L]||(n.c.IncludesShadersStoreWGSL[L]=d)},13894:(g,i,a)=>{"use strict";a.r(i),a.d(i,{particlesPixelShaderWGSL:()=>b});var n=a(12367);a(13898),a(13902),a(13904),a(13912),a(13916),a(13921),a(13928),a(13937),a(13943);const L="particlesPixelShader",d="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";n.c.ShadersStoreWGSL[L]||(n.c.ShadersStoreWGSL[L]=d);const b={name:L,shader:d}},13950:(g,i,a)=>{"use strict";a.r(i),a.d(i,{particlesVertexShaderWGSL:()=>b});var n=a(12367);a(13953),a(13962),a(13904),a(13965),a(13971),a(13977);const L="particlesVertexShader",d="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";n.c.ShadersStoreWGSL[L]||(n.c.ShadersStoreWGSL[L]=d);const b={name:L,shader:d}},13799:(g,i,a)=>{"use strict";var n=a(12367);const L="clipPlaneFragment",d="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13872:(g,i,a)=>{"use strict";var n=a(12367);const L="clipPlaneFragmentDeclaration",d="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13819:(g,i,a)=>{"use strict";var n=a(12367);const L="clipPlaneVertex",d="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13889:(g,i,a)=>{"use strict";var n=a(12367);const L="clipPlaneVertexDeclaration",d="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13807:(g,i,a)=>{"use strict";var n=a(12367);const L="fogFragment",d="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13795:(g,i,a)=>{"use strict";var n=a(12367);const L="fogFragmentDeclaration",d="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13822:(g,i,a)=>{"use strict";var n=a(12367);const L="fogVertex",d="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13816:(g,i,a)=>{"use strict";var n=a(12367);const L="fogVertexDeclaration",d="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13784:(g,i,a)=>{"use strict";var n=a(12367);const L="helperFunctions",d="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13766:(g,i,a)=>{"use strict";var n=a(12367);const L="imageProcessingDeclaration",d="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13786:(g,i,a)=>{"use strict";var n=a(12367);const L="imageProcessingFunctions",d="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13775:(g,i,a)=>{"use strict";var n=a(12367);const L="logDepthDeclaration",d="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13803:(g,i,a)=>{"use strict";var n=a(12367);const L="logDepthFragment",d="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13829:(g,i,a)=>{"use strict";var n=a(12367);const L="logDepthVertex",d="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";n.c.IncludesShadersStore[L]||(n.c.IncludesShadersStore[L]=d)},13864:(g,i,a)=>{"use strict";a.r(i),a.d(i,{particlesPixelShader:()=>b});var n=a(12367);a(13872),a(13766),a(13775),a(13784),a(13786),a(13795),a(13799),a(13803),a(13807);const L="particlesPixelShader",d="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";n.c.ShadersStore[L]||(n.c.ShadersStore[L]=d);const b={name:L,shader:d}},13881:(g,i,a)=>{"use strict";a.r(i),a.d(i,{particlesVertexShader:()=>b});var n=a(12367);a(13889),a(13816),a(13775),a(13819),a(13822),a(13829);const L="particlesVertexShader",d="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";n.c.ShadersStore[L]||(n.c.ShadersStore[L]=d);const b={name:L,shader:d}},14280:(g,i,a)=>{"use strict";a.r(i),a.d(i,{FlowGraphGLTFDataProvider:()=>d});var n=a(14234),L=a(14214);class d extends n.c{constructor(g){var i,a;super();const n=g.glTF,d=(null===(i=n.animations)||void 0===i?void 0:i.map((g=>g._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",L.d,d);const b=(null===(a=n.nodes)||void 0===a?void 0:a.map((g=>g._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",L.d,b)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14136:(g,i,a)=>{"use strict";a.d(i,{c:()=>D,e:()=>B,i:()=>y,l:()=>c});var n=a(12452),L=a(12950),d=a(12496),b=a(14143);const k=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class e{constructor(g,i){this._gltf=g,this._infoTree=i}convert(g){let i,a=this._gltf,n=this._infoTree;if(!g.startsWith("/"))throw new Error("Path must start with a /");const L=g.split("/");if(L.shift(),L[L.length-1].includes(".length")){const g=L[L.length-1].split(".");L.pop(),L.push(...g)}let d=!1;for(const e of L){const L="length"===e;if(L&&!n.__array__)throw new Error(`Path ${g} is invalid`);if(n.__ignoreObjectTree__&&(d=!0),n.__array__&&!L)n=n.__array__;else if(n=n[e],!n)throw new Error(`Path ${g} is invalid`);if(!d)if(void 0===a){if(!k.find((i=>i.regex.test(g))))throw new Error(`Path ${g} is invalid`)}else if(!L){var b;a=null===(b=a)||void 0===b?void 0:b[e]}(n.__target__||L)&&(i=a)}return{object:i,info:n}}}function N(g,i,a,n){const L=F(g,i);return n?L[a][n]:L[a]}function F(g,i,a){var n,d;return null===(n=g._data)||void 0===n||null===(d=n[(null===a||void 0===a?void 0:a.fillMode)??L.b.MATERIAL_TriangleFillMode])||void 0===d?void 0:d.babylonMaterial}function I(g,i){return{offset:{componentsCount:2,type:"Vector2",get:(a,L,d)=>{const b=N(a,d,g,i);return new n.Vector2(null===b||void 0===b?void 0:b.uOffset,null===b||void 0===b?void 0:b.vOffset)},getTarget:F,set:(a,n,L,d)=>{const b=N(n,d,g,i);b.uOffset=a.x,b.vOffset=a.y},getPropertyName:[()=>`${g}${i?"."+i:""}.uOffset`,()=>`${g}${i?"."+i:""}.vOffset`]},rotation:{type:"number",get:(a,n,L)=>{var d;return null===(d=N(a,L,g,i))||void 0===d?void 0:d.wAng},getTarget:F,set:(a,n,L,d)=>N(n,d,g,i).wAng=a,getPropertyName:[()=>`${g}${i?"."+i:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(a,L,d)=>{const b=N(a,d,g,i);return new n.Vector2(null===b||void 0===b?void 0:b.uScale,null===b||void 0===b?void 0:b.vScale)},getTarget:F,set:(a,n,L,d)=>{const b=N(n,d,g,i);b.uScale=a.x,b.vScale=a.y},getPropertyName:[()=>`${g}${i?"."+i:""}.uScale`,()=>`${g}${i?"."+i:""}.vScale`]}}}const j={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:g=>{var i,a;return new n.Vector2((null===(i=g._babylonCamera)||void 0===i?void 0:i.orthoLeft)??0,(null===(a=g._babylonCamera)||void 0===a?void 0:a.orthoRight)??0)},set:(g,i)=>{i._babylonCamera&&(i._babylonCamera.orthoLeft=g.x,i._babylonCamera.orthoRight=g.y)},getTarget:g=>g,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:g=>{var i,a;return new n.Vector2((null===(i=g._babylonCamera)||void 0===i?void 0:i.orthoBottom)??0,(null===(a=g._babylonCamera)||void 0===a?void 0:a.orthoTop)??0)},set:(g,i)=>{i._babylonCamera&&(i._babylonCamera.orthoBottom=g.x,i._babylonCamera.orthoTop=g.y)},getTarget:g=>g,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:g=>{var i;return null===(i=g._babylonCamera)||void 0===i?void 0:i.maxZ},set:(g,i)=>{i._babylonCamera&&(i._babylonCamera.maxZ=g)},getTarget:g=>g,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:g=>{var i;return null===(i=g._babylonCamera)||void 0===i?void 0:i.Vd},set:(g,i)=>{i._babylonCamera&&(i._babylonCamera.Vd=g)},getTarget:g=>g,getPropertyName:[()=>"Vd"]}},perspective:{aspectRatio:{type:"number",get:g=>{var i;return null===(i=g._babylonCamera)||void 0===i?void 0:i.getEngine().getAspectRatio(g._babylonCamera)},getTarget:g=>g,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:g=>{var i;return null===(i=g._babylonCamera)||void 0===i?void 0:i.fov},set:(g,i)=>{i._babylonCamera&&(i._babylonCamera.fov=g)},getTarget:g=>g,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:g=>{var i;return null===(i=g._babylonCamera)||void 0===i?void 0:i.maxZ},set:(g,i)=>{i._babylonCamera&&(i._babylonCamera.maxZ=g)},getTarget:g=>g,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:g=>{var i;return null===(i=g._babylonCamera)||void 0===i?void 0:i.Vd},set:(g,i)=>{i._babylonCamera&&(i._babylonCamera.Vd=g)},getTarget:g=>g,getPropertyName:[()=>"Vd"]}}}},nodes:{length:{type:"number",get:g=>g.length,getTarget:g=>g.map((g=>g._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Bi",get:g=>{var i;return null===(i=g._babylonTransformNode)||void 0===i?void 0:i.position},set:(g,i)=>{var a;return null===(a=i._babylonTransformNode)||void 0===a?void 0:a.position.I(g)},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:g=>{var i;return null===(i=g._babylonTransformNode)||void 0===i?void 0:i.rotationQuaternion},set:(g,i)=>{var a,n;return null===(a=i._babylonTransformNode)||void 0===a||null===(n=a.rotationQuaternion)||void 0===n?void 0:n.I(g)},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Bi",get:g=>{var i;return null===(i=g._babylonTransformNode)||void 0===i?void 0:i.rd},set:(g,i)=>{var a;return null===(a=i._babylonTransformNode)||void 0===a?void 0:a.rd.I(g)},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"rd"]},weights:{length:{type:"number",get:g=>g._numMorphTargets,getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(g,i)=>{var a,n;return void 0!==i?null===(a=g._primitiveBabylonMeshes)||void 0===a||null===(n=a[0].morphTargetManager)||void 0===n?void 0:n.getTarget(i).influence:void 0},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(g,i)=>[0],getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:g=>{var i,a,L;return n.Matrix.Compose(null===(i=g._babylonTransformNode)||void 0===i?void 0:i.rd,null===(a=g._babylonTransformNode)||void 0===a?void 0:a.rotationQuaternion,null===(L=g._babylonTransformNode)||void 0===L?void 0:L.position)},getTarget:g=>g._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:g=>{var i,a,L,d;const b=n.Matrix.Identity();let k=g.parent;for(;k&&k.parent;)k=k.parent;const e=(null===(i=g._babylonTransformNode)||void 0===i?void 0:i.position._isDirty)||(null===(a=g._babylonTransformNode)||void 0===a||null===(L=a.rotationQuaternion)||void 0===L?void 0:L._isDirty)||(null===(d=g._babylonTransformNode)||void 0===d?void 0:d.rd._isDirty);if(k){var N;const i=null===(N=k._babylonTransformNode)||void 0===N?void 0:N.Zd(!0).invert();var F,I;if(i)null===(F=g._babylonTransformNode)||void 0===F||null===(I=F.Zd(e))||void 0===I||I.multiplyToRef(i,b)}else g._babylonTransformNode&&b.I(g._babylonTransformNode.Zd(e));return b},getTarget:g=>g._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:g=>{var i,a;return null===(i=g._babylonTransformNode)||void 0===i||null===(a=i.getChildren((g=>g instanceof b.c),!0)[0])||void 0===a?void 0:a.ib},getTarget:g=>{var i;return null===(i=g._babylonTransformNode)||void 0===i?void 0:i.getChildren((g=>g instanceof b.c),!0)[0]},set:(g,i)=>{if(i._babylonTransformNode){const a=i._babylonTransformNode.getChildren((g=>g instanceof b.c),!0)[0];a&&(a.ib=g)}}},color:{type:"Ri",get:g=>{var i,a;return null===(i=g._babylonTransformNode)||void 0===i||null===(a=i.getChildren((g=>g instanceof b.c),!0)[0])||void 0===a?void 0:a.ab},getTarget:g=>{var i;return null===(i=g._babylonTransformNode)||void 0===i?void 0:i.getChildren((g=>g instanceof b.c),!0)[0]},set:(g,i)=>{if(i._babylonTransformNode){const a=i._babylonTransformNode.getChildren((g=>g instanceof b.c),!0)[0];a&&(a.ab=g)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Ri",get:(g,i,a)=>F(g,i,a).emissiveColor,set:(g,i,a,n)=>F(i,a,n).emissiveColor.I(g),getTarget:(g,i,a)=>F(g,i,a),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:I("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(g,i,a)=>{var n;return null===(n=N(g,a,"bumpTexture"))||void 0===n?void 0:n.level},set:(g,i,a,n)=>{const L=N(i,n,"bumpTexture");L&&(L.level=g)},getTarget:(g,i,a)=>F(g,i,a),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:I("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(g,i,a)=>F(g,i,a).ambientTextureStrength,set:(g,i,a,n)=>{const L=F(i,a,n);L&&(L.ambientTextureStrength=g)},getTarget:(g,i,a)=>F(g,i,a),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:I("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Hd",get:(g,i,a)=>{const n=F(g,i,a);return d.Hd.FromColor3(n.albedoColor,n.alpha)},set:(g,i,a,n)=>{const L=F(i,a,n);L.albedoColor.set(g.r,g.g,g.b),L.alpha=g.a},getTarget:(g,i,a)=>F(g,i,a),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:I("albedoTexture")}},metallicFactor:{type:"number",get:(g,i,a)=>F(g,i,a).metallic,set:(g,i,a,n)=>{const L=F(i,a,n);L&&(L.metallic=g)},getTarget:(g,i,a)=>F(g,i,a),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(g,i,a)=>F(g,i,a).roughness,set:(g,i,a,n)=>{const L=F(i,a,n);L&&(L.roughness=g)},getTarget:(g,i,a)=>F(g,i,a),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:I("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(g,i,a)=>F(g,i,a).anisotropy.ib,set:(g,i,a,n)=>{F(i,a,n).anisotropy.ib=g},getTarget:(g,i,a)=>F(g,i,a),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(g,i,a)=>F(g,i,a).anisotropy.angle,set:(g,i,a,n)=>{F(i,a,n).anisotropy.angle=g},getTarget:(g,i,a)=>F(g,i,a),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:I("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(g,i,a)=>F(g,i,a).clearCoat.ib,set:(g,i,a,n)=>{F(i,a,n).clearCoat.ib=g},getTarget:(g,i,a)=>F(g,i,a),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(g,i,a)=>F(g,i,a).clearCoat.roughness,set:(g,i,a,n)=>{F(i,a,n).clearCoat.roughness=g},getTarget:(g,i,a)=>F(g,i,a),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:I("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(g,i,a)=>{var n;return null===(n=F(g,i,a).clearCoat.bumpTexture)||void 0===n?void 0:n.level},getTarget:F,set:(g,i,a,n)=>F(i,a,n).clearCoat.bumpTexture.level=g},extensions:{KHR_texture_transform:I("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:I("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(g,i,a)=>F(g,i,a).subSurface.dispersion,getTarget:F,set:(g,i,a,n)=>F(i,a,n).subSurface.dispersion=g}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(g,i,a)=>F(g,i,a).emissiveIntensity,getTarget:F,set:(g,i,a,n)=>F(i,a,n).emissiveIntensity=g}},KHR_materials_ior:{ior:{type:"number",get:(g,i,a)=>F(g,i,a).indexOfRefraction,getTarget:F,set:(g,i,a,n)=>F(i,a,n).indexOfRefraction=g}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(g,i,a)=>F(g,i,a).iridescence.ib,getTarget:F,set:(g,i,a,n)=>F(i,a,n).iridescence.ib=g},iridescenceIor:{type:"number",get:(g,i,a)=>F(g,i,a).iridescence.indexOfRefraction,getTarget:F,set:(g,i,a,n)=>F(i,a,n).iridescence.indexOfRefraction=g},iridescenceTexture:{extensions:{KHR_texture_transform:I("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(g,i,a)=>F(g,i,a).iridescence.maximumThickness,getTarget:F,set:(g,i,a,n)=>F(i,a,n).iridescence.maximumThickness=g},iridescenceThicknessMinimum:{type:"number",get:(g,i,a)=>F(g,i,a).iridescence.minimumThickness,getTarget:F,set:(g,i,a,n)=>F(i,a,n).iridescence.minimumThickness=g},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:I("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Ri",get:(g,i,a)=>F(g,i,a).sheen.color,getTarget:F,set:(g,i,a,n)=>F(i,a,n).sheen.color.I(g)},sheenColorTexture:{extensions:{KHR_texture_transform:I("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(g,i,a)=>F(g,i,a).sheen.ib,getTarget:F,set:(g,i,a,n)=>F(i,a,n).sheen.ib=g},sheenRoughnessTexture:{extensions:{KHR_texture_transform:I("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(g,i,a)=>F(g,i,a).metallicF0Factor,getTarget:F,set:(g,i,a,n)=>F(i,a,n).metallicF0Factor=g,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Ri",get:(g,i,a)=>F(g,i,a).metallicReflectanceColor,getTarget:F,set:(g,i,a,n)=>F(i,a,n).metallicReflectanceColor.I(g),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:I("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:I("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(g,i,a)=>F(g,i,a).subSurface.refractionIntensity,getTarget:F,set:(g,i,a,n)=>F(i,a,n).subSurface.refractionIntensity=g,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:I("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(g,i,a)=>F(g,i,a).subSurface.translucencyIntensity,getTarget:F,set:(g,i,a,n)=>F(i,a,n).subSurface.translucencyIntensity=g},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:I("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Ri",get:(g,i,a)=>F(g,i,a).subSurface.translucencyColor,getTarget:F,set:(g,i,a,n)=>{var L;return g&&(null===(L=F(i,a,n).subSurface.translucencyColor)||void 0===L?void 0:L.I(g))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:I("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Ri",get:(g,i,a)=>F(g,i,a).subSurface.tintColor,getTarget:F,set:(g,i,a,n)=>F(i,a,n).subSurface.tintColor.I(g)},attenuationDistance:{type:"number",get:(g,i,a)=>F(g,i,a).subSurface.tintColorAtDistance,getTarget:F,set:(g,i,a,n)=>F(i,a,n).subSurface.tintColorAtDistance=g},thicknessFactor:{type:"number",get:(g,i,a)=>F(g,i,a).subSurface.maximumThickness,getTarget:F,set:(g,i,a,n)=>F(i,a,n).subSurface.maximumThickness=g},thicknessTexture:{extensions:{KHR_texture_transform:I("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:g=>g.length,getTarget:g=>g.map((g=>g._babylonLight)),getPropertyName:[g=>"length"]},__array__:{__target__:!0,color:{type:"Ri",get:g=>{var i;return null===(i=g._babylonLight)||void 0===i?void 0:i.ab},set:(g,i)=>{var a;return null===(a=i._babylonLight)||void 0===a?void 0:a.ab.I(g)},getTarget:g=>g._babylonLight,getPropertyName:[g=>"diffuse"]},ib:{type:"number",get:g=>{var i;return null===(i=g._babylonLight)||void 0===i?void 0:i.ib},set:(g,i)=>i._babylonLight?i._babylonLight.ib=g:void 0,getTarget:g=>g._babylonLight,getPropertyName:[g=>"intensity"]},range:{type:"number",get:g=>{var i;return null===(i=g._babylonLight)||void 0===i?void 0:i.range},set:(g,i)=>i._babylonLight?i._babylonLight.range=g:void 0,getTarget:g=>g._babylonLight,getPropertyName:[g=>"range"]},spot:{innerConeAngle:{type:"number",get:g=>{var i;return null===(i=g._babylonLight)||void 0===i?void 0:i.innerAngle},set:(g,i)=>i._babylonLight?i._babylonLight.innerAngle=g:void 0,getTarget:g=>g._babylonLight,getPropertyName:[g=>"innerConeAngle"]},outerConeAngle:{type:"number",get:g=>{var i;return null===(i=g._babylonLight)||void 0===i?void 0:i.angle},set:(g,i)=>i._babylonLight?i._babylonLight.angle=g:void 0,getTarget:g=>g._babylonLight,getPropertyName:[g=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:g=>g.length,getTarget:g=>g.map((g=>g._babylonLight)),getPropertyName:[g=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:g=>g.length,getTarget:g=>g.map((g=>g._babylonTexture)),getPropertyName:[g=>"length"]},__array__:{__target__:!0,ib:{type:"number",get:g=>{var i;return null===(i=g._babylonTexture)||void 0===i?void 0:i.level},set:(g,i)=>{i._babylonTexture&&(i._babylonTexture.level=g)},getTarget:g=>g._babylonTexture},rotation:{type:"Quaternion",get:g=>{var i;return g._babylonTexture&&n.Quaternion.FromRotationMatrix(null===(i=g._babylonTexture)||void 0===i?void 0:i.getReflectionTextureMatrix())},set:(g,i)=>{var a;i._babylonTexture&&(null!==(a=i._babylonTexture.Pg())&&void 0!==a&&a.useRightHandedSystem||(g=n.Quaternion.Inverse(g)),n.Matrix.FromQuaternionToRef(g,i._babylonTexture.getReflectionTextureMatrix()))},getTarget:g=>g._babylonTexture}}}}},animations:{length:{type:"number",get:g=>g.length,getTarget:g=>g.map((g=>g._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:g=>g.length,getTarget:g=>g.map((g=>{var i;return null===(i=g.primitives[0]._instanceData)||void 0===i?void 0:i.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function y(g){return new e(g,j)}function B(g){const i=g.split("/").map((g=>g.replace(/{}/g,"__array__")));let a=j;for(const n of i)n&&(a=a[n]);if(a&&a.type&&a.get)return a}function c(g,i){const a=g.split("/").map((g=>g.replace(/{}/g,"__array__")));let n=j;for(const L of a)L&&(n=n[L]);n&&n.type&&n.get&&(n.interpolation=i)}function D(g,i){const a=g.split("/").map((g=>g.replace(/{}/g,"__array__")));let n=j;for(const L of a)if(L){if(!n[L]){if("?"===L){n.__ignoreObjectTree__=!0;continue}n[L]={},"__array__"===L&&(n[L].__target__=!0)}n=n[L]}Object.assign(n,i)}},14150:(g,i,a)=>{"use strict";a.r(i),a.d(i,{AnimationPropertyInfo:()=>N,TransformNodeAnimationPropertyInfo:()=>F,WeightAnimationPropertyInfo:()=>I,getQuaternion:()=>k,getVector3:()=>b,getWeights:()=>e});var n=a(12994),L=a(12452),d=a(14136);function b(g,i,a,n){return L.Bi.xi(i,a).scaleInPlace(n)}function k(g,i,a,n){return L.Quaternion.xi(i,a).scaleInPlace(n)}function e(g,i,a,n){const L=new Array(g._numMorphTargets);for(let d=0;d<L.length;d++)L[d]=i[a++]*n;return L}class N{constructor(g,i,a,n){this.type=g,this.name=i,this.getValue=a,this.getStride=n}_buildAnimation(g,i,a){const L=new n.b(g,this.name,i,this.type);return L.setKeys(a),L}}class F extends N{buildAnimations(g,i,a,n){const L=[];return L.push({babylonAnimatable:g._babylonTransformNode,babylonAnimation:this._buildAnimation(i,a,n)}),L}}class I extends N{buildAnimations(g,i,a,L){const d=[];if(g._numMorphTargets)for(let b=0;b<g._numMorphTargets;b++){const k=new n.b(`${i}_${b}`,this.name,a,this.type);if(k.setKeys(L.map((g=>({frame:g.frame,inTangent:g.inTangent?g.inTangent[b]:void 0,value:g.value[b],outTangent:g.outTangent?g.outTangent[b]:void 0,interpolation:g.interpolation})))),g._primitiveBabylonMeshes)for(const i of g._primitiveBabylonMeshes)if(i.morphTargetManager){const g=i.morphTargetManager.getTarget(b),a=k.clone();g.animations.push(a),d.push({babylonAnimatable:g,babylonAnimation:a})}}return d}}(0,d.l)("/nodes/{}/translation",[new F(n.b.ANIMATIONTYPE_VECTOR3,"position",b,(()=>3))]),(0,d.l)("/nodes/{}/rotation",[new F(n.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",k,(()=>4))]),(0,d.l)("/nodes/{}/scale",[new F(n.b.ANIMATIONTYPE_VECTOR3,"rd",b,(()=>3))]),(0,d.l)("/nodes/{}/weights",[new I(n.b.ANIMATIONTYPE_FLOAT,"influence",e,(g=>g._numMorphTargets))])},14101:(g,i,a)=>{"use strict";class n{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((g,i)=>{this._resolve=g,this._reject=i}))}}var L=a(12452),d=a(12496),b=a(12277),k=a(12916),e=a(14106),N=a(14115),F=a(12286),I=a(12943),j=a(12994),y=a(12996),B=a(12316),c=a(12292),D=a(12296);class p{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(g){this._useTextureToStoreBoneMatrices=g,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(g){this._animationPropertiesOverride=g}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(g,i,a){this.name=g,this.id=i,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=L.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new F.b,this.bones=[],this._scene=a||B.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const n=this._scene.getEngine().getCaps();this._canUseTextureForBones=n.textureFloat&&n.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((g=>!g.getParent()))}getTransformMatrices(g){if(this.needInitialSkinMatrix){if(!g)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return g._bonesTransformMatrices||this.prepare(!0),g._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(g){return this.needInitialSkinMatrix&&g._transformMatrixTexture?g._transformMatrixTexture:this._transformMatrixTexture}Pg(){return this._scene}toString(g){let i=`Name: ${this.name}, nBones: ${this.bones.length}`;if(i+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,g){i+=", Ranges: {";let g=!0;for(const a in this._ranges)g&&(i+=", ",g=!1),i+=a;i+="}"}return i}getBoneIndexByName(g){for(let i=0,a=this.bones.length;i<a;i++)if(this.bones[i].name===g)return i;return-1}createAnimationRange(g,i,a){if(!this._ranges[g]){this._ranges[g]=new y.d(g,i,a);for(let n=0,L=this.bones.length;n<L;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].createRange(g,i,a)}}deleteAnimationRange(g){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let a=0,n=this.bones.length;a<n;a++)this.bones[a].animations[0]&&this.bones[a].animations[0].deleteRange(g,i);this._ranges[g]=null}getAnimationRange(g){return this._ranges[g]||null}getAnimationRanges(){const g=[];let i;for(i in this._ranges)g.push(this._ranges[i]);return g}copyAnimationRange(g,i){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[i]||!g.getAnimationRange(i))return!1;let n=!0;const L=this._getHighestAnimationFrame()+1,d={},b=g.bones;let k,e;for(e=0,k=b.length;e<k;e++)d[b[e].name]=b[e];this.bones.length!==b.length&&(c.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${b.length}`),n=!1);const N=a&&this.dimensionsAtRest&&g.dimensionsAtRest?this.dimensionsAtRest.divide(g.dimensionsAtRest):null;for(e=0,k=this.bones.length;e<k;e++){const g=this.bones[e].name,b=d[g];b?n=n&&this.bones[e].copyAnimationRange(b,i,L,a,N):(c.b.Warn("copyAnimationRange: not same rig, missing source bone "+g),n=!1)}const F=g.getAnimationRange(i);return F&&(this._ranges[i]=new y.d(i,F.from+L,F.to+L)),n}returnToRest(){for(const g of this.bones)-1!==g._index&&g.returnToRest()}_getHighestAnimationFrame(){let g=0;for(let i=0,a=this.bones.length;i<a;i++)if(this.bones[i].animations[0]){const a=this.bones[i].animations[0].getHighestFrame();g<a&&(g=a)}return g}beginAnimation(g,i,a,n){const L=this.getAnimationRange(g);return L?this._scene.beginAnimation(this,L.from,L.to,i,a,n):null}static MakeAnimationAdditive(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;const n=g.getAnimationRange(a);if(!n)return null;const L=g._scene.getAllAnimatablesByTarget(g);let d=null;for(let k=0;k<L.length;k++){const g=L[k];if(g.fromFrame===(null===n||void 0===n?void 0:n.from)&&g.toFrame===(null===n||void 0===n?void 0:n.to)){d=g;break}}const b=g.getAnimatables();for(let k=0;k<b.length;k++){const g=b[k].animations;if(g)for(let n=0;n<g.length;n++)j.b.MakeAnimationAdditive(g[n],i,a)}return d&&(d.isAdditive=!0),g}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(g){this._meshesWithPoseMatrix.push(g)}_unregisterMeshWithPoseMatrix(g){const i=this._meshesWithPoseMatrix.indexOf(g);i>-1&&this._meshesWithPoseMatrix.splice(i,1)}_computeTransformMatrices(g,i){this.onBeforeComputeObservable.notifyObservers(this);for(let a=0;a<this.bones.length;a++){const n=this.bones[a];n._childUpdateId++;const L=n.getParent();if(L?n.getLocalMatrix().multiplyToRef(L.getFinalMatrix(),n.getFinalMatrix()):i?n.getLocalMatrix().multiplyToRef(i,n.getFinalMatrix()):n.getFinalMatrix().I(n.getLocalMatrix()),-1!==n._index){const i=null===n._index?a:n._index;n.getAbsoluteInverseBindMatrix().multiplyToArray(n.getFinalMatrix(),g,16*i)}}this._identity.copyToArray(g,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const g=this.Pg().getRenderId();if(this._currentRenderId===g)return;this._currentRenderId=g}if(this._numBonesWithLinkedTransformNode>0)for(const g of this.bones)if(g._linkedTransformNode){const i=g._linkedTransformNode;g.position=i.position,i.rotationQuaternion?g.rotationQuaternion=i.rotationQuaternion:g.rotation=i.rotation,g.rd=i.rd}if(this.needInitialSkinMatrix)for(const g of this._meshesWithPoseMatrix){const i=g.getPoseMatrix();let a=this._isDirty;if(g._bonesTransformMatrices&&g._bonesTransformMatrices.length===16*(this.bones.length+1)||(g._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),a=!0),a){if(this._synchronizedWithMesh!==g){this._synchronizedWithMesh=g;for(const g of this.bones)if(!g.getParent()){g.getBindMatrix().multiplyToRef(i,L.TmpVectors.Matrix[1]),g._updateAbsoluteBindMatrices(L.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const i=4*(this.bones.length+1);g._transformMatrixTexture&&g._transformMatrixTexture.getSize().width===i||(g._transformMatrixTexture&&g._transformMatrixTexture.dispose(),g._transformMatrixTexture=I.b.CreateRGBATexture(g._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(g._bonesTransformMatrices,i),this.isUsingTextureForMatrices&&g._transformMatrixTexture&&g._transformMatrixTexture.update(g._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=I.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let g=0;g<this.bones.length;g++)this._animatables.push(this.bones[g])}return this._animatables}clone(g,i){const a=new p(g,i||g,this._scene);a.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let n=0;n<this.bones.length;n++){const g=this.bones[n];let i=null;const L=g.getParent();if(L){const g=this.bones.indexOf(L);i=a.bones[g]}const d=new N.d(g.name,a,i,g.getBindMatrix().clone(),g.getRestMatrix().clone());d._index=g._index,g._linkedTransformNode&&d.linkTransformNode(g._linkedTransformNode),D.c.DeepCopy(g.animations,d.animations)}if(this._ranges){a._ranges={};for(const g in this._ranges){const i=this._ranges[g];i&&(a._ranges[g]=i.clone())}}return this._isDirty=!0,a.prepare(!0),a}enableBlending(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const i of this.bones)for(const a of i.animations)a.enableBlending=!0,a.blendingSpeed=g}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Pg().stopAnimation(this),this.Pg().removeSkeleton(this),this._parentContainer){const g=this._parentContainer.skeletons.indexOf(this);g>-1&&this._parentContainer.skeletons.splice(g,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const g={};g.name=this.name,g.id=this.id,this.dimensionsAtRest&&(g.dimensionsAtRest=this.dimensionsAtRest.fd()),g.bones=[],g.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let a=0;a<this.bones.length;a++){var i;const n=this.bones[a],L=n.getParent(),d={parentBoneIndex:L?this.bones.indexOf(L):-1,index:n.getIndex(),name:n.name,id:n.id,matrix:n.getBindMatrix().fd(),rest:n.getRestMatrix().fd(),linkedTransformNodeId:null===(i=n.getTransformNode())||void 0===i?void 0:i.id};g.bones.push(d),n.length&&(d.length=n.length),n.metadata&&(d.metadata=n.metadata),n.animations&&n.animations.length>0&&(d.animation=n.animations[0].serialize()),g.ranges=[];for(const i in this._ranges){const a=this._ranges[i];if(!a)continue;const n={};n.name=i,n.from=a.from,n.to=a.to,g.ranges.push(n)}}return g}static Parse(g,i){const a=new p(g.name,g.id,i);let n;for(g.dimensionsAtRest&&(a.dimensionsAtRest=L.Bi.xi(g.dimensionsAtRest)),a.needInitialSkinMatrix=g.needInitialSkinMatrix,n=0;n<g.bones.length;n++){const i=g.bones[n],d=g.bones[n].index;let b=null;i.parentBoneIndex>-1&&(b=a.bones[i.parentBoneIndex]);const k=i.rest?L.Matrix.xi(i.rest):null,e=new N.d(i.name,a,b,L.Matrix.xi(i.matrix),k,null,d);void 0!==i.id&&null!==i.id&&(e.id=i.id),i.length&&(e.length=i.length),i.metadata&&(e.metadata=i.metadata),i.animation&&e.animations.push(j.b.Parse(i.animation)),void 0!==i.linkedTransformNodeId&&null!==i.linkedTransformNodeId&&(a._hasWaitingData=!0,e._waitingTransformNodeId=i.linkedTransformNodeId)}if(g.ranges)for(n=0;n<g.ranges.length;n++){const i=g.ranges[n];a.createAnimationRange(i.name,i.from,i.to)}return a}computeAbsoluteMatrices(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||g)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(g)}getPoseMatrix(){let g=null;return this._meshesWithPoseMatrix.length>0&&(g=this._meshesWithPoseMatrix[0].getPoseMatrix()),g}sortBones(){const g=[],i=new Array(this.bones.length);for(let a=0;a<this.bones.length;a++)this._sortBones(a,g,i);this.bones=g}_sortBones(g,i,a){if(a[g])return;a[g]=!0;const n=this.bones[g];if(!n)return;void 0===n._index&&(n._index=g);const L=n.getParent();L&&this._sortBones(this.bones.indexOf(L),i,a),i.push(n)}setCurrentPoseAsRest(){for(const g of this.bones)g.setCurrentPoseAsRest()}}var R=a(12778),x=a(12959),E=a(12436),X=a(12879),v=a(12526),P=a(12924),Y=a(12894),f=a(12910),C=a(12998),U=a(12541),S=a(14058);class V{set areUpdatesFrozen(g){g?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new U.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,g||(g=B.c.LastCreatedScene),this._scene=g,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const g=this._scene.getEngine().getCaps();this._canUseTextureForTargets=g.canUseGLVertexID&&g.textureFloat&&g.maxVertexTextureImageUnits>0&&g.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return V.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?V.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(g){this._numMaxInfluencers!==g&&(this._numMaxInfluencers=g,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(g){this._useTextureToStoreTargets!==g&&(this._useTextureToStoreTargets=g,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var g;return V.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(g=this._scene)&&void 0!==g&&g.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(g){return this._activeTargets.data[g]}getTarget(g){return this._targets[g]}getTargetByName(g){for(const i of this._targets)if(i.name===g)return i;return null}addTarget(g){this._targets.push(g),this._targetInfluenceChangedObservers.push(g.onInfluenceChanged.add((g=>{this.areUpdatesFrozen&&g&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(g)}))),this._targetDataLayoutChangedObservers.push(g._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(g){const i=this._targets.indexOf(g);i>=0&&(this._targets.splice(i,1),g.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(i,1)[0]),g._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(i,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(g)}_bind(g){g.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),g.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),g.setTexture("morphTargets",this._targetStoreTexture),g.setInt("morphTargetCount",this.numInfluencers)}clone(){const g=new V(this._scene);for(const i of this._targets)g.addTarget(i.clone());return g.enablePositionMorphing=this.enablePositionMorphing,g.enableNormalMorphing=this.enableNormalMorphing,g.enableTangentMorphing=this.enableTangentMorphing,g.enableUVMorphing=this.enableUVMorphing,g.enableUV2Morphing=this.enableUV2Morphing,g.enableColorMorphing=this.enableColorMorphing,g}serialize(){const g={};g.id=this.uniqueId,g.targets=[];for(const i of this._targets)g.targets.push(i.serialize());return g}_syncActiveTargets(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const i=!!this._targetStoreTexture,a=this.isUsingTextureForTargets;(this._mustSynchronize||i!==a)&&(this._mustSynchronize=!1,this.synchronize());let n=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let L=-1;for(const d of this._targets)if(L++,0!==d.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=V.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(d),this._morphTargetTextureIndices[n]=L,this._tempInfluences[n++]=d.influence}this._morphTargetTextureIndices.length!==n&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,n)),this._influences&&this._influences.length===n||(this._influences=new Float32Array(n));for(let d=0;d<n;d++)this._influences[d]=this._tempInfluences[d];if(g&&this._scene)for(const d of this._scene.meshes)d.morphTargetManager===this&&(a?d._markSubMeshesAsAttributesDirty():d._syncGeometryWithMorphTargetManager())}synchronize(){var g;if(!this._scene||this.areUpdatesFrozen)return;const i=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(g=this._targetStoreTexture)||void 0===g||g.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>i.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const a of this._targets){this._supportsPositions=this._supportsPositions&&a.hasPositions,this._supportsNormals=this._supportsNormals&&a.hasNormals,this._supportsTangents=this._supportsTangents&&a.hasTangents,this._supportsUVs=this._supportsUVs&&a.hasUVs,this._supportsUV2s=this._supportsUV2s&&a.hasUV2s,this._supportsColors=this._supportsColors&&a.hasColors;const g=a.vertexCount;if(0===this._vertexCount)this._vertexCount=g;else if(this._vertexCount!==g)return void c.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${a.name}": ${g}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const g=i.getCaps().maxTextureSize;this._textureWidth>g&&(this._textureHeight=Math.ceil(this._textureWidth/g),this._textureWidth=g);const a=this._targets.length,n=new Float32Array(a*this._textureWidth*this._textureHeight*4);let L=0;for(let i=0;i<a;i++){const g=this._targets[i],a=g.getPositions(),d=g.getNormals(),b=g.getUVs(),k=g.getTangents(),e=g.getUV2s(),N=g.getColors();L=i*this._textureWidth*this._textureHeight*4;for(let i=0;i<this._vertexCount;i++)this._supportsPositions&&a&&(n[L]=a[3*i],n[L+1]=a[3*i+1],n[L+2]=a[3*i+2],L+=4),this._supportsNormals&&d&&(n[L]=d[3*i],n[L+1]=d[3*i+1],n[L+2]=d[3*i+2],L+=4),this._supportsUVs&&b&&(n[L]=b[2*i],n[L+1]=b[2*i+1],L+=4),this._supportsTangents&&k&&(n[L]=k[3*i],n[L+1]=k[3*i+1],n[L+2]=k[3*i+2],L+=4),this._supportsUV2s&&e&&(n[L]=e[2*i],n[L+1]=e[2*i+1],L+=4),this._supportsColors&&N&&(n[L]=N[4*i],n[L+1]=N[4*i+1],n[L+2]=N[4*i+2],n[L+3]=N[4*i+3],L+=4)}this._targetStoreTexture=S.d.CreateRGBATexture(n,this._textureWidth,this._textureHeight,a,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const a of this._scene.meshes)a.morphTargetManager===this&&a._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const g=this._parentContainer.morphTargetManagers.indexOf(this);g>-1&&this._parentContainer.morphTargetManagers.splice(g,1),this._parentContainer=null}for(const g of this._targets)this._scene.stopAnimation(g)}}static Parse(g,i){const a=new V(i);for(const n of g.targets)a.addTarget(C.c.Parse(n,i));return a}}V.EnableTextureStorage=!0,V.MaxActiveMorphTargetsInVertexAttributeMode=8,V.ConstantTargetCountForTextureMode=0;var K=a(14124),T=a(12324),l=a(12791);const Z=new Map,h=Z;function w(g,i,a){t(g)&&c.b.Warn(`Extension with the name '${g}' already exists`),Z.set(g,{isGLTFExtension:i,factory:a})}function t(g){return Z.delete(g)}var A=a(14136),O=a(13061),z=a(12534);class s{static Get(g,i,a){if(!i||void 0==a||!i[a])throw new Error(`${g}: Failed to find index (${a})`);return i[a]}static TryGet(g,i){return g&&void 0!=i&&g[i]?g[i]:null}static Assign(g){if(g)for(let i=0;i<g.length;i++)g[i].index=i}}function mg(g){if(g.min&&g.max){const i=g.min,a=g.max,n=L.TmpVectors.Bi[0].sd(i[0],i[1],i[2]),d=L.TmpVectors.Bi[1].sd(a[0],a[1],a[2]);if(g.normalized&&5126!==g.componentType){let i=1;switch(g.componentType){case 5120:i=127;break;case 5121:i=255;break;case 5122:i=32767;break;case 5123:i=65535}const a=1/i;n.scaleInPlace(a),d.scaleInPlace(a)}return new l.c(n,d)}return null}class r{static RegisterExtension(g,i){w(g,!1,i)}static UnregisterExtension(g){return t(g)}get Dd(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(g){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=g}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((g=>g.dispose&&g.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(g,i,a,n,L,d){let b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=i,this._assetContainer=a,this._loadData(n);let d=null;if(g){const i={};if(this._gltf.nodes)for(const g of this._gltf.nodes)g.name&&(i[g.name]=g.index);d=(g instanceof Array?g:[g]).map((g=>{const a=i[g];if(void 0===a)throw new Error(`Failed to find node '${g}'`);return a}))}return await this._loadAsync(L,b,d,(()=>({meshes:this._getMeshes(),Wj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=g,this._loadData(i),await this._loadAsync(a,L,null,(()=>{}))}async _loadAsync(g,i,a,n){return await Promise.resolve().then((async()=>{this._rootUrl=g,this._uniqueRootUrl=!g.startsWith("file:")&&i?g:`${g}${Date.now()}/`,this._fileName=i,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const L=`${K.j[K.j.LOADING]} => ${K.j[K.j.READY]}`,d=`${K.j[K.j.LOADING]} => ${K.j[K.j.COMPLETE]}`;this._parent._startPerformanceCounter(L),this._parent._startPerformanceCounter(d),this._parent._setState(K.j.LOADING),this._extensionsOnLoading();const k=new Array;if(!this.parent.loadOnlyMaterials)if(a)k.push(this.loadSceneAsync("/nodes",{nodes:a,index:-1}));else if(void 0!=this._gltf.Di||this._gltf.scenes&&this._gltf.scenes[0]){const g=s.Get("/scene",this._gltf.scenes,this._gltf.Di||0);k.push(this.loadSceneAsync(`/scenes/${g.index}`,g))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let g=0;g<this._gltf.materials.length;++g){const i=this._gltf.materials[g],a="/materials/"+g,n=R.c.TriangleFillMode;k.push(this._loadMaterialAsync(a,i,null,n,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&k.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&k.push(this._compileShadowGeneratorsAsync());const e=Promise.all(k).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.oe(!0);for(const g of this._babylonScene.materials){const i=g;void 0!==i.maxSimultaneousLights&&(i.maxSimultaneousLights=Math.max(i.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(K.j.READY),this._skipStartAnimationStep||this._startAnimations(),n()}));return await e.then((g=>(this._parent._endPerformanceCounter(L),b.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(d),this._parent._setState(K.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(g=>{this._parent.onErrorObservable.notifyObservers(g),this._parent.onErrorObservable.clear(),this.dispose()}))})),g)))})).catch((g=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(g),this._parent.onErrorObservable.clear(),this.dispose()),g}))}_loadData(g){if(this._gltf=g.json,this._setupData(),g.bin){const i=this._gltf.buffers;if(i&&i[0]&&!i[0].uri){const a=i[0];(a.byteLength<g.bin.byteLength-3||a.byteLength>g.bin.byteLength)&&c.b.Warn(`Binary buffer length (${a.byteLength}) from JSON does not match chunk length (${g.bin.byteLength})`),this._bin=g.bin}else c.b.Warn("Unexpected BIN chunk")}}_setupData(){if(s.Assign(this._gltf.accessors),s.Assign(this._gltf.animations),s.Assign(this._gltf.buffers),s.Assign(this._gltf.bufferViews),s.Assign(this._gltf.cameras),s.Assign(this._gltf.images),s.Assign(this._gltf.materials),s.Assign(this._gltf.meshes),s.Assign(this._gltf.nodes),s.Assign(this._gltf.samplers),s.Assign(this._gltf.scenes),s.Assign(this._gltf.skins),s.Assign(this._gltf.textures),this._gltf.nodes){const g={};for(const a of this._gltf.nodes)if(a.children)for(const i of a.children)g[i]=a.index;const i=this._createRootNode();for(const a of this._gltf.nodes){const n=g[a.index];a.parent=void 0===n?i:this._gltf.nodes[n]}}}async _loadExtensionsAsync(){const g=[];if(h.forEach(((i,a)=>{var n;!1===(null===(n=this.parent.extensionOptions[a])||void 0===n?void 0:n.enabled)?i.isGLTFExtension&&this.isExtensionUsed(a)&&c.b.Warn(`Extension ${a} is used but has been explicitly disabled.`):i.isGLTFExtension&&!this.isExtensionUsed(a)||g.push((async()=>{const g=await i.factory(this);return g.name!==a&&c.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${g.name} !== ${a}`),this._parent.onExtensionLoadedObservable.notifyObservers(g),g})())})),this._extensions.push(...await Promise.all(g)),this._extensions.sort(((g,i)=>(g.order||Number.MAX_VALUE)-(i.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const a of this._gltf.extensionsRequired){if(!this._extensions.some((g=>g.name===a&&g.enabled))){var i;if(!1===(null===(i=this.parent.extensionOptions[a])||void 0===i?void 0:i.enabled))throw new Error(`Required extension ${a} is disabled`);throw new Error(`Required extension ${a} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new f.e("__root__",this._babylonScene);this._rootBabylonMesh=g,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.oe(!1);const i={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case K.h.AUTO:this._babylonScene.useRightHandedSystem||(i.rotation=[0,1,0,0],i.scale=[1,1,-1],r._LoadTransform(i,this._rootBabylonMesh));break;case K.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(g),i}loadSceneAsync(g,i){const a=this._extensionsLoadSceneAsync(g,i);if(a)return a;const n=new Array;if(this.logOpen(`${g} ${i.name||""}`),i.nodes)for(const L of i.nodes){const i=s.Get(`${g}/nodes/${L}`,this._gltf.nodes,L);n.push(this.loadNodeAsync(`/nodes/${i.index}`,i,(g=>{g.parent=this._rootBabylonMesh})))}for(const L of this._postSceneLoadActions)L();return n.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(n).then((()=>{}))}_forEachPrimitive(g,i){if(g._primitiveBabylonMeshes)for(const a of g._primitiveBabylonMeshes)i(a)}_getGeometries(){const g=[],i=this._gltf.nodes;if(i)for(const a of i)this._forEachPrimitive(a,(i=>{const a=i.wd;a&&-1===g.indexOf(a)&&g.push(a)}));return g}_getMeshes(){const g=[];this._rootBabylonMesh instanceof Y.d&&g.push(this._rootBabylonMesh);const i=this._gltf.nodes;if(i)for(const a of i)this._forEachPrimitive(a,(i=>{g.push(i)}));return g}_getTransformNodes(){const g=[],i=this._gltf.nodes;if(i)for(const a of i)a._babylonTransformNode&&"bb"===a._babylonTransformNode.getClassName()&&g.push(a._babylonTransformNode),a._babylonTransformNodeForSkin&&g.push(a._babylonTransformNodeForSkin);return g}_getSkeletons(){const g=[],i=this._gltf.skins;if(i)for(const a of i)a._data&&g.push(a._data.babylonSkeleton);return g}_getAnimationGroups(){const g=[],i=this._gltf.animations;if(i)for(const a of i)a._babylonAnimationGroup&&g.push(a._babylonAnimationGroup);return g}_startAnimations(){switch(this._parent.animationStartMode){case K.e.NONE:break;case K.e.FIRST:{const g=this._getAnimationGroups();0!==g.length&&g[0].start(!0);break}case K.e.ALL:{const g=this._getAnimationGroups();for(const i of g)i.start(!0);break}default:return void c.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const n=this._extensionsLoadNodeAsync(g,i,a);if(n)return n;if(i._babylonTransformNode)throw new Error(`${g}: Invalid recursive node hierarchy`);const L=new Array;this.logOpen(`${g} ${i.name||""}`);const d=n=>{if(r.AddPointerMetadata(n,g),r._LoadTransform(i,n),void 0!=i.camera){const a=s.Get(`${g}/camera`,this._gltf.cameras,i.camera);L.push(this.loadCameraAsync(`/cameras/${a.index}`,a,(g=>{g.parent=n,this._babylonScene.useRightHandedSystem||(n.rd.x=-1)})))}if(i.children)for(const a of i.children){const i=s.Get(`${g}/children/${a}`,this._gltf.nodes,a);L.push(this.loadNodeAsync(`/nodes/${i.index}`,i,(g=>{g.parent=n})))}a(n)},b=void 0!=i.mesh,k=this._parent.loadSkins&&void 0!=i.skin;if(!b||k){const g=i.name||`node${i.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new X.c(g,this._babylonScene);a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==i.mesh?i._babylonTransformNode=a:i._babylonTransformNodeForSkin=a,d(a)}if(b)if(k){const a=s.Get(`${g}/mesh`,this._gltf.meshes,i.mesh);L.push(this._loadMeshAsync(`/meshes/${a.index}`,i,a,(a=>{const n=i._babylonTransformNodeForSkin;a.metadata=(0,O.d)(n.metadata,a.metadata||{});const d=s.Get(`${g}/skin`,this._gltf.skins,i.skin);L.push(this._loadSkinAsync(`/skins/${d.index}`,i,d,(g=>{this._forEachPrimitive(i,(i=>{i.skeleton=g})),this._postSceneLoadActions.push((()=>{if(void 0!=d.skeleton){const g=s.Get(`/skins/${d.index}/skeleton`,this._gltf.nodes,d.skeleton).parent;i.index===g.index?a.parent=n.parent:a.parent=g._babylonTransformNode}else a.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:n,skinnedNode:a})}))})))})))}else{const a=s.Get(`${g}/mesh`,this._gltf.meshes,i.mesh);L.push(this._loadMeshAsync(`/meshes/${a.index}`,i,a,d))}return this.logClose(),Promise.all(L).then((()=>(this._forEachPrimitive(i,(g=>{const i=g;!i.isAnInstance&&i.wd&&i.wd.useBoundingInfoFromGeometry?g.lg():g.refreshBoundingInfo(!0,!0)})),i._babylonTransformNode)))}_loadMeshAsync(g,i,a,n){const L=a.primitives;if(!L||!L.length)throw new Error(`${g}: Primitives are missing`);void 0==L[0].index&&s.Assign(L);const d=new Array;this.logOpen(`${g} ${a.name||""}`);const b=i.name||`node${i.index}`;if(1===L.length){const n=a.primitives[0];d.push(this._loadMeshPrimitiveAsync(`${g}/primitives/${n.index}`,b,i,a,n,(g=>{i._babylonTransformNode=g,i._primitiveBabylonMeshes=[g]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,i._babylonTransformNode=new X.c(b,this._babylonScene),i._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i._primitiveBabylonMeshes=[];for(const n of L)d.push(this._loadMeshPrimitiveAsync(`${g}/primitives/${n.index}`,`${b}_primitive${n.index}`,i,a,n,(g=>{g.parent=i._babylonTransformNode,i._primitiveBabylonMeshes.push(g)})))}return n(i._babylonTransformNode),this.logClose(),Promise.all(d).then((()=>i._babylonTransformNode))}_loadMeshPrimitiveAsync(g,i,a,n,L,d){const b=this._extensionsLoadMeshPrimitiveAsync(g,i,a,n,L,d);if(b)return b;this.logOpen(`${g}`);const k=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==a.skin&&!n.primitives[0].targets;let e,N;if(k&&L._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,e=L._instanceData.babylonSourceMesh.createInstance(i),e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,N=L._instanceData.promise;else{const d=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new f.e(i,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.sideOrientation=this._babylonScene.useRightHandedSystem?R.c.CounterClockWiseSideOrientation:R.c.ClockWiseSideOrientation,this._createMorphTargets(g,a,n,L,b),d.push(this._loadVertexDataAsync(g,L,b).then((async i=>await this._loadMorphTargetsAsync(g,L,b,i).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,i.Kg(b),i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const F=r._GetDrawMode(g,L.mode);if(void 0==L.material){let g=this._defaultBabylonMaterialData[F];g||(g=this._createDefaultMaterial("__GLTFLoader._default",F),this._parent.onMaterialLoadedObservable.notifyObservers(g),this._defaultBabylonMaterialData[F]=g),b.material=g}else if(!this.parent.skipMaterials){const i=s.Get(`${g}/material`,this._gltf.materials,L.material);d.push(this._loadMaterialAsync(`/materials/${i.index}`,i,b,F,(g=>{b.material=g})))}N=Promise.all(d),k&&(L._instanceData={babylonSourceMesh:b,promise:N}),e=b}return r.AddPointerMetadata(e,g),this._parent.onMeshLoadedObservable.notifyObservers(e),d(e),this.logClose(),N.then((()=>e))}_loadVertexDataAsync(g,i,a){const n=this._extensionsLoadVertexDataAsync(g,i,a);if(n)return n;const L=i.attributes;if(!L)throw new Error(`${g}: Attributes are missing`);const d=new Array,b=new P.d(a.name,this._babylonScene);if(void 0==i.indices)a.isUnIndexed=!0;else{const a=s.Get(`${g}/indices`,this._gltf.accessors,i.indices);d.push(this._loadIndicesAccessorAsync(`/accessors/${a.index}`,a).then((g=>{b.setIndices(g)})))}const k=(i,n,k)=>{if(void 0==L[i])return;a._delayInfo=a._delayInfo||[],-1===a._delayInfo.indexOf(n)&&a._delayInfo.push(n);const e=s.Get(`${g}/attributes/${i}`,this._gltf.accessors,L[i]);d.push(this._loadVertexAccessorAsync(`/accessors/${e.index}`,e,n).then((g=>{if(g.getKind()===v.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!a.skeleton){const g=mg(e);g&&(b._boundingInfo=g,b.useBoundingInfoFromGeometry=!0)}b.setVerticesBuffer(g,e.count)}))),n==v.g.MatricesIndicesExtraKind&&(a.numBoneInfluencers=8),k&&k(e)};return k("POSITION",v.g.PositionKind),k("NORMAL",v.g.NormalKind),k("TANGENT",v.g.TangentKind),k("TEXCOORD_0",v.g.UVKind),k("TEXCOORD_1",v.g.UV2Kind),k("TEXCOORD_2",v.g.UV3Kind),k("TEXCOORD_3",v.g.UV4Kind),k("TEXCOORD_4",v.g.UV5Kind),k("TEXCOORD_5",v.g.UV6Kind),k("JOINTS_0",v.g.MatricesIndicesKind),k("WEIGHTS_0",v.g.MatricesWeightsKind),k("JOINTS_1",v.g.MatricesIndicesExtraKind),k("WEIGHTS_1",v.g.MatricesWeightsExtraKind),k("COLOR_0",v.g.ColorKind,(g=>{"VEC4"===g.type&&(a.hasVertexAlpha=!0)})),Promise.all(d).then((()=>b))}_createMorphTargets(g,i,a,n,L){if(!n.targets||!this._parent.loadMorphTargets)return;if(void 0==i._numMorphTargets)i._numMorphTargets=n.targets.length;else if(n.targets.length!==i._numMorphTargets)throw new Error(`${g}: Primitives do not have the same number of targets`);const d=a.extras?a.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,L.morphTargetManager=new V(this._babylonScene),L.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L.morphTargetManager.areUpdatesFrozen=!0;for(let b=0;b<n.targets.length;b++){const g=i.weights?i.weights[b]:a.weights?a.weights[b]:0,n=d?d[b]:`morphTarget${b}`;L.morphTargetManager.addTarget(new C.c(n,g,L.Pg()))}}_loadMorphTargetsAsync(g,i,a,n){if(!i.targets||!this._parent.loadMorphTargets)return Promise.resolve();const L=new Array,d=a.morphTargetManager;for(let b=0;b<d.numTargets;b++){const a=d.getTarget(b);L.push(this._loadMorphTargetVertexDataAsync(`${g}/targets/${b}`,n,i.targets[b],a))}return Promise.all(L).then((()=>{d.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(g,i,a,n){const L=new Array,d=(n,d,b)=>{if(void 0==a[n])return;const k=i.getVertexBuffer(d);if(!k)return;const e=s.Get(`${g}/${n}`,this._gltf.accessors,a[n]);L.push(this._loadFloatAccessorAsync(`/accessors/${e.index}`,e).then((g=>{b(k,g)})))};return d("POSITION",v.g.PositionKind,((g,i)=>{const a=new Float32Array(i.length);g.forEach(i.length,((g,n)=>{a[n]=i[n]+g})),n.setPositions(a)})),d("NORMAL",v.g.NormalKind,((g,i)=>{const a=new Float32Array(i.length);g.forEach(a.length,((g,n)=>{a[n]=i[n]+g})),n.setNormals(a)})),d("TANGENT",v.g.TangentKind,((g,i)=>{const a=new Float32Array(i.length/3*4);let L=0;g.forEach(i.length/3*4,((g,n)=>{(n+1)%4!==0&&(a[L]=i[L]+g,L++)})),n.setTangents(a)})),d("TEXCOORD_0",v.g.UVKind,((g,i)=>{const a=new Float32Array(i.length);g.forEach(i.length,((g,n)=>{a[n]=i[n]+g})),n.setUVs(a)})),d("TEXCOORD_1",v.g.UV2Kind,((g,i)=>{const a=new Float32Array(i.length);g.forEach(i.length,((g,n)=>{a[n]=i[n]+g})),n.setUV2s(a)})),d("COLOR_0",v.g.ColorKind,((i,a)=>{let L=null;const d=i.getSize();if(3===d){L=new Float32Array(a.length/3*4),i.forEach(a.length,((g,i)=>{const n=Math.floor(i/3),d=i%3;L[4*n+d]=a[3*n+d]+g}));for(let g=0;g<a.length/3;++g)L[4*g+3]=1}else{if(4!==d)throw new Error(`${g}: Invalid number of components (${d}) for COLOR_0 attribute`);L=new Float32Array(a.length),i.forEach(a.length,((g,i)=>{L[i]=a[i]+g}))}n.setColors(L)})),await Promise.all(L).then((()=>{}))}static _LoadTransform(g,i){if(void 0!=g.skin)return;let a=L.Bi.Zero(),n=L.Quaternion.Identity(),d=L.Bi.One();if(g.matrix){L.Matrix.xi(g.matrix).decompose(d,n,a)}else g.translation&&(a=L.Bi.xi(g.translation)),g.rotation&&(n=L.Quaternion.xi(g.rotation)),g.scale&&(d=L.Bi.xi(g.scale));i.position=a,i.rotationQuaternion=n,i.rd=d}_loadSkinAsync(g,i,a,n){if(!this._parent.loadSkins)return Promise.resolve();const L=this._extensionsLoadSkinAsync(g,i,a);if(L)return L;if(a._data)return n(a._data.babylonSkeleton),a._data.promise;const d=`skeleton${a.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new p(a.name||d,d,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(g,a,b);const k=this._loadSkinInverseBindMatricesDataAsync(g,a).then((g=>{this._updateBoneMatrices(b,g)}));return a._data={babylonSkeleton:b,promise:k},n(b),k}_loadBones(g,i,a){if(void 0==i.skeleton||this._parent.alwaysComputeSkeletonRootNode){const a=this._findSkeletonRootNode(`${g}/joints`,i.joints);if(a)if(void 0===i.skeleton)i.skeleton=a.index;else{const n=(g,i)=>{for(;i.parent;i=i.parent)if(i.parent===g)return!0;return!1},L=s.Get(`${g}/skeleton`,this._gltf.nodes,i.skeleton);L===a||n(L,a)||(c.b.Warn(`${g}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),i.skeleton=a.index)}else c.b.Warn(`${g}: Failed to find common root`)}const n={};for(const L of i.joints){const d=s.Get(`${g}/joints/${L}`,this._gltf.nodes,L);this._loadBone(d,i,a,n)}}_findSkeletonRootNode(g,i){if(0===i.length)return null;const a={};for(const L of i){const i=[];let n=s.Get(`${g}/${L}`,this._gltf.nodes,L);for(;-1!==n.index;)i.unshift(n),n=n.parent;a[L]=i}let n=null;for(let L=0;;++L){let g=a[i[0]];if(L>=g.length)return n;const d=g[L];for(let b=1;b<i.length;++b)if(g=a[i[b]],L>=g.length||d!==g[L])return n;n=d}}_loadBone(g,i,a,n){g._isJoint=!0;let L=n[g.index];if(L)return L;let d=null;g.index!==i.skeleton&&(g.parent&&-1!==g.parent.index?d=this._loadBone(g.parent,i,a,n):void 0!==i.skeleton&&c.b.Warn(`/skins/${i.index}/skeleton: Skeleton node is not a common root`));const b=i.joints.indexOf(g.index);return L=new N.d(g.name||`joint${g.index}`,a,d,this._getNodeMatrix(g),null,null,b),n[g.index]=L,this._postSceneLoadActions.push((()=>{L.linkTransformNode(g._babylonTransformNode)})),L}_loadSkinInverseBindMatricesDataAsync(g,i){if(void 0==i.inverseBindMatrices)return Promise.resolve(null);const a=s.Get(`${g}/inverseBindMatrices`,this._gltf.accessors,i.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${a.index}`,a)}_updateBoneMatrices(g,i){for(const a of g.bones){const g=L.Matrix.Identity(),n=a._index;i&&-1!==n&&(L.Matrix.FromArrayToRef(i,16*n,g),g.invertToRef(g));const d=a.getParent();d&&g.multiplyToRef(d.getAbsoluteInverseBindMatrix(),g),a.ld(g,!1,!1),a._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(g){return g.matrix?L.Matrix.xi(g.matrix):L.Matrix.Compose(g.scale?L.Bi.xi(g.scale):L.Bi.One(),g.rotation?L.Quaternion.xi(g.rotation):L.Quaternion.Identity(),g.translation?L.Bi.xi(g.translation):L.Bi.Zero())}loadCameraAsync(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const n=this._extensionsLoadCameraAsync(g,i,a);if(n)return n;const d=new Array;this.logOpen(`${g} ${i.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new e.e(i.name||`camera${i.index}`,L.Bi.Zero(),this._babylonScene,!1);switch(b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i._babylonCamera=b,b.setTarget(new L.Bi(0,0,-1)),i.type){case"perspective":{const a=i.perspective;if(!a)throw new Error(`${g}: Camera perspective properties are missing`);b.fov=a.yfov,b.Vd=a.znear,b.maxZ=a.zfar||0;break}case"orthographic":if(!i.orthographic)throw new Error(`${g}: Camera orthographic properties are missing`);b.mode=k.b.ORTHOGRAPHIC_CAMERA,b.orthoLeft=-i.orthographic.xmag,b.orthoRight=i.orthographic.xmag,b.orthoBottom=-i.orthographic.ymag,b.orthoTop=i.orthographic.ymag,b.Vd=i.orthographic.znear,b.maxZ=i.orthographic.zfar;break;default:throw new Error(`${g}: Invalid camera type (${i.type})`)}return r.AddPointerMetadata(b,g),this._parent.onCameraLoadedObservable.notifyObservers(b),a(b),this.logClose(),Promise.all(d).then((()=>b))}_loadAnimationsAsync(){const g=this._gltf.animations;if(!g)return Promise.resolve();const i=new Array;for(let a=0;a<g.length;a++){const n=g[a];i.push(this.loadAnimationAsync(`/animations/${n.index}`,n).then((g=>{0===g.targetedAnimations.length&&g.dispose()})))}return Promise.all(i).then((()=>{}))}loadAnimationAsync(g,i){const n=this._extensionsLoadAnimationAsync(g,i);return n||a.e(78).then(a.bind(a,15696)).then((a=>{let{AnimationGroup:n}=a;this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new n(i.name||`animation${i.index}`,this._babylonScene);L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i._babylonAnimationGroup=L;const d=new Array;s.Assign(i.channels),s.Assign(i.samplers);for(const b of i.channels)d.push(this._loadAnimationChannelAsync(`${g}/channels/${b.index}`,g,i,b,((g,i)=>{g.animations=g.animations||[],g.animations.push(i),L.addTargetedAnimation(i,g)})));return Promise.all(d).then((()=>(L.normalize(0),L)))}))}async _loadAnimationChannelAsync(g,i,n,L,d){const b=this._extensionsLoadAnimationChannelAsync(g,i,n,L,d);if(b)return await b;if(void 0==L.target.node)return await Promise.resolve();const k=s.Get(`${g}/target/node`,this._gltf.nodes,L.target.node),e=L.target.path,N="weights"===e;if(N&&!k._numMorphTargets||!N&&!k._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!N&&!k._isJoint)return await Promise.resolve();let F;switch(await Promise.resolve().then(a.bind(a,14150)),e){case"translation":var I;F=null===(I=(0,A.e)("/nodes/{}/translation"))||void 0===I?void 0:I.interpolation;break;case"rotation":var j;F=null===(j=(0,A.e)("/nodes/{}/rotation"))||void 0===j?void 0:j.interpolation;break;case"scale":var y;F=null===(y=(0,A.e)("/nodes/{}/scale"))||void 0===y?void 0:y.interpolation;break;case"weights":var B;F=null===(B=(0,A.e)("/nodes/{}/weights"))||void 0===B?void 0:B.interpolation;break;default:throw new Error(`${g}/target/path: Invalid value (${L.target.path})`)}if(!F)throw new Error(`${g}/target/path: Could not find interpolation properties for target path (${L.target.path})`);const c={object:k,info:F};return await this._loadAnimationChannelFromTargetInfoAsync(g,i,n,L,c,d)}_loadAnimationChannelFromTargetInfoAsync(g,i,a,n,L,d){const b=this.parent.targetFps,k=1/b,e=s.Get(`${g}/sampler`,a.samplers,n.sampler);return this._loadAnimationSamplerAsync(`${i}/samplers/${n.sampler}`,e).then((g=>{let i=0;const e=L.object,N=L.info;for(const L of N){const N=L.getStride(e),F=g.input,I=g.output,j=new Array(F.length);let y=0;switch(g.interpolation){case"STEP":for(let g=0;g<F.length;g++){const i=L.getValue(e,I,y,1);y+=N,j[g]={frame:F[g]*b,value:i,interpolation:1}}break;case"CUBICSPLINE":for(let g=0;g<F.length;g++){const i=L.getValue(e,I,y,k);y+=N;const a=L.getValue(e,I,y,1);y+=N;const n=L.getValue(e,I,y,k);y+=N,j[g]={frame:F[g]*b,inTangent:i,value:a,outTangent:n}}break;case"LINEAR":for(let g=0;g<F.length;g++){const i=L.getValue(e,I,y,1);y+=N,j[g]={frame:F[g]*b,value:i}}}if(y>0){const g=`${a.name||`animation${a.index}`}_channel${n.index}_${i}`,k=L.buildAnimations(e,g,b,j);for(const a of k)i++,d(a.babylonAnimatable,a.babylonAnimation)}}}))}_loadAnimationSamplerAsync(g,i){if(i._data)return i._data;const a=i.interpolation||"LINEAR";switch(a){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${g}/interpolation: Invalid value (${i.interpolation})`)}const n=s.Get(`${g}/input`,this._gltf.accessors,i.input),L=s.Get(`${g}/output`,this._gltf.accessors,i.output);return i._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${n.index}`,n),this._loadFloatAccessorAsync(`/accessors/${L.index}`,L)]).then((g=>{let[i,n]=g;return{input:i,interpolation:a,output:n}})),i._data}loadBufferAsync(g,i,a,n){const L=this._extensionsLoadBufferAsync(g,i,a,n);if(L)return L;if(!i._data)if(i.uri)i._data=this.loadUriAsync(`${g}/uri`,i,i.uri);else{if(!this._bin)throw new Error(`${g}: Uri is missing or the binary glTF is missing its binary chunk`);i._data=this._bin.readAsync(0,i.byteLength)}return i._data.then((i=>{try{return new Uint8Array(i.buffer,i.byteOffset+a,n)}catch(L){throw new Error(`${g}: ${L.message}`)}}))}loadBufferViewAsync(g,i){const a=this._extensionsLoadBufferViewAsync(g,i);if(a)return a;if(i._data)return i._data;const n=s.Get(`${g}/buffer`,this._gltf.buffers,i.buffer);return i._data=this.loadBufferAsync(`/buffers/${n.index}`,n,i.byteOffset||0,i.byteLength),i._data}_loadAccessorAsync(g,i,a){if(i._data)return i._data;const n=r._GetNumComponents(g,i.type),L=n*v.g.GetTypeByteLength(i.componentType),d=n*i.count;if(void 0==i.bufferView)i._data=Promise.resolve(new a(d));else{const b=s.Get(`${g}/bufferView`,this._gltf.bufferViews,i.bufferView);i._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((k=>{if(5126!==i.componentType||i.normalized||b.byteStride&&b.byteStride!==L){const g=new a(d);return v.g.ForEach(k,i.byteOffset||0,b.byteStride||L,n,i.componentType,g.length,i.normalized||!1,((i,a)=>{g[a]=i})),g}return r._GetTypedArray(g,i.componentType,k,i.byteOffset,d)}))}if(i.sparse){const d=i.sparse;i._data=i._data.then((b=>{const k=b,e=s.Get(`${g}/sparse/indices/bufferView`,this._gltf.bufferViews,d.indices.bufferView),N=s.Get(`${g}/sparse/values/bufferView`,this._gltf.bufferViews,d.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${e.index}`,e),this.loadBufferViewAsync(`/bufferViews/${N.index}`,N)]).then((b=>{let[e,N]=b;const F=r._GetTypedArray(`${g}/sparse/indices`,d.indices.componentType,e,d.indices.byteOffset,d.count),I=n*d.count;let j;if(5126!==i.componentType||i.normalized){const b=r._GetTypedArray(`${g}/sparse/values`,i.componentType,N,d.values.byteOffset,I);j=new a(I),v.g.ForEach(b,0,L,n,i.componentType,j.length,i.normalized||!1,((g,i)=>{j[i]=g}))}else j=r._GetTypedArray(`${g}/sparse/values`,i.componentType,N,d.values.byteOffset,I);let y=0;for(let g=0;g<F.length;g++){let i=F[g]*n;for(let g=0;g<n;g++)k[i++]=j[y++]}return k}))}))}return i._data}_loadFloatAccessorAsync(g,i){return this._loadAccessorAsync(g,i,Float32Array)}_loadIndicesAccessorAsync(g,i){if("SCALAR"!==i.type)throw new Error(`${g}/type: Invalid value ${i.type}`);if(5121!==i.componentType&&5123!==i.componentType&&5125!==i.componentType)throw new Error(`${g}/componentType: Invalid value ${i.componentType}`);if(i._data)return i._data;if(i.sparse){const a=r._GetTypedArrayConstructor(`${g}/componentType`,i.componentType);i._data=this._loadAccessorAsync(g,i,a)}else{const a=s.Get(`${g}/bufferView`,this._gltf.bufferViews,i.bufferView);i._data=this.loadBufferViewAsync(`/bufferViews/${a.index}`,a).then((a=>r._GetTypedArray(g,i.componentType,a,i.byteOffset,i.count)))}return i._data}_loadVertexBufferViewAsync(g){if(g._babylonBuffer)return g._babylonBuffer;const i=this._babylonScene.getEngine();return g._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${g.index}`,g).then((g=>new v.c(i,g,!1))),g._babylonBuffer}_loadVertexAccessorAsync(g,i,a){var n;if(null!==(n=i._babylonVertexBuffer)&&void 0!==n&&n[a])return i._babylonVertexBuffer[a];i._babylonVertexBuffer||(i._babylonVertexBuffer={});const L=this._babylonScene.getEngine();if(i.sparse||void 0==i.bufferView)i._babylonVertexBuffer[a]=this._loadFloatAccessorAsync(g,i).then((g=>new v.g(L,g,a,!1)));else{const n=s.Get(`${g}/bufferView`,this._gltf.bufferViews,i.bufferView);i._babylonVertexBuffer[a]=this._loadVertexBufferViewAsync(n).then((d=>{const b=r._GetNumComponents(g,i.type);return new v.g(L,d,a,!1,void 0,n.byteStride,void 0,i.byteOffset,b,i.componentType,i.normalized,!0,void 0,!0)}))}return i._babylonVertexBuffer[a]}_loadMaterialMetallicRoughnessPropertiesAsync(g,i,a){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);const n=new Array;return i&&(i.baseColorFactor?(a.albedoColor=d.Ri.xi(i.baseColorFactor),a.alpha=i.baseColorFactor[3]):a.albedoColor=d.Ri.White(),a.metallic=void 0==i.metallicFactor?1:i.metallicFactor,a.roughness=void 0==i.roughnessFactor?1:i.roughnessFactor,i.baseColorTexture&&n.push(this.loadTextureInfoAsync(`${g}/baseColorTexture`,i.baseColorTexture,(g=>{g.name=`${a.name} (Base Color)`,a.albedoTexture=g}))),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${g}/metallicRoughnessTexture`,i.metallicRoughnessTexture,(g=>{g.name=`${a.name} (Metallic Roughness)`,a.metallicTexture=g}))),a.useMetallnessFromMetallicTextureBlue=!0,a.useRoughnessFromMetallicTextureGreen=!0,a.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(n).then((()=>{}))}_loadMaterialAsync(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const d=this._extensionsLoadMaterialAsync(g,i,a,n,L);if(d)return d;i._data=i._data||{};let b=i._data[n];if(!b){this.logOpen(`${g} ${i.name||""}`);const a=this.createMaterial(g,i,n);b={babylonMaterial:a,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(g,i,a)},i._data[n]=b,r.AddPointerMetadata(a,g),this._parent.onMaterialLoadedObservable.notifyObservers(a),this.logClose()}return a&&(b.babylonMeshes.push(a),a.dd.addOnce((()=>{const g=b.babylonMeshes.indexOf(a);-1!==g&&b.babylonMeshes.splice(g,1)}))),L(b.babylonMaterial),b.promise.then((()=>b.babylonMaterial))}_createDefaultMaterial(g,i){this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new x.b(g,this._babylonScene);return a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.fillMode=i,a.enableSpecularAntiAliasing=!0,a.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,a.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,a.transparencyMode=x.b.PBRMATERIAL_OPAQUE,a.metallic=1,a.roughness=1,a}createMaterial(g,i,a){const n=this._extensionsCreateMaterial(g,i,a);if(n)return n;const L=i.name||`material${i.index}`;return this._createDefaultMaterial(L,a)}loadMaterialPropertiesAsync(g,i,a){const n=this._extensionsLoadMaterialPropertiesAsync(g,i,a);if(n)return n;const L=new Array;return L.push(this.loadMaterialBasePropertiesAsync(g,i,a)),i.pbrMetallicRoughness&&L.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${g}/pbrMetallicRoughness`,i.pbrMetallicRoughness,a)),this.loadMaterialAlphaProperties(g,i,a),Promise.all(L).then((()=>{}))}loadMaterialBasePropertiesAsync(g,i,a){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);const n=new Array;return a.emissiveColor=i.emissiveFactor?d.Ri.xi(i.emissiveFactor):new d.Ri(0,0,0),i.doubleSided&&(a.zd=!1,a.twoSidedLighting=!0),i.normalTexture&&(i.normalTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${g}/normalTexture`,i.normalTexture,(g=>{g.name=`${a.name} (Normal)`,a.bumpTexture=g}))),a.invertNormalMapX=!this._babylonScene.useRightHandedSystem,a.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=i.normalTexture.scale&&a.bumpTexture&&(a.bumpTexture.level=i.normalTexture.scale),a.forceIrradianceInFragment=!0),i.occlusionTexture&&(i.occlusionTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${g}/occlusionTexture`,i.occlusionTexture,(g=>{g.name=`${a.name} (Occlusion)`,a.ambientTexture=g}))),a.useAmbientInGrayScale=!0,void 0!=i.occlusionTexture.strength&&(a.ambientTextureStrength=i.occlusionTexture.strength)),i.emissiveTexture&&n.push(this.loadTextureInfoAsync(`${g}/emissiveTexture`,i.emissiveTexture,(g=>{g.name=`${a.name} (Emissive)`,a.emissiveTexture=g}))),Promise.all(n).then((()=>{}))}loadMaterialAlphaProperties(g,i,a){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);switch(i.alphaMode||"OPAQUE"){case"OPAQUE":a.transparencyMode=x.b.PBRMATERIAL_OPAQUE,a.alpha=1;break;case"MASK":a.transparencyMode=x.b.PBRMATERIAL_ALPHATEST,a.alphaCutOff=void 0==i.alphaCutoff?.5:i.alphaCutoff,a.albedoTexture&&(a.albedoTexture.Ud=!0);break;case"BLEND":a.transparencyMode=x.b.PBRMATERIAL_ALPHABLEND,a.albedoTexture&&(a.albedoTexture.Ud=!0,a.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${g}/alphaMode: Invalid value (${i.alphaMode})`)}}loadTextureInfoAsync(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const n=this._extensionsLoadTextureInfoAsync(g,i,a);if(n)return n;if(this.logOpen(`${g}`),i.texCoord>=6)throw new Error(`${g}/texCoord: Invalid value (${i.texCoord})`);const L=s.Get(`${g}/index`,this._gltf.textures,i.index);L._textureInfo=i;const d=this._loadTextureAsync(`/textures/${i.index}`,L,(n=>{n.coordinatesIndex=i.texCoord||0,r.AddPointerMetadata(n,g),this._parent.onTextureLoadedObservable.notifyObservers(n),a(n)}));return this.logClose(),d}_loadTextureAsync(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const n=this._extensionsLoadTextureAsync(g,i,a);if(n)return n;this.logOpen(`${g} ${i.name||""}`);const L=void 0==i.sampler?r.DefaultSampler:s.Get(`${g}/sampler`,this._gltf.samplers,i.sampler),d=s.Get(`${g}/source`,this._gltf.images,i.source),b=this._createTextureAsync(g,L,d,a,void 0,!i._textureInfo.nonColorData);return this.logClose(),b}_createTextureAsync(g,i,a){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},d=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0;const k=this._loadSampler(`/samplers/${i.index}`,i),e=new Array,N=new n;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F={noMipmap:k.noMipMaps,invertY:!1,samplingMode:k.samplingMode,W:()=>{this._disposed||N.resolve()},onError:(i,a)=>{this._disposed||N.reject(new Error(`${g}: ${a&&a.message?a.message:i||"Failed to load texture"}`))},mimeType:a.mimeType??(0,T.h)(a.uri??""),loaderOptions:d,useSRGBBuffer:!!b&&this._parent.useSRGBBuffers},I=new E.c(null,this._babylonScene,F);return I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e.push(N.promise),e.push(this.loadImageAsync(`/images/${a.index}`,a).then((g=>{const i=a.uri||`${this._fileName}#image${a.index}`,n=`data:${this._uniqueRootUrl}${i}`;I.updateURL(n,g);const L=I.getInternalTexture();L&&(L.label=a.name)}))),I.wrapU=k.wrapU,I.wrapV=k.wrapV,L(I),this._parent.useGltfTextureNames&&(I.name=a.name||a.uri||`image${a.index}`),Promise.all(e).then((()=>I))}_loadSampler(g,i){return i._data||(i._data={noMipMaps:9728===i.minFilter||9729===i.minFilter,samplingMode:r._GetTextureSamplingMode(g,i),wrapU:r._GetTextureWrapMode(`${g}/wrapS`,i.wrapS),wrapV:r._GetTextureWrapMode(`${g}/wrapT`,i.wrapT)}),i._data}loadImageAsync(g,i){if(!i._data){if(this.logOpen(`${g} ${i.name||""}`),i.uri)i._data=this.loadUriAsync(`${g}/uri`,i,i.uri);else{const a=s.Get(`${g}/bufferView`,this._gltf.bufferViews,i.bufferView);i._data=this.loadBufferViewAsync(`/bufferViews/${a.index}`,a)}this.logClose()}return i._data}loadUriAsync(g,i,a){const n=this._extensionsLoadUriAsync(g,i,a);if(n)return n;if(!r._ValidateUri(a))throw new Error(`${g}: '${a}' is invalid`);if((0,T.i)(a)){const i=new Uint8Array((0,T.d)(a));return this.log(`${g}: Decoded ${a.substring(0,64)}... (${i.length} bytes)`),Promise.resolve(i)}return this.log(`${g}: Loading ${a}`),this._parent.preprocessUrlAsync(this._rootUrl+a).then((i=>new Promise(((n,L)=>{this._parent._loadFile(this._babylonScene,i,(i=>{this._disposed||(this.log(`${g}: Loaded ${a} (${i.byteLength} bytes)`),n(new Uint8Array(i)))}),!0,(i=>{L(new T.j(`${g}: Failed to load '${a}'${i?": "+i.status+" "+i.statusText:""}`,i))}))}))))}static AddPointerMetadata(g,i){g.metadata=g.metadata||{};const a=g._internalMetadata=g._internalMetadata||{},n=a.Dd=a.Dd||{};(n.pointers=n.pointers||[]).push(i)}static _GetTextureWrapMode(g,i){switch(i=void 0==i?10497:i){case 33071:return E.c.CLAMP_ADDRESSMODE;case 33648:return E.c.MIRROR_ADDRESSMODE;case 10497:return E.c.WRAP_ADDRESSMODE;default:return c.b.Warn(`${g}: Invalid value (${i})`),E.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(g,i){const a=void 0==i.magFilter?9729:i.magFilter,n=void 0==i.minFilter?9987:i.minFilter;if(9729===a)switch(n){case 9728:return E.c.LINEAR_NEAREST;case 9729:return E.c.LINEAR_LINEAR;case 9984:return E.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return E.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return E.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return E.c.LINEAR_LINEAR_MIPLINEAR;default:return c.b.Warn(`${g}/minFilter: Invalid value (${n})`),E.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==a&&c.b.Warn(`${g}/magFilter: Invalid value (${a})`),n){case 9728:return E.c.NEAREST_NEAREST;case 9729:return E.c.NEAREST_LINEAR;case 9984:return E.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return E.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return E.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return E.c.NEAREST_LINEAR_MIPLINEAR;default:return c.b.Warn(`${g}/minFilter: Invalid value (${n})`),E.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(g,i){try{return(0,z.s)(i)}catch(a){throw new Error(`${g}: ${a.message}`)}}static _GetTypedArray(g,i,a,n,L){const d=a.buffer;n=a.byteOffset+(n||0);const b=r._GetTypedArrayConstructor(`${g}/componentType`,i),k=v.g.GetTypeByteLength(i);return n%k!==0?(c.b.Warn(`${g}: Copying buffer as byte offset (${n}) is not a multiple of component type byte length (${k})`),new b(d.slice(n,n+L*k),0)):new b(d,n,L)}static _GetNumComponents(g,i){switch(i){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${g}: Invalid type (${i})`)}static _ValidateUri(g){return b.Tools.IsBase64(g)||-1===g.indexOf("..")}static _GetDrawMode(g,i){switch(void 0==i&&(i=4),i){case 0:return R.c.PointListDrawMode;case 1:return R.c.LineListDrawMode;case 2:return R.c.LineLoopDrawMode;case 3:return R.c.LineStripDrawMode;case 4:return R.c.TriangleFillMode;case 5:return R.c.TriangleStripDrawMode;case 6:return R.c.TriangleFanDrawMode}throw new Error(`${g}: Invalid mesh primitive mode (${i})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const g=new Array;if(this._gltf.materials)for(const i of this._gltf.materials)if(i._data)for(const a in i._data){const n=i._data[a];for(const i of n.babylonMeshes){i.Zd(!0);const a=n.babylonMaterial;g.push(a.forceCompilationAsync(i)),g.push(a.forceCompilationAsync(i,{useInstances:!0})),this._parent.useClipPlane&&(g.push(a.forceCompilationAsync(i,{clipPlane:!0})),g.push(a.forceCompilationAsync(i,{clipPlane:!0,useInstances:!0})))}}return Promise.all(g).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const g=new Array,i=this._babylonScene.lights;for(const a of i){const i=a.getShadowGenerator();i&&g.push(i.forceCompilationAsync())}return Promise.all(g).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(g){for(const i of this._extensions)i.enabled&&g(i)}_applyExtensions(g,i,a){for(const n of this._extensions)if(n.enabled){const L=`${n.name}.${i}`,d=g;d._activeLoaderExtensionFunctions=d._activeLoaderExtensionFunctions||{};const b=d._activeLoaderExtensionFunctions;if(!b[L]){b[L]=!0;try{const g=a(n);if(g)return g}finally{delete b[L]}}}return null}_extensionsOnLoading(){this._forEachExtensions((g=>g.onLoading&&g.onLoading()))}_extensionsOnReady(){this._forEachExtensions((g=>g.onReady&&g.onReady()))}_extensionsLoadSceneAsync(g,i){return this._applyExtensions(i,"loadScene",(a=>a.loadSceneAsync&&a.loadSceneAsync(g,i)))}_extensionsLoadNodeAsync(g,i,a){return this._applyExtensions(i,"loadNode",(n=>n.loadNodeAsync&&n.loadNodeAsync(g,i,a)))}_extensionsLoadCameraAsync(g,i,a){return this._applyExtensions(i,"loadCamera",(n=>n.loadCameraAsync&&n.loadCameraAsync(g,i,a)))}_extensionsLoadVertexDataAsync(g,i,a){return this._applyExtensions(i,"loadVertexData",(n=>n._loadVertexDataAsync&&n._loadVertexDataAsync(g,i,a)))}_extensionsLoadMeshPrimitiveAsync(g,i,a,n,L,d){return this._applyExtensions(L,"loadMeshPrimitive",(b=>b._loadMeshPrimitiveAsync&&b._loadMeshPrimitiveAsync(g,i,a,n,L,d)))}_extensionsLoadMaterialAsync(g,i,a,n,L){return this._applyExtensions(i,"loadMaterial",(d=>d._loadMaterialAsync&&d._loadMaterialAsync(g,i,a,n,L)))}_extensionsCreateMaterial(g,i,a){return this._applyExtensions(i,"createMaterial",(n=>n.createMaterial&&n.createMaterial(g,i,a)))}_extensionsLoadMaterialPropertiesAsync(g,i,a){return this._applyExtensions(i,"loadMaterialProperties",(n=>n.loadMaterialPropertiesAsync&&n.loadMaterialPropertiesAsync(g,i,a)))}_extensionsLoadTextureInfoAsync(g,i,a){return this._applyExtensions(i,"loadTextureInfo",(n=>n.loadTextureInfoAsync&&n.loadTextureInfoAsync(g,i,a)))}_extensionsLoadTextureAsync(g,i,a){return this._applyExtensions(i,"loadTexture",(n=>n._loadTextureAsync&&n._loadTextureAsync(g,i,a)))}_extensionsLoadAnimationAsync(g,i){return this._applyExtensions(i,"loadAnimation",(a=>a.loadAnimationAsync&&a.loadAnimationAsync(g,i)))}_extensionsLoadAnimationChannelAsync(g,i,a,n,L){return this._applyExtensions(a,"loadAnimationChannel",(d=>d._loadAnimationChannelAsync&&d._loadAnimationChannelAsync(g,i,a,n,L)))}_extensionsLoadSkinAsync(g,i,a){return this._applyExtensions(a,"loadSkin",(n=>n._loadSkinAsync&&n._loadSkinAsync(g,i,a)))}_extensionsLoadUriAsync(g,i,a){return this._applyExtensions(i,"loadUri",(n=>n._loadUriAsync&&n._loadUriAsync(g,i,a)))}_extensionsLoadBufferViewAsync(g,i){return this._applyExtensions(i,"loadBufferView",(a=>a.loadBufferViewAsync&&a.loadBufferViewAsync(g,i)))}_extensionsLoadBufferAsync(g,i,a,n){return this._applyExtensions(i,"loadBuffer",(L=>L.loadBufferAsync&&L.loadBufferAsync(g,i,a,n)))}static LoadExtensionAsync(g,i,a,n){if(!i.extensions)return null;const L=i.extensions[a];return L?n(`${g}/extensions/${a}`,L):null}static LoadExtraAsync(g,i,a,n){if(!i.extras)return null;const L=i.extras[a];return L?n(`${g}/extras/${a}`,L):null}isExtensionUsed(g){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(g)}logOpen(g){this._parent._logOpen(g)}logClose(){this._parent._logClose()}log(g){this._parent._log(g)}startPerformanceCounter(g){this._parent._startPerformanceCounter(g)}endPerformanceCounter(g){this._parent._endPerformanceCounter(g)}}r.DefaultSampler={index:-1},K.d._CreateGLTF2Loader=g=>new r(g);var Q=a(14150),o=a(12648),u=a(12484),H=a(14159),M=a(14168);class q extends M.c{constructor(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",g),this._texture=g.getEngine().createRawCubeTexture(i,a,n,L,d,b,k,e)}update(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,g,i,a,n,L)}updateRGBDAsync(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,H.n)(this._texture,g,i,a,n).then((()=>{}))}clone(){return u.c.Clone((()=>{const g=this.Pg(),i=this._texture,a=new q(g,i._bufferViewArray,i.width,i.format,i.type,i.generateMipMaps,i.invertY,i.samplingMode,i._compression);return 13===i.source&&a.updateRGBDAsync(i._bufferViewArrayArray,i._sphericalPolynomial,i._lodGenerationScale,i._lodGenerationOffset),a}),this)}}const W="EXT_lights_image_based";class G{constructor(g){this.name=W,this._loader=g,this.enabled=this._loader.isExtensionUsed(W)}dispose(){this._loader=null,delete this._lights}onLoading(){const g=this._loader.Dd.extensions;if(g&&g[this.name]){const i=g[this.name];this._lights=i.lights}}loadSceneAsync(g,i){return r.LoadExtensionAsync(g,i,this.name,(async(a,n)=>{this._loader._allMaterialsDirtyRequired=!0;const L=new Array;L.push(this._loader.loadSceneAsync(g,i)),this._loader.logOpen(`${a}`);const d=s.Get(`${a}/light`,this._lights,n.gd);return L.push(this._loadLightAsync(`/extensions/${this.name}/lights/${n.gd}`,d).then((g=>{this._loader.babylonScene.environmentTexture=g}))),this._loader.logClose(),await Promise.all(L).then((()=>{}))}))}_loadLightAsync(g,i){if(!i._loaded){const a=new Array;this._loader.logOpen(`${g}`);const n=new Array(i.specularImages.length);for(let L=0;L<i.specularImages.length;L++){const d=i.specularImages[L];n[L]=new Array(d.length);for(let i=0;i<d.length;i++){const b=`${g}/specularImages/${L}/${i}`;this._loader.logOpen(`${b}`);const k=d[i],e=s.Get(b,this._loader.Dd.images,k);a.push(this._loader.loadImageAsync(`/images/${k}`,e).then((g=>{n[L][i]=g}))),this._loader.logClose()}}this._loader.logClose(),i._loaded=Promise.all(a).then((async()=>{const a=new q(this._loader.babylonScene,null,i.specularImageSize);if(a.name=i.name||"environment",i._babylonTexture=a,void 0!=i.ib&&(a.level=i.ib),i.rotation){let g=L.Quaternion.xi(i.rotation);this._loader.babylonScene.useRightHandedSystem||(g=L.Quaternion.Inverse(g)),L.Matrix.FromQuaternionToRef(g,a.getReflectionTextureMatrix())}if(!i.irradianceCoefficients)throw new Error(`${g}: Irradiance coefficients are missing`);const d=o.b.xi(i.irradianceCoefficients);d.scaleInPlace(i.ib),d.convertIrradianceToLambertianRadiance();const b=o.c.FromHarmonics(d),k=(n.length-1)/Math.log2(i.specularImageSize);return await a.updateRGBDAsync(n,b,k)}))}return i._loaded.then((()=>i._babylonTexture))}}t(W),w(W,!0,(g=>new G(g)));a(13031);const J="EXT_mesh_gpu_instancing";class gg{constructor(g){this.name=J,this._loader=g,this.enabled=this._loader.isExtensionUsed(J)}dispose(){this._loader=null}loadNodeAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(g,n)=>{this._loader._disableInstancedMesh++;const d=this._loader.loadNodeAsync(`/nodes/${i.index}`,i,a);if(this._loader._disableInstancedMesh--,!i._primitiveBabylonMeshes)return await d;const b=new Array;let k=0;const e=i=>{if(void 0==n.attributes[i])return void b.push(Promise.resolve(null));const a=s.Get(`${g}/attributes/${i}`,this._loader.Dd.accessors,n.attributes[i]);if(b.push(this._loader._loadFloatAccessorAsync(`/accessors/${a.bufferView}`,a)),0===k)k=a.count;else if(k!==a.count)throw new Error(`${g}/attributes: Instance buffer accessors do not have the same count.`)};return e("TRANSLATION"),e("ROTATION"),e("SCALE"),await d.then((async g=>{const[a,n,d]=await Promise.all(b),e=new Float32Array(16*k);L.TmpVectors.Bi[0].sd(0,0,0),L.TmpVectors.Quaternion[0].sd(0,0,0,1),L.TmpVectors.Bi[1].sd(1,1,1);for(let i=0;i<k;++i)a&&L.Bi.FromArrayToRef(a,3*i,L.TmpVectors.Bi[0]),n&&L.Quaternion.FromArrayToRef(n,4*i,L.TmpVectors.Quaternion[0]),d&&L.Bi.FromArrayToRef(d,3*i,L.TmpVectors.Bi[1]),L.Matrix.ComposeToRef(L.TmpVectors.Bi[1],L.TmpVectors.Quaternion[0],L.TmpVectors.Bi[0],L.TmpVectors.Matrix[0]),L.TmpVectors.Matrix[0].copyToArray(e,16*i);for(const L of i._primitiveBabylonMeshes)L.pj("matrix",e,16,!0);return g}))}))}}t(J),w(J,!0,(g=>new gg(g)));let ig=0,ag=null;class ng{static get Default(){return ng._Default||(ng._Default=new ng),ng._Default}constructor(){const g=ng.Configuration.decoder;this._decoderModulePromise=b.Tools.LoadBabylonScriptAsync(g.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(g,i,a,n,L){await this._decoderModulePromise,0===ig&&(MeshoptDecoder.useWorkers(1),ig=1);const d=await MeshoptDecoder.decodeGltfBufferAsync(i,a,g,n,L);return null!==ag&&clearTimeout(ag),ag=setTimeout((()=>{MeshoptDecoder.useWorkers(0),ig=0,ag=null}),1e3),d}}ng.Configuration={decoder:{url:`${b.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},ng._Default=null;const Lg="EXT_meshopt_compression";class dg{constructor(g){this.name=Lg,this.enabled=g.isExtensionUsed(Lg),this._loader=g}dispose(){this._loader=null}loadBufferViewAsync(g,i){return r.LoadExtensionAsync(g,i,this.name,(async(a,n)=>{const L=i;if(L._meshOptData)return await L._meshOptData;const d=s.Get(`${g}/buffer`,this._loader.Dd.buffers,n.buffer);return L._meshOptData=this._loader.loadBufferAsync(`/buffers/${d.index}`,d,n.byteOffset||0,n.byteLength).then((async g=>await ng.Default.decodeGltfBufferAsync(g,n.count,n.byteStride,n.mode,n.filter))),await L._meshOptData}))}}t(Lg),w(Lg,!0,(g=>new dg(g)));const bg="EXT_texture_webp";class kg{constructor(g){this.name=bg,this._loader=g,this.enabled=g.isExtensionUsed(bg)}dispose(){this._loader=null}_loadTextureAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=void 0==i.sampler?r.DefaultSampler:s.Get(`${g}/sampler`,this._loader.Dd.samplers,i.sampler),b=s.Get(`${n}/source`,this._loader.Dd.images,L.source);return await this._loader._createTextureAsync(g,d,b,(g=>{a(g)}),void 0,!i._textureInfo.nonColorData)}))}}t(bg),w(bg,!0,(g=>new kg(g)));const eg="EXT_texture_avif";class Ng{constructor(g){this.name=eg,this._loader=g,this.enabled=g.isExtensionUsed(eg)}dispose(){this._loader=null}_loadTextureAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=void 0==i.sampler?r.DefaultSampler:s.Get(`${g}/sampler`,this._loader.Dd.samplers,i.sampler),b=s.Get(`${n}/source`,this._loader.Dd.images,L.source);return await this._loader._createTextureAsync(g,d,b,(g=>{a(g)}),void 0,!i._textureInfo.nonColorData)}))}}t(eg),w(eg,!0,(g=>new Ng(g)));var Fg=a(14143),Ig=a(13004);const jg="EXT_lights_ies";class yg{constructor(g){this.name=jg,this._loader=g,this.enabled=this._loader.isExtensionUsed(jg)}dispose(){this._loader=null,delete this._lights}onLoading(){const g=this._loader.Dd.extensions;if(g&&g[this.name]){const i=g[this.name];this._lights=i.lights,s.Assign(this._lights)}}loadNodeAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,b)=>{let k,e;this._loader._allMaterialsDirtyRequired=!0;const N=await this._loader.loadNodeAsync(g,i,(g=>{e=s.Get(n,this._lights,b.gd);const i=e.name||g.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,k=new Fg.c(i,L.Bi.Zero(),L.Bi.Backward(),0,1,this._loader.babylonScene),k.angle=Math.PI/2,k.innerAngle=0,k._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,e._babylonLight=k,k.falloffType=Ig.e.FALLOFF_GLTF,k.ab=b.color?d.Ri.xi(b.color):d.Ri.White(),k.ib=b.multiplier||1,k.range=Number.MAX_VALUE,k.parent=g,this._loader._babylonLights.push(k),r.AddPointerMetadata(k,n),a(g)}));let F;if(e.uri)F=await this._loader.loadUriAsync(g,e,e.uri);else{const i=s.Get(`${g}/bufferView`,this._loader.Dd.bufferViews,e.bufferView);F=await this._loader.loadBufferViewAsync(`/bufferViews/${i.index}`,i)}return k.iesProfileTexture=new E.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,F,!0,void 0,void 0,void 0,void 0,".ies"),N}))}}t(jg),w(jg,!0,(g=>new yg(g)));var Bg=a(14183);const cg="KHR_draco_mesh_compression";class Dg{constructor(g){this.name=cg,this.useNormalizedFlagFromAccessor=!0,this._loader=g,this.enabled=Bg.c.DefaultAvailable&&this._loader.isExtensionUsed(cg)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{if(void 0!=i.mode&&4!==i.mode&&5!==i.mode)throw new Error(`${g}: Unsupported mode ${i.mode}`);const d={},b={},k=(g,n)=>{const k=L.attributes[g];if(void 0!=k&&(a._delayInfo=a._delayInfo||[],-1===a._delayInfo.indexOf(n)&&a._delayInfo.push(n),d[n]=k,this.useNormalizedFlagFromAccessor)){const a=s.TryGet(this._loader.Dd.accessors,i.attributes[g]);a&&(b[n]=a.normalized||!1)}};k("POSITION",v.g.PositionKind),k("NORMAL",v.g.NormalKind),k("TANGENT",v.g.TangentKind),k("TEXCOORD_0",v.g.UVKind),k("TEXCOORD_1",v.g.UV2Kind),k("TEXCOORD_2",v.g.UV3Kind),k("TEXCOORD_3",v.g.UV4Kind),k("TEXCOORD_4",v.g.UV5Kind),k("TEXCOORD_5",v.g.UV6Kind),k("JOINTS_0",v.g.MatricesIndicesKind),k("WEIGHTS_0",v.g.MatricesWeightsKind),k("COLOR_0",v.g.ColorKind);const e=s.Get(n,this._loader.Dd.bufferViews,L.bufferView);return e._dracoBabylonGeometry||(e._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((async n=>{const L=this.dracoDecoder||Bg.c.Default,k=s.TryGet(this._loader.Dd.accessors,i.attributes.POSITION),e=this._loader.parent.alwaysComputeBoundingBox||a.skeleton||!k?null:mg(k);return await L._decodeMeshToGeometryForGltfAsync(a.name,this._loader.babylonScene,n,d,b,e).catch((i=>{throw new Error(`${g}: ${i.message}`)}))}))),await e._dracoBabylonGeometry}))}}t(cg),w(cg,!0,(g=>new Dg(g)));var pg=a(14189),Rg=a(12441),xg=a(12447),Eg=a(12887),Xg=a(13065),vg=a(12415);Eg.d.AddNodeConstructor("Light_Type_0",((g,i)=>()=>new Pg(g,L.Bi.Zero(),i)));class Pg extends Xg.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(g){this._shadowAngle=g,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(g){const i=this.needCube();if(this._direction=g,this.needCube()!==i&&this._shadowGenerators){const g=this._shadowGenerators.values();for(let i=g.next();!0!==i.done;i=g.next()){i.value.recreateShadowMap()}}}constructor(g,i,a){super(g,a),this._shadowAngle=Math.PI/2,this.position=i}getClassName(){return"PointLight"}getTypeID(){return Ig.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(g){if(this.direction)return super.getShadowDirection(g);switch(g){case 0:return new L.Bi(1,0,0);case 1:return new L.Bi(-1,0,0);case 2:return new L.Bi(0,-1,0);case 3:return new L.Bi(0,1,0);case 4:return new L.Bi(0,0,1);case 5:return new L.Bi(0,0,-1)}return L.Bi.Zero()}_setDefaultShadowProjectionMatrix(g,i,a){const n=this.Pg().activeCamera;if(!n)return;const d=void 0!==this.shadowMinZ?this.shadowMinZ:n.Vd,b=void 0!==this.shadowMaxZ?this.shadowMaxZ:n.maxZ,k=this.Pg().getEngine().o;L.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,k?b:d,k?d:b,g,!0,this._scene.getEngine().isNDCHalfZRange,void 0,k)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(g,i){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,i):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,i),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,i),this}transferToNodeMaterialEffect(g,i){return this.computeTransformedInformation()?g.setFloat3(i,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):g.setFloat3(i,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(g,i){g["POINTLIGHT"+i]=!0}}(0,Rg.e)([(0,xg.P)()],Pg.prototype,"shadowAngle",null),(0,vg.e)("BABYLON.PointLight",Pg);const Yg="KHR_lights_punctual";class fg{constructor(g){this.name=Yg,this._loader=g,this.enabled=this._loader.isExtensionUsed(Yg)}dispose(){this._loader=null,delete this._lights}onLoading(){const g=this._loader.Dd.extensions;if(g&&g[this.name]){const i=g[this.name];this._lights=i.lights,s.Assign(this._lights)}}loadNodeAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,b)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(g,i,(g=>{let i;const k=s.Get(n,this._lights,b.gd),e=k.name||g.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,k.type){case"directional":{const g=new pg.d(e,L.Bi.Backward(),this._loader.babylonScene);g.position.Qd(0),i=g;break}case"point":i=new Pg(e,L.Bi.Zero(),this._loader.babylonScene);break;case"spot":{const g=new Fg.c(e,L.Bi.Zero(),L.Bi.Backward(),0,1,this._loader.babylonScene);g.angle=2*(k.spot&&k.spot.outerConeAngle||Math.PI/4),g.innerAngle=2*(k.spot&&k.spot.innerConeAngle||0),i=g;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${n}: Invalid light type (${k.type})`)}i._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,k._babylonLight=i,i.falloffType=Ig.e.FALLOFF_GLTF,i.ab=k.color?d.Ri.xi(k.color):d.Ri.White(),i.ib=void 0==k.ib?1:k.ib,i.range=void 0==k.range?Number.MAX_VALUE:k.range,i.parent=g,this._loader._babylonLights.push(i),r.AddPointerMetadata(i,n),a(g)})))))}}t(Yg),w(Yg,!0,(g=>new fg(g)));const Cg="KHR_materials_pbrSpecularGlossiness";class Ug{constructor(g){this.name=Cg,this.order=200,this._loader=g,this.enabled=this._loader.isExtensionUsed(Cg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=new Array;return d.push(this._loader.loadMaterialBasePropertiesAsync(g,i,a)),d.push(this._loadSpecularGlossinessPropertiesAsync(n,L,a)),this._loader.loadMaterialAlphaProperties(g,i,a),await Promise.all(d).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(g,i,a){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);const n=new Array;return a.metallic=null,a.roughness=null,i.diffuseFactor?(a.albedoColor=d.Ri.xi(i.diffuseFactor),a.alpha=i.diffuseFactor[3]):a.albedoColor=d.Ri.White(),a.reflectivityColor=i.specularFactor?d.Ri.xi(i.specularFactor):d.Ri.White(),a.microSurface=void 0==i.glossinessFactor?1:i.glossinessFactor,i.diffuseTexture&&n.push(this._loader.loadTextureInfoAsync(`${g}/diffuseTexture`,i.diffuseTexture,(g=>{g.name=`${a.name} (Diffuse)`,a.albedoTexture=g}))),i.specularGlossinessTexture&&(n.push(this._loader.loadTextureInfoAsync(`${g}/specularGlossinessTexture`,i.specularGlossinessTexture,(g=>{g.name=`${a.name} (Specular Glossiness)`,a.reflectivityTexture=g,a.reflectivityTexture.Ud=!0}))),a.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(n).then((()=>{}))}}t(Cg),w(Cg,!0,(g=>new Ug(g)));const Sg="KHR_materials_unlit";class Vg{constructor(g){this.name=Sg,this.order=210,this._loader=g,this.enabled=this._loader.isExtensionUsed(Sg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async()=>await this._loadUnlitPropertiesAsync(g,i,a)))}_loadUnlitPropertiesAsync(g,i,a){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);const n=new Array;a.unlit=!0;const L=i.pbrMetallicRoughness;return L&&(L.baseColorFactor?(a.albedoColor=d.Ri.xi(L.baseColorFactor),a.alpha=L.baseColorFactor[3]):a.albedoColor=d.Ri.White(),L.baseColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${g}/baseColorTexture`,L.baseColorTexture,(g=>{g.name=`${a.name} (Base Color)`,a.albedoTexture=g})))),i.doubleSided&&(a.zd=!1,a.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(g,i,a),Promise.all(n).then((()=>{}))}}t(Sg),w(Sg,!0,(g=>new Vg(g)));const Kg="KHR_materials_clearcoat";class Tg{constructor(g){this.name=Kg,this.order=190,this._loader=g,this.enabled=this._loader.isExtensionUsed(Kg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=new Array;d.push(this._loader.loadMaterialPropertiesAsync(g,i,a)),d.push(this._loadClearCoatPropertiesAsync(n,L,a)),await Promise.all(d)}))}_loadClearCoatPropertiesAsync(g,i,a){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);const n=new Array;return a.clearCoat.isEnabled=!0,a.clearCoat.useRoughnessFromMainTexture=!1,a.clearCoat.remapF0OnInterfaceChange=!1,void 0!=i.clearcoatFactor?a.clearCoat.ib=i.clearcoatFactor:a.clearCoat.ib=0,i.clearcoatTexture&&n.push(this._loader.loadTextureInfoAsync(`${g}/clearcoatTexture`,i.clearcoatTexture,(g=>{g.name=`${a.name} (ClearCoat)`,a.clearCoat.texture=g}))),void 0!=i.clearcoatRoughnessFactor?a.clearCoat.roughness=i.clearcoatRoughnessFactor:a.clearCoat.roughness=0,i.clearcoatRoughnessTexture&&(i.clearcoatRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${g}/clearcoatRoughnessTexture`,i.clearcoatRoughnessTexture,(g=>{g.name=`${a.name} (ClearCoat Roughness)`,a.clearCoat.textureRoughness=g})))),i.clearcoatNormalTexture&&(i.clearcoatNormalTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${g}/clearcoatNormalTexture`,i.clearcoatNormalTexture,(g=>{g.name=`${a.name} (ClearCoat Normal)`,a.clearCoat.bumpTexture=g}))),a.invertNormalMapX=!a.Pg().useRightHandedSystem,a.invertNormalMapY=a.Pg().useRightHandedSystem,void 0!=i.clearcoatNormalTexture.scale&&(a.clearCoat.bumpTexture.level=i.clearcoatNormalTexture.scale)),Promise.all(n).then((()=>{}))}}t(Kg),w(Kg,!0,(g=>new Tg(g)));const lg="KHR_materials_iridescence";class Zg{constructor(g){this.name=lg,this.order=195,this._loader=g,this.enabled=this._loader.isExtensionUsed(lg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(g,i,a)),d.push(this._loadIridescencePropertiesAsync(n,L,a)),await Promise.all(d).then((()=>{}))}))}_loadIridescencePropertiesAsync(g,i,a){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);const n=new Array;return a.iridescence.isEnabled=!0,a.iridescence.ib=i.iridescenceFactor??0,a.iridescence.indexOfRefraction=i.iridescenceIor??i.iridescenceIOR??1.3,a.iridescence.minimumThickness=i.iridescenceThicknessMinimum??100,a.iridescence.maximumThickness=i.iridescenceThicknessMaximum??400,i.iridescenceTexture&&n.push(this._loader.loadTextureInfoAsync(`${g}/iridescenceTexture`,i.iridescenceTexture,(g=>{g.name=`${a.name} (Iridescence)`,a.iridescence.texture=g}))),i.iridescenceThicknessTexture&&n.push(this._loader.loadTextureInfoAsync(`${g}/iridescenceThicknessTexture`,i.iridescenceThicknessTexture,(g=>{g.name=`${a.name} (Iridescence Thickness)`,a.iridescence.thicknessTexture=g}))),Promise.all(n).then((()=>{}))}}t(lg),w(lg,!0,(g=>new Zg(g)));const hg="KHR_materials_anisotropy";class wg{constructor(g){this.name=hg,this.order=195,this._loader=g,this.enabled=this._loader.isExtensionUsed(hg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=new Array;d.push(this._loader.loadMaterialPropertiesAsync(g,i,a)),d.push(this._loadIridescencePropertiesAsync(n,L,a)),await Promise.all(d)}))}async _loadIridescencePropertiesAsync(g,i,a){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);const n=new Array;a.anisotropy.isEnabled=!0,a.anisotropy.ib=i.anisotropyStrength??0,a.anisotropy.angle=i.anisotropyRotation??0,i.anisotropyTexture&&(i.anisotropyTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${g}/anisotropyTexture`,i.anisotropyTexture,(g=>{g.name=`${a.name} (Anisotropy Intensity)`,a.anisotropy.texture=g})))),await Promise.all(n)}}t(hg),w(hg,!0,(g=>new wg(g)));const tg="KHR_materials_emissive_strength";class Ag{constructor(g){this.name=tg,this.order=170,this._loader=g,this.enabled=this._loader.isExtensionUsed(tg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>await this._loader.loadMaterialPropertiesAsync(g,i,a).then((()=>{this._loadEmissiveProperties(n,L,a)}))))}_loadEmissiveProperties(g,i,a){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);void 0!==i.emissiveStrength&&(a.emissiveIntensity=i.emissiveStrength)}}t(tg),w(tg,!0,(g=>new Ag(g)));const Og="KHR_materials_sheen";class zg{constructor(g){this.name=Og,this.order=190,this._loader=g,this.enabled=this._loader.isExtensionUsed(Og)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(g,i,a)),d.push(this._loadSheenPropertiesAsync(n,L,a)),await Promise.all(d).then((()=>{}))}))}_loadSheenPropertiesAsync(g,i,a){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);const n=new Array;return a.sheen.isEnabled=!0,a.sheen.ib=1,void 0!=i.sheenColorFactor?a.sheen.color=d.Ri.xi(i.sheenColorFactor):a.sheen.color=d.Ri.Black(),i.sheenColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${g}/sheenColorTexture`,i.sheenColorTexture,(g=>{g.name=`${a.name} (Sheen Color)`,a.sheen.texture=g}))),void 0!==i.sheenRoughnessFactor?a.sheen.roughness=i.sheenRoughnessFactor:a.sheen.roughness=0,i.sheenRoughnessTexture&&(i.sheenRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${g}/sheenRoughnessTexture`,i.sheenRoughnessTexture,(g=>{g.name=`${a.name} (Sheen Roughness)`,a.sheen.textureRoughness=g})))),a.sheen.albedoScaling=!0,a.sheen.useRoughnessFromMainTexture=!1,Promise.all(n).then((()=>{}))}}t(Og),w(Og,!0,(g=>new zg(g)));var sg=a(12950);const mi="KHR_materials_specular";class rg{constructor(g){this.name=mi,this.order=190,this._loader=g,this.enabled=this._loader.isExtensionUsed(mi)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=new Array;if(d.push(this._loader.loadMaterialPropertiesAsync(g,i,a)),d.push(this._loadSpecularPropertiesAsync(n,L,a)),L.extensions&&L.extensions.EXT_materials_specular_edge_color&&a instanceof x.b){L.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(a.brdf.dielectricSpecularModel=sg.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,a.brdf.conductorSpecularModel=sg.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(d).then((()=>{}))}))}_loadSpecularPropertiesAsync(g,i,a){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);const n=new Array;return void 0!==i.specularFactor&&(a.metallicF0Factor=i.specularFactor),void 0!==i.specularColorFactor&&(a.metallicReflectanceColor=d.Ri.xi(i.specularColorFactor)),i.specularTexture&&(i.specularTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${g}/specularTexture`,i.specularTexture,(g=>{g.name=`${a.name} (Specular)`,a.metallicReflectanceTexture=g,a.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),i.specularColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${g}/specularColorTexture`,i.specularColorTexture,(g=>{g.name=`${a.name} (Specular Color)`,a.reflectanceTexture=g}))),Promise.all(n).then((()=>{}))}}t(mi),w(mi,!0,(g=>new rg(g)));const Qg="KHR_materials_ior";class og{constructor(g){this.name=Qg,this.order=180,this._loader=g,this.enabled=this._loader.isExtensionUsed(Qg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(g,i,a)),d.push(this._loadIorPropertiesAsync(n,L,a)),await Promise.all(d).then((()=>{}))}))}_loadIorPropertiesAsync(g,i,a){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);return void 0!==i.ior?a.indexOfRefraction=i.ior:a.indexOfRefraction=og._DEFAULT_IOR,Promise.resolve()}}og._DEFAULT_IOR=1.5,t(Qg),w(Qg,!0,(g=>new og(g)));const ug="KHR_materials_variants";class Hg{constructor(g){this.name=ug,this._loader=g,this.enabled=this._loader.isExtensionUsed(ug)}dispose(){this._loader=null}static GetAvailableVariants(g){const i=this._GetExtensionMetadata(g);return i?Object.keys(i.variants):[]}getAvailableVariants(g){return Hg.GetAvailableVariants(g)}static SelectVariant(g,i){const a=this._GetExtensionMetadata(g);if(!a)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${ug} extension`);const n=g=>{const i=a.variants[g];if(i)for(const a of i)a.mesh.material=a.material};if(i instanceof Array)for(const L of i)n(L);else n(i);a.lastSelected=i}selectVariant(g,i){Hg.SelectVariant(g,i)}static Reset(g){const i=this._GetExtensionMetadata(g);if(!i)throw new Error(`Cannot reset on a glTF mesh that does not have the ${ug} extension`);for(const a of i.original)a.mesh.material=a.material;i.lastSelected=null}reset(g){Hg.Reset(g)}static GetLastSelectedVariant(g){const i=this._GetExtensionMetadata(g);if(!i)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${ug} extension`);return i.lastSelected}getLastSelectedVariant(g){return Hg.GetLastSelectedVariant(g)}static _GetExtensionMetadata(g){var i,a;return(null===g||void 0===g||null===(i=g._internalMetadata)||void 0===i||null===(a=i.Dd)||void 0===a?void 0:a[ug])||null}onLoading(){const g=this._loader.Dd.extensions;if(g&&g[this.name]){const i=g[this.name];this._variants=i.variants}}onReady(){const g=this._loader.rootBabylonMesh;if(g){var i;const a=this._loader.parent.extensionOptions[ug];null!==a&&void 0!==a&&a.defaultVariant&&Hg.SelectVariant(g,a.defaultVariant),null===a||void 0===a||null===(i=a.onLoaded)||void 0===i||i.call(a,{get variants(){return Hg.GetAvailableVariants(g)},get selectedVariant(){const i=Hg.GetLastSelectedVariant(g);return i?Array.isArray(i)?i[0]:i:Hg.GetAvailableVariants(g)[0]},set selectedVariant(i){Hg.SelectVariant(g,i)}})}}_loadMeshPrimitiveAsync(g,i,a,n,L,d){return r.LoadExtensionAsync(g,L,this.name,(async(b,k)=>{const e=new Array;return e.push(this._loader._loadMeshPrimitiveAsync(g,i,a,n,L,(i=>{if(d(i),i instanceof f.e){const a=r._GetDrawMode(g,L.mode),n=this._loader.rootBabylonMesh,d=n?n._internalMetadata=n._internalMetadata||{}:{},N=d.Dd=d.Dd||{},F=N[ug]=N[ug]||{lastSelected:null,original:[],variants:{}};F.original.push({mesh:i,material:i.material});for(let g=0;g<k.mappings.length;++g){const L=k.mappings[g],d=s.Get(`${b}/mappings/${g}/material`,this._loader.Dd.materials,L.material);e.push(this._loader._loadMaterialAsync(`#/materials/${L.material}`,d,i,a,(g=>{for(let a=0;a<L.variants.length;++a){const d=L.variants[a],b=s.Get(`/extensions/${ug}/variants/${d}`,this._variants,d);F.variants[b.name]=F.variants[b.name]||[],F.variants[b.name].push({mesh:i,material:g}),i.onClonedObservable.add((g=>{const a=g;let L=null,d=a;do{if(d=d.parent,!d)return;L=Hg._GetExtensionMetadata(d)}while(null===L);if(n&&L===Hg._GetExtensionMetadata(n)){d._internalMetadata={};for(const g in n._internalMetadata)d._internalMetadata[g]=n._internalMetadata[g];d._internalMetadata.Dd=[];for(const g in n._internalMetadata.Dd)d._internalMetadata.Dd[g]=n._internalMetadata.Dd[g];d._internalMetadata.Dd[ug]={lastSelected:null,original:[],variants:{}};for(const g of L.original)d._internalMetadata.Dd[ug].original.push({mesh:g.mesh,material:g.material});for(const g in L.variants)if(Object.prototype.hasOwnProperty.call(L.variants,g)){d._internalMetadata.Dd[ug].variants[g]=[];for(const i of L.variants[g])d._internalMetadata.Dd[ug].variants[g].push({mesh:i.mesh,material:i.material})}L=d._internalMetadata.Dd[ug]}for(const n of L.original)n.mesh===i&&(n.mesh=a);for(const n of L.variants[b.name])n.mesh===i&&(n.mesh=a)}))}})))}}}))),await Promise.all(e).then((g=>{let[i]=g;return i}))}))}}t(ug),w(ug,!0,(g=>new Hg(g)));var Mg=a(12508);class qg{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:sg.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(g,i){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...qg._GetDefaultOptions(),...g},this._scene=i,this._scene._transmissionHelper=this,this.onErrorObservable=new F.b,this._scene.dd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(g){if(!Object.keys(g).filter((i=>this._options[i]!==g[i])).length)return;const i={...this._options,...g},a=this._options;this._options=i,i.renderSize===a.renderSize&&i.renderTargetTextureType===a.renderTargetTextureType&&i.generateMipmaps===a.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=i.samples,this._opaqueRenderTarget.lodGenerationScale=i.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=i.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(g){return!!g&&!!(g instanceof x.b&&g.subSurface.isRefractionEnabled)}_addMesh(g){this._materialObservers[g.uniqueId]=g.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),b.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(g.material)?(g.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(g)&&this._transparentMeshesCache.push(g)):-1===this._opaqueMeshesCache.indexOf(g)&&this._opaqueMeshesCache.push(g)}))}_removeMesh(g){g.onMaterialChangedObservable.remove(this._materialObservers[g.uniqueId]),delete this._materialObservers[g.uniqueId];let i=this._transparentMeshesCache.indexOf(g);-1!==i&&this._transparentMeshesCache.splice(i,1),i=this._opaqueMeshesCache.indexOf(g),-1!==i&&this._opaqueMeshesCache.splice(i,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(g){const i=this._transparentMeshesCache.indexOf(g),a=this._opaqueMeshesCache.indexOf(g);this._shouldRenderAsTransmission(g.material)?(g.material instanceof x.b&&(g.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==a?(this._opaqueMeshesCache.splice(a,1),this._transparentMeshesCache.push(g)):-1===i&&this._transparentMeshesCache.push(g)):-1!==i?(this._transparentMeshesCache.splice(i,1),this._opaqueMeshesCache.push(g)):-1===a&&this._opaqueMeshesCache.push(g)}_isRenderTargetValid(){var g;return null!==(null===(g=this._opaqueRenderTarget)||void 0===g?void 0:g.getInternalTexture())}_setupRenderTargets(){var g;let i;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Mg.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(g=this._options.clearColor)||void 0===g?void 0:g.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((g=>{i=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?g.clearColor.I(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(g.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=i}));for(const a of this._transparentMeshesCache)this._shouldRenderAsTransmission(a.material)&&(a.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Wg="KHR_materials_transmission";class Gg{constructor(g){this.name=Wg,this.order=175,this._loader=g,this.enabled=this._loader.isExtensionUsed(Wg),this.enabled&&(g.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(g,i,a)),d.push(this._loadTransparentPropertiesAsync(n,i,a,L)),await Promise.all(d).then((()=>{}))}))}_loadTransparentPropertiesAsync(g,i,a,n){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);const L=a;if(L.subSurface.isRefractionEnabled=!0,L.subSurface.volumeIndexOfRefraction=1,L.subSurface.useAlbedoToTintRefraction=!0,void 0===n.transmissionFactor)return L.subSurface.refractionIntensity=0,L.subSurface.isRefractionEnabled=!1,Promise.resolve();{var d;L.subSurface.refractionIntensity=n.transmissionFactor;const g=L.Pg();if(L.subSurface.refractionIntensity&&!g._transmissionHelper)new qg({},L.Pg());else if(L.subSurface.refractionIntensity&&(null===(d=g._transmissionHelper)||void 0===d||!d._isRenderTargetValid())){var b;null===(b=g._transmissionHelper)||void 0===b||b._setupRenderTargets()}}return L.subSurface.minimumThickness=0,L.subSurface.maximumThickness=0,n.transmissionTexture?(n.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${g}/transmissionTexture`,n.transmissionTexture,void 0).then((g=>{g.name=`${a.name} (Transmission)`,L.subSurface.refractionIntensityTexture=g,L.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}t(Wg),w(Wg,!0,(g=>new Gg(g)));const Jg="KHR_materials_diffuse_transmission";class gi{constructor(g){this.name=Jg,this.order=174,this._loader=g,this.enabled=this._loader.isExtensionUsed(Jg),this.enabled&&(g.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(g,i,a)),d.push(this._loadTranslucentPropertiesAsync(n,i,a,L)),await Promise.all(d).then((()=>{}))}))}_loadTranslucentPropertiesAsync(g,i,a,n){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);const L=a;if(L.subSurface.isTranslucencyEnabled=!0,L.subSurface.volumeIndexOfRefraction=1,L.subSurface.minimumThickness=0,L.subSurface.maximumThickness=0,L.subSurface.useAlbedoToTintTranslucency=!1,void 0===n.diffuseTransmissionFactor)return L.subSurface.translucencyIntensity=0,L.subSurface.isTranslucencyEnabled=!1,Promise.resolve();L.subSurface.translucencyIntensity=n.diffuseTransmissionFactor;const b=new Array;return L.subSurface.useGltfStyleTextures=!0,n.diffuseTransmissionTexture&&(n.diffuseTransmissionTexture.nonColorData=!0,b.push(this._loader.loadTextureInfoAsync(`${g}/diffuseTransmissionTexture`,n.diffuseTransmissionTexture).then((g=>{g.name=`${a.name} (Diffuse Transmission)`,L.subSurface.translucencyIntensityTexture=g})))),void 0!==n.diffuseTransmissionColorFactor?L.subSurface.translucencyColor=d.Ri.xi(n.diffuseTransmissionColorFactor):L.subSurface.translucencyColor=d.Ri.White(),n.diffuseTransmissionColorTexture&&b.push(this._loader.loadTextureInfoAsync(`${g}/diffuseTransmissionColorTexture`,n.diffuseTransmissionColorTexture).then((g=>{g.name=`${a.name} (Diffuse Transmission Color)`,L.subSurface.translucencyColorTexture=g}))),Promise.all(b).then((()=>{}))}}t(Jg),w(Jg,!0,(g=>new gi(g)));const ii="KHR_materials_volume";class ai{constructor(g){this.name=ii,this.order=173,this._loader=g,this.enabled=this._loader.isExtensionUsed(ii),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(g,i,a)),d.push(this._loadVolumePropertiesAsync(n,i,a,L)),await Promise.all(d).then((()=>{}))}))}_loadVolumePropertiesAsync(g,i,a,n){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);if(!a.subSurface.isRefractionEnabled&&!a.subSurface.isTranslucencyEnabled||!n.thicknessFactor)return Promise.resolve();a.subSurface.volumeIndexOfRefraction=a.indexOfRefraction;const L=void 0!==n.attenuationDistance?n.attenuationDistance:Number.MAX_VALUE;return a.subSurface.tintColorAtDistance=L,void 0!==n.attenuationColor&&3==n.attenuationColor.length&&a.subSurface.tintColor.sd(n.attenuationColor[0],n.attenuationColor[1],n.attenuationColor[2]),a.subSurface.minimumThickness=0,a.subSurface.maximumThickness=n.thicknessFactor,a.subSurface.useThicknessAsDepth=!0,n.thicknessTexture?(n.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${g}/thicknessTexture`,n.thicknessTexture).then((g=>{g.name=`${a.name} (Thickness)`,a.subSurface.thicknessTexture=g,a.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}t(ii),w(ii,!0,(g=>new ai(g)));const ni="KHR_materials_dispersion";class Li{constructor(g){this.name=ni,this.order=174,this._loader=g,this.enabled=this._loader.isExtensionUsed(ni)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(g,i,a)),d.push(this._loadDispersionPropertiesAsync(n,i,a,L)),await Promise.all(d).then((()=>{}))}))}_loadDispersionPropertiesAsync(g,i,a,n){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);return a.subSurface.isRefractionEnabled&&n.dispersion?(a.subSurface.isDispersionEnabled=!0,a.subSurface.dispersion=n.dispersion,Promise.resolve()):Promise.resolve()}}t(ni),w(ni,!0,(g=>new Li(g)));const di="EXT_materials_diffuse_roughness";class bi{constructor(g){this.name=di,this.order=190,this._loader=g,this.enabled=this._loader.isExtensionUsed(di)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(g,i,a)),d.push(this._loadDiffuseRoughnessPropertiesAsync(n,L,a)),await Promise.all(d).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(g,i,a){if(!(a instanceof x.b))throw new Error(`${g}: Material type not supported`);const n=new Array;return a.brdf.baseDiffuseModel=sg.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=i.diffuseRoughnessFactor?a.baseDiffuseRoughness=i.diffuseRoughnessFactor:a.baseDiffuseRoughness=0,i.diffuseRoughnessTexture&&n.push(this._loader.loadTextureInfoAsync(`${g}/diffuseRoughnessTexture`,i.diffuseRoughnessTexture,(g=>{g.name=`${a.name} (Diffuse Roughness)`,a.baseDiffuseRoughnessTexture=g}))),Promise.all(n).then((()=>{}))}}t(di),w(di,!0,(g=>new bi(g)));const ki="KHR_mesh_quantization";class ei{constructor(g){this.name=ki,this.enabled=g.isExtensionUsed(ki)}dispose(){}}t(ki),w(ki,!0,(g=>new ei(g)));const Ni="KHR_texture_basisu";class Fi{constructor(g){this.name=Ni,this._loader=g,this.enabled=g.isExtensionUsed(Ni)}dispose(){this._loader=null}_loadTextureAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>{const d=void 0==i.sampler?r.DefaultSampler:s.Get(`${g}/sampler`,this._loader.Dd.samplers,i.sampler),b=s.Get(`${n}/source`,this._loader.Dd.images,L.source);return await this._loader._createTextureAsync(g,d,b,(g=>{a(g)}),i._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!i._textureInfo.nonColorData)}))}}t(Ni),w(Ni,!0,(g=>new Fi(g)));const Ii="KHR_texture_transform";class ji{constructor(g){this.name=Ii,this._loader=g,this.enabled=this._loader.isExtensionUsed(Ii)}dispose(){this._loader=null}loadTextureInfoAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(n,L)=>await this._loader.loadTextureInfoAsync(g,i,(g=>{if(!(g instanceof E.c))throw new Error(`${n}: Texture type not supported`);L.offset&&(g.uOffset=L.offset[0],g.vOffset=L.offset[1]),g.uRotationCenter=0,g.vRotationCenter=0,L.rotation&&(g.wAng=-L.rotation),L.scale&&(g.uScale=L.scale[0],g.vScale=L.scale[1]),void 0!=L.texCoord&&(g.coordinatesIndex=L.texCoord),a(g)}))))}}t(Ii),w(Ii,!0,(g=>new ji(g)));const yi="KHR_xmp_json_ld";class Bi{constructor(g){this.name=yi,this.order=100,this._loader=g,this.enabled=this._loader.isExtensionUsed(yi)}dispose(){this._loader=null}onLoading(){var g,i,a;if(null===this._loader.rootBabylonMesh)return;const n=null===(g=this._loader.Dd.extensions)||void 0===g?void 0:g.KHR_xmp_json_ld,L=null===(i=this._loader.Dd.asset)||void 0===i||null===(a=i.extensions)||void 0===a?void 0:a.KHR_xmp_json_ld;if(n&&L){const g=+L.packet;n.packets&&g<n.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=n.packets[g])}}}function ci(g,i,a,n){return d.Ri.xi(i,a).scale(n)}function Di(g,i,a,n){return i[a]*n}function pi(g,i,a,n){return-i[a]*n}function Ri(g,i,a,n){return i[a+1]*n}function xi(g,i,a,n){return i[a]*n*2}function Ei(g){return{scale:[new vi(j.b.ANIMATIONTYPE_FLOAT,`${g}.uScale`,Di,(()=>2)),new vi(j.b.ANIMATIONTYPE_FLOAT,`${g}.vScale`,Ri,(()=>2))],offset:[new vi(j.b.ANIMATIONTYPE_FLOAT,`${g}.uOffset`,Di,(()=>2)),new vi(j.b.ANIMATIONTYPE_FLOAT,`${g}.vOffset`,Ri,(()=>2))],rotation:[new vi(j.b.ANIMATIONTYPE_FLOAT,`${g}.wAng`,pi,(()=>1))]}}t(yi),w(yi,!0,(g=>new Bi(g)));class Xi extends Q.AnimationPropertyInfo{buildAnimations(g,i,a,n){return[{babylonAnimatable:g._babylonCamera,babylonAnimation:this._buildAnimation(i,a,n)}]}}class vi extends Q.AnimationPropertyInfo{buildAnimations(g,i,a,n){const L=[];for(const d in g._data)L.push({babylonAnimatable:g._data[d].babylonMaterial,babylonAnimation:this._buildAnimation(i,a,n)});return L}}class Pi extends Q.AnimationPropertyInfo{buildAnimations(g,i,a,n){return[{babylonAnimatable:g._babylonLight,babylonAnimation:this._buildAnimation(i,a,n)}]}}(0,A.l)("/cameras/{}/orthographic/xmag",[new Xi(j.b.ANIMATIONTYPE_FLOAT,"orthoLeft",pi,(()=>1)),new Xi(j.b.ANIMATIONTYPE_FLOAT,"orthoRight",Ri,(()=>1))]),(0,A.l)("/cameras/{}/orthographic/ymag",[new Xi(j.b.ANIMATIONTYPE_FLOAT,"orthoBottom",pi,(()=>1)),new Xi(j.b.ANIMATIONTYPE_FLOAT,"orthoTop",Ri,(()=>1))]),(0,A.l)("/cameras/{}/orthographic/zfar",[new Xi(j.b.ANIMATIONTYPE_FLOAT,"maxZ",Di,(()=>1))]),(0,A.l)("/cameras/{}/orthographic/znear",[new Xi(j.b.ANIMATIONTYPE_FLOAT,"Vd",Di,(()=>1))]),(0,A.l)("/cameras/{}/perspective/yfov",[new Xi(j.b.ANIMATIONTYPE_FLOAT,"fov",Di,(()=>1))]),(0,A.l)("/cameras/{}/perspective/zfar",[new Xi(j.b.ANIMATIONTYPE_FLOAT,"maxZ",Di,(()=>1))]),(0,A.l)("/cameras/{}/perspective/znear",[new Xi(j.b.ANIMATIONTYPE_FLOAT,"Vd",Di,(()=>1))]),(0,A.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new vi(j.b.ANIMATIONTYPE_COLOR3,"albedoColor",ci,(()=>4)),new vi(j.b.ANIMATIONTYPE_FLOAT,"alpha",(function(g,i,a,n){return i[a+3]*n}),(()=>4))]),(0,A.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new vi(j.b.ANIMATIONTYPE_FLOAT,"metallic",Di,(()=>1))]),(0,A.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new vi(j.b.ANIMATIONTYPE_FLOAT,"roughness",Di,(()=>1))]);const Yi=Ei("albedoTexture");(0,A.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Yi.scale),(0,A.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Yi.offset),(0,A.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Yi.rotation);const fi=Ei("metallicTexture");(0,A.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",fi.scale),(0,A.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",fi.offset),(0,A.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",fi.rotation),(0,A.l)("/materials/{}/emissiveFactor",[new vi(j.b.ANIMATIONTYPE_COLOR3,"emissiveColor",ci,(()=>3))]);const Ci=Ei("bumpTexture");(0,A.l)("/materials/{}/normalTexture/scale",[new vi(j.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Di,(()=>1))]),(0,A.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Ci.scale),(0,A.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Ci.offset),(0,A.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Ci.rotation),(0,A.l)("/materials/{}/occlusionTexture/strength",[new vi(j.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Di,(()=>1))]);const Ui=Ei("ambientTexture");(0,A.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Ui.scale),(0,A.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Ui.offset),(0,A.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Ui.rotation);const Si=Ei("emissiveTexture");(0,A.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Si.scale),(0,A.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Si.offset),(0,A.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Si.rotation),(0,A.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new vi(j.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Di,(()=>1))]),(0,A.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new vi(j.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Di,(()=>1))]);const Vi=Ei("anisotropy.texture");(0,A.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Vi.scale),(0,A.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Vi.offset),(0,A.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Vi.rotation),(0,A.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new vi(j.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Di,(()=>1))]),(0,A.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new vi(j.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Di,(()=>1))]);const Ki=Ei("clearCoat.texture");(0,A.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Ki.scale),(0,A.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Ki.offset),(0,A.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Ki.rotation);const Ti=Ei("clearCoat.bumpTexture");(0,A.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new vi(j.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Di,(()=>1))]),(0,A.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Ti.scale),(0,A.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Ti.offset),(0,A.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Ti.rotation);const li=Ei("clearCoat.textureRoughness");(0,A.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",li.scale),(0,A.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",li.offset),(0,A.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",li.rotation),(0,A.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new vi(j.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Di,(()=>1))]),(0,A.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new vi(j.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Di,(()=>1))]),(0,A.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new vi(j.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Di,(()=>1))]),(0,A.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new vi(j.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Di,(()=>1))]),(0,A.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new vi(j.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Di,(()=>1))]),(0,A.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new vi(j.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Di,(()=>1))]),(0,A.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new vi(j.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Di,(()=>1))]);const Zi=Ei("iridescence.texture");(0,A.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Zi.scale),(0,A.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Zi.offset),(0,A.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Zi.rotation);const hi=Ei("iridescence.thicknessTexture");(0,A.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",hi.scale),(0,A.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",hi.offset),(0,A.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",hi.rotation),(0,A.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new vi(j.b.ANIMATIONTYPE_COLOR3,"sheen.color",ci,(()=>3))]),(0,A.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new vi(j.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",Di,(()=>1))]);const wi=Ei("sheen.texture");(0,A.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",wi.scale),(0,A.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",wi.offset),(0,A.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",wi.rotation);const ti=Ei("sheen.textureRoughness");(0,A.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",ti.scale),(0,A.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",ti.offset),(0,A.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",ti.rotation),(0,A.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new vi(j.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Di,(()=>1))]),(0,A.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new vi(j.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",ci,(()=>3))]);const Ai=Ei("metallicReflectanceTexture");(0,A.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Ai.scale),(0,A.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Ai.offset),(0,A.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Ai.rotation);const Oi=Ei("reflectanceTexture");(0,A.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Oi.scale),(0,A.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Oi.offset),(0,A.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Oi.rotation),(0,A.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new vi(j.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Di,(()=>1))]);const zi=Ei("subSurface.refractionIntensityTexture");(0,A.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",zi.scale),(0,A.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",zi.offset),(0,A.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",zi.rotation),(0,A.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new vi(j.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",ci,(()=>3))]),(0,A.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new vi(j.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Di,(()=>1))]),(0,A.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new vi(j.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Di,(()=>1))]);const si=Ei("subSurface.thicknessTexture");(0,A.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",si.scale),(0,A.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",si.offset),(0,A.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",si.rotation),(0,A.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new vi(j.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Di,(()=>1))]);const ma=Ei("subSurface.translucencyIntensityTexture");(0,A.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",ma.scale),(0,A.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",ma.offset),(0,A.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",ma.rotation),(0,A.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new vi(j.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",ci,(()=>3))]);const ri=Ei("subSurface.translucencyColorTexture");(0,A.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",ri.scale),(0,A.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",ri.offset),(0,A.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",ri.rotation),(0,A.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new Pi(j.b.ANIMATIONTYPE_COLOR3,"diffuse",ci,(()=>3))]),(0,A.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Pi(j.b.ANIMATIONTYPE_FLOAT,"intensity",Di,(()=>1))]),(0,A.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new Pi(j.b.ANIMATIONTYPE_FLOAT,"range",Di,(()=>1))]),(0,A.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Pi(j.b.ANIMATIONTYPE_FLOAT,"innerAngle",xi,(()=>1))]),(0,A.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Pi(j.b.ANIMATIONTYPE_FLOAT,"angle",xi,(()=>1))]),(0,A.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new Pi(j.b.ANIMATIONTYPE_COLOR3,"diffuse",ci,(()=>3))]),(0,A.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Pi(j.b.ANIMATIONTYPE_FLOAT,"intensity",Di,(()=>1))]);const Qi="KHR_animation_pointer";class oi{constructor(g){this.name=Qi,this._loader=g,this._pathToObjectConverter=(0,A.i)(this._loader.Dd)}get enabled(){return this._loader.isExtensionUsed(Qi)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(g,i,a,n,L){var d;const b=null===(d=n.target.extensions)||void 0===d?void 0:d.KHR_animation_pointer;if(!b||!this._pathToObjectConverter)return null;"pointer"!==n.target.path&&c.b.Warn(`${g}/target/path: Value (${n.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=n.target.node&&c.b.Warn(`${g}/target/node: Value (${n.target.node}) must not be present when using the ${this.name} extension`);const k=`${g}/extensions/${this.name}`,e=b.pointer;if(!e)throw new Error(`${k}: Pointer is missing`);try{const d=this._pathToObjectConverter.convert(e);if(!d.info.interpolation)throw new Error(`${k}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(g,i,a,n,{object:d.object,info:d.info.interpolation},L)}catch(N){return c.b.Warn(`${k}/pointer: Invalid pointer (${e}) skipped`),null}}}t(Qi),w(Qi,!0,(g=>new oi(g)));class ui{constructor(g,i,a){this.frame=g,this.action=i,this.onlyOnce=a,this.isDone=!1}_clone(){return new ui(this.frame,this.action,this.onlyOnce)}}var Hi=a(12303),Mi=a(12354),qi=a(12352);class Wi{get loop(){return this._loop}set loop(g){g!==this._loop&&(this._loop=g,this.updateOptions({loop:g}))}get currentTime(){var g;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(g=Mi.d.audioEngine)&&void 0!==g&&g.audioContext&&(this.isPlaying||this.isPaused)){const g=this.isPaused?0:Mi.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+g}return 0}get spatialSound(){return this._spatialSound}set spatialSound(g){if(g==this._spatialSound)return;const i=this.isPlaying;this.pause(),g?(this._spatialSound=g,this._updateSpatialParameters()):this._disableSpatialSound(),i&&this.play()}constructor(g,i,a){var n;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new F.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=L.Bi.Zero(),this._localDirection=new L.Bi(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=g,a=a||B.c.LastCreatedScene)if(this._scene=a,Wi._SceneComponentInitialization(a),this._readyToPlayCallback=d,this._customAttenuationFunction=(g,i,a,n,L)=>i<a?g*(1-i/a):0,k&&(this.autoplay=k.autoplay||!1,this._loop=k.loop||!1,void 0!==k.volume&&(this._volume=k.volume),this._spatialSound=k.spatialSound??!1,this.maxDistance=k.maxDistance??100,this.useCustomAttenuation=k.useCustomAttenuation??!1,this.rolloffFactor=k.rolloffFactor||1,this.refDistance=k.refDistance||1,this.distanceModel=k.distanceModel||"linear",this._playbackRate=k.playbackRate||1,this._streaming=k.streaming??!1,this._length=k.length,this._offset=k.offset),null!==(n=Mi.d.audioEngine)&&void 0!==n&&n.canUseWebAudio&&Mi.d.audioEngine.audioContext){this._soundGain=Mi.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let g=!0;if(i)try{"string"===typeof i?(this._urlType="String",this._url=i):i instanceof ArrayBuffer?this._urlType="ArrayBuffer":i instanceof HTMLMediaElement?this._urlType="MediaElement":i instanceof MediaStream?this._urlType="MediaStream":i instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(i)&&(this._urlType="Array");let a=[],n=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Mi.d.audioEngine.audioContext.createMediaElementSource(i),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Mi.d.audioEngine.audioContext.createMediaStreamSource(i),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":i.byteLength>0&&(n=!0,this._soundLoaded(i));break;case"AudioBuffer":this._audioBufferLoaded(i);break;case"String":a.push(i);case"Array":0===a.length&&(a=i);for(let g=0;g<a.length;g++){const i=a[g];if(n=k&&k.skipCodecCheck||-1!==i.indexOf(".mp3",i.length-4)&&Mi.d.audioEngine.isMP3supported||-1!==i.indexOf(".ogg",i.length-4)&&Mi.d.audioEngine.isOGGsupported||-1!==i.indexOf(".wav",i.length-4)||-1!==i.indexOf(".m4a",i.length-4)||-1!==i.indexOf(".mp4",i.length-4)||-1!==i.indexOf("blob:"),n){this._streaming?(this._htmlAudioElement=new Audio(i),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,b.Tools.SetCorsBehavior(i,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(i,(g=>{this._soundLoaded(g)}),void 0,!0,!0,(g=>{g&&c.b.Error("XHR "+g.status+" error on: "+i+"."),c.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:g=!1}g?n||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):c.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(e){c.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Mi.d.audioEngine&&!Mi.d.audioEngine.WarnedWebAudioUnsupported&&(c.b.Error("Web Audio is not supported by your browser."),Mi.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var g;null!==(g=Mi.d.audioEngine)&&void 0!==g&&g.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(g){var i;null!==(i=Mi.d.audioEngine)&&void 0!==i&&i.audioContext&&(this._audioBuffer=g,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(g){var i;null!==(i=Mi.d.audioEngine)&&void 0!==i&&i.audioContext&&Mi.d.audioEngine.audioContext.decodeAudioData(g,(g=>{this._audioBufferLoaded(g)}),(g=>{c.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+g)}))}setAudioBuffer(g){var i;null!==(i=Mi.d.audioEngine)&&void 0!==i&&i.canUseWebAudio&&(this._audioBuffer=g,this._isReadyToPlay=!0)}updateOptions(g){g&&(this.loop=g.loop??this.loop,this.maxDistance=g.maxDistance??this.maxDistance,this.useCustomAttenuation=g.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=g.rolloffFactor??this.rolloffFactor,this.refDistance=g.refDistance??this.refDistance,this.distanceModel=g.distanceModel??this.distanceModel,this._playbackRate=g.playbackRate??this._playbackRate,this._length=g.length??void 0,this.spatialSound=g.spatialSound??this._spatialSound,this._setOffset(g.offset??void 0),this.setVolume(g.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var g;null!==(g=Mi.d.audioEngine)&&void 0!==g&&g.canUseWebAudio&&Mi.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Mi.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var g;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(g=this._soundPanner)||void 0===g||g.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var g;null!==(g=Mi.d.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(g){var i;null!==(i=Mi.d.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(g),this._isOutputConnected=!0)}setDirectionalCone(g,i,a){i<g?c.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=g,this._coneOuterAngle=i,this._coneOuterGain=a,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(g){if(g!=this._coneInnerAngle){var i;if(this._coneOuterAngle<g)return void c.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=g,null!==(i=Mi.d.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(g){if(g!=this._coneOuterAngle){var i;if(g<this._coneInnerAngle)return void c.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=g,null!==(i=Mi.d.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(g){var i;g.equals(this._position)||(this._position.I(g),null!==(i=Mi.d.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(g){var i;this._localDirection=g,null!==(i=Mi.d.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const g=this._connectedTransformNode.getWorldMatrix(),i=L.Bi.TransformNormal(this._localDirection,g);i.normalize(),this._soundPanner.orientationX.value=i.x,this._soundPanner.orientationY.value=i.y,this._soundPanner.orientationZ.value=i.z}updateDistanceFromListener(){var g;if(null!==(g=Mi.d.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const g=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.ci(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,g,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(g){this._customAttenuationFunction=g}play(g,i,a){var n;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(n=Mi.d.audioEngine)&&void 0!==n&&n.audioContext)try{var L,d;this._clearTimeoutsAndObservers();let n=g?(null===(L=Mi.d.audioEngine)||void 0===L?void 0:L.audioContext.currentTime)+g:null===(d=Mi.d.audioEngine)||void 0===d?void 0:d.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Mi.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const g=()=>{var a;if(null!==(a=Mi.d.audioEngine)&&void 0!==a&&a.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=i??0;const a=this._htmlAudioElement.play();void 0!==a&&a.catch((()=>{var i,a;(null===(i=Mi.d.audioEngine)||void 0===i||i.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(a=Mi.d.audioEngine)||void 0===a?void 0:a.onAudioUnlockedObservable.addOnce((()=>{g()})))}))}else{var n;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(n=Mi.d.audioEngine)||void 0===n?void 0:n.onAudioUnlockedObservable.addOnce((()=>{g()}))}};g()}}else{var b;const L=()=>{var L;if(null!==(L=Mi.d.audioEngine)&&void 0!==L&&L.audioContext){var d;if(a=a||this._length,void 0!==i&&this._setOffset(i),this._soundSource){const g=this._soundSource;g.onended=()=>{g.disconnect()}}if(this._soundSource=null===(d=Mi.d.audioEngine)||void 0===d?void 0:d.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var b;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==i&&(this._soundSource.loopStart=i),void 0!==a&&(this._soundSource.loopEnd=(0|i)+a),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},n=g?(null===(b=Mi.d.audioEngine)||void 0===b?void 0:b.audioContext.currentTime)+g:Mi.d.audioEngine.audioContext.currentTime;const L=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(n,L,this.loop?void 0:a)}}};"suspended"===(null===(b=Mi.d.audioEngine)||void 0===b?void 0:b.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var g;"suspended"===(null===(g=Mi.d.audioEngine)||void 0===g?void 0:g.audioContext.state)?(Mi.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Mi.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{L()})))):L()}),500):L()}this._startTime=n,this.isPlaying=!0,this.isPaused=!1}catch(k){c.b.Error("Error while trying to play audio: "+this.name+", "+k.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(g){var i;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var a;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(a=this._streamingSource)||void 0===a||a.disconnect();this.isPlaying=!1}else if(null!==(i=Mi.d.audioEngine)&&void 0!==i&&i.audioContext&&this._soundSource){const i=g?Mi.d.audioEngine.audioContext.currentTime+g:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(i)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var g;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var i;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(i=this._streamingSource)||void 0===i||i.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(g=Mi.d.audioEngine)&&void 0!==g&&g.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Mi.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(g,i){var a;null!==(a=Mi.d.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._soundGain&&(i&&Mi.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Mi.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Mi.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(g,Mi.d.audioEngine.audioContext.currentTime+i)):this._soundGain.gain.value=g),this._volume=g}setPlaybackRate(g){this._playbackRate=g,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(g){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=g,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=g=>this._onRegisterAfterWorldMatrixUpdate(g),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(g){var i;if(g.getBoundingInfo){const i=g.getBoundingInfo();this.setPosition(i.boundingSphere.centerWorld)}else this.setPosition(g.absolutePosition);null!==(i=Mi.d.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const g=()=>{(0,qi.f)((()=>this._isReadyToPlay),(()=>{a._audioBuffer=this.getAudioBuffer(),a._isReadyToPlay=!0,a.autoplay&&a.play(0,this._offset,this._length)}),void 0,300)},i={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},a=new Wi(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,i);return this.useCustomAttenuation&&a.setAttenuationFunction(this._customAttenuationFunction),a.setPosition(this._position),a.setPlaybackRate(this._playbackRate),g(),a}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const g={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(g.connectedMeshId=this._connectedTransformNode.id),g.position=this._position.fd(),g.refDistance=this.refDistance,g.distanceModel=this.distanceModel,g.isDirectional=this._isDirectional,g.localDirectionToMesh=this._localDirection.fd(),g.coneInnerAngle=this._coneInnerAngle,g.coneOuterAngle=this._coneOuterAngle,g.coneOuterGain=this._coneOuterGain),g}static Parse(g,i,a,n){const d=g.name;let b;b=g.url?a+g.url:a+d;const k={autoplay:g.autoplay,loop:g.loop,volume:g.volume,spatialSound:g.spatialSound,maxDistance:g.maxDistance,rolloffFactor:g.rolloffFactor,refDistance:g.refDistance,distanceModel:g.distanceModel,playbackRate:g.playbackRate};let e;if(n){const g=()=>{(0,qi.f)((()=>n._isReadyToPlay),(()=>{e._audioBuffer=n.getAudioBuffer(),e._isReadyToPlay=!0,e.autoplay&&e.play(0,e._offset,e._length)}),void 0,300)};e=new Wi(d,new ArrayBuffer(0),i,null,k),g()}else e=new Wi(d,b,i,(()=>{i.removePendingData(e)}),k),i.addPendingData(e);if(g.position){const i=L.Bi.xi(g.position);e.setPosition(i)}if(g.isDirectional&&(e.setDirectionalCone(g.coneInnerAngle||360,g.coneOuterAngle||360,g.coneOuterGain||0),g.localDirectionToMesh)){const i=L.Bi.xi(g.localDirectionToMesh);e.setLocalDirectionToMesh(i)}if(g.connectedMeshId){const a=i.getMeshById(g.connectedMeshId);a&&e.attachToMesh(a)}return g.metadata&&(e.metadata=g.metadata),e}_setOffset(g){this._offset!==g&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=g)}_clearTimeoutsAndObservers(){var g;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(g=Mi.d.audioEngine)||void 0===g||g.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Wi._SceneComponentInitialization=g=>{throw(0,Hi.b)("AudioSceneComponent")},(0,vg.e)("BABYLON.Sound",Wi);class Gi{constructor(g,i,a){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],i.length!==a.length)throw new Error("Sounds length does not equal weights length");this.loop=g,this._weights=a;let n=0;for(const d of a)n+=d;const L=n>0?1/n:0;for(let d=0;d<this._weights.length;d++)this._weights[d]*=L;this._sounds=i;for(const d of this._sounds)d.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(g){if(g!==this._coneInnerAngle){if(this._coneOuterAngle<g)return void c.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=g;for(const i of this._sounds)i.directionalConeInnerAngle=g}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(g){if(g!==this._coneOuterAngle){if(g<this._coneInnerAngle)return void c.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=g;for(const i of this._sounds)i.directionalConeOuterAngle=g}}get volume(){return this._volume}set volume(g){if(g!==this._volume)for(const i of this._sounds)i.setVolume(g)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(g){if(!this.isPaused){this.stop();const g=Math.random();let i=0;for(let a=0;a<this._weights.length;a++)if(i+=this._weights[a],g<=i){this._currentIndex=a;break}}const i=this._sounds[this._currentIndex??0];i.isReady()?i.play(0,this.isPaused?void 0:g):i.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Ji{constructor(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(g=g||B.c.LastCreatedScene)&&(this._scene=g,this.soundCollection=[],this._options=i,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var g;null!==(g=Mi.d.audioEngine)&&void 0!==g&&g.canUseWebAudio&&Mi.d.audioEngine.audioContext&&(this._outputAudioNode=Mi.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Mi.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Mi.d.audioEngine&&Mi.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(g){var i;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(i=Mi.d.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._outputAudioNode&&g.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==g.soundTrackId&&(-1===g.soundTrackId?this._scene.mainSoundTrack.removeSound(g):this._scene.soundTracks&&this._scene.soundTracks[g.soundTrackId].removeSound(g)),this.soundCollection.push(g),g.soundTrackId=this.id}removeSound(g){const i=this.soundCollection.indexOf(g);-1!==i&&this.soundCollection.splice(i,1)}setVolume(g){var i;null!==(i=Mi.d.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=g)}switchPanningModelToHRTF(){var g;if(null!==(g=Mi.d.audioEngine)&&void 0!==g&&g.canUseWebAudio)for(let i=0;i<this.soundCollection.length;i++)this.soundCollection[i].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var g;if(null!==(g=Mi.d.audioEngine)&&void 0!==g&&g.canUseWebAudio)for(let i=0;i<this.soundCollection.length;i++)this.soundCollection[i].switchPanningModelToEqualPower()}connectToAnalyser(g){var i;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=g,null!==(i=Mi.d.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Mi.d.audioEngine.masterGain))}}var ga=a(12731),ia=a(12692),aa=a(12289);Mi.d.AudioEngineFactory=(g,i,a)=>new na(g,i,a);class na{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new F.b,this.onAudioLockedObservable=new F.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,aa.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const n=document.createElement("audio");this._hostElement=g,this._audioContext=i,this._audioDestination=a;try{n&&n.canPlayType&&(n.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||n.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(L){}try{n&&n.canPlayType&&n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(L){}}lock(){this._triggerSuspendedState()}unlock(){var g,i;if("running"===(null===(g=this._audioContext)||void 0===g?void 0:g.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(i=this._audioContext)||void 0===i||i.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{c.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var g;null===(g=this._audioContext)||void 0===g||g.addEventListener("statechange",(()=>{var g;this.unlocked&&"running"!==(null===(g=this._audioContext)||void 0===g?void 0:g.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var g;return null!==(g=this._audioContext)&&void 0!==g&&g.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(g){this.canUseWebAudio=!1,c.b.Error("Web Audio: "+g.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(g){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const g=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",i=document.createElement("style");i.appendChild(document.createTextNode(g)),document.getElementsByTagName("head")[0].appendChild(i),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var g;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(g=this._audioContext)||void 0===g||g.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(g){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=g)}connectToAnalyser(g){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=g,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var La=a(12301);(0,a(13838).h)(ga.b.NAME_AUDIO,((g,i,a,n)=>{let L,d=[];if(a.ty=a.ty||[],void 0!==g.ty&&null!==g.ty)for(let k=0,e=g.ty.length;k<e;k++){var b;const e=g.ty[k];null!==(b=Mi.d.audioEngine)&&void 0!==b&&b.canUseWebAudio?(e.url||(e.url=e.name),d[e.url]?a.ty.push(Wi.Parse(e,i,n,d[e.url])):(L=Wi.Parse(e,i,n),d[e.url]=L,a.ty.push(L))):a.ty.push(new Wi(e.name,null,i))}d=[]})),Object.defineProperty(ia.e.prototype,"mainSoundTrack",{get:function(){let g=this._getComponent(ga.b.NAME_AUDIO);return g||(g=new da(this),this.ad(g)),this._mainSoundTrack||(this._mainSoundTrack=new Ji(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),ia.e.prototype.getSoundByName=function(g){let i;for(i=0;i<this.mainSoundTrack.soundCollection.length;i++)if(this.mainSoundTrack.soundCollection[i].name===g)return this.mainSoundTrack.soundCollection[i];if(this.soundTracks)for(let a=0;a<this.soundTracks.length;a++)for(i=0;i<this.soundTracks[a].soundCollection.length;i++)if(this.soundTracks[a].soundCollection[i].name===g)return this.soundTracks[a].soundCollection[i];return null},Object.defineProperty(ia.e.prototype,"audioEnabled",{get:function(){let g=this._getComponent(ga.b.NAME_AUDIO);return g||(g=new da(this),this.ad(g)),g.audioEnabled},set:function(g){let i=this._getComponent(ga.b.NAME_AUDIO);i||(i=new da(this),this.ad(i)),g?i.enableAudio():i.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(ia.e.prototype,"headphone",{get:function(){let g=this._getComponent(ga.b.NAME_AUDIO);return g||(g=new da(this),this.ad(g)),g.headphone},set:function(g){let i=this._getComponent(ga.b.NAME_AUDIO);i||(i=new da(this),this.ad(i)),g?i.switchAudioModeForHeadphones():i.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(ia.e.prototype,"audioListenerPositionProvider",{get:function(){let g=this._getComponent(ga.b.NAME_AUDIO);return g||(g=new da(this),this.ad(g)),g.audioListenerPositionProvider},set:function(g){let i=this._getComponent(ga.b.NAME_AUDIO);if(i||(i=new da(this),this.ad(i)),g&&"function"!==typeof g)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");i.audioListenerPositionProvider=g},enumerable:!0,configurable:!0}),Object.defineProperty(ia.e.prototype,"audioListenerRotationProvider",{get:function(){let g=this._getComponent(ga.b.NAME_AUDIO);return g||(g=new da(this),this.ad(g)),g.audioListenerRotationProvider},set:function(g){let i=this._getComponent(ga.b.NAME_AUDIO);if(i||(i=new da(this),this.ad(i)),g&&"function"!==typeof g)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");i.audioListenerRotationProvider=g},enumerable:!0,configurable:!0}),Object.defineProperty(ia.e.prototype,"audioPositioningRefreshRate",{get:function(){let g=this._getComponent(ga.b.NAME_AUDIO);return g||(g=new da(this),this.ad(g)),g.audioPositioningRefreshRate},set:function(g){let i=this._getComponent(ga.b.NAME_AUDIO);i||(i=new da(this),this.ad(i)),i.audioPositioningRefreshRate=g},enumerable:!0,configurable:!0});class da{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(g){this.name=ga.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new L.Bi,this._cachedCameraPosition=new L.Bi,this._lastCheck=0,this._invertMatrixTemp=new L.Matrix,this._cameraDirectionTemp=new L.Bi,(g=g||B.c.LastCreatedScene)&&(this.Di=g,g.soundTracks=[],g.ty=[])}register(){this.Di._afterRenderStage.registerStep(ga.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(g){if(g.ty=[],this.Di.soundTracks)for(let i=0;i<this.Di.soundTracks.length;i++){const a=this.Di.soundTracks[i];for(let i=0;i<a.soundCollection.length;i++)g.ty.push(a.soundCollection[i].serialize())}}addFromContainer(g){if(g.ty)for(const i of g.ty)i.play(),i.autoplay=!0,this.Di.mainSoundTrack.addSound(i)}removeFromContainer(g){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(g.ty)for(const a of g.ty)a.stop(),a.autoplay=!1,this.Di.mainSoundTrack.removeSound(a),i&&a.dispose()}dispose(){const g=this.Di;if(g._mainSoundTrack&&g.mainSoundTrack.dispose(),g.soundTracks)for(let i=0;i<g.soundTracks.length;i++)g.soundTracks[i].dispose()}disableAudio(){const g=this.Di;let i;for(this._audioEnabled=!1,Mi.d.audioEngine&&Mi.d.audioEngine.audioContext&&Mi.d.audioEngine.audioContext.suspend(),i=0;i<g.mainSoundTrack.soundCollection.length;i++)g.mainSoundTrack.soundCollection[i].pause();if(g.soundTracks)for(i=0;i<g.soundTracks.length;i++)for(let a=0;a<g.soundTracks[i].soundCollection.length;a++)g.soundTracks[i].soundCollection[a].pause()}enableAudio(){const g=this.Di;let i;for(this._audioEnabled=!0,Mi.d.audioEngine&&Mi.d.audioEngine.audioContext&&Mi.d.audioEngine.audioContext.resume(),i=0;i<g.mainSoundTrack.soundCollection.length;i++)g.mainSoundTrack.soundCollection[i].isPaused&&g.mainSoundTrack.soundCollection[i].play();if(g.soundTracks)for(i=0;i<g.soundTracks.length;i++)for(let a=0;a<g.soundTracks[i].soundCollection.length;a++)g.soundTracks[i].soundCollection[a].isPaused&&g.soundTracks[i].soundCollection[a].play()}switchAudioModeForHeadphones(){const g=this.Di;if(this._headphone=!0,g.mainSoundTrack.switchPanningModelToHRTF(),g.soundTracks)for(let i=0;i<g.soundTracks.length;i++)g.soundTracks[i].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const g=this.Di;if(this._headphone=!1,g.mainSoundTrack.switchPanningModelToEqualPower(),g.soundTracks)for(let i=0;i<g.soundTracks.length;i++)g.soundTracks[i].switchPanningModelToEqualPower()}_afterRender(){const g=La.c.Now;if(this._lastCheck&&g-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=g;const i=this.Di;if(!this._audioEnabled||!i._mainSoundTrack||!i.soundTracks||0===i._mainSoundTrack.soundCollection.length&&1===i.soundTracks.length)return;const a=Mi.d.audioEngine;if(a&&a.audioContext){let g,n=i.activeCamera;if(i.activeCameras&&i.activeCameras.length>0&&(n=i.activeCameras[0]),this.audioListenerPositionProvider){const g=this.audioListenerPositionProvider();a.audioContext.listener.setPosition(g.x||0,g.y||0,g.z||0)}else n?this._cachedCameraPosition.equals(n.globalPosition)||(this._cachedCameraPosition.I(n.globalPosition),a.audioContext.listener.setPosition(n.globalPosition.x,n.globalPosition.y,n.globalPosition.z)):a.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const g=this.audioListenerRotationProvider();a.audioContext.listener.setOrientation(g.x||0,g.y||0,g.z||0,0,1,0)}else n?(n.rigCameras&&n.rigCameras.length>0&&(n=n.rigCameras[0]),n.getViewMatrix().invertToRef(this._invertMatrixTemp),L.Bi.TransformNormalToRef(da._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.I(this._cameraDirectionTemp),a.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):a.audioContext.listener.setOrientation(0,0,0,0,1,0);for(g=0;g<i.mainSoundTrack.soundCollection.length;g++){const a=i.mainSoundTrack.soundCollection[g];a.useCustomAttenuation&&a.updateDistanceFromListener()}if(i.soundTracks)for(g=0;g<i.soundTracks.length;g++)for(let a=0;a<i.soundTracks[g].soundCollection.length;a++){const n=i.soundTracks[g].soundCollection[a];n.useCustomAttenuation&&n.updateDistanceFromListener()}}}}da._CameraDirection=new L.Bi(0,0,-1),Wi._SceneComponentInitialization=g=>{let i=g._getComponent(ga.b.NAME_AUDIO);i||(i=new da(g),g.ad(i))};const ba="MSFT_audio_emitter";class ka{constructor(g){this.name=ba,this._loader=g,this.enabled=this._loader.isExtensionUsed(ba)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const g=this._loader.Dd.extensions;if(g&&g[this.name]){const i=g[this.name];this._clips=i.clips,this._emitters=i.emitters,s.Assign(this._clips),s.Assign(this._emitters)}}loadSceneAsync(g,i){return r.LoadExtensionAsync(g,i,this.name,(async(a,n)=>{const L=new Array;L.push(this._loader.loadSceneAsync(g,i));for(const g of n.emitters){const i=s.Get(`${a}/emitters`,this._emitters,g);if(void 0!=i.refDistance||void 0!=i.maxDistance||void 0!=i.rolloffFactor||void 0!=i.distanceModel||void 0!=i.innerAngle||void 0!=i.outerAngle)throw new Error(`${a}: Direction or Distance properties are not allowed on emitters attached to a scene`);L.push(this._loadEmitterAsync(`${a}/emitters/${i.index}`,i))}await Promise.all(L)}))}loadNodeAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(g,n)=>{const d=new Array,k=await this._loader.loadNodeAsync(g,i,(i=>{for(const a of n.emitters){const n=s.Get(`${g}/emitters`,this._emitters,a);d.push(this._loadEmitterAsync(`${g}/emitters/${n.index}`,n).then((()=>{for(const g of n._babylonSounds)g.attachToMesh(i),void 0==n.innerAngle&&void 0==n.outerAngle||(g.setLocalDirectionToMesh(L.Bi.Forward()),g.setDirectionalCone(2*b.Tools.ToDegrees(void 0==n.innerAngle?Math.PI:n.innerAngle),2*b.Tools.ToDegrees(void 0==n.outerAngle?Math.PI:n.outerAngle),0))})))}a(i)}));return await Promise.all(d),k}))}loadAnimationAsync(g,i){return r.LoadExtensionAsync(g,i,this.name,(async(a,n)=>{const L=await this._loader.loadAnimationAsync(g,i),d=new Array;s.Assign(n.events);for(const b of n.events)d.push(this._loadAnimationEventAsync(`${a}/events/${b.index}`,g,i,b,L));return await Promise.all(d),L}))}_loadClipAsync(g,i){if(i._objectURL)return i._objectURL;let a;if(i.uri)a=this._loader.loadUriAsync(g,i,i.uri);else{const n=s.Get(`${g}/bufferView`,this._loader.Dd.bufferViews,i.bufferView);a=this._loader.loadBufferViewAsync(`/bufferViews/${n.index}`,n)}return i._objectURL=a.then((g=>URL.createObjectURL(new Blob([g],{type:i.mimeType})))),i._objectURL}_loadEmitterAsync(g,i){if(i._babylonSounds=i._babylonSounds||[],!i._babylonData){const g=new Array,a=i.name||`emitter${i.index}`,n={loop:!1,autoplay:!1,volume:void 0==i.volume?1:i.volume};for(let d=0;d<i.clips.length;d++){const L=`/extensions/${this.name}/clips`,b=s.Get(L,this._clips,i.clips[d].clip);g.push(this._loadClipAsync(`${L}/${i.clips[d].clip}`,b).then((g=>{const L=i._babylonSounds[d]=new Wi(a,g,this._loader.babylonScene,null,n);L.refDistance=i.refDistance||1,L.maxDistance=i.maxDistance||256,L.rolloffFactor=i.rolloffFactor||1,L.distanceModel=i.distanceModel||"exponential"})))}const L=Promise.all(g).then((()=>{const g=i.clips.map((g=>g.weight||1)),a=new Gi(i.loop||!1,i._babylonSounds,g);i.innerAngle&&(a.directionalConeInnerAngle=2*b.Tools.ToDegrees(i.innerAngle)),i.outerAngle&&(a.directionalConeOuterAngle=2*b.Tools.ToDegrees(i.outerAngle)),i.volume&&(a.volume=i.volume),i._babylonData.sound=a}));i._babylonData={loaded:L}}return i._babylonData.loaded}_getEventAction(g,i,a,n,L){switch(a){case"play":return g=>{const a=(L||0)+(g-n);i.play(a)};case"stop":return()=>{i.stop()};case"pause":return()=>{i.pause()};default:throw new Error(`${g}: Unsupported action ${a}`)}}_loadAnimationEventAsync(g,i,a,n,L){if(0==L.targetedAnimations.length)return Promise.resolve();const d=L.targetedAnimations[0],b=n.ni,k=s.Get(`/extensions/${this.name}/emitters`,this._emitters,b);return this._loadEmitterAsync(g,k).then((()=>{const i=k._babylonData.sound;if(i){const a=new ui(n.time,this._getEventAction(g,i,n.action,n.time,n.startOffset));d.animation.addEvent(a),L.onAnimationGroupEndObservable.add((()=>{i.stop()})),L.onAnimationGroupPauseObservable.add((()=>{i.pause()}))}}))}}t(ba),w(ba,!0,(g=>new ka(g)));const ea="MSFT_lod";class Na{constructor(g){var i;this.name=ea,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new F.b,this.onMaterialLODsLoadedObservable=new F.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=g,this.maxLODsToLoad=(null===(i=this._loader.parent.extensionOptions[ea])||void 0===i?void 0:i.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(ea)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let g=0;g<this._nodePromiseLODs.length;g++){const i=Promise.all(this._nodePromiseLODs[g]).then((()=>{0!==g&&(this._loader.endPerformanceCounter(`Node LOD ${g}`),this._loader.log(`Loaded node LOD ${g}`)),this.onNodeLODsLoadedObservable.notifyObservers(g),g!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${g+1}`),this._loadBufferLOD(this._nodeBufferLODs,g+1),this._nodeSignalLODs[g]&&this._nodeSignalLODs[g].resolve())}));this._loader._completePromises.push(i)}for(let g=0;g<this._materialPromiseLODs.length;g++){const i=Promise.all(this._materialPromiseLODs[g]).then((()=>{0!==g&&(this._loader.endPerformanceCounter(`Material LOD ${g}`),this._loader.log(`Loaded material LOD ${g}`)),this.onMaterialLODsLoadedObservable.notifyObservers(g),g!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${g+1}`),this._loadBufferLOD(this._materialBufferLODs,g+1),this._materialSignalLODs[g]&&this._materialSignalLODs[g].resolve())}));this._loader._completePromises.push(i)}}loadSceneAsync(g,i){const a=this._loader.loadSceneAsync(g,i);return this._loadBufferLOD(this._bufferLODs,0),a}loadNodeAsync(g,i,a){return r.LoadExtensionAsync(g,i,this.name,(async(g,L)=>{let d;const b=this._getLODs(g,i,this._loader.Dd.nodes,L.ids);this._loader.logOpen(`${g}`);for(let i=0;i<b.length;i++){const g=b[i];0!==i&&(this._nodeIndexLOD=i,this._nodeSignalLODs[i]=this._nodeSignalLODs[i]||new n);const L=g=>{a(g),g.oe(!1)},k=this._loader.loadNodeAsync(`/nodes/${g.index}`,g,L).then((g=>{if(0!==i){const g=b[i-1];g._babylonTransformNode&&(this._disposeTransformNode(g._babylonTransformNode),delete g._babylonTransformNode)}return g.oe(!0),g}));this._nodePromiseLODs[i]=this._nodePromiseLODs[i]||[],0===i?d=k:(this._nodeIndexLOD=null,this._nodePromiseLODs[i].push(k))}return this._loader.logClose(),await d}))}_loadMaterialAsync(g,i,a,n,L){return this._nodeIndexLOD?null:r.LoadExtensionAsync(g,i,this.name,(async(g,d)=>{let b;const k=this._getLODs(g,i,this._loader.Dd.materials,d.ids);this._loader.logOpen(`${g}`);for(let i=0;i<k.length;i++){const g=k[i];0!==i&&(this._materialIndexLOD=i);const d=this._loader._loadMaterialAsync(`/materials/${g.index}`,g,a,n,(g=>{0===i&&L(g)})).then((g=>{if(0!==i){L(g);const a=k[i-1]._data;a[n]&&(this._disposeMaterials([a[n].babylonMaterial]),delete a[n])}return g}));this._materialPromiseLODs[i]=this._materialPromiseLODs[i]||[],0===i?b=d:(this._materialIndexLOD=null,this._materialPromiseLODs[i].push(d))}return this._loader.logClose(),await b}))}_loadUriAsync(g,i,a){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const L=this._nodeIndexLOD-1;return this._nodeSignalLODs[L]=this._nodeSignalLODs[L]||new n,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(g,i,a)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const L=this._materialIndexLOD-1;return this._materialSignalLODs[L]=this._materialSignalLODs[L]||new n,this._materialSignalLODs[L].promise.then((async()=>await this._loader.loadUriAsync(g,i,a)))}return null}loadBufferAsync(g,i,a,L){if(this._loader.parent.useRangeRequests&&!i.uri){if(!this._loader.bin)throw new Error(`${g}: Uri is missing or the binary glTF is missing its binary chunk`);const i=async(g,i)=>{const d=a,b=d+L-1;let k=g[i];return k?(k.start=Math.min(k.start,d),k.end=Math.max(k.end,b)):(k={start:d,end:b,loaded:new n},g[i]=k),await k.loaded.promise.then((g=>new Uint8Array(g.buffer,g.byteOffset+a-k.start,L)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?i(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?i(this._materialBufferLODs,this._materialIndexLOD):i(this._bufferLODs,0)}return null}_loadBufferLOD(g,i){const a=g[i];a&&(this._loader.log(`Loading buffer range [${a.start}-${a.end}]`),this._loader.bin.readAsync(a.start,a.end-a.start+1).then((g=>{a.loaded.resolve(g)}),(g=>{a.loaded.reject(g)})))}_getLODs(g,i,a,n){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const L=[];for(let d=n.length-1;d>=0;d--)if(L.push(s.Get(`${g}/ids/${n[d]}`,a,n[d])),L.length===this.maxLODsToLoad)return L;return L.push(i),L}_disposeTransformNode(g){const i=[],a=g.material;a&&i.push(a);for(const L of g.getChildMeshes())L.material&&i.push(L.material);g.dispose();const n=i.filter((g=>this._loader.babylonScene.meshes.every((i=>i.material!=g))));this._disposeMaterials(n)}_disposeMaterials(g){const i={};for(const a of g){for(const g of a.getActiveTextures())i[g.uniqueId]=g;a.dispose()}for(const a in i)for(const g of this._loader.babylonScene.materials)g.hasTexture(i[a])&&delete i[a];for(const a in i)i[a].dispose()}}t(ea),w(ea,!0,(g=>new Na(g)));const Fa="MSFT_minecraftMesh";class Ia{constructor(g){this.name=Fa,this._loader=g,this.enabled=this._loader.isExtensionUsed(Fa)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtraAsync(g,i,this.name,(async(n,L)=>{if(L){if(!(a instanceof x.b))throw new Error(`${n}: Material type not supported`);const L=this._loader.loadMaterialPropertiesAsync(g,i,a);return a.needAlphaBlending()&&(a.forceDepthWrite=!0,a.separateCullingPass=!0),a.zd=a.forceDepthWrite,a.twoSidedLighting=!0,await L}}))}}t(Fa),w(Fa,!0,(g=>new Ia(g)));const ja="MSFT_sRGBFactors";class ya{constructor(g){this.name=ja,this._loader=g,this.enabled=this._loader.isExtensionUsed(ja)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,i,a){return r.LoadExtraAsync(g,i,this.name,(async(n,L)=>{if(L){if(!(a instanceof x.b))throw new Error(`${n}: Material type not supported`);const L=this._loader.loadMaterialPropertiesAsync(g,i,a),d=a.Pg().getEngine().useExactSrgbConversions;return a.albedoTexture||a.albedoColor.toLinearSpaceToRef(a.albedoColor,d),a.reflectivityTexture||a.reflectivityColor.toLinearSpaceToRef(a.reflectivityColor,d),await L}}))}}t(ja),w(ja,!0,(g=>new ya(g)));var Ba=a(14197);const ca={};var Da=a(14256),pa=a(14231),Ra=a(14204),xa=a(14214);function Ea(g,i){for(const a of g)for(const g of a.dataOutputs)if(g.uniqueId===i)return g;throw new Error("Could not find data out connection with unique id "+i)}function Xa(g,i){for(const a of g)if(a instanceof pa.b)for(const g of a.signalInputs)if(g.uniqueId===i)return g;throw new Error("Could not find signal in connection with unique id "+i)}async function va(g,i){const n=await Promise.all(g.allBlocks.map((async g=>{const i=function(g){switch(g){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([a.e(78),a.e(79)]).then(a.bind(a,15704))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await a.e(80).then(a.bind(a,15711))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await a.e(81).then(a.bind(a,15717))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await a.e(82).then(a.bind(a,15726))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await a.e(83).then(a.bind(a,15729))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await a.e(84).then(a.bind(a,15737))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await a.e(85).then(a.bind(a,15745))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await a.e(86).then(a.bind(a,15753))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await a.e(87).then(a.bind(a,15760))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await a.e(89).then(a.bind(a,15794))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await a.e(89).then(a.bind(a,15794))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await a.e(89).then(a.bind(a,15794))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await a.e(89).then(a.bind(a,15794))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await a.e(89).then(a.bind(a,15794))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await a.e(89).then(a.bind(a,15794))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await a.e(90).then(a.bind(a,15801))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await a.e(90).then(a.bind(a,15801))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await a.e(90).then(a.bind(a,15801))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await a.e(90).then(a.bind(a,15801))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await a.e(95).then(a.bind(a,15809))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await a.e(96).then(a.bind(a,15813))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await a.e(97).then(a.bind(a,15818))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await a.e(98).then(a.bind(a,15822))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await a.e(99).then(a.bind(a,15827))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await a.e(100).then(a.bind(a,15834))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await a.e(101).then(a.bind(a,15841))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await a.e(102).then(a.bind(a,15843))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await a.e(103).then(a.bind(a,15850))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await a.e(104).then(a.bind(a,15859))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await a.e(105).then(a.bind(a,15868))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await a.e(106).then(a.bind(a,15870))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await a.e(107).then(a.bind(a,15874))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await a.e(108).then(a.bind(a,15883))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await a.e(109).then(a.bind(a,15887))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await a.e(110).then(a.bind(a,15890))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await a.e(111).then(a.bind(a,15895))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await a.e(112).then(a.bind(a,15900))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await a.e(113).then(a.bind(a,15904))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await a.e(92).then(a.bind(a,15907))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await a.e(114).then(a.bind(a,15913))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await a.e(115).then(a.bind(a,15916))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await a.e(116).then(a.bind(a,15922))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await a.e(93).then(a.bind(a,15930))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await a.e(88).then(a.bind(a,15766))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await a.e(94).then(a.bind(a,15932))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await a.e(94).then(a.bind(a,15932))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await a.e(94).then(a.bind(a,15932))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await a.e(94).then(a.bind(a,15932))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await a.e(94).then(a.bind(a,15932))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await a.e(94).then(a.bind(a,15932))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await a.e(94).then(a.bind(a,15932))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await a.e(94).then(a.bind(a,15932))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await a.e(89).then(a.bind(a,15794))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await a.e(89).then(a.bind(a,15794))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await a.e(89).then(a.bind(a,15794))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await a.e(89).then(a.bind(a,15794))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await a.e(89).then(a.bind(a,15794))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await a.e(89).then(a.bind(a,15794))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await a.e(89).then(a.bind(a,15794))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await a.e(90).then(a.bind(a,15801))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await a.e(90).then(a.bind(a,15801))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await a.e(91).then(a.bind(a,15939))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await a.e(91).then(a.bind(a,15939))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await a.e(91).then(a.bind(a,15939))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await a.e(91).then(a.bind(a,15939))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await a.e(91).then(a.bind(a,15939))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await a.e(91).then(a.bind(a,15939))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await a.e(117).then(a.bind(a,15945))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await a.e(118).then(a.bind(a,15951))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await a.e(119).then(a.bind(a,15957))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await a.e(120).then(a.bind(a,15966))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await a.e(121).then(a.bind(a,15973))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await a.e(122).then(a.bind(a,15980))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await a.e(123).then(a.bind(a,15984))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await a.e(124).then(a.bind(a,15991))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await a.e(125).then(a.bind(a,15996))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await a.e(126).then(a.bind(a,16003))).FlowGraphDataSwitchBlock;default:if(ca[g])return ca[g];throw new Error(`Unknown block name ${g}`)}}(g.className);return await i()})));return function(g,i,a){const n=i.coordinator.createGraph(),L=[],d=i.valueParseFunction??Ra.e;for(let b=0;b<g.allBlocks.length;b++){const k=Ya(g.allBlocks[b],{Di:i.coordinator.config.Di,pathConverter:i.pathConverter,assetsContainer:i.coordinator.config.Di,valueParseFunction:d},a[b]);L.push(k),k instanceof Da.e&&n.addEventBlock(k)}for(const b of L){for(const g of b.dataInputs)for(const i of g.connectedPointIds){const a=Ea(L,i);g.connectTo(a)}if(b instanceof pa.b)for(const g of b.signalOutputs)for(const i of g.connectedPointIds){const a=Xa(L,i);g.connectTo(a)}}for(const b of g.executionContexts)Pa(b,{graph:n,valueParseFunction:d},g.rightHanded);return n}(g,i,n)}function Pa(g,i,a){const n=i.graph.createContext();g.enableLogging&&(n.enableLogging=!0),n.treatDataAsRightHanded=a||!1;const L=i.valueParseFunction??Ra.e;n.uniqueId=g.uniqueId;const d=n.Pg();if(g._assetsContext){var b,k,e,N,F,I,j,y,B,c;const i=g._assetsContext,a={meshes:null===(b=i.meshes)||void 0===b?void 0:b.map((g=>d.getMeshById(g))),lights:null===(k=i.lights)||void 0===k?void 0:k.map((g=>d.getLightByName(g))),cameras:null===(e=i.cameras)||void 0===e?void 0:e.map((g=>d.getCameraByName(g))),materials:null===(N=i.materials)||void 0===N?void 0:N.map((g=>d.getMaterialById(g))),textures:null===(F=i.textures)||void 0===F?void 0:F.map((g=>d.getTextureByName(g))),animations:null===(I=i.animations)||void 0===I?void 0:I.map((g=>d.animations.find((i=>i.name===g)))),skeletons:null===(j=i.skeletons)||void 0===j?void 0:j.map((g=>d.getSkeletonByName(g))),Wj:null===(y=i.Wj)||void 0===y?void 0:y.map((g=>d.getParticleSystemById(g))),animationGroups:null===(B=i.animationGroups)||void 0===B?void 0:B.map((g=>d.getAnimationGroupByName(g))),transformNodes:null===(c=i.transformNodes)||void 0===c?void 0:c.map((g=>d.getTransformNodeById(g))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],ty:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};n.assetsContext=a}for(const D in g._userVariables){const i=L(D,g._userVariables,n.assetsContext,d);n.userVariables[D]=i}for(const D in g._connectionValues){const i=L(D,g._connectionValues,n.assetsContext,d);n._setConnectionValueByKey(D,i)}return n}function Ya(g,i,a){const n={},L=i.valueParseFunction??Ra.e;if(g.config)for(const b in g.config)n[b]=L(b,g.config,i.assetsContainer||i.Di,i.Di);if((0,Ra.k)(g.className)){if(!i.pathConverter)throw new Error("Path converter is required for this block");n.pathConverter=i.pathConverter}const d=new a(n);d.uniqueId=g.uniqueId;for(let b=0;b<g.dataInputs.length;b++){const i=d.getDataInput(g.dataInputs[b].name);if(!i)throw new Error("Could not find data input with name "+g.dataInputs[b].name+" in block "+g.className);i.deserialize(g.dataInputs[b])}for(let b=0;b<g.dataOutputs.length;b++){const i=d.getDataOutput(g.dataOutputs[b].name);if(!i)throw new Error("Could not find data output with name "+g.dataOutputs[b].name+" in block "+g.className);i.deserialize(g.dataOutputs[b])}return d.metadata=g.metadata,d.deserialize&&d.deserialize(g),d}function fa(g){const[i,a]=g.split(":");return Ca({op:i,extension:a})}function Ca(g){var i;let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=g.extension?null===(i=Sa[g.extension])||void 0===i?void 0:i[g.op]:Va[g.op];if(!n&&(c.b.Warn(`No mapping found for operation ${g.op} and extension ${g.extension||"KHR_interactivity"}`),a)){const i={},a={flows:{}};if(g.inputValueSockets){i.values={};for(const a in g.inputValueSockets)i.values[a]={name:a}}return g.outputValueSockets&&(a.values={},Object.keys(g.outputValueSockets).forEach((g=>{a.values[g]={name:g}}))),{cI:[],inputs:i,outputs:a}}return n}function Ua(g,i,a){Sa[i]||(Sa[i]={}),Sa[i][g]=a}const Sa={BABYLON:{"flow/log":{cI:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Va={"event/onStart":{cI:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{cI:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{cI:["FlowGraphSendCustomEventBlock"],extraProcessor(g,i,a,n,L){if("event/send"!==i.op||!g.configuration||1!==Object.keys(g.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const d=g.configuration.event.value[0];if("number"!==typeof d)throw new Error("Event id should be a number");const b=n.arrays.events[d],k=L[0];return k.config||(k.config={}),k.config.eventId=b.eventId,k.config.eventData=b.eventData,L}},"event/receive":{cI:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(g,i){var a;if(!g.configuration)return c.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const n=g.configuration.event;if(!n)return c.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const L=n.value[0];if("number"!==typeof L)return c.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(a=i.events)||void 0===a?void 0:a[L])?{valid:!0}:(c.b.Error(`Event with id ${L} not found`),{valid:!1,error:`Event with id ${L} not found`})},extraProcessor(g,i,a,n,L){if("event/receive"!==i.op||!g.configuration||1!==Object.keys(g.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const d=g.configuration.event.value[0];if("number"!==typeof d)throw new Error("Event id should be a number");const b=n.arrays.events[d],k=L[0];return k.config||(k.config={}),k.config.eventId=b.eventId,k.config.eventData=b.eventData,L}},"math/e":Ka("FlowGraphEBlock"),"math/pi":Ka("FlowGraphPIBlock"),"math/inf":Ka("FlowGraphInfBlock"),"math/nan":Ka("FlowGraphNaNBlock"),"math/abs":Ka("FlowGraphAbsBlock"),"math/sign":Ka("FlowGraphSignBlock"),"math/trunc":Ka("FlowGraphTruncBlock"),"math/floor":Ka("FlowGraphFloorBlock"),"math/ceil":Ka("FlowGraphCeilBlock"),"math/round":{cI:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,i,a,n,L){var d;return(d=L[0]).config||(d.config={}),L[0].config.roundHalfAwayFromZero=!0,L}},"math/fract":Ka("FlowGraphFractBlock"),"math/neg":Ka("FlowGraphNegationBlock"),"math/add":Ka("FlowGraphAddBlock",["a","b"],!0),"math/sub":Ka("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{cI:["FlowGraphMultiplyBlock"],extraProcessor(g,i,a,n,L){var d;(d=L[0]).config||(d.config={}),L[0].config.useMatrixPerComponent=!0,L[0].config.preventIntegerFloatArithmetic=!0;let b=-1;return Object.keys(g.values||{}).find((i=>{var a;return void 0!==(null===(a=g.values)||void 0===a?void 0:a[i].type)&&(b=g.values[i].type,!0)})),-1!==b&&(L[0].config.type=n.arrays.types[b].flowGraphType),L},validation:g=>g.values?Ta(g):{valid:!0}},"math/div":Ka("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Ka("FlowGraphModuloBlock",["a","b"]),"math/min":Ka("FlowGraphMinBlock",["a","b"]),"math/max":Ka("FlowGraphMaxBlock",["a","b"]),"math/clamp":Ka("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Ka("FlowGraphSaturateBlock"),"math/mix":Ka("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Ka("FlowGraphEqualityBlock",["a","b"]),"math/lt":Ka("FlowGraphLessThanBlock",["a","b"]),"math/le":Ka("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Ka("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Ka("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Ka("FlowGraphIsNaNBlock"),"math/isinf":Ka("FlowGraphIsInfBlock"),"math/select":{cI:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{cI:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Ka("FlowGraphSinBlock"),"math/cos":Ka("FlowGraphCosBlock"),"math/tan":Ka("FlowGraphTanBlock"),"math/asin":Ka("FlowGraphASinBlock"),"math/acos":Ka("FlowGraphACosBlock"),"math/atan":Ka("FlowGraphATanBlock"),"math/atan2":Ka("FlowGraphATan2Block",["a","b"]),"math/sinh":Ka("FlowGraphSinhBlock"),"math/cosh":Ka("FlowGraphCoshBlock"),"math/tanh":Ka("FlowGraphTanhBlock"),"math/asinh":Ka("FlowGraphASinhBlock"),"math/acosh":Ka("FlowGraphACoshBlock"),"math/atanh":Ka("FlowGraphATanhBlock"),"math/exp":Ka("FlowGraphExponentialBlock"),"math/log":Ka("FlowGraphLogBlock"),"math/log2":Ka("FlowGraphLog2Block"),"math/log10":Ka("FlowGraphLog10Block"),"math/sqrt":Ka("FlowGraphSquareRootBlock"),"math/cbrt":Ka("FlowGraphCubeRootBlock"),"math/pow":Ka("FlowGraphPowerBlock",["a","b"]),"math/length":Ka("FlowGraphLengthBlock"),"math/normalize":Ka("FlowGraphNormalizeBlock"),"math/dot":Ka("FlowGraphDotBlock",["a","b"]),"math/cross":Ka("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Ka("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Ka("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{cI:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{cI:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{cI:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{cI:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{cI:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{cI:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{cI:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Ka("FlowGraphTransposeBlock"),"math/determinant":Ka("FlowGraphDeterminantBlock"),"math/inverse":Ka("FlowGraphInvertMatrixBlock"),"math/matmul":Ka("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{cI:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"rd",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,i,a,n,L,d){const b=L[0].dataInputs.find((g=>"rotationQuaternion"===g.name));if(!b)throw new Error("Rotation quaternion input not found");return d._connectionValues[b.uniqueId]&&(d._connectionValues[b.uniqueId].type="Quaternion"),L}},"math/matDecompose":{cI:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"rd"}}}},"math/quatConjugate":Ka("FlowGraphConjugateBlock",["a"]),"math/quatMul":{cI:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,i,a,n,L){var d;return(d=L[0]).config||(d.config={}),L[0].config.type="Quaternion",L}},"math/quatAngleBetween":Ka("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{cI:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Ka("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Ka("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{cI:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,i,a,n,L){var d;return(d=L[0]).config||(d.config={}),L[0].config.inputIsColumnMajor=!0,L}},"math/extract2x2":{cI:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{cI:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,i,a,n,L){var d;return(d=L[0]).config||(d.config={}),L[0].config.inputIsColumnMajor=!0,L}},"math/extract3x3":{cI:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{cI:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,i,a,n,L){var d;return(d=L[0]).config||(d.config={}),L[0].config.inputIsColumnMajor=!0,L}},"math/extract4x4":{cI:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{cI:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,i,a,n,L,d){var b,k;(k=L[0]).config||(k.config={});const e=L[0].dataInputs[0];return L[0].config.valueType=(null===(b=d._connectionValues[e.uniqueId])||void 0===b?void 0:b.type)??"FlowGraphInteger",L}},"math/and":{cI:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,i,a,n,L,d){var b,k,e;(e=L[0]).config||(e.config={});const N=L[0].dataInputs[0],F=L[0].dataInputs[1];return L[0].config.valueType=(null===(b=d._connectionValues[N.uniqueId])||void 0===b?void 0:b.type)??(null===(k=d._connectionValues[F.uniqueId])||void 0===k?void 0:k.type)??"FlowGraphInteger",L}},"math/or":{cI:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,i,a,n,L,d){var b,k,e;(e=L[0]).config||(e.config={});const N=L[0].dataInputs[0],F=L[0].dataInputs[1];return L[0].config.valueType=(null===(b=d._connectionValues[N.uniqueId])||void 0===b?void 0:b.type)??(null===(k=d._connectionValues[F.uniqueId])||void 0===k?void 0:k.type)??"FlowGraphInteger",L}},"math/xor":{cI:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,i,a,n,L,d){var b,k,e;(e=L[0]).config||(e.config={});const N=L[0].dataInputs[0],F=L[0].dataInputs[1];return L[0].config.valueType=(null===(b=d._connectionValues[N.uniqueId])||void 0===b?void 0:b.type)??(null===(k=d._connectionValues[F.uniqueId])||void 0===k?void 0:k.type)??"FlowGraphInteger",L}},"math/asr":Ka("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Ka("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Ka("FlowGraphLeadingZerosBlock"),"math/ctz":Ka("FlowGraphTrailingZerosBlock"),"math/popcnt":Ka("FlowGraphOneBitsCounterBlock"),"math/rad":Ka("FlowGraphDegToRadBlock"),"math/deg":Ka("FlowGraphRadToDegBlock"),"type/boolToInt":Ka("FlowGraphBooleanToInt"),"type/boolToFloat":Ka("FlowGraphBooleanToFloat"),"type/intToBool":Ka("FlowGraphIntToBoolean"),"type/intToFloat":Ka("FlowGraphIntToFloat"),"type/floatToInt":Ka("FlowGraphFloatToInt"),"type/floatToBool":Ka("FlowGraphFloatToBoolean"),"flow/sequence":{cI:["FlowGraphSequenceBlock"],extraProcessor(g,i,a,n,L){const d=L[0];return d.config||(d.config={}),d.config.outputSignalCount=Object.keys(g.flows||[]).length,d.signalOutputs.forEach(((g,i)=>{g.name="out_"+i})),L}},"flow/branch":{cI:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{cI:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(g){if(g.configuration&&g.configuration.cases){const i=g.configuration.cases.value;if(!i.every((g=>"number"===typeof g&&/^-?\d+$/.test(g.toString()))))return c.b.Warn("Switch cases should be integers. Using empty array instead."),g.configuration.cases.value=[],{valid:!0};const a=new Set(i);g.configuration.cases.value=Array.from(a)}return{valid:!0}},extraProcessor(g,i,a,n,L){if("flow/switch"!==i.op||!g.flows||0===Object.keys(g.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return L[0].signalOutputs.forEach((g=>{"default"!==g.name&&(g.name="out_"+g.name)})),L}},"flow/while":{cI:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{cI:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(g,i,a,n,L){const d=L[0];return d.config||(d.config={}),d.config.incrementIndexWhenLoopDone=!0,L}},"flow/doN":{cI:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{cI:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(g,i,a,n,L){if("flow/multiGate"!==i.op||!g.flows||0===Object.keys(g.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const d=L[0];return d.config||(d.config={}),d.config.outputSignalCount=Object.keys(g.flows).length,d.signalOutputs.forEach(((g,i)=>{g.name="out_"+i})),L}},"flow/waitAll":{cI:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(g){var i,a;return"number"!==typeof(null===(i=g.configuration)||void 0===i||null===(a=i.inputFlows)||void 0===a?void 0:a.value[0])&&(g.configuration=g.configuration||{inputFlows:{value:[0]}},g.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{cI:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{cI:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{cI:["FlowGraphCancelDelayBlock"]},"variable/get":{cI:["FlowGraphGetVariableBlock"],validation(g){var i,a;return null!==(i=g.configuration)&&void 0!==i&&null!==(a=i.variable)&&void 0!==a&&a.value?{valid:!0}:(c.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(g,i)=>[i.getVariableName(g[0])]}}},"variable/set":{cI:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(g,i)=>[i.getVariableName(g[0])]}}},"variable/setMultiple":{cI:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(g,i)=>[g[0].map((g=>i.getVariableName(g)))]}},extraProcessor:(g,i,a,n,L)=>(L[0].dataInputs.forEach((g=>{g.name=n.getVariableName(+g.name)})),L)},"variable/interpolate":{cI:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(g,i)=>[i.getVariableName(g[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:g=>!0===g[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",va:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",va:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",va:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",va:"FlowGraphPlayAnimationBlock"},out:{name:"out",va:"FlowGraphPlayAnimationBlock"},done:{name:"done",va:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(g,i,a,n,L){var d,b,k;const e=L[0],N=null===(d=g.configuration)||void 0===d?void 0:d.variable.value[0];if("number"!==typeof N)throw c.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const F=n.arrays.staticVariables[N];"undefined"===typeof e.config.animationType.value&&(n.arrays.staticVariables,e.config.animationType.value=(0,xa.D)(F.type));const I=L[4];return I.config||(I.config={}),(b=I.config).variable||(b.variable={}),I.config.variable.value=n.getVariableName(N),(k=L[3]).config||(k.config={}),L}},"pointer/get":{cI:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",va:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",va:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(g,i,a,n,L)=>(L.forEach((g=>{"FlowGraphJsonPointerParserBlock"===g.className&&(g.config||(g.config={}),g.config.outputValue=!0)})),L)},"pointer/set":{cI:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",va:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",va:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(g,i,a,n,L)=>(L.forEach((g=>{"FlowGraphJsonPointerParserBlock"===g.className&&(g.config||(g.config={}),g.config.outputValue=!0)})),L)},"pointer/interpolate":{cI:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",va:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",va:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",va:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",va:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",va:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",va:"FlowGraphPlayAnimationBlock"},out:{name:"out",va:"FlowGraphPlayAnimationBlock"},done:{name:"done",va:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(g,i,a,n,L)=>(L.forEach((i=>{"FlowGraphJsonPointerParserBlock"===i.className?(i.config||(i.config={}),i.config.outputValue=!0):"FlowGraphInterpolationBlock"===i.className&&(i.config||(i.config={}),Object.keys(g.values||[]).forEach((a=>{var L;const d=null===(L=g.values)||void 0===L?void 0:L[a];if("value"===a&&d){const g=d.type;void 0!==g&&(i.config.animationType=n.arrays.types[g].flowGraphType)}})))})),L)},"animation/start":{cI:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",va:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(g,i)=>[g[0]*i._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(g,i)=>[g[0]*i._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(g,i,a,n,L,d,b){const k=L[L.length-1];return k.config||(k.config={}),k.config.glTF=b,L}},"animation/stop":{cI:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",va:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(g,i,a,n,L,d,b){const k=L[L.length-1];return k.config||(k.config={}),k.config.glTF=b,L}},"animation/stopAt":{cI:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",va:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(g,i)=>[g[0]*i._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(g,i,a,n,L,d,b){const k=L[L.length-1];return k.config||(k.config={}),k.config.glTF=b,L}},"math/switch":{cI:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(g){if(g.configuration&&g.configuration.cases){const i=g.configuration.cases.value;if(!i.every((g=>"number"===typeof g&&/^-?\d+$/.test(g.toString()))))return c.b.Warn("Switch cases should be integers. Using empty array instead."),g.configuration.cases.value=[],{valid:!0};const a=new Set(i);g.configuration.cases.value=Array.from(a)}return{valid:!0}},extraProcessor(g,i,a,n,L){const d=L[0];return d.dataInputs.forEach((g=>{"default"!==g.name&&"case"!==g.name&&(g.name="in_"+g.name)})),d.config||(d.config={}),d.config.treatCasesAsIntegers=!0,L}},"debug/log":{cI:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Ka(g){let i=arguments.length>2?arguments[2]:void 0;return{cI:[g],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((g,i)=>(g[i]={name:i},g)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(g,a,n,L,d){var b;if(i){(b=d[0]).config||(b.config={}),d[0].config.preventIntegerFloatArithmetic=!0;let i=-1;Object.keys(g.values||{}).find((a=>{var n;return void 0!==(null===(n=g.values)||void 0===n?void 0:n[a].type)&&(i=g.values[a].type,!0)})),-1!==i&&(d[0].config.type=L.arrays.types[i].flowGraphType)}return d},validation:g=>i?Ta(g):{valid:!0}}}function Ta(g){if(g.values){const i=Object.keys(g.values).map((i=>g.values[i].type)).filter((g=>void 0!==g));if(!i.every((g=>g===i[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Va["math/compose"]=Va["math/matCompose"],Va["math/decompose"]=Va["math/matDecompose"];var la=a(12422);const Za={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Bi",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class ha{constructor(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=g,this._gltf=i,this._animationTargetFps=a,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const g of this._interactivityGraph.types)this._types.push(Za[g.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const g of this._interactivityGraph.declarations){const i=Ca(g);if(!i)throw c.b.Error(["No mapping found for declaration",g]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:i,fullOperationName:g.extension?g.op+":"+g.extension:g.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const g of this._interactivityGraph.variables){const i=this._parseVariable(g);this._staticVariables.push(i)}}_parseVariable(g,i){const a=this._types[g.type];if(!a)throw c.b.Error(["No type found for variable",g]),new Error("Error parsing variables");if(g.value&&g.value.length!==a.length)throw c.b.Error(["Invalid value length for variable",g,a]),new Error("Error parsing variables");const n=g.value||[];if(!n.length)switch(a.flowGraphType){case"boolean":n.push(!1);break;case"FlowGraphInteger":n.push(0);break;case"number":n.push(NaN);break;case"Vector2":n.push(NaN,NaN);break;case"Bi":n.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":n.fill(NaN,0,4);break;case"Matrix":n.fill(NaN,0,16);break;case"Matrix3D":n.fill(NaN,0,9)}return"number"===a.elementType&&"string"===typeof n[0]&&(n[0]=parseFloat(n[0])),{type:a.flowGraphType,value:i?i(n,this):n}}_parseEvents(){if(this._interactivityGraph.events)for(const g of this._interactivityGraph.events){const i={eventId:g.id||"internalEvent_"+this._internalEventsCounter++};g.values&&(i.eventData=Object.keys(g.values).map((i=>{var a;const n=null===(a=g.values)||void 0===a?void 0:a[i];if(!n)throw c.b.Error(["No value found for event key",i]),new Error("Error parsing events");const L=this._types[n.type];if(!L)throw c.b.Error(["No type found for event value",n]),new Error("Error parsing events");const d="undefined"!==typeof n.value?this._parseVariable(n):void 0;return{id:i,type:L.flowGraphType,eventData:!0,value:d}}))),this._events.push(i)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const i of this._interactivityGraph.nodes){if("number"!==typeof i.declaration)throw c.b.Error(["No declaration found for node",i]),new Error("Error parsing nodes");const a=this._mappings[i.declaration];if(!a)throw c.b.Error(["No mapping found for node",i]),new Error("Error parsing nodes");if(a.flowGraphMapping.validation){const n=a.flowGraphMapping.validation(i,this._interactivityGraph,this._gltf);var g;if(!n.valid)throw new Error(`Error validating interactivity node ${null===(g=this._interactivityGraph.declarations)||void 0===g?void 0:g[i.declaration].op} - ${n.error}`)}const n=[];for(const g of a.flowGraphMapping.cI){const L=this._getEmptyBlock(g,a.fullOperationName);this._parseNodeConfiguration(i,L,a.flowGraphMapping,g),n.push(L)}this._nodes.push({cI:n,fullOperationName:a.fullOperationName})}}_getEmptyBlock(g,i){return{uniqueId:(0,la.d)(),className:g,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:i,metadata:{}}}_parseNodeConfiguration(g,i,a,n){const L=i.config;if(g.configuration){const i=Object.keys(g.configuration);for(const k of i){var d,b;const i=null===(d=g.configuration)||void 0===d?void 0:d[k];if(!i)throw c.b.Error(["No value found for node configuration",k]),new Error("Error parsing node configuration");const e=null===(b=a.configuration)||void 0===b?void 0:b[k];if(e&&e.va?e.va===n:0===a.cI.indexOf(n)){const g=(null===e||void 0===e?void 0:e.name)||k;i&&"undefined"!==typeof i.value||"undefined"===typeof(null===e||void 0===e?void 0:e.defaultValue)?i.value.length>=0?L[g]={value:1===i.value.length?i.value[0]:i.value}:c.b.Warn(["Invalid value for node configuration",i]):L[g]={value:e.defaultValue},e&&e.dataTransformer&&(L[g].value=e.dataTransformer([L[g].value],this)[0])}}}}_parseNodeConnections(g){for(let v=0;v<this._nodes.length;v++){var i;const P=null===(i=this._interactivityGraph.nodes)||void 0===i?void 0:i[v];if(!P)throw c.b.Error(["No node found for interactivity node",this._nodes[v]]),new Error("Error parsing node connections");const Y=this._nodes[v],f=this._mappings[P.declaration];if(!f)throw c.b.Error(["No mapping found for node",P]),new Error("Error parsing node connections");const C=P.flows||{},U=Object.keys(C).sort();for(const g of U){var a,n,L,d;const i=C[g],N=null===(a=f.flowGraphMapping.outputs)||void 0===a||null===(n=a.flows)||void 0===n?void 0:n[g],F=(null===N||void 0===N?void 0:N.name)||g,I=this._createNewSocketConnection(F,!0);(N&&N.va&&Y.cI.find((g=>g.className===N.va))||Y.cI[0]).signalOutputs.push(I);const j=i.node,y=this._nodes[j];if(!y)throw c.b.Error(["No node found for input node id",j]),new Error("Error parsing node connections");const B=fa(y.fullOperationName);if(!B)throw c.b.Error(["No mapping found for input node",y]),new Error("Error parsing node connections");let D=null===(L=B.inputs)||void 0===L||null===(d=L.flows)||void 0===d?void 0:d[i.socket||"in"],p=!1;if(!D)for(const g in null===(b=B.inputs)||void 0===b?void 0:b.flows){var b,k,e;if(g.startsWith("[")&&g.endsWith("]"))p=!0,D=null===(k=B.inputs)||void 0===k||null===(e=k.flows)||void 0===e?void 0:e[g]}const R=D?p?D.name.replace("$1",i.socket||""):D.name:i.socket||"in",x=D&&D.va&&y.cI.find((g=>g.className===D.va))||y.cI[0];let E=x.signalInputs.find((g=>g.name===R));E||(E=this._createNewSocketConnection(R),x.signalInputs.push(E)),E.connectedPointIds.push(I.uniqueId),I.connectedPointIds.push(E.uniqueId)}const S=P.values||{},V=Object.keys(S);for(const i of V){var N,F;const a=S[i];let n=null===(N=f.flowGraphMapping.inputs)||void 0===N||null===(F=N.values)||void 0===F?void 0:F[i],L=!1;if(!n)for(const g in null===(I=f.flowGraphMapping.inputs)||void 0===I?void 0:I.values){var I,j,y;if(g.startsWith("[")&&g.endsWith("]"))L=!0,n=null===(j=f.flowGraphMapping.inputs)||void 0===j||null===(y=j.values)||void 0===y?void 0:y[g]}const d=n?L?n.name.replace("$1",i):n.name:i,b=this._createNewSocketConnection(d);if((n&&n.va&&Y.cI.find((g=>g.className===n.va))||Y.cI[0]).dataInputs.push(b),void 0!==a.value){const i=this._parseVariable(a,n&&n.dataTransformer);g._connectionValues[b.uniqueId]=i}else{if("undefined"===typeof a.node)throw c.b.Error(["Invalid value for value connection",a]),new Error("Error parsing node connections");{var B,D,p;const g=a.node,i=a.socket||"value",n=this._nodes[g];if(!n)throw c.b.Error(["No node found for output socket reference",a]),new Error("Error parsing node connections");const L=fa(n.fullOperationName);if(!L)throw c.b.Error(["No mapping found for output socket reference",a]),new Error("Error parsing node connections");let d=null===(B=L.outputs)||void 0===B||null===(D=B.values)||void 0===D?void 0:D[i],k=!1;if(!d)for(const a in null===(R=L.outputs)||void 0===R?void 0:R.values){var R,x,E;if(a.startsWith("[")&&a.endsWith("]"))k=!0,d=null===(x=L.outputs)||void 0===x||null===(E=x.values)||void 0===E?void 0:E[a]}const e=d?k?d.name.replace("$1",i):null===(p=d)||void 0===p?void 0:p.name:i,N=d&&d.va&&n.cI.find((g=>g.className===d.va))||n.cI[0];let F=N.dataOutputs.find((g=>g.name===e));F||(F=this._createNewSocketConnection(e,!0),N.dataOutputs.push(F)),b.connectedPointIds.push(F.uniqueId),F.connectedPointIds.push(b.uniqueId)}}}if(f.flowGraphMapping.interBlockConnectors)for(const g of f.flowGraphMapping.interBlockConnectors){const i=g.input,a=g.output,n=g.isVariable;this._connectFlowGraphNodes(i,a,Y.cI[g.inputBlockIndex],Y.cI[g.outputBlockIndex],n)}if(f.flowGraphMapping.extraProcessor){var X;const i=null===(X=this._interactivityGraph.declarations)||void 0===X?void 0:X[P.declaration];if(!i)throw c.b.Error(["No declaration found for extra processor",P]),new Error("Error parsing node connections");Y.cI=f.flowGraphMapping.extraProcessor(P,i,f.flowGraphMapping,this,Y.cI,g,this._gltf)}}}_createNewSocketConnection(g,i){return{uniqueId:(0,la.d)(),name:g,_connectionType:i?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(g,i,a,n,L){const d=L?a.dataInputs:a.signalInputs,b=L?n.dataOutputs:n.signalOutputs,k=d.find((i=>i.name===g))||this._createNewSocketConnection(g),e=b.find((g=>g.name===i))||this._createNewSocketConnection(i,!0);d.find((i=>i.name===g))||d.push(k),b.find((g=>g.name===i))||b.push(e),k.connectedPointIds.push(e.uniqueId),e.connectedPointIds.push(k.uniqueId)}getVariableName(g){return"staticVariable_"+g}serializeToFlowGraph(){const g={uniqueId:(0,la.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(g);for(let i=0;i<this._staticVariables.length;i++){const a=this._staticVariables[i];g._userVariables[this.getVariableName(i)]=a}return{rightHanded:!0,allBlocks:this._nodes.reduce(((g,i)=>g.concat(i.cI)),[]),executionContexts:[g]}}}const wa="KHR_interactivity";class ta{constructor(g){this._loader=g,this.name=wa,this.enabled=this._loader.isExtensionUsed(wa),this._pathConverter=(0,A.i)(this._loader.Dd),g._skipStartAnimationStep=!0;const i=g.babylonScene;i&&function(g){(0,A.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!g.activeCamera)return new L.Quaternion(NaN,NaN,NaN,NaN);const i=L.Quaternion.FromRotationMatrix(g.activeCamera.getWorldMatrix()).normalize();return g.useRightHandedSystem||(i.w*=-1,i.x*=-1),i},type:"Quaternion",getTarget:()=>g.activeCamera}),(0,A.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!g.activeCamera)return new L.Bi(NaN,NaN,NaN);const i=g.activeCamera.getWorldMatrix().getTranslation();return g.useRightHandedSystem||(i.x*=-1),i},type:"Bi",getTarget:()=>g.activeCamera}),(0,A.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:g=>{var i;return(null===(i=g._babylonAnimationGroup)||void 0===i?void 0:i.isPlaying)??!1},type:"boolean",getTarget:g=>g._babylonAnimationGroup}),(0,A.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:g=>{var i;return((null===(i=g._babylonAnimationGroup)||void 0===i?void 0:i.from)??0)/60},type:"number",getTarget:g=>g._babylonAnimationGroup}),(0,A.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:g=>{var i;return((null===(i=g._babylonAnimationGroup)||void 0===i?void 0:i.to)??0)/60},type:"number",getTarget:g=>g._babylonAnimationGroup}),(0,A.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:g=>{var i;return((null===(i=g._babylonAnimationGroup)||void 0===i?void 0:i.getCurrentFrame())??0)/60},type:"number",getTarget:g=>g._babylonAnimationGroup}),(0,A.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:g=>{var i;return((null===(i=g._babylonAnimationGroup)||void 0===i?void 0:i.getCurrentFrame())??0)/60},type:"number",getTarget:g=>g._babylonAnimationGroup})}(i)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var g;if(!this._loader.babylonScene||!this._pathConverter)return;const i=this._loader.babylonScene,a=null===(g=this._loader.Dd.extensions)||void 0===g?void 0:g.KHR_interactivity;if(!a)return;const n=new Ba.e({Di:i});n.dispatchEventsSynchronously=!1;const L=a.graphs.map((g=>new ha(g,this._loader.Dd,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(L.map((async g=>await va(g,{coordinator:n,pathConverter:this._pathConverter})))),n.start()}}var Aa;Aa=async()=>(await Promise.resolve().then(a.bind(a,14280))).FlowGraphGLTFDataProvider,ca[`${wa}/${"FlowGraphGLTFDataProvider"}`]=Aa,t(wa),w(wa,!0,(g=>new ta(g)));const Oa="KHR_node_visibility";(0,A.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:g=>{const i=g._babylonTransformNode;return!i||void 0===i.isVisible||i.isVisible},set:(g,i)=>{var a,n;null===(a=i._primitiveBabylonMeshes)||void 0===a||a.forEach((g=>{g.inheritVisibility=!0})),i._babylonTransformNode&&(i._babylonTransformNode.isVisible=g),null===(n=i._primitiveBabylonMeshes)||void 0===n||n.forEach((i=>{i.isVisible=g}))},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class za{constructor(g){this.name=Oa,this._loader=g,this.enabled=g.isExtensionUsed(Oa)}async onReady(){var g;null===(g=this._loader.Dd.nodes)||void 0===g||g.forEach((g=>{var i,a,n,L;(null===(i=g._primitiveBabylonMeshes)||void 0===i||i.forEach((g=>{g.inheritVisibility=!0})),null!==(a=g.extensions)&&void 0!==a&&a.KHR_node_visibility)&&(!1===(null===(n=g.extensions)||void 0===n?void 0:n.KHR_node_visibility.visible)&&(g._babylonTransformNode&&(g._babylonTransformNode.isVisible=!1),null===(L=g._primitiveBabylonMeshes)||void 0===L||L.forEach((g=>{g.isVisible=!1}))))}))}dispose(){this._loader=null}}t(Oa),w(Oa,!0,(g=>new za(g)));const sa="KHR_node_selectability";Ua("event/onSelect",sa,{cI:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",va:"FlowGraphGetVariableBlock",dataTransformer:g=>["pickedMesh_"+g[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",va:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(g,i,a,n,L,d,b){var k,e,N,F,I,j;const y=L[L.length-1];y.config=y.config||{},y.config.glTF=b;const B=null===(k=g.configuration)||void 0===k||null===(e=k.nodeIndex)||void 0===e?void 0:e.value[0];if(void 0===B||"number"!==typeof B)throw new Error("nodeIndex not found in configuration");const c="pickedMesh_"+B;return L[1].config.variable=c,d._userVariables[c]={className:"Mesh",id:null===b||void 0===b||null===(N=b.nodes)||void 0===N||null===(F=N[B]._babylonTransformNode)||void 0===F?void 0:F.id,uniqueId:null===b||void 0===b||null===(I=b.nodes)||void 0===I||null===(j=I[B]._babylonTransformNode)||void 0===j?void 0:j.uniqueId},L}}),(0,A.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:g=>{const i=g._babylonTransformNode;return!i||void 0===i.zN||i.zN},set:(g,i)=>{var a;null===(a=i._primitiveBabylonMeshes)||void 0===a||a.forEach((i=>{i.zN=g}))},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"zN"],type:"boolean"});class mn{constructor(g){this.name=sa,this._loader=g,this.enabled=g.isExtensionUsed(sa)}async onReady(){var g;null===(g=this._loader.Dd.nodes)||void 0===g||g.forEach((g=>{var i,a,n;null!==(i=g.extensions)&&void 0!==i&&i.KHR_node_selectability&&!1===(null===(a=g.extensions)||void 0===a?void 0:a.KHR_node_selectability.selectable)&&(null===(n=g._babylonTransformNode)||void 0===n||n.getChildMeshes().forEach((g=>{g.zN=!1})))}))}dispose(){this._loader=null}}t(sa),w(sa,!0,(g=>new mn(g)));const ra="KHR_node_hoverability",Qa="targetMeshPointerOver_";Ua("event/onHoverIn",ra,{cI:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",va:"FlowGraphGetVariableBlock",dataTransformer:g=>[Qa+g[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",va:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(g,i,a,n,L,d,b){var k,e,N,F,I,j;const y=L[L.length-1];y.config=y.config||{},y.config.glTF=b;const B=null===(k=g.configuration)||void 0===k||null===(e=k.nodeIndex)||void 0===e?void 0:e.value[0];if(void 0===B||"number"!==typeof B)throw new Error("nodeIndex not found in configuration");const c=Qa+B;return L[1].config.variable=c,d._userVariables[c]={className:"Mesh",id:null===b||void 0===b||null===(N=b.nodes)||void 0===N||null===(F=N[B]._babylonTransformNode)||void 0===F?void 0:F.id,uniqueId:null===b||void 0===b||null===(I=b.nodes)||void 0===I||null===(j=I[B]._babylonTransformNode)||void 0===j?void 0:j.uniqueId},L}});const oa="targetMeshPointerOut_";Ua("event/onHoverOut",ra,{cI:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",va:"FlowGraphGetVariableBlock",dataTransformer:g=>[oa+g[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",va:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(g,i,a,n,L,d,b){var k,e,N,F,I,j;const y=L[L.length-1];y.config=y.config||{},y.config.glTF=b;const B=null===(k=g.configuration)||void 0===k||null===(e=k.nodeIndex)||void 0===e?void 0:e.value[0];if(void 0===B||"number"!==typeof B)throw new Error("nodeIndex not found in configuration");const c=oa+B;return L[1].config.variable=c,d._userVariables[c]={className:"Mesh",id:null===b||void 0===b||null===(N=b.nodes)||void 0===N||null===(F=N[B]._babylonTransformNode)||void 0===F?void 0:F.id,uniqueId:null===b||void 0===b||null===(I=b.nodes)||void 0===I||null===(j=I[B]._babylonTransformNode)||void 0===j?void 0:j.uniqueId},L}}),(0,A.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:g=>{const i=g._babylonTransformNode;return!i||void 0===i.pointerOverDisableMeshTesting||i.pointerOverDisableMeshTesting},set:(g,i)=>{var a;null===(a=i._primitiveBabylonMeshes)||void 0===a||a.forEach((i=>{i.pointerOverDisableMeshTesting=!g}))},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class ua{constructor(g){this.name=ra,this._loader=g,this.enabled=g.isExtensionUsed(ra)}async onReady(){var g;null===(g=this._loader.Dd.nodes)||void 0===g||g.forEach((g=>{var i,a,n;null!==(i=g.extensions)&&void 0!==i&&i.KHR_node_hoverability&&!1===(null===(a=g.extensions)||void 0===a?void 0:a.KHR_node_hoverability.hoverable)&&(null===(n=g._babylonTransformNode)||void 0===n||n.getChildMeshes().forEach((g=>{g.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}t(ra),w(ra,!0,(g=>new ua(g)));const Ha="ExtrasAsMetadata";class Ma{_assignExtras(g,i){if(i.extras&&Object.keys(i.extras).length>0){const a=g.metadata=g.metadata||{};(a.Dd=a.Dd||{}).extras=i.extras}}constructor(g){this.name=Ha,this.enabled=!0,this._loader=g}dispose(){this._loader=null}loadNodeAsync(g,i,a){return this._loader.loadNodeAsync(g,i,(g=>{this._assignExtras(g,i),a(g)}))}loadCameraAsync(g,i,a){return this._loader.loadCameraAsync(g,i,(g=>{this._assignExtras(g,i),a(g)}))}createMaterial(g,i,a){const n=this._loader.createMaterial(g,i,a);return this._assignExtras(n,i),n}}t(Ha),w(Ha,!1,(g=>new Ma(g)));a(14280)},14124:(g,i,a)=>{"use strict";a.d(i,{d:()=>T,e:()=>f,h:()=>Y,j:()=>C});var n=a(12286),L=a(12277),d=a(13743),b=a(12910),k=a(12879),e=a(12894),N=a(12292),F=a(12316),I=a(12906),j=a(13004),y=a(12916),B=a(12492);class c{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Wj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.ty=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(g){this._environmentTexture=g}getNodes(){let g=[];g=g.concat(this.meshes),g=g.concat(this.lights),g=g.concat(this.cameras),g=g.concat(this.transformNodes);for(const i of this.skeletons)g=g.concat(i.bones);return g}}class D extends c{}class p{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const g=this.rootNodes;for(const n of g)n.dispose();g.length=0;const i=this.skeletons;for(const n of i)n.dispose();i.length=0;const a=this.animationGroups;for(const n of a)n.dispose();a.length=0}}class R extends c{constructor(g){super(),this._wasAddedToScene=!1,(g=g||F.c.LastCreatedScene)&&(this.Di=g,this.proceduralTextures=[],g.dd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=g.getEngine().onContextRestoredObservable.add((()=>{for(const g of this.geometries)g._rebuild();for(const g of this.meshes)g._rebuild();for(const g of this.Wj)g.rebuild();for(const g of this.textures)g._rebuild()})))}_topologicalSort(g){const i=new Map;for(const b of g)i.set(b.uniqueId,b);const a={dependsOn:new Map,dependedBy:new Map};for(const b of g){const g=b.uniqueId;a.dependsOn.set(g,new Set),a.dependedBy.set(g,new Set)}for(const b of g){const g=b.uniqueId,n=a.dependsOn.get(g);if(b instanceof I.d){const L=b.sourceMesh;i.has(L.uniqueId)&&(n.add(L.uniqueId),a.dependedBy.get(L.uniqueId).add(g))}const L=a.dependedBy.get(g);for(const d of b.getDescendants()){const n=d.uniqueId;if(i.has(n)){L.add(n);a.dependsOn.get(n).add(g)}}}const n=[],L=[];for(const b of g){const g=b.uniqueId;0===a.dependsOn.get(g).size&&(L.push(b),i.delete(g))}const d=L;for(;d.length>0;){const g=d.shift();n.push(g);const L=a.dependedBy.get(g.uniqueId);for(const n of Array.from(L.values())){const L=a.dependsOn.get(n);L.delete(g.uniqueId),0===L.size&&i.get(n)&&(d.push(i.get(n)),i.delete(n))}}return i.size>0&&(N.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),i.forEach((g=>{N.b.Error(g.name)}))),n}_addNodeAndDescendantsToList(g,i,a,n){if(a&&(!n||n(a))&&!i.has(a.uniqueId)){g.push(a),i.add(a.uniqueId);for(const L of a.getDescendants(!0))this._addNodeAndDescendantsToList(g,i,L,n)}}_isNodeInContainer(g){return g instanceof e.d&&-1!==this.meshes.indexOf(g)||(g instanceof k.c&&-1!==this.transformNodes.indexOf(g)||(g instanceof j.e&&-1!==this.lights.indexOf(g)||g instanceof y.b&&-1!==this.cameras.indexOf(g)))}_isValidHierarchy(){for(const g of this.meshes)if(g.parent&&!this._isNodeInContainer(g.parent))return N.b.Warn(`Node ${g.name} has a parent that is not in the container.`),!1;for(const g of this.transformNodes)if(g.parent&&!this._isNodeInContainer(g.parent))return N.b.Warn(`Node ${g.name} has a parent that is not in the container.`),!1;for(const g of this.lights)if(g.parent&&!this._isNodeInContainer(g.parent))return N.b.Warn(`Node ${g.name} has a parent that is not in the container.`),!1;for(const g of this.cameras)if(g.parent&&!this._isNodeInContainer(g.parent))return N.b.Warn(`Node ${g.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(g){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||L.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const n={},d={},k=new p,e=[],N=[],F={doNotInstantiate:!0,...a},I=[],j=new Set;for(const L of this.transformNodes)null===L.parent&&this._addNodeAndDescendantsToList(I,j,L,F.predicate);for(const L of this.meshes)null===L.parent&&this._addNodeAndDescendantsToList(I,j,L,F.predicate);const y=this._topologicalSort(I),B=(a,L)=>{if(((i,a)=>{if(n[i.uniqueId]=a.uniqueId,d[a.uniqueId]=a,g&&(a.name=g(i.name)),a instanceof b.e){const g=a;if(g.morphTargetManager){const a=i.morphTargetManager;g.morphTargetManager=a.clone();for(let i=0;i<a.numTargets;i++){const L=a.getTarget(i),b=g.morphTargetManager.getTarget(i);n[L.uniqueId]=b.uniqueId,d[b.uniqueId]=b}}}})(a,L),a.parent){const g=n[a.parent.uniqueId],i=d[g];L.parent=i||a.parent}if(L.position&&a.position&&L.position.I(a.position),L.rotationQuaternion&&a.rotationQuaternion&&L.rotationQuaternion.I(a.rotationQuaternion),L.rotation&&a.rotation&&L.rotation.I(a.rotation),L.rd&&a.rd&&L.rd.I(a.rd),L.material){const b=L;if(b.material)if(i){const i=a.material;if(-1===N.indexOf(i)){let a=i.clone(g?g(i.name):"Clone of "+i.name);if(N.push(i),n[i.uniqueId]=a.uniqueId,d[a.uniqueId]=a,"MultiMaterial"===i.getClassName()){const L=i;for(const i of L.Wd)i&&(a=i.clone(g?g(i.name):"Clone of "+i.name),N.push(i),n[i.uniqueId]=a.uniqueId,d[a.uniqueId]=a);L.Wd=L.Wd.map((g=>g&&d[n[g.uniqueId]]))}}"InstancedMesh"!==b.getClassName()&&(b.material=d[n[i.uniqueId]])}else"MultiMaterial"===b.material.getClassName()?-1===this.Di.multiMaterials.indexOf(b.material)&&this.Di.addMultiMaterial(b.material):-1===this.Di.materials.indexOf(b.material)&&this.Di.addMaterial(b.material)}null===L.parent&&k.rootNodes.push(L)};for(const L of y)if("InstancedMesh"===L.getClassName()){const g=L,i=g.sourceMesh,a=n[i.uniqueId];B(g,("number"===typeof a?d[a]:i).createInstance(g.name))}else{let g=!0;"bb"===L.getClassName()||"Node"===L.getClassName()||L.skeleton||!L.getTotalVertices||0===L.getTotalVertices()?g=!1:F.doNotInstantiate&&(g="function"===typeof F.doNotInstantiate?!F.doNotInstantiate(L):!F.doNotInstantiate);const i=g?L.createInstance(`instance of ${L.name}`):L.clone(`Clone of ${L.name}`,null,!0);if(!i)throw new Error(`Could not clone or instantiate node on Asset Container ${L.name}`);B(L,i)}for(const L of this.skeletons){if(F.predicate&&!F.predicate(L))continue;const i=L.clone(g?g(L.name):"Clone of "+L.name);for(const g of this.meshes)if(g.skeleton===L&&!g.isAnInstance){const a=d[n[g.uniqueId]];if(!a||a.isAnInstance)continue;if(a.skeleton=i,-1!==e.indexOf(i))continue;e.push(i);for(const g of i.bones)g._linkedTransformNode&&(g._linkedTransformNode=d[n[g._linkedTransformNode.uniqueId]])}k.skeletons.push(i)}for(const L of this.animationGroups){if(F.predicate&&!F.predicate(L))continue;const i=L.clone(g?g(L.name):"Clone of "+L.name,(g=>d[n[g.uniqueId]]||g));k.animationGroups.push(i)}return k}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||L.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Di.environmentTexture=this.environmentTexture);for(const g of this.Di._serializableComponents)g.addFromContainer(this);this.Di.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const i=[];for(const a of this.cameras)g&&!g(a)||(this.Di.addCamera(a),i.push(a));for(const a of this.lights)g&&!g(a)||(this.Di.addLight(a),i.push(a));for(const a of this.meshes)g&&!g(a)||(this.Di.nI(a),i.push(a));for(const a of this.skeletons)g&&!g(a)||this.Di.addSkeleton(a);for(const a of this.animations)g&&!g(a)||this.Di.addAnimation(a);for(const a of this.animationGroups)g&&!g(a)||this.Di.addAnimationGroup(a);for(const a of this.multiMaterials)g&&!g(a)||this.Di.addMultiMaterial(a);for(const a of this.materials)g&&!g(a)||this.Di.addMaterial(a);for(const a of this.morphTargetManagers)g&&!g(a)||this.Di.addMorphTargetManager(a);for(const a of this.geometries)g&&!g(a)||this.Di.addGeometry(a);for(const a of this.transformNodes)g&&!g(a)||(this.Di.addTransformNode(a),i.push(a));for(const a of this.actionManagers)g&&!g(a)||this.Di.addActionManager(a);for(const a of this.textures)g&&!g(a)||this.Di.addTexture(a);for(const a of this.reflectionProbes)g&&!g(a)||this.Di.addReflectionProbe(a);for(const a of i)a.parent&&-1===this.Di.getNodes().indexOf(a.parent)&&(a.setParent?a.setParent(null):a.parent=null)}removeAllFromScene(){this._isValidHierarchy()||L.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Di.environmentTexture&&(this.Di.environmentTexture=null);for(const g of this.Di._serializableComponents)g.removeFromContainer(this)}removeFromScene(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const i of this.cameras)g&&!g(i)||this.Di.removeCamera(i);for(const i of this.lights)g&&!g(i)||this.Di.removeLight(i);for(const i of this.meshes)g&&!g(i)||this.Di.aI(i,!0);for(const i of this.skeletons)g&&!g(i)||this.Di.removeSkeleton(i);for(const i of this.animations)g&&!g(i)||this.Di.removeAnimation(i);for(const i of this.animationGroups)g&&!g(i)||this.Di.removeAnimationGroup(i);for(const i of this.multiMaterials)g&&!g(i)||this.Di.removeMultiMaterial(i);for(const i of this.materials)g&&!g(i)||this.Di.removeMaterial(i);for(const i of this.morphTargetManagers)g&&!g(i)||this.Di.removeMorphTargetManager(i);for(const i of this.geometries)g&&!g(i)||this.Di.removeGeometry(i);for(const i of this.transformNodes)g&&!g(i)||this.Di.removeTransformNode(i);for(const i of this.actionManagers)g&&!g(i)||this.Di.removeActionManager(i);for(const i of this.textures)g&&!g(i)||this.Di.removeTexture(i);for(const i of this.reflectionProbes)g&&!g(i)||this.Di.removeReflectionProbe(i)}dispose(){const g=this.cameras.slice(0);for(const y of g)y.dispose();this.cameras.length=0;const i=this.lights.slice(0);for(const y of i)y.dispose();this.lights.length=0;const a=this.meshes.slice(0);for(const y of a)y.dispose();this.meshes.length=0;const n=this.skeletons.slice(0);for(const y of n)y.dispose();this.skeletons.length=0;const L=this.animationGroups.slice(0);for(const y of L)y.dispose();this.animationGroups.length=0;const d=this.multiMaterials.slice(0);for(const y of d)y.dispose();this.multiMaterials.length=0;const b=this.materials.slice(0);for(const y of b)y.dispose();this.materials.length=0;const k=this.geometries.slice(0);for(const y of k)y.dispose();this.geometries.length=0;const e=this.transformNodes.slice(0);for(const y of e)y.dispose();this.transformNodes.length=0;const N=this.actionManagers.slice(0);for(const y of N)y.dispose();this.actionManagers.length=0;const F=this.textures.slice(0);for(const y of F)y.dispose();this.textures.length=0;const I=this.reflectionProbes.slice(0);for(const y of I)y.dispose();this.reflectionProbes.length=0;const j=this.morphTargetManagers.slice(0);for(const y of j)y.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const y of this.Di._serializableComponents)y.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Di.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(g,i,a){if(g&&i)for(const n of g){let g=!0;if(a)for(const i of a)if(n===i){g=!1;break}g&&(i.push(n),n._parentContainer=this)}}moveAllFromScene(g){this._wasAddedToScene=!1,void 0===g&&(g=new D);for(const i in this)Object.prototype.hasOwnProperty.call(this,i)&&(this[i]=this[i]||("_environmentTexture"===i?null:[]),this._moveAssets(this.Di[i],this[i],g[i]));this.environmentTexture=this.Di.environmentTexture,this.removeAllFromScene()}createRootMesh(){const g=new b.e("assetContainerRootMesh",this.Di);for(const i of this.meshes)i.parent||g.addChild(i);return this.meshes.unshift(g),g}mergeAnimationsTo(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.c.LastCreatedScene,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!g)return N.b.Error("No scene available to merge animations to"),[];const n=a||(i=>{let a=null;const n=i.animations.length?i.animations[0].targetProperty:"",L=i.name.split(".").join("").split("_primitive")[0];switch(n){case"position":case"rotationQuaternion":a=g.getTransformNodeByName(i.name)||g.getTransformNodeByName(L);break;case"influence":a=g.getMorphTargetByName(i.name)||g.getMorphTargetByName(L);break;default:a=g.getNodeByName(i.name)||g.getNodeByName(L)}return a}),L=this.getNodes();for(const k of L){const g=n(k);if(null!==g){for(const i of k.animations){const a=g.animations.filter((g=>g.targetProperty===i.targetProperty));for(const i of a){const a=g.animations.indexOf(i,0);a>-1&&g.animations.splice(a,1)}}g.animations=g.animations.concat(k.animations)}}const d=[],b=this.animationGroups.slice();for(const k of b){d.push(k.clone(k.name,n));for(const g of k.animatables)g.stop()}for(const k of i){const i=n(k.target);i&&(g.beginAnimation(i,k.fromFrame,k.toFrame,k.loopAnimation,k.speedRatio,k.onAnimationEnd?k.onAnimationEnd:void 0,void 0,!0,void 0,k.onAnimationLoop?k.onAnimationLoop:void 0),g.stopAnimation(k.target))}return d}populateRootNodes(){this.rootNodes.length=0;for(const g of this.meshes)g.parent||-1!==this.rootNodes.indexOf(g)||this.rootNodes.push(g);for(const g of this.transformNodes)g.parent||-1!==this.rootNodes.indexOf(g)||this.rootNodes.push(g);for(const g of this.lights)g.parent||-1!==this.rootNodes.indexOf(g)||this.rootNodes.push(g);for(const g of this.cameras)g.parent||-1!==this.rootNodes.indexOf(g)||this.rootNodes.push(g)}addAllAssetsToContainer(g){if(!g)return;const i=[],a=new Set;for(i.push(g);i.length>0;){const g=i.pop();if(g instanceof b.e?(g.wd&&-1===this.geometries.indexOf(g.wd)&&this.geometries.push(g.wd),this.meshes.push(g)):g instanceof I.d?this.meshes.push(g):g instanceof k.c?this.transformNodes.push(g):g instanceof j.e?this.lights.push(g):g instanceof y.b&&this.cameras.push(g),g instanceof e.d){if(g.material&&-1===this.materials.indexOf(g.material)){this.materials.push(g.material);for(const i of g.material.getActiveTextures())-1===this.textures.indexOf(i)&&this.textures.push(i)}g.skeleton&&-1===this.skeletons.indexOf(g.skeleton)&&this.skeletons.push(g.skeleton),g.morphTargetManager&&-1===this.morphTargetManagers.indexOf(g.morphTargetManager)&&this.morphTargetManagers.push(g.morphTargetManager)}for(const n of g.getChildren())a.has(n)||i.push(n);a.add(g)}this.populateRootNodes()}_getByTags(g,i,a){if(void 0===i)return g;const n=[];for(const L in g){const d=g[L];B.c&&B.c.MatchesQuery(d,i)&&(!a||a(d))&&n.push(d)}return n}getMeshesByTags(g,i){return this._getByTags(this.meshes,g,i)}getCamerasByTags(g,i){return this._getByTags(this.cameras,g,i)}getLightsByTags(g,i){return this._getByTags(this.lights,g,i)}getMaterialsByTags(g,i){return this._getByTags(this.materials,g,i).concat(this._getByTags(this.multiMaterials,g,i))}getTransformNodesByTags(g,i){return this._getByTags(this.transformNodes,g,i)}}var x=a(12334);class E{constructor(g){this.byteOffset=0,this.buffer=g}async loadAsync(g){const i=await this.buffer.readAsync(this.byteOffset,g);this._dataView=new DataView(i.buffer,i.byteOffset,i.byteLength),this._dataByteOffset=0}readUint32(){const g=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,g}readUint8Array(g){const i=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,g);return this._dataByteOffset+=g,this.byteOffset+=g,i}readString(g){return(0,x.g)(this.readUint8Array(g))}skipBytes(g){this._dataByteOffset+=g,this.byteOffset+=g}}var X=a(14132);const v="Z2xURg",P={name:"Dd",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:g=>-1!==g.indexOf("asset")&&-1!==g.indexOf("version")||g.startsWith("data:base64,"+v)||g.startsWith("data:;base64,"+v)||g.startsWith("data:application/octet-stream;base64,"+v)||g.startsWith("data:model/gltf-binary;base64,"+v)};var Y,f,C,U=a(12324),S=a(12330);function V(g,i,a){try{return Promise.resolve(new Uint8Array(g,i,a))}catch(n){return Promise.reject(n)}}!function(g){g[g.AUTO=0]="AUTO",g[g.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(Y||(Y={})),function(g){g[g.NONE=0]="NONE",g[g.FIRST=1]="FIRST",g[g.ALL=2]="ALL"}(f||(f={})),function(g){g[g.LOADING=0]="LOADING",g[g.READY=1]="READY",g[g.COMPLETE=2]="COMPLETE"}(C||(C={}));class K{constructor(){this.coordinateSystemMode=Y.AUTO,this.animationStartMode=f.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=g=>Promise.resolve(g),this.extensionOptions={}}I(g){g&&(this.onParsed=g.onParsed,this.coordinateSystemMode=g.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=g.animationStartMode??this.animationStartMode,this.loadNodeAnimations=g.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=g.loadSkins??this.loadSkins,this.loadMorphTargets=g.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=g.compileMaterials??this.compileMaterials,this.useClipPlane=g.useClipPlane??this.useClipPlane,this.compileShadowGenerators=g.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=g.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=g.useRangeRequests??this.useRangeRequests,this.createInstances=g.createInstances??this.createInstances,this.alwaysComputeBoundingBox=g.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=g.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=g.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=g.skipMaterials??this.skipMaterials,this.useSRGBBuffers=g.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=g.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=g.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=g.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=g.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=g.customRootNode,this.onMeshLoaded=g.onMeshLoaded,this.onSkinLoaded=g.onSkinLoaded,this.onTextureLoaded=g.onTextureLoaded,this.onMaterialLoaded=g.onMaterialLoaded,this.onCameraLoaded=g.onCameraLoaded,this.extensionOptions=g.extensionOptions??this.extensionOptions)}}class T extends K{constructor(g){super(),this.onParsedObservable=new n.b,this.onMeshLoadedObservable=new n.b,this.onSkinLoadedObservable=new n.b,this.onTextureLoadedObservable=new n.b,this.onMaterialLoadedObservable=new n.b,this.onCameraLoadedObservable=new n.b,this.onCompleteObservable=new n.b,this.onErrorObservable=new n.b,this.dd=new n.b,this.onExtensionLoadedObservable=new n.b,this.validate=!1,this.onValidatedObservable=new n.b,this._loader=null,this._state=null,this._requests=new Array,this.name=P.name,this.extensions=P.extensions,this.onLoaderStateChangedObservable=new n.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.I(g)}set onParsed(g){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),g&&(this._onParsedObserver=this.onParsedObservable.add(g))}set onMeshLoaded(g){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),g&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(g))}set onSkinLoaded(g){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),g&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((i=>g(i.node,i.skinnedNode))))}set onTextureLoaded(g){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),g&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(g))}set onMaterialLoaded(g){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),g&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(g))}set onCameraLoaded(g){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),g&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(g))}set onComplete(g){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(g)}set onError(g){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(g)}set onDispose(g){this._onDisposeObserver&&this.dd.remove(this._onDisposeObserver),this._onDisposeObserver=this.dd.add(g)}set onExtensionLoaded(g){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(g)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(g){this._loggingEnabled!==g&&(this._loggingEnabled=g,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(g){this._capturePerformanceCounters!==g&&(this._capturePerformanceCounters=g,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(g){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(g)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const g of this._requests)g.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=g=>Promise.resolve(g),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.dd.notifyObservers(void 0),this.dd.clear()}loadFile(g,i,a,d,b,k,e,F){if(ArrayBuffer.isView(i))return this._loadBinary(g,i,a,d,e,F),null;this._progressCallback=b;const I=i.name||L.Tools.GetFilename(i);if(k){if(this.useRangeRequests){this.validate&&N.b.Warn("glTF validation is not supported when range requests are enabled");const a={abort:()=>{},onCompleteObservable:new n.b},L={readAsync:(a,n)=>new Promise(((L,d)=>{this._loadFile(g,i,(g=>{L(new Uint8Array(g))}),!0,(g=>{d(g)}),(g=>{g.setRequestHeader("Range",`bytes=${a}-${a+n-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new E(L)).then((g=>{a.onCompleteObservable.notifyObservers(a),d(g)}),e?g=>e(void 0,g):void 0),a}return this._loadFile(g,i,(i=>{this._validate(g,new Uint8Array(i,0,i.byteLength),a,I),this._unpackBinaryAsync(new E({readAsync:(g,a)=>V(i,g,a),byteLength:i.byteLength})).then((g=>{d(g)}),e?g=>e(void 0,g):void 0)}),!0,e)}return this._loadFile(g,i,(i=>{try{this._validate(g,i,a,I),d({json:this._parseJson(i)})}catch{e&&e()}}),!1,e)}_loadBinary(g,i,a,n,L,d){this._validate(g,new Uint8Array(i.buffer,i.byteOffset,i.byteLength),a,d),this._unpackBinaryAsync(new E({readAsync:(g,a)=>function(g,i,a){try{if(i<0||i>=g.byteLength)throw new RangeError("Offset is out of range.");if(i+a>g.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(g.buffer,g.byteOffset+i,a))}catch(n){return Promise.reject(n)}}(i,g,a),byteLength:i.byteLength})).then((g=>{n(g)}),L?g=>L(void 0,g):void 0)}importMeshAsync(g,i,a,n,L,d){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(a),this.onParsedObservable.clear(),this._log(`Loading ${d||""}`),this._loader=this._getLoader(a),this._loader.importMeshAsync(g,i,null,a,n,L,d))))}loadAsync(g,i,a,n,L){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(i),this.onParsedObservable.clear(),this._log(`Loading ${L||""}`),this._loader=this._getLoader(i),this._loader.loadAsync(g,i,a,n,L))))}loadAssetContainerAsync(g,i,a,n,L){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(i),this.onParsedObservable.clear(),this._log(`Loading ${L||""}`),this._loader=this._getLoader(i);const d=new R(g),b=[];this.onMaterialLoadedObservable.add((g=>{b.push(g)}));const k=[];this.onTextureLoadedObservable.add((g=>{k.push(g)}));const e=[];this.onCameraLoadedObservable.add((g=>{e.push(g)}));const N=[];return this.onMeshLoadedObservable.add((g=>{g.morphTargetManager&&N.push(g.morphTargetManager)})),this._loader.importMeshAsync(null,g,d,i,a,n,L).then((g=>(Array.prototype.push.apply(d.geometries,g.geometries),Array.prototype.push.apply(d.meshes,g.meshes),Array.prototype.push.apply(d.Wj,g.Wj),Array.prototype.push.apply(d.skeletons,g.skeletons),Array.prototype.push.apply(d.animationGroups,g.animationGroups),Array.prototype.push.apply(d.materials,b),Array.prototype.push.apply(d.textures,k),Array.prototype.push.apply(d.lights,g.lights),Array.prototype.push.apply(d.transformNodes,g.transformNodes),Array.prototype.push.apply(d.cameras,e),Array.prototype.push.apply(d.morphTargetManagers,N),d)))}))}canDirectLoad(g){return P.canDirectLoad(g)}directLoad(g,i){if(i.startsWith("base64,"+v)||i.startsWith(";base64,"+v)||i.startsWith("application/octet-stream;base64,"+v)||i.startsWith("model/gltf-binary;base64,"+v)){const a=(0,U.d)(i);return this._validate(g,new Uint8Array(a,0,a.byteLength)),this._unpackBinaryAsync(new E({readAsync:(g,i)=>V(a,g,i),byteLength:a.byteLength}))}return this._validate(g,i),Promise.resolve({json:this._parseJson(i)})}createPlugin(g){return new T(g[P.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((g,i)=>{this.onCompleteObservable.addOnce((()=>{g()})),this.onErrorObservable.addOnce((g=>{i(g)}))}))}_setState(g){this._state!==g&&(this._state=g,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(C[this._state]))}_loadFile(g,i,a,n,L,d){const b=g._loadFile(i,a,(g=>{this._onProgress(g,b)}),!0,n,L,d);return b.onCompleteObservable.add((()=>{b._lengthComputable=!0,b._total=b._loaded})),this._requests.push(b),b}_onProgress(g,i){if(!this._progressCallback)return;i._lengthComputable=g.lengthComputable,i._loaded=g.loaded,i._total=g.total;let a=!0,n=0,L=0;for(const d of this._requests){if(void 0===d._lengthComputable||void 0===d._loaded||void 0===d._total)return;a=a&&d._lengthComputable,n+=d._loaded,L+=d._total}this._progressCallback({lengthComputable:a,loaded:n,total:a?L:0})}_validate(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),X.c.ValidateAsync(i,a,n,(i=>this.preprocessUrlAsync(a+i).then((i=>g._loadFileAsync(i,void 0,!0,!0).then((g=>new Uint8Array(g,0,g.byteLength))))))).then((g=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(g),this.onValidatedObservable.clear()}),(g=>{this._endPerformanceCounter("Validate JSON"),L.Tools.Warn(`Failed to validate: ${g.message}`),this.onValidatedObservable.clear()})))}_getLoader(g){const i=g.json.asset||{};this._log(`Asset version: ${i.version}`),i.minVersion&&this._log(`Asset minimum version: ${i.minVersion}`),i.generator&&this._log(`Asset generator: ${i.generator}`);const a=T._parseVersion(i.version);if(!a)throw new Error("Invalid version: "+i.version);if(void 0!==i.minVersion){const g=T._parseVersion(i.minVersion);if(!g)throw new Error("Invalid minimum version: "+i.minVersion);if(T._compareVersion(g,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+i.minVersion)}const n={1:T._CreateGLTF1Loader,2:T._CreateGLTF2Loader}[a.major];if(!n)throw new Error("Unsupported version: "+i.version);return n(this)}_parseJson(g){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${g.length}`);const i=JSON.parse(g);return this._endPerformanceCounter("Parse JSON"),i}_unpackBinaryAsync(g){return this._startPerformanceCounter("Unpack Binary"),g.loadAsync(20).then((()=>{const i=g.readUint32();if(1179937895!==i)throw new S.i("Unexpected magic: "+i,S.e.GLTFLoaderUnexpectedMagicError);const a=g.readUint32();this.loggingEnabled&&this._log(`Binary version: ${a}`);const n=g.readUint32();let L;switch(this.useRangeRequests||n===g.buffer.byteLength||N.b.Warn(`Length in header does not match actual data length: ${n} != ${g.buffer.byteLength}`),a){case 1:L=this._unpackBinaryV1Async(g,n);break;case 2:L=this._unpackBinaryV2Async(g,n);break;default:throw new Error("Unsupported version: "+a)}return this._endPerformanceCounter("Unpack Binary"),L}))}_unpackBinaryV1Async(g,i){const a=g.readUint32(),n=g.readUint32();if(0!==n)throw new Error(`Unexpected content format: ${n}`);const L=i-g.byteOffset,d={json:this._parseJson(g.readString(a)),bin:null};if(0!==L){const i=g.byteOffset;d.bin={readAsync:(a,n)=>g.buffer.readAsync(i+a,n),byteLength:L}}return Promise.resolve(d)}_unpackBinaryV2Async(g,i){const a=1313821514,n=5130562,L=g.readUint32();if(g.readUint32()!==a)throw new Error("First chunk format is not JSON");return g.byteOffset+L===i?g.loadAsync(L).then((()=>({json:this._parseJson(g.readString(L)),bin:null}))):g.loadAsync(L+8).then((()=>{const d={json:this._parseJson(g.readString(L)),bin:null},b=()=>{const L=g.readUint32();switch(g.readUint32()){case a:throw new Error("Unexpected JSON chunk");case n:{const i=g.byteOffset;d.bin={readAsync:(a,n)=>g.buffer.readAsync(i+a,n),byteLength:L},g.skipBytes(L);break}default:g.skipBytes(L)}return g.byteOffset!==i?g.loadAsync(8).then(b):Promise.resolve(d)};return b()}))}static _parseVersion(g){if("1.0"===g||"1.0.1"===g)return{major:1,minor:0};const i=(g+"").match(/^(\d+)\.(\d+)/);return i?{major:parseInt(i[1]),minor:parseInt(i[2])}:null}static _compareVersion(g,i){return g.major>i.major?1:g.major<i.major?-1:g.minor>i.minor?1:g.minor<i.minor?-1:0}_logOpen(g){this._log(g),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(g){const i=T._logSpaces.substring(0,2*this._logIndentLevel);N.b.Log(`${i}${g}`)}_logDisabled(g){}_startPerformanceCounterEnabled(g){L.Tools.StartPerformanceCounter(g)}_startPerformanceCounterDisabled(g){}_endPerformanceCounterEnabled(g){L.Tools.EndPerformanceCounter(g)}_endPerformanceCounterDisabled(g){}}T.IncrementalLoading=!0,T.HomogeneousCoordinates=!1,T._logSpaces="                                ",(0,d.c)(new T)},14132:(g,i,a)=>{"use strict";a.d(i,{c:()=>b});var n=a(12277);function L(g,i,a,n){const L={externalResourceFunction:n};return a&&(L.uri="file:"===i?a:i+a),ArrayBuffer.isView(g)?GLTFValidator.validateBytes(g,L):GLTFValidator.validateString(g,L)}function d(){const g=[];onmessage=i=>{const a=i.data;switch(a.id){case"init":importScripts(a.url);break;case"validate":L(a.data,a.rootUrl,a.fileName,(i=>new Promise(((a,n)=>{const L=g.length;g.push({resolve:a,reject:n}),postMessage({id:"getExternalResource",index:L,uri:i})})))).then((g=>{postMessage({id:"validate.resolve",value:g})}),(g=>{postMessage({id:"validate.reject",reason:g})}));break;case"getExternalResource.resolve":g[a.index].resolve(a.value);break;case"getExternalResource.reject":g[a.index].reject(a.reason)}}}class b{static ValidateAsync(g,i,a,b){return"function"===typeof Worker?new Promise(((k,e)=>{const N=`${L}(${d})()`,F=URL.createObjectURL(new Blob([N],{type:"application/javascript"})),I=new Worker(F),j=g=>{I.removeEventListener("error",j),I.removeEventListener("message",y),e(g)},y=g=>{const i=g.data;switch(i.id){case"getExternalResource":b(i.uri).then((g=>{I.postMessage({id:"getExternalResource.resolve",index:i.index,value:g},[g.buffer])}),(g=>{I.postMessage({id:"getExternalResource.reject",index:i.index,reason:g})}));break;case"validate.resolve":I.removeEventListener("error",j),I.removeEventListener("message",y),k(i.value),I.terminate();break;case"validate.reject":I.removeEventListener("error",j),I.removeEventListener("message",y),e(i.reason),I.terminate()}};if(I.addEventListener("error",j),I.addEventListener("message",y),I.postMessage({id:"init",url:n.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(g)){const n=g.slice();I.postMessage({id:"validate",data:n,rootUrl:i,fileName:a},[n.buffer])}else I.postMessage({id:"validate",data:g,rootUrl:i,fileName:a})})):(this._LoadScriptPromise||(this._LoadScriptPromise=n.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>L(g,i,a,b))))}}b.Configuration={url:`${n.Tools._DefaultCdnUrl}/gltf_validator.js`}},14722:(g,i,a)=>{"use strict";a.d(i,{d:()=>P});var n=a(12441),L=a(12447),d=a(12484),b=a(12452),k=a(12843),e=a(12773),N=a(12526),F=a(12692),I=a(12415),j=a(12367);a(13872),a(13775),a(13795),a(13784),a(13799),a(13803),a(13807);const y="imageProcessingCompatibility",B="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";j.c.IncludesShadersStore[y]||(j.c.IncludesShadersStore[y]=B);const c="skyPixelShader",D="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";j.c.ShadersStore[c]||(j.c.ShadersStore[c]=D);a(13889),a(13816),a(13819),a(13829),a(13822);const p="skyVertexShader",R="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";j.c.ShadersStore[p]||(j.c.ShadersStore[p]=R);var x=a(12770),E=a(12825),X=a(12820);class v extends k.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class P extends e.b{constructor(g,i){super(g,i),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new b.Bi(0,100,0),this.useSunPosition=!1,this.cameraOffset=b.Bi.Zero(),this.up=b.Bi.Up(),this.dithering=!1,this._cameraPosition=b.Bi.Zero(),this._skyOrientation=new b.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(g,i){const a=i._drawWrapper;if(this.isFrozen&&a.effect&&a._wasPreviouslyReady)return!0;i.materialDefines||(i.materialDefines=new v);const n=i.materialDefines,L=this.Pg();if(this._isReadyForSubMesh(i))return!0;if((0,X.O)(g,L,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,n),(0,X.I)(g,n,!0,!1),n.IMAGEPROCESSINGPOSTPROCESS!==L.imageProcessingConfiguration.applyByPostProcess&&n.markAsMiscDirty(),n.DITHER!==this.dithering&&n.markAsMiscDirty(),n.isDirty){n.markAsProcessed(),L.resetCachedMaterial();const g=new x.b;n.FOG&&g.addFallback(1,"FOG"),n.IMAGEPROCESSINGPOSTPROCESS=L.imageProcessingConfiguration.applyByPostProcess,n.DITHER=this.dithering;const a=[N.g.PositionKind];n.VERTEXCOLOR&&a.push(N.g.ColorKind);const d="sky",b=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,E.e)(b);const k=n.toString();i.setEffect(L.getEngine().createEffect(d,a,b,[],k,g,this.onCompiled,this.onError),n,this._materialContext)}return!(!i.effect||!i.effect.isReady())&&(n._renderId=L.getRenderId(),a._wasPreviouslyReady=!0,!0)}bindForSubMesh(g,i,a){const n=this.Pg(),L=a.materialDefines;if(!L)return;const d=a.effect;if(!d)return;this._activeEffect=d,this.bindOnlyWorldMatrix(g),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),this._mustRebind(n,d,a)&&((0,E.i)(d,this,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,X.j)(L,d,n)),n.fogEnabled&&i.applyFog&&n.fogMode!==F.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),(0,X.d)(n,i,this._activeEffect);const k=n.activeCamera;if(k){const g=k.getWorldMatrix();this._cameraPosition.x=g.m[12],this._cameraPosition.y=g.m[13],this._cameraPosition.z=g.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const g=Math.PI*(this.inclination-.5),i=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(i)*Math.cos(g),this.sunPosition.y=this.distance*Math.sin(-g),this.sunPosition.z=this.distance*Math.sin(i)*Math.cos(g),b.Quaternion.FromUnitVectorsToRef(b.Bi.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(i,this._activeEffect,a)}getAnimatables(){return[]}dispose(g){super.dispose(g)}clone(g){return d.c.Clone((()=>new P(g,this.Pg())),this)}serialize(){const g=super.serialize();return g.customType="BABYLON.SkyMaterial",g}getClassName(){return"SkyMaterial"}static Parse(g,i,a){return d.c.Parse((()=>new P(g.name,i)),g,i,a)}}(0,n.e)([(0,L.P)()],P.prototype,"luminance",void 0),(0,n.e)([(0,L.P)()],P.prototype,"turbidity",void 0),(0,n.e)([(0,L.P)()],P.prototype,"rayleigh",void 0),(0,n.e)([(0,L.P)()],P.prototype,"mieCoefficient",void 0),(0,n.e)([(0,L.P)()],P.prototype,"mieDirectionalG",void 0),(0,n.e)([(0,L.P)()],P.prototype,"distance",void 0),(0,n.e)([(0,L.P)()],P.prototype,"inclination",void 0),(0,n.e)([(0,L.P)()],P.prototype,"azimuth",void 0),(0,n.e)([(0,L.M)()],P.prototype,"sunPosition",void 0),(0,n.e)([(0,L.P)()],P.prototype,"useSunPosition",void 0),(0,n.e)([(0,L.M)()],P.prototype,"cameraOffset",void 0),(0,n.e)([(0,L.M)()],P.prototype,"up",void 0),(0,n.e)([(0,L.P)()],P.prototype,"dithering",void 0),(0,I.e)("BABYLON.SkyMaterial",P)},13151:(g,i,a)=>{"use strict";function n(g,i){i.headers=g.headers||{},i.statusMessage=g.statusText,i.statusCode=g.status,i.data=g.response}function L(g,i,a){return new Promise((function(L,d){a=a||{};var b,k,e,N=new XMLHttpRequest,F=a.body,I=a.headers||{};for(b in a.timeout&&(N.timeout=a.timeout),N.ontimeout=N.onerror=function(g){g.timeout="timeout"==g.type,d(g)},N.open(g,i.href||i),N.onload=function(){for(e=N.getAllResponseHeaders().trim().split(/[\r\n]+/),n(N,N);k=e.shift();)k=k.split(": "),N.headers[k.shift().toLowerCase()]=k.join(": ");if((k=N.headers["content-type"])&&~k.indexOf("application/json"))try{N.data=JSON.parse(N.data,a.reviver)}catch(g){return n(N,g),d(g)}(N.status>=400?d:L)(N)},typeof FormData<"u"&&F instanceof FormData||F&&"object"==typeof F&&(I["content-type"]="application/json",F=JSON.stringify(F)),N.withCredentials=!!a.withCredentials,I)N.setRequestHeader(b,I[b]);N.send(F)}))}a.r(i),a.d(i,{del:()=>e,get:()=>d,patch:()=>k,post:()=>b,put:()=>N,send:()=>L});var d=L.bind(L,"GET"),b=L.bind(L,"POST"),k=L.bind(L,"PATCH"),e=L.bind(L,"DELETE"),N=L.bind(L,"PUT")},14837:(g,i,a)=>{"use strict";a.d(i,{c:()=>I});const n=.5*(Math.sqrt(3)-1),L=(3-Math.sqrt(3))/6,d=1/3,b=1/6,k=(Math.sqrt(5)-1)/4,e=(5-Math.sqrt(5))/20,N=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),F=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const I=class{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const i="function"==typeof g?g:function(g){let i=0,a=0,n=0,L=1;const d=function(){let g=4022871197;return function(i){i=i.toString();for(let a=0;a<i.length;a++){g+=i.charCodeAt(a);let n=.02519603282416938*g;g=n>>>0,n-=g,n*=g,g=n>>>0,n-=g,g+=4294967296*n}return 2.3283064365386963e-10*(g>>>0)}}();i=d(" "),a=d(" "),n=d(" "),i-=d(g),i<0&&(i+=1);a-=d(g),a<0&&(a+=1);n-=d(g),n<0&&(n+=1);return function(){const g=2091639*i+2.3283064365386963e-10*L;return i=a,a=n,n=g-(L=0|g)}}(g);this.p=function(g){const i=new Uint8Array(256);for(let a=0;a<256;a++)i[a]=a;for(let a=0;a<255;a++){const n=a+~~(g()*(256-a)),L=i[a];i[a]=i[n],i[n]=L}return i}(i),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let a=0;a<512;a++)this.perm[a]=this.p[255&a],this.permMod12[a]=this.perm[a]%12}noise2D(g,i){const a=this.permMod12,d=this.perm;let b=0,k=0,e=0;const F=(g+i)*n,I=Math.floor(g+F),j=Math.floor(i+F),y=(I+j)*L,B=g-(I-y),c=i-(j-y);let D,p;B>c?(D=1,p=0):(D=0,p=1);const R=B-D+L,x=c-p+L,E=B-1+2*L,X=c-1+2*L,v=255&I,P=255&j;let Y=.5-B*B-c*c;if(Y>=0){const g=3*a[v+d[P]];Y*=Y,b=Y*Y*(N[g]*B+N[g+1]*c)}let f=.5-R*R-x*x;if(f>=0){const g=3*a[v+D+d[P+p]];f*=f,k=f*f*(N[g]*R+N[g+1]*x)}let C=.5-E*E-X*X;if(C>=0){const g=3*a[v+1+d[P+1]];C*=C,e=C*C*(N[g]*E+N[g+1]*X)}return 70*(b+k+e)}noise3D(g,i,a){const n=this.permMod12,L=this.perm;let k,e,F,I;const j=(g+i+a)*d,y=Math.floor(g+j),B=Math.floor(i+j),c=Math.floor(a+j),D=(y+B+c)*b,p=g-(y-D),R=i-(B-D),x=a-(c-D);let E,X,v,P,Y,f;p>=R?R>=x?(E=1,X=0,v=0,P=1,Y=1,f=0):p>=x?(E=1,X=0,v=0,P=1,Y=0,f=1):(E=0,X=0,v=1,P=1,Y=0,f=1):R<x?(E=0,X=0,v=1,P=0,Y=1,f=1):p<x?(E=0,X=1,v=0,P=0,Y=1,f=1):(E=0,X=1,v=0,P=1,Y=1,f=0);const C=p-E+b,U=R-X+b,S=x-v+b,V=p-P+2*b,K=R-Y+2*b,T=x-f+2*b,l=p-1+.5,Z=R-1+.5,h=x-1+.5,w=255&y,t=255&B,A=255&c;let O=.6-p*p-R*R-x*x;if(O<0)k=0;else{const g=3*n[w+L[t+L[A]]];O*=O,k=O*O*(N[g]*p+N[g+1]*R+N[g+2]*x)}let z=.6-C*C-U*U-S*S;if(z<0)e=0;else{const g=3*n[w+E+L[t+X+L[A+v]]];z*=z,e=z*z*(N[g]*C+N[g+1]*U+N[g+2]*S)}let s=.6-V*V-K*K-T*T;if(s<0)F=0;else{const g=3*n[w+P+L[t+Y+L[A+f]]];s*=s,F=s*s*(N[g]*V+N[g+1]*K+N[g+2]*T)}let mg=.6-l*l-Z*Z-h*h;if(mg<0)I=0;else{const g=3*n[w+1+L[t+1+L[A+1]]];mg*=mg,I=mg*mg*(N[g]*l+N[g+1]*Z+N[g+2]*h)}return 32*(k+e+F+I)}noise4D(g,i,a,n){const L=this.perm;let d,b,N,I,j;const y=(g+i+a+n)*k,B=Math.floor(g+y),c=Math.floor(i+y),D=Math.floor(a+y),p=Math.floor(n+y),R=(B+c+D+p)*e,x=g-(B-R),E=i-(c-R),X=a-(D-R),v=n-(p-R);let P=0,Y=0,f=0,C=0;x>E?P++:Y++,x>X?P++:f++,x>v?P++:C++,E>X?Y++:f++,E>v?Y++:C++,X>v?f++:C++;const U=P>=3?1:0,S=Y>=3?1:0,V=f>=3?1:0,K=C>=3?1:0,T=P>=2?1:0,l=Y>=2?1:0,Z=f>=2?1:0,h=C>=2?1:0,w=P>=1?1:0,t=Y>=1?1:0,A=f>=1?1:0,O=C>=1?1:0,z=x-U+e,s=E-S+e,mg=X-V+e,r=v-K+e,Q=x-T+2*e,o=E-l+2*e,u=X-Z+2*e,H=v-h+2*e,M=x-w+3*e,q=E-t+3*e,W=X-A+3*e,G=v-O+3*e,J=x-1+4*e,gg=E-1+4*e,ig=X-1+4*e,ag=v-1+4*e,ng=255&B,Lg=255&c,dg=255&D,bg=255&p;let kg=.6-x*x-E*E-X*X-v*v;if(kg<0)d=0;else{const g=L[ng+L[Lg+L[dg+L[bg]]]]%32*4;kg*=kg,d=kg*kg*(F[g]*x+F[g+1]*E+F[g+2]*X+F[g+3]*v)}let eg=.6-z*z-s*s-mg*mg-r*r;if(eg<0)b=0;else{const g=L[ng+U+L[Lg+S+L[dg+V+L[bg+K]]]]%32*4;eg*=eg,b=eg*eg*(F[g]*z+F[g+1]*s+F[g+2]*mg+F[g+3]*r)}let Ng=.6-Q*Q-o*o-u*u-H*H;if(Ng<0)N=0;else{const g=L[ng+T+L[Lg+l+L[dg+Z+L[bg+h]]]]%32*4;Ng*=Ng,N=Ng*Ng*(F[g]*Q+F[g+1]*o+F[g+2]*u+F[g+3]*H)}let Fg=.6-M*M-q*q-W*W-G*G;if(Fg<0)I=0;else{const g=L[ng+w+L[Lg+t+L[dg+A+L[bg+O]]]]%32*4;Fg*=Fg,I=Fg*Fg*(F[g]*M+F[g+1]*q+F[g+2]*W+F[g+3]*G)}let Ig=.6-J*J-gg*gg-ig*ig-ag*ag;if(Ig<0)j=0;else{const g=L[ng+1+L[Lg+1+L[dg+1+L[bg+1]]]]%32*4;Ig*=Ig,j=Ig*Ig*(F[g]*J+F[g+1]*gg+F[g+2]*ig+F[g+3]*ag)}return 27*(d+b+N+I+j)}}}}]);